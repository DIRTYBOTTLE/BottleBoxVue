"use strict";(self["webpackChunkbottlebox"]=self["webpackChunkbottlebox"]||[]).push([[240],{5240:function(e,t,n){n.r(t),n.d(t,{default:function(){return ddt}});var i=n(3396);const o=e=>((0,i.dD)("data-v-024a05c2"),e=e(),(0,i.Cn)(),e),r=o((()=>(0,i._)("div",{id:"cesiumContainer"},null,-1))),s=(0,i.Uk)("欧氏距离"),a=(0,i.Uk)("贴地距离"),c=(0,i.Uk)("贴地面积"),l=(0,i.Uk)("清除测量"),u=(0,i.Uk)("分析工具"),h=(0,i.Uk)("黄家坝"),d=o((()=>(0,i._)("div",{class:"drawer-title"}," 空间量算 ",-1))),f={class:"drawer-item-container"},p=["src"],m=o((()=>(0,i._)("p",null,"欧式距离",-1))),_=["src"],g=o((()=>(0,i._)("p",null,"贴地距离",-1))),y=["src"],v=o((()=>(0,i._)("p",null,"贴地面积",-1))),b=["src"],A=o((()=>(0,i._)("p",null,"清除测量",-1)));function w(e,t,o,w,T,C){const E=(0,i.up)("el-tree"),x=(0,i.up)("el-button"),S=(0,i.up)("el-drawer");return(0,i.wg)(),(0,i.iD)(i.HY,null,[r,(0,i.Wm)(E,{data:w.tree,onCheckChange:w.handleCheckChange,"show-checkbox":"","default-expand-all":"",style:{position:"absolute",top:"0",left:"0"}},null,8,["data","onCheckChange"]),(0,i.Wm)(x,{onClick:w.measureDistance,style:{position:"absolute",top:"10px",left:"130px"}},{default:(0,i.w5)((()=>[s])),_:1},8,["onClick"]),(0,i.Wm)(x,{onClick:w.measurePolyLineToGround,style:{position:"absolute",top:"10px",left:"220px"}},{default:(0,i.w5)((()=>[a])),_:1},8,["onClick"]),(0,i.Wm)(x,{onClick:w.measurePolygonToGround,style:{position:"absolute",top:"10px",left:"323px"}},{default:(0,i.w5)((()=>[c])),_:1},8,["onClick"]),(0,i.Wm)(x,{onClick:w.clearDistance,style:{position:"absolute",top:"10px",left:"423px"}},{default:(0,i.w5)((()=>[l])),_:1},8,["onClick"]),(0,i.Wm)(x,{onClick:t[0]||(t[0]=e=>w.drawer=!0),style:{position:"absolute",top:"10px",left:"523px"}},{default:(0,i.w5)((()=>[u])),_:1}),(0,i.Wm)(x,{onClick:w.flyTo,style:{position:"absolute",top:"50px",left:"125px"}},{default:(0,i.w5)((()=>[h])),_:1},8,["onClick"]),(0,i.Wm)(S,{modelValue:w.drawer,"onUpdate:modelValue":t[5]||(t[5]=e=>w.drawer=e),"with-header":!1},{default:(0,i.w5)((()=>[d,(0,i._)("div",f,[(0,i._)("div",{class:"drawer-item",onClick:t[1]||(t[1]=e=>{w.measureDistance(),w.drawer=!1})},[(0,i._)("img",{src:n(4966),alt:"网络错误"},null,8,p),m]),(0,i._)("div",{class:"drawer-item",onClick:t[2]||(t[2]=e=>{w.measurePolyLineToGround(),w.drawer=!1})},[(0,i._)("img",{src:n(8647),alt:"网络错误"},null,8,_),g]),(0,i._)("div",{class:"drawer-item",onClick:t[3]||(t[3]=e=>{w.measurePolygonToGround(),w.drawer=!1})},[(0,i._)("img",{src:n(4908),alt:"网络错误"},null,8,y),v]),(0,i._)("div",{class:"drawer-item",onClick:t[4]||(t[4]=e=>{w.clearDistance(),w.drawer=!1})},[(0,i._)("img",{src:n(4378),alt:"网络错误"},null,8,b),A])])])),_:1},8,["modelValue"])],64)}function T(e){return void 0!==e&&null!==e}var C=T;n(1703);function E(e){let t;this.name="DeveloperError",this.message=e;try{throw new Error}catch(n){t=n.stack}this.stack=t}C(Object.create)&&(E.prototype=Object.create(Error.prototype),E.prototype.constructor=E),E.prototype.toString=function(){let e=`${this.name}: ${this.message}`;return C(this.stack)&&(e+=`\n${this.stack.toString()}`),e},E.throwInstantiationError=function(){throw new E("This function defines an interface and should not be called directly.")};var x=E;const S={};function I(e){return`${e} is required, actual value was undefined`}function O(e,t,n){return`Expected ${n} to be typeof ${t}, actual typeof was ${e}`}S.typeOf={},S.defined=function(e,t){if(!C(t))throw new x(I(e))},S.typeOf.func=function(e,t){if("function"!==typeof t)throw new x(O(typeof t,"function",e))},S.typeOf.string=function(e,t){if("string"!==typeof t)throw new x(O(typeof t,"string",e))},S.typeOf.number=function(e,t){if("number"!==typeof t)throw new x(O(typeof t,"number",e))},S.typeOf.number.lessThan=function(e,t,n){if(S.typeOf.number(e,t),t>=n)throw new x(`Expected ${e} to be less than ${n}, actual value was ${t}`)},S.typeOf.number.lessThanOrEquals=function(e,t,n){if(S.typeOf.number(e,t),t>n)throw new x(`Expected ${e} to be less than or equal to ${n}, actual value was ${t}`)},S.typeOf.number.greaterThan=function(e,t,n){if(S.typeOf.number(e,t),t<=n)throw new x(`Expected ${e} to be greater than ${n}, actual value was ${t}`)},S.typeOf.number.greaterThanOrEquals=function(e,t,n){if(S.typeOf.number(e,t),t<n)throw new x(`Expected ${e} to be greater than or equal to ${n}, actual value was ${t}`)},S.typeOf.object=function(e,t){if("object"!==typeof t)throw new x(O(typeof t,"object",e))},S.typeOf.bool=function(e,t){if("boolean"!==typeof t)throw new x(O(typeof t,"boolean",e))},S.typeOf.bigint=function(e,t){if("bigint"!==typeof t)throw new x(O(typeof t,"bigint",e))},S.typeOf.number.equals=function(e,t,n,i){if(S.typeOf.number(e,n),S.typeOf.number(t,i),n!==i)throw new x(`${e} must be equal to ${t}, the actual values are ${n} and ${i}`)};var D=S;function P(e,t){return void 0!==e&&null!==e?e:t}P.EMPTY_OBJECT=Object.freeze({});var R=P,L=function(e){void 0==e&&(e=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,e.constructor==Array?this.init_by_array(e,e.length):this.init_seed(e)};L.prototype.init_seed=function(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<this.N;this.mti++){e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+this.mti,this.mt[this.mti]>>>=0}},L.prototype.init_by_array=function(e,t){var n,i,o;for(this.init_seed(19650218),n=1,i=0,o=this.N>t?this.N:t;o;o--){var r=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(1664525*((4294901760&r)>>>16)<<16)+1664525*(65535&r))+e[i]+i,this.mt[n]>>>=0,n++,i++,n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1),i>=t&&(i=0)}for(o=this.N-1;o;o--){r=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(1566083941*((4294901760&r)>>>16)<<16)+1566083941*(65535&r))-n,this.mt[n]>>>=0,n++,n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1)}this.mt[0]=2147483648},L.prototype.random_int=function(){var e,t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var n;for(this.mti==this.N+1&&this.init_seed(5489),n=0;n<this.N-this.M;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+this.M]^e>>>1^t[1&e];for(;n<this.N-1;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+(this.M-this.N)]^e>>>1^t[1&e];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[1&e],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,e^=e>>>18,e>>>0},L.prototype.random_int31=function(){return this.random_int()>>>1},L.prototype.random_incl=function(){return this.random_int()*(1/4294967295)},L.prototype.random=function(){return this.random_int()*(1/4294967296)},L.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)},L.prototype.random_long=function(){var e=this.random_int()>>>5,t=this.random_int()>>>6;return(67108864*e+t)*(1/9007199254740992)};var M=L;const B={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,EPSILON21:1e-21,GRAVITATIONALPARAMETER:3986004418e5,SOLAR_RADIUS:6955e5,LUNAR_RADIUS:1737400,SIXTY_FOUR_KILOBYTES:65536,FOUR_GIGABYTES:4294967296};B.sign=R(Math.sign,(function(e){return e=+e,0===e||e!==e?e:e>0?1:-1})),B.signNotZero=function(e){return e<0?-1:1},B.toSNorm=function(e,t){return t=R(t,255),Math.round((.5*B.clamp(e,-1,1)+.5)*t)},B.fromSNorm=function(e,t){return t=R(t,255),B.clamp(e,0,t)/t*2-1},B.normalize=function(e,t,n){return n=Math.max(n-t,0),0===n?0:B.clamp((e-t)/n,0,1)},B.sinh=R(Math.sinh,(function(e){return(Math.exp(e)-Math.exp(-e))/2})),B.cosh=R(Math.cosh,(function(e){return(Math.exp(e)+Math.exp(-e))/2})),B.lerp=function(e,t,n){return(1-n)*e+n*t},B.PI=Math.PI,B.ONE_OVER_PI=1/Math.PI,B.PI_OVER_TWO=Math.PI/2,B.PI_OVER_THREE=Math.PI/3,B.PI_OVER_FOUR=Math.PI/4,B.PI_OVER_SIX=Math.PI/6,B.THREE_PI_OVER_TWO=3*Math.PI/2,B.TWO_PI=2*Math.PI,B.ONE_OVER_TWO_PI=1/(2*Math.PI),B.RADIANS_PER_DEGREE=Math.PI/180,B.DEGREES_PER_RADIAN=180/Math.PI,B.RADIANS_PER_ARCSECOND=B.RADIANS_PER_DEGREE/3600,B.toRadians=function(e){if(!C(e))throw new x("degrees is required.");return e*B.RADIANS_PER_DEGREE},B.toDegrees=function(e){if(!C(e))throw new x("radians is required.");return e*B.DEGREES_PER_RADIAN},B.convertLongitudeRange=function(e){if(!C(e))throw new x("angle is required.");const t=B.TWO_PI,n=e-Math.floor(e/t)*t;return n<-Math.PI?n+t:n>=Math.PI?n-t:n},B.clampToLatitudeRange=function(e){if(!C(e))throw new x("angle is required.");return B.clamp(e,-1*B.PI_OVER_TWO,B.PI_OVER_TWO)},B.negativePiToPi=function(e){if(!C(e))throw new x("angle is required.");return e>=-B.PI&&e<=B.PI?e:B.zeroToTwoPi(e+B.PI)-B.PI},B.zeroToTwoPi=function(e){if(!C(e))throw new x("angle is required.");if(e>=0&&e<=B.TWO_PI)return e;const t=B.mod(e,B.TWO_PI);return Math.abs(t)<B.EPSILON14&&Math.abs(e)>B.EPSILON14?B.TWO_PI:t},B.mod=function(e,t){if(!C(e))throw new x("m is required.");if(!C(t))throw new x("n is required.");if(0===t)throw new x("divisor cannot be 0.");return B.sign(e)===B.sign(t)&&Math.abs(e)<Math.abs(t)?e:(e%t+t)%t},B.equalsEpsilon=function(e,t,n,i){if(!C(e))throw new x("left is required.");if(!C(t))throw new x("right is required.");n=R(n,0),i=R(i,n);const o=Math.abs(e-t);return o<=i||o<=n*Math.max(Math.abs(e),Math.abs(t))},B.lessThan=function(e,t,n){if(!C(e))throw new x("first is required.");if(!C(t))throw new x("second is required.");if(!C(n))throw new x("absoluteEpsilon is required.");return e-t<-n},B.lessThanOrEquals=function(e,t,n){if(!C(e))throw new x("first is required.");if(!C(t))throw new x("second is required.");if(!C(n))throw new x("absoluteEpsilon is required.");return e-t<n},B.greaterThan=function(e,t,n){if(!C(e))throw new x("first is required.");if(!C(t))throw new x("second is required.");if(!C(n))throw new x("absoluteEpsilon is required.");return e-t>n},B.greaterThanOrEquals=function(e,t,n){if(!C(e))throw new x("first is required.");if(!C(t))throw new x("second is required.");if(!C(n))throw new x("absoluteEpsilon is required.");return e-t>-n};const N=[1];B.factorial=function(e){if("number"!==typeof e||e<0)throw new x("A number greater than or equal to 0 is required.");const t=N.length;if(e>=t){let n=N[t-1];for(let i=t;i<=e;i++){const e=n*i;N.push(e),n=e}}return N[e]},B.incrementWrap=function(e,t,n){if(n=R(n,0),!C(e))throw new x("n is required.");if(t<=n)throw new x("maximumValue must be greater than minimumValue.");return++e,e>t&&(e=n),e},B.isPowerOfTwo=function(e){if("number"!==typeof e||e<0||e>4294967295)throw new x("A number between 0 and (2^32)-1 is required.");return 0!==e&&0===(e&e-1)},B.nextPowerOfTwo=function(e){if("number"!==typeof e||e<0||e>2147483648)throw new x("A number between 0 and 2^31 is required.");return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e,e},B.previousPowerOfTwo=function(e){if("number"!==typeof e||e<0||e>4294967295)throw new x("A number between 0 and (2^32)-1 is required.");return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e|=e>>32,e=(e>>>0)-(e>>>1),e},B.clamp=function(e,t,n){return D.typeOf.number("value",e),D.typeOf.number("min",t),D.typeOf.number("max",n),e<t?t:e>n?n:e};let F=new M;B.setRandomNumberSeed=function(e){if(!C(e))throw new x("seed is required.");F=new M(e)},B.nextRandomNumber=function(){return F.random()},B.randomBetween=function(e,t){return B.nextRandomNumber()*(t-e)+e},B.acosClamped=function(e){if(!C(e))throw new x("value is required.");return Math.acos(B.clamp(e,-1,1))},B.asinClamped=function(e){if(!C(e))throw new x("value is required.");return Math.asin(B.clamp(e,-1,1))},B.chordLength=function(e,t){if(!C(e))throw new x("angle is required.");if(!C(t))throw new x("radius is required.");return 2*t*Math.sin(.5*e)},B.logBase=function(e,t){if(!C(e))throw new x("number is required.");if(!C(t))throw new x("base is required.");return Math.log(e)/Math.log(t)},B.cbrt=R(Math.cbrt,(function(e){const t=Math.pow(Math.abs(e),1/3);return e<0?-t:t})),B.log2=R(Math.log2,(function(e){return Math.log(e)*Math.LOG2E})),B.fog=function(e,t){const n=e*t;return 1-Math.exp(-n*n)},B.fastApproximateAtan=function(e){return D.typeOf.number("x",e),e*(-.1784*Math.abs(e)-.0663*e*e+1.0301)},B.fastApproximateAtan2=function(e,t){let n;D.typeOf.number("x",e),D.typeOf.number("y",t);let i=Math.abs(e);n=Math.abs(t);const o=Math.max(i,n);n=Math.min(i,n);const r=n/o;if(isNaN(r))throw new x("either x or y must be nonzero");return i=B.fastApproximateAtan(r),i=Math.abs(t)>Math.abs(e)?B.PI_OVER_TWO-i:i,i=e<0?B.PI-i:i,i=t<0?-i:i,i};var z=B;function k(e,t,n){this.x=R(e,0),this.y=R(t,0),this.z=R(n,0)}k.fromSpherical=function(e,t){D.typeOf.object("spherical",e),C(t)||(t=new k);const n=e.clock,i=e.cone,o=R(e.magnitude,1),r=o*Math.sin(i);return t.x=r*Math.cos(n),t.y=r*Math.sin(n),t.z=o*Math.cos(i),t},k.fromElements=function(e,t,n,i){return C(i)?(i.x=e,i.y=t,i.z=n,i):new k(e,t,n)},k.clone=function(e,t){if(C(e))return C(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t):new k(e.x,e.y,e.z)},k.fromCartesian4=k.clone,k.packedLength=3,k.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),t[n++]=e.x,t[n++]=e.y,t[n]=e.z,t},k.unpack=function(e,t,n){return D.defined("array",e),t=R(t,0),C(n)||(n=new k),n.x=e[t++],n.y=e[t++],n.z=e[t],n},k.packArray=function(e,t){D.defined("array",e);const n=e.length,i=3*n;if(C(t)){if(!Array.isArray(t)&&t.length!==i)throw new x("If result is a typed array, it must have exactly array.length * 3 elements");t.length!==i&&(t.length=i)}else t=new Array(i);for(let o=0;o<n;++o)k.pack(e[o],t,3*o);return t},k.unpackArray=function(e,t){if(D.defined("array",e),D.typeOf.number.greaterThanOrEquals("array.length",e.length,3),e.length%3!==0)throw new x("array length must be a multiple of 3.");const n=e.length;C(t)?t.length=n/3:t=new Array(n/3);for(let i=0;i<n;i+=3){const n=i/3;t[n]=k.unpack(e,i,t[n])}return t},k.fromArray=k.unpack,k.maximumComponent=function(e){return D.typeOf.object("cartesian",e),Math.max(e.x,e.y,e.z)},k.minimumComponent=function(e){return D.typeOf.object("cartesian",e),Math.min(e.x,e.y,e.z)},k.minimumByComponent=function(e,t,n){return D.typeOf.object("first",e),D.typeOf.object("second",t),D.typeOf.object("result",n),n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z),n},k.maximumByComponent=function(e,t,n){return D.typeOf.object("first",e),D.typeOf.object("second",t),D.typeOf.object("result",n),n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z),n},k.clamp=function(e,t,n,i){D.typeOf.object("value",e),D.typeOf.object("min",t),D.typeOf.object("max",n),D.typeOf.object("result",i);const o=z.clamp(e.x,t.x,n.x),r=z.clamp(e.y,t.y,n.y),s=z.clamp(e.z,t.z,n.z);return i.x=o,i.y=r,i.z=s,i},k.magnitudeSquared=function(e){return D.typeOf.object("cartesian",e),e.x*e.x+e.y*e.y+e.z*e.z},k.magnitude=function(e){return Math.sqrt(k.magnitudeSquared(e))};const U=new k;k.distance=function(e,t){return D.typeOf.object("left",e),D.typeOf.object("right",t),k.subtract(e,t,U),k.magnitude(U)},k.distanceSquared=function(e,t){return D.typeOf.object("left",e),D.typeOf.object("right",t),k.subtract(e,t,U),k.magnitudeSquared(U)},k.normalize=function(e,t){D.typeOf.object("cartesian",e),D.typeOf.object("result",t);const n=k.magnitude(e);if(t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,isNaN(t.x)||isNaN(t.y)||isNaN(t.z))throw new x("normalized result is not a number");return t},k.dot=function(e,t){return D.typeOf.object("left",e),D.typeOf.object("right",t),e.x*t.x+e.y*t.y+e.z*t.z},k.multiplyComponents=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z,n},k.divideComponents=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z,n},k.add=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n},k.subtract=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n},k.multiplyByScalar=function(e,t,n){return D.typeOf.object("cartesian",e),D.typeOf.number("scalar",t),D.typeOf.object("result",n),n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n},k.divideByScalar=function(e,t,n){return D.typeOf.object("cartesian",e),D.typeOf.number("scalar",t),D.typeOf.object("result",n),n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n},k.negate=function(e,t){return D.typeOf.object("cartesian",e),D.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t},k.abs=function(e,t){return D.typeOf.object("cartesian",e),D.typeOf.object("result",t),t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t};const V=new k;k.lerp=function(e,t,n,i){return D.typeOf.object("start",e),D.typeOf.object("end",t),D.typeOf.number("t",n),D.typeOf.object("result",i),k.multiplyByScalar(t,n,V),i=k.multiplyByScalar(e,1-n,i),k.add(V,i,i)};const H=new k,G=new k;k.angleBetween=function(e,t){D.typeOf.object("left",e),D.typeOf.object("right",t),k.normalize(e,H),k.normalize(t,G);const n=k.dot(H,G),i=k.magnitude(k.cross(H,G,H));return Math.atan2(i,n)};const W=new k;k.mostOrthogonalAxis=function(e,t){D.typeOf.object("cartesian",e),D.typeOf.object("result",t);const n=k.normalize(e,W);return k.abs(n,n),t=n.x<=n.y?n.x<=n.z?k.clone(k.UNIT_X,t):k.clone(k.UNIT_Z,t):n.y<=n.z?k.clone(k.UNIT_Y,t):k.clone(k.UNIT_Z,t),t},k.projectVector=function(e,t,n){D.defined("a",e),D.defined("b",t),D.defined("result",n);const i=k.dot(e,t)/k.dot(t,t);return k.multiplyByScalar(t,i,n)},k.equals=function(e,t){return e===t||C(e)&&C(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z},k.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]&&e.z===t[n+2]},k.equalsEpsilon=function(e,t,n,i){return e===t||C(e)&&C(t)&&z.equalsEpsilon(e.x,t.x,n,i)&&z.equalsEpsilon(e.y,t.y,n,i)&&z.equalsEpsilon(e.z,t.z,n,i)},k.cross=function(e,t,n){D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n);const i=e.x,o=e.y,r=e.z,s=t.x,a=t.y,c=t.z,l=o*c-r*a,u=r*s-i*c,h=i*a-o*s;return n.x=l,n.y=u,n.z=h,n},k.midpoint=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=.5*(e.x+t.x),n.y=.5*(e.y+t.y),n.z=.5*(e.z+t.z),n},k.fromDegrees=function(e,t,n,i,o){return D.typeOf.number("longitude",e),D.typeOf.number("latitude",t),e=z.toRadians(e),t=z.toRadians(t),k.fromRadians(e,t,n,i,o)};let q=new k,j=new k;const Y=new k(40680631590769,40680631590769,40408299984661.445);k.fromRadians=function(e,t,n,i,o){D.typeOf.number("longitude",e),D.typeOf.number("latitude",t),n=R(n,0);const r=C(i)?i.radiiSquared:Y,s=Math.cos(t);q.x=s*Math.cos(e),q.y=s*Math.sin(e),q.z=Math.sin(t),q=k.normalize(q,q),k.multiplyComponents(r,q,j);const a=Math.sqrt(k.dot(q,j));return j=k.divideByScalar(j,a,j),q=k.multiplyByScalar(q,n,q),C(o)||(o=new k),k.add(j,q,o)},k.fromDegreesArray=function(e,t,n){if(D.defined("coordinates",e),e.length<2||e.length%2!==0)throw new x("the number of coordinates must be a multiple of 2 and at least 2");const i=e.length;C(n)?n.length=i/2:n=new Array(i/2);for(let o=0;o<i;o+=2){const i=e[o],r=e[o+1],s=o/2;n[s]=k.fromDegrees(i,r,0,t,n[s])}return n},k.fromRadiansArray=function(e,t,n){if(D.defined("coordinates",e),e.length<2||e.length%2!==0)throw new x("the number of coordinates must be a multiple of 2 and at least 2");const i=e.length;C(n)?n.length=i/2:n=new Array(i/2);for(let o=0;o<i;o+=2){const i=e[o],r=e[o+1],s=o/2;n[s]=k.fromRadians(i,r,0,t,n[s])}return n},k.fromDegreesArrayHeights=function(e,t,n){if(D.defined("coordinates",e),e.length<3||e.length%3!==0)throw new x("the number of coordinates must be a multiple of 3 and at least 3");const i=e.length;C(n)?n.length=i/3:n=new Array(i/3);for(let o=0;o<i;o+=3){const i=e[o],r=e[o+1],s=e[o+2],a=o/3;n[a]=k.fromDegrees(i,r,s,t,n[a])}return n},k.fromRadiansArrayHeights=function(e,t,n){if(D.defined("coordinates",e),e.length<3||e.length%3!==0)throw new x("the number of coordinates must be a multiple of 3 and at least 3");const i=e.length;C(n)?n.length=i/3:n=new Array(i/3);for(let o=0;o<i;o+=3){const i=e[o],r=e[o+1],s=e[o+2],a=o/3;n[a]=k.fromRadians(i,r,s,t,n[a])}return n},k.ZERO=Object.freeze(new k(0,0,0)),k.ONE=Object.freeze(new k(1,1,1)),k.UNIT_X=Object.freeze(new k(1,0,0)),k.UNIT_Y=Object.freeze(new k(0,1,0)),k.UNIT_Z=Object.freeze(new k(0,0,1)),k.prototype.clone=function(e){return k.clone(this,e)},k.prototype.equals=function(e){return k.equals(this,e)},k.prototype.equalsEpsilon=function(e,t,n){return k.equalsEpsilon(this,e,t,n)},k.prototype.toString=function(){return`(${this.x}, ${this.y}, ${this.z})`};var K=k;const X=new K,Q=new K;function J(e,t,n,i,o){if(!C(e))throw new x("cartesian is required.");if(!C(t))throw new x("oneOverRadii is required.");if(!C(n))throw new x("oneOverRadiiSquared is required.");if(!C(i))throw new x("centerToleranceSquared is required.");const r=e.x,s=e.y,a=e.z,c=t.x,l=t.y,u=t.z,h=r*r*c*c,d=s*s*l*l,f=a*a*u*u,p=h+d+f,m=Math.sqrt(1/p),_=K.multiplyByScalar(e,m,X);if(p<i)return isFinite(m)?K.clone(_,o):void 0;const g=n.x,y=n.y,v=n.z,b=Q;b.x=_.x*g*2,b.y=_.y*y*2,b.z=_.z*v*2;let A,w,T,E,S,I,O,D,P,R,L,M=(1-m)*K.magnitude(e)/(.5*K.magnitude(b)),B=0;do{M-=B,T=1/(1+M*g),E=1/(1+M*y),S=1/(1+M*v),I=T*T,O=E*E,D=S*S,P=I*T,R=O*E,L=D*S,A=h*I+d*O+f*D-1,w=h*P*g+d*R*y+f*L*v;const e=-2*w;B=A/e}while(Math.abs(A)>z.EPSILON12);return C(o)?(o.x=r*T,o.y=s*E,o.z=a*S,o):new K(r*T,s*E,a*S)}var Z=J;function $(e,t,n){this.longitude=R(e,0),this.latitude=R(t,0),this.height=R(n,0)}$.fromRadians=function(e,t,n,i){return D.typeOf.number("longitude",e),D.typeOf.number("latitude",t),n=R(n,0),C(i)?(i.longitude=e,i.latitude=t,i.height=n,i):new $(e,t,n)},$.fromDegrees=function(e,t,n,i){return D.typeOf.number("longitude",e),D.typeOf.number("latitude",t),e=z.toRadians(e),t=z.toRadians(t),$.fromRadians(e,t,n,i)};const ee=new K,te=new K,ne=new K,ie=new K(1/6378137,1/6378137,1/6356752.314245179),oe=new K(1/40680631590769,1/40680631590769,1/40408299984661.445),re=z.EPSILON1;$.fromCartesian=function(e,t,n){const i=C(t)?t.oneOverRadii:ie,o=C(t)?t.oneOverRadiiSquared:oe,r=C(t)?t._centerToleranceSquared:re,s=Z(e,i,o,r,te);if(!C(s))return;let a=K.multiplyComponents(s,o,ee);a=K.normalize(a,a);const c=K.subtract(e,s,ne),l=Math.atan2(a.y,a.x),u=Math.asin(a.z),h=z.sign(K.dot(c,e))*K.magnitude(c);return C(n)?(n.longitude=l,n.latitude=u,n.height=h,n):new $(l,u,h)},$.toCartesian=function(e,t,n){return D.defined("cartographic",e),K.fromRadians(e.longitude,e.latitude,e.height,t,n)},$.clone=function(e,t){if(C(e))return C(t)?(t.longitude=e.longitude,t.latitude=e.latitude,t.height=e.height,t):new $(e.longitude,e.latitude,e.height)},$.equals=function(e,t){return e===t||C(e)&&C(t)&&e.longitude===t.longitude&&e.latitude===t.latitude&&e.height===t.height},$.equalsEpsilon=function(e,t,n){return n=R(n,0),e===t||C(e)&&C(t)&&Math.abs(e.longitude-t.longitude)<=n&&Math.abs(e.latitude-t.latitude)<=n&&Math.abs(e.height-t.height)<=n},$.ZERO=Object.freeze(new $(0,0,0)),$.prototype.clone=function(e){return $.clone(this,e)},$.prototype.equals=function(e){return $.equals(this,e)},$.prototype.equalsEpsilon=function(e,t){return $.equalsEpsilon(this,e,t)},$.prototype.toString=function(){return`(${this.longitude}, ${this.latitude}, ${this.height})`};var se=$;function ae(e,t,n,i){t=R(t,0),n=R(n,0),i=R(i,0),D.typeOf.number.greaterThanOrEquals("x",t,0),D.typeOf.number.greaterThanOrEquals("y",n,0),D.typeOf.number.greaterThanOrEquals("z",i,0),e._radii=new K(t,n,i),e._radiiSquared=new K(t*t,n*n,i*i),e._radiiToTheFourth=new K(t*t*t*t,n*n*n*n,i*i*i*i),e._oneOverRadii=new K(0===t?0:1/t,0===n?0:1/n,0===i?0:1/i),e._oneOverRadiiSquared=new K(0===t?0:1/(t*t),0===n?0:1/(n*n),0===i?0:1/(i*i)),e._minimumRadius=Math.min(t,n,i),e._maximumRadius=Math.max(t,n,i),e._centerToleranceSquared=z.EPSILON1,0!==e._radiiSquared.z&&(e._squaredXOverSquaredZ=e._radiiSquared.x/e._radiiSquared.z)}function ce(e,t,n){this._radii=void 0,this._radiiSquared=void 0,this._radiiToTheFourth=void 0,this._oneOverRadii=void 0,this._oneOverRadiiSquared=void 0,this._minimumRadius=void 0,this._maximumRadius=void 0,this._centerToleranceSquared=void 0,this._squaredXOverSquaredZ=void 0,ae(this,e,t,n)}Object.defineProperties(ce.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}}),ce.clone=function(e,t){if(!C(e))return;const n=e._radii;return C(t)?(K.clone(n,t._radii),K.clone(e._radiiSquared,t._radiiSquared),K.clone(e._radiiToTheFourth,t._radiiToTheFourth),K.clone(e._oneOverRadii,t._oneOverRadii),K.clone(e._oneOverRadiiSquared,t._oneOverRadiiSquared),t._minimumRadius=e._minimumRadius,t._maximumRadius=e._maximumRadius,t._centerToleranceSquared=e._centerToleranceSquared,t):new ce(n.x,n.y,n.z)},ce.fromCartesian3=function(e,t){return C(t)||(t=new ce),C(e)?(ae(t,e.x,e.y,e.z),t):t},ce.WGS84=Object.freeze(new ce(6378137,6378137,6356752.314245179)),ce.UNIT_SPHERE=Object.freeze(new ce(1,1,1)),ce.MOON=Object.freeze(new ce(z.LUNAR_RADIUS,z.LUNAR_RADIUS,z.LUNAR_RADIUS)),ce.prototype.clone=function(e){return ce.clone(this,e)},ce.packedLength=K.packedLength,ce.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),K.pack(e._radii,t,n),t},ce.unpack=function(e,t,n){D.defined("array",e),t=R(t,0);const i=K.unpack(e,t);return ce.fromCartesian3(i,n)},ce.prototype.geocentricSurfaceNormal=K.normalize,ce.prototype.geodeticSurfaceNormalCartographic=function(e,t){D.typeOf.object("cartographic",e);const n=e.longitude,i=e.latitude,o=Math.cos(i),r=o*Math.cos(n),s=o*Math.sin(n),a=Math.sin(i);return C(t)||(t=new K),t.x=r,t.y=s,t.z=a,K.normalize(t,t)},ce.prototype.geodeticSurfaceNormal=function(e,t){if(!K.equalsEpsilon(e,K.ZERO,z.EPSILON14))return C(t)||(t=new K),t=K.multiplyComponents(e,this._oneOverRadiiSquared,t),K.normalize(t,t)};const le=new K,ue=new K;ce.prototype.cartographicToCartesian=function(e,t){const n=le,i=ue;this.geodeticSurfaceNormalCartographic(e,n),K.multiplyComponents(this._radiiSquared,n,i);const o=Math.sqrt(K.dot(n,i));return K.divideByScalar(i,o,i),K.multiplyByScalar(n,e.height,n),C(t)||(t=new K),K.add(i,n,t)},ce.prototype.cartographicArrayToCartesianArray=function(e,t){D.defined("cartographics",e);const n=e.length;C(t)?t.length=n:t=new Array(n);for(let i=0;i<n;i++)t[i]=this.cartographicToCartesian(e[i],t[i]);return t};const he=new K,de=new K,fe=new K;ce.prototype.cartesianToCartographic=function(e,t){const n=this.scaleToGeodeticSurface(e,de);if(!C(n))return;const i=this.geodeticSurfaceNormal(n,he),o=K.subtract(e,n,fe),r=Math.atan2(i.y,i.x),s=Math.asin(i.z),a=z.sign(K.dot(o,e))*K.magnitude(o);return C(t)?(t.longitude=r,t.latitude=s,t.height=a,t):new se(r,s,a)},ce.prototype.cartesianArrayToCartographicArray=function(e,t){D.defined("cartesians",e);const n=e.length;C(t)?t.length=n:t=new Array(n);for(let i=0;i<n;++i)t[i]=this.cartesianToCartographic(e[i],t[i]);return t},ce.prototype.scaleToGeodeticSurface=function(e,t){return Z(e,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,t)},ce.prototype.scaleToGeocentricSurface=function(e,t){D.typeOf.object("cartesian",e),C(t)||(t=new K);const n=e.x,i=e.y,o=e.z,r=this._oneOverRadiiSquared,s=1/Math.sqrt(n*n*r.x+i*i*r.y+o*o*r.z);return K.multiplyByScalar(e,s,t)},ce.prototype.transformPositionToScaledSpace=function(e,t){return C(t)||(t=new K),K.multiplyComponents(e,this._oneOverRadii,t)},ce.prototype.transformPositionFromScaledSpace=function(e,t){return C(t)||(t=new K),K.multiplyComponents(e,this._radii,t)},ce.prototype.equals=function(e){return this===e||C(e)&&K.equals(this._radii,e._radii)},ce.prototype.toString=function(){return this._radii.toString()},ce.prototype.getSurfaceNormalIntersectionWithZAxis=function(e,t,n){if(D.typeOf.object("position",e),!z.equalsEpsilon(this._radii.x,this._radii.y,z.EPSILON15))throw new x("Ellipsoid must be an ellipsoid of revolution (radii.x == radii.y)");D.typeOf.number.greaterThan("Ellipsoid.radii.z",this._radii.z,0),t=R(t,0);const i=this._squaredXOverSquaredZ;if(C(n)||(n=new K),n.x=0,n.y=0,n.z=e.z*(1-i),!(Math.abs(n.z)>=this._radii.z-t))return n};const pe=[.14887433898163,.43339539412925,.67940956829902,.86506336668898,.97390652851717,0],me=[.29552422471475,.26926671930999,.21908636251598,.14945134915058,.066671344308684,0];function _e(e,t,n){D.typeOf.number("a",e),D.typeOf.number("b",t),D.typeOf.func("func",n);const i=.5*(t+e),o=.5*(t-e);let r=0;for(let s=0;s<5;s++){const e=o*pe[s];r+=me[s]*(n(i+e)+n(i-e))}return r*=o,r}ce.prototype.surfaceArea=function(e){D.typeOf.object("rectangle",e);const t=e.west;let n=e.east;const i=e.south,o=e.north;while(n<t)n+=z.TWO_PI;const r=this._radiiSquared,s=r.x,a=r.y,c=r.z,l=s*a;return _e(i,o,(function(e){const i=Math.cos(e),o=Math.sin(e);return Math.cos(e)*_e(t,n,(function(e){const t=Math.cos(e),n=Math.sin(e);return Math.sqrt(l*o*o+c*(a*t*t+s*n*n)*i*i)}))}))};var ge=ce;function ye(e){this._ellipsoid=R(e,ge.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}Object.defineProperties(ye.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),ye.prototype.project=function(e,t){const n=this._semimajorAxis,i=e.longitude*n,o=e.latitude*n,r=e.height;return C(t)?(t.x=i,t.y=o,t.z=r,t):new K(i,o,r)},ye.prototype.unproject=function(e,t){if(!C(e))throw new x("cartesian is required");const n=this._oneOverSemimajorAxis,i=e.x*n,o=e.y*n,r=e.z;return C(t)?(t.longitude=i,t.latitude=o,t.height=r,t):new se(i,o,r)};var ve=ye;const be={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};var Ae=Object.freeze(be);function we(e,t){this.start=R(e,0),this.stop=R(t,0)}var Te=we;function Ce(e,t,n,i,o,r,s,a,c){this[0]=R(e,0),this[1]=R(i,0),this[2]=R(s,0),this[3]=R(t,0),this[4]=R(o,0),this[5]=R(a,0),this[6]=R(n,0),this[7]=R(r,0),this[8]=R(c,0)}Ce.packedLength=9,Ce.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t[n++]=e[4],t[n++]=e[5],t[n++]=e[6],t[n++]=e[7],t[n++]=e[8],t},Ce.unpack=function(e,t,n){return D.defined("array",e),t=R(t,0),C(n)||(n=new Ce),n[0]=e[t++],n[1]=e[t++],n[2]=e[t++],n[3]=e[t++],n[4]=e[t++],n[5]=e[t++],n[6]=e[t++],n[7]=e[t++],n[8]=e[t++],n},Ce.packArray=function(e,t){D.defined("array",e);const n=e.length,i=9*n;if(C(t)){if(!Array.isArray(t)&&t.length!==i)throw new x("If result is a typed array, it must have exactly array.length * 9 elements");t.length!==i&&(t.length=i)}else t=new Array(i);for(let o=0;o<n;++o)Ce.pack(e[o],t,9*o);return t},Ce.unpackArray=function(e,t){if(D.defined("array",e),D.typeOf.number.greaterThanOrEquals("array.length",e.length,9),e.length%9!==0)throw new x("array length must be a multiple of 9.");const n=e.length;C(t)?t.length=n/9:t=new Array(n/9);for(let i=0;i<n;i+=9){const n=i/9;t[n]=Ce.unpack(e,i,t[n])}return t},Ce.clone=function(e,t){if(C(e))return C(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t):new Ce(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])},Ce.fromArray=Ce.unpack,Ce.fromColumnMajorArray=function(e,t){return D.defined("values",e),Ce.clone(e,t)},Ce.fromRowMajorArray=function(e,t){return D.defined("values",e),C(t)?(t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t):new Ce(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},Ce.fromQuaternion=function(e,t){D.typeOf.object("quaternion",e);const n=e.x*e.x,i=e.x*e.y,o=e.x*e.z,r=e.x*e.w,s=e.y*e.y,a=e.y*e.z,c=e.y*e.w,l=e.z*e.z,u=e.z*e.w,h=e.w*e.w,d=n-s-l+h,f=2*(i-u),p=2*(o+c),m=2*(i+u),_=-n+s-l+h,g=2*(a-r),y=2*(o-c),v=2*(a+r),b=-n-s+l+h;return C(t)?(t[0]=d,t[1]=m,t[2]=y,t[3]=f,t[4]=_,t[5]=v,t[6]=p,t[7]=g,t[8]=b,t):new Ce(d,f,p,m,_,g,y,v,b)},Ce.fromHeadingPitchRoll=function(e,t){D.typeOf.object("headingPitchRoll",e);const n=Math.cos(-e.pitch),i=Math.cos(-e.heading),o=Math.cos(e.roll),r=Math.sin(-e.pitch),s=Math.sin(-e.heading),a=Math.sin(e.roll),c=n*i,l=-o*s+a*r*i,u=a*s+o*r*i,h=n*s,d=o*i+a*r*s,f=-a*i+o*r*s,p=-r,m=a*n,_=o*n;return C(t)?(t[0]=c,t[1]=h,t[2]=p,t[3]=l,t[4]=d,t[5]=m,t[6]=u,t[7]=f,t[8]=_,t):new Ce(c,l,u,h,d,f,p,m,_)},Ce.fromScale=function(e,t){return D.typeOf.object("scale",e),C(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=e.y,t[5]=0,t[6]=0,t[7]=0,t[8]=e.z,t):new Ce(e.x,0,0,0,e.y,0,0,0,e.z)},Ce.fromUniformScale=function(e,t){return D.typeOf.number("scale",e),C(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=e,t):new Ce(e,0,0,0,e,0,0,0,e)},Ce.fromCrossProduct=function(e,t){return D.typeOf.object("vector",e),C(t)?(t[0]=0,t[1]=e.z,t[2]=-e.y,t[3]=-e.z,t[4]=0,t[5]=e.x,t[6]=e.y,t[7]=-e.x,t[8]=0,t):new Ce(0,-e.z,e.y,e.z,0,-e.x,-e.y,e.x,0)},Ce.fromRotationX=function(e,t){D.typeOf.number("angle",e);const n=Math.cos(e),i=Math.sin(e);return C(t)?(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=n,t[5]=i,t[6]=0,t[7]=-i,t[8]=n,t):new Ce(1,0,0,0,n,-i,0,i,n)},Ce.fromRotationY=function(e,t){D.typeOf.number("angle",e);const n=Math.cos(e),i=Math.sin(e);return C(t)?(t[0]=n,t[1]=0,t[2]=-i,t[3]=0,t[4]=1,t[5]=0,t[6]=i,t[7]=0,t[8]=n,t):new Ce(n,0,i,0,1,0,-i,0,n)},Ce.fromRotationZ=function(e,t){D.typeOf.number("angle",e);const n=Math.cos(e),i=Math.sin(e);return C(t)?(t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t):new Ce(n,-i,0,i,n,0,0,0,1)},Ce.toArray=function(e,t){return D.typeOf.object("matrix",e),C(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},Ce.getElementIndex=function(e,t){return D.typeOf.number.greaterThanOrEquals("row",t,0),D.typeOf.number.lessThanOrEquals("row",t,2),D.typeOf.number.greaterThanOrEquals("column",e,0),D.typeOf.number.lessThanOrEquals("column",e,2),3*e+t},Ce.getColumn=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.number.greaterThanOrEquals("index",t,0),D.typeOf.number.lessThanOrEquals("index",t,2),D.typeOf.object("result",n);const i=3*t,o=e[i],r=e[i+1],s=e[i+2];return n.x=o,n.y=r,n.z=s,n},Ce.setColumn=function(e,t,n,i){D.typeOf.object("matrix",e),D.typeOf.number.greaterThanOrEquals("index",t,0),D.typeOf.number.lessThanOrEquals("index",t,2),D.typeOf.object("cartesian",n),D.typeOf.object("result",i),i=Ce.clone(e,i);const o=3*t;return i[o]=n.x,i[o+1]=n.y,i[o+2]=n.z,i},Ce.getRow=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.number.greaterThanOrEquals("index",t,0),D.typeOf.number.lessThanOrEquals("index",t,2),D.typeOf.object("result",n);const i=e[t],o=e[t+3],r=e[t+6];return n.x=i,n.y=o,n.z=r,n},Ce.setRow=function(e,t,n,i){return D.typeOf.object("matrix",e),D.typeOf.number.greaterThanOrEquals("index",t,0),D.typeOf.number.lessThanOrEquals("index",t,2),D.typeOf.object("cartesian",n),D.typeOf.object("result",i),i=Ce.clone(e,i),i[t]=n.x,i[t+3]=n.y,i[t+6]=n.z,i};const Ee=new K;Ce.setScale=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.object("scale",t),D.typeOf.object("result",n);const i=Ce.getScale(e,Ee),o=t.x/i.x,r=t.y/i.y,s=t.z/i.z;return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*r,n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*s,n};const xe=new K;Ce.setUniformScale=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.number("scale",t),D.typeOf.object("result",n);const i=Ce.getScale(e,xe),o=t/i.x,r=t/i.y,s=t/i.z;return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*r,n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*s,n};const Se=new K;Ce.getScale=function(e,t){return D.typeOf.object("matrix",e),D.typeOf.object("result",t),t.x=K.magnitude(K.fromElements(e[0],e[1],e[2],Se)),t.y=K.magnitude(K.fromElements(e[3],e[4],e[5],Se)),t.z=K.magnitude(K.fromElements(e[6],e[7],e[8],Se)),t};const Ie=new K;Ce.getMaximumScale=function(e){return Ce.getScale(e,Ie),K.maximumComponent(Ie)};const Oe=new K;Ce.setRotation=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.object("result",n);const i=Ce.getScale(e,Oe);return n[0]=t[0]*i.x,n[1]=t[1]*i.x,n[2]=t[2]*i.x,n[3]=t[3]*i.y,n[4]=t[4]*i.y,n[5]=t[5]*i.y,n[6]=t[6]*i.z,n[7]=t[7]*i.z,n[8]=t[8]*i.z,n};const De=new K;function Pe(e){let t=0;for(let n=0;n<9;++n){const i=e[n];t+=i*i}return Math.sqrt(t)}Ce.getRotation=function(e,t){D.typeOf.object("matrix",e),D.typeOf.object("result",t);const n=Ce.getScale(e,De);return t[0]=e[0]/n.x,t[1]=e[1]/n.x,t[2]=e[2]/n.x,t[3]=e[3]/n.y,t[4]=e[4]/n.y,t[5]=e[5]/n.y,t[6]=e[6]/n.z,t[7]=e[7]/n.z,t[8]=e[8]/n.z,t},Ce.multiply=function(e,t,n){D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n);const i=e[0]*t[0]+e[3]*t[1]+e[6]*t[2],o=e[1]*t[0]+e[4]*t[1]+e[7]*t[2],r=e[2]*t[0]+e[5]*t[1]+e[8]*t[2],s=e[0]*t[3]+e[3]*t[4]+e[6]*t[5],a=e[1]*t[3]+e[4]*t[4]+e[7]*t[5],c=e[2]*t[3]+e[5]*t[4]+e[8]*t[5],l=e[0]*t[6]+e[3]*t[7]+e[6]*t[8],u=e[1]*t[6]+e[4]*t[7]+e[7]*t[8],h=e[2]*t[6]+e[5]*t[7]+e[8]*t[8];return n[0]=i,n[1]=o,n[2]=r,n[3]=s,n[4]=a,n[5]=c,n[6]=l,n[7]=u,n[8]=h,n},Ce.add=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n},Ce.subtract=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n},Ce.multiplyByVector=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.object("cartesian",t),D.typeOf.object("result",n);const i=t.x,o=t.y,r=t.z,s=e[0]*i+e[3]*o+e[6]*r,a=e[1]*i+e[4]*o+e[7]*r,c=e[2]*i+e[5]*o+e[8]*r;return n.x=s,n.y=a,n.z=c,n},Ce.multiplyByScalar=function(e,t,n){return D.typeOf.object("matrix",e),D.typeOf.number("scalar",t),D.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n},Ce.multiplyByScale=function(e,t,n){return D.typeOf.object("matrix",e),D.typeOf.object("scale",t),D.typeOf.object("result",n),n[0]=e[0]*t.x,n[1]=e[1]*t.x,n[2]=e[2]*t.x,n[3]=e[3]*t.y,n[4]=e[4]*t.y,n[5]=e[5]*t.y,n[6]=e[6]*t.z,n[7]=e[7]*t.z,n[8]=e[8]*t.z,n},Ce.multiplyByUniformScale=function(e,t,n){return D.typeOf.object("matrix",e),D.typeOf.number("scale",t),D.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n},Ce.negate=function(e,t){return D.typeOf.object("matrix",e),D.typeOf.object("result",t),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t},Ce.transpose=function(e,t){D.typeOf.object("matrix",e),D.typeOf.object("result",t);const n=e[0],i=e[3],o=e[6],r=e[1],s=e[4],a=e[7],c=e[2],l=e[5],u=e[8];return t[0]=n,t[1]=i,t[2]=o,t[3]=r,t[4]=s,t[5]=a,t[6]=c,t[7]=l,t[8]=u,t};const Re=[1,0,0],Le=[2,2,1];function Me(e){let t=0;for(let n=0;n<3;++n){const i=e[Ce.getElementIndex(Le[n],Re[n])];t+=2*i*i}return Math.sqrt(t)}function Be(e,t){const n=z.EPSILON15;let i=0,o=1;for(let l=0;l<3;++l){const t=Math.abs(e[Ce.getElementIndex(Le[l],Re[l])]);t>i&&(o=l,i=t)}let r=1,s=0;const a=Re[o],c=Le[o];if(Math.abs(e[Ce.getElementIndex(c,a)])>n){const t=e[Ce.getElementIndex(c,c)],n=e[Ce.getElementIndex(a,a)],i=e[Ce.getElementIndex(c,a)],o=(t-n)/2/i;let l;l=o<0?-1/(-o+Math.sqrt(1+o*o)):1/(o+Math.sqrt(1+o*o)),r=1/Math.sqrt(1+l*l),s=l*r}return t=Ce.clone(Ce.IDENTITY,t),t[Ce.getElementIndex(a,a)]=t[Ce.getElementIndex(c,c)]=r,t[Ce.getElementIndex(c,a)]=s,t[Ce.getElementIndex(a,c)]=-s,t}const Ne=new Ce,Fe=new Ce;Ce.computeEigenDecomposition=function(e,t){D.typeOf.object("matrix",e);const n=z.EPSILON20,i=10;let o=0,r=0;C(t)||(t={});const s=t.unitary=Ce.clone(Ce.IDENTITY,t.unitary),a=t.diagonal=Ce.clone(e,t.diagonal),c=n*Pe(a);while(r<i&&Me(a)>c)Be(a,Ne),Ce.transpose(Ne,Fe),Ce.multiply(a,Ne,a),Ce.multiply(Fe,a,a),Ce.multiply(s,Ne,s),++o>2&&(++r,o=0);return t},Ce.abs=function(e,t){return D.typeOf.object("matrix",e),D.typeOf.object("result",t),t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t},Ce.determinant=function(e){D.typeOf.object("matrix",e);const t=e[0],n=e[3],i=e[6],o=e[1],r=e[4],s=e[7],a=e[2],c=e[5],l=e[8];return t*(r*l-c*s)+o*(c*i-n*l)+a*(n*s-r*i)},Ce.inverse=function(e,t){D.typeOf.object("matrix",e),D.typeOf.object("result",t);const n=e[0],i=e[1],o=e[2],r=e[3],s=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=Ce.determinant(e);if(Math.abs(h)<=z.EPSILON15)throw new x("matrix is not invertible");t[0]=s*u-l*a,t[1]=l*o-i*u,t[2]=i*a-s*o,t[3]=c*a-r*u,t[4]=n*u-c*o,t[5]=r*o-n*a,t[6]=r*l-c*s,t[7]=c*i-n*l,t[8]=n*s-r*i;const d=1/h;return Ce.multiplyByScalar(t,d,t)};const ze=new Ce;Ce.inverseTranspose=function(e,t){return D.typeOf.object("matrix",e),D.typeOf.object("result",t),Ce.inverse(Ce.transpose(e,ze),t)},Ce.equals=function(e,t){return e===t||C(e)&&C(t)&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},Ce.equalsEpsilon=function(e,t,n){return n=R(n,0),e===t||C(e)&&C(t)&&Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n&&Math.abs(e[4]-t[4])<=n&&Math.abs(e[5]-t[5])<=n&&Math.abs(e[6]-t[6])<=n&&Math.abs(e[7]-t[7])<=n&&Math.abs(e[8]-t[8])<=n},Ce.IDENTITY=Object.freeze(new Ce(1,0,0,0,1,0,0,0,1)),Ce.ZERO=Object.freeze(new Ce(0,0,0,0,0,0,0,0,0)),Ce.COLUMN0ROW0=0,Ce.COLUMN0ROW1=1,Ce.COLUMN0ROW2=2,Ce.COLUMN1ROW0=3,Ce.COLUMN1ROW1=4,Ce.COLUMN1ROW2=5,Ce.COLUMN2ROW0=6,Ce.COLUMN2ROW1=7,Ce.COLUMN2ROW2=8,Object.defineProperties(Ce.prototype,{length:{get:function(){return Ce.packedLength}}}),Ce.prototype.clone=function(e){return Ce.clone(this,e)},Ce.prototype.equals=function(e){return Ce.equals(this,e)},Ce.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]&&e[4]===t[n+4]&&e[5]===t[n+5]&&e[6]===t[n+6]&&e[7]===t[n+7]&&e[8]===t[n+8]},Ce.prototype.equalsEpsilon=function(e,t){return Ce.equalsEpsilon(this,e,t)},Ce.prototype.toString=function(){return`(${this[0]}, ${this[3]}, ${this[6]})\n(${this[1]}, ${this[4]}, ${this[7]})\n(${this[2]}, ${this[5]}, ${this[8]})`};var ke=Ce;n(8675),n(3462);function Ue(e,t,n,i){this.x=R(e,0),this.y=R(t,0),this.z=R(n,0),this.w=R(i,0)}Ue.fromElements=function(e,t,n,i,o){return C(o)?(o.x=e,o.y=t,o.z=n,o.w=i,o):new Ue(e,t,n,i)},Ue.fromColor=function(e,t){return D.typeOf.object("color",e),C(t)?(t.x=e.red,t.y=e.green,t.z=e.blue,t.w=e.alpha,t):new Ue(e.red,e.green,e.blue,e.alpha)},Ue.clone=function(e,t){if(C(e))return C(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t):new Ue(e.x,e.y,e.z,e.w)},Ue.packedLength=4,Ue.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.z,t[n]=e.w,t},Ue.unpack=function(e,t,n){return D.defined("array",e),t=R(t,0),C(n)||(n=new Ue),n.x=e[t++],n.y=e[t++],n.z=e[t++],n.w=e[t],n},Ue.packArray=function(e,t){D.defined("array",e);const n=e.length,i=4*n;if(C(t)){if(!Array.isArray(t)&&t.length!==i)throw new x("If result is a typed array, it must have exactly array.length * 4 elements");t.length!==i&&(t.length=i)}else t=new Array(i);for(let o=0;o<n;++o)Ue.pack(e[o],t,4*o);return t},Ue.unpackArray=function(e,t){if(D.defined("array",e),D.typeOf.number.greaterThanOrEquals("array.length",e.length,4),e.length%4!==0)throw new x("array length must be a multiple of 4.");const n=e.length;C(t)?t.length=n/4:t=new Array(n/4);for(let i=0;i<n;i+=4){const n=i/4;t[n]=Ue.unpack(e,i,t[n])}return t},Ue.fromArray=Ue.unpack,Ue.maximumComponent=function(e){return D.typeOf.object("cartesian",e),Math.max(e.x,e.y,e.z,e.w)},Ue.minimumComponent=function(e){return D.typeOf.object("cartesian",e),Math.min(e.x,e.y,e.z,e.w)},Ue.minimumByComponent=function(e,t,n){return D.typeOf.object("first",e),D.typeOf.object("second",t),D.typeOf.object("result",n),n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z),n.w=Math.min(e.w,t.w),n},Ue.maximumByComponent=function(e,t,n){return D.typeOf.object("first",e),D.typeOf.object("second",t),D.typeOf.object("result",n),n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z),n.w=Math.max(e.w,t.w),n},Ue.clamp=function(e,t,n,i){D.typeOf.object("value",e),D.typeOf.object("min",t),D.typeOf.object("max",n),D.typeOf.object("result",i);const o=z.clamp(e.x,t.x,n.x),r=z.clamp(e.y,t.y,n.y),s=z.clamp(e.z,t.z,n.z),a=z.clamp(e.w,t.w,n.w);return i.x=o,i.y=r,i.z=s,i.w=a,i},Ue.magnitudeSquared=function(e){return D.typeOf.object("cartesian",e),e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},Ue.magnitude=function(e){return Math.sqrt(Ue.magnitudeSquared(e))};const Ve=new Ue;Ue.distance=function(e,t){return D.typeOf.object("left",e),D.typeOf.object("right",t),Ue.subtract(e,t,Ve),Ue.magnitude(Ve)},Ue.distanceSquared=function(e,t){return D.typeOf.object("left",e),D.typeOf.object("right",t),Ue.subtract(e,t,Ve),Ue.magnitudeSquared(Ve)},Ue.normalize=function(e,t){D.typeOf.object("cartesian",e),D.typeOf.object("result",t);const n=Ue.magnitude(e);if(t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,t.w=e.w/n,isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||isNaN(t.w))throw new x("normalized result is not a number");return t},Ue.dot=function(e,t){return D.typeOf.object("left",e),D.typeOf.object("right",t),e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},Ue.multiplyComponents=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z,n.w=e.w*t.w,n},Ue.divideComponents=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z,n.w=e.w/t.w,n},Ue.add=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w,n},Ue.subtract=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n.w=e.w-t.w,n},Ue.multiplyByScalar=function(e,t,n){return D.typeOf.object("cartesian",e),D.typeOf.number("scalar",t),D.typeOf.object("result",n),n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t,n},Ue.divideByScalar=function(e,t,n){return D.typeOf.object("cartesian",e),D.typeOf.number("scalar",t),D.typeOf.object("result",n),n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n.w=e.w/t,n},Ue.negate=function(e,t){return D.typeOf.object("cartesian",e),D.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},Ue.abs=function(e,t){return D.typeOf.object("cartesian",e),D.typeOf.object("result",t),t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t.w=Math.abs(e.w),t};const He=new Ue;Ue.lerp=function(e,t,n,i){return D.typeOf.object("start",e),D.typeOf.object("end",t),D.typeOf.number("t",n),D.typeOf.object("result",i),Ue.multiplyByScalar(t,n,He),i=Ue.multiplyByScalar(e,1-n,i),Ue.add(He,i,i)};const Ge=new Ue;Ue.mostOrthogonalAxis=function(e,t){D.typeOf.object("cartesian",e),D.typeOf.object("result",t);const n=Ue.normalize(e,Ge);return Ue.abs(n,n),t=n.x<=n.y?n.x<=n.z?n.x<=n.w?Ue.clone(Ue.UNIT_X,t):Ue.clone(Ue.UNIT_W,t):n.z<=n.w?Ue.clone(Ue.UNIT_Z,t):Ue.clone(Ue.UNIT_W,t):n.y<=n.z?n.y<=n.w?Ue.clone(Ue.UNIT_Y,t):Ue.clone(Ue.UNIT_W,t):n.z<=n.w?Ue.clone(Ue.UNIT_Z,t):Ue.clone(Ue.UNIT_W,t),t},Ue.equals=function(e,t){return e===t||C(e)&&C(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},Ue.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]&&e.z===t[n+2]&&e.w===t[n+3]},Ue.equalsEpsilon=function(e,t,n,i){return e===t||C(e)&&C(t)&&z.equalsEpsilon(e.x,t.x,n,i)&&z.equalsEpsilon(e.y,t.y,n,i)&&z.equalsEpsilon(e.z,t.z,n,i)&&z.equalsEpsilon(e.w,t.w,n,i)},Ue.ZERO=Object.freeze(new Ue(0,0,0,0)),Ue.ONE=Object.freeze(new Ue(1,1,1,1)),Ue.UNIT_X=Object.freeze(new Ue(1,0,0,0)),Ue.UNIT_Y=Object.freeze(new Ue(0,1,0,0)),Ue.UNIT_Z=Object.freeze(new Ue(0,0,1,0)),Ue.UNIT_W=Object.freeze(new Ue(0,0,0,1)),Ue.prototype.clone=function(e){return Ue.clone(this,e)},Ue.prototype.equals=function(e){return Ue.equals(this,e)},Ue.prototype.equalsEpsilon=function(e,t,n){return Ue.equalsEpsilon(this,e,t,n)},Ue.prototype.toString=function(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`};const We=new Float32Array(1),qe=new Uint8Array(We.buffer),je=new Uint32Array([287454020]),Ye=new Uint8Array(je.buffer),Ke=68===Ye[0];Ue.packFloat=function(e,t){return D.typeOf.number("value",e),C(t)||(t=new Ue),We[0]=e,Ke?(t.x=qe[0],t.y=qe[1],t.z=qe[2],t.w=qe[3]):(t.x=qe[3],t.y=qe[2],t.z=qe[1],t.w=qe[0]),t},Ue.unpackFloat=function(e){return D.typeOf.object("packedFloat",e),Ke?(qe[0]=e.x,qe[1]=e.y,qe[2]=e.z,qe[3]=e.w):(qe[0]=e.w,qe[1]=e.z,qe[2]=e.y,qe[3]=e.x),We[0]};var Xe=Ue;function Qe(e){let t;this.name="RuntimeError",this.message=e;try{throw new Error}catch(n){t=n.stack}this.stack=t}C(Object.create)&&(Qe.prototype=Object.create(Error.prototype),Qe.prototype.constructor=Qe),Qe.prototype.toString=function(){let e=`${this.name}: ${this.message}`;return C(this.stack)&&(e+=`\n${this.stack.toString()}`),e};var Je=Qe;function Ze(e,t,n,i,o,r,s,a,c,l,u,h,d,f,p,m){this[0]=R(e,0),this[1]=R(o,0),this[2]=R(c,0),this[3]=R(d,0),this[4]=R(t,0),this[5]=R(r,0),this[6]=R(l,0),this[7]=R(f,0),this[8]=R(n,0),this[9]=R(s,0),this[10]=R(u,0),this[11]=R(p,0),this[12]=R(i,0),this[13]=R(a,0),this[14]=R(h,0),this[15]=R(m,0)}Ze.packedLength=16,Ze.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t[n++]=e[4],t[n++]=e[5],t[n++]=e[6],t[n++]=e[7],t[n++]=e[8],t[n++]=e[9],t[n++]=e[10],t[n++]=e[11],t[n++]=e[12],t[n++]=e[13],t[n++]=e[14],t[n]=e[15],t},Ze.unpack=function(e,t,n){return D.defined("array",e),t=R(t,0),C(n)||(n=new Ze),n[0]=e[t++],n[1]=e[t++],n[2]=e[t++],n[3]=e[t++],n[4]=e[t++],n[5]=e[t++],n[6]=e[t++],n[7]=e[t++],n[8]=e[t++],n[9]=e[t++],n[10]=e[t++],n[11]=e[t++],n[12]=e[t++],n[13]=e[t++],n[14]=e[t++],n[15]=e[t],n},Ze.packArray=function(e,t){D.defined("array",e);const n=e.length,i=16*n;if(C(t)){if(!Array.isArray(t)&&t.length!==i)throw new x("If result is a typed array, it must have exactly array.length * 16 elements");t.length!==i&&(t.length=i)}else t=new Array(i);for(let o=0;o<n;++o)Ze.pack(e[o],t,16*o);return t},Ze.unpackArray=function(e,t){if(D.defined("array",e),D.typeOf.number.greaterThanOrEquals("array.length",e.length,16),e.length%16!==0)throw new x("array length must be a multiple of 16.");const n=e.length;C(t)?t.length=n/16:t=new Array(n/16);for(let i=0;i<n;i+=16){const n=i/16;t[n]=Ze.unpack(e,i,t[n])}return t},Ze.clone=function(e,t){if(C(e))return C(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):new Ze(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},Ze.fromArray=Ze.unpack,Ze.fromColumnMajorArray=function(e,t){return D.defined("values",e),Ze.clone(e,t)},Ze.fromRowMajorArray=function(e,t){return D.defined("values",e),C(t)?(t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t):new Ze(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},Ze.fromRotationTranslation=function(e,t,n){return D.typeOf.object("rotation",e),t=R(t,K.ZERO),C(n)?(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=0,n[4]=e[3],n[5]=e[4],n[6]=e[5],n[7]=0,n[8]=e[6],n[9]=e[7],n[10]=e[8],n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,n):new Ze(e[0],e[3],e[6],t.x,e[1],e[4],e[7],t.y,e[2],e[5],e[8],t.z,0,0,0,1)},Ze.fromTranslationQuaternionRotationScale=function(e,t,n,i){D.typeOf.object("translation",e),D.typeOf.object("rotation",t),D.typeOf.object("scale",n),C(i)||(i=new Ze);const o=n.x,r=n.y,s=n.z,a=t.x*t.x,c=t.x*t.y,l=t.x*t.z,u=t.x*t.w,h=t.y*t.y,d=t.y*t.z,f=t.y*t.w,p=t.z*t.z,m=t.z*t.w,_=t.w*t.w,g=a-h-p+_,y=2*(c-m),v=2*(l+f),b=2*(c+m),A=-a+h-p+_,w=2*(d-u),T=2*(l-f),E=2*(d+u),x=-a-h+p+_;return i[0]=g*o,i[1]=b*o,i[2]=T*o,i[3]=0,i[4]=y*r,i[5]=A*r,i[6]=E*r,i[7]=0,i[8]=v*s,i[9]=w*s,i[10]=x*s,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,i},Ze.fromTranslationRotationScale=function(e,t){return D.typeOf.object("translationRotationScale",e),Ze.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t)},Ze.fromTranslation=function(e,t){return D.typeOf.object("translation",e),Ze.fromRotationTranslation(ke.IDENTITY,e,t)},Ze.fromScale=function(e,t){return D.typeOf.object("scale",e),C(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e.y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e.z,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):new Ze(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1)},Ze.fromUniformScale=function(e,t){return D.typeOf.number("scale",e),C(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):new Ze(e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1)},Ze.fromRotation=function(e,t){return D.typeOf.object("rotation",e),C(t)||(t=new Ze),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t};const $e=new K,et=new K,tt=new K;Ze.fromCamera=function(e,t){D.typeOf.object("camera",e);const n=e.position,i=e.direction,o=e.up;D.typeOf.object("camera.position",n),D.typeOf.object("camera.direction",i),D.typeOf.object("camera.up",o),K.normalize(i,$e),K.normalize(K.cross($e,o,et),et),K.normalize(K.cross(et,$e,tt),tt);const r=et.x,s=et.y,a=et.z,c=$e.x,l=$e.y,u=$e.z,h=tt.x,d=tt.y,f=tt.z,p=n.x,m=n.y,_=n.z,g=r*-p+s*-m+a*-_,y=h*-p+d*-m+f*-_,v=c*p+l*m+u*_;return C(t)?(t[0]=r,t[1]=h,t[2]=-c,t[3]=0,t[4]=s,t[5]=d,t[6]=-l,t[7]=0,t[8]=a,t[9]=f,t[10]=-u,t[11]=0,t[12]=g,t[13]=y,t[14]=v,t[15]=1,t):new Ze(r,s,a,g,h,d,f,y,-c,-l,-u,v,0,0,0,1)},Ze.computePerspectiveFieldOfView=function(e,t,n,i,o){D.typeOf.number.greaterThan("fovY",e,0),D.typeOf.number.lessThan("fovY",e,Math.PI),D.typeOf.number.greaterThan("near",n,0),D.typeOf.number.greaterThan("far",i,0),D.typeOf.object("result",o);const r=Math.tan(.5*e),s=1/r,a=s/t,c=(i+n)/(n-i),l=2*i*n/(n-i);return o[0]=a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=s,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=c,o[11]=-1,o[12]=0,o[13]=0,o[14]=l,o[15]=0,o},Ze.computeOrthographicOffCenter=function(e,t,n,i,o,r,s){D.typeOf.number("left",e),D.typeOf.number("right",t),D.typeOf.number("bottom",n),D.typeOf.number("top",i),D.typeOf.number("near",o),D.typeOf.number("far",r),D.typeOf.object("result",s);let a=1/(t-e),c=1/(i-n),l=1/(r-o);const u=-(t+e)*a,h=-(i+n)*c,d=-(r+o)*l;return a*=2,c*=2,l*=-2,s[0]=a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=c,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=l,s[11]=0,s[12]=u,s[13]=h,s[14]=d,s[15]=1,s},Ze.computePerspectiveOffCenter=function(e,t,n,i,o,r,s){D.typeOf.number("left",e),D.typeOf.number("right",t),D.typeOf.number("bottom",n),D.typeOf.number("top",i),D.typeOf.number("near",o),D.typeOf.number("far",r),D.typeOf.object("result",s);const a=2*o/(t-e),c=2*o/(i-n),l=(t+e)/(t-e),u=(i+n)/(i-n),h=-(r+o)/(r-o),d=-1,f=-2*r*o/(r-o);return s[0]=a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=c,s[6]=0,s[7]=0,s[8]=l,s[9]=u,s[10]=h,s[11]=d,s[12]=0,s[13]=0,s[14]=f,s[15]=0,s},Ze.computeInfinitePerspectiveOffCenter=function(e,t,n,i,o,r){D.typeOf.number("left",e),D.typeOf.number("right",t),D.typeOf.number("bottom",n),D.typeOf.number("top",i),D.typeOf.number("near",o),D.typeOf.object("result",r);const s=2*o/(t-e),a=2*o/(i-n),c=(t+e)/(t-e),l=(i+n)/(i-n),u=-1,h=-1,d=-2*o;return r[0]=s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=c,r[9]=l,r[10]=u,r[11]=h,r[12]=0,r[13]=0,r[14]=d,r[15]=0,r},Ze.computeViewportTransformation=function(e,t,n,i){C(i)||(i=new Ze),e=R(e,R.EMPTY_OBJECT);const o=R(e.x,0),r=R(e.y,0),s=R(e.width,0),a=R(e.height,0);t=R(t,0),n=R(n,1);const c=.5*s,l=.5*a,u=.5*(n-t),h=c,d=l,f=u,p=o+c,m=r+l,_=t+u,g=1;return i[0]=h,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=f,i[11]=0,i[12]=p,i[13]=m,i[14]=_,i[15]=g,i},Ze.computeView=function(e,t,n,i,o){return D.typeOf.object("position",e),D.typeOf.object("direction",t),D.typeOf.object("up",n),D.typeOf.object("right",i),D.typeOf.object("result",o),o[0]=i.x,o[1]=n.x,o[2]=-t.x,o[3]=0,o[4]=i.y,o[5]=n.y,o[6]=-t.y,o[7]=0,o[8]=i.z,o[9]=n.z,o[10]=-t.z,o[11]=0,o[12]=-K.dot(i,e),o[13]=-K.dot(n,e),o[14]=K.dot(t,e),o[15]=1,o},Ze.toArray=function(e,t){return D.typeOf.object("matrix",e),C(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},Ze.getElementIndex=function(e,t){return D.typeOf.number.greaterThanOrEquals("row",t,0),D.typeOf.number.lessThanOrEquals("row",t,3),D.typeOf.number.greaterThanOrEquals("column",e,0),D.typeOf.number.lessThanOrEquals("column",e,3),4*e+t},Ze.getColumn=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.number.greaterThanOrEquals("index",t,0),D.typeOf.number.lessThanOrEquals("index",t,3),D.typeOf.object("result",n);const i=4*t,o=e[i],r=e[i+1],s=e[i+2],a=e[i+3];return n.x=o,n.y=r,n.z=s,n.w=a,n},Ze.setColumn=function(e,t,n,i){D.typeOf.object("matrix",e),D.typeOf.number.greaterThanOrEquals("index",t,0),D.typeOf.number.lessThanOrEquals("index",t,3),D.typeOf.object("cartesian",n),D.typeOf.object("result",i),i=Ze.clone(e,i);const o=4*t;return i[o]=n.x,i[o+1]=n.y,i[o+2]=n.z,i[o+3]=n.w,i},Ze.getRow=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.number.greaterThanOrEquals("index",t,0),D.typeOf.number.lessThanOrEquals("index",t,3),D.typeOf.object("result",n);const i=e[t],o=e[t+4],r=e[t+8],s=e[t+12];return n.x=i,n.y=o,n.z=r,n.w=s,n},Ze.setRow=function(e,t,n,i){return D.typeOf.object("matrix",e),D.typeOf.number.greaterThanOrEquals("index",t,0),D.typeOf.number.lessThanOrEquals("index",t,3),D.typeOf.object("cartesian",n),D.typeOf.object("result",i),i=Ze.clone(e,i),i[t]=n.x,i[t+4]=n.y,i[t+8]=n.z,i[t+12]=n.w,i},Ze.setTranslation=function(e,t,n){return D.typeOf.object("matrix",e),D.typeOf.object("translation",t),D.typeOf.object("result",n),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=e[15],n};const nt=new K;Ze.setScale=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.object("scale",t),D.typeOf.object("result",n);const i=Ze.getScale(e,nt),o=t.x/i.x,r=t.y/i.y,s=t.z/i.z;return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3],n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*r,n[7]=e[7],n[8]=e[8]*s,n[9]=e[9]*s,n[10]=e[10]*s,n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n};const it=new K;Ze.setUniformScale=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.number("scale",t),D.typeOf.object("result",n);const i=Ze.getScale(e,it),o=t/i.x,r=t/i.y,s=t/i.z;return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3],n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*r,n[7]=e[7],n[8]=e[8]*s,n[9]=e[9]*s,n[10]=e[10]*s,n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n};const ot=new K;Ze.getScale=function(e,t){return D.typeOf.object("matrix",e),D.typeOf.object("result",t),t.x=K.magnitude(K.fromElements(e[0],e[1],e[2],ot)),t.y=K.magnitude(K.fromElements(e[4],e[5],e[6],ot)),t.z=K.magnitude(K.fromElements(e[8],e[9],e[10],ot)),t};const rt=new K;Ze.getMaximumScale=function(e){return Ze.getScale(e,rt),K.maximumComponent(rt)};const st=new K;Ze.setRotation=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.object("result",n);const i=Ze.getScale(e,st);return n[0]=t[0]*i.x,n[1]=t[1]*i.x,n[2]=t[2]*i.x,n[3]=e[3],n[4]=t[3]*i.y,n[5]=t[4]*i.y,n[6]=t[5]*i.y,n[7]=e[7],n[8]=t[6]*i.z,n[9]=t[7]*i.z,n[10]=t[8]*i.z,n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n};const at=new K;Ze.getRotation=function(e,t){D.typeOf.object("matrix",e),D.typeOf.object("result",t);const n=Ze.getScale(e,at);return t[0]=e[0]/n.x,t[1]=e[1]/n.x,t[2]=e[2]/n.x,t[3]=e[4]/n.y,t[4]=e[5]/n.y,t[5]=e[6]/n.y,t[6]=e[8]/n.z,t[7]=e[9]/n.z,t[8]=e[10]/n.z,t},Ze.multiply=function(e,t,n){D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n);const i=e[0],o=e[1],r=e[2],s=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=e[9],f=e[10],p=e[11],m=e[12],_=e[13],g=e[14],y=e[15],v=t[0],b=t[1],A=t[2],w=t[3],T=t[4],C=t[5],E=t[6],x=t[7],S=t[8],I=t[9],O=t[10],P=t[11],R=t[12],L=t[13],M=t[14],B=t[15],N=i*v+a*b+h*A+m*w,F=o*v+c*b+d*A+_*w,z=r*v+l*b+f*A+g*w,k=s*v+u*b+p*A+y*w,U=i*T+a*C+h*E+m*x,V=o*T+c*C+d*E+_*x,H=r*T+l*C+f*E+g*x,G=s*T+u*C+p*E+y*x,W=i*S+a*I+h*O+m*P,q=o*S+c*I+d*O+_*P,j=r*S+l*I+f*O+g*P,Y=s*S+u*I+p*O+y*P,K=i*R+a*L+h*M+m*B,X=o*R+c*L+d*M+_*B,Q=r*R+l*L+f*M+g*B,J=s*R+u*L+p*M+y*B;return n[0]=N,n[1]=F,n[2]=z,n[3]=k,n[4]=U,n[5]=V,n[6]=H,n[7]=G,n[8]=W,n[9]=q,n[10]=j,n[11]=Y,n[12]=K,n[13]=X,n[14]=Q,n[15]=J,n},Ze.add=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n[9]=e[9]+t[9],n[10]=e[10]+t[10],n[11]=e[11]+t[11],n[12]=e[12]+t[12],n[13]=e[13]+t[13],n[14]=e[14]+t[14],n[15]=e[15]+t[15],n},Ze.subtract=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n[9]=e[9]-t[9],n[10]=e[10]-t[10],n[11]=e[11]-t[11],n[12]=e[12]-t[12],n[13]=e[13]-t[13],n[14]=e[14]-t[14],n[15]=e[15]-t[15],n},Ze.multiplyTransformation=function(e,t,n){D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n);const i=e[0],o=e[1],r=e[2],s=e[4],a=e[5],c=e[6],l=e[8],u=e[9],h=e[10],d=e[12],f=e[13],p=e[14],m=t[0],_=t[1],g=t[2],y=t[4],v=t[5],b=t[6],A=t[8],w=t[9],T=t[10],C=t[12],E=t[13],x=t[14],S=i*m+s*_+l*g,I=o*m+a*_+u*g,O=r*m+c*_+h*g,P=i*y+s*v+l*b,R=o*y+a*v+u*b,L=r*y+c*v+h*b,M=i*A+s*w+l*T,B=o*A+a*w+u*T,N=r*A+c*w+h*T,F=i*C+s*E+l*x+d,z=o*C+a*E+u*x+f,k=r*C+c*E+h*x+p;return n[0]=S,n[1]=I,n[2]=O,n[3]=0,n[4]=P,n[5]=R,n[6]=L,n[7]=0,n[8]=M,n[9]=B,n[10]=N,n[11]=0,n[12]=F,n[13]=z,n[14]=k,n[15]=1,n},Ze.multiplyByMatrix3=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.object("rotation",t),D.typeOf.object("result",n);const i=e[0],o=e[1],r=e[2],s=e[4],a=e[5],c=e[6],l=e[8],u=e[9],h=e[10],d=t[0],f=t[1],p=t[2],m=t[3],_=t[4],g=t[5],y=t[6],v=t[7],b=t[8],A=i*d+s*f+l*p,w=o*d+a*f+u*p,T=r*d+c*f+h*p,C=i*m+s*_+l*g,E=o*m+a*_+u*g,x=r*m+c*_+h*g,S=i*y+s*v+l*b,I=o*y+a*v+u*b,O=r*y+c*v+h*b;return n[0]=A,n[1]=w,n[2]=T,n[3]=0,n[4]=C,n[5]=E,n[6]=x,n[7]=0,n[8]=S,n[9]=I,n[10]=O,n[11]=0,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},Ze.multiplyByTranslation=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.object("translation",t),D.typeOf.object("result",n);const i=t.x,o=t.y,r=t.z,s=i*e[0]+o*e[4]+r*e[8]+e[12],a=i*e[1]+o*e[5]+r*e[9]+e[13],c=i*e[2]+o*e[6]+r*e[10]+e[14];return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=s,n[13]=a,n[14]=c,n[15]=e[15],n},Ze.multiplyByScale=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.object("scale",t),D.typeOf.object("result",n);const i=t.x,o=t.y,r=t.z;return 1===i&&1===o&&1===r?Ze.clone(e,n):(n[0]=i*e[0],n[1]=i*e[1],n[2]=i*e[2],n[3]=e[3],n[4]=o*e[4],n[5]=o*e[5],n[6]=o*e[6],n[7]=e[7],n[8]=r*e[8],n[9]=r*e[9],n[10]=r*e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n)},Ze.multiplyByUniformScale=function(e,t,n){return D.typeOf.object("matrix",e),D.typeOf.number("scale",t),D.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3],n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7],n[8]=e[8]*t,n[9]=e[9]*t,n[10]=e[10]*t,n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},Ze.multiplyByVector=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.object("cartesian",t),D.typeOf.object("result",n);const i=t.x,o=t.y,r=t.z,s=t.w,a=e[0]*i+e[4]*o+e[8]*r+e[12]*s,c=e[1]*i+e[5]*o+e[9]*r+e[13]*s,l=e[2]*i+e[6]*o+e[10]*r+e[14]*s,u=e[3]*i+e[7]*o+e[11]*r+e[15]*s;return n.x=a,n.y=c,n.z=l,n.w=u,n},Ze.multiplyByPointAsVector=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.object("cartesian",t),D.typeOf.object("result",n);const i=t.x,o=t.y,r=t.z,s=e[0]*i+e[4]*o+e[8]*r,a=e[1]*i+e[5]*o+e[9]*r,c=e[2]*i+e[6]*o+e[10]*r;return n.x=s,n.y=a,n.z=c,n},Ze.multiplyByPoint=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.object("cartesian",t),D.typeOf.object("result",n);const i=t.x,o=t.y,r=t.z,s=e[0]*i+e[4]*o+e[8]*r+e[12],a=e[1]*i+e[5]*o+e[9]*r+e[13],c=e[2]*i+e[6]*o+e[10]*r+e[14];return n.x=s,n.y=a,n.z=c,n},Ze.multiplyByScalar=function(e,t,n){return D.typeOf.object("matrix",e),D.typeOf.number("scalar",t),D.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n[9]=e[9]*t,n[10]=e[10]*t,n[11]=e[11]*t,n[12]=e[12]*t,n[13]=e[13]*t,n[14]=e[14]*t,n[15]=e[15]*t,n},Ze.negate=function(e,t){return D.typeOf.object("matrix",e),D.typeOf.object("result",t),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},Ze.transpose=function(e,t){D.typeOf.object("matrix",e),D.typeOf.object("result",t);const n=e[1],i=e[2],o=e[3],r=e[6],s=e[7],a=e[11];return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=r,t[10]=e[10],t[11]=e[14],t[12]=o,t[13]=s,t[14]=a,t[15]=e[15],t},Ze.abs=function(e,t){return D.typeOf.object("matrix",e),D.typeOf.object("result",t),t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t[9]=Math.abs(e[9]),t[10]=Math.abs(e[10]),t[11]=Math.abs(e[11]),t[12]=Math.abs(e[12]),t[13]=Math.abs(e[13]),t[14]=Math.abs(e[14]),t[15]=Math.abs(e[15]),t},Ze.equals=function(e,t){return e===t||C(e)&&C(t)&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[3]===t[3]&&e[7]===t[7]&&e[11]===t[11]&&e[15]===t[15]},Ze.equalsEpsilon=function(e,t,n){return n=R(n,0),e===t||C(e)&&C(t)&&Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n&&Math.abs(e[4]-t[4])<=n&&Math.abs(e[5]-t[5])<=n&&Math.abs(e[6]-t[6])<=n&&Math.abs(e[7]-t[7])<=n&&Math.abs(e[8]-t[8])<=n&&Math.abs(e[9]-t[9])<=n&&Math.abs(e[10]-t[10])<=n&&Math.abs(e[11]-t[11])<=n&&Math.abs(e[12]-t[12])<=n&&Math.abs(e[13]-t[13])<=n&&Math.abs(e[14]-t[14])<=n&&Math.abs(e[15]-t[15])<=n},Ze.getTranslation=function(e,t){return D.typeOf.object("matrix",e),D.typeOf.object("result",t),t.x=e[12],t.y=e[13],t.z=e[14],t},Ze.getMatrix3=function(e,t){return D.typeOf.object("matrix",e),D.typeOf.object("result",t),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t};const ct=new ke,lt=new ke,ut=new Xe,ht=new Xe(0,0,0,1);Ze.inverse=function(e,t){D.typeOf.object("matrix",e),D.typeOf.object("result",t);const n=e[0],i=e[4],o=e[8],r=e[12],s=e[1],a=e[5],c=e[9],l=e[13],u=e[2],h=e[6],d=e[10],f=e[14],p=e[3],m=e[7],_=e[11],g=e[15];let y=d*g,v=f*_,b=h*g,A=f*m,w=h*_,T=d*m,C=u*g,E=f*p,x=u*_,S=d*p,I=u*m,O=h*p;const P=y*a+A*c+w*l-(v*a+b*c+T*l),R=v*s+C*c+S*l-(y*s+E*c+x*l),L=b*s+E*a+I*l-(A*s+C*a+O*l),M=T*s+x*a+O*c-(w*s+S*a+I*c),B=v*i+b*o+T*r-(y*i+A*o+w*r),N=y*n+E*o+x*r-(v*n+C*o+S*r),F=A*n+C*i+O*r-(b*n+E*i+I*r),k=w*n+S*i+I*o-(T*n+x*i+O*o);y=o*l,v=r*c,b=i*l,A=r*a,w=i*c,T=o*a,C=n*l,E=r*s,x=n*c,S=o*s,I=n*a,O=i*s;const U=y*m+A*_+w*g-(v*m+b*_+T*g),V=v*p+C*_+S*g-(y*p+E*_+x*g),H=b*p+E*m+I*g-(A*p+C*m+O*g),G=T*p+x*m+O*_-(w*p+S*m+I*_),W=b*d+T*f+v*h-(w*f+y*h+A*d),q=x*f+y*u+E*d-(C*d+S*f+v*u),j=C*h+O*f+A*u-(I*f+b*u+E*h),Y=I*d+w*u+S*h-(x*h+O*d+T*u);let K=n*P+i*R+o*L+r*M;if(Math.abs(K)<z.EPSILON21){if(ke.equalsEpsilon(Ze.getMatrix3(e,ct),lt,z.EPSILON7)&&Xe.equals(Ze.getRow(e,3,ut),ht))return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=1,t;throw new Je("matrix is not invertible because its determinate is zero.")}return K=1/K,t[0]=P*K,t[1]=R*K,t[2]=L*K,t[3]=M*K,t[4]=B*K,t[5]=N*K,t[6]=F*K,t[7]=k*K,t[8]=U*K,t[9]=V*K,t[10]=H*K,t[11]=G*K,t[12]=W*K,t[13]=q*K,t[14]=j*K,t[15]=Y*K,t},Ze.inverseTransformation=function(e,t){D.typeOf.object("matrix",e),D.typeOf.object("result",t);const n=e[0],i=e[1],o=e[2],r=e[4],s=e[5],a=e[6],c=e[8],l=e[9],u=e[10],h=e[12],d=e[13],f=e[14],p=-n*h-i*d-o*f,m=-r*h-s*d-a*f,_=-c*h-l*d-u*f;return t[0]=n,t[1]=r,t[2]=c,t[3]=0,t[4]=i,t[5]=s,t[6]=l,t[7]=0,t[8]=o,t[9]=a,t[10]=u,t[11]=0,t[12]=p,t[13]=m,t[14]=_,t[15]=1,t};const dt=new Ze;Ze.inverseTranspose=function(e,t){return D.typeOf.object("matrix",e),D.typeOf.object("result",t),Ze.inverse(Ze.transpose(e,dt),t)},Ze.IDENTITY=Object.freeze(new Ze(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),Ze.ZERO=Object.freeze(new Ze(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)),Ze.COLUMN0ROW0=0,Ze.COLUMN0ROW1=1,Ze.COLUMN0ROW2=2,Ze.COLUMN0ROW3=3,Ze.COLUMN1ROW0=4,Ze.COLUMN1ROW1=5,Ze.COLUMN1ROW2=6,Ze.COLUMN1ROW3=7,Ze.COLUMN2ROW0=8,Ze.COLUMN2ROW1=9,Ze.COLUMN2ROW2=10,Ze.COLUMN2ROW3=11,Ze.COLUMN3ROW0=12,Ze.COLUMN3ROW1=13,Ze.COLUMN3ROW2=14,Ze.COLUMN3ROW3=15,Object.defineProperties(Ze.prototype,{length:{get:function(){return Ze.packedLength}}}),Ze.prototype.clone=function(e){return Ze.clone(this,e)},Ze.prototype.equals=function(e){return Ze.equals(this,e)},Ze.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]&&e[4]===t[n+4]&&e[5]===t[n+5]&&e[6]===t[n+6]&&e[7]===t[n+7]&&e[8]===t[n+8]&&e[9]===t[n+9]&&e[10]===t[n+10]&&e[11]===t[n+11]&&e[12]===t[n+12]&&e[13]===t[n+13]&&e[14]===t[n+14]&&e[15]===t[n+15]},Ze.prototype.equalsEpsilon=function(e,t){return Ze.equalsEpsilon(this,e,t)},Ze.prototype.toString=function(){return`(${this[0]}, ${this[4]}, ${this[8]}, ${this[12]})\n(${this[1]}, ${this[5]}, ${this[9]}, ${this[13]})\n(${this[2]}, ${this[6]}, ${this[10]}, ${this[14]})\n(${this[3]}, ${this[7]}, ${this[11]}, ${this[15]})`};var ft=Ze;function pt(e,t,n,i){this.west=R(e,0),this.south=R(t,0),this.east=R(n,0),this.north=R(i,0)}Object.defineProperties(pt.prototype,{width:{get:function(){return pt.computeWidth(this)}},height:{get:function(){return pt.computeHeight(this)}}}),pt.packedLength=4,pt.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),t[n++]=e.west,t[n++]=e.south,t[n++]=e.east,t[n]=e.north,t},pt.unpack=function(e,t,n){return D.defined("array",e),t=R(t,0),C(n)||(n=new pt),n.west=e[t++],n.south=e[t++],n.east=e[t++],n.north=e[t],n},pt.computeWidth=function(e){D.typeOf.object("rectangle",e);let t=e.east;const n=e.west;return t<n&&(t+=z.TWO_PI),t-n},pt.computeHeight=function(e){return D.typeOf.object("rectangle",e),e.north-e.south},pt.fromDegrees=function(e,t,n,i,o){return e=z.toRadians(R(e,0)),t=z.toRadians(R(t,0)),n=z.toRadians(R(n,0)),i=z.toRadians(R(i,0)),C(o)?(o.west=e,o.south=t,o.east=n,o.north=i,o):new pt(e,t,n,i)},pt.fromRadians=function(e,t,n,i,o){return C(o)?(o.west=R(e,0),o.south=R(t,0),o.east=R(n,0),o.north=R(i,0),o):new pt(e,t,n,i)},pt.fromCartographicArray=function(e,t){D.defined("cartographics",e);let n=Number.MAX_VALUE,i=-Number.MAX_VALUE,o=Number.MAX_VALUE,r=-Number.MAX_VALUE,s=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let c=0,l=e.length;c<l;c++){const t=e[c];n=Math.min(n,t.longitude),i=Math.max(i,t.longitude),s=Math.min(s,t.latitude),a=Math.max(a,t.latitude);const l=t.longitude>=0?t.longitude:t.longitude+z.TWO_PI;o=Math.min(o,l),r=Math.max(r,l)}return i-n>r-o&&(n=o,i=r,i>z.PI&&(i-=z.TWO_PI),n>z.PI&&(n-=z.TWO_PI)),C(t)?(t.west=n,t.south=s,t.east=i,t.north=a,t):new pt(n,s,i,a)},pt.fromCartesianArray=function(e,t,n){D.defined("cartesians",e),t=R(t,ge.WGS84);let i=Number.MAX_VALUE,o=-Number.MAX_VALUE,r=Number.MAX_VALUE,s=-Number.MAX_VALUE,a=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(let l=0,u=e.length;l<u;l++){const n=t.cartesianToCartographic(e[l]);i=Math.min(i,n.longitude),o=Math.max(o,n.longitude),a=Math.min(a,n.latitude),c=Math.max(c,n.latitude);const u=n.longitude>=0?n.longitude:n.longitude+z.TWO_PI;r=Math.min(r,u),s=Math.max(s,u)}return o-i>s-r&&(i=r,o=s,o>z.PI&&(o-=z.TWO_PI),i>z.PI&&(i-=z.TWO_PI)),C(n)?(n.west=i,n.south=a,n.east=o,n.north=c,n):new pt(i,a,o,c)},pt.clone=function(e,t){if(C(e))return C(t)?(t.west=e.west,t.south=e.south,t.east=e.east,t.north=e.north,t):new pt(e.west,e.south,e.east,e.north)},pt.equalsEpsilon=function(e,t,n){return n=R(n,0),e===t||C(e)&&C(t)&&Math.abs(e.west-t.west)<=n&&Math.abs(e.south-t.south)<=n&&Math.abs(e.east-t.east)<=n&&Math.abs(e.north-t.north)<=n},pt.prototype.clone=function(e){return pt.clone(this,e)},pt.prototype.equals=function(e){return pt.equals(this,e)},pt.equals=function(e,t){return e===t||C(e)&&C(t)&&e.west===t.west&&e.south===t.south&&e.east===t.east&&e.north===t.north},pt.prototype.equalsEpsilon=function(e,t){return pt.equalsEpsilon(this,e,t)},pt.validate=function(e){D.typeOf.object("rectangle",e);const t=e.north;D.typeOf.number.greaterThanOrEquals("north",t,-z.PI_OVER_TWO),D.typeOf.number.lessThanOrEquals("north",t,z.PI_OVER_TWO);const n=e.south;D.typeOf.number.greaterThanOrEquals("south",n,-z.PI_OVER_TWO),D.typeOf.number.lessThanOrEquals("south",n,z.PI_OVER_TWO);const i=e.west;D.typeOf.number.greaterThanOrEquals("west",i,-Math.PI),D.typeOf.number.lessThanOrEquals("west",i,Math.PI);const o=e.east;D.typeOf.number.greaterThanOrEquals("east",o,-Math.PI),D.typeOf.number.lessThanOrEquals("east",o,Math.PI)},pt.southwest=function(e,t){return D.typeOf.object("rectangle",e),C(t)?(t.longitude=e.west,t.latitude=e.south,t.height=0,t):new se(e.west,e.south)},pt.northwest=function(e,t){return D.typeOf.object("rectangle",e),C(t)?(t.longitude=e.west,t.latitude=e.north,t.height=0,t):new se(e.west,e.north)},pt.northeast=function(e,t){return D.typeOf.object("rectangle",e),C(t)?(t.longitude=e.east,t.latitude=e.north,t.height=0,t):new se(e.east,e.north)},pt.southeast=function(e,t){return D.typeOf.object("rectangle",e),C(t)?(t.longitude=e.east,t.latitude=e.south,t.height=0,t):new se(e.east,e.south)},pt.center=function(e,t){D.typeOf.object("rectangle",e);let n=e.east;const i=e.west;n<i&&(n+=z.TWO_PI);const o=z.negativePiToPi(.5*(i+n)),r=.5*(e.south+e.north);return C(t)?(t.longitude=o,t.latitude=r,t.height=0,t):new se(o,r)},pt.intersection=function(e,t,n){D.typeOf.object("rectangle",e),D.typeOf.object("otherRectangle",t);let i=e.east,o=e.west,r=t.east,s=t.west;i<o&&r>0?i+=z.TWO_PI:r<s&&i>0&&(r+=z.TWO_PI),i<o&&s<0?s+=z.TWO_PI:r<s&&o<0&&(o+=z.TWO_PI);const a=z.negativePiToPi(Math.max(o,s)),c=z.negativePiToPi(Math.min(i,r));if((e.west<e.east||t.west<t.east)&&c<=a)return;const l=Math.max(e.south,t.south),u=Math.min(e.north,t.north);return l>=u?void 0:C(n)?(n.west=a,n.south=l,n.east=c,n.north=u,n):new pt(a,l,c,u)},pt.simpleIntersection=function(e,t,n){D.typeOf.object("rectangle",e),D.typeOf.object("otherRectangle",t);const i=Math.max(e.west,t.west),o=Math.max(e.south,t.south),r=Math.min(e.east,t.east),s=Math.min(e.north,t.north);if(!(o>=s||i>=r))return C(n)?(n.west=i,n.south=o,n.east=r,n.north=s,n):new pt(i,o,r,s)},pt.union=function(e,t,n){D.typeOf.object("rectangle",e),D.typeOf.object("otherRectangle",t),C(n)||(n=new pt);let i=e.east,o=e.west,r=t.east,s=t.west;i<o&&r>0?i+=z.TWO_PI:r<s&&i>0&&(r+=z.TWO_PI),i<o&&s<0?s+=z.TWO_PI:r<s&&o<0&&(o+=z.TWO_PI);const a=z.negativePiToPi(Math.min(o,s)),c=z.negativePiToPi(Math.max(i,r));return n.west=a,n.south=Math.min(e.south,t.south),n.east=c,n.north=Math.max(e.north,t.north),n},pt.expand=function(e,t,n){return D.typeOf.object("rectangle",e),D.typeOf.object("cartographic",t),C(n)||(n=new pt),n.west=Math.min(e.west,t.longitude),n.south=Math.min(e.south,t.latitude),n.east=Math.max(e.east,t.longitude),n.north=Math.max(e.north,t.latitude),n},pt.contains=function(e,t){D.typeOf.object("rectangle",e),D.typeOf.object("cartographic",t);let n=t.longitude;const i=t.latitude,o=e.west;let r=e.east;return r<o&&(r+=z.TWO_PI,n<0&&(n+=z.TWO_PI)),(n>o||z.equalsEpsilon(n,o,z.EPSILON14))&&(n<r||z.equalsEpsilon(n,r,z.EPSILON14))&&i>=e.south&&i<=e.north};const mt=new se;pt.subsample=function(e,t,n,i){D.typeOf.object("rectangle",e),t=R(t,ge.WGS84),n=R(n,0),C(i)||(i=[]);let o=0;const r=e.north,s=e.south,a=e.east,c=e.west,l=mt;l.height=n,l.longitude=c,l.latitude=r,i[o]=t.cartographicToCartesian(l,i[o]),o++,l.longitude=a,i[o]=t.cartographicToCartesian(l,i[o]),o++,l.latitude=s,i[o]=t.cartographicToCartesian(l,i[o]),o++,l.longitude=c,i[o]=t.cartographicToCartesian(l,i[o]),o++,l.latitude=r<0?r:s>0?s:0;for(let u=1;u<8;++u)l.longitude=-Math.PI+u*z.PI_OVER_TWO,pt.contains(e,l)&&(i[o]=t.cartographicToCartesian(l,i[o]),o++);return 0===l.latitude&&(l.longitude=c,i[o]=t.cartographicToCartesian(l,i[o]),o++,l.longitude=a,i[o]=t.cartographicToCartesian(l,i[o]),o++),i.length=o,i},pt.subsection=function(e,t,n,i,o,r){if(D.typeOf.object("rectangle",e),D.typeOf.number.greaterThanOrEquals("westLerp",t,0),D.typeOf.number.lessThanOrEquals("westLerp",t,1),D.typeOf.number.greaterThanOrEquals("southLerp",n,0),D.typeOf.number.lessThanOrEquals("southLerp",n,1),D.typeOf.number.greaterThanOrEquals("eastLerp",i,0),D.typeOf.number.lessThanOrEquals("eastLerp",i,1),D.typeOf.number.greaterThanOrEquals("northLerp",o,0),D.typeOf.number.lessThanOrEquals("northLerp",o,1),D.typeOf.number.lessThanOrEquals("westLerp",t,i),D.typeOf.number.lessThanOrEquals("southLerp",n,o),C(r)||(r=new pt),e.west<=e.east){const n=e.east-e.west;r.west=e.west+t*n,r.east=e.west+i*n}else{const n=z.TWO_PI+e.east-e.west;r.west=z.negativePiToPi(e.west+t*n),r.east=z.negativePiToPi(e.west+i*n)}const s=e.north-e.south;return r.south=e.south+n*s,r.north=e.south+o*s,1===t&&(r.west=e.east),1===i&&(r.east=e.east),1===n&&(r.south=e.north),1===o&&(r.north=e.north),r},pt.MAX_VALUE=Object.freeze(new pt(-Math.PI,-z.PI_OVER_TWO,Math.PI,z.PI_OVER_TWO));var _t=pt;function gt(e,t){this.center=K.clone(R(e,K.ZERO)),this.radius=R(t,0)}const yt=new K,vt=new K,bt=new K,At=new K,wt=new K,Tt=new K,Ct=new K,Et=new K,xt=new K,St=new K,It=new K,Ot=new K,Dt=4/3*z.PI;gt.fromPoints=function(e,t){if(C(t)||(t=new gt),!C(e)||0===e.length)return t.center=K.clone(K.ZERO,t.center),t.radius=0,t;const n=K.clone(e[0],Ct),i=K.clone(n,yt),o=K.clone(n,vt),r=K.clone(n,bt),s=K.clone(n,At),a=K.clone(n,wt),c=K.clone(n,Tt),l=e.length;let u;for(u=1;u<l;u++){K.clone(e[u],n);const t=n.x,l=n.y,h=n.z;t<i.x&&K.clone(n,i),t>s.x&&K.clone(n,s),l<o.y&&K.clone(n,o),l>a.y&&K.clone(n,a),h<r.z&&K.clone(n,r),h>c.z&&K.clone(n,c)}const h=K.magnitudeSquared(K.subtract(s,i,Et)),d=K.magnitudeSquared(K.subtract(a,o,Et)),f=K.magnitudeSquared(K.subtract(c,r,Et));let p=i,m=s,_=h;d>_&&(_=d,p=o,m=a),f>_&&(_=f,p=r,m=c);const g=xt;g.x=.5*(p.x+m.x),g.y=.5*(p.y+m.y),g.z=.5*(p.z+m.z);let y=K.magnitudeSquared(K.subtract(m,g,Et)),v=Math.sqrt(y);const b=St;b.x=i.x,b.y=o.y,b.z=r.z;const A=It;A.x=s.x,A.y=a.y,A.z=c.z;const w=K.midpoint(b,A,Ot);let T=0;for(u=0;u<l;u++){K.clone(e[u],n);const t=K.magnitude(K.subtract(n,w,Et));t>T&&(T=t);const i=K.magnitudeSquared(K.subtract(n,g,Et));if(i>y){const e=Math.sqrt(i);v=.5*(v+e),y=v*v;const t=e-v;g.x=(v*g.x+t*n.x)/e,g.y=(v*g.y+t*n.y)/e,g.z=(v*g.z+t*n.z)/e}}return v<T?(K.clone(g,t.center),t.radius=v):(K.clone(w,t.center),t.radius=T),t};const Pt=new ve,Rt=new K,Lt=new K,Mt=new se,Bt=new se;gt.fromRectangle2D=function(e,t,n){return gt.fromRectangleWithHeights2D(e,t,0,0,n)},gt.fromRectangleWithHeights2D=function(e,t,n,i,o){if(C(o)||(o=new gt),!C(e))return o.center=K.clone(K.ZERO,o.center),o.radius=0,o;t=R(t,Pt),_t.southwest(e,Mt),Mt.height=n,_t.northeast(e,Bt),Bt.height=i;const r=t.project(Mt,Rt),s=t.project(Bt,Lt),a=s.x-r.x,c=s.y-r.y,l=s.z-r.z;o.radius=.5*Math.sqrt(a*a+c*c+l*l);const u=o.center;return u.x=r.x+.5*a,u.y=r.y+.5*c,u.z=r.z+.5*l,o};const Nt=[];gt.fromRectangle3D=function(e,t,n,i){if(t=R(t,ge.WGS84),n=R(n,0),C(i)||(i=new gt),!C(e))return i.center=K.clone(K.ZERO,i.center),i.radius=0,i;const o=_t.subsample(e,t,n,Nt);return gt.fromPoints(o,i)},gt.fromVertices=function(e,t,n,i){if(C(i)||(i=new gt),!C(e)||0===e.length)return i.center=K.clone(K.ZERO,i.center),i.radius=0,i;t=R(t,K.ZERO),n=R(n,3),D.typeOf.number.greaterThanOrEquals("stride",n,3);const o=Ct;o.x=e[0]+t.x,o.y=e[1]+t.y,o.z=e[2]+t.z;const r=K.clone(o,yt),s=K.clone(o,vt),a=K.clone(o,bt),c=K.clone(o,At),l=K.clone(o,wt),u=K.clone(o,Tt),h=e.length;let d;for(d=0;d<h;d+=n){const n=e[d]+t.x,i=e[d+1]+t.y,h=e[d+2]+t.z;o.x=n,o.y=i,o.z=h,n<r.x&&K.clone(o,r),n>c.x&&K.clone(o,c),i<s.y&&K.clone(o,s),i>l.y&&K.clone(o,l),h<a.z&&K.clone(o,a),h>u.z&&K.clone(o,u)}const f=K.magnitudeSquared(K.subtract(c,r,Et)),p=K.magnitudeSquared(K.subtract(l,s,Et)),m=K.magnitudeSquared(K.subtract(u,a,Et));let _=r,g=c,y=f;p>y&&(y=p,_=s,g=l),m>y&&(y=m,_=a,g=u);const v=xt;v.x=.5*(_.x+g.x),v.y=.5*(_.y+g.y),v.z=.5*(_.z+g.z);let b=K.magnitudeSquared(K.subtract(g,v,Et)),A=Math.sqrt(b);const w=St;w.x=r.x,w.y=s.y,w.z=a.z;const T=It;T.x=c.x,T.y=l.y,T.z=u.z;const E=K.midpoint(w,T,Ot);let x=0;for(d=0;d<h;d+=n){o.x=e[d]+t.x,o.y=e[d+1]+t.y,o.z=e[d+2]+t.z;const n=K.magnitude(K.subtract(o,E,Et));n>x&&(x=n);const i=K.magnitudeSquared(K.subtract(o,v,Et));if(i>b){const e=Math.sqrt(i);A=.5*(A+e),b=A*A;const t=e-A;v.x=(A*v.x+t*o.x)/e,v.y=(A*v.y+t*o.y)/e,v.z=(A*v.z+t*o.z)/e}}return A<x?(K.clone(v,i.center),i.radius=A):(K.clone(E,i.center),i.radius=x),i},gt.fromEncodedCartesianVertices=function(e,t,n){if(C(n)||(n=new gt),!C(e)||!C(t)||e.length!==t.length||0===e.length)return n.center=K.clone(K.ZERO,n.center),n.radius=0,n;const i=Ct;i.x=e[0]+t[0],i.y=e[1]+t[1],i.z=e[2]+t[2];const o=K.clone(i,yt),r=K.clone(i,vt),s=K.clone(i,bt),a=K.clone(i,At),c=K.clone(i,wt),l=K.clone(i,Tt),u=e.length;let h;for(h=0;h<u;h+=3){const n=e[h]+t[h],u=e[h+1]+t[h+1],d=e[h+2]+t[h+2];i.x=n,i.y=u,i.z=d,n<o.x&&K.clone(i,o),n>a.x&&K.clone(i,a),u<r.y&&K.clone(i,r),u>c.y&&K.clone(i,c),d<s.z&&K.clone(i,s),d>l.z&&K.clone(i,l)}const d=K.magnitudeSquared(K.subtract(a,o,Et)),f=K.magnitudeSquared(K.subtract(c,r,Et)),p=K.magnitudeSquared(K.subtract(l,s,Et));let m=o,_=a,g=d;f>g&&(g=f,m=r,_=c),p>g&&(g=p,m=s,_=l);const y=xt;y.x=.5*(m.x+_.x),y.y=.5*(m.y+_.y),y.z=.5*(m.z+_.z);let v=K.magnitudeSquared(K.subtract(_,y,Et)),b=Math.sqrt(v);const A=St;A.x=o.x,A.y=r.y,A.z=s.z;const w=It;w.x=a.x,w.y=c.y,w.z=l.z;const T=K.midpoint(A,w,Ot);let E=0;for(h=0;h<u;h+=3){i.x=e[h]+t[h],i.y=e[h+1]+t[h+1],i.z=e[h+2]+t[h+2];const n=K.magnitude(K.subtract(i,T,Et));n>E&&(E=n);const o=K.magnitudeSquared(K.subtract(i,y,Et));if(o>v){const e=Math.sqrt(o);b=.5*(b+e),v=b*b;const t=e-b;y.x=(b*y.x+t*i.x)/e,y.y=(b*y.y+t*i.y)/e,y.z=(b*y.z+t*i.z)/e}}return b<E?(K.clone(y,n.center),n.radius=b):(K.clone(T,n.center),n.radius=E),n},gt.fromCornerPoints=function(e,t,n){D.typeOf.object("corner",e),D.typeOf.object("oppositeCorner",t),C(n)||(n=new gt);const i=K.midpoint(e,t,n.center);return n.radius=K.distance(i,t),n},gt.fromEllipsoid=function(e,t){return D.typeOf.object("ellipsoid",e),C(t)||(t=new gt),K.clone(K.ZERO,t.center),t.radius=e.maximumRadius,t};const Ft=new K;gt.fromBoundingSpheres=function(e,t){if(C(t)||(t=new gt),!C(e)||0===e.length)return t.center=K.clone(K.ZERO,t.center),t.radius=0,t;const n=e.length;if(1===n)return gt.clone(e[0],t);if(2===n)return gt.union(e[0],e[1],t);const i=[];let o;for(o=0;o<n;o++)i.push(e[o].center);t=gt.fromPoints(i,t);const r=t.center;let s=t.radius;for(o=0;o<n;o++){const t=e[o];s=Math.max(s,K.distance(r,t.center,Ft)+t.radius)}return t.radius=s,t};const zt=new K,kt=new K,Ut=new K;gt.fromOrientedBoundingBox=function(e,t){D.defined("orientedBoundingBox",e),C(t)||(t=new gt);const n=e.halfAxes,i=ke.getColumn(n,0,zt),o=ke.getColumn(n,1,kt),r=ke.getColumn(n,2,Ut);return K.add(i,o,i),K.add(i,r,i),t.center=K.clone(e.center,t.center),t.radius=K.magnitude(i),t};const Vt=new K,Ht=new K;gt.fromTransformation=function(e,t){D.typeOf.object("transformation",e),C(t)||(t=new gt);const n=ft.getTranslation(e,Vt),i=ft.getScale(e,Ht),o=.5*K.magnitude(i);return t.center=K.clone(n,t.center),t.radius=o,t},gt.clone=function(e,t){if(C(e))return C(t)?(t.center=K.clone(e.center,t.center),t.radius=e.radius,t):new gt(e.center,e.radius)},gt.packedLength=4,gt.pack=function(e,t,n){D.typeOf.object("value",e),D.defined("array",t),n=R(n,0);const i=e.center;return t[n++]=i.x,t[n++]=i.y,t[n++]=i.z,t[n]=e.radius,t},gt.unpack=function(e,t,n){D.defined("array",e),t=R(t,0),C(n)||(n=new gt);const i=n.center;return i.x=e[t++],i.y=e[t++],i.z=e[t++],n.radius=e[t],n};const Gt=new K,Wt=new K;gt.union=function(e,t,n){D.typeOf.object("left",e),D.typeOf.object("right",t),C(n)||(n=new gt);const i=e.center,o=e.radius,r=t.center,s=t.radius,a=K.subtract(r,i,Gt),c=K.magnitude(a);if(o>=c+s)return e.clone(n),n;if(s>=c+o)return t.clone(n),n;const l=.5*(o+c+s),u=K.multiplyByScalar(a,(-o+l)/c,Wt);return K.add(u,i,u),K.clone(u,n.center),n.radius=l,n};const qt=new K;gt.expand=function(e,t,n){D.typeOf.object("sphere",e),D.typeOf.object("point",t),n=gt.clone(e,n);const i=K.magnitude(K.subtract(t,n.center,qt));return i>n.radius&&(n.radius=i),n},gt.intersectPlane=function(e,t){D.typeOf.object("sphere",e),D.typeOf.object("plane",t);const n=e.center,i=e.radius,o=t.normal,r=K.dot(o,n)+t.distance;return r<-i?Ae.OUTSIDE:r<i?Ae.INTERSECTING:Ae.INSIDE},gt.transform=function(e,t,n){return D.typeOf.object("sphere",e),D.typeOf.object("transform",t),C(n)||(n=new gt),n.center=ft.multiplyByPoint(t,e.center,n.center),n.radius=ft.getMaximumScale(t)*e.radius,n};const jt=new K;gt.distanceSquaredTo=function(e,t){D.typeOf.object("sphere",e),D.typeOf.object("cartesian",t);const n=K.subtract(e.center,t,jt),i=K.magnitude(n)-e.radius;return i<=0?0:i*i},gt.transformWithoutScale=function(e,t,n){return D.typeOf.object("sphere",e),D.typeOf.object("transform",t),C(n)||(n=new gt),n.center=ft.multiplyByPoint(t,e.center,n.center),n.radius=e.radius,n};const Yt=new K;gt.computePlaneDistances=function(e,t,n,i){D.typeOf.object("sphere",e),D.typeOf.object("position",t),D.typeOf.object("direction",n),C(i)||(i=new Te);const o=K.subtract(e.center,t,Yt),r=K.dot(n,o);return i.start=r-e.radius,i.stop=r+e.radius,i};const Kt=new K,Xt=new K,Qt=new K,Jt=new K,Zt=new K,$t=new se,en=new Array(8);for(let ko=0;ko<8;++ko)en[ko]=new K;const tn=new ve;gt.projectTo2D=function(e,t,n){D.typeOf.object("sphere",e),t=R(t,tn);const i=t.ellipsoid;let o=e.center;const r=e.radius;let s;s=K.equals(o,K.ZERO)?K.clone(K.UNIT_X,Kt):i.geodeticSurfaceNormal(o,Kt);const a=K.cross(K.UNIT_Z,s,Xt);K.normalize(a,a);const c=K.cross(s,a,Qt);K.normalize(c,c),K.multiplyByScalar(s,r,s),K.multiplyByScalar(c,r,c),K.multiplyByScalar(a,r,a);const l=K.negate(c,Zt),u=K.negate(a,Jt),h=en;let d=h[0];K.add(s,c,d),K.add(d,a,d),d=h[1],K.add(s,c,d),K.add(d,u,d),d=h[2],K.add(s,l,d),K.add(d,u,d),d=h[3],K.add(s,l,d),K.add(d,a,d),K.negate(s,s),d=h[4],K.add(s,c,d),K.add(d,a,d),d=h[5],K.add(s,c,d),K.add(d,u,d),d=h[6],K.add(s,l,d),K.add(d,u,d),d=h[7],K.add(s,l,d),K.add(d,a,d);const f=h.length;for(let g=0;g<f;++g){const e=h[g];K.add(o,e,e);const n=i.cartesianToCartographic(e,$t);t.project(n,e)}n=gt.fromPoints(h,n),o=n.center;const p=o.x,m=o.y,_=o.z;return o.x=_,o.y=p,o.z=m,n},gt.isOccluded=function(e,t){return D.typeOf.object("sphere",e),D.typeOf.object("occluder",t),!t.isBoundingSphereVisible(e)},gt.equals=function(e,t){return e===t||C(e)&&C(t)&&K.equals(e.center,t.center)&&e.radius===t.radius},gt.prototype.intersectPlane=function(e){return gt.intersectPlane(this,e)},gt.prototype.distanceSquaredTo=function(e){return gt.distanceSquaredTo(this,e)},gt.prototype.computePlaneDistances=function(e,t,n){return gt.computePlaneDistances(this,e,t,n)},gt.prototype.isOccluded=function(e){return gt.isOccluded(this,e)},gt.prototype.equals=function(e){return gt.equals(this,e)},gt.prototype.clone=function(e){return gt.clone(this,e)},gt.prototype.volume=function(){const e=this.radius;return Dt*e*e*e};var nn=gt,on=n(7885),rn=(0,on.c)((function(e,t){(function(n){var i=t&&!t.nodeType&&t,o=e&&!e.nodeType&&e,r="object"==typeof on.a&&on.a;r.global!==r&&r.window!==r&&r.self!==r||(n=r);var s,a,c=2147483647,l=36,u=1,h=26,d=38,f=700,p=72,m=128,_="-",g=/^xn--/,y=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},A=l-u,w=Math.floor,T=String.fromCharCode;function C(e){throw new RangeError(b[e])}function E(e,t){var n=e.length,i=[];while(n--)i[n]=t(e[n]);return i}function x(e,t){var n=e.split("@"),i="";n.length>1&&(i=n[0]+"@",e=n[1]),e=e.replace(v,".");var o=e.split("."),r=E(o,t).join(".");return i+r}function S(e){var t,n,i=[],o=0,r=e.length;while(o<r)t=e.charCodeAt(o++),t>=55296&&t<=56319&&o<r?(n=e.charCodeAt(o++),56320==(64512&n)?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),o--)):i.push(t);return i}function I(e){return E(e,(function(e){var t="";return e>65535&&(e-=65536,t+=T(e>>>10&1023|55296),e=56320|1023&e),t+=T(e),t})).join("")}function O(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:l}function D(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function P(e,t,n){var i=0;for(e=n?w(e/f):e>>1,e+=w(e/t);e>A*h>>1;i+=l)e=w(e/A);return w(i+(A+1)*e/(e+d))}function R(e){var t,n,i,o,r,s,a,d,f,g,y=[],v=e.length,b=0,A=m,T=p;for(n=e.lastIndexOf(_),n<0&&(n=0),i=0;i<n;++i)e.charCodeAt(i)>=128&&C("not-basic"),y.push(e.charCodeAt(i));for(o=n>0?n+1:0;o<v;){for(r=b,s=1,a=l;;a+=l){if(o>=v&&C("invalid-input"),d=O(e.charCodeAt(o++)),(d>=l||d>w((c-b)/s))&&C("overflow"),b+=d*s,f=a<=T?u:a>=T+h?h:a-T,d<f)break;g=l-f,s>w(c/g)&&C("overflow"),s*=g}t=y.length+1,T=P(b-r,t,0==r),w(b/t)>c-A&&C("overflow"),A+=w(b/t),b%=t,y.splice(b++,0,A)}return I(y)}function L(e){var t,n,i,o,r,s,a,d,f,g,y,v,b,A,E,x=[];for(e=S(e),v=e.length,t=m,n=0,r=p,s=0;s<v;++s)y=e[s],y<128&&x.push(T(y));i=o=x.length,o&&x.push(_);while(i<v){for(a=c,s=0;s<v;++s)y=e[s],y>=t&&y<a&&(a=y);for(b=i+1,a-t>w((c-n)/b)&&C("overflow"),n+=(a-t)*b,t=a,s=0;s<v;++s)if(y=e[s],y<t&&++n>c&&C("overflow"),y==t){for(d=n,f=l;;f+=l){if(g=f<=r?u:f>=r+h?h:f-r,d<g)break;E=d-g,A=l-g,x.push(T(D(g+E%A,0))),d=w(E/A)}x.push(T(D(d,0))),r=P(n,b,i==o),n=0,++i}++n,++t}return x.join("")}function M(e){return x(e,(function(e){return g.test(e)?R(e.slice(4).toLowerCase()):e}))}function B(e){return x(e,(function(e){return y.test(e)?"xn--"+L(e):e}))}if(s={version:"1.3.2",ucs2:{decode:S,encode:I},decode:R,encode:L,toASCII:B,toUnicode:M},i&&o)if(e.exports==i)o.exports=s;else for(a in s)s.hasOwnProperty(a)&&(i[a]=s[a]);else n.punycode=s})(on.a)})),sn=(0,on.c)((function(e){
/*!
   * URI.js - Mutating URLs
   * IPv6 Support
   *
   * Version: 1.19.10
   *
   * Author: Rodney Rehm
   * Web: http://medialize.github.io/URI.js/
   *
   * Licensed under
   *   MIT License http://www.opensource.org/licenses/mit-license
   *
   */
(function(t,n){e.exports?e.exports=n():t.IPv6=n(t)})(on.a,(function(e){var t=e&&e.IPv6;function n(e){var t,n,i=e.toLowerCase(),o=i.split(":"),r=o.length,s=8;for(""===o[0]&&""===o[1]&&""===o[2]?(o.shift(),o.shift()):""===o[0]&&""===o[1]?o.shift():""===o[r-1]&&""===o[r-2]&&o.pop(),r=o.length,-1!==o[r-1].indexOf(".")&&(s=7),t=0;t<r;t++)if(""===o[t])break;if(t<s){o.splice(t,1,"0000");while(o.length<s)o.splice(t,0,"0000")}for(var a=0;a<s;a++){n=o[a].split("");for(var c=0;c<3;c++){if(!("0"===n[0]&&n.length>1))break;n.splice(0,1)}o[a]=n.join("")}var l=-1,u=0,h=0,d=-1,f=!1;for(a=0;a<s;a++)f?"0"===o[a]?h+=1:(f=!1,h>u&&(l=d,u=h)):"0"===o[a]&&(f=!0,d=a,h=1);h>u&&(l=d,u=h),u>1&&o.splice(l,u,""),r=o.length;var p="";for(""===o[0]&&(p=":"),a=0;a<r;a++){if(p+=o[a],a===r-1)break;p+=":"}return""===o[r-1]&&(p+=":"),p}function i(){return e.IPv6===this&&(e.IPv6=t),this}return{best:n,noConflict:i}}))})),an=(0,on.c)((function(e){
/*!
   * URI.js - Mutating URLs
   * Second Level Domain (SLD) Support
   *
   * Version: 1.19.10
   *
   * Author: Rodney Rehm
   * Web: http://medialize.github.io/URI.js/
   *
   * Licensed under
   *   MIT License http://www.opensource.org/licenses/mit-license
   *
   */
(function(t,n){e.exports?e.exports=n():t.SecondLevelDomains=n(t)})(on.a,(function(e){var t=e&&e.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;var i=e.lastIndexOf(".",t-1);if(i<=0||i>=t-1)return!1;var o=n.list[e.slice(t+1)];return!!o&&o.indexOf(" "+e.slice(i+1,t)+" ")>=0},is:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;var i=e.lastIndexOf(".",t-1);if(i>=0)return!1;var o=n.list[e.slice(t+1)];return!!o&&o.indexOf(" "+e.slice(0,t)+" ")>=0},get:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return null;var i=e.lastIndexOf(".",t-1);if(i<=0||i>=t-1)return null;var o=n.list[e.slice(t+1)];return o?o.indexOf(" "+e.slice(i+1,t)+" ")<0?null:e.slice(i+1):null},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return n}))})),cn=(0,on.c)((function(e){
/*!
   * URI.js - Mutating URLs
   *
   * Version: 1.19.10
   *
   * Author: Rodney Rehm
   * Web: http://medialize.github.io/URI.js/
   *
   * Licensed under
   *   MIT License http://www.opensource.org/licenses/mit-license
   *
   */
(function(t,n){e.exports?e.exports=n(rn,sn,an):t.URI=n(t.punycode,t.IPv6,t.SecondLevelDomains,t)})(on.a,(function(e,t,n,i){var o=i&&i.URI;function r(e,t){var n=arguments.length>=1,i=arguments.length>=2;if(!(this instanceof r))return n?i?new r(e,t):new r(e):new r;if(void 0===e){if(n)throw new TypeError("undefined is not a valid argument for URI");e="undefined"!==typeof location?location.href+"":""}if(null===e&&n)throw new TypeError("null is not a valid argument for URI");return this.href(e),void 0!==t?this.absoluteTo(t):this}function s(e){return/^[0-9]+$/.test(e)}r.version="1.19.10";var a=r.prototype,c=Object.prototype.hasOwnProperty;function l(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function u(e){return void 0===e?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function h(e){return"Array"===u(e)}function d(e,t){var n,i,o={};if("RegExp"===u(t))o=null;else if(h(t))for(n=0,i=t.length;n<i;n++)o[t[n]]=!0;else o[t]=!0;for(n=0,i=e.length;n<i;n++){var r=o&&void 0!==o[e[n]]||!o&&t.test(e[n]);r&&(e.splice(n,1),i--,n--)}return e}function f(e,t){var n,i;if(h(t)){for(n=0,i=t.length;n<i;n++)if(!f(e,t[n]))return!1;return!0}var o=u(t);for(n=0,i=e.length;n<i;n++)if("RegExp"===o){if("string"===typeof e[n]&&e[n].match(t))return!0}else if(e[n]===t)return!0;return!1}function p(e,t){if(!h(e)||!h(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function m(e){var t=/^\/+|\/+$/g;return e.replace(t,"")}function _(e){return escape(e)}function g(e){return encodeURIComponent(e).replace(/[!'()*]/g,_).replace(/\*/g,"%2A")}r._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:r.preventInvalidHostname,duplicateQueryParameters:r.duplicateQueryParameters,escapeQuerySpace:r.escapeQuerySpace}},r.preventInvalidHostname=!1,r.duplicateQueryParameters=!1,r.escapeQuerySpace=!0,r.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,r.idn_expression=/[^a-z0-9\._-]/i,r.punycode_expression=/(xn--)/i,r.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,r.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,r.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,r.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},r.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,r.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},r.hostProtocols=["http","https"],r.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,r.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},r.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();if("input"!==t||"image"===e.type)return r.domAttributes[t]}},r.encode=g,r.decode=decodeURIComponent,r.iso8859=function(){r.encode=escape,r.decode=unescape},r.unicode=function(){r.encode=g,r.decode=decodeURIComponent},r.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},r.encodeQuery=function(e,t){var n=r.encode(e+"");return void 0===t&&(t=r.escapeQuerySpace),t?n.replace(/%20/g,"+"):n},r.decodeQuery=function(e,t){e+="",void 0===t&&(t=r.escapeQuerySpace);try{return r.decode(t?e.replace(/\+/g,"%20"):e)}catch(n){return e}};var y,v={encode:"encode",decode:"decode"},b=function(e,t){return function(n){try{return r[t](n+"").replace(r.characters[e][t].expression,(function(n){return r.characters[e][t].map[n]}))}catch(i){return n}}};for(y in v)r[y+"PathSegment"]=b("pathname",v[y]),r[y+"UrnPathSegment"]=b("urnpath",v[y]);var A=function(e,t,n){return function(i){var o;o=n?function(e){return r[t](r[n](e))}:r[t];for(var s=(i+"").split(e),a=0,c=s.length;a<c;a++)s[a]=o(s[a]);return s.join(e)}};function w(e){return function(t,n){return void 0===t?this._parts[e]||"":(this._parts[e]=t||null,this.build(!n),this)}}function T(e,t){return function(n,i){return void 0===n?this._parts[e]||"":(null!==n&&(n+="",n.charAt(0)===t&&(n=n.substring(1))),this._parts[e]=n,this.build(!i),this)}}r.decodePath=A("/","decodePathSegment"),r.decodeUrnPath=A(":","decodeUrnPathSegment"),r.recodePath=A("/","encodePathSegment","decode"),r.recodeUrnPath=A(":","encodeUrnPathSegment","decode"),r.encodeReserved=b("reserved","encode"),r.parse=function(e,t){var n;return t||(t={preventInvalidHostname:r.preventInvalidHostname}),e=e.replace(r.leading_whitespace_expression,""),n=e.indexOf("#"),n>-1&&(t.fragment=e.substring(n+1)||null,e=e.substring(0,n)),n=e.indexOf("?"),n>-1&&(t.query=e.substring(n+1)||null,e=e.substring(0,n)),e=e.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),"//"===e.substring(0,2)?(t.protocol=null,e=e.substring(2),e=r.parseAuthority(e,t)):(n=e.indexOf(":"),n>-1&&(t.protocol=e.substring(0,n)||null,t.protocol&&!t.protocol.match(r.protocol_expression)?t.protocol=void 0:"//"===e.substring(n+1,n+3).replace(/\\/g,"/")?(e=e.substring(n+3),e=r.parseAuthority(e,t)):(e=e.substring(n+1),t.urn=!0))),t.path=e,t},r.parseHost=function(e,t){e||(e=""),e=e.replace(/\\/g,"/");var n,i,o=e.indexOf("/");if(-1===o&&(o=e.length),"["===e.charAt(0))n=e.indexOf("]"),t.hostname=e.substring(1,n)||null,t.port=e.substring(n+2,o)||null,"/"===t.port&&(t.port=null);else{var s=e.indexOf(":"),a=e.indexOf("/"),c=e.indexOf(":",s+1);-1!==c&&(-1===a||c<a)?(t.hostname=e.substring(0,o)||null,t.port=null):(i=e.substring(0,o).split(":"),t.hostname=i[0]||null,t.port=i[1]||null)}return t.hostname&&"/"!==e.substring(o).charAt(0)&&(o++,e="/"+e),t.preventInvalidHostname&&r.ensureValidHostname(t.hostname,t.protocol),t.port&&r.ensureValidPort(t.port),e.substring(o)||"/"},r.parseAuthority=function(e,t){return e=r.parseUserinfo(e,t),r.parseHost(e,t)},r.parseUserinfo=function(e,t){var n=e,i=e.indexOf("\\");-1!==i&&(e=e.replace(/\\/g,"/"));var o,s=e.indexOf("/"),a=e.lastIndexOf("@",s>-1?s:e.length-1);return a>-1&&(-1===s||a<s)?(o=e.substring(0,a).split(":"),t.username=o[0]?r.decode(o[0]):null,o.shift(),t.password=o[0]?r.decode(o.join(":")):null,e=n.substring(a+1)):(t.username=null,t.password=null),e},r.parseQuery=function(e,t){if(!e)return{};if(e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!e)return{};for(var n,i,o,s={},a=e.split("&"),l=a.length,u=0;u<l;u++)n=a[u].split("="),i=r.decodeQuery(n.shift(),t),o=n.length?r.decodeQuery(n.join("="),t):null,"__proto__"!==i&&(c.call(s,i)?("string"!==typeof s[i]&&null!==s[i]||(s[i]=[s[i]]),s[i].push(o)):s[i]=o);return s},r.build=function(e){var t="",n=!1;return e.protocol&&(t+=e.protocol+":"),e.urn||!t&&!e.hostname||(t+="//",n=!0),t+=r.buildAuthority(e)||"","string"===typeof e.path&&("/"!==e.path.charAt(0)&&n&&(t+="/"),t+=e.path),"string"===typeof e.query&&e.query&&(t+="?"+e.query),"string"===typeof e.fragment&&e.fragment&&(t+="#"+e.fragment),t},r.buildHost=function(e){var t="";return e.hostname?(r.ip6_expression.test(e.hostname)?t+="["+e.hostname+"]":t+=e.hostname,e.port&&(t+=":"+e.port),t):""},r.buildAuthority=function(e){return r.buildUserinfo(e)+r.buildHost(e)},r.buildUserinfo=function(e){var t="";return e.username&&(t+=r.encode(e.username)),e.password&&(t+=":"+r.encode(e.password)),t&&(t+="@"),t},r.buildQuery=function(e,t,n){var i,o,s,a,l="";for(o in e)if("__proto__"!==o&&c.call(e,o))if(h(e[o]))for(i={},s=0,a=e[o].length;s<a;s++)void 0!==e[o][s]&&void 0===i[e[o][s]+""]&&(l+="&"+r.buildQueryParameter(o,e[o][s],n),!0!==t&&(i[e[o][s]+""]=!0));else void 0!==e[o]&&(l+="&"+r.buildQueryParameter(o,e[o],n));return l.substring(1)},r.buildQueryParameter=function(e,t,n){return r.encodeQuery(e,n)+(null!==t?"="+r.encodeQuery(t,n):"")},r.addQuery=function(e,t,n){if("object"===typeof t)for(var i in t)c.call(t,i)&&r.addQuery(e,i,t[i]);else{if("string"!==typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===e[t])return void(e[t]=n);"string"===typeof e[t]&&(e[t]=[e[t]]),h(n)||(n=[n]),e[t]=(e[t]||[]).concat(n)}},r.setQuery=function(e,t,n){if("object"===typeof t)for(var i in t)c.call(t,i)&&r.setQuery(e,i,t[i]);else{if("string"!==typeof t)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");e[t]=void 0===n?null:n}},r.removeQuery=function(e,t,n){var i,o,s;if(h(t))for(i=0,o=t.length;i<o;i++)e[t[i]]=void 0;else if("RegExp"===u(t))for(s in e)t.test(s)&&(e[s]=void 0);else if("object"===typeof t)for(s in t)c.call(t,s)&&r.removeQuery(e,s,t[s]);else{if("string"!==typeof t)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==n?"RegExp"===u(n)?!h(e[t])&&n.test(e[t])?e[t]=void 0:e[t]=d(e[t],n):e[t]!==String(n)||h(n)&&1!==n.length?h(e[t])&&(e[t]=d(e[t],n)):e[t]=void 0:e[t]=void 0}},r.hasQuery=function(e,t,n,i){switch(u(t)){case"String":break;case"RegExp":for(var o in e)if(c.call(e,o)&&t.test(o)&&(void 0===n||r.hasQuery(e,o,n)))return!0;return!1;case"Object":for(var s in t)if(c.call(t,s)&&!r.hasQuery(e,s,t[s]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(u(n)){case"Undefined":return t in e;case"Boolean":var a=Boolean(h(e[t])?e[t].length:e[t]);return n===a;case"Function":return!!n(e[t],t,e);case"Array":if(!h(e[t]))return!1;var l=i?f:p;return l(e[t],n);case"RegExp":return h(e[t])?!!i&&f(e[t],n):Boolean(e[t]&&e[t].match(n));case"Number":n=String(n);case"String":return h(e[t])?!!i&&f(e[t],n):e[t]===n;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},r.joinPaths=function(){for(var e=[],t=[],n=0,i=0;i<arguments.length;i++){var o=new r(arguments[i]);e.push(o);for(var s=o.segment(),a=0;a<s.length;a++)"string"===typeof s[a]&&t.push(s[a]),s[a]&&n++}if(!t.length||!n)return new r("");var c=new r("").segment(t);return""!==e[0].path()&&"/"!==e[0].path().slice(0,1)||c.path("/"+c.path()),c.normalize()},r.commonPath=function(e,t){var n,i=Math.min(e.length,t.length);for(n=0;n<i;n++)if(e.charAt(n)!==t.charAt(n)){n--;break}return n<1?e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"":("/"===e.charAt(n)&&"/"===t.charAt(n)||(n=e.substring(0,n).lastIndexOf("/")),e.substring(0,n+1))},r.withinString=function(e,t,n){n||(n={});var i=n.start||r.findUri.start,o=n.end||r.findUri.end,s=n.trim||r.findUri.trim,a=n.parens||r.findUri.parens,c=/[a-z0-9-]=["']?$/i;i.lastIndex=0;while(1){var l=i.exec(e);if(!l)break;var u=l.index;if(n.ignoreHtml){var h=e.slice(Math.max(u-3,0),u);if(h&&c.test(h))continue}var d=u+e.slice(u).search(o),f=e.slice(u,d),p=-1;while(1){var m=a.exec(f);if(!m)break;var _=m.index+m[0].length;p=Math.max(p,_)}if(f=p>-1?f.slice(0,p)+f.slice(p).replace(s,""):f.replace(s,""),!(f.length<=l[0].length)&&(!n.ignore||!n.ignore.test(f))){d=u+f.length;var g=t(f,u,d,e);void 0!==g?(g=String(g),e=e.slice(0,u)+g+e.slice(d),i.lastIndex=u+g.length):i.lastIndex=d}}return i.lastIndex=0,e},r.ensureValidHostname=function(t,n){var i=!!t,o=!!n,s=!1;if(o&&(s=f(r.hostProtocols,n)),s&&!i)throw new TypeError("Hostname cannot be empty, if protocol is "+n);if(t&&t.match(r.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(t).match(r.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_]')}},r.ensureValidPort=function(e){if(e){var t=Number(e);if(!(s(t)&&t>0&&t<65536))throw new TypeError('Port "'+e+'" is not a valid port')}},r.noConflict=function(e){if(e){var t={URI:this.noConflict()};return i.URITemplate&&"function"===typeof i.URITemplate.noConflict&&(t.URITemplate=i.URITemplate.noConflict()),i.IPv6&&"function"===typeof i.IPv6.noConflict&&(t.IPv6=i.IPv6.noConflict()),i.SecondLevelDomains&&"function"===typeof i.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=i.SecondLevelDomains.noConflict()),t}return i.URI===this&&(i.URI=o),this},a.build=function(e){return!0===e?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=r.build(this._parts),this._deferred_build=!1),this},a.clone=function(){return new r(this)},a.valueOf=a.toString=function(){return this.build(!1)._string},a.protocol=w("protocol"),a.username=w("username"),a.password=w("password"),a.hostname=w("hostname"),a.port=w("port"),a.query=T("query","?"),a.fragment=T("fragment","#"),a.search=function(e,t){var n=this.query(e,t);return"string"===typeof n&&n.length?"?"+n:n},a.hash=function(e,t){var n=this.fragment(e,t);return"string"===typeof n&&n.length?"#"+n:n},a.pathname=function(e,t){if(void 0===e||!0===e){var n=this._parts.path||(this._parts.hostname?"/":"");return e?(this._parts.urn?r.decodeUrnPath:r.decodePath)(n):n}return this._parts.urn?this._parts.path=e?r.recodeUrnPath(e):"":this._parts.path=e?r.recodePath(e):"/",this.build(!t),this},a.path=a.pathname,a.href=function(e,t){var n;if(void 0===e)return this.toString();this._string="",this._parts=r._parts();var i=e instanceof r,o="object"===typeof e&&(e.hostname||e.path||e.pathname);if(e.nodeName){var s=r.getDomAttribute(e);e=e[s]||"",o=!1}if(!i&&o&&void 0!==e.pathname&&(e=e.toString()),"string"===typeof e||e instanceof String)this._parts=r.parse(String(e),this._parts);else{if(!i&&!o)throw new TypeError("invalid input");var a=i?e._parts:e;for(n in a)"query"!==n&&c.call(this._parts,n)&&(this._parts[n]=a[n]);a.query&&this.query(a.query,!1)}return this.build(!t),this},a.is=function(e){var t=!1,i=!1,o=!1,s=!1,a=!1,c=!1,l=!1,u=!this._parts.urn;switch(this._parts.hostname&&(u=!1,i=r.ip4_expression.test(this._parts.hostname),o=r.ip6_expression.test(this._parts.hostname),t=i||o,s=!t,a=s&&n&&n.has(this._parts.hostname),c=s&&r.idn_expression.test(this._parts.hostname),l=s&&r.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case"relative":return u;case"absolute":return!u;case"domain":case"name":return s;case"sld":return a;case"ip":return t;case"ip4":case"ipv4":case"inet4":return i;case"ip6":case"ipv6":case"inet6":return o;case"idn":return c;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return l}return null};var C=a.protocol,E=a.port,x=a.hostname;a.protocol=function(e,t){if(e&&(e=e.replace(/:(\/\/)?$/,""),!e.match(r.protocol_expression)))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return C.call(this,e,t)},a.scheme=a.protocol,a.port=function(e,t){return this._parts.urn?void 0===e?"":this:(void 0!==e&&(0===e&&(e=null),e&&(e+="",":"===e.charAt(0)&&(e=e.substring(1)),r.ensureValidPort(e))),E.call(this,e,t))},a.hostname=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e){var n={preventInvalidHostname:this._parts.preventInvalidHostname},i=r.parseHost(e,n);if("/"!==i)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=n.hostname,this._parts.preventInvalidHostname&&r.ensureValidHostname(e,this._parts.protocol)}return x.call(this,e,t)},a.origin=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var n=this.protocol(),i=this.authority();return i?(n?n+"://":"")+this.authority():""}var o=r(e);return this.protocol(o.protocol()).authority(o.authority()).build(!t),this},a.host=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?r.buildHost(this._parts):"";var n=r.parseHost(e,this._parts);if("/"!==n)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},a.authority=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?r.buildAuthority(this._parts):"";var n=r.parseAuthority(e,this._parts);if("/"!==n)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},a.userinfo=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var n=r.buildUserinfo(this._parts);return n?n.substring(0,n.length-1):n}return"@"!==e[e.length-1]&&(e+="@"),r.parseUserinfo(e,this._parts),this.build(!t),this},a.resource=function(e,t){var n;return void 0===e?this.path()+this.search()+this.hash():(n=r.parse(e),this._parts.path=n.path,this._parts.query=n.query,this._parts.fragment=n.fragment,this.build(!t),this)},a.subdomain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,n)||""}var i=this._parts.hostname.length-this.domain().length,o=this._parts.hostname.substring(0,i),s=new RegExp("^"+l(o));if(e&&"."!==e.charAt(e.length-1)&&(e+="."),-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");return e&&r.ensureValidHostname(e,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(s,e),this.build(!t),this},a.domain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"===typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.match(/\./g);if(n&&n.length<2)return this._parts.hostname;var i=this._parts.hostname.length-this.tld(t).length-1;return i=this._parts.hostname.lastIndexOf(".",i-1)+1,this._parts.hostname.substring(i)||""}if(!e)throw new TypeError("cannot set domain empty");if(-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");if(r.ensureValidHostname(e,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var o=new RegExp(l(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(o,e)}return this.build(!t),this},a.tld=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"===typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.lastIndexOf("."),o=this._parts.hostname.substring(i+1);return!0!==t&&n&&n.list[o.toLowerCase()]&&n.get(this._parts.hostname)||o}var r;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!n||!n.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');r=new RegExp(l(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(r,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");r=new RegExp(l(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(r,e)}return this.build(!t),this},a.directory=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var n=this._parts.path.length-this.filename().length-1,i=this._parts.path.substring(0,n)||(this._parts.hostname?"/":"");return e?r.decodePath(i):i}var o=this._parts.path.length-this.filename().length,s=this._parts.path.substring(0,o),a=new RegExp("^"+l(s));return this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e)),e&&"/"!==e.charAt(e.length-1)&&(e+="/"),e=r.recodePath(e),this._parts.path=this._parts.path.replace(a,e),this.build(!t),this},a.filename=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("string"!==typeof e){if(!this._parts.path||"/"===this._parts.path)return"";var n=this._parts.path.lastIndexOf("/"),i=this._parts.path.substring(n+1);return e?r.decodePathSegment(i):i}var o=!1;"/"===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(o=!0);var s=new RegExp(l(this.filename())+"$");return e=r.recodePath(e),this._parts.path=this._parts.path.replace(s,e),o?this.normalizePath(t):this.build(!t),this},a.suffix=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path)return"";var n,i,o=this.filename(),s=o.lastIndexOf(".");return-1===s?"":(n=o.substring(s+1),i=/^[a-z0-9%]+$/i.test(n)?n:"",e?r.decodePathSegment(i):i)}"."===e.charAt(0)&&(e=e.substring(1));var a,c=this.suffix();if(c)a=e?new RegExp(l(c)+"$"):new RegExp(l("."+c)+"$");else{if(!e)return this;this._parts.path+="."+r.recodePath(e)}return a&&(e=r.recodePath(e),this._parts.path=this._parts.path.replace(a,e)),this.build(!t),this},a.segment=function(e,t,n){var i=this._parts.urn?":":"/",o=this.path(),r="/"===o.substring(0,1),s=o.split(i);if(void 0!==e&&"number"!==typeof e&&(n=t,t=e,e=void 0),void 0!==e&&"number"!==typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');if(r&&s.shift(),e<0&&(e=Math.max(s.length+e,0)),void 0===t)return void 0===e?s:s[e];if(null===e||void 0===s[e])if(h(t)){s=[];for(var a=0,c=t.length;a<c;a++)(t[a].length||s.length&&s[s.length-1].length)&&(s.length&&!s[s.length-1].length&&s.pop(),s.push(m(t[a])))}else(t||"string"===typeof t)&&(t=m(t),""===s[s.length-1]?s[s.length-1]=t:s.push(t));else t?s[e]=m(t):s.splice(e,1);return r&&s.unshift(""),this.path(s.join(i),n)},a.segmentCoded=function(e,t,n){var i,o,s;if("number"!==typeof e&&(n=t,t=e,e=void 0),void 0===t){if(i=this.segment(e,t,n),h(i))for(o=0,s=i.length;o<s;o++)i[o]=r.decode(i[o]);else i=void 0!==i?r.decode(i):void 0;return i}if(h(t))for(o=0,s=t.length;o<s;o++)t[o]=r.encode(t[o]);else t="string"===typeof t||t instanceof String?r.encode(t):t;return this.segment(e,t,n)};var S=a.query;return a.query=function(e,t){if(!0===e)return r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"===typeof e){var n=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace),i=e.call(this,n);return this._parts.query=r.buildQuery(i||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&"string"!==typeof e?(this._parts.query=r.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):S.call(this,e,t)},a.setQuery=function(e,t,n){var i=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"===typeof e||e instanceof String)i[e]=void 0!==t?t:null;else{if("object"!==typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var o in e)c.call(e,o)&&(i[o]=e[o])}return this._parts.query=r.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!==typeof e&&(n=t),this.build(!n),this},a.addQuery=function(e,t,n){var i=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.addQuery(i,e,void 0===t?null:t),this._parts.query=r.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!==typeof e&&(n=t),this.build(!n),this},a.removeQuery=function(e,t,n){var i=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.removeQuery(i,e,t),this._parts.query=r.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!==typeof e&&(n=t),this.build(!n),this},a.hasQuery=function(e,t,n){var i=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.hasQuery(i,e,t,n)},a.setSearch=a.setQuery,a.addSearch=a.addQuery,a.removeSearch=a.removeQuery,a.hasSearch=a.hasQuery,a.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},a.normalizeProtocol=function(e){return"string"===typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},a.normalizeHostname=function(n){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!n)),this},a.normalizePort=function(e){return"string"===typeof this._parts.protocol&&this._parts.port===r.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},a.normalizePath=function(e){var t,n=this._parts.path;if(!n)return this;if(this._parts.urn)return this._parts.path=r.recodeUrnPath(this._parts.path),this.build(!e),this;if("/"===this._parts.path)return this;n=r.recodePath(n);var i,o,s="";"/"!==n.charAt(0)&&(t=!0,n="/"+n),"/.."!==n.slice(-3)&&"/."!==n.slice(-2)||(n+="/"),n=n.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),t&&(s=n.substring(1).match(/^(\.\.\/)+/)||"",s&&(s=s[0]));while(1){if(i=n.search(/\/\.\.(\/|$)/),-1===i)break;0!==i?(o=n.substring(0,i).lastIndexOf("/"),-1===o&&(o=i),n=n.substring(0,o)+n.substring(i+3)):n=n.substring(3)}return t&&this.is("relative")&&(n=s+n.substring(1)),this._parts.path=n,this.build(!e),this},a.normalizePathname=a.normalizePath,a.normalizeQuery=function(e){return"string"===typeof this._parts.query&&(this._parts.query.length?this.query(r.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},a.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},a.normalizeSearch=a.normalizeQuery,a.normalizeHash=a.normalizeFragment,a.iso8859=function(){var e=r.encode,t=r.decode;r.encode=escape,r.decode=decodeURIComponent;try{this.normalize()}finally{r.encode=e,r.decode=t}return this},a.unicode=function(){var e=r.encode,t=r.decode;r.encode=g,r.decode=unescape;try{this.normalize()}finally{r.encode=e,r.decode=t}return this},a.readable=function(){var t=this.clone();t.username("").password("").normalize();var n="";if(t._parts.protocol&&(n+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(n+=e.toUnicode(t._parts.hostname),t._parts.port&&(n+=":"+t._parts.port)):n+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(n+="/"),n+=t.path(!0),t._parts.query){for(var i="",o=0,s=t._parts.query.split("&"),a=s.length;o<a;o++){var c=(s[o]||"").split("=");i+="&"+r.decodeQuery(c[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==c[1]&&(i+="="+r.decodeQuery(c[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}n+="?"+i.substring(1)}return n+=r.decodeQuery(t.hash(),!0),n},a.absoluteTo=function(e){var t,n,i,o=this.clone(),s=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e instanceof r||(e=new r(e)),o._parts.protocol)return o;if(o._parts.protocol=e._parts.protocol,this._parts.hostname)return o;for(n=0;i=s[n];n++)o._parts[i]=e._parts[i];return o._parts.path?(".."===o._parts.path.substring(-2)&&(o._parts.path+="/"),"/"!==o.path().charAt(0)&&(t=e.directory(),t=t||(0===e.path().indexOf("/")?"/":""),o._parts.path=(t?t+"/":"")+o._parts.path,o.normalizePath())):(o._parts.path=e._parts.path,o._parts.query||(o._parts.query=e._parts.query)),o.build(),o},a.relativeTo=function(e){var t,n,i,o,s,a=this.clone().normalize();if(a._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e=new r(e).normalize(),t=a._parts,n=e._parts,o=a.path(),s=e.path(),"/"!==o.charAt(0))throw new Error("URI is already relative");if("/"!==s.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(t.protocol===n.protocol&&(t.protocol=null),t.username!==n.username||t.password!==n.password)return a.build();if(null!==t.protocol||null!==t.username||null!==t.password)return a.build();if(t.hostname!==n.hostname||t.port!==n.port)return a.build();if(t.hostname=null,t.port=null,o===s)return t.path="",a.build();if(i=r.commonPath(o,s),!i)return a.build();var c=n.path.substring(i.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return t.path=c+t.path.substring(i.length)||"./",a.build()},a.equals=function(e){var t,n,i,o=this.clone(),s=new r(e),a={},l={},u={};if(o.normalize(),s.normalize(),o.toString()===s.toString())return!0;if(t=o.query(),n=s.query(),o.query(""),s.query(""),o.toString()!==s.toString())return!1;if(t.length!==n.length)return!1;for(i in a=r.parseQuery(t,this._parts.escapeQuerySpace),l=r.parseQuery(n,this._parts.escapeQuerySpace),a)if(c.call(a,i)){if(h(a[i])){if(!p(a[i],l[i]))return!1}else if(a[i]!==l[i])return!1;u[i]=!0}for(i in l)if(c.call(l,i)&&!u[i])return!1;return!0},a.preventInvalidHostname=function(e){return this._parts.preventInvalidHostname=!!e,this},a.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},a.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},r}))}));function ln(e,t){let n;return"undefined"!==typeof document&&(n=document),ln._implementation(e,t,n)}ln._implementation=function(e,t,n){if(!C(e))throw new x("relative uri is required.");if(!C(t)){if("undefined"===typeof n)return e;t=R(n.baseURI,n.location.href)}const i=new cn(e);return""!==i.scheme()?i.toString():i.absoluteTo(t).toString()};var un=ln;n(2801);function hn(e){return 0!==e.length&&"/"===e[e.length-1]||(e=`${e}/`),e}var dn=hn;function fn(e,t){if(null===e||"object"!==typeof e)return e;t=R(t,!1);const n=new e.constructor;for(const i in e)if(e.hasOwnProperty(i)){let o=e[i];t&&(o=fn(o,t)),n[i]=o}return n}var pn=fn;function mn(e,t,n){n=R(n,!1);const i={},o=C(e),r=C(t);let s,a,c;if(o)for(s in e)e.hasOwnProperty(s)&&(a=e[s],r&&n&&"object"===typeof a&&t.hasOwnProperty(s)?(c=t[s],i[s]="object"===typeof c?mn(a,c,n):a):i[s]=a);if(r)for(s in t)t.hasOwnProperty(s)&&!i.hasOwnProperty(s)&&(c=t[s],i[s]=c);return i}var _n=mn;function gn(){let e,t;const n=new Promise((function(n,i){e=n,t=i}));return{resolve:e,reject:t,promise:n}}var yn=gn;function vn(e,t){if(!C(e))throw new x("uri is required.");let n="";const i=e.lastIndexOf("/");return-1!==i&&(n=e.substring(0,i+1)),t?(e=new cn(e),0!==e.query().length&&(n+=`?${e.query()}`),0!==e.fragment().length&&(n+=`#${e.fragment()}`),n):n}var bn=vn;function An(e){if(!C(e))throw new x("uri is required.");const t=new cn(e);t.normalize();let n=t.path(),i=n.lastIndexOf("/");return-1!==i&&(n=n.substr(i+1)),i=n.lastIndexOf("."),n=-1===i?"":n.substr(i+1),n}var wn=An;const Tn={};function Cn(e,t,n){C(t)||(t=e.width),C(n)||(n=e.height);let i=Tn[t];C(i)||(i={},Tn[t]=i);let o=i[n];if(!C(o)){const e=document.createElement("canvas");e.width=t,e.height=n,o=e.getContext("2d"),o.globalCompositeOperation="copy",i[n]=o}return o.drawImage(e,0,0,t,n),o.getImageData(0,0,t,n).data}var En=Cn;const xn=/^blob:/i;function Sn(e){return D.typeOf.string("uri",e),xn.test(e)}var In=Sn;let On;function Dn(e){C(On)||(On=document.createElement("a")),On.href=window.location.href;const t=On.host,n=On.protocol;return On.href=e,On.href=On.href,n!==On.protocol||t!==On.host}var Pn=Dn;const Rn=/^data:/i;function Ln(e){return D.typeOf.string("uri",e),Rn.test(e)}var Mn=Ln;function Bn(e){const t=yn(),n=document.createElement("script");n.async=!0,n.src=e;const i=document.getElementsByTagName("head")[0];return n.onload=function(){n.onload=void 0,i.removeChild(n),t.resolve()},n.onerror=function(e){t.reject(e)},i.appendChild(n),t.promise}var Nn=Bn;function Fn(e){if(!C(e))throw new x("obj is required.");let t="";for(const n in e)if(e.hasOwnProperty(n)){const i=e[n],o=`${encodeURIComponent(n)}=`;if(Array.isArray(i))for(let e=0,n=i.length;e<n;++e)t+=`${o+encodeURIComponent(i[e])}&`;else t+=`${o+encodeURIComponent(i)}&`}return t=t.slice(0,-1),t}var zn=Fn;function kn(e){if(!C(e))throw new x("queryString is required.");const t={};if(""===e)return t;const n=e.replace(/\+/g,"%20").split(/[&;]/);for(let i=0,o=n.length;i<o;++i){const e=n[i].split("="),o=decodeURIComponent(e[0]);let r=e[1];r=C(r)?decodeURIComponent(r):"";const s=t[o];"string"===typeof s?t[o]=[s,r]:Array.isArray(s)?s.push(r):t[o]=r}return t}var Un=kn;const Vn={UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5};var Hn=Object.freeze(Vn);const Gn={TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3};var Wn=Object.freeze(Gn);function qn(e){e=R(e,R.EMPTY_OBJECT);const t=R(e.throttleByServer,!1),n=R(e.throttle,!1);this.url=e.url,this.requestFunction=e.requestFunction,this.cancelFunction=e.cancelFunction,this.priorityFunction=e.priorityFunction,this.priority=R(e.priority,0),this.throttle=n,this.throttleByServer=t,this.type=R(e.type,Wn.OTHER),this.serverKey=void 0,this.state=Hn.UNISSUED,this.deferred=void 0,this.cancelled=!1}qn.prototype.cancel=function(){this.cancelled=!0},qn.prototype.clone=function(e){return C(e)?(e.url=this.url,e.requestFunction=this.requestFunction,e.cancelFunction=this.cancelFunction,e.priorityFunction=this.priorityFunction,e.priority=this.priority,e.throttle=this.throttle,e.throttleByServer=this.throttleByServer,e.type=this.type,e.serverKey=this.serverKey,e.state=this.RequestState.UNISSUED,e.deferred=void 0,e.cancelled=!1,e):new qn(this)};var jn=qn;function Yn(e){const t={};if(!e)return t;const n=e.split("\r\n");for(let i=0;i<n.length;++i){const e=n[i],o=e.indexOf(": ");if(o>0){const n=e.substring(0,o),i=e.substring(o+2);t[n]=i}}return t}var Kn=Yn;function Xn(e,t,n){this.statusCode=e,this.response=t,this.responseHeaders=n,"string"===typeof this.responseHeaders&&(this.responseHeaders=Kn(this.responseHeaders))}Xn.prototype.toString=function(){let e="Request has failed.";return C(this.statusCode)&&(e+=` Status Code: ${this.statusCode}`),e};var Qn=Xn;function Jn(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}function Zn(e,t){return t-e}Object.defineProperties(Jn.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}}),Jn.prototype.addEventListener=function(e,t){D.typeOf.func("listener",e),this._listeners.push(e),this._scopes.push(t);const n=this;return function(){n.removeEventListener(e,t)}},Jn.prototype.removeEventListener=function(e,t){D.typeOf.func("listener",e);const n=this._listeners,i=this._scopes;let o=-1;for(let r=0;r<n.length;r++)if(n[r]===e&&i[r]===t){o=r;break}return-1!==o&&(this._insideRaiseEvent?(this._toRemove.push(o),n[o]=void 0,i[o]=void 0):(n.splice(o,1),i.splice(o,1)),!0)},Jn.prototype.raiseEvent=function(){let e;this._insideRaiseEvent=!0;const t=this._listeners,n=this._scopes;let i=t.length;for(e=0;e<i;e++){const i=t[e];C(i)&&t[e].apply(n[e],arguments)}const o=this._toRemove;if(i=o.length,i>0){for(o.sort(Zn),e=0;e<i;e++){const i=o[e];t.splice(i,1),n.splice(i,1)}o.length=0}this._insideRaiseEvent=!1};var $n=Jn;function ei(e){D.typeOf.object("options",e),D.defined("options.comparator",e.comparator),this._comparator=e.comparator,this._array=[],this._length=0,this._maximumLength=void 0}function ti(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}Object.defineProperties(ei.prototype,{length:{get:function(){return this._length}},internalArray:{get:function(){return this._array}},maximumLength:{get:function(){return this._maximumLength},set:function(e){D.typeOf.number.greaterThanOrEquals("maximumLength",e,0);const t=this._length;if(e<t){const n=this._array;for(let i=e;i<t;++i)n[i]=void 0;this._length=e,n.length=e}this._maximumLength=e}},comparator:{get:function(){return this._comparator}}}),ei.prototype.reserve=function(e){e=R(e,this._length),this._array.length=e},ei.prototype.heapify=function(e){e=R(e,0);const t=this._length,n=this._comparator,i=this._array;let o=-1,r=!0;while(r){const s=2*(e+1),a=s-1;o=a<t&&n(i[a],i[e])<0?a:e,s<t&&n(i[s],i[o])<0&&(o=s),o!==e?(ti(i,o,e),e=o):r=!1}},ei.prototype.resort=function(){const e=this._length;for(let t=Math.ceil(e/2);t>=0;--t)this.heapify(t)},ei.prototype.insert=function(e){D.defined("element",e);const t=this._array,n=this._comparator,i=this._maximumLength;let o,r=this._length++;r<t.length?t[r]=e:t.push(e);while(0!==r){const e=Math.floor((r-1)/2);if(!(n(t[r],t[e])<0))break;ti(t,r,e),r=e}return C(i)&&this._length>i&&(o=t[i],this._length=i),o},ei.prototype.pop=function(e){if(e=R(e,0),0===this._length)return;D.typeOf.number.lessThan("index",e,this._length);const t=this._array,n=t[e];return ti(t,e,--this._length),this.heapify(e),t[this._length]=void 0,n};var ni=ei;function ii(e,t){return e.priority-t.priority}const oi={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0,lastNumberOfActiveRequests:0};let ri=20;const si=new ni({comparator:ii});si.maximumLength=ri,si.reserve(ri);const ai=[];let ci={};const li="undefined"!==typeof document?new cn(document.location.href):new cn,ui=new $n;function hi(){}function di(e){C(e.priorityFunction)&&(e.priority=e.priorityFunction())}function fi(e){return e.state===Hn.UNISSUED&&(e.state=Hn.ISSUED,e.deferred=yn()),e.deferred.promise}function pi(e){return function(t){if(e.state===Hn.CANCELLED)return;const n=e.deferred;--oi.numberOfActiveRequests,--ci[e.serverKey],ui.raiseEvent(),e.state=Hn.RECEIVED,e.deferred=void 0,n.resolve(t)}}function mi(e){return function(t){e.state!==Hn.CANCELLED&&(++oi.numberOfFailedRequests,--oi.numberOfActiveRequests,--ci[e.serverKey],ui.raiseEvent(t),e.state=Hn.FAILED,e.deferred.reject(t))}}function _i(e){const t=fi(e);return e.state=Hn.ACTIVE,ai.push(e),++oi.numberOfActiveRequests,++oi.numberOfActiveRequestsEver,++ci[e.serverKey],e.requestFunction().then(pi(e)).catch(mi(e)),t}function gi(e){const t=e.state===Hn.ACTIVE;if(e.state=Hn.CANCELLED,++oi.numberOfCancelledRequests,C(e.deferred)){const t=e.deferred;e.deferred=void 0,t.reject()}t&&(--oi.numberOfActiveRequests,--ci[e.serverKey],++oi.numberOfCancelledActiveRequests),C(e.cancelFunction)&&e.cancelFunction()}function yi(){hi.debugShowStatistics&&(0===oi.numberOfActiveRequests&&oi.lastNumberOfActiveRequests>0&&(oi.numberOfAttemptedRequests>0&&(console.log(`Number of attempted requests: ${oi.numberOfAttemptedRequests}`),oi.numberOfAttemptedRequests=0),oi.numberOfCancelledRequests>0&&(console.log(`Number of cancelled requests: ${oi.numberOfCancelledRequests}`),oi.numberOfCancelledRequests=0),oi.numberOfCancelledActiveRequests>0&&(console.log(`Number of cancelled active requests: ${oi.numberOfCancelledActiveRequests}`),oi.numberOfCancelledActiveRequests=0),oi.numberOfFailedRequests>0&&(console.log(`Number of failed requests: ${oi.numberOfFailedRequests}`),oi.numberOfFailedRequests=0)),oi.lastNumberOfActiveRequests=oi.numberOfActiveRequests)}hi.maximumRequests=50,hi.maximumRequestsPerServer=6,hi.requestsByServer={"api.cesium.com:443":18,"assets.cesium.com:443":18},hi.throttleRequests=!0,hi.debugShowStatistics=!1,hi.requestCompletedEvent=ui,Object.defineProperties(hi,{statistics:{get:function(){return oi}},priorityHeapLength:{get:function(){return ri},set:function(e){if(e<ri)while(si.length>e){const e=si.pop();gi(e)}ri=e,si.maximumLength=e,si.reserve(e)}}}),hi.serverHasOpenSlots=function(e,t){t=R(t,1);const n=R(hi.requestsByServer[e],hi.maximumRequestsPerServer),i=ci[e]+t<=n;return i},hi.heapHasOpenSlots=function(e){const t=si.length+e<=ri;return t},hi.update=function(){let e,t,n=0;const i=ai.length;for(e=0;e<i;++e)t=ai[e],t.cancelled&&gi(t),t.state===Hn.ACTIVE?n>0&&(ai[e-n]=t):++n;ai.length-=n;const o=si.internalArray,r=si.length;for(e=0;e<r;++e)di(o[e]);si.resort();const s=Math.max(hi.maximumRequests-ai.length,0);let a=0;while(a<s&&si.length>0)t=si.pop(),t.cancelled?gi(t):!t.throttleByServer||hi.serverHasOpenSlots(t.serverKey)?(_i(t),++a):gi(t);yi()},hi.getServerKey=function(e){D.typeOf.string("url",e);let t=new cn(e);""===t.scheme()&&(t=new cn(e).absoluteTo(li),t.normalize());let n=t.authority();/:/.test(n)||(n=`${n}:${"https"===t.scheme()?"443":"80"}`);const i=ci[n];return C(i)||(ci[n]=0),n},hi.request=function(e){if(D.typeOf.object("request",e),D.typeOf.string("request.url",e.url),D.typeOf.func("request.requestFunction",e.requestFunction),Mn(e.url)||In(e.url))return ui.raiseEvent(),e.state=Hn.RECEIVED,e.requestFunction();if(++oi.numberOfAttemptedRequests,C(e.serverKey)||(e.serverKey=hi.getServerKey(e.url)),hi.throttleRequests&&e.throttleByServer&&!hi.serverHasOpenSlots(e.serverKey))return;if(!hi.throttleRequests||!e.throttle)return _i(e);if(ai.length>=hi.maximumRequests)return;di(e);const t=si.insert(e);if(C(t)){if(t===e)return;gi(t)}return fi(e)},hi.clearForSpecs=function(){while(si.length>0){const e=si.pop();gi(e)}const e=ai.length;for(let t=0;t<e;++t)gi(ai[t]);ai.length=0,ci={},oi.numberOfAttemptedRequests=0,oi.numberOfActiveRequests=0,oi.numberOfCancelledRequests=0,oi.numberOfCancelledActiveRequests=0,oi.numberOfFailedRequests=0,oi.numberOfActiveRequestsEver=0,oi.lastNumberOfActiveRequests=0},hi.numberOfActiveRequestsByServer=function(e){return ci[e]},hi.requestHeap=si;var vi=hi;const bi={};let Ai={};function wi(e){const t=new cn(e);t.normalize();let n=t.authority();if(0!==n.length){if(t.authority(n),-1!==n.indexOf("@")){const e=n.split("@");n=e[1]}if(-1===n.indexOf(":")){let e=t.scheme();if(0===e.length&&(e=window.location.protocol,e=e.substring(0,e.length-1)),"http"===e)n+=":80";else{if("https"!==e)return;n+=":443"}}return n}}bi.add=function(e,t){if(!C(e))throw new x("host is required.");if(!C(t)||t<=0)throw new x("port is required to be greater than 0.");const n=`${e.toLowerCase()}:${t}`;C(Ai[n])||(Ai[n]=!0)},bi.remove=function(e,t){if(!C(e))throw new x("host is required.");if(!C(t)||t<=0)throw new x("port is required to be greater than 0.");const n=`${e.toLowerCase()}:${t}`;C(Ai[n])&&delete Ai[n]},bi.contains=function(e){if(!C(e))throw new x("url is required.");const t=wi(e);return!(!C(t)||!C(Ai[t]))},bi.clear=function(){Ai={}};var Ti=bi;const Ci=function(){try{const e=new XMLHttpRequest;return e.open("GET","#",!0),e.responseType="blob","blob"===e.responseType}catch(e){return!1}}();function Ei(e,t,n,i){const o=e.query();if(0===o.length)return{};let r;if(-1===o.indexOf("=")){const e={};e[o]=void 0,r=e}else r=Un(o);t._queryParameters=n?Oi(r,t._queryParameters,i):r,e.search("")}function xi(e,t){const n=t._queryParameters,i=Object.keys(n);1!==i.length||C(n[i[0]])?e.search(zn(n)):e.search(i[0])}function Si(e,t){return C(e)?C(e.clone)?e.clone():pn(e):t}function Ii(e){if(e.state===Hn.ISSUED||e.state===Hn.ACTIVE)throw new Je("The Resource is already being fetched.");e.state=Hn.UNISSUED,e.deferred=void 0}function Oi(e,t,n){if(!n)return _n(e,t);const i=pn(e,!0);for(const o in t)if(t.hasOwnProperty(o)){let e=i[o];const n=t[o];C(e)?(Array.isArray(e)||(e=i[o]=[e]),i[o]=e.concat(n)):i[o]=Array.isArray(n)?n.slice():n}return i}function Di(e){e=R(e,R.EMPTY_OBJECT),"string"===typeof e&&(e={url:e}),D.typeOf.string("options.url",e.url),this._url=void 0,this._templateValues=Si(e.templateValues,{}),this._queryParameters=Si(e.queryParameters,{}),this.headers=Si(e.headers,{}),this.request=R(e.request,new jn),this.proxy=e.proxy,this.retryCallback=e.retryCallback,this.retryAttempts=R(e.retryAttempts,0),this._retryCount=0;const t=new cn(e.url);Ei(t,this,!0,!0),t.fragment(""),this._url=t.toString()}let Pi;function Ri(e){const t=e.resource,n=e.flipY,i=e.skipColorSpaceConversion,o=e.preferImageBitmap,r=t.request;r.url=t.url,r.requestFunction=function(){let e=!1;t.isDataUri||t.isBlobUri||(e=t.isCrossOriginUrl);const s=yn();return Di._Implementations.createImage(r,e,s,n,i,o),s.promise};const s=vi.request(r);if(C(s))return s.catch((function(e){return r.state!==Hn.FAILED?Promise.reject(e):t.retryOnError(e).then((function(s){return s?(r.state=Hn.UNISSUED,r.deferred=void 0,Ri({resource:t,flipY:n,skipColorSpaceConversion:i,preferImageBitmap:o})):Promise.reject(e)}))}))}function Li(e,t,n){const i={};i[t]=n,e.setQueryParameters(i);const o=e.request;o.url=e.url,o.requestFunction=function(){const t=yn();return window[n]=function(e){t.resolve(e);try{delete window[n]}catch(i){window[n]=void 0}},Di._Implementations.loadAndExecuteScript(e.url,n,t),t.promise};const r=vi.request(o);if(C(r))return r.catch((function(i){return o.state!==Hn.FAILED?Promise.reject(i):e.retryOnError(i).then((function(r){return r?(o.state=Hn.UNISSUED,o.deferred=void 0,Li(e,t,n)):Promise.reject(i)}))}))}Di.createIfNeeded=function(e){return e instanceof Di?e.getDerivedResource({request:e.request}):"string"!==typeof e?e:new Di({url:e})},Di.supportsImageBitmapOptions=function(){if(C(Pi))return Pi;if("function"!==typeof createImageBitmap)return Pi=Promise.resolve(!1),Pi;const e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAABGdBTUEAAE4g3rEiDgAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAADElEQVQI12Ng6GAAAAEUAIngE3ZiAAAAAElFTkSuQmCC";return Pi=Di.fetchBlob({url:e}).then((function(e){const t={imageOrientation:"flipY",premultiplyAlpha:"none",colorSpaceConversion:"none"};return Promise.all([createImageBitmap(e,t),createImageBitmap(e)])})).then((function(e){const t=En(e[0]),n=En(e[1]);return t[1]!==n[1]})).catch((function(){return!1})),Pi},Object.defineProperties(Di,{isBlobSupported:{get:function(){return Ci}}}),Object.defineProperties(Di.prototype,{queryParameters:{get:function(){return this._queryParameters}},templateValues:{get:function(){return this._templateValues}},url:{get:function(){return this.getUrlComponent(!0,!0)},set:function(e){const t=new cn(e);Ei(t,this,!1),t.fragment(""),this._url=t.toString()}},extension:{get:function(){return wn(this._url)}},isDataUri:{get:function(){return Mn(this._url)}},isBlobUri:{get:function(){return In(this._url)}},isCrossOriginUrl:{get:function(){return Pn(this._url)}},hasHeaders:{get:function(){return Object.keys(this.headers).length>0}}}),Di.prototype.toString=function(){return this.getUrlComponent(!0,!0)},Di.prototype.getUrlComponent=function(e,t){if(this.isDataUri)return this._url;const n=new cn(this._url);e&&xi(n,this);let i=n.toString().replace(/%7B/g,"{").replace(/%7D/g,"}");const o=this._templateValues;return i=i.replace(/{(.*?)}/g,(function(e,t){const n=o[t];return C(n)?encodeURIComponent(n):e})),t&&C(this.proxy)&&(i=this.proxy.getURL(i)),i},Di.prototype.setQueryParameters=function(e,t){this._queryParameters=t?Oi(this._queryParameters,e,!1):Oi(e,this._queryParameters,!1)},Di.prototype.appendQueryParameters=function(e){this._queryParameters=Oi(e,this._queryParameters,!0)},Di.prototype.setTemplateValues=function(e,t){this._templateValues=t?_n(this._templateValues,e):_n(e,this._templateValues)},Di.prototype.getDerivedResource=function(e){const t=this.clone();if(t._retryCount=0,C(e.url)){const n=new cn(e.url),i=R(e.preserveQueryParameters,!1);Ei(n,t,!0,i),n.fragment(""),""!==n.scheme()?t._url=n.toString():t._url=n.absoluteTo(new cn(un(this._url))).toString()}return C(e.queryParameters)&&(t._queryParameters=_n(e.queryParameters,t._queryParameters)),C(e.templateValues)&&(t._templateValues=_n(e.templateValues,t.templateValues)),C(e.headers)&&(t.headers=_n(e.headers,t.headers)),C(e.proxy)&&(t.proxy=e.proxy),C(e.request)&&(t.request=e.request),C(e.retryCallback)&&(t.retryCallback=e.retryCallback),C(e.retryAttempts)&&(t.retryAttempts=e.retryAttempts),t},Di.prototype.retryOnError=function(e){const t=this.retryCallback;if("function"!==typeof t||this._retryCount>=this.retryAttempts)return Promise.resolve(!1);const n=this;return Promise.resolve(t(this,e)).then((function(e){return++n._retryCount,e}))},Di.prototype.clone=function(e){return C(e)||(e=new Di({url:this._url})),e._url=this._url,e._queryParameters=pn(this._queryParameters),e._templateValues=pn(this._templateValues),e.headers=pn(this.headers),e.proxy=this.proxy,e.retryCallback=this.retryCallback,e.retryAttempts=this.retryAttempts,e._retryCount=0,e.request=this.request.clone(),e},Di.prototype.getBaseUri=function(e){return bn(this.getUrlComponent(e),e)},Di.prototype.appendForwardSlash=function(){this._url=dn(this._url)},Di.prototype.fetchArrayBuffer=function(){return this.fetch({responseType:"arraybuffer"})},Di.fetchArrayBuffer=function(e){const t=new Di(e);return t.fetchArrayBuffer()},Di.prototype.fetchBlob=function(){return this.fetch({responseType:"blob"})},Di.fetchBlob=function(e){const t=new Di(e);return t.fetchBlob()},Di.prototype.fetchImage=function(e){e=R(e,R.EMPTY_OBJECT);const t=R(e.preferImageBitmap,!1),n=R(e.preferBlob,!1),i=R(e.flipY,!1),o=R(e.skipColorSpaceConversion,!1);if(Ii(this.request),!Ci||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!n)return Ri({resource:this,flipY:i,skipColorSpaceConversion:o,preferImageBitmap:t});const r=this.fetchBlob();if(!C(r))return;let s,a,c,l;return Di.supportsImageBitmapOptions().then((function(e){return s=e,a=s&&t,r})).then((function(e){if(!C(e))return;if(l=e,a)return Di.createImageBitmapFromBlob(e,{flipY:i,premultiplyAlpha:!1,skipColorSpaceConversion:o});const t=window.URL.createObjectURL(e);return c=new Di({url:t}),Ri({resource:c,flipY:i,skipColorSpaceConversion:o,preferImageBitmap:!1})})).then((function(e){if(C(e))return e.blob=l,a||window.URL.revokeObjectURL(c.url),e})).catch((function(e){return C(c)&&window.URL.revokeObjectURL(c.url),e.blob=l,Promise.reject(e)}))},Di.fetchImage=function(e){const t=new Di(e);return t.fetchImage({flipY:e.flipY,skipColorSpaceConversion:e.skipColorSpaceConversion,preferBlob:e.preferBlob,preferImageBitmap:e.preferImageBitmap})},Di.prototype.fetchText=function(){return this.fetch({responseType:"text"})},Di.fetchText=function(e){const t=new Di(e);return t.fetchText()},Di.prototype.fetchJson=function(){const e=this.fetch({responseType:"text",headers:{Accept:"application/json,*/*;q=0.01"}});if(C(e))return e.then((function(e){if(C(e))return JSON.parse(e)}))},Di.fetchJson=function(e){const t=new Di(e);return t.fetchJson()},Di.prototype.fetchXML=function(){return this.fetch({responseType:"document",overrideMimeType:"text/xml"})},Di.fetchXML=function(e){const t=new Di(e);return t.fetchXML()},Di.prototype.fetchJsonp=function(e){let t;e=R(e,"callback"),Ii(this.request);do{t=`loadJsonp${z.nextRandomNumber().toString().substring(2,8)}`}while(C(window[t]));return Li(this,e,t)},Di.fetchJsonp=function(e){const t=new Di(e);return t.fetchJsonp(e.callbackParameterName)},Di.prototype._makeRequest=function(e){const t=this;Ii(t.request);const n=t.request;n.url=t.url,n.requestFunction=function(){const i=e.responseType,o=_n(e.headers,t.headers),r=e.overrideMimeType,s=e.method,a=e.data,c=yn(),l=Di._Implementations.loadWithXhr(t.url,i,s,a,o,c,r);return C(l)&&C(l.abort)&&(n.cancelFunction=function(){l.abort()}),c.promise};const i=vi.request(n);if(C(i))return i.then((function(e){return n.cancelFunction=void 0,e})).catch((function(i){return n.cancelFunction=void 0,n.state!==Hn.FAILED?Promise.reject(i):t.retryOnError(i).then((function(o){return o?(n.state=Hn.UNISSUED,n.deferred=void 0,t.fetch(e)):Promise.reject(i)}))}))};const Mi=/^data:(.*?)(;base64)?,(.*)$/;function Bi(e,t){const n=decodeURIComponent(t);return e?atob(n):n}function Ni(e,t){const n=Bi(e,t),i=new ArrayBuffer(n.length),o=new Uint8Array(i);for(let r=0;r<n.length;r++)o[r]=n.charCodeAt(r);return i}function Fi(e,t){t=R(t,"");const n=e[1],i=!!e[2],o=e[3];let r,s;switch(t){case"":case"text":return Bi(i,o);case"arraybuffer":return Ni(i,o);case"blob":return r=Ni(i,o),new Blob([r],{type:n});case"document":return s=new DOMParser,s.parseFromString(Bi(i,o),n);case"json":return JSON.parse(Bi(i,o));default:throw new x(`Unhandled responseType: ${t}`)}}function zi(e,t){switch(t){case"text":return e.toString("utf8");case"json":return JSON.parse(e.toString("utf8"));default:return new Uint8Array(e).buffer}}function ki(e,t,n,i,o,r,s){const a=require("url").parse(e),c="https:"===a.protocol?require("https"):require("http"),l=require("zlib"),u={protocol:a.protocol,hostname:a.hostname,port:a.port,path:a.path,query:a.query,method:n,headers:o};c.request(u).on("response",(function(e){if(e.statusCode<200||e.statusCode>=300)return void r.reject(new Qn(e.statusCode,e,e.headers));const n=[];e.on("data",(function(e){n.push(e)})),e.on("end",(function(){const i=Buffer.concat(n);"gzip"===e.headers["content-encoding"]?l.gunzip(i,(function(e,n){e?r.reject(new Je("Error decompressing response.")):r.resolve(zi(n,t))})):r.resolve(zi(i,t))}))})).on("error",(function(e){r.reject(new Qn)})).end()}Di.prototype.fetch=function(e){return e=Si(e,{}),e.method="GET",this._makeRequest(e)},Di.fetch=function(e){const t=new Di(e);return t.fetch({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Di.prototype.delete=function(e){return e=Si(e,{}),e.method="DELETE",this._makeRequest(e)},Di.delete=function(e){const t=new Di(e);return t.delete({responseType:e.responseType,overrideMimeType:e.overrideMimeType,data:e.data})},Di.prototype.head=function(e){return e=Si(e,{}),e.method="HEAD",this._makeRequest(e)},Di.head=function(e){const t=new Di(e);return t.head({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Di.prototype.options=function(e){return e=Si(e,{}),e.method="OPTIONS",this._makeRequest(e)},Di.options=function(e){const t=new Di(e);return t.options({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Di.prototype.post=function(e,t){return D.defined("data",e),t=Si(t,{}),t.method="POST",t.data=e,this._makeRequest(t)},Di.post=function(e){const t=new Di(e);return t.post(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Di.prototype.put=function(e,t){return D.defined("data",e),t=Si(t,{}),t.method="PUT",t.data=e,this._makeRequest(t)},Di.put=function(e){const t=new Di(e);return t.put(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Di.prototype.patch=function(e,t){return D.defined("data",e),t=Si(t,{}),t.method="PATCH",t.data=e,this._makeRequest(t)},Di.patch=function(e){const t=new Di(e);return t.patch(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Di._Implementations={},Di._Implementations.loadImageElement=function(e,t,n){const i=new Image;i.onload=function(){0===i.naturalWidth&&0===i.naturalHeight&&0===i.width&&0===i.height&&(i.width=300,i.height=150),n.resolve(i)},i.onerror=function(e){n.reject(e)},t&&(Ti.contains(e)?i.crossOrigin="use-credentials":i.crossOrigin=""),i.src=e},Di._Implementations.createImage=function(e,t,n,i,o,r){const s=e.url;Di.supportsImageBitmapOptions().then((function(a){if(!a||!r)return void Di._Implementations.loadImageElement(s,t,n);const c="blob",l="GET",u=yn(),h=Di._Implementations.loadWithXhr(s,c,l,void 0,void 0,u,void 0,void 0,void 0);return C(h)&&C(h.abort)&&(e.cancelFunction=function(){h.abort()}),u.promise.then((function(e){if(C(e))return Di.createImageBitmapFromBlob(e,{flipY:i,premultiplyAlpha:!1,skipColorSpaceConversion:o});n.reject(new Je(`Successfully retrieved ${s} but it contained no content.`))})).then((function(e){n.resolve(e)}))})).catch((function(e){n.reject(e)}))},Di.createImageBitmapFromBlob=function(e,t){return D.defined("options",t),D.typeOf.bool("options.flipY",t.flipY),D.typeOf.bool("options.premultiplyAlpha",t.premultiplyAlpha),D.typeOf.bool("options.skipColorSpaceConversion",t.skipColorSpaceConversion),createImageBitmap(e,{imageOrientation:t.flipY?"flipY":"none",premultiplyAlpha:t.premultiplyAlpha?"premultiply":"none",colorSpaceConversion:t.skipColorSpaceConversion?"none":"default"})};const Ui="undefined"===typeof XMLHttpRequest;Di._Implementations.loadWithXhr=function(e,t,n,i,o,r,s){const a=Mi.exec(e);if(null!==a)return void r.resolve(Fi(a,t));if(Ui)return void ki(e,t,n,i,o,r,s);const c=new XMLHttpRequest;if(Ti.contains(e)&&(c.withCredentials=!0),c.open(n,e,!0),C(s)&&C(c.overrideMimeType)&&c.overrideMimeType(s),C(o))for(const u in o)o.hasOwnProperty(u)&&c.setRequestHeader(u,o[u]);C(t)&&(c.responseType=t);let l=!1;return"string"===typeof e&&(l=0===e.indexOf("file://")||"undefined"!==typeof window&&"file://"===window.location.origin),c.onload=function(){if((c.status<200||c.status>=300)&&(!l||0!==c.status))return void r.reject(new Qn(c.status,c.response,c.getAllResponseHeaders()));const e=c.response,i=c.responseType;if("HEAD"===n||"OPTIONS"===n){const e=c.getAllResponseHeaders(),t=e.trim().split(/[\r\n]+/),n={};return t.forEach((function(e){const t=e.split(": "),i=t.shift();n[i]=t.join(": ")})),void r.resolve(n)}if(204===c.status)r.resolve();else if(!C(e)||C(t)&&i!==t)if("json"===t&&"string"===typeof e)try{r.resolve(JSON.parse(e))}catch(o){r.reject(o)}else(""===i||"document"===i)&&C(c.responseXML)&&c.responseXML.hasChildNodes()?r.resolve(c.responseXML):""!==i&&"text"!==i||!C(c.responseText)?r.reject(new Je("Invalid XMLHttpRequest response type.")):r.resolve(c.responseText);else r.resolve(e)},c.onerror=function(e){r.reject(new Qn)},c.send(i),c},Di._Implementations.loadAndExecuteScript=function(e,t,n){return Nn(e,t).catch((function(e){n.reject(e)}))},Di._DefaultImplementations={},Di._DefaultImplementations.createImage=Di._Implementations.createImage,Di._DefaultImplementations.loadWithXhr=Di._Implementations.loadWithXhr,Di._DefaultImplementations.loadAndExecuteScript=Di._Implementations.loadAndExecuteScript,Di.DEFAULT=Object.freeze(new Di({url:"undefined"===typeof document?"":document.location.href.split("?")[0]}));var Vi=Di;const Hi=/((?:.*\/)|^)Cesium\.js(?:\?|\#|$)/;function Gi(){const e=document.getElementsByTagName("script");for(let t=0,n=e.length;t<n;++t){const n=e[t].getAttribute("src"),i=Hi.exec(n);if(null!==i)return i[1]}}let Wi,qi,ji;function Yi(e){return"undefined"===typeof document?e:(C(Wi)||(Wi=document.createElement("a")),Wi.href=e,Wi.href=Wi.href,Wi.href)}function Ki(){if(C(qi))return qi;let e;if(e="undefined"!==typeof CESIUM_BASE_URL?CESIUM_BASE_URL:"object"===typeof define&&C(define.amd)&&!define.amd.toUrlUndefined&&C(require.toUrl)?un("..",Ji("Core/buildModuleUrl.js")):Gi(),!C(e))throw new x("Unable to determine Cesium base URL automatically, try defining a global variable called CESIUM_BASE_URL.");return qi=new Vi({url:Yi(e)}),qi.appendForwardSlash(),qi}function Xi(e){return Yi(require.toUrl(`../${e}`))}function Qi(e){const t=Ki().getDerivedResource({url:e});return t.url}function Ji(e){C(ji)||(ji="object"===typeof define&&C(define.amd)&&!define.amd.toUrlUndefined&&C(require.toUrl)?Xi:Qi);const t=ji(e);return t}Ji._cesiumScriptRegex=Hi,Ji._buildModuleUrlFromBaseUrl=Qi,Ji._clearBaseResource=function(){qi=void 0},Ji.setBaseUrl=function(e){qi=Vi.DEFAULT.getDerivedResource({url:e})},Ji.getCesiumBaseUrl=Ki;var Zi=Ji;function $i(e,t){this.x=R(e,0),this.y=R(t,0)}$i.fromElements=function(e,t,n){return C(n)?(n.x=e,n.y=t,n):new $i(e,t)},$i.clone=function(e,t){if(C(e))return C(t)?(t.x=e.x,t.y=e.y,t):new $i(e.x,e.y)},$i.fromCartesian3=$i.clone,$i.fromCartesian4=$i.clone,$i.packedLength=2,$i.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),t[n++]=e.x,t[n]=e.y,t},$i.unpack=function(e,t,n){return D.defined("array",e),t=R(t,0),C(n)||(n=new $i),n.x=e[t++],n.y=e[t],n},$i.packArray=function(e,t){D.defined("array",e);const n=e.length,i=2*n;if(C(t)){if(!Array.isArray(t)&&t.length!==i)throw new x("If result is a typed array, it must have exactly array.length * 2 elements");t.length!==i&&(t.length=i)}else t=new Array(i);for(let o=0;o<n;++o)$i.pack(e[o],t,2*o);return t},$i.unpackArray=function(e,t){if(D.defined("array",e),D.typeOf.number.greaterThanOrEquals("array.length",e.length,2),e.length%2!==0)throw new x("array length must be a multiple of 2.");const n=e.length;C(t)?t.length=n/2:t=new Array(n/2);for(let i=0;i<n;i+=2){const n=i/2;t[n]=$i.unpack(e,i,t[n])}return t},$i.fromArray=$i.unpack,$i.maximumComponent=function(e){return D.typeOf.object("cartesian",e),Math.max(e.x,e.y)},$i.minimumComponent=function(e){return D.typeOf.object("cartesian",e),Math.min(e.x,e.y)},$i.minimumByComponent=function(e,t,n){return D.typeOf.object("first",e),D.typeOf.object("second",t),D.typeOf.object("result",n),n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n},$i.maximumByComponent=function(e,t,n){return D.typeOf.object("first",e),D.typeOf.object("second",t),D.typeOf.object("result",n),n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n},$i.clamp=function(e,t,n,i){D.typeOf.object("value",e),D.typeOf.object("min",t),D.typeOf.object("max",n),D.typeOf.object("result",i);const o=z.clamp(e.x,t.x,n.x),r=z.clamp(e.y,t.y,n.y);return i.x=o,i.y=r,i},$i.magnitudeSquared=function(e){return D.typeOf.object("cartesian",e),e.x*e.x+e.y*e.y},$i.magnitude=function(e){return Math.sqrt($i.magnitudeSquared(e))};const eo=new $i;$i.distance=function(e,t){return D.typeOf.object("left",e),D.typeOf.object("right",t),$i.subtract(e,t,eo),$i.magnitude(eo)},$i.distanceSquared=function(e,t){return D.typeOf.object("left",e),D.typeOf.object("right",t),$i.subtract(e,t,eo),$i.magnitudeSquared(eo)},$i.normalize=function(e,t){D.typeOf.object("cartesian",e),D.typeOf.object("result",t);const n=$i.magnitude(e);if(t.x=e.x/n,t.y=e.y/n,isNaN(t.x)||isNaN(t.y))throw new x("normalized result is not a number");return t},$i.dot=function(e,t){return D.typeOf.object("left",e),D.typeOf.object("right",t),e.x*t.x+e.y*t.y},$i.cross=function(e,t){return D.typeOf.object("left",e),D.typeOf.object("right",t),e.x*t.y-e.y*t.x},$i.multiplyComponents=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=e.x*t.x,n.y=e.y*t.y,n},$i.divideComponents=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=e.x/t.x,n.y=e.y/t.y,n},$i.add=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=e.x+t.x,n.y=e.y+t.y,n},$i.subtract=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=e.x-t.x,n.y=e.y-t.y,n},$i.multiplyByScalar=function(e,t,n){return D.typeOf.object("cartesian",e),D.typeOf.number("scalar",t),D.typeOf.object("result",n),n.x=e.x*t,n.y=e.y*t,n},$i.divideByScalar=function(e,t,n){return D.typeOf.object("cartesian",e),D.typeOf.number("scalar",t),D.typeOf.object("result",n),n.x=e.x/t,n.y=e.y/t,n},$i.negate=function(e,t){return D.typeOf.object("cartesian",e),D.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t},$i.abs=function(e,t){return D.typeOf.object("cartesian",e),D.typeOf.object("result",t),t.x=Math.abs(e.x),t.y=Math.abs(e.y),t};const to=new $i;$i.lerp=function(e,t,n,i){return D.typeOf.object("start",e),D.typeOf.object("end",t),D.typeOf.number("t",n),D.typeOf.object("result",i),$i.multiplyByScalar(t,n,to),i=$i.multiplyByScalar(e,1-n,i),$i.add(to,i,i)};const no=new $i,io=new $i;$i.angleBetween=function(e,t){return D.typeOf.object("left",e),D.typeOf.object("right",t),$i.normalize(e,no),$i.normalize(t,io),z.acosClamped($i.dot(no,io))};const oo=new $i;$i.mostOrthogonalAxis=function(e,t){D.typeOf.object("cartesian",e),D.typeOf.object("result",t);const n=$i.normalize(e,oo);return $i.abs(n,n),t=n.x<=n.y?$i.clone($i.UNIT_X,t):$i.clone($i.UNIT_Y,t),t},$i.equals=function(e,t){return e===t||C(e)&&C(t)&&e.x===t.x&&e.y===t.y},$i.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]},$i.equalsEpsilon=function(e,t,n,i){return e===t||C(e)&&C(t)&&z.equalsEpsilon(e.x,t.x,n,i)&&z.equalsEpsilon(e.y,t.y,n,i)},$i.ZERO=Object.freeze(new $i(0,0)),$i.ONE=Object.freeze(new $i(1,1)),$i.UNIT_X=Object.freeze(new $i(1,0)),$i.UNIT_Y=Object.freeze(new $i(0,1)),$i.prototype.clone=function(e){return $i.clone(this,e)},$i.prototype.equals=function(e){return $i.equals(this,e)},$i.prototype.equalsEpsilon=function(e,t,n){return $i.equalsEpsilon(this,e,t,n)},$i.prototype.toString=function(){return`(${this.x}, ${this.y})`};var ro=$i;function so(e){e=R(e,R.EMPTY_OBJECT),this._ellipsoid=R(e.ellipsoid,ge.WGS84),this._rectangle=R(e.rectangle,_t.MAX_VALUE),this._projection=new ve(this._ellipsoid),this._numberOfLevelZeroTilesX=R(e.numberOfLevelZeroTilesX,2),this._numberOfLevelZeroTilesY=R(e.numberOfLevelZeroTilesY,1)}Object.defineProperties(so.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),so.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},so.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},so.prototype.rectangleToNativeRectangle=function(e,t){D.defined("rectangle",e);const n=z.toDegrees(e.west),i=z.toDegrees(e.south),o=z.toDegrees(e.east),r=z.toDegrees(e.north);return C(t)?(t.west=n,t.south=i,t.east=o,t.north=r,t):new _t(n,i,o,r)},so.prototype.tileXYToNativeRectangle=function(e,t,n,i){const o=this.tileXYToRectangle(e,t,n,i);return o.west=z.toDegrees(o.west),o.south=z.toDegrees(o.south),o.east=z.toDegrees(o.east),o.north=z.toDegrees(o.north),o},so.prototype.tileXYToRectangle=function(e,t,n,i){const o=this._rectangle,r=this.getNumberOfXTilesAtLevel(n),s=this.getNumberOfYTilesAtLevel(n),a=o.width/r,c=e*a+o.west,l=(e+1)*a+o.west,u=o.height/s,h=o.north-t*u,d=o.north-(t+1)*u;return C(i)||(i=new _t(c,d,l,h)),i.west=c,i.south=d,i.east=l,i.north=h,i},so.prototype.positionToTileXY=function(e,t,n){const i=this._rectangle;if(!_t.contains(i,e))return;const o=this.getNumberOfXTilesAtLevel(t),r=this.getNumberOfYTilesAtLevel(t),s=i.width/o,a=i.height/r;let c=e.longitude;i.east<i.west&&(c+=z.TWO_PI);let l=(c-i.west)/s|0;l>=o&&(l=o-1);let u=(i.north-e.latitude)/a|0;return u>=r&&(u=r-1),C(n)?(n.x=l,n.y=u,n):new ro(l,u)};var ao=so;const co=new K,lo=new K,uo=new se,ho=new K,fo=new K,po=new nn,mo=new ao,_o=[new se,new se,new se,new se],go=new ro,yo={};function vo(e){se.fromRadians(e.east,e.north,0,_o[0]),se.fromRadians(e.west,e.north,0,_o[1]),se.fromRadians(e.east,e.south,0,_o[2]),se.fromRadians(e.west,e.south,0,_o[3]);let t=0,n=0,i=0,o=0;const r=yo._terrainHeightsMaxLevel;let s;for(s=0;s<=r;++s){let e=!1;for(let t=0;t<4;++t){const n=_o[t];if(mo.positionToTileXY(n,s,go),0===t)i=go.x,o=go.y;else if(i!==go.x||o!==go.y){e=!0;break}}if(e)break;t=i,n=o}if(0!==s)return{x:t,y:n,level:s>r?r:s-1}}yo.initialize=function(){let e=yo._initPromise;return C(e)||(e=Vi.fetchJson(Zi("Assets/approximateTerrainHeights.json")).then((function(e){yo._terrainHeights=e})),yo._initPromise=e),e},yo.getMinimumMaximumHeights=function(e,t){if(D.defined("rectangle",e),!C(yo._terrainHeights))throw new x("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");t=R(t,ge.WGS84);const n=vo(e);let i=yo._defaultMinTerrainHeight,o=yo._defaultMaxTerrainHeight;if(C(n)){const r=`${n.level}-${n.x}-${n.y}`,s=yo._terrainHeights[r];C(s)&&(i=s[0],o=s[1]),t.cartographicToCartesian(_t.northeast(e,uo),co),t.cartographicToCartesian(_t.southwest(e,uo),lo),K.midpoint(lo,co,ho);const a=t.scaleToGeodeticSurface(ho,fo);if(C(a)){const e=K.distance(ho,a);i=Math.min(i,-e)}else i=yo._defaultMinTerrainHeight}return i=Math.max(yo._defaultMinTerrainHeight,i),{minimumTerrainHeight:i,maximumTerrainHeight:o}},yo.getBoundingSphere=function(e,t){if(D.defined("rectangle",e),!C(yo._terrainHeights))throw new x("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");t=R(t,ge.WGS84);const n=vo(e);let i=yo._defaultMaxTerrainHeight;if(C(n)){const e=`${n.level}-${n.x}-${n.y}`,t=yo._terrainHeights[e];C(t)&&(i=t[1])}const o=nn.fromRectangle3D(e,t,0);return nn.fromRectangle3D(e,t,i,po),nn.union(o,po,o)},yo._terrainHeightsMaxLevel=6,yo._defaultMaxTerrainHeight=9e3,yo._defaultMinTerrainHeight=-1e5,yo._terrainHeights=void 0,yo._initPromise=void 0,Object.defineProperties(yo,{initialized:{get:function(){return C(yo._terrainHeights)}}});var bo=yo;
/*! @license DOMPurify 2.3.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.3.6/LICENSE */
function Ao(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var wo=Object.hasOwnProperty,To=Object.setPrototypeOf,Co=Object.isFrozen,Eo=Object.getPrototypeOf,xo=Object.getOwnPropertyDescriptor,So=Object.freeze,Io=Object.seal,Oo=Object.create,Do="undefined"!==typeof Reflect&&Reflect,Po=Do.apply,Ro=Do.construct;Po||(Po=function(e,t,n){return e.apply(t,n)}),So||(So=function(e){return e}),Io||(Io=function(e){return e}),Ro||(Ro=function(e,t){return new(Function.prototype.bind.apply(e,[null].concat(Ao(t))))});var Lo=Wo(Array.prototype.forEach),Mo=Wo(Array.prototype.pop),Bo=Wo(Array.prototype.push),No=Wo(String.prototype.toLowerCase),Fo=Wo(String.prototype.match),zo=Wo(String.prototype.replace),Uo=Wo(String.prototype.indexOf),Vo=Wo(String.prototype.trim),Ho=Wo(RegExp.prototype.test),Go=qo(TypeError);function Wo(e){return function(t){for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return Po(e,t,i)}}function qo(e){return function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ro(e,n)}}function jo(e,t){To&&To(e,null);var n=t.length;while(n--){var i=t[n];if("string"===typeof i){var o=No(i);o!==i&&(Co(t)||(t[n]=o),i=o)}e[i]=!0}return e}function Yo(e){var t=Oo(null),n=void 0;for(n in e)Po(wo,e,[n])&&(t[n]=e[n]);return t}function Ko(e,t){while(null!==e){var n=xo(e,t);if(n){if(n.get)return Wo(n.get);if("function"===typeof n.value)return Wo(n.value)}e=Eo(e)}function i(e){return console.warn("fallback value for",e),null}return i}var Xo=So(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Qo=So(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Jo=So(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Zo=So(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),$o=So(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),er=So(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),tr=So(["#text"]),nr=So(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),ir=So(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),or=So(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),rr=So(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),sr=Io(/\{\{[\s\S]*|[\s\S]*\}\}/gm),ar=Io(/<%[\s\S]*|[\s\S]*%>/gm),cr=Io(/^data-[\-\w.\u00B7-\uFFFF]/),lr=Io(/^aria-[\-\w]+$/),ur=Io(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),hr=Io(/^(?:\w+script|data):/i),dr=Io(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),fr=Io(/^html$/i),pr="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function mr(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var _r=function(){return"undefined"===typeof window?null:window},gr=function(e,t){if("object"!==("undefined"===typeof e?"undefined":pr(e))||"function"!==typeof e.createPolicy)return null;var n=null,i="data-tt-policy-suffix";t.currentScript&&t.currentScript.hasAttribute(i)&&(n=t.currentScript.getAttribute(i));var o="dompurify"+(n?"#"+n:"");try{return e.createPolicy(o,{createHTML:function(e){return e}})}catch(r){return console.warn("TrustedTypes policy "+o+" could not be created."),null}};function yr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_r(),t=function(e){return yr(e)};if(t.version="2.3.6",t.removed=[],!e||!e.document||9!==e.document.nodeType)return t.isSupported=!1,t;var n=e.document,i=e.document,o=e.DocumentFragment,r=e.HTMLTemplateElement,s=e.Node,a=e.Element,c=e.NodeFilter,l=e.NamedNodeMap,u=void 0===l?e.NamedNodeMap||e.MozNamedAttrMap:l,h=e.HTMLFormElement,d=e.DOMParser,f=e.trustedTypes,p=a.prototype,m=Ko(p,"cloneNode"),_=Ko(p,"nextSibling"),g=Ko(p,"childNodes"),y=Ko(p,"parentNode");if("function"===typeof r){var v=i.createElement("template");v.content&&v.content.ownerDocument&&(i=v.content.ownerDocument)}var b=gr(f,n),A=b?b.createHTML(""):"",w=i,T=w.implementation,C=w.createNodeIterator,E=w.createDocumentFragment,x=w.getElementsByTagName,S=n.importNode,I={};try{I=Yo(i).documentMode?i.documentMode:{}}catch(Ue){}var O={};t.isSupported="function"===typeof y&&T&&"undefined"!==typeof T.createHTMLDocument&&9!==I;var D=sr,P=ar,R=cr,L=lr,M=hr,B=dr,N=ur,F=null,z=jo({},[].concat(mr(Xo),mr(Qo),mr(Jo),mr($o),mr(tr))),k=null,U=jo({},[].concat(mr(nr),mr(ir),mr(or),mr(rr))),V=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),H=null,G=null,W=!0,q=!0,j=!1,Y=!1,K=!1,X=!1,Q=!1,J=!1,Z=!1,$=!1,ee=!0,te=!0,ne=!1,ie={},oe=null,re=jo({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),se=null,ae=jo({},["audio","video","img","source","image","track"]),ce=null,le=jo({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ue="http://www.w3.org/1998/Math/MathML",he="http://www.w3.org/2000/svg",de="http://www.w3.org/1999/xhtml",fe=de,pe=!1,me=void 0,_e=["application/xhtml+xml","text/html"],ge="text/html",ye=void 0,ve=null,be=i.createElement("form"),Ae=function(e){return e instanceof RegExp||e instanceof Function},we=function(e){ve&&ve===e||(e&&"object"===("undefined"===typeof e?"undefined":pr(e))||(e={}),e=Yo(e),F="ALLOWED_TAGS"in e?jo({},e.ALLOWED_TAGS):z,k="ALLOWED_ATTR"in e?jo({},e.ALLOWED_ATTR):U,ce="ADD_URI_SAFE_ATTR"in e?jo(Yo(le),e.ADD_URI_SAFE_ATTR):le,se="ADD_DATA_URI_TAGS"in e?jo(Yo(ae),e.ADD_DATA_URI_TAGS):ae,oe="FORBID_CONTENTS"in e?jo({},e.FORBID_CONTENTS):re,H="FORBID_TAGS"in e?jo({},e.FORBID_TAGS):{},G="FORBID_ATTR"in e?jo({},e.FORBID_ATTR):{},ie="USE_PROFILES"in e&&e.USE_PROFILES,W=!1!==e.ALLOW_ARIA_ATTR,q=!1!==e.ALLOW_DATA_ATTR,j=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Y=e.SAFE_FOR_TEMPLATES||!1,K=e.WHOLE_DOCUMENT||!1,J=e.RETURN_DOM||!1,Z=e.RETURN_DOM_FRAGMENT||!1,$=e.RETURN_TRUSTED_TYPE||!1,Q=e.FORCE_BODY||!1,ee=!1!==e.SANITIZE_DOM,te=!1!==e.KEEP_CONTENT,ne=e.IN_PLACE||!1,N=e.ALLOWED_URI_REGEXP||N,fe=e.NAMESPACE||de,e.CUSTOM_ELEMENT_HANDLING&&Ae(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(V.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&Ae(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(V.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"===typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(V.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),me=me=-1===_e.indexOf(e.PARSER_MEDIA_TYPE)?ge:e.PARSER_MEDIA_TYPE,ye="application/xhtml+xml"===me?function(e){return e}:No,Y&&(q=!1),Z&&(J=!0),ie&&(F=jo({},[].concat(mr(tr))),k=[],!0===ie.html&&(jo(F,Xo),jo(k,nr)),!0===ie.svg&&(jo(F,Qo),jo(k,ir),jo(k,rr)),!0===ie.svgFilters&&(jo(F,Jo),jo(k,ir),jo(k,rr)),!0===ie.mathMl&&(jo(F,$o),jo(k,or),jo(k,rr))),e.ADD_TAGS&&(F===z&&(F=Yo(F)),jo(F,e.ADD_TAGS)),e.ADD_ATTR&&(k===U&&(k=Yo(k)),jo(k,e.ADD_ATTR)),e.ADD_URI_SAFE_ATTR&&jo(ce,e.ADD_URI_SAFE_ATTR),e.FORBID_CONTENTS&&(oe===re&&(oe=Yo(oe)),jo(oe,e.FORBID_CONTENTS)),te&&(F["#text"]=!0),K&&jo(F,["html","head","body"]),F.table&&(jo(F,["tbody"]),delete H.tbody),So&&So(e),ve=e)},Te=jo({},["mi","mo","mn","ms","mtext"]),Ce=jo({},["foreignobject","desc","title","annotation-xml"]),Ee=jo({},Qo);jo(Ee,Jo),jo(Ee,Zo);var xe=jo({},$o);jo(xe,er);var Se=function(e){var t=y(e);t&&t.tagName||(t={namespaceURI:de,tagName:"template"});var n=No(e.tagName),i=No(t.tagName);if(e.namespaceURI===he)return t.namespaceURI===de?"svg"===n:t.namespaceURI===ue?"svg"===n&&("annotation-xml"===i||Te[i]):Boolean(Ee[n]);if(e.namespaceURI===ue)return t.namespaceURI===de?"math"===n:t.namespaceURI===he?"math"===n&&Ce[i]:Boolean(xe[n]);if(e.namespaceURI===de){if(t.namespaceURI===he&&!Ce[i])return!1;if(t.namespaceURI===ue&&!Te[i])return!1;var o=jo({},["title","style","font","a","script"]);return!xe[n]&&(o[n]||!Ee[n])}return!1},Ie=function(e){Bo(t.removed,{element:e});try{e.parentNode.removeChild(e)}catch(Ue){try{e.outerHTML=A}catch(Ue){e.remove()}}},Oe=function(e,n){try{Bo(t.removed,{attribute:n.getAttributeNode(e),from:n})}catch(Ue){Bo(t.removed,{attribute:null,from:n})}if(n.removeAttribute(e),"is"===e&&!k[e])if(J||Z)try{Ie(n)}catch(Ue){}else try{n.setAttribute(e,"")}catch(Ue){}},De=function(e){var t=void 0,n=void 0;if(Q)e="<remove></remove>"+e;else{var o=Fo(e,/^[\r\n\t ]+/);n=o&&o[0]}"application/xhtml+xml"===me&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");var r=b?b.createHTML(e):e;if(fe===de)try{t=(new d).parseFromString(r,me)}catch(Ue){}if(!t||!t.documentElement){t=T.createDocument(fe,"template",null);try{t.documentElement.innerHTML=pe?"":r}catch(Ue){}}var s=t.body||t.documentElement;return e&&n&&s.insertBefore(i.createTextNode(n),s.childNodes[0]||null),fe===de?x.call(t,K?"html":"body")[0]:K?t.documentElement:s},Pe=function(e){return C.call(e.ownerDocument||e,e,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT,null,!1)},Re=function(e){return e instanceof h&&("string"!==typeof e.nodeName||"string"!==typeof e.textContent||"function"!==typeof e.removeChild||!(e.attributes instanceof u)||"function"!==typeof e.removeAttribute||"function"!==typeof e.setAttribute||"string"!==typeof e.namespaceURI||"function"!==typeof e.insertBefore)},Le=function(e){return"object"===("undefined"===typeof s?"undefined":pr(s))?e instanceof s:e&&"object"===("undefined"===typeof e?"undefined":pr(e))&&"number"===typeof e.nodeType&&"string"===typeof e.nodeName},Me=function(e,n,i){O[e]&&Lo(O[e],(function(e){e.call(t,n,i,ve)}))},Be=function(e){var n=void 0;if(Me("beforeSanitizeElements",e,null),Re(e))return Ie(e),!0;if(Fo(e.nodeName,/[\u0080-\uFFFF]/))return Ie(e),!0;var i=ye(e.nodeName);if(Me("uponSanitizeElement",e,{tagName:i,allowedTags:F}),!Le(e.firstElementChild)&&(!Le(e.content)||!Le(e.content.firstElementChild))&&Ho(/<[/\w]/g,e.innerHTML)&&Ho(/<[/\w]/g,e.textContent))return Ie(e),!0;if("select"===i&&Ho(/<template/i,e.innerHTML))return Ie(e),!0;if(!F[i]||H[i]){if(!H[i]&&Fe(i)){if(V.tagNameCheck instanceof RegExp&&Ho(V.tagNameCheck,i))return!1;if(V.tagNameCheck instanceof Function&&V.tagNameCheck(i))return!1}if(te&&!oe[i]){var o=y(e)||e.parentNode,r=g(e)||e.childNodes;if(r&&o)for(var s=r.length,c=s-1;c>=0;--c)o.insertBefore(m(r[c],!0),_(e))}return Ie(e),!0}return e instanceof a&&!Se(e)?(Ie(e),!0):"noscript"!==i&&"noembed"!==i||!Ho(/<\/no(script|embed)/i,e.innerHTML)?(Y&&3===e.nodeType&&(n=e.textContent,n=zo(n,D," "),n=zo(n,P," "),e.textContent!==n&&(Bo(t.removed,{element:e.cloneNode()}),e.textContent=n)),Me("afterSanitizeElements",e,null),!1):(Ie(e),!0)},Ne=function(e,t,n){if(ee&&("id"===t||"name"===t)&&(n in i||n in be))return!1;if(q&&!G[t]&&Ho(R,t));else if(W&&Ho(L,t));else if(!k[t]||G[t]){if(!(Fe(e)&&(V.tagNameCheck instanceof RegExp&&Ho(V.tagNameCheck,e)||V.tagNameCheck instanceof Function&&V.tagNameCheck(e))&&(V.attributeNameCheck instanceof RegExp&&Ho(V.attributeNameCheck,t)||V.attributeNameCheck instanceof Function&&V.attributeNameCheck(t))||"is"===t&&V.allowCustomizedBuiltInElements&&(V.tagNameCheck instanceof RegExp&&Ho(V.tagNameCheck,n)||V.tagNameCheck instanceof Function&&V.tagNameCheck(n))))return!1}else if(ce[t]);else if(Ho(N,zo(n,B,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==Uo(n,"data:")||!se[e]){if(j&&!Ho(M,zo(n,B,"")));else if(n)return!1}else;return!0},Fe=function(e){return e.indexOf("-")>0},ze=function(e){var n=void 0,i=void 0,o=void 0,r=void 0;Me("beforeSanitizeAttributes",e,null);var s=e.attributes;if(s){var a={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:k};r=s.length;while(r--){n=s[r];var c=n,l=c.name,u=c.namespaceURI;if(i=Vo(n.value),o=ye(l),a.attrName=o,a.attrValue=i,a.keepAttr=!0,a.forceKeepAttr=void 0,Me("uponSanitizeAttribute",e,a),i=a.attrValue,!a.forceKeepAttr&&(Oe(l,e),a.keepAttr))if(Ho(/\/>/i,i))Oe(l,e);else{Y&&(i=zo(i,D," "),i=zo(i,P," "));var h=ye(e.nodeName);if(Ne(h,o,i))try{u?e.setAttributeNS(u,l,i):e.setAttribute(l,i),Mo(t.removed)}catch(Ue){}}}Me("afterSanitizeAttributes",e,null)}},ke=function e(t){var n=void 0,i=Pe(t);Me("beforeSanitizeShadowDOM",t,null);while(n=i.nextNode())Me("uponSanitizeShadowNode",n,null),Be(n)||(n.content instanceof o&&e(n.content),ze(n));Me("afterSanitizeShadowDOM",t,null)};return t.sanitize=function(i,r){var a=void 0,c=void 0,l=void 0,u=void 0,h=void 0;if(pe=!i,pe&&(i="\x3c!--\x3e"),"string"!==typeof i&&!Le(i)){if("function"!==typeof i.toString)throw Go("toString is not a function");if(i=i.toString(),"string"!==typeof i)throw Go("dirty is not a string, aborting")}if(!t.isSupported){if("object"===pr(e.toStaticHTML)||"function"===typeof e.toStaticHTML){if("string"===typeof i)return e.toStaticHTML(i);if(Le(i))return e.toStaticHTML(i.outerHTML)}return i}if(X||we(r),t.removed=[],"string"===typeof i&&(ne=!1),ne){if(i.nodeName){var d=ye(i.nodeName);if(!F[d]||H[d])throw Go("root node is forbidden and cannot be sanitized in-place")}}else if(i instanceof s)a=De("\x3c!----\x3e"),c=a.ownerDocument.importNode(i,!0),1===c.nodeType&&"BODY"===c.nodeName||"HTML"===c.nodeName?a=c:a.appendChild(c);else{if(!J&&!Y&&!K&&-1===i.indexOf("<"))return b&&$?b.createHTML(i):i;if(a=De(i),!a)return J?null:$?A:""}a&&Q&&Ie(a.firstChild);var f=Pe(ne?i:a);while(l=f.nextNode())3===l.nodeType&&l===u||Be(l)||(l.content instanceof o&&ke(l.content),ze(l),u=l);if(u=null,ne)return i;if(J){if(Z){h=E.call(a.ownerDocument);while(a.firstChild)h.appendChild(a.firstChild)}else h=a;return k.shadowroot&&(h=S.call(n,h,!0)),h}var p=K?a.outerHTML:a.innerHTML;return K&&F["!doctype"]&&a.ownerDocument&&a.ownerDocument.doctype&&a.ownerDocument.doctype.name&&Ho(fr,a.ownerDocument.doctype.name)&&(p="<!DOCTYPE "+a.ownerDocument.doctype.name+">\n"+p),Y&&(p=zo(p,D," "),p=zo(p,P," ")),b&&$?b.createHTML(p):p},t.setConfig=function(e){we(e),X=!0},t.clearConfig=function(){ve=null,X=!1},t.isValidAttribute=function(e,t,n){ve||we({});var i=ye(e),o=ye(t);return Ne(i,o,n)},t.addHook=function(e,t){"function"===typeof t&&(O[e]=O[e]||[],Bo(O[e],t))},t.removeHook=function(e){O[e]&&Mo(O[e])},t.removeHooks=function(e){O[e]&&(O[e]=[])},t.removeAllHooks=function(){O={}},t}var vr=yr();let br=0;const Ar={};function wr(e,t){let n;D.typeOf.string("html",e);const i=e;C(Ar[i])?n=Ar[i]:(n=br++,Ar[i]=n),t=R(t,!1),this._id=n,this._html=e,this._showOnScreen=t,this._element=void 0}Object.defineProperties(wr.prototype,{html:{get:function(){return this._html}},id:{get:function(){return this._id}},showOnScreen:{get:function(){return this._showOnScreen},set:function(e){this._showOnScreen=e}},element:{get:function(){if(!C(this._element)){const e=vr.sanitize(this._html),t=document.createElement("div");t._creditId=this._id,t.style.display="inline",t.innerHTML=e;const n=t.querySelectorAll("a");for(let i=0;i<n.length;i++)n[i].setAttribute("target","_blank");this._element=t}return this._element}}}),wr.equals=function(e,t){return e===t||C(e)&&C(t)&&e._id===t._id&&e._showOnScreen===t._showOnScreen},wr.prototype.equals=function(e){return wr.equals(this,e)},wr.getIonCredit=function(e){const t=C(e.collapsible)&&!e.collapsible,n=new wr(e.html,t);return n._isIon=-1!==n.html.indexOf("ion-credit.png"),n},wr.clone=function(e){if(C(e))return new wr(e.html,e.showOnScreen)};var Tr=wr;const Cr={NONE:0,LERC:1};var Er=Object.freeze(Cr);function xr(e,t,n){this.minimum=K.clone(R(e,K.ZERO)),this.maximum=K.clone(R(t,K.ZERO)),n=C(n)?K.clone(n):K.midpoint(this.minimum,this.maximum,new K),this.center=n}xr.fromCorners=function(e,t,n){return D.defined("minimum",e),D.defined("maximum",t),C(n)||(n=new xr),n.minimum=K.clone(e,n.minimum),n.maximum=K.clone(t,n.maximum),n.center=K.midpoint(e,t,n.center),n},xr.fromPoints=function(e,t){if(C(t)||(t=new xr),!C(e)||0===e.length)return t.minimum=K.clone(K.ZERO,t.minimum),t.maximum=K.clone(K.ZERO,t.maximum),t.center=K.clone(K.ZERO,t.center),t;let n=e[0].x,i=e[0].y,o=e[0].z,r=e[0].x,s=e[0].y,a=e[0].z;const c=e.length;for(let h=1;h<c;h++){const t=e[h],c=t.x,l=t.y,u=t.z;n=Math.min(c,n),r=Math.max(c,r),i=Math.min(l,i),s=Math.max(l,s),o=Math.min(u,o),a=Math.max(u,a)}const l=t.minimum;l.x=n,l.y=i,l.z=o;const u=t.maximum;return u.x=r,u.y=s,u.z=a,t.center=K.midpoint(l,u,t.center),t},xr.clone=function(e,t){if(C(e))return C(t)?(t.minimum=K.clone(e.minimum,t.minimum),t.maximum=K.clone(e.maximum,t.maximum),t.center=K.clone(e.center,t.center),t):new xr(e.minimum,e.maximum,e.center)},xr.equals=function(e,t){return e===t||C(e)&&C(t)&&K.equals(e.center,t.center)&&K.equals(e.minimum,t.minimum)&&K.equals(e.maximum,t.maximum)};let Sr=new K;xr.intersectPlane=function(e,t){D.defined("box",e),D.defined("plane",t),Sr=K.subtract(e.maximum,e.minimum,Sr);const n=K.multiplyByScalar(Sr,.5,Sr),i=t.normal,o=n.x*Math.abs(i.x)+n.y*Math.abs(i.y)+n.z*Math.abs(i.z),r=K.dot(e.center,i)+t.distance;return r-o>0?Ae.INSIDE:r+o<0?Ae.OUTSIDE:Ae.INTERSECTING},xr.prototype.clone=function(e){return xr.clone(this,e)},xr.prototype.intersectPlane=function(e){return xr.intersectPlane(this,e)},xr.prototype.equals=function(e){return xr.equals(this,e)};var Ir=xr;function Or(e,t){D.typeOf.object("ellipsoid",e),this._ellipsoid=e,this._cameraPosition=new K,this._cameraPositionInScaledSpace=new K,this._distanceToLimbInScaledSpaceSquared=0,C(t)&&(this.cameraPosition=t)}Object.defineProperties(Or.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},cameraPosition:{get:function(){return this._cameraPosition},set:function(e){const t=this._ellipsoid,n=t.transformPositionToScaledSpace(e,this._cameraPositionInScaledSpace),i=K.magnitudeSquared(n)-1;K.clone(e,this._cameraPosition),this._cameraPositionInScaledSpace=n,this._distanceToLimbInScaledSpaceSquared=i}}});const Dr=new K;Or.prototype.isPointVisible=function(e){const t=this._ellipsoid,n=t.transformPositionToScaledSpace(e,Dr);return kr(n,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)},Or.prototype.isScaledSpacePointVisible=function(e){return kr(e,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)};const Pr=new K;Or.prototype.isScaledSpacePointVisiblePossiblyUnderEllipsoid=function(e,t){const n=this._ellipsoid;let i,o;return C(t)&&t<0&&n.minimumRadius>-t?(o=Pr,o.x=this._cameraPosition.x/(n.radii.x+t),o.y=this._cameraPosition.y/(n.radii.y+t),o.z=this._cameraPosition.z/(n.radii.z+t),i=o.x*o.x+o.y*o.y+o.z*o.z-1):(o=this._cameraPositionInScaledSpace,i=this._distanceToLimbInScaledSpaceSquared),kr(e,o,i)},Or.prototype.computeHorizonCullingPoint=function(e,t,n){return Nr(this._ellipsoid,e,t,n)};const Rr=ge.clone(ge.UNIT_SPHERE);Or.prototype.computeHorizonCullingPointPossiblyUnderEllipsoid=function(e,t,n,i){const o=Br(this._ellipsoid,n,Rr);return Nr(o,e,t,i)},Or.prototype.computeHorizonCullingPointFromVertices=function(e,t,n,i,o){return zr(this._ellipsoid,e,t,n,i,o)},Or.prototype.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid=function(e,t,n,i,o,r){const s=Br(this._ellipsoid,o,Rr);return zr(s,e,t,n,i,r)};const Lr=[];Or.prototype.computeHorizonCullingPointFromRectangle=function(e,t,n){D.typeOf.object("rectangle",e);const i=_t.subsample(e,t,0,Lr),o=nn.fromPoints(i);if(!(K.magnitude(o.center)<.1*t.minimumRadius))return this.computeHorizonCullingPoint(o.center,i,n)};const Mr=new K;function Br(e,t,n){if(C(t)&&t<0&&e.minimumRadius>-t){const i=K.fromElements(e.radii.x+t,e.radii.y+t,e.radii.z+t,Mr);e=ge.fromCartesian3(i,n)}return e}function Nr(e,t,n,i){D.typeOf.object("directionToPoint",t),D.defined("positions",n),C(i)||(i=new K);const o=qr(e,t);let r=0;for(let s=0,a=n.length;s<a;++s){const t=n[s],i=Hr(e,t,o);if(i<0)return;r=Math.max(r,i)}return Gr(o,r,i)}const Fr=new K;function zr(e,t,n,i,o,r){D.typeOf.object("directionToPoint",t),D.defined("vertices",n),D.typeOf.number("stride",i),C(r)||(r=new K),i=R(i,3),o=R(o,K.ZERO);const s=qr(e,t);let a=0;for(let c=0,l=n.length;c<l;c+=i){Fr.x=n[c]+o.x,Fr.y=n[c+1]+o.y,Fr.z=n[c+2]+o.z;const t=Hr(e,Fr,s);if(t<0)return;a=Math.max(a,t)}return Gr(s,a,r)}function kr(e,t,n){const i=t,o=n,r=K.subtract(e,i,Dr),s=-K.dot(r,i),a=o<0?s>0:s>o&&s*s/K.magnitudeSquared(r)>o;return!a}const Ur=new K,Vr=new K;function Hr(e,t,n){const i=e.transformPositionToScaledSpace(t,Ur);let o=K.magnitudeSquared(i),r=Math.sqrt(o);const s=K.divideByScalar(i,r,Vr);o=Math.max(1,o),r=Math.max(1,r);const a=K.dot(s,n),c=K.magnitude(K.cross(s,n,s)),l=1/r,u=Math.sqrt(o-1)*l;return 1/(a*l-c*u)}function Gr(e,t,n){if(!(t<=0||t===1/0||t!==t))return K.multiplyByScalar(e,t,n)}const Wr=new K;function qr(e,t){return K.equals(t,K.ZERO)?t:(e.transformPositionToScaledSpace(t,Wr),K.normalize(Wr,Wr))}var jr=Or;const Yr={};function Kr(e,t,n){const i=e+t;return z.sign(e)!==z.sign(t)&&Math.abs(i/Math.max(Math.abs(e),Math.abs(t)))<n?0:i}Yr.computeDiscriminant=function(e,t,n){if("number"!==typeof e)throw new x("a is a required number.");if("number"!==typeof t)throw new x("b is a required number.");if("number"!==typeof n)throw new x("c is a required number.");const i=t*t-4*e*n;return i},Yr.computeRealRoots=function(e,t,n){if("number"!==typeof e)throw new x("a is a required number.");if("number"!==typeof t)throw new x("b is a required number.");if("number"!==typeof n)throw new x("c is a required number.");let i;if(0===e)return 0===t?[]:[-n/t];if(0===t){if(0===n)return[0,0];const t=Math.abs(n),o=Math.abs(e);if(t<o&&t/o<z.EPSILON14)return[0,0];if(t>o&&o/t<z.EPSILON14)return[];if(i=-n/e,i<0)return[];const r=Math.sqrt(i);return[-r,r]}if(0===n)return i=-t/e,i<0?[i,0]:[0,i];const o=t*t,r=4*e*n,s=Kr(o,-r,z.EPSILON14);if(s<0)return[];const a=-.5*Kr(t,z.sign(t)*Math.sqrt(s),z.EPSILON14);return t>0?[a/e,n/a]:[n/a,a/e]};var Xr=Yr;const Qr={};function Jr(e,t,n,i){const o=e,r=t/3,s=n/3,a=i,c=o*s,l=r*a,u=r*r,h=s*s,d=o*s-u,f=o*a-r*s,p=r*a-h,m=4*d*p-f*f;let _,g;if(m<0){let e,t,n;u*l>=c*h?(e=o,t=d,n=-2*r*d+o*f):(e=a,t=p,n=-a*f+2*s*p);const i=n<0?-1:1,y=-i*Math.abs(e)*Math.sqrt(-m);g=-n+y;const v=g/2,b=v<0?-Math.pow(-v,1/3):Math.pow(v,1/3),A=g===y?-b:-t/b;return _=t<=0?b+A:-n/(b*b+A*A+t),u*l>=c*h?[(_-r)/o]:[-a/(_+s)]}const y=d,v=-2*r*d+o*f,b=p,A=-a*f+2*s*p,w=Math.sqrt(m),T=Math.sqrt(3)/2;let C=Math.abs(Math.atan2(o*w,-v)/3);_=2*Math.sqrt(-y);let E=Math.cos(C);g=_*E;let x=_*(-E/2-T*Math.sin(C));const S=g+x>2*r?g-r:x-r,I=o,O=S/I;C=Math.abs(Math.atan2(a*w,-A)/3),_=2*Math.sqrt(-b),E=Math.cos(C),g=_*E,x=_*(-E/2-T*Math.sin(C));const D=-a,P=g+x<2*s?g+s:x+s,R=D/P,L=I*P,M=-S*P-I*D,B=S*D,N=(s*M-r*B)/(-r*M+s*L);return O<=N?O<=R?N<=R?[O,N,R]:[O,R,N]:[R,O,N]:O<=R?[N,O,R]:N<=R?[N,R,O]:[R,N,O]}Qr.computeDiscriminant=function(e,t,n,i){if("number"!==typeof e)throw new x("a is a required number.");if("number"!==typeof t)throw new x("b is a required number.");if("number"!==typeof n)throw new x("c is a required number.");if("number"!==typeof i)throw new x("d is a required number.");const o=e*e,r=t*t,s=n*n,a=i*i,c=18*e*t*n*i+r*s-27*o*a-4*(e*s*n+r*t*i);return c},Qr.computeRealRoots=function(e,t,n,i){if("number"!==typeof e)throw new x("a is a required number.");if("number"!==typeof t)throw new x("b is a required number.");if("number"!==typeof n)throw new x("c is a required number.");if("number"!==typeof i)throw new x("d is a required number.");let o,r;if(0===e)return Xr.computeRealRoots(t,n,i);if(0===t){if(0===n){if(0===i)return[0,0,0];r=-i/e;const t=r<0?-Math.pow(-r,1/3):Math.pow(r,1/3);return[t,t,t]}return 0===i?(o=Xr.computeRealRoots(e,0,n),0===o.Length?[0]:[o[0],0,o[1]]):Jr(e,0,n,i)}return 0===n?0===i?(r=-t/e,r<0?[r,0,0]:[0,0,r]):Jr(e,t,0,i):0===i?(o=Xr.computeRealRoots(e,t,n),0===o.length?[0]:o[1]<=0?[o[0],o[1],0]:o[0]>=0?[0,o[0],o[1]]:[o[0],0,o[1]]):Jr(e,t,n,i)};var Zr=Qr;const $r={};function es(e,t,n,i){const o=e*e,r=t-3*o/8,s=n-t*e/2+o*e/8,a=i-n*e/4+t*o/16-3*o*o/256,c=Zr.computeRealRoots(1,2*r,r*r-4*a,-s*s);if(c.length>0){const t=-e/4,n=c[c.length-1];if(Math.abs(n)<z.EPSILON14){const e=Xr.computeRealRoots(1,r,a);if(2===e.length){const n=e[0],i=e[1];let o;if(n>=0&&i>=0){const e=Math.sqrt(n),o=Math.sqrt(i);return[t-o,t-e,t+e,t+o]}if(n>=0&&i<0)return o=Math.sqrt(n),[t-o,t+o];if(n<0&&i>=0)return o=Math.sqrt(i),[t-o,t+o]}return[]}if(n>0){const e=Math.sqrt(n),i=(r+n-s/e)/2,o=(r+n+s/e)/2,a=Xr.computeRealRoots(1,e,i),c=Xr.computeRealRoots(1,-e,o);return 0!==a.length?(a[0]+=t,a[1]+=t,0!==c.length?(c[0]+=t,c[1]+=t,a[1]<=c[0]?[a[0],a[1],c[0],c[1]]:c[1]<=a[0]?[c[0],c[1],a[0],a[1]]:a[0]>=c[0]&&a[1]<=c[1]?[c[0],a[0],a[1],c[1]]:c[0]>=a[0]&&c[1]<=a[1]?[a[0],c[0],c[1],a[1]]:a[0]>c[0]&&a[0]<c[1]?[c[0],a[0],c[1],a[1]]:[a[0],c[0],a[1],c[1]]):a):0!==c.length?(c[0]+=t,c[1]+=t,c):[]}}return[]}function ts(e,t,n,i){const o=n*n,r=t*t,s=e*e,a=-2*t,c=n*e+r-4*i,l=s*i-n*t*e+o,u=Zr.computeRealRoots(1,a,c,l);if(u.length>0){const o=u[0],r=t-o,a=r*r,c=e/2,l=r/2,h=a-4*i,d=a+4*Math.abs(i),f=s-4*o,p=s+4*Math.abs(o);let m,_,g,y,v,b;if(o<0||h*p<f*d){const t=Math.sqrt(f);m=t/2,_=0===t?0:(e*l-n)/t}else{const t=Math.sqrt(h);m=0===t?0:(e*l-n)/t,_=t/2}0===c&&0===m?(g=0,y=0):z.sign(c)===z.sign(m)?(g=c+m,y=o/g):(y=c-m,g=o/y),0===l&&0===_?(v=0,b=0):z.sign(l)===z.sign(_)?(v=l+_,b=i/v):(b=l-_,v=i/b);const A=Xr.computeRealRoots(1,g,v),w=Xr.computeRealRoots(1,y,b);if(0!==A.length)return 0!==w.length?A[1]<=w[0]?[A[0],A[1],w[0],w[1]]:w[1]<=A[0]?[w[0],w[1],A[0],A[1]]:A[0]>=w[0]&&A[1]<=w[1]?[w[0],A[0],A[1],w[1]]:w[0]>=A[0]&&w[1]<=A[1]?[A[0],w[0],w[1],A[1]]:A[0]>w[0]&&A[0]<w[1]?[w[0],A[0],w[1],A[1]]:[A[0],w[0],A[1],w[1]]:A;if(0!==w.length)return w}return[]}$r.computeDiscriminant=function(e,t,n,i,o){if("number"!==typeof e)throw new x("a is a required number.");if("number"!==typeof t)throw new x("b is a required number.");if("number"!==typeof n)throw new x("c is a required number.");if("number"!==typeof i)throw new x("d is a required number.");if("number"!==typeof o)throw new x("e is a required number.");const r=e*e,s=r*e,a=t*t,c=a*t,l=n*n,u=l*n,h=i*i,d=h*i,f=o*o,p=f*o,m=a*l*h-4*c*d-4*e*u*h+18*e*t*n*d-27*r*h*h+256*s*p+o*(18*c*n*i-4*a*u+16*e*l*l-80*e*t*l*i-6*e*a*h+144*r*n*h)+f*(144*e*a*n-27*a*a-128*r*l-192*r*t*i);return m},$r.computeRealRoots=function(e,t,n,i,o){if("number"!==typeof e)throw new x("a is a required number.");if("number"!==typeof t)throw new x("b is a required number.");if("number"!==typeof n)throw new x("c is a required number.");if("number"!==typeof i)throw new x("d is a required number.");if("number"!==typeof o)throw new x("e is a required number.");if(Math.abs(e)<z.EPSILON15)return Zr.computeRealRoots(t,n,i,o);const r=t/e,s=n/e,a=i/e,c=o/e;let l=r<0?1:0;switch(l+=s<0?l+1:l,l+=a<0?l+1:l,l+=c<0?l+1:l,l){case 0:return es(r,s,a,c);case 1:return ts(r,s,a,c);case 2:return ts(r,s,a,c);case 3:return es(r,s,a,c);case 4:return es(r,s,a,c);case 5:return ts(r,s,a,c);case 6:return es(r,s,a,c);case 7:return es(r,s,a,c);case 8:return ts(r,s,a,c);case 9:return es(r,s,a,c);case 10:return es(r,s,a,c);case 11:return ts(r,s,a,c);case 12:return es(r,s,a,c);case 13:return es(r,s,a,c);case 14:return es(r,s,a,c);case 15:return es(r,s,a,c);default:return}};var ns=$r;function is(e,t){t=K.clone(R(t,K.ZERO)),K.equals(t,K.ZERO)||K.normalize(t,t),this.origin=K.clone(R(e,K.ZERO)),this.direction=t}is.clone=function(e,t){if(C(e))return C(t)?(t.origin=K.clone(e.origin),t.direction=K.clone(e.direction),t):new is(e.origin,e.direction)},is.getPoint=function(e,t,n){return D.typeOf.object("ray",e),D.typeOf.number("t",t),C(n)||(n=new K),n=K.multiplyByScalar(e.direction,t,n),K.add(e.origin,n,n)};var os=is;const rs={rayPlane:function(e,t,n){if(!C(e))throw new x("ray is required.");if(!C(t))throw new x("plane is required.");C(n)||(n=new K);const i=e.origin,o=e.direction,r=t.normal,s=K.dot(r,o);if(Math.abs(s)<z.EPSILON15)return;const a=(-t.distance-K.dot(r,i))/s;return a<0?void 0:(n=K.multiplyByScalar(o,a,n),K.add(i,n,n))}},ss=new K,as=new K,cs=new K,ls=new K,us=new K;rs.rayTriangleParametric=function(e,t,n,i,o){if(!C(e))throw new x("ray is required.");if(!C(t))throw new x("p0 is required.");if(!C(n))throw new x("p1 is required.");if(!C(i))throw new x("p2 is required.");o=R(o,!1);const r=e.origin,s=e.direction,a=K.subtract(n,t,ss),c=K.subtract(i,t,as),l=K.cross(s,c,cs),u=K.dot(a,l);let h,d,f,p,m;if(o){if(u<z.EPSILON6)return;if(h=K.subtract(r,t,ls),f=K.dot(h,l),f<0||f>u)return;if(d=K.cross(h,a,us),p=K.dot(s,d),p<0||f+p>u)return;m=K.dot(c,d)/u}else{if(Math.abs(u)<z.EPSILON6)return;const e=1/u;if(h=K.subtract(r,t,ls),f=K.dot(h,l)*e,f<0||f>1)return;if(d=K.cross(h,a,us),p=K.dot(s,d)*e,p<0||f+p>1)return;m=K.dot(c,d)*e}return m},rs.rayTriangle=function(e,t,n,i,o,r){const s=rs.rayTriangleParametric(e,t,n,i,o);if(C(s)&&!(s<0))return C(r)||(r=new K),K.multiplyByScalar(e.direction,s,r),K.add(e.origin,r,r)};const hs=new os;function ds(e,t,n,i){const o=t*t-4*e*n;if(o<0)return;if(o>0){const n=1/(2*e),r=Math.sqrt(o),s=(-t+r)*n,a=(-t-r)*n;return s<a?(i.root0=s,i.root1=a):(i.root0=a,i.root1=s),i}const r=-t/(2*e);return 0!==r?(i.root0=i.root1=r,i):void 0}rs.lineSegmentTriangle=function(e,t,n,i,o,r,s){if(!C(e))throw new x("v0 is required.");if(!C(t))throw new x("v1 is required.");if(!C(n))throw new x("p0 is required.");if(!C(i))throw new x("p1 is required.");if(!C(o))throw new x("p2 is required.");const a=hs;K.clone(e,a.origin),K.subtract(t,e,a.direction),K.normalize(a.direction,a.direction);const c=rs.rayTriangleParametric(a,n,i,o,r);if(!(!C(c)||c<0||c>K.distance(e,t)))return C(s)||(s=new K),K.multiplyByScalar(a.direction,c,s),K.add(a.origin,s,s)};const fs={root0:0,root1:0};function ps(e,t,n){C(n)||(n=new Te);const i=e.origin,o=e.direction,r=t.center,s=t.radius*t.radius,a=K.subtract(i,r,cs),c=K.dot(o,o),l=2*K.dot(o,a),u=K.magnitudeSquared(a)-s,h=ds(c,l,u,fs);if(C(h))return n.start=h.root0,n.stop=h.root1,n}rs.raySphere=function(e,t,n){if(!C(e))throw new x("ray is required.");if(!C(t))throw new x("sphere is required.");if(n=ps(e,t,n),C(n)&&!(n.stop<0))return n.start=Math.max(n.start,0),n};const ms=new os;rs.lineSegmentSphere=function(e,t,n,i){if(!C(e))throw new x("p0 is required.");if(!C(t))throw new x("p1 is required.");if(!C(n))throw new x("sphere is required.");const o=ms;K.clone(e,o.origin);const r=K.subtract(t,e,o.direction),s=K.magnitude(r);if(K.normalize(r,r),i=ps(o,n,i),!(!C(i)||i.stop<0||i.start>s))return i.start=Math.max(i.start,0),i.stop=Math.min(i.stop,s),i};const _s=new K,gs=new K;function ys(e,t,n){const i=e+t;return z.sign(e)!==z.sign(t)&&Math.abs(i/Math.max(Math.abs(e),Math.abs(t)))<n?0:i}function vs(e,t,n,i,o){const r=i*i,s=o*o,a=(e[ke.COLUMN1ROW1]-e[ke.COLUMN2ROW2])*s,c=o*(i*ys(e[ke.COLUMN1ROW0],e[ke.COLUMN0ROW1],z.EPSILON15)+t.y),l=e[ke.COLUMN0ROW0]*r+e[ke.COLUMN2ROW2]*s+i*t.x+n,u=s*ys(e[ke.COLUMN2ROW1],e[ke.COLUMN1ROW2],z.EPSILON15),h=o*(i*ys(e[ke.COLUMN2ROW0],e[ke.COLUMN0ROW2])+t.z);let d;const f=[];if(0===h&&0===u){if(d=Xr.computeRealRoots(a,c,l),0===d.length)return f;const e=d[0],t=Math.sqrt(Math.max(1-e*e,0));if(f.push(new K(i,o*e,o*-t)),f.push(new K(i,o*e,o*t)),2===d.length){const e=d[1],t=Math.sqrt(Math.max(1-e*e,0));f.push(new K(i,o*e,o*-t)),f.push(new K(i,o*e,o*t))}return f}const p=h*h,m=u*u,_=a*a,g=h*u,y=_+m,v=2*(c*a+g),b=2*l*a+c*c-m+p,A=2*(l*c-g),w=l*l-p;if(0===y&&0===v&&0===b&&0===A)return f;d=ns.computeRealRoots(y,v,b,A,w);const T=d.length;if(0===T)return f;for(let C=0;C<T;++C){const e=d[C],t=e*e,n=Math.max(1-t,0),r=Math.sqrt(n);let s;s=z.sign(a)===z.sign(l)?ys(a*t+l,c*e,z.EPSILON12):z.sign(l)===z.sign(c*e)?ys(a*t,c*e+l,z.EPSILON12):ys(a*t+c*e,l,z.EPSILON12);const p=ys(u*e,h,z.EPSILON15),m=s*p;m<0?f.push(new K(i,o*e,o*r)):m>0?f.push(new K(i,o*e,o*-r)):0!==r?(f.push(new K(i,o*e,o*-r)),f.push(new K(i,o*e,o*r)),++C):f.push(new K(i,o*e,o*r))}return f}rs.rayEllipsoid=function(e,t){if(!C(e))throw new x("ray is required.");if(!C(t))throw new x("ellipsoid is required.");const n=t.oneOverRadii,i=K.multiplyComponents(n,e.origin,_s),o=K.multiplyComponents(n,e.direction,gs),r=K.magnitudeSquared(i),s=K.dot(i,o);let a,c,l,u,h;if(r>1){if(s>=0)return;const e=s*s;if(a=r-1,c=K.magnitudeSquared(o),l=c*a,e<l)return;if(e>l){u=s*s-l,h=-s+Math.sqrt(u);const e=h/c,t=a/h;return e<t?new Te(e,t):{start:t,stop:e}}const t=Math.sqrt(a/c);return new Te(t,t)}return r<1?(a=r-1,c=K.magnitudeSquared(o),l=c*a,u=s*s-l,h=-s+Math.sqrt(u),new Te(0,h/c)):s<0?(c=K.magnitudeSquared(o),new Te(0,-s/c)):void 0};const bs=new K,As=new K,ws=new K,Ts=new K,Cs=new K,Es=new ke,xs=new ke,Ss=new ke,Is=new ke,Os=new ke,Ds=new ke,Ps=new ke,Rs=new K,Ls=new K,Ms=new se;rs.grazingAltitudeLocation=function(e,t){if(!C(e))throw new x("ray is required.");if(!C(t))throw new x("ellipsoid is required.");const n=e.origin,i=e.direction;if(!K.equals(n,K.ZERO)){const e=t.geodeticSurfaceNormal(n,bs);if(K.dot(i,e)>=0)return n}const o=C(this.rayEllipsoid(e,t)),r=t.transformPositionToScaledSpace(i,bs),s=K.normalize(r,r),a=K.mostOrthogonalAxis(r,Ts),c=K.normalize(K.cross(a,s,As),As),l=K.normalize(K.cross(s,c,ws),ws),u=Es;u[0]=s.x,u[1]=s.y,u[2]=s.z,u[3]=c.x,u[4]=c.y,u[5]=c.z,u[6]=l.x,u[7]=l.y,u[8]=l.z;const h=ke.transpose(u,xs),d=ke.fromScale(t.radii,Ss),f=ke.fromScale(t.oneOverRadii,Is),p=Os;p[0]=0,p[1]=-i.z,p[2]=i.y,p[3]=i.z,p[4]=0,p[5]=-i.x,p[6]=-i.y,p[7]=i.x,p[8]=0;const m=ke.multiply(ke.multiply(h,f,Ds),p,Ds),_=ke.multiply(ke.multiply(m,d,Ps),u,Ps),g=ke.multiplyByVector(m,n,Cs),y=vs(_,K.negate(g,bs),0,0,1);let v,b;const A=y.length;if(A>0){let e=K.clone(K.ZERO,Ls),r=Number.NEGATIVE_INFINITY;for(let t=0;t<A;++t){v=ke.multiplyByVector(d,ke.multiplyByVector(u,y[t],Rs),Rs);const o=K.normalize(K.subtract(v,n,Ts),Ts),s=K.dot(o,i);s>r&&(r=s,e=K.clone(v,e))}const s=t.cartesianToCartographic(e,Ms);return r=z.clamp(r,0,1),b=K.magnitude(K.subtract(e,n,Ts))*Math.sqrt(1-r*r),b=o?-b:b,s.height=b,t.cartographicToCartesian(s,new K)}};const Bs=new K;rs.lineSegmentPlane=function(e,t,n,i){if(!C(e))throw new x("endPoint0 is required.");if(!C(t))throw new x("endPoint1 is required.");if(!C(n))throw new x("plane is required.");C(i)||(i=new K);const o=K.subtract(t,e,Bs),r=n.normal,s=K.dot(r,o);if(Math.abs(s)<z.EPSILON6)return;const a=K.dot(r,e),c=-(n.distance+a)/s;return c<0||c>1?void 0:(K.multiplyByScalar(o,c,i),K.add(e,i,i),i)},rs.trianglePlaneIntersection=function(e,t,n,i){if(!C(e)||!C(t)||!C(n)||!C(i))throw new x("p0, p1, p2, and plane are required.");const o=i.normal,r=i.distance,s=K.dot(o,e)+r<0,a=K.dot(o,t)+r<0,c=K.dot(o,n)+r<0;let l,u,h=0;if(h+=s?1:0,h+=a?1:0,h+=c?1:0,1!==h&&2!==h||(l=new K,u=new K),1===h){if(s)return rs.lineSegmentPlane(e,t,i,l),rs.lineSegmentPlane(e,n,i,u),{positions:[e,t,n,l,u],indices:[0,3,4,1,2,4,1,4,3]};if(a)return rs.lineSegmentPlane(t,n,i,l),rs.lineSegmentPlane(t,e,i,u),{positions:[e,t,n,l,u],indices:[1,3,4,2,0,4,2,4,3]};if(c)return rs.lineSegmentPlane(n,e,i,l),rs.lineSegmentPlane(n,t,i,u),{positions:[e,t,n,l,u],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===h){if(!s)return rs.lineSegmentPlane(t,e,i,l),rs.lineSegmentPlane(n,e,i,u),{positions:[e,t,n,l,u],indices:[1,2,4,1,4,3,0,3,4]};if(!a)return rs.lineSegmentPlane(n,t,i,l),rs.lineSegmentPlane(e,t,i,u),{positions:[e,t,n,l,u],indices:[2,0,4,2,4,3,1,3,4]};if(!c)return rs.lineSegmentPlane(e,n,i,l),rs.lineSegmentPlane(t,n,i,u),{positions:[e,t,n,l,u],indices:[0,1,4,0,4,3,2,3,4]}}};var Ns=rs;function Fs(e,t){if(D.typeOf.object("normal",e),!z.equalsEpsilon(K.magnitude(e),1,z.EPSILON6))throw new x("normal must be normalized.");D.typeOf.number("distance",t),this.normal=K.clone(e),this.distance=t}Fs.fromPointNormal=function(e,t,n){if(D.typeOf.object("point",e),D.typeOf.object("normal",t),!z.equalsEpsilon(K.magnitude(t),1,z.EPSILON6))throw new x("normal must be normalized.");const i=-K.dot(t,e);return C(n)?(K.clone(t,n.normal),n.distance=i,n):new Fs(t,i)};const zs=new K;Fs.fromCartesian4=function(e,t){D.typeOf.object("coefficients",e);const n=K.fromCartesian4(e,zs),i=e.w;if(!z.equalsEpsilon(K.magnitude(n),1,z.EPSILON6))throw new x("normal must be normalized.");return C(t)?(K.clone(n,t.normal),t.distance=i,t):new Fs(n,i)},Fs.getPointDistance=function(e,t){return D.typeOf.object("plane",e),D.typeOf.object("point",t),K.dot(e.normal,t)+e.distance};const ks=new K;Fs.projectPointOntoPlane=function(e,t,n){D.typeOf.object("plane",e),D.typeOf.object("point",t),C(n)||(n=new K);const i=Fs.getPointDistance(e,t),o=K.multiplyByScalar(e.normal,i,ks);return K.subtract(t,o,n)};const Us=new ft,Vs=new Xe,Hs=new K;Fs.transform=function(e,t,n){D.typeOf.object("plane",e),D.typeOf.object("transform",t);const i=e.normal,o=e.distance,r=ft.inverseTranspose(t,Us);let s=Xe.fromElements(i.x,i.y,i.z,o,Vs);s=ft.multiplyByVector(r,s,s);const a=K.fromCartesian4(s,Hs);return s=Xe.divideByScalar(s,K.magnitude(a),s),Fs.fromCartesian4(s,n)},Fs.clone=function(e,t){return D.typeOf.object("plane",e),C(t)?(K.clone(e.normal,t.normal),t.distance=e.distance,t):new Fs(e.normal,e.distance)},Fs.equals=function(e,t){return D.typeOf.object("left",e),D.typeOf.object("right",t),e.distance===t.distance&&K.equals(e.normal,t.normal)},Fs.ORIGIN_XY_PLANE=Object.freeze(new Fs(K.UNIT_Z,0)),Fs.ORIGIN_YZ_PLANE=Object.freeze(new Fs(K.UNIT_X,0)),Fs.ORIGIN_ZX_PLANE=Object.freeze(new Fs(K.UNIT_Y,0));var Gs=Fs;function Ws(e,t,n){D.defined("array",e),D.defined("itemToFind",t),D.defined("comparator",n);let i,o,r=0,s=e.length-1;while(r<=s)if(i=~~((r+s)/2),o=n(e[i],t),o<0)r=i+1;else{if(!(o>0))return i;s=i-1}return~(s+1)}var qs=Ws;function js(e,t,n,i,o){this.xPoleWander=e,this.yPoleWander=t,this.xPoleOffset=n,this.yPoleOffset=i,this.ut1MinusUtc=o}var Ys=js;function Ks(e,t,n,i,o,r,s,a){this.year=e,this.month=t,this.day=n,this.hour=i,this.minute=o,this.second=r,this.millisecond=s,this.isLeapSecond=a}var Xs=Ks;function Qs(e){if(null===e||isNaN(e))throw new x("year is required and must be a number.");return e%4===0&&e%100!==0||e%400===0}var Js=Qs;function Zs(e,t){this.julianDate=e,this.offset=t}var $s=Zs;const ea={SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:2400000.5};var ta=Object.freeze(ea);const na={UTC:0,TAI:1};var ia=Object.freeze(na);const oa=new Xs,ra=[31,28,31,30,31,30,31,31,30,31,30,31],sa=29;function aa(e,t){return Ta.compare(e.julianDate,t.julianDate)}const ca=new $s;function la(e){ca.julianDate=e;const t=Ta.leapSeconds;let n=qs(t,ca,aa);n<0&&(n=~n),n>=t.length&&(n=t.length-1);let i=t[n].offset;if(n>0){const o=Ta.secondsDifference(t[n].julianDate,e);o>i&&(n--,i=t[n].offset)}Ta.addSeconds(e,i,e)}function ua(e,t){ca.julianDate=e;const n=Ta.leapSeconds;let i=qs(n,ca,aa);if(i<0&&(i=~i),0===i)return Ta.addSeconds(e,-n[0].offset,t);if(i>=n.length)return Ta.addSeconds(e,-n[i-1].offset,t);const o=Ta.secondsDifference(n[i].julianDate,e);return 0===o?Ta.addSeconds(e,-n[i].offset,t):o<=1?void 0:Ta.addSeconds(e,-n[--i].offset,t)}function ha(e,t,n){const i=t/ta.SECONDS_PER_DAY|0;return e+=i,t-=ta.SECONDS_PER_DAY*i,t<0&&(e--,t+=ta.SECONDS_PER_DAY),n.dayNumber=e,n.secondsOfDay=t,n}function da(e,t,n,i,o,r,s){const a=(t-14)/12|0,c=e+4800+a;let l=(1461*c/4|0)+(367*(t-2-12*a)/12|0)-(3*((c+100)/100|0)/4|0)+n-32075;i-=12,i<0&&(i+=24);const u=r+(i*ta.SECONDS_PER_HOUR+o*ta.SECONDS_PER_MINUTE+s*ta.SECONDS_PER_MILLISECOND);return u>=43200&&(l-=1),[l,u]}const fa=/^(\d{4})$/,pa=/^(\d{4})-(\d{2})$/,ma=/^(\d{4})-?(\d{3})$/,_a=/^(\d{4})-?W(\d{2})-?(\d{1})?$/,ga=/^(\d{4})-?(\d{2})-?(\d{2})$/,ya=/([Z+\-])?(\d{2})?:?(\d{2})?$/,va=/^(\d{2})(\.\d+)?/.source+ya.source,ba=/^(\d{2}):?(\d{2})(\.\d+)?/.source+ya.source,Aa=/^(\d{2}):?(\d{2}):?(\d{2})(\.\d+)?/.source+ya.source,wa="Invalid ISO 8601 date.";function Ta(e,t,n){this.dayNumber=void 0,this.secondsOfDay=void 0,e=R(e,0),t=R(t,0),n=R(n,ia.UTC);const i=0|e;t+=(e-i)*ta.SECONDS_PER_DAY,ha(i,t,this),n===ia.UTC&&la(this)}Ta.fromGregorianDate=function(e,t){if(!(e instanceof Xs))throw new x("date must be a valid GregorianDate.");const n=da(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond);return C(t)?(ha(n[0],n[1],t),la(t),t):new Ta(n[0],n[1],ia.UTC)},Ta.fromDate=function(e,t){if(!(e instanceof Date)||isNaN(e.getTime()))throw new x("date must be a valid JavaScript Date.");const n=da(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds());return C(t)?(ha(n[0],n[1],t),la(t),t):new Ta(n[0],n[1],ia.UTC)},Ta.fromIso8601=function(e,t){if("string"!==typeof e)throw new x(wa);e=e.replace(",",".");let n,i=e.split("T"),o=1,r=1,s=0,a=0,c=0,l=0;const u=i[0],h=i[1];let d,f,p,m;if(!C(u))throw new x(wa);if(i=u.match(ga),null!==i){if(p=u.split("-").length-1,p>0&&2!==p)throw new x(wa);n=+i[1],o=+i[2],r=+i[3]}else if(i=u.match(pa),null!==i)n=+i[1],o=+i[2];else if(i=u.match(fa),null!==i)n=+i[1];else{let e;if(i=u.match(ma),null!==i){if(n=+i[1],e=+i[2],f=Js(n),e<1||f&&e>366||!f&&e>365)throw new x(wa)}else{if(i=u.match(_a),null===i)throw new x(wa);{n=+i[1];const t=+i[2],o=+i[3]||0;if(p=u.split("-").length-1,p>0&&(!C(i[3])&&1!==p||C(i[3])&&2!==p))throw new x(wa);const r=new Date(Date.UTC(n,0,4));e=7*t+o-r.getUTCDay()-3}}d=new Date(Date.UTC(n,0,1)),d.setUTCDate(e),o=d.getUTCMonth()+1,r=d.getUTCDate()}if(f=Js(n),o<1||o>12||r<1||(2!==o||!f)&&r>ra[o-1]||f&&2===o&&r>sa)throw new x(wa);if(C(h)){if(i=h.match(Aa),null!==i){if(p=h.split(":").length-1,p>0&&2!==p&&3!==p)throw new x(wa);s=+i[1],a=+i[2],c=+i[3],l=1e3*+(i[4]||0),m=5}else if(i=h.match(ba),null!==i){if(p=h.split(":").length-1,p>2)throw new x(wa);s=+i[1],a=+i[2],c=60*+(i[3]||0),m=4}else{if(i=h.match(va),null===i)throw new x(wa);s=+i[1],a=60*+(i[2]||0),m=3}if(a>=60||c>=61||s>24||24===s&&(a>0||c>0||l>0))throw new x(wa);const e=i[m],t=+i[m+1],u=+(i[m+2]||0);switch(e){case"+":s-=t,a-=u;break;case"-":s+=t,a+=u;break;case"Z":break;default:a+=new Date(Date.UTC(n,o-1,r,s,a)).getTimezoneOffset();break}}const _=60===c;_&&c--;while(a>=60)a-=60,s++;while(s>=24)s-=24,r++;d=f&&2===o?sa:ra[o-1];while(r>d)r-=d,o++,o>12&&(o-=12,n++),d=f&&2===o?sa:ra[o-1];while(a<0)a+=60,s--;while(s<0)s+=24,r--;while(r<1)o--,o<1&&(o+=12,n--),d=f&&2===o?sa:ra[o-1],r+=d;const g=da(n,o,r,s,a,c,l);return C(t)?(ha(g[0],g[1],t),la(t)):t=new Ta(g[0],g[1],ia.UTC),_&&Ta.addSeconds(t,1,t),t},Ta.now=function(e){return Ta.fromDate(new Date,e)};const Ca=new Ta(0,0,ia.TAI);Ta.toGregorianDate=function(e,t){if(!C(e))throw new x("julianDate is required.");let n=!1,i=ua(e,Ca);C(i)||(Ta.addSeconds(e,-1,Ca),i=ua(Ca,Ca),n=!0);let o=i.dayNumber;const r=i.secondsOfDay;r>=43200&&(o+=1);let s=o+68569|0;const a=4*s/146097|0;s=s-((146097*a+3)/4|0)|0;const c=4e3*(s+1)/1461001|0;s=s-(1461*c/4|0)+31|0;const l=80*s/2447|0,u=s-(2447*l/80|0)|0;s=l/11|0;const h=l+2-12*s|0,d=100*(a-49)+c+s|0;let f=r/ta.SECONDS_PER_HOUR|0,p=r-f*ta.SECONDS_PER_HOUR;const m=p/ta.SECONDS_PER_MINUTE|0;p-=m*ta.SECONDS_PER_MINUTE;let _=0|p;const g=(p-_)/ta.SECONDS_PER_MILLISECOND;return f+=12,f>23&&(f-=24),n&&(_+=1),C(t)?(t.year=d,t.month=h,t.day=u,t.hour=f,t.minute=m,t.second=_,t.millisecond=g,t.isLeapSecond=n,t):new Xs(d,h,u,f,m,_,g,n)},Ta.toDate=function(e){if(!C(e))throw new x("julianDate is required.");const t=Ta.toGregorianDate(e,oa);let n=t.second;return t.isLeapSecond&&(n-=1),new Date(Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,n,t.millisecond))},Ta.toIso8601=function(e,t){if(!C(e))throw new x("julianDate is required.");const n=Ta.toGregorianDate(e,oa);let i=n.year,o=n.month,r=n.day,s=n.hour;const a=n.minute,c=n.second,l=n.millisecond;let u;return 1e4===i&&1===o&&1===r&&0===s&&0===a&&0===c&&0===l&&(i=9999,o=12,r=31,s=24),C(t)||0===l?C(t)&&0!==t?(u=(.01*l).toFixed(t).replace(".","").slice(0,t),`${i.toString().padStart(4,"0")}-${o.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}T${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}.${u}Z`):`${i.toString().padStart(4,"0")}-${o.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}T${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}Z`:(u=(.01*l).toString().replace(".",""),`${i.toString().padStart(4,"0")}-${o.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}T${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}.${u}Z`)},Ta.clone=function(e,t){if(C(e))return C(t)?(t.dayNumber=e.dayNumber,t.secondsOfDay=e.secondsOfDay,t):new Ta(e.dayNumber,e.secondsOfDay,ia.TAI)},Ta.compare=function(e,t){if(!C(e))throw new x("left is required.");if(!C(t))throw new x("right is required.");const n=e.dayNumber-t.dayNumber;return 0!==n?n:e.secondsOfDay-t.secondsOfDay},Ta.equals=function(e,t){return e===t||C(e)&&C(t)&&e.dayNumber===t.dayNumber&&e.secondsOfDay===t.secondsOfDay},Ta.equalsEpsilon=function(e,t,n){return n=R(n,0),e===t||C(e)&&C(t)&&Math.abs(Ta.secondsDifference(e,t))<=n},Ta.totalDays=function(e){if(!C(e))throw new x("julianDate is required.");return e.dayNumber+e.secondsOfDay/ta.SECONDS_PER_DAY},Ta.secondsDifference=function(e,t){if(!C(e))throw new x("left is required.");if(!C(t))throw new x("right is required.");const n=(e.dayNumber-t.dayNumber)*ta.SECONDS_PER_DAY;return n+(e.secondsOfDay-t.secondsOfDay)},Ta.daysDifference=function(e,t){if(!C(e))throw new x("left is required.");if(!C(t))throw new x("right is required.");const n=e.dayNumber-t.dayNumber,i=(e.secondsOfDay-t.secondsOfDay)/ta.SECONDS_PER_DAY;return n+i},Ta.computeTaiMinusUtc=function(e){ca.julianDate=e;const t=Ta.leapSeconds;let n=qs(t,ca,aa);return n<0&&(n=~n,--n,n<0&&(n=0)),t[n].offset},Ta.addSeconds=function(e,t,n){if(!C(e))throw new x("julianDate is required.");if(!C(t))throw new x("seconds is required.");if(!C(n))throw new x("result is required.");return ha(e.dayNumber,e.secondsOfDay+t,n)},Ta.addMinutes=function(e,t,n){if(!C(e))throw new x("julianDate is required.");if(!C(t))throw new x("minutes is required.");if(!C(n))throw new x("result is required.");const i=e.secondsOfDay+t*ta.SECONDS_PER_MINUTE;return ha(e.dayNumber,i,n)},Ta.addHours=function(e,t,n){if(!C(e))throw new x("julianDate is required.");if(!C(t))throw new x("hours is required.");if(!C(n))throw new x("result is required.");const i=e.secondsOfDay+t*ta.SECONDS_PER_HOUR;return ha(e.dayNumber,i,n)},Ta.addDays=function(e,t,n){if(!C(e))throw new x("julianDate is required.");if(!C(t))throw new x("days is required.");if(!C(n))throw new x("result is required.");const i=e.dayNumber+t;return ha(i,e.secondsOfDay,n)},Ta.lessThan=function(e,t){return Ta.compare(e,t)<0},Ta.lessThanOrEquals=function(e,t){return Ta.compare(e,t)<=0},Ta.greaterThan=function(e,t){return Ta.compare(e,t)>0},Ta.greaterThanOrEquals=function(e,t){return Ta.compare(e,t)>=0},Ta.prototype.clone=function(e){return Ta.clone(this,e)},Ta.prototype.equals=function(e){return Ta.equals(this,e)},Ta.prototype.equalsEpsilon=function(e,t){return Ta.equalsEpsilon(this,e,t)},Ta.prototype.toString=function(){return Ta.toIso8601(this)},Ta.leapSeconds=[new $s(new Ta(2441317,43210,ia.TAI),10),new $s(new Ta(2441499,43211,ia.TAI),11),new $s(new Ta(2441683,43212,ia.TAI),12),new $s(new Ta(2442048,43213,ia.TAI),13),new $s(new Ta(2442413,43214,ia.TAI),14),new $s(new Ta(2442778,43215,ia.TAI),15),new $s(new Ta(2443144,43216,ia.TAI),16),new $s(new Ta(2443509,43217,ia.TAI),17),new $s(new Ta(2443874,43218,ia.TAI),18),new $s(new Ta(2444239,43219,ia.TAI),19),new $s(new Ta(2444786,43220,ia.TAI),20),new $s(new Ta(2445151,43221,ia.TAI),21),new $s(new Ta(2445516,43222,ia.TAI),22),new $s(new Ta(2446247,43223,ia.TAI),23),new $s(new Ta(2447161,43224,ia.TAI),24),new $s(new Ta(2447892,43225,ia.TAI),25),new $s(new Ta(2448257,43226,ia.TAI),26),new $s(new Ta(2448804,43227,ia.TAI),27),new $s(new Ta(2449169,43228,ia.TAI),28),new $s(new Ta(2449534,43229,ia.TAI),29),new $s(new Ta(2450083,43230,ia.TAI),30),new $s(new Ta(2450630,43231,ia.TAI),31),new $s(new Ta(2451179,43232,ia.TAI),32),new $s(new Ta(2453736,43233,ia.TAI),33),new $s(new Ta(2454832,43234,ia.TAI),34),new $s(new Ta(2456109,43235,ia.TAI),35),new $s(new Ta(2457204,43236,ia.TAI),36),new $s(new Ta(2457754,43237,ia.TAI),37)];var Ea=Ta;function xa(e){if(e=R(e,R.EMPTY_OBJECT),this._dates=void 0,this._samples=void 0,this._dateColumn=-1,this._xPoleWanderRadiansColumn=-1,this._yPoleWanderRadiansColumn=-1,this._ut1MinusUtcSecondsColumn=-1,this._xCelestialPoleOffsetRadiansColumn=-1,this._yCelestialPoleOffsetRadiansColumn=-1,this._taiMinusUtcSecondsColumn=-1,this._columnCount=0,this._lastIndex=-1,this._downloadPromise=void 0,this._dataError=void 0,this._addNewLeapSeconds=R(e.addNewLeapSeconds,!0),C(e.data))Ia(this,e.data);else if(C(e.url)){const t=Vi.createIfNeeded(e.url),n=this;this._downloadPromise=t.fetchJson().then((function(e){Ia(n,e)})).catch((function(){n._dataError=`An error occurred while retrieving the EOP data from the URL ${t.url}.`}))}else Ia(this,{columnNames:["dateIso8601","modifiedJulianDateUtc","xPoleWanderRadians","yPoleWanderRadians","ut1MinusUtcSeconds","lengthOfDayCorrectionSeconds","xCelestialPoleOffsetRadians","yCelestialPoleOffsetRadians","taiMinusUtcSeconds"],samples:[]})}function Sa(e,t){return Ea.compare(e.julianDate,t)}function Ia(e,t){if(!C(t.columnNames))return void(e._dataError="Error in loaded EOP data: The columnNames property is required.");if(!C(t.samples))return void(e._dataError="Error in loaded EOP data: The samples property is required.");const n=t.columnNames.indexOf("modifiedJulianDateUtc"),i=t.columnNames.indexOf("xPoleWanderRadians"),o=t.columnNames.indexOf("yPoleWanderRadians"),r=t.columnNames.indexOf("ut1MinusUtcSeconds"),s=t.columnNames.indexOf("xCelestialPoleOffsetRadians"),a=t.columnNames.indexOf("yCelestialPoleOffsetRadians"),c=t.columnNames.indexOf("taiMinusUtcSeconds");if(n<0||i<0||o<0||r<0||s<0||a<0||c<0)return void(e._dataError="Error in loaded EOP data: The columnNames property must include modifiedJulianDateUtc, xPoleWanderRadians, yPoleWanderRadians, ut1MinusUtcSeconds, xCelestialPoleOffsetRadians, yCelestialPoleOffsetRadians, and taiMinusUtcSeconds columns");const l=e._samples=t.samples,u=e._dates=[];let h;e._dateColumn=n,e._xPoleWanderRadiansColumn=i,e._yPoleWanderRadiansColumn=o,e._ut1MinusUtcSecondsColumn=r,e._xCelestialPoleOffsetRadiansColumn=s,e._yCelestialPoleOffsetRadiansColumn=a,e._taiMinusUtcSecondsColumn=c,e._columnCount=t.columnNames.length,e._lastIndex=void 0;const d=e._addNewLeapSeconds;for(let f=0,p=l.length;f<p;f+=e._columnCount){const e=l[f+n],t=l[f+c],i=e+ta.MODIFIED_JULIAN_DATE_DIFFERENCE,o=new Ea(i,t,ia.TAI);if(u.push(o),d){if(t!==h&&C(h)){const e=Ea.leapSeconds,n=qs(e,o,Sa);if(n<0){const i=new $s(o,t);e.splice(~n,0,i)}}h=t}}}function Oa(e,t,n,i,o){const r=n*i;o.xPoleWander=t[r+e._xPoleWanderRadiansColumn],o.yPoleWander=t[r+e._yPoleWanderRadiansColumn],o.xPoleOffset=t[r+e._xCelestialPoleOffsetRadiansColumn],o.yPoleOffset=t[r+e._yCelestialPoleOffsetRadiansColumn],o.ut1MinusUtc=t[r+e._ut1MinusUtcSecondsColumn]}function Da(e,t,n){return t+e*(n-t)}function Pa(e,t,n,i,o,r,s){const a=e._columnCount;if(r>t.length-1)return s.xPoleWander=0,s.yPoleWander=0,s.xPoleOffset=0,s.yPoleOffset=0,s.ut1MinusUtc=0,s;const c=t[o],l=t[r];if(c.equals(l)||i.equals(c))return Oa(e,n,o,a,s),s;if(i.equals(l))return Oa(e,n,r,a,s),s;const u=Ea.secondsDifference(i,c)/Ea.secondsDifference(l,c),h=o*a,d=r*a;let f=n[h+e._ut1MinusUtcSecondsColumn],p=n[d+e._ut1MinusUtcSecondsColumn];const m=p-f;if(m>.5||m<-.5){const t=n[h+e._taiMinusUtcSecondsColumn],o=n[d+e._taiMinusUtcSecondsColumn];t!==o&&(l.equals(i)?f=p:p-=o-t)}return s.xPoleWander=Da(u,n[h+e._xPoleWanderRadiansColumn],n[d+e._xPoleWanderRadiansColumn]),s.yPoleWander=Da(u,n[h+e._yPoleWanderRadiansColumn],n[d+e._yPoleWanderRadiansColumn]),s.xPoleOffset=Da(u,n[h+e._xCelestialPoleOffsetRadiansColumn],n[d+e._xCelestialPoleOffsetRadiansColumn]),s.yPoleOffset=Da(u,n[h+e._yCelestialPoleOffsetRadiansColumn],n[d+e._yCelestialPoleOffsetRadiansColumn]),s.ut1MinusUtc=Da(u,f,p),s}xa.NONE=Object.freeze({getPromiseToLoad:function(){return Promise.resolve()},compute:function(e,t){return C(t)?(t.xPoleWander=0,t.yPoleWander=0,t.xPoleOffset=0,t.yPoleOffset=0,t.ut1MinusUtc=0):t=new Ys(0,0,0,0,0),t}}),xa.prototype.getPromiseToLoad=function(){return Promise.resolve(this._downloadPromise)},xa.prototype.compute=function(e,t){if(!C(this._samples)){if(C(this._dataError))throw new Je(this._dataError);return}if(C(t)||(t=new Ys(0,0,0,0,0)),0===this._samples.length)return t.xPoleWander=0,t.yPoleWander=0,t.xPoleOffset=0,t.yPoleOffset=0,t.ut1MinusUtc=0,t;const n=this._dates,i=this._lastIndex;let o=0,r=0;if(C(i)){const s=n[i],a=n[i+1],c=Ea.lessThanOrEquals(s,e),l=!C(a),u=l||Ea.greaterThanOrEquals(a,e);if(c&&u)return o=i,!l&&a.equals(e)&&++o,r=o+1,Pa(this,n,this._samples,e,o,r,t),t}let s=qs(n,e,Ea.compare,this._dateColumn);return s>=0?(s<n.length-1&&n[s+1].equals(e)&&++s,o=s,r=s):(r=~s,o=r-1,o<0&&(o=0)),this._lastIndex=o,Pa(this,n,this._samples,e,o,r,t),t};var Ra=xa;function La(e,t,n){this.heading=R(e,0),this.pitch=R(t,0),this.roll=R(n,0)}La.fromQuaternion=function(e,t){if(!C(e))throw new x("quaternion is required");C(t)||(t=new La);const n=2*(e.w*e.y-e.z*e.x),i=1-2*(e.x*e.x+e.y*e.y),o=2*(e.w*e.x+e.y*e.z),r=1-2*(e.y*e.y+e.z*e.z),s=2*(e.w*e.z+e.x*e.y);return t.heading=-Math.atan2(s,r),t.roll=Math.atan2(o,i),t.pitch=-z.asinClamped(n),t},La.fromDegrees=function(e,t,n,i){if(!C(e))throw new x("heading is required");if(!C(t))throw new x("pitch is required");if(!C(n))throw new x("roll is required");return C(i)||(i=new La),i.heading=e*z.RADIANS_PER_DEGREE,i.pitch=t*z.RADIANS_PER_DEGREE,i.roll=n*z.RADIANS_PER_DEGREE,i},La.clone=function(e,t){if(C(e))return C(t)?(t.heading=e.heading,t.pitch=e.pitch,t.roll=e.roll,t):new La(e.heading,e.pitch,e.roll)},La.equals=function(e,t){return e===t||C(e)&&C(t)&&e.heading===t.heading&&e.pitch===t.pitch&&e.roll===t.roll},La.equalsEpsilon=function(e,t,n,i){return e===t||C(e)&&C(t)&&z.equalsEpsilon(e.heading,t.heading,n,i)&&z.equalsEpsilon(e.pitch,t.pitch,n,i)&&z.equalsEpsilon(e.roll,t.roll,n,i)},La.prototype.clone=function(e){return La.clone(this,e)},La.prototype.equals=function(e){return La.equals(this,e)},La.prototype.equalsEpsilon=function(e,t,n){return La.equalsEpsilon(this,e,t,n)},La.prototype.toString=function(){return`(${this.heading}, ${this.pitch}, ${this.roll})`};var Ma=La;function Ba(e,t,n){this.x=e,this.y=t,this.s=n}var Na=Ba;function Fa(e){e=R(e,R.EMPTY_OBJECT),this._xysFileUrlTemplate=Vi.createIfNeeded(e.xysFileUrlTemplate),this._interpolationOrder=R(e.interpolationOrder,9),this._sampleZeroJulianEphemerisDate=R(e.sampleZeroJulianEphemerisDate,2442396.5),this._sampleZeroDateTT=new Ea(this._sampleZeroJulianEphemerisDate,0,ia.TAI),this._stepSizeDays=R(e.stepSizeDays,1),this._samplesPerXysFile=R(e.samplesPerXysFile,1e3),this._totalSamples=R(e.totalSamples,27426),this._samples=new Array(3*this._totalSamples),this._chunkDownloadsInProgress=[];const t=this._interpolationOrder,n=this._denominators=new Array(t+1),i=this._xTable=new Array(t+1),o=Math.pow(this._stepSizeDays,t);for(let r=0;r<=t;++r){n[r]=o,i[r]=r*this._stepSizeDays;for(let e=0;e<=t;++e)e!==r&&(n[r]*=r-e);n[r]=1/n[r]}this._work=new Array(t+1),this._coef=new Array(t+1)}const za=new Ea(0,0,ia.TAI);function ka(e,t,n){const i=za;return i.dayNumber=t,i.secondsOfDay=n,Ea.daysDifference(i,e._sampleZeroDateTT)}function Ua(e,t){if(e._chunkDownloadsInProgress[t])return e._chunkDownloadsInProgress[t];const n=yn();let i;e._chunkDownloadsInProgress[t]=n;const o=e._xysFileUrlTemplate;return i=C(o)?o.getDerivedResource({templateValues:{0:t}}):new Vi({url:Zi(`Assets/IAU2006_XYS/IAU2006_XYS_${t}.json`)}),i.fetchJson().then((function(i){e._chunkDownloadsInProgress[t]=!1;const o=e._samples,r=i.samples,s=t*e._samplesPerXysFile*3;for(let e=0,t=r.length;e<t;++e)o[s+e]=r[e];n.resolve()})),n.promise}Fa.prototype.preload=function(e,t,n,i){const o=ka(this,e,t),r=ka(this,n,i);let s=o/this._stepSizeDays-this._interpolationOrder/2|0;s<0&&(s=0);let a=r/this._stepSizeDays-this._interpolationOrder/2|0+this._interpolationOrder;a>=this._totalSamples&&(a=this._totalSamples-1);const c=s/this._samplesPerXysFile|0,l=a/this._samplesPerXysFile|0,u=[];for(let h=c;h<=l;++h)u.push(Ua(this,h));return Promise.all(u)},Fa.prototype.computeXysRadians=function(e,t,n){const i=ka(this,e,t);if(i<0)return;const o=i/this._stepSizeDays|0;if(o>=this._totalSamples)return;const r=this._interpolationOrder;let s=o-(r/2|0);s<0&&(s=0);let a=s+r;a>=this._totalSamples&&(a=this._totalSamples-1,s=a-r,s<0&&(s=0));let c=!1;const l=this._samples;if(C(l[3*s])||(Ua(this,s/this._samplesPerXysFile|0),c=!0),C(l[3*a])||(Ua(this,a/this._samplesPerXysFile|0),c=!0),c)return;C(n)?(n.x=0,n.y=0,n.s=0):n=new Na(0,0,0);const u=i-s*this._stepSizeDays,h=this._work,d=this._denominators,f=this._coef,p=this._xTable;let m,_;for(m=0;m<=r;++m)h[m]=u-p[m];for(m=0;m<=r;++m){for(f[m]=1,_=0;_<=r;++_)_!==m&&(f[m]*=h[_]);f[m]*=d[m];let e=3*(s+m);n.x+=f[m]*l[e++],n.y+=f[m]*l[e++],n.s+=f[m]*l[e]}return n};var Va=Fa;let Ha;const Ga={requestFullscreen:void 0,exitFullscreen:void 0,fullscreenEnabled:void 0,fullscreenElement:void 0,fullscreenchange:void 0,fullscreenerror:void 0},Wa={};Object.defineProperties(Wa,{element:{get:function(){if(Wa.supportsFullscreen())return document[Ga.fullscreenElement]}},changeEventName:{get:function(){if(Wa.supportsFullscreen())return Ga.fullscreenchange}},errorEventName:{get:function(){if(Wa.supportsFullscreen())return Ga.fullscreenerror}},enabled:{get:function(){if(Wa.supportsFullscreen())return document[Ga.fullscreenEnabled]}},fullscreen:{get:function(){if(Wa.supportsFullscreen())return null!==Wa.element}}}),Wa.supportsFullscreen=function(){if(C(Ha))return Ha;Ha=!1;const e=document.body;if("function"===typeof e.requestFullscreen)return Ga.requestFullscreen="requestFullscreen",Ga.exitFullscreen="exitFullscreen",Ga.fullscreenEnabled="fullscreenEnabled",Ga.fullscreenElement="fullscreenElement",Ga.fullscreenchange="fullscreenchange",Ga.fullscreenerror="fullscreenerror",Ha=!0,Ha;const t=["webkit","moz","o","ms","khtml"];let n;for(let i=0,o=t.length;i<o;++i){const o=t[i];n=`${o}RequestFullscreen`,"function"===typeof e[n]?(Ga.requestFullscreen=n,Ha=!0):(n=`${o}RequestFullScreen`,"function"===typeof e[n]&&(Ga.requestFullscreen=n,Ha=!0)),n=`${o}ExitFullscreen`,"function"===typeof document[n]?Ga.exitFullscreen=n:(n=`${o}CancelFullScreen`,"function"===typeof document[n]&&(Ga.exitFullscreen=n)),n=`${o}FullscreenEnabled`,void 0!==document[n]?Ga.fullscreenEnabled=n:(n=`${o}FullScreenEnabled`,void 0!==document[n]&&(Ga.fullscreenEnabled=n)),n=`${o}FullscreenElement`,void 0!==document[n]?Ga.fullscreenElement=n:(n=`${o}FullScreenElement`,void 0!==document[n]&&(Ga.fullscreenElement=n)),n=`${o}fullscreenchange`,void 0!==document[`on${n}`]&&("ms"===o&&(n="MSFullscreenChange"),Ga.fullscreenchange=n),n=`${o}fullscreenerror`,void 0!==document[`on${n}`]&&("ms"===o&&(n="MSFullscreenError"),Ga.fullscreenerror=n)}return Ha},Wa.requestFullscreen=function(e,t){Wa.supportsFullscreen()&&e[Ga.requestFullscreen]({vrDisplay:t})},Wa.exitFullscreen=function(){Wa.supportsFullscreen()&&document[Ga.exitFullscreen]()},Wa._names=Ga;var qa=Wa;let ja,Ya,Ka,Xa,Qa,Ja,Za,$a,ec,tc,nc,ic,oc,rc,sc,ac,cc;function lc(e){const t=e.split(".");for(let n=0,i=t.length;n<i;++n)t[n]=parseInt(t[n],10);return t}function uc(){if(!C(Ya)&&(Ya=!1,!yc())){const e=/ Chrome\/([\.0-9]+)/.exec(ja.userAgent);null!==e&&(Ya=!0,Ka=lc(e[1]))}return Ya}function hc(){return uc()&&Ka}function dc(){if(!C(Xa)&&(Xa=!1,!uc()&&!yc()&&/ Safari\/[\.0-9]+/.test(ja.userAgent))){const e=/ Version\/([\.0-9]+)/.exec(ja.userAgent);null!==e&&(Xa=!0,Qa=lc(e[1]))}return Xa}function fc(){return dc()&&Qa}function pc(){if(!C(Ja)){Ja=!1;const e=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(ja.userAgent);null!==e&&(Ja=!0,Za=lc(e[1]),Za.isNightly=!!e[2])}return Ja}function mc(){return pc()&&Za}function _c(){if(!C($a)){let e;$a=!1,"Microsoft Internet Explorer"===ja.appName?(e=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(ja.userAgent),null!==e&&($a=!0,ec=lc(e[1]))):"Netscape"===ja.appName&&(e=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(ja.userAgent),null!==e&&($a=!0,ec=lc(e[1])))}return $a}function gc(){return _c()&&ec}function yc(){if(!C(tc)){tc=!1;const e=/ Edge\/([\.0-9]+)/.exec(ja.userAgent);null!==e&&(tc=!0,nc=lc(e[1]))}return tc}function vc(){return yc()&&nc}function bc(){if(!C(ic)){ic=!1;const e=/Firefox\/([\.0-9]+)/.exec(ja.userAgent);null!==e&&(ic=!0,oc=lc(e[1]))}return ic}function Ac(){return C(rc)||(rc=/Windows/i.test(ja.appVersion)),rc}function wc(){return bc()&&oc}function Tc(){return C(sc)||(sc=!bc()&&"undefined"!==typeof PointerEvent&&(!C(ja.pointerEnabled)||ja.pointerEnabled)),sc}function Cc(){if(!C(cc)){const e=document.createElement("canvas");e.setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;");const t=e.style.imageRendering;cc=C(t)&&""!==t,cc&&(ac=t)}return cc}function Ec(){return Cc()?ac:void 0}function xc(){if(!xc.initialized)throw new x("You must call FeatureDetection.supportsWebP.initialize and wait for the promise to resolve before calling FeatureDetection.supportsWebP");return xc._result}ja="undefined"!==typeof navigator?navigator:{},xc._promise=void 0,xc._result=void 0,xc.initialize=function(){if(C(xc._promise))return xc._promise;const e=yn();if(xc._promise=e.promise,yc())return xc._result=!1,e.resolve(xc._result),e.promise;const t=new Image;return t.onload=function(){xc._result=t.width>0&&t.height>0,e.resolve(xc._result)},t.onerror=function(){xc._result=!1,e.resolve(xc._result)},t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.promise},Object.defineProperties(xc,{initialized:{get:function(){return C(xc._result)}}});const Sc=[];"undefined"!==typeof ArrayBuffer&&(Sc.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),"undefined"!==typeof Uint8ClampedArray&&Sc.push(Uint8ClampedArray),"undefined"!==typeof Uint8ClampedArray&&Sc.push(Uint8ClampedArray),"undefined"!==typeof BigInt64Array&&Sc.push(BigInt64Array),"undefined"!==typeof BigUint64Array&&Sc.push(BigUint64Array));const Ic={isChrome:uc,chromeVersion:hc,isSafari:dc,safariVersion:fc,isWebkit:pc,webkitVersion:mc,isInternetExplorer:_c,internetExplorerVersion:gc,isEdge:yc,edgeVersion:vc,isFirefox:bc,firefoxVersion:wc,isWindows:Ac,hardwareConcurrency:R(ja.hardwareConcurrency,3),supportsPointerEvents:Tc,supportsImageRenderingPixelated:Cc,supportsWebP:xc,imageRenderingValue:Ec,typedArrayTypes:Sc,supportsBasis:function(e){return Ic.supportsWebAssembly()&&e.context.supportsBasis},supportsFullscreen:function(){return qa.supportsFullscreen()},supportsTypedArrays:function(){return"undefined"!==typeof ArrayBuffer},supportsBigInt64Array:function(){return"undefined"!==typeof BigInt64Array},supportsBigUint64Array:function(){return"undefined"!==typeof BigUint64Array},supportsBigInt:function(){return"undefined"!==typeof BigInt},supportsWebWorkers:function(){return"undefined"!==typeof Worker},supportsWebAssembly:function(){return"undefined"!==typeof WebAssembly&&!Ic.isEdge()}};var Oc=Ic;function Dc(e,t,n,i){this.x=R(e,0),this.y=R(t,0),this.z=R(n,0),this.w=R(i,0)}let Pc=new K;Dc.fromAxisAngle=function(e,t,n){D.typeOf.object("axis",e),D.typeOf.number("angle",t);const i=t/2,o=Math.sin(i);Pc=K.normalize(e,Pc);const r=Pc.x*o,s=Pc.y*o,a=Pc.z*o,c=Math.cos(i);return C(n)?(n.x=r,n.y=s,n.z=a,n.w=c,n):new Dc(r,s,a,c)};const Rc=[1,2,0],Lc=new Array(3);Dc.fromRotationMatrix=function(e,t){let n,i,o,r,s;D.typeOf.object("matrix",e);const a=e[ke.COLUMN0ROW0],c=e[ke.COLUMN1ROW1],l=e[ke.COLUMN2ROW2],u=a+c+l;if(u>0)n=Math.sqrt(u+1),s=.5*n,n=.5/n,i=(e[ke.COLUMN1ROW2]-e[ke.COLUMN2ROW1])*n,o=(e[ke.COLUMN2ROW0]-e[ke.COLUMN0ROW2])*n,r=(e[ke.COLUMN0ROW1]-e[ke.COLUMN1ROW0])*n;else{const t=Rc;let u=0;c>a&&(u=1),l>a&&l>c&&(u=2);const h=t[u],d=t[h];n=Math.sqrt(e[ke.getElementIndex(u,u)]-e[ke.getElementIndex(h,h)]-e[ke.getElementIndex(d,d)]+1);const f=Lc;f[u]=.5*n,n=.5/n,s=(e[ke.getElementIndex(d,h)]-e[ke.getElementIndex(h,d)])*n,f[h]=(e[ke.getElementIndex(h,u)]+e[ke.getElementIndex(u,h)])*n,f[d]=(e[ke.getElementIndex(d,u)]+e[ke.getElementIndex(u,d)])*n,i=-f[0],o=-f[1],r=-f[2]}return C(t)?(t.x=i,t.y=o,t.z=r,t.w=s,t):new Dc(i,o,r,s)};const Mc=new Dc;let Bc=new Dc,Nc=new Dc,Fc=new Dc;Dc.fromHeadingPitchRoll=function(e,t){return D.typeOf.object("headingPitchRoll",e),Fc=Dc.fromAxisAngle(K.UNIT_X,e.roll,Mc),Nc=Dc.fromAxisAngle(K.UNIT_Y,-e.pitch,t),t=Dc.multiply(Nc,Fc,Nc),Bc=Dc.fromAxisAngle(K.UNIT_Z,-e.heading,Mc),Dc.multiply(Bc,t,t)};const zc=new K,kc=new K,Uc=new Dc,Vc=new Dc,Hc=new Dc;Dc.packedLength=4,Dc.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.z,t[n]=e.w,t},Dc.unpack=function(e,t,n){return D.defined("array",e),t=R(t,0),C(n)||(n=new Dc),n.x=e[t],n.y=e[t+1],n.z=e[t+2],n.w=e[t+3],n},Dc.packedInterpolationLength=3,Dc.convertPackedArrayForInterpolation=function(e,t,n,i){Dc.unpack(e,4*n,Hc),Dc.conjugate(Hc,Hc);for(let o=0,r=n-t+1;o<r;o++){const n=3*o;Dc.unpack(e,4*(t+o),Uc),Dc.multiply(Uc,Hc,Uc),Uc.w<0&&Dc.negate(Uc,Uc),Dc.computeAxis(Uc,zc);const r=Dc.computeAngle(Uc);C(i)||(i=[]),i[n]=zc.x*r,i[n+1]=zc.y*r,i[n+2]=zc.z*r}},Dc.unpackInterpolationResult=function(e,t,n,i,o){C(o)||(o=new Dc),K.fromArray(e,0,kc);const r=K.magnitude(kc);return Dc.unpack(t,4*i,Vc),0===r?Dc.clone(Dc.IDENTITY,Uc):Dc.fromAxisAngle(kc,r,Uc),Dc.multiply(Uc,Vc,o)},Dc.clone=function(e,t){if(C(e))return C(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t):new Dc(e.x,e.y,e.z,e.w)},Dc.conjugate=function(e,t){return D.typeOf.object("quaternion",e),D.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t},Dc.magnitudeSquared=function(e){return D.typeOf.object("quaternion",e),e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},Dc.magnitude=function(e){return Math.sqrt(Dc.magnitudeSquared(e))},Dc.normalize=function(e,t){D.typeOf.object("result",t);const n=1/Dc.magnitude(e),i=e.x*n,o=e.y*n,r=e.z*n,s=e.w*n;return t.x=i,t.y=o,t.z=r,t.w=s,t},Dc.inverse=function(e,t){D.typeOf.object("result",t);const n=Dc.magnitudeSquared(e);return t=Dc.conjugate(e,t),Dc.multiplyByScalar(t,1/n,t)},Dc.add=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w,n},Dc.subtract=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n.w=e.w-t.w,n},Dc.negate=function(e,t){return D.typeOf.object("quaternion",e),D.typeOf.object("result",t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},Dc.dot=function(e,t){return D.typeOf.object("left",e),D.typeOf.object("right",t),e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},Dc.multiply=function(e,t,n){D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n);const i=e.x,o=e.y,r=e.z,s=e.w,a=t.x,c=t.y,l=t.z,u=t.w,h=s*a+i*u+o*l-r*c,d=s*c-i*l+o*u+r*a,f=s*l+i*c-o*a+r*u,p=s*u-i*a-o*c-r*l;return n.x=h,n.y=d,n.z=f,n.w=p,n},Dc.multiplyByScalar=function(e,t,n){return D.typeOf.object("quaternion",e),D.typeOf.number("scalar",t),D.typeOf.object("result",n),n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t,n},Dc.divideByScalar=function(e,t,n){return D.typeOf.object("quaternion",e),D.typeOf.number("scalar",t),D.typeOf.object("result",n),n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n.w=e.w/t,n},Dc.computeAxis=function(e,t){D.typeOf.object("quaternion",e),D.typeOf.object("result",t);const n=e.w;if(Math.abs(n-1)<z.EPSILON6)return t.x=t.y=t.z=0,t;const i=1/Math.sqrt(1-n*n);return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t},Dc.computeAngle=function(e){return D.typeOf.object("quaternion",e),Math.abs(e.w-1)<z.EPSILON6?0:2*Math.acos(e.w)};let Gc=new Dc;Dc.lerp=function(e,t,n,i){return D.typeOf.object("start",e),D.typeOf.object("end",t),D.typeOf.number("t",n),D.typeOf.object("result",i),Gc=Dc.multiplyByScalar(t,n,Gc),i=Dc.multiplyByScalar(e,1-n,i),Dc.add(Gc,i,i)};let Wc=new Dc,qc=new Dc,jc=new Dc;Dc.slerp=function(e,t,n,i){D.typeOf.object("start",e),D.typeOf.object("end",t),D.typeOf.number("t",n),D.typeOf.object("result",i);let o=Dc.dot(e,t),r=t;if(o<0&&(o=-o,r=Wc=Dc.negate(t,Wc)),1-o<z.EPSILON6)return Dc.lerp(e,r,n,i);const s=Math.acos(o);return qc=Dc.multiplyByScalar(e,Math.sin((1-n)*s),qc),jc=Dc.multiplyByScalar(r,Math.sin(n*s),jc),i=Dc.add(qc,jc,i),Dc.multiplyByScalar(i,1/Math.sin(s),i)},Dc.log=function(e,t){D.typeOf.object("quaternion",e),D.typeOf.object("result",t);const n=z.acosClamped(e.w);let i=0;return 0!==n&&(i=n/Math.sin(n)),K.multiplyByScalar(e,i,t)},Dc.exp=function(e,t){D.typeOf.object("cartesian",e),D.typeOf.object("result",t);const n=K.magnitude(e);let i=0;return 0!==n&&(i=Math.sin(n)/n),t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=Math.cos(n),t};const Yc=new K,Kc=new K,Xc=new Dc,Qc=new Dc;Dc.computeInnerQuadrangle=function(e,t,n,i){D.typeOf.object("q0",e),D.typeOf.object("q1",t),D.typeOf.object("q2",n),D.typeOf.object("result",i);const o=Dc.conjugate(t,Xc);Dc.multiply(o,n,Qc);const r=Dc.log(Qc,Yc);Dc.multiply(o,e,Qc);const s=Dc.log(Qc,Kc);return K.add(r,s,r),K.multiplyByScalar(r,.25,r),K.negate(r,r),Dc.exp(r,Xc),Dc.multiply(t,Xc,i)},Dc.squad=function(e,t,n,i,o,r){D.typeOf.object("q0",e),D.typeOf.object("q1",t),D.typeOf.object("s0",n),D.typeOf.object("s1",i),D.typeOf.number("t",o),D.typeOf.object("result",r);const s=Dc.slerp(e,t,o,Xc),a=Dc.slerp(n,i,o,Qc);return Dc.slerp(s,a,2*o*(1-o),r)};const Jc=new Dc,Zc=1.9011074535173003,$c=Oc.supportsTypedArrays()?new Float32Array(8):[],el=Oc.supportsTypedArrays()?new Float32Array(8):[],tl=Oc.supportsTypedArrays()?new Float32Array(8):[],nl=Oc.supportsTypedArrays()?new Float32Array(8):[];for(let ko=0;ko<7;++ko){const e=ko+1,t=2*e+1;$c[ko]=1/(e*t),el[ko]=e/t}$c[7]=Zc/136,el[7]=8*Zc/17,Dc.fastSlerp=function(e,t,n,i){D.typeOf.object("start",e),D.typeOf.object("end",t),D.typeOf.number("t",n),D.typeOf.object("result",i);let o,r=Dc.dot(e,t);r>=0?o=1:(o=-1,r=-r);const s=r-1,a=1-n,c=n*n,l=a*a;for(let f=7;f>=0;--f)tl[f]=($c[f]*c-el[f])*s,nl[f]=($c[f]*l-el[f])*s;const u=o*n*(1+tl[0]*(1+tl[1]*(1+tl[2]*(1+tl[3]*(1+tl[4]*(1+tl[5]*(1+tl[6]*(1+tl[7])))))))),h=a*(1+nl[0]*(1+nl[1]*(1+nl[2]*(1+nl[3]*(1+nl[4]*(1+nl[5]*(1+nl[6]*(1+nl[7])))))))),d=Dc.multiplyByScalar(e,h,Jc);return Dc.multiplyByScalar(t,u,i),Dc.add(d,i,i)},Dc.fastSquad=function(e,t,n,i,o,r){D.typeOf.object("q0",e),D.typeOf.object("q1",t),D.typeOf.object("s0",n),D.typeOf.object("s1",i),D.typeOf.number("t",o),D.typeOf.object("result",r);const s=Dc.fastSlerp(e,t,o,Xc),a=Dc.fastSlerp(n,i,o,Qc);return Dc.fastSlerp(s,a,2*o*(1-o),r)},Dc.equals=function(e,t){return e===t||C(e)&&C(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},Dc.equalsEpsilon=function(e,t,n){return n=R(n,0),e===t||C(e)&&C(t)&&Math.abs(e.x-t.x)<=n&&Math.abs(e.y-t.y)<=n&&Math.abs(e.z-t.z)<=n&&Math.abs(e.w-t.w)<=n},Dc.ZERO=Object.freeze(new Dc(0,0,0,0)),Dc.IDENTITY=Object.freeze(new Dc(0,0,0,1)),Dc.prototype.clone=function(e){return Dc.clone(this,e)},Dc.prototype.equals=function(e){return Dc.equals(this,e)},Dc.prototype.equalsEpsilon=function(e,t){return Dc.equalsEpsilon(this,e,t)},Dc.prototype.toString=function(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`};var il=Dc;const ol={},rl={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},sl={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},al={},cl={east:new K,north:new K,up:new K,west:new K,south:new K,down:new K};let ll=new K,ul=new K,hl=new K;ol.localFrameToFixedFrameGenerator=function(e,t){if(!rl.hasOwnProperty(e)||!rl[e].hasOwnProperty(t))throw new x("firstAxis and secondAxis must be east, north, up, west, south or down.");const n=rl[e][t];let i;const o=e+t;return C(al[o])?i=al[o]:(i=function(i,o,r){if(!C(i))throw new x("origin is required.");if(C(r)||(r=new ft),K.equalsEpsilon(i,K.ZERO,z.EPSILON14))K.unpack(sl[e],0,ll),K.unpack(sl[t],0,ul),K.unpack(sl[n],0,hl);else if(z.equalsEpsilon(i.x,0,z.EPSILON14)&&z.equalsEpsilon(i.y,0,z.EPSILON14)){const o=z.sign(i.z);K.unpack(sl[e],0,ll),"east"!==e&&"west"!==e&&K.multiplyByScalar(ll,o,ll),K.unpack(sl[t],0,ul),"east"!==t&&"west"!==t&&K.multiplyByScalar(ul,o,ul),K.unpack(sl[n],0,hl),"east"!==n&&"west"!==n&&K.multiplyByScalar(hl,o,hl)}else{o=R(o,ge.WGS84),o.geodeticSurfaceNormal(i,cl.up);const r=cl.up,s=cl.east;s.x=-i.y,s.y=i.x,s.z=0,K.normalize(s,cl.east),K.cross(r,s,cl.north),K.multiplyByScalar(cl.up,-1,cl.down),K.multiplyByScalar(cl.east,-1,cl.west),K.multiplyByScalar(cl.north,-1,cl.south),ll=cl[e],ul=cl[t],hl=cl[n]}return r[0]=ll.x,r[1]=ll.y,r[2]=ll.z,r[3]=0,r[4]=ul.x,r[5]=ul.y,r[6]=ul.z,r[7]=0,r[8]=hl.x,r[9]=hl.y,r[10]=hl.z,r[11]=0,r[12]=i.x,r[13]=i.y,r[14]=i.z,r[15]=1,r},al[o]=i),i},ol.eastNorthUpToFixedFrame=ol.localFrameToFixedFrameGenerator("east","north"),ol.northEastDownToFixedFrame=ol.localFrameToFixedFrameGenerator("north","east"),ol.northUpEastToFixedFrame=ol.localFrameToFixedFrameGenerator("north","up"),ol.northWestUpToFixedFrame=ol.localFrameToFixedFrameGenerator("north","west");const dl=new il,fl=new K(1,1,1),pl=new ft;ol.headingPitchRollToFixedFrame=function(e,t,n,i,o){D.typeOf.object("HeadingPitchRoll",t),i=R(i,ol.eastNorthUpToFixedFrame);const r=il.fromHeadingPitchRoll(t,dl),s=ft.fromTranslationQuaternionRotationScale(K.ZERO,r,fl,pl);return o=i(e,n,o),ft.multiply(o,s,o)};const ml=new ft,_l=new ke;ol.headingPitchRollQuaternion=function(e,t,n,i,o){D.typeOf.object("HeadingPitchRoll",t);const r=ol.headingPitchRollToFixedFrame(e,t,n,i,ml),s=ft.getMatrix3(r,_l);return il.fromRotationMatrix(s,o)};const gl=new K(1,1,1),yl=new K,vl=new ft,bl=new ft,Al=new ke,wl=new il;ol.fixedFrameToHeadingPitchRoll=function(e,t,n,i){D.defined("transform",e),t=R(t,ge.WGS84),n=R(n,ol.eastNorthUpToFixedFrame),C(i)||(i=new Ma);const o=ft.getTranslation(e,yl);if(K.equals(o,K.ZERO))return i.heading=0,i.pitch=0,i.roll=0,i;let r=ft.inverseTransformation(n(o,t,vl),vl),s=ft.setScale(e,gl,bl);s=ft.setTranslation(s,K.ZERO,s),r=ft.multiply(r,s,r);let a=il.fromRotationMatrix(ft.getMatrix3(r,Al),wl);return a=il.normalize(a,a),Ma.fromQuaternion(a,i)};const Tl=24110.54841,Cl=8640184.812866,El=.093104,xl=-62e-7,Sl=11772758384668e-32,Il=72921158553e-15,Ol=z.TWO_PI/86400;let Dl=new Ea;ol.computeTemeToPseudoFixedMatrix=function(e,t){if(!C(e))throw new x("date is required.");Dl=Ea.addSeconds(e,-Ea.computeTaiMinusUtc(e),Dl);const n=Dl.dayNumber,i=Dl.secondsOfDay;let o;const r=n-2451545;o=i>=43200?(r+.5)/ta.DAYS_PER_JULIAN_CENTURY:(r-.5)/ta.DAYS_PER_JULIAN_CENTURY;const s=Tl+o*(Cl+o*(El+o*xl)),a=s*Ol%z.TWO_PI,c=Il+Sl*(n-2451545.5),l=(i+.5*ta.SECONDS_PER_DAY)%ta.SECONDS_PER_DAY,u=a+c*l,h=Math.cos(u),d=Math.sin(u);return C(t)?(t[0]=h,t[1]=-d,t[2]=0,t[3]=d,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t):new ke(h,d,0,-d,h,0,0,0,1)},ol.iau2006XysData=new Va,ol.earthOrientationParameters=Ra.NONE;const Pl=32.184,Rl=2451545;ol.preloadIcrfFixed=function(e){const t=e.start.dayNumber,n=e.start.secondsOfDay+Pl,i=e.stop.dayNumber,o=e.stop.secondsOfDay+Pl,r=ol.iau2006XysData.preload(t,n,i,o),s=ol.earthOrientationParameters.getPromiseToLoad();return Promise.all([r,s])},ol.computeIcrfToFixedMatrix=function(e,t){if(!C(e))throw new x("date is required.");C(t)||(t=new ke);const n=ol.computeFixedToIcrfMatrix(e,t);if(C(n))return ke.transpose(n,t)};const Ll=new Na(0,0,0),Ml=new Ys(0,0,0,0,0,0),Bl=new ke,Nl=new ke;ol.computeFixedToIcrfMatrix=function(e,t){if(!C(e))throw new x("date is required.");C(t)||(t=new ke);const n=ol.earthOrientationParameters.compute(e,Ml);if(!C(n))return;const i=e.dayNumber,o=e.secondsOfDay+Pl,r=ol.iau2006XysData.computeXysRadians(i,o,Ll);if(!C(r))return;const s=r.x+n.xPoleOffset,a=r.y+n.yPoleOffset,c=1/(1+Math.sqrt(1-s*s-a*a)),l=Bl;l[0]=1-c*s*s,l[3]=-c*s*a,l[6]=s,l[1]=-c*s*a,l[4]=1-c*a*a,l[7]=a,l[2]=-s,l[5]=-a,l[8]=1-c*(s*s+a*a);const u=ke.fromRotationZ(-r.s,Nl),h=ke.multiply(l,u,Bl),d=e.dayNumber,f=e.secondsOfDay-Ea.computeTaiMinusUtc(e)+n.ut1MinusUtc,p=d-2451545,m=f/ta.SECONDS_PER_DAY;let _=.779057273264+m+.00273781191135448*(p+m);_=_%1*z.TWO_PI;const g=ke.fromRotationZ(_,Nl),y=ke.multiply(h,g,Bl),v=Math.cos(n.xPoleWander),b=Math.cos(n.yPoleWander),A=Math.sin(n.xPoleWander),w=Math.sin(n.yPoleWander);let T=i-Rl+o/ta.SECONDS_PER_DAY;T/=36525;const E=-47e-6*T*z.RADIANS_PER_DEGREE/3600,S=Math.cos(E),I=Math.sin(E),O=Nl;return O[0]=v*S,O[1]=v*I,O[2]=A,O[3]=-b*I+w*A*S,O[4]=b*S+w*A*I,O[5]=-w*v,O[6]=-w*I-b*A*S,O[7]=w*S-b*A*I,O[8]=b*v,ke.multiply(y,O,t)};const Fl=new Xe;ol.pointToWindowCoordinates=function(e,t,n,i){return i=ol.pointToGLWindowCoordinates(e,t,n,i),i.y=2*t[5]-i.y,i},ol.pointToGLWindowCoordinates=function(e,t,n,i){if(!C(e))throw new x("modelViewProjectionMatrix is required.");if(!C(t))throw new x("viewportTransformation is required.");if(!C(n))throw new x("point is required.");C(i)||(i=new ro);const o=Fl;return ft.multiplyByVector(e,Xe.fromElements(n.x,n.y,n.z,1,o),o),Xe.multiplyByScalar(o,1/o.w,o),ft.multiplyByVector(t,o,o),ro.fromCartesian4(o,i)};const zl=new K,kl=new K,Ul=new K;ol.rotationMatrixFromPositionVelocity=function(e,t,n,i){if(!C(e))throw new x("position is required.");if(!C(t))throw new x("velocity is required.");const o=R(n,ge.WGS84).geodeticSurfaceNormal(e,zl);let r=K.cross(t,o,kl);K.equalsEpsilon(r,K.ZERO,z.EPSILON6)&&(r=K.clone(K.UNIT_X,r));const s=K.cross(r,t,Ul);return K.normalize(s,s),K.cross(t,s,r),K.negate(r,r),K.normalize(r,r),C(i)||(i=new ke),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=r.x,i[4]=r.y,i[5]=r.z,i[6]=s.x,i[7]=s.y,i[8]=s.z,i};const Vl=new ft(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),Hl=new se,Gl=new K,Wl=new K,ql=new ke,jl=new ft,Yl=new ft;ol.basisTo2D=function(e,t,n){if(!C(e))throw new x("projection is required.");if(!C(t))throw new x("matrix is required.");if(!C(n))throw new x("result is required.");const i=ft.getTranslation(t,Wl),o=e.ellipsoid,r=o.cartesianToCartographic(i,Hl),s=e.project(r,Gl);K.fromElements(s.z,s.x,s.y,s);const a=ol.eastNorthUpToFixedFrame(i,o,jl),c=ft.inverseTransformation(a,Yl),l=ft.getMatrix3(t,ql),u=ft.multiplyByMatrix3(c,l,n);return ft.multiply(Vl,u,n),ft.setTranslation(n,s,n),n},ol.wgs84To2DModelMatrix=function(e,t,n){if(!C(e))throw new x("projection is required.");if(!C(t))throw new x("center is required.");if(!C(n))throw new x("result is required.");const i=e.ellipsoid,o=ol.eastNorthUpToFixedFrame(t,i,jl),r=ft.inverseTransformation(o,Yl),s=i.cartesianToCartographic(t,Hl),a=e.project(s,Gl);K.fromElements(a.z,a.x,a.y,a);const c=ft.fromTranslation(a,jl);return ft.multiply(Vl,r,n),ft.multiply(c,n,n),n};var Kl=ol;const Xl=new Xe;function Ql(e,t){if(D.defined("origin",e),t=R(t,ge.WGS84),e=t.scaleToGeodeticSurface(e),!C(e))throw new x("origin must not be at the center of the ellipsoid.");const n=Kl.eastNorthUpToFixedFrame(e,t);this._ellipsoid=t,this._origin=e,this._xAxis=K.fromCartesian4(ft.getColumn(n,0,Xl)),this._yAxis=K.fromCartesian4(ft.getColumn(n,1,Xl));const i=K.fromCartesian4(ft.getColumn(n,2,Xl));this._plane=Gs.fromPointNormal(e,i)}Object.defineProperties(Ql.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},origin:{get:function(){return this._origin}},plane:{get:function(){return this._plane}},xAxis:{get:function(){return this._xAxis}},yAxis:{get:function(){return this._yAxis}},zAxis:{get:function(){return this._plane.normal}}});const Jl=new Ir;Ql.fromPoints=function(e,t){D.defined("cartesians",e);const n=Ir.fromPoints(e,Jl);return new Ql(n.center,t)};const Zl=new os,$l=new K;Ql.prototype.projectPointOntoPlane=function(e,t){D.defined("cartesian",e);const n=Zl;n.origin=e,K.normalize(e,n.direction);let i=Ns.rayPlane(n,this._plane,$l);if(C(i)||(K.negate(n.direction,n.direction),i=Ns.rayPlane(n,this._plane,$l)),C(i)){const e=K.subtract(i,this._origin,i),n=K.dot(this._xAxis,e),o=K.dot(this._yAxis,e);return C(t)?(t.x=n,t.y=o,t):new ro(n,o)}},Ql.prototype.projectPointsOntoPlane=function(e,t){D.defined("cartesians",e),C(t)||(t=[]);let n=0;const i=e.length;for(let o=0;o<i;o++){const i=this.projectPointOntoPlane(e[o],t[n]);C(i)&&(t[n]=i,n++)}return t.length=n,t},Ql.prototype.projectPointToNearestOnPlane=function(e,t){D.defined("cartesian",e),C(t)||(t=new ro);const n=Zl;n.origin=e,K.clone(this._plane.normal,n.direction);let i=Ns.rayPlane(n,this._plane,$l);C(i)||(K.negate(n.direction,n.direction),i=Ns.rayPlane(n,this._plane,$l));const o=K.subtract(i,this._origin,i),r=K.dot(this._xAxis,o),s=K.dot(this._yAxis,o);return t.x=r,t.y=s,t},Ql.prototype.projectPointsToNearestOnPlane=function(e,t){D.defined("cartesians",e),C(t)||(t=[]);const n=e.length;t.length=n;for(let i=0;i<n;i++)t[i]=this.projectPointToNearestOnPlane(e[i],t[i]);return t};const eu=new K;Ql.prototype.projectPointOntoEllipsoid=function(e,t){D.defined("cartesian",e),C(t)||(t=new K);const n=this._ellipsoid,i=this._origin,o=this._xAxis,r=this._yAxis,s=eu;return K.multiplyByScalar(o,e.x,s),t=K.add(i,s,t),K.multiplyByScalar(r,e.y,s),K.add(t,s,t),n.scaleToGeocentricSurface(t,t),t},Ql.prototype.projectPointsOntoEllipsoid=function(e,t){D.defined("cartesians",e);const n=e.length;C(t)?t.length=n:t=new Array(n);for(let i=0;i<n;++i)t[i]=this.projectPointOntoEllipsoid(e[i],t[i]);return t};var tu=Ql;function nu(e,t){this.center=K.clone(R(e,K.ZERO)),this.halfAxes=ke.clone(R(t,ke.ZERO))}nu.packedLength=K.packedLength+ke.packedLength,nu.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),K.pack(e.center,t,n),ke.pack(e.halfAxes,t,n+K.packedLength),t},nu.unpack=function(e,t,n){return D.defined("array",e),t=R(t,0),C(n)||(n=new nu),K.unpack(e,t,n.center),ke.unpack(e,t+K.packedLength,n.halfAxes),n};const iu=new K,ou=new K,ru=new K,su=new K,au=new K,cu=new K,lu=new ke,uu={unitary:new ke,diagonal:new ke};nu.fromPoints=function(e,t){if(C(t)||(t=new nu),!C(e)||0===e.length)return t.halfAxes=ke.ZERO,t.center=K.ZERO,t;let n;const i=e.length,o=K.clone(e[0],iu);for(n=1;n<i;n++)K.add(o,e[n],o);const r=1/i;K.multiplyByScalar(o,r,o);let s,a=0,c=0,l=0,u=0,h=0,d=0;for(n=0;n<i;n++)s=K.subtract(e[n],o,ou),a+=s.x*s.x,c+=s.x*s.y,l+=s.x*s.z,u+=s.y*s.y,h+=s.y*s.z,d+=s.z*s.z;a*=r,c*=r,l*=r,u*=r,h*=r,d*=r;const f=lu;f[0]=a,f[1]=c,f[2]=l,f[3]=c,f[4]=u,f[5]=h,f[6]=l,f[7]=h,f[8]=d;const p=ke.computeEigenDecomposition(f,uu),m=ke.clone(p.unitary,t.halfAxes);let _=ke.getColumn(m,0,su),g=ke.getColumn(m,1,au),y=ke.getColumn(m,2,cu),v=-Number.MAX_VALUE,b=-Number.MAX_VALUE,A=-Number.MAX_VALUE,w=Number.MAX_VALUE,T=Number.MAX_VALUE,E=Number.MAX_VALUE;for(n=0;n<i;n++)s=e[n],v=Math.max(K.dot(_,s),v),b=Math.max(K.dot(g,s),b),A=Math.max(K.dot(y,s),A),w=Math.min(K.dot(_,s),w),T=Math.min(K.dot(g,s),T),E=Math.min(K.dot(y,s),E);_=K.multiplyByScalar(_,.5*(w+v),_),g=K.multiplyByScalar(g,.5*(T+b),g),y=K.multiplyByScalar(y,.5*(E+A),y);const x=K.add(_,g,t.center);K.add(x,y,x);const S=ru;return S.x=v-w,S.y=b-T,S.z=A-E,K.multiplyByScalar(S,.5,S),ke.multiplyByScale(t.halfAxes,S,t.halfAxes),t};const hu=new K,du=new K;function fu(e,t,n,i,o,r,s,a,c,l,u){if(!C(o)||!C(r)||!C(s)||!C(a)||!C(c)||!C(l))throw new x("all extents (minimum/maximum X/Y/Z) are required.");C(u)||(u=new nu);const h=u.halfAxes;ke.setColumn(h,0,t,h),ke.setColumn(h,1,n,h),ke.setColumn(h,2,i,h);let d=hu;d.x=(o+r)/2,d.y=(s+a)/2,d.z=(c+l)/2;const f=du;f.x=(r-o)/2,f.y=(a-s)/2,f.z=(l-c)/2;const p=u.center;return d=ke.multiplyByVector(h,d,d),K.add(e,d,p),ke.multiplyByScale(h,f,h),u}const pu=new se,mu=new K,_u=new se,gu=new se,yu=new se,vu=new se,bu=new se,Au=new K,wu=new K,Tu=new K,Cu=new K,Eu=new K,xu=new ro,Su=new ro,Iu=new ro,Ou=new ro,Du=new ro,Pu=new K,Ru=new K,Lu=new K,Mu=new K,Bu=new ro,Nu=new K,Fu=new K,zu=new K,ku=new Gs(K.UNIT_X,0);nu.fromRectangle=function(e,t,n,i,o){if(!C(e))throw new x("rectangle is required");if(e.width<0||e.width>z.TWO_PI)throw new x("Rectangle width must be between 0 and 2*pi");if(e.height<0||e.height>z.PI)throw new x("Rectangle height must be between 0 and pi");if(C(i)&&!z.equalsEpsilon(i.radii.x,i.radii.y,z.EPSILON15))throw new x("Ellipsoid must be an ellipsoid of revolution (radii.x == radii.y)");let r,s,a,c,l,u,h;if(t=R(t,0),n=R(n,0),i=R(i,ge.WGS84),e.width<=z.PI){const d=_t.center(e,pu),f=i.cartographicToCartesian(d,mu),p=new tu(f,i);h=p.plane;const m=d.longitude,_=e.south<0&&e.north>0?0:d.latitude,g=se.fromRadians(m,e.north,n,_u),y=se.fromRadians(e.west,e.north,n,gu),v=se.fromRadians(e.west,_,n,yu),b=se.fromRadians(e.west,e.south,n,vu),A=se.fromRadians(m,e.south,n,bu),w=i.cartographicToCartesian(g,Au);let T=i.cartographicToCartesian(y,wu);const C=i.cartographicToCartesian(v,Tu);let E=i.cartographicToCartesian(b,Cu);const x=i.cartographicToCartesian(A,Eu),S=p.projectPointToNearestOnPlane(w,xu),I=p.projectPointToNearestOnPlane(T,Su),O=p.projectPointToNearestOnPlane(C,Iu),D=p.projectPointToNearestOnPlane(E,Ou),P=p.projectPointToNearestOnPlane(x,Du);return r=Math.min(I.x,O.x,D.x),s=-r,c=Math.max(I.y,S.y),a=Math.min(D.y,P.y),y.height=b.height=t,T=i.cartographicToCartesian(y,wu),E=i.cartographicToCartesian(b,Cu),l=Math.min(Gs.getPointDistance(h,T),Gs.getPointDistance(h,E)),u=n,fu(p.origin,p.xAxis,p.yAxis,p.zAxis,r,s,a,c,l,u,o)}const d=e.south>0,f=e.north<0,p=d?e.south:f?e.north:0,m=_t.center(e,pu).longitude,_=K.fromRadians(m,p,n,i,Pu);_.z=0;const g=Math.abs(_.x)<z.EPSILON10&&Math.abs(_.y)<z.EPSILON10,y=g?K.UNIT_X:K.normalize(_,Ru),v=K.UNIT_Z,b=K.cross(y,v,Lu);h=Gs.fromPointNormal(_,y,ku);const A=K.fromRadians(m+z.PI_OVER_TWO,p,n,i,Mu);s=K.dot(Gs.projectPointOntoPlane(h,A,Bu),b),r=-s,c=K.fromRadians(0,e.north,f?t:n,i,Nu).z,a=K.fromRadians(0,e.south,d?t:n,i,Fu).z;const w=K.fromRadians(e.east,p,n,i,zu);return l=Gs.getPointDistance(h,w),u=0,fu(_,b,v,y,r,s,a,c,l,u,o)},nu.fromTransformation=function(e,t){return D.typeOf.object("transformation",e),C(t)||(t=new nu),t.center=ft.getTranslation(e,t.center),t.halfAxes=ft.getMatrix3(e,t.halfAxes),t.halfAxes=ke.multiplyByScalar(t.halfAxes,.5,t.halfAxes),t},nu.clone=function(e,t){if(C(e))return C(t)?(K.clone(e.center,t.center),ke.clone(e.halfAxes,t.halfAxes),t):new nu(e.center,e.halfAxes)},nu.intersectPlane=function(e,t){if(!C(e))throw new x("box is required.");if(!C(t))throw new x("plane is required.");const n=e.center,i=t.normal,o=e.halfAxes,r=i.x,s=i.y,a=i.z,c=Math.abs(r*o[ke.COLUMN0ROW0]+s*o[ke.COLUMN0ROW1]+a*o[ke.COLUMN0ROW2])+Math.abs(r*o[ke.COLUMN1ROW0]+s*o[ke.COLUMN1ROW1]+a*o[ke.COLUMN1ROW2])+Math.abs(r*o[ke.COLUMN2ROW0]+s*o[ke.COLUMN2ROW1]+a*o[ke.COLUMN2ROW2]),l=K.dot(i,n)+t.distance;return l<=-c?Ae.OUTSIDE:l>=c?Ae.INSIDE:Ae.INTERSECTING};const Uu=new K,Vu=new K,Hu=new K,Gu=new K,Wu=new K,qu=new K;nu.distanceSquaredTo=function(e,t){if(!C(e))throw new x("box is required.");if(!C(t))throw new x("cartesian is required.");const n=K.subtract(t,e.center,hu),i=e.halfAxes;let o=ke.getColumn(i,0,Uu),r=ke.getColumn(i,1,Vu),s=ke.getColumn(i,2,Hu);const a=K.magnitude(o),c=K.magnitude(r),l=K.magnitude(s);let u=!0,h=!0,d=!0;a>0?K.divideByScalar(o,a,o):u=!1,c>0?K.divideByScalar(r,c,r):h=!1,l>0?K.divideByScalar(s,l,s):d=!1;const f=!u+!h+!d;let p,m,_;if(1===f){let e=o;p=r,m=s,h?d||(e=s,m=o):(e=r,p=o),_=K.cross(p,m,Wu),e===o?o=_:e===r?r=_:e===s&&(s=_)}else if(2===f){p=o,h?p=r:d&&(p=s);let e=K.UNIT_Y;e.equalsEpsilon(p,z.EPSILON3)&&(e=K.UNIT_X),m=K.cross(p,e,Gu),K.normalize(m,m),_=K.cross(p,m,Wu),K.normalize(_,_),p===o?(r=m,s=_):p===r?(s=m,o=_):p===s&&(o=m,r=_)}else 3===f&&(o=K.UNIT_X,r=K.UNIT_Y,s=K.UNIT_Z);const g=qu;g.x=K.dot(n,o),g.y=K.dot(n,r),g.z=K.dot(n,s);let y,v=0;return g.x<-a?(y=g.x+a,v+=y*y):g.x>a&&(y=g.x-a,v+=y*y),g.y<-c?(y=g.y+c,v+=y*y):g.y>c&&(y=g.y-c,v+=y*y),g.z<-l?(y=g.z+l,v+=y*y):g.z>l&&(y=g.z-l,v+=y*y),v};const ju=new K,Yu=new K;nu.computePlaneDistances=function(e,t,n,i){if(!C(e))throw new x("box is required.");if(!C(t))throw new x("position is required.");if(!C(n))throw new x("direction is required.");C(i)||(i=new Te);let o=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const s=e.center,a=e.halfAxes,c=ke.getColumn(a,0,Uu),l=ke.getColumn(a,1,Vu),u=ke.getColumn(a,2,Hu),h=K.add(c,l,ju);K.add(h,u,h),K.add(h,s,h);const d=K.subtract(h,t,Yu);let f=K.dot(n,d);return o=Math.min(f,o),r=Math.max(f,r),K.add(s,c,h),K.add(h,l,h),K.subtract(h,u,h),K.subtract(h,t,d),f=K.dot(n,d),o=Math.min(f,o),r=Math.max(f,r),K.add(s,c,h),K.subtract(h,l,h),K.add(h,u,h),K.subtract(h,t,d),f=K.dot(n,d),o=Math.min(f,o),r=Math.max(f,r),K.add(s,c,h),K.subtract(h,l,h),K.subtract(h,u,h),K.subtract(h,t,d),f=K.dot(n,d),o=Math.min(f,o),r=Math.max(f,r),K.subtract(s,c,h),K.add(h,l,h),K.add(h,u,h),K.subtract(h,t,d),f=K.dot(n,d),o=Math.min(f,o),r=Math.max(f,r),K.subtract(s,c,h),K.add(h,l,h),K.subtract(h,u,h),K.subtract(h,t,d),f=K.dot(n,d),o=Math.min(f,o),r=Math.max(f,r),K.subtract(s,c,h),K.subtract(h,l,h),K.add(h,u,h),K.subtract(h,t,d),f=K.dot(n,d),o=Math.min(f,o),r=Math.max(f,r),K.subtract(s,c,h),K.subtract(h,l,h),K.subtract(h,u,h),K.subtract(h,t,d),f=K.dot(n,d),o=Math.min(f,o),r=Math.max(f,r),i.start=o,i.stop=r,i};const Ku=new K,Xu=new K,Qu=new K;nu.computeCorners=function(e,t){D.typeOf.object("box",e),C(t)||(t=[new K,new K,new K,new K,new K,new K,new K,new K]);const n=e.center,i=e.halfAxes,o=ke.getColumn(i,0,Ku),r=ke.getColumn(i,1,Xu),s=ke.getColumn(i,2,Qu);return K.clone(n,t[0]),K.subtract(t[0],o,t[0]),K.subtract(t[0],r,t[0]),K.subtract(t[0],s,t[0]),K.clone(n,t[1]),K.subtract(t[1],o,t[1]),K.subtract(t[1],r,t[1]),K.add(t[1],s,t[1]),K.clone(n,t[2]),K.subtract(t[2],o,t[2]),K.add(t[2],r,t[2]),K.subtract(t[2],s,t[2]),K.clone(n,t[3]),K.subtract(t[3],o,t[3]),K.add(t[3],r,t[3]),K.add(t[3],s,t[3]),K.clone(n,t[4]),K.add(t[4],o,t[4]),K.subtract(t[4],r,t[4]),K.subtract(t[4],s,t[4]),K.clone(n,t[5]),K.add(t[5],o,t[5]),K.subtract(t[5],r,t[5]),K.add(t[5],s,t[5]),K.clone(n,t[6]),K.add(t[6],o,t[6]),K.add(t[6],r,t[6]),K.subtract(t[6],s,t[6]),K.clone(n,t[7]),K.add(t[7],o,t[7]),K.add(t[7],r,t[7]),K.add(t[7],s,t[7]),t};const Ju=new ke;nu.computeTransformation=function(e,t){D.typeOf.object("box",e),C(t)||(t=new ft);const n=e.center,i=ke.multiplyByUniformScale(e.halfAxes,2,Ju);return ft.fromRotationTranslation(i,n,t)};const Zu=new nn;nu.isOccluded=function(e,t){if(!C(e))throw new x("box is required.");if(!C(t))throw new x("occluder is required.");const n=nn.fromOrientedBoundingBox(e,Zu);return!t.isBoundingSphereVisible(n)},nu.prototype.intersectPlane=function(e){return nu.intersectPlane(this,e)},nu.prototype.distanceSquaredTo=function(e){return nu.distanceSquaredTo(this,e)},nu.prototype.computePlaneDistances=function(e,t,n){return nu.computePlaneDistances(this,e,t,n)},nu.prototype.computeCorners=function(e){return nu.computeCorners(this,e)},nu.prototype.computeTransformation=function(e){return nu.computeTransformation(this,e)},nu.prototype.isOccluded=function(e){return nu.isOccluded(this,e)},nu.equals=function(e,t){return e===t||C(e)&&C(t)&&K.equals(e.center,t.center)&&ke.equals(e.halfAxes,t.halfAxes)},nu.prototype.clone=function(e){return nu.clone(this,e)},nu.prototype.equals=function(e){return nu.equals(this,e)};var $u=nu;const eh={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_WEBGL:37808,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_BPTC_UNORM:36492,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047};var th=Object.freeze(eh);const nh={BYTE:th.BYTE,UNSIGNED_BYTE:th.UNSIGNED_BYTE,SHORT:th.SHORT,UNSIGNED_SHORT:th.UNSIGNED_SHORT,INT:th.INT,UNSIGNED_INT:th.UNSIGNED_INT,FLOAT:th.FLOAT,DOUBLE:th.DOUBLE,getSizeInBytes:function(e){if(!C(e))throw new x("value is required.");switch(e){case nh.BYTE:return Int8Array.BYTES_PER_ELEMENT;case nh.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case nh.SHORT:return Int16Array.BYTES_PER_ELEMENT;case nh.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case nh.INT:return Int32Array.BYTES_PER_ELEMENT;case nh.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case nh.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case nh.DOUBLE:return Float64Array.BYTES_PER_ELEMENT;default:throw new x("componentDatatype is not a valid value.")}},fromTypedArray:function(e){return e instanceof Int8Array?nh.BYTE:e instanceof Uint8Array?nh.UNSIGNED_BYTE:e instanceof Int16Array?nh.SHORT:e instanceof Uint16Array?nh.UNSIGNED_SHORT:e instanceof Int32Array?nh.INT:e instanceof Uint32Array?nh.UNSIGNED_INT:e instanceof Float32Array?nh.FLOAT:e instanceof Float64Array?nh.DOUBLE:void 0},validate:function(e){return C(e)&&(e===nh.BYTE||e===nh.UNSIGNED_BYTE||e===nh.SHORT||e===nh.UNSIGNED_SHORT||e===nh.INT||e===nh.UNSIGNED_INT||e===nh.FLOAT||e===nh.DOUBLE)},createTypedArray:function(e,t){if(!C(e))throw new x("componentDatatype is required.");if(!C(t))throw new x("valuesOrLength is required.");switch(e){case nh.BYTE:return new Int8Array(t);case nh.UNSIGNED_BYTE:return new Uint8Array(t);case nh.SHORT:return new Int16Array(t);case nh.UNSIGNED_SHORT:return new Uint16Array(t);case nh.INT:return new Int32Array(t);case nh.UNSIGNED_INT:return new Uint32Array(t);case nh.FLOAT:return new Float32Array(t);case nh.DOUBLE:return new Float64Array(t);default:throw new x("componentDatatype is not a valid value.")}},createArrayBufferView:function(e,t,n,i){if(!C(e))throw new x("componentDatatype is required.");if(!C(t))throw new x("buffer is required.");switch(n=R(n,0),i=R(i,(t.byteLength-n)/nh.getSizeInBytes(e)),e){case nh.BYTE:return new Int8Array(t,n,i);case nh.UNSIGNED_BYTE:return new Uint8Array(t,n,i);case nh.SHORT:return new Int16Array(t,n,i);case nh.UNSIGNED_SHORT:return new Uint16Array(t,n,i);case nh.INT:return new Int32Array(t,n,i);case nh.UNSIGNED_INT:return new Uint32Array(t,n,i);case nh.FLOAT:return new Float32Array(t,n,i);case nh.DOUBLE:return new Float64Array(t,n,i);default:throw new x("componentDatatype is not a valid value.")}},fromName:function(e){switch(e){case"BYTE":return nh.BYTE;case"UNSIGNED_BYTE":return nh.UNSIGNED_BYTE;case"SHORT":return nh.SHORT;case"UNSIGNED_SHORT":return nh.UNSIGNED_SHORT;case"INT":return nh.INT;case"UNSIGNED_INT":return nh.UNSIGNED_INT;case"FLOAT":return nh.FLOAT;case"DOUBLE":return nh.DOUBLE;default:throw new x("name is not a valid value.")}}};var ih=Object.freeze(nh);function oh(e,t,n,i){this[0]=R(e,0),this[1]=R(n,0),this[2]=R(t,0),this[3]=R(i,0)}oh.packedLength=4,oh.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t},oh.unpack=function(e,t,n){return D.defined("array",e),t=R(t,0),C(n)||(n=new oh),n[0]=e[t++],n[1]=e[t++],n[2]=e[t++],n[3]=e[t++],n},oh.packArray=function(e,t){D.defined("array",e);const n=e.length,i=4*n;if(C(t)){if(!Array.isArray(t)&&t.length!==i)throw new x("If result is a typed array, it must have exactly array.length * 4 elements");t.length!==i&&(t.length=i)}else t=new Array(i);for(let o=0;o<n;++o)oh.pack(e[o],t,4*o);return t},oh.unpackArray=function(e,t){if(D.defined("array",e),D.typeOf.number.greaterThanOrEquals("array.length",e.length,4),e.length%4!==0)throw new x("array length must be a multiple of 4.");const n=e.length;C(t)?t.length=n/4:t=new Array(n/4);for(let i=0;i<n;i+=4){const n=i/4;t[n]=oh.unpack(e,i,t[n])}return t},oh.clone=function(e,t){if(C(e))return C(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):new oh(e[0],e[2],e[1],e[3])},oh.fromArray=oh.unpack,oh.fromColumnMajorArray=function(e,t){return D.defined("values",e),oh.clone(e,t)},oh.fromRowMajorArray=function(e,t){return D.defined("values",e),C(t)?(t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3],t):new oh(e[0],e[1],e[2],e[3])},oh.fromScale=function(e,t){return D.typeOf.object("scale",e),C(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=e.y,t):new oh(e.x,0,0,e.y)},oh.fromUniformScale=function(e,t){return D.typeOf.number("scale",e),C(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=e,t):new oh(e,0,0,e)},oh.fromRotation=function(e,t){D.typeOf.number("angle",e);const n=Math.cos(e),i=Math.sin(e);return C(t)?(t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t):new oh(n,-i,i,n)},oh.toArray=function(e,t){return D.typeOf.object("matrix",e),C(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):[e[0],e[1],e[2],e[3]]},oh.getElementIndex=function(e,t){return D.typeOf.number.greaterThanOrEquals("row",t,0),D.typeOf.number.lessThanOrEquals("row",t,1),D.typeOf.number.greaterThanOrEquals("column",e,0),D.typeOf.number.lessThanOrEquals("column",e,1),2*e+t},oh.getColumn=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.number.greaterThanOrEquals("index",t,0),D.typeOf.number.lessThanOrEquals("index",t,1),D.typeOf.object("result",n);const i=2*t,o=e[i],r=e[i+1];return n.x=o,n.y=r,n},oh.setColumn=function(e,t,n,i){D.typeOf.object("matrix",e),D.typeOf.number.greaterThanOrEquals("index",t,0),D.typeOf.number.lessThanOrEquals("index",t,1),D.typeOf.object("cartesian",n),D.typeOf.object("result",i),i=oh.clone(e,i);const o=2*t;return i[o]=n.x,i[o+1]=n.y,i},oh.getRow=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.number.greaterThanOrEquals("index",t,0),D.typeOf.number.lessThanOrEquals("index",t,1),D.typeOf.object("result",n);const i=e[t],o=e[t+2];return n.x=i,n.y=o,n},oh.setRow=function(e,t,n,i){return D.typeOf.object("matrix",e),D.typeOf.number.greaterThanOrEquals("index",t,0),D.typeOf.number.lessThanOrEquals("index",t,1),D.typeOf.object("cartesian",n),D.typeOf.object("result",i),i=oh.clone(e,i),i[t]=n.x,i[t+2]=n.y,i};const rh=new ro;oh.setScale=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.object("scale",t),D.typeOf.object("result",n);const i=oh.getScale(e,rh),o=t.x/i.x,r=t.y/i.y;return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*r,n[3]=e[3]*r,n};const sh=new ro;oh.setUniformScale=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.number("scale",t),D.typeOf.object("result",n);const i=oh.getScale(e,sh),o=t/i.x,r=t/i.y;return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*r,n[3]=e[3]*r,n};const ah=new ro;oh.getScale=function(e,t){return D.typeOf.object("matrix",e),D.typeOf.object("result",t),t.x=ro.magnitude(ro.fromElements(e[0],e[1],ah)),t.y=ro.magnitude(ro.fromElements(e[2],e[3],ah)),t};const ch=new ro;oh.getMaximumScale=function(e){return oh.getScale(e,ch),ro.maximumComponent(ch)};const lh=new ro;oh.setRotation=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.object("result",n);const i=oh.getScale(e,lh);return n[0]=t[0]*i.x,n[1]=t[1]*i.x,n[2]=t[2]*i.y,n[3]=t[3]*i.y,n};const uh=new ro;oh.getRotation=function(e,t){D.typeOf.object("matrix",e),D.typeOf.object("result",t);const n=oh.getScale(e,uh);return t[0]=e[0]/n.x,t[1]=e[1]/n.x,t[2]=e[2]/n.y,t[3]=e[3]/n.y,t},oh.multiply=function(e,t,n){D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n);const i=e[0]*t[0]+e[2]*t[1],o=e[0]*t[2]+e[2]*t[3],r=e[1]*t[0]+e[3]*t[1],s=e[1]*t[2]+e[3]*t[3];return n[0]=i,n[1]=r,n[2]=o,n[3]=s,n},oh.add=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},oh.subtract=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n},oh.multiplyByVector=function(e,t,n){D.typeOf.object("matrix",e),D.typeOf.object("cartesian",t),D.typeOf.object("result",n);const i=e[0]*t.x+e[2]*t.y,o=e[1]*t.x+e[3]*t.y;return n.x=i,n.y=o,n},oh.multiplyByScalar=function(e,t,n){return D.typeOf.object("matrix",e),D.typeOf.number("scalar",t),D.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n},oh.multiplyByScale=function(e,t,n){return D.typeOf.object("matrix",e),D.typeOf.object("scale",t),D.typeOf.object("result",n),n[0]=e[0]*t.x,n[1]=e[1]*t.x,n[2]=e[2]*t.y,n[3]=e[3]*t.y,n},oh.multiplyByUniformScale=function(e,t,n){return D.typeOf.object("matrix",e),D.typeOf.number("scale",t),D.typeOf.object("result",n),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n},oh.negate=function(e,t){return D.typeOf.object("matrix",e),D.typeOf.object("result",t),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},oh.transpose=function(e,t){D.typeOf.object("matrix",e),D.typeOf.object("result",t);const n=e[0],i=e[2],o=e[1],r=e[3];return t[0]=n,t[1]=i,t[2]=o,t[3]=r,t},oh.abs=function(e,t){return D.typeOf.object("matrix",e),D.typeOf.object("result",t),t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t},oh.equals=function(e,t){return e===t||C(e)&&C(t)&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},oh.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]},oh.equalsEpsilon=function(e,t,n){return n=R(n,0),e===t||C(e)&&C(t)&&Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n},oh.IDENTITY=Object.freeze(new oh(1,0,0,1)),oh.ZERO=Object.freeze(new oh(0,0,0,0)),oh.COLUMN0ROW0=0,oh.COLUMN0ROW1=1,oh.COLUMN1ROW0=2,oh.COLUMN1ROW1=3,Object.defineProperties(oh.prototype,{length:{get:function(){return oh.packedLength}}}),oh.prototype.clone=function(e){return oh.clone(this,e)},oh.prototype.equals=function(e){return oh.equals(this,e)},oh.prototype.equalsEpsilon=function(e,t){return oh.equalsEpsilon(this,e,t)},oh.prototype.toString=function(){return`(${this[0]}, ${this[2]})\n(${this[1]}, ${this[3]})`};var hh=oh;const dh={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4",getMathType:function(e){switch(e){case dh.SCALAR:return Number;case dh.VEC2:return ro;case dh.VEC3:return K;case dh.VEC4:return Xe;case dh.MAT2:return hh;case dh.MAT3:return ke;case dh.MAT4:return ft;default:throw new x("attributeType is not a valid value.")}},getNumberOfComponents:function(e){switch(e){case dh.SCALAR:return 1;case dh.VEC2:return 2;case dh.VEC3:return 3;case dh.VEC4:case dh.MAT2:return 4;case dh.MAT3:return 9;case dh.MAT4:return 16;default:throw new x("attributeType is not a valid value.")}},getAttributeLocationCount:function(e){switch(e){case dh.SCALAR:case dh.VEC2:case dh.VEC3:case dh.VEC4:return 1;case dh.MAT2:return 2;case dh.MAT3:return 3;case dh.MAT4:return 4;default:throw new x("attributeType is not a valid value.")}},getGlslType:function(e){switch(D.typeOf.string("attributeType",e),e){case dh.SCALAR:return"float";case dh.VEC2:return"vec2";case dh.VEC3:return"vec3";case dh.VEC4:return"vec4";case dh.MAT2:return"mat2";case dh.MAT3:return"mat3";case dh.MAT4:return"mat4";default:throw new x("attributeType is not a valid value.")}}};var fh=Object.freeze(dh);const ph=1/256,mh=256,_h={octEncodeInRange:function(e,t,n){D.defined("vector",e),D.defined("result",n);const i=K.magnitudeSquared(e);if(Math.abs(i-1)>z.EPSILON6)throw new x("vector must be normalized.");if(n.x=e.x/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),n.y=e.y/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),e.z<0){const e=n.x,t=n.y;n.x=(1-Math.abs(t))*z.signNotZero(e),n.y=(1-Math.abs(e))*z.signNotZero(t)}return n.x=z.toSNorm(n.x,t),n.y=z.toSNorm(n.y,t),n},octEncode:function(e,t){return _h.octEncodeInRange(e,255,t)}},gh=new ro,yh=new Uint8Array(1);function vh(e){return yh[0]=e,yh[0]}_h.octEncodeToCartesian4=function(e,t){return _h.octEncodeInRange(e,65535,gh),t.x=vh(gh.x*ph),t.y=vh(gh.x),t.z=vh(gh.y*ph),t.w=vh(gh.y),t},_h.octDecodeInRange=function(e,t,n,i){if(D.defined("result",i),e<0||e>n||t<0||t>n)throw new x(`x and y must be unsigned normalized integers between 0 and ${n}`);if(i.x=z.fromSNorm(e,n),i.y=z.fromSNorm(t,n),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const e=i.x;i.x=(1-Math.abs(i.y))*z.signNotZero(e),i.y=(1-Math.abs(e))*z.signNotZero(i.y)}return K.normalize(i,i)},_h.octDecode=function(e,t,n){return _h.octDecodeInRange(e,t,255,n)},_h.octDecodeFromCartesian4=function(e,t){D.typeOf.object("encoded",e),D.typeOf.object("result",t);const n=e.x,i=e.y,o=e.z,r=e.w;if(n<0||n>255||i<0||i>255||o<0||o>255||r<0||r>255)throw new x("x, y, z, and w must be unsigned normalized integers between 0 and 255");const s=n*mh+i,a=o*mh+r;return _h.octDecodeInRange(s,a,65535,t)},_h.octPackFloat=function(e){return D.defined("encoded",e),256*e.x+e.y};const bh=new ro;function Ah(e){return e>>1^-(1&e)}_h.octEncodeFloat=function(e){return _h.octEncode(e,bh),_h.octPackFloat(bh)},_h.octDecodeFloat=function(e,t){D.defined("value",e);const n=e/256,i=Math.floor(n),o=256*(n-i);return _h.octDecode(i,o,t)},_h.octPack=function(e,t,n,i){D.defined("v1",e),D.defined("v2",t),D.defined("v3",n),D.defined("result",i);const o=_h.octEncodeFloat(e),r=_h.octEncodeFloat(t),s=_h.octEncode(n,bh);return i.x=65536*s.x+o,i.y=65536*s.y+r,i},_h.octUnpack=function(e,t,n,i){D.defined("packed",e),D.defined("v1",t),D.defined("v2",n),D.defined("v3",i);let o=e.x/65536;const r=Math.floor(o),s=65536*(o-r);o=e.y/65536;const a=Math.floor(o),c=65536*(o-a);_h.octDecodeFloat(s,t),_h.octDecodeFloat(c,n),_h.octDecode(r,a,i)},_h.compressTextureCoordinates=function(e){D.defined("textureCoordinates",e);const t=4095*e.x|0,n=4095*e.y|0;return 4096*t+n},_h.decompressTextureCoordinates=function(e,t){D.defined("compressed",e),D.defined("result",t);const n=e/4096,i=Math.floor(n);return t.x=i/4095,t.y=(e-4096*i)/4095,t},_h.zigZagDeltaDecode=function(e,t,n){D.defined("uBuffer",e),D.defined("vBuffer",t),D.typeOf.number.equals("uBuffer.length","vBuffer.length",e.length,t.length),C(n)&&D.typeOf.number.equals("uBuffer.length","heightBuffer.length",e.length,n.length);const i=e.length;let o=0,r=0,s=0;for(let a=0;a<i;++a)o+=Ah(e[a]),r+=Ah(t[a]),e[a]=o,t[a]=r,C(n)&&(s+=Ah(n[a]),n[a]=s)},_h.dequantize=function(e,t,n,i){D.defined("typedArray",e),D.defined("componentDatatype",t),D.defined("type",n),D.defined("count",i);const o=fh.getNumberOfComponents(n);let r;switch(t){case ih.BYTE:r=127;break;case ih.UNSIGNED_BYTE:r=255;break;case ih.SHORT:r=32767;break;case ih.UNSIGNED_SHORT:r=65535;break;case ih.INT:r=2147483647;break;case ih.UNSIGNED_INT:r=4294967295;break;default:throw new x(`Cannot dequantize component datatype: ${t}`)}const s=new Float32Array(i*o);for(let a=0;a<i;a++)for(let t=0;t<o;t++){const n=a*o+t;s[n]=Math.max(e[n]/r,-1)}return s},_h.decodeRGB565=function(e,t){D.defined("typedArray",e);const n=3*e.length;C(t)&&D.typeOf.number.equals("result.length","typedArray.length * 3",t.length,n);const i=e.length;C(t)||(t=new Float32Array(3*i));const o=31,r=63,s=1/31,a=1/63;for(let c=0;c<i;c++){const n=e[c],i=n>>11,l=n>>5&r,u=n&o,h=3*c;t[h]=i*s,t[h+1]=l*a,t[h+2]=u*s}return t};var wh=_h;const Th={getHeight:function(e,t,n){return(e-n)*t+n}},Ch=new K;Th.getPosition=function(e,t,n,i,o){const r=t.cartesianToCartographic(e,Ch),s=Th.getHeight(r.height,n,i);return K.fromRadians(r.longitude,r.latitude,s,t,o)};var Eh=Th;const xh={NONE:0,BITS12:1};var Sh=Object.freeze(xh);const Ih=new K,Oh=new K,Dh=new ro,Ph=new ft,Rh=new ft,Lh=Math.pow(2,12);function Mh(e,t,n,i,o,r,s,a,c,l){let u,h,d=Sh.NONE;if(C(t)&&C(n)&&C(i)&&C(o)){const e=t.minimum,r=t.maximum,s=K.subtract(r,e,Oh),a=i-n,c=Math.max(K.maximumComponent(s),a);d=c<Lh-1?Sh.BITS12:Sh.NONE,u=ft.inverseTransformation(o,new ft);const l=K.negate(e,Ih);ft.multiply(ft.fromTranslation(l,Ph),u,u);const f=Ih;f.x=1/s.x,f.y=1/s.y,f.z=1/s.z,ft.multiply(ft.fromScale(f,Ph),u,u),h=ft.clone(o),ft.setTranslation(h,K.ZERO,h),o=ft.clone(o,new ft);const p=ft.fromTranslation(e,Ph),m=ft.fromScale(s,Rh),_=ft.multiply(p,m,Ph);ft.multiply(o,_,o),ft.multiply(h,_,h)}this.quantization=d,this.minimumHeight=n,this.maximumHeight=i,this.center=K.clone(e),this.toScaledENU=u,this.fromScaledENU=o,this.matrix=h,this.hasVertexNormals=r,this.hasWebMercatorT=R(s,!1),this.hasGeodeticSurfaceNormals=R(a,!1),this.exaggeration=R(c,1),this.exaggerationRelativeHeight=R(l,0),this.stride=0,this._offsetGeodeticSurfaceNormal=0,this._offsetVertexNormal=0,this._calculateStrideAndOffsets()}Mh.prototype.encode=function(e,t,n,i,o,r,s,a){const c=i.x,l=i.y;if(this.quantization===Sh.BITS12){n=ft.multiplyByPoint(this.toScaledENU,n,Ih),n.x=z.clamp(n.x,0,1),n.y=z.clamp(n.y,0,1),n.z=z.clamp(n.z,0,1);const i=this.maximumHeight-this.minimumHeight,r=z.clamp((o-this.minimumHeight)/i,0,1);ro.fromElements(n.x,n.y,Dh);const a=wh.compressTextureCoordinates(Dh);ro.fromElements(n.z,r,Dh);const u=wh.compressTextureCoordinates(Dh);ro.fromElements(c,l,Dh);const h=wh.compressTextureCoordinates(Dh);if(e[t++]=a,e[t++]=u,e[t++]=h,this.hasWebMercatorT){ro.fromElements(s,0,Dh);const n=wh.compressTextureCoordinates(Dh);e[t++]=n}}else K.subtract(n,this.center,Ih),e[t++]=Ih.x,e[t++]=Ih.y,e[t++]=Ih.z,e[t++]=o,e[t++]=c,e[t++]=l,this.hasWebMercatorT&&(e[t++]=s);return this.hasVertexNormals&&(e[t++]=wh.octPackFloat(r)),this.hasGeodeticSurfaceNormals&&(e[t++]=a.x,e[t++]=a.y,e[t++]=a.z),t};const Bh=new K,Nh=new K;Mh.prototype.addGeodeticSurfaceNormals=function(e,t,n){if(this.hasGeodeticSurfaceNormals)return;const i=this.stride,o=e.length/i;this.hasGeodeticSurfaceNormals=!0,this._calculateStrideAndOffsets();const r=this.stride;for(let s=0;s<o;s++){for(let n=0;n<i;n++){const o=s*i+n,a=s*r+n;t[a]=e[o]}const o=this.decodePosition(t,s,Bh),a=n.geodeticSurfaceNormal(o,Nh),c=s*r+this._offsetGeodeticSurfaceNormal;t[c]=a.x,t[c+1]=a.y,t[c+2]=a.z}},Mh.prototype.removeGeodeticSurfaceNormals=function(e,t){if(!this.hasGeodeticSurfaceNormals)return;const n=this.stride,i=e.length/n;this.hasGeodeticSurfaceNormals=!1,this._calculateStrideAndOffsets();const o=this.stride;for(let r=0;r<i;r++)for(let i=0;i<o;i++){const s=r*n+i,a=r*o+i;t[a]=e[s]}},Mh.prototype.decodePosition=function(e,t,n){if(C(n)||(n=new K),t*=this.stride,this.quantization===Sh.BITS12){const i=wh.decompressTextureCoordinates(e[t],Dh);n.x=i.x,n.y=i.y;const o=wh.decompressTextureCoordinates(e[t+1],Dh);return n.z=o.x,ft.multiplyByPoint(this.fromScaledENU,n,n)}return n.x=e[t],n.y=e[t+1],n.z=e[t+2],K.add(n,this.center,n)},Mh.prototype.getExaggeratedPosition=function(e,t,n){n=this.decodePosition(e,t,n);const i=this.exaggeration,o=this.exaggerationRelativeHeight,r=1!==i;if(r&&this.hasGeodeticSurfaceNormals){const r=this.decodeGeodeticSurfaceNormal(e,t,Nh),s=this.decodeHeight(e,t),a=Eh.getHeight(s,i,o)-s;n.x+=r.x*a,n.y+=r.y*a,n.z+=r.z*a}return n},Mh.prototype.decodeTextureCoordinates=function(e,t,n){return C(n)||(n=new ro),t*=this.stride,this.quantization===Sh.BITS12?wh.decompressTextureCoordinates(e[t+2],n):ro.fromElements(e[t+4],e[t+5],n)},Mh.prototype.decodeHeight=function(e,t){if(t*=this.stride,this.quantization===Sh.BITS12){const n=wh.decompressTextureCoordinates(e[t+1],Dh);return n.y*(this.maximumHeight-this.minimumHeight)+this.minimumHeight}return e[t+3]},Mh.prototype.decodeWebMercatorT=function(e,t){return t*=this.stride,this.quantization===Sh.BITS12?wh.decompressTextureCoordinates(e[t+3],Dh).x:e[t+6]},Mh.prototype.getOctEncodedNormal=function(e,t,n){t=t*this.stride+this._offsetVertexNormal;const i=e[t]/256,o=Math.floor(i),r=256*(i-o);return ro.fromElements(o,r,n)},Mh.prototype.decodeGeodeticSurfaceNormal=function(e,t,n){return t=t*this.stride+this._offsetGeodeticSurfaceNormal,n.x=e[t],n.y=e[t+1],n.z=e[t+2],n},Mh.prototype._calculateStrideAndOffsets=function(){let e=0;switch(this.quantization){case Sh.BITS12:e+=3;break;default:e+=6}this.hasWebMercatorT&&(e+=1),this.hasVertexNormals&&(this._offsetVertexNormal=e,e+=1),this.hasGeodeticSurfaceNormals&&(this._offsetGeodeticSurfaceNormal=e,e+=3),this.stride=e};const Fh={position3DAndHeight:0,textureCoordAndEncodedNormals:1,geodeticSurfaceNormal:2},zh={compressed0:0,compressed1:1,geodeticSurfaceNormal:2};Mh.prototype.getAttributes=function(e){const t=ih.FLOAT,n=ih.getSizeInBytes(t),i=this.stride*n;let o=0;const r=[];function s(s,a){r.push({index:s,vertexBuffer:e,componentDatatype:t,componentsPerAttribute:a,offsetInBytes:o,strideInBytes:i}),o+=a*n}if(this.quantization===Sh.NONE){s(Fh.position3DAndHeight,4);let e=2;e+=this.hasWebMercatorT?1:0,e+=this.hasVertexNormals?1:0,s(Fh.textureCoordAndEncodedNormals,e),this.hasGeodeticSurfaceNormals&&s(Fh.geodeticSurfaceNormal,3)}else{const e=this.hasWebMercatorT||this.hasVertexNormals,t=this.hasWebMercatorT&&this.hasVertexNormals;s(zh.compressed0,e?4:3),t&&s(zh.compressed1,1),this.hasGeodeticSurfaceNormals&&s(zh.geodeticSurfaceNormal,3)}return r},Mh.prototype.getAttributeLocations=function(){return this.quantization===Sh.NONE?Fh:zh},Mh.clone=function(e,t){if(C(e))return C(t)||(t=new Mh),t.quantization=e.quantization,t.minimumHeight=e.minimumHeight,t.maximumHeight=e.maximumHeight,t.center=K.clone(e.center),t.toScaledENU=ft.clone(e.toScaledENU),t.fromScaledENU=ft.clone(e.fromScaledENU),t.matrix=ft.clone(e.matrix),t.hasVertexNormals=e.hasVertexNormals,t.hasWebMercatorT=e.hasWebMercatorT,t.hasGeodeticSurfaceNormals=e.hasGeodeticSurfaceNormals,t.exaggeration=e.exaggeration,t.exaggerationRelativeHeight=e.exaggerationRelativeHeight,t._calculateStrideAndOffsets(),t};var kh=Mh;function Uh(e){this._ellipsoid=R(e,ge.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}Object.defineProperties(Uh.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),Uh.mercatorAngleToGeodeticLatitude=function(e){return z.PI_OVER_TWO-2*Math.atan(Math.exp(-e))},Uh.geodeticLatitudeToMercatorAngle=function(e){e>Uh.MaximumLatitude?e=Uh.MaximumLatitude:e<-Uh.MaximumLatitude&&(e=-Uh.MaximumLatitude);const t=Math.sin(e);return.5*Math.log((1+t)/(1-t))},Uh.MaximumLatitude=Uh.mercatorAngleToGeodeticLatitude(Math.PI),Uh.prototype.project=function(e,t){const n=this._semimajorAxis,i=e.longitude*n,o=Uh.geodeticLatitudeToMercatorAngle(e.latitude)*n,r=e.height;return C(t)?(t.x=i,t.y=o,t.z=r,t):new K(i,o,r)},Uh.prototype.unproject=function(e,t){if(!C(e))throw new x("cartesian is required");const n=this._oneOverSemimajorAxis,i=e.x*n,o=Uh.mercatorAngleToGeodeticLatitude(e.y*n),r=e.z;return C(t)?(t.longitude=i,t.latitude=o,t.height=r,t):new se(i,o,r)};var Vh=Uh;const Hh={};Hh.DEFAULT_STRUCTURE=Object.freeze({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});const Gh=new K,Wh=new ft,qh=new K,jh=new K;Hh.computeVertices=function(e){if(!C(e)||!C(e.heightmap))throw new x("options.heightmap is required.");if(!C(e.width)||!C(e.height))throw new x("options.width and options.height are required.");if(!C(e.nativeRectangle))throw new x("options.nativeRectangle is required.");if(!C(e.skirtHeight))throw new x("options.skirtHeight is required.");const t=Math.cos,n=Math.sin,i=Math.sqrt,o=Math.atan,r=Math.exp,s=z.PI_OVER_TWO,a=z.toRadians,c=e.heightmap,l=e.width,u=e.height,h=e.skirtHeight,d=h>0,f=R(e.isGeographic,!0),p=R(e.ellipsoid,ge.WGS84),m=1/p.maximumRadius,_=_t.clone(e.nativeRectangle),g=_t.clone(e.rectangle);let y,v,b,A;C(g)?(y=g.west,v=g.south,b=g.east,A=g.north):f?(y=a(_.west),v=a(_.south),b=a(_.east),A=a(_.north)):(y=_.west*m,v=s-2*o(r(-_.south*m)),b=_.east*m,A=s-2*o(r(-_.north*m)));let w=e.relativeToCenter;const T=C(w);w=T?w:K.ZERO;const E=R(e.includeWebMercatorT,!1),S=R(e.exaggeration,1),I=R(e.exaggerationRelativeHeight,0),O=1!==S,D=O,P=R(e.structure,Hh.DEFAULT_STRUCTURE),L=R(P.heightScale,Hh.DEFAULT_STRUCTURE.heightScale),M=R(P.heightOffset,Hh.DEFAULT_STRUCTURE.heightOffset),B=R(P.elementsPerHeight,Hh.DEFAULT_STRUCTURE.elementsPerHeight),N=R(P.stride,Hh.DEFAULT_STRUCTURE.stride),F=R(P.elementMultiplier,Hh.DEFAULT_STRUCTURE.elementMultiplier),k=R(P.isBigEndian,Hh.DEFAULT_STRUCTURE.isBigEndian);let U=_t.computeWidth(_),V=_t.computeHeight(_);const H=U/(l-1),G=V/(u-1);f||(U*=m,V*=m);const W=p.radiiSquared,q=W.x,j=W.y,Y=W.z;let X=65536,Q=-65536;const J=Kl.eastNorthUpToFixedFrame(w,p),Z=ft.inverseTransformation(J,Wh);let $,ee;E&&($=Vh.geodeticLatitudeToMercatorAngle(v),ee=1/(Vh.geodeticLatitudeToMercatorAngle(A)-$));const te=qh;te.x=Number.POSITIVE_INFINITY,te.y=Number.POSITIVE_INFINITY,te.z=Number.POSITIVE_INFINITY;const ne=jh;ne.x=Number.NEGATIVE_INFINITY,ne.y=Number.NEGATIVE_INFINITY,ne.z=Number.NEGATIVE_INFINITY;let ie=Number.POSITIVE_INFINITY;const oe=l*u,re=h>0?2*l+2*u:0,se=oe+re,ae=new Array(se),ce=new Array(se),le=new Array(se),ue=E?new Array(se):[],he=D?new Array(se):[];let de=0,fe=u,pe=0,me=l;d&&(--de,++fe,--pe,++me);const _e=1e-5;for(let C=de;C<fe;++C){let e=C;e<0&&(e=0),e>=u&&(e=u-1);let d=_.north-G*e;d=f?a(d):s-2*o(r(-d*m));let g=(d-v)/(A-v);g=z.clamp(g,0,1);const w=C===de,T=C===fe-1;h>0&&(w?d+=_e*V:T&&(d-=_e*V));const x=t(d),S=n(d),I=Y*S;let O;E&&(O=(Vh.geodeticLatitudeToMercatorAngle(d)-$)*ee);for(let o=pe;o<me;++o){let r=o;r<0&&(r=0),r>=l&&(r=l-1);const s=e*(l*N)+r*N;let d;if(1===B)d=c[s];else{let e;if(d=0,k)for(e=0;e<B;++e)d=d*F+c[s+e];else for(e=B-1;e>=0;--e)d=d*F+c[s+e]}d=d*L+M,Q=Math.max(Q,d),X=Math.min(X,d);let v=_.west+H*r;f?v=a(v):v*=m;let A=(v-y)/(b-y);A=z.clamp(A,0,1);let C=e*l+r;if(h>0){const t=o===pe,n=o===me-1,i=w||T||t||n,s=(w||T)&&(t||n);if(s)continue;i&&(d-=h,t?(C=oe+(u-e-1),v-=_e*U):T?C=oe+u+(l-r-1):n?(C=oe+u+l+e,v+=_e*U):w&&(C=oe+u+l+u+r))}const P=x*t(v),R=x*n(v),V=q*P,G=j*R,W=i(V*P+G*R+I*S),Y=1/W,J=V*Y,$=G*Y,ee=I*Y,re=new K;re.x=J+P*d,re.y=$+R*d,re.z=ee+S*d,ft.multiplyByPoint(Z,re,Gh),K.minimumByComponent(Gh,te,te),K.maximumByComponent(Gh,ne,ne),ie=Math.min(ie,d),ae[C]=re,le[C]=new ro(A,g),ce[C]=d,E&&(ue[C]=O),D&&(he[C]=p.geodeticSurfaceNormal(re))}}const ye=nn.fromPoints(ae);let ve,be;if(C(g)&&(ve=$u.fromRectangle(g,X,Q,p)),T){const e=new jr(p);be=e.computeHorizonCullingPointPossiblyUnderEllipsoid(w,ae,X)}const Ae=new Ir(te,ne,w),we=new kh(w,Ae,ie,Q,J,!1,E,D,S,I),Te=new Float32Array(se*we.stride);let Ce=0;for(let C=0;C<se;++C)Ce=we.encode(Te,Ce,ae[C],le[C],ce[C],void 0,ue[C],he[C]);return{vertices:Te,maximumHeight:Q,minimumHeight:X,encoding:we,boundingSphere3D:ye,orientedBoundingBox:ve,occludeePointInScaledSpace:be}};var Yh=Hh;function Kh(){return!0}function Xh(e,t){function n(){throw new x(t)}t=R(t,"This object was destroyed, i.e., destroy() was called.");for(const i in e)"function"===typeof e[i]&&(e[i]=n);e.isDestroyed=Kh}var Qh=Xh;function Jh(){if(!C(rd._canTransferArrayBuffer)){const t=new Worker(ed("Workers/transferTypedArrayTest.js"));t.postMessage=R(t.webkitPostMessage,t.postMessage);const n=99,i=new Int8Array([n]);try{t.postMessage({array:i},[i.buffer])}catch(e){return rd._canTransferArrayBuffer=!1,rd._canTransferArrayBuffer}const o=yn();t.onmessage=function(e){const i=e.data.array,r=C(i)&&i[0]===n;o.resolve(r),t.terminate(),rd._canTransferArrayBuffer=r},rd._canTransferArrayBuffer=o.promise}return rd._canTransferArrayBuffer}const Zh=new $n;function $h(e,t){--e._activeTasks;const n=t.id;if(!C(n))return;const i=e._deferreds,o=i[n];if(C(t.error)){let e=t.error;"RuntimeError"===e.name?(e=new Je(t.error.message),e.stack=t.error.stack):"DeveloperError"===e.name&&(e=new x(t.error.message),e.stack=t.error.stack),Zh.raiseEvent(e),o.reject(e)}else Zh.raiseEvent(),o.resolve(t.result);delete i[n]}function ed(e){let t=Zi(e);if(Pn(t)){const e=`importScripts("${t}");`;let i;try{i=new Blob([e],{type:"application/javascript"})}catch(n){const t=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,o=new t;o.append(e),i=o.getBlob("application/javascript")}const o=window.URL||window.webkitURL;t=o.createObjectURL(i)}return t}let td;function nd(){return C(td)||(td=ed("Workers/cesiumWorkerBootstrapper.js")),td}function id(e){const t=new Worker(nd());t.postMessage=R(t.webkitPostMessage,t.postMessage);const n={loaderConfig:{paths:{Workers:Zi("Workers")},baseUrl:Zi.getCesiumBaseUrl().url},workerModule:e._workerPath};return t.postMessage(n),t.onmessage=function(t){$h(e,t.data)},t}function od(e,t){const n={modulePath:void 0,wasmBinaryFile:void 0,wasmBinary:void 0};if(!Oc.supportsWebAssembly()){if(!C(t.fallbackModulePath))throw new Je(`This browser does not support Web Assembly, and no backup module was provided for ${e._workerPath}`);return n.modulePath=Zi(t.fallbackModulePath),Promise.resolve(n)}return n.modulePath=Zi(t.modulePath),n.wasmBinaryFile=Zi(t.wasmBinaryFile),Vi.fetchArrayBuffer({url:n.wasmBinaryFile}).then((function(e){return n.wasmBinary=e,n}))}function rd(e,t){const n=new cn(e);this._workerPath=0!==n.scheme().length&&0===n.fragment().length?e:rd._workerModulePrefix+e,this._maximumActiveTasks=R(t,Number.POSITIVE_INFINITY),this._activeTasks=0,this._deferreds={},this._nextID=0}const sd=[];rd.prototype.scheduleTask=function(e,t){if(C(this._worker)||(this._worker=id(this)),this._activeTasks>=this._maximumActiveTasks)return;++this._activeTasks;const n=this;return Promise.resolve(Jh()).then((function(i){C(t)?i||(t.length=0):t=sd;const o=n._nextID++,r=yn();return n._deferreds[o]=r,n._worker.postMessage({id:o,parameters:e,canTransferArrayBuffer:i},t),r.promise}))},rd.prototype.initWebAssemblyModule=function(e){C(this._worker)||(this._worker=id(this));const t=yn(),n=this,i=this._worker;return od(this,e).then((function(e){return Promise.resolve(Jh()).then((function(o){let r;const s=e.wasmBinary;C(s)&&o&&(r=[s]),i.onmessage=function(e){i.onmessage=function(e){$h(n,e.data)},t.resolve(e.data)},i.postMessage({webAssemblyConfig:e},r)}))})),t.promise},rd.prototype.isDestroyed=function(){return!1},rd.prototype.destroy=function(){return C(this._worker)&&this._worker.terminate(),Qh(this)},rd.taskCompletedEvent=Zh,rd._defaultWorkerModulePrefix="Workers/",rd._workerModulePrefix=rd._defaultWorkerModulePrefix,rd._canTransferArrayBuffer=void 0;var ad=rd;function cd(){x.throwInstantiationError()}Object.defineProperties(cd.prototype,{credits:{get:x.throwInstantiationError},waterMask:{get:x.throwInstantiationError}}),cd.prototype.interpolateHeight=x.throwInstantiationError,cd.prototype.isChildAvailable=x.throwInstantiationError,cd.prototype.createMesh=x.throwInstantiationError,cd.prototype.upsample=x.throwInstantiationError,cd.prototype.wasCreatedByUpsampling=x.throwInstantiationError,cd.maximumAsynchronousTasks=5;var ld=cd;function ud(e,t,n,i,o,r,s,a,c,l,u,h,d,f,p,m){this.center=e,this.vertices=t,this.stride=R(l,6),this.indices=n,this.indexCountWithoutSkirts=i,this.vertexCountWithoutSkirts=o,this.minimumHeight=r,this.maximumHeight=s,this.boundingSphere3D=a,this.occludeePointInScaledSpace=c,this.orientedBoundingBox=u,this.encoding=h,this.westIndicesSouthToNorth=d,this.southIndicesEastToWest=f,this.eastIndicesNorthToSouth=p,this.northIndicesWestToEast=m}var hd=ud;const dd={UNSIGNED_BYTE:th.UNSIGNED_BYTE,UNSIGNED_SHORT:th.UNSIGNED_SHORT,UNSIGNED_INT:th.UNSIGNED_INT,getSizeInBytes:function(e){switch(e){case dd.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case dd.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case dd.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT}throw new x("indexDatatype is required and must be a valid IndexDatatype constant.")},fromSizeInBytes:function(e){switch(e){case 2:return dd.UNSIGNED_SHORT;case 4:return dd.UNSIGNED_INT;case 1:return dd.UNSIGNED_BYTE;default:throw new x("Size in bytes cannot be mapped to an IndexDatatype")}},validate:function(e){return C(e)&&(e===dd.UNSIGNED_BYTE||e===dd.UNSIGNED_SHORT||e===dd.UNSIGNED_INT)},createTypedArray:function(e,t){if(!C(e))throw new x("numberOfVertices is required.");return e>=z.SIXTY_FOUR_KILOBYTES?new Uint32Array(t):new Uint16Array(t)},createTypedArrayFromArrayBuffer:function(e,t,n,i){if(!C(e))throw new x("numberOfVertices is required.");if(!C(t))throw new x("sourceArray is required.");if(!C(n))throw new x("byteOffset is required.");return e>=z.SIXTY_FOUR_KILOBYTES?new Uint32Array(t,n,i):new Uint16Array(t,n,i)}};var fd=Object.freeze(dd);function pd(){x.throwInstantiationError()}Object.defineProperties(pd.prototype,{errorEvent:{get:x.throwInstantiationError},credit:{get:x.throwInstantiationError},tilingScheme:{get:x.throwInstantiationError},ready:{get:x.throwInstantiationError},readyPromise:{get:x.throwInstantiationError},hasWaterMask:{get:x.throwInstantiationError},hasVertexNormals:{get:x.throwInstantiationError},availability:{get:x.throwInstantiationError}});const md=[];pd.getRegularGridIndices=function(e,t){if(e*t>=z.FOUR_GIGABYTES)throw new x("The total number of vertices (width * height) must be less than 4,294,967,296.");let n=md[e];C(n)||(md[e]=n=[]);let i=n[t];return C(i)||(i=e*t<z.SIXTY_FOUR_KILOBYTES?n[t]=new Uint16Array((e-1)*(t-1)*6):n[t]=new Uint32Array((e-1)*(t-1)*6),vd(e,t,i,0)),i};const _d=[];pd.getRegularGridIndicesAndEdgeIndices=function(e,t){if(e*t>=z.FOUR_GIGABYTES)throw new x("The total number of vertices (width * height) must be less than 4,294,967,296.");let n=_d[e];C(n)||(_d[e]=n=[]);let i=n[t];if(!C(i)){const o=pd.getRegularGridIndices(e,t),r=yd(e,t),s=r.westIndicesSouthToNorth,a=r.southIndicesEastToWest,c=r.eastIndicesNorthToSouth,l=r.northIndicesWestToEast;i=n[t]={indices:o,westIndicesSouthToNorth:s,southIndicesEastToWest:a,eastIndicesNorthToSouth:c,northIndicesWestToEast:l}}return i};const gd=[];function yd(e,t){const n=new Array(t),i=new Array(e),o=new Array(t),r=new Array(e);let s;for(s=0;s<e;++s)r[s]=s,i[s]=e*t-1-s;for(s=0;s<t;++s)o[s]=(s+1)*e-1,n[s]=(t-s-1)*e;return{westIndicesSouthToNorth:n,southIndicesEastToWest:i,eastIndicesNorthToSouth:o,northIndicesWestToEast:r}}function vd(e,t,n,i){let o=0;for(let r=0;r<t-1;++r){for(let t=0;t<e-1;++t){const t=o,r=t+e,s=r+1,a=t+1;n[i++]=t,n[i++]=r,n[i++]=a,n[i++]=a,n[i++]=r,n[i++]=s,++o}++o}}function bd(e,t,n,i){let o=e[0];const r=e.length;for(let s=1;s<r;++s){const r=e[s];n[i++]=o,n[i++]=r,n[i++]=t,n[i++]=t,n[i++]=r,n[i++]=t+1,o=r,++t}return i}pd.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){if(e*t>=z.FOUR_GIGABYTES)throw new x("The total number of vertices (width * height) must be less than 4,294,967,296.");let n=gd[e];C(n)||(gd[e]=n=[]);let i=n[t];if(!C(i)){const o=e*t,r=(e-1)*(t-1)*6,s=2*e+2*t,a=6*Math.max(0,s-4),c=o+s,l=r+a,u=yd(e,t),h=u.westIndicesSouthToNorth,d=u.southIndicesEastToWest,f=u.eastIndicesNorthToSouth,p=u.northIndicesWestToEast,m=fd.createTypedArray(c,l);vd(e,t,m,0),pd.addSkirtIndices(h,d,f,p,o,m,r),i=n[t]={indices:m,westIndicesSouthToNorth:h,southIndicesEastToWest:d,eastIndicesNorthToSouth:f,northIndicesWestToEast:p,indexCountWithoutSkirts:r}}return i},pd.addSkirtIndices=function(e,t,n,i,o,r,s){let a=o;s=bd(e,a,r,s),a+=e.length,s=bd(t,a,r,s),a+=t.length,s=bd(n,a,r,s),a+=n.length,bd(i,a,r,s)},pd.heightmapTerrainQuality=.25,pd.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,n){return 2*e.maximumRadius*Math.PI*pd.heightmapTerrainQuality/(t*n)},pd.prototype.requestTileGeometry=x.throwInstantiationError,pd.prototype.getLevelMaximumGeometricError=x.throwInstantiationError,pd.prototype.getTileDataAvailable=x.throwInstantiationError,pd.prototype.loadTileDataAvailability=x.throwInstantiationError;var Ad=pd;function wd(e){if(!C(e)||!C(e.buffer))throw new x("options.buffer is required.");if(!C(e.width))throw new x("options.width is required.");if(!C(e.height))throw new x("options.height is required.");this._buffer=e.buffer,this._width=e.width,this._height=e.height,this._childTileMask=R(e.childTileMask,15),this._encoding=R(e.encoding,Er.NONE);const t=Yh.DEFAULT_STRUCTURE;let n=e.structure;C(n)?n!==t&&(n.heightScale=R(n.heightScale,t.heightScale),n.heightOffset=R(n.heightOffset,t.heightOffset),n.elementsPerHeight=R(n.elementsPerHeight,t.elementsPerHeight),n.stride=R(n.stride,t.stride),n.elementMultiplier=R(n.elementMultiplier,t.elementMultiplier),n.isBigEndian=R(n.isBigEndian,t.isBigEndian)):n=t,this._structure=n,this._createdByUpsampling=R(e.createdByUpsampling,!1),this._waterMask=e.waterMask,this._skirtHeight=void 0,this._bufferType=this._encoding===Er.LERC?Float32Array:this._buffer.constructor,this._mesh=void 0}Object.defineProperties(wd.prototype,{credits:{get:function(){}},waterMask:{get:function(){return this._waterMask}},childTileMask:{get:function(){return this._childTileMask}}});const Td="createVerticesFromHeightmap",Cd=new ad(Td),Ed=new ad(Td,ld.maximumAsynchronousTasks);function xd(e,t,n,i,o,r,s,a,c,l){const u=(c-r.west)*(s-1)/(r.east-r.west),h=(l-r.south)*(a-1)/(r.north-r.south);let d=0|u,f=d+1;f>=s&&(f=s-1,d=s-2);let p=0|h,m=p+1;m>=a&&(m=a-1,p=a-2);const _=u-d,g=h-p;p=a-1-p,m=a-1-m;const y=Od(e,t,n,i,o,p*s+d),v=Od(e,t,n,i,o,p*s+f),b=Od(e,t,n,i,o,m*s+d),A=Od(e,t,n,i,o,m*s+f);return Id(_,g,y,v,b,A)}function Sd(e,t,n,i,o,r,s,a,c){const l=(a-o.west)*(r-1)/(o.east-o.west),u=(c-o.south)*(s-1)/(o.north-o.south);let h=0|l,d=h+1;d>=r&&(d=r-1,h=r-2);let f=0|u,p=f+1;p>=s&&(p=s-1,f=s-2);const m=l-h,_=u-f;f=s-1-f,p=s-1-p;const g=(t.decodeHeight(e,f*r+h)-n)/i,y=(t.decodeHeight(e,f*r+d)-n)/i,v=(t.decodeHeight(e,p*r+h)-n)/i,b=(t.decodeHeight(e,p*r+d)-n)/i;return Id(m,_,g,y,v,b)}function Id(e,t,n,i,o,r){return t<e?n+e*(i-n)+t*(r-i):n+e*(r-o)+t*(o-n)}function Od(e,t,n,i,o,r){r*=i;let s,a=0;if(o)for(s=0;s<t;++s)a=a*n+e[r+s];else for(s=t-1;s>=0;--s)a=a*n+e[r+s];return a}function Dd(e,t,n,i,o,r,s,a){let c;if(s*=o,r)for(c=0;c<t-1;++c)e[s+c]=a/i|0,a-=e[s+c]*i,i/=n;else for(c=t-1;c>0;--c)e[s+c]=a/i|0,a-=e[s+c]*i,i/=n;e[s+c]=a}wd.prototype.createMesh=function(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.object("options.tilingScheme",e.tilingScheme),D.typeOf.number("options.x",e.x),D.typeOf.number("options.y",e.y),D.typeOf.number("options.level",e.level);const t=e.tilingScheme,n=e.x,i=e.y,o=e.level,r=R(e.exaggeration,1),s=R(e.exaggerationRelativeHeight,0),a=R(e.throttle,!0),c=t.ellipsoid,l=t.tileXYToNativeRectangle(n,i,o),u=t.tileXYToRectangle(n,i,o),h=c.cartographicToCartesian(_t.center(u)),d=this._structure,f=Ad.getEstimatedLevelZeroGeometricErrorForAHeightmap(c,this._width,t.getNumberOfXTilesAtLevel(0)),p=f/(1<<o);this._skirtHeight=Math.min(4*p,1e3);const m=a?Ed:Cd,_=m.scheduleTask({heightmap:this._buffer,structure:d,includeWebMercatorT:!0,width:this._width,height:this._height,nativeRectangle:l,rectangle:u,relativeToCenter:h,ellipsoid:c,skirtHeight:this._skirtHeight,isGeographic:t.projection instanceof ve,exaggeration:r,exaggerationRelativeHeight:s,encoding:this._encoding});if(!C(_))return;const g=this;return Promise.resolve(_).then((function(e){let t;t=g._skirtHeight>0?Ad.getRegularGridAndSkirtIndicesAndEdgeIndices(e.gridWidth,e.gridHeight):Ad.getRegularGridIndicesAndEdgeIndices(e.gridWidth,e.gridHeight);const n=e.gridWidth*e.gridHeight;return g._mesh=new hd(h,new Float32Array(e.vertices),t.indices,t.indexCountWithoutSkirts,n,e.minimumHeight,e.maximumHeight,nn.clone(e.boundingSphere3D),K.clone(e.occludeePointInScaledSpace),e.numberOfAttributes,$u.clone(e.orientedBoundingBox),kh.clone(e.encoding),t.westIndicesSouthToNorth,t.southIndicesEastToWest,t.eastIndicesNorthToSouth,t.northIndicesWestToEast),g._buffer=void 0,g._mesh}))},wd.prototype._createMeshSync=function(e){D.typeOf.object("options.tilingScheme",e.tilingScheme),D.typeOf.number("options.x",e.x),D.typeOf.number("options.y",e.y),D.typeOf.number("options.level",e.level);const t=e.tilingScheme,n=e.x,i=e.y,o=e.level,r=R(e.exaggeration,1),s=R(e.exaggerationRelativeHeight,0),a=t.ellipsoid,c=t.tileXYToNativeRectangle(n,i,o),l=t.tileXYToRectangle(n,i,o),u=a.cartographicToCartesian(_t.center(l)),h=this._structure,d=Ad.getEstimatedLevelZeroGeometricErrorForAHeightmap(a,this._width,t.getNumberOfXTilesAtLevel(0)),f=d/(1<<o);this._skirtHeight=Math.min(4*f,1e3);const p=Yh.computeVertices({heightmap:this._buffer,structure:h,includeWebMercatorT:!0,width:this._width,height:this._height,nativeRectangle:c,rectangle:l,relativeToCenter:u,ellipsoid:a,skirtHeight:this._skirtHeight,isGeographic:t.projection instanceof ve,exaggeration:r,exaggerationRelativeHeight:s});let m;this._buffer=void 0,m=this._skirtHeight>0?Ad.getRegularGridAndSkirtIndicesAndEdgeIndices(this._width,this._height):Ad.getRegularGridIndicesAndEdgeIndices(this._width,this._height);const _=p.gridWidth*p.gridHeight;return this._mesh=new hd(u,p.vertices,m.indices,m.indexCountWithoutSkirts,_,p.minimumHeight,p.maximumHeight,p.boundingSphere3D,p.occludeePointInScaledSpace,p.encoding.stride,p.orientedBoundingBox,p.encoding,m.westIndicesSouthToNorth,m.southIndicesEastToWest,m.eastIndicesNorthToSouth,m.northIndicesWestToEast),this._mesh},wd.prototype.interpolateHeight=function(e,t,n){const i=this._width,o=this._height,r=this._structure,s=r.stride,a=r.elementsPerHeight,c=r.elementMultiplier,l=r.isBigEndian,u=r.heightOffset,h=r.heightScale,d=C(this._mesh),f=this._encoding===Er.LERC,p=!d&&f;if(p)return;let m;if(d){const r=this._mesh.vertices,s=this._mesh.encoding;m=Sd(r,s,u,h,e,i,o,t,n)}else m=xd(this._buffer,a,c,s,l,e,i,o,t,n),m=m*h+u;return m},wd.prototype.upsample=function(e,t,n,i,o,r,s){if(!C(e))throw new x("tilingScheme is required.");if(!C(t))throw new x("thisX is required.");if(!C(n))throw new x("thisY is required.");if(!C(i))throw new x("thisLevel is required.");if(!C(o))throw new x("descendantX is required.");if(!C(r))throw new x("descendantY is required.");if(!C(s))throw new x("descendantLevel is required.");const a=s-i;if(a>1)throw new x("Upsampling through more than one level at a time is not currently supported.");const c=this._mesh;if(!C(c))return;const l=this._width,u=this._height,h=this._structure,d=h.stride,f=new this._bufferType(l*u*d),p=c.vertices,m=c.encoding,_=e.tileXYToRectangle(t,n,i),g=e.tileXYToRectangle(o,r,s),y=h.heightOffset,v=h.heightScale,b=h.elementsPerHeight,A=h.elementMultiplier,w=h.isBigEndian,T=Math.pow(A,b-1);for(let C=0;C<u;++C){const e=z.lerp(g.north,g.south,C/(u-1));for(let t=0;t<l;++t){const n=z.lerp(g.west,g.east,t/(l-1));let i=Sd(p,m,y,v,_,l,u,n,e);i=i<h.lowestEncodedHeight?h.lowestEncodedHeight:i,i=i>h.highestEncodedHeight?h.highestEncodedHeight:i,Dd(f,b,A,T,d,w,C*l+t,i)}}return new wd({buffer:f,width:l,height:u,childTileMask:0,structure:this._structure,createdByUpsampling:!0})},wd.prototype.isChildAvailable=function(e,t,n,i){if(!C(e))throw new x("thisX is required.");if(!C(t))throw new x("thisY is required.");if(!C(n))throw new x("childX is required.");if(!C(i))throw new x("childY is required.");let o=2;return n!==2*e&&++o,i!==2*t&&(o-=2),0!==(this._childTileMask&1<<o)},wd.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling};var Pd=wd;function Rd(e,t){this._tilingScheme=e,this._maximumLevel=t,this._rootNodes=[]}const Ld=new _t;function Md(e,t,n,i){const o=i.length;for(let r=0;r<o;++r){const o=i[r];if(o.x===t&&o.y===n&&o.level===e)return!0}return!1}Rd.prototype.addAvailableTileRange=function(e,t,n,i,o){const r=this._tilingScheme,s=this._rootNodes;if(0===e)for(let d=n;d<=o;++d)for(let n=t;n<=i;++n)Md(e,n,d,s)||s.push(new Ud(r,void 0,0,n,d));r.tileXYToRectangle(t,n,e,Ld);const a=Ld.west,c=Ld.north;r.tileXYToRectangle(i,o,e,Ld);const l=Ld.east,u=Ld.south,h=new Vd(e,a,u,l,c);for(let d=0;d<s.length;++d){const e=s[d];Hd(e.extent,h)&&Gd(this._maximumLevel,e,h)}},Rd.prototype.computeMaximumLevelAtPosition=function(e){let t;for(let n=0;n<this._rootNodes.length;++n){const i=this._rootNodes[n];if(jd(i.extent,e)){t=i;break}}return C(t)?Yd(void 0,t,e):-1};const Bd=[],Nd=[],Fd=new _t,zd=new _t;Rd.prototype.computeBestAvailableLevelOverRectangle=function(e){const t=Bd;t.length=0,e.east<e.west?(t.push(_t.fromRadians(-Math.PI,e.south,e.east,e.north,Fd)),t.push(_t.fromRadians(e.west,e.south,Math.PI,e.north,zd))):t.push(e);const n=Nd;let i;for(n.length=0,i=0;i<this._rootNodes.length;++i)Kd(n,this._rootNodes[i],t);for(i=n.length-1;i>=0;--i)if(C(n[i])&&0===n[i].length)return i;return 0};const kd=new se;function Ud(e,t,n,i,o){this.tilingScheme=e,this.parent=t,this.level=n,this.x=i,this.y=o,this.extent=e.tileXYToRectangle(i,o,n),this.rectangles=[],this._sw=void 0,this._se=void 0,this._nw=void 0,this._ne=void 0}function Vd(e,t,n,i,o){this.level=e,this.west=t,this.south=n,this.east=i,this.north=o}function Hd(e,t){const n=Math.max(e.west,t.west),i=Math.max(e.south,t.south),o=Math.min(e.east,t.east),r=Math.min(e.north,t.north);return i<r&&n<o}function Gd(e,t,n){while(t.level<e)if(qd(t.nw.extent,n))t=t.nw;else if(qd(t.ne.extent,n))t=t.ne;else if(qd(t.sw.extent,n))t=t.sw;else{if(!qd(t.se.extent,n))break;t=t.se}if(0===t.rectangles.length||t.rectangles[t.rectangles.length-1].level<=n.level)t.rectangles.push(n);else{let e=qs(t.rectangles,n.level,Wd);e<0&&(e=~e),t.rectangles.splice(e,0,n)}}function Wd(e,t){return e.level-t}function qd(e,t){return t.west>=e.west&&t.east<=e.east&&t.south>=e.south&&t.north<=e.north}function jd(e,t){return t.longitude>=e.west&&t.longitude<=e.east&&t.latitude>=e.south&&t.latitude<=e.north}function Yd(e,t,n){let i=0,o=!1;while(!o){const e=t._nw&&jd(t._nw.extent,n),r=t._ne&&jd(t._ne.extent,n),s=t._sw&&jd(t._sw.extent,n),a=t._se&&jd(t._se.extent,n);if(e+r+s+a>1){e&&(i=Math.max(i,Yd(t,t._nw,n))),r&&(i=Math.max(i,Yd(t,t._ne,n))),s&&(i=Math.max(i,Yd(t,t._sw,n))),a&&(i=Math.max(i,Yd(t,t._se,n)));break}e?t=t._nw:r?t=t._ne:s?t=t._sw:a?t=t._se:o=!0}while(t!==e){const e=t.rectangles;for(let t=e.length-1;t>=0&&e[t].level>i;--t){const o=e[t];jd(o,n)&&(i=o.level)}t=t.parent}return i}function Kd(e,t,n){if(!t)return;let i,o=!1;for(i=0;i<n.length;++i)o=o||Hd(t.extent,n[i]);if(!o)return;const r=t.rectangles;for(i=0;i<r.length;++i){const t=r[i];e[t.level]||(e[t.level]=n),e[t.level]=Xd(e[t.level],t)}Kd(e,t._nw,n),Kd(e,t._ne,n),Kd(e,t._sw,n),Kd(e,t._se,n)}function Xd(e,t){const n=[];for(let i=0;i<e.length;++i){const o=e[i];Hd(o,t)?(o.west<t.west&&n.push(new _t(o.west,o.south,t.west,o.north)),o.east>t.east&&n.push(new _t(t.east,o.south,o.east,o.north)),o.south<t.south&&n.push(new _t(Math.max(t.west,o.west),o.south,Math.min(t.east,o.east),t.south)),o.north>t.north&&n.push(new _t(Math.max(t.west,o.west),t.north,Math.min(t.east,o.east),o.north))):n.push(o)}return n}Rd.prototype.isTileAvailable=function(e,t,n){const i=this._tilingScheme.tileXYToRectangle(t,n,e,Ld);return _t.center(i,kd),this.computeMaximumLevelAtPosition(kd)>=e},Rd.prototype.computeChildMaskForTile=function(e,t,n){const i=e+1;if(i>=this._maximumLevel)return 0;let o=0;return o|=this.isTileAvailable(i,2*t,2*n+1)?1:0,o|=this.isTileAvailable(i,2*t+1,2*n+1)?2:0,o|=this.isTileAvailable(i,2*t,2*n)?4:0,o|=this.isTileAvailable(i,2*t+1,2*n)?8:0,o},Object.defineProperties(Ud.prototype,{nw:{get:function(){return this._nw||(this._nw=new Ud(this.tilingScheme,this,this.level+1,2*this.x,2*this.y)),this._nw}},ne:{get:function(){return this._ne||(this._ne=new Ud(this.tilingScheme,this,this.level+1,2*this.x+1,2*this.y)),this._ne}},sw:{get:function(){return this._sw||(this._sw=new Ud(this.tilingScheme,this,this.level+1,2*this.x,2*this.y+1)),this._sw}},se:{get:function(){return this._se||(this._se=new Ud(this.tilingScheme,this,this.level+1,2*this.x+1,2*this.y+1)),this._se}}});var Qd=Rd;function Jd(e){let t;const n=e.name,i=e.message;t=C(n)&&C(i)?`${n}: ${i}`:e.toString();const o=e.stack;return C(o)&&(t+=`\n${o}`),t}var Zd=Jd;function $d(e,t,n,i,o,r,s){this.provider=e,this.message=t,this.x=n,this.y=i,this.level=o,this.timesRetried=R(r,0),this.retry=!1,this.error=s}$d.handleError=function(e,t,n,i,o,r,s,a,c){let l=e;return C(e)?(l.provider=t,l.message=i,l.x=o,l.y=r,l.level=s,l.retry=!1,l.error=c,++l.timesRetried):l=new $d(t,i,o,r,s,0,c),n.numberOfListeners>0?n.raiseEvent(l):console.log(`An error occurred in "${t.constructor.name}": ${Zd(i)}`),l.retry&&C(a)&&a(),l},$d.handleSuccess=function(e){C(e)&&(e.timesRetried=-1)};var ef=$d;function tf(e){if(e=R(e,R.EMPTY_OBJECT),this._ellipsoid=R(e.ellipsoid,ge.WGS84),this._numberOfLevelZeroTilesX=R(e.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=R(e.numberOfLevelZeroTilesY,1),this._projection=new Vh(this._ellipsoid),C(e.rectangleSouthwestInMeters)&&C(e.rectangleNortheastInMeters))this._rectangleSouthwestInMeters=e.rectangleSouthwestInMeters,this._rectangleNortheastInMeters=e.rectangleNortheastInMeters;else{const e=this._ellipsoid.maximumRadius*Math.PI;this._rectangleSouthwestInMeters=new ro(-e,-e),this._rectangleNortheastInMeters=new ro(e,e)}const t=this._projection.unproject(this._rectangleSouthwestInMeters),n=this._projection.unproject(this._rectangleNortheastInMeters);this._rectangle=new _t(t.longitude,t.latitude,n.longitude,n.latitude)}Object.defineProperties(tf.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),tf.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},tf.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},tf.prototype.rectangleToNativeRectangle=function(e,t){const n=this._projection,i=n.project(_t.southwest(e)),o=n.project(_t.northeast(e));return C(t)?(t.west=i.x,t.south=i.y,t.east=o.x,t.north=o.y,t):new _t(i.x,i.y,o.x,o.y)},tf.prototype.tileXYToNativeRectangle=function(e,t,n,i){const o=this.getNumberOfXTilesAtLevel(n),r=this.getNumberOfYTilesAtLevel(n),s=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/o,a=this._rectangleSouthwestInMeters.x+e*s,c=this._rectangleSouthwestInMeters.x+(e+1)*s,l=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/r,u=this._rectangleNortheastInMeters.y-t*l,h=this._rectangleNortheastInMeters.y-(t+1)*l;return C(i)?(i.west=a,i.south=h,i.east=c,i.north=u,i):new _t(a,h,c,u)},tf.prototype.tileXYToRectangle=function(e,t,n,i){const o=this.tileXYToNativeRectangle(e,t,n,i),r=this._projection,s=r.unproject(new ro(o.west,o.south)),a=r.unproject(new ro(o.east,o.north));return o.west=s.longitude,o.south=s.latitude,o.east=a.longitude,o.north=a.latitude,o},tf.prototype.positionToTileXY=function(e,t,n){const i=this._rectangle;if(!_t.contains(i,e))return;const o=this.getNumberOfXTilesAtLevel(t),r=this.getNumberOfYTilesAtLevel(t),s=this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x,a=s/o,c=this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y,l=c/r,u=this._projection,h=u.project(e),d=h.x-this._rectangleSouthwestInMeters.x,f=this._rectangleNortheastInMeters.y-h.y;let p=d/a|0;p>=o&&(p=o-1);let m=f/l|0;return m>=r&&(m=r-1),C(n)?(n.x=p,n.y=m,n):new ro(p,m)};var nf=tf;const of=15;function rf(e){if(!C(e)||!C(e.url))throw new x("options.url is required.");this._resource=void 0,this._credit=void 0,this._tilingScheme=void 0,this._levelZeroMaximumGeometricError=void 0,this._maxLevel=void 0,this._terrainDataStructure=void 0,this._ready=!1,this._width=void 0,this._height=void 0,this._encoding=void 0;const t=e.token;this._hasAvailability=!1,this._tilesAvailable=void 0,this._tilesAvailablityLoaded=void 0,this._availableCache={};const n=this,i=R(e.ellipsoid,ge.WGS84);this._readyPromise=Promise.resolve(e.url).then((function(e){let i=Vi.createIfNeeded(e);i.appendForwardSlash(),C(t)&&(i=i.getDerivedResource({queryParameters:{token:t}})),n._resource=i;const o=i.getDerivedResource({queryParameters:{f:"pjson"}});return o.fetchJson()})).then((function(e){const t=e.copyrightText;C(t)&&(n._credit=new Tr(t));const o=e.spatialReference,r=R(o.latestWkid,o.wkid),s=e.extent,a={ellipsoid:i};if(4326===r)a.rectangle=_t.fromDegrees(s.xmin,s.ymin,s.xmax,s.ymax),n._tilingScheme=new ao(a);else{if(3857!==r)return Promise.reject(new Je("Invalid spatial reference"));a.rectangleSouthwestInMeters=new ro(s.xmin,s.ymin),a.rectangleNortheastInMeters=new ro(s.xmax,s.ymax),n._tilingScheme=new nf(a)}const c=e.tileInfo;if(!C(c))return Promise.reject(new Je("tileInfo is required"));n._width=c.rows+1,n._height=c.cols+1,n._encoding="LERC"===c.format?Er.LERC:Er.NONE,n._lodCount=c.lods.length-1;const l=n._hasAvailability=-1!==e.capabilities.indexOf("Tilemap");return l&&(n._tilesAvailable=new Qd(n._tilingScheme,n._lodCount),n._tilesAvailable.addAvailableTileRange(0,0,0,n._tilingScheme.getNumberOfXTilesAtLevel(0),n._tilingScheme.getNumberOfYTilesAtLevel(0)),n._tilesAvailablityLoaded=new Qd(n._tilingScheme,n._lodCount)),n._levelZeroMaximumGeometricError=Ad.getEstimatedLevelZeroGeometricErrorForAHeightmap(n._tilingScheme.ellipsoid,n._width,n._tilingScheme.getNumberOfXTilesAtLevel(0)),e.bandCount>1&&console.log("ArcGISTiledElevationTerrainProvider: Terrain data has more than 1 band. Using the first one."),n._terrainDataStructure={elementMultiplier:1,lowestEncodedHeight:e.minValues[0],highestEncodedHeight:e.maxValues[0]},n._ready=!0,!0})).catch((function(e){const t=`An error occurred while accessing ${n._resource.url}.`;return ef.handleError(void 0,n,n._errorEvent,t),Promise.reject(e)})),this._errorEvent=new $n}function sf(e,t,n,i){if(!e._hasAvailability)return;const o=e._tilesAvailablityLoaded,r=e._tilesAvailable;return!(t>e._lodCount)&&(!!r.isTileAvailable(t,n,i)||!o.isTileAvailable(t,n,i)&&void 0)}function af(e,t,n,i){const o=t-1,r=n-1,s=i[e.y*t+e.x],a=[],c={startX:e.x,startY:e.y,endX:0,endY:0},l=new ro(e.x+1,e.y+1);let u=!1,h=!1;while(!u||!h){let n=l.x;const d=h?l.y+1:l.y;if(!u){for(let n=e.y;n<d;++n)if(i[n*t+l.x]!==s){u=!0;break}u?(a.push(new ro(l.x,e.y)),--l.x,--n,c.endX=l.x):l.x===o?(c.endX=l.x,u=!0):++l.x}if(!h){const o=l.y*t;for(let t=e.x;t<=n;++t)if(i[o+t]!==s){h=!0;break}h?(a.push(new ro(e.x,l.y)),--l.y,c.endY=l.y):l.y===r?(c.endY=l.y,h=!0):++l.y}}return{endingIndices:a,range:c,value:s}}function cf(e,t,n,i,o){const r=[],s=o.every((function(e){return e===o[0]}));if(s)return 1===o[0]&&r.push({startX:e,startY:t,endX:e+n-1,endY:t+i-1}),r;let a=[new ro(0,0)];while(a.length>0){const s=a.pop(),c=af(s,n,i,o);if(1===c.value){const n=c.range;n.startX+=e,n.endX+=e,n.startY+=t,n.endY+=t,r.push(n)}const l=c.endingIndices;l.length>0&&(a=a.concat(l))}return r}function lf(e,t,n,i){if(!e._hasAvailability)return{};const o=128*Math.floor(n/128),r=128*Math.floor(i/128),s=Math.min(1<<t,128),a=`tilemap/${t}/${r}/${o}/${s}/${s}`,c=e._availableCache;if(C(c[a]))return c[a];const l=new jn({throttle:!1,throttleByServer:!0,type:Wn.TERRAIN}),u=e._resource.getDerivedResource({url:a,request:l});let h=u.fetchJson();return C(h)?(h=h.then((function(a){const c=cf(o,r,s,s,a.data);e._tilesAvailablityLoaded.addAvailableTileRange(t,o,r,o+s,r+s);const l=e._tilesAvailable;for(let e=0;e<c.length;++e){const n=c[e];l.addAvailableTileRange(t,n.startX,n.startY,n.endX,n.endY)}return sf(e,t,n,i)})),c[a]={promise:h,request:l},h=h.finally((function(e){return delete c[a],e})),{promise:h,request:l}):{}}Object.defineProperties(rf.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){if(!this.ready)throw new x("credit must not be called before ready returns true.");return this._credit}},tilingScheme:{get:function(){if(!this.ready)throw new x("tilingScheme must not be called before ready returns true.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){if(!this._ready)throw new x("availability must not be called before the terrain provider is ready.");return this._tilesAvailable}}}),rf.prototype.requestTileGeometry=function(e,t,n,i){if(!this._ready)throw new x("requestTileGeometry must not be called before the terrain provider is ready.");const o=this._resource.getDerivedResource({url:`tile/${n}/${t}/${e}`,request:i}),r=this._hasAvailability;let s,a=Promise.resolve(!0);if(r&&!C(sf(this,n+1,2*e,2*t))){const i=lf(this,n+1,2*e,2*t);a=i.promise,s=i.request}const c=o.fetchArrayBuffer();if(!C(c)||!C(a))return;const l=this,u=this._tilesAvailable;return Promise.all([c,a]).then((function(i){return new Pd({buffer:i[0],width:l._width,height:l._height,childTileMask:r?u.computeChildMaskForTile(n,e,t):of,structure:l._terrainDataStructure,encoding:l._encoding})})).catch((function(e){return C(s)&&s.state===Hn.CANCELLED?(i.cancel(),i.deferred.promise.finally((function(){return i.state=Hn.CANCELLED,Promise.reject(e)}))):Promise.reject(e)}))},rf.prototype.getLevelMaximumGeometricError=function(e){if(!this.ready)throw new x("getLevelMaximumGeometricError must not be called before ready returns true.");return this._levelZeroMaximumGeometricError/(1<<e)},rf.prototype.getTileDataAvailable=function(e,t,n){if(!this._hasAvailability)return;const i=sf(this,n,e,t);if(C(i))return i;lf(this,n,e,t)},rf.prototype.loadTileDataAvailability=function(e,t,n){};const uf={NONE:0,GEODESIC:1,RHUMB:2};var hf=Object.freeze(uf);function df(){this._array=[],this._hash={}}Object.defineProperties(df.prototype,{length:{get:function(){return this._array.length}},values:{get:function(){return this._array}}}),df.prototype.contains=function(e){if("string"!==typeof e&&"number"!==typeof e)throw new x("key is required to be a string or number.");return C(this._hash[e])},df.prototype.set=function(e,t){if("string"!==typeof e&&"number"!==typeof e)throw new x("key is required to be a string or number.");const n=this._hash[e];t!==n&&(this.remove(e),this._hash[e]=t,this._array.push(t))},df.prototype.get=function(e){if("string"!==typeof e&&"number"!==typeof e)throw new x("key is required to be a string or number.");return this._hash[e]},df.prototype.remove=function(e){if(C(e)&&"string"!==typeof e&&"number"!==typeof e)throw new x("key is required to be a string or number.");const t=this._hash[e],n=C(t);if(n){const n=this._array;n.splice(n.indexOf(t),1),delete this._hash[e]}return n},df.prototype.removeAll=function(){const e=this._array;e.length>0&&(this._hash={},e.length=0)};var ff=df;const pf="https://dev.virtualearth.net/REST/v1/Locations";function mf(e){e=R(e,R.EMPTY_OBJECT);const t=e.key;if(!C(t))throw new x("options.key is required.");this._key=t;const n={key:t};C(e.culture)&&(n.culture=e.culture),this._resource=new Vi({url:pf,queryParameters:n})}Object.defineProperties(mf.prototype,{url:{get:function(){return pf}},key:{get:function(){return this._key}}}),mf.prototype.geocode=function(e){D.typeOf.string("query",e);const t=this._resource.getDerivedResource({queryParameters:{query:e}});return t.fetchJsonp("jsonp").then((function(e){if(0===e.resourceSets.length)return[];const t=e.resourceSets[0].resources;return t.map((function(e){const t=e.bbox,n=t[0],i=t[1],o=t[2],r=t[3];return{displayName:e.name,destination:_t.fromDegrees(i,n,r,o)}}))}))};function _f(e,t,n,i){this.x=R(e,0),this.y=R(t,0),this.width=R(n,0),this.height=R(i,0)}_f.packedLength=4,_f.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.width,t[n]=e.height,t},_f.unpack=function(e,t,n){return D.defined("array",e),t=R(t,0),C(n)||(n=new _f),n.x=e[t++],n.y=e[t++],n.width=e[t++],n.height=e[t],n},_f.fromPoints=function(e,t){if(C(t)||(t=new _f),!C(e)||0===e.length)return t.x=0,t.y=0,t.width=0,t.height=0,t;const n=e.length;let i=e[0].x,o=e[0].y,r=e[0].x,s=e[0].y;for(let a=1;a<n;a++){const t=e[a],n=t.x,c=t.y;i=Math.min(n,i),r=Math.max(n,r),o=Math.min(c,o),s=Math.max(c,s)}return t.x=i,t.y=o,t.width=r-i,t.height=s-o,t};const gf=new ve,yf=new se,vf=new se;_f.fromRectangle=function(e,t,n){if(C(n)||(n=new _f),!C(e))return n.x=0,n.y=0,n.width=0,n.height=0,n;t=R(t,gf);const i=t.project(_t.southwest(e,yf)),o=t.project(_t.northeast(e,vf));return ro.subtract(o,i,o),n.x=i.x,n.y=i.y,n.width=o.x,n.height=o.y,n},_f.clone=function(e,t){if(C(e))return C(t)?(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t):new _f(e.x,e.y,e.width,e.height)},_f.union=function(e,t,n){D.typeOf.object("left",e),D.typeOf.object("right",t),C(n)||(n=new _f);const i=Math.min(e.x,t.x),o=Math.min(e.y,t.y),r=Math.max(e.x+e.width,t.x+t.width),s=Math.max(e.y+e.height,t.y+t.height);return n.x=i,n.y=o,n.width=r-i,n.height=s-o,n},_f.expand=function(e,t,n){D.typeOf.object("rectangle",e),D.typeOf.object("point",t),n=_f.clone(e,n);const i=t.x-n.x,o=t.y-n.y;return i>n.width?n.width=i:i<0&&(n.width-=i,n.x=t.x),o>n.height?n.height=o:o<0&&(n.height-=o,n.y=t.y),n},_f.intersect=function(e,t){D.typeOf.object("left",e),D.typeOf.object("right",t);const n=e.x,i=e.y,o=t.x,r=t.y;return n>o+t.width||n+e.width<o||i+e.height<r||i>r+t.height?Ae.OUTSIDE:Ae.INTERSECTING},_f.equals=function(e,t){return e===t||C(e)&&C(t)&&e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height},_f.prototype.clone=function(e){return _f.clone(this,e)},_f.prototype.intersect=function(e){return _f.intersect(this,e)},_f.prototype.equals=function(e){return _f.equals(this,e)};var bf=_f;function Af(e,t,n,i){if(D.defined("array",e),D.defined("value",t),C(n)&&D.typeOf.number("start",n),C(i)&&D.typeOf.number("end",i),"function"===typeof e.fill)return e.fill(t,n,i);const o=e.length>>>0,r=R(n,0);let s=r<0?Math.max(o+r,0):Math.min(r,o);const a=R(i,o),c=a<0?Math.max(o+a,0):Math.min(a,o);while(s<c)e[s]=t,s++;return e}var wf=Af;const Tf={NONE:0,TRIANGLES:1,LINES:2,POLYLINES:3};var Cf=Object.freeze(Tf);const Ef={POINTS:th.POINTS,LINES:th.LINES,LINE_LOOP:th.LINE_LOOP,LINE_STRIP:th.LINE_STRIP,TRIANGLES:th.TRIANGLES,TRIANGLE_STRIP:th.TRIANGLE_STRIP,TRIANGLE_FAN:th.TRIANGLE_FAN,validate:function(e){return e===Ef.POINTS||e===Ef.LINES||e===Ef.LINE_LOOP||e===Ef.LINE_STRIP||e===Ef.TRIANGLES||e===Ef.TRIANGLE_STRIP||e===Ef.TRIANGLE_FAN}};var xf=Object.freeze(Ef);function Sf(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.object("options.attributes",e.attributes),this.attributes=e.attributes,this.indices=e.indices,this.primitiveType=R(e.primitiveType,xf.TRIANGLES),this.boundingSphere=e.boundingSphere,this.geometryType=R(e.geometryType,Cf.NONE),this.boundingSphereCV=e.boundingSphereCV,this.offsetAttribute=e.offsetAttribute}Sf.computeNumberOfVertices=function(e){D.typeOf.object("geometry",e);let t=-1;for(const n in e.attributes)if(e.attributes.hasOwnProperty(n)&&C(e.attributes[n])&&C(e.attributes[n].values)){const i=e.attributes[n],o=i.values.length/i.componentsPerAttribute;if(t!==o&&-1!==t)throw new x("All attribute lists must have the same number of attributes.");t=o}return t};const If=new se,Of=new K,Df=new ft,Pf=[new se,new se,new se],Rf=[new ro,new ro,new ro],Lf=[new ro,new ro,new ro],Mf=new K,Bf=new il,Nf=new ft,Ff=new hh;Sf._textureCoordinateRotationPoints=function(e,t,n,i){let o;const r=_t.center(i,If),s=se.toCartesian(r,n,Of),a=Kl.eastNorthUpToFixedFrame(s,n,Df),c=ft.inverse(a,Df),l=Rf,u=Pf;u[0].longitude=i.west,u[0].latitude=i.south,u[1].longitude=i.west,u[1].latitude=i.north,u[2].longitude=i.east,u[2].latitude=i.south;let h=Mf;for(o=0;o<3;o++)se.toCartesian(u[o],n,h),h=ft.multiplyByPointAsVector(c,h,h),l[o].x=h.x,l[o].y=h.y;const d=il.fromAxisAngle(K.UNIT_Z,-t,Bf),f=ke.fromQuaternion(d,Nf),p=e.length;let m=Number.POSITIVE_INFINITY,_=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,y=Number.NEGATIVE_INFINITY;for(o=0;o<p;o++)h=ft.multiplyByPointAsVector(c,e[o],h),h=ke.multiplyByVector(f,h,h),m=Math.min(m,h.x),_=Math.min(_,h.y),g=Math.max(g,h.x),y=Math.max(y,h.y);const v=hh.fromRotation(t,Ff),b=Lf;b[0].x=m,b[0].y=_,b[1].x=m,b[1].y=y,b[2].x=g,b[2].y=_;const A=l[0],w=l[2].x-A.x,T=l[1].y-A.y;for(o=0;o<3;o++){const e=b[o];hh.multiplyByVector(v,e,e),e.x=(e.x-A.x)/w,e.y=(e.y-A.y)/T}const C=b[0],E=b[1],x=b[2],S=new Array(6);return ro.pack(C,S),ro.pack(E,S,2),ro.pack(x,S,4),S};var zf=Sf;function kf(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.componentDatatype))throw new x("options.componentDatatype is required.");if(!C(e.componentsPerAttribute))throw new x("options.componentsPerAttribute is required.");if(e.componentsPerAttribute<1||e.componentsPerAttribute>4)throw new x("options.componentsPerAttribute must be between 1 and 4.");if(!C(e.values))throw new x("options.values is required.");this.componentDatatype=e.componentDatatype,this.componentsPerAttribute=e.componentsPerAttribute,this.normalize=R(e.normalize,!1),this.values=e.values}var Uf=kf;function Vf(e){e=R(e,R.EMPTY_OBJECT),this.position=e.position,this.normal=e.normal,this.st=e.st,this.bitangent=e.bitangent,this.tangent=e.tangent,this.color=e.color}var Hf=Vf;const Gf={NONE:0,TOP:1,ALL:2};var Wf=Object.freeze(Gf);function qf(e){e=R(e,R.EMPTY_OBJECT),this.position=R(e.position,!1),this.normal=R(e.normal,!1),this.st=R(e.st,!1),this.bitangent=R(e.bitangent,!1),this.tangent=R(e.tangent,!1),this.color=R(e.color,!1)}qf.POSITION_ONLY=Object.freeze(new qf({position:!0})),qf.POSITION_AND_NORMAL=Object.freeze(new qf({position:!0,normal:!0})),qf.POSITION_NORMAL_AND_ST=Object.freeze(new qf({position:!0,normal:!0,st:!0})),qf.POSITION_AND_ST=Object.freeze(new qf({position:!0,st:!0})),qf.POSITION_AND_COLOR=Object.freeze(new qf({position:!0,color:!0})),qf.ALL=Object.freeze(new qf({position:!0,normal:!0,st:!0,tangent:!0,bitangent:!0})),qf.DEFAULT=qf.POSITION_NORMAL_AND_ST,qf.packedLength=6,qf.pack=function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");return n=R(n,0),t[n++]=e.position?1:0,t[n++]=e.normal?1:0,t[n++]=e.st?1:0,t[n++]=e.tangent?1:0,t[n++]=e.bitangent?1:0,t[n]=e.color?1:0,t},qf.unpack=function(e,t,n){if(!C(e))throw new x("array is required");return t=R(t,0),C(n)||(n=new qf),n.position=1===e[t++],n.normal=1===e[t++],n.st=1===e[t++],n.tangent=1===e[t++],n.bitangent=1===e[t++],n.color=1===e[t],n},qf.clone=function(e,t){if(C(e))return C(t)||(t=new qf),t.position=e.position,t.normal=e.normal,t.st=e.st,t.tangent=e.tangent,t.bitangent=e.bitangent,t.color=e.color,t};var jf=qf;const Yf=new K;function Kf(e){e=R(e,R.EMPTY_OBJECT);const t=e.minimum,n=e.maximum;if(D.typeOf.object("min",t),D.typeOf.object("max",n),C(e.offsetAttribute)&&e.offsetAttribute===Wf.TOP)throw new x("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");const i=R(e.vertexFormat,jf.DEFAULT);this._minimum=K.clone(t),this._maximum=K.clone(n),this._vertexFormat=i,this._offsetAttribute=e.offsetAttribute,this._workerName="createBoxGeometry"}Kf.fromDimensions=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.dimensions;D.typeOf.object("dimensions",t),D.typeOf.number.greaterThanOrEquals("dimensions.x",t.x,0),D.typeOf.number.greaterThanOrEquals("dimensions.y",t.y,0),D.typeOf.number.greaterThanOrEquals("dimensions.z",t.z,0);const n=K.multiplyByScalar(t,.5,new K);return new Kf({minimum:K.negate(n,new K),maximum:n,vertexFormat:e.vertexFormat,offsetAttribute:e.offsetAttribute})},Kf.fromAxisAlignedBoundingBox=function(e){return D.typeOf.object("boundingBox",e),new Kf({minimum:e.minimum,maximum:e.maximum})},Kf.packedLength=2*K.packedLength+jf.packedLength+1,Kf.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),K.pack(e._minimum,t,n),K.pack(e._maximum,t,n+K.packedLength),jf.pack(e._vertexFormat,t,n+2*K.packedLength),t[n+2*K.packedLength+jf.packedLength]=R(e._offsetAttribute,-1),t};const Xf=new K,Qf=new K,Jf=new jf,Zf={minimum:Xf,maximum:Qf,vertexFormat:Jf,offsetAttribute:void 0};let $f;Kf.unpack=function(e,t,n){D.defined("array",e),t=R(t,0);const i=K.unpack(e,t,Xf),o=K.unpack(e,t+K.packedLength,Qf),r=jf.unpack(e,t+2*K.packedLength,Jf),s=e[t+2*K.packedLength+jf.packedLength];return C(n)?(n._minimum=K.clone(i,n._minimum),n._maximum=K.clone(o,n._maximum),n._vertexFormat=jf.clone(r,n._vertexFormat),n._offsetAttribute=-1===s?void 0:s,n):(Zf.offsetAttribute=-1===s?void 0:s,new Kf(Zf))},Kf.createGeometry=function(e){const t=e._minimum,n=e._maximum,i=e._vertexFormat;if(K.equals(t,n))return;const o=new Hf;let r,s;if(i.position&&(i.st||i.normal||i.tangent||i.bitangent)){if(i.position&&(s=new Float64Array(72),s[0]=t.x,s[1]=t.y,s[2]=n.z,s[3]=n.x,s[4]=t.y,s[5]=n.z,s[6]=n.x,s[7]=n.y,s[8]=n.z,s[9]=t.x,s[10]=n.y,s[11]=n.z,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=n.x,s[16]=t.y,s[17]=t.z,s[18]=n.x,s[19]=n.y,s[20]=t.z,s[21]=t.x,s[22]=n.y,s[23]=t.z,s[24]=n.x,s[25]=t.y,s[26]=t.z,s[27]=n.x,s[28]=n.y,s[29]=t.z,s[30]=n.x,s[31]=n.y,s[32]=n.z,s[33]=n.x,s[34]=t.y,s[35]=n.z,s[36]=t.x,s[37]=t.y,s[38]=t.z,s[39]=t.x,s[40]=n.y,s[41]=t.z,s[42]=t.x,s[43]=n.y,s[44]=n.z,s[45]=t.x,s[46]=t.y,s[47]=n.z,s[48]=t.x,s[49]=n.y,s[50]=t.z,s[51]=n.x,s[52]=n.y,s[53]=t.z,s[54]=n.x,s[55]=n.y,s[56]=n.z,s[57]=t.x,s[58]=n.y,s[59]=n.z,s[60]=t.x,s[61]=t.y,s[62]=t.z,s[63]=n.x,s[64]=t.y,s[65]=t.z,s[66]=n.x,s[67]=t.y,s[68]=n.z,s[69]=t.x,s[70]=t.y,s[71]=n.z,o.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:s})),i.normal){const e=new Float32Array(72);e[0]=0,e[1]=0,e[2]=1,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=1,e[9]=0,e[10]=0,e[11]=1,e[12]=0,e[13]=0,e[14]=-1,e[15]=0,e[16]=0,e[17]=-1,e[18]=0,e[19]=0,e[20]=-1,e[21]=0,e[22]=0,e[23]=-1,e[24]=1,e[25]=0,e[26]=0,e[27]=1,e[28]=0,e[29]=0,e[30]=1,e[31]=0,e[32]=0,e[33]=1,e[34]=0,e[35]=0,e[36]=-1,e[37]=0,e[38]=0,e[39]=-1,e[40]=0,e[41]=0,e[42]=-1,e[43]=0,e[44]=0,e[45]=-1,e[46]=0,e[47]=0,e[48]=0,e[49]=1,e[50]=0,e[51]=0,e[52]=1,e[53]=0,e[54]=0,e[55]=1,e[56]=0,e[57]=0,e[58]=1,e[59]=0,e[60]=0,e[61]=-1,e[62]=0,e[63]=0,e[64]=-1,e[65]=0,e[66]=0,e[67]=-1,e[68]=0,e[69]=0,e[70]=-1,e[71]=0,o.normal=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:e})}if(i.st){const e=new Float32Array(48);e[0]=0,e[1]=0,e[2]=1,e[3]=0,e[4]=1,e[5]=1,e[6]=0,e[7]=1,e[8]=1,e[9]=0,e[10]=0,e[11]=0,e[12]=0,e[13]=1,e[14]=1,e[15]=1,e[16]=0,e[17]=0,e[18]=1,e[19]=0,e[20]=1,e[21]=1,e[22]=0,e[23]=1,e[24]=1,e[25]=0,e[26]=0,e[27]=0,e[28]=0,e[29]=1,e[30]=1,e[31]=1,e[32]=1,e[33]=0,e[34]=0,e[35]=0,e[36]=0,e[37]=1,e[38]=1,e[39]=1,e[40]=0,e[41]=0,e[42]=1,e[43]=0,e[44]=1,e[45]=1,e[46]=0,e[47]=1,o.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:e})}if(i.tangent){const e=new Float32Array(72);e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=1,e[7]=0,e[8]=0,e[9]=1,e[10]=0,e[11]=0,e[12]=-1,e[13]=0,e[14]=0,e[15]=-1,e[16]=0,e[17]=0,e[18]=-1,e[19]=0,e[20]=0,e[21]=-1,e[22]=0,e[23]=0,e[24]=0,e[25]=1,e[26]=0,e[27]=0,e[28]=1,e[29]=0,e[30]=0,e[31]=1,e[32]=0,e[33]=0,e[34]=1,e[35]=0,e[36]=0,e[37]=-1,e[38]=0,e[39]=0,e[40]=-1,e[41]=0,e[42]=0,e[43]=-1,e[44]=0,e[45]=0,e[46]=-1,e[47]=0,e[48]=-1,e[49]=0,e[50]=0,e[51]=-1,e[52]=0,e[53]=0,e[54]=-1,e[55]=0,e[56]=0,e[57]=-1,e[58]=0,e[59]=0,e[60]=1,e[61]=0,e[62]=0,e[63]=1,e[64]=0,e[65]=0,e[66]=1,e[67]=0,e[68]=0,e[69]=1,e[70]=0,e[71]=0,o.tangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:e})}if(i.bitangent){const e=new Float32Array(72);e[0]=0,e[1]=1,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=1,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=1,e[14]=0,e[15]=0,e[16]=1,e[17]=0,e[18]=0,e[19]=1,e[20]=0,e[21]=0,e[22]=1,e[23]=0,e[24]=0,e[25]=0,e[26]=1,e[27]=0,e[28]=0,e[29]=1,e[30]=0,e[31]=0,e[32]=1,e[33]=0,e[34]=0,e[35]=1,e[36]=0,e[37]=0,e[38]=1,e[39]=0,e[40]=0,e[41]=1,e[42]=0,e[43]=0,e[44]=1,e[45]=0,e[46]=0,e[47]=1,e[48]=0,e[49]=0,e[50]=1,e[51]=0,e[52]=0,e[53]=1,e[54]=0,e[55]=0,e[56]=1,e[57]=0,e[58]=0,e[59]=1,e[60]=0,e[61]=0,e[62]=1,e[63]=0,e[64]=0,e[65]=1,e[66]=0,e[67]=0,e[68]=1,e[69]=0,e[70]=0,e[71]=1,o.bitangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:e})}r=new Uint16Array(36),r[0]=0,r[1]=1,r[2]=2,r[3]=0,r[4]=2,r[5]=3,r[6]=6,r[7]=5,r[8]=4,r[9]=7,r[10]=6,r[11]=4,r[12]=8,r[13]=9,r[14]=10,r[15]=8,r[16]=10,r[17]=11,r[18]=14,r[19]=13,r[20]=12,r[21]=15,r[22]=14,r[23]=12,r[24]=18,r[25]=17,r[26]=16,r[27]=19,r[28]=18,r[29]=16,r[30]=20,r[31]=21,r[32]=22,r[33]=20,r[34]=22,r[35]=23}else s=new Float64Array(24),s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=n.x,s[4]=t.y,s[5]=t.z,s[6]=n.x,s[7]=n.y,s[8]=t.z,s[9]=t.x,s[10]=n.y,s[11]=t.z,s[12]=t.x,s[13]=t.y,s[14]=n.z,s[15]=n.x,s[16]=t.y,s[17]=n.z,s[18]=n.x,s[19]=n.y,s[20]=n.z,s[21]=t.x,s[22]=n.y,s[23]=n.z,o.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:s}),r=new Uint16Array(36),r[0]=4,r[1]=5,r[2]=6,r[3]=4,r[4]=6,r[5]=7,r[6]=1,r[7]=0,r[8]=3,r[9]=1,r[10]=3,r[11]=2,r[12]=1,r[13]=6,r[14]=5,r[15]=1,r[16]=2,r[17]=6,r[18]=2,r[19]=3,r[20]=7,r[21]=2,r[22]=7,r[23]=6,r[24]=3,r[25]=0,r[26]=4,r[27]=3,r[28]=4,r[29]=7,r[30]=0,r[31]=1,r[32]=5,r[33]=0,r[34]=5,r[35]=4;const a=K.subtract(n,t,Yf),c=.5*K.magnitude(a);if(C(e._offsetAttribute)){const t=s.length,n=new Uint8Array(t/3),i=e._offsetAttribute===Wf.NONE?0:1;wf(n,i),o.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}return new zf({attributes:o,indices:r,primitiveType:xf.TRIANGLES,boundingSphere:new nn(K.ZERO,c),offsetAttribute:e._offsetAttribute})},Kf.getUnitBox=function(){return C($f)||($f=Kf.createGeometry(Kf.fromDimensions({dimensions:new K(1,1,1),vertexFormat:jf.POSITION_ONLY}))),$f};var ep=Kf;const tp=new K;function np(e){e=R(e,R.EMPTY_OBJECT);const t=e.minimum,n=e.maximum;if(D.typeOf.object("min",t),D.typeOf.object("max",n),C(e.offsetAttribute)&&e.offsetAttribute===Wf.TOP)throw new x("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._min=K.clone(t),this._max=K.clone(n),this._offsetAttribute=e.offsetAttribute,this._workerName="createBoxOutlineGeometry"}np.fromDimensions=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.dimensions;D.typeOf.object("dimensions",t),D.typeOf.number.greaterThanOrEquals("dimensions.x",t.x,0),D.typeOf.number.greaterThanOrEquals("dimensions.y",t.y,0),D.typeOf.number.greaterThanOrEquals("dimensions.z",t.z,0);const n=K.multiplyByScalar(t,.5,new K);return new np({minimum:K.negate(n,new K),maximum:n,offsetAttribute:e.offsetAttribute})},np.fromAxisAlignedBoundingBox=function(e){return D.typeOf.object("boundindBox",e),new np({minimum:e.minimum,maximum:e.maximum})},np.packedLength=2*K.packedLength+1,np.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),K.pack(e._min,t,n),K.pack(e._max,t,n+K.packedLength),t[n+2*K.packedLength]=R(e._offsetAttribute,-1),t};const ip=new K,op=new K,rp={minimum:ip,maximum:op,offsetAttribute:void 0};np.unpack=function(e,t,n){D.defined("array",e),t=R(t,0);const i=K.unpack(e,t,ip),o=K.unpack(e,t+K.packedLength,op),r=e[t+2*K.packedLength];return C(n)?(n._min=K.clone(i,n._min),n._max=K.clone(o,n._max),n._offsetAttribute=-1===r?void 0:r,n):(rp.offsetAttribute=-1===r?void 0:r,new np(rp))},np.createGeometry=function(e){const t=e._min,n=e._max;if(K.equals(t,n))return;const i=new Hf,o=new Uint16Array(24),r=new Float64Array(24);r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=n.x,r[4]=t.y,r[5]=t.z,r[6]=n.x,r[7]=n.y,r[8]=t.z,r[9]=t.x,r[10]=n.y,r[11]=t.z,r[12]=t.x,r[13]=t.y,r[14]=n.z,r[15]=n.x,r[16]=t.y,r[17]=n.z,r[18]=n.x,r[19]=n.y,r[20]=n.z,r[21]=t.x,r[22]=n.y,r[23]=n.z,i.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:r}),o[0]=4,o[1]=5,o[2]=5,o[3]=6,o[4]=6,o[5]=7,o[6]=7,o[7]=4,o[8]=0,o[9]=1,o[10]=1,o[11]=2,o[12]=2,o[13]=3,o[14]=3,o[15]=0,o[16]=0,o[17]=4,o[18]=1,o[19]=5,o[20]=2,o[21]=6,o[22]=3,o[23]=7;const s=K.subtract(n,t,tp),a=.5*K.magnitude(s);if(C(e._offsetAttribute)){const t=r.length,n=new Uint8Array(t/3),o=e._offsetAttribute===Wf.NONE?0:1;wf(n,o),i.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}return new zf({attributes:i,indices:o,primitiveType:xf.LINES,boundingSphere:new nn(K.ZERO,a),offsetAttribute:e._offsetAttribute})};var sp=np;function ap(){}ap.prototype.geocode=function(e){D.typeOf.string("query",e);const t=e.match(/[^\s,\n]+/g);if(2===t.length||3===t.length){let n=+t[0],i=+t[1];const o=3===t.length?+t[2]:300;if(isNaN(n)&&isNaN(i)){const e=/^(\d+.?\d*)([nsew])/i;for(let o=0;o<t.length;++o){const r=t[o].match(e);e.test(t[o])&&3===r.length&&(/^[ns]/i.test(r[2])?i=/^[n]/i.test(r[2])?+r[1]:-r[1]:/^[ew]/i.test(r[2])&&(n=/^[e]/i.test(r[2])?+r[1]:-r[1]))}}if(!isNaN(n)&&!isNaN(i)&&!isNaN(o)){const t={displayName:e,destination:K.fromDegrees(n,i,o)};return Promise.resolve([t])}}return Promise.resolve([])};var cp=ap;function lp(){this.times=void 0,this.points=void 0,x.throwInstantiationError()}lp.prototype.evaluate=x.throwInstantiationError,lp.prototype.findTimeInterval=function(e,t){const n=this.times,i=n.length;if(!C(e))throw new x("time is required.");if(e<n[0]||e>n[i-1])throw new x("time is out of range.");if(t=R(t,0),e>=n[t]){if(t+1<i&&e<n[t+1])return t;if(t+2<i&&e<n[t+2])return t+1}else if(t-1>=0&&e>=n[t-1])return t-1;let o;if(e>n[t]){for(o=t;o<i-1;++o)if(e>=n[o]&&e<n[o+1])break}else for(o=t-1;o>=0;--o)if(e>=n[o]&&e<n[o+1])break;return o===i-1&&(o=i-2),o},lp.prototype.wrapTime=function(e){D.typeOf.number("time",e);const t=this.times,n=t[t.length-1],i=t[0],o=n-i;let r;return e<i&&(r=Math.floor((i-e)/o)+1,e+=r*o),e>n&&(r=Math.floor((e-n)/o)+1,e-=r*o),e},lp.prototype.clampTime=function(e){D.typeOf.number("time",e);const t=this.times;return z.clamp(e,t[0],t[t.length-1])};var up=lp;function hp(e){e=R(e,R.EMPTY_OBJECT);const t=e.points,n=e.times;if(!C(t)||!C(n))throw new x("points and times are required.");if(t.length<2)throw new x("points.length must be greater than or equal to 2.");if(n.length!==t.length)throw new x("times.length must be equal to points.length.");this._times=n,this._points=t,this._lastTimeIndex=0}Object.defineProperties(hp.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}}),hp.prototype.findTimeInterval=up.prototype.findTimeInterval,hp.prototype.wrapTime=up.prototype.wrapTime,hp.prototype.clampTime=up.prototype.clampTime,hp.prototype.evaluate=function(e,t){const n=this.points,i=this.times,o=this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex),r=(e-i[o])/(i[o+1]-i[o]);return C(t)||(t=new K),K.lerp(n[o],n[o+1],r,t)};var dp=hp;const fp={solve:function(e,t,n,i){if(!C(e)||!(e instanceof Array))throw new x("The array lower is required.");if(!C(t)||!(t instanceof Array))throw new x("The array diagonal is required.");if(!C(n)||!(n instanceof Array))throw new x("The array upper is required.");if(!C(i)||!(i instanceof Array))throw new x("The array right is required.");if(t.length!==i.length)throw new x("diagonal and right must have the same lengths.");if(e.length!==n.length)throw new x("lower and upper must have the same lengths.");if(e.length!==t.length-1)throw new x("lower and upper must be one less than the length of diagonal.");const o=new Array(n.length),r=new Array(i.length),s=new Array(i.length);let a,c;for(a=0;a<r.length;a++)r[a]=new K,s[a]=new K;for(o[0]=n[0]/t[0],r[0]=K.multiplyByScalar(i[0],1/t[0],r[0]),a=1;a<o.length;++a)c=1/(t[a]-o[a-1]*e[a-1]),o[a]=n[a]*c,r[a]=K.subtract(i[a],K.multiplyByScalar(r[a-1],e[a-1],r[a]),r[a]),r[a]=K.multiplyByScalar(r[a],c,r[a]);for(c=1/(t[a]-o[a-1]*e[a-1]),r[a]=K.subtract(i[a],K.multiplyByScalar(r[a-1],e[a-1],r[a]),r[a]),r[a]=K.multiplyByScalar(r[a],c,r[a]),s[s.length-1]=r[r.length-1],a=s.length-2;a>=0;--a)s[a]=K.subtract(r[a],K.multiplyByScalar(s[a+1],o[a],s[a]),s[a]);return s}};var pp=fp;const mp=[],_p=[],gp=[],yp=[];function vp(e,t,n){const i=mp,o=gp,r=_p,s=yp;let a;i.length=o.length=e.length-1,r.length=s.length=e.length,i[0]=r[0]=1,o[0]=0;let c=s[0];for(C(c)||(c=s[0]=new K),K.clone(t,c),a=1;a<i.length-1;++a)i[a]=o[a]=1,r[a]=4,c=s[a],C(c)||(c=s[a]=new K),K.subtract(e[a+1],e[a-1],c),K.multiplyByScalar(c,3,c);return i[a]=0,o[a]=1,r[a]=4,c=s[a],C(c)||(c=s[a]=new K),K.subtract(e[a+1],e[a-1],c),K.multiplyByScalar(c,3,c),r[a+1]=1,c=s[a+1],C(c)||(c=s[a+1]=new K),K.clone(n,c),pp.solve(i,r,o,s)}function bp(e){const t=mp,n=gp,i=_p,o=yp;let r;t.length=n.length=e.length-1,i.length=o.length=e.length,t[0]=n[0]=1,i[0]=2;let s=o[0];for(C(s)||(s=o[0]=new K),K.subtract(e[1],e[0],s),K.multiplyByScalar(s,3,s),r=1;r<t.length;++r)t[r]=n[r]=1,i[r]=4,s=o[r],C(s)||(s=o[r]=new K),K.subtract(e[r+1],e[r-1],s),K.multiplyByScalar(s,3,s);return i[r]=2,s=o[r],C(s)||(s=o[r]=new K),K.subtract(e[r],e[r-1],s),K.multiplyByScalar(s,3,s),pp.solve(t,i,n,o)}function Ap(e){e=R(e,R.EMPTY_OBJECT);const t=e.points,n=e.times,i=e.inTangents,o=e.outTangents;if(!C(t)||!C(n)||!C(i)||!C(o))throw new x("times, points, inTangents, and outTangents are required.");if(t.length<2)throw new x("points.length must be greater than or equal to 2.");if(n.length!==t.length)throw new x("times.length must be equal to points.length.");if(i.length!==o.length||i.length!==t.length-1)throw new x("inTangents and outTangents must have a length equal to points.length - 1.");this._times=n,this._points=t,this._inTangents=i,this._outTangents=o,this._lastTimeIndex=0}Object.defineProperties(Ap.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}},inTangents:{get:function(){return this._inTangents}},outTangents:{get:function(){return this._outTangents}}}),Ap.createC1=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.times,n=e.points,i=e.tangents;if(!C(n)||!C(t)||!C(i))throw new x("points, times and tangents are required.");if(n.length<2)throw new x("points.length must be greater than or equal to 2.");if(t.length!==n.length||t.length!==i.length)throw new x("times, points and tangents must have the same length.");const o=i.slice(0,i.length-1),r=i.slice(1,i.length);return new Ap({times:t,points:n,inTangents:r,outTangents:o})},Ap.createNaturalCubic=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.times,n=e.points;if(!C(n)||!C(t))throw new x("points and times are required.");if(n.length<2)throw new x("points.length must be greater than or equal to 2.");if(t.length!==n.length)throw new x("times.length must be equal to points.length.");if(n.length<3)return new dp({points:n,times:t});const i=bp(n),o=i.slice(0,i.length-1),r=i.slice(1,i.length);return new Ap({times:t,points:n,inTangents:r,outTangents:o})},Ap.createClampedCubic=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.times,n=e.points,i=e.firstTangent,o=e.lastTangent;if(!C(n)||!C(t)||!C(i)||!C(o))throw new x("points, times, firstTangent and lastTangent are required.");if(n.length<2)throw new x("points.length must be greater than or equal to 2.");if(t.length!==n.length)throw new x("times.length must be equal to points.length.");if(n.length<3)return new dp({points:n,times:t});const r=vp(n,i,o),s=r.slice(0,r.length-1),a=r.slice(1,r.length);return new Ap({times:t,points:n,inTangents:a,outTangents:s})},Ap.hermiteCoefficientMatrix=new ft(2,-3,0,1,-2,3,0,0,1,-2,1,0,1,-1,0,0),Ap.prototype.findTimeInterval=up.prototype.findTimeInterval;const wp=new Xe,Tp=new K;Ap.prototype.wrapTime=up.prototype.wrapTime,Ap.prototype.clampTime=up.prototype.clampTime,Ap.prototype.evaluate=function(e,t){C(t)||(t=new K);const n=this.points,i=this.times,o=this.inTangents,r=this.outTangents,s=this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex),a=(e-i[s])/(i[s+1]-i[s]),c=wp;c.z=a,c.y=a*a,c.x=c.y*a,c.w=1;const l=ft.multiplyByVector(Ap.hermiteCoefficientMatrix,c,c);return t=K.multiplyByScalar(n[s],l.x,t),K.multiplyByScalar(n[s+1],l.y,Tp),K.add(t,Tp,t),K.multiplyByScalar(r[s],l.z,Tp),K.add(t,Tp,t),K.multiplyByScalar(o[s],l.w,Tp),K.add(t,Tp,t)};var Cp=Ap;const Ep=new Xe,xp=new K,Sp=new K;function Ip(e){const t=e.points,n=e.times;if(t.length<3){const e=n[0],i=1/(n[1]-e),o=t[0],r=t[1];return function(t,n){C(n)||(n=new K);const s=(t-e)*i;return K.lerp(o,r,s,n)}}return function(i,o){C(o)||(o=new K);const r=e._lastTimeIndex=e.findTimeInterval(i,e._lastTimeIndex),s=(i-n[r])/(n[r+1]-n[r]),a=Ep;let c,l,u,h,d;return a.z=s,a.y=s*s,a.x=a.y*s,a.w=1,0===r?(c=t[0],l=t[1],u=e.firstTangent,h=K.subtract(t[2],c,xp),K.multiplyByScalar(h,.5,h),d=ft.multiplyByVector(Cp.hermiteCoefficientMatrix,a,a)):r===t.length-2?(c=t[r],l=t[r+1],h=e.lastTangent,u=K.subtract(l,t[r-1],xp),K.multiplyByScalar(u,.5,u),d=ft.multiplyByVector(Cp.hermiteCoefficientMatrix,a,a)):(c=t[r-1],l=t[r],u=t[r+1],h=t[r+2],d=ft.multiplyByVector(Pp.catmullRomCoefficientMatrix,a,a)),o=K.multiplyByScalar(c,d.x,o),K.multiplyByScalar(l,d.y,Sp),K.add(o,Sp,o),K.multiplyByScalar(u,d.z,Sp),K.add(o,Sp,o),K.multiplyByScalar(h,d.w,Sp),K.add(o,Sp,o)}}const Op=new K,Dp=new K;function Pp(e){e=R(e,R.EMPTY_OBJECT);const t=e.points,n=e.times;let i=e.firstTangent,o=e.lastTangent;if(D.defined("points",t),D.defined("times",n),D.typeOf.number.greaterThanOrEquals("points.length",t.length,2),D.typeOf.number.equals("times.length","points.length",n.length,t.length),t.length>2&&(C(i)||(i=Op,K.multiplyByScalar(t[1],2,i),K.subtract(i,t[2],i),K.subtract(i,t[0],i),K.multiplyByScalar(i,.5,i)),!C(o))){const e=t.length-1;o=Dp,K.multiplyByScalar(t[e-1],2,o),K.subtract(t[e],o,o),K.add(o,t[e-2],o),K.multiplyByScalar(o,.5,o)}this._times=n,this._points=t,this._firstTangent=K.clone(i),this._lastTangent=K.clone(o),this._evaluateFunction=Ip(this),this._lastTimeIndex=0}Object.defineProperties(Pp.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}},firstTangent:{get:function(){return this._firstTangent}},lastTangent:{get:function(){return this._lastTangent}}}),Pp.catmullRomCoefficientMatrix=new ft(-.5,1,-.5,0,1.5,-2.5,0,1,-1.5,2,.5,0,.5,-.5,0,0),Pp.prototype.findTimeInterval=up.prototype.findTimeInterval,Pp.prototype.wrapTime=up.prototype.wrapTime,Pp.prototype.clampTime=up.prototype.clampTime,Pp.prototype.evaluate=function(e,t){return this._evaluateFunction(e,t)};function Rp(e,t,n){if(!C(e))throw new x("uint8Array is required.");if(t<0)throw new x("byteOffset cannot be negative.");if(n<0)throw new x("byteLength cannot be negative.");if(t+n>e.byteLength)throw new x("sub-region exceeds array bounds.");return t=R(t,0),n=R(n,e.byteLength-t),e=e.subarray(t,t+n),Rp.decode(e)}function Lp(e,t,n){return t<=e&&e<=n}function Mp(e){let t=0,n=0,i=0,o=128,r=191;const s=[],a=e.length;for(let c=0;c<a;++c){const a=e[c];if(0===i){if(Lp(a,0,127)){s.push(a);continue}if(Lp(a,194,223)){i=1,t=31&a;continue}if(Lp(a,224,239)){224===a&&(o=160),237===a&&(r=159),i=2,t=15&a;continue}if(Lp(a,240,244)){240===a&&(o=144),244===a&&(r=143),i=3,t=7&a;continue}throw new Je("String decoding failed.")}Lp(a,o,r)?(o=128,r=191,t=t<<6|63&a,++n,n===i&&(s.push(t),t=i=n=0)):(t=i=n=0,o=128,r=191,--c)}return s}Rp.decodeWithTextDecoder=function(e){const t=new TextDecoder("utf-8");return t.decode(e)},Rp.decodeWithFromCharCode=function(e){let t="";const n=Mp(e),i=n.length;for(let o=0;o<i;++o){let e=n[o];e<=65535?t+=String.fromCharCode(e):(e-=65536,t+=String.fromCharCode(55296+(e>>10),56320+(1023&e)))}return t},"undefined"!==typeof TextDecoder?Rp.decode=Rp.decodeWithTextDecoder:Rp.decode=Rp.decodeWithFromCharCode;var Bp=Rp;function Np(e,t,n){return JSON.parse(Bp(e,t,n))}var Fp=Np;const zp={clipTriangleAtAxisAlignedThreshold:function(e,t,n,i,o,r){if(!C(e))throw new x("threshold is required.");if(!C(t))throw new x("keepAbove is required.");if(!C(n))throw new x("u0 is required.");if(!C(i))throw new x("u1 is required.");if(!C(o))throw new x("u2 is required.");let s,a,c;C(r)?r.length=0:r=[],t?(s=n<e,a=i<e,c=o<e):(s=n>e,a=i>e,c=o>e);const l=s+a+c;let u,h,d,f,p,m;return 1===l?s?(u=(e-n)/(i-n),h=(e-n)/(o-n),r.push(1),r.push(2),1!==h&&(r.push(-1),r.push(0),r.push(2),r.push(h)),1!==u&&(r.push(-1),r.push(0),r.push(1),r.push(u))):a?(d=(e-i)/(o-i),f=(e-i)/(n-i),r.push(2),r.push(0),1!==f&&(r.push(-1),r.push(1),r.push(0),r.push(f)),1!==d&&(r.push(-1),r.push(1),r.push(2),r.push(d))):c&&(p=(e-o)/(n-o),m=(e-o)/(i-o),r.push(0),r.push(1),1!==m&&(r.push(-1),r.push(2),r.push(1),r.push(m)),1!==p&&(r.push(-1),r.push(2),r.push(0),r.push(p))):2===l?s||n===e?a||i===e?c||o===e||(h=(e-n)/(o-n),d=(e-i)/(o-i),r.push(2),r.push(-1),r.push(0),r.push(2),r.push(h),r.push(-1),r.push(1),r.push(2),r.push(d)):(m=(e-o)/(i-o),u=(e-n)/(i-n),r.push(1),r.push(-1),r.push(2),r.push(1),r.push(m),r.push(-1),r.push(0),r.push(1),r.push(u)):(f=(e-i)/(n-i),p=(e-o)/(n-o),r.push(0),r.push(-1),r.push(1),r.push(0),r.push(f),r.push(-1),r.push(2),r.push(0),r.push(p)):3!==l&&(r.push(0),r.push(1),r.push(2)),r},computeBarycentricCoordinates:function(e,t,n,i,o,r,s,a,c){if(!C(e))throw new x("x is required.");if(!C(t))throw new x("y is required.");if(!C(n))throw new x("x1 is required.");if(!C(i))throw new x("y1 is required.");if(!C(o))throw new x("x2 is required.");if(!C(r))throw new x("y2 is required.");if(!C(s))throw new x("x3 is required.");if(!C(a))throw new x("y3 is required.");const l=n-s,u=s-o,h=r-a,d=i-a,f=1/(h*l+u*d),p=t-a,m=e-s,_=(h*m+u*p)*f,g=(-d*m+l*p)*f,y=1-_-g;return C(c)?(c.x=_,c.y=g,c.z=y,c):new K(_,g,y)},computeLineSegmentLineSegmentIntersection:function(e,t,n,i,o,r,s,a,c){D.typeOf.number("x00",e),D.typeOf.number("y00",t),D.typeOf.number("x01",n),D.typeOf.number("y01",i),D.typeOf.number("x10",o),D.typeOf.number("y10",r),D.typeOf.number("x11",s),D.typeOf.number("y11",a);const l=(s-o)*(t-r)-(a-r)*(e-o),u=(n-e)*(t-r)-(i-t)*(e-o),h=(a-r)*(n-e)-(s-o)*(i-t);if(0===h)return;const d=l/h,f=u/h;return d>=0&&d<=1&&f>=0&&f<=1?(C(c)||(c=new ro),c.x=e+d*(n-e),c.y=t+d*(i-t),c):void 0}};var kp=zp;function Up(e){if(!C(e)||!C(e.quantizedVertices))throw new x("options.quantizedVertices is required.");if(!C(e.indices))throw new x("options.indices is required.");if(!C(e.minimumHeight))throw new x("options.minimumHeight is required.");if(!C(e.maximumHeight))throw new x("options.maximumHeight is required.");if(!C(e.maximumHeight))throw new x("options.maximumHeight is required.");if(!C(e.boundingSphere))throw new x("options.boundingSphere is required.");if(!C(e.horizonOcclusionPoint))throw new x("options.horizonOcclusionPoint is required.");if(!C(e.westIndices))throw new x("options.westIndices is required.");if(!C(e.southIndices))throw new x("options.southIndices is required.");if(!C(e.eastIndices))throw new x("options.eastIndices is required.");if(!C(e.northIndices))throw new x("options.northIndices is required.");if(!C(e.westSkirtHeight))throw new x("options.westSkirtHeight is required.");if(!C(e.southSkirtHeight))throw new x("options.southSkirtHeight is required.");if(!C(e.eastSkirtHeight))throw new x("options.eastSkirtHeight is required.");if(!C(e.northSkirtHeight))throw new x("options.northSkirtHeight is required.");this._quantizedVertices=e.quantizedVertices,this._encodedNormals=e.encodedNormals,this._indices=e.indices,this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._boundingSphere=e.boundingSphere,this._orientedBoundingBox=e.orientedBoundingBox,this._horizonOcclusionPoint=e.horizonOcclusionPoint,this._credits=e.credits;const t=this._quantizedVertices.length/3,n=this._uValues=this._quantizedVertices.subarray(0,t),i=this._vValues=this._quantizedVertices.subarray(t,2*t);function o(e,t){return i[e]-i[t]}function r(e,t){return n[e]-n[t]}this._heightValues=this._quantizedVertices.subarray(2*t,3*t),this._westIndices=Hp(e.westIndices,o,t),this._southIndices=Hp(e.southIndices,r,t),this._eastIndices=Hp(e.eastIndices,o,t),this._northIndices=Hp(e.northIndices,r,t),this._westSkirtHeight=e.westSkirtHeight,this._southSkirtHeight=e.southSkirtHeight,this._eastSkirtHeight=e.eastSkirtHeight,this._northSkirtHeight=e.northSkirtHeight,this._childTileMask=R(e.childTileMask,15),this._createdByUpsampling=R(e.createdByUpsampling,!1),this._waterMask=e.waterMask,this._mesh=void 0}Object.defineProperties(Up.prototype,{credits:{get:function(){return this._credits}},waterMask:{get:function(){return this._waterMask}},childTileMask:{get:function(){return this._childTileMask}},canUpsample:{get:function(){return C(this._mesh)}}});const Vp=[];function Hp(e,t,n){Vp.length=e.length;let i=!1;for(let o=0,r=e.length;o<r;++o)Vp[o]=e[o],i=i||o>0&&t(e[o-1],e[o])>0;return i?(Vp.sort(t),fd.createTypedArray(n,Vp)):e}const Gp="createVerticesFromQuantizedTerrainMesh",Wp=new ad(Gp),qp=new ad(Gp,ld.maximumAsynchronousTasks);Up.prototype.createMesh=function(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.object("options.tilingScheme",e.tilingScheme),D.typeOf.number("options.x",e.x),D.typeOf.number("options.y",e.y),D.typeOf.number("options.level",e.level);const t=e.tilingScheme,n=e.x,i=e.y,o=e.level,r=R(e.exaggeration,1),s=R(e.exaggerationRelativeHeight,0),a=R(e.throttle,!0),c=t.ellipsoid,l=t.tileXYToRectangle(n,i,o),u=a?qp:Wp,h=u.scheduleTask({minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,quantizedVertices:this._quantizedVertices,octEncodedNormals:this._encodedNormals,includeWebMercatorT:!0,indices:this._indices,westIndices:this._westIndices,southIndices:this._southIndices,eastIndices:this._eastIndices,northIndices:this._northIndices,westSkirtHeight:this._westSkirtHeight,southSkirtHeight:this._southSkirtHeight,eastSkirtHeight:this._eastSkirtHeight,northSkirtHeight:this._northSkirtHeight,rectangle:l,relativeToCenter:this._boundingSphere.center,ellipsoid:c,exaggeration:r,exaggerationRelativeHeight:s});if(!C(h))return;const d=this;return Promise.resolve(h).then((function(e){const t=d._quantizedVertices.length/3,n=t+d._westIndices.length+d._southIndices.length+d._eastIndices.length+d._northIndices.length,i=fd.createTypedArray(n,e.indices),o=new Float32Array(e.vertices),r=e.center,s=e.minimumHeight,a=e.maximumHeight,c=d._boundingSphere,l=d._orientedBoundingBox,u=R(K.clone(e.occludeePointInScaledSpace),d._horizonOcclusionPoint),h=e.vertexStride,f=kh.clone(e.encoding);return d._mesh=new hd(r,o,i,e.indexCountWithoutSkirts,t,s,a,c,u,h,l,f,e.westIndicesSouthToNorth,e.southIndicesEastToWest,e.eastIndicesNorthToSouth,e.northIndicesWestToEast),d._quantizedVertices=void 0,d._encodedNormals=void 0,d._indices=void 0,d._uValues=void 0,d._vValues=void 0,d._heightValues=void 0,d._westIndices=void 0,d._southIndices=void 0,d._eastIndices=void 0,d._northIndices=void 0,d._mesh}))};const jp=new ad("upsampleQuantizedTerrainMesh",ld.maximumAsynchronousTasks);Up.prototype.upsample=function(e,t,n,i,o,r,s){if(!C(e))throw new x("tilingScheme is required.");if(!C(t))throw new x("thisX is required.");if(!C(n))throw new x("thisY is required.");if(!C(i))throw new x("thisLevel is required.");if(!C(o))throw new x("descendantX is required.");if(!C(r))throw new x("descendantY is required.");if(!C(s))throw new x("descendantLevel is required.");const a=s-i;if(a>1)throw new x("Upsampling through more than one level at a time is not currently supported.");const c=this._mesh;if(!C(this._mesh))return;const l=2*t!==o,u=2*n===r,h=e.ellipsoid,d=e.tileXYToRectangle(o,r,s),f=jp.scheduleTask({vertices:c.vertices,vertexCountWithoutSkirts:c.vertexCountWithoutSkirts,indices:c.indices,indexCountWithoutSkirts:c.indexCountWithoutSkirts,encoding:c.encoding,minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,isEastChild:l,isNorthChild:u,childRectangle:d,ellipsoid:h});if(!C(f))return;let p=Math.min(this._westSkirtHeight,this._eastSkirtHeight);p=Math.min(p,this._southSkirtHeight),p=Math.min(p,this._northSkirtHeight);const m=l?.5*p:this._westSkirtHeight,_=u?.5*p:this._southSkirtHeight,g=l?this._eastSkirtHeight:.5*p,y=u?this._northSkirtHeight:.5*p,v=this._credits;return Promise.resolve(f).then((function(e){const t=new Uint16Array(e.vertices),n=fd.createTypedArray(t.length/3,e.indices);let i;return C(e.encodedNormals)&&(i=new Uint8Array(e.encodedNormals)),new Up({quantizedVertices:t,indices:n,encodedNormals:i,minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight,boundingSphere:nn.clone(e.boundingSphere),orientedBoundingBox:$u.clone(e.orientedBoundingBox),horizonOcclusionPoint:K.clone(e.horizonOcclusionPoint),westIndices:e.westIndices,southIndices:e.southIndices,eastIndices:e.eastIndices,northIndices:e.northIndices,westSkirtHeight:m,southSkirtHeight:_,eastSkirtHeight:g,northSkirtHeight:y,childTileMask:0,credits:v,createdByUpsampling:!0})}))};const Yp=32767,Kp=new K;function Xp(e,t,n,i,o,r,s,a){const c=Math.min(n,o,s),l=Math.max(n,o,s),u=Math.min(i,r,a),h=Math.max(i,r,a);return e>=c&&e<=l&&t>=u&&t<=h}Up.prototype.interpolateHeight=function(e,t,n){let i=z.clamp((t-e.west)/e.width,0,1);i*=Yp;let o=z.clamp((n-e.south)/e.height,0,1);return o*=Yp,C(this._mesh)?$p(this,i,o):em(this,i,o)};const Qp=new ro,Jp=new ro,Zp=new ro;function $p(e,t,n){const i=e._mesh,o=i.vertices,r=i.encoding,s=i.indices;for(let a=0,c=s.length;a<c;a+=3){const e=s[a],i=s[a+1],c=s[a+2],l=r.decodeTextureCoordinates(o,e,Qp),u=r.decodeTextureCoordinates(o,i,Jp),h=r.decodeTextureCoordinates(o,c,Zp);if(Xp(t,n,l.x,l.y,u.x,u.y,h.x,h.y)){const s=kp.computeBarycentricCoordinates(t,n,l.x,l.y,u.x,u.y,h.x,h.y,Kp);if(s.x>=-1e-15&&s.y>=-1e-15&&s.z>=-1e-15){const t=r.decodeHeight(o,e),n=r.decodeHeight(o,i),a=r.decodeHeight(o,c);return s.x*t+s.y*n+s.z*a}}}}function em(e,t,n){const i=e._uValues,o=e._vValues,r=e._heightValues,s=e._indices;for(let a=0,c=s.length;a<c;a+=3){const c=s[a],l=s[a+1],u=s[a+2],h=i[c],d=i[l],f=i[u],p=o[c],m=o[l],_=o[u];if(Xp(t,n,h,p,d,m,f,_)){const i=kp.computeBarycentricCoordinates(t,n,h,p,d,m,f,_,Kp);if(i.x>=-1e-15&&i.y>=-1e-15&&i.z>=-1e-15){const t=i.x*r[c]+i.y*r[l]+i.z*r[u];return z.lerp(e._minimumHeight,e._maximumHeight,t/Yp)}}}}Up.prototype.isChildAvailable=function(e,t,n,i){if(!C(e))throw new x("thisX is required.");if(!C(t))throw new x("thisY is required.");if(!C(n))throw new x("childX is required.");if(!C(i))throw new x("childY is required.");let o=2;return n!==2*e&&++o,i!==2*t&&(o-=2),0!==(this._childTileMask&1<<o)},Up.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling};var tm=Up;function nm(e){this.resource=e.resource,this.version=e.version,this.isHeightmap=e.isHeightmap,this.tileUrlTemplates=e.tileUrlTemplates,this.availability=e.availability,this.hasVertexNormals=e.hasVertexNormals,this.hasWaterMask=e.hasWaterMask,this.hasMetadata=e.hasMetadata,this.availabilityLevels=e.availabilityLevels,this.availabilityTilesLoaded=e.availabilityTilesLoaded,this.littleEndianExtensionSize=e.littleEndianExtensionSize,this.availabilityPromiseCache={}}function im(e){if(!C(e)||!C(e.url))throw new x("options.url is required.");this._heightmapWidth=65,this._heightmapStructure=void 0,this._hasWaterMask=!1,this._hasVertexNormals=!1,this._ellipsoid=e.ellipsoid,this._requestVertexNormals=R(e.requestVertexNormals,!1),this._requestWaterMask=R(e.requestWaterMask,!1),this._requestMetadata=R(e.requestMetadata,!0),this._errorEvent=new $n;let t=e.credit;"string"===typeof t&&(t=new Tr(t)),this._credit=t,this._availability=void 0;const n=yn();this._ready=!1,this._readyPromise=n,this._tileCredits=void 0;const i=this;let o,r,s;const a=this._layers=[];let c="";const l=[];let u=0;function h(e){let t;if(!e.format)return t="The tile format is not specified in the layer.json file.",void(s=ef.handleError(s,i,i._errorEvent,t,void 0,void 0,void 0,m));if(!e.tiles||0===e.tiles.length)return t="The layer.json file does not specify any tile URL templates.",void(s=ef.handleError(s,i,i._errorEvent,t,void 0,void 0,void 0,m));let n=!1,f=!1,p=!1,_=!0,g=!1;if("heightmap-1.0"===e.format)g=!0,C(i._heightmapStructure)||(i._heightmapStructure={heightScale:.2,heightOffset:-1e3,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1,lowestEncodedHeight:0,highestEncodedHeight:65535}),f=!0,i._requestWaterMask=!0;else if(0!==e.format.indexOf("quantized-mesh-1."))return t=`The tile format "${e.format}" is invalid or not supported.`,void(s=ef.handleError(s,i,i._errorEvent,t,void 0,void 0,void 0,m));const y=e.tiles,v=e.maxzoom;if(u=Math.max(u,v),e.projection&&"EPSG:4326"!==e.projection){if("EPSG:3857"!==e.projection)return t=`The projection "${e.projection}" is invalid or not supported.`,void(s=ef.handleError(s,i,i._errorEvent,t,void 0,void 0,void 0,m));i._tilingScheme=new nf({numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,ellipsoid:i._ellipsoid})}else i._tilingScheme=new ao({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1,ellipsoid:i._ellipsoid});if(i._levelZeroMaximumGeometricError=Ad.getEstimatedLevelZeroGeometricErrorForAHeightmap(i._tilingScheme.ellipsoid,i._heightmapWidth,i._tilingScheme.getNumberOfXTilesAtLevel(0)),e.scheme&&"tms"!==e.scheme&&"slippyMap"!==e.scheme)return t=`The scheme "${e.scheme}" is invalid or not supported.`,void(s=ef.handleError(s,i,i._errorEvent,t,void 0,void 0,void 0,m));let b;i._scheme=e.scheme,C(e.extensions)&&-1!==e.extensions.indexOf("octvertexnormals")?n=!0:C(e.extensions)&&-1!==e.extensions.indexOf("vertexnormals")&&(n=!0,_=!1),C(e.extensions)&&-1!==e.extensions.indexOf("watermask")&&(f=!0),C(e.extensions)&&-1!==e.extensions.indexOf("metadata")&&(p=!0);const A=e.metadataAvailability,w=e.available;let T;if(C(w)&&!C(A)){T=new Qd(i._tilingScheme,w.length);for(let e=0;e<w.length;++e){const t=w[e],n=i._tilingScheme.getNumberOfYTilesAtLevel(e);C(l[e])||(l[e]=[]);for(let i=0;i<t.length;++i){const o=t[i],r=n-o.endY-1,s=n-o.startY-1;l[e].push([o.startX,r,o.endX,s]),T.addAvailableTileRange(e,o.startX,r,o.endX,s)}}}else C(A)&&(b=new Qd(i._tilingScheme,v),T=new Qd(i._tilingScheme,v),l[0]=[[0,0,1,0]],T.addAvailableTileRange(0,0,0,1,0));i._hasWaterMask=i._hasWaterMask||f,i._hasVertexNormals=i._hasVertexNormals||n,i._hasMetadata=i._hasMetadata||p,C(e.attribution)&&(c.length>0&&(c+=" "),c+=e.attribution),a.push(new nm({resource:o,version:e.version,isHeightmap:g,tileUrlTemplates:y,availability:T,hasVertexNormals:n,hasWaterMask:f,hasMetadata:p,availabilityLevels:A,availabilityTilesLoaded:b,littleEndianExtensionSize:_}));const E=e.parentUrl;if(C(E)){if(!C(T))return console.log("A layer.json can't have a parentUrl if it does't have an available array."),Promise.resolve();o=o.getDerivedResource({url:E}),o.appendForwardSlash(),r=o.getDerivedResource({url:"layer.json"});const e=r.fetchJson();return Promise.resolve(e).then(h).catch(d)}return Promise.resolve()}function d(e){const t=`An error occurred while accessing ${r.url}.`;s=ef.handleError(s,i,i._errorEvent,t,void 0,void 0,void 0,m)}function f(e){h(e).then((function(){if(C(s))return;const e=l.length;if(e>0){const t=i._availability=new Qd(i._tilingScheme,u);for(let n=0;n<e;++n){const e=l[n];for(let i=0;i<e.length;++i){const o=e[i];t.addAvailableTileRange(n,o[0],o[1],o[2],o[3])}}}if(c.length>0){const e=new Tr(c);C(i._tileCredits)?i._tileCredits.push(e):i._tileCredits=[e]}i._ready=!0,i._readyPromise.resolve(!0)}))}function p(e){C(e)&&404===e.statusCode?f({tilejson:"2.1.0",format:"heightmap-1.0",version:"1.0.0",scheme:"tms",tiles:["{z}/{x}/{y}.terrain?v={version}"]}):d(e)}function m(){Promise.resolve(r.fetchJson()).then(f).catch(p)}Promise.resolve(e.url).then((function(e){const t=Vi.createIfNeeded(e);t.appendForwardSlash(),o=t,r=o.getDerivedResource({url:"layer.json"}),i._tileCredits=t.credits,m()})).catch((function(e){n.reject(e)}))}const om={OCT_VERTEX_NORMALS:1,WATER_MASK:2,METADATA:4};function rm(e){if(!C(e)||0===e.length)return{Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9,*/*;q=0.01"};const t=e.join("-");return{Accept:`application/vnd.quantized-mesh;extensions=${t},application/octet-stream;q=0.9,*/*;q=0.01`}}function sm(e,t,n,i,o){const r=new Uint16Array(t,0,e._heightmapWidth*e._heightmapWidth);return new Pd({buffer:r,childTileMask:new Uint8Array(t,r.byteLength,1)[0],waterMask:new Uint8Array(t,r.byteLength+1,t.byteLength-r.byteLength-1),width:e._heightmapWidth,height:e._heightmapWidth,structure:e._heightmapStructure,credits:e._tileCredits})}function am(e,t,n,i,o,r){const s=r.littleEndianExtensionSize;let a=0;const c=3,l=c+1,u=Float64Array.BYTES_PER_ELEMENT*c,h=Float64Array.BYTES_PER_ELEMENT*l,d=3,f=Uint16Array.BYTES_PER_ELEMENT*d,p=3;let m=Uint16Array.BYTES_PER_ELEMENT,_=m*p;const g=new DataView(t),y=new K(g.getFloat64(a,!0),g.getFloat64(a+8,!0),g.getFloat64(a+16,!0));a+=u;const v=g.getFloat32(a,!0);a+=Float32Array.BYTES_PER_ELEMENT;const b=g.getFloat32(a,!0);a+=Float32Array.BYTES_PER_ELEMENT;const A=new nn(new K(g.getFloat64(a,!0),g.getFloat64(a+8,!0),g.getFloat64(a+16,!0)),g.getFloat64(a+u,!0));a+=h;const w=new K(g.getFloat64(a,!0),g.getFloat64(a+8,!0),g.getFloat64(a+16,!0));a+=u;const T=g.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;const E=new Uint16Array(t,a,3*T);a+=T*f,T>65536&&(m=Uint32Array.BYTES_PER_ELEMENT,_=m*p);const x=E.subarray(0,T),S=E.subarray(T,2*T),I=E.subarray(2*T,3*T);wh.zigZagDeltaDecode(x,S,I),a%m!==0&&(a+=m-a%m);const O=g.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;const D=fd.createTypedArrayFromArrayBuffer(T,t,a,O*p);a+=O*_;let P=0;const R=D.length;for(let C=0;C<R;++C){const e=D[C];D[C]=P-e,0===e&&++P}const L=g.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;const M=fd.createTypedArrayFromArrayBuffer(T,t,a,L);a+=L*m;const B=g.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;const N=fd.createTypedArrayFromArrayBuffer(T,t,a,B);a+=B*m;const F=g.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;const z=fd.createTypedArrayFromArrayBuffer(T,t,a,F);a+=F*m;const k=g.getUint32(a,!0);a+=Uint32Array.BYTES_PER_ELEMENT;const U=fd.createTypedArrayFromArrayBuffer(T,t,a,k);let V,H;a+=k*m;while(a<g.byteLength){const c=g.getUint8(a,!0);a+=Uint8Array.BYTES_PER_ELEMENT;const l=g.getUint32(a,s);if(a+=Uint32Array.BYTES_PER_ELEMENT,c===om.OCT_VERTEX_NORMALS&&e._requestVertexNormals)V=new Uint8Array(t,a,2*T);else if(c===om.WATER_MASK&&e._requestWaterMask)H=new Uint8Array(t,a,l);else if(c===om.METADATA&&e._requestMetadata){const s=g.getUint32(a,!0);if(s>0){const i=Fp(new Uint8Array(t),a+Uint32Array.BYTES_PER_ELEMENT,s),o=i.available;if(C(o))for(let t=0;t<o.length;++t){const i=n+t+1,s=o[t],a=e._tilingScheme.getNumberOfYTilesAtLevel(i);for(let t=0;t<s.length;++t){const n=s[t],o=a-n.endY-1,c=a-n.startY-1;e.availability.addAvailableTileRange(i,n.startX,o,n.endX,c),r.availability.addAvailableTileRange(i,n.startX,o,n.endX,c)}}}r.availabilityTilesLoaded.addAvailableTileRange(n,i,o,i,o)}a+=l}const G=5*e.getLevelMaximumGeometricError(n),W=e._tilingScheme.tileXYToRectangle(i,o,n),q=$u.fromRectangle(W,v,b,e._tilingScheme.ellipsoid);return new tm({center:y,minimumHeight:v,maximumHeight:b,boundingSphere:A,orientedBoundingBox:q,horizonOcclusionPoint:w,quantizedVertices:E,encodedNormals:V,indices:D,westIndices:M,southIndices:N,eastIndices:z,northIndices:U,westSkirtHeight:G,southSkirtHeight:G,eastSkirtHeight:G,northSkirtHeight:G,childTileMask:e.availability.computeChildMaskForTile(n,i,o),waterMask:H,credits:e._tileCredits})}function cm(e,t,n,i,o,r){if(!C(o))return Promise.reject(new Je("Terrain tile doesn't exist"));const s=o.tileUrlTemplates;if(0===s.length)return;let a;if(e._scheme&&"tms"!==e._scheme)a=n;else{const t=e._tilingScheme.getNumberOfYTilesAtLevel(i);a=t-n-1}const c=[];let l,u;e._requestVertexNormals&&o.hasVertexNormals&&c.push(o.littleEndianExtensionSize?"octvertexnormals":"vertexnormals"),e._requestWaterMask&&o.hasWaterMask&&c.push("watermask"),e._requestMetadata&&o.hasMetadata&&c.push("metadata");const h=s[(t+a+i)%s.length],d=o.resource;C(d._ionEndpoint)&&!C(d._ionEndpoint.externalType)?(0!==c.length&&(u={extensions:c.join("-")}),l=rm(void 0)):l=rm(c);const f=d.getDerivedResource({url:h,templateValues:{version:o.version,z:i,x:t,y:a},queryParameters:u,headers:l,request:r}).fetchArrayBuffer();return C(f)?f.then((function(r){return C(e._heightmapStructure)?sm(e,r,i,t,n):am(e,r,i,t,n,o)})):void 0}function lm(e,t,n,i){if(0===i)return;const o=e.availabilityLevels,r=i%o===0?i-o:(i/o|0)*o,s=1<<i-r,a=t/s|0,c=n/s|0;return{level:r,x:a,y:c}}function um(e,t,n,i,o,r){if(!C(o.availabilityLevels))return{result:!1};let s;const a=function(){delete o.availabilityPromiseCache[s]},c=o.availabilityTilesLoaded,l=o.availability;let u=lm(o,t,n,i);while(C(u)){if(l.isTileAvailable(u.level,u.x,u.y)&&!c.isTileAvailable(u.level,u.x,u.y)){let t;if(!r&&(s=`${u.level}-${u.x}-${u.y}`,t=o.availabilityPromiseCache[s],!C(t))){const n=new jn({throttle:!1,throttleByServer:!0,type:Wn.TERRAIN});t=cm(e,u.x,u.y,u.level,o,n),C(t)&&(o.availabilityPromiseCache[s]=t,t.then(a))}return{result:!0,promise:t}}u=lm(o,u.x,u.y,u.level)}return{result:!1}}im.prototype.requestTileGeometry=function(e,t,n,i){if(!this._ready)throw new x("requestTileGeometry must not be called before the terrain provider is ready.");const o=this._layers;let r;const s=o.length;if(1===s)r=o[0];else for(let a=0;a<s;++a){const i=o[a];if(!C(i.availability)||i.availability.isTileAvailable(n,e,t)){r=i;break}}return cm(this,e,t,n,r,i)},Object.defineProperties(im.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){if(!this._ready)throw new x("credit must not be called before the terrain provider is ready.");return this._credit}},tilingScheme:{get:function(){if(!this._ready)throw new x("tilingScheme must not be called before the terrain provider is ready.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){if(!this._ready)throw new x("hasWaterMask must not be called before the terrain provider is ready.");return this._hasWaterMask&&this._requestWaterMask}},hasVertexNormals:{get:function(){if(!this._ready)throw new x("hasVertexNormals must not be called before the terrain provider is ready.");return this._hasVertexNormals&&this._requestVertexNormals}},hasMetadata:{get:function(){if(!this._ready)throw new x("hasMetadata must not be called before the terrain provider is ready.");return this._hasMetadata&&this._requestMetadata}},requestVertexNormals:{get:function(){return this._requestVertexNormals}},requestWaterMask:{get:function(){return this._requestWaterMask}},requestMetadata:{get:function(){return this._requestMetadata}},availability:{get:function(){if(!this._ready)throw new x("availability must not be called before the terrain provider is ready.");return this._availability}}}),im.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},im.prototype.getTileDataAvailable=function(e,t,n){if(!C(this._availability))return;if(n>this._availability._maximumLevel)return!1;if(this._availability.isTileAvailable(n,e,t))return!0;if(!this._hasMetadata)return!1;const i=this._layers,o=i.length;for(let r=0;r<o;++r){const o=um(this,e,t,n,i[r],0===r);if(o.result)return}return!1},im.prototype.loadTileDataAvailability=function(e,t,n){if(!C(this._availability)||n>this._availability._maximumLevel||this._availability.isTileAvailable(n,e,t)||!this._hasMetadata)return;const i=this._layers,o=i.length;for(let r=0;r<o;++r){const o=um(this,e,t,n,i[r],0===r);if(C(o.promise))return o.promise}},im._getAvailabilityTile=lm;var hm=im;const dm={},fm=new K,pm=new K,mm=new il,_m=new ke;function gm(e,t,n,i,o,r,s,a,c,l){const u=e+t;K.multiplyByScalar(i,Math.cos(u),fm),K.multiplyByScalar(n,Math.sin(u),pm),K.add(fm,pm,fm);let h=Math.cos(e);h*=h;let d=Math.sin(e);d*=d;const f=r/Math.sqrt(s*h+o*d),p=f/a;return il.fromAxisAngle(fm,p,mm),ke.fromQuaternion(mm,_m),ke.multiplyByVector(_m,c,l),K.normalize(l,l),K.multiplyByScalar(l,a,l),l}const ym=new K,vm=new K,bm=new K,Am=new K;dm.raisePositionsToHeight=function(e,t,n){const i=t.ellipsoid,o=t.height,r=t.extrudedHeight,s=n?e.length/3*2:e.length/3,a=new Float64Array(3*s),c=e.length,l=n?c:0;for(let u=0;u<c;u+=3){const t=u+1,s=u+2,c=K.fromArray(e,u,ym);i.scaleToGeodeticSurface(c,c);const h=K.clone(c,vm),d=i.geodeticSurfaceNormal(c,Am),f=K.multiplyByScalar(d,o,bm);K.add(c,f,c),n&&(K.multiplyByScalar(d,r,f),K.add(h,f,h),a[u+l]=h.x,a[t+l]=h.y,a[s+l]=h.z),a[u]=c.x,a[t]=c.y,a[s]=c.z}return a};const wm=new K,Tm=new K,Cm=new K;dm.computeEllipsePositions=function(e,t,n){const i=e.semiMinorAxis,o=e.semiMajorAxis,r=e.rotation,s=e.center,a=8*e.granularity,c=i*i,l=o*o,u=o*i,h=K.magnitude(s),d=K.normalize(s,wm);let f=K.cross(K.UNIT_Z,s,Tm);f=K.normalize(f,f);const p=K.cross(d,f,Cm);let m=1+Math.ceil(z.PI_OVER_TWO/a);const _=z.PI_OVER_TWO/(m-1);let g=z.PI_OVER_TWO-m*_;g<0&&(m-=Math.ceil(Math.abs(g)/_));const y=m*(m+2)*2,v=t?new Array(3*y):void 0;let b=0,A=ym,w=vm;const T=4*m*3;let C=T-1,E=0;const x=n?new Array(T):void 0;let S,I,O,D,P;for(g=z.PI_OVER_TWO,A=gm(g,r,p,f,c,u,l,h,d,A),t&&(v[b++]=A.x,v[b++]=A.y,v[b++]=A.z),n&&(x[C--]=A.z,x[C--]=A.y,x[C--]=A.x),g=z.PI_OVER_TWO-_,S=1;S<m+1;++S){if(A=gm(g,r,p,f,c,u,l,h,d,A),w=gm(Math.PI-g,r,p,f,c,u,l,h,d,w),t){for(v[b++]=A.x,v[b++]=A.y,v[b++]=A.z,O=2*S+2,I=1;I<O-1;++I)D=I/(O-1),P=K.lerp(A,w,D,bm),v[b++]=P.x,v[b++]=P.y,v[b++]=P.z;v[b++]=w.x,v[b++]=w.y,v[b++]=w.z}n&&(x[C--]=A.z,x[C--]=A.y,x[C--]=A.x,x[E++]=w.x,x[E++]=w.y,x[E++]=w.z),g=z.PI_OVER_TWO-(S+1)*_}for(S=m;S>1;--S){if(g=z.PI_OVER_TWO-(S-1)*_,A=gm(-g,r,p,f,c,u,l,h,d,A),w=gm(g+Math.PI,r,p,f,c,u,l,h,d,w),t){for(v[b++]=A.x,v[b++]=A.y,v[b++]=A.z,O=2*(S-1)+2,I=1;I<O-1;++I)D=I/(O-1),P=K.lerp(A,w,D,bm),v[b++]=P.x,v[b++]=P.y,v[b++]=P.z;v[b++]=w.x,v[b++]=w.y,v[b++]=w.z}n&&(x[C--]=A.z,x[C--]=A.y,x[C--]=A.x,x[E++]=w.x,x[E++]=w.y,x[E++]=w.z)}g=z.PI_OVER_TWO,A=gm(-g,r,p,f,c,u,l,h,d,A);const R={};return t&&(v[b++]=A.x,v[b++]=A.y,v[b++]=A.z,R.positions=v,R.numPts=m),n&&(x[C--]=A.z,x[C--]=A.y,x[C--]=A.x,R.outerPositions=x),R};var Em=dm;function xm(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.geometry))throw new x("options.geometry is required.");this.geometry=e.geometry,this.modelMatrix=ft.clone(R(e.modelMatrix,ft.IDENTITY)),this.id=e.id,this.pickPrimitive=e.pickPrimitive,this.attributes=R(e.attributes,{}),this.westHemisphereGeometry=void 0,this.eastHemisphereGeometry=void 0}var Sm=xm;const Im=new K,Om=new K,Dm=new K;function Pm(e,t,n,i,o){let r,s,a,c,l,u,h,d;if(D.defined("point",e),D.defined("p0",t),D.defined("p1",n),D.defined("p2",i),C(o)||(o=new K),C(t.z)){if(K.equalsEpsilon(e,t,z.EPSILON14))return K.clone(K.UNIT_X,o);if(K.equalsEpsilon(e,n,z.EPSILON14))return K.clone(K.UNIT_Y,o);if(K.equalsEpsilon(e,i,z.EPSILON14))return K.clone(K.UNIT_Z,o);r=K.subtract(n,t,Im),s=K.subtract(i,t,Om),a=K.subtract(e,t,Dm),c=K.dot(r,r),l=K.dot(r,s),u=K.dot(r,a),h=K.dot(s,s),d=K.dot(s,a)}else{if(ro.equalsEpsilon(e,t,z.EPSILON14))return K.clone(K.UNIT_X,o);if(ro.equalsEpsilon(e,n,z.EPSILON14))return K.clone(K.UNIT_Y,o);if(ro.equalsEpsilon(e,i,z.EPSILON14))return K.clone(K.UNIT_Z,o);r=ro.subtract(n,t,Im),s=ro.subtract(i,t,Om),a=ro.subtract(e,t,Dm),c=ro.dot(r,r),l=ro.dot(r,s),u=ro.dot(r,a),h=ro.dot(s,s),d=ro.dot(s,a)}o.y=h*u-l*d,o.z=c*d-l*u;const f=c*h-l*l;if(0!==f)return o.y/=f,o.z/=f,o.x=1-o.y-o.z,o}var Rm=Pm;function Lm(){this.high=K.clone(K.ZERO),this.low=K.clone(K.ZERO)}Lm.encode=function(e,t){let n;return D.typeOf.number("value",e),C(t)||(t={high:0,low:0}),e>=0?(n=65536*Math.floor(e/65536),t.high=n,t.low=e-n):(n=65536*Math.floor(-e/65536),t.high=-n,t.low=e+n),t};const Mm={high:0,low:0};Lm.fromCartesian=function(e,t){D.typeOf.object("cartesian",e),C(t)||(t=new Lm);const n=t.high,i=t.low;return Lm.encode(e.x,Mm),n.x=Mm.high,i.x=Mm.low,Lm.encode(e.y,Mm),n.y=Mm.high,i.y=Mm.low,Lm.encode(e.z,Mm),n.z=Mm.high,i.z=Mm.low,t};const Bm=new Lm;Lm.writeElements=function(e,t,n){D.defined("cartesianArray",t),D.typeOf.number("index",n),D.typeOf.number.greaterThanOrEquals("index",n,0),Lm.fromCartesian(e,Bm);const i=Bm.high,o=Bm.low;t[n]=i.x,t[n+1]=i.y,t[n+2]=i.z,t[n+3]=o.x,t[n+4]=o.y,t[n+5]=o.z};var Nm=Lm;const Fm={calculateACMR:function(e){e=R(e,R.EMPTY_OBJECT);const t=e.indices;let n=e.maximumIndex;const i=R(e.cacheSize,24);if(!C(t))throw new x("indices is required.");const o=t.length;if(o<3||o%3!==0)throw new x("indices length must be a multiple of three.");if(n<=0)throw new x("maximumIndex must be greater than zero.");if(i<3)throw new x("cacheSize must be greater than two.");if(!C(n)){n=0;let e=0,i=t[e];while(e<o)i>n&&(n=i),++e,i=t[e]}const r=[];for(let a=0;a<n+1;a++)r[a]=0;let s=i+1;for(let a=0;a<o;++a)s-r[t[a]]>i&&(r[t[a]]=s,++s);return(s-i+1)/(o/3)},tipsify:function(e){e=R(e,R.EMPTY_OBJECT);const t=e.indices,n=e.maximumIndex,i=R(e.cacheSize,24);let o;function r(e,t,n,i){while(t.length>=1){const n=t[t.length-1];if(t.splice(t.length-1,1),e[n].numLiveTriangles>0)return n}while(o<i){if(e[o].numLiveTriangles>0)return++o,o-1;++o}return-1}function s(e,t,n,i,o,s,a){let c,l=-1,u=-1,h=0;while(h<n.length){const e=n[h];i[e].numLiveTriangles&&(c=0,o-i[e].timeStamp+2*i[e].numLiveTriangles<=t&&(c=o-i[e].timeStamp),(c>u||-1===u)&&(u=c,l=e)),++h}return-1===l?r(i,s,e,a):l}if(!C(t))throw new x("indices is required.");const a=t.length;if(a<3||a%3!==0)throw new x("indices length must be a multiple of three.");if(n<=0)throw new x("maximumIndex must be greater than zero.");if(i<3)throw new x("cacheSize must be greater than two.");let c=0,l=0,u=t[l];const h=a;if(C(n))c=n+1;else{while(l<h)u>c&&(c=u),++l,u=t[l];if(-1===c)return 0;++c}const d=[];let f;for(f=0;f<c;f++)d[f]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};l=0;let p=0;while(l<h)d[t[l]].vertexTriangles.push(p),++d[t[l]].numLiveTriangles,d[t[l+1]].vertexTriangles.push(p),++d[t[l+1]].numLiveTriangles,d[t[l+2]].vertexTriangles.push(p),++d[t[l+2]].numLiveTriangles,++p,l+=3;let m=0,_=i+1;o=1;let g=[];const y=[];let v,b,A=0;const w=[],T=a/3,E=[];for(f=0;f<T;f++)E[f]=!1;let S,I;while(-1!==m){g=[],b=d[m],I=b.vertexTriangles.length;for(let e=0;e<I;++e)if(p=b.vertexTriangles[e],!E[p]){E[p]=!0,l=p+p+p;for(let e=0;e<3;++e)S=t[l],g.push(S),y.push(S),w[A]=S,++A,v=d[S],--v.numLiveTriangles,_-v.timeStamp>i&&(v.timeStamp=_,++_),++l}m=s(t,i,g,d,_,y,c)}return w}};var zm=Fm;const km={};function Um(e,t,n,i,o){e[t++]=n,e[t++]=i,e[t++]=i,e[t++]=o,e[t++]=o,e[t]=n}function Vm(e){const t=e.length,n=t/3*6,i=fd.createTypedArray(t,n);let o=0;for(let r=0;r<t;r+=3,o+=6)Um(i,o,e[r],e[r+1],e[r+2]);return i}function Hm(e){const t=e.length;if(t>=3){const n=6*(t-2),i=fd.createTypedArray(t,n);Um(i,0,e[0],e[1],e[2]);let o=6;for(let r=3;r<t;++r,o+=6)Um(i,o,e[r-1],e[r],e[r-2]);return i}return new Uint16Array}function Gm(e){if(e.length>0){const t=e.length-1,n=6*(t-1),i=fd.createTypedArray(t,n),o=e[0];let r=0;for(let s=1;s<t;++s,r+=6)Um(i,r,o,e[s],e[s+1]);return i}return new Uint16Array}function Wm(e){const t={};for(const n in e)if(e.hasOwnProperty(n)&&C(e[n])&&C(e[n].values)){const i=e[n];t[n]=new Uf({componentDatatype:i.componentDatatype,componentsPerAttribute:i.componentsPerAttribute,normalize:i.normalize,values:[]})}return t}function qm(e,t,n){for(const i in t)if(t.hasOwnProperty(i)&&C(t[i])&&C(t[i].values)){const o=t[i];for(let t=0;t<o.componentsPerAttribute;++t)e[i].values.push(o.values[n*o.componentsPerAttribute+t])}}km.toWireframe=function(e){if(!C(e))throw new x("geometry is required.");const t=e.indices;if(C(t)){switch(e.primitiveType){case xf.TRIANGLES:e.indices=Vm(t);break;case xf.TRIANGLE_STRIP:e.indices=Hm(t);break;case xf.TRIANGLE_FAN:e.indices=Gm(t);break;default:throw new x("geometry.primitiveType must be TRIANGLES, TRIANGLE_STRIP, or TRIANGLE_FAN.")}e.primitiveType=xf.LINES}return e},km.createLineSegmentsForVectors=function(e,t,n){if(t=R(t,"normal"),!C(e))throw new x("geometry is required.");if(!C(e.attributes.position))throw new x("geometry.attributes.position is required.");if(!C(e.attributes[t]))throw new x(`geometry.attributes must have an attribute with the same name as the attributeName parameter, ${t}.`);n=R(n,1e4);const i=e.attributes.position.values,o=e.attributes[t].values,r=i.length,s=new Float64Array(2*r);let a,c=0;for(let u=0;u<r;u+=3)s[c++]=i[u],s[c++]=i[u+1],s[c++]=i[u+2],s[c++]=i[u]+o[u]*n,s[c++]=i[u+1]+o[u+1]*n,s[c++]=i[u+2]+o[u+2]*n;const l=e.boundingSphere;return C(l)&&(a=new nn(l.center,l.radius+n)),new zf({attributes:{position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:s})},primitiveType:xf.LINES,boundingSphere:a})},km.createAttributeLocations=function(e){if(!C(e))throw new x("geometry is required.");const t=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],n=e.attributes,i={};let o,r=0;const s=t.length;for(o=0;o<s;++o){const e=t[o];C(n[e])&&(i[e]=r++)}for(const a in n)n.hasOwnProperty(a)&&!C(i[a])&&(i[a]=r++);return i},km.reorderForPreVertexCache=function(e){if(!C(e))throw new x("geometry is required.");const t=zf.computeNumberOfVertices(e),n=e.indices;if(C(n)){const i=new Int32Array(t);for(let e=0;e<t;e++)i[e]=-1;const o=n,r=o.length,s=fd.createTypedArray(t,r);let a,c=0,l=0,u=0;while(c<r)a=i[o[c]],-1!==a?s[l]=a:(a=o[c],i[a]=u,s[l]=u,++u),++c,++l;e.indices=s;const h=e.attributes;for(const e in h)if(h.hasOwnProperty(e)&&C(h[e])&&C(h[e].values)){const n=h[e],o=n.values;let r=0;const s=n.componentsPerAttribute,a=ih.createTypedArray(n.componentDatatype,u*s);while(r<t){const e=i[r];if(-1!==e)for(let t=0;t<s;t++)a[s*e+t]=o[s*r+t];++r}n.values=a}}return e},km.reorderForPostVertexCache=function(e,t){if(!C(e))throw new x("geometry is required.");const n=e.indices;if(e.primitiveType===xf.TRIANGLES&&C(n)){const i=n.length;let o=0;for(let e=0;e<i;e++)n[e]>o&&(o=n[e]);e.indices=zm.tipsify({indices:n,maximumIndex:o,cacheSize:t})}return e},km.fitToUnsignedShortIndices=function(e){if(!C(e))throw new x("geometry is required.");if(C(e.indices)&&e.primitiveType!==xf.TRIANGLES&&e.primitiveType!==xf.LINES&&e.primitiveType!==xf.POINTS)throw new x("geometry.primitiveType must equal to PrimitiveType.TRIANGLES, PrimitiveType.LINES, or PrimitiveType.POINTS.");const t=[],n=zf.computeNumberOfVertices(e);if(C(e.indices)&&n>=z.SIXTY_FOUR_KILOBYTES){let n=[],i=[],o=0,r=Wm(e.attributes);const s=e.indices,a=s.length;let c;e.primitiveType===xf.TRIANGLES?c=3:e.primitiveType===xf.LINES?c=2:e.primitiveType===xf.POINTS&&(c=1);for(let l=0;l<a;l+=c){for(let t=0;t<c;++t){const a=s[l+t];let c=n[a];C(c)||(c=o++,n[a]=c,qm(r,e.attributes,a)),i.push(c)}o+c>=z.SIXTY_FOUR_KILOBYTES&&(t.push(new zf({attributes:r,indices:i,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),n=[],i=[],o=0,r=Wm(e.attributes))}0!==i.length&&t.push(new zf({attributes:r,indices:i,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else t.push(e);return t};const jm=new K,Ym=new se;km.projectTo2D=function(e,t,n,i,o){if(!C(e))throw new x("geometry is required.");if(!C(t))throw new x("attributeName is required.");if(!C(n))throw new x("attributeName3D is required.");if(!C(i))throw new x("attributeName2D is required.");if(!C(e.attributes[t]))throw new x(`geometry must have attribute matching the attributeName argument: ${t}.`);if(e.attributes[t].componentDatatype!==ih.DOUBLE)throw new x("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");const r=e.attributes[t];o=C(o)?o:new ve;const s=o.ellipsoid,a=r.values,c=new Float64Array(a.length);let l=0;for(let u=0;u<a.length;u+=3){const e=K.fromArray(a,u,jm),t=s.cartesianToCartographic(e,Ym);if(!C(t))throw new x(`Could not project point (${e.x}, ${e.y}, ${e.z}) to 2D.`);const n=o.project(t,jm);c[l++]=n.x,c[l++]=n.y,c[l++]=n.z}return e.attributes[n]=r,e.attributes[i]=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:c}),delete e.attributes[t],e};const Km={high:0,low:0};km.encodeAttribute=function(e,t,n,i){if(!C(e))throw new x("geometry is required.");if(!C(t))throw new x("attributeName is required.");if(!C(n))throw new x("attributeHighName is required.");if(!C(i))throw new x("attributeLowName is required.");if(!C(e.attributes[t]))throw new x(`geometry must have attribute matching the attributeName argument: ${t}.`);if(e.attributes[t].componentDatatype!==ih.DOUBLE)throw new x("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");const o=e.attributes[t],r=o.values,s=r.length,a=new Float32Array(s),c=new Float32Array(s);for(let u=0;u<s;++u)Nm.encode(r[u],Km),a[u]=Km.high,c[u]=Km.low;const l=o.componentsPerAttribute;return e.attributes[n]=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:l,values:a}),e.attributes[i]=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:l,values:c}),delete e.attributes[t],e};let Xm=new K;function Qm(e,t){if(C(t)){const n=t.values,i=n.length;for(let t=0;t<i;t+=3)K.unpack(n,t,Xm),ft.multiplyByPoint(e,Xm,Xm),K.pack(Xm,n,t)}}function Jm(e,t){if(C(t)){const n=t.values,i=n.length;for(let t=0;t<i;t+=3)K.unpack(n,t,Xm),ke.multiplyByVector(e,Xm,Xm),Xm=K.normalize(Xm,Xm),K.pack(Xm,n,t)}}const Zm=new ft,$m=new ke;function e_(e,t){const n=e.length,i={},o=e[0][t].attributes;let r;for(r in o)if(o.hasOwnProperty(r)&&C(o[r])&&C(o[r].values)){const s=o[r];let a=s.values.length,c=!0;for(let i=1;i<n;++i){const n=e[i][t].attributes[r];if(!C(n)||s.componentDatatype!==n.componentDatatype||s.componentsPerAttribute!==n.componentsPerAttribute||s.normalize!==n.normalize){c=!1;break}a+=n.values.length}c&&(i[r]=new Uf({componentDatatype:s.componentDatatype,componentsPerAttribute:s.componentsPerAttribute,normalize:s.normalize,values:ih.createTypedArray(s.componentDatatype,a)}))}return i}km.transformToWorldCoordinates=function(e){if(!C(e))throw new x("instance is required.");const t=e.modelMatrix;if(ft.equals(t,ft.IDENTITY))return e;const n=e.geometry.attributes;Qm(t,n.position),Qm(t,n.prevPosition),Qm(t,n.nextPosition),(C(n.normal)||C(n.tangent)||C(n.bitangent))&&(ft.inverse(t,Zm),ft.transpose(Zm,Zm),ft.getMatrix3(Zm,$m),Jm($m,n.normal),Jm($m,n.tangent),Jm($m,n.bitangent));const i=e.geometry.boundingSphere;return C(i)&&(e.geometry.boundingSphere=nn.transform(i,t,i)),e.modelMatrix=ft.clone(ft.IDENTITY),e};const t_=new K;function n_(e,t){const n=e.length;let i,o,r,s;const a=e[0].modelMatrix,c=C(e[0][t].indices),l=e[0][t].primitiveType;for(o=1;o<n;++o){if(!ft.equals(e[o].modelMatrix,a))throw new x("All instances must have the same modelMatrix.");if(C(e[o][t].indices)!==c)throw new x("All instance geometries must have an indices or not have one.");if(e[o][t].primitiveType!==l)throw new x("All instance geometries must have the same primitiveType.")}const u=e_(e,t);let h,d,f,p;for(i in u)if(u.hasOwnProperty(i))for(h=u[i].values,s=0,o=0;o<n;++o)for(d=e[o][t].attributes[i].values,f=d.length,r=0;r<f;++r)h[s++]=d[r];if(c){let i=0;for(o=0;o<n;++o)i+=e[o][t].indices.length;const r=zf.computeNumberOfVertices(new zf({attributes:u,primitiveType:xf.POINTS})),a=fd.createTypedArray(r,i);let c=0,l=0;for(o=0;o<n;++o){const n=e[o][t].indices,i=n.length;for(s=0;s<i;++s)a[c++]=l+n[s];l+=zf.computeNumberOfVertices(e[o][t])}p=a}let m,_=new K,g=0;for(o=0;o<n;++o){if(m=e[o][t].boundingSphere,!C(m)){_=void 0;break}K.add(m.center,_,_)}if(C(_))for(K.divideByScalar(_,n,_),o=0;o<n;++o){m=e[o][t].boundingSphere;const n=K.magnitude(K.subtract(m.center,_,t_))+m.radius;n>g&&(g=n)}return new zf({attributes:u,indices:p,primitiveType:l,boundingSphere:C(_)?new nn(_,g):void 0})}km.combineInstances=function(e){if(!C(e)||e.length<1)throw new x("instances is required and must have length greater than zero.");const t=[],n=[],i=e.length;for(let r=0;r<i;++r){const i=e[r];C(i.geometry)?t.push(i):C(i.westHemisphereGeometry)&&C(i.eastHemisphereGeometry)&&n.push(i)}const o=[];return t.length>0&&o.push(n_(t,"geometry")),n.length>0&&(o.push(n_(n,"westHemisphereGeometry")),o.push(n_(n,"eastHemisphereGeometry"))),o};const i_=new K,o_=new K,r_=new K,s_=new K;km.computeNormal=function(e){if(!C(e))throw new x("geometry is required.");if(!C(e.attributes.position)||!C(e.attributes.position.values))throw new x("geometry.attributes.position.values is required.");if(!C(e.indices))throw new x("geometry.indices is required.");if(e.indices.length<2||e.indices.length%3!==0)throw new x("geometry.indices length must be greater than 0 and be a multiple of 3.");if(e.primitiveType!==xf.TRIANGLES)throw new x("geometry.primitiveType must be PrimitiveType.TRIANGLES.");const t=e.indices,n=e.attributes,i=n.position.values,o=n.position.values.length/3,r=t.length,s=new Array(o),a=new Array(r/3),c=new Array(r);let l;for(l=0;l<o;l++)s[l]={indexOffset:0,count:0,currentCount:0};let u=0;for(l=0;l<r;l+=3){const e=t[l],n=t[l+1],o=t[l+2],r=3*e,c=3*n,h=3*o;o_.x=i[r],o_.y=i[r+1],o_.z=i[r+2],r_.x=i[c],r_.y=i[c+1],r_.z=i[c+2],s_.x=i[h],s_.y=i[h+1],s_.z=i[h+2],s[e].count++,s[n].count++,s[o].count++,K.subtract(r_,o_,r_),K.subtract(s_,o_,s_),a[u]=K.cross(r_,s_,new K),u++}let h,d=0;for(l=0;l<o;l++)s[l].indexOffset+=d,d+=s[l].count;for(u=0,l=0;l<r;l+=3){h=s[t[l]];let e=h.indexOffset+h.currentCount;c[e]=u,h.currentCount++,h=s[t[l+1]],e=h.indexOffset+h.currentCount,c[e]=u,h.currentCount++,h=s[t[l+2]],e=h.indexOffset+h.currentCount,c[e]=u,h.currentCount++,u++}const f=new Float32Array(3*o);for(l=0;l<o;l++){const e=3*l;if(h=s[l],K.clone(K.ZERO,i_),h.count>0){for(u=0;u<h.count;u++)K.add(i_,a[c[h.indexOffset+u]],i_);K.equalsEpsilon(K.ZERO,i_,z.EPSILON10)&&K.clone(a[c[h.indexOffset]],i_)}K.equalsEpsilon(K.ZERO,i_,z.EPSILON10)&&(i_.z=1),K.normalize(i_,i_),f[e]=i_.x,f[e+1]=i_.y,f[e+2]=i_.z}return e.attributes.normal=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:f}),e};const a_=new K,c_=new K,l_=new K;km.computeTangentAndBitangent=function(e){if(!C(e))throw new x("geometry is required.");const t=e.attributes,n=e.indices;if(!C(t.position)||!C(t.position.values))throw new x("geometry.attributes.position.values is required.");if(!C(t.normal)||!C(t.normal.values))throw new x("geometry.attributes.normal.values is required.");if(!C(t.st)||!C(t.st.values))throw new x("geometry.attributes.st.values is required.");if(!C(n))throw new x("geometry.indices is required.");if(n.length<2||n.length%3!==0)throw new x("geometry.indices length must be greater than 0 and be a multiple of 3.");if(e.primitiveType!==xf.TRIANGLES)throw new x("geometry.primitiveType must be PrimitiveType.TRIANGLES.");const i=e.attributes.position.values,o=e.attributes.normal.values,r=e.attributes.st.values,s=e.attributes.position.values.length/3,a=n.length,c=new Array(3*s);let l,u,h,d;for(l=0;l<c.length;l++)c[l]=0;for(l=0;l<a;l+=3){const e=n[l],t=n[l+1],o=n[l+2];u=3*e,h=3*t,d=3*o;const s=2*e,a=2*t,f=2*o,p=i[u],m=i[u+1],_=i[u+2],g=r[s],y=r[s+1],v=r[a+1]-y,b=r[f+1]-y,A=1/((r[a]-g)*b-(r[f]-g)*v),w=(b*(i[h]-p)-v*(i[d]-p))*A,T=(b*(i[h+1]-m)-v*(i[d+1]-m))*A,C=(b*(i[h+2]-_)-v*(i[d+2]-_))*A;c[u]+=w,c[u+1]+=T,c[u+2]+=C,c[h]+=w,c[h+1]+=T,c[h+2]+=C,c[d]+=w,c[d+1]+=T,c[d+2]+=C}const f=new Float32Array(3*s),p=new Float32Array(3*s);for(l=0;l<s;l++){u=3*l,h=u+1,d=u+2;const e=K.fromArray(o,u,a_),t=K.fromArray(c,u,l_),n=K.dot(e,t);K.multiplyByScalar(e,n,c_),K.normalize(K.subtract(t,c_,t),t),f[u]=t.x,f[h]=t.y,f[d]=t.z,K.normalize(K.cross(e,t,t),t),p[u]=t.x,p[h]=t.y,p[d]=t.z}return e.attributes.tangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:f}),e.attributes.bitangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:p}),e};const u_=new ro,h_=new K,d_=new K,f_=new K;let p_=new ro;function m_(e){if(C(e.indices))return e;const t=zf.computeNumberOfVertices(e);if(t<3)throw new x("The number of vertices must be at least three.");if(t%3!==0)throw new x("The number of vertices must be a multiple of three.");const n=fd.createTypedArray(t,t);for(let i=0;i<t;++i)n[i]=i;return e.indices=n,e}function __(e){const t=zf.computeNumberOfVertices(e);if(t<3)throw new x("The number of vertices must be at least three.");const n=fd.createTypedArray(t,3*(t-2));n[0]=1,n[1]=0,n[2]=2;let i=3;for(let o=3;o<t;++o)n[i++]=o-1,n[i++]=0,n[i++]=o;return e.indices=n,e.primitiveType=xf.TRIANGLES,e}function g_(e){const t=zf.computeNumberOfVertices(e);if(t<3)throw new x("The number of vertices must be at least 3.");const n=fd.createTypedArray(t,3*(t-2));n[0]=0,n[1]=1,n[2]=2,t>3&&(n[3]=0,n[4]=2,n[5]=3);let i=6;for(let o=3;o<t-1;o+=2)n[i++]=o,n[i++]=o-1,n[i++]=o+1,o+2<t&&(n[i++]=o,n[i++]=o+1,n[i++]=o+2);return e.indices=n,e.primitiveType=xf.TRIANGLES,e}function y_(e){if(C(e.indices))return e;const t=zf.computeNumberOfVertices(e);if(t<2)throw new x("The number of vertices must be at least two.");if(t%2!==0)throw new x("The number of vertices must be a multiple of 2.");const n=fd.createTypedArray(t,t);for(let i=0;i<t;++i)n[i]=i;return e.indices=n,e}function v_(e){const t=zf.computeNumberOfVertices(e);if(t<2)throw new x("The number of vertices must be at least two.");const n=fd.createTypedArray(t,2*(t-1));n[0]=0,n[1]=1;let i=2;for(let o=2;o<t;++o)n[i++]=o-1,n[i++]=o;return e.indices=n,e.primitiveType=xf.LINES,e}function b_(e){const t=zf.computeNumberOfVertices(e);if(t<2)throw new x("The number of vertices must be at least two.");const n=fd.createTypedArray(t,2*t);n[0]=0,n[1]=1;let i=2;for(let o=2;o<t;++o)n[i++]=o-1,n[i++]=o;return n[i++]=t-1,n[i]=0,e.indices=n,e.primitiveType=xf.LINES,e}function A_(e){switch(e.primitiveType){case xf.TRIANGLE_FAN:return __(e);case xf.TRIANGLE_STRIP:return g_(e);case xf.TRIANGLES:return m_(e);case xf.LINE_STRIP:return v_(e);case xf.LINE_LOOP:return b_(e);case xf.LINES:return y_(e)}return e}function w_(e,t){Math.abs(e.y)<z.EPSILON6&&(e.y=t?-z.EPSILON6:z.EPSILON6)}function T_(e,t,n){if(0!==e.y&&0!==t.y&&0!==n.y)return w_(e,e.y<0),w_(t,t.y<0),void w_(n,n.y<0);const i=Math.abs(e.y),o=Math.abs(t.y),r=Math.abs(n.y);let s;s=i>o?i>r?z.sign(e.y):z.sign(n.y):o>r?z.sign(t.y):z.sign(n.y);const a=s<0;w_(e,a),w_(t,a),w_(n,a)}km.compressVertices=function(e){if(!C(e))throw new x("geometry is required.");const t=e.attributes.extrudeDirection;let n,i;if(C(t)){const o=t.values;i=o.length/3;const r=new Float32Array(2*i);let s=0;for(n=0;n<i;++n)K.fromArray(o,3*n,h_),K.equals(h_,K.ZERO)?s+=2:(p_=wh.octEncodeInRange(h_,65535,p_),r[s++]=p_.x,r[s++]=p_.y);return e.attributes.compressedAttributes=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:r}),delete e.attributes.extrudeDirection,e}const o=e.attributes.normal,r=e.attributes.st,s=C(o),a=C(r);if(!s&&!a)return e;const c=e.attributes.tangent,l=e.attributes.bitangent,u=C(c),h=C(l);let d,f,p,m;s&&(d=o.values),a&&(f=r.values),u&&(p=c.values),h&&(m=l.values);const _=s?d.length:f.length,g=s?3:2;i=_/g;let y=i,v=a&&s?2:1;v+=u||h?1:0,y*=v;const b=new Float32Array(y);let A=0;for(n=0;n<i;++n){a&&(ro.fromArray(f,2*n,u_),b[A++]=wh.compressTextureCoordinates(u_));const e=3*n;s&&C(p)&&C(m)?(K.fromArray(d,e,h_),K.fromArray(p,e,d_),K.fromArray(m,e,f_),wh.octPack(h_,d_,f_,u_),b[A++]=u_.x,b[A++]=u_.y):(s&&(K.fromArray(d,e,h_),b[A++]=wh.octEncodeFloat(h_)),u&&(K.fromArray(p,e,h_),b[A++]=wh.octEncodeFloat(h_)),h&&(K.fromArray(m,e,h_),b[A++]=wh.octEncodeFloat(h_)))}return e.attributes.compressedAttributes=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:v,values:b}),s&&delete e.attributes.normal,a&&delete e.attributes.st,h&&delete e.attributes.bitangent,u&&delete e.attributes.tangent,e};const C_=new K;function E_(e,t,n,i){K.add(e,K.multiplyByScalar(K.subtract(t,e,C_),e.y/(e.y-t.y),C_),n),K.clone(n,i),w_(n,!0),w_(i,!1)}const x_=new K,S_=new K,I_=new K,O_=new K,D_={positions:new Array(7),indices:new Array(9)};function P_(e,t,n){if(e.x>=0||t.x>=0||n.x>=0)return;T_(e,t,n);const i=e.y<0,o=t.y<0,r=n.y<0;let s=0;s+=i?1:0,s+=o?1:0,s+=r?1:0;const a=D_.indices;1===s?(a[1]=3,a[2]=4,a[5]=6,a[7]=6,a[8]=5,i?(E_(e,t,x_,I_),E_(e,n,S_,O_),a[0]=0,a[3]=1,a[4]=2,a[6]=1):o?(E_(t,n,x_,I_),E_(t,e,S_,O_),a[0]=1,a[3]=2,a[4]=0,a[6]=2):r&&(E_(n,e,x_,I_),E_(n,t,S_,O_),a[0]=2,a[3]=0,a[4]=1,a[6]=0)):2===s&&(a[2]=4,a[4]=4,a[5]=3,a[7]=5,a[8]=6,i?o?r||(E_(n,e,x_,I_),E_(n,t,S_,O_),a[0]=0,a[1]=1,a[3]=0,a[6]=2):(E_(t,n,x_,I_),E_(t,e,S_,O_),a[0]=2,a[1]=0,a[3]=2,a[6]=1):(E_(e,t,x_,I_),E_(e,n,S_,O_),a[0]=1,a[1]=2,a[3]=1,a[6]=0));const c=D_.positions;return c[0]=e,c[1]=t,c[2]=n,c.length=3,1!==s&&2!==s||(c[3]=x_,c[4]=S_,c[5]=I_,c[6]=O_,c.length=7),D_}function R_(e,t){const n=e.attributes;if(0===n.position.values.length)return;for(const o in n)if(n.hasOwnProperty(o)&&C(n[o])&&C(n[o].values)){const e=n[o];e.values=ih.createTypedArray(e.componentDatatype,e.values)}const i=zf.computeNumberOfVertices(e);return e.indices=fd.createTypedArray(i,e.indices),t&&(e.boundingSphere=nn.fromVertices(n.position.values)),e}function L_(e){const t=e.attributes,n={};for(const i in t)if(t.hasOwnProperty(i)&&C(t[i])&&C(t[i].values)){const e=t[i];n[i]=new Uf({componentDatatype:e.componentDatatype,componentsPerAttribute:e.componentsPerAttribute,normalize:e.normalize,values:[]})}return new zf({attributes:n,indices:[],primitiveType:e.primitiveType})}function M_(e,t,n){const i=C(e.geometry.boundingSphere);t=R_(t,i),n=R_(n,i),C(n)&&!C(t)?e.geometry=n:!C(n)&&C(t)?e.geometry=t:(e.westHemisphereGeometry=t,e.eastHemisphereGeometry=n,e.geometry=void 0)}function B_(e,t){const n=new e,i=new e,o=new e;return function(r,s,a,c,l,u,h,d){const f=e.fromArray(l,r*t,n),p=e.fromArray(l,s*t,i),m=e.fromArray(l,a*t,o);e.multiplyByScalar(f,c.x,f),e.multiplyByScalar(p,c.y,p),e.multiplyByScalar(m,c.z,m);const _=e.add(f,p,f);e.add(_,m,_),d&&e.normalize(_,_),e.pack(_,u,h*t)}}const N_=B_(Xe,4),F_=B_(K,3),z_=B_(ro,2),k_=function(e,t,n,i,o,r,s){const a=o[e]*i.x,c=o[t]*i.y,l=o[n]*i.z;r[s]=a+c+l>z.EPSILON6?1:0},U_=new K,V_=new K,H_=new K,G_=new K;function W_(e,t,n,i,o,r,s,a,c,l,u,h,d,f,p,m){if(!C(r)&&!C(s)&&!C(a)&&!C(c)&&!C(l)&&0===f)return;const _=K.fromArray(o,3*e,U_),g=K.fromArray(o,3*t,V_),y=K.fromArray(o,3*n,H_),v=Rm(i,_,g,y,G_);if(C(v)){if(C(r)&&F_(e,t,n,v,r,h.normal.values,m,!0),C(l)){const i=K.fromArray(l,3*e,U_),o=K.fromArray(l,3*t,V_),r=K.fromArray(l,3*n,H_);let s;K.multiplyByScalar(i,v.x,i),K.multiplyByScalar(o,v.y,o),K.multiplyByScalar(r,v.z,r),K.equals(i,K.ZERO)&&K.equals(o,K.ZERO)&&K.equals(r,K.ZERO)?(s=U_,s.x=0,s.y=0,s.z=0):(s=K.add(i,o,i),K.add(s,r,s),K.normalize(s,s)),K.pack(s,h.extrudeDirection.values,3*m)}if(C(u)&&k_(e,t,n,v,u,h.applyOffset.values,m),C(s)&&F_(e,t,n,v,s,h.tangent.values,m,!0),C(a)&&F_(e,t,n,v,a,h.bitangent.values,m,!0),C(c)&&z_(e,t,n,v,c,h.st.values,m),f>0)for(let i=0;i<f;i++){const o=d[i];q_(e,t,n,v,m,p[o],h[o])}}}function q_(e,t,n,i,o,r,s){const a=r.componentsPerAttribute,c=r.values,l=s.values;switch(a){case 4:N_(e,t,n,i,c,l,o,!1);break;case 3:F_(e,t,n,i,c,l,o,!1);break;case 2:z_(e,t,n,i,c,l,o,!1);break;default:l[o]=c[e]*i.x+c[t]*i.y+c[n]*i.z}}function j_(e,t,n,i,o,r){const s=e.position.values.length/3;if(-1!==o){const a=i[o],c=n[a];return-1===c?(n[a]=s,e.position.values.push(r.x,r.y,r.z),t.push(s),s):(t.push(c),c)}return e.position.values.push(r.x,r.y,r.z),t.push(s),s}const Y_={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function K_(e){const t=e.geometry,n=t.attributes,i=n.position.values,o=C(n.normal)?n.normal.values:void 0,r=C(n.bitangent)?n.bitangent.values:void 0,s=C(n.tangent)?n.tangent.values:void 0,a=C(n.st)?n.st.values:void 0,c=C(n.extrudeDirection)?n.extrudeDirection.values:void 0,l=C(n.applyOffset)?n.applyOffset.values:void 0,u=t.indices,h=[];for(const T in n)n.hasOwnProperty(T)&&!Y_[T]&&C(n[T])&&h.push(T);const d=h.length,f=L_(t),p=L_(t);let m,_,g,y,v;const b=[];b.length=i.length/3;const A=[];for(A.length=i.length/3,v=0;v<b.length;++v)b[v]=-1,A[v]=-1;const w=u.length;for(v=0;v<w;v+=3){const e=u[v],t=u[v+1],w=u[v+2];let T=K.fromArray(i,3*e),E=K.fromArray(i,3*t),x=K.fromArray(i,3*w);const S=P_(T,E,x);if(C(S)&&S.positions.length>3){const T=S.positions,C=S.indices,E=C.length;for(let x=0;x<E;++x){const E=C[x],S=T[E];S.y<0?(m=p.attributes,_=p.indices,g=b):(m=f.attributes,_=f.indices,g=A),y=j_(m,_,g,u,E<3?v+E:-1,S),W_(e,t,w,S,i,o,s,r,a,c,l,m,h,d,n,y)}}else C(S)&&(T=S.positions[0],E=S.positions[1],x=S.positions[2]),T.y<0?(m=p.attributes,_=p.indices,g=b):(m=f.attributes,_=f.indices,g=A),y=j_(m,_,g,u,v,T),W_(e,t,w,T,i,o,s,r,a,c,l,m,h,d,n,y),y=j_(m,_,g,u,v+1,E),W_(e,t,w,E,i,o,s,r,a,c,l,m,h,d,n,y),y=j_(m,_,g,u,v+2,x),W_(e,t,w,x,i,o,s,r,a,c,l,m,h,d,n,y)}M_(e,p,f)}const X_=Gs.fromPointNormal(K.ZERO,K.UNIT_Y),Q_=new K,J_=new K;function Z_(e,t,n,i,o,r,s){if(!C(s))return;const a=K.fromArray(i,3*e,U_);K.equalsEpsilon(a,n,z.EPSILON10)?r.applyOffset.values[o]=s[e]:r.applyOffset.values[o]=s[t]}function $_(e){const t=e.geometry,n=t.attributes,i=n.position.values,o=C(n.applyOffset)?n.applyOffset.values:void 0,r=t.indices,s=L_(t),a=L_(t);let c;const l=r.length,u=[];u.length=i.length/3;const h=[];for(h.length=i.length/3,c=0;c<u.length;++c)u[c]=-1,h[c]=-1;for(c=0;c<l;c+=2){const e=r[c],t=r[c+1],n=K.fromArray(i,3*e,U_),l=K.fromArray(i,3*t,V_);let d;Math.abs(n.y)<z.EPSILON6&&(n.y<0?n.y=-z.EPSILON6:n.y=z.EPSILON6),Math.abs(l.y)<z.EPSILON6&&(l.y<0?l.y=-z.EPSILON6:l.y=z.EPSILON6);let f=s.attributes,p=s.indices,m=h,_=a.attributes,g=a.indices,y=u;const v=Ns.lineSegmentPlane(n,l,X_,H_);if(C(v)){const b=K.multiplyByScalar(K.UNIT_Y,5*z.EPSILON9,Q_);n.y<0&&(K.negate(b,b),f=a.attributes,p=a.indices,m=u,_=s.attributes,g=s.indices,y=h);const A=K.add(v,b,J_);d=j_(f,p,m,r,c,n),Z_(e,t,n,i,d,f,o),d=j_(f,p,m,r,-1,A),Z_(e,t,A,i,d,f,o),K.negate(b,b),K.add(v,b,A),d=j_(_,g,y,r,-1,A),Z_(e,t,A,i,d,_,o),d=j_(_,g,y,r,c+1,l),Z_(e,t,l,i,d,_,o)}else{let f,p,m;n.y<0?(f=a.attributes,p=a.indices,m=u):(f=s.attributes,p=s.indices,m=h),d=j_(f,p,m,r,c,n),Z_(e,t,n,i,d,f,o),d=j_(f,p,m,r,c+1,l),Z_(e,t,l,i,d,f,o)}}M_(e,a,s)}const eg=new ro,tg=new ro,ng=new K,ig=new K,og=new K,rg=new K,sg=new K,ag=new K,cg=new Xe;function lg(e){const t=e.attributes,n=t.position.values,i=t.prevPosition.values,o=t.nextPosition.values,r=n.length;for(let s=0;s<r;s+=3){const e=K.unpack(n,s,ng);if(e.x>0)continue;const t=K.unpack(i,s,ig);(e.y<0&&t.y>0||e.y>0&&t.y<0)&&(s-3>0?(i[s]=n[s-3],i[s+1]=n[s-2],i[s+2]=n[s-1]):K.pack(e,i,s));const a=K.unpack(o,s,og);(e.y<0&&a.y>0||e.y>0&&a.y<0)&&(s+3<r?(o[s]=n[s+3],o[s+1]=n[s+4],o[s+2]=n[s+5]):K.pack(e,o,s))}}const ug=5*z.EPSILON9,hg=z.EPSILON6;function dg(e){const t=e.geometry,n=t.attributes,i=n.position.values,o=n.prevPosition.values,r=n.nextPosition.values,s=n.expandAndWidth.values,a=C(n.st)?n.st.values:void 0,c=C(n.color)?n.color.values:void 0,l=L_(t),u=L_(t);let h,d,f,p=!1;const m=i.length/3;for(h=0;h<m;h+=4){const e=h,t=h+2,n=K.fromArray(i,3*e,ng),m=K.fromArray(i,3*t,ig);if(Math.abs(n.y)<hg)for(n.y=hg*(m.y<0?-1:1),i[3*h+1]=n.y,i[3*(h+1)+1]=n.y,d=3*e;d<3*e+12;d+=3)o[d]=i[3*h],o[d+1]=i[3*h+1],o[d+2]=i[3*h+2];if(Math.abs(m.y)<hg)for(m.y=hg*(n.y<0?-1:1),i[3*(h+2)+1]=m.y,i[3*(h+3)+1]=m.y,d=3*e;d<3*e+12;d+=3)r[d]=i[3*(h+2)],r[d+1]=i[3*(h+2)+1],r[d+2]=i[3*(h+2)+2];let _=l.attributes,g=l.indices,y=u.attributes,v=u.indices;const b=Ns.lineSegmentPlane(n,m,X_,rg);if(C(b)){p=!0;const i=K.multiplyByScalar(K.UNIT_Y,ug,sg);n.y<0&&(K.negate(i,i),_=u.attributes,g=u.indices,y=l.attributes,v=l.indices);const A=K.add(b,i,ag);_.position.values.push(n.x,n.y,n.z,n.x,n.y,n.z),_.position.values.push(A.x,A.y,A.z),_.position.values.push(A.x,A.y,A.z),_.prevPosition.values.push(o[3*e],o[3*e+1],o[3*e+2]),_.prevPosition.values.push(o[3*e+3],o[3*e+4],o[3*e+5]),_.prevPosition.values.push(n.x,n.y,n.z,n.x,n.y,n.z),_.nextPosition.values.push(A.x,A.y,A.z),_.nextPosition.values.push(A.x,A.y,A.z),_.nextPosition.values.push(A.x,A.y,A.z),_.nextPosition.values.push(A.x,A.y,A.z),K.negate(i,i),K.add(b,i,A),y.position.values.push(A.x,A.y,A.z),y.position.values.push(A.x,A.y,A.z),y.position.values.push(m.x,m.y,m.z,m.x,m.y,m.z),y.prevPosition.values.push(A.x,A.y,A.z),y.prevPosition.values.push(A.x,A.y,A.z),y.prevPosition.values.push(A.x,A.y,A.z),y.prevPosition.values.push(A.x,A.y,A.z),y.nextPosition.values.push(m.x,m.y,m.z,m.x,m.y,m.z),y.nextPosition.values.push(r[3*t],r[3*t+1],r[3*t+2]),y.nextPosition.values.push(r[3*t+3],r[3*t+4],r[3*t+5]);const w=ro.fromArray(s,2*e,eg),T=Math.abs(w.y);_.expandAndWidth.values.push(-1,T,1,T),_.expandAndWidth.values.push(-1,-T,1,-T),y.expandAndWidth.values.push(-1,T,1,T),y.expandAndWidth.values.push(-1,-T,1,-T);let E=K.magnitudeSquared(K.subtract(b,n,og));if(E/=K.magnitudeSquared(K.subtract(m,n,og)),C(c)){const n=Xe.fromArray(c,4*e,cg),i=Xe.fromArray(c,4*t,cg),o=z.lerp(n.x,i.x,E),r=z.lerp(n.y,i.y,E),s=z.lerp(n.z,i.z,E),a=z.lerp(n.w,i.w,E);for(d=4*e;d<4*e+8;++d)_.color.values.push(c[d]);for(_.color.values.push(o,r,s,a),_.color.values.push(o,r,s,a),y.color.values.push(o,r,s,a),y.color.values.push(o,r,s,a),d=4*t;d<4*t+8;++d)y.color.values.push(c[d])}if(C(a)){const n=ro.fromArray(a,2*e,eg),i=ro.fromArray(a,2*(h+3),tg),o=z.lerp(n.x,i.x,E);for(d=2*e;d<2*e+4;++d)_.st.values.push(a[d]);for(_.st.values.push(o,n.y),_.st.values.push(o,i.y),y.st.values.push(o,n.y),y.st.values.push(o,i.y),d=2*t;d<2*t+4;++d)y.st.values.push(a[d])}f=_.position.values.length/3-4,g.push(f,f+2,f+1),g.push(f+1,f+2,f+3),f=y.position.values.length/3-4,v.push(f,f+2,f+1),v.push(f+1,f+2,f+3)}else{let e,t;for(n.y<0?(e=u.attributes,t=u.indices):(e=l.attributes,t=l.indices),e.position.values.push(n.x,n.y,n.z),e.position.values.push(n.x,n.y,n.z),e.position.values.push(m.x,m.y,m.z),e.position.values.push(m.x,m.y,m.z),d=3*h;d<3*h+12;++d)e.prevPosition.values.push(o[d]),e.nextPosition.values.push(r[d]);for(d=2*h;d<2*h+8;++d)e.expandAndWidth.values.push(s[d]),C(a)&&e.st.values.push(a[d]);if(C(c))for(d=4*h;d<4*h+16;++d)e.color.values.push(c[d]);f=e.position.values.length/3-4,t.push(f,f+2,f+1),t.push(f+1,f+2,f+3)}}p&&(lg(u),lg(l)),M_(e,u,l)}km.splitLongitude=function(e){if(!C(e))throw new x("instance is required.");const t=e.geometry,n=t.boundingSphere;if(C(n)){const t=n.center.x-n.radius;if(t>0||nn.intersectPlane(n,Gs.ORIGIN_ZX_PLANE)!==Ae.INTERSECTING)return e}if(t.geometryType!==Cf.NONE)switch(t.geometryType){case Cf.POLYLINES:dg(e);break;case Cf.TRIANGLES:K_(e);break;case Cf.LINES:$_(e);break}else A_(t),t.primitiveType===xf.TRIANGLES?K_(e):t.primitiveType===xf.LINES&&$_(e);return e};var fg=km;const pg=new K,mg=new K,_g=new K,gg=new K,yg=new ro,vg=new ke,bg=new ke,Ag=new il,wg=new K,Tg=new K,Cg=new K,Eg=new se,xg=new K,Sg=new ro,Ig=new ro;function Og(e,t,n){const i=t.vertexFormat,o=t.center,r=t.semiMajorAxis,s=t.semiMinorAxis,a=t.ellipsoid,c=t.stRotation,l=n?e.length/3*2:e.length/3,u=t.shadowVolume,h=i.st?new Float32Array(2*l):void 0,d=i.normal?new Float32Array(3*l):void 0,f=i.tangent?new Float32Array(3*l):void 0,p=i.bitangent?new Float32Array(3*l):void 0,m=u?new Float32Array(3*l):void 0;let _=0,g=wg,y=Tg,v=Cg;const b=new ve(a),A=b.project(a.cartesianToCartographic(o,Eg),xg),w=a.scaleToGeodeticSurface(o,pg);a.geodeticSurfaceNormal(w,w);let T=vg,E=bg;if(0!==c){let e=il.fromAxisAngle(w,c,Ag);T=ke.fromQuaternion(e,T),e=il.fromAxisAngle(w,-c,Ag),E=ke.fromQuaternion(e,E)}else T=ke.clone(ke.IDENTITY,T),E=ke.clone(ke.IDENTITY,E);const x=ro.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Sg),S=ro.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Ig);let I=e.length;const O=n?I:0,D=O/3*2;for(let C=0;C<I;C+=3){const t=C+1,o=C+2,c=K.fromArray(e,C,pg);if(i.st){const e=ke.multiplyByVector(T,c,mg),t=b.project(a.cartesianToCartographic(e,Eg),_g);K.subtract(t,A,t),yg.x=(t.x+r)/(2*r),yg.y=(t.y+s)/(2*s),x.x=Math.min(yg.x,x.x),x.y=Math.min(yg.y,x.y),S.x=Math.max(yg.x,S.x),S.y=Math.max(yg.y,S.y),n&&(h[_+D]=yg.x,h[_+1+D]=yg.y),h[_++]=yg.x,h[_++]=yg.y}(i.normal||i.tangent||i.bitangent||u)&&(g=a.geodeticSurfaceNormal(c,g),u&&(m[C+O]=-g.x,m[t+O]=-g.y,m[o+O]=-g.z),(i.normal||i.tangent||i.bitangent)&&((i.tangent||i.bitangent)&&(y=K.normalize(K.cross(K.UNIT_Z,g,y),y),ke.multiplyByVector(E,y,y)),i.normal&&(d[C]=g.x,d[t]=g.y,d[o]=g.z,n&&(d[C+O]=-g.x,d[t+O]=-g.y,d[o+O]=-g.z)),i.tangent&&(f[C]=y.x,f[t]=y.y,f[o]=y.z,n&&(f[C+O]=-y.x,f[t+O]=-y.y,f[o+O]=-y.z)),i.bitangent&&(v=K.normalize(K.cross(g,y,v),v),p[C]=v.x,p[t]=v.y,p[o]=v.z,n&&(p[C+O]=v.x,p[t+O]=v.y,p[o+O]=v.z))))}if(i.st){I=h.length;for(let e=0;e<I;e+=2)h[e]=(h[e]-x.x)/(S.x-x.x),h[e+1]=(h[e+1]-x.y)/(S.y-x.y)}const P=new Hf;if(i.position){const i=Em.raisePositionsToHeight(e,t,n);P.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:i})}if(i.st&&(P.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:h})),i.normal&&(P.normal=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:d})),i.tangent&&(P.tangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:f})),i.bitangent&&(P.bitangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:p})),u&&(P.extrudeDirection=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:m})),n&&C(t.offsetAttribute)){let e=new Uint8Array(l);if(t.offsetAttribute===Wf.TOP)e=wf(e,1,0,l/2);else{const n=t.offsetAttribute===Wf.NONE?0:1;e=wf(e,n)}P.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:e})}return P}function Dg(e){const t=new Array(e*(e+1)*12-6);let n,i,o,r,s,a=0;for(n=0,o=1,r=0;r<3;r++)t[a++]=o++,t[a++]=n,t[a++]=o;for(r=2;r<e+1;++r){for(o=r*(r+1)-1,n=(r-1)*r-1,t[a++]=o++,t[a++]=n,t[a++]=o,i=2*r,s=0;s<i-1;++s)t[a++]=o,t[a++]=n++,t[a++]=n,t[a++]=o++,t[a++]=n,t[a++]=o;t[a++]=o++,t[a++]=n,t[a++]=o}for(i=2*e,++o,++n,r=0;r<i-1;++r)t[a++]=o,t[a++]=n++,t[a++]=n,t[a++]=o++,t[a++]=n,t[a++]=o;for(t[a++]=o,t[a++]=n++,t[a++]=n,t[a++]=o++,t[a++]=n++,t[a++]=n,++n,r=e-1;r>1;--r){for(t[a++]=n++,t[a++]=n,t[a++]=o,i=2*r,s=0;s<i-1;++s)t[a++]=o,t[a++]=n++,t[a++]=n,t[a++]=o++,t[a++]=n,t[a++]=o;t[a++]=n++,t[a++]=n++,t[a++]=o++}for(r=0;r<3;r++)t[a++]=n++,t[a++]=n,t[a++]=o;return t}let Pg=new K;function Rg(e){const t=e.center;Pg=K.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,Pg),e.height,Pg),Pg=K.add(t,Pg,Pg);const n=new nn(Pg,e.semiMajorAxis),i=Em.computeEllipsePositions(e,!0,!1),o=i.positions,r=i.numPts,s=Og(o,e,!1);let a=Dg(r);return a=fd.createTypedArray(o.length/3,a),{boundingSphere:n,attributes:s,indices:a}}function Lg(e,t){const n=t.vertexFormat,i=t.center,o=t.semiMajorAxis,r=t.semiMinorAxis,s=t.ellipsoid,a=t.height,c=t.extrudedHeight,l=t.stRotation,u=e.length/3*2,h=new Float64Array(3*u),d=n.st?new Float32Array(2*u):void 0,f=n.normal?new Float32Array(3*u):void 0,p=n.tangent?new Float32Array(3*u):void 0,m=n.bitangent?new Float32Array(3*u):void 0,_=t.shadowVolume,g=_?new Float32Array(3*u):void 0;let y=0,v=wg,b=Tg,A=Cg;const w=new ve(s),T=w.project(s.cartesianToCartographic(i,Eg),xg),E=s.scaleToGeodeticSurface(i,pg);s.geodeticSurfaceNormal(E,E);const x=il.fromAxisAngle(E,l,Ag),S=ke.fromQuaternion(x,vg),I=ro.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Sg),O=ro.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Ig);let D=e.length;const P=D/3*2;for(let C=0;C<D;C+=3){const t=C+1,i=C+2;let l,u=K.fromArray(e,C,pg);if(n.st){const e=ke.multiplyByVector(S,u,mg),t=w.project(s.cartesianToCartographic(e,Eg),_g);K.subtract(t,T,t),yg.x=(t.x+o)/(2*o),yg.y=(t.y+r)/(2*r),I.x=Math.min(yg.x,I.x),I.y=Math.min(yg.y,I.y),O.x=Math.max(yg.x,O.x),O.y=Math.max(yg.y,O.y),d[y+P]=yg.x,d[y+1+P]=yg.y,d[y++]=yg.x,d[y++]=yg.y}u=s.scaleToGeodeticSurface(u,u),l=K.clone(u,mg),v=s.geodeticSurfaceNormal(u,v),_&&(g[C+D]=-v.x,g[t+D]=-v.y,g[i+D]=-v.z);let E=K.multiplyByScalar(v,a,gg);if(u=K.add(u,E,u),E=K.multiplyByScalar(v,c,E),l=K.add(l,E,l),n.position&&(h[C+D]=l.x,h[t+D]=l.y,h[i+D]=l.z,h[C]=u.x,h[t]=u.y,h[i]=u.z),n.normal||n.tangent||n.bitangent){A=K.clone(v,A);const o=K.fromArray(e,(C+3)%D,gg);K.subtract(o,u,o);const r=K.subtract(l,u,_g);v=K.normalize(K.cross(r,o,v),v),n.normal&&(f[C]=v.x,f[t]=v.y,f[i]=v.z,f[C+D]=v.x,f[t+D]=v.y,f[i+D]=v.z),n.tangent&&(b=K.normalize(K.cross(A,v,b),b),p[C]=b.x,p[t]=b.y,p[i]=b.z,p[C+D]=b.x,p[C+1+D]=b.y,p[C+2+D]=b.z),n.bitangent&&(m[C]=A.x,m[t]=A.y,m[i]=A.z,m[C+D]=A.x,m[t+D]=A.y,m[i+D]=A.z)}}if(n.st){D=d.length;for(let e=0;e<D;e+=2)d[e]=(d[e]-I.x)/(O.x-I.x),d[e+1]=(d[e+1]-I.y)/(O.y-I.y)}const R=new Hf;if(n.position&&(R.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:h})),n.st&&(R.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:d})),n.normal&&(R.normal=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:f})),n.tangent&&(R.tangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:p})),n.bitangent&&(R.bitangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:m})),_&&(R.extrudeDirection=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:g})),C(t.offsetAttribute)){let e=new Uint8Array(u);if(t.offsetAttribute===Wf.TOP)e=wf(e,1,0,u/2);else{const n=t.offsetAttribute===Wf.NONE?0:1;e=wf(e,n)}R.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:e})}return R}function Mg(e){const t=e.length/3,n=fd.createTypedArray(t,6*t);let i=0;for(let o=0;o<t;o++){const e=o,r=o+t,s=(e+1)%t,a=s+t;n[i++]=e,n[i++]=r,n[i++]=s,n[i++]=s,n[i++]=r,n[i++]=a}return n}const Bg=new nn,Ng=new nn;function Fg(e){const t=e.center,n=e.ellipsoid,i=e.semiMajorAxis;let o=K.multiplyByScalar(n.geodeticSurfaceNormal(t,pg),e.height,pg);Bg.center=K.add(t,o,Bg.center),Bg.radius=i,o=K.multiplyByScalar(n.geodeticSurfaceNormal(t,o),e.extrudedHeight,o),Ng.center=K.add(t,o,Ng.center),Ng.radius=i;const r=Em.computeEllipsePositions(e,!0,!0),s=r.positions,a=r.numPts,c=r.outerPositions,l=nn.union(Bg,Ng),u=Og(s,e,!0);let h=Dg(a);const d=h.length;h.length=2*d;const f=s.length/3;for(let b=0;b<d;b+=3)h[b+d]=h[b+2]+f,h[b+1+d]=h[b+1]+f,h[b+2+d]=h[b]+f;const p=fd.createTypedArray(2*f/3,h),m=new zf({attributes:u,indices:p,primitiveType:xf.TRIANGLES}),_=Lg(c,e);h=Mg(c);const g=fd.createTypedArray(2*c.length/3,h),y=new zf({attributes:_,indices:g,primitiveType:xf.TRIANGLES}),v=fg.combineInstances([new Sm({geometry:m}),new Sm({geometry:y})]);return{boundingSphere:l,attributes:v[0].attributes,indices:v[0].indices}}function zg(e,t,n,i,o,r,s){const a=Em.computeEllipsePositions({center:e,semiMajorAxis:t,semiMinorAxis:n,rotation:i,granularity:o},!1,!0),c=a.outerPositions,l=c.length/3,u=new Array(l);for(let d=0;d<l;++d)u[d]=K.fromArray(c,3*d);const h=_t.fromCartesianArray(u,r,s);return h.width>z.PI&&(h.north=h.north>0?z.PI_OVER_TWO-z.EPSILON7:h.north,h.south=h.south<0?z.EPSILON7-z.PI_OVER_TWO:h.south,h.east=z.PI,h.west=-z.PI),h}function kg(e){e=R(e,R.EMPTY_OBJECT);const t=e.center,n=R(e.ellipsoid,ge.WGS84),i=e.semiMajorAxis,o=e.semiMinorAxis,r=R(e.granularity,z.RADIANS_PER_DEGREE),s=R(e.vertexFormat,jf.DEFAULT);if(D.defined("options.center",t),D.typeOf.number("options.semiMajorAxis",i),D.typeOf.number("options.semiMinorAxis",o),i<o)throw new x("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(r<=0)throw new x("granularity must be greater than zero.");const a=R(e.height,0),c=R(e.extrudedHeight,a);this._center=K.clone(t),this._semiMajorAxis=i,this._semiMinorAxis=o,this._ellipsoid=ge.clone(n),this._rotation=R(e.rotation,0),this._stRotation=R(e.stRotation,0),this._height=Math.max(c,a),this._granularity=r,this._vertexFormat=jf.clone(s),this._extrudedHeight=Math.min(c,a),this._shadowVolume=R(e.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}kg.packedLength=K.packedLength+ge.packedLength+jf.packedLength+9,kg.pack=function(e,t,n){return D.defined("value",e),D.defined("array",t),n=R(n,0),K.pack(e._center,t,n),n+=K.packedLength,ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,jf.pack(e._vertexFormat,t,n),n+=jf.packedLength,t[n++]=e._semiMajorAxis,t[n++]=e._semiMinorAxis,t[n++]=e._rotation,t[n++]=e._stRotation,t[n++]=e._height,t[n++]=e._granularity,t[n++]=e._extrudedHeight,t[n++]=e._shadowVolume?1:0,t[n]=R(e._offsetAttribute,-1),t};const Ug=new K,Vg=new ge,Hg=new jf,Gg={center:Ug,ellipsoid:Vg,vertexFormat:Hg,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};function Wg(e){const t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];const n=Em.computeEllipsePositions({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,rotation:e._rotation,granularity:e._granularity},!1,!0),i=n.outerPositions,o=i.length/3,r=new Array(o);for(let c=0;c<o;++c)r[c]=K.fromArray(i,3*c);const s=e._ellipsoid,a=e.rectangle;return zf._textureCoordinateRotationPoints(r,t,s,a)}kg.unpack=function(e,t,n){D.defined("array",e),t=R(t,0);const i=K.unpack(e,t,Ug);t+=K.packedLength;const o=ge.unpack(e,t,Vg);t+=ge.packedLength;const r=jf.unpack(e,t,Hg);t+=jf.packedLength;const s=e[t++],a=e[t++],c=e[t++],l=e[t++],u=e[t++],h=e[t++],d=e[t++],f=1===e[t++],p=e[t];return C(n)?(n._center=K.clone(i,n._center),n._ellipsoid=ge.clone(o,n._ellipsoid),n._vertexFormat=jf.clone(r,n._vertexFormat),n._semiMajorAxis=s,n._semiMinorAxis=a,n._rotation=c,n._stRotation=l,n._height=u,n._granularity=h,n._extrudedHeight=d,n._shadowVolume=f,n._offsetAttribute=-1===p?void 0:p,n):(Gg.height=u,Gg.extrudedHeight=d,Gg.granularity=h,Gg.stRotation=l,Gg.rotation=c,Gg.semiMajorAxis=s,Gg.semiMinorAxis=a,Gg.shadowVolume=f,Gg.offsetAttribute=-1===p?void 0:p,new kg(Gg))},kg.computeRectangle=function(e,t){e=R(e,R.EMPTY_OBJECT);const n=e.center,i=R(e.ellipsoid,ge.WGS84),o=e.semiMajorAxis,r=e.semiMinorAxis,s=R(e.granularity,z.RADIANS_PER_DEGREE),a=R(e.rotation,0);if(D.defined("options.center",n),D.typeOf.number("options.semiMajorAxis",o),D.typeOf.number("options.semiMinorAxis",r),o<r)throw new x("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(s<=0)throw new x("granularity must be greater than zero.");return zg(n,o,r,a,s,i,t)},kg.createGeometry=function(e){if(e._semiMajorAxis<=0||e._semiMinorAxis<=0)return;const t=e._height,n=e._extrudedHeight,i=!z.equalsEpsilon(t,n,0,z.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);const o={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:t,granularity:e._granularity,vertexFormat:e._vertexFormat,stRotation:e._stRotation};let r;if(i)o.extrudedHeight=n,o.shadowVolume=e._shadowVolume,o.offsetAttribute=e._offsetAttribute,r=Fg(o);else if(r=Rg(o),C(e._offsetAttribute)){const t=r.attributes.position.values.length,n=new Uint8Array(t/3),i=e._offsetAttribute===Wf.NONE?0:1;wf(n,i),r.attributes.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}return new zf({attributes:r.attributes,indices:r.indices,primitiveType:xf.TRIANGLES,boundingSphere:r.boundingSphere,offsetAttribute:e._offsetAttribute})},kg.createShadowVolume=function(e,t,n){const i=e._granularity,o=e._ellipsoid,r=t(i,o),s=n(i,o);return new kg({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:o,rotation:e._rotation,stRotation:e._stRotation,granularity:i,extrudedHeight:r,height:s,vertexFormat:jf.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(kg.prototype,{rectangle:{get:function(){return C(this._rectangle)||(this._rectangle=zg(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return C(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=Wg(this)),this._textureCoordinateRotationPoints}}});var qg=kg;function jg(e){e=R(e,R.EMPTY_OBJECT);const t=e.radius;D.typeOf.number("radius",t);const n={center:e.center,semiMajorAxis:t,semiMinorAxis:t,ellipsoid:e.ellipsoid,height:e.height,extrudedHeight:e.extrudedHeight,granularity:e.granularity,vertexFormat:e.vertexFormat,stRotation:e.stRotation,shadowVolume:e.shadowVolume};this._ellipseGeometry=new qg(n),this._workerName="createCircleGeometry"}jg.packedLength=qg.packedLength,jg.pack=function(e,t,n){return D.typeOf.object("value",e),qg.pack(e._ellipseGeometry,t,n)};const Yg=new qg({center:new K,semiMajorAxis:1,semiMinorAxis:1}),Kg={center:new K,radius:void 0,ellipsoid:ge.clone(ge.UNIT_SPHERE),height:void 0,extrudedHeight:void 0,granularity:void 0,vertexFormat:new jf,stRotation:void 0,semiMajorAxis:void 0,semiMinorAxis:void 0,shadowVolume:void 0};jg.unpack=function(e,t,n){const i=qg.unpack(e,t,Yg);return Kg.center=K.clone(i._center,Kg.center),Kg.ellipsoid=ge.clone(i._ellipsoid,Kg.ellipsoid),Kg.height=i._height,Kg.extrudedHeight=i._extrudedHeight,Kg.granularity=i._granularity,Kg.vertexFormat=jf.clone(i._vertexFormat,Kg.vertexFormat),Kg.stRotation=i._stRotation,Kg.shadowVolume=i._shadowVolume,C(n)?(Kg.semiMajorAxis=i._semiMajorAxis,Kg.semiMinorAxis=i._semiMinorAxis,n._ellipseGeometry=new qg(Kg),n):(Kg.radius=i._semiMajorAxis,new jg(Kg))},jg.createGeometry=function(e){return qg.createGeometry(e._ellipseGeometry)},jg.createShadowVolume=function(e,t,n){const i=e._ellipseGeometry._granularity,o=e._ellipseGeometry._ellipsoid,r=t(i,o),s=n(i,o);return new jg({center:e._ellipseGeometry._center,radius:e._ellipseGeometry._semiMajorAxis,ellipsoid:o,stRotation:e._ellipseGeometry._stRotation,granularity:i,extrudedHeight:r,height:s,vertexFormat:jf.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(jg.prototype,{rectangle:{get:function(){return this._ellipseGeometry.rectangle}},textureCoordinateRotationPoints:{get:function(){return this._ellipseGeometry.textureCoordinateRotationPoints}}});const Xg=new K;let Qg=new K;function Jg(e){const t=e.center;Qg=K.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,Qg),e.height,Qg),Qg=K.add(t,Qg,Qg);const n=new nn(Qg,e.semiMajorAxis),i=Em.computeEllipsePositions(e,!1,!0).outerPositions,o=new Hf({position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:Em.raisePositionsToHeight(i,e,!1)})}),r=i.length/3,s=fd.createTypedArray(r,2*r);let a=0;for(let c=0;c<r;++c)s[a++]=c,s[a++]=(c+1)%r;return{boundingSphere:n,attributes:o,indices:s}}const Zg=new nn,$g=new nn;function ey(e){const t=e.center,n=e.ellipsoid,i=e.semiMajorAxis;let o=K.multiplyByScalar(n.geodeticSurfaceNormal(t,Xg),e.height,Xg);Zg.center=K.add(t,o,Zg.center),Zg.radius=i,o=K.multiplyByScalar(n.geodeticSurfaceNormal(t,o),e.extrudedHeight,o),$g.center=K.add(t,o,$g.center),$g.radius=i;let r=Em.computeEllipsePositions(e,!1,!0).outerPositions;const s=new Hf({position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:Em.raisePositionsToHeight(r,e,!0)})});r=s.position.values;const a=nn.union(Zg,$g);let c=r.length/3;if(C(e.offsetAttribute)){let t=new Uint8Array(c);if(e.offsetAttribute===Wf.TOP)t=wf(t,1,0,c/2);else{const n=e.offsetAttribute===Wf.NONE?0:1;t=wf(t,n)}s.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:t})}let l=R(e.numberOfVerticalLines,16);l=z.clamp(l,0,c/2);const u=fd.createTypedArray(c,2*c+2*l);c/=2;let h,d,f=0;for(h=0;h<c;++h)u[f++]=h,u[f++]=(h+1)%c,u[f++]=h+c,u[f++]=(h+1)%c+c;if(l>0){const e=Math.min(l,c);d=Math.round(c/e);const t=Math.min(d*l,c);for(h=0;h<t;h+=d)u[f++]=h,u[f++]=h+c}return{boundingSphere:a,attributes:s,indices:u}}function ty(e){e=R(e,R.EMPTY_OBJECT);const t=e.center,n=R(e.ellipsoid,ge.WGS84),i=e.semiMajorAxis,o=e.semiMinorAxis,r=R(e.granularity,z.RADIANS_PER_DEGREE);if(!C(t))throw new x("center is required.");if(!C(i))throw new x("semiMajorAxis is required.");if(!C(o))throw new x("semiMinorAxis is required.");if(i<o)throw new x("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(r<=0)throw new x("granularity must be greater than zero.");const s=R(e.height,0),a=R(e.extrudedHeight,s);this._center=K.clone(t),this._semiMajorAxis=i,this._semiMinorAxis=o,this._ellipsoid=ge.clone(n),this._rotation=R(e.rotation,0),this._height=Math.max(a,s),this._granularity=r,this._extrudedHeight=Math.min(a,s),this._numberOfVerticalLines=Math.max(R(e.numberOfVerticalLines,16),0),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipseOutlineGeometry"}ty.packedLength=K.packedLength+ge.packedLength+8,ty.pack=function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");return n=R(n,0),K.pack(e._center,t,n),n+=K.packedLength,ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,t[n++]=e._semiMajorAxis,t[n++]=e._semiMinorAxis,t[n++]=e._rotation,t[n++]=e._height,t[n++]=e._granularity,t[n++]=e._extrudedHeight,t[n++]=e._numberOfVerticalLines,t[n]=R(e._offsetAttribute,-1),t};const ny=new K,iy=new ge,oy={center:ny,ellipsoid:iy,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};ty.unpack=function(e,t,n){if(!C(e))throw new x("array is required");t=R(t,0);const i=K.unpack(e,t,ny);t+=K.packedLength;const o=ge.unpack(e,t,iy);t+=ge.packedLength;const r=e[t++],s=e[t++],a=e[t++],c=e[t++],l=e[t++],u=e[t++],h=e[t++],d=e[t];return C(n)?(n._center=K.clone(i,n._center),n._ellipsoid=ge.clone(o,n._ellipsoid),n._semiMajorAxis=r,n._semiMinorAxis=s,n._rotation=a,n._height=c,n._granularity=l,n._extrudedHeight=u,n._numberOfVerticalLines=h,n._offsetAttribute=-1===d?void 0:d,n):(oy.height=c,oy.extrudedHeight=u,oy.granularity=l,oy.rotation=a,oy.semiMajorAxis=r,oy.semiMinorAxis=s,oy.numberOfVerticalLines=h,oy.offsetAttribute=-1===d?void 0:d,new ty(oy))},ty.createGeometry=function(e){if(e._semiMajorAxis<=0||e._semiMinorAxis<=0)return;const t=e._height,n=e._extrudedHeight,i=!z.equalsEpsilon(t,n,0,z.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);const o={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:t,granularity:e._granularity,numberOfVerticalLines:e._numberOfVerticalLines};let r;if(i)o.extrudedHeight=n,o.offsetAttribute=e._offsetAttribute,r=ey(o);else if(r=Jg(o),C(e._offsetAttribute)){const t=r.attributes.position.values.length,n=new Uint8Array(t/3),i=e._offsetAttribute===Wf.NONE?0:1;wf(n,i),r.attributes.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}return new zf({attributes:r.attributes,indices:r.indices,primitiveType:xf.LINES,boundingSphere:r.boundingSphere,offsetAttribute:e._offsetAttribute})};var ry=ty;function sy(e){e=R(e,R.EMPTY_OBJECT);const t=e.radius;D.typeOf.number("radius",t);const n={center:e.center,semiMajorAxis:t,semiMinorAxis:t,ellipsoid:e.ellipsoid,height:e.height,extrudedHeight:e.extrudedHeight,granularity:e.granularity,numberOfVerticalLines:e.numberOfVerticalLines};this._ellipseGeometry=new ry(n),this._workerName="createCircleOutlineGeometry"}sy.packedLength=ry.packedLength,sy.pack=function(e,t,n){return D.typeOf.object("value",e),ry.pack(e._ellipseGeometry,t,n)};const ay=new ry({center:new K,semiMajorAxis:1,semiMinorAxis:1}),cy={center:new K,radius:void 0,ellipsoid:ge.clone(ge.UNIT_SPHERE),height:void 0,extrudedHeight:void 0,granularity:void 0,numberOfVerticalLines:void 0,semiMajorAxis:void 0,semiMinorAxis:void 0};sy.unpack=function(e,t,n){const i=ry.unpack(e,t,ay);return cy.center=K.clone(i._center,cy.center),cy.ellipsoid=ge.clone(i._ellipsoid,cy.ellipsoid),cy.height=i._height,cy.extrudedHeight=i._extrudedHeight,cy.granularity=i._granularity,cy.numberOfVerticalLines=i._numberOfVerticalLines,C(n)?(cy.semiMajorAxis=i._semiMajorAxis,cy.semiMinorAxis=i._semiMinorAxis,n._ellipseGeometry=new ry(cy),n):(cy.radius=i._semiMajorAxis,new sy(cy))},sy.createGeometry=function(e){return ry.createGeometry(e._ellipseGeometry)};const ly={UNBOUNDED:0,CLAMPED:1,LOOP_STOP:2};var uy=Object.freeze(ly);const hy={TICK_DEPENDENT:0,SYSTEM_CLOCK_MULTIPLIER:1,SYSTEM_CLOCK:2};var dy=Object.freeze(hy);let fy;fy="undefined"!==typeof performance&&"function"===typeof performance.now&&isFinite(performance.now())?function(){return performance.now()}:function(){return Date.now()};var py=fy;function my(e){e=R(e,R.EMPTY_OBJECT);let t=e.currentTime,n=e.startTime,i=e.stopTime;if(t=C(t)?Ea.clone(t):C(n)?Ea.clone(n):C(i)?Ea.addDays(i,-1,new Ea):Ea.now(),n=C(n)?Ea.clone(n):Ea.clone(t),i=C(i)?Ea.clone(i):Ea.addDays(n,1,new Ea),Ea.greaterThan(n,i))throw new x("startTime must come before stopTime.");this.startTime=n,this.stopTime=i,this.clockRange=R(e.clockRange,uy.UNBOUNDED),this.canAnimate=R(e.canAnimate,!0),this.onTick=new $n,this.onStop=new $n,this._currentTime=void 0,this._multiplier=void 0,this._clockStep=void 0,this._shouldAnimate=void 0,this._lastSystemTime=py(),this.currentTime=t,this.multiplier=R(e.multiplier,1),this.shouldAnimate=R(e.shouldAnimate,!1),this.clockStep=R(e.clockStep,dy.SYSTEM_CLOCK_MULTIPLIER)}Object.defineProperties(my.prototype,{currentTime:{get:function(){return this._currentTime},set:function(e){Ea.equals(this._currentTime,e)||(this._clockStep===dy.SYSTEM_CLOCK&&(this._clockStep=dy.SYSTEM_CLOCK_MULTIPLIER),this._currentTime=e)}},multiplier:{get:function(){return this._multiplier},set:function(e){this._multiplier!==e&&(this._clockStep===dy.SYSTEM_CLOCK&&(this._clockStep=dy.SYSTEM_CLOCK_MULTIPLIER),this._multiplier=e)}},clockStep:{get:function(){return this._clockStep},set:function(e){e===dy.SYSTEM_CLOCK&&(this._multiplier=1,this._shouldAnimate=!0,this._currentTime=Ea.now()),this._clockStep=e}},shouldAnimate:{get:function(){return this._shouldAnimate},set:function(e){this._shouldAnimate!==e&&(this._clockStep===dy.SYSTEM_CLOCK&&(this._clockStep=dy.SYSTEM_CLOCK_MULTIPLIER),this._shouldAnimate=e)}}}),my.prototype.tick=function(){const e=py();let t=Ea.clone(this._currentTime);if(this.canAnimate&&this._shouldAnimate){const n=this._clockStep;if(n===dy.SYSTEM_CLOCK)t=Ea.now(t);else{const i=this._multiplier;if(n===dy.TICK_DEPENDENT)t=Ea.addSeconds(t,i,t);else{const n=e-this._lastSystemTime;t=Ea.addSeconds(t,i*(n/1e3),t)}const o=this.clockRange,r=this.startTime,s=this.stopTime;if(o===uy.CLAMPED)Ea.lessThan(t,r)?t=Ea.clone(r,t):Ea.greaterThan(t,s)&&(t=Ea.clone(s,t),this.onStop.raiseEvent(this));else if(o===uy.LOOP_STOP){Ea.lessThan(t,r)&&(t=Ea.clone(r,t));while(Ea.greaterThan(t,s))t=Ea.addSeconds(r,Ea.secondsDifference(t,s),t),this.onStop.raiseEvent(this)}}}return this._currentTime=t,this._lastSystemTime=e,this.onTick.raiseEvent(this),t};var _y=my;function gy(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),6*n<1?e+6*(t-e)*n:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}function yy(e,t,n,i){this.red=R(e,1),this.green=R(t,1),this.blue=R(n,1),this.alpha=R(i,1)}let vy,by,Ay;yy.fromCartesian4=function(e,t){return D.typeOf.object("cartesian",e),C(t)?(t.red=e.x,t.green=e.y,t.blue=e.z,t.alpha=e.w,t):new yy(e.x,e.y,e.z,e.w)},yy.fromBytes=function(e,t,n,i,o){return e=yy.byteToFloat(R(e,255)),t=yy.byteToFloat(R(t,255)),n=yy.byteToFloat(R(n,255)),i=yy.byteToFloat(R(i,255)),C(o)?(o.red=e,o.green=t,o.blue=n,o.alpha=i,o):new yy(e,t,n,i)},yy.fromAlpha=function(e,t,n){return D.typeOf.object("color",e),D.typeOf.number("alpha",t),C(n)?(n.red=e.red,n.green=e.green,n.blue=e.blue,n.alpha=t,n):new yy(e.red,e.green,e.blue,t)},Oc.supportsTypedArrays()&&(vy=new ArrayBuffer(4),by=new Uint32Array(vy),Ay=new Uint8Array(vy)),yy.fromRgba=function(e,t){return by[0]=e,yy.fromBytes(Ay[0],Ay[1],Ay[2],Ay[3],t)},yy.fromHsl=function(e,t,n,i,o){e=R(e,0)%1,t=R(t,0),n=R(n,0),i=R(i,1);let r=n,s=n,a=n;if(0!==t){let i;i=n<.5?n*(1+t):n+t-n*t;const o=2*n-i;r=gy(o,i,e+1/3),s=gy(o,i,e),a=gy(o,i,e-1/3)}return C(o)?(o.red=r,o.green=s,o.blue=a,o.alpha=i,o):new yy(r,s,a,i)},yy.fromRandom=function(e,t){e=R(e,R.EMPTY_OBJECT);let n=e.red;if(!C(n)){const t=R(e.minimumRed,0),i=R(e.maximumRed,1);D.typeOf.number.lessThanOrEquals("minimumRed",t,i),n=t+z.nextRandomNumber()*(i-t)}let i=e.green;if(!C(i)){const t=R(e.minimumGreen,0),n=R(e.maximumGreen,1);D.typeOf.number.lessThanOrEquals("minimumGreen",t,n),i=t+z.nextRandomNumber()*(n-t)}let o=e.blue;if(!C(o)){const t=R(e.minimumBlue,0),n=R(e.maximumBlue,1);D.typeOf.number.lessThanOrEquals("minimumBlue",t,n),o=t+z.nextRandomNumber()*(n-t)}let r=e.alpha;if(!C(r)){const t=R(e.minimumAlpha,0),n=R(e.maximumAlpha,1);D.typeOf.number.lessThanOrEquals("minumumAlpha",t,n),r=t+z.nextRandomNumber()*(n-t)}return C(t)?(t.red=n,t.green=i,t.blue=o,t.alpha=r,t):new yy(n,i,o,r)};const wy=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,Ty=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,Cy=/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)(?:\s*,\s*([0-9.]+))?\s*\)$/i,Ey=/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+%)\s*,\s*([0-9.]+%)(?:\s*,\s*([0-9.]+))?\s*\)$/i;yy.fromCssColorString=function(e,t){D.typeOf.string("color",e),C(t)||(t=new yy),e=e.replace(/\s/g,"");const n=yy[e.toUpperCase()];if(C(n))return yy.clone(n,t),t;let i=wy.exec(e);return null!==i?(t.red=parseInt(i[1],16)/15,t.green=parseInt(i[2],16)/15,t.blue=parseInt(i[3],16)/15,t.alpha=parseInt(R(i[4],"f"),16)/15,t):(i=Ty.exec(e),null!==i?(t.red=parseInt(i[1],16)/255,t.green=parseInt(i[2],16)/255,t.blue=parseInt(i[3],16)/255,t.alpha=parseInt(R(i[4],"ff"),16)/255,t):(i=Cy.exec(e),null!==i?(t.red=parseFloat(i[1])/("%"===i[1].substr(-1)?100:255),t.green=parseFloat(i[2])/("%"===i[2].substr(-1)?100:255),t.blue=parseFloat(i[3])/("%"===i[3].substr(-1)?100:255),t.alpha=parseFloat(R(i[4],"1.0")),t):(i=Ey.exec(e),null!==i?yy.fromHsl(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,parseFloat(R(i[4],"1.0")),t):(t=void 0,t))))},yy.packedLength=4,yy.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),t[n++]=e.red,t[n++]=e.green,t[n++]=e.blue,t[n]=e.alpha,t},yy.unpack=function(e,t,n){return D.defined("array",e),t=R(t,0),C(n)||(n=new yy),n.red=e[t++],n.green=e[t++],n.blue=e[t++],n.alpha=e[t],n},yy.byteToFloat=function(e){return e/255},yy.floatToByte=function(e){return 1===e?255:256*e|0},yy.clone=function(e,t){if(C(e))return C(t)?(t.red=e.red,t.green=e.green,t.blue=e.blue,t.alpha=e.alpha,t):new yy(e.red,e.green,e.blue,e.alpha)},yy.equals=function(e,t){return e===t||C(e)&&C(t)&&e.red===t.red&&e.green===t.green&&e.blue===t.blue&&e.alpha===t.alpha},yy.equalsArray=function(e,t,n){return e.red===t[n]&&e.green===t[n+1]&&e.blue===t[n+2]&&e.alpha===t[n+3]},yy.prototype.clone=function(e){return yy.clone(this,e)},yy.prototype.equals=function(e){return yy.equals(this,e)},yy.prototype.equalsEpsilon=function(e,t){return this===e||C(e)&&Math.abs(this.red-e.red)<=t&&Math.abs(this.green-e.green)<=t&&Math.abs(this.blue-e.blue)<=t&&Math.abs(this.alpha-e.alpha)<=t},yy.prototype.toString=function(){return`(${this.red}, ${this.green}, ${this.blue}, ${this.alpha})`},yy.prototype.toCssColorString=function(){const e=yy.floatToByte(this.red),t=yy.floatToByte(this.green),n=yy.floatToByte(this.blue);return 1===this.alpha?`rgb(${e},${t},${n})`:`rgba(${e},${t},${n},${this.alpha})`},yy.prototype.toCssHexString=function(){let e=yy.floatToByte(this.red).toString(16);e.length<2&&(e=`0${e}`);let t=yy.floatToByte(this.green).toString(16);t.length<2&&(t=`0${t}`);let n=yy.floatToByte(this.blue).toString(16);if(n.length<2&&(n=`0${n}`),this.alpha<1){let i=yy.floatToByte(this.alpha).toString(16);return i.length<2&&(i=`0${i}`),`#${e}${t}${n}${i}`}return`#${e}${t}${n}`},yy.prototype.toBytes=function(e){const t=yy.floatToByte(this.red),n=yy.floatToByte(this.green),i=yy.floatToByte(this.blue),o=yy.floatToByte(this.alpha);return C(e)?(e[0]=t,e[1]=n,e[2]=i,e[3]=o,e):[t,n,i,o]},yy.prototype.toRgba=function(){return Ay[0]=yy.floatToByte(this.red),Ay[1]=yy.floatToByte(this.green),Ay[2]=yy.floatToByte(this.blue),Ay[3]=yy.floatToByte(this.alpha),by[0]},yy.prototype.brighten=function(e,t){return D.typeOf.number("magnitude",e),D.typeOf.number.greaterThanOrEquals("magnitude",e,0),D.typeOf.object("result",t),e=1-e,t.red=1-(1-this.red)*e,t.green=1-(1-this.green)*e,t.blue=1-(1-this.blue)*e,t.alpha=this.alpha,t},yy.prototype.darken=function(e,t){return D.typeOf.number("magnitude",e),D.typeOf.number.greaterThanOrEquals("magnitude",e,0),D.typeOf.object("result",t),e=1-e,t.red=this.red*e,t.green=this.green*e,t.blue=this.blue*e,t.alpha=this.alpha,t},yy.prototype.withAlpha=function(e,t){return yy.fromAlpha(this,e,t)},yy.add=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.red=e.red+t.red,n.green=e.green+t.green,n.blue=e.blue+t.blue,n.alpha=e.alpha+t.alpha,n},yy.subtract=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.red=e.red-t.red,n.green=e.green-t.green,n.blue=e.blue-t.blue,n.alpha=e.alpha-t.alpha,n},yy.multiply=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.red=e.red*t.red,n.green=e.green*t.green,n.blue=e.blue*t.blue,n.alpha=e.alpha*t.alpha,n},yy.divide=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.red=e.red/t.red,n.green=e.green/t.green,n.blue=e.blue/t.blue,n.alpha=e.alpha/t.alpha,n},yy.mod=function(e,t,n){return D.typeOf.object("left",e),D.typeOf.object("right",t),D.typeOf.object("result",n),n.red=e.red%t.red,n.green=e.green%t.green,n.blue=e.blue%t.blue,n.alpha=e.alpha%t.alpha,n},yy.lerp=function(e,t,n,i){return D.typeOf.object("start",e),D.typeOf.object("end",t),D.typeOf.number("t",n),D.typeOf.object("result",i),i.red=z.lerp(e.red,t.red,n),i.green=z.lerp(e.green,t.green,n),i.blue=z.lerp(e.blue,t.blue,n),i.alpha=z.lerp(e.alpha,t.alpha,n),i},yy.multiplyByScalar=function(e,t,n){return D.typeOf.object("color",e),D.typeOf.number("scalar",t),D.typeOf.object("result",n),n.red=e.red*t,n.green=e.green*t,n.blue=e.blue*t,n.alpha=e.alpha*t,n},yy.divideByScalar=function(e,t,n){return D.typeOf.object("color",e),D.typeOf.number("scalar",t),D.typeOf.object("result",n),n.red=e.red/t,n.green=e.green/t,n.blue=e.blue/t,n.alpha=e.alpha/t,n},yy.ALICEBLUE=Object.freeze(yy.fromCssColorString("#F0F8FF")),yy.ANTIQUEWHITE=Object.freeze(yy.fromCssColorString("#FAEBD7")),yy.AQUA=Object.freeze(yy.fromCssColorString("#00FFFF")),yy.AQUAMARINE=Object.freeze(yy.fromCssColorString("#7FFFD4")),yy.AZURE=Object.freeze(yy.fromCssColorString("#F0FFFF")),yy.BEIGE=Object.freeze(yy.fromCssColorString("#F5F5DC")),yy.BISQUE=Object.freeze(yy.fromCssColorString("#FFE4C4")),yy.BLACK=Object.freeze(yy.fromCssColorString("#000000")),yy.BLANCHEDALMOND=Object.freeze(yy.fromCssColorString("#FFEBCD")),yy.BLUE=Object.freeze(yy.fromCssColorString("#0000FF")),yy.BLUEVIOLET=Object.freeze(yy.fromCssColorString("#8A2BE2")),yy.BROWN=Object.freeze(yy.fromCssColorString("#A52A2A")),yy.BURLYWOOD=Object.freeze(yy.fromCssColorString("#DEB887")),yy.CADETBLUE=Object.freeze(yy.fromCssColorString("#5F9EA0")),yy.CHARTREUSE=Object.freeze(yy.fromCssColorString("#7FFF00")),yy.CHOCOLATE=Object.freeze(yy.fromCssColorString("#D2691E")),yy.CORAL=Object.freeze(yy.fromCssColorString("#FF7F50")),yy.CORNFLOWERBLUE=Object.freeze(yy.fromCssColorString("#6495ED")),yy.CORNSILK=Object.freeze(yy.fromCssColorString("#FFF8DC")),yy.CRIMSON=Object.freeze(yy.fromCssColorString("#DC143C")),yy.CYAN=Object.freeze(yy.fromCssColorString("#00FFFF")),yy.DARKBLUE=Object.freeze(yy.fromCssColorString("#00008B")),yy.DARKCYAN=Object.freeze(yy.fromCssColorString("#008B8B")),yy.DARKGOLDENROD=Object.freeze(yy.fromCssColorString("#B8860B")),yy.DARKGRAY=Object.freeze(yy.fromCssColorString("#A9A9A9")),yy.DARKGREEN=Object.freeze(yy.fromCssColorString("#006400")),yy.DARKGREY=yy.DARKGRAY,yy.DARKKHAKI=Object.freeze(yy.fromCssColorString("#BDB76B")),yy.DARKMAGENTA=Object.freeze(yy.fromCssColorString("#8B008B")),yy.DARKOLIVEGREEN=Object.freeze(yy.fromCssColorString("#556B2F")),yy.DARKORANGE=Object.freeze(yy.fromCssColorString("#FF8C00")),yy.DARKORCHID=Object.freeze(yy.fromCssColorString("#9932CC")),yy.DARKRED=Object.freeze(yy.fromCssColorString("#8B0000")),yy.DARKSALMON=Object.freeze(yy.fromCssColorString("#E9967A")),yy.DARKSEAGREEN=Object.freeze(yy.fromCssColorString("#8FBC8F")),yy.DARKSLATEBLUE=Object.freeze(yy.fromCssColorString("#483D8B")),yy.DARKSLATEGRAY=Object.freeze(yy.fromCssColorString("#2F4F4F")),yy.DARKSLATEGREY=yy.DARKSLATEGRAY,yy.DARKTURQUOISE=Object.freeze(yy.fromCssColorString("#00CED1")),yy.DARKVIOLET=Object.freeze(yy.fromCssColorString("#9400D3")),yy.DEEPPINK=Object.freeze(yy.fromCssColorString("#FF1493")),yy.DEEPSKYBLUE=Object.freeze(yy.fromCssColorString("#00BFFF")),yy.DIMGRAY=Object.freeze(yy.fromCssColorString("#696969")),yy.DIMGREY=yy.DIMGRAY,yy.DODGERBLUE=Object.freeze(yy.fromCssColorString("#1E90FF")),yy.FIREBRICK=Object.freeze(yy.fromCssColorString("#B22222")),yy.FLORALWHITE=Object.freeze(yy.fromCssColorString("#FFFAF0")),yy.FORESTGREEN=Object.freeze(yy.fromCssColorString("#228B22")),yy.FUCHSIA=Object.freeze(yy.fromCssColorString("#FF00FF")),yy.GAINSBORO=Object.freeze(yy.fromCssColorString("#DCDCDC")),yy.GHOSTWHITE=Object.freeze(yy.fromCssColorString("#F8F8FF")),yy.GOLD=Object.freeze(yy.fromCssColorString("#FFD700")),yy.GOLDENROD=Object.freeze(yy.fromCssColorString("#DAA520")),yy.GRAY=Object.freeze(yy.fromCssColorString("#808080")),yy.GREEN=Object.freeze(yy.fromCssColorString("#008000")),yy.GREENYELLOW=Object.freeze(yy.fromCssColorString("#ADFF2F")),yy.GREY=yy.GRAY,yy.HONEYDEW=Object.freeze(yy.fromCssColorString("#F0FFF0")),yy.HOTPINK=Object.freeze(yy.fromCssColorString("#FF69B4")),yy.INDIANRED=Object.freeze(yy.fromCssColorString("#CD5C5C")),yy.INDIGO=Object.freeze(yy.fromCssColorString("#4B0082")),yy.IVORY=Object.freeze(yy.fromCssColorString("#FFFFF0")),yy.KHAKI=Object.freeze(yy.fromCssColorString("#F0E68C")),yy.LAVENDER=Object.freeze(yy.fromCssColorString("#E6E6FA")),yy.LAVENDAR_BLUSH=Object.freeze(yy.fromCssColorString("#FFF0F5")),yy.LAWNGREEN=Object.freeze(yy.fromCssColorString("#7CFC00")),yy.LEMONCHIFFON=Object.freeze(yy.fromCssColorString("#FFFACD")),yy.LIGHTBLUE=Object.freeze(yy.fromCssColorString("#ADD8E6")),yy.LIGHTCORAL=Object.freeze(yy.fromCssColorString("#F08080")),yy.LIGHTCYAN=Object.freeze(yy.fromCssColorString("#E0FFFF")),yy.LIGHTGOLDENRODYELLOW=Object.freeze(yy.fromCssColorString("#FAFAD2")),yy.LIGHTGRAY=Object.freeze(yy.fromCssColorString("#D3D3D3")),yy.LIGHTGREEN=Object.freeze(yy.fromCssColorString("#90EE90")),yy.LIGHTGREY=yy.LIGHTGRAY,yy.LIGHTPINK=Object.freeze(yy.fromCssColorString("#FFB6C1")),yy.LIGHTSEAGREEN=Object.freeze(yy.fromCssColorString("#20B2AA")),yy.LIGHTSKYBLUE=Object.freeze(yy.fromCssColorString("#87CEFA")),yy.LIGHTSLATEGRAY=Object.freeze(yy.fromCssColorString("#778899")),yy.LIGHTSLATEGREY=yy.LIGHTSLATEGRAY,yy.LIGHTSTEELBLUE=Object.freeze(yy.fromCssColorString("#B0C4DE")),yy.LIGHTYELLOW=Object.freeze(yy.fromCssColorString("#FFFFE0")),yy.LIME=Object.freeze(yy.fromCssColorString("#00FF00")),yy.LIMEGREEN=Object.freeze(yy.fromCssColorString("#32CD32")),yy.LINEN=Object.freeze(yy.fromCssColorString("#FAF0E6")),yy.MAGENTA=Object.freeze(yy.fromCssColorString("#FF00FF")),yy.MAROON=Object.freeze(yy.fromCssColorString("#800000")),yy.MEDIUMAQUAMARINE=Object.freeze(yy.fromCssColorString("#66CDAA")),yy.MEDIUMBLUE=Object.freeze(yy.fromCssColorString("#0000CD")),yy.MEDIUMORCHID=Object.freeze(yy.fromCssColorString("#BA55D3")),yy.MEDIUMPURPLE=Object.freeze(yy.fromCssColorString("#9370DB")),yy.MEDIUMSEAGREEN=Object.freeze(yy.fromCssColorString("#3CB371")),yy.MEDIUMSLATEBLUE=Object.freeze(yy.fromCssColorString("#7B68EE")),yy.MEDIUMSPRINGGREEN=Object.freeze(yy.fromCssColorString("#00FA9A")),yy.MEDIUMTURQUOISE=Object.freeze(yy.fromCssColorString("#48D1CC")),yy.MEDIUMVIOLETRED=Object.freeze(yy.fromCssColorString("#C71585")),yy.MIDNIGHTBLUE=Object.freeze(yy.fromCssColorString("#191970")),yy.MINTCREAM=Object.freeze(yy.fromCssColorString("#F5FFFA")),yy.MISTYROSE=Object.freeze(yy.fromCssColorString("#FFE4E1")),yy.MOCCASIN=Object.freeze(yy.fromCssColorString("#FFE4B5")),yy.NAVAJOWHITE=Object.freeze(yy.fromCssColorString("#FFDEAD")),yy.NAVY=Object.freeze(yy.fromCssColorString("#000080")),yy.OLDLACE=Object.freeze(yy.fromCssColorString("#FDF5E6")),yy.OLIVE=Object.freeze(yy.fromCssColorString("#808000")),yy.OLIVEDRAB=Object.freeze(yy.fromCssColorString("#6B8E23")),yy.ORANGE=Object.freeze(yy.fromCssColorString("#FFA500")),yy.ORANGERED=Object.freeze(yy.fromCssColorString("#FF4500")),yy.ORCHID=Object.freeze(yy.fromCssColorString("#DA70D6")),yy.PALEGOLDENROD=Object.freeze(yy.fromCssColorString("#EEE8AA")),yy.PALEGREEN=Object.freeze(yy.fromCssColorString("#98FB98")),yy.PALETURQUOISE=Object.freeze(yy.fromCssColorString("#AFEEEE")),yy.PALEVIOLETRED=Object.freeze(yy.fromCssColorString("#DB7093")),yy.PAPAYAWHIP=Object.freeze(yy.fromCssColorString("#FFEFD5")),yy.PEACHPUFF=Object.freeze(yy.fromCssColorString("#FFDAB9")),yy.PERU=Object.freeze(yy.fromCssColorString("#CD853F")),yy.PINK=Object.freeze(yy.fromCssColorString("#FFC0CB")),yy.PLUM=Object.freeze(yy.fromCssColorString("#DDA0DD")),yy.POWDERBLUE=Object.freeze(yy.fromCssColorString("#B0E0E6")),yy.PURPLE=Object.freeze(yy.fromCssColorString("#800080")),yy.RED=Object.freeze(yy.fromCssColorString("#FF0000")),yy.ROSYBROWN=Object.freeze(yy.fromCssColorString("#BC8F8F")),yy.ROYALBLUE=Object.freeze(yy.fromCssColorString("#4169E1")),yy.SADDLEBROWN=Object.freeze(yy.fromCssColorString("#8B4513")),yy.SALMON=Object.freeze(yy.fromCssColorString("#FA8072")),yy.SANDYBROWN=Object.freeze(yy.fromCssColorString("#F4A460")),yy.SEAGREEN=Object.freeze(yy.fromCssColorString("#2E8B57")),yy.SEASHELL=Object.freeze(yy.fromCssColorString("#FFF5EE")),yy.SIENNA=Object.freeze(yy.fromCssColorString("#A0522D")),yy.SILVER=Object.freeze(yy.fromCssColorString("#C0C0C0")),yy.SKYBLUE=Object.freeze(yy.fromCssColorString("#87CEEB")),yy.SLATEBLUE=Object.freeze(yy.fromCssColorString("#6A5ACD")),yy.SLATEGRAY=Object.freeze(yy.fromCssColorString("#708090")),yy.SLATEGREY=yy.SLATEGRAY,yy.SNOW=Object.freeze(yy.fromCssColorString("#FFFAFA")),yy.SPRINGGREEN=Object.freeze(yy.fromCssColorString("#00FF7F")),yy.STEELBLUE=Object.freeze(yy.fromCssColorString("#4682B4")),yy.TAN=Object.freeze(yy.fromCssColorString("#D2B48C")),yy.TEAL=Object.freeze(yy.fromCssColorString("#008080")),yy.THISTLE=Object.freeze(yy.fromCssColorString("#D8BFD8")),yy.TOMATO=Object.freeze(yy.fromCssColorString("#FF6347")),yy.TURQUOISE=Object.freeze(yy.fromCssColorString("#40E0D0")),yy.VIOLET=Object.freeze(yy.fromCssColorString("#EE82EE")),yy.WHEAT=Object.freeze(yy.fromCssColorString("#F5DEB3")),yy.WHITE=Object.freeze(yy.fromCssColorString("#FFFFFF")),yy.WHITESMOKE=Object.freeze(yy.fromCssColorString("#F5F5F5")),yy.YELLOW=Object.freeze(yy.fromCssColorString("#FFFF00")),yy.YELLOWGREEN=Object.freeze(yy.fromCssColorString("#9ACD32")),yy.TRANSPARENT=Object.freeze(new yy(0,0,0,0));var xy=yy;function Sy(e,t,n,i){e=R(e,1),t=R(t,1),n=R(n,1),i=R(i,1),this.value=new Uint8Array([xy.floatToByte(e),xy.floatToByte(t),xy.floatToByte(n),xy.floatToByte(i)])}Object.defineProperties(Sy.prototype,{componentDatatype:{get:function(){return ih.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 4}},normalize:{get:function(){return!0}}}),Sy.fromColor=function(e){if(!C(e))throw new x("color is required.");return new Sy(e.red,e.green,e.blue,e.alpha)},Sy.toValue=function(e,t){if(!C(e))throw new x("color is required.");return C(t)?e.toBytes(t):new Uint8Array(e.toBytes())},Sy.equals=function(e,t){return e===t||C(e)&&C(t)&&e.value[0]===t.value[0]&&e.value[1]===t.value[1]&&e.value[2]===t.value[2]&&e.value[3]===t.value[3]};var Iy=Sy;function Oy(e,t,n,i,o){this._format=e,this._datatype=t,this._width=n,this._height=i,this._buffer=o}Object.defineProperties(Oy.prototype,{internalFormat:{get:function(){return this._format}},pixelDatatype:{get:function(){return this._datatype}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},bufferView:{get:function(){return this._buffer}}}),Oy.clone=function(e){if(C(e))return new Oy(e._format,e._datatype,e._width,e._height,e._buffer)},Oy.prototype.clone=function(){return Oy.clone(this)};var Dy=Oy;const Py=z.EPSILON10;function Ry(e,t,n,i){if(D.defined("equalsEpsilon",t),!C(e))return;n=R(n,!1);const o=C(i),r=e.length;if(r<2)return e;let s,a,c,l=e[0],u=0,h=-1;for(s=1;s<r;++s)a=e[s],t(l,a,Py)?(C(c)||(c=e.slice(0,s),u=s-1,h=0),o&&i.push(s)):(C(c)&&(c.push(a),u=s,o&&(h=i.length)),l=a);return n&&t(e[0],e[r-1],Py)&&(o&&(C(c)?i.splice(h,0,u):i.push(r-1)),C(c)?c.length-=1:c=e.slice(0,-1)),C(c)?c:e}var Ly=Ry;const My={},By=new K,Ny=new K,Fy=new K,zy=new K,ky=new $u;function Uy(e,t,n,i,o){const r=K.subtract(e,t,By),s=K.dot(n,r),a=K.dot(i,r);return ro.fromElements(s,a,o)}My.validOutline=function(e){D.defined("positions",e);const t=$u.fromPoints(e,ky),n=t.halfAxes,i=ke.getColumn(n,0,Ny),o=ke.getColumn(n,1,Fy),r=ke.getColumn(n,2,zy),s=K.magnitude(i),a=K.magnitude(o),c=K.magnitude(r);return!(0===s&&(0===a||0===c)||0===a&&0===c)},My.computeProjectTo2DArguments=function(e,t,n,i){D.defined("positions",e),D.defined("centerResult",t),D.defined("planeAxis1Result",n),D.defined("planeAxis2Result",i);const o=$u.fromPoints(e,ky),r=o.halfAxes,s=ke.getColumn(r,0,Ny),a=ke.getColumn(r,1,Fy),c=ke.getColumn(r,2,zy),l=K.magnitude(s),u=K.magnitude(a),h=K.magnitude(c),d=Math.min(l,u,h);if(0===l&&(0===u||0===h)||0===u&&0===h)return!1;let f,p;return d!==u&&d!==h||(f=s),d===l?f=a:d===h&&(p=a),d!==l&&d!==u||(p=c),K.normalize(f,n),K.normalize(p,i),K.clone(o.center,t),!0},My.createProjectPointsTo2DFunction=function(e,t,n){return function(i){const o=new Array(i.length);for(let r=0;r<i.length;r++)o[r]=Uy(i[r],e,t,n);return o}},My.createProjectPointTo2DFunction=function(e,t,n){return function(i,o){return Uy(i,e,t,n,o)}};var Vy=My;function Hy(e,t,n){if(0===e)return t*n;const i=e*e,o=i*i,r=o*i,s=r*i,a=s*i,c=a*i,l=n,u=Math.sin(2*l),h=Math.sin(4*l),d=Math.sin(6*l),f=Math.sin(8*l),p=Math.sin(10*l),m=Math.sin(12*l);return t*((1-i/4-3*o/64-5*r/256-175*s/16384-441*a/65536-4851*c/1048576)*l-(3*i/8+3*o/32+45*r/1024+105*s/4096+2205*a/131072+6237*c/524288)*u+(15*o/256+45*r/1024+525*s/16384+1575*a/65536+155925*c/8388608)*h-(35*r/3072+175*s/12288+3675*a/262144+13475*c/1048576)*d+(315*s/131072+2205*a/524288+43659*c/8388608)*f-(693*a/1310720+6237*c/5242880)*p+1001*c/8388608*m)}function Gy(e,t,n){const i=e/n;if(0===t)return i;const o=i*i,r=o*i,s=r*i,a=t,c=a*a,l=c*c,u=l*c,h=u*c,d=h*c,f=d*c,p=Math.sin(2*i),m=Math.cos(2*i),_=Math.sin(4*i),g=Math.cos(4*i),y=Math.sin(6*i),v=Math.cos(6*i),b=Math.sin(8*i),A=Math.cos(8*i),w=Math.sin(10*i),T=Math.cos(10*i),C=Math.sin(12*i);return i+i*c/4+7*i*l/64+15*i*u/256+579*i*h/16384+1515*i*d/65536+16837*i*f/1048576+(3*i*l/16+45*i*u/256-i*(32*o-561)*h/4096-i*(232*o-1677)*d/16384+i*(399985-90560*o+512*s)*f/5242880)*m+(21*i*u/256+483*i*h/4096-i*(224*o-1969)*d/16384-i*(33152*o-112599)*f/1048576)*g+(151*i*h/4096+4681*i*d/65536+1479*i*f/16384-453*r*f/32768)*v+(1097*i*d/65536+42783*i*f/1048576)*A+8011*i*f/1048576*T+(3*c/8+3*l/16+213*u/2048-3*o*u/64+255*h/4096-33*o*h/512+20861*d/524288-33*o*d/512+s*d/1024+28273*f/1048576-471*o*f/8192+9*s*f/4096)*p+(21*l/256+21*u/256+533*h/8192-21*o*h/512+197*d/4096-315*o*d/4096+584039*f/16777216-12517*o*f/131072+7*s*f/2048)*_+(151*u/6144+151*h/4096+5019*d/131072-453*o*d/16384+26965*f/786432-8607*o*f/131072)*y+(1097*h/131072+1097*d/65536+225797*f/10485760-1097*o*f/65536)*b+(8011*d/2621440+8011*f/1048576)*w+293393*f/251658240*C}function Wy(e,t){if(0===e)return Math.log(Math.tan(.5*(z.PI_OVER_TWO+t)));const n=e*Math.sin(t);return Math.log(Math.tan(.5*(z.PI_OVER_TWO+t)))-e/2*Math.log((1+n)/(1-n))}function qy(e,t,n,i,o){const r=Wy(e._ellipticity,n),s=Wy(e._ellipticity,o);return Math.atan2(z.negativePiToPi(i-t),s-r)}function jy(e,t,n,i,o,r,s){const a=e._heading,c=r-i;let l=0;if(z.equalsEpsilon(Math.abs(a),z.PI_OVER_TWO,z.EPSILON8))if(t===n)l=t*Math.cos(o)*z.negativePiToPi(c);else{const n=Math.sin(o);l=t*Math.cos(o)*z.negativePiToPi(c)/Math.sqrt(1-e._ellipticitySquared*n*n)}else{const n=Hy(e._ellipticity,t,o),i=Hy(e._ellipticity,t,s);l=(i-n)/Math.cos(a)}return Math.abs(l)}const Yy=new K,Ky=new K;function Xy(e,t,n,i){const o=K.normalize(i.cartographicToCartesian(t,Ky),Yy),r=K.normalize(i.cartographicToCartesian(n,Ky),Ky);D.typeOf.number.greaterThanOrEquals("value",Math.abs(Math.abs(K.angleBetween(o,r))-Math.PI),.0125);const s=i.maximumRadius,a=i.minimumRadius,c=s*s,l=a*a;e._ellipticitySquared=(c-l)/c,e._ellipticity=Math.sqrt(e._ellipticitySquared),e._start=se.clone(t,e._start),e._start.height=0,e._end=se.clone(n,e._end),e._end.height=0,e._heading=qy(e,t.longitude,t.latitude,n.longitude,n.latitude),e._distance=jy(e,i.maximumRadius,i.minimumRadius,t.longitude,t.latitude,n.longitude,n.latitude)}function Qy(e,t,n,i,o,r){if(0===n)return se.clone(e,r);const s=o*o;let a,c,l;if(Math.abs(z.PI_OVER_TWO-Math.abs(t))>z.EPSILON8){const r=Hy(o,i,e.latitude),s=n*Math.cos(t),u=r+s;c=Gy(u,o,i);const h=Wy(o,e.latitude),d=Wy(o,c);l=Math.tan(t)*(d-h),a=z.negativePiToPi(e.longitude+l)}else{let r;if(c=e.latitude,0===o)r=i*Math.cos(e.latitude);else{const t=Math.sin(e.latitude);r=i*Math.cos(e.latitude)/Math.sqrt(1-s*t*t)}l=n/r,a=t>0?z.negativePiToPi(e.longitude+l):z.negativePiToPi(e.longitude-l)}return C(r)?(r.longitude=a,r.latitude=c,r.height=0,r):new se(a,c,0)}function Jy(e,t,n){const i=R(n,ge.WGS84);this._ellipsoid=i,this._start=new se,this._end=new se,this._heading=void 0,this._distance=void 0,this._ellipticity=void 0,this._ellipticitySquared=void 0,C(e)&&C(t)&&Xy(this,e,t,i)}Object.defineProperties(Jy.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){return D.defined("distance",this._distance),this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},heading:{get:function(){return D.defined("distance",this._distance),this._heading}}}),Jy.fromStartHeadingDistance=function(e,t,n,i,o){D.defined("start",e),D.defined("heading",t),D.defined("distance",n),D.typeOf.number.greaterThan("distance",n,0);const r=R(i,ge.WGS84),s=r.maximumRadius,a=r.minimumRadius,c=s*s,l=a*a,u=Math.sqrt((c-l)/c);t=z.negativePiToPi(t);const h=Qy(e,t,n,r.maximumRadius,u);return!C(o)||C(i)&&!i.equals(o.ellipsoid)?new Jy(e,h,r):(o.setEndPoints(e,h),o)},Jy.prototype.setEndPoints=function(e,t){D.defined("start",e),D.defined("end",t),Xy(this,e,t,this._ellipsoid)},Jy.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(e*this._distance,t)},Jy.prototype.interpolateUsingSurfaceDistance=function(e,t){if(D.typeOf.number("distance",e),!C(this._distance)||0===this._distance)throw new x("EllipsoidRhumbLine must have distinct start and end set.");return Qy(this._start,this._heading,e,this._ellipsoid.maximumRadius,this._ellipticity,t)},Jy.prototype.findIntersectionWithLongitude=function(e,t){if(D.typeOf.number("intersectionLongitude",e),!C(this._distance)||0===this._distance)throw new x("EllipsoidRhumbLine must have distinct start and end set.");const n=this._ellipticity,i=this._heading,o=Math.abs(i),r=this._start;if(e=z.negativePiToPi(e),z.equalsEpsilon(Math.abs(e),Math.PI,z.EPSILON14)&&(e=z.sign(r.longitude)*Math.PI),C(t)||(t=new se),Math.abs(z.PI_OVER_TWO-o)<=z.EPSILON8)return t.longitude=e,t.latitude=r.latitude,t.height=0,t;if(z.equalsEpsilon(Math.abs(z.PI_OVER_TWO-o),z.PI_OVER_TWO,z.EPSILON8)){if(z.equalsEpsilon(e,r.longitude,z.EPSILON12))return;return t.longitude=e,t.latitude=z.PI_OVER_TWO*z.sign(z.PI_OVER_TWO-i),t.height=0,t}const s=r.latitude,a=n*Math.sin(s),c=Math.tan(.5*(z.PI_OVER_TWO+s))*Math.exp((e-r.longitude)/Math.tan(i)),l=(1+a)/(1-a);let u,h=r.latitude;do{u=h;const e=n*Math.sin(u),t=(1+e)/(1-e);h=2*Math.atan(c*Math.pow(t/l,n/2))-z.PI_OVER_TWO}while(!z.equalsEpsilon(h,u,z.EPSILON12));return t.longitude=e,t.latitude=h,t.height=0,t},Jy.prototype.findIntersectionWithLatitude=function(e,t){if(D.typeOf.number("intersectionLatitude",e),!C(this._distance)||0===this._distance)throw new x("EllipsoidRhumbLine must have distinct start and end set.");const n=this._ellipticity,i=this._heading,o=this._start;if(z.equalsEpsilon(Math.abs(i),z.PI_OVER_TWO,z.EPSILON8))return;const r=Wy(n,o.latitude),s=Wy(n,e),a=Math.tan(i)*(s-r),c=z.negativePiToPi(o.longitude+a);return C(t)?(t.longitude=c,t.latitude=e,t.height=0,t):new se(c,e,0)};var Zy=Jy,$y=tv,ev=tv;function tv(e,t,n){n=n||2;var i,o,r,s,a,c,l,u=t&&t.length,h=u?t[0]*n:e.length,d=nv(e,0,h,n,!0),f=[];if(!d||d.next===d.prev)return f;if(u&&(d=lv(e,t,d,n)),e.length>80*n){i=r=e[0],o=s=e[1];for(var p=n;p<h;p+=n)a=e[p],c=e[p+1],a<i&&(i=a),c<o&&(o=c),a>r&&(r=a),c>s&&(s=c);l=Math.max(r-i,s-o),l=0!==l?1/l:0}return ov(d,f,n,i,o,l),f}function nv(e,t,n,i,o){var r,s;if(o===Rv(e,t,n,i)>0)for(r=t;r<n;r+=i)s=Ov(r,e[r],e[r+1],s);else for(r=n-i;r>=t;r-=i)s=Ov(r,e[r],e[r+1],s);return s&&Av(s,s.next)&&(Dv(s),s=s.next),s}function iv(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!Av(i,i.next)&&0!==bv(i.prev,i,i.next))i=i.next;else{if(Dv(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function ov(e,t,n,i,o,r,s){if(e){!s&&r&&pv(e,i,o,r);var a,c,l=e;while(e.prev!==e.next)if(a=e.prev,c=e.next,r?sv(e,i,o,r):rv(e))t.push(a.i/n),t.push(e.i/n),t.push(c.i/n),Dv(e),e=c.next,l=c.next;else if(e=c,e===l){s?1===s?(e=av(iv(e),t,n),ov(e,t,n,i,o,r,2)):2===s&&cv(e,t,n,i,o,r):ov(iv(e),t,n,i,o,r,1);break}}}function rv(e){var t=e.prev,n=e,i=e.next;if(bv(t,n,i)>=0)return!1;var o=e.next.next;while(o!==e.prev){if(yv(t.x,t.y,n.x,n.y,i.x,i.y,o.x,o.y)&&bv(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function sv(e,t,n,i){var o=e.prev,r=e,s=e.next;if(bv(o,r,s)>=0)return!1;var a=o.x<r.x?o.x<s.x?o.x:s.x:r.x<s.x?r.x:s.x,c=o.y<r.y?o.y<s.y?o.y:s.y:r.y<s.y?r.y:s.y,l=o.x>r.x?o.x>s.x?o.x:s.x:r.x>s.x?r.x:s.x,u=o.y>r.y?o.y>s.y?o.y:s.y:r.y>s.y?r.y:s.y,h=_v(a,c,t,n,i),d=_v(l,u,t,n,i),f=e.prevZ,p=e.nextZ;while(f&&f.z>=h&&p&&p.z<=d){if(f!==e.prev&&f!==e.next&&yv(o.x,o.y,r.x,r.y,s.x,s.y,f.x,f.y)&&bv(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&yv(o.x,o.y,r.x,r.y,s.x,s.y,p.x,p.y)&&bv(p.prev,p,p.next)>=0)return!1;p=p.nextZ}while(f&&f.z>=h){if(f!==e.prev&&f!==e.next&&yv(o.x,o.y,r.x,r.y,s.x,s.y,f.x,f.y)&&bv(f.prev,f,f.next)>=0)return!1;f=f.prevZ}while(p&&p.z<=d){if(p!==e.prev&&p!==e.next&&yv(o.x,o.y,r.x,r.y,s.x,s.y,p.x,p.y)&&bv(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function av(e,t,n){var i=e;do{var o=i.prev,r=i.next.next;!Av(o,r)&&wv(o,i,i.next,r)&&xv(o,r)&&xv(r,o)&&(t.push(o.i/n),t.push(i.i/n),t.push(r.i/n),Dv(i),Dv(i.next),i=e=r),i=i.next}while(i!==e);return iv(i)}function cv(e,t,n,i,o,r){var s=e;do{var a=s.next.next;while(a!==s.prev){if(s.i!==a.i&&vv(s,a)){var c=Iv(s,a);return s=iv(s,s.next),c=iv(c,c.next),ov(s,t,n,i,o,r),void ov(c,t,n,i,o,r)}a=a.next}s=s.next}while(s!==e)}function lv(e,t,n,i){var o,r,s,a,c,l=[];for(o=0,r=t.length;o<r;o++)s=t[o]*i,a=o<r-1?t[o+1]*i:e.length,c=nv(e,s,a,i,!1),c===c.next&&(c.steiner=!0),l.push(gv(c));for(l.sort(uv),o=0;o<l.length;o++)n=hv(l[o],n),n=iv(n,n.next);return n}function uv(e,t){return e.x-t.x}function hv(e,t){var n=dv(e,t);if(!n)return t;var i=Iv(n,e),o=iv(n,n.next);return iv(i,i.next),t===n?o:t}function dv(e,t){var n,i=t,o=e.x,r=e.y,s=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var a=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=o&&a>s){if(s=a,a===o){if(r===i.y)return i;if(r===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(o===s)return n;var c,l=n,u=n.x,h=n.y,d=1/0;i=n;do{o>=i.x&&i.x>=u&&o!==i.x&&yv(r<h?o:s,r,u,h,r<h?s:o,r,i.x,i.y)&&(c=Math.abs(r-i.y)/(o-i.x),xv(i,e)&&(c<d||c===d&&(i.x>n.x||i.x===n.x&&fv(n,i)))&&(n=i,d=c)),i=i.next}while(i!==l);return n}function fv(e,t){return bv(e.prev,e,t.prev)<0&&bv(t.next,e,e.next)<0}function pv(e,t,n,i){var o=e;do{null===o.z&&(o.z=_v(o.x,o.y,t,n,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,mv(o)}function mv(e){var t,n,i,o,r,s,a,c,l=1;do{n=e,e=null,r=null,s=0;while(n){for(s++,i=n,a=0,t=0;t<l;t++)if(a++,i=i.nextZ,!i)break;c=l;while(a>0||c>0&&i)0!==a&&(0===c||!i||n.z<=i.z)?(o=n,n=n.nextZ,a--):(o=i,i=i.nextZ,c--),r?r.nextZ=o:e=o,o.prevZ=r,r=o;n=i}r.nextZ=null,l*=2}while(s>1);return e}function _v(e,t,n,i,o){return e=32767*(e-n)*o,t=32767*(t-i)*o,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1}function gv(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function yv(e,t,n,i,o,r,s,a){return(o-s)*(t-a)-(e-s)*(r-a)>=0&&(e-s)*(i-a)-(n-s)*(t-a)>=0&&(n-s)*(r-a)-(o-s)*(i-a)>=0}function vv(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Ev(e,t)&&(xv(e,t)&&xv(t,e)&&Sv(e,t)&&(bv(e.prev,e,t.prev)||bv(e,t.prev,t))||Av(e,t)&&bv(e.prev,e,e.next)>0&&bv(t.prev,t,t.next)>0)}function bv(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Av(e,t){return e.x===t.x&&e.y===t.y}function wv(e,t,n,i){var o=Cv(bv(e,t,n)),r=Cv(bv(e,t,i)),s=Cv(bv(n,i,e)),a=Cv(bv(n,i,t));return o!==r&&s!==a||(!(0!==o||!Tv(e,n,t))||(!(0!==r||!Tv(e,i,t))||(!(0!==s||!Tv(n,e,i))||!(0!==a||!Tv(n,t,i)))))}function Tv(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Cv(e){return e>0?1:e<0?-1:0}function Ev(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&wv(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function xv(e,t){return bv(e.prev,e,e.next)<0?bv(e,t,e.next)>=0&&bv(e,e.prev,t)>=0:bv(e,t,e.prev)<0||bv(e,e.next,t)<0}function Sv(e,t){var n=e,i=!1,o=(e.x+t.x)/2,r=(e.y+t.y)/2;do{n.y>r!==n.next.y>r&&n.next.y!==n.y&&o<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}function Iv(e,t){var n=new Pv(e.i,e.x,e.y),i=new Pv(t.i,t.x,t.y),o=e.next,r=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,i.next=n,n.prev=i,r.next=i,i.prev=r,i}function Ov(e,t,n,i){var o=new Pv(e,t,n);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function Dv(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Pv(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rv(e,t,n,i){for(var o=0,r=t,s=n-i;r<n;r+=i)o+=(e[s]-e[r])*(e[r+1]+e[s+1]),s=r;return o}tv.deviation=function(e,t,n,i){var o=t&&t.length,r=o?t[0]*n:e.length,s=Math.abs(Rv(e,0,r,n));if(o)for(var a=0,c=t.length;a<c;a++){var l=t[a]*n,u=a<c-1?t[a+1]*n:e.length;s-=Math.abs(Rv(e,l,u,n))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*n,f=i[a+1]*n,p=i[a+2]*n;h+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},tv.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,o=0;o<e.length;o++){for(var r=0;r<e[o].length;r++)for(var s=0;s<t;s++)n.vertices.push(e[o][r][s]);o>0&&(i+=e[o-1].length,n.holes.push(i))}return n},$y.default=ev;const Lv={CLOCKWISE:th.CW,COUNTER_CLOCKWISE:th.CCW,validate:function(e){return e===Lv.CLOCKWISE||e===Lv.COUNTER_CLOCKWISE}};var Mv=Object.freeze(Lv);const Bv=new K,Nv=new K,Fv={computeArea2D:function(e){D.defined("positions",e),D.typeOf.number.greaterThanOrEquals("positions.length",e.length,3);const t=e.length;let n=0;for(let i=t-1,o=0;o<t;i=o++){const t=e[i],r=e[o];n+=t.x*r.y-r.x*t.y}return.5*n},computeWindingOrder2D:function(e){const t=Fv.computeArea2D(e);return t>0?Mv.COUNTER_CLOCKWISE:Mv.CLOCKWISE},triangulate:function(e,t){D.defined("positions",e);const n=ro.packArray(e);return $y(n,t,2)}},zv=new K,kv=new K,Uv=new K,Vv=new K,Hv=new K,Gv=new K,Wv=new K;Fv.computeSubdivision=function(e,t,n,i){i=R(i,z.RADIANS_PER_DEGREE),D.typeOf.object("ellipsoid",e),D.defined("positions",t),D.defined("indices",n),D.typeOf.number.greaterThanOrEquals("indices.length",n.length,3),D.typeOf.number.equals("indices.length % 3","0",n.length%3,0),D.typeOf.number.greaterThan("granularity",i,0);const o=n.slice(0);let r;const s=t.length,a=new Array(3*s);let c=0;for(r=0;r<s;r++){const e=t[r];a[c++]=e.x,a[c++]=e.y,a[c++]=e.z}const l=[],u={},h=e.maximumRadius,d=z.chordLength(i,h),f=d*d;while(o.length>0){const e=o.pop(),t=o.pop(),n=o.pop(),i=K.fromArray(a,3*n,zv),s=K.fromArray(a,3*t,kv),c=K.fromArray(a,3*e,Uv),d=K.multiplyByScalar(K.normalize(i,Vv),h,Vv),p=K.multiplyByScalar(K.normalize(s,Hv),h,Hv),m=K.multiplyByScalar(K.normalize(c,Gv),h,Gv),_=K.magnitudeSquared(K.subtract(d,p,Wv)),g=K.magnitudeSquared(K.subtract(p,m,Wv)),y=K.magnitudeSquared(K.subtract(m,d,Wv)),v=Math.max(_,g,y);let b,A;v>f?_===v?(b=`${Math.min(n,t)} ${Math.max(n,t)}`,r=u[b],C(r)||(A=K.add(i,s,Wv),K.multiplyByScalar(A,.5,A),a.push(A.x,A.y,A.z),r=a.length/3-1,u[b]=r),o.push(n,r,e),o.push(r,t,e)):g===v?(b=`${Math.min(t,e)} ${Math.max(t,e)}`,r=u[b],C(r)||(A=K.add(s,c,Wv),K.multiplyByScalar(A,.5,A),a.push(A.x,A.y,A.z),r=a.length/3-1,u[b]=r),o.push(t,r,n),o.push(r,e,n)):y===v&&(b=`${Math.min(e,n)} ${Math.max(e,n)}`,r=u[b],C(r)||(A=K.add(c,i,Wv),K.multiplyByScalar(A,.5,A),a.push(A.x,A.y,A.z),r=a.length/3-1,u[b]=r),o.push(e,r,t),o.push(r,n,t)):(l.push(n),l.push(t),l.push(e))}return new zf({attributes:{position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:a})},indices:l,primitiveType:xf.TRIANGLES})};const qv=new se,jv=new se,Yv=new se,Kv=new se;Fv.computeRhumbLineSubdivision=function(e,t,n,i){i=R(i,z.RADIANS_PER_DEGREE),D.typeOf.object("ellipsoid",e),D.defined("positions",t),D.defined("indices",n),D.typeOf.number.greaterThanOrEquals("indices.length",n.length,3),D.typeOf.number.equals("indices.length % 3","0",n.length%3,0),D.typeOf.number.greaterThan("granularity",i,0);const o=n.slice(0);let r;const s=t.length,a=new Array(3*s);let c=0;for(r=0;r<s;r++){const e=t[r];a[c++]=e.x,a[c++]=e.y,a[c++]=e.z}const l=[],u={},h=e.maximumRadius,d=z.chordLength(i,h),f=new Zy(void 0,void 0,e),p=new Zy(void 0,void 0,e),m=new Zy(void 0,void 0,e);while(o.length>0){const t=o.pop(),n=o.pop(),i=o.pop(),s=K.fromArray(a,3*i,zv),c=K.fromArray(a,3*n,kv),h=K.fromArray(a,3*t,Uv),_=e.cartesianToCartographic(s,qv),g=e.cartesianToCartographic(c,jv),y=e.cartesianToCartographic(h,Yv);f.setEndPoints(_,g);const v=f.surfaceDistance;p.setEndPoints(g,y);const b=p.surfaceDistance;m.setEndPoints(y,_);const A=m.surfaceDistance,w=Math.max(v,b,A);let T,E,x,S;w>d?v===w?(T=`${Math.min(i,n)} ${Math.max(i,n)}`,r=u[T],C(r)||(E=f.interpolateUsingFraction(.5,Kv),x=.5*(_.height+g.height),S=K.fromRadians(E.longitude,E.latitude,x,e,Wv),a.push(S.x,S.y,S.z),r=a.length/3-1,u[T]=r),o.push(i,r,t),o.push(r,n,t)):b===w?(T=`${Math.min(n,t)} ${Math.max(n,t)}`,r=u[T],C(r)||(E=p.interpolateUsingFraction(.5,Kv),x=.5*(g.height+y.height),S=K.fromRadians(E.longitude,E.latitude,x,e,Wv),a.push(S.x,S.y,S.z),r=a.length/3-1,u[T]=r),o.push(n,r,i),o.push(r,t,i)):A===w&&(T=`${Math.min(t,i)} ${Math.max(t,i)}`,r=u[T],C(r)||(E=m.interpolateUsingFraction(.5,Kv),x=.5*(y.height+_.height),S=K.fromRadians(E.longitude,E.latitude,x,e,Wv),a.push(S.x,S.y,S.z),r=a.length/3-1,u[T]=r),o.push(t,r,n),o.push(r,i,n)):(l.push(i),l.push(n),l.push(t))}return new zf({attributes:{position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:a})},indices:l,primitiveType:xf.TRIANGLES})},Fv.scaleToGeodeticHeight=function(e,t,n,i){n=R(n,ge.WGS84);let o=Bv,r=Nv;if(t=R(t,0),i=R(i,!0),C(e)){const s=e.length;for(let a=0;a<s;a+=3)K.fromArray(e,a,r),i&&(r=n.scaleToGeodeticSurface(r,r)),0!==t&&(o=n.geodeticSurfaceNormal(r,o),K.multiplyByScalar(o,t,o),K.add(r,o,r)),e[a]=r.x,e[a+1]=r.y,e[a+2]=r.z}return e};var Xv=Fv;function Qv(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(Qv.prototype,{length:{get:function(){return this._length}}}),Qv.prototype.enqueue=function(e){this._array.push(e),this._length++},Qv.prototype.dequeue=function(){if(0===this._length)return;const e=this._array;let t=this._offset;const n=e[t];return e[t]=void 0,t++,t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,n},Qv.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},Qv.prototype.contains=function(e){return-1!==this._array.indexOf(e)},Qv.prototype.clear=function(){this._array.length=this._offset=this._length=0},Qv.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var Jv=Qv;const Zv={computeHierarchyPackedLength:function(e){let t=0;const n=[e];while(n.length>0){const e=n.pop();if(!C(e))continue;t+=2;const i=e.positions,o=e.holes;if(C(i)&&(t+=i.length*K.packedLength),C(o)){const e=o.length;for(let t=0;t<e;++t)n.push(o[t])}}return t},packPolygonHierarchy:function(e,t,n){const i=[e];while(i.length>0){const e=i.pop();if(!C(e))continue;const o=e.positions,r=e.holes;if(t[n++]=C(o)?o.length:0,t[n++]=C(r)?r.length:0,C(o)){const e=o.length;for(let i=0;i<e;++i,n+=3)K.pack(o[i],t,n)}if(C(r)){const e=r.length;for(let t=0;t<e;++t)i.push(r[t])}}return n},unpackPolygonHierarchy:function(e,t){const n=e[t++],i=e[t++],o=new Array(n),r=i>0?new Array(i):void 0;for(let s=0;s<n;++s,t+=K.packedLength)o[s]=K.unpack(e,t);for(let s=0;s<i;++s)r[s]=Zv.unpackPolygonHierarchy(e,t),t=r[s].startingIndex,delete r[s].startingIndex;return{positions:o,holes:r,startingIndex:t}}},$v=new K;function eb(e,t,n,i){return K.subtract(t,e,$v),K.multiplyByScalar($v,n/i,$v),K.add(e,$v,$v),[$v.x,$v.y,$v.z]}Zv.subdivideLineCount=function(e,t,n){const i=K.distance(e,t),o=i/n,r=Math.max(0,Math.ceil(z.log2(o)));return Math.pow(2,r)};const tb=new se,nb=new se,ib=new se,ob=new K;Zv.subdivideRhumbLineCount=function(e,t,n,i){const o=e.cartesianToCartographic(t,tb),r=e.cartesianToCartographic(n,nb),s=new Zy(o,r,e),a=s.surfaceDistance/i,c=Math.max(0,Math.ceil(z.log2(a)));return Math.pow(2,c)},Zv.subdivideLine=function(e,t,n,i){const o=Zv.subdivideLineCount(e,t,n),r=K.distance(e,t),s=r/o;C(i)||(i=[]);const a=i;a.length=3*o;let c=0;for(let l=0;l<o;l++){const n=eb(e,t,l*s,r);a[c++]=n[0],a[c++]=n[1],a[c++]=n[2]}return a},Zv.subdivideRhumbLine=function(e,t,n,i,o){const r=e.cartesianToCartographic(t,tb),s=e.cartesianToCartographic(n,nb),a=new Zy(r,s,e),c=a.surfaceDistance/i,l=Math.max(0,Math.ceil(z.log2(c))),u=Math.pow(2,l),h=a.surfaceDistance/u;C(o)||(o=[]);const d=o;d.length=3*u;let f=0;for(let p=0;p<u;p++){const t=a.interpolateUsingSurfaceDistance(p*h,ib),n=e.cartographicToCartesian(t,ob);d[f++]=n.x,d[f++]=n.y,d[f++]=n.z}return d};const rb=new K,sb=new K,ab=new K,cb=new K;Zv.scaleToGeodeticHeightExtruded=function(e,t,n,i,o){i=R(i,ge.WGS84);const r=rb;let s=sb;const a=ab;let c=cb;if(C(e)&&C(e.attributes)&&C(e.attributes.position)){const l=e.attributes.position.values,u=l.length/2;for(let e=0;e<u;e+=3)K.fromArray(l,e,a),i.geodeticSurfaceNormal(a,r),c=i.scaleToGeodeticSurface(a,c),s=K.multiplyByScalar(r,n,s),s=K.add(c,s,s),l[e+u]=s.x,l[e+1+u]=s.y,l[e+2+u]=s.z,o&&(c=K.clone(a,c)),s=K.multiplyByScalar(r,t,s),s=K.add(c,s,s),l[e]=s.x,l[e+1]=s.y,l[e+2]=s.z}return e},Zv.polygonOutlinesFromHierarchy=function(e,t,n){const i=[],o=new Jv;let r,s,a;o.enqueue(e);while(0!==o.length){const e=o.dequeue();let c=e.positions;if(t)for(a=c.length,r=0;r<a;r++)n.scaleToGeodeticSurface(c[r],c[r]);if(c=Ly(c,K.equalsEpsilon,!0),c.length<3)continue;const l=e.holes?e.holes.length:0;for(r=0;r<l;r++){const c=e.holes[r];let l=c.positions;if(t)for(a=l.length,s=0;s<a;++s)n.scaleToGeodeticSurface(l[s],l[s]);if(l=Ly(l,K.equalsEpsilon,!0),l.length<3)continue;i.push(l);let u=0;for(C(c.holes)&&(u=c.holes.length),s=0;s<u;s++)o.enqueue(c.holes[s])}i.push(c)}return i},Zv.polygonsFromHierarchy=function(e,t,n,i){const o=[],r=[],s=new Jv;s.enqueue(e);while(0!==s.length){const e=s.dequeue();let a=e.positions;const c=e.holes;let l,u;if(n)for(u=a.length,l=0;l<u;l++)i.scaleToGeodeticSurface(a[l],a[l]);if(a=Ly(a,K.equalsEpsilon,!0),a.length<3)continue;let h=t(a);if(!C(h))continue;const d=[];let f=Xv.computeWindingOrder2D(h);f===Mv.CLOCKWISE&&(h.reverse(),a=a.slice().reverse());let p=a.slice();const m=C(c)?c.length:0,_=[];let g;for(l=0;l<m;l++){const e=c[l];let o=e.positions;if(n)for(u=o.length,g=0;g<u;++g)i.scaleToGeodeticSurface(o[g],o[g]);if(o=Ly(o,K.equalsEpsilon,!0),o.length<3)continue;const r=t(o);if(!C(r))continue;f=Xv.computeWindingOrder2D(r),f===Mv.CLOCKWISE&&(r.reverse(),o=o.slice().reverse()),_.push(o),d.push(p.length),p=p.concat(o),h=h.concat(r);let a=0;for(C(e.holes)&&(a=e.holes.length),g=0;g<a;g++)s.enqueue(e.holes[g])}o.push({outerRing:a,holes:_}),r.push({positions:p,positions2D:h,holes:d})}return{hierarchy:o,polygons:r}};const lb=new ro,ub=new K,hb=new il,db=new ke;Zv.computeBoundingRectangle=function(e,t,n,i,o){const r=il.fromAxisAngle(e,i,hb),s=ke.fromQuaternion(r,db);let a=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY;const h=n.length;for(let d=0;d<h;++d){const e=K.clone(n[d],ub);ke.multiplyByVector(s,e,e);const i=t(e,lb);C(i)&&(a=Math.min(a,i.x),c=Math.max(c,i.x),l=Math.min(l,i.y),u=Math.max(u,i.y))}return o.x=a,o.y=l,o.width=c-a,o.height=u-l,o},Zv.createGeometryFromPositions=function(e,t,n,i,o,r){let s=Xv.triangulate(t.positions2D,t.holes);s.length<3&&(s=[0,1,2]);const a=t.positions;if(i){const e=a.length,t=new Array(3*e);let n=0;for(let o=0;o<e;o++){const e=a[o];t[n++]=e.x,t[n++]=e.y,t[n++]=e.z}const i=new zf({attributes:{position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:t})},indices:s,primitiveType:xf.TRIANGLES});return o.normal?fg.computeNormal(i):i}return r===hf.GEODESIC?Xv.computeSubdivision(e,a,s,n):r===hf.RHUMB?Xv.computeRhumbLineSubdivision(e,a,s,n):void 0};const fb=[],pb=new K,mb=new K;Zv.computeWallGeometry=function(e,t,n,i,o){let r,s,a,c,l,u=e.length,h=0;if(i)for(s=3*u*2,r=new Array(2*s),a=0;a<u;a++)c=e[a],l=e[(a+1)%u],r[h]=r[h+s]=c.x,++h,r[h]=r[h+s]=c.y,++h,r[h]=r[h+s]=c.z,++h,r[h]=r[h+s]=l.x,++h,r[h]=r[h+s]=l.y,++h,r[h]=r[h+s]=l.z,++h;else{const i=z.chordLength(n,t.maximumRadius);let d=0;if(o===hf.GEODESIC)for(a=0;a<u;a++)d+=Zv.subdivideLineCount(e[a],e[(a+1)%u],i);else if(o===hf.RHUMB)for(a=0;a<u;a++)d+=Zv.subdivideRhumbLineCount(t,e[a],e[(a+1)%u],i);for(s=3*(d+u),r=new Array(2*s),a=0;a<u;a++){let n;c=e[a],l=e[(a+1)%u],o===hf.GEODESIC?n=Zv.subdivideLine(c,l,i,fb):o===hf.RHUMB&&(n=Zv.subdivideRhumbLine(t,c,l,i,fb));const d=n.length;for(let e=0;e<d;++e,++h)r[h]=n[e],r[h+s]=n[e];r[h]=l.x,r[h+s]=l.x,++h,r[h]=l.y,r[h+s]=l.y,++h,r[h]=l.z,r[h+s]=l.z,++h}}u=r.length;const d=fd.createTypedArray(u/3,u-6*e.length);let f=0;for(u/=6,a=0;a<u;a++){const e=a,t=e+1,n=e+u,i=n+1;c=K.fromArray(r,3*e,pb),l=K.fromArray(r,3*t,mb),K.equalsEpsilon(c,l,z.EPSILON10,z.EPSILON10)||(d[f++]=e,d[f++]=n,d[f++]=t,d[f++]=t,d[f++]=n,d[f++]=i)}return new zf({attributes:new Hf({position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:r})}),indices:d,primitiveType:xf.TRIANGLES})};var _b=Zv;const gb=new K,yb=new bf,vb=new ro,bb=new ro,Ab=new K,wb=new K,Tb=new K,Cb=new K,Eb=new K,xb=new K,Sb=new il,Ib=new ke,Ob=new ke,Db=new K;function Pb(e,t,n,i,o,r,s,a){const c=e.positions;let l=Xv.triangulate(e.positions2D,e.holes);l.length<3&&(l=[0,1,2]);const u=fd.createTypedArray(c.length,l.length);u.set(l);let h=Ib;if(0!==i){let e=il.fromAxisAngle(r,i,Sb);if(h=ke.fromQuaternion(e,h),t.tangent||t.bitangent){e=il.fromAxisAngle(r,-i,Sb);const n=ke.fromQuaternion(e,Ob);s=K.normalize(ke.multiplyByVector(n,s,s),s),t.bitangent&&(a=K.normalize(K.cross(r,s,a),a))}}else h=ke.clone(ke.IDENTITY,h);const d=bb;t.st&&(d.x=n.x,d.y=n.y);const f=c.length,p=3*f,m=new Float64Array(p),_=t.normal?new Float32Array(p):void 0,g=t.tangent?new Float32Array(p):void 0,y=t.bitangent?new Float32Array(p):void 0,v=t.st?new Float32Array(2*f):void 0;let b=0,A=0,w=0,T=0,C=0;for(let x=0;x<f;x++){const e=c[x];if(m[b++]=e.x,m[b++]=e.y,m[b++]=e.z,t.st){const t=ke.multiplyByVector(h,e,gb),i=o(t,vb);ro.subtract(i,d,i);const r=z.clamp(i.x/n.width,0,1),s=z.clamp(i.y/n.height,0,1);v[C++]=r,v[C++]=s}t.normal&&(_[A++]=r.x,_[A++]=r.y,_[A++]=r.z),t.tangent&&(g[T++]=s.x,g[T++]=s.y,g[T++]=s.z),t.bitangent&&(y[w++]=a.x,y[w++]=a.y,y[w++]=a.z)}const E=new Hf;return t.position&&(E.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:m})),t.normal&&(E.normal=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:_})),t.tangent&&(E.tangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:g})),t.bitangent&&(E.bitangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:y})),t.st&&(E.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:v})),new zf({attributes:E,indices:u,primitiveType:xf.TRIANGLES})}function Rb(e){e=R(e,R.EMPTY_OBJECT);const t=e.polygonHierarchy;D.defined("options.polygonHierarchy",t);const n=R(e.vertexFormat,jf.DEFAULT);this._vertexFormat=jf.clone(n),this._polygonHierarchy=t,this._stRotation=R(e.stRotation,0),this._ellipsoid=ge.clone(R(e.ellipsoid,ge.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=_b.computeHierarchyPackedLength(t)+jf.packedLength+ge.packedLength+2}Rb.fromPositions=function(e){e=R(e,R.EMPTY_OBJECT),D.defined("options.positions",e.positions);const t={polygonHierarchy:{positions:e.positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid};return new Rb(t)},Rb.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),n=_b.packPolygonHierarchy(e._polygonHierarchy,t,n),ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,jf.pack(e._vertexFormat,t,n),n+=jf.packedLength,t[n++]=e._stRotation,t[n]=e.packedLength,t};const Lb=ge.clone(ge.UNIT_SPHERE),Mb=new jf,Bb={polygonHierarchy:{}};Rb.unpack=function(e,t,n){D.defined("array",e),t=R(t,0);const i=_b.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;const o=ge.unpack(e,t,Lb);t+=ge.packedLength;const r=jf.unpack(e,t,Mb);t+=jf.packedLength;const s=e[t++],a=e[t];return C(n)||(n=new Rb(Bb)),n._polygonHierarchy=i,n._ellipsoid=ge.clone(o,n._ellipsoid),n._vertexFormat=jf.clone(r,n._vertexFormat),n._stRotation=s,n.packedLength=a,n},Rb.createGeometry=function(e){const t=e._vertexFormat,n=e._polygonHierarchy,i=e._stRotation;let o=n.positions;if(o=Ly(o,K.equalsEpsilon,!0),o.length<3)return;let r=Ab,s=wb,a=Tb,c=Eb;const l=xb,u=Vy.computeProjectTo2DArguments(o,Cb,c,l);if(!u)return;if(r=K.cross(c,l,r),r=K.normalize(r,r),!K.equalsEpsilon(Cb,K.ZERO,z.EPSILON6)){const t=e._ellipsoid.geodeticSurfaceNormal(Cb,Db);K.dot(r,t)<0&&(r=K.negate(r,r),c=K.negate(c,c))}const h=Vy.createProjectPointsTo2DFunction(Cb,c,l),d=Vy.createProjectPointTo2DFunction(Cb,c,l);t.tangent&&(s=K.clone(c,s)),t.bitangent&&(a=K.clone(l,a));const f=_b.polygonsFromHierarchy(n,h,!1),p=f.hierarchy,m=f.polygons;if(0===p.length)return;o=p[0].outerRing;const _=nn.fromPoints(o),g=_b.computeBoundingRectangle(r,d,o,i,yb),y=[];for(let A=0;A<m.length;A++){const e=new Sm({geometry:Pb(m[A],t,g,i,d,r,s,a)});y.push(e)}const v=fg.combineInstances(y)[0];v.attributes.position.values=new Float64Array(v.attributes.position.values),v.indices=fd.createTypedArray(v.attributes.position.values.length/3,v.indices);const b=v.attributes;return t.position||delete b.position,new zf({attributes:b,indices:v.indices,primitiveType:v.primitiveType,boundingSphere:_})};var Nb=Rb;function Fb(e){const t=e.length,n=new Float64Array(3*t),i=fd.createTypedArray(t,2*t);let o=0,r=0;for(let a=0;a<t;a++){const s=e[a];n[o++]=s.x,n[o++]=s.y,n[o++]=s.z,i[r++]=a,i[r++]=(a+1)%t}const s=new Hf({position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:n})});return new zf({attributes:s,indices:i,primitiveType:xf.LINES})}function zb(e){e=R(e,R.EMPTY_OBJECT);const t=e.polygonHierarchy;D.defined("options.polygonHierarchy",t),this._polygonHierarchy=t,this._workerName="createCoplanarPolygonOutlineGeometry",this.packedLength=_b.computeHierarchyPackedLength(t)+1}zb.fromPositions=function(e){e=R(e,R.EMPTY_OBJECT),D.defined("options.positions",e.positions);const t={polygonHierarchy:{positions:e.positions}};return new zb(t)},zb.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),n=_b.packPolygonHierarchy(e._polygonHierarchy,t,n),t[n]=e.packedLength,t};const kb={polygonHierarchy:{}};zb.unpack=function(e,t,n){D.defined("array",e),t=R(t,0);const i=_b.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;const o=e[t];return C(n)||(n=new zb(kb)),n._polygonHierarchy=i,n.packedLength=o,n},zb.createGeometry=function(e){const t=e._polygonHierarchy;let n=t.positions;if(n=Ly(n,K.equalsEpsilon,!0),n.length<3)return;const i=Vy.validOutline(n);if(!i)return;const o=_b.polygonOutlinesFromHierarchy(t,!1);if(0===o.length)return;const r=[];for(let c=0;c<o.length;c++){const e=new Sm({geometry:Fb(o[c])});r.push(e)}const s=fg.combineInstances(r)[0],a=nn.fromPoints(t.positions);return new zf({attributes:s.attributes,indices:s.indices,primitiveType:s.primitiveType,boundingSphere:a})};var Ub=zb;const Vb={ROUNDED:0,MITERED:1,BEVELED:2};var Hb=Object.freeze(Vb);function Gb(e){const t=e._uSquared,n=e._ellipsoid.maximumRadius,i=e._ellipsoid.minimumRadius,o=(n-i)/n,r=Math.cos(e._startHeading),s=Math.sin(e._startHeading),a=(1-o)*Math.tan(e._start.latitude),c=1/Math.sqrt(1+a*a),l=c*a,u=Math.atan2(a,r),h=c*s,d=h*h,f=1-d,p=Math.sqrt(f),m=t/4,_=m*m,g=_*m,y=_*_,v=1+m-3*_/4+5*g/4-175*y/64,b=1-m+15*_/8-35*g/8,A=1-3*m+35*_/4,w=1-5*m,T=v*u-b*Math.sin(2*u)*m/2-A*Math.sin(4*u)*_/16-w*Math.sin(6*u)*g/48-5*Math.sin(8*u)*y/512,C=e._constants;C.a=n,C.b=i,C.f=o,C.cosineHeading=r,C.sineHeading=s,C.tanU=a,C.cosineU=c,C.sineU=l,C.sigma=u,C.sineAlpha=h,C.sineSquaredAlpha=d,C.cosineSquaredAlpha=f,C.cosineAlpha=p,C.u2Over4=m,C.u4Over16=_,C.u6Over64=g,C.u8Over256=y,C.a0=v,C.a1=b,C.a2=A,C.a3=w,C.distanceRatio=T}function Wb(e,t){return e*t*(4+e*(4-3*t))/16}function qb(e,t,n,i,o,r,s){const a=Wb(e,n);return(1-a)*e*t*(i+a*o*(s+a*r*(2*s*s-1)))}function jb(e,t,n,i,o,r,s){const a=(t-n)/t,c=r-i,l=Math.atan((1-a)*Math.tan(o)),u=Math.atan((1-a)*Math.tan(s)),h=Math.cos(l),d=Math.sin(l),f=Math.cos(u),p=Math.sin(u),m=h*f,_=h*p,g=d*p,y=d*f;let v,b,A,w,T,C=c,E=z.TWO_PI,x=Math.cos(C),S=Math.sin(C);do{x=Math.cos(C),S=Math.sin(C);const e=_-y*x;let t;A=Math.sqrt(f*f*S*S+e*e),b=g+m*x,v=Math.atan2(A,b),0===A?(t=0,w=1):(t=m*S/A,w=1-t*t),E=C,T=b-2*g/w,isFinite(T)||(T=0),C=c+qb(a,t,w,v,A,b,T)}while(Math.abs(C-E)>z.EPSILON12);const I=w*(t*t-n*n)/(n*n),O=1+I*(4096+I*(I*(320-175*I)-768))/16384,D=I*(256+I*(I*(74-47*I)-128))/1024,P=T*T,R=D*A*(T+D*(b*(2*P-1)-D*T*(4*A*A-3)*(4*P-3)/6)/4),L=n*O*(v-R),M=Math.atan2(f*S,_-y*x),B=Math.atan2(h*S,_*x-y);e._distance=L,e._startHeading=M,e._endHeading=B,e._uSquared=I}const Yb=new K,Kb=new K;function Xb(e,t,n,i){const o=K.normalize(i.cartographicToCartesian(t,Kb),Yb),r=K.normalize(i.cartographicToCartesian(n,Kb),Kb);D.typeOf.number.greaterThanOrEquals("value",Math.abs(Math.abs(K.angleBetween(o,r))-Math.PI),.0125),jb(e,i.maximumRadius,i.minimumRadius,t.longitude,t.latitude,n.longitude,n.latitude),e._start=se.clone(t,e._start),e._end=se.clone(n,e._end),e._start.height=0,e._end.height=0,Gb(e)}function Qb(e,t,n){const i=R(n,ge.WGS84);this._ellipsoid=i,this._start=new se,this._end=new se,this._constants={},this._startHeading=void 0,this._endHeading=void 0,this._distance=void 0,this._uSquared=void 0,C(e)&&C(t)&&Xb(this,e,t,i)}Object.defineProperties(Qb.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){return D.defined("distance",this._distance),this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},startHeading:{get:function(){return D.defined("distance",this._distance),this._startHeading}},endHeading:{get:function(){return D.defined("distance",this._distance),this._endHeading}}}),Qb.prototype.setEndPoints=function(e,t){D.defined("start",e),D.defined("end",t),Xb(this,e,t,this._ellipsoid)},Qb.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(this._distance*e,t)},Qb.prototype.interpolateUsingSurfaceDistance=function(e,t){D.defined("distance",this._distance);const n=this._constants,i=n.distanceRatio+e/n.b,o=Math.cos(2*i),r=Math.cos(4*i),s=Math.cos(6*i),a=Math.sin(2*i),c=Math.sin(4*i),l=Math.sin(6*i),u=Math.sin(8*i),h=i*i,d=i*h,f=n.u8Over256,p=n.u2Over4,m=n.u6Over64,_=n.u4Over16;let g=2*d*f*o/3+i*(1-p+7*_/4-15*m/4+579*f/64-(_-15*m/4+187*f/16)*o-(5*m/4-115*f/16)*r-29*f*s/16)+(p/2-_+71*m/32-85*f/16)*a+(5*_/16-5*m/4+383*f/96)*c-h*((m-11*f/2)*a+5*f*c/2)+(29*m/96-29*f/16)*l+539*f*u/1536;const y=Math.asin(Math.sin(g)*n.cosineAlpha),v=Math.atan(n.a/n.b*Math.tan(y));g-=n.sigma;const b=Math.cos(2*n.sigma+g),A=Math.sin(g),w=Math.cos(g),T=n.cosineU*w,E=n.sineU*A,x=Math.atan2(A*n.sineHeading,T-E*n.cosineHeading),S=x-qb(n.f,n.sineAlpha,n.cosineSquaredAlpha,g,A,w,b);return C(t)?(t.longitude=this._start.longitude+S,t.latitude=v,t.height=0,t):new se(this._start.longitude+S,v,0)};var Jb=Qb;const Zb={numberOfPoints:function(e,t,n){const i=K.distance(e,t);return Math.ceil(i/n)},numberOfPointsRhumbLine:function(e,t,n){const i=Math.pow(e.longitude-t.longitude,2)+Math.pow(e.latitude-t.latitude,2);return Math.max(1,Math.ceil(Math.sqrt(i/(n*n))))}},$b=new se;Zb.extractHeights=function(e,t){const n=e.length,i=new Array(n);for(let o=0;o<n;o++){const n=e[o];i[o]=t.cartesianToCartographic(n,$b).height}return i};const eA=new ft,tA=new K,nA=new K,iA=new Gs(K.UNIT_X,0),oA=new K,rA=new Gs(K.UNIT_X,0),sA=new K,aA=new K,cA=[];function lA(e,t,n){const i=cA;let o;if(i.length=e,t===n){for(o=0;o<e;o++)i[o]=t;return i}const r=n-t,s=r/e;for(o=0;o<e;o++){const e=t+o*s;i[o]=e}return i}const uA=new se,hA=new se,dA=new K,fA=new K,pA=new K,mA=new Jb;let _A=new Zy;function gA(e,t,n,i,o,r,s,a){const c=i.scaleToGeodeticSurface(e,fA),l=i.scaleToGeodeticSurface(t,pA),u=Zb.numberOfPoints(e,t,n),h=i.cartesianToCartographic(c,uA),d=i.cartesianToCartographic(l,hA),f=lA(u,o,r);mA.setEndPoints(h,d);const p=mA.surfaceDistance/u;let m=a;h.height=o;let _=i.cartographicToCartesian(h,dA);K.pack(_,s,m),m+=3;for(let g=1;g<u;g++){const e=mA.interpolateUsingSurfaceDistance(g*p,hA);e.height=f[g],_=i.cartographicToCartesian(e,dA),K.pack(_,s,m),m+=3}return m}function yA(e,t,n,i,o,r,s,a){const c=i.cartesianToCartographic(e,uA),l=i.cartesianToCartographic(t,hA),u=Zb.numberOfPointsRhumbLine(c,l,n);c.height=0,l.height=0;const h=lA(u,o,r);_A.ellipsoid.equals(i)||(_A=new Zy(void 0,void 0,i)),_A.setEndPoints(c,l);const d=_A.surfaceDistance/u;let f=a;c.height=o;let p=i.cartographicToCartesian(c,dA);K.pack(p,s,f),f+=3;for(let m=1;m<u;m++){const e=_A.interpolateUsingSurfaceDistance(m*d,hA);e.height=h[m],p=i.cartographicToCartesian(e,dA),K.pack(p,s,f),f+=3}return f}Zb.wrapLongitude=function(e,t){const n=[],i=[];if(C(e)&&e.length>0){t=R(t,ft.IDENTITY);const o=ft.inverseTransformation(t,eA),r=ft.multiplyByPoint(o,K.ZERO,tA),s=K.normalize(ft.multiplyByPointAsVector(o,K.UNIT_Y,nA),nA),a=Gs.fromPointNormal(r,s,iA),c=K.normalize(ft.multiplyByPointAsVector(o,K.UNIT_X,oA),oA),l=Gs.fromPointNormal(r,c,rA);let u=1;n.push(K.clone(e[0]));let h=n[0];const d=e.length;for(let t=1;t<d;++t){const o=e[t];if(Gs.getPointDistance(l,h)<0||Gs.getPointDistance(l,o)<0){const e=Ns.lineSegmentPlane(h,o,a,sA);if(C(e)){const t=K.multiplyByScalar(s,5e-9,aA);Gs.getPointDistance(a,h)<0&&K.negate(t,t),n.push(K.add(e,t,new K)),i.push(u+1),K.negate(t,t),n.push(K.add(e,t,new K)),u=1}}n.push(K.clone(e[t])),u++,h=o}i.push(u)}return{positions:n,lengths:i}},Zb.generateArc=function(e){C(e)||(e={});const t=e.positions;if(!C(t))throw new x("options.positions is required.");const n=t.length,i=R(e.ellipsoid,ge.WGS84);let o=R(e.height,0);const r=Array.isArray(o);if(n<1)return[];if(1===n){const e=i.scaleToGeodeticSurface(t[0],fA);if(o=r?o[0]:o,0!==o){const t=i.geodeticSurfaceNormal(e,dA);K.multiplyByScalar(t,o,t),K.add(e,t,e)}return[e.x,e.y,e.z]}let s=e.minDistance;if(!C(s)){const t=R(e.granularity,z.RADIANS_PER_DEGREE);s=z.chordLength(t,i.maximumRadius)}let a,c=0;for(a=0;a<n-1;a++)c+=Zb.numberOfPoints(t[a],t[a+1],s);const l=3*(c+1),u=new Array(l);let h=0;for(a=0;a<n-1;a++){const e=t[a],n=t[a+1],c=r?o[a]:o,l=r?o[a+1]:o;h=gA(e,n,s,i,c,l,u,h)}cA.length=0;const d=t[n-1],f=i.cartesianToCartographic(d,uA);f.height=r?o[n-1]:o;const p=i.cartographicToCartesian(f,dA);return K.pack(p,u,l-3),u};const vA=new se,bA=new se;Zb.generateRhumbArc=function(e){C(e)||(e={});const t=e.positions;if(!C(t))throw new x("options.positions is required.");const n=t.length,i=R(e.ellipsoid,ge.WGS84);let o=R(e.height,0);const r=Array.isArray(o);if(n<1)return[];if(1===n){const e=i.scaleToGeodeticSurface(t[0],fA);if(o=r?o[0]:o,0!==o){const t=i.geodeticSurfaceNormal(e,dA);K.multiplyByScalar(t,o,t),K.add(e,t,e)}return[e.x,e.y,e.z]}const s=R(e.granularity,z.RADIANS_PER_DEGREE);let a,c,l=0,u=i.cartesianToCartographic(t[0],vA);for(a=0;a<n-1;a++)c=i.cartesianToCartographic(t[a+1],bA),l+=Zb.numberOfPointsRhumbLine(u,c,s),u=se.clone(c,vA);const h=3*(l+1),d=new Array(h);let f=0;for(a=0;a<n-1;a++){const e=t[a],n=t[a+1],c=r?o[a]:o,l=r?o[a+1]:o;f=yA(e,n,s,i,c,l,d,f)}cA.length=0;const p=t[n-1],m=i.cartesianToCartographic(p,uA);m.height=r?o[n-1]:o;const _=i.cartographicToCartesian(m,dA);return K.pack(_,d,h-3),d},Zb.generateCartesianArc=function(e){const t=Zb.generateArc(e),n=t.length/3,i=new Array(n);for(let o=0;o<n;o++)i[o]=K.unpack(t,3*o);return i},Zb.generateCartesianRhumbArc=function(e){const t=Zb.generateRhumbArc(e),n=t.length/3,i=new Array(n);for(let o=0;o<n;o++)i[o]=K.unpack(t,3*o);return i};var AA=Zb;const wA={};function TA(e,t){if(!C(e))throw new x("identifier is required.");C(wA[e])||(wA[e]=!0,console.warn(R(t,e)))}TA.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.",TA.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored",TA.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored",TA.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored";var CA=TA;const EA=[new K,new K],xA=new K,SA=new K,IA=new K,OA=new K,DA=new K,PA=new K,RA=new K,LA=new K,MA=new K,BA=new K,NA=new K,FA={};let zA=new se;function kA(e,t){const n=new Array(e.length);for(let i=0;i<e.length;i++){const o=e[i];zA=t.cartesianToCartographic(o,zA),n[i]=zA.height,e[i]=t.scaleToGeodeticSurface(o,o)}return n}function UA(e,t,n,i){const o=e[0],r=e[1],s=K.angleBetween(o,r),a=Math.ceil(s/i),c=new Array(a);let l;if(t===n){for(l=0;l<a;l++)c[l]=t;return c.push(n),c}const u=n-t,h=u/a;for(l=1;l<a;l++){const e=t+l*h;c[l]=e}return c[0]=t,c.push(n),c}const VA=new K,HA=new K;function GA(e,t,n,i){const o=new tu(n,i),r=o.projectPointOntoPlane(K.add(n,e,VA),VA),s=o.projectPointOntoPlane(K.add(n,t,HA),HA),a=ro.angleBetween(r,s);return s.x*r.y-s.y*r.x>=0?-a:a}const WA=new K(-1,0,0);let qA=new ft;const jA=new ft;let YA=new ke;const KA=ke.IDENTITY.clone(),XA=new K,QA=new Xe,JA=new K;function ZA(e,t,n,i,o,r,s,a){let c=XA,l=QA;qA=Kl.eastNorthUpToFixedFrame(e,o,qA),c=ft.multiplyByPointAsVector(qA,WA,c),c=K.normalize(c,c);const u=GA(c,t,e,o);YA=ke.fromRotationZ(u,YA),JA.z=r,qA=ft.multiplyTransformation(qA,ft.fromRotationTranslation(YA,JA,jA),qA);const h=KA;h[0]=s;for(let d=0;d<a;d++)for(let e=0;e<n.length;e+=3)l=K.fromArray(n,e,l),l=ke.multiplyByVector(h,l,l),l=ft.multiplyByPoint(qA,l,l),i.push(l.x,l.y,l.z);return i}const $A=new K;function ew(e,t,n,i,o,r,s){for(let a=0;a<e.length;a+=3){const c=K.fromArray(e,a,$A);i=ZA(c,t,n,i,o,r[a/3],s,1)}return i}function tw(e,t){const n=e.length,i=new Array(6*n);let o=0;const r=t.x+t.width/2,s=t.y+t.height/2;let a=e[0];i[o++]=a.x-r,i[o++]=0,i[o++]=a.y-s;for(let c=1;c<n;c++){a=e[c];const t=a.x-r,n=a.y-s;i[o++]=t,i[o++]=0,i[o++]=n,i[o++]=t,i[o++]=0,i[o++]=n}return a=e[0],i[o++]=a.x-r,i[o++]=0,i[o++]=a.y-s,i}function nw(e,t){const n=e.length,i=new Array(3*n);let o=0;const r=t.x+t.width/2,s=t.y+t.height/2;for(let a=0;a<n;a++)i[o++]=e[a].x-r,i[o++]=0,i[o++]=e[a].y-s;return i}const iw=new il,ow=new K,rw=new ke;function sw(e,t,n,i,o,r,s,a,c,l){const u=K.angleBetween(K.subtract(t,e,BA),K.subtract(n,e,NA)),h=i===Hb.BEVELED?0:Math.ceil(u/z.toRadians(5));let d,f,p;if(d=o?ke.fromQuaternion(il.fromAxisAngle(K.negate(e,BA),u/(h+1),iw),rw):ke.fromQuaternion(il.fromAxisAngle(e,u/(h+1),iw),rw),t=K.clone(t,ow),h>0){const n=l?2:1;for(let i=0;i<h;i++)t=ke.multiplyByVector(d,t,t),f=K.subtract(t,e,BA),f=K.normalize(f,f),o||(f=K.negate(f,f)),p=r.scaleToGeodeticSurface(t,NA),s=ZA(p,f,a,s,r,c,1,n)}else f=K.subtract(t,e,BA),f=K.normalize(f,f),o||(f=K.negate(f,f)),p=r.scaleToGeodeticSurface(t,NA),s=ZA(p,f,a,s,r,c,1,1),n=K.clone(n,ow),f=K.subtract(n,e,BA),f=K.normalize(f,f),o||(f=K.negate(f,f)),p=r.scaleToGeodeticSurface(n,NA),s=ZA(p,f,a,s,r,c,1,1);return s}FA.removeDuplicatesFromShape=function(e){const t=e.length,n=[];for(let i=t-1,o=0;o<t;i=o++){const t=e[i],r=e[o];ro.equals(t,r)||n.push(r)}return n},FA.angleIsGreaterThanPi=function(e,t,n,i){const o=new tu(n,i),r=o.projectPointOntoPlane(K.add(n,e,VA),VA),s=o.projectPointOntoPlane(K.add(n,t,HA),HA);return s.x*r.y-s.y*r.x>=0};const aw=new K,cw=new K;FA.computePositions=function(e,t,n,i,o){const r=i._ellipsoid,s=kA(e,r),a=i._granularity,c=i._cornerType,l=o?tw(t,n):nw(t,n),u=o?nw(t,n):void 0,h=n.height/2,d=n.width/2;let f=e.length,p=[],m=o?[]:void 0,_=xA,g=SA,y=IA,v=OA,b=DA,A=PA,w=RA,T=LA,C=MA,E=e[0],x=e[1];v=r.geodeticSurfaceNormal(E,v),_=K.subtract(x,E,_),_=K.normalize(_,_),T=K.cross(v,_,T),T=K.normalize(T,T);let S,I,O=s[0],D=s[1];o&&(m=ZA(E,T,u,m,r,O+h,1,1)),C=K.clone(E,C),E=x,g=K.negate(_,g);for(let L=1;L<f-1;L++){const t=o?2:1;if(x=e[L+1],E.equals(x)){CA("Positions are too close and are considered equivalent with rounding error.");continue}_=K.subtract(x,E,_),_=K.normalize(_,_),y=K.add(_,g,y),y=K.normalize(y,y),v=r.geodeticSurfaceNormal(E,v);const n=K.multiplyByScalar(v,K.dot(_,v),aw);K.subtract(_,n,n),K.normalize(n,n);const i=K.multiplyByScalar(v,K.dot(g,v),cw);K.subtract(g,i,i),K.normalize(i,i);const u=!z.equalsEpsilon(Math.abs(K.dot(n,i)),1,z.EPSILON7);if(u){y=K.cross(y,v,y),y=K.cross(v,y,y),y=K.normalize(y,y);const e=1/Math.max(.25,K.magnitude(K.cross(y,g,BA))),n=FA.angleIsGreaterThanPi(_,g,E,r);n?(b=K.add(E,K.multiplyByScalar(y,e*d,y),b),A=K.add(b,K.multiplyByScalar(T,d,A),A),EA[0]=K.clone(C,EA[0]),EA[1]=K.clone(A,EA[1]),S=UA(EA,O+h,D+h,a),I=AA.generateArc({positions:EA,granularity:a,ellipsoid:r}),p=ew(I,T,l,p,r,S,1),T=K.cross(v,_,T),T=K.normalize(T,T),w=K.add(b,K.multiplyByScalar(T,d,w),w),c===Hb.ROUNDED||c===Hb.BEVELED?sw(b,A,w,c,n,r,p,l,D+h,o):(y=K.negate(y,y),p=ZA(E,y,l,p,r,D+h,e,t)),C=K.clone(w,C)):(b=K.add(E,K.multiplyByScalar(y,e*d,y),b),A=K.add(b,K.multiplyByScalar(T,-d,A),A),EA[0]=K.clone(C,EA[0]),EA[1]=K.clone(A,EA[1]),S=UA(EA,O+h,D+h,a),I=AA.generateArc({positions:EA,granularity:a,ellipsoid:r}),p=ew(I,T,l,p,r,S,1),T=K.cross(v,_,T),T=K.normalize(T,T),w=K.add(b,K.multiplyByScalar(T,-d,w),w),c===Hb.ROUNDED||c===Hb.BEVELED?sw(b,A,w,c,n,r,p,l,D+h,o):p=ZA(E,y,l,p,r,D+h,e,t),C=K.clone(w,C)),g=K.negate(_,g)}else p=ZA(C,T,l,p,r,O+h,1,1),C=E;O=D,D=s[L+1],E=x}EA[0]=K.clone(C,EA[0]),EA[1]=K.clone(E,EA[1]),S=UA(EA,O+h,D+h,a),I=AA.generateArc({positions:EA,granularity:a,ellipsoid:r}),p=ew(I,T,l,p,r,S,1),o&&(m=ZA(E,T,u,m,r,D+h,1,1)),f=p.length;const P=o?f+m.length:f,R=new Float64Array(P);return R.set(p),o&&R.set(m,f),R};var lw=FA;const uw={},hw=new K,dw=new K,fw=new K,pw=new K,mw=[new K,new K],_w=new K,gw=new K,yw=new K,vw=new K,bw=new K,Aw=new K,ww=new K,Tw=new K,Cw=new K,Ew=new K,xw=new il,Sw=new ke;function Iw(e,t,n,i,o){const r=K.angleBetween(K.subtract(t,e,hw),K.subtract(n,e,dw)),s=i===Hb.BEVELED?1:Math.ceil(r/z.toRadians(5))+1,a=3*s,c=new Array(a);let l;c[a-3]=n.x,c[a-2]=n.y,c[a-1]=n.z,l=o?ke.fromQuaternion(il.fromAxisAngle(K.negate(e,hw),r/s,xw),Sw):ke.fromQuaternion(il.fromAxisAngle(e,r/s,xw),Sw);let u=0;t=K.clone(t,hw);for(let h=0;h<s;h++)t=ke.multiplyByVector(l,t,t),c[u++]=t.x,c[u++]=t.y,c[u++]=t.z;return c}function Ow(e){let t=_w,n=gw,i=yw,o=e[1];n=K.fromArray(e[1],o.length-3,n),i=K.fromArray(e[0],0,i),t=K.midpoint(n,i,t);const r=Iw(t,n,i,Hb.ROUNDED,!1),s=e.length-1,a=e[s-1];o=e[s],n=K.fromArray(a,a.length-3,n),i=K.fromArray(o,0,i),t=K.midpoint(n,i,t);const c=Iw(t,n,i,Hb.ROUNDED,!1);return[r,c]}function Dw(e,t,n,i){let o=hw;return i||(t=K.negate(t,t)),o=K.add(e,t,o),[o.x,o.y,o.z,n.x,n.y,n.z]}function Pw(e,t,n,i){const o=new Array(e.length),r=new Array(e.length),s=K.multiplyByScalar(t,n,hw),a=K.negate(s,dw);let c=0,l=e.length-1;for(let u=0;u<e.length;u+=3){const t=K.fromArray(e,u,fw),n=K.add(t,a,pw);o[c++]=n.x,o[c++]=n.y,o[c++]=n.z;const i=K.add(t,s,pw);r[l--]=i.z,r[l--]=i.y,r[l--]=i.x}return i.push(o,r),i}uw.addAttribute=function(e,t,n,i){const o=t.x,r=t.y,s=t.z;C(n)&&(e[n]=o,e[n+1]=r,e[n+2]=s),C(i)&&(e[i]=s,e[i-1]=r,e[i-2]=o)};const Rw=new K,Lw=new K;uw.computePositions=function(e){const t=e.granularity,n=e.positions,i=e.ellipsoid,o=e.width/2,r=e.cornerType,s=e.saveAttributes;let a=_w,c=gw,l=yw,u=vw,h=bw,d=Aw,f=ww,p=Tw,m=Cw,_=Ew,g=[];const y=s?[]:void 0,v=s?[]:void 0;let b,A=n[0],w=n[1];c=K.normalize(K.subtract(w,A,c),c),a=i.geodeticSurfaceNormal(A,a),u=K.normalize(K.cross(a,c,u),u),s&&(y.push(u.x,u.y,u.z),v.push(a.x,a.y,a.z)),f=K.clone(A,f),A=w,l=K.negate(c,l);const T=[];let C;const E=n.length;for(C=1;C<E-1;C++){a=i.geodeticSurfaceNormal(A,a),w=n[C+1],c=K.normalize(K.subtract(w,A,c),c),h=K.normalize(K.add(c,l,h),h);const e=K.multiplyByScalar(a,K.dot(c,a),Rw);K.subtract(c,e,e),K.normalize(e,e);const E=K.multiplyByScalar(a,K.dot(l,a),Lw);K.subtract(l,E,E),K.normalize(E,E);const x=!z.equalsEpsilon(Math.abs(K.dot(e,E)),1,z.EPSILON7);if(x){h=K.cross(h,a,h),h=K.cross(a,h,h),h=K.normalize(h,h);const e=o/Math.max(.25,K.magnitude(K.cross(h,l,hw))),n=lw.angleIsGreaterThanPi(c,l,A,i);h=K.multiplyByScalar(h,e,h),n?(p=K.add(A,h,p),_=K.add(p,K.multiplyByScalar(u,o,_),_),m=K.add(p,K.multiplyByScalar(u,2*o,m),m),mw[0]=K.clone(f,mw[0]),mw[1]=K.clone(_,mw[1]),b=AA.generateArc({positions:mw,granularity:t,ellipsoid:i}),g=Pw(b,u,o,g),s&&(y.push(u.x,u.y,u.z),v.push(a.x,a.y,a.z)),d=K.clone(m,d),u=K.normalize(K.cross(a,c,u),u),m=K.add(p,K.multiplyByScalar(u,2*o,m),m),f=K.add(p,K.multiplyByScalar(u,o,f),f),r===Hb.ROUNDED||r===Hb.BEVELED?T.push({leftPositions:Iw(p,d,m,r,n)}):T.push({leftPositions:Dw(A,K.negate(h,h),m,n)})):(m=K.add(A,h,m),_=K.add(m,K.negate(K.multiplyByScalar(u,o,_),_),_),p=K.add(m,K.negate(K.multiplyByScalar(u,2*o,p),p),p),mw[0]=K.clone(f,mw[0]),mw[1]=K.clone(_,mw[1]),b=AA.generateArc({positions:mw,granularity:t,ellipsoid:i}),g=Pw(b,u,o,g),s&&(y.push(u.x,u.y,u.z),v.push(a.x,a.y,a.z)),d=K.clone(p,d),u=K.normalize(K.cross(a,c,u),u),p=K.add(m,K.negate(K.multiplyByScalar(u,2*o,p),p),p),f=K.add(m,K.negate(K.multiplyByScalar(u,o,f),f),f),r===Hb.ROUNDED||r===Hb.BEVELED?T.push({rightPositions:Iw(m,d,p,r,n)}):T.push({rightPositions:Dw(A,h,p,n)})),l=K.negate(c,l)}A=w}let x;return a=i.geodeticSurfaceNormal(A,a),mw[0]=K.clone(f,mw[0]),mw[1]=K.clone(A,mw[1]),b=AA.generateArc({positions:mw,granularity:t,ellipsoid:i}),g=Pw(b,u,o,g),s&&(y.push(u.x,u.y,u.z),v.push(a.x,a.y,a.z)),r===Hb.ROUNDED&&(x=Ow(g)),{positions:g,corners:T,lefts:y,normals:v,endPositions:x}};var Mw=uw;const Bw=new K,Nw=new K,Fw=new K,zw=new K,kw=new K,Uw=new K,Vw=new K,Hw=new K;function Gw(e,t){for(let n=0;n<e.length;n++)e[n]=t.scaleToGeodeticSurface(e[n],e[n]);return e}function Ww(e,t,n,i,o,r){const s=e.normals,a=e.tangents,c=e.bitangents,l=K.normalize(K.cross(n,t,Vw),Vw);r.normal&&Mw.addAttribute(s,t,i,o),r.tangent&&Mw.addAttribute(a,l,i,o),r.bitangent&&Mw.addAttribute(c,n,i,o)}function qw(e,t,n){const i=e.positions,o=e.corners,r=e.endPositions,s=e.lefts,a=e.normals,c=new Hf;let l,u,h,d=0,f=0,p=0;for(u=0;u<i.length;u+=2)h=i[u].length-3,d+=h,p+=2*h,f+=i[u+1].length-3;for(d+=3,f+=3,u=0;u<o.length;u++){l=o[u];const e=o[u].leftPositions;C(e)?(h=e.length,d+=h,p+=h):(h=o[u].rightPositions.length,f+=h,p+=h)}const m=C(r);let _;m&&(_=r[0].length-3,d+=_,f+=_,_/=3,p+=6*_);const g=d+f,y=new Float64Array(g),v=t.normal?new Float32Array(g):void 0,b=t.tangent?new Float32Array(g):void 0,A=t.bitangent?new Float32Array(g):void 0,w={normals:v,tangents:b,bitangents:A};let T,E,x,S,I,O,D=0,P=g-1,R=Bw,L=Nw;const M=_/2,B=fd.createTypedArray(g/3,p);let N=0;if(m){O=Fw,I=zw;const e=r[0];for(R=K.fromArray(a,0,R),L=K.fromArray(s,0,L),u=0;u<M;u++)O=K.fromArray(e,3*(M-1-u),O),I=K.fromArray(e,3*(M+u),I),Mw.addAttribute(y,I,D),Mw.addAttribute(y,O,void 0,P),Ww(w,R,L,D,P,t),E=D/3,S=E+1,T=(P-2)/3,x=T-1,B[N++]=T,B[N++]=E,B[N++]=x,B[N++]=x,B[N++]=E,B[N++]=S,D+=3,P-=3}let F,k,U=0,V=0,H=i[U++],G=i[U++];for(y.set(H,D),y.set(G,P-G.length+1),L=K.fromArray(s,V,L),h=G.length-3,u=0;u<h;u+=3)F=n.geodeticSurfaceNormal(K.fromArray(H,u,Vw),Vw),k=n.geodeticSurfaceNormal(K.fromArray(G,h-u,Hw),Hw),R=K.normalize(K.add(F,k,R),R),Ww(w,R,L,D,P,t),E=D/3,S=E+1,T=(P-2)/3,x=T-1,B[N++]=T,B[N++]=E,B[N++]=x,B[N++]=x,B[N++]=E,B[N++]=S,D+=3,P-=3;for(F=n.geodeticSurfaceNormal(K.fromArray(H,h,Vw),Vw),k=n.geodeticSurfaceNormal(K.fromArray(G,h,Hw),Hw),R=K.normalize(K.add(F,k,R),R),V+=3,u=0;u<o.length;u++){let e;l=o[u];const r=l.leftPositions,c=l.rightPositions;let d,f,p=Uw,m=Fw,_=zw;if(R=K.fromArray(a,V,R),C(r)){for(Ww(w,R,L,void 0,P,t),P-=3,d=S,f=x,e=0;e<r.length/3;e++)p=K.fromArray(r,3*e,p),B[N++]=d,B[N++]=f-e-1,B[N++]=f-e,Mw.addAttribute(y,p,void 0,P),m=K.fromArray(y,3*(f-e-1),m),_=K.fromArray(y,3*d,_),L=K.normalize(K.subtract(m,_,L),L),Ww(w,R,L,void 0,P,t),P-=3;p=K.fromArray(y,3*d,p),m=K.subtract(K.fromArray(y,3*f,m),p,m),_=K.subtract(K.fromArray(y,3*(f-e),_),p,_),L=K.normalize(K.add(m,_,L),L),Ww(w,R,L,D,void 0,t),D+=3}else{for(Ww(w,R,L,D,void 0,t),D+=3,d=x,f=S,e=0;e<c.length/3;e++)p=K.fromArray(c,3*e,p),B[N++]=d,B[N++]=f+e,B[N++]=f+e+1,Mw.addAttribute(y,p,D),m=K.fromArray(y,3*d,m),_=K.fromArray(y,3*(f+e),_),L=K.normalize(K.subtract(m,_,L),L),Ww(w,R,L,D,void 0,t),D+=3;p=K.fromArray(y,3*d,p),m=K.subtract(K.fromArray(y,3*(f+e),m),p,m),_=K.subtract(K.fromArray(y,3*f,_),p,_),L=K.normalize(K.negate(K.add(_,m,L),L),L),Ww(w,R,L,void 0,P,t),P-=3}for(H=i[U++],G=i[U++],H.splice(0,3),G.splice(G.length-3,3),y.set(H,D),y.set(G,P-G.length+1),h=G.length-3,V+=3,L=K.fromArray(s,V,L),e=0;e<G.length;e+=3)F=n.geodeticSurfaceNormal(K.fromArray(H,e,Vw),Vw),k=n.geodeticSurfaceNormal(K.fromArray(G,h-e,Hw),Hw),R=K.normalize(K.add(F,k,R),R),Ww(w,R,L,D,P,t),S=D/3,E=S-1,x=(P-2)/3,T=x+1,B[N++]=T,B[N++]=E,B[N++]=x,B[N++]=x,B[N++]=E,B[N++]=S,D+=3,P-=3;D-=3,P+=3}if(R=K.fromArray(a,a.length-3,R),Ww(w,R,L,D,P,t),m){D+=3,P-=3,O=Fw,I=zw;const e=r[1];for(u=0;u<M;u++)O=K.fromArray(e,3*(_-u-1),O),I=K.fromArray(e,3*u,I),Mw.addAttribute(y,O,void 0,P),Mw.addAttribute(y,I,D),Ww(w,R,L,D,P,t),S=D/3,E=S-1,x=(P-2)/3,T=x+1,B[N++]=T,B[N++]=E,B[N++]=x,B[N++]=x,B[N++]=E,B[N++]=S,D+=3,P-=3}if(c.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:y}),t.st){const e=new Float32Array(g/3*2);let t,n,i=0;if(m){d/=3,f/=3;const o=Math.PI/(_+1);let r;n=1/(d-_+1),t=1/(f-_+1);const s=_/2;for(u=s+1;u<_+1;u++)r=z.PI_OVER_TWO+o*u,e[i++]=t*(1+Math.cos(r)),e[i++]=.5*(1+Math.sin(r));for(u=1;u<f-_+1;u++)e[i++]=u*t,e[i++]=0;for(u=_;u>s;u--)r=z.PI_OVER_TWO-u*o,e[i++]=1-t*(1+Math.cos(r)),e[i++]=.5*(1+Math.sin(r));for(u=s;u>0;u--)r=z.PI_OVER_TWO-o*u,e[i++]=1-n*(1+Math.cos(r)),e[i++]=.5*(1+Math.sin(r));for(u=d-_;u>0;u--)e[i++]=u*n,e[i++]=1;for(u=1;u<s+1;u++)r=z.PI_OVER_TWO+o*u,e[i++]=n*(1+Math.cos(r)),e[i++]=.5*(1+Math.sin(r))}else{for(d/=3,f/=3,n=1/(d-1),t=1/(f-1),u=0;u<f;u++)e[i++]=u*t,e[i++]=0;for(u=d;u>0;u--)e[i++]=(u-1)*n,e[i++]=1}c.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:e})}return t.normal&&(c.normal=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:w.normals})),t.tangent&&(c.tangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:w.tangents})),t.bitangent&&(c.bitangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:w.bitangents})),{attributes:c,indices:B}}function jw(e,t){if(!t.normal&&!t.tangent&&!t.bitangent&&!t.st)return e;const n=e.position.values;let i,o;(t.normal||t.bitangent)&&(i=e.normal.values,o=e.bitangent.values);const r=e.position.values.length/18,s=3*r,a=2*r,c=2*s;let l;if(t.normal||t.bitangent||t.tangent){const r=t.normal?new Float32Array(6*s):void 0,a=t.tangent?new Float32Array(6*s):void 0,u=t.bitangent?new Float32Array(6*s):void 0;let h=Bw,d=Nw,f=Fw,p=zw,m=kw,_=Uw,g=c;for(l=0;l<s;l+=3){const e=g+c;h=K.fromArray(n,l,h),d=K.fromArray(n,l+s,d),f=K.fromArray(n,(l+3)%s,f),d=K.subtract(d,h,d),f=K.subtract(f,h,f),p=K.normalize(K.cross(d,f,p),p),t.normal&&(Mw.addAttribute(r,p,e),Mw.addAttribute(r,p,e+3),Mw.addAttribute(r,p,g),Mw.addAttribute(r,p,g+3)),(t.tangent||t.bitangent)&&(_=K.fromArray(i,l,_),t.bitangent&&(Mw.addAttribute(u,_,e),Mw.addAttribute(u,_,e+3),Mw.addAttribute(u,_,g),Mw.addAttribute(u,_,g+3)),t.tangent&&(m=K.normalize(K.cross(_,p,m),m),Mw.addAttribute(a,m,e),Mw.addAttribute(a,m,e+3),Mw.addAttribute(a,m,g),Mw.addAttribute(a,m,g+3))),g+=6}if(t.normal){for(r.set(i),l=0;l<s;l+=3)r[l+s]=-i[l],r[l+s+1]=-i[l+1],r[l+s+2]=-i[l+2];e.normal.values=r}else e.normal=void 0;if(t.bitangent?(u.set(o),u.set(o,s),e.bitangent.values=u):e.bitangent=void 0,t.tangent){const t=e.tangent.values;a.set(t),a.set(t,s),e.tangent.values=a}}if(t.st){const t=e.st.values,n=new Float32Array(6*a);n.set(t),n.set(t,a);let i=2*a;for(let e=0;e<2;e++){for(n[i++]=t[0],n[i++]=t[1],l=2;l<a;l+=2){const e=t[l],o=t[l+1];n[i++]=e,n[i++]=o,n[i++]=e,n[i++]=o}n[i++]=t[0],n[i++]=t[1]}e.st.values=n}return e}function Yw(e,t,n){n[t++]=e[0],n[t++]=e[1],n[t++]=e[2];for(let i=3;i<e.length;i+=3){const o=e[i],r=e[i+1],s=e[i+2];n[t++]=o,n[t++]=r,n[t++]=s,n[t++]=o,n[t++]=r,n[t++]=s}return n[t++]=e[0],n[t++]=e[1],n[t++]=e[2],n}function Kw(e,t){const n=new jf({position:t.position,normal:t.normal||t.bitangent||e.shadowVolume,tangent:t.tangent,bitangent:t.normal||t.bitangent,st:t.st}),i=e.ellipsoid,o=Mw.computePositions(e),r=qw(o,n,i),s=e.height,a=e.extrudedHeight;let c=r.attributes;const l=r.indices;let u=c.position.values,h=u.length;const d=new Float64Array(6*h);let f=new Float64Array(h);f.set(u);let p,m=new Float64Array(4*h);u=Xv.scaleToGeodeticHeight(u,s,i),m=Yw(u,0,m),f=Xv.scaleToGeodeticHeight(f,a,i),m=Yw(f,2*h,m),d.set(u),d.set(f,h),d.set(m,2*h),c.position.values=d,c=jw(c,t);const _=h/3;if(e.shadowVolume){const e=c.normal.values;h=e.length;let n=new Float32Array(6*h);for(p=0;p<h;p++)e[p]=-e[p];n.set(e,h),n=Yw(e,4*h,n),c.extrudeDirection=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:n}),t.normal||(c.normal=void 0)}if(C(e.offsetAttribute)){let t=new Uint8Array(6*_);if(e.offsetAttribute===Wf.TOP)t=wf(t,1,0,_),t=wf(t,1,2*_,4*_);else{const n=e.offsetAttribute===Wf.NONE?0:1;t=wf(t,n)}c.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:t})}const g=l.length,y=_+_,v=fd.createTypedArray(d.length/3,2*g+3*y);v.set(l);let b,A,w,T,E=g;for(p=0;p<g;p+=3){const e=l[p],t=l[p+1],n=l[p+2];v[E++]=n+_,v[E++]=t+_,v[E++]=e+_}for(p=0;p<y;p+=2)b=p+y,A=b+y,w=b+1,T=A+1,v[E++]=b,v[E++]=A,v[E++]=w,v[E++]=w,v[E++]=A,v[E++]=T;return{attributes:c,indices:v}}const Xw=new K,Qw=new K,Jw=new se;function Zw(e,t,n,i,o,r){const s=K.subtract(t,e,Xw);K.normalize(s,s);const a=n.geodeticSurfaceNormal(e,Qw),c=K.cross(s,a,Xw);K.multiplyByScalar(c,i,c);let l=o.latitude,u=o.longitude,h=r.latitude,d=r.longitude;K.add(e,c,Qw),n.cartesianToCartographic(Qw,Jw);let f=Jw.latitude,p=Jw.longitude;l=Math.min(l,f),u=Math.min(u,p),h=Math.max(h,f),d=Math.max(d,p),K.subtract(e,c,Qw),n.cartesianToCartographic(Qw,Jw),f=Jw.latitude,p=Jw.longitude,l=Math.min(l,f),u=Math.min(u,p),h=Math.max(h,f),d=Math.max(d,p),o.latitude=l,o.longitude=u,r.latitude=h,r.longitude=d}const $w=new K,eT=new K,tT=new se,nT=new se;function iT(e,t,n,i,o){e=Gw(e,t);const r=Ly(e,K.equalsEpsilon),s=r.length;if(s<2||n<=0)return new _t;const a=.5*n;let c,l;if(tT.latitude=Number.POSITIVE_INFINITY,tT.longitude=Number.POSITIVE_INFINITY,nT.latitude=Number.NEGATIVE_INFINITY,nT.longitude=Number.NEGATIVE_INFINITY,i===Hb.ROUNDED){const e=r[0];K.subtract(e,r[1],$w),K.normalize($w,$w),K.multiplyByScalar($w,a,$w),K.add(e,$w,eT),t.cartesianToCartographic(eT,Jw),c=Jw.latitude,l=Jw.longitude,tT.latitude=Math.min(tT.latitude,c),tT.longitude=Math.min(tT.longitude,l),nT.latitude=Math.max(nT.latitude,c),nT.longitude=Math.max(nT.longitude,l)}for(let d=0;d<s-1;++d)Zw(r[d],r[d+1],t,a,tT,nT);const u=r[s-1];K.subtract(u,r[s-2],$w),K.normalize($w,$w),K.multiplyByScalar($w,a,$w),K.add(u,$w,eT),Zw(u,eT,t,a,tT,nT),i===Hb.ROUNDED&&(t.cartesianToCartographic(eT,Jw),c=Jw.latitude,l=Jw.longitude,tT.latitude=Math.min(tT.latitude,c),tT.longitude=Math.min(tT.longitude,l),nT.latitude=Math.max(nT.latitude,c),nT.longitude=Math.max(nT.longitude,l));const h=C(o)?o:new _t;return h.north=nT.latitude,h.south=tT.latitude,h.east=nT.longitude,h.west=tT.longitude,h}function oT(e){e=R(e,R.EMPTY_OBJECT);const t=e.positions,n=e.width;D.defined("options.positions",t),D.defined("options.width",n);const i=R(e.height,0),o=R(e.extrudedHeight,i);this._positions=t,this._ellipsoid=ge.clone(R(e.ellipsoid,ge.WGS84)),this._vertexFormat=jf.clone(R(e.vertexFormat,jf.DEFAULT)),this._width=n,this._height=Math.max(i,o),this._extrudedHeight=Math.min(i,o),this._cornerType=R(e.cornerType,Hb.ROUNDED),this._granularity=R(e.granularity,z.RADIANS_PER_DEGREE),this._shadowVolume=R(e.shadowVolume,!1),this._workerName="createCorridorGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this.packedLength=1+t.length*K.packedLength+ge.packedLength+jf.packedLength+7}oT.pack=function(e,t,n){D.defined("value",e),D.defined("array",t),n=R(n,0);const i=e._positions,o=i.length;t[n++]=o;for(let r=0;r<o;++r,n+=K.packedLength)K.pack(i[r],t,n);return ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,jf.pack(e._vertexFormat,t,n),n+=jf.packedLength,t[n++]=e._width,t[n++]=e._height,t[n++]=e._extrudedHeight,t[n++]=e._cornerType,t[n++]=e._granularity,t[n++]=e._shadowVolume?1:0,t[n]=R(e._offsetAttribute,-1),t};const rT=ge.clone(ge.UNIT_SPHERE),sT=new jf,aT={positions:void 0,ellipsoid:rT,vertexFormat:sT,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,shadowVolume:void 0,offsetAttribute:void 0};oT.unpack=function(e,t,n){D.defined("array",e),t=R(t,0);const i=e[t++],o=new Array(i);for(let p=0;p<i;++p,t+=K.packedLength)o[p]=K.unpack(e,t);const r=ge.unpack(e,t,rT);t+=ge.packedLength;const s=jf.unpack(e,t,sT);t+=jf.packedLength;const a=e[t++],c=e[t++],l=e[t++],u=e[t++],h=e[t++],d=1===e[t++],f=e[t];return C(n)?(n._positions=o,n._ellipsoid=ge.clone(r,n._ellipsoid),n._vertexFormat=jf.clone(s,n._vertexFormat),n._width=a,n._height=c,n._extrudedHeight=l,n._cornerType=u,n._granularity=h,n._shadowVolume=d,n._offsetAttribute=-1===f?void 0:f,n):(aT.positions=o,aT.width=a,aT.height=c,aT.extrudedHeight=l,aT.cornerType=u,aT.granularity=h,aT.shadowVolume=d,aT.offsetAttribute=-1===f?void 0:f,new oT(aT))},oT.computeRectangle=function(e,t){e=R(e,R.EMPTY_OBJECT);const n=e.positions,i=e.width;D.defined("options.positions",n),D.defined("options.width",i);const o=R(e.ellipsoid,ge.WGS84),r=R(e.cornerType,Hb.ROUNDED);return iT(n,o,i,r,t)},oT.createGeometry=function(e){let t=e._positions;const n=e._width,i=e._ellipsoid;t=Gw(t,i);const o=Ly(t,K.equalsEpsilon);if(o.length<2||n<=0)return;const r=e._height,s=e._extrudedHeight,a=!z.equalsEpsilon(r,s,0,z.EPSILON2),c=e._vertexFormat,l={ellipsoid:i,positions:o,width:n,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!0};let u;if(a)l.height=r,l.extrudedHeight=s,l.shadowVolume=e._shadowVolume,l.offsetAttribute=e._offsetAttribute,u=Kw(l,c);else{const t=Mw.computePositions(l);if(u=qw(t,c,i),u.attributes.position.values=Xv.scaleToGeodeticHeight(u.attributes.position.values,r,i),C(e._offsetAttribute)){const t=e._offsetAttribute===Wf.NONE?0:1,n=u.attributes.position.values.length,i=new Uint8Array(n/3);wf(i,t),u.attributes.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:i})}}const h=u.attributes,d=nn.fromVertices(h.position.values,void 0,3);return c.position||(u.attributes.position.values=void 0),new zf({attributes:h,indices:u.indices,primitiveType:xf.TRIANGLES,boundingSphere:d,offsetAttribute:e._offsetAttribute})},oT.createShadowVolume=function(e,t,n){const i=e._granularity,o=e._ellipsoid,r=t(i,o),s=n(i,o);return new oT({positions:e._positions,width:e._width,cornerType:e._cornerType,ellipsoid:o,granularity:i,extrudedHeight:r,height:s,vertexFormat:jf.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(oT.prototype,{rectangle:{get:function(){return C(this._rectangle)||(this._rectangle=iT(this._positions,this._ellipsoid,this._width,this._cornerType)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}});var cT=oT;const lT=new K,uT=new K,hT=new K;function dT(e,t){for(let n=0;n<e.length;n++)e[n]=t.scaleToGeodeticSurface(e[n],e[n]);return e}function fT(e,t){const n=[],i=e.positions,o=e.corners,r=e.endPositions,s=new Hf;let a,c,l,u=0,h=0,d=0;for(c=0;c<i.length;c+=2)l=i[c].length-3,u+=l,d+=l/3*4,h+=i[c+1].length-3;for(u+=3,h+=3,c=0;c<o.length;c++){a=o[c];const e=o[c].leftPositions;C(e)?(l=e.length,u+=l,d+=l/3*2):(l=o[c].rightPositions.length,h+=l,d+=l/3*2)}const f=C(r);let p;f&&(p=r[0].length-3,u+=p,h+=p,p/=3,d+=4*p);const m=u+h,_=new Float64Array(m);let g,y,v,b,A,w,T=0,E=m-1;const x=p/2,S=fd.createTypedArray(m/3,d+4);let I=0;if(S[I++]=T/3,S[I++]=(E-2)/3,f){n.push(T/3),w=lT,A=uT;const e=r[0];for(c=0;c<x;c++)w=K.fromArray(e,3*(x-1-c),w),A=K.fromArray(e,3*(x+c),A),Mw.addAttribute(_,A,T),Mw.addAttribute(_,w,void 0,E),y=T/3,b=y+1,g=(E-2)/3,v=g-1,S[I++]=g,S[I++]=v,S[I++]=y,S[I++]=b,T+=3,E-=3}let O=0,D=i[O++],P=i[O++];for(_.set(D,T),_.set(P,E-P.length+1),l=P.length-3,n.push(T/3,(E-2)/3),c=0;c<l;c+=3)y=T/3,b=y+1,g=(E-2)/3,v=g-1,S[I++]=g,S[I++]=v,S[I++]=y,S[I++]=b,T+=3,E-=3;for(c=0;c<o.length;c++){let e;a=o[c];const r=a.leftPositions,s=a.rightPositions;let u,h=hT;if(C(r)){for(E-=3,u=v,n.push(b),e=0;e<r.length/3;e++)h=K.fromArray(r,3*e,h),S[I++]=u-e-1,S[I++]=u-e,Mw.addAttribute(_,h,void 0,E),E-=3;n.push(u-Math.floor(r.length/6)),t===Hb.BEVELED&&n.push((E-2)/3+1),T+=3}else{for(T+=3,u=b,n.push(v),e=0;e<s.length/3;e++)h=K.fromArray(s,3*e,h),S[I++]=u+e,S[I++]=u+e+1,Mw.addAttribute(_,h,T),T+=3;n.push(u+Math.floor(s.length/6)),t===Hb.BEVELED&&n.push(T/3-1),E-=3}for(D=i[O++],P=i[O++],D.splice(0,3),P.splice(P.length-3,3),_.set(D,T),_.set(P,E-P.length+1),l=P.length-3,e=0;e<P.length;e+=3)b=T/3,y=b-1,v=(E-2)/3,g=v+1,S[I++]=g,S[I++]=v,S[I++]=y,S[I++]=b,T+=3,E-=3;T-=3,E+=3,n.push(T/3,(E-2)/3)}if(f){T+=3,E-=3,w=lT,A=uT;const e=r[1];for(c=0;c<x;c++)w=K.fromArray(e,3*(p-c-1),w),A=K.fromArray(e,3*c,A),Mw.addAttribute(_,w,void 0,E),Mw.addAttribute(_,A,T),b=T/3,y=b-1,v=(E-2)/3,g=v+1,S[I++]=g,S[I++]=v,S[I++]=y,S[I++]=b,T+=3,E-=3;n.push(T/3)}else n.push(T/3,(E-2)/3);return S[I++]=T/3,S[I++]=(E-2)/3,s.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:_}),{attributes:s,indices:S,wallIndices:n}}function pT(e){const t=e.ellipsoid,n=Mw.computePositions(e),i=fT(n,e.cornerType),o=i.wallIndices,r=e.height,s=e.extrudedHeight,a=i.attributes,c=i.indices;let l=a.position.values,u=l.length,h=new Float64Array(u);h.set(l);const d=new Float64Array(2*u);if(l=Xv.scaleToGeodeticHeight(l,r,t),h=Xv.scaleToGeodeticHeight(h,s,t),d.set(l),d.set(h,u),a.position.values=d,u/=3,C(e.offsetAttribute)){let t=new Uint8Array(2*u);if(e.offsetAttribute===Wf.TOP)t=wf(t,1,0,u);else{const n=e.offsetAttribute===Wf.NONE?0:1;t=wf(t,n)}a.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:t})}let f;const p=c.length,m=fd.createTypedArray(d.length/3,2*(p+o.length));m.set(c);let _,g,y=p;for(f=0;f<p;f+=2){const e=c[f],t=c[f+1];m[y++]=e+u,m[y++]=t+u}for(f=0;f<o.length;f++)_=o[f],g=_+u,m[y++]=_,m[y++]=g;return{attributes:a,indices:m}}function mT(e){e=R(e,R.EMPTY_OBJECT);const t=e.positions,n=e.width;D.typeOf.object("options.positions",t),D.typeOf.number("options.width",n);const i=R(e.height,0),o=R(e.extrudedHeight,i);this._positions=t,this._ellipsoid=ge.clone(R(e.ellipsoid,ge.WGS84)),this._width=n,this._height=Math.max(i,o),this._extrudedHeight=Math.min(i,o),this._cornerType=R(e.cornerType,Hb.ROUNDED),this._granularity=R(e.granularity,z.RADIANS_PER_DEGREE),this._offsetAttribute=e.offsetAttribute,this._workerName="createCorridorOutlineGeometry",this.packedLength=1+t.length*K.packedLength+ge.packedLength+6}mT.pack=function(e,t,n){D.typeOf.object("value",e),D.typeOf.object("array",t),n=R(n,0);const i=e._positions,o=i.length;t[n++]=o;for(let r=0;r<o;++r,n+=K.packedLength)K.pack(i[r],t,n);return ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,t[n++]=e._width,t[n++]=e._height,t[n++]=e._extrudedHeight,t[n++]=e._cornerType,t[n++]=e._granularity,t[n]=R(e._offsetAttribute,-1),t};const _T=ge.clone(ge.UNIT_SPHERE),gT={positions:void 0,ellipsoid:_T,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};mT.unpack=function(e,t,n){D.typeOf.object("array",e),t=R(t,0);const i=e[t++],o=new Array(i);for(let d=0;d<i;++d,t+=K.packedLength)o[d]=K.unpack(e,t);const r=ge.unpack(e,t,_T);t+=ge.packedLength;const s=e[t++],a=e[t++],c=e[t++],l=e[t++],u=e[t++],h=e[t];return C(n)?(n._positions=o,n._ellipsoid=ge.clone(r,n._ellipsoid),n._width=s,n._height=a,n._extrudedHeight=c,n._cornerType=l,n._granularity=u,n._offsetAttribute=-1===h?void 0:h,n):(gT.positions=o,gT.width=s,gT.height=a,gT.extrudedHeight=c,gT.cornerType=l,gT.granularity=u,gT.offsetAttribute=-1===h?void 0:h,new mT(gT))},mT.createGeometry=function(e){let t=e._positions;const n=e._width,i=e._ellipsoid;t=dT(t,i);const o=Ly(t,K.equalsEpsilon);if(o.length<2||n<=0)return;const r=e._height,s=e._extrudedHeight,a=!z.equalsEpsilon(r,s,0,z.EPSILON2),c={ellipsoid:i,positions:o,width:n,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!1};let l;if(a)c.height=r,c.extrudedHeight=s,c.offsetAttribute=e._offsetAttribute,l=pT(c);else{const t=Mw.computePositions(c);if(l=fT(t,c.cornerType),l.attributes.position.values=Xv.scaleToGeodeticHeight(l.attributes.position.values,r,i),C(e._offsetAttribute)){const t=l.attributes.position.values.length,n=new Uint8Array(t/3),i=e._offsetAttribute===Wf.NONE?0:1;wf(n,i),l.attributes.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}}const u=l.attributes,h=nn.fromVertices(u.position.values,void 0,3);return new zf({attributes:u,indices:l.indices,primitiveType:xf.LINES,boundingSphere:h,offsetAttribute:e._offsetAttribute})};var yT=mT;function vT(e){this.planes=R(e,[])}const bT=[new K,new K,new K];K.clone(K.UNIT_X,bT[0]),K.clone(K.UNIT_Y,bT[1]),K.clone(K.UNIT_Z,bT[2]);const AT=new K,wT=new K,TT=new Gs(new K(1,0,0),0);vT.fromBoundingSphere=function(e,t){if(!C(e))throw new x("boundingSphere is required.");C(t)||(t=new vT);const n=bT.length,i=t.planes;i.length=2*n;const o=e.center,r=e.radius;let s=0;for(let a=0;a<n;++a){const e=bT[a];let t=i[s],n=i[s+1];C(t)||(t=i[s]=new Xe),C(n)||(n=i[s+1]=new Xe),K.multiplyByScalar(e,-r,AT),K.add(o,AT,AT),t.x=e.x,t.y=e.y,t.z=e.z,t.w=-K.dot(e,AT),K.multiplyByScalar(e,r,AT),K.add(o,AT,AT),n.x=-e.x,n.y=-e.y,n.z=-e.z,n.w=-K.dot(K.negate(e,wT),AT),s+=2}return t},vT.prototype.computeVisibility=function(e){if(!C(e))throw new x("boundingVolume is required.");const t=this.planes;let n=!1;for(let i=0,o=t.length;i<o;++i){const o=e.intersectPlane(Gs.fromCartesian4(t[i],TT));if(o===Ae.OUTSIDE)return Ae.OUTSIDE;o===Ae.INTERSECTING&&(n=!0)}return n?Ae.INTERSECTING:Ae.INSIDE},vT.prototype.computeVisibilityWithPlaneMask=function(e,t){if(!C(e))throw new x("boundingVolume is required.");if(!C(t))throw new x("parentPlaneMask is required.");if(t===vT.MASK_OUTSIDE||t===vT.MASK_INSIDE)return t;let n=vT.MASK_INSIDE;const i=this.planes;for(let o=0,r=i.length;o<r;++o){const r=o<31?1<<o:0;if(o<31&&0===(t&r))continue;const s=e.intersectPlane(Gs.fromCartesian4(i[o],TT));if(s===Ae.OUTSIDE)return vT.MASK_OUTSIDE;s===Ae.INTERSECTING&&(n|=r)}return n},vT.MASK_OUTSIDE=4294967295,vT.MASK_INSIDE=0,vT.MASK_INDETERMINATE=2147483647;var CT=vT;function ET(e){e=R(e,R.EMPTY_OBJECT),D.defined("options.callback",e.callback),D.defined("options.width",e.width),D.defined("options.height",e.height),this._callback=e.callback,this._tilingScheme=e.tilingScheme,C(this._tilingScheme)||(this._tilingScheme=new ao({ellipsoid:R(e.ellipsoid,ge.WGS84)})),this._width=e.width,this._height=e.height;const t=Math.max(this._width,this._height);this._levelZeroMaximumGeometricError=Ad.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,t,this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._errorEvent=new $n;let n=e.credit;"string"===typeof n&&(n=new Tr(n)),this._credit=n,this._readyPromise=Promise.resolve(!0)}Object.defineProperties(ET.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},width:{get:function(){return this._width}},height:{get:function(){return this._height}}}),ET.prototype.requestTileGeometry=function(e,t,n,i){const o=this._callback(e,t,n);if(!C(o))return;const r=this._width,s=this._height;return Promise.resolve(o).then((function(e){let t=e;return Array.isArray(t)&&(t=new Float64Array(t)),new Pd({buffer:t,width:r,height:s})}))},ET.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},ET.prototype.getTileDataAvailable=function(e,t,n){},ET.prototype.loadTileDataAvailability=function(e,t,n){};const xT={computePositions:function(e,t,n,i,o){const r=.5*e,s=-r,a=i+i,c=o?2*a:a,l=new Float64Array(3*c);let u,h=0,d=0;const f=o?3*a:0,p=o?3*(a+i):3*i;for(u=0;u<i;u++){const e=u/i*z.TWO_PI,a=Math.cos(e),c=Math.sin(e),m=a*n,_=c*n,g=a*t,y=c*t;l[d+f]=m,l[d+f+1]=_,l[d+f+2]=s,l[d+p]=g,l[d+p+1]=y,l[d+p+2]=r,d+=3,o&&(l[h++]=m,l[h++]=_,l[h++]=s,l[h++]=g,l[h++]=y,l[h++]=r)}return l}};var ST=xT;const IT=new ro,OT=new K,DT=new K,PT=new K,RT=new K;function LT(e){e=R(e,R.EMPTY_OBJECT);const t=e.length,n=e.topRadius,i=e.bottomRadius,o=R(e.vertexFormat,jf.DEFAULT),r=R(e.slices,128);if(!C(t))throw new x("options.length must be defined.");if(!C(n))throw new x("options.topRadius must be defined.");if(!C(i))throw new x("options.bottomRadius must be defined.");if(r<3)throw new x("options.slices must be greater than or equal to 3.");if(C(e.offsetAttribute)&&e.offsetAttribute===Wf.TOP)throw new x("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._length=t,this._topRadius=n,this._bottomRadius=i,this._vertexFormat=jf.clone(o),this._slices=r,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderGeometry"}LT.packedLength=jf.packedLength+5,LT.pack=function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");return n=R(n,0),jf.pack(e._vertexFormat,t,n),n+=jf.packedLength,t[n++]=e._length,t[n++]=e._topRadius,t[n++]=e._bottomRadius,t[n++]=e._slices,t[n]=R(e._offsetAttribute,-1),t};const MT=new jf,BT={vertexFormat:MT,length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,offsetAttribute:void 0};let NT;LT.unpack=function(e,t,n){if(!C(e))throw new x("array is required");t=R(t,0);const i=jf.unpack(e,t,MT);t+=jf.packedLength;const o=e[t++],r=e[t++],s=e[t++],a=e[t++],c=e[t];return C(n)?(n._vertexFormat=jf.clone(i,n._vertexFormat),n._length=o,n._topRadius=r,n._bottomRadius=s,n._slices=a,n._offsetAttribute=-1===c?void 0:c,n):(BT.length=o,BT.topRadius=r,BT.bottomRadius=s,BT.slices=a,BT.offsetAttribute=-1===c?void 0:c,new LT(BT))},LT.createGeometry=function(e){let t=e._length;const n=e._topRadius,i=e._bottomRadius,o=e._vertexFormat,r=e._slices;if(t<=0||n<0||i<0||0===n&&0===i)return;const s=r+r,a=r+s,c=s+s,l=ST.computePositions(t,n,i,r,!0),u=o.st?new Float32Array(2*c):void 0,h=o.normal?new Float32Array(3*c):void 0,d=o.tangent?new Float32Array(3*c):void 0,f=o.bitangent?new Float32Array(3*c):void 0;let p;const m=o.normal||o.tangent||o.bitangent;if(m){const e=o.tangent||o.bitangent;let s=0,a=0,c=0;const l=Math.atan2(i-n,t),u=OT;u.z=Math.sin(l);const _=Math.cos(l);let g=PT,y=DT;for(p=0;p<r;p++){const t=p/r*z.TWO_PI,n=_*Math.cos(t),i=_*Math.sin(t);m&&(u.x=n,u.y=i,e&&(g=K.normalize(K.cross(K.UNIT_Z,u,g),g)),o.normal&&(h[s++]=u.x,h[s++]=u.y,h[s++]=u.z,h[s++]=u.x,h[s++]=u.y,h[s++]=u.z),o.tangent&&(d[a++]=g.x,d[a++]=g.y,d[a++]=g.z,d[a++]=g.x,d[a++]=g.y,d[a++]=g.z),o.bitangent&&(y=K.normalize(K.cross(u,g,y),y),f[c++]=y.x,f[c++]=y.y,f[c++]=y.z,f[c++]=y.x,f[c++]=y.y,f[c++]=y.z))}for(p=0;p<r;p++)o.normal&&(h[s++]=0,h[s++]=0,h[s++]=-1),o.tangent&&(d[a++]=1,d[a++]=0,d[a++]=0),o.bitangent&&(f[c++]=0,f[c++]=-1,f[c++]=0);for(p=0;p<r;p++)o.normal&&(h[s++]=0,h[s++]=0,h[s++]=1),o.tangent&&(d[a++]=1,d[a++]=0,d[a++]=0),o.bitangent&&(f[c++]=0,f[c++]=1,f[c++]=0)}const _=12*r-12,g=fd.createTypedArray(c,_);let y=0,v=0;for(p=0;p<r-1;p++)g[y++]=v,g[y++]=v+2,g[y++]=v+3,g[y++]=v,g[y++]=v+3,g[y++]=v+1,v+=2;for(g[y++]=s-2,g[y++]=0,g[y++]=1,g[y++]=s-2,g[y++]=1,g[y++]=s-1,p=1;p<r-1;p++)g[y++]=s+p+1,g[y++]=s+p,g[y++]=s;for(p=1;p<r-1;p++)g[y++]=a,g[y++]=a+p,g[y++]=a+p+1;let b=0;if(o.st){const e=Math.max(n,i);for(p=0;p<c;p++){const t=K.fromArray(l,3*p,RT);u[b++]=(t.x+e)/(2*e),u[b++]=(t.y+e)/(2*e)}}const A=new Hf;o.position&&(A.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:l})),o.normal&&(A.normal=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:h})),o.tangent&&(A.tangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:d})),o.bitangent&&(A.bitangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:f})),o.st&&(A.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:u})),IT.x=.5*t,IT.y=Math.max(i,n);const w=new nn(K.ZERO,ro.magnitude(IT));if(C(e._offsetAttribute)){t=l.length;const n=new Uint8Array(t/3),i=e._offsetAttribute===Wf.NONE?0:1;wf(n,i),A.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}return new zf({attributes:A,indices:g,primitiveType:xf.TRIANGLES,boundingSphere:w,offsetAttribute:e._offsetAttribute})},LT.getUnitCylinder=function(){return C(NT)||(NT=LT.createGeometry(new LT({topRadius:1,bottomRadius:1,length:1,vertexFormat:jf.POSITION_ONLY}))),NT};var FT=LT;const zT=new ro;function kT(e){e=R(e,R.EMPTY_OBJECT);const t=e.length,n=e.topRadius,i=e.bottomRadius,o=R(e.slices,128),r=Math.max(R(e.numberOfVerticalLines,16),0);if(D.typeOf.number("options.positions",t),D.typeOf.number("options.topRadius",n),D.typeOf.number("options.bottomRadius",i),D.typeOf.number.greaterThanOrEquals("options.slices",o,3),C(e.offsetAttribute)&&e.offsetAttribute===Wf.TOP)throw new x("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._length=t,this._topRadius=n,this._bottomRadius=i,this._slices=o,this._numberOfVerticalLines=r,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderOutlineGeometry"}kT.packedLength=6,kT.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),t[n++]=e._length,t[n++]=e._topRadius,t[n++]=e._bottomRadius,t[n++]=e._slices,t[n++]=e._numberOfVerticalLines,t[n]=R(e._offsetAttribute,-1),t};const UT={length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};kT.unpack=function(e,t,n){D.defined("array",e),t=R(t,0);const i=e[t++],o=e[t++],r=e[t++],s=e[t++],a=e[t++],c=e[t];return C(n)?(n._length=i,n._topRadius=o,n._bottomRadius=r,n._slices=s,n._numberOfVerticalLines=a,n._offsetAttribute=-1===c?void 0:c,n):(UT.length=i,UT.topRadius=o,UT.bottomRadius=r,UT.slices=s,UT.numberOfVerticalLines=a,UT.offsetAttribute=-1===c?void 0:c,new kT(UT))},kT.createGeometry=function(e){let t=e._length;const n=e._topRadius,i=e._bottomRadius,o=e._slices,r=e._numberOfVerticalLines;if(t<=0||n<0||i<0||0===n&&0===i)return;const s=2*o,a=ST.computePositions(t,n,i,o,!1);let c,l=2*o;if(r>0){const e=Math.min(r,o);c=Math.round(o/e),l+=e}const u=fd.createTypedArray(s,2*l);let h,d=0;for(h=0;h<o-1;h++)u[d++]=h,u[d++]=h+1,u[d++]=h+o,u[d++]=h+1+o;if(u[d++]=o-1,u[d++]=0,u[d++]=o+o-1,u[d++]=o,r>0)for(h=0;h<o;h+=c)u[d++]=h,u[d++]=h+o;const f=new Hf;f.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:a}),zT.x=.5*t,zT.y=Math.max(i,n);const p=new nn(K.ZERO,ro.magnitude(zT));if(C(e._offsetAttribute)){t=a.length;const n=new Uint8Array(t/3),i=e._offsetAttribute===Wf.NONE?0:1;wf(n,i),f.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}return new zf({attributes:f,indices:u,primitiveType:xf.LINES,boundingSphere:p,offsetAttribute:e._offsetAttribute})};var VT=kT;function HT(e){this.proxy=e}HT.prototype.getURL=function(e){const t=-1===this.proxy.indexOf("?")?"?":"";return this.proxy+t+encodeURIComponent(e)};function GT(e,t){e=R(e,0),this._near=e,t=R(t,Number.MAX_VALUE),this._far=t}Object.defineProperties(GT.prototype,{near:{get:function(){return this._near},set:function(e){this._near=e}},far:{get:function(){return this._far},set:function(e){this._far=e}}}),GT.packedLength=2,GT.pack=function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");return n=R(n,0),t[n++]=e.near,t[n]=e.far,t},GT.unpack=function(e,t,n){if(!C(e))throw new x("array is required");return t=R(t,0),C(n)||(n=new GT),n.near=e[t++],n.far=e[t],n},GT.equals=function(e,t){return e===t||C(e)&&C(t)&&e.near===t.near&&e.far===t.far},GT.clone=function(e,t){if(C(e))return C(t)||(t=new GT),t.near=e.near,t.far=e.far,t},GT.prototype.clone=function(e){return GT.clone(this,e)},GT.prototype.equals=function(e){return GT.equals(this,e)};var WT=GT;function qT(e,t){if(e=R(e,0),t=R(t,Number.MAX_VALUE),t<=e)throw new x("far distance must be greater than near distance.");this.value=new Float32Array([e,t])}Object.defineProperties(qT.prototype,{componentDatatype:{get:function(){return ih.FLOAT}},componentsPerAttribute:{get:function(){return 2}},normalize:{get:function(){return!1}}}),qT.fromDistanceDisplayCondition=function(e){if(!C(e))throw new x("distanceDisplayCondition is required.");if(e.far<=e.near)throw new x("distanceDisplayCondition.far distance must be greater than distanceDisplayCondition.near distance.");return new qT(e.near,e.far)},qT.toValue=function(e,t){if(!C(e))throw new x("distanceDisplayCondition is required.");return C(t)?(t[0]=e.near,t[1]=e.far,t):new Float32Array([e.near,e.far])};var jT=qT;function YT(e){D.typeOf.object("options",e),D.defined("options.comparator",e.comparator),C(e.maximumLength)&&D.typeOf.number.greaterThanOrEquals("options.maximumLength",e.maximumLength,0),this._comparator=e.comparator,this._maximumLength=e.maximumLength,this._array=C(e.maximumLength)?new Array(e.maximumLength):[],this._length=0}function KT(e,t,n){const i=e._array,o=i[t];i[t]=i[n],i[n]=o}function XT(e,t,n){return e._comparator(e._array[t],e._array[n])<0}function QT(e,t,n){return e._comparator(e._array[t],e._array[n])>0}function JT(e,t){if(0===t)return;const n=Math.floor(z.log2(t+1))%2===0,i=Math.floor((t-1)/2),o=XT(e,t,i);o!==n&&(KT(e,t,i),t=i);while(t>=3){const n=Math.floor((t-3)/4);if(XT(e,t,n)!==o)break;KT(e,t,n),t=n}}function ZT(e,t){const n=e._length,i=Math.floor(z.log2(t+1))%2===0;let o;while((o=2*t+1)<n){let r=o;const s=o+1;if(s<n){XT(e,s,r)===i&&(r=s);const t=2*o+1,a=Math.max(Math.min(n-t,4),0);for(let n=0;n<a;n++){const o=t+n;XT(e,o,r)===i&&(r=o)}}if(XT(e,r,t)===i&&(KT(e,r,t),r!==o&&r!==s)){const t=Math.floor((r-1)/2);QT(e,r,t)===i&&KT(e,r,t)}t=r}}Object.defineProperties(YT.prototype,{length:{get:function(){return this._length}},maximumLength:{get:function(){return this._maximumLength},set:function(e){if(C(e)){D.typeOf.number.greaterThanOrEquals("maximumLength",e,0);while(this._length>e)this.removeMinimum();this._array.length=e}this._maximumLength=e}},internalArray:{get:function(){return this._array}},comparator:{get:function(){return this._comparator}}}),YT.prototype.clone=function(){const e=this._maximumLength,t=this._comparator,n=this._array,i=this._length,o=new YT({comparator:t,maximumLength:e});o._length=i;for(let r=0;r<i;r++)o._array[r]=n[r];return o},YT.prototype.reset=function(){this._length=0;const e=this._maximumLength;if(C(e))for(let t=0;t<e;t++)this._array[t]=void 0;else this._array.length=0},YT.prototype.resort=function(){const e=this._length;for(let t=0;t<e;t++)JT(this,t)},YT.prototype.insert=function(e){let t;const n=this._maximumLength;if(C(n)){if(0===n)return;if(this._length===n){const n=this._array[0];if(this._comparator(e,n)<=0)return e;t=this.removeMinimum()}}const i=this._length;return this._array[i]=e,this._length++,JT(this,i),t},YT.prototype.removeMinimum=function(){const e=this._length;if(0===e)return;this._length--;const t=this._array[0];return e>=2&&(this._array[0]=this._array[e-1],ZT(this,0)),this._array[e-1]=void 0,t},YT.prototype.removeMaximum=function(){const e=this._length;if(0===e)return;let t;if(this._length--,e<=2)t=this._array[e-1];else{const n=QT(this,1,2)?1:2;t=this._array[n],this._array[n]=this._array[e-1],e>=4&&ZT(this,n)}return this._array[e-1]=void 0,t},YT.prototype.getMinimum=function(){const e=this._length;if(0!==e)return this._array[0]},YT.prototype.getMaximum=function(){const e=this._length;if(0!==e)return e<=2?this._array[e-1]:this._array[QT(this,1,2)?1:2]};function $T(){this.head=void 0,this.tail=void 0,this._length=0}function eC(e,t,n){this.item=e,this.previous=t,this.next=n}function tC(e,t){C(t.previous)&&C(t.next)?(t.previous.next=t.next,t.next.previous=t.previous):C(t.previous)?(t.previous.next=void 0,e.tail=t.previous):C(t.next)?(t.next.previous=void 0,e.head=t.next):(e.head=void 0,e.tail=void 0),t.next=void 0,t.previous=void 0}Object.defineProperties($T.prototype,{length:{get:function(){return this._length}}}),$T.prototype.add=function(e){const t=new eC(e,this.tail,void 0);return C(this.tail)?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t},$T.prototype.remove=function(e){C(e)&&(tC(this,e),--this._length)},$T.prototype.splice=function(e,t){if(e===t)return;tC(this,t);const n=e.next;e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e};var nC=$T,iC=(0,on.c)((function(e,t){var n=n||function(){var e=[];return{getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)},update:function(t,i){if(0===e.length)return!1;var o=0;t=void 0!==t?t:n.now();while(o<e.length)e[o].update(t)||i?o++:e.splice(o,1);return!0}}}();"undefined"===typeof window&&"undefined"!==typeof process?n.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!==typeof window&&void 0!==window.performance&&void 0!==window.performance.now?n.now=window.performance.now.bind(window.performance):void 0!==Date.now?n.now=Date.now:n.now=function(){return(new Date).getTime()},n.Tween=function(e){var t,i=e,o={},r={},s={},a=1e3,c=0,l=!1,u=!1,h=0,d=null,f=n.Easing.Linear.None,p=n.Interpolation.Linear,m=[],_=null,g=!1,y=null,v=null,b=null;this.to=function(e,t){return r=e,void 0!==t&&(a=t),this},this.start=function(e){for(var t in n.add(this),u=!0,g=!1,d=void 0!==e?e:n.now(),d+=h,r){if(r[t]instanceof Array){if(0===r[t].length)continue;r[t]=[i[t]].concat(r[t])}void 0!==i[t]&&(o[t]=i[t],o[t]instanceof Array===!1&&(o[t]*=1),s[t]=o[t]||0)}return this},this.stop=function(){return u?(n.remove(this),u=!1,null!==b&&b.call(i,i),this.stopChainedTweens(),this):this},this.end=function(){return this.update(d+a),this},this.stopChainedTweens=function(){for(var e=0,t=m.length;e<t;e++)m[e].stop()},this.delay=function(e){return h=e,this},this.repeat=function(e){return c=e,this},this.repeatDelay=function(e){return t=e,this},this.yoyo=function(e){return l=e,this},this.easing=function(e){return f=e,this},this.interpolation=function(e){return p=e,this},this.chain=function(){return m=arguments,this},this.onStart=function(e){return _=e,this},this.onUpdate=function(e){return y=e,this},this.onComplete=function(e){return v=e,this},this.onStop=function(e){return b=e,this},this.update=function(e){var n,u,b;if(e<d)return!0;for(n in!1===g&&(null!==_&&_.call(i,i),g=!0),u=(e-d)/a,u=u>1?1:u,b=f(u),r)if(void 0!==o[n]){var A=o[n]||0,w=r[n];w instanceof Array?i[n]=p(w,b):("string"===typeof w&&(w="+"===w.charAt(0)||"-"===w.charAt(0)?A+parseFloat(w):parseFloat(w)),"number"===typeof w&&(i[n]=A+(w-A)*b))}if(null!==y&&y.call(i,b),1===u){if(c>0){for(n in isFinite(c)&&c--,s){if("string"===typeof r[n]&&(s[n]=s[n]+parseFloat(r[n])),l){var T=s[n];s[n]=r[n],r[n]=T}o[n]=s[n]}return d=void 0!==t?e+t:e+h,!0}null!==v&&v.call(i,i);for(var C=0,E=m.length;C<E;C++)m[C].start(d+a);return!1}return!0}},n.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2,e<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-n.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*n.Easing.Bounce.In(2*e):.5*n.Easing.Bounce.Out(2*e-1)+.5}}},n.Interpolation={Linear:function(e,t){var i=e.length-1,o=i*t,r=Math.floor(o),s=n.Interpolation.Utils.Linear;return t<0?s(e[0],e[1],o):t>1?s(e[i],e[i-1],i-o):s(e[r],e[r+1>i?i:r+1],o-r)},Bezier:function(e,t){for(var i=0,o=e.length-1,r=Math.pow,s=n.Interpolation.Utils.Bernstein,a=0;a<=o;a++)i+=r(1-t,o-a)*r(t,a)*e[a]*s(o,a);return i},CatmullRom:function(e,t){var i=e.length-1,o=i*t,r=Math.floor(o),s=n.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(r=Math.floor(o=i*(1+t))),s(e[(r-1+i)%i],e[r],e[(r+1)%i],e[(r+2)%i],o-r)):t<0?e[0]-(s(e[0],e[0],e[1],e[1],-o)-e[0]):t>1?e[i]-(s(e[i],e[i],e[i-1],e[i-1],o-i)-e[i]):s(e[r?r-1:0],e[r],e[i<r+1?i:r+1],e[i<r+2?i:r+2],o-r)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var i=n.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var n=1;if(e[t])return e[t];for(var i=t;i>1;i--)n*=i;return e[t]=n,n}}(),CatmullRom:function(e,t,n,i,o){var r=.5*(n-e),s=.5*(i-t),a=o*o,c=o*a;return(2*t-2*n+r+s)*c+(-3*t+3*n-2*r-s)*a+r*o+t}}},function(t){e.exports=n}()}));const oC={LINEAR_NONE:iC.Easing.Linear.None,QUADRATIC_IN:iC.Easing.Quadratic.In,QUADRATIC_OUT:iC.Easing.Quadratic.Out,QUADRATIC_IN_OUT:iC.Easing.Quadratic.InOut,CUBIC_IN:iC.Easing.Cubic.In,CUBIC_OUT:iC.Easing.Cubic.Out,CUBIC_IN_OUT:iC.Easing.Cubic.InOut,QUARTIC_IN:iC.Easing.Quartic.In,QUARTIC_OUT:iC.Easing.Quartic.Out,QUARTIC_IN_OUT:iC.Easing.Quartic.InOut,QUINTIC_IN:iC.Easing.Quintic.In,QUINTIC_OUT:iC.Easing.Quintic.Out,QUINTIC_IN_OUT:iC.Easing.Quintic.InOut,SINUSOIDAL_IN:iC.Easing.Sinusoidal.In,SINUSOIDAL_OUT:iC.Easing.Sinusoidal.Out,SINUSOIDAL_IN_OUT:iC.Easing.Sinusoidal.InOut,EXPONENTIAL_IN:iC.Easing.Exponential.In,EXPONENTIAL_OUT:iC.Easing.Exponential.Out,EXPONENTIAL_IN_OUT:iC.Easing.Exponential.InOut,CIRCULAR_IN:iC.Easing.Circular.In,CIRCULAR_OUT:iC.Easing.Circular.Out,CIRCULAR_IN_OUT:iC.Easing.Circular.InOut,ELASTIC_IN:iC.Easing.Elastic.In,ELASTIC_OUT:iC.Easing.Elastic.Out,ELASTIC_IN_OUT:iC.Easing.Elastic.InOut,BACK_IN:iC.Easing.Back.In,BACK_OUT:iC.Easing.Back.Out,BACK_IN_OUT:iC.Easing.Back.InOut,BOUNCE_IN:iC.Easing.Bounce.In,BOUNCE_OUT:iC.Easing.Bounce.Out,BOUNCE_IN_OUT:iC.Easing.Bounce.InOut};var rC=Object.freeze(oC);const sC=new K,aC=new K,cC=new K,lC=new K,uC=new K,hC=new K(1,1,1),dC=Math.cos,fC=Math.sin;function pC(e){e=R(e,R.EMPTY_OBJECT);const t=R(e.radii,hC),n=R(e.innerRadii,t),i=R(e.minimumClock,0),o=R(e.maximumClock,z.TWO_PI),r=R(e.minimumCone,0),s=R(e.maximumCone,z.PI),a=Math.round(R(e.stackPartitions,64)),c=Math.round(R(e.slicePartitions,64)),l=R(e.vertexFormat,jf.DEFAULT);if(c<3)throw new x("options.slicePartitions cannot be less than three.");if(a<3)throw new x("options.stackPartitions cannot be less than three.");this._radii=K.clone(t),this._innerRadii=K.clone(n),this._minimumClock=i,this._maximumClock=o,this._minimumCone=r,this._maximumCone=s,this._stackPartitions=a,this._slicePartitions=c,this._vertexFormat=jf.clone(l),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipsoidGeometry"}pC.packedLength=2*K.packedLength+jf.packedLength+7,pC.pack=function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");return n=R(n,0),K.pack(e._radii,t,n),n+=K.packedLength,K.pack(e._innerRadii,t,n),n+=K.packedLength,jf.pack(e._vertexFormat,t,n),n+=jf.packedLength,t[n++]=e._minimumClock,t[n++]=e._maximumClock,t[n++]=e._minimumCone,t[n++]=e._maximumCone,t[n++]=e._stackPartitions,t[n++]=e._slicePartitions,t[n]=R(e._offsetAttribute,-1),t};const mC=new K,_C=new K,gC=new jf,yC={radii:mC,innerRadii:_C,vertexFormat:gC,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};let vC;pC.unpack=function(e,t,n){if(!C(e))throw new x("array is required");t=R(t,0);const i=K.unpack(e,t,mC);t+=K.packedLength;const o=K.unpack(e,t,_C);t+=K.packedLength;const r=jf.unpack(e,t,gC);t+=jf.packedLength;const s=e[t++],a=e[t++],c=e[t++],l=e[t++],u=e[t++],h=e[t++],d=e[t];return C(n)?(n._radii=K.clone(i,n._radii),n._innerRadii=K.clone(o,n._innerRadii),n._vertexFormat=jf.clone(r,n._vertexFormat),n._minimumClock=s,n._maximumClock=a,n._minimumCone=c,n._maximumCone=l,n._stackPartitions=u,n._slicePartitions=h,n._offsetAttribute=-1===d?void 0:d,n):(yC.minimumClock=s,yC.maximumClock=a,yC.minimumCone=c,yC.maximumCone=l,yC.stackPartitions=u,yC.slicePartitions=h,yC.offsetAttribute=-1===d?void 0:d,new pC(yC))},pC.createGeometry=function(e){const t=e._radii;if(t.x<=0||t.y<=0||t.z<=0)return;const n=e._innerRadii;if(n.x<=0||n.y<=0||n.z<=0)return;const i=e._minimumClock,o=e._maximumClock,r=e._minimumCone,s=e._maximumCone,a=e._vertexFormat;let c,l,u=e._slicePartitions+1,h=e._stackPartitions+1;u=Math.round(u*Math.abs(o-i)/z.TWO_PI),h=Math.round(h*Math.abs(s-r)/z.PI),u<2&&(u=2),h<2&&(h=2);let d=0;const f=[r],p=[i];for(c=0;c<h;c++)f.push(r+c*(s-r)/(h-1));for(f.push(s),l=0;l<u;l++)p.push(i+l*(o-i)/(u-1));p.push(o);const m=f.length,_=p.length;let g=0,y=1;const v=n.x!==t.x||n.y!==t.y||n.z!==t.z;let b=!1,A=!1,w=!1;v&&(y=2,r>0&&(b=!0,g+=u-1),s<Math.PI&&(A=!0,g+=u-1),(o-i)%z.TWO_PI?(w=!0,g+=2*(h-1)+1):g+=1);const T=_*m*y,E=new Float64Array(3*T),x=wf(new Array(T),!1),S=wf(new Array(T),!1),I=u*h*y,O=6*(I+g+1-(u+h)*y),D=fd.createTypedArray(I,O),P=a.normal?new Float32Array(3*T):void 0,R=a.tangent?new Float32Array(3*T):void 0,L=a.bitangent?new Float32Array(3*T):void 0,M=a.st?new Float32Array(2*T):void 0,B=new Array(m),N=new Array(m);for(c=0;c<m;c++)B[c]=fC(f[c]),N[c]=dC(f[c]);const F=new Array(_),k=new Array(_);for(l=0;l<_;l++)k[l]=dC(p[l]),F[l]=fC(p[l]);for(c=0;c<m;c++)for(l=0;l<_;l++)E[d++]=t.x*B[c]*k[l],E[d++]=t.y*B[c]*F[l],E[d++]=t.z*N[c];let U,V,H,G,W=T/2;if(v)for(c=0;c<m;c++)for(l=0;l<_;l++)E[d++]=n.x*B[c]*k[l],E[d++]=n.y*B[c]*F[l],E[d++]=n.z*N[c],x[W]=!0,c>0&&c!==m-1&&0!==l&&l!==_-1&&(S[W]=!0),W++;for(d=0,c=1;c<m-2;c++)for(U=c*_,V=(c+1)*_,l=1;l<_-2;l++)D[d++]=V+l,D[d++]=V+l+1,D[d++]=U+l+1,D[d++]=V+l,D[d++]=U+l+1,D[d++]=U+l;if(v){const e=m*_;for(c=1;c<m-2;c++)for(U=e+c*_,V=e+(c+1)*_,l=1;l<_-2;l++)D[d++]=V+l,D[d++]=U+l,D[d++]=U+l+1,D[d++]=V+l,D[d++]=U+l+1,D[d++]=V+l+1}if(v){if(b)for(G=m*_,c=1;c<_-2;c++)D[d++]=c,D[d++]=c+1,D[d++]=G+c+1,D[d++]=c,D[d++]=G+c+1,D[d++]=G+c;if(A)for(H=m*_-_,G=m*_*y-_,c=1;c<_-2;c++)D[d++]=H+c+1,D[d++]=H+c,D[d++]=G+c,D[d++]=H+c+1,D[d++]=G+c,D[d++]=G+c+1}if(w){for(c=1;c<m-2;c++)G=_*m+_*c,H=_*c,D[d++]=G,D[d++]=H+_,D[d++]=H,D[d++]=G,D[d++]=G+_,D[d++]=H+_;for(c=1;c<m-2;c++)G=_*m+_*(c+1)-1,H=_*(c+1)-1,D[d++]=H+_,D[d++]=G,D[d++]=H,D[d++]=H+_,D[d++]=G+_,D[d++]=G}const q=new Hf;a.position&&(q.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:E}));let j=0,Y=0,X=0,Q=0;const J=T/2;let Z;const $=ge.fromCartesian3(t),ee=ge.fromCartesian3(n);if(a.st||a.normal||a.tangent||a.bitangent){for(c=0;c<T;c++){Z=x[c]?ee:$;const e=K.fromArray(E,3*c,sC),t=Z.geodeticSurfaceNormal(e,aC);if(S[c]&&K.negate(t,t),a.st){const e=ro.negate(t,uC);M[j++]=Math.atan2(e.y,e.x)/z.TWO_PI+.5,M[j++]=Math.asin(t.z)/Math.PI+.5}if(a.normal&&(P[Y++]=t.x,P[Y++]=t.y,P[Y++]=t.z),a.tangent||a.bitangent){const e=cC;let n,i=0;if(x[c]&&(i=J),n=!b&&c>=i&&c<i+2*_?K.UNIT_X:K.UNIT_Z,K.cross(n,t,e),K.normalize(e,e),a.tangent&&(R[X++]=e.x,R[X++]=e.y,R[X++]=e.z),a.bitangent){const n=K.cross(t,e,lC);K.normalize(n,n),L[Q++]=n.x,L[Q++]=n.y,L[Q++]=n.z}}}a.st&&(q.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:M})),a.normal&&(q.normal=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:P})),a.tangent&&(q.tangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:R})),a.bitangent&&(q.bitangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:L}))}if(C(e._offsetAttribute)){const t=E.length,n=new Uint8Array(t/3),i=e._offsetAttribute===Wf.NONE?0:1;wf(n,i),q.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}return new zf({attributes:q,indices:D,primitiveType:xf.TRIANGLES,boundingSphere:nn.fromEllipsoid($),offsetAttribute:e._offsetAttribute})},pC.getUnitEllipsoid=function(){return C(vC)||(vC=pC.createGeometry(new pC({radii:new K(1,1,1),vertexFormat:jf.POSITION_ONLY}))),vC};var bC=pC;const AC=new K(1,1,1),wC=Math.cos,TC=Math.sin;function CC(e){e=R(e,R.EMPTY_OBJECT);const t=R(e.radii,AC),n=R(e.innerRadii,t),i=R(e.minimumClock,0),o=R(e.maximumClock,z.TWO_PI),r=R(e.minimumCone,0),s=R(e.maximumCone,z.PI),a=Math.round(R(e.stackPartitions,10)),c=Math.round(R(e.slicePartitions,8)),l=Math.round(R(e.subdivisions,128));if(a<1)throw new x("options.stackPartitions cannot be less than 1");if(c<0)throw new x("options.slicePartitions cannot be less than 0");if(l<0)throw new x("options.subdivisions must be greater than or equal to zero.");if(C(e.offsetAttribute)&&e.offsetAttribute===Wf.TOP)throw new x("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._radii=K.clone(t),this._innerRadii=K.clone(n),this._minimumClock=i,this._maximumClock=o,this._minimumCone=r,this._maximumCone=s,this._stackPartitions=a,this._slicePartitions=c,this._subdivisions=l,this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipsoidOutlineGeometry"}CC.packedLength=2*K.packedLength+8,CC.pack=function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");return n=R(n,0),K.pack(e._radii,t,n),n+=K.packedLength,K.pack(e._innerRadii,t,n),n+=K.packedLength,t[n++]=e._minimumClock,t[n++]=e._maximumClock,t[n++]=e._minimumCone,t[n++]=e._maximumCone,t[n++]=e._stackPartitions,t[n++]=e._slicePartitions,t[n++]=e._subdivisions,t[n]=R(e._offsetAttribute,-1),t};const EC=new K,xC=new K,SC={radii:EC,innerRadii:xC,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,subdivisions:void 0,offsetAttribute:void 0};CC.unpack=function(e,t,n){if(!C(e))throw new x("array is required");t=R(t,0);const i=K.unpack(e,t,EC);t+=K.packedLength;const o=K.unpack(e,t,xC);t+=K.packedLength;const r=e[t++],s=e[t++],a=e[t++],c=e[t++],l=e[t++],u=e[t++],h=e[t++],d=e[t];return C(n)?(n._radii=K.clone(i,n._radii),n._innerRadii=K.clone(o,n._innerRadii),n._minimumClock=r,n._maximumClock=s,n._minimumCone=a,n._maximumCone=c,n._stackPartitions=l,n._slicePartitions=u,n._subdivisions=h,n._offsetAttribute=-1===d?void 0:d,n):(SC.minimumClock=r,SC.maximumClock=s,SC.minimumCone=a,SC.maximumCone=c,SC.stackPartitions=l,SC.slicePartitions=u,SC.subdivisions=h,SC.offsetAttribute=-1===d?void 0:d,new CC(SC))},CC.createGeometry=function(e){const t=e._radii;if(t.x<=0||t.y<=0||t.z<=0)return;const n=e._innerRadii;if(n.x<=0||n.y<=0||n.z<=0)return;const i=e._minimumClock,o=e._maximumClock,r=e._minimumCone,s=e._maximumCone,a=e._subdivisions,c=ge.fromCartesian3(t);let l=e._slicePartitions+1,u=e._stackPartitions+1;l=Math.round(l*Math.abs(o-i)/z.TWO_PI),u=Math.round(u*Math.abs(s-r)/z.PI),l<2&&(l=2),u<2&&(u=2);let h=0,d=1;const f=n.x!==t.x||n.y!==t.y||n.z!==t.z;let p=!1,m=!1;f&&(d=2,r>0&&(p=!0,h+=l),s<Math.PI&&(m=!0,h+=l));const _=a*d*(u+l),g=new Float64Array(3*_),y=2*(_+h-(l+u)*d),v=fd.createTypedArray(_,y);let b,A,w,T,E=0;const x=new Array(u),S=new Array(u);for(b=0;b<u;b++)T=r+b*(s-r)/(u-1),x[b]=TC(T),S[b]=wC(T);const I=new Array(a),O=new Array(a);for(b=0;b<a;b++)w=i+b*(o-i)/(a-1),I[b]=TC(w),O[b]=wC(w);for(b=0;b<u;b++)for(A=0;A<a;A++)g[E++]=t.x*x[b]*O[A],g[E++]=t.y*x[b]*I[A],g[E++]=t.z*S[b];if(f)for(b=0;b<u;b++)for(A=0;A<a;A++)g[E++]=n.x*x[b]*O[A],g[E++]=n.y*x[b]*I[A],g[E++]=n.z*S[b];for(x.length=a,S.length=a,b=0;b<a;b++)T=r+b*(s-r)/(a-1),x[b]=TC(T),S[b]=wC(T);for(I.length=l,O.length=l,b=0;b<l;b++)w=i+b*(o-i)/(l-1),I[b]=TC(w),O[b]=wC(w);for(b=0;b<a;b++)for(A=0;A<l;A++)g[E++]=t.x*x[b]*O[A],g[E++]=t.y*x[b]*I[A],g[E++]=t.z*S[b];if(f)for(b=0;b<a;b++)for(A=0;A<l;A++)g[E++]=n.x*x[b]*O[A],g[E++]=n.y*x[b]*I[A],g[E++]=n.z*S[b];for(E=0,b=0;b<u*d;b++){const e=b*a;for(A=0;A<a-1;A++)v[E++]=e+A,v[E++]=e+A+1}let D=u*a*d;for(b=0;b<l;b++)for(A=0;A<a-1;A++)v[E++]=D+b+A*l,v[E++]=D+b+(A+1)*l;if(f)for(D=u*a*d+l*a,b=0;b<l;b++)for(A=0;A<a-1;A++)v[E++]=D+b+A*l,v[E++]=D+b+(A+1)*l;if(f){let e=u*a*d,t=e+a*l;if(p)for(b=0;b<l;b++)v[E++]=e+b,v[E++]=t+b;if(m)for(e+=a*l-l,t+=a*l-l,b=0;b<l;b++)v[E++]=e+b,v[E++]=t+b}const P=new Hf({position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:g})});if(C(e._offsetAttribute)){const t=g.length,n=new Uint8Array(t/3),i=e._offsetAttribute===Wf.NONE?0:1;wf(n,i),P.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}return new zf({attributes:P,indices:v,primitiveType:xf.LINES,boundingSphere:nn.fromEllipsoid(c),offsetAttribute:e._offsetAttribute})};var IC=CC;function OC(e){e=R(e,R.EMPTY_OBJECT),this._tilingScheme=e.tilingScheme,C(this._tilingScheme)||(this._tilingScheme=new ao({ellipsoid:R(e.ellipsoid,ge.WGS84)})),this._levelZeroMaximumGeometricError=Ad.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,64,this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._errorEvent=new $n,this._readyPromise=Promise.resolve(!0)}Object.defineProperties(OC.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){}},tilingScheme:{get:function(){return this._tilingScheme}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){}}}),OC.prototype.requestTileGeometry=function(e,t,n,i){const o=16,r=16;return Promise.resolve(new Pd({buffer:new Uint8Array(o*r),width:o,height:r}))},OC.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},OC.prototype.getTileDataAvailable=function(e,t,n){},OC.prototype.loadTileDataAvailability=function(e,t,n){};var DC=OC;function PC(){this._removalFunctions=[]}PC.prototype.add=function(e,t,n){if(!C(e))throw new x("event is required");const i=e.addEventListener(t,n);this._removalFunctions.push(i);const o=this;return function(){i();const e=o._removalFunctions;e.splice(e.indexOf(i),1)}},PC.prototype.removeAll=function(){const e=this._removalFunctions;for(let t=0,n=e.length;t<n;++t)e[t]();e.length=0};var RC=PC;const LC={enableModelExperimental:!1};var MC=LC;const BC={NONE:0,HOLD:1,EXTRAPOLATE:2};var NC=Object.freeze(BC);function FC(e){e=R(e,R.EMPTY_OBJECT),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=R(e.near,1),this._near=this.near,this.far=R(e.far,5e8),this._far=this.far,this._cullingVolume=new CT,this._orthographicMatrix=new ft}function zC(e){if(!C(e.right)||!C(e.left)||!C(e.top)||!C(e.bottom)||!C(e.near)||!C(e.far))throw new x("right, left, top, bottom, near, or far parameters are not set.");if(e.top!==e._top||e.bottom!==e._bottom||e.left!==e._left||e.right!==e._right||e.near!==e._near||e.far!==e._far){if(e.left>e.right)throw new x("right must be greater than left.");if(e.bottom>e.top)throw new x("top must be greater than bottom.");if(e.near<=0||e.near>e.far)throw new x("near must be greater than zero and less than far.");e._left=e.left,e._right=e.right,e._top=e.top,e._bottom=e.bottom,e._near=e.near,e._far=e.far,e._orthographicMatrix=ft.computeOrthographicOffCenter(e.left,e.right,e.bottom,e.top,e.near,e.far,e._orthographicMatrix)}}Object.defineProperties(FC.prototype,{projectionMatrix:{get:function(){return zC(this),this._orthographicMatrix}}});const kC=new K,UC=new K,VC=new K,HC=new K;FC.prototype.computeCullingVolume=function(e,t,n){if(!C(e))throw new x("position is required.");if(!C(t))throw new x("direction is required.");if(!C(n))throw new x("up is required.");const i=this._cullingVolume.planes,o=this.top,r=this.bottom,s=this.right,a=this.left,c=this.near,l=this.far,u=K.cross(t,n,kC);K.normalize(u,u);const h=UC;K.multiplyByScalar(t,c,h),K.add(e,h,h);const d=VC;K.multiplyByScalar(u,a,d),K.add(h,d,d);let f=i[0];return C(f)||(f=i[0]=new Xe),f.x=u.x,f.y=u.y,f.z=u.z,f.w=-K.dot(u,d),K.multiplyByScalar(u,s,d),K.add(h,d,d),f=i[1],C(f)||(f=i[1]=new Xe),f.x=-u.x,f.y=-u.y,f.z=-u.z,f.w=-K.dot(K.negate(u,HC),d),K.multiplyByScalar(n,r,d),K.add(h,d,d),f=i[2],C(f)||(f=i[2]=new Xe),f.x=n.x,f.y=n.y,f.z=n.z,f.w=-K.dot(n,d),K.multiplyByScalar(n,o,d),K.add(h,d,d),f=i[3],C(f)||(f=i[3]=new Xe),f.x=-n.x,f.y=-n.y,f.z=-n.z,f.w=-K.dot(K.negate(n,HC),d),f=i[4],C(f)||(f=i[4]=new Xe),f.x=t.x,f.y=t.y,f.z=t.z,f.w=-K.dot(t,h),K.multiplyByScalar(t,l,d),K.add(e,d,d),f=i[5],C(f)||(f=i[5]=new Xe),f.x=-t.x,f.y=-t.y,f.z=-t.z,f.w=-K.dot(K.negate(t,HC),d),this._cullingVolume},FC.prototype.getPixelDimensions=function(e,t,n,i,o){if(zC(this),!C(e)||!C(t))throw new x("Both drawingBufferWidth and drawingBufferHeight are required.");if(e<=0)throw new x("drawingBufferWidth must be greater than zero.");if(t<=0)throw new x("drawingBufferHeight must be greater than zero.");if(!C(n))throw new x("distance is required.");if(!C(i))throw new x("pixelRatio is required.");if(i<=0)throw new x("pixelRatio must be greater than zero.");if(!C(o))throw new x("A result object is required.");const r=this.right-this.left,s=this.top-this.bottom,a=i*r/e,c=i*s/t;return o.x=a,o.y=c,o},FC.prototype.clone=function(e){return C(e)||(e=new FC),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e._left=void 0,e._right=void 0,e._top=void 0,e._bottom=void 0,e._near=void 0,e._far=void 0,e},FC.prototype.equals=function(e){return C(e)&&e instanceof FC&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far},FC.prototype.equalsEpsilon=function(e,t,n){return e===this||C(e)&&e instanceof FC&&z.equalsEpsilon(this.right,e.right,t,n)&&z.equalsEpsilon(this.left,e.left,t,n)&&z.equalsEpsilon(this.top,e.top,t,n)&&z.equalsEpsilon(this.bottom,e.bottom,t,n)&&z.equalsEpsilon(this.near,e.near,t,n)&&z.equalsEpsilon(this.far,e.far,t,n)};var GC=FC;function WC(e){e=R(e,R.EMPTY_OBJECT),this._offCenterFrustum=new GC,this.width=e.width,this._width=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=R(e.near,1),this._near=this.near,this.far=R(e.far,5e8),this._far=this.far}function qC(e){if(!C(e.width)||!C(e.aspectRatio)||!C(e.near)||!C(e.far))throw new x("width, aspectRatio, near, or far parameters are not set.");const t=e._offCenterFrustum;if(e.width!==e._width||e.aspectRatio!==e._aspectRatio||e.near!==e._near||e.far!==e._far){if(e.aspectRatio<0)throw new x("aspectRatio must be positive.");if(e.near<0||e.near>e.far)throw new x("near must be greater than zero and less than far.");e._aspectRatio=e.aspectRatio,e._width=e.width,e._near=e.near,e._far=e.far;const n=1/e.aspectRatio;t.right=.5*e.width,t.left=-t.right,t.top=n*t.right,t.bottom=-t.top,t.near=e.near,t.far=e.far}}WC.packedLength=4,WC.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),t[n++]=e.width,t[n++]=e.aspectRatio,t[n++]=e.near,t[n]=e.far,t},WC.unpack=function(e,t,n){return D.defined("array",e),t=R(t,0),C(n)||(n=new WC),n.width=e[t++],n.aspectRatio=e[t++],n.near=e[t++],n.far=e[t],n},Object.defineProperties(WC.prototype,{projectionMatrix:{get:function(){return qC(this),this._offCenterFrustum.projectionMatrix}}}),WC.prototype.computeCullingVolume=function(e,t,n){return qC(this),this._offCenterFrustum.computeCullingVolume(e,t,n)},WC.prototype.getPixelDimensions=function(e,t,n,i,o){return qC(this),this._offCenterFrustum.getPixelDimensions(e,t,n,i,o)},WC.prototype.clone=function(e){return C(e)||(e=new WC),e.aspectRatio=this.aspectRatio,e.width=this.width,e.near=this.near,e.far=this.far,e._aspectRatio=void 0,e._width=void 0,e._near=void 0,e._far=void 0,this._offCenterFrustum.clone(e._offCenterFrustum),e},WC.prototype.equals=function(e){return!!(C(e)&&e instanceof WC)&&(qC(this),qC(e),this.width===e.width&&this.aspectRatio===e.aspectRatio&&this._offCenterFrustum.equals(e._offCenterFrustum))},WC.prototype.equalsEpsilon=function(e,t,n){return!!(C(e)&&e instanceof WC)&&(qC(this),qC(e),z.equalsEpsilon(this.width,e.width,t,n)&&z.equalsEpsilon(this.aspectRatio,e.aspectRatio,t,n)&&this._offCenterFrustum.equalsEpsilon(e._offCenterFrustum,t,n))};var jC=WC;function YC(e){e=R(e,R.EMPTY_OBJECT),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=R(e.near,1),this._near=this.near,this.far=R(e.far,5e8),this._far=this.far,this._cullingVolume=new CT,this._perspectiveMatrix=new ft,this._infinitePerspective=new ft}function KC(e){if(!C(e.right)||!C(e.left)||!C(e.top)||!C(e.bottom)||!C(e.near)||!C(e.far))throw new x("right, left, top, bottom, near, or far parameters are not set.");const t=e.top,n=e.bottom,i=e.right,o=e.left,r=e.near,s=e.far;if(t!==e._top||n!==e._bottom||o!==e._left||i!==e._right||r!==e._near||s!==e._far){if(e.near<=0||e.near>e.far)throw new x("near must be greater than zero and less than far.");e._left=o,e._right=i,e._top=t,e._bottom=n,e._near=r,e._far=s,e._perspectiveMatrix=ft.computePerspectiveOffCenter(o,i,n,t,r,s,e._perspectiveMatrix),e._infinitePerspective=ft.computeInfinitePerspectiveOffCenter(o,i,n,t,r,e._infinitePerspective)}}Object.defineProperties(YC.prototype,{projectionMatrix:{get:function(){return KC(this),this._perspectiveMatrix}},infiniteProjectionMatrix:{get:function(){return KC(this),this._infinitePerspective}}});const XC=new K,QC=new K,JC=new K,ZC=new K;YC.prototype.computeCullingVolume=function(e,t,n){if(!C(e))throw new x("position is required.");if(!C(t))throw new x("direction is required.");if(!C(n))throw new x("up is required.");const i=this._cullingVolume.planes,o=this.top,r=this.bottom,s=this.right,a=this.left,c=this.near,l=this.far,u=K.cross(t,n,XC),h=QC;K.multiplyByScalar(t,c,h),K.add(e,h,h);const d=JC;K.multiplyByScalar(t,l,d),K.add(e,d,d);const f=ZC;K.multiplyByScalar(u,a,f),K.add(h,f,f),K.subtract(f,e,f),K.normalize(f,f),K.cross(f,n,f),K.normalize(f,f);let p=i[0];return C(p)||(p=i[0]=new Xe),p.x=f.x,p.y=f.y,p.z=f.z,p.w=-K.dot(f,e),K.multiplyByScalar(u,s,f),K.add(h,f,f),K.subtract(f,e,f),K.cross(n,f,f),K.normalize(f,f),p=i[1],C(p)||(p=i[1]=new Xe),p.x=f.x,p.y=f.y,p.z=f.z,p.w=-K.dot(f,e),K.multiplyByScalar(n,r,f),K.add(h,f,f),K.subtract(f,e,f),K.cross(u,f,f),K.normalize(f,f),p=i[2],C(p)||(p=i[2]=new Xe),p.x=f.x,p.y=f.y,p.z=f.z,p.w=-K.dot(f,e),K.multiplyByScalar(n,o,f),K.add(h,f,f),K.subtract(f,e,f),K.cross(f,u,f),K.normalize(f,f),p=i[3],C(p)||(p=i[3]=new Xe),p.x=f.x,p.y=f.y,p.z=f.z,p.w=-K.dot(f,e),p=i[4],C(p)||(p=i[4]=new Xe),p.x=t.x,p.y=t.y,p.z=t.z,p.w=-K.dot(t,h),K.negate(t,f),p=i[5],C(p)||(p=i[5]=new Xe),p.x=f.x,p.y=f.y,p.z=f.z,p.w=-K.dot(f,d),this._cullingVolume},YC.prototype.getPixelDimensions=function(e,t,n,i,o){if(KC(this),!C(e)||!C(t))throw new x("Both drawingBufferWidth and drawingBufferHeight are required.");if(e<=0)throw new x("drawingBufferWidth must be greater than zero.");if(t<=0)throw new x("drawingBufferHeight must be greater than zero.");if(!C(n))throw new x("distance is required.");if(!C(i))throw new x("pixelRatio is required");if(i<=0)throw new x("pixelRatio must be greater than zero.");if(!C(o))throw new x("A result object is required.");const r=1/this.near;let s=this.top*r;const a=2*i*n*s/t;s=this.right*r;const c=2*i*n*s/e;return o.x=c,o.y=a,o},YC.prototype.clone=function(e){return C(e)||(e=new YC),e.right=this.right,e.left=this.left,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e._left=void 0,e._right=void 0,e._top=void 0,e._bottom=void 0,e._near=void 0,e._far=void 0,e},YC.prototype.equals=function(e){return C(e)&&e instanceof YC&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far},YC.prototype.equalsEpsilon=function(e,t,n){return e===this||C(e)&&e instanceof YC&&z.equalsEpsilon(this.right,e.right,t,n)&&z.equalsEpsilon(this.left,e.left,t,n)&&z.equalsEpsilon(this.top,e.top,t,n)&&z.equalsEpsilon(this.bottom,e.bottom,t,n)&&z.equalsEpsilon(this.near,e.near,t,n)&&z.equalsEpsilon(this.far,e.far,t,n)};var $C=YC;function eE(e){e=R(e,R.EMPTY_OBJECT),this._offCenterFrustum=new $C,this.fov=e.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=R(e.near,1),this._near=this.near,this.far=R(e.far,5e8),this._far=this.far,this.xOffset=R(e.xOffset,0),this._xOffset=this.xOffset,this.yOffset=R(e.yOffset,0),this._yOffset=this.yOffset}function tE(e){if(!C(e.fov)||!C(e.aspectRatio)||!C(e.near)||!C(e.far))throw new x("fov, aspectRatio, near, or far parameters are not set.");const t=e._offCenterFrustum;if(e.fov!==e._fov||e.aspectRatio!==e._aspectRatio||e.near!==e._near||e.far!==e._far||e.xOffset!==e._xOffset||e.yOffset!==e._yOffset){if(e.fov<0||e.fov>=Math.PI)throw new x("fov must be in the range [0, PI).");if(e.aspectRatio<0)throw new x("aspectRatio must be positive.");if(e.near<0||e.near>e.far)throw new x("near must be greater than zero and less than far.");e._aspectRatio=e.aspectRatio,e._fov=e.fov,e._fovy=e.aspectRatio<=1?e.fov:2*Math.atan(Math.tan(.5*e.fov)/e.aspectRatio),e._near=e.near,e._far=e.far,e._sseDenominator=2*Math.tan(.5*e._fovy),e._xOffset=e.xOffset,e._yOffset=e.yOffset,t.top=e.near*Math.tan(.5*e._fovy),t.bottom=-t.top,t.right=e.aspectRatio*t.top,t.left=-t.right,t.near=e.near,t.far=e.far,t.right+=e.xOffset,t.left+=e.xOffset,t.top+=e.yOffset,t.bottom+=e.yOffset}}eE.packedLength=6,eE.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),t[n++]=e.fov,t[n++]=e.aspectRatio,t[n++]=e.near,t[n++]=e.far,t[n++]=e.xOffset,t[n]=e.yOffset,t},eE.unpack=function(e,t,n){return D.defined("array",e),t=R(t,0),C(n)||(n=new eE),n.fov=e[t++],n.aspectRatio=e[t++],n.near=e[t++],n.far=e[t++],n.xOffset=e[t++],n.yOffset=e[t],n},Object.defineProperties(eE.prototype,{projectionMatrix:{get:function(){return tE(this),this._offCenterFrustum.projectionMatrix}},infiniteProjectionMatrix:{get:function(){return tE(this),this._offCenterFrustum.infiniteProjectionMatrix}},fovy:{get:function(){return tE(this),this._fovy}},sseDenominator:{get:function(){return tE(this),this._sseDenominator}}}),eE.prototype.computeCullingVolume=function(e,t,n){return tE(this),this._offCenterFrustum.computeCullingVolume(e,t,n)},eE.prototype.getPixelDimensions=function(e,t,n,i,o){return tE(this),this._offCenterFrustum.getPixelDimensions(e,t,n,i,o)},eE.prototype.clone=function(e){return C(e)||(e=new eE),e.aspectRatio=this.aspectRatio,e.fov=this.fov,e.near=this.near,e.far=this.far,e._aspectRatio=void 0,e._fov=void 0,e._near=void 0,e._far=void 0,this._offCenterFrustum.clone(e._offCenterFrustum),e},eE.prototype.equals=function(e){return!!(C(e)&&e instanceof eE)&&(tE(this),tE(e),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this._offCenterFrustum.equals(e._offCenterFrustum))},eE.prototype.equalsEpsilon=function(e,t,n){return!!(C(e)&&e instanceof eE)&&(tE(this),tE(e),z.equalsEpsilon(this.fov,e.fov,t,n)&&z.equalsEpsilon(this.aspectRatio,e.aspectRatio,t,n)&&this._offCenterFrustum.equalsEpsilon(e._offCenterFrustum,t,n))};var nE=eE;const iE=0,oE=1;function rE(e){D.typeOf.object("options",e),D.typeOf.object("options.frustum",e.frustum),D.typeOf.object("options.origin",e.origin),D.typeOf.object("options.orientation",e.orientation);const t=e.frustum,n=e.orientation,i=e.origin,o=R(e.vertexFormat,jf.DEFAULT),r=R(e._drawNearPlane,!0);let s,a;t instanceof nE?(s=iE,a=nE.packedLength):t instanceof jC&&(s=oE,a=jC.packedLength),this._frustumType=s,this._frustum=t.clone(),this._origin=K.clone(i),this._orientation=il.clone(n),this._drawNearPlane=r,this._vertexFormat=o,this._workerName="createFrustumGeometry",this.packedLength=2+a+K.packedLength+il.packedLength+jf.packedLength}rE.pack=function(e,t,n){D.typeOf.object("value",e),D.defined("array",t),n=R(n,0);const i=e._frustumType,o=e._frustum;return t[n++]=i,i===iE?(nE.pack(o,t,n),n+=nE.packedLength):(jC.pack(o,t,n),n+=jC.packedLength),K.pack(e._origin,t,n),n+=K.packedLength,il.pack(e._orientation,t,n),n+=il.packedLength,jf.pack(e._vertexFormat,t,n),n+=jf.packedLength,t[n]=e._drawNearPlane?1:0,t};const sE=new nE,aE=new jC,cE=new il,lE=new K,uE=new jf;function hE(e,t,n,i,o,r,s,a){const c=e/3*2;for(let l=0;l<4;++l)C(t)&&(t[e]=r.x,t[e+1]=r.y,t[e+2]=r.z),C(n)&&(n[e]=s.x,n[e+1]=s.y,n[e+2]=s.z),C(i)&&(i[e]=a.x,i[e+1]=a.y,i[e+2]=a.z),e+=3;o[c]=0,o[c+1]=0,o[c+2]=1,o[c+3]=0,o[c+4]=1,o[c+5]=1,o[c+6]=0,o[c+7]=1}rE.unpack=function(e,t,n){D.defined("array",e),t=R(t,0);const i=e[t++];let o;i===iE?(o=nE.unpack(e,t,sE),t+=nE.packedLength):(o=jC.unpack(e,t,aE),t+=jC.packedLength);const r=K.unpack(e,t,lE);t+=K.packedLength;const s=il.unpack(e,t,cE);t+=il.packedLength;const a=jf.unpack(e,t,uE);t+=jf.packedLength;const c=1===e[t];if(!C(n))return new rE({frustum:o,origin:r,orientation:s,vertexFormat:a,_drawNearPlane:c});const l=i===n._frustumType?n._frustum:void 0;return n._frustum=o.clone(l),n._frustumType=i,n._origin=K.clone(r,n._origin),n._orientation=il.clone(s,n._orientation),n._vertexFormat=jf.clone(a,n._vertexFormat),n._drawNearPlane=c,n};const dE=new ke,fE=new ft,pE=new ft,mE=new K,_E=new K,gE=new K,yE=new K,vE=new K,bE=new K,AE=new Array(3),wE=new Array(4);wE[0]=new Xe(-1,-1,1,1),wE[1]=new Xe(1,-1,1,1),wE[2]=new Xe(1,1,1,1),wE[3]=new Xe(-1,1,1,1);const TE=new Array(4);for(let ko=0;ko<4;++ko)TE[ko]=new Xe;rE._computeNearFarPlanes=function(e,t,n,i,o,r,s,a){const c=ke.fromQuaternion(t,dE);let l=R(r,mE),u=R(s,_E),h=R(a,gE);l=ke.getColumn(c,0,l),u=ke.getColumn(c,1,u),h=ke.getColumn(c,2,h),K.normalize(l,l),K.normalize(u,u),K.normalize(h,h),K.negate(l,l);const d=ft.computeView(e,h,u,l,fE);let f,p;if(n===iE){const e=i.projectionMatrix,t=ft.multiply(e,d,pE);p=ft.inverse(t,pE)}else f=ft.inverseTransformation(d,pE);C(p)?(AE[0]=i.near,AE[1]=i.far):(AE[0]=0,AE[1]=i.near,AE[2]=i.far);for(let m=0;m<2;++m)for(let t=0;t<4;++t){let n=Xe.clone(wE[t],TE[t]);if(C(p)){n=ft.multiplyByVector(p,n,n);const t=1/n.w;K.multiplyByScalar(n,t,n),K.subtract(n,e,n),K.normalize(n,n);const i=K.dot(h,n);K.multiplyByScalar(n,AE[m]/i,n),K.add(n,e,n)}else{C(i._offCenterFrustum)&&(i=i._offCenterFrustum);const e=AE[m],t=AE[m+1];n.x=.5*(n.x*(i.right-i.left)+i.left+i.right),n.y=.5*(n.y*(i.top-i.bottom)+i.bottom+i.top),n.z=.5*(n.z*(e-t)-e-t),n.w=1,ft.multiplyByVector(f,n,n)}o[12*m+3*t]=n.x,o[12*m+3*t+1]=n.y,o[12*m+3*t+2]=n.z}},rE.createGeometry=function(e){const t=e._frustumType,n=e._frustum,i=e._origin,o=e._orientation,r=e._drawNearPlane,s=e._vertexFormat,a=r?6:5;let c=new Float64Array(72);rE._computeNearFarPlanes(i,o,t,n,c);let l=24;c[l]=c[12],c[l+1]=c[13],c[l+2]=c[14],c[l+3]=c[0],c[l+4]=c[1],c[l+5]=c[2],c[l+6]=c[9],c[l+7]=c[10],c[l+8]=c[11],c[l+9]=c[21],c[l+10]=c[22],c[l+11]=c[23],l+=12,c[l]=c[15],c[l+1]=c[16],c[l+2]=c[17],c[l+3]=c[3],c[l+4]=c[4],c[l+5]=c[5],c[l+6]=c[0],c[l+7]=c[1],c[l+8]=c[2],c[l+9]=c[12],c[l+10]=c[13],c[l+11]=c[14],l+=12,c[l]=c[3],c[l+1]=c[4],c[l+2]=c[5],c[l+3]=c[15],c[l+4]=c[16],c[l+5]=c[17],c[l+6]=c[18],c[l+7]=c[19],c[l+8]=c[20],c[l+9]=c[6],c[l+10]=c[7],c[l+11]=c[8],l+=12,c[l]=c[6],c[l+1]=c[7],c[l+2]=c[8],c[l+3]=c[18],c[l+4]=c[19],c[l+5]=c[20],c[l+6]=c[21],c[l+7]=c[22],c[l+8]=c[23],c[l+9]=c[9],c[l+10]=c[10],c[l+11]=c[11],r||(c=c.subarray(12));const u=new Hf({position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:c})});if(C(s.normal)||C(s.tangent)||C(s.bitangent)||C(s.st)){const e=C(s.normal)?new Float32Array(12*a):void 0,t=C(s.tangent)?new Float32Array(12*a):void 0,n=C(s.bitangent)?new Float32Array(12*a):void 0,i=C(s.st)?new Float32Array(8*a):void 0,o=mE,c=_E,h=gE,d=K.negate(o,yE),f=K.negate(c,vE),p=K.negate(h,bE);l=0,r&&(hE(l,e,t,n,i,p,o,c),l+=12),hE(l,e,t,n,i,h,d,c),l+=12,hE(l,e,t,n,i,d,p,c),l+=12,hE(l,e,t,n,i,f,p,d),l+=12,hE(l,e,t,n,i,o,h,c),l+=12,hE(l,e,t,n,i,c,h,d),C(e)&&(u.normal=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:e})),C(t)&&(u.tangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:t})),C(n)&&(u.bitangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:n})),C(i)&&(u.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:i}))}const h=new Uint16Array(6*a);for(let d=0;d<a;++d){const e=6*d,t=4*d;h[e]=t,h[e+1]=t+1,h[e+2]=t+2,h[e+3]=t,h[e+4]=t+2,h[e+5]=t+3}return new zf({attributes:u,indices:h,primitiveType:xf.TRIANGLES,boundingSphere:nn.fromVertices(c)})};var CE=rE;const EE=0,xE=1;function SE(e){D.typeOf.object("options",e),D.typeOf.object("options.frustum",e.frustum),D.typeOf.object("options.origin",e.origin),D.typeOf.object("options.orientation",e.orientation);const t=e.frustum,n=e.orientation,i=e.origin,o=R(e._drawNearPlane,!0);let r,s;t instanceof nE?(r=EE,s=nE.packedLength):t instanceof jC&&(r=xE,s=jC.packedLength),this._frustumType=r,this._frustum=t.clone(),this._origin=K.clone(i),this._orientation=il.clone(n),this._drawNearPlane=o,this._workerName="createFrustumOutlineGeometry",this.packedLength=2+s+K.packedLength+il.packedLength}SE.pack=function(e,t,n){D.typeOf.object("value",e),D.defined("array",t),n=R(n,0);const i=e._frustumType,o=e._frustum;return t[n++]=i,i===EE?(nE.pack(o,t,n),n+=nE.packedLength):(jC.pack(o,t,n),n+=jC.packedLength),K.pack(e._origin,t,n),n+=K.packedLength,il.pack(e._orientation,t,n),n+=il.packedLength,t[n]=e._drawNearPlane?1:0,t};const IE=new nE,OE=new jC,DE=new il,PE=new K;SE.unpack=function(e,t,n){D.defined("array",e),t=R(t,0);const i=e[t++];let o;i===EE?(o=nE.unpack(e,t,IE),t+=nE.packedLength):(o=jC.unpack(e,t,OE),t+=jC.packedLength);const r=K.unpack(e,t,PE);t+=K.packedLength;const s=il.unpack(e,t,DE);t+=il.packedLength;const a=1===e[t];if(!C(n))return new SE({frustum:o,origin:r,orientation:s,_drawNearPlane:a});const c=i===n._frustumType?n._frustum:void 0;return n._frustum=o.clone(c),n._frustumType=i,n._origin=K.clone(r,n._origin),n._orientation=il.clone(s,n._orientation),n._drawNearPlane=a,n},SE.createGeometry=function(e){const t=e._frustumType,n=e._frustum,i=e._origin,o=e._orientation,r=e._drawNearPlane,s=new Float64Array(24);CE._computeNearFarPlanes(i,o,t,n,s);const a=new Hf({position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:s})});let c,l;const u=r?2:1,h=new Uint16Array(8*(u+1));let d=r?0:1;for(;d<2;++d)c=r?8*d:0,l=4*d,h[c]=l,h[c+1]=l+1,h[c+2]=l+1,h[c+3]=l+2,h[c+4]=l+2,h[c+5]=l+3,h[c+6]=l+3,h[c+7]=l;for(d=0;d<2;++d)c=8*(u+d),l=4*d,h[c]=l,h[c+1]=l+4,h[c+2]=l+1,h[c+3]=l+5,h[c+4]=l+2,h[c+5]=l+6,h[c+6]=l+3,h[c+7]=l+7;return new zf({attributes:a,indices:h,primitiveType:xf.LINES,boundingSphere:nn.fromVertices(s)})};var RE=SE;const LE={SEARCH:0,AUTOCOMPLETE:1};var ME=Object.freeze(LE);function BE(){}BE.prototype.geocode=x.throwInstantiationError;function NE(){x.throwInstantiationError()}NE.createGeometry=function(e){x.throwInstantiationError()};function FE(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.componentDatatype))throw new x("options.componentDatatype is required.");if(!C(e.componentsPerAttribute))throw new x("options.componentsPerAttribute is required.");if(e.componentsPerAttribute<1||e.componentsPerAttribute>4)throw new x("options.componentsPerAttribute must be between 1 and 4.");if(!C(e.value))throw new x("options.value is required.");this.componentDatatype=e.componentDatatype,this.componentsPerAttribute=e.componentsPerAttribute,this.normalize=R(e.normalize,!1),this.value=e.value}var zE=FE,kE=n(8424);function UE(e,t){return 0!==(e&t)}var VE=UE;const HE=[1,2,4,8],GE=15,WE=16,qE=64,jE=128;function YE(e,t,n,i,o,r){this._bits=e,this.cnodeVersion=t,this.imageryVersion=n,this.terrainVersion=i,this.imageryProvider=o,this.terrainProvider=r,this.ancestorHasTerrain=!1,this.terrainState=void 0}YE.clone=function(e,t){return C(t)?(t._bits=e._bits,t.cnodeVersion=e.cnodeVersion,t.imageryVersion=e.imageryVersion,t.terrainVersion=e.terrainVersion,t.imageryProvider=e.imageryProvider,t.terrainProvider=e.terrainProvider):t=new YE(e._bits,e.cnodeVersion,e.imageryVersion,e.terrainVersion,e.imageryProvider,e.terrainProvider),t.ancestorHasTerrain=e.ancestorHasTerrain,t.terrainState=e.terrainState,t},YE.prototype.setParent=function(e){this.ancestorHasTerrain=e.ancestorHasTerrain||this.hasTerrain()},YE.prototype.hasSubtree=function(){return VE(this._bits,WE)},YE.prototype.hasImagery=function(){return VE(this._bits,qE)},YE.prototype.hasTerrain=function(){return VE(this._bits,jE)},YE.prototype.hasChildren=function(){return VE(this._bits,GE)},YE.prototype.hasChild=function(e){return VE(this._bits,HE[e])},YE.prototype.getChildBitmask=function(){return this._bits&GE};var KE=YE;function XE(e){const t=e.length,n=new ArrayBuffer(t),i=new Uint8Array(n);for(let o=0;o<t;++o)i[o]=e.charCodeAt(o);return n}const QE=XE('Eô½\vyâjE",ÍqøIFgQ\0B%Æèa,f)\bÆ4Üjb%y\nwmiÖðk¡½NuàA[ß@V\fÙ»r|3SîOlÔq°{ÀEVZ­wUe\v3*¬l5Å0sø3>mF8J´Ýð.ÝuÚDt"úa"\f3"So¯9D\v9Ù9L¹¿«\\P_"uxéqh;ÁÄð<VqH\'UfYNeu£aF}a?A\0×´4MÎF°Õ¸\'{Ü+»Mg0ÈÑö\\Pú[/Fn5/\'C.ë\n\f^¥se4ål.jC\'c#U©?q{gC}:¯ÍâTUýKÆâ/(íË\\Æ-f§;/*"N°k.Ý\r}}GºC²²+>Mª>}æÎIÆæx\fa1-¤O¥~q ì\r1èN\v\0nPh}=\b\r¦n£h$[kó#ó¶s³\r\v@ÀØQ]ú".jßI\0¹ wUÆïj¿{GLîÜÜF©­S+S4ÿYä8è1N¹XFkË-#p\x005"Ï1²&/çÃu-6,rt°#G·ÓÑ&7râ\0DÏÚ3-Þ`i#i*|ÍKQ\rT9w.)ê¦P¢joP\\>TûïP[\vEm(w7ÛJfJo åpâ¹q~\fmI-zþrÇòY0»]såÉ êxì ðB|G`°½&·q¶ÇÑ3=Ó«îcÈ+S D\\qÆÌD2O<ÊÀ)=RÓaX©}e´ÜÏ\rô=ñ\b©BÚ#\tØ¿^PIøMÀËGLO÷{+ØÅ1;µoÜl\rÑÛ?âéÚ_ÔâFaZÞUÏ¤\0¾ýÎgñJiæ HØ]~®q N®ÀV©<rçvì)IÖ]-ãÛ6©;fjÕ¶=P^R¹KÇsWxÉô.YoÐKW>\'\'Ç`Û;íSD>?mw¢\në?R¨ÆU^1I7ôÅ&-©¿\'TÚÃj å*x°Öprªh½÷_H±~ÀXL?fù>áeÀp§Ï8i¯ðVldI\'­xtOÂÞV9\0Úw\vË-û5Oõ\bQ`Á\nZGM&30xÚÀFGâ[y`In7gS\n>éìF9²ñ4\rÆSuná\fYÙÞ){II¥wy¾IV.6ç\v:»Ob{ÒM1/½8{¨O!áìFpv})"x\nÝ\\ÚÞQÏðüYRe|3ßóHÚ»*uÛ`²Ôüíì5¨ÿ(1-ÈÜF|["');function JE(e){D.defined("resourceOrUrl",e);let t=e;"string"===typeof t||t instanceof Vi||(D.typeOf.string("resourceOrUrl.url",e.url),t=e.url);const n=Vi.createIfNeeded(t);n.appendForwardSlash(),this._resource=n,this.imageryPresent=!0,this.protoImagery=void 0,this.terrainPresent=!0,this.negativeAltitudeExponentBias=32,this.negativeAltitudeThreshold=z.EPSILON12,this.providers={},this.key=void 0,this._quadPacketVersion=1,this._tileInfo={},this._subtreePromises={};const i=this;this._readyPromise=ix(this).then((function(){return i.getQuadTreePacket("",i._quadPacketVersion)})).then((function(){return!0})).catch((function(e){const t=`An error occurred while accessing ${ex(i,"",1).url}.`;return Promise.reject(new Je(t))}))}Object.defineProperties(JE.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},resource:{get:function(){return this._resource}},readyPromise:{get:function(){return this._readyPromise}}}),JE.tileXYToQuadKey=function(e,t,n){let i="";for(let o=n;o>=0;--o){const n=1<<o;let r=0;VE(t,n)?VE(e,n)&&(r|=1):(r|=2,VE(e,n)||(r|=1)),i+=r}return i},JE.quadKeyToTileXY=function(e){let t=0,n=0;const i=e.length-1;for(let o=i;o>=0;--o){const r=1<<o,s=+e[i-o];VE(s,2)?VE(s,1)||(t|=r):(n|=r,VE(s,1)&&(t|=r))}return{x:t,y:n,level:i}},JE.prototype.isValid=function(e){let t=this.getTileInformationFromQuadKey(e);if(C(t))return null!==t;let n,i=!0,o=e;while(o.length>1){if(n=o.substring(o.length-1),o=o.substring(0,o.length-1),t=this.getTileInformationFromQuadKey(o),C(t)){t.hasSubtree()||t.hasChild(parseInt(n))||(i=!1);break}if(null===t){i=!1;break}}return i};const ZE=new ad("decodeGoogleEarthEnterprisePacket");function $E(e,t,n){const i=e._tileInfo;let o,r=t,s=i[r];if(C(s)&&(!s.hasSubtree()||s.hasChildren()))return s;while(void 0===s&&r.length>1)r=r.substring(0,r.length-1),s=i[r];const a=e._subtreePromises;let c=a[r];return C(c)?c.then((function(){return o=new jn({throttle:n.throttle,throttleByServer:n.throttleByServer,type:n.type,priorityFunction:n.priorityFunction}),$E(e,t,o)})):C(s)&&s.hasSubtree()?(c=e.getQuadTreePacket(r,s.cnodeVersion,n),C(c)?(a[r]=c,c.then((function(){return o=new jn({throttle:n.throttle,throttleByServer:n.throttleByServer,type:n.type,priorityFunction:n.priorityFunction}),$E(e,t,o)})).finally((function(){delete a[r]}))):void 0):Promise.reject(new Je(`Couldn't load metadata for tile ${t}`))}function ex(e,t,n,i){return e._resource.getDerivedResource({url:`flatfile?q2-0${t}-q.${n.toString()}`,request:i})}let tx,nx;function ix(e){const t=e._resource.getDerivedResource({url:"dbRoot.v5",queryParameters:{output:"proto"}});if(!C(nx)){const e=Zi("ThirdParty/google-earth-dbroot-parser.js"),t=window.cesiumGoogleEarthDbRootParser;nx=Nn(e).then((function(){tx=window.cesiumGoogleEarthDbRootParser(kE.Z),C(t)?window.cesiumGoogleEarthDbRootParser=t:delete window.cesiumGoogleEarthDbRootParser}))}return nx.then((function(){return t.fetchArrayBuffer()})).then((function(t){const n=tx.EncryptedDbRootProto.decode(new Uint8Array(t));let i=n.encryptionData,o=i.byteOffset,r=o+i.byteLength;const s=e.key=i.buffer.slice(o,r);i=n.dbrootData,o=i.byteOffset,r=o+i.byteLength;const a=i.buffer.slice(o,r);return ZE.scheduleTask({buffer:a,type:"DbRoot",key:s},[a])})).then((function(t){const n=tx.DbRootProto.decode(new Uint8Array(t.buffer));if(e.imageryPresent=R(n.imageryPresent,e.imageryPresent),e.protoImagery=n.protoImagery,e.terrainPresent=R(n.terrainPresent,e.terrainPresent),C(n.endSnippet)&&C(n.endSnippet.model)){const t=n.endSnippet.model;e.negativeAltitudeExponentBias=R(t.negativeAltitudeExponentBias,e.negativeAltitudeExponentBias),e.negativeAltitudeThreshold=R(t.compressedNegativeAltitudeThreshold,e.negativeAltitudeThreshold)}C(n.databaseVersion)&&(e._quadPacketVersion=R(n.databaseVersion.quadtreeVersion,e._quadPacketVersion));const i=e.providers,o=R(n.providerInfo,[]),r=o.length;for(let e=0;e<r;++e){const t=o[e],n=t.copyrightString;C(n)&&(i[t.providerId]=new Tr(n.value))}})).catch((function(){console.log(`Failed to retrieve ${t.url}. Using defaults.`),e.key=QE}))}JE.prototype.getQuadTreePacket=function(e,t,n){t=R(t,1),e=R(e,"");const i=ex(this,e,t,n),o=i.fetchArrayBuffer();if(!C(o))return;const r=this._tileInfo,s=this.key;return o.then((function(t){const n=ZE.scheduleTask({buffer:t,quadKey:e,type:"Metadata",key:s},[t]);return n.then((function(t){let n,i=-1;if(""!==e){i=e.length+1;const o=t[e];n=r[e],n._bits|=o._bits,delete t[e]}const o=Object.keys(t);o.sort((function(e,t){return e.length-t.length}));const s=o.length;for(let e=0;e<s;++e){const s=o[e],a=t[s];if(null!==a){const e=KE.clone(t[s]),o=s.length;if(o===i)e.setParent(n);else if(o>1){const t=r[s.substring(0,s.length-1)];e.setParent(t)}r[s]=e}else r[s]=null}}))}))},JE.prototype.populateSubtree=function(e,t,n,i){const o=JE.tileXYToQuadKey(e,t,n);return $E(this,o,i)},JE.prototype.getTileInformation=function(e,t,n){const i=JE.tileXYToQuadKey(e,t,n);return this._tileInfo[i]},JE.prototype.getTileInformationFromQuadKey=function(e){return this._tileInfo[e]};var ox=JE;function rx(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.object("options.buffer",e.buffer),D.typeOf.number("options.negativeAltitudeExponentBias",e.negativeAltitudeExponentBias),D.typeOf.number("options.negativeElevationThreshold",e.negativeElevationThreshold),this._buffer=e.buffer,this._credits=e.credits,this._negativeAltitudeExponentBias=e.negativeAltitudeExponentBias,this._negativeElevationThreshold=e.negativeElevationThreshold;const t=R(e.childTileMask,15);let n=3&t;n|=4&t?8:0,n|=8&t?4:0,this._childTileMask=n,this._createdByUpsampling=R(e.createdByUpsampling,!1),this._skirtHeight=void 0,this._bufferType=this._buffer.constructor,this._mesh=void 0,this._minimumHeight=void 0,this._maximumHeight=void 0}Object.defineProperties(rx.prototype,{credits:{get:function(){return this._credits}},waterMask:{get:function(){}}});const sx="createVerticesFromGoogleEarthEnterpriseBuffer",ax=new ad(sx),cx=new ad(sx,ld.maximumAsynchronousTasks),lx=new _t,ux=new _t;rx.prototype.createMesh=function(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.object("options.tilingScheme",e.tilingScheme),D.typeOf.number("options.x",e.x),D.typeOf.number("options.y",e.y),D.typeOf.number("options.level",e.level);const t=e.tilingScheme,n=e.x,i=e.y,o=e.level,r=R(e.exaggeration,1),s=R(e.exaggerationRelativeHeight,0),a=R(e.throttle,!0),c=t.ellipsoid;t.tileXYToNativeRectangle(n,i,o,lx),t.tileXYToRectangle(n,i,o,ux);const l=c.cartographicToCartesian(_t.center(ux)),u=40075.16,h=u/(1<<o);this._skirtHeight=Math.min(8*h,1e3);const d=a?cx:ax,f=d.scheduleTask({buffer:this._buffer,nativeRectangle:lx,rectangle:ux,relativeToCenter:l,ellipsoid:c,skirtHeight:this._skirtHeight,exaggeration:r,exaggerationRelativeHeight:s,includeWebMercatorT:!0,negativeAltitudeExponentBias:this._negativeAltitudeExponentBias,negativeElevationThreshold:this._negativeElevationThreshold});if(!C(f))return;const p=this;return f.then((function(e){return p._mesh=new hd(l,new Float32Array(e.vertices),new Uint16Array(e.indices),e.indexCountWithoutSkirts,e.vertexCountWithoutSkirts,e.minimumHeight,e.maximumHeight,nn.clone(e.boundingSphere3D),K.clone(e.occludeePointInScaledSpace),e.numberOfAttributes,$u.clone(e.orientedBoundingBox),kh.clone(e.encoding),e.westIndicesSouthToNorth,e.southIndicesEastToWest,e.eastIndicesNorthToSouth,e.northIndicesWestToEast),p._minimumHeight=e.minimumHeight,p._maximumHeight=e.maximumHeight,p._buffer=void 0,p._mesh}))},rx.prototype.interpolateHeight=function(e,t,n){const i=z.clamp((t-e.west)/e.width,0,1),o=z.clamp((n-e.south)/e.height,0,1);return C(this._mesh)?_x(this,i,o):wx(this,i,o,e)};const hx=new ad("upsampleQuantizedTerrainMesh",ld.maximumAsynchronousTasks);rx.prototype.upsample=function(e,t,n,i,o,r,s){D.typeOf.object("tilingScheme",e),D.typeOf.number("thisX",t),D.typeOf.number("thisY",n),D.typeOf.number("thisLevel",i),D.typeOf.number("descendantX",o),D.typeOf.number("descendantY",r),D.typeOf.number("descendantLevel",s);const a=s-i;if(a>1)throw new x("Upsampling through more than one level at a time is not currently supported.");const c=this._mesh;if(!C(this._mesh))return;const l=2*t!==o,u=2*n===r,h=e.ellipsoid,d=e.tileXYToRectangle(o,r,s),f=hx.scheduleTask({vertices:c.vertices,indices:c.indices,indexCountWithoutSkirts:c.indexCountWithoutSkirts,vertexCountWithoutSkirts:c.vertexCountWithoutSkirts,encoding:c.encoding,minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,isEastChild:l,isNorthChild:u,childRectangle:d,ellipsoid:h});if(!C(f))return;const p=this;return f.then((function(e){const t=new Uint16Array(e.vertices),n=fd.createTypedArray(t.length/3,e.indices),i=p._skirtHeight;return new tm({quantizedVertices:t,indices:n,minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight,boundingSphere:nn.clone(e.boundingSphere),orientedBoundingBox:$u.clone(e.orientedBoundingBox),horizonOcclusionPoint:K.clone(e.horizonOcclusionPoint),westIndices:e.westIndices,southIndices:e.southIndices,eastIndices:e.eastIndices,northIndices:e.northIndices,westSkirtHeight:i,southSkirtHeight:i,eastSkirtHeight:i,northSkirtHeight:i,childTileMask:0,createdByUpsampling:!0,credits:p._credits})}))},rx.prototype.isChildAvailable=function(e,t,n,i){D.typeOf.number("thisX",e),D.typeOf.number("thisY",t),D.typeOf.number("childX",n),D.typeOf.number("childY",i);let o=2;return n!==2*e&&++o,i!==2*t&&(o-=2),0!==(this._childTileMask&1<<o)},rx.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling};const dx=new ro,fx=new ro,px=new ro,mx=new K;function _x(e,t,n){const i=e._mesh,o=i.vertices,r=i.encoding,s=i.indices;for(let a=0,c=s.length;a<c;a+=3){const e=s[a],i=s[a+1],c=s[a+2],l=r.decodeTextureCoordinates(o,e,dx),u=r.decodeTextureCoordinates(o,i,fx),h=r.decodeTextureCoordinates(o,c,px),d=kp.computeBarycentricCoordinates(t,n,l.x,l.y,u.x,u.y,h.x,h.y,mx);if(d.x>=-1e-15&&d.y>=-1e-15&&d.z>=-1e-15){const t=r.decodeHeight(o,e),n=r.decodeHeight(o,i),s=r.decodeHeight(o,c);return d.x*t+d.y*n+d.z*s}}}const gx=Uint16Array.BYTES_PER_ELEMENT,yx=Uint32Array.BYTES_PER_ELEMENT,vx=Int32Array.BYTES_PER_ELEMENT,bx=Float32Array.BYTES_PER_ELEMENT,Ax=Float64Array.BYTES_PER_ELEMENT;function wx(e,t,n,i){const o=e._buffer;let r=0,s=0,a=0;n>.5?(t>.5?(r=2,s=.5):r=3,a=.5):t>.5&&(r=1,s=.5);const c=new DataView(o);let l=0;for(let A=0;A<r;++A)l+=c.getUint32(l,!0),l+=yx;l+=yx,l+=2*Ax;const u=z.toRadians(180*c.getFloat64(l,!0));l+=Ax;const h=z.toRadians(180*c.getFloat64(l,!0));l+=Ax;const d=i.width/u/2,f=i.height/h/2,p=c.getInt32(l,!0);l+=vx;const m=3*c.getInt32(l,!0);l+=vx,l+=vx;const _=new Array(p),g=new Array(p),y=new Array(p);let v;for(v=0;v<p;++v)_[v]=s+c.getUint8(l++)*d,g[v]=a+c.getUint8(l++)*f,y[v]=6371010*c.getFloat32(l,!0),l+=bx;const b=new Array(m);for(v=0;v<m;++v)b[v]=c.getUint16(l,!0),l+=gx;for(v=0;v<m;v+=3){const e=b[v],i=b[v+1],o=b[v+2],r=_[e],s=_[i],a=_[o],c=g[e],l=g[i],u=g[o],h=kp.computeBarycentricCoordinates(t,n,r,c,s,l,a,u,mx);if(h.x>=-1e-15&&h.y>=-1e-15&&h.z>=-1e-15)return h.x*y[e]+h.y*y[i]+h.z*y[o]}}var Tx=rx;const Cx={UNKNOWN:0,NONE:1,SELF:2,PARENT:3},Ex=new Ea;function xx(){this._terrainCache={},this._lastTidy=Ea.now()}function Sx(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.url)&&!C(e.metadata))throw new x("options.url or options.metadata is required.");let t;if(C(e.metadata))t=e.metadata;else{const n=Vi.createIfNeeded(e.url);t=new ox(n)}this._metadata=t,this._tilingScheme=new ao({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,rectangle:new _t(-z.PI,-z.PI,z.PI,z.PI),ellipsoid:e.ellipsoid});let n=e.credit;"string"===typeof n&&(n=new Tr(n)),this._credit=n,this._levelZeroMaximumGeometricError=40075.16,this._terrainCache=new xx,this._terrainPromises={},this._terrainRequests={},this._errorEvent=new $n,this._ready=!1;const i=this;let o;this._readyPromise=t.readyPromise.then((function(e){if(!t.terrainPresent){const e=new Je(`The server ${t.url} doesn't have terrain`);return o=ef.handleError(o,i,i._errorEvent,e.message,void 0,void 0,void 0,e),Promise.reject(e)}return ef.handleSuccess(o),i._ready=e,e})).catch((function(e){return o=ef.handleError(o,i,i._errorEvent,e.message,void 0,void 0,void 0,e),Promise.reject(e)}))}xx.prototype.add=function(e,t){this._terrainCache[e]={buffer:t,timestamp:Ea.now()}},xx.prototype.get=function(e){const t=this._terrainCache,n=t[e];if(C(n))return delete this._terrainCache[e],n.buffer},xx.prototype.tidy=function(){if(Ea.now(Ex),Ea.secondsDifference(Ex,this._lastTidy)>10){const e=this._terrainCache,t=Object.keys(e),n=t.length;for(let i=0;i<n;++i){const n=t[i],o=e[n];Ea.secondsDifference(Ex,o.timestamp)>10&&delete e[n]}Ea.clone(Ex,this._lastTidy)}},Object.defineProperties(Sx.prototype,{url:{get:function(){return this._metadata.url}},proxy:{get:function(){return this._metadata.proxy}},tilingScheme:{get:function(){if(!this._ready)throw new x("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){return this._credit}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){}}});const Ix=new ad("decodeGoogleEarthEnterprisePacket");function Ox(e,t,n){let i=t.getChildBitmask();if(t.terrainState===Cx.PARENT){i=0;for(let t=0;t<4;++t){const o=n.getTileInformationFromQuadKey(e+t.toString());C(o)&&o.hasTerrain()&&(i|=1<<t)}}return i}function Dx(e,t,n,i){return n=C(n)&&n>0?n:1,e._metadata.resource.getDerivedResource({url:`flatfile?f1c-0${t}-t.${n.toString()}`,request:i})}Sx.prototype.requestTileGeometry=function(e,t,n,i){if(!this._ready)throw new x("requestTileGeometry must not be called before the terrain provider is ready.");const o=ox.tileXYToQuadKey(e,t,n),r=this._terrainCache,s=this._metadata,a=s.getTileInformationFromQuadKey(o);if(!C(a))return Promise.reject(new Je("Terrain tile doesn't exist"));let c=a.terrainState;C(c)||(c=a.terrainState=Cx.UNKNOWN);const l=r.get(o);if(C(l)){const e=s.providers[a.terrainProvider];return Promise.resolve(new Tx({buffer:l,childTileMask:Ox(o,a,s),credits:C(e)?[e]:void 0,negativeAltitudeExponentBias:s.negativeAltitudeExponentBias,negativeElevationThreshold:s.negativeAltitudeThreshold}))}if(r.tidy(),!a.ancestorHasTerrain)return Promise.resolve(new Pd({buffer:new Uint8Array(256),width:16,height:16}));if(c===Cx.NONE)return Promise.reject(new Je("Terrain tile doesn't exist"));let u,h=o,d=-1;switch(c){case Cx.SELF:d=a.terrainVersion;break;case Cx.PARENT:h=h.substring(0,h.length-1),u=s.getTileInformationFromQuadKey(h),d=u.terrainVersion;break;case Cx.UNKNOWN:a.hasTerrain()?d=a.terrainVersion:(h=h.substring(0,h.length-1),u=s.getTileInformationFromQuadKey(h),C(u)&&u.hasTerrain()&&(d=u.terrainVersion));break}if(d<0)return Promise.reject(new Je("Terrain tile doesn't exist"));const f=this._terrainPromises,p=this._terrainRequests;let m,_;if(C(f[h]))m=f[h],_=p[h];else{_=i;const e=Dx(this,h,d,_).fetchArrayBuffer();if(!C(e))return;m=e.then((function(e){return C(e)?Ix.scheduleTask({buffer:e,type:"Terrain",key:s.key},[e]).then((function(e){const t=s.getTileInformationFromQuadKey(h);t.terrainState=Cx.SELF,r.add(h,e[0]);const n=t.terrainProvider,i=e.length-1;for(let o=0;o<i;++o){const t=h+o.toString(),i=s.getTileInformationFromQuadKey(t);C(i)&&(r.add(t,e[o+1]),i.terrainState=Cx.PARENT,0===i.terrainProvider&&(i.terrainProvider=n))}})):Promise.reject(new Je("Failed to load terrain."))})),f[h]=m,p[h]=_,m=m.finally((function(){delete f[h],delete p[h]}))}return m.then((function(){const e=r.get(o);if(C(e)){const t=s.providers[a.terrainProvider];return new Tx({buffer:e,childTileMask:Ox(o,a,s),credits:C(t)?[t]:void 0,negativeAltitudeExponentBias:s.negativeAltitudeExponentBias,negativeElevationThreshold:s.negativeAltitudeThreshold})}return Promise.reject(new Je("Failed to load terrain."))})).catch((function(e){return _.state===Hn.CANCELLED?(i.state=_.state,Promise.reject(e)):(a.terrainState=Cx.NONE,Promise.reject(e))}))},Sx.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)},Sx.prototype.getTileDataAvailable=function(e,t,n){const i=this._metadata;let o=ox.tileXYToQuadKey(e,t,n);const r=i.getTileInformation(e,t,n);if(null===r)return!1;if(C(r)){if(!r.ancestorHasTerrain)return!0;const e=r.terrainState;if(e===Cx.NONE)return!1;if((!C(e)||e===Cx.UNKNOWN)&&(r.terrainState=Cx.UNKNOWN,!r.hasTerrain())){o=o.substring(0,o.length-1);const e=i.getTileInformationFromQuadKey(o);if(!C(e)||!e.hasTerrain())return!1}return!0}if(i.isValid(o)){const o=new jn({throttle:!1,throttleByServer:!0,type:Wn.TERRAIN});i.populateSubtree(e,t,n,o)}return!1},Sx.prototype.loadTileDataAvailability=function(e,t,n){};const Px=[ve,Vh],Rx=Px.length,Lx=Math.cos(z.toRadians(30)),Mx=Math.cos(z.toRadians(150)),Bx=0,Nx=1e3;function Fx(e){e=R(e,R.EMPTY_OBJECT);const t=e.positions;if(!C(t)||t.length<2)throw new x("At least two positions are required.");if(C(e.arcType)&&e.arcType!==hf.GEODESIC&&e.arcType!==hf.RHUMB)throw new x("Valid options for arcType are ArcType.GEODESIC and ArcType.RHUMB.");this.width=R(e.width,1),this._positions=t,this.granularity=R(e.granularity,9999),this.loop=R(e.loop,!1),this.arcType=R(e.arcType,hf.GEODESIC),this._ellipsoid=ge.WGS84,this._projectionIndex=0,this._workerName="createGroundPolylineGeometry",this._scene3DOnly=!1}Object.defineProperties(Fx.prototype,{packedLength:{get:function(){return 1+3*this._positions.length+1+1+1+ge.packedLength+1+1}}}),Fx.setProjectionAndEllipsoid=function(e,t){let n=0;for(let i=0;i<Rx;i++)if(t instanceof Px[i]){n=i;break}e._projectionIndex=n,e._ellipsoid=t.ellipsoid};const zx=new K,kx=new K,Ux=new K;function Vx(e,t,n,i,o){const r=Kx(i,e,0,zx),s=Kx(i,e,n,kx),a=Kx(i,t,0,Ux),c=Xx(s,r,kx),l=Xx(a,r,Ux);return K.cross(l,c,o),K.normalize(o,o)}const Hx=new se,Gx=new K,Wx=new K,qx=new K;function jx(e,t,n,i,o,r,s,a,c,l,u){if(0===o)return;let h;r===hf.GEODESIC?h=new Jb(e,t,s):r===hf.RHUMB&&(h=new Zy(e,t,s));const d=h.surfaceDistance;if(d<o)return;const f=Vx(e,t,i,s,qx),p=Math.ceil(d/o),m=d/p;let _=m;const g=p-1;let y=a.length;for(let v=0;v<g;v++){const e=h.interpolateUsingSurfaceDistance(_,Hx),t=Kx(s,e,n,Gx),o=Kx(s,e,i,Wx);K.pack(f,a,y),K.pack(t,c,y),K.pack(o,l,y),u.push(e.latitude),u.push(e.longitude),y+=3,_+=m}}const Yx=new se;function Kx(e,t,n,i){return se.clone(t,Yx),Yx.height=n,se.toCartesian(Yx,e,i)}function Xx(e,t,n){return K.subtract(e,t,n),K.normalize(n,n),n}function Qx(e,t,n,i){return i=Xx(e,t,i),i=K.cross(i,n,i),i=K.normalize(i,i),i=K.cross(n,i,i),i}Fx.pack=function(e,t,n){D.typeOf.object("value",e),D.defined("array",t);let i=R(n,0);const o=e._positions,r=o.length;t[i++]=r;for(let s=0;s<r;++s){const e=o[s];K.pack(e,t,i),i+=3}return t[i++]=e.granularity,t[i++]=e.loop?1:0,t[i++]=e.arcType,ge.pack(e._ellipsoid,t,i),i+=ge.packedLength,t[i++]=e._projectionIndex,t[i++]=e._scene3DOnly?1:0,t},Fx.unpack=function(e,t,n){D.defined("array",e);let i=R(t,0);const o=e[i++],r=new Array(o);for(let d=0;d<o;d++)r[d]=K.unpack(e,i),i+=3;const s=e[i++],a=1===e[i++],c=e[i++],l=ge.unpack(e,i);i+=ge.packedLength;const u=e[i++],h=1===e[i++];return C(n)||(n=new Fx({positions:r})),n._positions=r,n.granularity=s,n.loop=a,n.arcType=c,n._ellipsoid=l,n._projectionIndex=u,n._scene3DOnly=h,n};const Jx=new K,Zx=new K,$x=new K,eS=new K,tS=0,nS=-1;function iS(e,t,n,i,o){const r=Xx(n,t,eS),s=Qx(e,t,r,Jx),a=Qx(i,t,r,Zx);if(z.equalsEpsilon(K.dot(s,a),nS,z.EPSILON5))return o=K.cross(r,s,o),o=K.normalize(o,o),o;o=K.add(a,s,o),o=K.normalize(o,o);const c=K.cross(r,o,$x);return K.dot(a,c)<tS&&(o=K.negate(o,o)),o}const oS=Gs.fromPointNormal(K.ZERO,K.UNIT_Y),rS=new K,sS=new K,aS=new K,cS=new K,lS=new K,uS=new K,hS=new se,dS=new se,fS=new se;Fx.createGeometry=function(e){const t=!e._scene3DOnly;let n=e.loop;const i=e._ellipsoid,o=e.granularity,r=e.arcType,s=new Px[e._projectionIndex](i),a=Bx,c=Nx;let l,u;const h=e._positions,d=h.length;let f,p,m,_;2===d&&(n=!1);const g=new Zy(void 0,void 0,i);let y,v,b;const A=[h[0]];for(u=0;u<d-1;u++)f=h[u],p=h[u+1],y=Ns.lineSegmentPlane(f,p,oS,uS),!C(y)||K.equalsEpsilon(y,f,z.EPSILON7)||K.equalsEpsilon(y,p,z.EPSILON7)||(e.arcType===hf.GEODESIC?A.push(K.clone(y)):e.arcType===hf.RHUMB&&(b=i.cartesianToCartographic(y,hS).longitude,m=i.cartesianToCartographic(f,hS),_=i.cartesianToCartographic(p,dS),g.setEndPoints(m,_),v=g.findIntersectionWithLongitude(b,fS),y=i.cartographicToCartesian(v,uS),!C(y)||K.equalsEpsilon(y,f,z.EPSILON7)||K.equalsEpsilon(y,p,z.EPSILON7)||A.push(K.clone(y)))),A.push(p);n&&(f=h[d-1],p=h[0],y=Ns.lineSegmentPlane(f,p,oS,uS),!C(y)||K.equalsEpsilon(y,f,z.EPSILON7)||K.equalsEpsilon(y,p,z.EPSILON7)||(e.arcType===hf.GEODESIC?A.push(K.clone(y)):e.arcType===hf.RHUMB&&(b=i.cartesianToCartographic(y,hS).longitude,m=i.cartesianToCartographic(f,hS),_=i.cartesianToCartographic(p,dS),g.setEndPoints(m,_),v=g.findIntersectionWithLongitude(b,fS),y=i.cartographicToCartesian(v,uS),!C(y)||K.equalsEpsilon(y,f,z.EPSILON7)||K.equalsEpsilon(y,p,z.EPSILON7)||A.push(K.clone(y)))));let w=A.length,T=new Array(w);for(u=0;u<w;u++){const e=se.fromCartesian(A[u],i);e.height=0,T[u]=e}if(T=Ly(T,se.equalsEpsilon),w=T.length,w<2)return;const E=[],x=[],S=[],I=[];let O=rS,D=sS,P=aS,R=cS,L=lS;const M=T[0],B=T[1],N=T[w-1];for(O=Kx(i,N,a,O),R=Kx(i,B,a,R),D=Kx(i,M,a,D),P=Kx(i,M,c,P),L=n?iS(O,D,P,R,L):Vx(M,B,c,i,L),K.pack(L,x,0),K.pack(D,S,0),K.pack(P,I,0),E.push(M.latitude),E.push(M.longitude),jx(M,B,a,c,o,r,i,x,S,I,E),u=1;u<w-1;++u){O=K.clone(D,O),D=K.clone(R,D);const e=T[u];Kx(i,e,c,P),Kx(i,T[u+1],a,R),iS(O,D,P,R,L),l=x.length,K.pack(L,x,l),K.pack(D,S,l),K.pack(P,I,l),E.push(e.latitude),E.push(e.longitude),jx(T[u],T[u+1],a,c,o,r,i,x,S,I,E)}const F=T[w-1],k=T[w-2];if(D=Kx(i,F,a,D),P=Kx(i,F,c,P),n){const e=T[0];O=Kx(i,k,a,O),R=Kx(i,e,a,R),L=iS(O,D,P,R,L)}else L=Vx(k,F,c,i,L);if(l=x.length,K.pack(L,x,l),K.pack(D,S,l),K.pack(P,I,l),E.push(F.latitude),E.push(F.longitude),n){for(jx(F,M,a,c,o,r,i,x,S,I,E),l=x.length,u=0;u<3;++u)x[l+u]=x[u],S[l+u]=S[u],I[l+u]=I[u];E.push(M.latitude),E.push(M.longitude)}return sI(n,s,S,I,x,E,t)};const pS=new K,mS=new ke,_S=new il;function gS(e,t,n,i){const o=Xx(n,t,pS),r=K.dot(o,e);if(r>Lx||r<Mx){const t=Xx(i,n,eS),o=r<Mx?z.PI_OVER_TWO:-z.PI_OVER_TWO,s=il.fromAxisAngle(t,o,_S),a=ke.fromQuaternion(s,mS);return ke.multiplyByVector(a,e,e),!0}return!1}const yS=new se,vS=new K,bS=new K;function AS(e,t,n,i,o){const r=se.toCartesian(t,e._ellipsoid,vS);let s=K.add(r,n,bS),a=!1;const c=e._ellipsoid;let l=c.cartesianToCartographic(s,yS);Math.abs(t.longitude-l.longitude)>z.PI_OVER_TWO&&(a=!0,s=K.subtract(r,n,bS),l=c.cartesianToCartographic(s,yS)),l.height=0;const u=e.project(l,o);return o=K.subtract(u,i,o),o.z=0,o=K.normalize(o,o),a&&K.negate(o,o),o}const wS=new K,TS=new K;function CS(e,t,n,i,o,r){const s=K.subtract(t,e,wS);K.normalize(s,s);const a=n-Bx;let c=K.multiplyByScalar(s,a,TS);K.add(e,c,o);const l=i-Nx;c=K.multiplyByScalar(s,l,TS),K.add(t,c,r)}const ES=new K;function xS(e,t){const n=Gs.getPointDistance(oS,e),i=Gs.getPointDistance(oS,t);let o=ES;z.equalsEpsilon(n,0,z.EPSILON2)?(o=Xx(t,e,o),K.multiplyByScalar(o,z.EPSILON2,o),K.add(e,o,e)):z.equalsEpsilon(i,0,z.EPSILON2)&&(o=Xx(e,t,o),K.multiplyByScalar(o,z.EPSILON2,o),K.add(t,o,t))}function SS(e,t){const n=Math.abs(e.longitude),i=Math.abs(t.longitude);if(z.equalsEpsilon(n,z.PI,z.EPSILON11)){const i=z.sign(t.longitude);return e.longitude=i*(n-z.EPSILON11),1}if(z.equalsEpsilon(i,z.PI,z.EPSILON11)){const n=z.sign(e.longitude);return t.longitude=n*(i-z.EPSILON11),2}return 0}const IS=new se,OS=new se,DS=new K,PS=new K,RS=new K,LS=new K,MS=new K,BS=new K,NS=[IS,OS],FS=new _t,zS=new K,kS=new K,US=new K,VS=new K,HS=new K,GS=new K,WS=new K,qS=new K,jS=new K,YS=new K,KS=new K,XS=new K,QS=new K,JS=new K,ZS=new Nm,$S=new Nm,eI=new K,tI=new K,nI=new K,iI=[new nn,new nn],oI=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],rI=oI.length;function sI(e,t,n,i,o,r,s){let a,c;const l=t._ellipsoid,u=n.length/3-1,h=8*u,d=4*h,f=36*u,p=h>65535?new Uint32Array(f):new Uint16Array(f),m=new Float64Array(3*h),_=new Float32Array(d),g=new Float32Array(d),y=new Float32Array(d),v=new Float32Array(d),b=new Float32Array(d);let A,w,T,C;s&&(A=new Float32Array(d),w=new Float32Array(d),T=new Float32Array(d),C=new Float32Array(2*h));const E=r.length/2;let x=0;const S=IS;S.height=0;const I=OS;I.height=0;let O=DS,D=PS;if(s)for(c=0,a=1;a<E;a++)S.latitude=r[c],S.longitude=r[c+1],I.latitude=r[c+2],I.longitude=r[c+3],O=t.project(S,O),D=t.project(I,D),x+=K.distance(O,D),c+=2;const P=i.length/3;D=K.unpack(i,0,D);let R,L=0;for(c=3,a=1;a<P;a++)O=K.clone(D,O),D=K.unpack(i,c,D),L+=K.distance(O,D),c+=3;c=3;let M=0,B=0,N=0,F=0,k=!1,U=K.unpack(n,0,LS),V=K.unpack(i,0,PS),H=K.unpack(o,0,BS);if(e){const e=K.unpack(n,n.length-6,RS);gS(H,e,U,V)&&(H=K.negate(H,H))}let G=0,W=0,q=0;for(a=0;a<u;a++){const e=K.clone(U,RS),a=K.clone(V,DS);let u,h,d,f,p=K.clone(H,MS);if(k&&(p=K.negate(p,p)),U=K.unpack(n,c,LS),V=K.unpack(i,c,PS),H=K.unpack(o,c,BS),k=gS(H,e,U,V),S.latitude=r[M],S.longitude=r[M+1],I.latitude=r[M+2],I.longitude=r[M+3],s){const e=SS(S,I);u=t.project(S,HS),h=t.project(I,GS);const n=Xx(h,u,eI);n.y=Math.abs(n.y),d=WS,f=qS,0===e||K.dot(n,K.UNIT_Y)>Lx?(d=AS(t,S,p,u,WS),f=AS(t,I,H,h,qS)):1===e?(f=AS(t,I,H,h,qS),d.x=0,d.y=z.sign(S.longitude-Math.abs(I.longitude)),d.z=0):(d=AS(t,S,p,u,WS),f.x=0,f.y=z.sign(S.longitude-I.longitude),f.z=0)}const E=K.distance(a,V),O=Nm.fromCartesian(e,ZS),D=K.subtract(U,e,jS),P=K.normalize(D,XS);let j=K.subtract(a,e,YS);j=K.normalize(j,j);let Y=K.cross(P,j,XS);Y=K.normalize(Y,Y);let X=K.cross(j,p,QS);X=K.normalize(X,X);let Q=K.subtract(V,U,KS);Q=K.normalize(Q,Q);let J=K.cross(H,Q,JS);J=K.normalize(J,J);const Z=E/L,$=G/L;let ee,te,ne,ie=0,oe=0,re=0;if(s){ie=K.distance(u,h),ee=Nm.fromCartesian(u,$S),te=K.subtract(h,u,eI),ne=K.normalize(te,tI);const e=ne.x;ne.x=ne.y,ne.y=-e,oe=ie/x,re=W/x}for(R=0;R<8;R++){const e=F+4*R,t=B+2*R,n=e+3,i=R<4?1:-1,o=2===R||3===R||6===R||7===R?1:-1;K.pack(O.high,_,e),_[n]=D.x,K.pack(O.low,g,e),g[n]=D.y,K.pack(X,y,e),y[n]=D.z,K.pack(J,v,e),v[n]=Z*i,K.pack(Y,b,e);let r=$*o;0===r&&o<0&&(r=9),b[n]=r,s&&(A[e]=ee.high.x,A[e+1]=ee.high.y,A[e+2]=ee.low.x,A[e+3]=ee.low.y,T[e]=-d.y,T[e+1]=d.x,T[e+2]=f.y,T[e+3]=-f.x,w[e]=te.x,w[e+1]=te.y,w[e+2]=ne.x,w[e+3]=ne.y,C[t]=oe*i,r=re*o,0===r&&o<0&&(r=9),C[t+1]=r)}const se=US,ae=VS,ce=zS,le=kS,ue=_t.fromCartographicArray(NS,FS),he=bo.getMinimumMaximumHeights(ue,l),de=he.minimumTerrainHeight,fe=he.maximumTerrainHeight;q+=de,q+=fe,CS(e,a,de,fe,se,ce),CS(U,V,de,fe,ae,le);let pe=K.multiplyByScalar(Y,z.EPSILON5,nI);K.add(se,pe,se),K.add(ae,pe,ae),K.add(ce,pe,ce),K.add(le,pe,le),xS(se,ae),xS(ce,le),K.pack(se,m,N),K.pack(ae,m,N+3),K.pack(le,m,N+6),K.pack(ce,m,N+9),pe=K.multiplyByScalar(Y,-2*z.EPSILON5,nI),K.add(se,pe,se),K.add(ae,pe,ae),K.add(ce,pe,ce),K.add(le,pe,le),xS(se,ae),xS(ce,le),K.pack(se,m,N+12),K.pack(ae,m,N+15),K.pack(le,m,N+18),K.pack(ce,m,N+21),M+=2,c+=3,B+=16,N+=24,F+=32,G+=E,W+=ie}c=0;let j=0;for(a=0;a<u;a++){for(R=0;R<rI;R++)p[c+R]=oI[R]+j;j+=8,c+=rI}const Y=iI;nn.fromVertices(n,K.ZERO,3,Y[0]),nn.fromVertices(i,K.ZERO,3,Y[1]);const X=nn.fromBoundingSpheres(Y);X.radius+=q/(2*u);const Q={position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,normalize:!1,values:m}),startHiAndForwardOffsetX:aI(_),startLoAndForwardOffsetY:aI(g),startNormalAndForwardOffsetZ:aI(y),endNormalAndTextureCoordinateNormalizationX:aI(v),rightNormalAndTextureCoordinateNormalizationY:aI(b)};return s&&(Q.startHiLo2D=aI(A),Q.offsetAndRight2D=aI(w),Q.startEndNormals2D=aI(T),Q.texcoordNormalization2D=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,normalize:!1,values:C})),new zf({attributes:Q,indices:p,boundingSphere:X})}function aI(e){return new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:4,normalize:!1,values:e})}Fx._projectNormal=AS;var cI=Fx;function lI(e,t,n){this.heading=R(e,0),this.pitch=R(t,0),this.range=R(n,0)}lI.clone=function(e,t){if(C(e))return C(t)||(t=new lI),t.heading=e.heading,t.pitch=e.pitch,t.range=e.range,t};var uI=lI;const hI=z.factorial;function dI(e,t,n,i,o,r){let s,a,c,l=0;if(i>0){for(a=0;a<o;a++){for(s=!1,c=0;c<r.length&&!s;c++)a===r[c]&&(s=!0);s||(r.push(a),l+=dI(e,t,n,i-1,o,r),r.splice(r.length-1,1))}return l}for(l=1,a=0;a<o;a++){for(s=!1,c=0;c<r.length&&!s;c++)a===r[c]&&(s=!0);s||(l*=e-n[t[a]])}return l}const fI={type:"Hermite",getRequiredDataPoints:function(e,t){if(t=R(t,0),!C(e))throw new x("degree is required.");if(e<0)throw new x("degree must be 0 or greater.");if(t<0)throw new x("inputOrder must be 0 or greater.");return Math.max(Math.floor((e+1)/(t+1)),2)},interpolateOrderZero:function(e,t,n,i,o){let r,s,a,c,l,u;C(o)||(o=new Array(i));const h=t.length,d=new Array(i);for(r=0;r<i;r++){o[r]=0;const e=new Array(h);for(d[r]=e,s=0;s<h;s++)e[s]=[]}const f=h,p=new Array(f);for(r=0;r<f;r++)p[r]=r;let m=h-1;for(c=0;c<i;c++){for(s=0;s<f;s++)u=p[s]*i+c,d[c][0].push(n[u]);for(r=1;r<f;r++){let e=!1;for(s=0;s<f-r;s++){const o=t[p[s]],a=t[p[s+r]];let l;a-o<=0?(u=p[s]*i+i*r+c,l=n[u],d[c][r].push(l/hI(r))):(l=d[c][r-1][s+1]-d[c][r-1][s],d[c][r].push(l/(a-o))),e=e||0!==l}e||(m=r-1)}}for(a=0,l=0;a<=l;a++)for(r=a;r<=m;r++){const n=dI(e,p,t,a,r,[]);for(c=0;c<i;c++){const e=d[c][r][0];o[c+a*i]+=e*n}}return o}},pI=[];function mI(e,t,n,i,o,r){let s,a,c=-1;const l=t.length,u=l*(l+1)/2;for(let h=0;h<o;h++){const d=Math.floor(h*u);for(s=0;s<l;s++)a=t[s]*o*(r+1)+h,e[d+s]=i[a];for(let u=1;u<l;u++){let f=0;const p=Math.floor(u*(1-u)/2)+l*u;let m=!1;for(s=0;s<l-u;s++){const c=n[t[s]],_=n[t[s+u]];let g,y;if(_-c<=0)a=t[s]*o*(r+1)+o*u+h,g=i[a],y=g/z.factorial(u),e[d+p+f]=y,f++;else{const t=Math.floor((u-1)*(2-u)/2)+l*(u-1);g=e[d+t+s+1]-e[d+t+s],y=g/(_-c),e[d+p+f]=y,f++}m=m||0!==g}m&&(c=Math.max(c,u))}}return c}fI.interpolate=function(e,t,n,i,o,r,s){const a=i*(r+1);C(s)||(s=new Array(a));for(let g=0;g<a;g++)s[g]=0;const c=t.length,l=new Array(c*(o+1));let u;for(u=0;u<c;u++)for(let e=0;e<o+1;e++)l[u*(o+1)+e]=u;const h=l.length,d=pI,f=mI(d,l,t,n,i,o),p=[],m=h*(h+1)/2,_=Math.min(f,r);for(let g=0;g<=_;g++)for(u=g;u<=f;u++){p.length=0;const n=dI(e,l,t,g,u,p),o=Math.floor(u*(1-u)/2)+h*u;for(let e=0;e<i;e++){const t=Math.floor(e*m),r=d[t+o];s[e+g*i]+=r*n}}return s};var _I=fI;const gI={};function yI(e,t,n,i){if(0!==i)return;1===n&&(t.x=e-1-t.x,t.y=e-1-t.y);const o=t.x;t.x=t.y,t.y=o}gI.encode2D=function(e,t,n){const i=Math.pow(2,e);if(D.typeOf.number("level",e),D.typeOf.number("x",t),D.typeOf.number("y",n),e<1)throw new x("Hilbert level cannot be less than 1.");if(t<0||t>=i||n<0||n>=i)throw new x("Invalid coordinates for given level.");const o={x:t,y:n};let r,s,a,c=BigInt(0);for(a=i/2;a>0;a/=2)r=(o.x&a)>0?1:0,s=(o.y&a)>0?1:0,c+=BigInt((3*r^s)*a*a),yI(i,o,r,s);return c},gI.decode2D=function(e,t){if(D.typeOf.number("level",e),D.typeOf.bigint("index",t),e<1)throw new x("Hilbert level cannot be less than 1.");if(t<BigInt(0)||t>=BigInt(Math.pow(4,e)))throw new x("Hilbert index exceeds valid maximum for given level.");const n=Math.pow(2,e),i={x:0,y:0};let o,r,s,a;for(s=1,a=t;s<n;s*=2)o=1&Number(a/BigInt(2)),r=1&Number(a^BigInt(o)),yI(s,i,o,r),i.x+=s*o,i.y+=s*r,a/=BigInt(4);return[i.x,i.y]};var vI=gI;function bI(e,t,n,i){this.rightAscension=e,this.declination=t,this.rotation=n,this.rotationRate=i}var AI=bI;const wI={},TI=32.184,CI=2451545,EI=-.0529921,xI=-.1059842,SI=13.0120009,II=13.3407154,OI=.9856003,DI=26.4057084,PI=13.064993,RI=.3287146,LI=1.7484877,MI=-.1589763,BI=.0036096,NI=.1643573,FI=12.9590088;let zI=new Ea;wI.ComputeMoon=function(e,t){C(e)||(e=Ea.now()),zI=Ea.addSeconds(e,TI,zI);const n=Ea.totalDays(zI)-CI,i=n/ta.DAYS_PER_JULIAN_CENTURY,o=(125.045+EI*n)*z.RADIANS_PER_DEGREE,r=(250.089+xI*n)*z.RADIANS_PER_DEGREE,s=(260.008+SI*n)*z.RADIANS_PER_DEGREE,a=(176.625+II*n)*z.RADIANS_PER_DEGREE,c=(357.529+OI*n)*z.RADIANS_PER_DEGREE,l=(311.589+DI*n)*z.RADIANS_PER_DEGREE,u=(134.963+PI*n)*z.RADIANS_PER_DEGREE,h=(276.617+RI*n)*z.RADIANS_PER_DEGREE,d=(34.226+LI*n)*z.RADIANS_PER_DEGREE,f=(15.134+MI*n)*z.RADIANS_PER_DEGREE,p=(119.743+BI*n)*z.RADIANS_PER_DEGREE,m=(239.961+NI*n)*z.RADIANS_PER_DEGREE,_=(25.053+FI*n)*z.RADIANS_PER_DEGREE,g=Math.sin(o),y=Math.sin(r),v=Math.sin(s),b=Math.sin(a),A=Math.sin(c),w=Math.sin(l),T=Math.sin(u),E=Math.sin(h),x=Math.sin(d),S=Math.sin(f),I=Math.sin(p),O=Math.sin(m),D=Math.sin(_),P=Math.cos(o),R=Math.cos(r),L=Math.cos(s),M=Math.cos(a),B=Math.cos(c),N=Math.cos(l),F=Math.cos(u),k=Math.cos(h),U=Math.cos(d),V=Math.cos(f),H=Math.cos(p),G=Math.cos(m),W=Math.cos(_),q=(269.9949+.0031*i-3.8787*g-.1204*y+.07*v-.0172*b+.0072*w-.0052*S+.0043*D)*z.RADIANS_PER_DEGREE,j=(66.5392+.013*i+1.5419*P+.0239*R-.0278*L+.0068*M-.0029*N+9e-4*F+8e-4*V-9e-4*W)*z.RADIANS_PER_DEGREE,Y=(38.3213+13.17635815*n-14e-13*n*n+3.561*g+.1208*y-.0642*v+.0158*b+.0252*A-.0066*w-.0047*T-.0046*E+.0028*x+.0052*S+.004*I+.0019*O-.0044*D)*z.RADIANS_PER_DEGREE,K=(13.17635815-2*n*14e-13+3.561*P*EI+.1208*R*xI-.0642*L*SI+.0158*M*II+.0252*B*OI-.0066*N*DI-.0047*F*PI-.0046*k*RI+.0028*U*LI+.0052*V*MI+.004*H*BI+.0019*G*NI-.0044*W*FI)/86400*z.RADIANS_PER_DEGREE;return C(t)||(t=new AI),t.rightAscension=q,t.declination=j,t.rotation=Y,t.rotationRate=K,t};var kI=wI;function UI(e){C(e)&&"function"===typeof e||(e=kI.ComputeMoon),this._computeFunction=e}const VI=new K,HI=new K,GI=new K;function WI(e,t,n){const i=VI;i.x=Math.cos(e+z.PI_OVER_TWO),i.y=Math.sin(e+z.PI_OVER_TWO),i.z=0;const o=Math.cos(t),r=GI;r.x=o*Math.cos(e),r.y=o*Math.sin(e),r.z=Math.sin(t);const s=K.cross(r,i,HI);return C(n)||(n=new ke),n[0]=i.x,n[1]=s.x,n[2]=r.x,n[3]=i.y,n[4]=s.y,n[5]=r.y,n[6]=i.z,n[7]=s.z,n[8]=r.z,n}const qI=new ke,jI=new il;UI.prototype.evaluate=function(e,t){C(e)||(e=Ea.now());const n=this._computeFunction(e),i=WI(n.rightAscension,n.declination,t),o=z.zeroToTwoPi(n.rotation),r=il.fromAxisAngle(K.UNIT_Z,o,jI),s=ke.fromQuaternion(il.conjugate(r,r),qI),a=ke.multiply(s,i,i);return a};var YI=UI;const KI={type:void 0};KI.getRequiredDataPoints=x.throwInstantiationError,KI.interpolateOrderZero=x.throwInstantiationError,KI.interpolate=x.throwInstantiationError;let XI;const QI="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI2YzU4ZDFiYS0yY2Q0LTRkYTItYjI1MS1iZjFiYTM2ZmVmNGYiLCJpZCI6MjU5LCJpYXQiOjE2NDg4MzQyNTN9.TTJ-QAXRECpsYbLFn6Pu60v6c21wIR2IOKBO9VSkOnM",JI={};JI.defaultAccessToken=QI,JI.defaultServer=new Vi({url:"https://api.cesium.com/"}),JI.getDefaultTokenCredit=function(e){if(e===QI){if(!C(XI)){const e='<b>             This application is using Cesium\'s default ion access token. Please assign <i>Cesium.Ion.defaultAccessToken</i>             with an access token from your ion account before making any Cesium API calls.             You can sign up for a free ion account at <a href="https://cesium.com">https://cesium.com</a>.</b>';XI=new Tr(e,!0)}return XI}};var ZI=JI;function $I(e){D.defined("url",e),this._url=Vi.createIfNeeded(e),this._url.appendForwardSlash()}Object.defineProperties($I.prototype,{url:{get:function(){return this._url}}}),$I.prototype.geocode=function(e,t){D.typeOf.string("query",e);const n=this._url.getDerivedResource({url:t===ME.AUTOCOMPLETE?"autocomplete":"search",queryParameters:{text:e}});return n.fetchJson().then((function(e){return e.features.map((function(e){let t;const n=e.bbox;if(C(n))t=_t.fromDegrees(n[0],n[1],n[2],n[3]);else{const n=e.geometry.coordinates[0],i=e.geometry.coordinates[1];t=K.fromDegrees(n,i)}return{displayName:e.properties.label,destination:t}}))}))};var eO=$I;function tO(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.object("options.scene",e.scene);const t=R(e.accessToken,ZI.defaultAccessToken),n=Vi.createIfNeeded(R(e.server,ZI.defaultServer));n.appendForwardSlash();const i=ZI.getDefaultTokenCredit(t);C(i)&&e.scene.frameState.creditDisplay.addDefaultCredit(Tr.clone(i));const o=n.getDerivedResource({url:"v1/geocode"});C(t)&&o.appendQueryParameters({access_token:t}),this._accessToken=t,this._server=n,this._pelias=new eO(o)}tO.prototype.geocode=function(e,t){return this._pelias.geocode(e,t)};var nO=tO;function iO(e,t){let n;D.defined("endpoint",e),D.defined("endpointResource",t);const i=e.externalType,o=C(i);if(o){if("3DTILES"!==i&&"STK_TERRAIN_SERVER"!==i)throw new Je("Ion.createResource does not support external imagery assets; use IonImageryProvider instead.");n={url:e.options.url}}else n={url:e.url,retryAttempts:1,retryCallback:oO};Vi.call(this,n),this._ionEndpoint=e,this._ionEndpointDomain=o?void 0:new cn(e.url).authority(),this._ionEndpointResource=t,this._ionRoot=void 0,this._pendingPromise=void 0,this._credits=void 0,this._isExternal=o}function oO(e,t){const n=R(e._ionRoot,e),i=n._ionEndpointResource,o="undefined"!==typeof Image;return C(t)&&(401===t.statusCode||o&&t.target instanceof Image)?(C(n._pendingPromise)||(n._pendingPromise=i.fetchJson().then((function(e){return n._ionEndpoint=e,e})).finally((function(e){return n._pendingPromise=void 0,e}))),n._pendingPromise.then((function(t){return e._ionEndpoint=t,!0}))):Promise.resolve(!1)}C(Object.create)&&(iO.prototype=Object.create(Vi.prototype),iO.prototype.constructor=iO),iO.fromAssetId=function(e,t){const n=iO._createEndpointResource(e,t);return n.fetchJson().then((function(e){return new iO(e,n)}))},Object.defineProperties(iO.prototype,{credits:{get:function(){return C(this._ionRoot)?this._ionRoot.credits:(C(this._credits)||(this._credits=iO.getCreditsFromEndpoint(this._ionEndpoint,this._ionEndpointResource)),this._credits)}}}),iO.getCreditsFromEndpoint=function(e,t){const n=e.attributions.map(Tr.getIonCredit),i=ZI.getDefaultTokenCredit(t.queryParameters.access_token);return C(i)&&n.push(Tr.clone(i)),n},iO.prototype.clone=function(e){const t=R(this._ionRoot,this);return C(e)||(e=new iO(t._ionEndpoint,t._ionEndpointResource)),e=Vi.prototype.clone.call(this,e),e._ionRoot=t,e._isExternal=this._isExternal,e},iO.prototype.fetchImage=function(e){if(!this._isExternal){const t=e;e={preferBlob:!0},C(t)&&(e.flipY=t.flipY,e.preferImageBitmap=t.preferImageBitmap)}return Vi.prototype.fetchImage.call(this,e)},iO.prototype._makeRequest=function(e){return this._isExternal||new cn(this.url).authority()!==this._ionEndpointDomain||(C(e.headers)||(e.headers={}),e.headers.Authorization=`Bearer ${this._ionEndpoint.accessToken}`),Vi.prototype._makeRequest.call(this,e)},iO._createEndpointResource=function(e,t){D.defined("assetId",e),t=R(t,R.EMPTY_OBJECT);let n=R(t.server,ZI.defaultServer);const i=R(t.accessToken,ZI.defaultAccessToken);n=Vi.createIfNeeded(n);const o={url:`v1/assets/${e}/endpoint`};return C(i)&&(o.queryParameters={access_token:i}),n.getDerivedResource(o)};var rO=iO;function sO(e){e=R(e,R.EMPTY_OBJECT),this.start=C(e.start)?Ea.clone(e.start):new Ea,this.stop=C(e.stop)?Ea.clone(e.stop):new Ea,this.data=e.data,this.isStartIncluded=R(e.isStartIncluded,!0),this.isStopIncluded=R(e.isStopIncluded,!0)}Object.defineProperties(sO.prototype,{isEmpty:{get:function(){const e=Ea.compare(this.stop,this.start);return e<0||0===e&&(!this.isStartIncluded||!this.isStopIncluded)}}});const aO={start:void 0,stop:void 0,isStartIncluded:void 0,isStopIncluded:void 0,data:void 0};sO.fromIso8601=function(e,t){D.typeOf.object("options",e),D.typeOf.string("options.iso8601",e.iso8601);const n=e.iso8601.split("/");if(2!==n.length)throw new x("options.iso8601 is an invalid ISO 8601 interval.");const i=Ea.fromIso8601(n[0]),o=Ea.fromIso8601(n[1]),r=R(e.isStartIncluded,!0),s=R(e.isStopIncluded,!0),a=e.data;return C(t)?(t.start=i,t.stop=o,t.isStartIncluded=r,t.isStopIncluded=s,t.data=a,t):(aO.start=i,aO.stop=o,aO.isStartIncluded=r,aO.isStopIncluded=s,aO.data=a,new sO(aO))},sO.toIso8601=function(e,t){return D.typeOf.object("timeInterval",e),`${Ea.toIso8601(e.start,t)}/${Ea.toIso8601(e.stop,t)}`},sO.clone=function(e,t){if(C(e))return C(t)?(t.start=e.start,t.stop=e.stop,t.isStartIncluded=e.isStartIncluded,t.isStopIncluded=e.isStopIncluded,t.data=e.data,t):new sO(e)},sO.equals=function(e,t,n){return e===t||C(e)&&C(t)&&(e.isEmpty&&t.isEmpty||e.isStartIncluded===t.isStartIncluded&&e.isStopIncluded===t.isStopIncluded&&Ea.equals(e.start,t.start)&&Ea.equals(e.stop,t.stop)&&(e.data===t.data||C(n)&&n(e.data,t.data)))},sO.equalsEpsilon=function(e,t,n,i){return n=R(n,0),e===t||C(e)&&C(t)&&(e.isEmpty&&t.isEmpty||e.isStartIncluded===t.isStartIncluded&&e.isStopIncluded===t.isStopIncluded&&Ea.equalsEpsilon(e.start,t.start,n)&&Ea.equalsEpsilon(e.stop,t.stop,n)&&(e.data===t.data||C(i)&&i(e.data,t.data)))},sO.intersect=function(e,t,n,i){if(D.typeOf.object("left",e),!C(t))return sO.clone(sO.EMPTY,n);const o=e.start,r=e.stop,s=t.start,a=t.stop,c=Ea.greaterThanOrEquals(s,o)&&Ea.greaterThanOrEquals(r,s),l=!c&&Ea.lessThanOrEquals(s,o)&&Ea.lessThanOrEquals(o,a);if(!c&&!l)return sO.clone(sO.EMPTY,n);const u=e.isStartIncluded,h=e.isStopIncluded,d=t.isStartIncluded,f=t.isStopIncluded,p=Ea.lessThan(r,a);return C(n)||(n=new sO),n.start=c?s:o,n.isStartIncluded=u&&d||!Ea.equals(s,o)&&(c&&d||l&&u),n.stop=p?r:a,n.isStopIncluded=p?h:h&&f||!Ea.equals(a,r)&&f,n.data=C(i)?i(e.data,t.data):e.data,n},sO.contains=function(e,t){if(D.typeOf.object("timeInterval",e),D.typeOf.object("julianDate",t),e.isEmpty)return!1;const n=Ea.compare(e.start,t);if(0===n)return e.isStartIncluded;const i=Ea.compare(t,e.stop);return 0===i?e.isStopIncluded:n<0&&i<0},sO.prototype.clone=function(e){return sO.clone(this,e)},sO.prototype.equals=function(e,t){return sO.equals(this,e,t)},sO.prototype.equalsEpsilon=function(e,t,n){return sO.equalsEpsilon(this,e,t,n)},sO.prototype.toString=function(){return sO.toIso8601(this)},sO.EMPTY=Object.freeze(new sO({start:new Ea,stop:new Ea,isStartIncluded:!1,isStopIncluded:!1}));var cO=sO;const lO=Object.freeze(Ea.fromIso8601("0000-01-01T00:00:00Z")),uO=Object.freeze(Ea.fromIso8601("9999-12-31T24:00:00Z")),hO=Object.freeze(new cO({start:lO,stop:uO})),dO={MINIMUM_VALUE:lO,MAXIMUM_VALUE:uO,MAXIMUM_INTERVAL:hO};var fO=dO;function pO(){}function mO(){const e=pO._transcodeTaskProcessor.initWebAssemblyModule({modulePath:"ThirdParty/Workers/basis_transcoder.js",wasmBinaryFile:"ThirdParty/basis_transcoder.wasm"}).then((function(){return pO._transcodeTaskProcessor}));pO._readyPromise=e}pO._transcodeTaskProcessor=new ad("transcodeKTX2",Number.POSITIVE_INFINITY),pO._readyPromise=void 0,pO.transcode=function(e,t){return D.defined("supportedTargetFormats",t),C(pO._readyPromise)||mO(),pO._readyPromise.then((function(n){let i;if(e instanceof ArrayBuffer){const o=new Uint8Array(e);return i={supportedTargetFormats:t,ktx2Buffer:o},n.scheduleTask(i,[e])}return i={supportedTargetFormats:t,ktx2Buffer:e},n.scheduleTask(i,[e.buffer])})).then((function(e){const t=e.length,n=Object.keys(e[0]),i=n.length;let o;for(o=0;o<t;o++){const t=e[o];for(let e=0;e<i;e++){const i=t[n[e]];t[n[e]]=new Dy(i.internalFormat,i.datatype,i.width,i.height,i.levelBuffer)}}if(1===i){for(o=0;o<t;++o)e[o]=e[o][n[0]];1===t&&(e=e[0])}return e})).catch((function(e){throw e}))};var _O=pO;const gO={SHIFT:0,CTRL:1,ALT:2};var yO=Object.freeze(gO);const vO={type:"Lagrange",getRequiredDataPoints:function(e){return Math.max(e+1,2)},interpolateOrderZero:function(e,t,n,i,o){let r,s;C(o)||(o=new Array(i));const a=t.length;for(r=0;r<i;r++)o[r]=0;for(r=0;r<a;r++){let c=1;for(s=0;s<a;s++)if(s!==r){const n=t[r]-t[s];c*=(e-t[s])/n}for(s=0;s<i;s++)o[s]+=c*n[r*i+s]}return o}};var bO=vO;const AO={type:"Linear",getRequiredDataPoints:function(e){return 2},interpolateOrderZero:function(e,t,n,i,o){if(2!==t.length)throw new x("The xTable provided to the linear interpolator must have exactly two elements.");if(i<=0)throw new x("There must be at least 1 dependent variable for each independent variable.");let r,s,a;C(o)||(o=new Array(i));const c=t[0],l=t[1];if(c===l)throw new x("Divide by zero error: xTable[0] and xTable[1] are equal");for(r=0;r<i;r++)s=n[r],a=n[r+i],o[r]=((a-s)*e+l*s-c*a)/(l-c);return o}};var wO=AO;function TO(e){e=R(e,0),this._array=new Array(e),this._length=e}Object.defineProperties(TO.prototype,{length:{get:function(){return this._length},set:function(e){D.typeOf.number.greaterThanOrEquals("length",e,0);const t=this._array,n=this._length;if(e<n)for(let i=e;i<n;++i)t[i]=void 0;else e>t.length&&(t.length=e);this._length=e}},values:{get:function(){return this._array}}}),TO.prototype.get=function(e){return D.typeOf.number.lessThan("index",e,this._array.length),this._array[e]},TO.prototype.set=function(e,t){D.typeOf.number("index",e),e>=this._length&&(this.length=e+1),this._array[e]=t},TO.prototype.peek=function(){return this._array[this._length-1]},TO.prototype.push=function(e){const t=this.length++;this._array[t]=e},TO.prototype.pop=function(){if(0===this._length)return;const e=this._array[this._length-1];return--this.length,e},TO.prototype.reserve=function(e){D.typeOf.number.greaterThanOrEquals("length",e,0),e>this._array.length&&(this._array.length=e)},TO.prototype.resize=function(e){D.typeOf.number.greaterThanOrEquals("length",e,0),this.length=e},TO.prototype.trim=function(e){e=R(e,this._length),this._array.length=e};var CO=TO;function EO(){x.throwInstantiationError()}Object.defineProperties(EO.prototype,{ellipsoid:{get:x.throwInstantiationError}}),EO.prototype.project=x.throwInstantiationError,EO.prototype.unproject=x.throwInstantiationError;const xO={};function SO(e){return e=16711935&(e^e<<8),e=252645135&(e^e<<4),e=858993459&(e^e<<2),e=1431655765&(e^e<<1),e}function IO(e){return e=50331903&(e^e<<16),e=50393103&(e^e<<8),e=51130563&(e^e<<4),e=153391689&(e^e<<2),e}function OO(e){return e&=1431655765,e=858993459&(e^e>>1),e=252645135&(e^e>>2),e=16711935&(e^e>>4),e=65535&(e^e>>8),e}function DO(e){return e&=153391689,e=51130563&(e^e>>2),e=50393103&(e^e>>4),e=4278190335&(e^e>>8),e=1023&(e^e>>16),e}xO.encode2D=function(e,t){if(D.typeOf.number("x",e),D.typeOf.number("y",t),e<0||e>65535||t<0||t>65535)throw new x("inputs must be 16-bit unsigned integers");return(SO(e)|SO(t)<<1)>>>0},xO.decode2D=function(e,t){if(D.typeOf.number("mortonIndex",e),e<0||e>4294967295)throw new x("input must be a 32-bit unsigned integer");return C(t)||(t=new Array(2)),t[0]=OO(e),t[1]=OO(e>>1),t},xO.encode3D=function(e,t,n){if(D.typeOf.number("x",e),D.typeOf.number("y",t),D.typeOf.number("z",n),e<0||e>1023||t<0||t>1023||n<0||n>1023)throw new x("inputs must be 10-bit unsigned integers");return IO(e)|IO(t)<<1|IO(n)<<2},xO.decode3D=function(e,t){if(D.typeOf.number("mortonIndex",e),e<0||e>1073741823)throw new x("input must be a 30-bit unsigned integer");return C(t)||(t=new Array(3)),t[0]=DO(e),t[1]=DO(e>>1),t[2]=DO(e>>2),t};var PO=xO;function RO(e,t,n,i){this.near=R(e,0),this.nearValue=R(t,0),this.far=R(n,1),this.farValue=R(i,0)}RO.clone=function(e,t){if(C(e))return C(t)?(t.near=e.near,t.nearValue=e.nearValue,t.far=e.far,t.farValue=e.farValue,t):new RO(e.near,e.nearValue,e.far,e.farValue)},RO.packedLength=4,RO.pack=function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");return n=R(n,0),t[n++]=e.near,t[n++]=e.nearValue,t[n++]=e.far,t[n]=e.farValue,t},RO.unpack=function(e,t,n){if(!C(e))throw new x("array is required");return t=R(t,0),C(n)||(n=new RO),n.near=e[t++],n.nearValue=e[t++],n.far=e[t++],n.farValue=e[t],n},RO.equals=function(e,t){return e===t||C(e)&&C(t)&&e.near===t.near&&e.nearValue===t.nearValue&&e.far===t.far&&e.farValue===t.farValue},RO.prototype.clone=function(e){return RO.clone(this,e)},RO.prototype.equals=function(e){return RO.equals(this,e)};var LO=RO;const MO={NONE:-1,PARTIAL:0,FULL:1};var BO=Object.freeze(MO);function NO(e,t){if(!C(e))throw new x("occluderBoundingSphere is required.");if(!C(t))throw new x("camera position is required.");this._occluderPosition=K.clone(e.center),this._occluderRadius=e.radius,this._horizonDistance=0,this._horizonPlaneNormal=void 0,this._horizonPlanePosition=void 0,this._cameraPosition=void 0,this.cameraPosition=t}const FO=new K;Object.defineProperties(NO.prototype,{position:{get:function(){return this._occluderPosition}},radius:{get:function(){return this._occluderRadius}},cameraPosition:{set:function(e){if(!C(e))throw new x("cameraPosition is required.");e=K.clone(e,this._cameraPosition);const t=K.subtract(this._occluderPosition,e,FO);let n=K.magnitudeSquared(t);const i=this._occluderRadius*this._occluderRadius;let o,r,s;if(n>i){o=Math.sqrt(n-i),n=1/Math.sqrt(n),r=K.multiplyByScalar(t,n,FO);const a=o*o*n;s=K.add(e,K.multiplyByScalar(r,a,FO),FO)}else o=Number.MAX_VALUE;this._horizonDistance=o,this._horizonPlaneNormal=r,this._horizonPlanePosition=s,this._cameraPosition=e}}}),NO.fromBoundingSphere=function(e,t,n){if(!C(e))throw new x("occluderBoundingSphere is required.");if(!C(t))throw new x("camera position is required.");return C(n)?(K.clone(e.center,n._occluderPosition),n._occluderRadius=e.radius,n.cameraPosition=t,n):new NO(e,t)};const zO=new K;NO.prototype.isPointVisible=function(e){if(this._horizonDistance!==Number.MAX_VALUE){let t=K.subtract(e,this._occluderPosition,zO),n=this._occluderRadius;if(n=K.magnitudeSquared(t)-n*n,n>0)return n=Math.sqrt(n)+this._horizonDistance,t=K.subtract(e,this._cameraPosition,t),n*n>K.magnitudeSquared(t)}return!1};const kO=new K;NO.prototype.isBoundingSphereVisible=function(e){const t=K.clone(e.center,kO),n=e.radius;if(this._horizonDistance!==Number.MAX_VALUE){let e=K.subtract(t,this._occluderPosition,zO),i=this._occluderRadius-n;if(i=K.magnitudeSquared(e)-i*i,n<this._occluderRadius)return i>0&&(i=Math.sqrt(i)+this._horizonDistance,e=K.subtract(t,this._cameraPosition,e),i*i+n*n>K.magnitudeSquared(e));if(i>0){e=K.subtract(t,this._cameraPosition,e);const o=K.magnitudeSquared(e),r=this._occluderRadius*this._occluderRadius,s=n*n;return(this._horizonDistance*this._horizonDistance+r)*s>o*r||(i=Math.sqrt(i)+this._horizonDistance,i*i+s>o)}return!0}return!1};const UO=new K;NO.prototype.computeVisibility=function(e){if(!C(e))throw new x("occludeeBS is required.");const t=K.clone(e.center),n=e.radius;if(n>this._occluderRadius)return BO.FULL;if(this._horizonDistance!==Number.MAX_VALUE){let e=K.subtract(t,this._occluderPosition,UO),i=this._occluderRadius-n;const o=K.magnitudeSquared(e);if(i=o-i*i,i>0){i=Math.sqrt(i)+this._horizonDistance,e=K.subtract(t,this._cameraPosition,e);const r=K.magnitudeSquared(e);return i*i+n*n<r?BO.NONE:(i=this._occluderRadius+n,i=o-i*i,i>0?(i=Math.sqrt(i)+this._horizonDistance,r<i*i+n*n?BO.FULL:BO.PARTIAL):(e=K.subtract(t,this._horizonPlanePosition,e),K.dot(e,this._horizonPlaneNormal)>-n?BO.PARTIAL:BO.FULL))}}return BO.NONE};const VO=new K;NO.computeOccludeePoint=function(e,t,n){if(!C(e))throw new x("occluderBoundingSphere is required.");if(!C(n))throw new x("positions is required.");if(0===n.length)throw new x("positions must contain at least one element");const i=K.clone(t),o=K.clone(e.center),r=e.radius,s=n.length;if(K.equals(o,t))throw new x("occludeePosition must be different than occluderBoundingSphere.center");const a=K.normalize(K.subtract(i,o,VO),VO),c=-K.dot(a,o),l=NO._anyRotationVector(o,a,c);let u,h=NO._horizonToPlaneNormalDotProduct(e,a,c,l,n[0]);if(!h)return;for(let f=1;f<s;++f){if(u=NO._horizonToPlaneNormalDotProduct(e,a,c,l,n[f]),!u)return;u<h&&(h=u)}if(h<.0017453283658983088)return;const d=r/h;return K.add(o,K.multiplyByScalar(a,d,VO),VO)};const HO=[];NO.computeOccludeePointFromRectangle=function(e,t){if(!C(e))throw new x("rectangle is required.");t=R(t,ge.WGS84);const n=_t.subsample(e,t,0,HO),i=nn.fromPoints(n),o=K.ZERO;if(!K.equals(o,i.center))return NO.computeOccludeePoint(new nn(o,t.minimumRadius),i.center,n)};const GO=new K;NO._anyRotationVector=function(e,t,n){const i=K.abs(t,GO);let o=i.x>i.y?0:1;(0===o&&i.z>i.x||1===o&&i.z>i.y)&&(o=2);const r=new K;let s;0===o?(i.x=e.x,i.y=e.y+1,i.z=e.z+1,s=K.UNIT_X):1===o?(i.x=e.x+1,i.y=e.y,i.z=e.z+1,s=K.UNIT_Y):(i.x=e.x+1,i.y=e.y+1,i.z=e.z,s=K.UNIT_Z);const a=(K.dot(t,i)+n)/-K.dot(t,s);return K.normalize(K.subtract(K.add(i,K.multiplyByScalar(s,a,r),i),e,i),i)};const WO=new K;NO._rotationVector=function(e,t,n,i,o){let r=K.subtract(i,e,WO);if(r=K.normalize(r,r),K.dot(t,r)<.9999999847691291){const e=K.cross(t,r,r),n=K.magnitude(e);if(n>z.EPSILON13)return K.normalize(e,new K)}return o};const qO=new K,jO=new K,YO=new K,KO=new K;NO._horizonToPlaneNormalDotProduct=function(e,t,n,i,o){const r=K.clone(o,qO),s=K.clone(e.center,jO),a=e.radius;let c=K.subtract(s,r,YO);const l=K.magnitudeSquared(c),u=a*a;if(l<u)return!1;const h=l-u,d=Math.sqrt(h),f=Math.sqrt(l),p=1/f,m=d*p,_=m*d;c=K.normalize(c,c);const g=K.add(r,K.multiplyByScalar(c,_,KO),KO),y=Math.sqrt(h-_*_);let v=this._rotationVector(s,t,n,r,i),b=K.fromElements(v.x*v.x*c.x+(v.x*v.y-v.z)*c.y+(v.x*v.z+v.y)*c.z,(v.x*v.y+v.z)*c.x+v.y*v.y*c.y+(v.y*v.z-v.x)*c.z,(v.x*v.z-v.y)*c.x+(v.y*v.z+v.x)*c.y+v.z*v.z*c.z,qO);b=K.normalize(b,b);const A=K.multiplyByScalar(b,y,qO);v=K.normalize(K.subtract(K.add(g,A,YO),s,YO),YO);const w=K.dot(t,v);v=K.normalize(K.subtract(K.subtract(g,A,v),s,v),v);const T=K.dot(t,v);return w<T?w:T};var XO=NO;function QO(e,t,n){e=R(e,0),t=R(t,0),n=R(n,0),this.value=new Float32Array([e,t,n])}Object.defineProperties(QO.prototype,{componentDatatype:{get:function(){return ih.FLOAT}},componentsPerAttribute:{get:function(){return 3}},normalize:{get:function(){return!1}}}),QO.fromCartesian3=function(e){return D.defined("offset",e),new QO(e.x,e.y,e.z)},QO.toValue=function(e,t){return D.defined("offset",e),C(t)||(t=new Float32Array([e.x,e.y,e.z])),t[0]=e.x,t[1]=e.y,t[2]=e.z,t};var JO=QO;function ZO(e,t,n){D.defined("url",e),D.defined("apiKey",t),C(n)&&D.typeOf.object("params",n),e=Vi.createIfNeeded(e),e.appendForwardSlash(),e.setQueryParameters({key:t}),this._url=e,this._params=R(n,{})}Object.defineProperties(ZO.prototype,{url:{get:function(){return this._url}},params:{get:function(){return this._params}}}),ZO.prototype.geocode=function(e){D.typeOf.string("query",e);const t=this._url.getDerivedResource({url:"json",queryParameters:_n(this._params,{q:e})});return t.fetchJson().then((function(e){return e.results.map((function(e){let t;const n=e.bounds;if(C(n))t=_t.fromDegrees(n.southwest.lng,n.southwest.lat,n.northeast.lng,n.northeast.lat);else{const n=e.geometry.lat,i=e.geometry.lng;t=K.fromDegrees(n,i)}return{displayName:e.formatted,destination:t}}))}))};x.throwInstantiationError,x.throwInstantiationError;x.throwInstantiationError,x.throwInstantiationError;function $O(e,t,n,i,o){const r=e.measureText(t),s=!/\S/.test(t);if(!s){const s=document.defaultView.getComputedStyle(e.canvas).getPropertyValue("font-size").replace("px",""),a=document.createElement("canvas"),c=100,l=r.width+c|0,u=3*s,h=u/2;a.width=l,a.height=u;const d=a.getContext("2d");d.font=n,d.fillStyle="white",d.fillRect(0,0,a.width+1,a.height+1),i&&(d.strokeStyle="black",d.lineWidth=e.lineWidth,d.strokeText(t,c/2,h)),o&&(d.fillStyle="black",d.fillText(t,c/2,h));const f=d.getImageData(0,0,l,u).data,p=f.length,m=4*l;let _,g,y,v;for(_=0;_<p;++_)if(255!==f[_]){y=_/m|0;break}for(_=p-1;_>=0;--_)if(255!==f[_]){v=_/m|0;break}let b=-1;for(_=0;_<l&&-1===b;++_)for(g=0;g<u;++g){const e=4*_+g*m;if(255!==f[e]||255!==f[e+1]||255!==f[e+2]||255!==f[e+3]){b=_;break}}return{width:r.width,height:v-y,ascent:h-y,descent:v-h,minx:b-c/2}}return{width:r.width,height:0,ascent:0,descent:0,minx:0}}let eD;function tD(e,t){if(!C(e))throw new x("text is required.");if(""===e)return;t=R(t,R.EMPTY_OBJECT);const n=R(t.font,"10px sans-serif"),i=R(t.stroke,!1),o=R(t.fill,!0),r=R(t.strokeWidth,1),s=R(t.backgroundColor,xy.TRANSPARENT),a=R(t.padding,0),c=2*a,l=document.createElement("canvas");l.width=1,l.height=1,l.style.font=n;const u=l.getContext("2d");C(eD)||(C(u.imageSmoothingEnabled)?eD="imageSmoothingEnabled":C(u.mozImageSmoothingEnabled)?eD="mozImageSmoothingEnabled":C(u.webkitImageSmoothingEnabled)?eD="webkitImageSmoothingEnabled":C(u.msImageSmoothingEnabled)&&(eD="msImageSmoothingEnabled")),u.font=n,u.lineJoin="round",u.lineWidth=r,u[eD]=!1,l.style.visibility="hidden",document.body.appendChild(l);const h=$O(u,e,n,i,o);l.dimensions=h,document.body.removeChild(l),l.style.visibility="";const d=-h.minx,f=Math.ceil(h.width)+d+c,p=h.height+c,m=p-h.ascent+a,_=p-m+c;if(l.width=f,l.height=p,u.font=n,u.lineJoin="round",u.lineWidth=r,u[eD]=!1,s!==xy.TRANSPARENT&&(u.fillStyle=s.toCssColorString(),u.fillRect(0,0,l.width,l.height)),i){const n=R(t.strokeColor,xy.BLACK);u.strokeStyle=n.toCssColorString(),u.strokeText(e,d+a,_)}if(o){const n=R(t.fillColor,xy.WHITE);u.fillStyle=n.toCssColorString(),u.fillText(e,d+a,_)}return l}var nD=tD;function iD(){this._cache={}}iD.prototype.fromColor=function(e,t){if(!C(e))throw new x("color is required");if(!C(t))throw new x("size is required");return cD(void 0,void 0,e,t,this._cache)},iD.prototype.fromUrl=function(e,t,n){if(!C(e))throw new x("url is required");if(!C(t))throw new x("color is required");if(!C(n))throw new x("size is required");return cD(e,void 0,t,n,this._cache)},iD.prototype.fromMakiIconId=function(e,t,n){if(!C(e))throw new x("id is required");if(!C(t))throw new x("color is required");if(!C(n))throw new x("size is required");return cD(Zi(`Assets/Textures/maki/${encodeURIComponent(e)}.png`),void 0,t,n,this._cache)},iD.prototype.fromText=function(e,t,n){if(!C(e))throw new x("text is required");if(!C(t))throw new x("color is required");if(!C(n))throw new x("size is required");return cD(void 0,e,t,n,this._cache)};const oD=new xy;function rD(e,t,n){e.save(),e.scale(n/24,n/24),e.fillStyle=t.toCssColorString(),e.strokeStyle=t.brighten(.6,oD).toCssColorString(),e.lineWidth=.846,e.beginPath(),e.moveTo(6.72,.422),e.lineTo(17.28,.422),e.bezierCurveTo(18.553,.422,19.577,1.758,19.577,3.415),e.lineTo(19.577,10.973),e.bezierCurveTo(19.577,12.63,18.553,13.966,17.282,13.966),e.lineTo(14.386,14.008),e.lineTo(11.826,23.578),e.lineTo(9.614,14.008),e.lineTo(6.719,13.965),e.bezierCurveTo(5.446,13.983,4.422,12.629,4.422,10.972),e.lineTo(4.422,3.416),e.bezierCurveTo(4.423,1.76,5.447,.423,6.718,.423),e.closePath(),e.fill(),e.stroke(),e.restore()}function sD(e,t,n){const i=n/2.5;let o=i,r=i;t.width>t.height?r=i*(t.height/t.width):t.width<t.height&&(o=i*(t.width/t.height));const s=Math.round((n-o)/2),a=Math.round(7/24*n-r/2);e.globalCompositeOperation="destination-out",e.drawImage(t,s-1,a,o,r),e.drawImage(t,s,a-1,o,r),e.drawImage(t,s+1,a,o,r),e.drawImage(t,s,a+1,o,r),e.globalCompositeOperation="destination-over",e.fillStyle=xy.BLACK.toCssColorString(),e.fillRect(s-1,a-1,o+2,r+2),e.globalCompositeOperation="destination-out",e.drawImage(t,s,a,o,r),e.globalCompositeOperation="destination-over",e.fillStyle=xy.WHITE.toCssColorString(),e.fillRect(s-1,a-2,o+2,r+2)}const aD=new Array(4);function cD(e,t,n,i,o){aD[0]=e,aD[1]=t,aD[2]=n,aD[3]=i;const r=JSON.stringify(aD),s=o[r];if(C(s))return s;const a=document.createElement("canvas");a.width=i,a.height=i;const c=a.getContext("2d");if(rD(c,n,i),C(e)){const t=Vi.createIfNeeded(e),n=t.fetchImage().then((function(e){return sD(c,e,i),o[r]=a,a}));return o[r]=n,n}if(C(t)){const e=nD(t,{font:`bold ${i}px sans-serif`});sD(c,e,i)}return o[r]=a,a}var lD=iD;const uD={UNSIGNED_BYTE:th.UNSIGNED_BYTE,UNSIGNED_SHORT:th.UNSIGNED_SHORT,UNSIGNED_INT:th.UNSIGNED_INT,FLOAT:th.FLOAT,HALF_FLOAT:th.HALF_FLOAT_OES,UNSIGNED_INT_24_8:th.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:th.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:th.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:th.UNSIGNED_SHORT_5_6_5,toWebGLConstant:function(e,t){switch(e){case uD.UNSIGNED_BYTE:return th.UNSIGNED_BYTE;case uD.UNSIGNED_SHORT:return th.UNSIGNED_SHORT;case uD.UNSIGNED_INT:return th.UNSIGNED_INT;case uD.FLOAT:return th.FLOAT;case uD.HALF_FLOAT:return t.webgl2?th.HALF_FLOAT:th.HALF_FLOAT_OES;case uD.UNSIGNED_INT_24_8:return th.UNSIGNED_INT_24_8;case uD.UNSIGNED_SHORT_4_4_4_4:return th.UNSIGNED_SHORT_4_4_4_4;case uD.UNSIGNED_SHORT_5_5_5_1:return th.UNSIGNED_SHORT_5_5_5_1;case uD.UNSIGNED_SHORT_5_6_5:return uD.UNSIGNED_SHORT_5_6_5}},isPacked:function(e){return e===uD.UNSIGNED_INT_24_8||e===uD.UNSIGNED_SHORT_4_4_4_4||e===uD.UNSIGNED_SHORT_5_5_5_1||e===uD.UNSIGNED_SHORT_5_6_5},sizeInBytes:function(e){switch(e){case uD.UNSIGNED_BYTE:return 1;case uD.UNSIGNED_SHORT:case uD.UNSIGNED_SHORT_4_4_4_4:case uD.UNSIGNED_SHORT_5_5_5_1:case uD.UNSIGNED_SHORT_5_6_5:case uD.HALF_FLOAT:return 2;case uD.UNSIGNED_INT:case uD.FLOAT:case uD.UNSIGNED_INT_24_8:return 4}},validate:function(e){return e===uD.UNSIGNED_BYTE||e===uD.UNSIGNED_SHORT||e===uD.UNSIGNED_INT||e===uD.FLOAT||e===uD.HALF_FLOAT||e===uD.UNSIGNED_INT_24_8||e===uD.UNSIGNED_SHORT_4_4_4_4||e===uD.UNSIGNED_SHORT_5_5_5_1||e===uD.UNSIGNED_SHORT_5_6_5}};var hD=Object.freeze(uD);const dD={DEPTH_COMPONENT:th.DEPTH_COMPONENT,DEPTH_STENCIL:th.DEPTH_STENCIL,ALPHA:th.ALPHA,RGB:th.RGB,RGBA:th.RGBA,LUMINANCE:th.LUMINANCE,LUMINANCE_ALPHA:th.LUMINANCE_ALPHA,RGB_DXT1:th.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:th.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:th.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:th.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:th.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:th.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:th.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:th.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGBA_ASTC:th.COMPRESSED_RGBA_ASTC_4x4_WEBGL,RGB_ETC1:th.COMPRESSED_RGB_ETC1_WEBGL,RGB8_ETC2:th.COMPRESSED_RGB8_ETC2,RGBA8_ETC2_EAC:th.COMPRESSED_RGBA8_ETC2_EAC,RGBA_BC7:th.COMPRESSED_RGBA_BPTC_UNORM,componentsLength:function(e){switch(e){case dD.RGB:return 3;case dD.RGBA:return 4;case dD.LUMINANCE_ALPHA:return 2;case dD.ALPHA:case dD.LUMINANCE:return 1;default:return 1}},validate:function(e){return e===dD.DEPTH_COMPONENT||e===dD.DEPTH_STENCIL||e===dD.ALPHA||e===dD.RGB||e===dD.RGBA||e===dD.LUMINANCE||e===dD.LUMINANCE_ALPHA||e===dD.RGB_DXT1||e===dD.RGBA_DXT1||e===dD.RGBA_DXT3||e===dD.RGBA_DXT5||e===dD.RGB_PVRTC_4BPPV1||e===dD.RGB_PVRTC_2BPPV1||e===dD.RGBA_PVRTC_4BPPV1||e===dD.RGBA_PVRTC_2BPPV1||e===dD.RGBA_ASTC||e===dD.RGB_ETC1||e===dD.RGB8_ETC2||e===dD.RGBA8_ETC2_EAC||e===dD.RGBA_BC7},isColorFormat:function(e){return e===dD.ALPHA||e===dD.RGB||e===dD.RGBA||e===dD.LUMINANCE||e===dD.LUMINANCE_ALPHA},isDepthFormat:function(e){return e===dD.DEPTH_COMPONENT||e===dD.DEPTH_STENCIL},isCompressedFormat:function(e){return e===dD.RGB_DXT1||e===dD.RGBA_DXT1||e===dD.RGBA_DXT3||e===dD.RGBA_DXT5||e===dD.RGB_PVRTC_4BPPV1||e===dD.RGB_PVRTC_2BPPV1||e===dD.RGBA_PVRTC_4BPPV1||e===dD.RGBA_PVRTC_2BPPV1||e===dD.RGBA_ASTC||e===dD.RGB_ETC1||e===dD.RGB8_ETC2||e===dD.RGBA8_ETC2_EAC||e===dD.RGBA_BC7},isDXTFormat:function(e){return e===dD.RGB_DXT1||e===dD.RGBA_DXT1||e===dD.RGBA_DXT3||e===dD.RGBA_DXT5},isPVRTCFormat:function(e){return e===dD.RGB_PVRTC_4BPPV1||e===dD.RGB_PVRTC_2BPPV1||e===dD.RGBA_PVRTC_4BPPV1||e===dD.RGBA_PVRTC_2BPPV1},isASTCFormat:function(e){return e===dD.RGBA_ASTC},isETC1Format:function(e){return e===dD.RGB_ETC1},isETC2Format:function(e){return e===dD.RGB8_ETC2||e===dD.RGBA8_ETC2_EAC},isBC7Format:function(e){return e===dD.RGBA_BC7},compressedTextureSizeInBytes:function(e,t,n){switch(e){case dD.RGB_DXT1:case dD.RGBA_DXT1:case dD.RGB_ETC1:case dD.RGB8_ETC2:return Math.floor((t+3)/4)*Math.floor((n+3)/4)*8;case dD.RGBA_DXT3:case dD.RGBA_DXT5:case dD.RGBA_ASTC:case dD.RGBA8_ETC2_EAC:return Math.floor((t+3)/4)*Math.floor((n+3)/4)*16;case dD.RGB_PVRTC_4BPPV1:case dD.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(t,8)*Math.max(n,8)*4+7)/8);case dD.RGB_PVRTC_2BPPV1:case dD.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(t,16)*Math.max(n,8)*2+7)/8);case dD.RGBA_BC7:return Math.ceil(t/4)*Math.ceil(n/4)*16;default:return 0}},textureSizeInBytes:function(e,t,n,i){let o=dD.componentsLength(e);return hD.isPacked(t)&&(o=1),o*hD.sizeInBytes(t)*n*i},alignmentInBytes:function(e,t,n){const i=dD.textureSizeInBytes(e,t,n,1)%4;return 0===i?4:2===i?2:1},createTypedArray:function(e,t,n,i){let o;const r=hD.sizeInBytes(t);o=r===Uint8Array.BYTES_PER_ELEMENT?Uint8Array:r===Uint16Array.BYTES_PER_ELEMENT?Uint16Array:r===Float32Array.BYTES_PER_ELEMENT&&t===hD.FLOAT?Float32Array:Uint32Array;const s=dD.componentsLength(e)*n*i;return new o(s)},flipY:function(e,t,n,i,o){if(1===o)return e;const r=dD.createTypedArray(t,n,i,o),s=dD.componentsLength(t),a=i*s;for(let c=0;c<o;++c){const t=c*i*s,n=(o-c-1)*i*s;for(let i=0;i<a;++i)r[n+i]=e[t+i]}return r},toInternalFormat:function(e,t,n){if(!n.webgl2)return e;if(e===dD.DEPTH_STENCIL)return th.DEPTH24_STENCIL8;if(e===dD.DEPTH_COMPONENT){if(t===hD.UNSIGNED_SHORT)return th.DEPTH_COMPONENT16;if(t===hD.UNSIGNED_INT)return th.DEPTH_COMPONENT24}if(t===hD.FLOAT)switch(e){case dD.RGBA:return th.RGBA32F;case dD.RGB:return th.RGB32F;case dD.RG:return th.RG32F;case dD.R:return th.R32F}if(t===hD.HALF_FLOAT)switch(e){case dD.RGBA:return th.RGBA16F;case dD.RGB:return th.RGB16F;case dD.RG:return th.RG16F;case dD.R:return th.R16F}return e}};var fD=Object.freeze(dD);function pD(e){e=R(e,R.EMPTY_OBJECT);const t=R(e.vertexFormat,jf.DEFAULT);this._vertexFormat=t,this._workerName="createPlaneGeometry"}pD.packedLength=jf.packedLength,pD.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),jf.pack(e._vertexFormat,t,n),t};const mD=new jf,_D={vertexFormat:mD};pD.unpack=function(e,t,n){D.defined("array",e),t=R(t,0);const i=jf.unpack(e,t,mD);return C(n)?(n._vertexFormat=jf.clone(i,n._vertexFormat),n):new pD(_D)};const gD=new K(-.5,-.5,0),yD=new K(.5,.5,0);pD.createGeometry=function(e){const t=e._vertexFormat,n=new Hf;let i,o;if(t.position){if(o=new Float64Array(12),o[0]=gD.x,o[1]=gD.y,o[2]=0,o[3]=yD.x,o[4]=gD.y,o[5]=0,o[6]=yD.x,o[7]=yD.y,o[8]=0,o[9]=gD.x,o[10]=yD.y,o[11]=0,n.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:o}),t.normal){const e=new Float32Array(12);e[0]=0,e[1]=0,e[2]=1,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=1,e[9]=0,e[10]=0,e[11]=1,n.normal=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:e})}if(t.st){const e=new Float32Array(8);e[0]=0,e[1]=0,e[2]=1,e[3]=0,e[4]=1,e[5]=1,e[6]=0,e[7]=1,n.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:e})}if(t.tangent){const e=new Float32Array(12);e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=1,e[7]=0,e[8]=0,e[9]=1,e[10]=0,e[11]=0,n.tangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:e})}if(t.bitangent){const e=new Float32Array(12);e[0]=0,e[1]=1,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=1,e[8]=0,e[9]=0,e[10]=1,e[11]=0,n.bitangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:e})}i=new Uint16Array(6),i[0]=0,i[1]=1,i[2]=2,i[3]=0,i[4]=2,i[5]=3}return new zf({attributes:n,indices:i,primitiveType:xf.TRIANGLES,boundingSphere:new nn(K.ZERO,Math.sqrt(2))})};var vD=pD;function bD(){this._workerName="createPlaneOutlineGeometry"}bD.packedLength=0,bD.pack=function(e,t){return D.defined("value",e),D.defined("array",t),t},bD.unpack=function(e,t,n){return D.defined("array",e),C(n)?n:new bD};const AD=new K(-.5,-.5,0),wD=new K(.5,.5,0);bD.createGeometry=function(){const e=new Hf,t=new Uint16Array(8),n=new Float64Array(12);return n[0]=AD.x,n[1]=AD.y,n[2]=AD.z,n[3]=wD.x,n[4]=AD.y,n[5]=AD.z,n[6]=wD.x,n[7]=wD.y,n[8]=AD.z,n[9]=AD.x,n[10]=wD.y,n[11]=AD.z,e.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:n}),t[0]=0,t[1]=1,t[2]=1,t[3]=2,t[4]=2,t[5]=3,t[6]=3,t[7]=0,new zf({attributes:e,indices:t,primitiveType:xf.LINES,boundingSphere:new nn(K.ZERO,Math.sqrt(2))})};var TD=bD;const CD=new se,ED=new se;function xD(e,t,n,i){const o=i.cartesianToCartographic(e,CD),r=o.height,s=i.cartesianToCartographic(t,ED);s.height=r,i.cartographicToCartesian(s,t);const a=i.cartesianToCartographic(n,ED);a.height=r-100,i.cartographicToCartesian(a,n)}const SD=new bf,ID=new K,OD=new K,DD=new K,PD=new K,RD=new K,LD=new K;let MD=new K,BD=new K,ND=new K;const FD=new ro,zD=new ro,kD=new K,UD=new il,VD=new ke,HD=new ke;function GD(e){const t=e.vertexFormat,n=e.geometry,i=e.shadowVolume,o=n.attributes.position.values;let r=o.length;const s=e.wall,a=e.top||s,c=e.bottom||s;if(t.st||t.normal||t.tangent||t.bitangent||i){const l=e.boundingRectangle,u=e.tangentPlane,h=e.ellipsoid,d=e.stRotation,f=e.perPositionHeight,p=FD;p.x=l.x,p.y=l.y;const m=t.st?new Float32Array(r/3*2):void 0;let _;t.normal&&(_=f&&a&&!s?n.attributes.normal.values:new Float32Array(r));const g=t.tangent?new Float32Array(r):void 0,y=t.bitangent?new Float32Array(r):void 0,v=i?new Float32Array(r):void 0;let b=0,A=0,w=OD,T=DD,C=PD,E=!0,x=VD,S=HD;if(0!==d){let e=il.fromAxisAngle(u._plane.normal,d,UD);x=ke.fromQuaternion(e,x),e=il.fromAxisAngle(u._plane.normal,-d,UD),S=ke.fromQuaternion(e,S)}else x=ke.clone(ke.IDENTITY,x),S=ke.clone(ke.IDENTITY,S);let I=0,O=0;a&&c&&(I=r/2,O=r/3,r/=2);for(let n=0;n<r;n+=3){const d=K.fromArray(o,n,kD);if(t.st){let e=ke.multiplyByVector(x,d,ID);e=h.scaleToGeodeticSurface(e,e);const t=u.projectPointOntoPlane(e,zD);ro.subtract(t,p,t);const n=z.clamp(t.x/l.width,0,1),i=z.clamp(t.y/l.height,0,1);c&&(m[b+O]=n,m[b+1+O]=i),a&&(m[b]=n,m[b+1]=i),b+=2}if(t.normal||t.tangent||t.bitangent||i){const l=A+1,u=A+2;if(s){if(n+3<r){const e=K.fromArray(o,n+3,RD);if(E){const t=K.fromArray(o,n+r,LD);f&&xD(d,e,t,h),K.subtract(e,d,e),K.subtract(t,d,t),w=K.normalize(K.cross(t,e,w),w),E=!1}K.equalsEpsilon(e,d,z.EPSILON10)&&(E=!0)}(t.tangent||t.bitangent)&&(C=h.geodeticSurfaceNormal(d,C),t.tangent&&(T=K.normalize(K.cross(C,w,T),T)))}else w=h.geodeticSurfaceNormal(d,w),(t.tangent||t.bitangent)&&(f&&(MD=K.fromArray(_,A,MD),BD=K.cross(K.UNIT_Z,MD,BD),BD=K.normalize(ke.multiplyByVector(S,BD,BD),BD),t.bitangent&&(ND=K.normalize(K.cross(MD,BD,ND),ND))),T=K.cross(K.UNIT_Z,w,T),T=K.normalize(ke.multiplyByVector(S,T,T),T),t.bitangent&&(C=K.normalize(K.cross(w,T,C),C)));t.normal&&(e.wall?(_[A+I]=w.x,_[l+I]=w.y,_[u+I]=w.z):c&&(_[A+I]=-w.x,_[l+I]=-w.y,_[u+I]=-w.z),(a&&!f||s)&&(_[A]=w.x,_[l]=w.y,_[u]=w.z)),i&&(s&&(w=h.geodeticSurfaceNormal(d,w)),v[A+I]=-w.x,v[l+I]=-w.y,v[u+I]=-w.z),t.tangent&&(e.wall?(g[A+I]=T.x,g[l+I]=T.y,g[u+I]=T.z):c&&(g[A+I]=-T.x,g[l+I]=-T.y,g[u+I]=-T.z),a&&(f?(g[A]=BD.x,g[l]=BD.y,g[u]=BD.z):(g[A]=T.x,g[l]=T.y,g[u]=T.z))),t.bitangent&&(c&&(y[A+I]=C.x,y[l+I]=C.y,y[u+I]=C.z),a&&(f?(y[A]=ND.x,y[l]=ND.y,y[u]=ND.z):(y[A]=C.x,y[l]=C.y,y[u]=C.z))),A+=3}}t.st&&(n.attributes.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:m})),t.normal&&(n.attributes.normal=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:_})),t.tangent&&(n.attributes.tangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:g})),t.bitangent&&(n.attributes.bitangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:y})),i&&(n.attributes.extrudeDirection=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:v}))}if(e.extrude&&C(e.offsetAttribute)){const t=o.length/3;let i=new Uint8Array(t);if(e.offsetAttribute===Wf.TOP)a&&c||s?i=wf(i,1,0,t/2):a&&(i=wf(i,1));else{const t=e.offsetAttribute===Wf.NONE?0:1;i=wf(i,t)}n.attributes.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:i})}return n}const WD=new se,qD=new se,jD={westOverIDL:0,eastOverIDL:0};let YD=new Jb;function KD(e,t,n,i,o){if(o=R(o,new _t),!C(e)||e.length<3)return o.west=0,o.north=0,o.south=0,o.east=0,o;if(n===hf.RHUMB)return _t.fromCartesianArray(e,t,o);YD.ellipsoid.equals(t)||(YD=new Jb(void 0,void 0,t)),o.west=Number.POSITIVE_INFINITY,o.east=Number.NEGATIVE_INFINITY,o.south=Number.POSITIVE_INFINITY,o.north=Number.NEGATIVE_INFINITY,jD.westOverIDL=Number.POSITIVE_INFINITY,jD.eastOverIDL=Number.NEGATIVE_INFINITY;const r=1/z.chordLength(i,t.maximumRadius),s=e.length;let a,c=t.cartesianToCartographic(e[0],qD),l=WD;for(let u=1;u<s;u++)a=l,l=c,c=t.cartesianToCartographic(e[u],a),YD.setEndPoints(l,c),QD(YD,r,o,jD);return a=l,l=c,c=t.cartesianToCartographic(e[0],a),YD.setEndPoints(l,c),QD(YD,r,o,jD),o.east-o.west>jD.eastOverIDL-jD.westOverIDL&&(o.west=jD.westOverIDL,o.east=jD.eastOverIDL,o.east>z.PI&&(o.east=o.east-z.TWO_PI),o.west>z.PI&&(o.west=o.west-z.TWO_PI)),o}const XD=new se;function QD(e,t,n,i){const o=e.surfaceDistance,r=Math.ceil(o*t),s=r>0?o/(r-1):Number.POSITIVE_INFINITY;let a=0;for(let c=0;c<r;c++){const t=e.interpolateUsingSurfaceDistance(a,XD);a+=s;const o=t.longitude,r=t.latitude;n.west=Math.min(n.west,o),n.east=Math.max(n.east,o),n.south=Math.min(n.south,r),n.north=Math.max(n.north,r);const c=o>=0?o:o+z.TWO_PI;i.westOverIDL=Math.min(i.westOverIDL,c),i.eastOverIDL=Math.max(i.eastOverIDL,c)}}const JD=[];function ZD(e,t,n,i,o,r,s,a,c){const l={walls:[]};let u;if(r||s){const i=_b.createGeometryFromPositions(e,t,n,o,a,c),h=i.attributes.position.values,d=i.indices;let f,p;if(r&&s){const e=h.concat(h);f=e.length/3,p=fd.createTypedArray(f,2*d.length),p.set(d);const t=d.length,n=f/2;for(u=0;u<t;u+=3){const e=p[u]+n,i=p[u+1]+n,o=p[u+2]+n;p[u+t]=o,p[u+1+t]=i,p[u+2+t]=e}if(i.attributes.position.values=e,o&&a.normal){const t=i.attributes.normal.values;i.attributes.normal.values=new Float32Array(e.length),i.attributes.normal.values.set(t)}i.indices=p}else if(s){for(f=h.length/3,p=fd.createTypedArray(f,d.length),u=0;u<d.length;u+=3)p[u]=d[u+2],p[u+1]=d[u+1],p[u+2]=d[u];i.indices=p}l.topAndBottom=new Sm({geometry:i})}let h=i.outerRing,d=tu.fromPoints(h,e),f=d.projectPointsOntoPlane(h,JD),p=Xv.computeWindingOrder2D(f);p===Mv.CLOCKWISE&&(h=h.slice().reverse());let m=_b.computeWallGeometry(h,e,n,o,c);l.walls.push(new Sm({geometry:m}));const _=i.holes;for(u=0;u<_.length;u++){let t=_[u];d=tu.fromPoints(t,e),f=d.projectPointsOntoPlane(t,JD),p=Xv.computeWindingOrder2D(f),p===Mv.COUNTER_CLOCKWISE&&(t=t.slice().reverse()),m=_b.computeWallGeometry(t,e,n,o,c),l.walls.push(new Sm({geometry:m}))}return l}function $D(e){if(D.typeOf.object("options",e),D.typeOf.object("options.polygonHierarchy",e.polygonHierarchy),C(e.perPositionHeight)&&e.perPositionHeight&&C(e.height))throw new x("Cannot use both options.perPositionHeight and options.height");if(C(e.arcType)&&e.arcType!==hf.GEODESIC&&e.arcType!==hf.RHUMB)throw new x("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");const t=e.polygonHierarchy,n=R(e.vertexFormat,jf.DEFAULT),i=R(e.ellipsoid,ge.WGS84),o=R(e.granularity,z.RADIANS_PER_DEGREE),r=R(e.stRotation,0),s=R(e.perPositionHeight,!1),a=s&&C(e.extrudedHeight);let c=R(e.height,0),l=R(e.extrudedHeight,c);if(!a){const e=Math.max(c,l);l=Math.min(c,l),c=e}this._vertexFormat=jf.clone(n),this._ellipsoid=ge.clone(i),this._granularity=o,this._stRotation=r,this._height=c,this._extrudedHeight=l,this._closeTop=R(e.closeTop,!0),this._closeBottom=R(e.closeBottom,!0),this._polygonHierarchy=t,this._perPositionHeight=s,this._perPositionHeightExtrude=a,this._shadowVolume=R(e.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=e.offsetAttribute,this._arcType=R(e.arcType,hf.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=_b.computeHierarchyPackedLength(t)+ge.packedLength+jf.packedLength+12}$D.fromPositions=function(e){e=R(e,R.EMPTY_OBJECT),D.defined("options.positions",e.positions);const t={polygonHierarchy:{positions:e.positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType};return new $D(t)},$D.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),n=_b.packPolygonHierarchy(e._polygonHierarchy,t,n),ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,jf.pack(e._vertexFormat,t,n),n+=jf.packedLength,t[n++]=e._height,t[n++]=e._extrudedHeight,t[n++]=e._granularity,t[n++]=e._stRotation,t[n++]=e._perPositionHeightExtrude?1:0,t[n++]=e._perPositionHeight?1:0,t[n++]=e._closeTop?1:0,t[n++]=e._closeBottom?1:0,t[n++]=e._shadowVolume?1:0,t[n++]=R(e._offsetAttribute,-1),t[n++]=e._arcType,t[n]=e.packedLength,t};const eP=ge.clone(ge.UNIT_SPHERE),tP=new jf,nP={polygonHierarchy:{}};function iP(e){const t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];const n=e._ellipsoid,i=e._polygonHierarchy.positions,o=e.rectangle;return zf._textureCoordinateRotationPoints(i,t,n,o)}$D.unpack=function(e,t,n){D.defined("array",e),t=R(t,0);const i=_b.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;const o=ge.unpack(e,t,eP);t+=ge.packedLength;const r=jf.unpack(e,t,tP);t+=jf.packedLength;const s=e[t++],a=e[t++],c=e[t++],l=e[t++],u=1===e[t++],h=1===e[t++],d=1===e[t++],f=1===e[t++],p=1===e[t++],m=e[t++],_=e[t++],g=e[t];return C(n)||(n=new $D(nP)),n._polygonHierarchy=i,n._ellipsoid=ge.clone(o,n._ellipsoid),n._vertexFormat=jf.clone(r,n._vertexFormat),n._height=s,n._extrudedHeight=a,n._granularity=c,n._stRotation=l,n._perPositionHeightExtrude=u,n._perPositionHeight=h,n._closeTop=d,n._closeBottom=f,n._shadowVolume=p,n._offsetAttribute=-1===m?void 0:m,n._arcType=_,n.packedLength=g,n},$D.computeRectangle=function(e,t){D.typeOf.object("options",e),D.typeOf.object("options.polygonHierarchy",e.polygonHierarchy);const n=R(e.granularity,z.RADIANS_PER_DEGREE),i=R(e.arcType,hf.GEODESIC);if(i!==hf.GEODESIC&&i!==hf.RHUMB)throw new x("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");const o=e.polygonHierarchy,r=R(e.ellipsoid,ge.WGS84);return KD(o.positions,r,i,n,t)},$D.createGeometry=function(e){const t=e._vertexFormat,n=e._ellipsoid,i=e._granularity,o=e._stRotation,r=e._polygonHierarchy,s=e._perPositionHeight,a=e._closeTop,c=e._closeBottom,l=e._arcType;let u=r.positions;if(u.length<3)return;const h=tu.fromPoints(u,n),d=_b.polygonsFromHierarchy(r,h.projectPointsOntoPlane.bind(h),!s,n),f=d.hierarchy,p=d.polygons;if(0===f.length)return;u=f[0].outerRing;const m=_b.computeBoundingRectangle(h.plane.normal,h.projectPointOntoPlane.bind(h),u,o,SD),_=[],g=e._height,y=e._extrudedHeight,v=e._perPositionHeightExtrude||!z.equalsEpsilon(g,y,0,z.EPSILON2),b={perPositionHeight:s,vertexFormat:t,geometry:void 0,tangentPlane:h,boundingRectangle:m,ellipsoid:n,stRotation:o,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:l};let A;if(v)for(b.extrude=!0,b.top=a,b.bottom=c,b.shadowVolume=e._shadowVolume,b.offsetAttribute=e._offsetAttribute,A=0;A<p.length;A++){const e=ZD(n,p[A],i,f[A],s,a,c,t,l);let o;a&&c?(o=e.topAndBottom,b.geometry=_b.scaleToGeodeticHeightExtruded(o.geometry,g,y,n,s)):a?(o=e.topAndBottom,o.geometry.attributes.position.values=Xv.scaleToGeodeticHeight(o.geometry.attributes.position.values,g,n,!s),b.geometry=o.geometry):c&&(o=e.topAndBottom,o.geometry.attributes.position.values=Xv.scaleToGeodeticHeight(o.geometry.attributes.position.values,y,n,!0),b.geometry=o.geometry),(a||c)&&(b.wall=!1,o.geometry=GD(b),_.push(o));const r=e.walls;b.wall=!0;for(let t=0;t<r.length;t++){const e=r[t];b.geometry=_b.scaleToGeodeticHeightExtruded(e.geometry,g,y,n,s),e.geometry=GD(b),_.push(e)}}else for(A=0;A<p.length;A++){const o=new Sm({geometry:_b.createGeometryFromPositions(n,p[A],i,s,t,l)});if(o.geometry.attributes.position.values=Xv.scaleToGeodeticHeight(o.geometry.attributes.position.values,g,n,!s),b.geometry=o.geometry,o.geometry=GD(b),C(e._offsetAttribute)){const t=o.geometry.attributes.position.values.length,n=new Uint8Array(t/3),i=e._offsetAttribute===Wf.NONE?0:1;wf(n,i),o.geometry.attributes.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}_.push(o)}const w=fg.combineInstances(_)[0];w.attributes.position.values=new Float64Array(w.attributes.position.values),w.indices=fd.createTypedArray(w.attributes.position.values.length/3,w.indices);const T=w.attributes,E=nn.fromVertices(T.position.values);return t.position||delete T.position,new zf({attributes:T,indices:w.indices,primitiveType:w.primitiveType,boundingSphere:E,offsetAttribute:e._offsetAttribute})},$D.createShadowVolume=function(e,t,n){const i=e._granularity,o=e._ellipsoid,r=t(i,o),s=n(i,o);return new $D({polygonHierarchy:e._polygonHierarchy,ellipsoid:o,stRotation:e._stRotation,granularity:i,perPositionHeight:!1,extrudedHeight:r,height:s,vertexFormat:jf.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties($D.prototype,{rectangle:{get:function(){if(!C(this._rectangle)){const e=this._polygonHierarchy.positions;this._rectangle=KD(e,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return C(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=iP(this)),this._textureCoordinateRotationPoints}}});var oP=$D;function rP(e,t){this.positions=C(e)?e:[],this.holes=C(t)?t:[]}var sP=rP;const aP=[],cP=[];function lP(e,t,n,i,o){const r=tu.fromPoints(t,e),s=r.projectPointsOntoPlane(t,aP),a=Xv.computeWindingOrder2D(s);let c,l;a===Mv.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());let u=t.length,h=0;if(i)for(c=new Float64Array(2*u*3),l=0;l<u;l++){const e=t[l],n=t[(l+1)%u];c[h++]=e.x,c[h++]=e.y,c[h++]=e.z,c[h++]=n.x,c[h++]=n.y,c[h++]=n.z}else{let i=0;if(o===hf.GEODESIC)for(l=0;l<u;l++)i+=_b.subdivideLineCount(t[l],t[(l+1)%u],n);else if(o===hf.RHUMB)for(l=0;l<u;l++)i+=_b.subdivideRhumbLineCount(e,t[l],t[(l+1)%u],n);for(c=new Float64Array(3*i),l=0;l<u;l++){let i;o===hf.GEODESIC?i=_b.subdivideLine(t[l],t[(l+1)%u],n,cP):o===hf.RHUMB&&(i=_b.subdivideRhumbLine(e,t[l],t[(l+1)%u],n,cP));const r=i.length;for(let e=0;e<r;++e)c[h++]=i[e]}}u=c.length/3;const d=2*u,f=fd.createTypedArray(u,d);for(h=0,l=0;l<u-1;l++)f[h++]=l,f[h++]=l+1;return f[h++]=u-1,f[h++]=0,new Sm({geometry:new zf({attributes:new Hf({position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:c})}),indices:f,primitiveType:xf.LINES})})}function uP(e,t,n,i,o){const r=tu.fromPoints(t,e),s=r.projectPointsOntoPlane(t,aP),a=Xv.computeWindingOrder2D(s);let c,l;a===Mv.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());let u=t.length;const h=new Array(u);let d=0;if(i)for(c=new Float64Array(2*u*3*2),l=0;l<u;++l){h[l]=d/3;const e=t[l],n=t[(l+1)%u];c[d++]=e.x,c[d++]=e.y,c[d++]=e.z,c[d++]=n.x,c[d++]=n.y,c[d++]=n.z}else{let i=0;if(o===hf.GEODESIC)for(l=0;l<u;l++)i+=_b.subdivideLineCount(t[l],t[(l+1)%u],n);else if(o===hf.RHUMB)for(l=0;l<u;l++)i+=_b.subdivideRhumbLineCount(e,t[l],t[(l+1)%u],n);for(c=new Float64Array(3*i*2),l=0;l<u;++l){let i;h[l]=d/3,o===hf.GEODESIC?i=_b.subdivideLine(t[l],t[(l+1)%u],n,cP):o===hf.RHUMB&&(i=_b.subdivideRhumbLine(e,t[l],t[(l+1)%u],n,cP));const r=i.length;for(let e=0;e<r;++e)c[d++]=i[e]}}u=c.length/6;const f=h.length,p=2*(2*u+f),m=fd.createTypedArray(u+f,p);for(d=0,l=0;l<u;++l)m[d++]=l,m[d++]=(l+1)%u,m[d++]=l+u,m[d++]=(l+1)%u+u;for(l=0;l<f;l++){const e=h[l];m[d++]=e,m[d++]=e+u}return new Sm({geometry:new zf({attributes:new Hf({position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:c})}),indices:m,primitiveType:xf.LINES})})}function hP(e){if(D.typeOf.object("options",e),D.typeOf.object("options.polygonHierarchy",e.polygonHierarchy),e.perPositionHeight&&C(e.height))throw new x("Cannot use both options.perPositionHeight and options.height");if(C(e.arcType)&&e.arcType!==hf.GEODESIC&&e.arcType!==hf.RHUMB)throw new x("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");const t=e.polygonHierarchy,n=R(e.ellipsoid,ge.WGS84),i=R(e.granularity,z.RADIANS_PER_DEGREE),o=R(e.perPositionHeight,!1),r=o&&C(e.extrudedHeight),s=R(e.arcType,hf.GEODESIC);let a=R(e.height,0),c=R(e.extrudedHeight,a);if(!r){const e=Math.max(a,c);c=Math.min(a,c),a=e}this._ellipsoid=ge.clone(n),this._granularity=i,this._height=a,this._extrudedHeight=c,this._arcType=s,this._polygonHierarchy=t,this._perPositionHeight=o,this._perPositionHeightExtrude=r,this._offsetAttribute=e.offsetAttribute,this._workerName="createPolygonOutlineGeometry",this.packedLength=_b.computeHierarchyPackedLength(t)+ge.packedLength+8}hP.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),n=_b.packPolygonHierarchy(e._polygonHierarchy,t,n),ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,t[n++]=e._height,t[n++]=e._extrudedHeight,t[n++]=e._granularity,t[n++]=e._perPositionHeightExtrude?1:0,t[n++]=e._perPositionHeight?1:0,t[n++]=e._arcType,t[n++]=R(e._offsetAttribute,-1),t[n]=e.packedLength,t};const dP=ge.clone(ge.UNIT_SPHERE),fP={polygonHierarchy:{}};hP.unpack=function(e,t,n){D.defined("array",e),t=R(t,0);const i=_b.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;const o=ge.unpack(e,t,dP);t+=ge.packedLength;const r=e[t++],s=e[t++],a=e[t++],c=1===e[t++],l=1===e[t++],u=e[t++],h=e[t++],d=e[t];return C(n)||(n=new hP(fP)),n._polygonHierarchy=i,n._ellipsoid=ge.clone(o,n._ellipsoid),n._height=r,n._extrudedHeight=s,n._granularity=a,n._perPositionHeight=l,n._perPositionHeightExtrude=c,n._arcType=u,n._offsetAttribute=-1===h?void 0:h,n.packedLength=d,n},hP.fromPositions=function(e){e=R(e,R.EMPTY_OBJECT),D.defined("options.positions",e.positions);const t={polygonHierarchy:{positions:e.positions},height:e.height,extrudedHeight:e.extrudedHeight,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,arcType:e.arcType,offsetAttribute:e.offsetAttribute};return new hP(t)},hP.createGeometry=function(e){const t=e._ellipsoid,n=e._granularity,i=e._polygonHierarchy,o=e._perPositionHeight,r=e._arcType,s=_b.polygonOutlinesFromHierarchy(i,!o,t);if(0===s.length)return;let a;const c=[],l=z.chordLength(n,t.maximumRadius),u=e._height,h=e._extrudedHeight,d=e._perPositionHeightExtrude||!z.equalsEpsilon(u,h,0,z.EPSILON2);let f,p;if(d)for(p=0;p<s.length;p++){if(a=uP(t,s[p],l,o,r),a.geometry=_b.scaleToGeodeticHeightExtruded(a.geometry,u,h,t,o),C(e._offsetAttribute)){const t=a.geometry.attributes.position.values.length/3;let n=new Uint8Array(t);e._offsetAttribute===Wf.TOP?n=wf(n,1,0,t/2):(f=e._offsetAttribute===Wf.NONE?0:1,n=wf(n,f)),a.geometry.attributes.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}c.push(a)}else for(p=0;p<s.length;p++){if(a=lP(t,s[p],l,o,r),a.geometry.attributes.position.values=Xv.scaleToGeodeticHeight(a.geometry.attributes.position.values,u,t,!o),C(e._offsetAttribute)){const t=a.geometry.attributes.position.values.length,n=new Uint8Array(t/3);f=e._offsetAttribute===Wf.NONE?0:1,wf(n,f),a.geometry.attributes.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}c.push(a)}const m=fg.combineInstances(c)[0],_=nn.fromVertices(m.attributes.position.values);return new zf({attributes:m.attributes,indices:m.indices,primitiveType:m.primitiveType,boundingSphere:_,offsetAttribute:e._offsetAttribute})};var pP=hP;const mP=[];function _P(e,t,n,i,o){const r=mP;let s;r.length=o;const a=n.red,c=n.green,l=n.blue,u=n.alpha,h=i.red,d=i.green,f=i.blue,p=i.alpha;if(xy.equals(n,i)){for(s=0;s<o;s++)r[s]=xy.clone(n);return r}const m=(h-a)/o,_=(d-c)/o,g=(f-l)/o,y=(p-u)/o;for(s=0;s<o;s++)r[s]=new xy(a+s*m,c+s*_,l+s*g,u+s*y);return r}function gP(e){e=R(e,R.EMPTY_OBJECT);const t=e.positions,n=e.colors,i=R(e.width,1),o=R(e.colorsPerVertex,!1);if(!C(t)||t.length<2)throw new x("At least two positions are required.");if("number"!==typeof i)throw new x("width must be a number");if(C(n)&&(o&&n.length<t.length||!o&&n.length<t.length-1))throw new x("colors has an invalid length.");this._positions=t,this._colors=n,this._width=i,this._colorsPerVertex=o,this._vertexFormat=jf.clone(R(e.vertexFormat,jf.DEFAULT)),this._arcType=R(e.arcType,hf.GEODESIC),this._granularity=R(e.granularity,z.RADIANS_PER_DEGREE),this._ellipsoid=ge.clone(R(e.ellipsoid,ge.WGS84)),this._workerName="createPolylineGeometry";let r=1+t.length*K.packedLength;r+=C(n)?1+n.length*xy.packedLength:1,this.packedLength=r+ge.packedLength+jf.packedLength+4}gP.pack=function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");let i;n=R(n,0);const o=e._positions;let r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=K.packedLength)K.pack(o[i],t,n);const s=e._colors;for(r=C(s)?s.length:0,t[n++]=r,i=0;i<r;++i,n+=xy.packedLength)xy.pack(s[i],t,n);return ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,jf.pack(e._vertexFormat,t,n),n+=jf.packedLength,t[n++]=e._width,t[n++]=e._colorsPerVertex?1:0,t[n++]=e._arcType,t[n]=e._granularity,t};const yP=ge.clone(ge.UNIT_SPHERE),vP=new jf,bP={positions:void 0,colors:void 0,ellipsoid:yP,vertexFormat:vP,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};gP.unpack=function(e,t,n){if(!C(e))throw new x("array is required");let i;t=R(t,0);let o=e[t++];const r=new Array(o);for(i=0;i<o;++i,t+=K.packedLength)r[i]=K.unpack(e,t);o=e[t++];const s=o>0?new Array(o):void 0;for(i=0;i<o;++i,t+=xy.packedLength)s[i]=xy.unpack(e,t);const a=ge.unpack(e,t,yP);t+=ge.packedLength;const c=jf.unpack(e,t,vP);t+=jf.packedLength;const l=e[t++],u=1===e[t++],h=e[t++],d=e[t];return C(n)?(n._positions=r,n._colors=s,n._ellipsoid=ge.clone(a,n._ellipsoid),n._vertexFormat=jf.clone(c,n._vertexFormat),n._width=l,n._colorsPerVertex=u,n._arcType=h,n._granularity=d,n):(bP.positions=r,bP.colors=s,bP.width=l,bP.colorsPerVertex=u,bP.arcType=h,bP.granularity=d,new gP(bP))};const AP=new K,wP=new K,TP=new K,CP=new K;gP.createGeometry=function(e){const t=e._width,n=e._vertexFormat;let i=e._colors;const o=e._colorsPerVertex,r=e._arcType,s=e._granularity,a=e._ellipsoid;let c,l,u;const h=[];let d=Ly(e._positions,K.equalsEpsilon,!1,h);if(C(i)&&h.length>0){let e=0,t=h[0];i=i.filter((function(n,i){let r=!1;return r=o?i===t||0===i&&1===t:i+1===t,!r||(e++,t=h[e],!1)}))}let f=d.length;if(f<2||t<=0)return;if(r===hf.GEODESIC||r===hf.RHUMB){let e,t;r===hf.GEODESIC?(e=z.chordLength(s,a.maximumRadius),t=AA.numberOfPoints):(e=s,t=AA.numberOfPointsRhumbLine);const n=AA.extractHeights(d,a);if(C(i)){let n=1;for(c=0;c<f-1;++c)n+=t(d[c],d[c+1],e);const r=new Array(n);let s=0;for(c=0;c<f-1;++c){const a=d[c],u=d[c+1],h=i[c],f=t(a,u,e);if(o&&c<n){const e=i[c+1],t=_P(a,u,h,e,f),n=t.length;for(l=0;l<n;++l)r[s++]=t[l]}else for(l=0;l<f;++l)r[s++]=xy.clone(h)}r[s]=xy.clone(i[i.length-1]),i=r,mP.length=0}d=r===hf.GEODESIC?AA.generateCartesianArc({positions:d,minDistance:e,ellipsoid:a,height:n}):AA.generateCartesianRhumbArc({positions:d,granularity:e,ellipsoid:a,height:n})}f=d.length;const p=4*f-4,m=new Float64Array(3*p),_=new Float64Array(3*p),g=new Float64Array(3*p),y=new Float32Array(2*p),v=n.st?new Float32Array(2*p):void 0,b=C(i)?new Uint8Array(4*p):void 0;let A,w=0,T=0,E=0,x=0;for(l=0;l<f;++l){let e,r;0===l?(A=AP,K.subtract(d[0],d[1],A),K.add(d[0],A,A)):A=d[l-1],K.clone(A,TP),K.clone(d[l],wP),l===f-1?(A=AP,K.subtract(d[f-1],d[f-2],A),K.add(d[f-1],A,A)):A=d[l+1],K.clone(A,CP),C(b)&&(e=0===l||o?i[l]:i[l-1],l!==f-1&&(r=i[l]));const s=0===l?2:0,a=l===f-1?2:4;for(u=s;u<a;++u){K.pack(wP,m,w),K.pack(TP,_,w),K.pack(CP,g,w),w+=3;const i=u-2<0?-1:1;if(y[T++]=u%2*2-1,y[T++]=i*t,n.st&&(v[E++]=l/(f-1),v[E++]=Math.max(y[T-2],0)),C(b)){const t=u<2?e:r;b[x++]=xy.floatToByte(t.red),b[x++]=xy.floatToByte(t.green),b[x++]=xy.floatToByte(t.blue),b[x++]=xy.floatToByte(t.alpha)}}}const S=new Hf;S.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:m}),S.prevPosition=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:_}),S.nextPosition=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:g}),S.expandAndWidth=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:y}),n.st&&(S.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:v})),C(b)&&(S.color=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:4,values:b,normalize:!0}));const I=fd.createTypedArray(p,6*f-6);let O=0,D=0;const P=f-1;for(l=0;l<P;++l)I[D++]=O,I[D++]=O+2,I[D++]=O+1,I[D++]=O+1,I[D++]=O+2,I[D++]=O+3,O+=4;return new zf({attributes:S,indices:I,primitiveType:xf.TRIANGLES,boundingSphere:nn.fromPoints(d),geometryType:Cf.POLYLINES})};var EP=gP;function xP(e,t,n,i){const o=new Hf;i.position&&(o.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:e}));const r=t.length,s=e.length/3,a=(s-2*r)/(2*r),c=Xv.triangulate(t),l=(a-1)*r*6+2*c.length,u=fd.createTypedArray(s,l);let h,d,f,p,m,_;const g=2*r;let y=0;for(h=0;h<a-1;h++){for(d=0;d<r-1;d++)f=2*d+h*r*2,_=f+g,p=f+1,m=p+g,u[y++]=p,u[y++]=f,u[y++]=m,u[y++]=m,u[y++]=f,u[y++]=_;f=2*r-2+h*r*2,p=f+1,m=p+g,_=f+g,u[y++]=p,u[y++]=f,u[y++]=m,u[y++]=m,u[y++]=f,u[y++]=_}if(i.st||i.tangent||i.bitangent){const e=new Float32Array(2*s),i=1/(a-1),c=1/n.height,l=n.height/2;let u,f,p=0;for(h=0;h<a;h++){for(u=h*i,f=c*(t[0].y+l),e[p++]=u,e[p++]=f,d=1;d<r;d++)f=c*(t[d].y+l),e[p++]=u,e[p++]=f,e[p++]=u,e[p++]=f;f=c*(t[0].y+l),e[p++]=u,e[p++]=f}for(d=0;d<r;d++)u=0,f=c*(t[d].y+l),e[p++]=u,e[p++]=f;for(d=0;d<r;d++)u=(a-1)*i,f=c*(t[d].y+l),e[p++]=u,e[p++]=f;o.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:new Float32Array(e)})}const v=s-2*r;for(h=0;h<c.length;h+=3){const e=c[h]+v,t=c[h+1]+v,n=c[h+2]+v;u[y++]=e,u[y++]=t,u[y++]=n,u[y++]=n+r,u[y++]=t+r,u[y++]=e+r}let b=new zf({attributes:o,indices:u,boundingSphere:nn.fromVertices(e),primitiveType:xf.TRIANGLES});if(i.normal&&(b=fg.computeNormal(b)),i.tangent||i.bitangent){try{b=fg.computeTangentAndBitangent(b)}catch(A){CA("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}i.tangent||(b.attributes.tangent=void 0),i.bitangent||(b.attributes.bitangent=void 0),i.st||(b.attributes.st=void 0)}return b}function SP(e){e=R(e,R.EMPTY_OBJECT);const t=e.polylinePositions,n=e.shapePositions;if(!C(t))throw new x("options.polylinePositions is required.");if(!C(n))throw new x("options.shapePositions is required.");this._positions=t,this._shape=n,this._ellipsoid=ge.clone(R(e.ellipsoid,ge.WGS84)),this._cornerType=R(e.cornerType,Hb.ROUNDED),this._vertexFormat=jf.clone(R(e.vertexFormat,jf.DEFAULT)),this._granularity=R(e.granularity,z.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeGeometry";let i=1+t.length*K.packedLength;i+=1+n.length*ro.packedLength,this.packedLength=i+ge.packedLength+jf.packedLength+2}SP.pack=function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");let i;n=R(n,0);const o=e._positions;let r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=K.packedLength)K.pack(o[i],t,n);const s=e._shape;for(r=s.length,t[n++]=r,i=0;i<r;++i,n+=ro.packedLength)ro.pack(s[i],t,n);return ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,jf.pack(e._vertexFormat,t,n),n+=jf.packedLength,t[n++]=e._cornerType,t[n]=e._granularity,t};const IP=ge.clone(ge.UNIT_SPHERE),OP=new jf,DP={polylinePositions:void 0,shapePositions:void 0,ellipsoid:IP,vertexFormat:OP,cornerType:void 0,granularity:void 0};SP.unpack=function(e,t,n){if(!C(e))throw new x("array is required");let i;t=R(t,0);let o=e[t++];const r=new Array(o);for(i=0;i<o;++i,t+=K.packedLength)r[i]=K.unpack(e,t);o=e[t++];const s=new Array(o);for(i=0;i<o;++i,t+=ro.packedLength)s[i]=ro.unpack(e,t);const a=ge.unpack(e,t,IP);t+=ge.packedLength;const c=jf.unpack(e,t,OP);t+=jf.packedLength;const l=e[t++],u=e[t];return C(n)?(n._positions=r,n._shape=s,n._ellipsoid=ge.clone(a,n._ellipsoid),n._vertexFormat=jf.clone(c,n._vertexFormat),n._cornerType=l,n._granularity=u,n):(DP.polylinePositions=r,DP.shapePositions=s,DP.cornerType=l,DP.granularity=u,new SP(DP))};const PP=new bf;SP.createGeometry=function(e){const t=e._positions,n=Ly(t,K.equalsEpsilon);let i=e._shape;if(i=lw.removeDuplicatesFromShape(i),n.length<2||i.length<3)return;Xv.computeWindingOrder2D(i)===Mv.CLOCKWISE&&i.reverse();const o=bf.fromPoints(i,PP),r=lw.computePositions(n,i,o,e,!0);return xP(r,i,o,e._vertexFormat)};var RP=SP;function LP(e,t){const n=new Hf;n.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:e});const i=t.length,o=n.position.values.length/3,r=e.length/3,s=r/i,a=fd.createTypedArray(o,2*i*(s+1));let c,l,u=0;c=0;let h=c*i;for(l=0;l<i-1;l++)a[u++]=l+h,a[u++]=l+h+1;for(a[u++]=i-1+h,a[u++]=h,c=s-1,h=c*i,l=0;l<i-1;l++)a[u++]=l+h,a[u++]=l+h+1;for(a[u++]=i-1+h,a[u++]=h,c=0;c<s-1;c++){const e=i*c,t=e+i;for(l=0;l<i;l++)a[u++]=l+e,a[u++]=l+t}const d=new zf({attributes:n,indices:fd.createTypedArray(o,a),boundingSphere:nn.fromVertices(e),primitiveType:xf.LINES});return d}function MP(e){e=R(e,R.EMPTY_OBJECT);const t=e.polylinePositions,n=e.shapePositions;if(!C(t))throw new x("options.polylinePositions is required.");if(!C(n))throw new x("options.shapePositions is required.");this._positions=t,this._shape=n,this._ellipsoid=ge.clone(R(e.ellipsoid,ge.WGS84)),this._cornerType=R(e.cornerType,Hb.ROUNDED),this._granularity=R(e.granularity,z.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeOutlineGeometry";let i=1+t.length*K.packedLength;i+=1+n.length*ro.packedLength,this.packedLength=i+ge.packedLength+2}MP.pack=function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");let i;n=R(n,0);const o=e._positions;let r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=K.packedLength)K.pack(o[i],t,n);const s=e._shape;for(r=s.length,t[n++]=r,i=0;i<r;++i,n+=ro.packedLength)ro.pack(s[i],t,n);return ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,t[n++]=e._cornerType,t[n]=e._granularity,t};const BP=ge.clone(ge.UNIT_SPHERE),NP={polylinePositions:void 0,shapePositions:void 0,ellipsoid:BP,height:void 0,cornerType:void 0,granularity:void 0};MP.unpack=function(e,t,n){if(!C(e))throw new x("array is required");let i;t=R(t,0);let o=e[t++];const r=new Array(o);for(i=0;i<o;++i,t+=K.packedLength)r[i]=K.unpack(e,t);o=e[t++];const s=new Array(o);for(i=0;i<o;++i,t+=ro.packedLength)s[i]=ro.unpack(e,t);const a=ge.unpack(e,t,BP);t+=ge.packedLength;const c=e[t++],l=e[t];return C(n)?(n._positions=r,n._shape=s,n._ellipsoid=ge.clone(a,n._ellipsoid),n._cornerType=c,n._granularity=l,n):(NP.polylinePositions=r,NP.shapePositions=s,NP.cornerType=c,NP.granularity=l,new MP(NP))};const FP=new bf;MP.createGeometry=function(e){const t=e._positions,n=Ly(t,K.equalsEpsilon);let i=e._shape;if(i=lw.removeDuplicatesFromShape(i),n.length<2||i.length<3)return;Xv.computeWindingOrder2D(i)===Mv.CLOCKWISE&&i.reverse();const o=bf.fromPoints(i,FP),r=lw.computePositions(n,i,o,e,!1);return LP(r,i)};var zP=MP;function kP(){x.throwInstantiationError()}kP.prototype.getURL=x.throwInstantiationError;function UP(e){const t=e.points,n=e.times;return function(i,o){C(o)||(o=new il);const r=e._lastTimeIndex=e.findTimeInterval(i,e._lastTimeIndex),s=(i-n[r])/(n[r+1]-n[r]),a=t[r],c=t[r+1];return il.fastSlerp(a,c,s,o)}}function VP(e){e=R(e,R.EMPTY_OBJECT);const t=e.points,n=e.times;if(!C(t)||!C(n))throw new x("points and times are required.");if(t.length<2)throw new x("points.length must be greater than or equal to 2.");if(n.length!==t.length)throw new x("times.length must be equal to points.length.");this._times=n,this._points=t,this._evaluateFunction=UP(this),this._lastTimeIndex=0}Object.defineProperties(VP.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}}),VP.prototype.findTimeInterval=up.prototype.findTimeInterval,VP.prototype.wrapTime=up.prototype.wrapTime,VP.prototype.clampTime=up.prototype.clampTime,VP.prototype.evaluate=function(e,t){return this._evaluateFunction(e,t)};var HP=VP;function GP(e,t,n,i,o){WP(e,t,n||0,i||e.length-1,o||jP)}function WP(e,t,n,i,o){while(i>n){if(i-n>600){var r=i-n+1,s=t-n+1,a=Math.log(r),c=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*c*(r-c)/r)*(s-r/2<0?-1:1),u=Math.max(n,Math.floor(t-s*c/r+l)),h=Math.min(i,Math.floor(t+(r-s)*c/r+l));WP(e,t,u,h,o)}var d=e[t],f=n,p=i;qP(e,n,t),o(e[i],d)>0&&qP(e,n,i);while(f<p){qP(e,f,p),f++,p--;while(o(e[f],d)<0)f++;while(o(e[p],d)>0)p--}0===o(e[n],d)?qP(e,n,p):(p++,qP(e,p,i)),p<=t&&(n=p+1),t<=p&&(i=p-1)}}function qP(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function jP(e,t){return e<t?-1:e>t?1:0}class YP{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const n=[];if(!rR(e,t))return n;const i=this.toBBox,o=[];while(t){for(let r=0;r<t.children.length;r++){const s=t.children[r],a=t.leaf?i(s):s;rR(e,a)&&(t.leaf?n.push(s):oR(e,a)?this._all(s,n):o.push(s))}t=o.pop()}return n}collides(e){let t=this.data;if(!rR(e,t))return!1;const n=[];while(t){for(let i=0;i<t.children.length;i++){const o=t.children[i],r=t.leaf?this.toBBox(o):o;if(rR(e,r)){if(t.leaf||oR(e,r))return!0;n.push(o)}}t=n.pop()}return!1}load(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(let t=0;t<e.length;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=sR([]),this}remove(e,t){if(!e)return this;let n=this.data;const i=this.toBBox(e),o=[],r=[];let s,a,c;while(n||o.length){if(n||(n=o.pop(),a=o[o.length-1],s=r.pop(),c=!0),n.leaf){const i=KP(e,n.children,t);if(-1!==i)return n.children.splice(i,1),o.push(n),this._condense(o),this}c||n.leaf||!oR(n,i)?a?(s++,n=a.children[s],c=!1):n=null:(o.push(n),r.push(s),s=0,a=n,n=n.children[0])}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const n=[];while(e)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,i){const o=n-t+1;let r,s=this._maxEntries;if(o<=s)return r=sR(e.slice(t,n+1)),XP(r,this.toBBox),r;i||(i=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,i-1))),r=sR([]),r.leaf=!1,r.height=i;const a=Math.ceil(o/s),c=a*Math.ceil(Math.sqrt(s));aR(e,t,n,c,this.compareMinX);for(let l=t;l<=n;l+=c){const t=Math.min(l+c-1,n);aR(e,l,t,a,this.compareMinY);for(let n=l;n<=t;n+=a){const o=Math.min(n+a-1,t);r.children.push(this._build(e,n,o,i-1))}}return XP(r,this.toBBox),r}_chooseSubtree(e,t,n,i){while(1){if(i.push(t),t.leaf||i.length-1===n)break;let o,r=1/0,s=1/0;for(let n=0;n<t.children.length;n++){const i=t.children[n],a=eR(i),c=nR(e,i)-a;c<s?(s=c,r=a<r?a:r,o=i):c===s&&a<r&&(r=a,o=i)}t=o||t.children[0]}return t}_insert(e,t,n){const i=n?e:this.toBBox(e),o=[],r=this._chooseSubtree(i,this.data,t,o);r.children.push(e),JP(r,i);while(t>=0){if(!(o[t].children.length>this._maxEntries))break;this._split(o,t),t--}this._adjustParentBBoxes(i,o,t)}_split(e,t){const n=e[t],i=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,i);const r=this._chooseSplitIndex(n,o,i),s=sR(n.children.splice(r,n.children.length-r));s.height=n.height,s.leaf=n.leaf,XP(n,this.toBBox),XP(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(n,s)}_splitRoot(e,t){this.data=sR([e,t]),this.data.height=e.height+1,this.data.leaf=!1,XP(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let i,o=1/0,r=1/0;for(let s=t;s<=n-t;s++){const t=QP(e,0,s,this.toBBox),a=QP(e,s,n,this.toBBox),c=iR(t,a),l=eR(t)+eR(a);c<o?(o=c,i=s,r=l<r?l:r):c===o&&l<r&&(r=l,i=s)}return i||n-t}_chooseSplitAxis(e,t,n){const i=e.leaf?this.compareMinX:ZP,o=e.leaf?this.compareMinY:$P,r=this._allDistMargin(e,t,n,i),s=this._allDistMargin(e,t,n,o);r<s&&e.children.sort(i)}_allDistMargin(e,t,n,i){e.children.sort(i);const o=this.toBBox,r=QP(e,0,t,o),s=QP(e,n-t,n,o);let a=tR(r)+tR(s);for(let c=t;c<n-t;c++){const t=e.children[c];JP(r,e.leaf?o(t):t),a+=tR(r)}for(let c=n-t-1;c>=t;c--){const t=e.children[c];JP(s,e.leaf?o(t):t),a+=tR(s)}return a}_adjustParentBBoxes(e,t,n){for(let i=n;i>=0;i--)JP(t[i],e)}_condense(e){for(let t,n=e.length-1;n>=0;n--)0===e[n].children.length?n>0?(t=e[n-1].children,t.splice(t.indexOf(e[n]),1)):this.clear():XP(e[n],this.toBBox)}}function KP(e,t,n){if(!n)return t.indexOf(e);for(let i=0;i<t.length;i++)if(n(e,t[i]))return i;return-1}function XP(e,t){QP(e,0,e.children.length,t,e)}function QP(e,t,n,i,o){o||(o=sR(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let r=t;r<n;r++){const t=e.children[r];JP(o,e.leaf?i(t):t)}return o}function JP(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function ZP(e,t){return e.minX-t.minX}function $P(e,t){return e.minY-t.minY}function eR(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function tR(e){return e.maxX-e.minX+(e.maxY-e.minY)}function nR(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function iR(e,t){const n=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),o=Math.min(e.maxX,t.maxX),r=Math.min(e.maxY,t.maxY);return Math.max(0,o-n)*Math.max(0,r-i)}function oR(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function rR(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function sR(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function aR(e,t,n,i,o){const r=[t,n];while(r.length){if(n=r.pop(),t=r.pop(),n-t<=i)continue;const s=t+Math.ceil((n-t)/i/2)*i;GP(e,s,t,n,o),r.push(t,s,s,n)}}function cR(){this._tree=new YP}function lR(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.id=""}function uR(e,t){return e.id===t.id}lR.fromRectangleAndId=function(e,t,n){return n.minX=t.west,n.minY=t.south,n.maxX=t.east,n.maxY=t.north,n.id=e,n},cR.prototype.insert=function(e,t){D.typeOf.string("id",e),D.typeOf.object("rectangle",t);const n=lR.fromRectangleAndId(e,t,new lR);this._tree.insert(n)};const hR=new lR;cR.prototype.remove=function(e,t){D.typeOf.string("id",e),D.typeOf.object("rectangle",t);const n=lR.fromRectangleAndId(e,t,hR);this._tree.remove(n,uR)};const dR=new lR;cR.prototype.collides=function(e){D.typeOf.object("rectangle",e);const t=lR.fromRectangleAndId("",e,dR);return this._tree.collides(t)};var fR=cR;const pR=Math.cos,mR=Math.sin,_R=Math.sqrt,gR={computePosition:function(e,t,n,i,o,r,s){const a=t.radiiSquared,c=e.nwCorner,l=e.boundingRectangle;let u=c.latitude-e.granYCos*i+o*e.granXSin;const h=pR(u),d=mR(u),f=a.z*d;let p=c.longitude+i*e.granYSin+o*e.granXCos;const m=h*pR(p),_=h*mR(p),g=a.x*m,y=a.y*_,v=_R(g*m+y*_+f*d);if(r.x=g/v,r.y=y/v,r.z=f/v,n){const t=e.stNwCorner;C(t)?(u=t.latitude-e.stGranYCos*i+o*e.stGranXSin,p=t.longitude+i*e.stGranYSin+o*e.stGranXCos,s.x=(p-e.stWest)*e.lonScalar,s.y=(u-e.stSouth)*e.latScalar):(s.x=(p-l.west)*e.lonScalar,s.y=(u-l.south)*e.latScalar)}}},yR=new hh;let vR=new K;const bR=new se;let AR=new K;const wR=new ve;function TR(e,t,n,i,o,r,s){const a=Math.cos(t),c=i*a,l=n*a,u=Math.sin(t),h=i*u,d=n*u;vR=wR.project(e,vR),vR=K.subtract(vR,AR,vR);const f=hh.fromRotation(t,yR);vR=hh.multiplyByVector(f,vR,vR),vR=K.add(vR,AR,vR),e=wR.unproject(vR,e),r-=1,s-=1;const p=e.latitude,m=p+r*d,_=p-c*s,g=p-c*s+r*d,y=Math.max(p,m,_,g),v=Math.min(p,m,_,g),b=e.longitude,A=b+r*l,w=b+s*h,T=b+s*h+r*l,C=Math.max(b,A,w,T),E=Math.min(b,A,w,T);return{north:y,south:v,east:C,west:E,granYCos:c,granYSin:h,granXCos:l,granXSin:d,nwCorner:e}}gR.computeOptions=function(e,t,n,i,o,r,s){let a,c=e.east,l=e.west,u=e.north,h=e.south,d=!1,f=!1;u===z.PI_OVER_TWO&&(d=!0),h===-z.PI_OVER_TWO&&(f=!0);const p=u-h;a=l>c?z.TWO_PI-l+c:c-l;const m=Math.ceil(a/t)+1,_=Math.ceil(p/t)+1,g=a/(m-1),y=p/(_-1),v=_t.northwest(e,r),b=_t.center(e,bR);0===n&&0===i||(b.longitude<v.longitude&&(b.longitude+=z.TWO_PI),AR=wR.project(b,AR));const A=y,w=g,T=0,C=0,E=_t.clone(e,o),S={granYCos:A,granYSin:T,granXCos:w,granXSin:C,nwCorner:v,boundingRectangle:E,width:m,height:_,northCap:d,southCap:f};if(0!==n){const e=TR(v,n,g,y,b,m,_);if(u=e.north,h=e.south,c=e.east,l=e.west,u<-z.PI_OVER_TWO||u>z.PI_OVER_TWO||h<-z.PI_OVER_TWO||h>z.PI_OVER_TWO)throw new x("Rotated rectangle is invalid.  It crosses over either the north or south pole.");S.granYCos=e.granYCos,S.granYSin=e.granYSin,S.granXCos=e.granXCos,S.granXSin=e.granXSin,E.north=u,E.south=h,E.east=c,E.west=l}if(0!==i){n-=i;const e=_t.northwest(E,s),t=TR(e,n,g,y,b,m,_);S.stGranYCos=t.granYCos,S.stGranXCos=t.granXCos,S.stGranYSin=t.granYSin,S.stGranXSin=t.granXSin,S.stNwCorner=e,S.stWest=t.west,S.stSouth=t.south}return S};var CR=gR;const ER=new K,xR=new K,SR=new K,IR=new K,OR=new _t,DR=new ro,PR=new nn,RR=new nn;function LR(e,t){const n=new zf({attributes:new Hf,primitiveType:xf.TRIANGLES});return n.attributes.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:t.positions}),e.normal&&(n.attributes.normal=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:t.normals})),e.tangent&&(n.attributes.tangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:t.tangents})),e.bitangent&&(n.attributes.bitangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:t.bitangents})),n}function MR(e,t,n,i){const o=e.length,r=t.normal?new Float32Array(o):void 0,s=t.tangent?new Float32Array(o):void 0,a=t.bitangent?new Float32Array(o):void 0;let c=0;const l=IR,u=SR;let h=xR;if(t.normal||t.tangent||t.bitangent)for(let d=0;d<o;d+=3){const o=K.fromArray(e,d,ER),f=c+1,p=c+2;h=n.geodeticSurfaceNormal(o,h),(t.tangent||t.bitangent)&&(K.cross(K.UNIT_Z,h,u),ke.multiplyByVector(i,u,u),K.normalize(u,u),t.bitangent&&K.normalize(K.cross(h,u,l),l)),t.normal&&(r[c]=h.x,r[f]=h.y,r[p]=h.z),t.tangent&&(s[c]=u.x,s[f]=u.y,s[p]=u.z),t.bitangent&&(a[c]=l.x,a[f]=l.y,a[p]=l.z),c+=3}return LR(t,{positions:e,normals:r,tangents:s,bitangents:a})}const BR=new K,NR=new K;function FR(e,t,n){const i=e.length,o=t.normal?new Float32Array(i):void 0,r=t.tangent?new Float32Array(i):void 0,s=t.bitangent?new Float32Array(i):void 0;let a=0,c=0,l=0,u=!0,h=IR,d=SR,f=xR;if(t.normal||t.tangent||t.bitangent)for(let p=0;p<i;p+=6){const m=K.fromArray(e,p,ER),_=K.fromArray(e,(p+6)%i,BR);if(u){const t=K.fromArray(e,(p+3)%i,NR);K.subtract(_,m,_),K.subtract(t,m,t),f=K.normalize(K.cross(t,_,f),f),u=!1}K.equalsEpsilon(_,m,z.EPSILON10)&&(u=!0),(t.tangent||t.bitangent)&&(h=n.geodeticSurfaceNormal(m,h),t.tangent&&(d=K.normalize(K.cross(h,f,d),d))),t.normal&&(o[a++]=f.x,o[a++]=f.y,o[a++]=f.z,o[a++]=f.x,o[a++]=f.y,o[a++]=f.z),t.tangent&&(r[c++]=d.x,r[c++]=d.y,r[c++]=d.z,r[c++]=d.x,r[c++]=d.y,r[c++]=d.z),t.bitangent&&(s[l++]=h.x,s[l++]=h.y,s[l++]=h.z,s[l++]=h.x,s[l++]=h.y,s[l++]=h.z)}return LR(t,{positions:e,normals:o,tangents:r,bitangents:s})}function zR(e,t){const n=e._vertexFormat,i=e._ellipsoid,o=t.height,r=t.width,s=t.northCap,a=t.southCap;let c=0,l=o,u=o,h=0;s&&(c=1,u-=1,h+=1),a&&(l-=1,u-=1,h+=1),h+=r*u;const d=n.position?new Float64Array(3*h):void 0,f=n.st?new Float32Array(2*h):void 0;let p=0,m=0;const _=ER,g=DR;let y=Number.MAX_VALUE,v=Number.MAX_VALUE,b=-Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let I=c;I<l;++I)for(let e=0;e<r;++e)CR.computePosition(t,i,n.st,I,e,_,g),d[p++]=_.x,d[p++]=_.y,d[p++]=_.z,n.st&&(f[m++]=g.x,f[m++]=g.y,y=Math.min(y,g.x),v=Math.min(v,g.y),b=Math.max(b,g.x),A=Math.max(A,g.y));if(s&&(CR.computePosition(t,i,n.st,0,0,_,g),d[p++]=_.x,d[p++]=_.y,d[p++]=_.z,n.st&&(f[m++]=g.x,f[m++]=g.y,y=g.x,v=g.y,b=g.x,A=g.y)),a&&(CR.computePosition(t,i,n.st,o-1,0,_,g),d[p++]=_.x,d[p++]=_.y,d[p]=_.z,n.st&&(f[m++]=g.x,f[m]=g.y,y=Math.min(y,g.x),v=Math.min(v,g.y),b=Math.max(b,g.x),A=Math.max(A,g.y))),n.st&&(y<0||v<0||b>1||A>1))for(let I=0;I<f.length;I+=2)f[I]=(f[I]-y)/(b-y),f[I+1]=(f[I+1]-v)/(A-v);const w=MR(d,n,i,t.tangentRotationMatrix);let T=6*(r-1)*(u-1);s&&(T+=3*(r-1)),a&&(T+=3*(r-1));const C=fd.createTypedArray(h,T);let E,x=0,S=0;for(E=0;E<u-1;++E){for(let e=0;e<r-1;++e){const e=x,t=e+r,n=t+1,i=e+1;C[S++]=e,C[S++]=t,C[S++]=i,C[S++]=i,C[S++]=t,C[S++]=n,++x}++x}if(s||a){let e=h-1;const t=h-1;let n,i;if(s&&a&&(e=h-2),x=0,s)for(E=0;E<r-1;E++)n=x,i=n+1,C[S++]=e,C[S++]=n,C[S++]=i,++x;if(a)for(x=(u-1)*r,E=0;E<r-1;E++)n=x,i=n+1,C[S++]=n,C[S++]=t,C[S++]=i,++x}return w.indices=C,n.st&&(w.attributes.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:f})),w}function kR(e,t,n,i,o){return e[t++]=i[n],e[t++]=i[n+1],e[t++]=i[n+2],e[t++]=o[n],e[t++]=o[n+1],e[t]=o[n+2],e}function UR(e,t,n,i){return e[t++]=i[n],e[t++]=i[n+1],e[t++]=i[n],e[t]=i[n+1],e}const VR=new jf;function HR(e,t){const n=e._shadowVolume,i=e._offsetAttribute,o=e._vertexFormat,r=e._extrudedHeight,s=e._surfaceHeight,a=e._ellipsoid,c=t.height,l=t.width;let u;if(n){const t=jf.clone(o,VR);t.normal=!0,e._vertexFormat=t}const h=zR(e,t);n&&(e._vertexFormat=o);let d=Xv.scaleToGeodeticHeight(h.attributes.position.values,s,a,!1);d=new Float64Array(d);let f=d.length;const p=2*f,m=new Float64Array(p);m.set(d);const _=Xv.scaleToGeodeticHeight(h.attributes.position.values,r,a);m.set(_,f),h.attributes.position.values=m;const g=o.normal?new Float32Array(p):void 0,y=o.tangent?new Float32Array(p):void 0,v=o.bitangent?new Float32Array(p):void 0,b=o.st?new Float32Array(p/3*2):void 0;let A,w,T;if(o.normal){for(w=h.attributes.normal.values,g.set(w),u=0;u<f;u++)w[u]=-w[u];g.set(w,f),h.attributes.normal.values=g}if(n){w=h.attributes.normal.values,o.normal||(h.attributes.normal=void 0);const e=new Float32Array(p);for(u=0;u<f;u++)w[u]=-w[u];e.set(w,f),h.attributes.extrudeDirection=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:e})}const E=C(i);if(E){const e=f/3*2;let t=new Uint8Array(e);i===Wf.TOP?t=wf(t,1,0,e/2):(T=i===Wf.NONE?0:1,t=wf(t,T)),h.attributes.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:t})}if(o.tangent){const e=h.attributes.tangent.values;for(y.set(e),u=0;u<f;u++)e[u]=-e[u];y.set(e,f),h.attributes.tangent.values=y}if(o.bitangent){const e=h.attributes.bitangent.values;v.set(e),v.set(e,f),h.attributes.bitangent.values=v}o.st&&(A=h.attributes.st.values,b.set(A),b.set(A,f/3*2),h.attributes.st.values=b);const x=h.indices,S=x.length,I=f/3,O=fd.createTypedArray(p/3,2*S);for(O.set(x),u=0;u<S;u+=3)O[u+S]=x[u+2]+I,O[u+1+S]=x[u+1]+I,O[u+2+S]=x[u]+I;h.indices=O;const D=t.northCap,P=t.southCap;let R=c,L=2,M=0,B=4,N=4;D&&(L-=1,R-=1,M+=1,B-=2,N-=1),P&&(L-=1,R-=1,M+=1,B-=2,N-=1),M+=L*l+2*R-B;const F=2*(M+N);let k=new Float64Array(3*F);const U=n?new Float32Array(3*F):void 0;let V=E?new Uint8Array(F):void 0,H=o.st?new Float32Array(2*F):void 0;const G=i===Wf.TOP;E&&!G&&(T=i===Wf.ALL?1:0,V=wf(V,T));let W=0,q=0,j=0,Y=0;const X=l*R;let Q;for(u=0;u<X;u+=l)Q=3*u,k=kR(k,W,Q,d,_),W+=6,o.st&&(H=UR(H,q,2*u,A),q+=4),n&&(j+=3,U[j++]=w[Q],U[j++]=w[Q+1],U[j++]=w[Q+2]),G&&(V[Y++]=1,Y+=1);if(P){const e=D?X+1:X;for(Q=3*e,u=0;u<2;u++)k=kR(k,W,Q,d,_),W+=6,o.st&&(H=UR(H,q,2*e,A),q+=4),n&&(j+=3,U[j++]=w[Q],U[j++]=w[Q+1],U[j++]=w[Q+2]),G&&(V[Y++]=1,Y+=1)}else for(u=X-l;u<X;u++)Q=3*u,k=kR(k,W,Q,d,_),W+=6,o.st&&(H=UR(H,q,2*u,A),q+=4),n&&(j+=3,U[j++]=w[Q],U[j++]=w[Q+1],U[j++]=w[Q+2]),G&&(V[Y++]=1,Y+=1);for(u=X-1;u>0;u-=l)Q=3*u,k=kR(k,W,Q,d,_),W+=6,o.st&&(H=UR(H,q,2*u,A),q+=4),n&&(j+=3,U[j++]=w[Q],U[j++]=w[Q+1],U[j++]=w[Q+2]),G&&(V[Y++]=1,Y+=1);if(D){const e=X;for(Q=3*e,u=0;u<2;u++)k=kR(k,W,Q,d,_),W+=6,o.st&&(H=UR(H,q,2*e,A),q+=4),n&&(j+=3,U[j++]=w[Q],U[j++]=w[Q+1],U[j++]=w[Q+2]),G&&(V[Y++]=1,Y+=1)}else for(u=l-1;u>=0;u--)Q=3*u,k=kR(k,W,Q,d,_),W+=6,o.st&&(H=UR(H,q,2*u,A),q+=4),n&&(j+=3,U[j++]=w[Q],U[j++]=w[Q+1],U[j++]=w[Q+2]),G&&(V[Y++]=1,Y+=1);let J=FR(k,o,a);o.st&&(J.attributes.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:H})),n&&(J.attributes.extrudeDirection=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:U})),E&&(J.attributes.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:V}));const Z=fd.createTypedArray(F,6*M);let $,ee,te,ne;f=k.length/3;let ie=0;for(u=0;u<f-1;u+=2){$=u,ne=($+2)%f;const e=K.fromArray(k,3*$,BR),t=K.fromArray(k,3*ne,NR);K.equalsEpsilon(e,t,z.EPSILON10)||(ee=($+1)%f,te=(ee+2)%f,Z[ie++]=$,Z[ie++]=ee,Z[ie++]=ne,Z[ie++]=ne,Z[ie++]=ee,Z[ie++]=te)}return J.indices=Z,J=fg.combineInstances([new Sm({geometry:h}),new Sm({geometry:J})]),J[0]}const GR=[new K,new K,new K,new K],WR=new se,qR=new se;function jR(e,t,n,i,o){if(0===n)return _t.clone(e,o);const r=CR.computeOptions(e,t,n,0,OR,WR),s=r.height,a=r.width,c=GR;return CR.computePosition(r,i,!1,0,0,c[0]),CR.computePosition(r,i,!1,0,a-1,c[1]),CR.computePosition(r,i,!1,s-1,0,c[2]),CR.computePosition(r,i,!1,s-1,a-1,c[3]),_t.fromCartesianArray(c,i,o)}function YR(e){e=R(e,R.EMPTY_OBJECT);const t=e.rectangle;if(D.typeOf.object("rectangle",t),_t.validate(t),t.north<t.south)throw new x("options.rectangle.north must be greater than or equal to options.rectangle.south");const n=R(e.height,0),i=R(e.extrudedHeight,n);this._rectangle=_t.clone(t),this._granularity=R(e.granularity,z.RADIANS_PER_DEGREE),this._ellipsoid=ge.clone(R(e.ellipsoid,ge.WGS84)),this._surfaceHeight=Math.max(n,i),this._rotation=R(e.rotation,0),this._stRotation=R(e.stRotation,0),this._vertexFormat=jf.clone(R(e.vertexFormat,jf.DEFAULT)),this._extrudedHeight=Math.min(n,i),this._shadowVolume=R(e.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=e.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}YR.packedLength=_t.packedLength+ge.packedLength+jf.packedLength+7,YR.pack=function(e,t,n){return D.typeOf.object("value",e),D.defined("array",t),n=R(n,0),_t.pack(e._rectangle,t,n),n+=_t.packedLength,ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,jf.pack(e._vertexFormat,t,n),n+=jf.packedLength,t[n++]=e._granularity,t[n++]=e._surfaceHeight,t[n++]=e._rotation,t[n++]=e._stRotation,t[n++]=e._extrudedHeight,t[n++]=e._shadowVolume?1:0,t[n]=R(e._offsetAttribute,-1),t};const KR=new _t,XR=ge.clone(ge.UNIT_SPHERE),QR={rectangle:KR,ellipsoid:XR,vertexFormat:VR,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};YR.unpack=function(e,t,n){D.defined("array",e),t=R(t,0);const i=_t.unpack(e,t,KR);t+=_t.packedLength;const o=ge.unpack(e,t,XR);t+=ge.packedLength;const r=jf.unpack(e,t,VR);t+=jf.packedLength;const s=e[t++],a=e[t++],c=e[t++],l=e[t++],u=e[t++],h=1===e[t++],d=e[t];return C(n)?(n._rectangle=_t.clone(i,n._rectangle),n._ellipsoid=ge.clone(o,n._ellipsoid),n._vertexFormat=jf.clone(r,n._vertexFormat),n._granularity=s,n._surfaceHeight=a,n._rotation=c,n._stRotation=l,n._extrudedHeight=u,n._shadowVolume=h,n._offsetAttribute=-1===d?void 0:d,n):(QR.granularity=s,QR.height=a,QR.rotation=c,QR.stRotation=l,QR.extrudedHeight=u,QR.shadowVolume=h,QR.offsetAttribute=-1===d?void 0:d,new YR(QR))},YR.computeRectangle=function(e,t){e=R(e,R.EMPTY_OBJECT);const n=e.rectangle;if(D.typeOf.object("rectangle",n),_t.validate(n),n.north<n.south)throw new x("options.rectangle.north must be greater than or equal to options.rectangle.south");const i=R(e.granularity,z.RADIANS_PER_DEGREE),o=R(e.ellipsoid,ge.WGS84),r=R(e.rotation,0);return jR(n,i,r,o,t)};const JR=new ke,ZR=new il,$R=new se;YR.createGeometry=function(e){if(z.equalsEpsilon(e._rectangle.north,e._rectangle.south,z.EPSILON10)||z.equalsEpsilon(e._rectangle.east,e._rectangle.west,z.EPSILON10))return;let t=e._rectangle;const n=e._ellipsoid,i=e._rotation,o=e._stRotation,r=e._vertexFormat,s=CR.computeOptions(t,e._granularity,i,o,OR,WR,qR),a=JR;if(0!==o||0!==i){const e=_t.center(t,$R),i=n.geodeticSurfaceNormalCartographic(e,BR);il.fromAxisAngle(i,-o,ZR),ke.fromQuaternion(ZR,a)}else ke.clone(ke.IDENTITY,a);const c=e._surfaceHeight,l=e._extrudedHeight,u=!z.equalsEpsilon(c,l,0,z.EPSILON2);let h,d;if(s.lonScalar=1/e._rectangle.width,s.latScalar=1/e._rectangle.height,s.tangentRotationMatrix=a,t=e._rectangle,u){h=HR(e,s);const i=nn.fromRectangle3D(t,n,c,RR),o=nn.fromRectangle3D(t,n,l,PR);d=nn.union(i,o)}else{if(h=zR(e,s),h.attributes.position.values=Xv.scaleToGeodeticHeight(h.attributes.position.values,c,n,!1),C(e._offsetAttribute)){const t=h.attributes.position.values.length,n=new Uint8Array(t/3),i=e._offsetAttribute===Wf.NONE?0:1;wf(n,i),h.attributes.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}d=nn.fromRectangle3D(t,n,c)}return r.position||delete h.attributes.position,new zf({attributes:h.attributes,indices:h.indices,primitiveType:h.primitiveType,boundingSphere:d,offsetAttribute:e._offsetAttribute})},YR.createShadowVolume=function(e,t,n){const i=e._granularity,o=e._ellipsoid,r=t(i,o),s=n(i,o);return new YR({rectangle:e._rectangle,rotation:e._rotation,ellipsoid:o,stRotation:e._stRotation,granularity:i,extrudedHeight:s,height:r,vertexFormat:jf.POSITION_ONLY,shadowVolume:!0})};const eL=new _t,tL=[new ro,new ro,new ro],nL=new hh,iL=new se;function oL(e){if(0===e._stRotation)return[0,0,0,1,1,0];const t=_t.clone(e._rectangle,eL),n=e._granularity,i=e._ellipsoid,o=e._rotation-e._stRotation,r=jR(t,n,o,i,eL),s=tL;s[0].x=r.west,s[0].y=r.south,s[1].x=r.west,s[1].y=r.north,s[2].x=r.east,s[2].y=r.south;const a=e.rectangle,c=hh.fromRotation(e._stRotation,nL),l=_t.center(a,iL);for(let p=0;p<3;++p){const e=s[p];e.x-=l.longitude,e.y-=l.latitude,hh.multiplyByVector(c,e,e),e.x+=l.longitude,e.y+=l.latitude,e.x=(e.x-a.west)/a.width,e.y=(e.y-a.south)/a.height}const u=s[0],h=s[1],d=s[2],f=new Array(6);return ro.pack(u,f),ro.pack(h,f,2),ro.pack(d,f,4),f}Object.defineProperties(YR.prototype,{rectangle:{get:function(){return C(this._rotatedRectangle)||(this._rotatedRectangle=jR(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return C(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=oL(this)),this._textureCoordinateRotationPoints}}});var rL=YR;const sL=new nn,aL=new nn,cL=new K,lL=new _t;function uL(e,t){const n=e._ellipsoid,i=t.height,o=t.width,r=t.northCap,s=t.southCap;let a=i,c=2,l=0,u=4;r&&(c-=1,a-=1,l+=1,u-=2),s&&(c-=1,a-=1,l+=1,u-=2),l+=c*o+2*a-u;const h=new Float64Array(3*l);let d,f=0,p=0;const m=cL;if(r)CR.computePosition(t,n,!1,p,0,m),h[f++]=m.x,h[f++]=m.y,h[f++]=m.z;else for(d=0;d<o;d++)CR.computePosition(t,n,!1,p,d,m),h[f++]=m.x,h[f++]=m.y,h[f++]=m.z;for(d=o-1,p=1;p<i;p++)CR.computePosition(t,n,!1,p,d,m),h[f++]=m.x,h[f++]=m.y,h[f++]=m.z;if(p=i-1,!s)for(d=o-2;d>=0;d--)CR.computePosition(t,n,!1,p,d,m),h[f++]=m.x,h[f++]=m.y,h[f++]=m.z;for(d=0,p=i-2;p>0;p--)CR.computePosition(t,n,!1,p,d,m),h[f++]=m.x,h[f++]=m.y,h[f++]=m.z;const _=h.length/3*2,g=fd.createTypedArray(h.length/3,_);let y=0;for(let b=0;b<h.length/3-1;b++)g[y++]=b,g[y++]=b+1;g[y++]=h.length/3-1,g[y++]=0;const v=new zf({attributes:new Hf,primitiveType:xf.LINES});return v.attributes.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:h}),v.indices=g,v}function hL(e,t){const n=e._surfaceHeight,i=e._extrudedHeight,o=e._ellipsoid,r=i,s=n,a=uL(e,t),c=t.height,l=t.width,u=Xv.scaleToGeodeticHeight(a.attributes.position.values,s,o,!1);let h=u.length;const d=new Float64Array(2*h);d.set(u);const f=Xv.scaleToGeodeticHeight(a.attributes.position.values,r,o);d.set(f,h),a.attributes.position.values=d;const p=t.northCap,m=t.southCap;let _=4;p&&(_-=1),m&&(_-=1);const g=2*(d.length/3+_),y=fd.createTypedArray(d.length/3,g);h=d.length/6;let v,b=0;for(let A=0;A<h-1;A++)y[b++]=A,y[b++]=A+1,y[b++]=A+h,y[b++]=A+h+1;if(y[b++]=h-1,y[b++]=0,y[b++]=h+h-1,y[b++]=h,y[b++]=0,y[b++]=h,p)v=c-1;else{const e=l-1;y[b++]=e,y[b++]=e+h,v=l+c-2}if(y[b++]=v,y[b++]=v+h,!m){const e=l+v-1;y[b++]=e,y[b]=e+h}return a.indices=y,a}function dL(e){e=R(e,R.EMPTY_OBJECT);const t=e.rectangle,n=R(e.granularity,z.RADIANS_PER_DEGREE),i=R(e.ellipsoid,ge.WGS84),o=R(e.rotation,0);if(!C(t))throw new x("rectangle is required.");if(_t.validate(t),t.north<t.south)throw new x("options.rectangle.north must be greater than options.rectangle.south");const r=R(e.height,0),s=R(e.extrudedHeight,r);this._rectangle=_t.clone(t),this._granularity=n,this._ellipsoid=i,this._surfaceHeight=Math.max(r,s),this._rotation=o,this._extrudedHeight=Math.min(r,s),this._offsetAttribute=e.offsetAttribute,this._workerName="createRectangleOutlineGeometry"}dL.packedLength=_t.packedLength+ge.packedLength+5,dL.pack=function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");return n=R(n,0),_t.pack(e._rectangle,t,n),n+=_t.packedLength,ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,t[n++]=e._granularity,t[n++]=e._surfaceHeight,t[n++]=e._rotation,t[n++]=e._extrudedHeight,t[n]=R(e._offsetAttribute,-1),t};const fL=new _t,pL=ge.clone(ge.UNIT_SPHERE),mL={rectangle:fL,ellipsoid:pL,granularity:void 0,height:void 0,rotation:void 0,extrudedHeight:void 0,offsetAttribute:void 0};dL.unpack=function(e,t,n){if(!C(e))throw new x("array is required");t=R(t,0);const i=_t.unpack(e,t,fL);t+=_t.packedLength;const o=ge.unpack(e,t,pL);t+=ge.packedLength;const r=e[t++],s=e[t++],a=e[t++],c=e[t++],l=e[t];return C(n)?(n._rectangle=_t.clone(i,n._rectangle),n._ellipsoid=ge.clone(o,n._ellipsoid),n._surfaceHeight=s,n._rotation=a,n._extrudedHeight=c,n._offsetAttribute=-1===l?void 0:l,n):(mL.granularity=r,mL.height=s,mL.rotation=a,mL.extrudedHeight=c,mL.offsetAttribute=-1===l?void 0:l,new dL(mL))};const _L=new se;dL.createGeometry=function(e){const t=e._rectangle,n=e._ellipsoid,i=CR.computeOptions(t,e._granularity,e._rotation,0,lL,_L);let o,r;if(z.equalsEpsilon(t.north,t.south,z.EPSILON10)||z.equalsEpsilon(t.east,t.west,z.EPSILON10))return;const s=e._surfaceHeight,a=e._extrudedHeight,c=!z.equalsEpsilon(s,a,0,z.EPSILON2);let l;if(c){if(o=hL(e,i),C(e._offsetAttribute)){const t=o.attributes.position.values.length/3;let n=new Uint8Array(t);e._offsetAttribute===Wf.TOP?n=wf(n,1,0,t/2):(l=e._offsetAttribute===Wf.NONE?0:1,n=wf(n,l)),o.attributes.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}const c=nn.fromRectangle3D(t,n,s,aL),u=nn.fromRectangle3D(t,n,a,sL);r=nn.union(c,u)}else{if(o=uL(e,i),o.attributes.position.values=Xv.scaleToGeodeticHeight(o.attributes.position.values,s,n,!1),C(e._offsetAttribute)){const t=o.attributes.position.values.length,n=new Uint8Array(t/3);l=e._offsetAttribute===Wf.NONE?0:1,wf(n,l),o.attributes.applyOffset=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})}r=nn.fromRectangle3D(t,n,s)}return new zf({attributes:o.attributes,indices:o.indices,primitiveType:xf.LINES,boundingSphere:r,offsetAttribute:e._offsetAttribute})};var gL=dL;const yL={FIXED:0,INERTIAL:1};var vL=Object.freeze(yL);const bL=30,AL=1<<bL,wL=1<<bL+1>>>0,TL=2*bL+1,CL=4,EL=[],xL=[],SL=[[0,1,3,2],[0,2,3,1],[3,2,0,1],[3,1,0,2]],IL=1,OL=2,DL=[IL,0,0,IL|OL];function PL(e){if(!Oc.supportsBigInt())throw new Je("S2 required BigInt support");if(!C(e))throw new x("cell ID is required.");if(!PL.isValidId(e))throw new x("cell ID is invalid.");this._cellId=e,this._level=PL.getLevel(e)}function RL(e,t){const n=ML(e,t);return NL(n[0],n[1],n[2])}function LL(e,t,n){const i=BL(e,t),o=UL([i[1],i[2]],t),r=n>>1&1;return FL(i[0],o[0][r^1&n],o[1][r])}function ML(e,t){const n=BL(e),i=n[0],o=n[1],r=n[2],s=30===t,a=!s&&(BigInt(o)^e>>BigInt(2))&BigInt(1),c=s?1:a?2:0,l=(o<<1)+c,u=(r<<1)+c;return[i,l,u]}function BL(e){0===EL.length&&WL();const t=Number(e>>BigInt(TL));let n=t&IL;const i=(1<<CL)-1;let o=0,r=0;for(let s=7;s>=0;s--){const t=7===s?bL-7*CL:CL,a=(1<<2*t)-1;n+=Number(e>>BigInt(2*s*CL+1)&BigInt(a))<<2,n=xL[n];const c=s*CL;o+=n>>CL+2<<c,r+=(n>>2&i)<<c,n&=IL|OL}return[t,o,r]}function NL(e,t,n){const i=kL(t),o=kL(n),r=zL(i),s=zL(o);return FL(e,r,s)}function FL(e,t,n){switch(e){case 0:return new K(1,t,n);case 1:return new K(-t,1,n);case 2:return new K(-t,-n,1);case 3:return new K(-1,-n,-t);case 4:return new K(n,-1,-t);default:return new K(n,t,-1)}}function zL(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function kL(e){return 1/wL*e}function UL(e,t){const n=[[],[]],i=VL(t);for(let o=0;o<2;++o){const t=e[o]&-i,r=t+i;n[o][0]=zL(HL(t)),n[o][1]=zL(HL(r))}return n}function VL(e){return 1<<bL-e>>>0}function HL(e){return 1/AL*e}function GL(e,t,n,i,o,r){if(e===CL){const e=(t<<CL)+n;EL[(e<<2)+i]=(o<<2)+r,xL[(o<<2)+i]=(e<<2)+r}else{e++,t<<=1,n<<=1,o<<=2;const s=SL[r];GL(e,t+(s[0]>>1),n+(1&s[0]),i,o,r^DL[0]),GL(e,t+(s[1]>>1),n+(1&s[1]),i,o+1,r^DL[1]),GL(e,t+(s[2]>>1),n+(1&s[2]),i,o+2,r^DL[2]),GL(e,t+(s[3]>>1),n+(1&s[3]),i,o+3,r^DL[3])}}function WL(){GL(0,0,0,0,0,0),GL(0,0,0,IL,0,IL),GL(0,0,0,OL,0,OL),GL(0,0,0,IL|OL,0,IL|OL)}function qL(e){return e&~e+BigInt(1)}function jL(e){return BigInt(1)<<BigInt(2*(bL-e))}PL.fromToken=function(e){if(D.typeOf.string("token",e),!PL.isValidToken(e))throw new x("token is invalid.");return new PL(PL.getIdFromToken(e))},PL.isValidId=function(e){if(D.typeOf.bigint("cellId",e),e<=0)return!1;if(e>>BigInt(TL)>5)return!1;const t=e&~e+BigInt(1);return!!(t&BigInt("0x1555555555555555"))},PL.isValidToken=function(e){return D.typeOf.string("token",e),!!/^[0-9a-fA-F]{1,16}$/.test(e)&&PL.isValidId(PL.getIdFromToken(e))},PL.getIdFromToken=function(e){return D.typeOf.string("token",e),BigInt("0x"+e+"0".repeat(16-e.length))},PL.getTokenFromId=function(e){D.typeOf.bigint("cellId",e);const t=Math.floor(KL(e)/4),n=e.toString(16).replace(/0*$/,""),i=Array(17-t-n.length).join("0");return i+n},PL.getLevel=function(e){if(D.typeOf.bigint("cellId",e),!PL.isValidId(e))throw new x;let t=0;while(e!==BigInt(0)){if(e&BigInt(1))break;t++,e>>=BigInt(1)}return bL-(t>>1)},PL.prototype.getChild=function(e){if(D.typeOf.number("index",e),e<0||e>3)throw new x("child index must be in the range [0-3].");if(30===this._level)throw new x("cannot get child of leaf cell.");const t=qL(this._cellId)>>BigInt(2),n=this._cellId+BigInt(2*e+1-4)*t;return new PL(n)},PL.prototype.getParent=function(){if(0===this._level)throw new x("cannot get parent of root cell.");const e=qL(this._cellId)<<BigInt(2);return new PL(this._cellId&~e+BigInt(1)|e)},PL.prototype.getParentAtLevel=function(e){if(0===this._level||e<0||this._level<e)throw new x("cannot get parent at invalid level.");const t=jL(e);return new PL(this._cellId&-t|t)},PL.prototype.getCenter=function(e){e=R(e,ge.WGS84);let t=RL(this._cellId,this._level);t=K.normalize(t,t);const n=new se.fromCartesian(t,ge.UNIT_SPHERE);return se.toCartesian(n,e,new K)},PL.prototype.getVertex=function(e,t){if(D.typeOf.number("index",e),e<0||e>3)throw new x("vertex index must be in the range [0-3].");t=R(t,ge.WGS84);let n=LL(this._cellId,this._level,e);n=K.normalize(n,n);const i=new se.fromCartesian(n,ge.UNIT_SPHERE);return se.toCartesian(i,t,new K)},PL.fromFacePositionLevel=function(e,t,n){if(D.typeOf.bigint("position",t),e<0||e>5)throw new x("Invalid S2 Face (must be within 0-5)");if(n<0||n>bL)throw new x("Invalid level (must be within 0-30)");if(t<0||t>=Math.pow(4,n))throw new x("Invalid Hilbert position for level");const i=(e<4?"0":"")+(e<2?"0":"")+e.toString(2),o=t.toString(2),r=Array(2*n-o.length+1).join("0"),s=Array(TL-2*n).join("0"),a=BigInt(`0b${i}${r}${o}1${s}`);return new PL(a)};const YL=[64,0,1,39,2,15,40,23,3,12,16,59,41,19,24,54,4,64,13,10,17,62,60,28,42,30,20,51,25,44,55,47,5,32,65,38,14,22,11,58,18,53,63,9,61,27,29,50,43,46,31,37,21,57,52,8,26,49,45,36,56,7,48,35,6,34,33,0];function KL(e){return YL[(-e&e)%BigInt(67)]}var XL=PL;const QL={LEFT_DOWN:0,LEFT_UP:1,LEFT_CLICK:2,LEFT_DOUBLE_CLICK:3,RIGHT_DOWN:5,RIGHT_UP:6,RIGHT_CLICK:7,MIDDLE_DOWN:10,MIDDLE_UP:11,MIDDLE_CLICK:12,MOUSE_MOVE:15,WHEEL:16,PINCH_START:17,PINCH_END:18,PINCH_MOVE:19};var JL=Object.freeze(QL);function ZL(e,t,n){const i=e._element;if(i===document)return n.x=t.clientX,n.y=t.clientY,n;const o=i.getBoundingClientRect();return n.x=t.clientX-o.left,n.y=t.clientY-o.top,n}function $L(e,t){let n=e;return C(t)&&(n+=`+${t}`),n}function eM(e){return e.shiftKey?yO.SHIFT:e.ctrlKey?yO.CTRL:e.altKey?yO.ALT:void 0}const tM={LEFT:0,MIDDLE:1,RIGHT:2};function nM(e,t,n,i){function o(t){i(e,t)}Oc.isInternetExplorer()?n.addEventListener(t,o,!1):n.addEventListener(t,o,{capture:!1,passive:!1}),e._removalFunctions.push((function(){n.removeEventListener(t,o,!1)}))}function iM(e){const t=e._element,n=C(t.disableRootEvents)?t:document;let i;Oc.supportsPointerEvents()?(nM(e,"pointerdown",t,PM),nM(e,"pointerup",t,RM),nM(e,"pointermove",t,LM),nM(e,"pointercancel",t,RM)):(nM(e,"mousedown",t,lM),nM(e,"mouseup",n,fM),nM(e,"mousemove",n,mM),nM(e,"touchstart",t,vM),nM(e,"touchend",n,bM),nM(e,"touchmove",n,SM),nM(e,"touchcancel",n,bM)),nM(e,"dblclick",t,gM),i="onwheel"in t?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",nM(e,i,t,yM)}function oM(e){const t=e._removalFunctions;for(let n=0;n<t.length;++n)t[n]()}const rM={position:new ro};function sM(e){e._lastSeenTouchEvent=py()}function aM(e){return py()-e._lastSeenTouchEvent>MM.mouseEmulationIgnoreMilliseconds}function cM(e,t,n){const i=e.x-t.x,o=e.y-t.y,r=Math.sqrt(i*i+o*o);return r<n}function lM(e,t){if(!aM(e))return;const n=t.button;let i;if(e._buttonDown[n]=!0,n===tM.LEFT)i=JL.LEFT_DOWN;else if(n===tM.MIDDLE)i=JL.MIDDLE_DOWN;else{if(n!==tM.RIGHT)return;i=JL.RIGHT_DOWN}const o=ZL(e,t,e._primaryPosition);ro.clone(o,e._primaryStartPosition),ro.clone(o,e._primaryPreviousPosition);const r=eM(t),s=e.getInputAction(i,r);C(s)&&(ro.clone(o,rM.position),s(rM),t.preventDefault())}const uM={position:new ro},hM={position:new ro};function dM(e,t,n,i){const o=eM(i),r=e.getInputAction(t,o),s=e.getInputAction(n,o);if(C(r)||C(s)){const t=ZL(e,i,e._primaryPosition);if(C(r)&&(ro.clone(t,uM.position),r(uM)),C(s)){const n=e._primaryStartPosition;cM(n,t,e._clickPixelTolerance)&&(ro.clone(t,hM.position),s(hM))}}}function fM(e,t){if(!aM(e))return;const n=t.button;n!==tM.LEFT&&n!==tM.MIDDLE&&n!==tM.RIGHT||(e._buttonDown[tM.LEFT]&&(dM(e,JL.LEFT_UP,JL.LEFT_CLICK,t),e._buttonDown[tM.LEFT]=!1),e._buttonDown[tM.MIDDLE]&&(dM(e,JL.MIDDLE_UP,JL.MIDDLE_CLICK,t),e._buttonDown[tM.MIDDLE]=!1),e._buttonDown[tM.RIGHT]&&(dM(e,JL.RIGHT_UP,JL.RIGHT_CLICK,t),e._buttonDown[tM.RIGHT]=!1))}const pM={startPosition:new ro,endPosition:new ro};function mM(e,t){if(!aM(e))return;const n=eM(t),i=ZL(e,t,e._primaryPosition),o=e._primaryPreviousPosition,r=e.getInputAction(JL.MOUSE_MOVE,n);C(r)&&(ro.clone(o,pM.startPosition),ro.clone(i,pM.endPosition),r(pM)),ro.clone(i,o),(e._buttonDown[tM.LEFT]||e._buttonDown[tM.MIDDLE]||e._buttonDown[tM.RIGHT])&&t.preventDefault()}const _M={position:new ro};function gM(e,t){const n=t.button;let i;if(n!==tM.LEFT)return;i=JL.LEFT_DOUBLE_CLICK;const o=eM(t),r=e.getInputAction(i,o);C(r)&&(ZL(e,t,_M.position),r(_M))}function yM(e,t){let n;if(C(t.deltaY)){const e=t.deltaMode;n=e===t.DOM_DELTA_PIXEL?-t.deltaY:e===t.DOM_DELTA_LINE?40*-t.deltaY:120*-t.deltaY}else n=t.detail>0?-120*t.detail:t.wheelDelta;if(!C(n))return;const i=eM(t),o=e.getInputAction(JL.WHEEL,i);C(o)&&(o(n),t.preventDefault())}function vM(e,t){sM(e);const n=t.changedTouches;let i;const o=n.length;let r,s;const a=e._positions;for(i=0;i<o;++i)r=n[i],s=r.identifier,a.set(s,ZL(e,r,new ro));xM(e,t);const c=e._previousPositions;for(i=0;i<o;++i)r=n[i],s=r.identifier,c.set(s,ro.clone(a.get(s)))}function bM(e,t){sM(e);const n=t.changedTouches;let i;const o=n.length;let r,s;const a=e._positions;for(i=0;i<o;++i)r=n[i],s=r.identifier,a.remove(s);xM(e,t);const c=e._previousPositions;for(i=0;i<o;++i)r=n[i],s=r.identifier,c.remove(s)}const AM={position:new ro},wM={position1:new ro,position2:new ro},TM={position:new ro},CM={position:new ro},EM={position:new ro};function xM(e,t){const n=eM(t),i=e._positions,o=i.length;let r,s;const a=e._isPinching;if(1!==o&&e._buttonDown[tM.LEFT]){if(e._buttonDown[tM.LEFT]=!1,C(e._touchHoldTimer)&&(clearTimeout(e._touchHoldTimer),e._touchHoldTimer=void 0),r=e.getInputAction(JL.LEFT_UP,n),C(r)&&(ro.clone(e._primaryPosition,TM.position),r(TM)),0===o&&!e._isTouchHolding&&(s=e.getInputAction(JL.LEFT_CLICK,n),C(s))){const t=e._primaryStartPosition,n=e._previousPositions.values[0];cM(t,n,e._clickPixelTolerance)&&(ro.clone(e._primaryPosition,CM.position),s(CM))}e._isTouchHolding=!1}if(0===o&&a&&(e._isPinching=!1,r=e.getInputAction(JL.PINCH_END,n),C(r)&&r()),1===o&&!a){const o=i.values[0];ro.clone(o,e._primaryPosition),ro.clone(o,e._primaryStartPosition),ro.clone(o,e._primaryPreviousPosition),e._buttonDown[tM.LEFT]=!0,r=e.getInputAction(JL.LEFT_DOWN,n),C(r)&&(ro.clone(o,AM.position),r(AM)),e._touchHoldTimer=setTimeout((function(){if(!e.isDestroyed()&&(e._touchHoldTimer=void 0,e._isTouchHolding=!0,s=e.getInputAction(JL.RIGHT_CLICK,n),C(s))){const t=e._primaryStartPosition,n=e._previousPositions.values[0];cM(t,n,e._holdPixelTolerance)&&(ro.clone(e._primaryPosition,EM.position),s(EM))}}),MM.touchHoldDelayMilliseconds),t.preventDefault()}2!==o||a||(e._isPinching=!0,r=e.getInputAction(JL.PINCH_START,n),C(r)&&(ro.clone(i.values[0],wM.position1),ro.clone(i.values[1],wM.position2),r(wM),t.preventDefault()))}function SM(e,t){sM(e);const n=t.changedTouches;let i;const o=n.length;let r,s;const a=e._positions;for(i=0;i<o;++i){r=n[i],s=r.identifier;const t=a.get(s);C(t)&&ZL(e,r,t)}DM(e,t);const c=e._previousPositions;for(i=0;i<o;++i)r=n[i],s=r.identifier,ro.clone(a.get(s),c.get(s))}const IM={startPosition:new ro,endPosition:new ro},OM={distance:{startPosition:new ro,endPosition:new ro},angleAndHeight:{startPosition:new ro,endPosition:new ro}};function DM(e,t){const n=eM(t),i=e._positions,o=e._previousPositions,r=i.length;let s;if(1===r&&e._buttonDown[tM.LEFT]){const o=i.values[0];ro.clone(o,e._primaryPosition);const r=e._primaryPreviousPosition;s=e.getInputAction(JL.MOUSE_MOVE,n),C(s)&&(ro.clone(r,IM.startPosition),ro.clone(o,IM.endPosition),s(IM)),ro.clone(o,r),t.preventDefault()}else if(2===r&&e._isPinching&&(s=e.getInputAction(JL.PINCH_MOVE,n),C(s))){const e=i.values[0],t=i.values[1],n=o.values[0],r=o.values[1],a=t.x-e.x,c=t.y-e.y,l=.25*Math.sqrt(a*a+c*c),u=r.x-n.x,h=r.y-n.y,d=.25*Math.sqrt(u*u+h*h),f=.125*(t.y+e.y),p=.125*(r.y+n.y),m=Math.atan2(c,a),_=Math.atan2(h,u);ro.fromElements(0,d,OM.distance.startPosition),ro.fromElements(0,l,OM.distance.endPosition),ro.fromElements(_,p,OM.angleAndHeight.startPosition),ro.fromElements(m,f,OM.angleAndHeight.endPosition),s(OM)}}function PM(e,t){if(t.target.setPointerCapture(t.pointerId),"touch"===t.pointerType){const n=e._positions,i=t.pointerId;n.set(i,ZL(e,t,new ro)),xM(e,t);const o=e._previousPositions;o.set(i,ro.clone(n.get(i)))}else lM(e,t)}function RM(e,t){if("touch"===t.pointerType){const n=e._positions,i=t.pointerId;n.remove(i),xM(e,t);const o=e._previousPositions;o.remove(i)}else fM(e,t)}function LM(e,t){if("touch"===t.pointerType){const n=e._positions,i=t.pointerId,o=n.get(i);if(!C(o))return;ZL(e,t,o),DM(e,t);const r=e._previousPositions;ro.clone(n.get(i),r.get(i))}else mM(e,t)}function MM(e){this._inputEvents={},this._buttonDown={LEFT:!1,MIDDLE:!1,RIGHT:!1},this._isPinching=!1,this._isTouchHolding=!1,this._lastSeenTouchEvent=-MM.mouseEmulationIgnoreMilliseconds,this._primaryStartPosition=new ro,this._primaryPosition=new ro,this._primaryPreviousPosition=new ro,this._positions=new ff,this._previousPositions=new ff,this._removalFunctions=[],this._touchHoldTimer=void 0,this._clickPixelTolerance=5,this._holdPixelTolerance=25,this._element=R(e,document),iM(this)}MM.prototype.setInputAction=function(e,t,n){if(!C(e))throw new x("action is required.");if(!C(t))throw new x("type is required.");const i=$L(t,n);this._inputEvents[i]=e},MM.prototype.getInputAction=function(e,t){if(!C(e))throw new x("type is required.");const n=$L(e,t);return this._inputEvents[n]},MM.prototype.removeInputAction=function(e,t){if(!C(e))throw new x("type is required.");const n=$L(e,t);delete this._inputEvents[n]},MM.prototype.isDestroyed=function(){return!1},MM.prototype.destroy=function(){return oM(this),Qh(this)},MM.mouseEmulationIgnoreMilliseconds=800,MM.touchHoldDelayMilliseconds=1500;var BM=MM;function NM(e){e=R(e,!0),this.value=NM.toValue(e)}Object.defineProperties(NM.prototype,{componentDatatype:{get:function(){return ih.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 1}},normalize:{get:function(){return!1}}}),NM.toValue=function(e,t){if(!C(e))throw new x("show is required.");return C(t)?(t[0]=e,t):new Uint8Array([e])};var FM=NM;const zM={};function kM(e){const t=6.239996+.0172019696544*e;return.001657*Math.sin(t+.01671*Math.sin(t))}const UM=32.184,VM=2451545;function HM(e,t){t=Ea.addSeconds(e,UM,t);const n=Ea.totalDays(t)-VM;return t=Ea.addSeconds(t,kM(n),t),t}const GM=new Ea(2451545,0,ia.TAI),WM=1e3,qM=z.RADIANS_PER_DEGREE,jM=z.RADIANS_PER_ARCSECOND,YM=14959787e4,KM=new ke;function XM(e,t,n,i,o,r,s){if(n<0&&(n=-n,o+=z.PI),n<0||n>z.PI)throw new x("The inclination is out of range. Inclination must be greater than or equal to zero and less than or equal to Pi radians.");const a=e*(1-t),c=i-o,l=o,u=JM(r-i,t),h=QM(t,0);if("Hyperbolic"===h&&Math.abs(z.negativePiToPi(u))>=Math.acos(-1/t))throw new x("The true anomaly of the hyperbolic orbit lies outside of the bounds of the hyperbola.");nB(c,n,l,KM);const d=a*(1+t),f=Math.cos(u),p=Math.sin(u),m=1+t*f;if(m<=z.Epsilon10)throw new x("elements cannot be converted to cartesian");const _=d/m;return C(s)?(s.x=_*f,s.y=_*p,s.z=0):s=new K(_*f,_*p,0),ke.multiplyByVector(KM,s,s)}function QM(e,t){if(e<0)throw new x("eccentricity cannot be negative.");return e<=t?"Circular":e<1-t?"Elliptical":e<=1+t?"Parabolic":"Hyperbolic"}function JM(e,t){if(t<0||t>=1)throw new x("eccentricity out of range.");const n=eB(e,t);return tB(n,t)}const ZM=50,$M=z.EPSILON8;function eB(e,t){if(t<0||t>=1)throw new x("eccentricity out of range.");const n=Math.floor(e/z.TWO_PI);e-=n*z.TWO_PI;let i,o=e+t*Math.sin(e)/(1-Math.sin(e+t)+Math.sin(e)),r=Number.MAX_VALUE;for(i=0;i<ZM&&Math.abs(r-o)>$M;++i){r=o;const n=r-t*Math.sin(r)-e,i=1-t*Math.cos(r);o=r-n/i}if(i>=ZM)throw new x("Kepler equation did not converge");return r=o+n*z.TWO_PI,r}function tB(e,t){if(t<0||t>=1)throw new x("eccentricity out of range.");const n=Math.floor(e/z.TWO_PI);e-=n*z.TWO_PI;const i=Math.cos(e)-t,o=Math.sin(e)*Math.sqrt(1-t*t);let r=Math.atan2(o,i);return r=z.zeroToTwoPi(r),e<0&&(r-=z.TWO_PI),r+=n*z.TWO_PI,r}function nB(e,t,n,i){if(t<0||t>z.PI)throw new x("inclination out of range");const o=Math.cos(e),r=Math.sin(e),s=Math.cos(t),a=Math.sin(t),c=Math.cos(n),l=Math.sin(n);return C(i)?(i[0]=c*o-l*r*s,i[1]=l*o+c*r*s,i[2]=r*a,i[3]=-c*r-l*o*s,i[4]=-l*r+c*o*s,i[5]=o*a,i[6]=l*a,i[7]=-c*a,i[8]=s):i=new ke(c*o-l*r*s,-c*r-l*o*s,l*a,l*o+c*r*s,-l*r+c*o*s,-c*a,r*a,o*a,s),i}const iB=1.0000010178*YM,oB=100.46645683*qM,rB=1295977422.83429*jM,sB=16002,aB=21863,cB=32004,lB=10931,uB=14529,hB=16368,dB=15318,fB=32794,pB=64*1e-7*YM,mB=1e-7*-152*YM,_B=62*1e-7*YM,gB=-8e-7*YM,yB=32*1e-7*YM,vB=1e-7*-41*YM,bB=19*1e-7*YM,AB=1e-7*-11*YM,wB=1e-7*-150*YM,TB=1e-7*-46*YM,CB=68*1e-7*YM,EB=54*1e-7*YM,xB=14*1e-7*YM,SB=24*1e-7*YM,IB=1e-7*-28*YM,OB=22*1e-7*YM,DB=10,PB=16002,RB=21863,LB=10931,MB=1473,BB=32004,NB=4387,FB=73,zB=1e-7*-325,kB=1e-7*-322,UB=1e-7*-79,VB=232*1e-7,HB=1e-7*-52,GB=97*1e-7,WB=55*1e-7,qB=1e-7*-41,jB=1e-7*-105,YB=1e-7*-137,KB=258*1e-7,XB=35*1e-7,QB=1e-7*-116,JB=1e-7*-88,ZB=1e-7*-112,$B=1e-7*-80,eN=new Ea(0,0,ia.TAI);function tN(e,t){HM(e,eN);const n=eN.dayNumber-GM.dayNumber+(eN.secondsOfDay-GM.secondsOfDay)/ta.SECONDS_PER_DAY,i=n/(10*ta.DAYS_PER_JULIAN_CENTURY),o=.3595362*i,r=iB+pB*Math.cos(sB*o)+wB*Math.sin(sB*o)+mB*Math.cos(aB*o)+TB*Math.sin(aB*o)+_B*Math.cos(cB*o)+CB*Math.sin(cB*o)+gB*Math.cos(lB*o)+EB*Math.sin(lB*o)+yB*Math.cos(uB*o)+xB*Math.sin(uB*o)+vB*Math.cos(hB*o)+SB*Math.sin(hB*o)+bB*Math.cos(dB*o)+IB*Math.sin(dB*o)+AB*Math.cos(fB*o)+OB*Math.sin(fB*o),s=oB+rB*i+zB*Math.cos(DB*o)+jB*Math.sin(DB*o)+kB*Math.cos(PB*o)+YB*Math.sin(PB*o)+UB*Math.cos(RB*o)+KB*Math.sin(RB*o)+VB*Math.cos(LB*o)+XB*Math.sin(LB*o)+HB*Math.cos(MB*o)+QB*Math.sin(MB*o)+GB*Math.cos(BB*o)+JB*Math.sin(BB*o)+WB*Math.cos(NB*o)+ZB*Math.sin(NB*o)+qB*Math.cos(FB*o)+$B*Math.sin(FB*o),a=.0167086342-.0004203654*i,c=102.93734808*qM+11612.3529*jM*i,l=469.97289*jM*i,u=174.87317577*qM-8679.27034*jM*i;return XM(r,a,l,c,u,s,t)}function nN(e,t){HM(e,eN);const n=eN.dayNumber-GM.dayNumber+(eN.secondsOfDay-GM.secondsOfDay)/ta.SECONDS_PER_DAY,i=n/ta.DAYS_PER_JULIAN_CENTURY,o=i*i,r=o*i,s=r*i;let a=383397.7725+.004*i,c=.055545526-16e-9*i;const l=5.15668983*qM;let u=-8e-5*i+.02966*o-42e-6*r-13e-8*s;const h=83.35324312*qM;let d=14643420.2669*i-38.2702*o-.045047*r+21301e-8*s;const f=125.04455501*qM;let p=-6967919.3631*i+6.3602*o+.007625*r-3586e-8*s;const m=218.31664563*qM;let _=1732559343.4847*i-6.391*o+.006588*r-3169e-8*s;const g=297.85019547*qM+jM*(1602961601.209*i-6.3706*o+.006593*r-3169e-8*s),y=93.27209062*qM+jM*(1739527262.8478*i-12.7512*o-.001037*r+417e-8*s),v=134.96340251*qM+jM*(1717915923.2178*i+31.8792*o+.051635*r-2447e-7*s),b=357.52910918*qM+jM*(129596581.0481*i-.5532*o+136e-6*r-1149e-8*s),A=310.17137918*qM-jM*(6967051.436*i+6.2068*o+.007618*r-3219e-8*s),w=2*g,T=4*g,C=6*g,E=2*v,x=3*v,S=4*v,I=2*y;a+=3400.4*Math.cos(w)-635.6*Math.cos(w-v)-235.6*Math.cos(v)+218.1*Math.cos(w-b)+181*Math.cos(w+v),c+=.014216*Math.cos(w-v)+.008551*Math.cos(w-E)-.001383*Math.cos(v)+.001356*Math.cos(w+v)-.001147*Math.cos(T-x)-914e-6*Math.cos(T-E)+869e-6*Math.cos(w-b-v)-627e-6*Math.cos(w)-394e-6*Math.cos(T-S)+282e-6*Math.cos(w-b-E)-279e-6*Math.cos(g-v)-236e-6*Math.cos(E)+231e-6*Math.cos(T)+229e-6*Math.cos(C-S)-201e-6*Math.cos(E-I),u+=486.26*Math.cos(w-I)-40.13*Math.cos(w)+37.51*Math.cos(I)+25.73*Math.cos(E-I)+19.97*Math.cos(w-b-I),d+=-55609*Math.sin(w-v)-34711*Math.sin(w-E)-9792*Math.sin(v)+9385*Math.sin(T-x)+7505*Math.sin(T-E)+5318*Math.sin(w+v)+3484*Math.sin(T-S)-3417*Math.sin(w-b-v)-2530*Math.sin(C-S)-2376*Math.sin(w)-2075*Math.sin(w-x)-1883*Math.sin(E)-1736*Math.sin(C-5*v)+1626*Math.sin(b)-1370*Math.sin(C-x),p+=-5392*Math.sin(w-I)-540*Math.sin(b)-441*Math.sin(w)+423*Math.sin(I)-288*Math.sin(E-I),_+=-3332.9*Math.sin(w)+1197.4*Math.sin(w-v)-662.5*Math.sin(b)+396.3*Math.sin(v)-218*Math.sin(w-b);const O=2*A,D=3*A;u+=46.997*Math.cos(A)*i-.614*Math.cos(w-I+A)*i+.614*Math.cos(w-I-A)*i-.0297*Math.cos(O)*o-.0335*Math.cos(A)*o+.0012*Math.cos(w-I+O)*o-16e-5*Math.cos(A)*r+4e-5*Math.cos(D)*r+4e-5*Math.cos(O)*r;const P=2.116*Math.sin(A)*i-.111*Math.sin(w-I-A)*i-.0015*Math.sin(A)*o;d+=P,_+=P,p+=-520.77*Math.sin(A)*i+13.66*Math.sin(w-I+A)*i+1.12*Math.sin(w-A)*i-1.06*Math.sin(I-A)*i+.66*Math.sin(O)*o+.371*Math.sin(A)*o-.035*Math.sin(w-I+O)*o-.015*Math.sin(w-I+A)*o+.0014*Math.sin(A)*r-.0011*Math.sin(D)*r-9e-4*Math.sin(O)*r,a*=WM;const R=l+u*jM,L=h+d*jM,M=m+_*jM,B=f+p*jM;return XM(a,c,R,L,B,M,t)}const iN=.012300034,oN=iN/(iN+1)*-1;function rN(e,t){return t=nN(e,t),K.multiplyByScalar(t,oN,t)}const sN=new ke(1.0000000000000002,5619723173785822e-31,4690511510146299e-34,-5154129427414611e-31,.9174820620691819,-.39777715593191376,-223970096136568e-30,.39777715593191376,.9174820620691819);let aN=new K;zM.computeSunPositionInEarthInertialFrame=function(e,t){return C(e)||(e=Ea.now()),C(t)||(t=new K),aN=tN(e,aN),t=K.negate(aN,t),rN(e,aN),K.subtract(t,aN,t),ke.multiplyByVector(sN,t,t),t},zM.computeMoonPositionInEarthInertialFrame=function(e,t){return C(e)||(e=Ea.now()),t=nN(e,t),ke.multiplyByVector(sN,t,t),t};var cN=zM;function lN(e,t,n,i,o,r,s){const a=AA.numberOfPoints(e,t,o);let c;const l=n.red,u=n.green,h=n.blue,d=n.alpha,f=i.red,p=i.green,m=i.blue,_=i.alpha;if(xy.equals(n,i)){for(c=0;c<a;c++)r[s++]=xy.floatToByte(l),r[s++]=xy.floatToByte(u),r[s++]=xy.floatToByte(h),r[s++]=xy.floatToByte(d);return s}const g=(f-l)/a,y=(p-u)/a,v=(m-h)/a,b=(_-d)/a;let A=s;for(c=0;c<a;c++)r[A++]=xy.floatToByte(l+c*g),r[A++]=xy.floatToByte(u+c*y),r[A++]=xy.floatToByte(h+c*v),r[A++]=xy.floatToByte(d+c*b);return A}function uN(e){e=R(e,R.EMPTY_OBJECT);const t=e.positions,n=e.colors,i=R(e.colorsPerVertex,!1);if(!C(t)||t.length<2)throw new x("At least two positions are required.");if(C(n)&&(i&&n.length<t.length||!i&&n.length<t.length-1))throw new x("colors has an invalid length.");this._positions=t,this._colors=n,this._colorsPerVertex=i,this._arcType=R(e.arcType,hf.GEODESIC),this._granularity=R(e.granularity,z.RADIANS_PER_DEGREE),this._ellipsoid=R(e.ellipsoid,ge.WGS84),this._workerName="createSimplePolylineGeometry";let o=1+t.length*K.packedLength;o+=C(n)?1+n.length*xy.packedLength:1,this.packedLength=o+ge.packedLength+3}uN.pack=function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");let i;n=R(n,0);const o=e._positions;let r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=K.packedLength)K.pack(o[i],t,n);const s=e._colors;for(r=C(s)?s.length:0,t[n++]=r,i=0;i<r;++i,n+=xy.packedLength)xy.pack(s[i],t,n);return ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,t[n++]=e._colorsPerVertex?1:0,t[n++]=e._arcType,t[n]=e._granularity,t},uN.unpack=function(e,t,n){if(!C(e))throw new x("array is required");let i;t=R(t,0);let o=e[t++];const r=new Array(o);for(i=0;i<o;++i,t+=K.packedLength)r[i]=K.unpack(e,t);o=e[t++];const s=o>0?new Array(o):void 0;for(i=0;i<o;++i,t+=xy.packedLength)s[i]=xy.unpack(e,t);const a=ge.unpack(e,t);t+=ge.packedLength;const c=1===e[t++],l=e[t++],u=e[t];return C(n)?(n._positions=r,n._colors=s,n._ellipsoid=a,n._colorsPerVertex=c,n._arcType=l,n._granularity=u,n):new uN({positions:r,colors:s,ellipsoid:a,colorsPerVertex:c,arcType:l,granularity:u})};const hN=new Array(2),dN=new Array(2),fN={positions:hN,height:dN,ellipsoid:void 0,minDistance:void 0,granularity:void 0};uN.createGeometry=function(e){const t=e._positions,n=e._colors,i=e._colorsPerVertex,o=e._arcType,r=e._granularity,s=e._ellipsoid,a=z.chordLength(r,s.maximumRadius),c=C(n)&&!i;let l;const u=t.length;let h,d,f,p,m=0;if(o===hf.GEODESIC||o===hf.RHUMB){let e,i,d;o===hf.GEODESIC?(e=z.chordLength(r,s.maximumRadius),i=AA.numberOfPoints,d=AA.generateArc):(e=r,i=AA.numberOfPointsRhumbLine,d=AA.generateRhumbArc);const _=AA.extractHeights(t,s),g=fN;if(o===hf.GEODESIC?g.minDistance=a:g.granularity=r,g.ellipsoid=s,c){let o=0;for(l=0;l<u-1;l++)o+=i(t[l],t[l+1],e)+1;h=new Float64Array(3*o),f=new Uint8Array(4*o),g.positions=hN,g.height=dN;let r=0;for(l=0;l<u-1;++l){hN[0]=t[l],hN[1]=t[l+1],dN[0]=_[l],dN[1]=_[l+1];const e=d(g);if(C(n)){const t=e.length/3;p=n[l];for(let e=0;e<t;++e)f[r++]=xy.floatToByte(p.red),f[r++]=xy.floatToByte(p.green),f[r++]=xy.floatToByte(p.blue),f[r++]=xy.floatToByte(p.alpha)}h.set(e,m),m+=e.length}}else if(g.positions=t,g.height=_,h=new Float64Array(d(g)),C(n)){for(f=new Uint8Array(h.length/3*4),l=0;l<u-1;++l){const e=t[l],i=t[l+1],o=n[l],r=n[l+1];m=lN(e,i,o,r,a,f,m)}const e=n[u-1];f[m++]=xy.floatToByte(e.red),f[m++]=xy.floatToByte(e.green),f[m++]=xy.floatToByte(e.blue),f[m++]=xy.floatToByte(e.alpha)}}else{d=c?2*u-2:u,h=new Float64Array(3*d),f=C(n)?new Uint8Array(4*d):void 0;let e=0,i=0;for(l=0;l<u;++l){const o=t[l];if(c&&l>0&&(K.pack(o,h,e),e+=3,p=n[l-1],f[i++]=xy.floatToByte(p.red),f[i++]=xy.floatToByte(p.green),f[i++]=xy.floatToByte(p.blue),f[i++]=xy.floatToByte(p.alpha)),c&&l===u-1)break;K.pack(o,h,e),e+=3,C(n)&&(p=n[l],f[i++]=xy.floatToByte(p.red),f[i++]=xy.floatToByte(p.green),f[i++]=xy.floatToByte(p.blue),f[i++]=xy.floatToByte(p.alpha))}}const _=new Hf;_.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:h}),C(n)&&(_.color=new Uf({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:4,values:f,normalize:!0})),d=h.length/3;const g=2*(d-1),y=fd.createTypedArray(d,g);let v=0;for(l=0;l<d-1;++l)y[v++]=l,y[v++]=l+1;return new zf({attributes:_,indices:y,primitiveType:xf.LINES,boundingSphere:nn.fromPoints(t)})};function pN(e){const t=R(e.radius,1),n=new K(t,t,t),i={radii:n,stackPartitions:e.stackPartitions,slicePartitions:e.slicePartitions,vertexFormat:e.vertexFormat};this._ellipsoidGeometry=new bC(i),this._workerName="createSphereGeometry"}pN.packedLength=bC.packedLength,pN.pack=function(e,t,n){return D.typeOf.object("value",e),bC.pack(e._ellipsoidGeometry,t,n)};const mN=new bC,_N={radius:void 0,radii:new K,vertexFormat:new jf,stackPartitions:void 0,slicePartitions:void 0};pN.unpack=function(e,t,n){const i=bC.unpack(e,t,mN);return _N.vertexFormat=jf.clone(i._vertexFormat,_N.vertexFormat),_N.stackPartitions=i._stackPartitions,_N.slicePartitions=i._slicePartitions,C(n)?(K.clone(i._radii,_N.radii),n._ellipsoidGeometry=new bC(_N),n):(_N.radius=i._radii.x,new pN(_N))},pN.createGeometry=function(e){return bC.createGeometry(e._ellipsoidGeometry)};function gN(e){const t=R(e.radius,1),n=new K(t,t,t),i={radii:n,stackPartitions:e.stackPartitions,slicePartitions:e.slicePartitions,subdivisions:e.subdivisions};this._ellipsoidGeometry=new IC(i),this._workerName="createSphereOutlineGeometry"}gN.packedLength=IC.packedLength,gN.pack=function(e,t,n){return D.typeOf.object("value",e),IC.pack(e._ellipsoidGeometry,t,n)};const yN=new IC,vN={radius:void 0,radii:new K,stackPartitions:void 0,slicePartitions:void 0,subdivisions:void 0};gN.unpack=function(e,t,n){const i=IC.unpack(e,t,yN);return vN.stackPartitions=i._stackPartitions,vN.slicePartitions=i._slicePartitions,vN.subdivisions=i._subdivisions,C(n)?(K.clone(i._radii,vN.radii),n._ellipsoidGeometry=new IC(vN),n):(vN.radius=i._radii.x,new gN(vN))},gN.createGeometry=function(e){return IC.createGeometry(e._ellipsoidGeometry)};var bN=gN;function AN(e,t,n){this.clock=R(e,0),this.cone=R(t,0),this.magnitude=R(n,1)}AN.fromCartesian3=function(e,t){D.typeOf.object("cartesian3",e);const n=e.x,i=e.y,o=e.z,r=n*n+i*i;return C(t)||(t=new AN),t.clock=Math.atan2(i,n),t.cone=Math.atan2(Math.sqrt(r),o),t.magnitude=Math.sqrt(r+o*o),t},AN.clone=function(e,t){if(C(e))return C(t)?(t.clock=e.clock,t.cone=e.cone,t.magnitude=e.magnitude,t):new AN(e.clock,e.cone,e.magnitude)},AN.normalize=function(e,t){return D.typeOf.object("spherical",e),C(t)?(t.clock=e.clock,t.cone=e.cone,t.magnitude=1,t):new AN(e.clock,e.cone,1)},AN.equals=function(e,t){return e===t||C(e)&&C(t)&&e.clock===t.clock&&e.cone===t.cone&&e.magnitude===t.magnitude},AN.equalsEpsilon=function(e,t,n){return n=R(n,0),e===t||C(e)&&C(t)&&Math.abs(e.clock-t.clock)<=n&&Math.abs(e.cone-t.cone)<=n&&Math.abs(e.magnitude-t.magnitude)<=n},AN.prototype.equals=function(e){return AN.equals(this,e)},AN.prototype.clone=function(e){return AN.clone(this,e)},AN.prototype.equalsEpsilon=function(e,t){return AN.equalsEpsilon(this,e,t)},AN.prototype.toString=function(){return`(${this.clock}, ${this.cone}, ${this.magnitude})`};var wN=AN;const TN={WEST:0,NORTH:1,EAST:2,SOUTH:3,NORTHWEST:4,NORTHEAST:5,SOUTHWEST:6,SOUTHEAST:7};var CN=TN;function EN(e){throw new x("This type should not be instantiated directly.  Instead, use WebMercatorTilingScheme or GeographicTilingScheme.")}Object.defineProperties(EN.prototype,{ellipsoid:{get:x.throwInstantiationError},rectangle:{get:x.throwInstantiationError},projection:{get:x.throwInstantiationError}}),EN.prototype.getNumberOfXTilesAtLevel=x.throwInstantiationError,EN.prototype.getNumberOfYTilesAtLevel=x.throwInstantiationError,EN.prototype.rectangleToNativeRectangle=x.throwInstantiationError,EN.prototype.tileXYToNativeRectangle=x.throwInstantiationError,EN.prototype.tileXYToRectangle=x.throwInstantiationError,EN.prototype.positionToTileXY=x.throwInstantiationError;function xN(e,t){return Ea.compare(e.start,t.start)}function SN(e){if(this._intervals=[],this._changedEvent=new $n,C(e)){const t=e.length;for(let n=0;n<t;n++)this.addInterval(e[n])}}Object.defineProperties(SN.prototype,{changedEvent:{get:function(){return this._changedEvent}},start:{get:function(){const e=this._intervals;return 0===e.length?void 0:e[0].start}},isStartIncluded:{get:function(){const e=this._intervals;return 0!==e.length&&e[0].isStartIncluded}},stop:{get:function(){const e=this._intervals,t=e.length;return 0===t?void 0:e[t-1].stop}},isStopIncluded:{get:function(){const e=this._intervals,t=e.length;return 0!==t&&e[t-1].isStopIncluded}},length:{get:function(){return this._intervals.length}},isEmpty:{get:function(){return 0===this._intervals.length}}}),SN.prototype.equals=function(e,t){if(this===e)return!0;if(!(e instanceof SN))return!1;const n=this._intervals,i=e._intervals,o=n.length;if(o!==i.length)return!1;for(let r=0;r<o;r++)if(!cO.equals(n[r],i[r],t))return!1;return!0},SN.prototype.get=function(e){if(!C(e))throw new x("index is required.");return this._intervals[e]},SN.prototype.removeAll=function(){this._intervals.length>0&&(this._intervals.length=0,this._changedEvent.raiseEvent(this))},SN.prototype.findIntervalContainingDate=function(e){const t=this.indexOf(e);return t>=0?this._intervals[t]:void 0},SN.prototype.findDataForIntervalContainingDate=function(e){const t=this.indexOf(e);return t>=0?this._intervals[t].data:void 0},SN.prototype.contains=function(e){return this.indexOf(e)>=0};const IN=new cO;SN.prototype.indexOf=function(e){if(!C(e))throw new x("date is required");const t=this._intervals;IN.start=e,IN.stop=e;let n=qs(t,IN,xN);return n>=0?t[n].isStartIncluded?n:n>0&&t[n-1].stop.equals(e)&&t[n-1].isStopIncluded?n-1:~n:(n=~n,n>0&&n-1<t.length&&cO.contains(t[n-1],e)?n-1:~n)},SN.prototype.findInterval=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.start,n=e.stop,i=e.isStartIncluded,o=e.isStopIncluded,r=this._intervals;for(let s=0,a=r.length;s<a;s++){const e=r[s];if((!C(t)||e.start.equals(t))&&(!C(n)||e.stop.equals(n))&&(!C(i)||e.isStartIncluded===i)&&(!C(o)||e.isStopIncluded===o))return r[s]}},SN.prototype.addInterval=function(e,t){if(!C(e))throw new x("interval is required");if(e.isEmpty)return;const n=this._intervals;if(0===n.length||Ea.greaterThan(e.start,n[n.length-1].stop))return n.push(e),void this._changedEvent.raiseEvent(this);let i,o=qs(n,e,xN);o<0?o=~o:o>0&&e.isStartIncluded&&n[o-1].isStartIncluded&&n[o-1].start.equals(e.start)?--o:o<n.length&&!e.isStartIncluded&&n[o].isStartIncluded&&n[o].start.equals(e.start)&&++o,o>0&&(i=Ea.compare(n[o-1].stop,e.start),(i>0||0===i&&(n[o-1].isStopIncluded||e.isStartIncluded))&&((C(t)?t(n[o-1].data,e.data):n[o-1].data===e.data)?(e=Ea.greaterThan(e.stop,n[o-1].stop)?new cO({start:n[o-1].start,stop:e.stop,isStartIncluded:n[o-1].isStartIncluded,isStopIncluded:e.isStopIncluded,data:e.data}):new cO({start:n[o-1].start,stop:n[o-1].stop,isStartIncluded:n[o-1].isStartIncluded,isStopIncluded:n[o-1].isStopIncluded||e.stop.equals(n[o-1].stop)&&e.isStopIncluded,data:e.data}),n.splice(o-1,1),--o):(i=Ea.compare(n[o-1].stop,e.stop),(i>0||0===i&&n[o-1].isStopIncluded&&!e.isStopIncluded)&&n.splice(o,0,new cO({start:e.stop,stop:n[o-1].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:n[o-1].isStopIncluded,data:n[o-1].data})),n[o-1]=new cO({start:n[o-1].start,stop:e.start,isStartIncluded:n[o-1].isStartIncluded,isStopIncluded:!e.isStartIncluded,data:n[o-1].data}))));while(o<n.length){if(i=Ea.compare(e.stop,n[o].start),!(i>0||0===i&&(e.isStopIncluded||n[o].isStartIncluded)))break;if(C(t)?t(n[o].data,e.data):n[o].data===e.data)e=new cO({start:e.start,stop:Ea.greaterThan(n[o].stop,e.stop)?n[o].stop:e.stop,isStartIncluded:e.isStartIncluded,isStopIncluded:Ea.greaterThan(n[o].stop,e.stop)?n[o].isStopIncluded:e.isStopIncluded,data:e.data}),n.splice(o,1);else{if(n[o]=new cO({start:e.stop,stop:n[o].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:n[o].isStopIncluded,data:n[o].data}),!n[o].isEmpty)break;n.splice(o,1)}}n.splice(o,0,e),this._changedEvent.raiseEvent(this)},SN.prototype.removeInterval=function(e){if(!C(e))throw new x("interval is required");if(e.isEmpty)return!1;const t=this._intervals;let n=qs(t,e,xN);n<0&&(n=~n);let i=!1;n>0&&(Ea.greaterThan(t[n-1].stop,e.start)||t[n-1].stop.equals(e.start)&&t[n-1].isStopIncluded&&e.isStartIncluded)&&(i=!0,(Ea.greaterThan(t[n-1].stop,e.stop)||t[n-1].isStopIncluded&&!e.isStopIncluded&&t[n-1].stop.equals(e.stop))&&t.splice(n,0,new cO({start:e.stop,stop:t[n-1].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:t[n-1].isStopIncluded,data:t[n-1].data})),t[n-1]=new cO({start:t[n-1].start,stop:e.start,isStartIncluded:t[n-1].isStartIncluded,isStopIncluded:!e.isStartIncluded,data:t[n-1].data})),n<t.length&&!e.isStartIncluded&&t[n].isStartIncluded&&e.start.equals(t[n].start)&&(i=!0,t.splice(n,0,new cO({start:t[n].start,stop:t[n].start,isStartIncluded:!0,isStopIncluded:!0,data:t[n].data})),++n);while(n<t.length&&Ea.greaterThan(e.stop,t[n].stop))i=!0,t.splice(n,1);return n<t.length&&e.stop.equals(t[n].stop)&&(i=!0,!e.isStopIncluded&&t[n].isStopIncluded?n+1<t.length&&t[n+1].start.equals(e.stop)&&t[n].data===t[n+1].data?(t.splice(n,1),t[n]=new cO({start:t[n].start,stop:t[n].stop,isStartIncluded:!0,isStopIncluded:t[n].isStopIncluded,data:t[n].data})):t[n]=new cO({start:e.stop,stop:e.stop,isStartIncluded:!0,isStopIncluded:!0,data:t[n].data}):t.splice(n,1)),n<t.length&&(Ea.greaterThan(e.stop,t[n].start)||e.stop.equals(t[n].start)&&e.isStopIncluded&&t[n].isStartIncluded)&&(i=!0,t[n]=new cO({start:e.stop,stop:t[n].stop,isStartIncluded:!e.isStopIncluded,isStopIncluded:t[n].isStopIncluded,data:t[n].data})),i&&this._changedEvent.raiseEvent(this),i},SN.prototype.intersect=function(e,t,n){if(!C(e))throw new x("other is required.");const i=new SN;let o=0,r=0;const s=this._intervals,a=e._intervals;while(o<s.length&&r<a.length){const e=s[o],c=a[r];if(Ea.lessThan(e.stop,c.start))++o;else if(Ea.lessThan(c.stop,e.start))++r;else{if(C(n)||C(t)&&t(e.data,c.data)||!C(t)&&c.data===e.data){const o=cO.intersect(e,c,new cO,n);o.isEmpty||i.addInterval(o,t)}Ea.lessThan(e.stop,c.stop)||e.stop.equals(c.stop)&&!e.isStopIncluded&&c.isStopIncluded?++o:++r}}return i},SN.fromJulianDateArray=function(e,t){if(!C(e))throw new x("options is required.");if(!C(e.julianDates))throw new x("options.iso8601Array is required.");C(t)||(t=new SN);const n=e.julianDates,i=n.length,o=e.dataCallback,r=R(e.isStartIncluded,!0),s=R(e.isStopIncluded,!0),a=R(e.leadingInterval,!1),c=R(e.trailingInterval,!1);let l,u=0;a&&(++u,l=new cO({start:fO.MINIMUM_VALUE,stop:n[0],isStartIncluded:!0,isStopIncluded:!r}),l.data=C(o)?o(l,t.length):t.length,t.addInterval(l));for(let h=0;h<i-1;++h){let e=n[h];const a=n[h+1];l=new cO({start:e,stop:a,isStartIncluded:t.length!==u||r,isStopIncluded:h===i-2&&s}),l.data=C(o)?o(l,t.length):t.length,t.addInterval(l),e=a}return c&&(l=new cO({start:n[i-1],stop:fO.MAXIMUM_VALUE,isStartIncluded:!s,isStopIncluded:!0}),l.data=C(o)?o(l,t.length):t.length,t.addInterval(l)),t};const ON=new Xs,DN=[0,31,28,31,30,31,30,31,31,30,31,30,31];function PN(e,t,n){C(n)||(n=new Ea),Ea.toGregorianDate(e,ON);let i=ON.millisecond+t.millisecond,o=ON.second+t.second,r=ON.minute+t.minute,s=ON.hour+t.hour,a=ON.day+t.day,c=ON.month+t.month,l=ON.year+t.year;i>=1e3&&(o+=Math.floor(i/1e3),i%=1e3),o>=60&&(r+=Math.floor(o/60),o%=60),r>=60&&(s+=Math.floor(r/60),r%=60),s>=24&&(a+=Math.floor(s/24),s%=24),DN[2]=Js(l)?29:28;while(a>DN[c]||c>=13)a>DN[c]&&(a-=DN[c],++c),c>=13&&(--c,l+=Math.floor(c/12),c%=12,++c),DN[2]=Js(l)?29:28;return ON.millisecond=i,ON.second=o,ON.minute=r,ON.hour=s,ON.day=a,ON.month=c,ON.year=l,Ea.fromGregorianDate(ON,n)}const RN=new Ea,LN=/P(?:([\d.,]+)Y)?(?:([\d.,]+)M)?(?:([\d.,]+)W)?(?:([\d.,]+)D)?(?:T(?:([\d.,]+)H)?(?:([\d.,]+)M)?(?:([\d.,]+)S)?)?/;function MN(e,t){if(!C(e)||0===e.length)return!1;if(t.year=0,t.month=0,t.day=0,t.hour=0,t.minute=0,t.second=0,t.millisecond=0,"P"===e[0]){const n=e.match(LN);if(!C(n))return!1;if(C(n[1])&&(t.year=Number(n[1].replace(",","."))),C(n[2])&&(t.month=Number(n[2].replace(",","."))),C(n[3])&&(t.day=7*Number(n[3].replace(",","."))),C(n[4])&&(t.day+=Number(n[4].replace(",","."))),C(n[5])&&(t.hour=Number(n[5].replace(",","."))),C(n[6])&&(t.minute=Number(n[6].replace(",","."))),C(n[7])){const e=Number(n[7].replace(",","."));t.second=Math.floor(e),t.millisecond=e%1*1e3}}else"Z"!==e[e.length-1]&&(e+="Z"),Ea.toGregorianDate(Ea.fromIso8601(e,RN),t);return t.year||t.month||t.day||t.hour||t.minute||t.second||t.millisecond}const BN=new Xs;SN.fromIso8601=function(e,t){if(!C(e))throw new x("options is required.");if(!C(e.iso8601))throw new x("options.iso8601 is required.");const n=e.iso8601.split("/"),i=Ea.fromIso8601(n[0]),o=Ea.fromIso8601(n[1]),r=[];if(MN(n[2],BN)){let e=Ea.clone(i);r.push(e);while(Ea.compare(e,o)<0){e=PN(e,BN);const t=Ea.compare(o,e)<=0;t&&Ea.clone(o,e),r.push(e)}}else r.push(i,o);return SN.fromJulianDateArray({julianDates:r,isStartIncluded:e.isStartIncluded,isStopIncluded:e.isStopIncluded,leadingInterval:e.leadingInterval,trailingInterval:e.trailingInterval,dataCallback:e.dataCallback},t)},SN.fromIso8601DateArray=function(e,t){if(!C(e))throw new x("options is required.");if(!C(e.iso8601Dates))throw new x("options.iso8601Dates is required.");return SN.fromJulianDateArray({julianDates:e.iso8601Dates.map((function(e){return Ea.fromIso8601(e)})),isStartIncluded:e.isStartIncluded,isStopIncluded:e.isStopIncluded,leadingInterval:e.leadingInterval,trailingInterval:e.trailingInterval,dataCallback:e.dataCallback},t)},SN.fromIso8601DurationArray=function(e,t){if(!C(e))throw new x("options is required.");if(!C(e.epoch))throw new x("options.epoch is required.");if(!C(e.iso8601Durations))throw new x("options.iso8601Durations is required.");const n=e.epoch,i=e.iso8601Durations,o=R(e.relativeToPrevious,!1),r=[];let s,a;const c=i.length;for(let l=0;l<c;++l)(MN(i[l],BN)||0===l)&&(s=o&&C(a)?PN(a,BN):PN(n,BN),r.push(s),a=s);return SN.fromJulianDateArray({julianDates:r,isStartIncluded:e.isStartIncluded,isStopIncluded:e.isStopIncluded,leadingInterval:e.leadingInterval,trailingInterval:e.trailingInterval,dataCallback:e.dataCallback},t)};var NN=SN;const FN=new K(1,1,1),zN=K.ZERO,kN=il.IDENTITY;function UN(e,t,n){this.translation=K.clone(R(e,zN)),this.rotation=il.clone(R(t,kN)),this.scale=K.clone(R(n,FN))}UN.prototype.equals=function(e){return this===e||C(e)&&K.equals(this.translation,e.translation)&&il.equals(this.rotation,e.rotation)&&K.equals(this.scale,e.scale)};var VN=UN;function HN(e,t){this.rectangle=e,this.maxLevel=t}function GN(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.url))throw new x("options.url is required.");const t=Vi.createIfNeeded(e.url);this._resource=t,this._errorEvent=new $n,this._ready=!1,this._readyPromise=yn(),this._terrainDataStructure={heightScale:.001,heightOffset:-1e3,elementsPerHeight:3,stride:4,elementMultiplier:256,isBigEndian:!0,lowestEncodedHeight:0,highestEncodedHeight:16777215};let n=e.credit;"string"===typeof n&&(n=new Tr(n)),this._credit=n,this._tilingScheme=void 0,this._rectangles=[];const i=this;let o;const r=R(e.ellipsoid,ge.WGS84);function s(e){const t=e.getElementsByTagName("SRS")[0].textContent;if("EPSG:4326"!==t)return void a(`SRS ${t} is not supported.`);i._tilingScheme=new ao({ellipsoid:r});const n=e.getElementsByTagName("TileFormat")[0];i._heightmapWidth=parseInt(n.getAttribute("width"),10),i._heightmapHeight=parseInt(n.getAttribute("height"),10),i._levelZeroMaximumGeometricError=Ad.getEstimatedLevelZeroGeometricErrorForAHeightmap(r,Math.min(i._heightmapWidth,i._heightmapHeight),i._tilingScheme.getNumberOfXTilesAtLevel(0));const o=e.getElementsByTagName("DataExtent");for(let r=0;r<o.length;++r){const e=o[r],t=z.toRadians(parseFloat(e.getAttribute("minx"))),n=z.toRadians(parseFloat(e.getAttribute("miny"))),s=z.toRadians(parseFloat(e.getAttribute("maxx"))),a=z.toRadians(parseFloat(e.getAttribute("maxy"))),c=parseInt(e.getAttribute("maxlevel"),10);i._rectangles.push(new HN(new _t(t,n,s,a),c))}i._ready=!0,i._readyPromise.resolve(!0)}function a(e){const t=R(e,`An error occurred while accessing ${i._resource.url}.`);o=ef.handleError(o,i,i._errorEvent,t,void 0,void 0,void 0,c)}function c(){i._resource.fetchXML().then(s).catch(a)}c()}Object.defineProperties(GN.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){if(!this.ready)throw new x("requestTileGeometry must not be called before ready returns true.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){}}}),GN.prototype.requestTileGeometry=function(e,t,n,i){if(!this.ready)throw new x("requestTileGeometry must not be called before ready returns true.");const o=this._tilingScheme.getNumberOfYTilesAtLevel(n),r=this._resource.getDerivedResource({url:`${n}/${e}/${o-t-1}.tif`,queryParameters:{cesium:!0},request:i}),s=r.fetchImage({preferImageBitmap:!0});if(!C(s))return;const a=this;return Promise.resolve(s).then((function(i){return new Pd({buffer:En(i),width:a._heightmapWidth,height:a._heightmapHeight,childTileMask:qN(a,e,t,n),structure:a._terrainDataStructure})}))},GN.prototype.getLevelMaximumGeometricError=function(e){if(!this.ready)throw new x("requestTileGeometry must not be called before ready returns true.");return this._levelZeroMaximumGeometricError/(1<<e)};const WN=new _t;function qN(e,t,n,i){const o=e._tilingScheme,r=e._rectangles,s=o.tileXYToRectangle(t,n,i);let a=0;for(let c=0;c<r.length&&15!==a;++c){const e=r[c];if(e.maxLevel<=i)continue;const l=e.rectangle,u=_t.intersection(l,s,WN);C(u)&&(jN(o,l,2*t,2*n,i+1)&&(a|=4),jN(o,l,2*t+1,2*n,i+1)&&(a|=8),jN(o,l,2*t,2*n+1,i+1)&&(a|=1),jN(o,l,2*t+1,2*n+1,i+1)&&(a|=2))}return a}function jN(e,t,n,i,o){const r=e.tileXYToRectangle(n,i,o);return C(_t.intersection(r,t,WN))}GN.prototype.getTileDataAvailable=function(e,t,n){},GN.prototype.loadTileDataAvailability=function(e,t,n){};function YN(e){e=R(e,R.EMPTY_OBJECT),this._clock=void 0,this._element=void 0,this._clockSubscription=void 0,this._seekFunction=void 0,this._lastPlaybackRate=void 0,this.clock=e.clock,this.element=e.element,this.epoch=R(e.epoch,fO.MINIMUM_VALUE),this.tolerance=R(e.tolerance,1),this._seeking=!1,this._seekFunction=void 0,this._firstTickAfterSeek=!1}function KN(e){return function(){e._seeking=!1,e._firstTickAfterSeek=!0}}Object.defineProperties(YN.prototype,{clock:{get:function(){return this._clock},set:function(e){const t=this._clock;t!==e&&(C(t)&&(this._clockSubscription(),this._clockSubscription=void 0),C(e)&&(this._clockSubscription=e.onTick.addEventListener(YN.prototype._onTick,this)),this._clock=e)}},element:{get:function(){return this._element},set:function(e){const t=this._element;t!==e&&(C(t)&&t.removeEventListener("seeked",this._seekFunction,!1),C(e)&&(this._seeking=!1,this._seekFunction=KN(this),e.addEventListener("seeked",this._seekFunction,!1)),this._element=e,this._seeking=!1,this._firstTickAfterSeek=!1)}}}),YN.prototype.destroy=function(){return this.element=void 0,this.clock=void 0,Qh(this)},YN.prototype.isDestroyed=function(){return!1},YN.prototype._trySetPlaybackRate=function(e){if(this._lastPlaybackRate===e.multiplier)return;const t=this._element;try{t.playbackRate=e.multiplier}catch(n){t.playbackRate=0}this._lastPlaybackRate=e.multiplier},YN.prototype._onTick=function(e){const t=this._element;if(!C(t)||t.readyState<2)return;const n=t.paused,i=e.shouldAnimate;if(i===n&&(i?t.play():t.pause()),this._seeking||this._firstTickAfterSeek)return void(this._firstTickAfterSeek=!1);this._trySetPlaybackRate(e);const o=e.currentTime,r=R(this.epoch,fO.MINIMUM_VALUE);let s=Ea.secondsDifference(o,r);const a=t.duration;let c;const l=t.currentTime;t.loop?(s%=a,s<0&&(s=a-s),c=s):c=s>a?a:s<0?0:s;const u=i?R(this.tolerance,1):.001;Math.abs(c-l)>u&&(this._seeking=!0,t.currentTime=c)};const XN={VK_FORMAT_UNDEFINED:0,VK_FORMAT_R4G4_UNORM_PACK8:1,VK_FORMAT_R4G4B4A4_UNORM_PACK16:2,VK_FORMAT_B4G4R4A4_UNORM_PACK16:3,VK_FORMAT_R5G6B5_UNORM_PACK16:4,VK_FORMAT_B5G6R5_UNORM_PACK16:5,VK_FORMAT_R5G5B5A1_UNORM_PACK16:6,VK_FORMAT_B5G5R5A1_UNORM_PACK16:7,VK_FORMAT_A1R5G5B5_UNORM_PACK16:8,VK_FORMAT_R8_UNORM:9,VK_FORMAT_R8_SNORM:10,VK_FORMAT_R8_USCALED:11,VK_FORMAT_R8_SSCALED:12,VK_FORMAT_R8_UINT:13,VK_FORMAT_R8_SINT:14,VK_FORMAT_R8_SRGB:15,VK_FORMAT_R8G8_UNORM:16,VK_FORMAT_R8G8_SNORM:17,VK_FORMAT_R8G8_USCALED:18,VK_FORMAT_R8G8_SSCALED:19,VK_FORMAT_R8G8_UINT:20,VK_FORMAT_R8G8_SINT:21,VK_FORMAT_R8G8_SRGB:22,VK_FORMAT_R8G8B8_UNORM:23,VK_FORMAT_R8G8B8_SNORM:24,VK_FORMAT_R8G8B8_USCALED:25,VK_FORMAT_R8G8B8_SSCALED:26,VK_FORMAT_R8G8B8_UINT:27,VK_FORMAT_R8G8B8_SINT:28,VK_FORMAT_R8G8B8_SRGB:29,VK_FORMAT_B8G8R8_UNORM:30,VK_FORMAT_B8G8R8_SNORM:31,VK_FORMAT_B8G8R8_USCALED:32,VK_FORMAT_B8G8R8_SSCALED:33,VK_FORMAT_B8G8R8_UINT:34,VK_FORMAT_B8G8R8_SINT:35,VK_FORMAT_B8G8R8_SRGB:36,VK_FORMAT_R8G8B8A8_UNORM:37,VK_FORMAT_R8G8B8A8_SNORM:38,VK_FORMAT_R8G8B8A8_USCALED:39,VK_FORMAT_R8G8B8A8_SSCALED:40,VK_FORMAT_R8G8B8A8_UINT:41,VK_FORMAT_R8G8B8A8_SINT:42,VK_FORMAT_R8G8B8A8_SRGB:43,VK_FORMAT_B8G8R8A8_UNORM:44,VK_FORMAT_B8G8R8A8_SNORM:45,VK_FORMAT_B8G8R8A8_USCALED:46,VK_FORMAT_B8G8R8A8_SSCALED:47,VK_FORMAT_B8G8R8A8_UINT:48,VK_FORMAT_B8G8R8A8_SINT:49,VK_FORMAT_B8G8R8A8_SRGB:50,VK_FORMAT_A8B8G8R8_UNORM_PACK32:51,VK_FORMAT_A8B8G8R8_SNORM_PACK32:52,VK_FORMAT_A8B8G8R8_USCALED_PACK32:53,VK_FORMAT_A8B8G8R8_SSCALED_PACK32:54,VK_FORMAT_A8B8G8R8_UINT_PACK32:55,VK_FORMAT_A8B8G8R8_SINT_PACK32:56,VK_FORMAT_A8B8G8R8_SRGB_PACK32:57,VK_FORMAT_A2R10G10B10_UNORM_PACK32:58,VK_FORMAT_A2R10G10B10_SNORM_PACK32:59,VK_FORMAT_A2R10G10B10_USCALED_PACK32:60,VK_FORMAT_A2R10G10B10_SSCALED_PACK32:61,VK_FORMAT_A2R10G10B10_UINT_PACK32:62,VK_FORMAT_A2R10G10B10_SINT_PACK32:63,VK_FORMAT_A2B10G10R10_UNORM_PACK32:64,VK_FORMAT_A2B10G10R10_SNORM_PACK32:65,VK_FORMAT_A2B10G10R10_USCALED_PACK32:66,VK_FORMAT_A2B10G10R10_SSCALED_PACK32:67,VK_FORMAT_A2B10G10R10_UINT_PACK32:68,VK_FORMAT_A2B10G10R10_SINT_PACK32:69,VK_FORMAT_R16_UNORM:70,VK_FORMAT_R16_SNORM:71,VK_FORMAT_R16_USCALED:72,VK_FORMAT_R16_SSCALED:73,VK_FORMAT_R16_UINT:74,VK_FORMAT_R16_SINT:75,VK_FORMAT_R16_SFLOAT:76,VK_FORMAT_R16G16_UNORM:77,VK_FORMAT_R16G16_SNORM:78,VK_FORMAT_R16G16_USCALED:79,VK_FORMAT_R16G16_SSCALED:80,VK_FORMAT_R16G16_UINT:81,VK_FORMAT_R16G16_SINT:82,VK_FORMAT_R16G16_SFLOAT:83,VK_FORMAT_R16G16B16_UNORM:84,VK_FORMAT_R16G16B16_SNORM:85,VK_FORMAT_R16G16B16_USCALED:86,VK_FORMAT_R16G16B16_SSCALED:87,VK_FORMAT_R16G16B16_UINT:88,VK_FORMAT_R16G16B16_SINT:89,VK_FORMAT_R16G16B16_SFLOAT:90,VK_FORMAT_R16G16B16A16_UNORM:91,VK_FORMAT_R16G16B16A16_SNORM:92,VK_FORMAT_R16G16B16A16_USCALED:93,VK_FORMAT_R16G16B16A16_SSCALED:94,VK_FORMAT_R16G16B16A16_UINT:95,VK_FORMAT_R16G16B16A16_SINT:96,VK_FORMAT_R16G16B16A16_SFLOAT:97,VK_FORMAT_R32_UINT:98,VK_FORMAT_R32_SINT:99,VK_FORMAT_R32_SFLOAT:100,VK_FORMAT_R32G32_UINT:101,VK_FORMAT_R32G32_SINT:102,VK_FORMAT_R32G32_SFLOAT:103,VK_FORMAT_R32G32B32_UINT:104,VK_FORMAT_R32G32B32_SINT:105,VK_FORMAT_R32G32B32_SFLOAT:106,VK_FORMAT_R32G32B32A32_UINT:107,VK_FORMAT_R32G32B32A32_SINT:108,VK_FORMAT_R32G32B32A32_SFLOAT:109,VK_FORMAT_R64_UINT:110,VK_FORMAT_R64_SINT:111,VK_FORMAT_R64_SFLOAT:112,VK_FORMAT_R64G64_UINT:113,VK_FORMAT_R64G64_SINT:114,VK_FORMAT_R64G64_SFLOAT:115,VK_FORMAT_R64G64B64_UINT:116,VK_FORMAT_R64G64B64_SINT:117,VK_FORMAT_R64G64B64_SFLOAT:118,VK_FORMAT_R64G64B64A64_UINT:119,VK_FORMAT_R64G64B64A64_SINT:120,VK_FORMAT_R64G64B64A64_SFLOAT:121,VK_FORMAT_B10G11R11_UFLOAT_PACK32:122,VK_FORMAT_E5B9G9R9_UFLOAT_PACK32:123,VK_FORMAT_D16_UNORM:124,VK_FORMAT_X8_D24_UNORM_PACK32:125,VK_FORMAT_D32_SFLOAT:126,VK_FORMAT_S8_UINT:127,VK_FORMAT_D16_UNORM_S8_UINT:128,VK_FORMAT_D24_UNORM_S8_UINT:129,VK_FORMAT_D32_SFLOAT_S8_UINT:130,VK_FORMAT_BC1_RGB_UNORM_BLOCK:131,VK_FORMAT_BC1_RGB_SRGB_BLOCK:132,VK_FORMAT_BC1_RGBA_UNORM_BLOCK:133,VK_FORMAT_BC1_RGBA_SRGB_BLOCK:134,VK_FORMAT_BC2_UNORM_BLOCK:135,VK_FORMAT_BC2_SRGB_BLOCK:136,VK_FORMAT_BC3_UNORM_BLOCK:137,VK_FORMAT_BC3_SRGB_BLOCK:138,VK_FORMAT_BC4_UNORM_BLOCK:139,VK_FORMAT_BC4_SNORM_BLOCK:140,VK_FORMAT_BC5_UNORM_BLOCK:141,VK_FORMAT_BC5_SNORM_BLOCK:142,VK_FORMAT_BC6H_UFLOAT_BLOCK:143,VK_FORMAT_BC6H_SFLOAT_BLOCK:144,VK_FORMAT_BC7_UNORM_BLOCK:145,VK_FORMAT_BC7_SRGB_BLOCK:146,VK_FORMAT_ETC2_R8G8B8_UNORM_BLOCK:147,VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK:148,VK_FORMAT_ETC2_R8G8B8A1_UNORM_BLOCK:149,VK_FORMAT_ETC2_R8G8B8A1_SRGB_BLOCK:150,VK_FORMAT_ETC2_R8G8B8A8_UNORM_BLOCK:151,VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK:152,VK_FORMAT_EAC_R11_UNORM_BLOCK:153,VK_FORMAT_EAC_R11_SNORM_BLOCK:154,VK_FORMAT_EAC_R11G11_UNORM_BLOCK:155,VK_FORMAT_EAC_R11G11_SNORM_BLOCK:156,VK_FORMAT_ASTC_4x4_UNORM_BLOCK:157,VK_FORMAT_ASTC_4x4_SRGB_BLOCK:158,VK_FORMAT_ASTC_5x4_UNORM_BLOCK:159,VK_FORMAT_ASTC_5x4_SRGB_BLOCK:160,VK_FORMAT_ASTC_5x5_UNORM_BLOCK:161,VK_FORMAT_ASTC_5x5_SRGB_BLOCK:162,VK_FORMAT_ASTC_6x5_UNORM_BLOCK:163,VK_FORMAT_ASTC_6x5_SRGB_BLOCK:164,VK_FORMAT_ASTC_6x6_UNORM_BLOCK:165,VK_FORMAT_ASTC_6x6_SRGB_BLOCK:166,VK_FORMAT_ASTC_8x5_UNORM_BLOCK:167,VK_FORMAT_ASTC_8x5_SRGB_BLOCK:168,VK_FORMAT_ASTC_8x6_UNORM_BLOCK:169,VK_FORMAT_ASTC_8x6_SRGB_BLOCK:170,VK_FORMAT_ASTC_8x8_UNORM_BLOCK:171,VK_FORMAT_ASTC_8x8_SRGB_BLOCK:172,VK_FORMAT_ASTC_10x5_UNORM_BLOCK:173,VK_FORMAT_ASTC_10x5_SRGB_BLOCK:174,VK_FORMAT_ASTC_10x6_UNORM_BLOCK:175,VK_FORMAT_ASTC_10x6_SRGB_BLOCK:176,VK_FORMAT_ASTC_10x8_UNORM_BLOCK:177,VK_FORMAT_ASTC_10x8_SRGB_BLOCK:178,VK_FORMAT_ASTC_10x10_UNORM_BLOCK:179,VK_FORMAT_ASTC_10x10_SRGB_BLOCK:180,VK_FORMAT_ASTC_12x10_UNORM_BLOCK:181,VK_FORMAT_ASTC_12x10_SRGB_BLOCK:182,VK_FORMAT_ASTC_12x12_UNORM_BLOCK:183,VK_FORMAT_ASTC_12x12_SRGB_BLOCK:184,VK_FORMAT_G8B8G8R8_422_UNORM:1000156e3,VK_FORMAT_B8G8R8G8_422_UNORM:1000156001,VK_FORMAT_G8_B8_R8_3PLANE_420_UNORM:1000156002,VK_FORMAT_G8_B8R8_2PLANE_420_UNORM:1000156003,VK_FORMAT_G8_B8_R8_3PLANE_422_UNORM:1000156004,VK_FORMAT_G8_B8R8_2PLANE_422_UNORM:1000156005,VK_FORMAT_G8_B8_R8_3PLANE_444_UNORM:1000156006,VK_FORMAT_R10X6_UNORM_PACK16:1000156007,VK_FORMAT_R10X6G10X6_UNORM_2PACK16:1000156008,VK_FORMAT_R10X6G10X6B10X6A10X6_UNORM_4PACK16:1000156009,VK_FORMAT_G10X6B10X6G10X6R10X6_422_UNORM_4PACK16:1000156010,VK_FORMAT_B10X6G10X6R10X6G10X6_422_UNORM_4PACK16:1000156011,VK_FORMAT_G10X6_B10X6_R10X6_3PLANE_420_UNORM_3PACK16:1000156012,VK_FORMAT_G10X6_B10X6R10X6_2PLANE_420_UNORM_3PACK16:1000156013,VK_FORMAT_G10X6_B10X6_R10X6_3PLANE_422_UNORM_3PACK16:1000156014,VK_FORMAT_G10X6_B10X6R10X6_2PLANE_422_UNORM_3PACK16:1000156015,VK_FORMAT_G10X6_B10X6_R10X6_3PLANE_444_UNORM_3PACK16:1000156016,VK_FORMAT_R12X4_UNORM_PACK16:1000156017,VK_FORMAT_R12X4G12X4_UNORM_2PACK16:1000156018,VK_FORMAT_R12X4G12X4B12X4A12X4_UNORM_4PACK16:1000156019,VK_FORMAT_G12X4B12X4G12X4R12X4_422_UNORM_4PACK16:1000156020,VK_FORMAT_B12X4G12X4R12X4G12X4_422_UNORM_4PACK16:1000156021,VK_FORMAT_G12X4_B12X4_R12X4_3PLANE_420_UNORM_3PACK16:1000156022,VK_FORMAT_G12X4_B12X4R12X4_2PLANE_420_UNORM_3PACK16:1000156023,VK_FORMAT_G12X4_B12X4_R12X4_3PLANE_422_UNORM_3PACK16:1000156024,VK_FORMAT_G12X4_B12X4R12X4_2PLANE_422_UNORM_3PACK16:1000156025,VK_FORMAT_G12X4_B12X4_R12X4_3PLANE_444_UNORM_3PACK16:1000156026,VK_FORMAT_G16B16G16R16_422_UNORM:1000156027,VK_FORMAT_B16G16R16G16_422_UNORM:1000156028,VK_FORMAT_G16_B16_R16_3PLANE_420_UNORM:1000156029,VK_FORMAT_G16_B16R16_2PLANE_420_UNORM:1000156030,VK_FORMAT_G16_B16_R16_3PLANE_422_UNORM:1000156031,VK_FORMAT_G16_B16R16_2PLANE_422_UNORM:1000156032,VK_FORMAT_G16_B16_R16_3PLANE_444_UNORM:1000156033,VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG:1000054e3,VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG:1000054001,VK_FORMAT_PVRTC2_2BPP_UNORM_BLOCK_IMG:1000054002,VK_FORMAT_PVRTC2_4BPP_UNORM_BLOCK_IMG:1000054003,VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG:1000054004,VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG:1000054005,VK_FORMAT_PVRTC2_2BPP_SRGB_BLOCK_IMG:1000054006,VK_FORMAT_PVRTC2_4BPP_SRGB_BLOCK_IMG:1000054007,VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT:1000066e3,VK_FORMAT_ASTC_5x4_SFLOAT_BLOCK_EXT:1000066001,VK_FORMAT_ASTC_5x5_SFLOAT_BLOCK_EXT:1000066002,VK_FORMAT_ASTC_6x5_SFLOAT_BLOCK_EXT:1000066003,VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT:1000066004,VK_FORMAT_ASTC_8x5_SFLOAT_BLOCK_EXT:1000066005,VK_FORMAT_ASTC_8x6_SFLOAT_BLOCK_EXT:1000066006,VK_FORMAT_ASTC_8x8_SFLOAT_BLOCK_EXT:1000066007,VK_FORMAT_ASTC_10x5_SFLOAT_BLOCK_EXT:1000066008,VK_FORMAT_ASTC_10x6_SFLOAT_BLOCK_EXT:1000066009,VK_FORMAT_ASTC_10x8_SFLOAT_BLOCK_EXT:1000066010,VK_FORMAT_ASTC_10x10_SFLOAT_BLOCK_EXT:1000066011,VK_FORMAT_ASTC_12x10_SFLOAT_BLOCK_EXT:1000066012,VK_FORMAT_ASTC_12x12_SFLOAT_BLOCK_EXT:1000066013,VK_FORMAT_G8B8G8R8_422_UNORM_KHR:1000156e3,VK_FORMAT_B8G8R8G8_422_UNORM_KHR:1000156001,VK_FORMAT_G8_B8_R8_3PLANE_420_UNORM_KHR:1000156002,VK_FORMAT_G8_B8R8_2PLANE_420_UNORM_KHR:1000156003,VK_FORMAT_G8_B8_R8_3PLANE_422_UNORM_KHR:1000156004,VK_FORMAT_G8_B8R8_2PLANE_422_UNORM_KHR:1000156005,VK_FORMAT_G8_B8_R8_3PLANE_444_UNORM_KHR:1000156006,VK_FORMAT_R10X6_UNORM_PACK16_KHR:1000156007,VK_FORMAT_R10X6G10X6_UNORM_2PACK16_KHR:1000156008,VK_FORMAT_R10X6G10X6B10X6A10X6_UNORM_4PACK16_KHR:1000156009,VK_FORMAT_G10X6B10X6G10X6R10X6_422_UNORM_4PACK16_KHR:1000156010,VK_FORMAT_B10X6G10X6R10X6G10X6_422_UNORM_4PACK16_KHR:1000156011,VK_FORMAT_G10X6_B10X6_R10X6_3PLANE_420_UNORM_3PACK16_KHR:1000156012,VK_FORMAT_G10X6_B10X6R10X6_2PLANE_420_UNORM_3PACK16_KHR:1000156013,VK_FORMAT_G10X6_B10X6_R10X6_3PLANE_422_UNORM_3PACK16_KHR:1000156014,VK_FORMAT_G10X6_B10X6R10X6_2PLANE_422_UNORM_3PACK16_KHR:1000156015,VK_FORMAT_G10X6_B10X6_R10X6_3PLANE_444_UNORM_3PACK16_KHR:1000156016,VK_FORMAT_R12X4_UNORM_PACK16_KHR:1000156017,VK_FORMAT_R12X4G12X4_UNORM_2PACK16_KHR:1000156018,VK_FORMAT_R12X4G12X4B12X4A12X4_UNORM_4PACK16_KHR:1000156019,VK_FORMAT_G12X4B12X4G12X4R12X4_422_UNORM_4PACK16_KHR:1000156020,VK_FORMAT_B12X4G12X4R12X4G12X4_422_UNORM_4PACK16_KHR:1000156021,VK_FORMAT_G12X4_B12X4_R12X4_3PLANE_420_UNORM_3PACK16_KHR:1000156022,VK_FORMAT_G12X4_B12X4R12X4_2PLANE_420_UNORM_3PACK16_KHR:1000156023,VK_FORMAT_G12X4_B12X4_R12X4_3PLANE_422_UNORM_3PACK16_KHR:1000156024,VK_FORMAT_G12X4_B12X4R12X4_2PLANE_422_UNORM_3PACK16_KHR:1000156025,VK_FORMAT_G12X4_B12X4_R12X4_3PLANE_444_UNORM_3PACK16_KHR:1000156026,VK_FORMAT_G16B16G16R16_422_UNORM_KHR:1000156027,VK_FORMAT_B16G16R16G16_422_UNORM_KHR:1000156028,VK_FORMAT_G16_B16_R16_3PLANE_420_UNORM_KHR:1000156029,VK_FORMAT_G16_B16R16_2PLANE_420_UNORM_KHR:1000156030,VK_FORMAT_G16_B16_R16_3PLANE_422_UNORM_KHR:1000156031,VK_FORMAT_G16_B16R16_2PLANE_422_UNORM_KHR:1000156032,VK_FORMAT_G16_B16_R16_3PLANE_444_UNORM_KHR:1000156033};Object.freeze(XN);const QN={};function JN(e,t){return z.equalsEpsilon(e.latitude,t.latitude,z.EPSILON10)&&z.equalsEpsilon(e.longitude,t.longitude,z.EPSILON10)}const ZN=new se,$N=new se;function eF(e,t,n,i){t=Ly(t,K.equalsEpsilon);const o=t.length;if(o<2)return;const r=C(i),s=C(n),a=new Array(o),c=new Array(o),l=new Array(o),u=t[0];a[0]=u;const h=e.cartesianToCartographic(u,ZN);s&&(h.height=n[0]),c[0]=h.height,l[0]=r?i[0]:0;const d=c[0],f=l[0];let p=d===f,m=1;for(let _=1;_<o;++_){const o=t[_],u=e.cartesianToCartographic(o,$N);s&&(u.height=n[_]),p=p&&0===u.height,JN(h,u)?h.height<u.height&&(c[m-1]=u.height):(a[m]=o,c[m]=u.height,l[m]=r?i[_]:0,p=p&&c[m]===l[m],se.clone(u,h),++m)}return p||m<2?void 0:(a.length=m,c.length=m,l.length=m,{positions:a,topHeights:c,bottomHeights:l})}const tF=new Array(2),nF=new Array(2),iF={positions:void 0,height:void 0,granularity:void 0,ellipsoid:void 0};QN.computePositions=function(e,t,n,i,o,r){const s=eF(e,t,n,i);if(!C(s))return;t=s.positions,n=s.topHeights,i=s.bottomHeights;const a=t.length,c=a-2;let l,u;const h=z.chordLength(o,e.maximumRadius),d=iF;if(d.minDistance=h,d.ellipsoid=e,r){let e,o=0;for(e=0;e<a-1;e++)o+=AA.numberOfPoints(t[e],t[e+1],h)+1;l=new Float64Array(3*o),u=new Float64Array(3*o);const r=tF,s=nF;d.positions=r,d.height=s;let c=0;for(e=0;e<a-1;e++){r[0]=t[e],r[1]=t[e+1],s[0]=n[e],s[1]=n[e+1];const o=AA.generateArc(d);l.set(o,c),s[0]=i[e],s[1]=i[e+1],u.set(AA.generateArc(d),c),c+=o.length}}else d.positions=t,d.height=n,l=new Float64Array(AA.generateArc(d)),d.height=i,u=new Float64Array(AA.generateArc(d));return{bottomPositions:u,topPositions:l,numCorners:c}};var oF=QN;const rF=new K,sF=new K,aF=new K,cF=new K,lF=new K,uF=new K,hF=new K;function dF(e){e=R(e,R.EMPTY_OBJECT);const t=e.positions,n=e.maximumHeights,i=e.minimumHeights;if(!C(t))throw new x("options.positions is required.");if(C(n)&&n.length!==t.length)throw new x("options.positions and options.maximumHeights must have the same length.");if(C(i)&&i.length!==t.length)throw new x("options.positions and options.minimumHeights must have the same length.");const o=R(e.vertexFormat,jf.DEFAULT),r=R(e.granularity,z.RADIANS_PER_DEGREE),s=R(e.ellipsoid,ge.WGS84);this._positions=t,this._minimumHeights=i,this._maximumHeights=n,this._vertexFormat=jf.clone(o),this._granularity=r,this._ellipsoid=ge.clone(s),this._workerName="createWallGeometry";let a=1+t.length*K.packedLength+2;C(i)&&(a+=i.length),C(n)&&(a+=n.length),this.packedLength=a+ge.packedLength+jf.packedLength+1}dF.pack=function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");let i;n=R(n,0);const o=e._positions;let r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=K.packedLength)K.pack(o[i],t,n);const s=e._minimumHeights;if(r=C(s)?s.length:0,t[n++]=r,C(s))for(i=0;i<r;++i)t[n++]=s[i];const a=e._maximumHeights;if(r=C(a)?a.length:0,t[n++]=r,C(a))for(i=0;i<r;++i)t[n++]=a[i];return ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,jf.pack(e._vertexFormat,t,n),n+=jf.packedLength,t[n]=e._granularity,t};const fF=ge.clone(ge.UNIT_SPHERE),pF=new jf,mF={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:fF,vertexFormat:pF,granularity:void 0};dF.unpack=function(e,t,n){if(!C(e))throw new x("array is required");let i;t=R(t,0);let o=e[t++];const r=new Array(o);for(i=0;i<o;++i,t+=K.packedLength)r[i]=K.unpack(e,t);let s,a;if(o=e[t++],o>0)for(s=new Array(o),i=0;i<o;++i)s[i]=e[t++];if(o=e[t++],o>0)for(a=new Array(o),i=0;i<o;++i)a[i]=e[t++];const c=ge.unpack(e,t,fF);t+=ge.packedLength;const l=jf.unpack(e,t,pF);t+=jf.packedLength;const u=e[t];return C(n)?(n._positions=r,n._minimumHeights=s,n._maximumHeights=a,n._ellipsoid=ge.clone(c,n._ellipsoid),n._vertexFormat=jf.clone(l,n._vertexFormat),n._granularity=u,n):(mF.positions=r,mF.minimumHeights=s,mF.maximumHeights=a,mF.granularity=u,new dF(mF))},dF.fromConstantHeights=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.positions;if(!C(t))throw new x("options.positions is required.");let n,i;const o=e.minimumHeight,r=e.maximumHeight,s=C(o),a=C(r);if(s||a){const e=t.length;n=s?new Array(e):void 0,i=a?new Array(e):void 0;for(let t=0;t<e;++t)s&&(n[t]=o),a&&(i[t]=r)}const c={positions:t,maximumHeights:i,minimumHeights:n,ellipsoid:e.ellipsoid,vertexFormat:e.vertexFormat};return new dF(c)},dF.createGeometry=function(e){const t=e._positions,n=e._minimumHeights,i=e._maximumHeights,o=e._vertexFormat,r=e._granularity,s=e._ellipsoid,a=oF.computePositions(s,t,i,n,r,!0);if(!C(a))return;const c=a.bottomPositions,l=a.topPositions,u=a.numCorners;let h=l.length,d=2*h;const f=o.position?new Float64Array(d):void 0,p=o.normal?new Float32Array(d):void 0,m=o.tangent?new Float32Array(d):void 0,_=o.bitangent?new Float32Array(d):void 0,g=o.st?new Float32Array(d/3*2):void 0;let y,v=0,b=0,A=0,w=0,T=0,E=hF,x=uF,S=lF,I=!0;h/=3;let O=0;const D=1/(h-u-1);for(y=0;y<h;++y){const e=3*y,t=K.fromArray(l,e,rF),n=K.fromArray(c,e,sF);if(o.position&&(f[v++]=n.x,f[v++]=n.y,f[v++]=n.z,f[v++]=t.x,f[v++]=t.y,f[v++]=t.z),o.st&&(g[T++]=O,g[T++]=0,g[T++]=O,g[T++]=1),o.normal||o.tangent||o.bitangent){let n=K.clone(K.ZERO,cF);const i=K.subtract(t,s.geodeticSurfaceNormal(t,sF),sF);if(y+1<h&&(n=K.fromArray(l,e+3,cF)),I){const e=K.subtract(n,t,aF),o=K.subtract(i,t,rF);E=K.normalize(K.cross(o,e,E),E),I=!1}K.equalsEpsilon(t,n,z.EPSILON10)?I=!0:(O+=D,o.tangent&&(x=K.normalize(K.subtract(n,t,x),x)),o.bitangent&&(S=K.normalize(K.cross(E,x,S),S))),o.normal&&(p[b++]=E.x,p[b++]=E.y,p[b++]=E.z,p[b++]=E.x,p[b++]=E.y,p[b++]=E.z),o.tangent&&(m[w++]=x.x,m[w++]=x.y,m[w++]=x.z,m[w++]=x.x,m[w++]=x.y,m[w++]=x.z),o.bitangent&&(_[A++]=S.x,_[A++]=S.y,_[A++]=S.z,_[A++]=S.x,_[A++]=S.y,_[A++]=S.z)}}const P=new Hf;o.position&&(P.position=new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:f})),o.normal&&(P.normal=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:p})),o.tangent&&(P.tangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:m})),o.bitangent&&(P.bitangent=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:_})),o.st&&(P.st=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:g}));const R=d/3;d-=6*(u+1);const L=fd.createTypedArray(R,d);let M=0;for(y=0;y<R-2;y+=2){const e=y,t=y+2,n=K.fromArray(f,3*e,rF),i=K.fromArray(f,3*t,sF);if(K.equalsEpsilon(n,i,z.EPSILON10))continue;const o=y+1,r=y+3;L[M++]=o,L[M++]=e,L[M++]=r,L[M++]=r,L[M++]=e,L[M++]=t}return new zf({attributes:P,indices:L,primitiveType:xf.TRIANGLES,boundingSphere:new nn.fromVertices(f)})};var _F=dF;const gF=new K,yF=new K;function vF(e){e=R(e,R.EMPTY_OBJECT);const t=e.positions,n=e.maximumHeights,i=e.minimumHeights;if(!C(t))throw new x("options.positions is required.");if(C(n)&&n.length!==t.length)throw new x("options.positions and options.maximumHeights must have the same length.");if(C(i)&&i.length!==t.length)throw new x("options.positions and options.minimumHeights must have the same length.");const o=R(e.granularity,z.RADIANS_PER_DEGREE),r=R(e.ellipsoid,ge.WGS84);this._positions=t,this._minimumHeights=i,this._maximumHeights=n,this._granularity=o,this._ellipsoid=ge.clone(r),this._workerName="createWallOutlineGeometry";let s=1+t.length*K.packedLength+2;C(i)&&(s+=i.length),C(n)&&(s+=n.length),this.packedLength=s+ge.packedLength+1}vF.pack=function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");let i;n=R(n,0);const o=e._positions;let r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=K.packedLength)K.pack(o[i],t,n);const s=e._minimumHeights;if(r=C(s)?s.length:0,t[n++]=r,C(s))for(i=0;i<r;++i)t[n++]=s[i];const a=e._maximumHeights;if(r=C(a)?a.length:0,t[n++]=r,C(a))for(i=0;i<r;++i)t[n++]=a[i];return ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,t[n]=e._granularity,t};const bF=ge.clone(ge.UNIT_SPHERE),AF={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:bF,granularity:void 0};vF.unpack=function(e,t,n){if(!C(e))throw new x("array is required");let i;t=R(t,0);let o=e[t++];const r=new Array(o);for(i=0;i<o;++i,t+=K.packedLength)r[i]=K.unpack(e,t);let s,a;if(o=e[t++],o>0)for(s=new Array(o),i=0;i<o;++i)s[i]=e[t++];if(o=e[t++],o>0)for(a=new Array(o),i=0;i<o;++i)a[i]=e[t++];const c=ge.unpack(e,t,bF);t+=ge.packedLength;const l=e[t];return C(n)?(n._positions=r,n._minimumHeights=s,n._maximumHeights=a,n._ellipsoid=ge.clone(c,n._ellipsoid),n._granularity=l,n):(AF.positions=r,AF.minimumHeights=s,AF.maximumHeights=a,AF.granularity=l,new vF(AF))},vF.fromConstantHeights=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.positions;if(!C(t))throw new x("options.positions is required.");let n,i;const o=e.minimumHeight,r=e.maximumHeight,s=C(o),a=C(r);if(s||a){const e=t.length;n=s?new Array(e):void 0,i=a?new Array(e):void 0;for(let t=0;t<e;++t)s&&(n[t]=o),a&&(i[t]=r)}const c={positions:t,maximumHeights:i,minimumHeights:n,ellipsoid:e.ellipsoid};return new vF(c)},vF.createGeometry=function(e){const t=e._positions,n=e._minimumHeights,i=e._maximumHeights,o=e._granularity,r=e._ellipsoid,s=oF.computePositions(r,t,i,n,o,!1);if(!C(s))return;const a=s.bottomPositions,c=s.topPositions;let l=c.length,u=2*l;const h=new Float64Array(u);let d,f=0;for(l/=3,d=0;d<l;++d){const e=3*d,t=K.fromArray(c,e,gF),n=K.fromArray(a,e,yF);h[f++]=n.x,h[f++]=n.y,h[f++]=n.z,h[f++]=t.x,h[f++]=t.y,h[f++]=t.z}const p=new Hf({position:new Uf({componentDatatype:ih.DOUBLE,componentsPerAttribute:3,values:h})}),m=u/3;u=2*m-4+m;const _=fd.createTypedArray(m,u);let g=0;for(d=0;d<m-2;d+=2){const e=d,t=d+2,n=K.fromArray(h,3*e,gF),i=K.fromArray(h,3*t,yF);if(K.equalsEpsilon(n,i,z.EPSILON10))continue;const o=d+1,r=d+3;_[g++]=o,_[g++]=e,_[g++]=o,_[g++]=r,_[g++]=e,_[g++]=t}return _[g++]=m-2,_[g++]=m-1,new zf({attributes:p,indices:_,primitiveType:xf.LINES,boundingSphere:new nn.fromVertices(h)})};var wF=vF;function TF(e){e=R(e,R.EMPTY_OBJECT);const t=e.weights,n=e.times;if(D.defined("weights",t),D.defined("times",n),D.typeOf.number.greaterThanOrEquals("weights.length",t.length,3),t.length%n.length!==0)throw new x("times.length must be a factor of weights.length.");this._times=n,this._weights=t,this._count=t.length/n.length,this._lastTimeIndex=0}Object.defineProperties(TF.prototype,{times:{get:function(){return this._times}},weights:{get:function(){return this._weights}}}),TF.prototype.findTimeInterval=up.prototype.findTimeInterval,TF.prototype.wrapTime=up.prototype.wrapTime,TF.prototype.clampTime=up.prototype.clampTime,TF.prototype.evaluate=function(e,t){const n=this.weights,i=this.times,o=this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex),r=(e-i[o])/(i[o+1]-i[o]);C(t)||(t=new Array(this._count));for(let s=0;s<this._count;s++){const e=o*this._count+s;t[s]=n[e]*(1-r)+n[e+this._count]*r}return t};var CF=TF;function EF(e,t,n){if(D.defined("array",e),C(t)&&D.typeOf.number("begin",t),C(n)&&D.typeOf.number("end",n),"function"===typeof e.slice)return e.slice(t,n);let i=Array.prototype.slice.call(e,t,n);const o=Oc.typedArrayTypes,r=o.length;for(let s=0;s<r;++s)if(e instanceof o[s]){i=new o[s](i);break}return i}var xF=EF;let SF;"undefined"!==typeof cancelAnimationFrame&&(SF=cancelAnimationFrame),function(){if(!C(SF)&&"undefined"!==typeof window){const e=["webkit","moz","ms","o"];let t=0;const n=e.length;while(t<n&&!C(SF))SF=window[`${e[t]}CancelAnimationFrame`],C(SF)||(SF=window[`${e[t]}CancelRequestAnimationFrame`]),++t}C(SF)||(SF=clearTimeout)}();function IF(e){return e=R(e,R.EMPTY_OBJECT),new hm({url:rO.fromAssetId(1),requestVertexNormals:R(e.requestVertexNormals,!1),requestWaterMask:R(e.requestWaterMask,!1)})}var OF=IF;const DF=1953029805,PF=2917034100;function RF(e,t){if(RF.passThroughDataForTesting)return t;D.typeOf.object("key",e),D.typeOf.object("data",t);const n=e.byteLength;if(0===n||n%4!==0)throw new Je("The length of key must be greater than 0 and a multiple of 4.");const i=new DataView(t),o=i.getUint32(0,!0);if(o===DF||o===PF)return t;const r=new DataView(e);let s=0;const a=t.byteLength,c=a-a%8,l=n;let u,h=8;while(s<c){h=(h+8)%24,u=h;while(s<c&&u<l)i.setUint32(s,i.getUint32(s,!0)^r.getUint32(u,!0),!0),i.setUint32(s+4,i.getUint32(s+4,!0)^r.getUint32(u+4,!0),!0),s+=8,u+=24}if(s<a){u>=l&&(h=(h+8)%24,u=h);while(s<a)i.setUint8(s,i.getUint8(s)^r.getUint8(u)),s++,u++}}RF.passThroughDataForTesting=!1;var LF=RF;const MF=32767,BF=new se,NF=new K;function FF(e,t,n,i,o){const r=e.length/3,s=e.subarray(0,r),a=e.subarray(r,2*r),c=e.subarray(2*r,3*r);wh.zigZagDeltaDecode(s,a,c);const l=new Float64Array(e.length);for(let u=0;u<r;++u){const e=s[u],r=a[u],h=c[u],d=z.lerp(t.west,t.east,e/MF),f=z.lerp(t.south,t.north,r/MF),p=z.lerp(n,i,h/MF),m=se.fromRadians(d,f,p,BF),_=o.cartographicToCartesian(m,NF);K.pack(_,l,3*u)}return l}var zF=FF;function kF(e,t){if(!C(e)||!C(t))throw new x("identifier and message are required.");CA(e,t)}var UF=kF;function VF(e){if(!C(e))throw new x("uri is required.");const t=new cn(e);t.normalize();let n=t.path();const i=n.lastIndexOf("/");return-1!==i&&(n=n.substr(i+1)),n}var HF=VF;function GF(e,t){return t=R(t,0),Bp(e,t,Math.min(4,e.length))}var WF=GF;function qF(e){const t=e.uint8Array,n=e.format,i=e.request,o=R(e.flipY,!1),r=R(e.skipColorSpaceConversion,!1);D.typeOf.object("uint8Array",t),D.typeOf.string("format",n);const s=new Blob([t],{type:n});let a;return Vi.supportsImageBitmapOptions().then((function(e){if(e)return Promise.resolve(Vi.createImageBitmapFromBlob(s,{flipY:o,premultiplyAlpha:!1,skipColorSpaceConversion:r}));a=window.URL.createObjectURL(s);const t=new Vi({url:a,request:i});return t.fetchImage({flipY:o,skipColorSpaceConversion:r})})).then((function(e){return C(a)&&window.URL.revokeObjectURL(a),e})).catch((function(e){return C(a)&&window.URL.revokeObjectURL(a),Promise.reject(e)}))}var jF=qF;let YF;function KF(e){let t;if(D.defined("resourceOrUrlOrBuffer",e),e instanceof ArrayBuffer||ArrayBuffer.isView(e))t=Promise.resolve(e);else{const n=Vi.createIfNeeded(e);t=n.fetchArrayBuffer()}return t.then((function(e){return _O.transcode(e,YF)}))}KF.setKTX2SupportedFormats=function(e,t,n,i,o,r){YF={s3tc:e,pvrtc:t,astc:n,etc:i,etc1:o,bc7:r}};var XF=KF;const QF=[],JF=[];function ZF(e,t,n,i,o,r){const s=o-i+1,a=r-o,c=QF,l=JF;let u,h;for(u=0;u<s;++u)c[u]=e[i+u];for(h=0;h<a;++h)l[h]=e[o+h+1];u=0,h=0;for(let d=i;d<=r;++d){const i=c[u],o=l[h];u<s&&(h>=a||t(i,o,n)<=0)?(e[d]=i,++u):h<a&&(e[d]=o,++h)}}function $F(e,t,n,i,o){if(i>=o)return;const r=Math.floor(.5*(i+o));$F(e,t,n,i,r),$F(e,t,n,r+1,o),ZF(e,t,n,i,r,o)}function ez(e,t,n){if(!C(e))throw new x("array is required.");if(!C(t))throw new x("comparator is required.");const i=e.length,o=Math.ceil(.5*i);QF.length=o,JF.length=o,$F(e,t,n,0,i-1),QF.length=0,JF.length=0}var tz=ez;new K;let nz;function iz(e){return nz(e)}"undefined"!==typeof requestAnimationFrame&&(nz=requestAnimationFrame),function(){if(!C(nz)&&"undefined"!==typeof window){const e=["webkit","moz","ms","o"];let t=0;const n=e.length;while(t<n&&!C(nz))nz=window[`${e[t]}RequestAnimationFrame`],++t}if(!C(nz)){const e=1e3/60;let t=0;nz=function(n){const i=py(),o=Math.max(e-(i-t),0);return t=i+o,setTimeout((function(){n(t)}),o)}}}();var oz=iz;function rz(e,t,n){return D.typeOf.object("terrainProvider",e),D.typeOf.number("level",t),D.defined("positions",n),e.readyPromise.then((function(){return sz(e,t,n)}))}function sz(e,t,n){const i=e.tilingScheme;let o;const r=[],s={};for(o=0;o<n.length;++o){const a=i.positionToTileXY(n[o],t),c=a.toString();if(!s.hasOwnProperty(c)){const n={x:a.x,y:a.y,level:t,tilingScheme:i,terrainProvider:e,positions:[]};s[c]=n,r.push(n)}s[c].positions.push(n[o])}const a=[];for(o=0;o<r.length;++o){const e=r[o],t=e.terrainProvider.requestTileGeometry(e.x,e.y,e.level),n=t.then(cz(e)).catch(lz(e));a.push(n)}return Promise.all(a).then((function(){return n}))}function az(e,t,n){const i=t.interpolateHeight(n,e.longitude,e.latitude);return void 0!==i&&(e.height=i,!0)}function cz(e){const t=e.positions,n=e.tilingScheme.tileXYToRectangle(e.x,e.y,e.level);return function(i){let o=!1;for(let e=0;e<t.length;++e){const r=t[e],s=az(r,i,n);if(!s){o=!0;break}}return o?i.createMesh({tilingScheme:e.tilingScheme,x:e.x,y:e.y,level:e.level,throttle:!1}).then((function(){for(let e=0;e<t.length;++e){const o=t[e];az(o,i,n)}})):Promise.resolve()}}function lz(e){const t=e.positions;return function(){for(let e=0;e<t.length;++e){const n=t[e];n.height=void 0}}}var uz=rz;const hz=new ro;function dz(e,t){if(!C(e))throw new x("terrainProvider is required.");if(!C(t))throw new x("positions is required.");return e.readyPromise.then((function(){const n=[],i=[],o=e.availability;if(!C(o))throw new x("sampleTerrainMostDetailed requires a terrain provider that has tile availability.");const r=[];for(let s=0;s<t.length;++s){const a=t[s],c=o.computeMaximumLevelAtPosition(a);if(i[s]=c,0===c){e.tilingScheme.positionToTileXY(a,1,hz);const t=e.loadTileDataAvailability(hz.x,hz.y,1);C(t)&&r.push(t)}let l=n[c];C(l)||(n[c]=l=[]),l.push(a)}return Promise.all(r).then((function(){return Promise.all(n.map((function(t,n){if(C(t))return uz(e,n,t)})))})).then((function(){const n=[];for(let e=0;e<t.length;++e){const r=t[e],s=o.computeMaximumLevelAtPosition(r);s!==i[e]&&n.push(r)}if(n.length>0)return dz(e,n)})).then((function(){return t}))}))}var fz=dz;function pz(e,t){if(!C(e))throw new x("array is required.");if(!C(t)||t<1)throw new x("numberOfArrays must be greater than 0.");const n=[],i=e.length;let o=0;while(o<i){const r=Math.ceil((i-o)/t--);n.push(e.slice(o,o+r)),o+=r}return n}var mz=pz;function _z(e){switch(e){case th.FLOAT:return"float";case th.FLOAT_VEC2:return"vec2";case th.FLOAT_VEC3:return"vec3";case th.FLOAT_VEC4:return"vec4";case th.FLOAT_MAT2:return"mat2";case th.FLOAT_MAT3:return"mat3";case th.FLOAT_MAT4:return"mat4";case th.SAMPLER_2D:return"sampler2D";case th.BOOL:return"bool"}}var gz=_z;function yz(e){this._value=void 0,this._hasClone=!1,this._hasEquals=!1,this._definitionChanged=new $n,this.setValue(e)}Object.defineProperties(yz.prototype,{isConstant:{value:!0},definitionChanged:{get:function(){return this._definitionChanged}}}),yz.prototype.getValue=function(e,t){return this._hasClone?this._value.clone(t):this._value},yz.prototype.setValue=function(e){const t=this._value;if(t!==e){const n=C(e),i=n&&"function"===typeof e.clone,o=n&&"function"===typeof e.equals,r=!o||!e.equals(t);r&&(this._hasClone=i,this._hasEquals=o,this._value=i?e.clone(this._value):e,this._definitionChanged.raiseEvent(this))}},yz.prototype.equals=function(e){return this===e||e instanceof yz&&(!this._hasEquals&&this._value===e._value||this._hasEquals&&this._value.equals(e._value))},yz.prototype.valueOf=function(){return this._value},yz.prototype.toString=function(){return String(this._value)};var vz=yz;function bz(e,t,n,i,o){return{configurable:i,get:function(){return this[t]},set:function(i){const r=this[t],s=this[n];C(s)&&(s(),this[n]=void 0);const a=void 0!==i;!a||C(i)&&C(i.getValue)||!C(o)||(i=o(i)),r!==i&&(this[t]=i,this._definitionChanged.raiseEvent(this,e,i,r)),C(i)&&C(i.definitionChanged)&&(this[n]=i.definitionChanged.addEventListener((function(){this._definitionChanged.raiseEvent(this,e,i,i)}),this))}}}function Az(e){return new vz(e)}function wz(e,t,n){return bz(e,`_${e.toString()}`,`_${e.toString()}Subscription`,R(t,!1),R(n,Az))}var Tz=wz;function Cz(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._image=void 0,this._imageSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this._pixelOffset=void 0,this._pixelOffsetSubscription=void 0,this._eyeOffset=void 0,this._eyeOffsetSubscription=void 0,this._horizontalOrigin=void 0,this._horizontalOriginSubscription=void 0,this._verticalOrigin=void 0,this._verticalOriginSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._alignedAxis=void 0,this._alignedAxisSubscription=void 0,this._sizeInMeters=void 0,this._sizeInMetersSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._scaleByDistance=void 0,this._scaleByDistanceSubscription=void 0,this._translucencyByDistance=void 0,this._translucencyByDistanceSubscription=void 0,this._pixelOffsetScaleByDistance=void 0,this._pixelOffsetScaleByDistanceSubscription=void 0,this._imageSubRegion=void 0,this._imageSubRegionSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._disableDepthTestDistance=void 0,this._disableDepthTestDistanceSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(Cz.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),image:Tz("image"),scale:Tz("scale"),pixelOffset:Tz("pixelOffset"),eyeOffset:Tz("eyeOffset"),horizontalOrigin:Tz("horizontalOrigin"),verticalOrigin:Tz("verticalOrigin"),heightReference:Tz("heightReference"),color:Tz("color"),rotation:Tz("rotation"),alignedAxis:Tz("alignedAxis"),sizeInMeters:Tz("sizeInMeters"),width:Tz("width"),height:Tz("height"),scaleByDistance:Tz("scaleByDistance"),translucencyByDistance:Tz("translucencyByDistance"),pixelOffsetScaleByDistance:Tz("pixelOffsetScaleByDistance"),imageSubRegion:Tz("imageSubRegion"),distanceDisplayCondition:Tz("distanceDisplayCondition"),disableDepthTestDistance:Tz("disableDepthTestDistance")}),Cz.prototype.clone=function(e){return C(e)?(e.show=this._show,e.image=this._image,e.scale=this._scale,e.pixelOffset=this._pixelOffset,e.eyeOffset=this._eyeOffset,e.horizontalOrigin=this._horizontalOrigin,e.verticalOrigin=this._verticalOrigin,e.heightReference=this._heightReference,e.color=this._color,e.rotation=this._rotation,e.alignedAxis=this._alignedAxis,e.sizeInMeters=this._sizeInMeters,e.width=this._width,e.height=this._height,e.scaleByDistance=this._scaleByDistance,e.translucencyByDistance=this._translucencyByDistance,e.pixelOffsetScaleByDistance=this._pixelOffsetScaleByDistance,e.imageSubRegion=this._imageSubRegion,e.distanceDisplayCondition=this._distanceDisplayCondition,e.disableDepthTestDistance=this._disableDepthTestDistance,e):new Cz(this)},Cz.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this._show,e.show),this.image=R(this._image,e.image),this.scale=R(this._scale,e.scale),this.pixelOffset=R(this._pixelOffset,e.pixelOffset),this.eyeOffset=R(this._eyeOffset,e.eyeOffset),this.horizontalOrigin=R(this._horizontalOrigin,e.horizontalOrigin),this.verticalOrigin=R(this._verticalOrigin,e.verticalOrigin),this.heightReference=R(this._heightReference,e.heightReference),this.color=R(this._color,e.color),this.rotation=R(this._rotation,e.rotation),this.alignedAxis=R(this._alignedAxis,e.alignedAxis),this.sizeInMeters=R(this._sizeInMeters,e.sizeInMeters),this.width=R(this._width,e.width),this.height=R(this._height,e.height),this.scaleByDistance=R(this._scaleByDistance,e.scaleByDistance),this.translucencyByDistance=R(this._translucencyByDistance,e.translucencyByDistance),this.pixelOffsetScaleByDistance=R(this._pixelOffsetScaleByDistance,e.pixelOffsetScaleByDistance),this.imageSubRegion=R(this._imageSubRegion,e.imageSubRegion),this.distanceDisplayCondition=R(this._distanceDisplayCondition,e.distanceDisplayCondition),this.disableDepthTestDistance=R(this._disableDepthTestDistance,e.disableDepthTestDistance)};var Ez=Cz;const xz={NONE:0,CLAMP_TO_GROUND:1,RELATIVE_TO_GROUND:2};var Sz=Object.freeze(xz);const Iz={CENTER:0,LEFT:1,RIGHT:-1};var Oz=Object.freeze(Iz);const Dz={CENTER:0,BOTTOM:1,BASELINE:2,TOP:-1};var Pz=Object.freeze(Dz);const Rz={DONE:0,PENDING:1,FAILED:2};var Lz=Object.freeze(Rz);function Mz(){x.throwInstantiationError()}Object.defineProperties(Mz.prototype,{isConstant:{get:x.throwInstantiationError},definitionChanged:{get:x.throwInstantiationError}}),Mz.prototype.getValue=x.throwInstantiationError,Mz.prototype.equals=x.throwInstantiationError,Mz.equals=function(e,t){return e===t||C(e)&&e.equals(t)},Mz.arrayEquals=function(e,t){if(e===t)return!0;if(!C(e)||!C(t)||e.length!==t.length)return!1;const n=e.length;for(let i=0;i<n;i++)if(!Mz.equals(e[i],t[i]))return!1;return!0},Mz.isConstant=function(e){return!C(e)||e.isConstant},Mz.getValueOrUndefined=function(e,t,n){return C(e)?e.getValue(t,n):void 0},Mz.getValueOrDefault=function(e,t,n,i){return C(e)?R(e.getValue(t,i),n):n},Mz.getValueOrClonedDefault=function(e,t,n,i){let o;return C(e)&&(o=e.getValue(t,i)),C(o)||(o=n.clone(o)),o};var Bz=Mz;const Nz=xy.WHITE,Fz=K.ZERO,zz=Sz.NONE,kz=ro.ZERO,Uz=1,Vz=0,Hz=K.ZERO,Gz=Oz.CENTER,Wz=Pz.CENTER,qz=!1,jz=new K,Yz=new xy,Kz=new K,Xz=new ro,Qz=new LO,Jz=new LO,Zz=new LO,$z=new bf,ek=new WT;function tk(e){this.entity=e,this.billboard=void 0,this.textureValue=void 0}function nk(e,t){if(!C(e))throw new x("entityCluster is required.");if(!C(t))throw new x("entityCollection is required.");t.collectionChanged.addEventListener(nk.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new ff,this._onCollectionChanged(t,t.values,[],[])}function ik(e,t,n){C(e)&&(e.billboard=void 0,n.removeBillboard(t))}nk.prototype.update=function(e){if(!C(e))throw new x("time is required.");const t=this._items.values,n=this._cluster;for(let i=0,o=t.length;i<o;i++){const o=t[i],r=o.entity,s=r._billboard;let a,c,l=o.billboard,u=r.isShowing&&r.isAvailable(e)&&Bz.getValueOrDefault(s._show,e,!0);if(u&&(c=Bz.getValueOrUndefined(r._position,e,jz),a=Bz.getValueOrUndefined(s._image,e),u=C(c)&&C(a)),!u){ik(o,r,n);continue}Bz.isConstant(r._position)||(n._clusterDirty=!0),C(l)||(l=n.getBillboard(r),l.id=r,l.image=void 0,o.billboard=l),l.show=u,C(l.image)&&o.textureValue===a||(l.image=a,o.textureValue=a),l.position=c,l.color=Bz.getValueOrDefault(s._color,e,Nz,Yz),l.eyeOffset=Bz.getValueOrDefault(s._eyeOffset,e,Fz,Kz),l.heightReference=Bz.getValueOrDefault(s._heightReference,e,zz),l.pixelOffset=Bz.getValueOrDefault(s._pixelOffset,e,kz,Xz),l.scale=Bz.getValueOrDefault(s._scale,e,Uz),l.rotation=Bz.getValueOrDefault(s._rotation,e,Vz),l.alignedAxis=Bz.getValueOrDefault(s._alignedAxis,e,Hz),l.horizontalOrigin=Bz.getValueOrDefault(s._horizontalOrigin,e,Gz),l.verticalOrigin=Bz.getValueOrDefault(s._verticalOrigin,e,Wz),l.width=Bz.getValueOrUndefined(s._width,e),l.height=Bz.getValueOrUndefined(s._height,e),l.scaleByDistance=Bz.getValueOrUndefined(s._scaleByDistance,e,Qz),l.translucencyByDistance=Bz.getValueOrUndefined(s._translucencyByDistance,e,Jz),l.pixelOffsetScaleByDistance=Bz.getValueOrUndefined(s._pixelOffsetScaleByDistance,e,Zz),l.sizeInMeters=Bz.getValueOrDefault(s._sizeInMeters,e,qz),l.distanceDisplayCondition=Bz.getValueOrUndefined(s._distanceDisplayCondition,e,ek),l.disableDepthTestDistance=Bz.getValueOrUndefined(s._disableDepthTestDistance,e);const h=Bz.getValueOrUndefined(s._imageSubRegion,e,$z);C(h)&&l.setImageSubRegion(l._imageId,h)}return!0},nk.prototype.getBoundingSphere=function(e,t){if(!C(e))throw new x("entity is required.");if(!C(t))throw new x("result is required.");const n=this._items.get(e.id);if(!C(n)||!C(n.billboard))return Lz.FAILED;const i=n.billboard;if(i.heightReference===Sz.NONE)t.center=K.clone(i.position,t.center);else{if(!C(i._clampedPosition))return Lz.PENDING;t.center=K.clone(i._clampedPosition,t.center)}return t.radius=0,Lz.DONE},nk.prototype.isDestroyed=function(){return!1},nk.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(nk.prototype._onCollectionChanged,this);const e=this._entityCollection.values;for(let t=0;t<e.length;t++)this._cluster.removeBillboard(e[t]);return Qh(this)},nk.prototype._onCollectionChanged=function(e,t,n,i){let o,r;const s=this._items,a=this._cluster;for(o=t.length-1;o>-1;o--)r=t[o],C(r._billboard)&&C(r._position)&&s.set(r.id,new tk(r));for(o=i.length-1;o>-1;o--)r=i[o],C(r._billboard)&&C(r._position)?s.contains(r.id)||s.set(r.id,new tk(r)):(ik(s.get(r.id),r,a),s.remove(r.id));for(o=n.length-1;o>-1;o--)r=n[o],ik(s.get(r.id),r,a),s.remove(r.id)};var ok=nk,rk="varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n    mat3 tangentToEyeMatrix = czm_tangentToEyeSpaceMatrix(v_normalEC, v_tangentEC, v_bitangentEC);\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.tangentToEyeMatrix = tangentToEyeMatrix;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n",sk="attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec3 tangent;\nattribute vec3 bitangent;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_tangentEC = czm_normal * tangent;                       // tangent in eye coordinates\n    v_bitangentEC = czm_normal * bitangent;                   // bitangent in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",ak="varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n",ck="attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",lk="varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n",uk="attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n";const hk={ADD:th.FUNC_ADD,SUBTRACT:th.FUNC_SUBTRACT,REVERSE_SUBTRACT:th.FUNC_REVERSE_SUBTRACT,MIN:th.MIN,MAX:th.MAX};var dk=Object.freeze(hk);const fk={ZERO:th.ZERO,ONE:th.ONE,SOURCE_COLOR:th.SRC_COLOR,ONE_MINUS_SOURCE_COLOR:th.ONE_MINUS_SRC_COLOR,DESTINATION_COLOR:th.DST_COLOR,ONE_MINUS_DESTINATION_COLOR:th.ONE_MINUS_DST_COLOR,SOURCE_ALPHA:th.SRC_ALPHA,ONE_MINUS_SOURCE_ALPHA:th.ONE_MINUS_SRC_ALPHA,DESTINATION_ALPHA:th.DST_ALPHA,ONE_MINUS_DESTINATION_ALPHA:th.ONE_MINUS_DST_ALPHA,CONSTANT_COLOR:th.CONSTANT_COLOR,ONE_MINUS_CONSTANT_COLOR:th.ONE_MINUS_CONSTANT_COLOR,CONSTANT_ALPHA:th.CONSTANT_ALPHA,ONE_MINUS_CONSTANT_ALPHA:th.ONE_MINUS_CONSTANT_ALPHA,SOURCE_ALPHA_SATURATE:th.SRC_ALPHA_SATURATE};var pk=Object.freeze(fk);const mk={DISABLED:Object.freeze({enabled:!1}),ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:dk.ADD,equationAlpha:dk.ADD,functionSourceRgb:pk.SOURCE_ALPHA,functionSourceAlpha:pk.ONE,functionDestinationRgb:pk.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:pk.ONE_MINUS_SOURCE_ALPHA}),PRE_MULTIPLIED_ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:dk.ADD,equationAlpha:dk.ADD,functionSourceRgb:pk.ONE,functionSourceAlpha:pk.ONE,functionDestinationRgb:pk.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:pk.ONE_MINUS_SOURCE_ALPHA}),ADDITIVE_BLEND:Object.freeze({enabled:!0,equationRgb:dk.ADD,equationAlpha:dk.ADD,functionSourceRgb:pk.SOURCE_ALPHA,functionSourceAlpha:pk.ONE,functionDestinationRgb:pk.ONE,functionDestinationAlpha:pk.ONE})};var _k=Object.freeze(mk);const gk={FRONT:th.FRONT,BACK:th.BACK,FRONT_AND_BACK:th.FRONT_AND_BACK};var yk=Object.freeze(gk);function vk(e){e=R(e,R.EMPTY_OBJECT),this.material=e.material,this.translucent=R(e.translucent,!0),this._vertexShaderSource=e.vertexShaderSource,this._fragmentShaderSource=e.fragmentShaderSource,this._renderState=e.renderState,this._closed=R(e.closed,!1)}Object.defineProperties(vk.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}}}),vk.prototype.getFragmentShaderSource=function(){const e=[];return this.flat&&e.push("#define FLAT"),this.faceForward&&e.push("#define FACE_FORWARD"),C(this.material)&&e.push(this.material.shaderSource),e.push(this.fragmentShaderSource),e.join("\n")},vk.prototype.isTranslucent=function(){return C(this.material)&&this.material.isTranslucent()||!C(this.material)&&this.translucent},vk.prototype.getRenderState=function(){const e=this.isTranslucent(),t=pn(this.renderState,!1);return e?(t.depthMask=!1,t.blending=_k.ALPHA_BLEND):t.depthMask=!0,t},vk.getDefaultRenderState=function(e,t,n){let i={depthTest:{enabled:!0}};return e&&(i.depthMask=!1,i.blending=_k.ALPHA_BLEND),t&&(i.cull={enabled:!0,face:yk.BACK}),C(n)&&(i=_n(n,i,!0)),i};var bk=vk;function Ak(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)}))}var wk=Ak;const Tk={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:0,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_maximumSamples:0,_highpFloatSupported:!1,_highpIntSupported:!1};Object.defineProperties(Tk,{maximumCombinedTextureImageUnits:{get:function(){return Tk._maximumCombinedTextureImageUnits}},maximumCubeMapSize:{get:function(){return Tk._maximumCubeMapSize}},maximumFragmentUniformVectors:{get:function(){return Tk._maximumFragmentUniformVectors}},maximumTextureImageUnits:{get:function(){return Tk._maximumTextureImageUnits}},maximumRenderbufferSize:{get:function(){return Tk._maximumRenderbufferSize}},maximumTextureSize:{get:function(){return Tk._maximumTextureSize}},maximumVaryingVectors:{get:function(){return Tk._maximumVaryingVectors}},maximumVertexAttributes:{get:function(){return Tk._maximumVertexAttributes}},maximumVertexTextureImageUnits:{get:function(){return Tk._maximumVertexTextureImageUnits}},maximumVertexUniformVectors:{get:function(){return Tk._maximumVertexUniformVectors}},minimumAliasedLineWidth:{get:function(){return Tk._minimumAliasedLineWidth}},maximumAliasedLineWidth:{get:function(){return Tk._maximumAliasedLineWidth}},minimumAliasedPointSize:{get:function(){return Tk._minimumAliasedPointSize}},maximumAliasedPointSize:{get:function(){return Tk._maximumAliasedPointSize}},maximumViewportWidth:{get:function(){return Tk._maximumViewportWidth}},maximumViewportHeight:{get:function(){return Tk._maximumViewportHeight}},maximumTextureFilterAnisotropy:{get:function(){return Tk._maximumTextureFilterAnisotropy}},maximumDrawBuffers:{get:function(){return Tk._maximumDrawBuffers}},maximumColorAttachments:{get:function(){return Tk._maximumColorAttachments}},maximumSamples:{get:function(){return Tk._maximumSamples}},highpFloatSupported:{get:function(){return Tk._highpFloatSupported}},highpIntSupported:{get:function(){return Tk._highpIntSupported}}});var Ck=Tk;function Ek(e,t,n,i,o,r,s,a,c,l,u){this._context=e,this._texture=t,this._textureTarget=n,this._targetFace=i,this._pixelDatatype=s,this._internalFormat=o,this._pixelFormat=r,this._size=a,this._preMultiplyAlpha=c,this._flipY=l,this._initialized=u}Object.defineProperties(Ek.prototype,{pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},_target:{get:function(){return this._targetFace}}}),Ek.prototype.copyFrom=function(e){D.defined("options",e);const t=R(e.xOffset,0),n=R(e.yOffset,0);if(D.defined("options.source",e.source),D.typeOf.number.greaterThanOrEquals("xOffset",t,0),D.typeOf.number.greaterThanOrEquals("yOffset",n,0),t+e.source.width>this._size)throw new x("xOffset + options.source.width must be less than or equal to width.");if(n+e.source.height>this._size)throw new x("yOffset + options.source.height must be less than or equal to height.");const i=e.source,o=this._context._gl,r=this._textureTarget,s=this._targetFace;o.activeTexture(o.TEXTURE0),o.bindTexture(r,this._texture);const a=i.width,c=i.height;let l=i.arrayBufferView;const u=this._size,h=this._pixelFormat,d=this._internalFormat,f=this._pixelDatatype,p=this._preMultiplyAlpha,m=this._flipY,_=R(e.skipColorSpaceConversion,!1);let g=4;C(l)&&(g=fD.alignmentInBytes(h,f,a)),o.pixelStorei(o.UNPACK_ALIGNMENT,g),_?o.pixelStorei(o.UNPACK_COLORSPACE_CONVERSION_WEBGL,o.NONE):o.pixelStorei(o.UNPACK_COLORSPACE_CONVERSION_WEBGL,o.BROWSER_DEFAULT_WEBGL);let y=!1;if(!this._initialized){if(0===t&&0===n&&a===u&&c===u)C(l)?(o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1),m&&(l=fD.flipY(l,h,f,u,u)),o.texImage2D(s,0,d,u,u,0,h,hD.toWebGLConstant(f,this._context),l)):(o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,m),o.texImage2D(s,0,d,h,hD.toWebGLConstant(f,this._context),i)),y=!0;else{o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1);const e=fD.createTypedArray(h,f,u,u);o.texImage2D(s,0,d,u,u,0,h,hD.toWebGLConstant(f,this._context),e)}this._initialized=!0}y||(C(l)?(o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1),m&&(l=fD.flipY(l,h,f,a,c)),o.texSubImage2D(s,0,t,n,a,c,h,hD.toWebGLConstant(f,this._context),l)):(o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,m),o.texSubImage2D(s,0,t,n,h,hD.toWebGLConstant(f,this._context),i))),o.bindTexture(r,null)},Ek.prototype.copyFromFramebuffer=function(e,t,n,i,o,r){if(e=R(e,0),t=R(t,0),n=R(n,0),i=R(i,0),o=R(o,this._size),r=R(r,this._size),D.typeOf.number.greaterThanOrEquals("xOffset",e,0),D.typeOf.number.greaterThanOrEquals("yOffset",t,0),D.typeOf.number.greaterThanOrEquals("framebufferXOffset",n,0),D.typeOf.number.greaterThanOrEquals("framebufferYOffset",i,0),e+o>this._size)throw new x("xOffset + source.width must be less than or equal to width.");if(t+r>this._size)throw new x("yOffset + source.height must be less than or equal to height.");if(this._pixelDatatype===hD.FLOAT)throw new x("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this._pixelDatatype===hD.HALF_FLOAT)throw new x("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");const s=this._context._gl,a=this._textureTarget;s.activeTexture(s.TEXTURE0),s.bindTexture(a,this._texture),s.copyTexSubImage2D(this._targetFace,0,e,t,n,i,o,r),s.bindTexture(a,null),this._initialized=!0};var xk=Ek;const Sk={DONT_CARE:th.DONT_CARE,FASTEST:th.FASTEST,NICEST:th.NICEST,validate:function(e){return e===Sk.DONT_CARE||e===Sk.FASTEST||e===Sk.NICEST}};var Ik=Object.freeze(Sk);const Ok={NEAREST:th.NEAREST,LINEAR:th.LINEAR,validate:function(e){return e===Ok.NEAREST||e===Ok.LINEAR}};var Dk=Object.freeze(Ok);const Pk={NEAREST:th.NEAREST,LINEAR:th.LINEAR,NEAREST_MIPMAP_NEAREST:th.NEAREST_MIPMAP_NEAREST,LINEAR_MIPMAP_NEAREST:th.LINEAR_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:th.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_LINEAR:th.LINEAR_MIPMAP_LINEAR,validate:function(e){return e===Pk.NEAREST||e===Pk.LINEAR||e===Pk.NEAREST_MIPMAP_NEAREST||e===Pk.LINEAR_MIPMAP_NEAREST||e===Pk.NEAREST_MIPMAP_LINEAR||e===Pk.LINEAR_MIPMAP_LINEAR}};var Rk=Object.freeze(Pk);const Lk={CLAMP_TO_EDGE:th.CLAMP_TO_EDGE,REPEAT:th.REPEAT,MIRRORED_REPEAT:th.MIRRORED_REPEAT,validate:function(e){return e===Lk.CLAMP_TO_EDGE||e===Lk.REPEAT||e===Lk.MIRRORED_REPEAT}};var Mk=Object.freeze(Lk);function Bk(e){e=R(e,R.EMPTY_OBJECT);const t=R(e.wrapS,Mk.CLAMP_TO_EDGE),n=R(e.wrapT,Mk.CLAMP_TO_EDGE),i=R(e.minificationFilter,Rk.LINEAR),o=R(e.magnificationFilter,Dk.LINEAR),r=C(e.maximumAnisotropy)?e.maximumAnisotropy:1;if(!Mk.validate(t))throw new x("Invalid sampler.wrapS.");if(!Mk.validate(n))throw new x("Invalid sampler.wrapT.");if(!Rk.validate(i))throw new x("Invalid sampler.minificationFilter.");if(!Dk.validate(o))throw new x("Invalid sampler.magnificationFilter.");D.typeOf.number.greaterThanOrEquals("maximumAnisotropy",r,1),this._wrapS=t,this._wrapT=n,this._minificationFilter=i,this._magnificationFilter=o,this._maximumAnisotropy=r}Object.defineProperties(Bk.prototype,{wrapS:{get:function(){return this._wrapS}},wrapT:{get:function(){return this._wrapT}},minificationFilter:{get:function(){return this._minificationFilter}},magnificationFilter:{get:function(){return this._magnificationFilter}},maximumAnisotropy:{get:function(){return this._maximumAnisotropy}}}),Bk.equals=function(e,t){return e===t||C(e)&&C(t)&&e._wrapS===t._wrapS&&e._wrapT===t._wrapT&&e._minificationFilter===t._minificationFilter&&e._magnificationFilter===t._magnificationFilter&&e._maximumAnisotropy===t._maximumAnisotropy},Bk.NEAREST=Object.freeze(new Bk({wrapS:Mk.CLAMP_TO_EDGE,wrapT:Mk.CLAMP_TO_EDGE,minificationFilter:Rk.NEAREST,magnificationFilter:Dk.NEAREST}));var Nk=Bk;function Fk(e){e=R(e,R.EMPTY_OBJECT),D.defined("options.context",e.context);const t=e.context,n=e.source;let i,o;if(C(n)){const e=[n.positiveX,n.negativeX,n.positiveY,n.negativeY,n.positiveZ,n.negativeZ];if(!e[0]||!e[1]||!e[2]||!e[3]||!e[4]||!e[5])throw new x("options.source requires positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ faces.");i=e[0].width,o=e[0].height;for(let t=1;t<6;++t)if(Number(e[t].width)!==i||Number(e[t].height)!==o)throw new x("Each face in options.source must have the same width and height.")}else i=e.width,o=e.height;const r=i,s=R(e.pixelDatatype,hD.UNSIGNED_BYTE),a=R(e.pixelFormat,fD.RGBA),c=fD.toInternalFormat(a,s,t);if(!C(i)||!C(o))throw new x("options requires a source field to create an initialized cube map or width and height fields to create a blank cube map.");if(i!==o)throw new x("Width must equal height.");if(r<=0)throw new x("Width and height must be greater than zero.");if(r>Ck.maximumCubeMapSize)throw new x(`Width and height must be less than or equal to the maximum cube map size (${Ck.maximumCubeMapSize}).  Check maximumCubeMapSize.`);if(!fD.validate(a))throw new x("Invalid options.pixelFormat.");if(fD.isDepthFormat(a))throw new x("options.pixelFormat cannot be DEPTH_COMPONENT or DEPTH_STENCIL.");if(!hD.validate(s))throw new x("Invalid options.pixelDatatype.");if(s===hD.FLOAT&&!t.floatingPointTexture)throw new x("When options.pixelDatatype is FLOAT, this WebGL implementation must support the OES_texture_float extension.");if(s===hD.HALF_FLOAT&&!t.halfFloatingPointTexture)throw new x("When options.pixelDatatype is HALF_FLOAT, this WebGL implementation must support the OES_texture_half_float extension.");const l=6*fD.textureSizeInBytes(a,s,r,r),u=e.preMultiplyAlpha||a===fD.RGB||a===fD.LUMINANCE,h=R(e.flipY,!0),d=R(e.skipColorSpaceConversion,!1),f=t._gl,p=f.TEXTURE_CUBE_MAP,m=f.createTexture();function _(e,n,o,l,u){let h=n.arrayBufferView;C(h)||(h=n.bufferView);let d=4;C(h)&&(d=fD.alignmentInBytes(a,s,i)),f.pixelStorei(f.UNPACK_ALIGNMENT,d),u?f.pixelStorei(f.UNPACK_COLORSPACE_CONVERSION_WEBGL,f.NONE):f.pixelStorei(f.UNPACK_COLORSPACE_CONVERSION_WEBGL,f.BROWSER_DEFAULT_WEBGL),C(h)?(f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1),l&&(h=fD.flipY(h,a,s,r,r)),f.texImage2D(e,0,c,r,r,0,a,hD.toWebGLConstant(s,t),h)):(f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l),f.texImage2D(e,0,c,a,hD.toWebGLConstant(s,t),n))}f.activeTexture(f.TEXTURE0),f.bindTexture(p,m),C(n)?(_(f.TEXTURE_CUBE_MAP_POSITIVE_X,n.positiveX,u,h,d),_(f.TEXTURE_CUBE_MAP_NEGATIVE_X,n.negativeX,u,h,d),_(f.TEXTURE_CUBE_MAP_POSITIVE_Y,n.positiveY,u,h,d),_(f.TEXTURE_CUBE_MAP_NEGATIVE_Y,n.negativeY,u,h,d),_(f.TEXTURE_CUBE_MAP_POSITIVE_Z,n.positiveZ,u,h,d),_(f.TEXTURE_CUBE_MAP_NEGATIVE_Z,n.negativeZ,u,h,d)):(f.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X,0,c,r,r,0,a,hD.toWebGLConstant(s,t),null),f.texImage2D(f.TEXTURE_CUBE_MAP_NEGATIVE_X,0,c,r,r,0,a,hD.toWebGLConstant(s,t),null),f.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_Y,0,c,r,r,0,a,hD.toWebGLConstant(s,t),null),f.texImage2D(f.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,c,r,r,0,a,hD.toWebGLConstant(s,t),null),f.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_Z,0,c,r,r,0,a,hD.toWebGLConstant(s,t),null),f.texImage2D(f.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,c,r,r,0,a,hD.toWebGLConstant(s,t),null)),f.bindTexture(p,null),this._context=t,this._textureFilterAnisotropic=t._textureFilterAnisotropic,this._textureTarget=p,this._texture=m,this._pixelFormat=a,this._pixelDatatype=s,this._size=r,this._hasMipmap=!1,this._sizeInBytes=l,this._preMultiplyAlpha=u,this._flipY=h,this._sampler=void 0;const g=C(n);this._positiveX=new xk(t,m,p,f.TEXTURE_CUBE_MAP_POSITIVE_X,c,a,s,r,u,h,g),this._negativeX=new xk(t,m,p,f.TEXTURE_CUBE_MAP_NEGATIVE_X,c,a,s,r,u,h,g),this._positiveY=new xk(t,m,p,f.TEXTURE_CUBE_MAP_POSITIVE_Y,c,a,s,r,u,h,g),this._negativeY=new xk(t,m,p,f.TEXTURE_CUBE_MAP_NEGATIVE_Y,c,a,s,r,u,h,g),this._positiveZ=new xk(t,m,p,f.TEXTURE_CUBE_MAP_POSITIVE_Z,c,a,s,r,u,h,g),this._negativeZ=new xk(t,m,p,f.TEXTURE_CUBE_MAP_NEGATIVE_Z,c,a,s,r,u,h,g),this.sampler=C(e.sampler)?e.sampler:new Nk}Object.defineProperties(Fk.prototype,{positiveX:{get:function(){return this._positiveX}},negativeX:{get:function(){return this._negativeX}},positiveY:{get:function(){return this._positiveY}},negativeY:{get:function(){return this._negativeY}},positiveZ:{get:function(){return this._positiveZ}},negativeZ:{get:function(){return this._negativeZ}},sampler:{get:function(){return this._sampler},set:function(e){let t=e.minificationFilter,n=e.magnificationFilter;const i=t===Rk.NEAREST_MIPMAP_NEAREST||t===Rk.NEAREST_MIPMAP_LINEAR||t===Rk.LINEAR_MIPMAP_NEAREST||t===Rk.LINEAR_MIPMAP_LINEAR,o=this._context,r=this._pixelDatatype;(r===hD.FLOAT&&!o.textureFloatLinear||r===hD.HALF_FLOAT&&!o.textureHalfFloatLinear)&&(t=i?Rk.NEAREST_MIPMAP_NEAREST:Rk.NEAREST,n=Dk.NEAREST);const s=o._gl,a=this._textureTarget;s.activeTexture(s.TEXTURE0),s.bindTexture(a,this._texture),s.texParameteri(a,s.TEXTURE_MIN_FILTER,t),s.texParameteri(a,s.TEXTURE_MAG_FILTER,n),s.texParameteri(a,s.TEXTURE_WRAP_S,e.wrapS),s.texParameteri(a,s.TEXTURE_WRAP_T,e.wrapT),C(this._textureFilterAnisotropic)&&s.texParameteri(a,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.maximumAnisotropy),s.bindTexture(a,null),this._sampler=e}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},width:{get:function(){return this._size}},height:{get:function(){return this._size}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},_target:{get:function(){return this._textureTarget}}}),Fk.prototype.generateMipmap=function(e){if(e=R(e,Ik.DONT_CARE),this._size>1&&!z.isPowerOfTwo(this._size))throw new x("width and height must be a power of two to call generateMipmap().");if(!Ik.validate(e))throw new x("hint is invalid.");this._hasMipmap=!0;const t=this._context._gl,n=this._textureTarget;t.hint(t.GENERATE_MIPMAP_HINT,e),t.activeTexture(t.TEXTURE0),t.bindTexture(n,this._texture),t.generateMipmap(n),t.bindTexture(n,null)},Fk.prototype.isDestroyed=function(){return!1},Fk.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),this._positiveX=Qh(this._positiveX),this._negativeX=Qh(this._negativeX),this._positiveY=Qh(this._positiveY),this._negativeY=Qh(this._negativeY),this._positiveZ=Qh(this._positiveZ),this._negativeZ=Qh(this._negativeZ),Qh(this)};var zk=Fk;function kk(e){e=R(e,R.EMPTY_OBJECT),D.defined("options.context",e.context);const t=e.context;let n=e.width,i=e.height;const o=e.source;C(o)&&(C(n)||(n=R(o.videoWidth,o.width)),C(i)||(i=R(o.videoHeight,o.height)));const r=R(e.pixelFormat,fD.RGBA),s=R(e.pixelDatatype,hD.UNSIGNED_BYTE),a=fD.toInternalFormat(r,s,t),c=fD.isCompressedFormat(a);if(!C(n)||!C(i))throw new x("options requires a source field to create an initialized texture or width and height fields to create a blank texture.");if(D.typeOf.number.greaterThan("width",n,0),n>Ck.maximumTextureSize)throw new x(`Width must be less than or equal to the maximum texture size (${Ck.maximumTextureSize}).  Check maximumTextureSize.`);if(D.typeOf.number.greaterThan("height",i,0),i>Ck.maximumTextureSize)throw new x(`Height must be less than or equal to the maximum texture size (${Ck.maximumTextureSize}).  Check maximumTextureSize.`);if(!fD.validate(r))throw new x("Invalid options.pixelFormat.");if(!c&&!hD.validate(s))throw new x("Invalid options.pixelDatatype.");if(r===fD.DEPTH_COMPONENT&&s!==hD.UNSIGNED_SHORT&&s!==hD.UNSIGNED_INT)throw new x("When options.pixelFormat is DEPTH_COMPONENT, options.pixelDatatype must be UNSIGNED_SHORT or UNSIGNED_INT.");if(r===fD.DEPTH_STENCIL&&s!==hD.UNSIGNED_INT_24_8)throw new x("When options.pixelFormat is DEPTH_STENCIL, options.pixelDatatype must be UNSIGNED_INT_24_8.");if(s===hD.FLOAT&&!t.floatingPointTexture)throw new x("When options.pixelDatatype is FLOAT, this WebGL implementation must support the OES_texture_float extension.  Check context.floatingPointTexture.");if(s===hD.HALF_FLOAT&&!t.halfFloatingPointTexture)throw new x("When options.pixelDatatype is HALF_FLOAT, this WebGL implementation must support the OES_texture_half_float extension. Check context.halfFloatingPointTexture.");if(fD.isDepthFormat(r)){if(C(o))throw new x("When options.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, source cannot be provided.");if(!t.depthTexture)throw new x("When options.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, this WebGL implementation must support WEBGL_depth_texture.  Check context.depthTexture.")}if(c){if(!C(o)||!C(o.arrayBufferView))throw new x("When options.pixelFormat is compressed, options.source.arrayBufferView must be defined.");if(fD.isDXTFormat(a)&&!t.s3tc)throw new x("When options.pixelFormat is S3TC compressed, this WebGL implementation must support the WEBGL_compressed_texture_s3tc extension. Check context.s3tc.");if(fD.isPVRTCFormat(a)&&!t.pvrtc)throw new x("When options.pixelFormat is PVRTC compressed, this WebGL implementation must support the WEBGL_compressed_texture_pvrtc extension. Check context.pvrtc.");if(fD.isASTCFormat(a)&&!t.astc)throw new x("When options.pixelFormat is ASTC compressed, this WebGL implementation must support the WEBGL_compressed_texture_astc extension. Check context.astc.");if(fD.isETC2Format(a)&&!t.etc)throw new x("When options.pixelFormat is ETC2 compressed, this WebGL implementation must support the WEBGL_compressed_texture_etc extension. Check context.etc.");if(fD.isETC1Format(a)&&!t.etc1)throw new x("When options.pixelFormat is ETC1 compressed, this WebGL implementation must support the WEBGL_compressed_texture_etc1 extension. Check context.etc1.");if(fD.isBC7Format(a)&&!t.bc7)throw new x("When options.pixelFormat is BC7 compressed, this WebGL implementation must support the EXT_texture_compression_bptc extension. Check context.bc7.");if(fD.compressedTextureSizeInBytes(a,n,i)!==o.arrayBufferView.byteLength)throw new x("The byte length of the array buffer is invalid for the compressed texture with the given width and height.")}const l=e.preMultiplyAlpha||r===fD.RGB||r===fD.LUMINANCE,u=R(e.flipY,!0),h=R(e.skipColorSpaceConversion,!1);let d=!0;const f=t._gl,p=f.TEXTURE_2D,m=f.createTexture();f.activeTexture(f.TEXTURE0),f.bindTexture(p,m);let _,g=4;if(C(o)&&C(o.arrayBufferView)&&!c&&(g=fD.alignmentInBytes(r,s,n)),f.pixelStorei(f.UNPACK_ALIGNMENT,g),h?f.pixelStorei(f.UNPACK_COLORSPACE_CONVERSION_WEBGL,f.NONE):f.pixelStorei(f.UNPACK_COLORSPACE_CONVERSION_WEBGL,f.BROWSER_DEFAULT_WEBGL),C(o))if(C(o.arrayBufferView)){f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1);let e,l,h,d=o.arrayBufferView;if(c){if(f.compressedTexImage2D(p,0,a,n,i,0,d),C(o.mipLevels))for(l=n,h=i,e=0;e<o.mipLevels.length;++e)l=0|Math.floor(l/2),l<1&&(l=1),h=0|Math.floor(h/2),h<1&&(h=1),f.compressedTexImage2D(p,e+1,a,l,h,0,o.mipLevels[e])}else if(u&&(d=fD.flipY(d,r,s,n,i)),f.texImage2D(p,0,a,n,i,0,r,hD.toWebGLConstant(s,t),d),C(o.mipLevels))for(l=n,h=i,e=0;e<o.mipLevels.length;++e)l=0|Math.floor(l/2),l<1&&(l=1),h=0|Math.floor(h/2),h<1&&(h=1),f.texImage2D(p,e+1,a,l,h,0,r,hD.toWebGLConstant(s,t),o.mipLevels[e])}else C(o.framebuffer)?(f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1),o.framebuffer!==t.defaultFramebuffer&&o.framebuffer._bind(),f.copyTexImage2D(p,0,a,o.xOffset,o.yOffset,n,i,0),o.framebuffer!==t.defaultFramebuffer&&o.framebuffer._unBind()):(f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,u),f.texImage2D(p,0,a,r,hD.toWebGLConstant(s,t),o));else f.texImage2D(p,0,a,n,i,0,r,hD.toWebGLConstant(s,t),null),d=!1;f.bindTexture(p,null),_=c?fD.compressedTextureSizeInBytes(r,n,i):fD.textureSizeInBytes(r,s,n,i),this._id=wk(),this._context=t,this._textureFilterAnisotropic=t._textureFilterAnisotropic,this._textureTarget=p,this._texture=m,this._internalFormat=a,this._pixelFormat=r,this._pixelDatatype=s,this._width=n,this._height=i,this._dimensions=new ro(n,i),this._hasMipmap=!1,this._sizeInBytes=_,this._preMultiplyAlpha=l,this._flipY=u,this._initialized=d,this._sampler=void 0,this.sampler=C(e.sampler)?e.sampler:new Nk}kk.create=function(e){return new kk(e)},kk.fromFramebuffer=function(e){e=R(e,R.EMPTY_OBJECT),D.defined("options.context",e.context);const t=e.context,n=t._gl,i=R(e.pixelFormat,fD.RGB),o=R(e.framebufferXOffset,0),r=R(e.framebufferYOffset,0),s=R(e.width,n.drawingBufferWidth),a=R(e.height,n.drawingBufferHeight),c=e.framebuffer;if(!fD.validate(i))throw new x("Invalid pixelFormat.");if(fD.isDepthFormat(i)||fD.isCompressedFormat(i))throw new x("pixelFormat cannot be DEPTH_COMPONENT, DEPTH_STENCIL or a compressed format.");if(D.defined("options.context",e.context),D.typeOf.number.greaterThanOrEquals("framebufferXOffset",o,0),D.typeOf.number.greaterThanOrEquals("framebufferYOffset",r,0),o+s>n.drawingBufferWidth)throw new x("framebufferXOffset + width must be less than or equal to drawingBufferWidth");if(r+a>n.drawingBufferHeight)throw new x("framebufferYOffset + height must be less than or equal to drawingBufferHeight.");const l=new kk({context:t,width:s,height:a,pixelFormat:i,source:{framebuffer:C(c)?c:t.defaultFramebuffer,xOffset:o,yOffset:r,width:s,height:a}});return l},Object.defineProperties(kk.prototype,{id:{get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(e){let t=e.minificationFilter,n=e.magnificationFilter;const i=this._context,o=this._pixelFormat,r=this._pixelDatatype,s=t===Rk.NEAREST_MIPMAP_NEAREST||t===Rk.NEAREST_MIPMAP_LINEAR||t===Rk.LINEAR_MIPMAP_NEAREST||t===Rk.LINEAR_MIPMAP_LINEAR;(r===hD.FLOAT&&!i.textureFloatLinear||r===hD.HALF_FLOAT&&!i.textureHalfFloatLinear)&&(t=s?Rk.NEAREST_MIPMAP_NEAREST:Rk.NEAREST,n=Dk.NEAREST),i.webgl2&&fD.isDepthFormat(o)&&(t=Rk.NEAREST,n=Dk.NEAREST);const a=i._gl,c=this._textureTarget;a.activeTexture(a.TEXTURE0),a.bindTexture(c,this._texture),a.texParameteri(c,a.TEXTURE_MIN_FILTER,t),a.texParameteri(c,a.TEXTURE_MAG_FILTER,n),a.texParameteri(c,a.TEXTURE_WRAP_S,e.wrapS),a.texParameteri(c,a.TEXTURE_WRAP_T,e.wrapT),C(this._textureFilterAnisotropic)&&a.texParameteri(c,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.maximumAnisotropy),a.bindTexture(c,null),this._sampler=e}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}}}),kk.prototype.copyFrom=function(e){D.defined("options",e);const t=R(e.xOffset,0),n=R(e.yOffset,0);if(D.defined("options.source",e.source),fD.isDepthFormat(this._pixelFormat))throw new x("Cannot call copyFrom when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(fD.isCompressedFormat(this._pixelFormat))throw new x("Cannot call copyFrom with a compressed texture pixel format.");D.typeOf.number.greaterThanOrEquals("xOffset",t,0),D.typeOf.number.greaterThanOrEquals("yOffset",n,0),D.typeOf.number.lessThanOrEquals("xOffset + options.source.width",t+e.source.width,this._width),D.typeOf.number.lessThanOrEquals("yOffset + options.source.height",n+e.source.height,this._height);const i=e.source,o=this._context,r=o._gl,s=this._textureTarget;r.activeTexture(r.TEXTURE0),r.bindTexture(s,this._texture);const a=i.width,c=i.height;let l=i.arrayBufferView;const u=this._width,h=this._height,d=this._internalFormat,f=this._pixelFormat,p=this._pixelDatatype,m=this._preMultiplyAlpha,_=this._flipY,g=R(e.skipColorSpaceConversion,!1);let y=4;C(l)&&(y=fD.alignmentInBytes(f,p,a)),r.pixelStorei(r.UNPACK_ALIGNMENT,y),g?r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE):r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.BROWSER_DEFAULT_WEBGL);let v=!1;if(!this._initialized){if(0===t&&0===n&&a===u&&c===h)C(l)?(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),_&&(l=fD.flipY(l,f,p,u,h)),r.texImage2D(s,0,d,u,h,0,f,hD.toWebGLConstant(p,o),l)):(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,m),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,_),r.texImage2D(s,0,d,f,hD.toWebGLConstant(p,o),i)),v=!0;else{r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1);const e=fD.createTypedArray(f,p,u,h);r.texImage2D(s,0,d,u,h,0,f,hD.toWebGLConstant(p,o),e)}this._initialized=!0}v||(C(l)?(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),_&&(l=fD.flipY(l,f,p,a,c)),r.texSubImage2D(s,0,t,n,a,c,f,hD.toWebGLConstant(p,o),l)):(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,m),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,_),r.texSubImage2D(s,0,t,n,f,hD.toWebGLConstant(p,o),i))),r.bindTexture(s,null)},kk.prototype.copyFromFramebuffer=function(e,t,n,i,o,r){if(e=R(e,0),t=R(t,0),n=R(n,0),i=R(i,0),o=R(o,this._width),r=R(r,this._height),fD.isDepthFormat(this._pixelFormat))throw new x("Cannot call copyFromFramebuffer when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(this._pixelDatatype===hD.FLOAT)throw new x("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this._pixelDatatype===hD.HALF_FLOAT)throw new x("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");if(fD.isCompressedFormat(this._pixelFormat))throw new x("Cannot call copyFrom with a compressed texture pixel format.");D.typeOf.number.greaterThanOrEquals("xOffset",e,0),D.typeOf.number.greaterThanOrEquals("yOffset",t,0),D.typeOf.number.greaterThanOrEquals("framebufferXOffset",n,0),D.typeOf.number.greaterThanOrEquals("framebufferYOffset",i,0),D.typeOf.number.lessThanOrEquals("xOffset + width",e+o,this._width),D.typeOf.number.lessThanOrEquals("yOffset + height",t+r,this._height);const s=this._context._gl,a=this._textureTarget;s.activeTexture(s.TEXTURE0),s.bindTexture(a,this._texture),s.copyTexSubImage2D(a,0,e,t,n,i,o,r),s.bindTexture(a,null),this._initialized=!0},kk.prototype.generateMipmap=function(e){if(e=R(e,Ik.DONT_CARE),fD.isDepthFormat(this._pixelFormat))throw new x("Cannot call generateMipmap when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(fD.isCompressedFormat(this._pixelFormat))throw new x("Cannot call generateMipmap with a compressed pixel format.");if(this._width>1&&!z.isPowerOfTwo(this._width))throw new x("width must be a power of two to call generateMipmap().");if(this._height>1&&!z.isPowerOfTwo(this._height))throw new x("height must be a power of two to call generateMipmap().");if(!Ik.validate(e))throw new x("hint is invalid.");this._hasMipmap=!0;const t=this._context._gl,n=this._textureTarget;t.hint(t.GENERATE_MIPMAP_HINT,e),t.activeTexture(t.TEXTURE0),t.bindTexture(n,this._texture),t.generateMipmap(n),t.bindTexture(n,null)},kk.prototype.isDestroyed=function(){return!1},kk.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),Qh(this)};var Uk=kk,Vk="uniform sampler2D image;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    vec4 rampColor = texture2D(image, vec2(materialInput.aspect / (2.0 * czm_pi), 0.5));\n    rampColor = czm_gammaCorrect(rampColor);\n    material.diffuse = rampColor.rgb;\n    material.alpha = rampColor.a;\n    return material;\n}\n",Hk="uniform sampler2D image;\nuniform float strength;\nuniform vec2 repeat;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    vec2 st = materialInput.st;\n\n    vec2 centerPixel = fract(repeat * st);\n    float centerBump = texture2D(image, centerPixel).channel;\n\n    float imageWidth = float(imageDimensions.x);\n    vec2 rightPixel = fract(repeat * (st + vec2(1.0 / imageWidth, 0.0)));\n    float rightBump = texture2D(image, rightPixel).channel;\n\n    float imageHeight = float(imageDimensions.y);\n    vec2 leftPixel = fract(repeat * (st + vec2(0.0, 1.0 / imageHeight)));\n    float topBump = texture2D(image, leftPixel).channel;\n\n    vec3 normalTangentSpace = normalize(vec3(centerBump - rightBump, centerBump - topBump, clamp(1.0 - strength, 0.1, 1.0)));\n    vec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;\n\n    material.normal = normalEC;\n    material.diffuse = vec3(0.01);\n\n    return material;\n}\n",Gk="uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform vec2 repeat;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    vec2 st = materialInput.st;\n\n    // From Stefan Gustavson's Procedural Textures in GLSL in OpenGL Insights\n    float b = mod(floor(repeat.s * st.s) + floor(repeat.t * st.t), 2.0);  // 0.0 or 1.0\n\n    // Find the distance from the closest separator (region between two colors)\n    float scaledWidth = fract(repeat.s * st.s);\n    scaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));\n    float scaledHeight = fract(repeat.t * st.t);\n    scaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));\n    float value = min(scaledWidth, scaledHeight);\n\n    vec4 currentColor = mix(lightColor, darkColor, b);\n    vec4 color = czm_antialias(lightColor, darkColor, currentColor, value, 0.03);\n\n    color = czm_gammaCorrect(color);\n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n\n    return material;\n}\n",Wk="uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform vec2 repeat;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    // From Stefan Gustavson's Procedural Textures in GLSL in OpenGL Insights\n    float b = smoothstep(0.3, 0.32, length(fract(repeat * materialInput.st) - 0.5));  // 0.0 or 1.0\n\n    vec4 color = mix(lightColor, darkColor, b);\n    color = czm_gammaCorrect(color);\n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n\n    return material;\n}\n",qk="uniform sampler2D heights;\nuniform sampler2D colors;\n\n// This material expects heights to be sorted from lowest to highest.\n\nfloat getHeight(int idx, float invTexSize)\n{\n    vec2 uv = vec2((float(idx) + 0.5) * invTexSize, 0.5);\n#ifdef OES_texture_float\n    return texture2D(heights, uv).x;\n#else\n    return czm_unpackFloat(texture2D(heights, uv));\n#endif\n}\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    float height = materialInput.height;\n    float invTexSize = 1.0 / float(heightsDimensions.x);\n\n    float minHeight = getHeight(0, invTexSize);\n    float maxHeight = getHeight(heightsDimensions.x - 1, invTexSize);\n\n    // early-out when outside the height range\n    if (height < minHeight || height > maxHeight) {\n        material.diffuse = vec3(0.0);\n        material.alpha = 0.0;\n        return material;\n    }\n\n    // Binary search to find heights above and below.\n    int idxBelow = 0;\n    int idxAbove = heightsDimensions.x;\n    float heightBelow = minHeight;\n    float heightAbove = maxHeight;\n\n    // while loop not allowed, so use for loop with max iterations.\n    // maxIterations of 16 supports a texture size up to 65536 (2^16).\n    const int maxIterations = 16;\n    for (int i = 0; i < maxIterations; i++) {\n        if (idxBelow >= idxAbove - 1) {\n            break;\n        }\n\n        int idxMid = (idxBelow + idxAbove) / 2;\n        float heightTex = getHeight(idxMid, invTexSize);\n\n        if (height > heightTex) {\n            idxBelow = idxMid;\n            heightBelow = heightTex;\n        } else {\n            idxAbove = idxMid;\n            heightAbove = heightTex;\n        }\n    }\n\n    float lerper = heightBelow == heightAbove ? 1.0 : (height - heightBelow) / (heightAbove - heightBelow);\n    vec2 colorUv = vec2(invTexSize * (float(idxBelow) + 0.5 + lerper), 0.5);\n    vec4 color = texture2D(colors, colorUv);\n\n    // undo preumultiplied alpha\n    if (color.a > 0.0) \n    {\n        color.rgb /= color.a;\n    }\n    \n    color.rgb = czm_gammaCorrect(color.rgb);\n\n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n    return material;\n}\n",jk="#ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n#endif\n\nuniform vec4 color;\nuniform float spacing;\nuniform float width;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    float distanceToContour = mod(materialInput.height, spacing);\n\n#ifdef GL_OES_standard_derivatives\n    float dxc = abs(dFdx(materialInput.height));\n    float dyc = abs(dFdy(materialInput.height));\n    float dF = max(dxc, dyc) * czm_pixelRatio * width;\n    float alpha = (distanceToContour < dF) ? 1.0 : 0.0;\n#else\n    float alpha = (distanceToContour < (czm_pixelRatio * width)) ? 1.0 : 0.0;\n#endif\n\n    vec4 outColor = czm_gammaCorrect(vec4(color.rgb, alpha * color.a));\n    material.diffuse = outColor.rgb;\n    material.alpha = outColor.a;\n\n    return material;\n}\n",Yk="uniform sampler2D image;\nuniform float minimumHeight;\nuniform float maximumHeight;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    float scaledHeight = clamp((materialInput.height - minimumHeight) / (maximumHeight - minimumHeight), 0.0, 1.0);\n    vec4 rampColor = texture2D(image, vec2(scaledHeight, 0.5));\n    rampColor = czm_gammaCorrect(rampColor);\n    material.diffuse = rampColor.rgb;\n    material.alpha = rampColor.a;\n    return material;\n}\n",Kk="uniform vec4 fadeInColor;\nuniform vec4 fadeOutColor;\nuniform float maximumDistance;\nuniform bool repeat;\nuniform vec2 fadeDirection;\nuniform vec2 time;\n\nfloat getTime(float t, float coord)\n{\n    float scalar = 1.0 / maximumDistance;\n    float q  = distance(t, coord) * scalar;\n    if (repeat)\n    {\n        float r = distance(t, coord + 1.0) * scalar;\n        float s = distance(t, coord - 1.0) * scalar;\n        q = min(min(r, s), q);\n    }\n    return clamp(q, 0.0, 1.0);\n}\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    vec2 st = materialInput.st;\n    float s = getTime(time.x, st.s) * fadeDirection.s;\n    float t = getTime(time.y, st.t) * fadeDirection.t;\n\n    float u = length(vec2(s, t));\n    vec4 color = mix(fadeInColor, fadeOutColor, u);\n\n    color = czm_gammaCorrect(color);\n    material.emission = color.rgb;\n    material.alpha = color.a;\n\n    return material;\n}\n",Xk='#ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n#endif\n\nuniform vec4 color;\nuniform float cellAlpha;\nuniform vec2 lineCount;\nuniform vec2 lineThickness;\nuniform vec2 lineOffset;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    vec2 st = materialInput.st;\n\n    float scaledWidth = fract(lineCount.s * st.s - lineOffset.s);\n    scaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));\n    float scaledHeight = fract(lineCount.t * st.t - lineOffset.t);\n    scaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));\n\n    float value;\n#ifdef GL_OES_standard_derivatives\n    // Fuzz Factor - Controls blurriness of lines\n    const float fuzz = 1.2;\n    vec2 thickness = (lineThickness * czm_pixelRatio) - 1.0;\n\n    // From "3D Engine Design for Virtual Globes" by Cozzi and Ring, Listing 4.13.\n    vec2 dx = abs(dFdx(st));\n    vec2 dy = abs(dFdy(st));\n    vec2 dF = vec2(max(dx.s, dy.s), max(dx.t, dy.t)) * lineCount;\n    value = min(\n        smoothstep(dF.s * thickness.s, dF.s * (fuzz + thickness.s), scaledWidth),\n        smoothstep(dF.t * thickness.t, dF.t * (fuzz + thickness.t), scaledHeight));\n#else\n    // Fuzz Factor - Controls blurriness of lines\n    const float fuzz = 0.05;\n\n    vec2 range = 0.5 - (lineThickness * 0.05);\n    value = min(\n        1.0 - smoothstep(range.s, range.s + fuzz, scaledWidth),\n        1.0 - smoothstep(range.t, range.t + fuzz, scaledHeight));\n#endif\n\n    // Edges taken from RimLightingMaterial.glsl\n    // See http://www.fundza.com/rman_shaders/surface/fake_rim/fake_rim1.html\n    float dRim = 1.0 - abs(dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC)));\n    float sRim = smoothstep(0.8, 1.0, dRim);\n    value *= (1.0 - sRim);\n\n    vec4 halfColor;\n    halfColor.rgb = color.rgb * 0.5;\n    halfColor.a = color.a * (1.0 - ((1.0 - cellAlpha) * value));\n    halfColor = czm_gammaCorrect(halfColor);\n    material.diffuse = halfColor.rgb;\n    material.emission = halfColor.rgb;\n    material.alpha = halfColor.a;\n\n    return material;\n}\n',Qk="uniform sampler2D image;\nuniform float strength;\nuniform vec2 repeat;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    \n    vec4 textureValue = texture2D(image, fract(repeat * materialInput.st));\n    vec3 normalTangentSpace = textureValue.channels;\n    normalTangentSpace.xy = normalTangentSpace.xy * 2.0 - 1.0;\n    normalTangentSpace.z = clamp(1.0 - strength, 0.1, 1.0);\n    normalTangentSpace = normalize(normalTangentSpace);\n    vec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;\n    \n    material.normal = normalEC;\n    \n    return material;\n}\n",Jk="#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n\nuniform vec4 color;\n\nfloat getPointOnLine(vec2 p0, vec2 p1, float x)\n{\n    float slope = (p0.y - p1.y) / (p0.x - p1.x);\n    return slope * (x - p0.x) + p0.y;\n}\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    vec2 st = materialInput.st;\n\n#ifdef GL_OES_standard_derivatives\n    float base = 1.0 - abs(fwidth(st.s)) * 10.0 * czm_pixelRatio;\n#else\n    float base = 0.975; // 2.5% of the line will be the arrow head\n#endif\n\n    vec2 center = vec2(1.0, 0.5);\n    float ptOnUpperLine = getPointOnLine(vec2(base, 1.0), center, st.s);\n    float ptOnLowerLine = getPointOnLine(vec2(base, 0.0), center, st.s);\n\n    float halfWidth = 0.15;\n    float s = step(0.5 - halfWidth, st.t);\n    s *= 1.0 - step(0.5 + halfWidth, st.t);\n    s *= 1.0 - step(base, st.s);\n\n    float t = step(base, materialInput.st.s);\n    t *= 1.0 - step(ptOnUpperLine, st.t);\n    t *= step(ptOnLowerLine, st.t);\n\n    // Find the distance from the closest separator (region between two colors)\n    float dist;\n    if (st.s < base)\n    {\n        float d1 = abs(st.t - (0.5 - halfWidth));\n        float d2 = abs(st.t - (0.5 + halfWidth));\n        dist = min(d1, d2);\n    }\n    else\n    {\n        float d1 = czm_infinity;\n        if (st.t < 0.5 - halfWidth && st.t > 0.5 + halfWidth)\n        {\n            d1 = abs(st.s - base);\n        }\n        float d2 = abs(st.t - ptOnUpperLine);\n        float d3 = abs(st.t - ptOnLowerLine);\n        dist = min(min(d1, d2), d3);\n    }\n\n    vec4 outsideColor = vec4(0.0);\n    vec4 currentColor = mix(outsideColor, color, clamp(s + t, 0.0, 1.0));\n    vec4 outColor = czm_antialias(outsideColor, color, currentColor, dist);\n\n    outColor = czm_gammaCorrect(outColor);\n    material.diffuse = outColor.rgb;\n    material.alpha = outColor.a;\n    return material;\n}\n",Zk="uniform vec4 color;\nuniform vec4 gapColor;\nuniform float dashLength;\nuniform float dashPattern;\nvarying float v_polylineAngle;\n\nconst float maskLength = 16.0;\n\nmat2 rotate(float rad) {\n    float c = cos(rad);\n    float s = sin(rad);\n    return mat2(\n        c, s,\n        -s, c\n    );\n}\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    vec2 pos = rotate(v_polylineAngle) * gl_FragCoord.xy;\n\n    // Get the relative position within the dash from 0 to 1\n    float dashPosition = fract(pos.x / (dashLength * czm_pixelRatio));\n    // Figure out the mask index.\n    float maskIndex = floor(dashPosition * maskLength);\n    // Test the bit mask.\n    float maskTest = floor(dashPattern / pow(2.0, maskIndex));\n    vec4 fragColor = (mod(maskTest, 2.0) < 1.0) ? gapColor : color;\n    if (fragColor.a < 0.005) {   // matches 0/255 and 1/255\n        discard;\n    }\n\n    fragColor = czm_gammaCorrect(fragColor);\n    material.emission = fragColor.rgb;\n    material.alpha = fragColor.a;\n    return material;\n}\n",$k="uniform vec4 color;\nuniform float glowPower;\nuniform float taperPower;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    vec2 st = materialInput.st;\n    float glow = glowPower / abs(st.t - 0.5) - (glowPower / 0.5);\n\n    if (taperPower <= 0.99999) {\n        glow *= min(1.0, taperPower / (0.5 - st.s * 0.5) - (taperPower / 0.5));\n    }\n\n    vec4 fragColor;\n    fragColor.rgb = max(vec3(glow - 1.0 + color.rgb), color.rgb);\n    fragColor.a = clamp(0.0, 1.0, glow) * color.a;\n    fragColor = czm_gammaCorrect(fragColor);\n\n    material.emission = fragColor.rgb;\n    material.alpha = fragColor.a;\n\n    return material;\n}\n",eU="uniform vec4 color;\nuniform vec4 outlineColor;\nuniform float outlineWidth;\n\nvarying float v_width;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    vec2 st = materialInput.st;\n    float halfInteriorWidth =  0.5 * (v_width - outlineWidth) / v_width;\n    float b = step(0.5 - halfInteriorWidth, st.t);\n    b *= 1.0 - step(0.5 + halfInteriorWidth, st.t);\n\n    // Find the distance from the closest separator (region between two colors)\n    float d1 = abs(st.t - (0.5 - halfInteriorWidth));\n    float d2 = abs(st.t - (0.5 + halfInteriorWidth));\n    float dist = min(d1, d2);\n\n    vec4 currentColor = mix(outlineColor, color, b);\n    vec4 outColor = czm_antialias(outlineColor, color, currentColor, dist);\n    outColor = czm_gammaCorrect(outColor);\n\n    material.diffuse = outColor.rgb;\n    material.alpha = outColor.a;\n\n    return material;\n}\n",tU="uniform vec4 color;\nuniform vec4 rimColor;\nuniform float width;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    // See http://www.fundza.com/rman_shaders/surface/fake_rim/fake_rim1.html\n    float d = 1.0 - dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC));\n    float s = smoothstep(1.0 - width, 1.0, d);\n\n    vec4 outColor = czm_gammaCorrect(color);\n    vec4 outRimColor = czm_gammaCorrect(rimColor);\n\n    material.diffuse = outColor.rgb;\n    material.emission = outRimColor.rgb * s;\n    material.alpha = mix(outColor.a, outRimColor.a, s);\n\n    return material;\n}\n",nU="uniform sampler2D image;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    vec4 rampColor = texture2D(image, vec2(materialInput.slope / (czm_pi / 2.0), 0.5));\n    rampColor = czm_gammaCorrect(rampColor);\n    material.diffuse = rampColor.rgb;\n    material.alpha = rampColor.a;\n    return material;\n}\n",iU="uniform vec4 evenColor;\nuniform vec4 oddColor;\nuniform float offset;\nuniform float repeat;\nuniform bool horizontal;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    // Based on the Stripes Fragment Shader in the Orange Book (11.1.2)\n    float coord = mix(materialInput.st.s, materialInput.st.t, float(horizontal));\n    float value = fract((coord - offset) * (repeat * 0.5));\n    float dist = min(value, min(abs(value - 0.5), 1.0 - value));\n\n    vec4 currentColor = mix(evenColor, oddColor, step(0.5, value));\n    vec4 color = czm_antialias(evenColor, oddColor, currentColor, dist);\n    color = czm_gammaCorrect(color);\n\n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n\n    return material;\n}\n",oU="// Thanks for the contribution Jonas\n// http://29a.ch/2012/7/19/webgl-terrain-rendering-water-fog\n\nuniform sampler2D specularMap;\nuniform sampler2D normalMap;\nuniform vec4 baseWaterColor;\nuniform vec4 blendColor;\nuniform float frequency;\nuniform float animationSpeed;\nuniform float amplitude;\nuniform float specularIntensity;\nuniform float fadeFactor;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    float time = czm_frameNumber * animationSpeed;\n\n    // fade is a function of the distance from the fragment and the frequency of the waves\n    float fade = max(1.0, (length(materialInput.positionToEyeEC) / 10000000000.0) * frequency * fadeFactor);\n\n    float specularMapValue = texture2D(specularMap, materialInput.st).r;\n\n    // note: not using directional motion at this time, just set the angle to 0.0;\n    vec4 noise = czm_getWaterNoise(normalMap, materialInput.st * frequency, time, 0.0);\n    vec3 normalTangentSpace = noise.xyz * vec3(1.0, 1.0, (1.0 / amplitude));\n\n    // fade out the normal perturbation as we move further from the water surface\n    normalTangentSpace.xy /= fade;\n\n    // attempt to fade out the normal perturbation as we approach non water areas (low specular map value)\n    normalTangentSpace = mix(vec3(0.0, 0.0, 50.0), normalTangentSpace, specularMapValue);\n\n    normalTangentSpace = normalize(normalTangentSpace);\n\n    // get ratios for alignment of the new normal vector with a vector perpendicular to the tangent plane\n    float tsPerturbationRatio = clamp(dot(normalTangentSpace, vec3(0.0, 0.0, 1.0)), 0.0, 1.0);\n\n    // fade out water effect as specular map value decreases\n    material.alpha = mix(blendColor.a, baseWaterColor.a, specularMapValue) * specularMapValue;\n\n    // base color is a blend of the water and non-water color based on the value from the specular map\n    // may need a uniform blend factor to better control this\n    material.diffuse = mix(blendColor.rgb, baseWaterColor.rgb, specularMapValue);\n\n    // diffuse highlights are based on how perturbed the normal is\n    material.diffuse += (0.1 * tsPerturbationRatio);\n\n    material.diffuse = material.diffuse;\n\n    material.normal = normalize(materialInput.tangentToEyeMatrix * normalTangentSpace);\n\n    material.specular = specularIntensity;\n    material.shininess = 10.0;\n\n    return material;\n}\n";function rU(e){this.type=void 0,this.shaderSource=void 0,this.materials=void 0,this.uniforms=void 0,this._uniforms=void 0,this.translucent=void 0,this._minificationFilter=R(e.minificationFilter,Rk.LINEAR),this._magnificationFilter=R(e.magnificationFilter,Dk.LINEAR),this._strict=void 0,this._template=void 0,this._count=void 0,this._texturePaths={},this._loadedImages=[],this._loadedCubeMaps=[],this._textures={},this._updateFunctions=[],this._defaultTexture=void 0,sU(e,this),Object.defineProperties(this,{type:{value:this.type,writable:!1}}),C(rU._uniformList[this.type])||(rU._uniformList[this.type]=Object.keys(this._uniforms))}function sU(e,t){let n;e=R(e,R.EMPTY_OBJECT),t._strict=R(e.strict,!1),t._count=R(e.count,0),t._template=pn(R(e.fabric,R.EMPTY_OBJECT)),t._template.uniforms=pn(R(t._template.uniforms,R.EMPTY_OBJECT)),t._template.materials=pn(R(t._template.materials,R.EMPTY_OBJECT)),t.type=C(t._template.type)?t._template.type:wk(),t.shaderSource="",t.materials={},t.uniforms={},t._uniforms={},t._translucentFunctions=[];const i=rU._materialCache.getMaterial(t.type);if(C(i)){const e=pn(i.fabric,!0);t._template=_n(t._template,e,!0),n=i.translucent}dU(t),C(i)||rU._materialCache.addMaterial(t.type,t),pU(t),vU(t),wU(t);const o=0===t._translucentFunctions.length||void 0;if(n=R(n,o),n=R(e.translucent,n),C(n))if("function"===typeof n){const e=function(){return n(t)};t._translucentFunctions.push(e)}else t._translucentFunctions.push(n)}function aU(e,t,n,i){if(C(e))for(const o in e)if(e.hasOwnProperty(o)){const e=-1!==t.indexOf(o);(i&&!e||!i&&e)&&n(o,t)}}function cU(e,t){let n=`fabric: property name '${e}' is not valid. It should be `;for(let i=0;i<t.length;i++){const e=`'${t[i]}'`;n+=i===t.length-1?`or ${e}.`:`${e}, `}throw new x(n)}function lU(e,t){const n=`fabric: uniforms and materials cannot share the same property '${e}'`;throw new x(n)}rU._uniformList={},rU.fromType=function(e,t){if(!C(rU._materialCache.getMaterial(e)))throw new x(`material with type '${e}' does not exist.`);const n=new rU({fabric:{type:e}});if(C(t))for(const i in t)t.hasOwnProperty(i)&&(n.uniforms[i]=t[i]);return n},rU.prototype.isTranslucent=function(){if(C(this.translucent))return"function"===typeof this.translucent?this.translucent():this.translucent;let e=!0;const t=this._translucentFunctions,n=t.length;for(let i=0;i<n;++i){const n=t[i];if(e="function"===typeof n?e&&n():e&&n,!e)break}return e},rU.prototype.update=function(e){let t,n;this._defaultTexture=e.defaultTexture;const i=this._loadedImages;let o=i.length;for(t=0;t<o;++t){const o=i[t];n=o.id;let r,s=o.image;Array.isArray(s)&&(r=s.slice(1,s.length).map((function(e){return e.bufferView})),s=s[0]);const a=new Nk({minificationFilter:this._minificationFilter,magnificationFilter:this._magnificationFilter});let c;c=C(s.internalFormat)?new Uk({context:e,pixelFormat:s.internalFormat,width:s.width,height:s.height,source:{arrayBufferView:s.bufferView,mipLevels:r},sampler:a}):new Uk({context:e,source:s,sampler:a});const l=this._textures[n];C(l)&&l!==this._defaultTexture&&l.destroy(),this._textures[n]=c;const u=`${n}Dimensions`;if(this.uniforms.hasOwnProperty(u)){const e=this.uniforms[u];e.x=c._width,e.y=c._height}}i.length=0;const r=this._loadedCubeMaps;for(o=r.length,t=0;t<o;++t){const i=r[t];n=i.id;const o=i.images,s=new zk({context:e,source:{positiveX:o[0],negativeX:o[1],positiveY:o[2],negativeY:o[3],positiveZ:o[4],negativeZ:o[5]},sampler:new Nk({minificationFilter:this._minificationFilter,magnificationFilter:this._magnificationFilter})});this._textures[n]=s}r.length=0;const s=this._updateFunctions;for(o=s.length,t=0;t<o;++t)s[t](this,e);const a=this.materials;for(const c in a)a.hasOwnProperty(c)&&a[c].update(e)},rU.prototype.isDestroyed=function(){return!1},rU.prototype.destroy=function(){const e=this._textures;for(const n in e)if(e.hasOwnProperty(n)){const t=e[n];t!==this._defaultTexture&&t.destroy()}const t=this.materials;for(const n in t)t.hasOwnProperty(n)&&t[n].destroy();return Qh(this)};const uU=["type","materials","uniforms","components","source"],hU=["diffuse","specular","shininess","normal","emission","alpha"];function dU(e){const t=e._template,n=t.uniforms,i=t.materials,o=t.components;if(C(o)&&C(t.source))throw new x("fabric: cannot have source and components in the same template.");aU(t,uU,cU,!0),aU(o,hU,cU,!0);const r=[];for(const s in i)i.hasOwnProperty(s)&&r.push(s);aU(n,r,lU,!1)}function fU(e,t){const n=t._template.materials;for(const i in n)if(n.hasOwnProperty(i)&&e.indexOf(i)>-1)return!0;return!1}function pU(e){const t=e._template.components,n=e._template.source;if(C(n))e.shaderSource+=`${n}\n`;else{if(e.shaderSource+="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n",e.shaderSource+="czm_material material = czm_getDefaultMaterial(materialInput);\n",C(t)){const n=Object.keys(e._template.materials).length>0;for(const i in t)if(t.hasOwnProperty(i))if("diffuse"===i||"emission"===i){const o=n&&fU(t[i],e),r=o?t[i]:`czm_gammaCorrect(${t[i]})`;e.shaderSource+=`material.${i} = ${r}; \n`}else e.shaderSource+="alpha"===i?`material.alpha = ${t.alpha}; \n`:`material.${i} = ${t[i]};\n`}e.shaderSource+="return material;\n}\n"}}const mU={mat2:hh,mat3:ke,mat4:ft},_U=/\.ktx2$/i;function gU(e){let t;return function(n,i){const o=n.uniforms,r=o[e],s=t!==r,a=!C(r)||r===rU.DefaultImageId;t=r;let c,l,u=n._textures[e];if(r instanceof HTMLVideoElement){if(r.readyState>=2){if(s&&C(u)&&(u!==i.defaultTexture&&u.destroy(),u=void 0),!C(u)||u===i.defaultTexture){const t=new Nk({minificationFilter:n._minificationFilter,magnificationFilter:n._magnificationFilter});return u=new Uk({context:i,source:r,sampler:t}),void(n._textures[e]=u)}u.copyFrom({source:r})}else C(u)||(n._textures[e]=i.defaultTexture);return}if(r instanceof Uk&&r!==u){n._texturePaths[e]=void 0;const t=n._textures[e];return C(t)&&t!==n._defaultTexture&&t.destroy(),n._textures[e]=r,c=`${e}Dimensions`,void(o.hasOwnProperty(c)&&(l=o[c],l.x=r._width,l.y=r._height))}if(s&&C(u)&&a&&(u!==n._defaultTexture&&u.destroy(),u=void 0),C(u)||(n._texturePaths[e]=void 0,u=n._textures[e]=n._defaultTexture,c=`${e}Dimensions`,o.hasOwnProperty(c)&&(l=o[c],l.x=u._width,l.y=u._height)),a)return;const h=r instanceof Vi;if(!C(n._texturePaths[e])||h&&r.url!==n._texturePaths[e].url||!h&&r!==n._texturePaths[e]){if("string"===typeof r||h){const t=h?r:Vi.createIfNeeded(r);let i;i=_U.test(t.url)?XF(t.url):t.fetchImage(),Promise.resolve(i).then((function(t){n._loadedImages.push({id:e,image:t})})).catch((function(){C(u)&&u!==n._defaultTexture&&u.destroy(),n._textures[e]=n._defaultTexture}))}else(r instanceof HTMLCanvasElement||r instanceof HTMLImageElement)&&n._loadedImages.push({id:e,image:r});n._texturePaths[e]=r}}}function yU(e){return function(t,n){const i=t.uniforms[e];if(i instanceof zk){const n=t._textures[e];return n!==t._defaultTexture&&n.destroy(),t._texturePaths[e]=void 0,void(t._textures[e]=i)}if(C(t._textures[e])||(t._texturePaths[e]=void 0,t._textures[e]=n.defaultCubeMap),i===rU.DefaultCubeMapId)return;const o=i.positiveX+i.negativeX+i.positiveY+i.negativeY+i.positiveZ+i.negativeZ;if(o!==t._texturePaths[e]){const n=[Vi.createIfNeeded(i.positiveX).fetchImage(),Vi.createIfNeeded(i.negativeX).fetchImage(),Vi.createIfNeeded(i.positiveY).fetchImage(),Vi.createIfNeeded(i.negativeY).fetchImage(),Vi.createIfNeeded(i.positiveZ).fetchImage(),Vi.createIfNeeded(i.negativeZ).fetchImage()];Promise.all(n).then((function(n){t._loadedCubeMaps.push({id:e,images:n})})),t._texturePaths[e]=o}}}function vU(e){const t=e._template.uniforms;for(const n in t)t.hasOwnProperty(n)&&bU(e,n)}function bU(e,t){const n=e._strict,i=e._template.uniforms,o=i[t],r=AU(o);if(!C(r))throw new x(`fabric: uniform '${t}' has invalid type.`);let s;if("channels"===r){if(s=TU(e,t,o,!1),0===s&&n)throw new x(`strict: shader source does not use channels '${t}'.`)}else{if("sampler2D"===r){const n=`${t}Dimensions`;CU(e,n)>0&&(i[n]={type:"ivec3",x:1,y:1},bU(e,n))}const a=new RegExp(`uniform\\s+${r}\\s+${t}\\s*;`);if(!a.test(e.shaderSource)){const n=`uniform ${r} ${t};`;e.shaderSource=n+e.shaderSource}const c=`${t}_${e._count++}`;if(s=TU(e,t,c),1===s&&n)throw new x(`strict: shader source does not use uniform '${t}'.`);if(e.uniforms[t]=o,"sampler2D"===r)e._uniforms[c]=function(){return e._textures[t]},e._updateFunctions.push(gU(t));else if("samplerCube"===r)e._uniforms[c]=function(){return e._textures[t]},e._updateFunctions.push(yU(t));else if(-1!==r.indexOf("mat")){const n=new mU[r];e._uniforms[c]=function(){return mU[r].fromColumnMajorArray(e.uniforms[t],n)}}else e._uniforms[c]=function(){return e.uniforms[t]}}}function AU(e){let t=e.type;if(!C(t)){const n=typeof e;if("number"===n)t="float";else if("boolean"===n)t="bool";else if("string"===n||e instanceof Vi||e instanceof HTMLCanvasElement||e instanceof HTMLImageElement)t=/^([rgba]){1,4}$/i.test(e)?"channels":e===rU.DefaultCubeMapId?"samplerCube":"sampler2D";else if("object"===n)if(Array.isArray(e))4!==e.length&&9!==e.length&&16!==e.length||(t=`mat${Math.sqrt(e.length)}`);else{let n=0;for(const t in e)e.hasOwnProperty(t)&&(n+=1);n>=2&&n<=4?t=`vec${n}`:6===n&&(t="samplerCube")}}return t}function wU(e){const t=e._strict,n=e._template.materials;for(const i in n)if(n.hasOwnProperty(i)){const o=new rU({strict:t,fabric:n[i],count:e._count});e._count=o._count,e._uniforms=_n(e._uniforms,o._uniforms,!0),e.materials[i]=o,e._translucentFunctions=e._translucentFunctions.concat(o._translucentFunctions);const r="czm_getMaterial",s=`${r}_${e._count++}`;TU(o,r,s),e.shaderSource=o.shaderSource+e.shaderSource;const a=`${s}(materialInput)`,c=TU(e,i,a);if(0===c&&t)throw new x(`strict: shader source does not use material '${i}'.`)}}function TU(e,t,n,i){i=R(i,!0);let o=0;const r="([\\w])?",s=`([\\w${i?".":""}])?`,a=new RegExp(s+t+r,"g");return e.shaderSource=e.shaderSource.replace(a,(function(e,t,i){return t||i?e:(o+=1,n)})),o}function CU(e,t,n){return TU(e,t,t,n)}rU._materialCache={_materials:{},addMaterial:function(e,t){this._materials[e]=t},getMaterial:function(e){return this._materials[e]}},rU.DefaultImageId="czm_defaultImage",rU.DefaultCubeMapId="czm_defaultCubeMap",rU.ColorType="Color",rU._materialCache.addMaterial(rU.ColorType,{fabric:{type:rU.ColorType,uniforms:{color:new xy(1,0,0,.5)},components:{diffuse:"color.rgb",alpha:"color.a"}},translucent:function(e){return e.uniforms.color.alpha<1}}),rU.ImageType="Image",rU._materialCache.addMaterial(rU.ImageType,{fabric:{type:rU.ImageType,uniforms:{image:rU.DefaultImageId,repeat:new ro(1,1),color:new xy(1,1,1,1)},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st)).rgb * color.rgb",alpha:"texture2D(image, fract(repeat * materialInput.st)).a * color.a"}},translucent:function(e){return e.uniforms.color.alpha<1}}),rU.DiffuseMapType="DiffuseMap",rU._materialCache.addMaterial(rU.DiffuseMapType,{fabric:{type:rU.DiffuseMapType,uniforms:{image:rU.DefaultImageId,channels:"rgb",repeat:new ro(1,1)},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st)).channels"}},translucent:!1}),rU.AlphaMapType="AlphaMap",rU._materialCache.addMaterial(rU.AlphaMapType,{fabric:{type:rU.AlphaMapType,uniforms:{image:rU.DefaultImageId,channel:"a",repeat:new ro(1,1)},components:{alpha:"texture2D(image, fract(repeat * materialInput.st)).channel"}},translucent:!0}),rU.SpecularMapType="SpecularMap",rU._materialCache.addMaterial(rU.SpecularMapType,{fabric:{type:rU.SpecularMapType,uniforms:{image:rU.DefaultImageId,channel:"r",repeat:new ro(1,1)},components:{specular:"texture2D(image, fract(repeat * materialInput.st)).channel"}},translucent:!1}),rU.EmissionMapType="EmissionMap",rU._materialCache.addMaterial(rU.EmissionMapType,{fabric:{type:rU.EmissionMapType,uniforms:{image:rU.DefaultImageId,channels:"rgb",repeat:new ro(1,1)},components:{emission:"texture2D(image, fract(repeat * materialInput.st)).channels"}},translucent:!1}),rU.BumpMapType="BumpMap",rU._materialCache.addMaterial(rU.BumpMapType,{fabric:{type:rU.BumpMapType,uniforms:{image:rU.DefaultImageId,channel:"r",strength:.8,repeat:new ro(1,1)},source:Hk},translucent:!1}),rU.NormalMapType="NormalMap",rU._materialCache.addMaterial(rU.NormalMapType,{fabric:{type:rU.NormalMapType,uniforms:{image:rU.DefaultImageId,channels:"rgb",strength:.8,repeat:new ro(1,1)},source:Qk},translucent:!1}),rU.GridType="Grid",rU._materialCache.addMaterial(rU.GridType,{fabric:{type:rU.GridType,uniforms:{color:new xy(0,1,0,1),cellAlpha:.1,lineCount:new ro(8,8),lineThickness:new ro(1,1),lineOffset:new ro(0,0)},source:Xk},translucent:function(e){const t=e.uniforms;return t.color.alpha<1||t.cellAlpha<1}}),rU.StripeType="Stripe",rU._materialCache.addMaterial(rU.StripeType,{fabric:{type:rU.StripeType,uniforms:{horizontal:!0,evenColor:new xy(1,1,1,.5),oddColor:new xy(0,0,1,.5),offset:0,repeat:5},source:iU},translucent:function(e){const t=e.uniforms;return t.evenColor.alpha<1||t.oddColor.alpha<1}}),rU.CheckerboardType="Checkerboard",rU._materialCache.addMaterial(rU.CheckerboardType,{fabric:{type:rU.CheckerboardType,uniforms:{lightColor:new xy(1,1,1,.5),darkColor:new xy(0,0,0,.5),repeat:new ro(5,5)},source:Gk},translucent:function(e){const t=e.uniforms;return t.lightColor.alpha<1||t.darkColor.alpha<1}}),rU.DotType="Dot",rU._materialCache.addMaterial(rU.DotType,{fabric:{type:rU.DotType,uniforms:{lightColor:new xy(1,1,0,.75),darkColor:new xy(0,1,1,.75),repeat:new ro(5,5)},source:Wk},translucent:function(e){const t=e.uniforms;return t.lightColor.alpha<1||t.darkColor.alpha<1}}),rU.WaterType="Water",rU._materialCache.addMaterial(rU.WaterType,{fabric:{type:rU.WaterType,uniforms:{baseWaterColor:new xy(.2,.3,.6,1),blendColor:new xy(0,1,.699,1),specularMap:rU.DefaultImageId,normalMap:rU.DefaultImageId,frequency:10,animationSpeed:.01,amplitude:1,specularIntensity:.5,fadeFactor:1},source:oU},translucent:function(e){const t=e.uniforms;return t.baseWaterColor.alpha<1||t.blendColor.alpha<1}}),rU.RimLightingType="RimLighting",rU._materialCache.addMaterial(rU.RimLightingType,{fabric:{type:rU.RimLightingType,uniforms:{color:new xy(1,0,0,.7),rimColor:new xy(1,1,1,.4),width:.3},source:tU},translucent:function(e){const t=e.uniforms;return t.color.alpha<1||t.rimColor.alpha<1}}),rU.FadeType="Fade",rU._materialCache.addMaterial(rU.FadeType,{fabric:{type:rU.FadeType,uniforms:{fadeInColor:new xy(1,0,0,1),fadeOutColor:new xy(0,0,0,0),maximumDistance:.5,repeat:!0,fadeDirection:{x:!0,y:!0},time:new ro(.5,.5)},source:Kk},translucent:function(e){const t=e.uniforms;return t.fadeInColor.alpha<1||t.fadeOutColor.alpha<1}}),rU.PolylineArrowType="PolylineArrow",rU._materialCache.addMaterial(rU.PolylineArrowType,{fabric:{type:rU.PolylineArrowType,uniforms:{color:new xy(1,1,1,1)},source:Jk},translucent:!0}),rU.PolylineDashType="PolylineDash",rU._materialCache.addMaterial(rU.PolylineDashType,{fabric:{type:rU.PolylineDashType,uniforms:{color:new xy(1,0,1,1),gapColor:new xy(0,0,0,0),dashLength:16,dashPattern:255},source:Zk},translucent:!0}),rU.PolylineGlowType="PolylineGlow",rU._materialCache.addMaterial(rU.PolylineGlowType,{fabric:{type:rU.PolylineGlowType,uniforms:{color:new xy(0,.5,1,1),glowPower:.25,taperPower:1},source:$k},translucent:!0}),rU.PolylineOutlineType="PolylineOutline",rU._materialCache.addMaterial(rU.PolylineOutlineType,{fabric:{type:rU.PolylineOutlineType,uniforms:{color:new xy(1,1,1,1),outlineColor:new xy(1,0,0,1),outlineWidth:1},source:eU},translucent:function(e){const t=e.uniforms;return t.color.alpha<1||t.outlineColor.alpha<1}}),rU.ElevationContourType="ElevationContour",rU._materialCache.addMaterial(rU.ElevationContourType,{fabric:{type:rU.ElevationContourType,uniforms:{spacing:100,color:new xy(1,0,0,1),width:1},source:jk},translucent:!1}),rU.ElevationRampType="ElevationRamp",rU._materialCache.addMaterial(rU.ElevationRampType,{fabric:{type:rU.ElevationRampType,uniforms:{image:rU.DefaultImageId,minimumHeight:0,maximumHeight:1e4},source:Yk},translucent:!1}),rU.SlopeRampMaterialType="SlopeRamp",rU._materialCache.addMaterial(rU.SlopeRampMaterialType,{fabric:{type:rU.SlopeRampMaterialType,uniforms:{image:rU.DefaultImageId},source:nU},translucent:!1}),rU.AspectRampMaterialType="AspectRamp",rU._materialCache.addMaterial(rU.AspectRampMaterialType,{fabric:{type:rU.AspectRampMaterialType,uniforms:{image:rU.DefaultImageId},source:Vk},translucent:!1}),rU.ElevationBandType="ElevationBand",rU._materialCache.addMaterial(rU.ElevationBandType,{fabric:{type:rU.ElevationBandType,uniforms:{heights:rU.DefaultImageId,colors:rU.DefaultImageId},source:qk},translucent:!0});var EU=rU;function xU(e){e=R(e,R.EMPTY_OBJECT);const t=R(e.translucent,!0),n=R(e.closed,!1),i=R(e.materialSupport,xU.MaterialSupport.TEXTURED);this.material=C(e.material)?e.material:EU.fromType(EU.ColorType),this.translucent=t,this._vertexShaderSource=R(e.vertexShaderSource,i.vertexShaderSource),this._fragmentShaderSource=R(e.fragmentShaderSource,i.fragmentShaderSource),this._renderState=bk.getDefaultRenderState(t,n,e.renderState),this._closed=n,this._materialSupport=i,this._vertexFormat=i.vertexFormat,this._flat=R(e.flat,!1),this._faceForward=R(e.faceForward,!n)}Object.defineProperties(xU.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},materialSupport:{get:function(){return this._materialSupport}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}}),xU.prototype.getFragmentShaderSource=bk.prototype.getFragmentShaderSource,xU.prototype.isTranslucent=bk.prototype.isTranslucent,xU.prototype.getRenderState=bk.prototype.getRenderState,xU.MaterialSupport={BASIC:Object.freeze({vertexFormat:jf.POSITION_AND_NORMAL,vertexShaderSource:ck,fragmentShaderSource:ak}),TEXTURED:Object.freeze({vertexFormat:jf.POSITION_NORMAL_AND_ST,vertexShaderSource:uk,fragmentShaderSource:lk}),ALL:Object.freeze({vertexFormat:jf.ALL,vertexShaderSource:sk,fragmentShaderSource:rk})};var SU=xU,IU="varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec4 v_color;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    vec4 color = czm_gammaCorrect(v_color);\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n}\n",OU="attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec4 color;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec4 v_color;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_color = color;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",DU="varying vec4 v_color;\n\nvoid main()\n{\n    gl_FragColor = czm_gammaCorrect(v_color);\n}\n",PU="attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec4 color;\nattribute float batchId;\n\nvarying vec4 v_color;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_color = color;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n";function RU(e){e=R(e,R.EMPTY_OBJECT);const t=R(e.translucent,!0),n=R(e.closed,!1),i=R(e.flat,!1),o=i?PU:OU,r=i?DU:IU,s=i?RU.FLAT_VERTEX_FORMAT:RU.VERTEX_FORMAT;this.material=void 0,this.translucent=t,this._vertexShaderSource=R(e.vertexShaderSource,o),this._fragmentShaderSource=R(e.fragmentShaderSource,r),this._renderState=bk.getDefaultRenderState(t,n,e.renderState),this._closed=n,this._vertexFormat=s,this._flat=i,this._faceForward=R(e.faceForward,!n)}Object.defineProperties(RU.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}}),RU.VERTEX_FORMAT=jf.POSITION_AND_NORMAL,RU.FLAT_VERTEX_FORMAT=jf.POSITION_ONLY,RU.prototype.getFragmentShaderSource=bk.prototype.getFragmentShaderSource,RU.prototype.isTranslucent=bk.prototype.isTranslucent,RU.prototype.getRenderState=bk.prototype.getRenderState;var LU=RU;function MU(e){this._definitionChanged=new $n,this._color=void 0,this._colorSubscription=void 0,this.color=e}Object.defineProperties(MU.prototype,{isConstant:{get:function(){return Bz.isConstant(this._color)}},definitionChanged:{get:function(){return this._definitionChanged}},color:Tz("color")}),MU.prototype.getType=function(e){return"Color"},MU.prototype.getValue=function(e,t){return C(t)||(t={}),t.color=Bz.getValueOrClonedDefault(this._color,e,xy.WHITE,t.color),t},MU.prototype.equals=function(e){return this===e||e instanceof MU&&Bz.equals(this._color,e._color)};var BU=MU;const NU={CULL:1,OCCLUDE:2,EXECUTE_IN_CLOSEST_FRUSTUM:4,DEBUG_SHOW_BOUNDING_VOLUME:8,CAST_SHADOWS:16,RECEIVE_SHADOWS:32,PICK_ONLY:64,DEPTH_FOR_TRANSLUCENT_CLASSIFICATION:128};function FU(e){e=R(e,R.EMPTY_OBJECT),this._boundingVolume=e.boundingVolume,this._orientedBoundingBox=e.orientedBoundingBox,this._modelMatrix=e.modelMatrix,this._primitiveType=R(e.primitiveType,xf.TRIANGLES),this._vertexArray=e.vertexArray,this._count=e.count,this._offset=R(e.offset,0),this._instanceCount=R(e.instanceCount,0),this._shaderProgram=e.shaderProgram,this._uniformMap=e.uniformMap,this._renderState=e.renderState,this._framebuffer=e.framebuffer,this._pass=e.pass,this._owner=e.owner,this._debugOverlappingFrustums=0,this._pickId=e.pickId,this._flags=0,this.cull=R(e.cull,!0),this.occlude=R(e.occlude,!0),this.executeInClosestFrustum=R(e.executeInClosestFrustum,!1),this.debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this.castShadows=R(e.castShadows,!1),this.receiveShadows=R(e.receiveShadows,!1),this.pickOnly=R(e.pickOnly,!1),this.depthForTranslucentClassification=R(e.depthForTranslucentClassification,!1),this.dirty=!0,this.lastDirtyTime=0,this.derivedCommands={}}function zU(e,t){return(e._flags&t)===t}function kU(e,t,n){n?e._flags|=t:e._flags&=~t}Object.defineProperties(FU.prototype,{boundingVolume:{get:function(){return this._boundingVolume},set:function(e){this._boundingVolume!==e&&(this._boundingVolume=e,this.dirty=!0)}},orientedBoundingBox:{get:function(){return this._orientedBoundingBox},set:function(e){this._orientedBoundingBox!==e&&(this._orientedBoundingBox=e,this.dirty=!0)}},cull:{get:function(){return zU(this,NU.CULL)},set:function(e){zU(this,NU.CULL)!==e&&(kU(this,NU.CULL,e),this.dirty=!0)}},occlude:{get:function(){return zU(this,NU.OCCLUDE)},set:function(e){zU(this,NU.OCCLUDE)!==e&&(kU(this,NU.OCCLUDE,e),this.dirty=!0)}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix!==e&&(this._modelMatrix=e,this.dirty=!0)}},primitiveType:{get:function(){return this._primitiveType},set:function(e){this._primitiveType!==e&&(this._primitiveType=e,this.dirty=!0)}},vertexArray:{get:function(){return this._vertexArray},set:function(e){this._vertexArray!==e&&(this._vertexArray=e,this.dirty=!0)}},count:{get:function(){return this._count},set:function(e){this._count!==e&&(this._count=e,this.dirty=!0)}},offset:{get:function(){return this._offset},set:function(e){this._offset!==e&&(this._offset=e,this.dirty=!0)}},instanceCount:{get:function(){return this._instanceCount},set:function(e){this._instanceCount!==e&&(this._instanceCount=e,this.dirty=!0)}},shaderProgram:{get:function(){return this._shaderProgram},set:function(e){this._shaderProgram!==e&&(this._shaderProgram=e,this.dirty=!0)}},castShadows:{get:function(){return zU(this,NU.CAST_SHADOWS)},set:function(e){zU(this,NU.CAST_SHADOWS)!==e&&(kU(this,NU.CAST_SHADOWS,e),this.dirty=!0)}},receiveShadows:{get:function(){return zU(this,NU.RECEIVE_SHADOWS)},set:function(e){zU(this,NU.RECEIVE_SHADOWS)!==e&&(kU(this,NU.RECEIVE_SHADOWS,e),this.dirty=!0)}},uniformMap:{get:function(){return this._uniformMap},set:function(e){this._uniformMap!==e&&(this._uniformMap=e,this.dirty=!0)}},renderState:{get:function(){return this._renderState},set:function(e){this._renderState!==e&&(this._renderState=e,this.dirty=!0)}},framebuffer:{get:function(){return this._framebuffer},set:function(e){this._framebuffer!==e&&(this._framebuffer=e,this.dirty=!0)}},pass:{get:function(){return this._pass},set:function(e){this._pass!==e&&(this._pass=e,this.dirty=!0)}},executeInClosestFrustum:{get:function(){return zU(this,NU.EXECUTE_IN_CLOSEST_FRUSTUM)},set:function(e){zU(this,NU.EXECUTE_IN_CLOSEST_FRUSTUM)!==e&&(kU(this,NU.EXECUTE_IN_CLOSEST_FRUSTUM,e),this.dirty=!0)}},owner:{get:function(){return this._owner},set:function(e){this._owner!==e&&(this._owner=e,this.dirty=!0)}},debugShowBoundingVolume:{get:function(){return zU(this,NU.DEBUG_SHOW_BOUNDING_VOLUME)},set:function(e){zU(this,NU.DEBUG_SHOW_BOUNDING_VOLUME)!==e&&(kU(this,NU.DEBUG_SHOW_BOUNDING_VOLUME,e),this.dirty=!0)}},debugOverlappingFrustums:{get:function(){return this._debugOverlappingFrustums},set:function(e){this._debugOverlappingFrustums!==e&&(this._debugOverlappingFrustums=e,this.dirty=!0)}},pickId:{get:function(){return this._pickId},set:function(e){this._pickId!==e&&(this._pickId=e,this.dirty=!0)}},pickOnly:{get:function(){return zU(this,NU.PICK_ONLY)},set:function(e){zU(this,NU.PICK_ONLY)!==e&&(kU(this,NU.PICK_ONLY,e),this.dirty=!0)}},depthForTranslucentClassification:{get:function(){return zU(this,NU.DEPTH_FOR_TRANSLUCENT_CLASSIFICATION)},set:function(e){zU(this,NU.DEPTH_FOR_TRANSLUCENT_CLASSIFICATION)!==e&&(kU(this,NU.DEPTH_FOR_TRANSLUCENT_CLASSIFICATION,e),this.dirty=!0)}}}),FU.shallowClone=function(e,t){if(C(e))return C(t)||(t=new FU),t._boundingVolume=e._boundingVolume,t._orientedBoundingBox=e._orientedBoundingBox,t._modelMatrix=e._modelMatrix,t._primitiveType=e._primitiveType,t._vertexArray=e._vertexArray,t._count=e._count,t._offset=e._offset,t._instanceCount=e._instanceCount,t._shaderProgram=e._shaderProgram,t._uniformMap=e._uniformMap,t._renderState=e._renderState,t._framebuffer=e._framebuffer,t._pass=e._pass,t._owner=e._owner,t._debugOverlappingFrustums=e._debugOverlappingFrustums,t._pickId=e._pickId,t._flags=e._flags,t.dirty=!0,t.lastDirtyTime=0,t},FU.prototype.execute=function(e,t){e.draw(this,t)};var UU=FU;const VU={ENVIRONMENT:0,COMPUTE:1,GLOBE:2,TERRAIN_CLASSIFICATION:3,CESIUM_3D_TILE:4,CESIUM_3D_TILE_CLASSIFICATION:5,CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW:6,OPAQUE:7,TRANSLUCENT:8,OVERLAY:9,NUMBER_OF_PASSES:10};var HU=Object.freeze(VU);function GU(e){if("object"!==typeof e||null===e)return e;let t;const n=Object.keys(e);for(let i=0;i<n.length;i++)t=n[i],e.hasOwnProperty(t)&&"_applyFunctions"!==t&&(e[t]=GU(e[t]));return Object.freeze(e)}var WU=GU;function qU(e){return e===th.FUNC_ADD||e===th.FUNC_SUBTRACT||e===th.FUNC_REVERSE_SUBTRACT||e===th.MIN||e===th.MAX}function jU(e){return e===th.ZERO||e===th.ONE||e===th.SRC_COLOR||e===th.ONE_MINUS_SRC_COLOR||e===th.DST_COLOR||e===th.ONE_MINUS_DST_COLOR||e===th.SRC_ALPHA||e===th.ONE_MINUS_SRC_ALPHA||e===th.DST_ALPHA||e===th.ONE_MINUS_DST_ALPHA||e===th.CONSTANT_COLOR||e===th.ONE_MINUS_CONSTANT_COLOR||e===th.CONSTANT_ALPHA||e===th.ONE_MINUS_CONSTANT_ALPHA||e===th.SRC_ALPHA_SATURATE}function YU(e){return e===th.FRONT||e===th.BACK||e===th.FRONT_AND_BACK}function KU(e){return e===th.NEVER||e===th.LESS||e===th.EQUAL||e===th.LEQUAL||e===th.GREATER||e===th.NOTEQUAL||e===th.GEQUAL||e===th.ALWAYS}function XU(e){return e===th.NEVER||e===th.LESS||e===th.EQUAL||e===th.LEQUAL||e===th.GREATER||e===th.NOTEQUAL||e===th.GEQUAL||e===th.ALWAYS}function QU(e){return e===th.ZERO||e===th.KEEP||e===th.REPLACE||e===th.INCR||e===th.DECR||e===th.INVERT||e===th.INCR_WRAP||e===th.DECR_WRAP}function JU(e){const t=R(e,R.EMPTY_OBJECT),n=R(t.cull,R.EMPTY_OBJECT),i=R(t.polygonOffset,R.EMPTY_OBJECT),o=R(t.scissorTest,R.EMPTY_OBJECT),r=R(o.rectangle,R.EMPTY_OBJECT),s=R(t.depthRange,R.EMPTY_OBJECT),a=R(t.depthTest,R.EMPTY_OBJECT),c=R(t.colorMask,R.EMPTY_OBJECT),l=R(t.blending,R.EMPTY_OBJECT),u=R(l.color,R.EMPTY_OBJECT),h=R(t.stencilTest,R.EMPTY_OBJECT),d=R(h.frontOperation,R.EMPTY_OBJECT),f=R(h.backOperation,R.EMPTY_OBJECT),p=R(t.sampleCoverage,R.EMPTY_OBJECT),m=t.viewport;if(this.frontFace=R(t.frontFace,Mv.COUNTER_CLOCKWISE),this.cull={enabled:R(n.enabled,!1),face:R(n.face,th.BACK)},this.lineWidth=R(t.lineWidth,1),this.polygonOffset={enabled:R(i.enabled,!1),factor:R(i.factor,0),units:R(i.units,0)},this.scissorTest={enabled:R(o.enabled,!1),rectangle:bf.clone(r)},this.depthRange={near:R(s.near,0),far:R(s.far,1)},this.depthTest={enabled:R(a.enabled,!1),func:R(a.func,th.LESS)},this.colorMask={red:R(c.red,!0),green:R(c.green,!0),blue:R(c.blue,!0),alpha:R(c.alpha,!0)},this.depthMask=R(t.depthMask,!0),this.stencilMask=R(t.stencilMask,-1),this.blending={enabled:R(l.enabled,!1),color:new xy(R(u.red,0),R(u.green,0),R(u.blue,0),R(u.alpha,0)),equationRgb:R(l.equationRgb,th.FUNC_ADD),equationAlpha:R(l.equationAlpha,th.FUNC_ADD),functionSourceRgb:R(l.functionSourceRgb,th.ONE),functionSourceAlpha:R(l.functionSourceAlpha,th.ONE),functionDestinationRgb:R(l.functionDestinationRgb,th.ZERO),functionDestinationAlpha:R(l.functionDestinationAlpha,th.ZERO)},this.stencilTest={enabled:R(h.enabled,!1),frontFunction:R(h.frontFunction,th.ALWAYS),backFunction:R(h.backFunction,th.ALWAYS),reference:R(h.reference,0),mask:R(h.mask,-1),frontOperation:{fail:R(d.fail,th.KEEP),zFail:R(d.zFail,th.KEEP),zPass:R(d.zPass,th.KEEP)},backOperation:{fail:R(f.fail,th.KEEP),zFail:R(f.zFail,th.KEEP),zPass:R(f.zPass,th.KEEP)}},this.sampleCoverage={enabled:R(p.enabled,!1),value:R(p.value,1),invert:R(p.invert,!1)},this.viewport=C(m)?new bf(m.x,m.y,m.width,m.height):void 0,this.lineWidth<Ck.minimumAliasedLineWidth||this.lineWidth>Ck.maximumAliasedLineWidth)throw new x("renderState.lineWidth is out of range.  Check minimumAliasedLineWidth and maximumAliasedLineWidth.");if(!Mv.validate(this.frontFace))throw new x("Invalid renderState.frontFace.");if(!YU(this.cull.face))throw new x("Invalid renderState.cull.face.");if(this.scissorTest.rectangle.width<0||this.scissorTest.rectangle.height<0)throw new x("renderState.scissorTest.rectangle.width and renderState.scissorTest.rectangle.height must be greater than or equal to zero.");if(this.depthRange.near>this.depthRange.far)throw new x("renderState.depthRange.near can not be greater than renderState.depthRange.far.");if(this.depthRange.near<0)throw new x("renderState.depthRange.near must be greater than or equal to zero.");if(this.depthRange.far>1)throw new x("renderState.depthRange.far must be less than or equal to one.");if(!KU(this.depthTest.func))throw new x("Invalid renderState.depthTest.func.");if(this.blending.color.red<0||this.blending.color.red>1||this.blending.color.green<0||this.blending.color.green>1||this.blending.color.blue<0||this.blending.color.blue>1||this.blending.color.alpha<0||this.blending.color.alpha>1)throw new x("renderState.blending.color components must be greater than or equal to zero and less than or equal to one.");if(!qU(this.blending.equationRgb))throw new x("Invalid renderState.blending.equationRgb.");if(!qU(this.blending.equationAlpha))throw new x("Invalid renderState.blending.equationAlpha.");if(!jU(this.blending.functionSourceRgb))throw new x("Invalid renderState.blending.functionSourceRgb.");if(!jU(this.blending.functionSourceAlpha))throw new x("Invalid renderState.blending.functionSourceAlpha.");if(!jU(this.blending.functionDestinationRgb))throw new x("Invalid renderState.blending.functionDestinationRgb.");if(!jU(this.blending.functionDestinationAlpha))throw new x("Invalid renderState.blending.functionDestinationAlpha.");if(!XU(this.stencilTest.frontFunction))throw new x("Invalid renderState.stencilTest.frontFunction.");if(!XU(this.stencilTest.backFunction))throw new x("Invalid renderState.stencilTest.backFunction.");if(!QU(this.stencilTest.frontOperation.fail))throw new x("Invalid renderState.stencilTest.frontOperation.fail.");if(!QU(this.stencilTest.frontOperation.zFail))throw new x("Invalid renderState.stencilTest.frontOperation.zFail.");if(!QU(this.stencilTest.frontOperation.zPass))throw new x("Invalid renderState.stencilTest.frontOperation.zPass.");if(!QU(this.stencilTest.backOperation.fail))throw new x("Invalid renderState.stencilTest.backOperation.fail.");if(!QU(this.stencilTest.backOperation.zFail))throw new x("Invalid renderState.stencilTest.backOperation.zFail.");if(!QU(this.stencilTest.backOperation.zPass))throw new x("Invalid renderState.stencilTest.backOperation.zPass.");if(C(this.viewport)){if(this.viewport.width<0)throw new x("renderState.viewport.width must be greater than or equal to zero.");if(this.viewport.height<0)throw new x("renderState.viewport.height must be greater than or equal to zero.");if(this.viewport.width>Ck.maximumViewportWidth)throw new x(`renderState.viewport.width must be less than or equal to the maximum viewport width (${Ck.maximumViewportWidth.toString()}).  Check maximumViewportWidth.`);if(this.viewport.height>Ck.maximumViewportHeight)throw new x(`renderState.viewport.height must be less than or equal to the maximum viewport height (${Ck.maximumViewportHeight.toString()}).  Check maximumViewportHeight.`)}this.id=0,this._applyFunctions=[]}let ZU=0,$U={};function eV(e,t,n){n?e.enable(t):e.disable(t)}function tV(e,t){e.frontFace(t.frontFace)}function nV(e,t){const n=t.cull,i=n.enabled;eV(e,e.CULL_FACE,i),i&&e.cullFace(n.face)}function iV(e,t){e.lineWidth(t.lineWidth)}function oV(e,t){const n=t.polygonOffset,i=n.enabled;eV(e,e.POLYGON_OFFSET_FILL,i),i&&e.polygonOffset(n.factor,n.units)}function rV(e,t,n){const i=t.scissorTest,o=C(n.scissorTest)?n.scissorTest.enabled:i.enabled;if(eV(e,e.SCISSOR_TEST,o),o){const t=C(n.scissorTest)?n.scissorTest.rectangle:i.rectangle;e.scissor(t.x,t.y,t.width,t.height)}}function sV(e,t){const n=t.depthRange;e.depthRange(n.near,n.far)}function aV(e,t){const n=t.depthTest,i=n.enabled;eV(e,e.DEPTH_TEST,i),i&&e.depthFunc(n.func)}function cV(e,t){const n=t.colorMask;e.colorMask(n.red,n.green,n.blue,n.alpha)}function lV(e,t){e.depthMask(t.depthMask)}function uV(e,t){e.stencilMask(t.stencilMask)}function hV(e,t){e.blendColor(t.red,t.green,t.blue,t.alpha)}function dV(e,t,n){const i=t.blending,o=C(n.blendingEnabled)?n.blendingEnabled:i.enabled;eV(e,e.BLEND,o),o&&(hV(e,i.color),e.blendEquationSeparate(i.equationRgb,i.equationAlpha),e.blendFuncSeparate(i.functionSourceRgb,i.functionDestinationRgb,i.functionSourceAlpha,i.functionDestinationAlpha))}function fV(e,t){const n=t.stencilTest,i=n.enabled;if(eV(e,e.STENCIL_TEST,i),i){const t=n.frontFunction,i=n.backFunction,o=n.reference,r=n.mask;e.stencilFunc(t,o,r),e.stencilFuncSeparate(e.BACK,i,o,r),e.stencilFuncSeparate(e.FRONT,t,o,r);const s=n.frontOperation,a=s.fail,c=s.zFail,l=s.zPass;e.stencilOpSeparate(e.FRONT,a,c,l);const u=n.backOperation,h=u.fail,d=u.zFail,f=u.zPass;e.stencilOpSeparate(e.BACK,h,d,f)}}function pV(e,t){const n=t.sampleCoverage,i=n.enabled;eV(e,e.SAMPLE_COVERAGE,i),i&&e.sampleCoverage(n.value,n.invert)}JU.fromCache=function(e){const t=JSON.stringify(e);let n=$U[t];if(C(n))return++n.referenceCount,n.state;let i=new JU(e);const o=JSON.stringify(i);return n=$U[o],C(n)||(i.id=ZU++,i=WU(i),n={referenceCount:0,state:i},$U[o]=n),++n.referenceCount,$U[t]={referenceCount:1,state:n.state},n.state},JU.removeFromCache=function(e){const t=new JU(e),n=JSON.stringify(t),i=$U[n],o=JSON.stringify(e),r=$U[o];C(r)&&(--r.referenceCount,0===r.referenceCount&&(delete $U[o],C(i)&&--i.referenceCount)),C(i)&&0===i.referenceCount&&delete $U[n]},JU.getCache=function(){return $U},JU.clearCache=function(){$U={}};const mV=new bf;function _V(e,t,n){let i=R(t.viewport,n.viewport);C(i)||(i=mV,i.width=n.context.drawingBufferWidth,i.height=n.context.drawingBufferHeight),n.context.uniformState.viewport=i,e.viewport(i.x,i.y,i.width,i.height)}function gV(e,t){const n=[];return e.frontFace!==t.frontFace&&n.push(tV),e.cull.enabled===t.cull.enabled&&e.cull.face===t.cull.face||n.push(nV),e.lineWidth!==t.lineWidth&&n.push(iV),e.polygonOffset.enabled===t.polygonOffset.enabled&&e.polygonOffset.factor===t.polygonOffset.factor&&e.polygonOffset.units===t.polygonOffset.units||n.push(oV),e.depthRange.near===t.depthRange.near&&e.depthRange.far===t.depthRange.far||n.push(sV),e.depthTest.enabled===t.depthTest.enabled&&e.depthTest.func===t.depthTest.func||n.push(aV),e.colorMask.red===t.colorMask.red&&e.colorMask.green===t.colorMask.green&&e.colorMask.blue===t.colorMask.blue&&e.colorMask.alpha===t.colorMask.alpha||n.push(cV),e.depthMask!==t.depthMask&&n.push(lV),e.stencilMask!==t.stencilMask&&n.push(uV),e.stencilTest.enabled===t.stencilTest.enabled&&e.stencilTest.frontFunction===t.stencilTest.frontFunction&&e.stencilTest.backFunction===t.stencilTest.backFunction&&e.stencilTest.reference===t.stencilTest.reference&&e.stencilTest.mask===t.stencilTest.mask&&e.stencilTest.frontOperation.fail===t.stencilTest.frontOperation.fail&&e.stencilTest.frontOperation.zFail===t.stencilTest.frontOperation.zFail&&e.stencilTest.backOperation.fail===t.stencilTest.backOperation.fail&&e.stencilTest.backOperation.zFail===t.stencilTest.backOperation.zFail&&e.stencilTest.backOperation.zPass===t.stencilTest.backOperation.zPass||n.push(fV),e.sampleCoverage.enabled===t.sampleCoverage.enabled&&e.sampleCoverage.value===t.sampleCoverage.value&&e.sampleCoverage.invert===t.sampleCoverage.invert||n.push(pV),n}JU.apply=function(e,t,n){tV(e,t),nV(e,t),iV(e,t),oV(e,t),sV(e,t),aV(e,t),cV(e,t),lV(e,t),uV(e,t),fV(e,t),pV(e,t),rV(e,t,n),dV(e,t,n),_V(e,t,n)},JU.partialApply=function(e,t,n,i,o,r){if(t!==n){let i=n._applyFunctions[t.id];C(i)||(i=gV(t,n),n._applyFunctions[t.id]=i);const o=i.length;for(let t=0;t<o;++t)i[t](e,n)}const s=C(i.scissorTest)?i.scissorTest:t.scissorTest,a=C(o.scissorTest)?o.scissorTest:n.scissorTest;(s!==a||r)&&rV(e,n,o);const c=C(i.blendingEnabled)?i.blendingEnabled:t.blending.enabled,l=C(o.blendingEnabled)?o.blendingEnabled:n.blending.enabled;(c!==l||l&&t.blending!==n.blending)&&dV(e,n,o),t===n&&i===o&&i.context===o.context||_V(e,n,o)},JU.getState=function(e){if(!C(e))throw new x("renderState is required.");return{frontFace:e.frontFace,cull:{enabled:e.cull.enabled,face:e.cull.face},lineWidth:e.lineWidth,polygonOffset:{enabled:e.polygonOffset.enabled,factor:e.polygonOffset.factor,units:e.polygonOffset.units},scissorTest:{enabled:e.scissorTest.enabled,rectangle:bf.clone(e.scissorTest.rectangle)},depthRange:{near:e.depthRange.near,far:e.depthRange.far},depthTest:{enabled:e.depthTest.enabled,func:e.depthTest.func},colorMask:{red:e.colorMask.red,green:e.colorMask.green,blue:e.colorMask.blue,alpha:e.colorMask.alpha},depthMask:e.depthMask,stencilMask:e.stencilMask,blending:{enabled:e.blending.enabled,color:xy.clone(e.blending.color),equationRgb:e.blending.equationRgb,equationAlpha:e.blending.equationAlpha,functionSourceRgb:e.blending.functionSourceRgb,functionSourceAlpha:e.blending.functionSourceAlpha,functionDestinationRgb:e.blending.functionDestinationRgb,functionDestinationAlpha:e.blending.functionDestinationAlpha},stencilTest:{enabled:e.stencilTest.enabled,frontFunction:e.stencilTest.frontFunction,backFunction:e.stencilTest.backFunction,reference:e.stencilTest.reference,mask:e.stencilTest.mask,frontOperation:{fail:e.stencilTest.frontOperation.fail,zFail:e.stencilTest.frontOperation.zFail,zPass:e.stencilTest.frontOperation.zPass},backOperation:{fail:e.stencilTest.backOperation.fail,zFail:e.stencilTest.backOperation.zFail,zPass:e.stencilTest.backOperation.zPass}},sampleCoverage:{enabled:e.sampleCoverage.enabled,value:e.sampleCoverage.value,invert:e.sampleCoverage.invert},viewport:C(e.viewport)?bf.clone(e.viewport):void 0}};var yV=JU;const vV=new K;function bV(e){this._size=e.size,this._datatype=e.datatype,this.getValue=e.getValue}const AV={};AV[th.FLOAT]="float",AV[th.FLOAT_VEC2]="vec2",AV[th.FLOAT_VEC3]="vec3",AV[th.FLOAT_VEC4]="vec4",AV[th.INT]="int",AV[th.INT_VEC2]="ivec2",AV[th.INT_VEC3]="ivec3",AV[th.INT_VEC4]="ivec4",AV[th.BOOL]="bool",AV[th.BOOL_VEC2]="bvec2",AV[th.BOOL_VEC3]="bvec3",AV[th.BOOL_VEC4]="bvec4",AV[th.FLOAT_MAT2]="mat2",AV[th.FLOAT_MAT3]="mat3",AV[th.FLOAT_MAT4]="mat4",AV[th.SAMPLER_2D]="sampler2D",AV[th.SAMPLER_CUBE]="samplerCube",bV.prototype.getDeclaration=function(e){let t=`uniform ${AV[this._datatype]} ${e}`;const n=this._size;return t+=1===n?";":`[${n.toString()}];`,t};const wV={czm_viewport:new bV({size:1,datatype:th.FLOAT_VEC4,getValue:function(e){return e.viewportCartesian4}}),czm_viewportOrthographic:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.viewportOrthographic}}),czm_viewportTransformation:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.viewportTransformation}}),czm_globeDepthTexture:new bV({size:1,datatype:th.SAMPLER_2D,getValue:function(e){return e.globeDepthTexture}}),czm_model:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.model}}),czm_inverseModel:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.inverseModel}}),czm_view:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.view}}),czm_view3D:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.view3D}}),czm_viewRotation:new bV({size:1,datatype:th.FLOAT_MAT3,getValue:function(e){return e.viewRotation}}),czm_viewRotation3D:new bV({size:1,datatype:th.FLOAT_MAT3,getValue:function(e){return e.viewRotation3D}}),czm_inverseView:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.inverseView}}),czm_inverseView3D:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.inverseView3D}}),czm_inverseViewRotation:new bV({size:1,datatype:th.FLOAT_MAT3,getValue:function(e){return e.inverseViewRotation}}),czm_inverseViewRotation3D:new bV({size:1,datatype:th.FLOAT_MAT3,getValue:function(e){return e.inverseViewRotation3D}}),czm_projection:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.projection}}),czm_inverseProjection:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.inverseProjection}}),czm_infiniteProjection:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.infiniteProjection}}),czm_modelView:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.modelView}}),czm_modelView3D:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.modelView3D}}),czm_modelViewRelativeToEye:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.modelViewRelativeToEye}}),czm_inverseModelView:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.inverseModelView}}),czm_inverseModelView3D:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.inverseModelView3D}}),czm_viewProjection:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.viewProjection}}),czm_inverseViewProjection:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.inverseViewProjection}}),czm_modelViewProjection:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.modelViewProjection}}),czm_inverseModelViewProjection:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.inverseModelViewProjection}}),czm_modelViewProjectionRelativeToEye:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.modelViewProjectionRelativeToEye}}),czm_modelViewInfiniteProjection:new bV({size:1,datatype:th.FLOAT_MAT4,getValue:function(e){return e.modelViewInfiniteProjection}}),czm_orthographicIn3D:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.orthographicIn3D?1:0}}),czm_normal:new bV({size:1,datatype:th.FLOAT_MAT3,getValue:function(e){return e.normal}}),czm_normal3D:new bV({size:1,datatype:th.FLOAT_MAT3,getValue:function(e){return e.normal3D}}),czm_inverseNormal:new bV({size:1,datatype:th.FLOAT_MAT3,getValue:function(e){return e.inverseNormal}}),czm_inverseNormal3D:new bV({size:1,datatype:th.FLOAT_MAT3,getValue:function(e){return e.inverseNormal3D}}),czm_eyeHeight:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.eyeHeight}}),czm_eyeHeight2D:new bV({size:1,datatype:th.FLOAT_VEC2,getValue:function(e){return e.eyeHeight2D}}),czm_entireFrustum:new bV({size:1,datatype:th.FLOAT_VEC2,getValue:function(e){return e.entireFrustum}}),czm_currentFrustum:new bV({size:1,datatype:th.FLOAT_VEC2,getValue:function(e){return e.currentFrustum}}),czm_frustumPlanes:new bV({size:1,datatype:th.FLOAT_VEC4,getValue:function(e){return e.frustumPlanes}}),czm_farDepthFromNearPlusOne:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.farDepthFromNearPlusOne}}),czm_log2FarDepthFromNearPlusOne:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.log2FarDepthFromNearPlusOne}}),czm_oneOverLog2FarDepthFromNearPlusOne:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.oneOverLog2FarDepthFromNearPlusOne}}),czm_sunPositionWC:new bV({size:1,datatype:th.FLOAT_VEC3,getValue:function(e){return e.sunPositionWC}}),czm_sunPositionColumbusView:new bV({size:1,datatype:th.FLOAT_VEC3,getValue:function(e){return e.sunPositionColumbusView}}),czm_sunDirectionEC:new bV({size:1,datatype:th.FLOAT_VEC3,getValue:function(e){return e.sunDirectionEC}}),czm_sunDirectionWC:new bV({size:1,datatype:th.FLOAT_VEC3,getValue:function(e){return e.sunDirectionWC}}),czm_moonDirectionEC:new bV({size:1,datatype:th.FLOAT_VEC3,getValue:function(e){return e.moonDirectionEC}}),czm_lightDirectionEC:new bV({size:1,datatype:th.FLOAT_VEC3,getValue:function(e){return e.lightDirectionEC}}),czm_lightDirectionWC:new bV({size:1,datatype:th.FLOAT_VEC3,getValue:function(e){return e.lightDirectionWC}}),czm_lightColor:new bV({size:1,datatype:th.FLOAT_VEC3,getValue:function(e){return e.lightColor}}),czm_lightColorHdr:new bV({size:1,datatype:th.FLOAT_VEC3,getValue:function(e){return e.lightColorHdr}}),czm_encodedCameraPositionMCHigh:new bV({size:1,datatype:th.FLOAT_VEC3,getValue:function(e){return e.encodedCameraPositionMCHigh}}),czm_encodedCameraPositionMCLow:new bV({size:1,datatype:th.FLOAT_VEC3,getValue:function(e){return e.encodedCameraPositionMCLow}}),czm_viewerPositionWC:new bV({size:1,datatype:th.FLOAT_VEC3,getValue:function(e){return ft.getTranslation(e.inverseView,vV)}}),czm_frameNumber:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.frameState.frameNumber}}),czm_morphTime:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.frameState.morphTime}}),czm_sceneMode:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.frameState.mode}}),czm_pass:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.pass}}),czm_backgroundColor:new bV({size:1,datatype:th.FLOAT_VEC4,getValue:function(e){return e.backgroundColor}}),czm_brdfLut:new bV({size:1,datatype:th.SAMPLER_2D,getValue:function(e){return e.brdfLut}}),czm_environmentMap:new bV({size:1,datatype:th.SAMPLER_CUBE,getValue:function(e){return e.environmentMap}}),czm_specularEnvironmentMaps:new bV({size:1,datatype:th.SAMPLER_2D,getValue:function(e){return e.specularEnvironmentMaps}}),czm_specularEnvironmentMapSize:new bV({size:1,datatype:th.FLOAT_VEC2,getValue:function(e){return e.specularEnvironmentMapsDimensions}}),czm_specularEnvironmentMapsMaximumLOD:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.specularEnvironmentMapsMaximumLOD}}),czm_sphericalHarmonicCoefficients:new bV({size:9,datatype:th.FLOAT_VEC3,getValue:function(e){return e.sphericalHarmonicCoefficients}}),czm_temeToPseudoFixed:new bV({size:1,datatype:th.FLOAT_MAT3,getValue:function(e){return e.temeToPseudoFixedMatrix}}),czm_pixelRatio:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.pixelRatio}}),czm_fogDensity:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.fogDensity}}),czm_splitPosition:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.splitPosition}}),czm_imagerySplitPosition:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.imagerySplitPosition}}),czm_geometricToleranceOverMeter:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.geometricToleranceOverMeter}}),czm_minimumDisableDepthTestDistance:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.minimumDisableDepthTestDistance}}),czm_invertClassificationColor:new bV({size:1,datatype:th.FLOAT_VEC4,getValue:function(e){return e.invertClassificationColor}}),czm_gamma:new bV({size:1,datatype:th.FLOAT,getValue:function(e){return e.gamma}}),czm_ellipsoidRadii:new bV({size:1,datatype:th.FLOAT_VEC3,getValue:function(e){return e.ellipsoid.radii}}),czm_ellipsoidInverseRadii:new bV({size:1,datatype:th.FLOAT_VEC3,getValue:function(e){return e.ellipsoid.oneOverRadii}})};var TV=wV;function CV(e,t,n,i){switch(t.type){case e.FLOAT:return new EV(e,t,n,i);case e.FLOAT_VEC2:return new xV(e,t,n,i);case e.FLOAT_VEC3:return new SV(e,t,n,i);case e.FLOAT_VEC4:return new IV(e,t,n,i);case e.SAMPLER_2D:case e.SAMPLER_CUBE:return new OV(e,t,n,i);case e.INT:case e.BOOL:return new DV(e,t,n,i);case e.INT_VEC2:case e.BOOL_VEC2:return new PV(e,t,n,i);case e.INT_VEC3:case e.BOOL_VEC3:return new RV(e,t,n,i);case e.INT_VEC4:case e.BOOL_VEC4:return new LV(e,t,n,i);case e.FLOAT_MAT2:return new BV(e,t,n,i);case e.FLOAT_MAT3:return new FV(e,t,n,i);case e.FLOAT_MAT4:return new kV(e,t,n,i);default:throw new Je(`Unrecognized uniform type: ${t.type} for uniform "${n}".`)}}function EV(e,t,n,i){this.name=n,this.value=void 0,this._value=0,this._gl=e,this._location=i}function xV(e,t,n,i){this.name=n,this.value=void 0,this._value=new ro,this._gl=e,this._location=i}function SV(e,t,n,i){this.name=n,this.value=void 0,this._value=void 0,this._gl=e,this._location=i}function IV(e,t,n,i){this.name=n,this.value=void 0,this._value=void 0,this._gl=e,this._location=i}function OV(e,t,n,i){this.name=n,this.value=void 0,this._gl=e,this._location=i,this.textureUnitIndex=void 0}function DV(e,t,n,i){this.name=n,this.value=void 0,this._value=0,this._gl=e,this._location=i}function PV(e,t,n,i){this.name=n,this.value=void 0,this._value=new ro,this._gl=e,this._location=i}function RV(e,t,n,i){this.name=n,this.value=void 0,this._value=new K,this._gl=e,this._location=i}function LV(e,t,n,i){this.name=n,this.value=void 0,this._value=new Xe,this._gl=e,this._location=i}EV.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1f(this._location,this.value))},xV.prototype.set=function(){const e=this.value;ro.equals(e,this._value)||(ro.clone(e,this._value),this._gl.uniform2f(this._location,e.x,e.y))},SV.prototype.set=function(){const e=this.value;if(C(e.red))xy.equals(e,this._value)||(this._value=xy.clone(e,this._value),this._gl.uniform3f(this._location,e.red,e.green,e.blue));else{if(!C(e.x))throw new x(`Invalid vec3 value for uniform "${this.name}".`);K.equals(e,this._value)||(this._value=K.clone(e,this._value),this._gl.uniform3f(this._location,e.x,e.y,e.z))}},IV.prototype.set=function(){const e=this.value;if(C(e.red))xy.equals(e,this._value)||(this._value=xy.clone(e,this._value),this._gl.uniform4f(this._location,e.red,e.green,e.blue,e.alpha));else{if(!C(e.x))throw new x(`Invalid vec4 value for uniform "${this.name}".`);Xe.equals(e,this._value)||(this._value=Xe.clone(e,this._value),this._gl.uniform4f(this._location,e.x,e.y,e.z,e.w))}},OV.prototype.set=function(){const e=this._gl;e.activeTexture(e.TEXTURE0+this.textureUnitIndex);const t=this.value;e.bindTexture(t._target,t._texture)},OV.prototype._setSampler=function(e){return this.textureUnitIndex=e,this._gl.uniform1i(this._location,e),e+1},DV.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1i(this._location,this.value))},PV.prototype.set=function(){const e=this.value;ro.equals(e,this._value)||(ro.clone(e,this._value),this._gl.uniform2i(this._location,e.x,e.y))},RV.prototype.set=function(){const e=this.value;K.equals(e,this._value)||(K.clone(e,this._value),this._gl.uniform3i(this._location,e.x,e.y,e.z))},LV.prototype.set=function(){const e=this.value;Xe.equals(e,this._value)||(Xe.clone(e,this._value),this._gl.uniform4i(this._location,e.x,e.y,e.z,e.w))};const MV=new Float32Array(4);function BV(e,t,n,i){this.name=n,this.value=void 0,this._value=new hh,this._gl=e,this._location=i}BV.prototype.set=function(){if(!hh.equalsArray(this.value,this._value,0)){hh.clone(this.value,this._value);const e=hh.toArray(this.value,MV);this._gl.uniformMatrix2fv(this._location,!1,e)}};const NV=new Float32Array(9);function FV(e,t,n,i){this.name=n,this.value=void 0,this._value=new ke,this._gl=e,this._location=i}FV.prototype.set=function(){if(!ke.equalsArray(this.value,this._value,0)){ke.clone(this.value,this._value);const e=ke.toArray(this.value,NV);this._gl.uniformMatrix3fv(this._location,!1,e)}};const zV=new Float32Array(16);function kV(e,t,n,i){this.name=n,this.value=void 0,this._value=new ft,this._gl=e,this._location=i}kV.prototype.set=function(){if(!ft.equalsArray(this.value,this._value,0)){ft.clone(this.value,this._value);const e=ft.toArray(this.value,zV);this._gl.uniformMatrix4fv(this._location,!1,e)}};var UV=CV;function VV(e,t,n,i){switch(t.type){case e.FLOAT:return new HV(e,t,n,i);case e.FLOAT_VEC2:return new GV(e,t,n,i);case e.FLOAT_VEC3:return new WV(e,t,n,i);case e.FLOAT_VEC4:return new qV(e,t,n,i);case e.SAMPLER_2D:case e.SAMPLER_CUBE:return new jV(e,t,n,i);case e.INT:case e.BOOL:return new YV(e,t,n,i);case e.INT_VEC2:case e.BOOL_VEC2:return new KV(e,t,n,i);case e.INT_VEC3:case e.BOOL_VEC3:return new XV(e,t,n,i);case e.INT_VEC4:case e.BOOL_VEC4:return new QV(e,t,n,i);case e.FLOAT_MAT2:return new JV(e,t,n,i);case e.FLOAT_MAT3:return new ZV(e,t,n,i);case e.FLOAT_MAT4:return new $V(e,t,n,i);default:throw new Je(`Unrecognized uniform type: ${t.type} for uniform "${n}".`)}}function HV(e,t,n,i){const o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(o),this._gl=e,this._location=i[0]}function GV(e,t,n,i){const o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(2*o),this._gl=e,this._location=i[0]}function WV(e,t,n,i){const o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(3*o),this._gl=e,this._location=i[0]}function qV(e,t,n,i){const o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(4*o),this._gl=e,this._location=i[0]}function jV(e,t,n,i){const o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(o),this._gl=e,this._locations=i,this.textureUnitIndex=void 0}function YV(e,t,n,i){const o=i.length;this.name=n,this.value=new Array(o),this._value=new Int32Array(o),this._gl=e,this._location=i[0]}function KV(e,t,n,i){const o=i.length;this.name=n,this.value=new Array(o),this._value=new Int32Array(2*o),this._gl=e,this._location=i[0]}function XV(e,t,n,i){const o=i.length;this.name=n,this.value=new Array(o),this._value=new Int32Array(3*o),this._gl=e,this._location=i[0]}function QV(e,t,n,i){const o=i.length;this.name=n,this.value=new Array(o),this._value=new Int32Array(4*o),this._gl=e,this._location=i[0]}function JV(e,t,n,i){const o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(4*o),this._gl=e,this._location=i[0]}function ZV(e,t,n,i){const o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(9*o),this._gl=e,this._location=i[0]}function $V(e,t,n,i){const o=i.length;this.name=n,this.value=new Array(o),this._value=new Float32Array(16*o),this._gl=e,this._location=i[0]}HV.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1;for(let o=0;o<t;++o){const t=e[o];t!==n[o]&&(n[o]=t,i=!0)}i&&this._gl.uniform1fv(this._location,n)},GV.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,o=0;for(let r=0;r<t;++r){const t=e[r];ro.equalsArray(t,n,o)||(ro.pack(t,n,o),i=!0),o+=2}i&&this._gl.uniform2fv(this._location,n)},WV.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,o=0;for(let r=0;r<t;++r){const t=e[r];if(C(t.red))t.red===n[o]&&t.green===n[o+1]&&t.blue===n[o+2]||(n[o]=t.red,n[o+1]=t.green,n[o+2]=t.blue,i=!0);else{if(!C(t.x))throw new x("Invalid vec3 value.");K.equalsArray(t,n,o)||(K.pack(t,n,o),i=!0)}o+=3}i&&this._gl.uniform3fv(this._location,n)},qV.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,o=0;for(let r=0;r<t;++r){const t=e[r];if(C(t.red))xy.equalsArray(t,n,o)||(xy.pack(t,n,o),i=!0);else{if(!C(t.x))throw new x("Invalid vec4 value.");Xe.equalsArray(t,n,o)||(Xe.pack(t,n,o),i=!0)}o+=4}i&&this._gl.uniform4fv(this._location,n)},jV.prototype.set=function(){const e=this._gl,t=e.TEXTURE0+this.textureUnitIndex,n=this.value,i=n.length;for(let o=0;o<i;++o){const i=n[o];e.activeTexture(t+o),e.bindTexture(i._target,i._texture)}},jV.prototype._setSampler=function(e){this.textureUnitIndex=e;const t=this._locations,n=t.length;for(let i=0;i<n;++i){const n=e+i;this._gl.uniform1i(t[i],n)}return e+n},YV.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1;for(let o=0;o<t;++o){const t=e[o];t!==n[o]&&(n[o]=t,i=!0)}i&&this._gl.uniform1iv(this._location,n)},KV.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,o=0;for(let r=0;r<t;++r){const t=e[r];ro.equalsArray(t,n,o)||(ro.pack(t,n,o),i=!0),o+=2}i&&this._gl.uniform2iv(this._location,n)},XV.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,o=0;for(let r=0;r<t;++r){const t=e[r];K.equalsArray(t,n,o)||(K.pack(t,n,o),i=!0),o+=3}i&&this._gl.uniform3iv(this._location,n)},QV.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,o=0;for(let r=0;r<t;++r){const t=e[r];Xe.equalsArray(t,n,o)||(Xe.pack(t,n,o),i=!0),o+=4}i&&this._gl.uniform4iv(this._location,n)},JV.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,o=0;for(let r=0;r<t;++r){const t=e[r];hh.equalsArray(t,n,o)||(hh.pack(t,n,o),i=!0),o+=4}i&&this._gl.uniformMatrix2fv(this._location,!1,n)},ZV.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,o=0;for(let r=0;r<t;++r){const t=e[r];ke.equalsArray(t,n,o)||(ke.pack(t,n,o),i=!0),o+=9}i&&this._gl.uniformMatrix3fv(this._location,!1,n)},$V.prototype.set=function(){const e=this.value,t=e.length,n=this._value;let i=!1,o=0;for(let r=0;r<t;++r){const t=e[r];ft.equalsArray(t,n,o)||(ft.pack(t,n,o),i=!0),o+=16}i&&this._gl.uniformMatrix4fv(this._location,!1,n)};var eH=VV;let tH=0;function nH(e){let t=e.vertexShaderText,n=e.fragmentShaderText;"undefined"!==typeof spector&&(t=t.replace(/^#line/gm,"//#line"),n=n.replace(/^#line/gm,"//#line"));const i=oH(t,n);this._gl=e.gl,this._logShaderCompilation=e.logShaderCompilation,this._debugShaders=e.debugShaders,this._attributeLocations=e.attributeLocations,this._program=void 0,this._numberOfVertexAttributes=void 0,this._vertexAttributes=void 0,this._uniformsByName=void 0,this._uniforms=void 0,this._automaticUniforms=void 0,this._manualUniforms=void 0,this._duplicateUniformNames=i.duplicateUniformNames,this._cachedShader=void 0,this.maximumTextureUnitIndex=void 0,this._vertexShaderSource=e.vertexShaderSource,this._vertexShaderText=e.vertexShaderText,this._fragmentShaderSource=e.fragmentShaderSource,this._fragmentShaderText=i.fragmentShaderText,this.id=tH++}function iH(e){const t=[],n=e.match(/uniform.*?(?![^{]*})(?=[=\[;])/g);if(C(n)){const e=n.length;for(let i=0;i<e;i++){const e=n[i].trim(),o=e.slice(e.lastIndexOf(" ")+1);t.push(o)}}return t}function oH(e,t){const n={};if(!Ck.highpFloatSupported||!Ck.highpIntSupported){let i,o,r,s;const a=iH(e),c=iH(t),l=a.length,u=c.length;for(i=0;i<l;i++)for(o=0;o<u;o++)if(a[i]===c[o]){r=a[i],s=`czm_mediump_${r}`;const e=new RegExp(`${r}\\b`,"g");t=t.replace(e,s),n[s]=r}}return{fragmentShaderText:t,duplicateUniformNames:n}}nH.fromCache=function(e){return e=R(e,R.EMPTY_OBJECT),D.defined("options.context",e.context),e.context.shaderCache.getShaderProgram(e)},nH.replaceCache=function(e){return e=R(e,R.EMPTY_OBJECT),D.defined("options.context",e.context),e.context.shaderCache.replaceShaderProgram(e)},Object.defineProperties(nH.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},vertexAttributes:{get:function(){return hH(this),this._vertexAttributes}},numberOfVertexAttributes:{get:function(){return hH(this),this._numberOfVertexAttributes}},allUniforms:{get:function(){return hH(this),this._uniformsByName}}});const rH="[Cesium WebGL] ";function sH(e,t){const n=t._vertexShaderText,i=t._fragmentShaderText,o=e.createShader(e.VERTEX_SHADER);e.shaderSource(o,n),e.compileShader(o);const r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,i),e.compileShader(r);const s=e.createProgram();e.attachShader(s,o),e.attachShader(s,r),e.deleteShader(o),e.deleteShader(r);const a=t._attributeLocations;if(C(a))for(const u in a)a.hasOwnProperty(u)&&e.bindAttribLocation(s,a[u],u);let c;if(e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS)){const n=t._debugShaders;if(!e.getShaderParameter(r,e.COMPILE_STATUS)){if(c=e.getShaderInfoLog(r),console.error(`${rH}Fragment shader compile log: ${c}`),C(n)){const e=n.getTranslatedShaderSource(r);""!==e?console.error(`${rH}Translated fragment shader source:\n${e}`):console.error(`${rH}Fragment shader translation failed.`)}throw e.deleteProgram(s),new Je(`Fragment shader failed to compile.  Compile log: ${c}`)}if(!e.getShaderParameter(o,e.COMPILE_STATUS)){if(c=e.getShaderInfoLog(o),console.error(`${rH}Vertex shader compile log: ${c}`),C(n)){const e=n.getTranslatedShaderSource(o);""!==e?console.error(`${rH}Translated vertex shader source:\n${e}`):console.error(`${rH}Vertex shader translation failed.`)}throw e.deleteProgram(s),new Je(`Vertex shader failed to compile.  Compile log: ${c}`)}throw c=e.getProgramInfoLog(s),console.error(`${rH}Shader program link log: ${c}`),C(n)&&(console.error(`${rH}Translated vertex shader source:\n${n.getTranslatedShaderSource(o)}`),console.error(`${rH}Translated fragment shader source:\n${n.getTranslatedShaderSource(r)}`)),e.deleteProgram(s),new Je(`Program failed to link.  Link log: ${c}`)}const l=t._logShaderCompilation;return l&&(c=e.getShaderInfoLog(o),C(c)&&c.length>0&&console.log(`${rH}Vertex shader compile log: ${c}`)),l&&(c=e.getShaderInfoLog(r),C(c)&&c.length>0&&console.log(`${rH}Fragment shader compile log: ${c}`)),l&&(c=e.getProgramInfoLog(s),C(c)&&c.length>0&&console.log(`${rH}Shader program link log: ${c}`)),s}function aH(e,t,n){const i={};for(let o=0;o<n;++o){const n=e.getActiveAttrib(t,o),r=e.getAttribLocation(t,n.name);i[n.name]={name:n.name,type:n.type,index:r}}return i}function cH(e,t){const n={},i=[],o=[],r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<r;++s){const r=e.getActiveUniform(t,s),a="[0]",c=-1!==r.name.indexOf(a,r.name.length-a.length)?r.name.slice(0,r.name.length-3):r.name;if(0!==c.indexOf("gl_"))if(r.name.indexOf("[")<0){const s=e.getUniformLocation(t,c);if(null!==s){const t=UV(e,r,c,s);n[c]=t,i.push(t),t._setSampler&&o.push(t)}}else{let s,a,l,u;const h=c.indexOf("[");if(h>=0){if(s=n[c.slice(0,h)],!C(s))continue;a=s._locations,a.length<=1&&(l=s.value,u=e.getUniformLocation(t,c),null!==u&&(a.push(u),l.push(e.getUniform(t,u))))}else{a=[];for(let n=0;n<r.size;++n)u=e.getUniformLocation(t,`${c}[${n}]`),null!==u&&a.push(u);s=eH(e,r,c,a),n[c]=s,i.push(s),s._setSampler&&o.push(s)}}}return{uniformsByName:n,uniforms:i,samplerUniforms:o}}function lH(e,t){const n=[],i=[];for(const o in t)if(t.hasOwnProperty(o)){const r=t[o];let s=o;const a=e._duplicateUniformNames[s];C(a)&&(r.name=a,s=a);const c=TV[s];C(c)?n.push({uniform:r,automaticUniform:c}):i.push(r)}return{automaticUniforms:n,manualUniforms:i}}function uH(e,t,n){e.useProgram(t);let i=0;const o=n.length;for(let r=0;r<o;++r)i=n[r]._setSampler(i);return e.useProgram(null),i}function hH(e){C(e._program)||dH(e)}function dH(e){const t=e._program,n=e._gl,i=sH(n,e,e._debugShaders),o=n.getProgramParameter(i,n.ACTIVE_ATTRIBUTES),r=cH(n,i),s=lH(e,r.uniformsByName);e._program=i,e._numberOfVertexAttributes=o,e._vertexAttributes=aH(n,i,o),e._uniformsByName=r.uniformsByName,e._uniforms=r.uniforms,e._automaticUniforms=s.automaticUniforms,e._manualUniforms=s.manualUniforms,e.maximumTextureUnitIndex=uH(n,i,r.samplerUniforms),t&&e._gl.deleteProgram(t),"undefined"!==typeof spector&&(e._program.__SPECTOR_rebuildProgram=function(t,n,i,o){const r=e._vertexShaderText,s=e._fragmentShaderText,a=/ ! = /g;e._vertexShaderText=t.replace(a," != "),e._fragmentShaderText=n.replace(a," != ");try{dH(e),i(e._program)}catch(c){e._vertexShaderText=r,e._fragmentShaderText=s;const t=/(?:Compile|Link) error: ([^]*)/,n=t.exec(c.message);o(n?n[1]:c.message)}})}nH.prototype._bind=function(){hH(this),this._gl.useProgram(this._program)},nH.prototype._setUniforms=function(e,t,n){let i,o;if(C(e)){const t=this._manualUniforms;for(i=t.length,o=0;o<i;++o){const n=t[o];n.value=e[n.name]()}}const r=this._automaticUniforms;for(i=r.length,o=0;o<i;++o){const e=r[o];e.uniform.value=e.automaticUniform.getValue(t)}const s=this._uniforms;for(i=s.length,o=0;o<i;++o)s[o].set();if(n){const e=this._gl,t=this._program;if(e.validateProgram(t),!e.getProgramParameter(t,e.VALIDATE_STATUS))throw new x(`Program validation failed.  Program info log: ${e.getProgramInfoLog(t)}`)}},nH.prototype.isDestroyed=function(){return!1},nH.prototype.destroy=function(){this._cachedShader.cache.releaseShaderProgram(this)},nH.prototype.finalDestroy=function(){return this._gl.deleteProgram(this._program),Qh(this)};var fH=nH;function pH(e,t){const n=/#define OUTPUT_DECLARATION/,i=e.split("\n");if(/#version 300 es/g.test(e))return e;let o,r,s=-1;for(o=0;o<i.length;++o)if(r=i[o],n.test(r)){s=o;break}if(-1===s)throw new x("Could not find a #define OUTPUT_DECLARATION!");const a=[];for(o=0;o<10;o++){const t=`gl_FragData\\[${o}\\]`,n=`czm_out${o}`,r=new RegExp(t,"g");r.test(e)&&(vH(n,a),mH(t,n,i),i.splice(s,0,`layout(location = ${o}) out vec4 ${n};`),s+=1)}const c="czm_fragColor";gH("gl_FragColor",i)&&(vH(c,a),mH("gl_FragColor",c,i),i.splice(s,0,"layout(location = 0) out vec4 czm_fragColor;"),s+=1);const l=bH(a,i),u={};for(o=0;o<i.length;o++){r=i[o];for(const e in l)if(l.hasOwnProperty(e)){const t=new RegExp(`(layout)[^]+(out)[^]+(${e})[^]+`,"g");t.test(r)&&(u[r]=e)}}for(const m in u)if(u.hasOwnProperty(m)){const e=u[m];let t=i.indexOf(m);const n=l[e],o=n.length;for(let r=0;r<o;r++)i.splice(t,0,n[r]);t+=o+1;for(let r=o-1;r>=0;r--)i.splice(t,0,`#endif //${n[r]}`)}const h="WEBGL_2",d=`#define ${h}`,f="#version 300 es";let p=!1;for(o=0;o<i.length;o++)if(/#version/.test(i[o])){i[o]=f,p=!0;break}return p||i.splice(0,0,f),i.splice(1,0,d),AH("EXT_draw_buffers",h,i),AH("EXT_frag_depth",h,i),AH("OES_standard_derivatives",h,i),mH("texture2D","texture",i),mH("texture3D","texture",i),mH("textureCube","texture",i),mH("gl_FragDepthEXT","gl_FragDepth",i),t?mH("varying","in",i):(mH("attribute","in",i),mH("varying","out",i)),yH(i)}function mH(e,t,n){const i=`(^|[^\\w])(${e})($|[^\\w])`,o=new RegExp(i,"g"),r=n.length;for(let s=0;s<r;++s){const e=n[s];n[s]=e.replace(o,`$1${t}$3`)}}function _H(e,t,n){const i=n.length;for(let o=0;o<i;++o){const i=n[o];n[o]=i.replace(e,t)}}function gH(e,t){const n=`(^|[^\\w])(${e})($|[^\\w])`,i=new RegExp(n,"g"),o=t.length;for(let r=0;r<o;++r){const e=t[r];if(i.test(e))return!0}return!1}function yH(e){let t="";const n=e.length;for(let i=0;i<n;++i)t+=`${e[i]}\n`;return t}function vH(e,t){-1===t.indexOf(e)&&t.push(e)}function bH(e,t){const n={},i=e.length,o=[];for(let r=0;r<t.length;++r){const s=t[r],a=/(#ifdef|#if)/g.test(s),c=/#else/g.test(s),l=/#endif/g.test(s);if(a)o.push(s);else if(c){const e=o[o.length-1];let t=e.replace("ifdef","ifndef");/if/g.test(t)&&(t=t.replace(/(#if\s+)(\S*)([^]*)/,"$1!($2)$3")),o.pop(),o.push(t)}else if(l)o.pop();else if(!/layout/g.test(s))for(let t=0;t<i;++t){const i=e[t];-1!==s.indexOf(i)&&(C(n[i])?n[i]=n[i].filter((function(e){return o.indexOf(e)>=0})):n[i]=o.slice())}}return n}function AH(e,t,n){const i=`#extension\\s+GL_${e}\\s+:\\s+[a-zA-Z0-9]+\\s*$`;_H(new RegExp(i,"g"),"",n),mH(`GL_${e}`,t,n)}var wH=pH,TH="/**\n * A built-in GLSL floating-point constant for converting radians to degrees.\n *\n * @alias czm_degreesPerRadian\n * @glslConstant\n *\n * @see CesiumMath.DEGREES_PER_RADIAN\n *\n * @example\n * // GLSL declaration\n * const float czm_degreesPerRadian = ...;\n *\n * // Example\n * float deg = czm_degreesPerRadian * rad;\n */\nconst float czm_degreesPerRadian = 57.29577951308232;\n",CH="/**\n * A built-in GLSL vec2 constant for defining the depth range.\n * This is a workaround to a bug where IE11 does not implement gl_DepthRange.\n *\n * @alias czm_depthRange\n * @glslConstant\n *\n * @example\n * // GLSL declaration\n * float depthRangeNear = czm_depthRange.near;\n * float depthRangeFar = czm_depthRange.far;\n *\n */\nconst czm_depthRangeStruct czm_depthRange = czm_depthRangeStruct(0.0, 1.0);\n",EH="/**\n * 0.1\n *\n * @name czm_epsilon1\n * @glslConstant\n */\nconst float czm_epsilon1 = 0.1;\n",xH="/**\n * 0.01\n *\n * @name czm_epsilon2\n * @glslConstant\n */\nconst float czm_epsilon2 = 0.01;\n",SH="/**\n * 0.001\n *\n * @name czm_epsilon3\n * @glslConstant\n */\nconst float czm_epsilon3 = 0.001;\n",IH="/**\n * 0.0001\n *\n * @name czm_epsilon4\n * @glslConstant\n */\nconst float czm_epsilon4 = 0.0001;\n",OH="/**\n * 0.00001\n *\n * @name czm_epsilon5\n * @glslConstant\n */\nconst float czm_epsilon5 = 0.00001;\n",DH="/**\n * 0.000001\n *\n * @name czm_epsilon6\n * @glslConstant\n */\nconst float czm_epsilon6 = 0.000001;\n",PH="/**\n * 0.0000001\n *\n * @name czm_epsilon7\n * @glslConstant\n */\nconst float czm_epsilon7 = 0.0000001;\n",RH="/**\n * DOC_TBA\n *\n * @name czm_infinity\n * @glslConstant\n */\nconst float czm_infinity = 5906376272000.0;  // Distance from the Sun to Pluto in meters.  TODO: What is best given lowp, mediump, and highp?\n",LH="/**\n * A built-in GLSL floating-point constant for <code>1/pi</code>.\n *\n * @alias czm_oneOverPi\n * @glslConstant\n *\n * @see CesiumMath.ONE_OVER_PI\n *\n * @example\n * // GLSL declaration\n * const float czm_oneOverPi = ...;\n *\n * // Example\n * float pi = 1.0 / czm_oneOverPi;\n */\nconst float czm_oneOverPi = 0.3183098861837907;\n",MH="/**\n * A built-in GLSL floating-point constant for <code>1/2pi</code>.\n *\n * @alias czm_oneOverTwoPi\n * @glslConstant\n *\n * @see CesiumMath.ONE_OVER_TWO_PI\n *\n * @example\n * // GLSL declaration\n * const float czm_oneOverTwoPi = ...;\n *\n * // Example\n * float pi = 2.0 * czm_oneOverTwoPi;\n */\nconst float czm_oneOverTwoPi = 0.15915494309189535;\n",BH="/**\n * The automatic GLSL constant for {@link Pass#CESIUM_3D_TILE}\n *\n * @name czm_passCesium3DTile\n * @glslConstant\n *\n * @see czm_pass\n */\nconst float czm_passCesium3DTile = 4.0;\n",NH="/**\n * The automatic GLSL constant for {@link Pass#CESIUM_3D_TILE_CLASSIFICATION}\n *\n * @name czm_passCesium3DTileClassification\n * @glslConstant\n *\n * @see czm_pass\n */\nconst float czm_passCesium3DTileClassification = 5.0;\n",FH="/**\n * The automatic GLSL constant for {@link Pass#CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW}\n *\n * @name czm_passCesium3DTileClassificationIgnoreShow\n * @glslConstant\n *\n * @see czm_pass\n */\nconst float czm_passCesium3DTileClassificationIgnoreShow = 6.0;\n",zH="/**\n * The automatic GLSL constant for {@link Pass#CLASSIFICATION}\n *\n * @name czm_passClassification\n * @glslConstant\n *\n * @see czm_pass\n */\nconst float czm_passClassification = 7.0;\n",kH="/**\n * The automatic GLSL constant for {@link Pass#COMPUTE}\n *\n * @name czm_passCompute\n * @glslConstant\n *\n * @see czm_pass\n */\nconst float czm_passCompute = 1.0;\n",UH="/**\n * The automatic GLSL constant for {@link Pass#ENVIRONMENT}\n *\n * @name czm_passEnvironment\n * @glslConstant\n *\n * @see czm_pass\n */\nconst float czm_passEnvironment = 0.0;\n",VH="/**\n * The automatic GLSL constant for {@link Pass#GLOBE}\n *\n * @name czm_passGlobe\n * @glslConstant\n *\n * @see czm_pass\n */\nconst float czm_passGlobe = 2.0;\n",HH="/**\n * The automatic GLSL constant for {@link Pass#OPAQUE}\n *\n * @name czm_passOpaque\n * @glslConstant\n *\n * @see czm_pass\n */\nconst float czm_passOpaque = 7.0;\n",GH="/**\n * The automatic GLSL constant for {@link Pass#OVERLAY}\n *\n * @name czm_passOverlay\n * @glslConstant\n *\n * @see czm_pass\n */\nconst float czm_passOverlay = 9.0;\n",WH="/**\n * The automatic GLSL constant for {@link Pass#TERRAIN_CLASSIFICATION}\n *\n * @name czm_passTerrainClassification\n * @glslConstant\n *\n * @see czm_pass\n */\nconst float czm_passTerrainClassification = 3.0;\n",qH="/**\n * The automatic GLSL constant for {@link Pass#TRANSLUCENT}\n *\n * @name czm_passTranslucent\n * @glslConstant\n *\n * @see czm_pass\n */\nconst float czm_passTranslucent = 8.0;\n",jH="/**\n * A built-in GLSL floating-point constant for <code>Math.PI</code>.\n *\n * @alias czm_pi\n * @glslConstant\n *\n * @see CesiumMath.PI\n *\n * @example\n * // GLSL declaration\n * const float czm_pi = ...;\n *\n * // Example\n * float twoPi = 2.0 * czm_pi;\n */\nconst float czm_pi = 3.141592653589793;\n",YH="/**\n * A built-in GLSL floating-point constant for <code>pi/4</code>.\n *\n * @alias czm_piOverFour\n * @glslConstant\n *\n * @see CesiumMath.PI_OVER_FOUR\n *\n * @example\n * // GLSL declaration\n * const float czm_piOverFour = ...;\n *\n * // Example\n * float pi = 4.0 * czm_piOverFour;\n */\nconst float czm_piOverFour = 0.7853981633974483;\n",KH="/**\n * A built-in GLSL floating-point constant for <code>pi/6</code>.\n *\n * @alias czm_piOverSix\n * @glslConstant\n *\n * @see CesiumMath.PI_OVER_SIX\n *\n * @example\n * // GLSL declaration\n * const float czm_piOverSix = ...;\n *\n * // Example\n * float pi = 6.0 * czm_piOverSix;\n */\nconst float czm_piOverSix = 0.5235987755982988;\n",XH="/**\n * A built-in GLSL floating-point constant for <code>pi/3</code>.\n *\n * @alias czm_piOverThree\n * @glslConstant\n *\n * @see CesiumMath.PI_OVER_THREE\n *\n * @example\n * // GLSL declaration\n * const float czm_piOverThree = ...;\n *\n * // Example\n * float pi = 3.0 * czm_piOverThree;\n */\nconst float czm_piOverThree = 1.0471975511965976;\n",QH="/**\n * A built-in GLSL floating-point constant for <code>pi/2</code>.\n *\n * @alias czm_piOverTwo\n * @glslConstant\n *\n * @see CesiumMath.PI_OVER_TWO\n *\n * @example\n * // GLSL declaration\n * const float czm_piOverTwo = ...;\n *\n * // Example\n * float pi = 2.0 * czm_piOverTwo;\n */\nconst float czm_piOverTwo = 1.5707963267948966;\n",JH="/**\n * A built-in GLSL floating-point constant for converting degrees to radians.\n *\n * @alias czm_radiansPerDegree\n * @glslConstant\n *\n * @see CesiumMath.RADIANS_PER_DEGREE\n *\n * @example\n * // GLSL declaration\n * const float czm_radiansPerDegree = ...;\n *\n * // Example\n * float rad = czm_radiansPerDegree * deg;\n */\nconst float czm_radiansPerDegree = 0.017453292519943295;\n",ZH="/**\n * The constant identifier for the 2D {@link SceneMode}\n *\n * @name czm_sceneMode2D\n * @glslConstant\n * @see czm_sceneMode\n * @see czm_sceneModeColumbusView\n * @see czm_sceneMode3D\n * @see czm_sceneModeMorphing\n */\nconst float czm_sceneMode2D = 2.0;\n",$H="/**\n * The constant identifier for the 3D {@link SceneMode}\n *\n * @name czm_sceneMode3D\n * @glslConstant\n * @see czm_sceneMode\n * @see czm_sceneMode2D\n * @see czm_sceneModeColumbusView\n * @see czm_sceneModeMorphing\n */\nconst float czm_sceneMode3D = 3.0;\n",eG="/**\n * The constant identifier for the Columbus View {@link SceneMode}\n *\n * @name czm_sceneModeColumbusView\n * @glslConstant\n * @see czm_sceneMode\n * @see czm_sceneMode2D\n * @see czm_sceneMode3D\n * @see czm_sceneModeMorphing\n */\nconst float czm_sceneModeColumbusView = 1.0;\n",tG="/**\n * The constant identifier for the Morphing {@link SceneMode}\n *\n * @name czm_sceneModeMorphing\n * @glslConstant\n * @see czm_sceneMode\n * @see czm_sceneMode2D\n * @see czm_sceneModeColumbusView\n * @see czm_sceneMode3D\n */\nconst float czm_sceneModeMorphing = 0.0;\n",nG="/**\n * A built-in GLSL floating-point constant for one solar radius.\n *\n * @alias czm_solarRadius\n * @glslConstant\n *\n * @see CesiumMath.SOLAR_RADIUS\n *\n * @example\n * // GLSL declaration\n * const float czm_solarRadius = ...;\n */\nconst float czm_solarRadius = 695500000.0;\n",iG="/**\n * A built-in GLSL floating-point constant for <code>3pi/2</code>.\n *\n * @alias czm_threePiOver2\n * @glslConstant\n *\n * @see CesiumMath.THREE_PI_OVER_TWO\n *\n * @example\n * // GLSL declaration\n * const float czm_threePiOver2 = ...;\n *\n * // Example\n * float pi = (2.0 / 3.0) * czm_threePiOver2;\n */\nconst float czm_threePiOver2 = 4.71238898038469;\n",oG="/**\n * A built-in GLSL floating-point constant for <code>2pi</code>.\n *\n * @alias czm_twoPi\n * @glslConstant\n *\n * @see CesiumMath.TWO_PI\n *\n * @example\n * // GLSL declaration\n * const float czm_twoPi = ...;\n *\n * // Example\n * float pi = czm_twoPi / 2.0;\n */\nconst float czm_twoPi = 6.283185307179586;\n",rG="/**\n * The maximum latitude, in radians, both North and South, supported by a Web Mercator\n * (EPSG:3857) projection.  Technically, the Mercator projection is defined\n * for any latitude up to (but not including) 90 degrees, but it makes sense\n * to cut it off sooner because it grows exponentially with increasing latitude.\n * The logic behind this particular cutoff value, which is the one used by\n * Google Maps, Bing Maps, and Esri, is that it makes the projection\n * square.  That is, the rectangle is equal in the X and Y directions.\n *\n * The constant value is computed as follows:\n *   czm_pi * 0.5 - (2.0 * atan(exp(-czm_pi)))\n *\n * @name czm_webMercatorMaxLatitude\n * @glslConstant\n */\nconst float czm_webMercatorMaxLatitude = 1.4844222297453324;\n",sG="/**\n * @name czm_depthRangeStruct\n * @glslStruct\n */\nstruct czm_depthRangeStruct\n{\n    float near;\n    float far;\n};\n",aG="/**\n * Holds material information that can be used for lighting. Returned by all czm_getMaterial functions.\n *\n * @name czm_material\n * @glslStruct\n *\n * @property {vec3} diffuse Incoming light that scatters evenly in all directions.\n * @property {float} specular Intensity of incoming light reflecting in a single direction.\n * @property {float} shininess The sharpness of the specular reflection.  Higher values create a smaller, more focused specular highlight.\n * @property {vec3} normal Surface's normal in eye coordinates. It is used for effects such as normal mapping. The default is the surface's unmodified normal.\n * @property {vec3} emission Light emitted by the material equally in all directions. The default is vec3(0.0), which emits no light.\n * @property {float} alpha Alpha of this material. 0.0 is completely transparent; 1.0 is completely opaque.\n */\nstruct czm_material\n{\n    vec3 diffuse;\n    float specular;\n    float shininess;\n    vec3 normal;\n    vec3 emission;\n    float alpha;\n};\n",cG="/**\n * Used as input to every material's czm_getMaterial function.\n *\n * @name czm_materialInput\n * @glslStruct\n *\n * @property {float} s 1D texture coordinates.\n * @property {vec2} st 2D texture coordinates.\n * @property {vec3} str 3D texture coordinates.\n * @property {vec3} normalEC Unperturbed surface normal in eye coordinates.\n * @property {mat3} tangentToEyeMatrix Matrix for converting a tangent space normal to eye space.\n * @property {vec3} positionToEyeEC Vector from the fragment to the eye in eye coordinates.  The magnitude is the distance in meters from the fragment to the eye.\n * @property {float} height The height of the terrain in meters above or below the WGS84 ellipsoid.  Only available for globe materials.\n * @property {float} slope The slope of the terrain in radians.  0 is flat; pi/2 is vertical.  Only available for globe materials.\n * @property {float} aspect The aspect of the terrain in radians.  0 is East, pi/2 is North, pi is West, 3pi/2 is South.  Only available for globe materials.\n */\nstruct czm_materialInput\n{\n    float s;\n    vec2 st;\n    vec3 str;\n    vec3 normalEC;\n    mat3 tangentToEyeMatrix;\n    vec3 positionToEyeEC;\n    float height;\n    float slope;\n    float aspect;\n};\n",lG="/**\n * Struct for representing a material for a {@link ModelExperimental}. The model\n * rendering pipeline will pass this struct between material, custom shaders,\n * and lighting stages. This is not to be confused with {@link czm_material}\n * which is used by the older Fabric materials system, although they are similar\n *\n * @name czm_modelMaterial\n * @glslStruct\n *\n * @property {vec3} diffuse Incoming light that scatters evenly in all directions.\n * @property {float} alpha Alpha of this material. 0.0 is completely transparent; 1.0 is completely opaque.\n * @property {vec3} specular Color of reflected light at normal incidence in PBR materials. This is sometimes referred to as f0 in the literature.\n * @property {float} roughness A number from 0.0 to 1.0 representing how rough the surface is. Values near 0.0 produce glossy surfaces, while values near 1.0 produce rough surfaces.\n * @property {vec3} normalEC Surface's normal in eye coordinates. It is used for effects such as normal mapping. The default is the surface's unmodified normal.\n * @property {float} occlusion Ambient occlusion recieved at this point on the material. 1.0 means fully lit, 0.0 means fully occluded.\n * @property {vec3} emissive Light emitted by the material equally in all directions. The default is vec3(0.0), which emits no light.\n */\nstruct czm_modelMaterial {\n    vec3 diffuse;\n    float alpha;\n    vec3 specular;\n    float roughness;\n    vec3 normalEC;\n    float occlusion;\n    vec3 emissive;\n};\n",uG="/**\n * Struct for representing the output of a custom vertex shader.\n * \n * @name czm_modelVertexOutput\n * @glslStruct\n *\n * @see {@link CustomShader}\n * @see {@link ModelExperimental}\n *\n * @property {vec3} positionMC The position of the vertex in model coordinates\n * @property {float} pointSize A custom value for gl_PointSize. This is only used for point primitives. \n */\nstruct czm_modelVertexOutput {\n  vec3 positionMC;\n  float pointSize;\n};\n",hG="/**\n * Parameters for {@link czm_pbrLighting}\n *\n * @name czm_material\n * @glslStruct\n *\n * @property {vec3} diffuseColor the diffuse color of the material for the lambert term of the rendering equation\n * @property {float} roughness a value from 0.0 to 1.0 that indicates how rough the surface of the material is.\n * @property {vec3} f0 The reflectance of the material at normal incidence\n */\nstruct czm_pbrParameters\n{\n    vec3 diffuseColor;\n    float roughness;\n    vec3 f0;\n};\n",dG="/**\n * DOC_TBA\n *\n * @name czm_ray\n * @glslStruct\n */\nstruct czm_ray\n{\n    vec3 origin;\n    vec3 direction;\n};\n",fG="/**\n * DOC_TBA\n *\n * @name czm_raySegment\n * @glslStruct\n */\nstruct czm_raySegment\n{\n    float start;\n    float stop;\n};\n\n/**\n * DOC_TBA\n *\n * @name czm_emptyRaySegment\n * @glslConstant \n */\nconst czm_raySegment czm_emptyRaySegment = czm_raySegment(-czm_infinity, -czm_infinity);\n\n/**\n * DOC_TBA\n *\n * @name czm_fullRaySegment\n * @glslConstant \n */\nconst czm_raySegment czm_fullRaySegment = czm_raySegment(0.0, czm_infinity);\n",pG="struct czm_shadowParameters\n{\n#ifdef USE_CUBE_MAP_SHADOW\n    vec3 texCoords;\n#else\n    vec2 texCoords;\n#endif\n\n    float depthBias;\n    float depth;\n    float nDotL;\n    vec2 texelStepSize;\n    float normalShadingSmooth;\n    float darkness;\n};\n",mG="/**\n * Converts an HSB color (hue, saturation, brightness) to RGB\n * HSB <-> RGB conversion with minimal branching: {@link http://lolengine.net/blog/2013/07/27/rgb-to-hsv-in-glsl}\n *\n * @name czm_HSBToRGB\n * @glslFunction\n * \n * @param {vec3} hsb The color in HSB.\n *\n * @returns {vec3} The color in RGB.\n *\n * @example\n * vec3 hsb = czm_RGBToHSB(rgb);\n * hsb.z *= 0.1;\n * rgb = czm_HSBToRGB(hsb);\n */\n\nconst vec4 K_HSB2RGB = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\nvec3 czm_HSBToRGB(vec3 hsb)\n{\n    vec3 p = abs(fract(hsb.xxx + K_HSB2RGB.xyz) * 6.0 - K_HSB2RGB.www);\n    return hsb.z * mix(K_HSB2RGB.xxx, clamp(p - K_HSB2RGB.xxx, 0.0, 1.0), hsb.y);\n}\n",_G="/**\n * Converts an HSL color (hue, saturation, lightness) to RGB\n * HSL <-> RGB conversion: {@link http://www.chilliant.com/rgb2hsv.html}\n *\n * @name czm_HSLToRGB\n * @glslFunction\n * \n * @param {vec3} rgb The color in HSL.\n *\n * @returns {vec3} The color in RGB.\n *\n * @example\n * vec3 hsl = czm_RGBToHSL(rgb);\n * hsl.z *= 0.1;\n * rgb = czm_HSLToRGB(hsl);\n */\n\nvec3 hueToRGB(float hue)\n{\n    float r = abs(hue * 6.0 - 3.0) - 1.0;\n    float g = 2.0 - abs(hue * 6.0 - 2.0);\n    float b = 2.0 - abs(hue * 6.0 - 4.0);\n    return clamp(vec3(r, g, b), 0.0, 1.0);\n}\n\nvec3 czm_HSLToRGB(vec3 hsl)\n{\n    vec3 rgb = hueToRGB(hsl.x);\n    float c = (1.0 - abs(2.0 * hsl.z - 1.0)) * hsl.y;\n    return (rgb - 0.5) * c + hsl.z;\n}\n",gG="/**\n * Converts an RGB color to HSB (hue, saturation, brightness)\n * HSB <-> RGB conversion with minimal branching: {@link http://lolengine.net/blog/2013/07/27/rgb-to-hsv-in-glsl}\n *\n * @name czm_RGBToHSB\n * @glslFunction\n * \n * @param {vec3} rgb The color in RGB.\n *\n * @returns {vec3} The color in HSB.\n *\n * @example\n * vec3 hsb = czm_RGBToHSB(rgb);\n * hsb.z *= 0.1;\n * rgb = czm_HSBToRGB(hsb);\n */\n\nconst vec4 K_RGB2HSB = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\nvec3 czm_RGBToHSB(vec3 rgb)\n{\n    vec4 p = mix(vec4(rgb.bg, K_RGB2HSB.wz), vec4(rgb.gb, K_RGB2HSB.xy), step(rgb.b, rgb.g));\n    vec4 q = mix(vec4(p.xyw, rgb.r), vec4(rgb.r, p.yzx), step(p.x, rgb.r));\n\n    float d = q.x - min(q.w, q.y);\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + czm_epsilon7)), d / (q.x + czm_epsilon7), q.x);\n}\n",yG="/**\n * Converts an RGB color to HSL (hue, saturation, lightness)\n * HSL <-> RGB conversion: {@link http://www.chilliant.com/rgb2hsv.html}\n *\n * @name czm_RGBToHSL\n * @glslFunction\n * \n * @param {vec3} rgb The color in RGB.\n *\n * @returns {vec3} The color in HSL.\n *\n * @example\n * vec3 hsl = czm_RGBToHSL(rgb);\n * hsl.z *= 0.1;\n * rgb = czm_HSLToRGB(hsl);\n */\n \nvec3 RGBtoHCV(vec3 rgb)\n{\n    // Based on work by Sam Hocevar and Emil Persson\n    vec4 p = (rgb.g < rgb.b) ? vec4(rgb.bg, -1.0, 2.0 / 3.0) : vec4(rgb.gb, 0.0, -1.0 / 3.0);\n    vec4 q = (rgb.r < p.x) ? vec4(p.xyw, rgb.r) : vec4(rgb.r, p.yzx);\n    float c = q.x - min(q.w, q.y);\n    float h = abs((q.w - q.y) / (6.0 * c + czm_epsilon7) + q.z);\n    return vec3(h, c, q.x);\n}\n\nvec3 czm_RGBToHSL(vec3 rgb)\n{\n    vec3 hcv = RGBtoHCV(rgb);\n    float l = hcv.z - hcv.y * 0.5;\n    float s = hcv.y / (1.0 - abs(l * 2.0 - 1.0) + czm_epsilon7);\n    return vec3(hcv.x, s, l);\n}\n",vG="/**\n * Converts an RGB color to CIE Yxy.\n * <p>The conversion is described in\n * {@link http://content.gpwiki.org/index.php/D3DBook:High-Dynamic_Range_Rendering#Luminance_Transform|Luminance Transform}\n * </p>\n * \n * @name czm_RGBToXYZ\n * @glslFunction\n * \n * @param {vec3} rgb The color in RGB.\n *\n * @returns {vec3} The color in CIE Yxy.\n *\n * @example\n * vec3 xyz = czm_RGBToXYZ(rgb);\n * xyz.x = max(xyz.x - luminanceThreshold, 0.0);\n * rgb = czm_XYZToRGB(xyz);\n */\nvec3 czm_RGBToXYZ(vec3 rgb)\n{\n    const mat3 RGB2XYZ = mat3(0.4124, 0.2126, 0.0193,\n                              0.3576, 0.7152, 0.1192,\n                              0.1805, 0.0722, 0.9505);\n    vec3 xyz = RGB2XYZ * rgb;\n    vec3 Yxy;\n    Yxy.r = xyz.g;\n    float temp = dot(vec3(1.0), xyz);\n    Yxy.gb = xyz.rg / temp;\n    return Yxy;\n}\n",bG="/**\n * Converts a CIE Yxy color to RGB.\n * <p>The conversion is described in\n * {@link http://content.gpwiki.org/index.php/D3DBook:High-Dynamic_Range_Rendering#Luminance_Transform|Luminance Transform}\n * </p>\n * \n * @name czm_XYZToRGB\n * @glslFunction\n * \n * @param {vec3} Yxy The color in CIE Yxy.\n *\n * @returns {vec3} The color in RGB.\n *\n * @example\n * vec3 xyz = czm_RGBToXYZ(rgb);\n * xyz.x = max(xyz.x - luminanceThreshold, 0.0);\n * rgb = czm_XYZToRGB(xyz);\n */\nvec3 czm_XYZToRGB(vec3 Yxy)\n{\n    const mat3 XYZ2RGB = mat3( 3.2405, -0.9693,  0.0556,\n                              -1.5371,  1.8760, -0.2040,\n                              -0.4985,  0.0416,  1.0572);\n    vec3 xyz;\n    xyz.r = Yxy.r * Yxy.g / Yxy.b;\n    xyz.g = Yxy.r;\n    xyz.b = Yxy.r * (1.0 - Yxy.g - Yxy.b) / Yxy.b;\n    \n    return XYZ2RGB * xyz;\n}\n",AG="// See:\n//    https://knarkowicz.wordpress.com/2016/01/06/aces-filmic-tone-mapping-curve/\n\nvec3 czm_acesTonemapping(vec3 color) {\n    float g = 0.985;\n    float a = 0.065;\n    float b = 0.0001;\n    float c = 0.433;\n    float d = 0.238;\n\n    color = (color * (color + a) - b) / (color * (g * color + c) + d);\n\n    color = clamp(color, 0.0, 1.0);\n\n    return color;\n}\n",wG="/**\n * @private\n */\nfloat czm_alphaWeight(float a)\n{\n    float z = (gl_FragCoord.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\n\n    // See Weighted Blended Order-Independent Transparency for examples of different weighting functions:\n    // http://jcgt.org/published/0002/02/09/\n    return pow(a + 0.01, 4.0) + max(1e-2, min(3.0 * 1e3, 0.003 / (1e-5 + pow(abs(z) / 200.0, 4.0))));\n}\n",TG="/**\n * Procedural anti-aliasing by blurring two colors that meet at a sharp edge.\n *\n * @name czm_antialias\n * @glslFunction\n *\n * @param {vec4} color1 The color on one side of the edge.\n * @param {vec4} color2 The color on the other side of the edge.\n * @param {vec4} currentcolor The current color, either <code>color1</code> or <code>color2</code>.\n * @param {float} dist The distance to the edge in texture coordinates.\n * @param {float} [fuzzFactor=0.1] Controls the blurriness between the two colors.\n * @returns {vec4} The anti-aliased color.\n *\n * @example\n * // GLSL declarations\n * vec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist, float fuzzFactor);\n * vec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist);\n *\n * // get the color for a material that has a sharp edge at the line y = 0.5 in texture space\n * float dist = abs(textureCoordinates.t - 0.5);\n * vec4 currentColor = mix(bottomColor, topColor, step(0.5, textureCoordinates.t));\n * vec4 color = czm_antialias(bottomColor, topColor, currentColor, dist, 0.1);\n */\nvec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist, float fuzzFactor)\n{\n    float val1 = clamp(dist / fuzzFactor, 0.0, 1.0);\n    float val2 = clamp((dist - 0.5) / fuzzFactor, 0.0, 1.0);\n    val1 = val1 * (1.0 - val2);\n    val1 = val1 * val1 * (3.0 - (2.0 * val1));\n    val1 = pow(val1, 0.5); //makes the transition nicer\n    \n    vec4 midColor = (color1 + color2) * 0.5;\n    return mix(midColor, currentColor, val1);\n}\n\nvec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist)\n{\n    return czm_antialias(color1, color2, currentColor, dist, 0.1);\n}\n",CG="/**\n * Approximately computes spherical coordinates given a normal.\n * Uses approximate inverse trigonometry for speed and consistency,\n * since inverse trigonometry can differ from vendor-to-vendor and when compared with the CPU.\n *\n * @name czm_approximateSphericalCoordinates\n * @glslFunction\n *\n * @param {vec3} normal arbitrary-length normal.\n *\n * @returns {vec2} Approximate latitude and longitude spherical coordinates.\n */\nvec2 czm_approximateSphericalCoordinates(vec3 normal) {\n    // Project into plane with vertical for latitude\n    float latitudeApproximation = czm_fastApproximateAtan(sqrt(normal.x * normal.x + normal.y * normal.y), normal.z);\n    float longitudeApproximation = czm_fastApproximateAtan(normal.x, normal.y);\n    return vec2(latitudeApproximation, longitudeApproximation);\n}\n",EG="/**\n * Determines if the fragment is back facing\n *\n * @name czm_backFacing\n * @glslFunction \n * \n * @returns {bool} <code>true</code> if the fragment is back facing; otherwise, <code>false</code>.\n */\nbool czm_backFacing()\n{\n    // !gl_FrontFacing doesn't work as expected on Mac/Intel so use the more verbose form instead. See https://github.com/CesiumGS/cesium/pull/8494.\n    return gl_FrontFacing == false;\n}\n",xG="/**\n * Branchless ternary operator to be used when it's inexpensive to explicitly\n * evaluate both possibilities for a float expression.\n *\n * @name czm_branchFreeTernary\n * @glslFunction\n *\n * @param {bool} comparison A comparison statement\n * @param {float} a Value to return if the comparison is true.\n * @param {float} b Value to return if the comparison is false.\n *\n * @returns {float} equivalent of comparison ? a : b\n */\nfloat czm_branchFreeTernary(bool comparison, float a, float b) {\n    float useA = float(comparison);\n    return a * useA + b * (1.0 - useA);\n}\n\n/**\n * Branchless ternary operator to be used when it's inexpensive to explicitly\n * evaluate both possibilities for a vec2 expression.\n *\n * @name czm_branchFreeTernary\n * @glslFunction\n *\n * @param {bool} comparison A comparison statement\n * @param {vec2} a Value to return if the comparison is true.\n * @param {vec2} b Value to return if the comparison is false.\n *\n * @returns {vec2} equivalent of comparison ? a : b\n */\nvec2 czm_branchFreeTernary(bool comparison, vec2 a, vec2 b) {\n    float useA = float(comparison);\n    return a * useA + b * (1.0 - useA);\n}\n\n/**\n * Branchless ternary operator to be used when it's inexpensive to explicitly\n * evaluate both possibilities for a vec3 expression.\n *\n * @name czm_branchFreeTernary\n * @glslFunction\n *\n * @param {bool} comparison A comparison statement\n * @param {vec3} a Value to return if the comparison is true.\n * @param {vec3} b Value to return if the comparison is false.\n *\n * @returns {vec3} equivalent of comparison ? a : b\n */\nvec3 czm_branchFreeTernary(bool comparison, vec3 a, vec3 b) {\n    float useA = float(comparison);\n    return a * useA + b * (1.0 - useA);\n}\n\n/**\n * Branchless ternary operator to be used when it's inexpensive to explicitly\n * evaluate both possibilities for a vec4 expression.\n *\n * @name czm_branchFreeTernary\n * @glslFunction\n *\n * @param {bool} comparison A comparison statement\n * @param {vec3} a Value to return if the comparison is true.\n * @param {vec3} b Value to return if the comparison is false.\n *\n * @returns {vec3} equivalent of comparison ? a : b\n */\nvec4 czm_branchFreeTernary(bool comparison, vec4 a, vec4 b) {\n    float useA = float(comparison);\n    return a * useA + b * (1.0 - useA);\n}\n",SG="\nvec4 czm_cascadeColor(vec4 weights)\n{\n    return vec4(1.0, 0.0, 0.0, 1.0) * weights.x +\n           vec4(0.0, 1.0, 0.0, 1.0) * weights.y +\n           vec4(0.0, 0.0, 1.0, 1.0) * weights.z +\n           vec4(1.0, 0.0, 1.0, 1.0) * weights.w;\n}\n",IG="\nuniform vec4 shadowMap_cascadeDistances;\n\nfloat czm_cascadeDistance(vec4 weights)\n{\n    return dot(shadowMap_cascadeDistances, weights);\n}\n",OG="\nuniform mat4 shadowMap_cascadeMatrices[4];\n\nmat4 czm_cascadeMatrix(vec4 weights)\n{\n    return shadowMap_cascadeMatrices[0] * weights.x +\n           shadowMap_cascadeMatrices[1] * weights.y +\n           shadowMap_cascadeMatrices[2] * weights.z +\n           shadowMap_cascadeMatrices[3] * weights.w;\n}\n",DG="\nuniform vec4 shadowMap_cascadeSplits[2];\n\nvec4 czm_cascadeWeights(float depthEye)\n{\n    // One component is set to 1.0 and all others set to 0.0.\n    vec4 near = step(shadowMap_cascadeSplits[0], vec4(depthEye));\n    vec4 far = step(depthEye, shadowMap_cascadeSplits[1]);\n    return near * far;\n}\n",PG="/**\n * DOC_TBA\n *\n * @name czm_columbusViewMorph\n * @glslFunction\n */\nvec4 czm_columbusViewMorph(vec4 position2D, vec4 position3D, float time)\n{\n    // Just linear for now.\n    vec3 p = mix(position2D.xyz, position3D.xyz, time);\n    return vec4(p, 1.0);\n}\n",RG="/**\n * Returns a position in model coordinates relative to eye taking into\n * account the current scene mode: 3D, 2D, or Columbus view.\n * <p>\n * This uses standard position attributes, <code>position3DHigh</code>, \n * <code>position3DLow</code>, <code>position2DHigh</code>, and <code>position2DLow</code>, \n * and should be used when writing a vertex shader for an {@link Appearance}.\n * </p>\n *\n * @name czm_computePosition\n * @glslFunction\n *\n * @returns {vec4} The position relative to eye.\n *\n * @example\n * vec4 p = czm_computePosition();\n * v_positionEC = (czm_modelViewRelativeToEye * p).xyz;\n * gl_Position = czm_modelViewProjectionRelativeToEye * p;\n *\n * @see czm_translateRelativeToEye\n */\nvec4 czm_computePosition();\n",LG="/**\n * @private\n */\nvec2 cordic(float angle)\n{\n// Scale the vector by the appropriate factor for the 24 iterations to follow.\n    vec2 vector = vec2(6.0725293500888267e-1, 0.0);\n// Iteration 1\n    float sense = (angle < 0.0) ? -1.0 : 1.0;\n //   float factor = sense * 1.0;  // 2^-0\n    mat2 rotation = mat2(1.0, sense, -sense, 1.0);\n    vector = rotation * vector;\n    angle -= sense * 7.8539816339744828e-1;  // atan(2^-0)\n// Iteration 2\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    float factor = sense * 5.0e-1;  // 2^-1\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 4.6364760900080609e-1;  // atan(2^-1)\n// Iteration 3\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 2.5e-1;  // 2^-2\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 2.4497866312686414e-1;  // atan(2^-2)\n// Iteration 4\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 1.25e-1;  // 2^-3\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 1.2435499454676144e-1;  // atan(2^-3)\n// Iteration 5\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 6.25e-2;  // 2^-4\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 6.2418809995957350e-2;  // atan(2^-4)\n// Iteration 6\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 3.125e-2;  // 2^-5\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 3.1239833430268277e-2;  // atan(2^-5)\n// Iteration 7\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 1.5625e-2;  // 2^-6\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 1.5623728620476831e-2;  // atan(2^-6)\n// Iteration 8\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 7.8125e-3;  // 2^-7\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 7.8123410601011111e-3;  // atan(2^-7)\n// Iteration 9\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 3.90625e-3;  // 2^-8\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 3.9062301319669718e-3;  // atan(2^-8)\n// Iteration 10\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 1.953125e-3;  // 2^-9\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 1.9531225164788188e-3;  // atan(2^-9)\n// Iteration 11\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 9.765625e-4;  // 2^-10\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 9.7656218955931946e-4;  // atan(2^-10)\n// Iteration 12\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 4.8828125e-4;  // 2^-11\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 4.8828121119489829e-4;  // atan(2^-11)\n// Iteration 13\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 2.44140625e-4;  // 2^-12\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 2.4414062014936177e-4;  // atan(2^-12)\n// Iteration 14\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 1.220703125e-4;  // 2^-13\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 1.2207031189367021e-4;  // atan(2^-13)\n// Iteration 15\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 6.103515625e-5;  // 2^-14\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 6.1035156174208773e-5;  // atan(2^-14)\n// Iteration 16\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 3.0517578125e-5;  // 2^-15\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 3.0517578115526096e-5;  // atan(2^-15)\n// Iteration 17\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 1.52587890625e-5;  // 2^-16\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 1.5258789061315762e-5;  // atan(2^-16)\n// Iteration 18\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 7.62939453125e-6;  // 2^-17\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 7.6293945311019700e-6;  // atan(2^-17)\n// Iteration 19\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 3.814697265625e-6;  // 2^-18\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 3.8146972656064961e-6;  // atan(2^-18)\n// Iteration 20\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 1.9073486328125e-6;  // 2^-19\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 1.9073486328101870e-6;  // atan(2^-19)\n// Iteration 21\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 9.5367431640625e-7;  // 2^-20\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 9.5367431640596084e-7;  // atan(2^-20)\n// Iteration 22\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 4.76837158203125e-7;  // 2^-21\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 4.7683715820308884e-7;  // atan(2^-21)\n// Iteration 23\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 2.384185791015625e-7;  // 2^-22\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n    angle -= sense * 2.3841857910155797e-7;  // atan(2^-22)\n// Iteration 24\n    sense = (angle < 0.0) ? -1.0 : 1.0;\n    factor = sense * 1.1920928955078125e-7;  // 2^-23\n    rotation[0][1] = factor;\n    rotation[1][0] = -factor;\n    vector = rotation * vector;\n//    angle -= sense * 1.1920928955078068e-7;  // atan(2^-23)\n\n    return vector;\n}\n\n/**\n * Computes the cosine and sine of the provided angle using the CORDIC algorithm.\n *\n * @name czm_cosineAndSine\n * @glslFunction\n *\n * @param {float} angle The angle in radians.\n *\n * @returns {vec2} The resulting cosine of the angle (as the x coordinate) and sine of the angle (as the y coordinate).\n *\n * @example\n * vec2 v = czm_cosineAndSine(czm_piOverSix);\n * float cosine = v.x;\n * float sine = v.y;\n */\nvec2 czm_cosineAndSine(float angle)\n{\n    if (angle < -czm_piOverTwo || angle > czm_piOverTwo)\n    {\n        if (angle < 0.0)\n        {\n            return -cordic(angle + czm_pi);\n        }\n        else\n        {\n            return -cordic(angle - czm_pi);\n        }\n    }\n    else\n    {\n        return cordic(angle);\n    }\n}\n",MG="/**\n * Decompresses texture coordinates that were packed into a single float.\n *\n * @name czm_decompressTextureCoordinates\n * @glslFunction\n *\n * @param {float} encoded The compressed texture coordinates.\n * @returns {vec2} The decompressed texture coordinates.\n */\n vec2 czm_decompressTextureCoordinates(float encoded)\n {\n    float temp = encoded / 4096.0;\n    float xZeroTo4095 = floor(temp);\n    float stx = xZeroTo4095 / 4095.0;\n    float sty = (encoded - xZeroTo4095 * 4096.0) / 4095.0;\n    return vec2(stx, sty);\n }\n",BG="/**\n * Get default parameters for physically based rendering. These defaults\n * describe a rough dielectric (non-metal) surface (e.g. rough plastic).\n *\n * @return {czm_pbrParameters} Default parameters for {@link czm_pbrLighting}\n */\nczm_pbrParameters czm_defaultPbrMaterial()\n{\n    czm_pbrParameters results;\n    results.diffuseColor = vec3(1.0);\n    results.roughness = 1.0;\n\n    const vec3 REFLECTANCE_DIELECTRIC = vec3(0.04);\n    results.f0 = REFLECTANCE_DIELECTRIC;\n    return results;\n}\n",NG="// emulated noperspective\n#if defined(GL_EXT_frag_depth) && !defined(LOG_DEPTH)\nvarying float v_WindowZ;\n#endif\n\n/**\n * Emulates GL_DEPTH_CLAMP, which is not available in WebGL 1 or 2.\n * GL_DEPTH_CLAMP clamps geometry that is outside the near and far planes, \n * capping the shadow volume. More information here: \n * https://www.khronos.org/registry/OpenGL/extensions/ARB/ARB_depth_clamp.txt.\n *\n * When GL_EXT_frag_depth is available we emulate GL_DEPTH_CLAMP by ensuring \n * no geometry gets clipped by setting the clip space z value to 0.0 and then\n * sending the unaltered screen space z value (using emulated noperspective\n * interpolation) to the frag shader where it is clamped to [0,1] and then\n * written with gl_FragDepth (see czm_writeDepthClamp). This technique is based on:\n * https://stackoverflow.com/questions/5960757/how-to-emulate-gl-depth-clamp-nv.\n *\n * When GL_EXT_frag_depth is not available, which is the case on some mobile \n * devices, we must attempt to fix this only in the vertex shader. \n * The approach is to clamp the z value to the far plane, which closes the \n * shadow volume but also distorts the geometry, so there can still be artifacts\n * on frustum seams.\n *\n * @name czm_depthClamp\n * @glslFunction\n *\n * @param {vec4} coords The vertex in clip coordinates.\n * @returns {vec4} The modified vertex.\n *\n * @example\n * gl_Position = czm_depthClamp(czm_modelViewProjection * vec4(position, 1.0));\n *\n * @see czm_writeDepthClamp\n */\nvec4 czm_depthClamp(vec4 coords)\n{\n#ifndef LOG_DEPTH\n#ifdef GL_EXT_frag_depth\n    v_WindowZ = (0.5 * (coords.z / coords.w) + 0.5) * coords.w;\n    coords.z = 0.0;\n#else\n    coords.z = min(coords.z, coords.w);\n#endif\n#endif\n    return coords;\n}\n",FG="/**\n * Computes a 3x3 rotation matrix that transforms vectors from an ellipsoid's east-north-up coordinate system \n * to eye coordinates.  In east-north-up coordinates, x points east, y points north, and z points along the \n * surface normal.  East-north-up can be used as an ellipsoid's tangent space for operations such as bump mapping.\n * <br /><br />\n * The ellipsoid is assumed to be centered at the model coordinate's origin.\n *\n * @name czm_eastNorthUpToEyeCoordinates\n * @glslFunction\n *\n * @param {vec3} positionMC The position on the ellipsoid in model coordinates.\n * @param {vec3} normalEC The normalized ellipsoid surface normal, at <code>positionMC</code>, in eye coordinates.\n *\n * @returns {mat3} A 3x3 rotation matrix that transforms vectors from the east-north-up coordinate system to eye coordinates.\n *\n * @example\n * // Transform a vector defined in the east-north-up coordinate \n * // system, (0, 0, 1) which is the surface normal, to eye \n * // coordinates.\n * mat3 m = czm_eastNorthUpToEyeCoordinates(positionMC, normalEC);\n * vec3 normalEC = m * vec3(0.0, 0.0, 1.0);\n */\nmat3 czm_eastNorthUpToEyeCoordinates(vec3 positionMC, vec3 normalEC)\n{\n    vec3 tangentMC = normalize(vec3(-positionMC.y, positionMC.x, 0.0));  // normalized surface tangent in model coordinates\n    vec3 tangentEC = normalize(czm_normal3D * tangentMC);                // normalized surface tangent in eye coordiantes\n    vec3 bitangentEC = normalize(cross(normalEC, tangentEC));            // normalized surface bitangent in eye coordinates\n\n    return mat3(\n        tangentEC.x,   tangentEC.y,   tangentEC.z,\n        bitangentEC.x, bitangentEC.y, bitangentEC.z,\n        normalEC.x,    normalEC.y,    normalEC.z);\n}\n",zG="/**\n * DOC_TBA\n *\n * @name czm_ellipsoidContainsPoint\n * @glslFunction\n *\n */\nbool czm_ellipsoidContainsPoint(vec3 ellipsoid_inverseRadii, vec3 point)\n{\n    vec3 scaled = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(point, 1.0)).xyz;\n    return (dot(scaled, scaled) <= 1.0);\n}\n",kG="/**\n * DOC_TBA\n *\n * @name czm_ellipsoidWgs84TextureCoordinates\n * @glslFunction\n */\nvec2 czm_ellipsoidWgs84TextureCoordinates(vec3 normal)\n{\n    return vec2(atan(normal.y, normal.x) * czm_oneOverTwoPi + 0.5, asin(normal.z) * czm_oneOverPi + 0.5);\n}\n",UG="/**\n * Compares <code>left</code> and <code>right</code> componentwise. Returns <code>true</code>\n * if they are within <code>epsilon</code> and <code>false</code> otherwise. The inputs\n * <code>left</code> and <code>right</code> can be <code>float</code>s, <code>vec2</code>s,\n * <code>vec3</code>s, or <code>vec4</code>s.\n *\n * @name czm_equalsEpsilon\n * @glslFunction\n *\n * @param {} left The first vector.\n * @param {} right The second vector.\n * @param {float} epsilon The epsilon to use for equality testing.\n * @returns {bool} <code>true</code> if the components are within <code>epsilon</code> and <code>false</code> otherwise.\n *\n * @example\n * // GLSL declarations\n * bool czm_equalsEpsilon(float left, float right, float epsilon);\n * bool czm_equalsEpsilon(vec2 left, vec2 right, float epsilon);\n * bool czm_equalsEpsilon(vec3 left, vec3 right, float epsilon);\n * bool czm_equalsEpsilon(vec4 left, vec4 right, float epsilon);\n */\nbool czm_equalsEpsilon(vec4 left, vec4 right, float epsilon) {\n    return all(lessThanEqual(abs(left - right), vec4(epsilon)));\n}\n\nbool czm_equalsEpsilon(vec3 left, vec3 right, float epsilon) {\n    return all(lessThanEqual(abs(left - right), vec3(epsilon)));\n}\n\nbool czm_equalsEpsilon(vec2 left, vec2 right, float epsilon) {\n    return all(lessThanEqual(abs(left - right), vec2(epsilon)));\n}\n\nbool czm_equalsEpsilon(float left, float right, float epsilon) {\n    return (abs(left - right) <= epsilon);\n}\n",VG="/**\n * DOC_TBA\n *\n * @name czm_eyeOffset\n * @glslFunction\n *\n * @param {vec4} positionEC DOC_TBA.\n * @param {vec3} eyeOffset DOC_TBA.\n *\n * @returns {vec4} DOC_TBA.\n */\nvec4 czm_eyeOffset(vec4 positionEC, vec3 eyeOffset)\n{\n    // This equation is approximate in x and y.\n    vec4 p = positionEC;\n    vec4 zEyeOffset = normalize(p) * eyeOffset.z;\n    p.xy += eyeOffset.xy + zEyeOffset.xy;\n    p.z += zEyeOffset.z;\n    return p;\n}\n",HG="/**\n * Transforms a position from eye to window coordinates.  The transformation\n * from eye to clip coordinates is done using {@link czm_projection}.\n * The transform from normalized device coordinates to window coordinates is\n * done using {@link czm_viewportTransformation}, which assumes a depth range\n * of <code>near = 0</code> and <code>far = 1</code>.\n * <br /><br />\n * This transform is useful when there is a need to manipulate window coordinates\n * in a vertex shader as done by {@link BillboardCollection}.\n *\n * @name czm_eyeToWindowCoordinates\n * @glslFunction\n *\n * @param {vec4} position The position in eye coordinates to transform.\n *\n * @returns {vec4} The transformed position in window coordinates.\n *\n * @see czm_modelToWindowCoordinates\n * @see czm_projection\n * @see czm_viewportTransformation\n * @see BillboardCollection\n *\n * @example\n * vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\n */\nvec4 czm_eyeToWindowCoordinates(vec4 positionEC)\n{\n    vec4 q = czm_projection * positionEC;                        // clip coordinates\n    q.xyz /= q.w;                                                // normalized device coordinates\n    q.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz; // window coordinates\n    return q;\n}\n",GG="/**\n * Approxiamtes atan over the range [0, 1]. Safe to flip output for negative input.\n *\n * Based on Michal Drobot's approximation from ShaderFastLibs, which in turn is based on\n * \"Efficient approximations for the arctangent function,\" Rajan, S. Sichun Wang Inkol, R. Joyal, A., May 2006.\n * Adapted from ShaderFastLibs under MIT License.\n *\n * Chosen for the following characteristics over range [0, 1]:\n * - basically no error at 0 and 1, important for getting around range limit (naive atan2 via atan requires infinite range atan)\n * - no visible artifacts from first-derivative discontinuities, unlike latitude via range-reduced sqrt asin approximations (at equator)\n *\n * The original code is x * (-0.1784 * abs(x) - 0.0663 * x * x + 1.0301);\n * Removed the abs() in here because it isn't needed, the input range is guaranteed as [0, 1] by how we're approximating atan2.\n *\n * @name czm_fastApproximateAtan\n * @glslFunction\n *\n * @param {float} x Value between 0 and 1 inclusive.\n *\n * @returns {float} Approximation of atan(x)\n */\nfloat czm_fastApproximateAtan(float x) {\n    return x * (-0.1784 * x - 0.0663 * x * x + 1.0301);\n}\n\n/**\n * Approximation of atan2.\n *\n * Range reduction math based on nvidia's cg reference implementation for atan2: http://developer.download.nvidia.com/cg/atan2.html\n * However, we replaced their atan curve with Michael Drobot's (see above).\n *\n * @name czm_fastApproximateAtan\n * @glslFunction\n *\n * @param {float} x Value between -1 and 1 inclusive.\n * @param {float} y Value between -1 and 1 inclusive.\n *\n * @returns {float} Approximation of atan2(x, y)\n */\nfloat czm_fastApproximateAtan(float x, float y) {\n    // atan approximations are usually only reliable over [-1, 1], or, in our case, [0, 1] due to modifications.\n    // So range-reduce using abs and by flipping whether x or y is on top.\n    float t = abs(x); // t used as swap and atan result.\n    float opposite = abs(y);\n    float adjacent = max(t, opposite);\n    opposite = min(t, opposite);\n\n    t = czm_fastApproximateAtan(opposite / adjacent);\n\n    // Undo range reduction\n    t = czm_branchFreeTernary(abs(y) > abs(x), czm_piOverTwo - t, t);\n    t = czm_branchFreeTernary(x < 0.0, czm_pi - t, t);\n    t = czm_branchFreeTernary(y < 0.0, -t, t);\n    return t;\n}\n",WG="/**\n * Gets the color with fog at a distance from the camera.\n *\n * @name czm_fog\n * @glslFunction\n *\n * @param {float} distanceToCamera The distance to the camera in meters.\n * @param {vec3} color The original color.\n * @param {vec3} fogColor The color of the fog.\n *\n * @returns {vec3} The color adjusted for fog at the distance from the camera.\n */\nvec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor)\n{\n    float scalar = distanceToCamera * czm_fogDensity;\n    float fog = 1.0 - exp(-(scalar * scalar));\n    return mix(color, fogColor, fog);\n}\n\n/**\n * Gets the color with fog at a distance from the camera.\n *\n * @name czm_fog\n * @glslFunction\n *\n * @param {float} distanceToCamera The distance to the camera in meters.\n * @param {vec3} color The original color.\n * @param {vec3} fogColor The color of the fog.\n * @param {float} fogModifierConstant A constant to modify the appearance of fog.\n *\n * @returns {vec3} The color adjusted for fog at the distance from the camera.\n */\nvec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor, float fogModifierConstant)\n{\n    float scalar = distanceToCamera * czm_fogDensity;\n    float fog = 1.0 - exp(-((fogModifierConstant * scalar + fogModifierConstant) * (scalar * (1.0 + fogModifierConstant))));\n    return mix(color, fogColor, fog);\n}\n",qG="/**\n * Converts a color from RGB space to linear space.\n *\n * @name czm_gammaCorrect\n * @glslFunction\n *\n * @param {vec3} color The color in RGB space.\n * @returns {vec3} The color in linear space.\n */\nvec3 czm_gammaCorrect(vec3 color) {\n#ifdef HDR\n    color = pow(color, vec3(czm_gamma));\n#endif\n    return color;\n}\n\nvec4 czm_gammaCorrect(vec4 color) {\n#ifdef HDR\n    color.rgb = pow(color.rgb, vec3(czm_gamma));\n#endif\n    return color;\n}\n",jG="/**\n * DOC_TBA\n *\n * @name czm_geodeticSurfaceNormal\n * @glslFunction\n *\n * @param {vec3} positionOnEllipsoid DOC_TBA\n * @param {vec3} ellipsoidCenter DOC_TBA\n * @param {vec3} oneOverEllipsoidRadiiSquared DOC_TBA\n * \n * @returns {vec3} DOC_TBA.\n */\nvec3 czm_geodeticSurfaceNormal(vec3 positionOnEllipsoid, vec3 ellipsoidCenter, vec3 oneOverEllipsoidRadiiSquared)\n{\n    return normalize((positionOnEllipsoid - ellipsoidCenter) * oneOverEllipsoidRadiiSquared);\n}\n",YG="/**\n * An czm_material with default values. Every material's czm_getMaterial\n * should use this default material as a base for the material it returns.\n * The default normal value is given by materialInput.normalEC.\n *\n * @name czm_getDefaultMaterial\n * @glslFunction\n *\n * @param {czm_materialInput} input The input used to construct the default material.\n *\n * @returns {czm_material} The default material.\n *\n * @see czm_materialInput\n * @see czm_material\n * @see czm_getMaterial\n */\nczm_material czm_getDefaultMaterial(czm_materialInput materialInput)\n{\n    czm_material material;\n    material.diffuse = vec3(0.0);\n    material.specular = 0.0;\n    material.shininess = 1.0;\n    material.normal = materialInput.normalEC;\n    material.emission = vec3(0.0);\n    material.alpha = 1.0;\n    return material;\n}\n",KG="/**\n * Calculates the intensity of diffusely reflected light.\n *\n * @name czm_getLambertDiffuse\n * @glslFunction\n *\n * @param {vec3} lightDirectionEC Unit vector pointing to the light source in eye coordinates.\n * @param {vec3} normalEC The surface normal in eye coordinates.\n *\n * @returns {float} The intensity of the diffuse reflection.\n *\n * @see czm_phong\n *\n * @example\n * float diffuseIntensity = czm_getLambertDiffuse(lightDirectionEC, normalEC);\n * float specularIntensity = czm_getSpecular(lightDirectionEC, toEyeEC, normalEC, 200);\n * vec3 color = (diffuseColor * diffuseIntensity) + (specularColor * specularIntensity);\n */\nfloat czm_getLambertDiffuse(vec3 lightDirectionEC, vec3 normalEC)\n{\n    return max(dot(lightDirectionEC, normalEC), 0.0);\n}\n",XG="/**\n * Calculates the specular intensity of reflected light.\n *\n * @name czm_getSpecular\n * @glslFunction\n *\n * @param {vec3} lightDirectionEC Unit vector pointing to the light source in eye coordinates.\n * @param {vec3} toEyeEC Unit vector pointing to the eye position in eye coordinates.\n * @param {vec3} normalEC The surface normal in eye coordinates.\n * @param {float} shininess The sharpness of the specular reflection.  Higher values create a smaller, more focused specular highlight.\n *\n * @returns {float} The intensity of the specular highlight.\n *\n * @see czm_phong\n *\n * @example\n * float diffuseIntensity = czm_getLambertDiffuse(lightDirectionEC, normalEC);\n * float specularIntensity = czm_getSpecular(lightDirectionEC, toEyeEC, normalEC, 200);\n * vec3 color = (diffuseColor * diffuseIntensity) + (specularColor * specularIntensity);\n */\nfloat czm_getSpecular(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess)\n{\n    vec3 toReflectedLight = reflect(-lightDirectionEC, normalEC);\n    float specular = max(dot(toReflectedLight, toEyeEC), 0.0);\n\n    // pow has undefined behavior if both parameters <= 0.\n    // Prevent this by making sure shininess is at least czm_epsilon2.\n    return pow(specular, max(shininess, czm_epsilon2));\n}\n",QG="/**\n * @private\n */\nvec4 czm_getWaterNoise(sampler2D normalMap, vec2 uv, float time, float angleInRadians)\n{\n    float cosAngle = cos(angleInRadians);\n    float sinAngle = sin(angleInRadians);\n\n    // time dependent sampling directions\n    vec2 s0 = vec2(1.0/17.0, 0.0);\n    vec2 s1 = vec2(-1.0/29.0, 0.0);\n    vec2 s2 = vec2(1.0/101.0, 1.0/59.0);\n    vec2 s3 = vec2(-1.0/109.0, -1.0/57.0);\n\n    // rotate sampling direction by specified angle\n    s0 = vec2((cosAngle * s0.x) - (sinAngle * s0.y), (sinAngle * s0.x) + (cosAngle * s0.y));\n    s1 = vec2((cosAngle * s1.x) - (sinAngle * s1.y), (sinAngle * s1.x) + (cosAngle * s1.y));\n    s2 = vec2((cosAngle * s2.x) - (sinAngle * s2.y), (sinAngle * s2.x) + (cosAngle * s2.y));\n    s3 = vec2((cosAngle * s3.x) - (sinAngle * s3.y), (sinAngle * s3.x) + (cosAngle * s3.y));\n\n    vec2 uv0 = (uv/103.0) + (time * s0);\n    vec2 uv1 = uv/107.0 + (time * s1) + vec2(0.23);\n    vec2 uv2 = uv/vec2(897.0, 983.0) + (time * s2) + vec2(0.51);\n    vec2 uv3 = uv/vec2(991.0, 877.0) + (time * s3) + vec2(0.71);\n\n    uv0 = fract(uv0);\n    uv1 = fract(uv1);\n    uv2 = fract(uv2);\n    uv3 = fract(uv3);\n    vec4 noise = (texture2D(normalMap, uv0)) +\n                 (texture2D(normalMap, uv1)) +\n                 (texture2D(normalMap, uv2)) +\n                 (texture2D(normalMap, uv3));\n\n    // average and scale to between -1 and 1\n    return ((noise / 4.0) - 0.5) * 2.0;\n}\n",JG="/**\n * Adjusts the hue of a color.\n * \n * @name czm_hue\n * @glslFunction\n * \n * @param {vec3} rgb The color.\n * @param {float} adjustment The amount to adjust the hue of the color in radians.\n *\n * @returns {float} The color with the hue adjusted.\n *\n * @example\n * vec3 adjustHue = czm_hue(color, czm_pi); // The same as czm_hue(color, -czm_pi)\n */\nvec3 czm_hue(vec3 rgb, float adjustment)\n{\n    const mat3 toYIQ = mat3(0.299,     0.587,     0.114,\n                            0.595716, -0.274453, -0.321263,\n                            0.211456, -0.522591,  0.311135);\n    const mat3 toRGB = mat3(1.0,  0.9563,  0.6210,\n                            1.0, -0.2721, -0.6474,\n                            1.0, -1.107,   1.7046);\n    \n    vec3 yiq = toYIQ * rgb;\n    float hue = atan(yiq.z, yiq.y) + adjustment;\n    float chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);\n    \n    vec3 color = vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));\n    return toRGB * color;\n}\n",ZG="/**\n * Converts a color in linear space to RGB space.\n *\n * @name czm_inverseGamma\n * @glslFunction\n *\n * @param {vec3} color The color in linear space.\n * @returns {vec3} The color in RGB space.\n */\nvec3 czm_inverseGamma(vec3 color) {\n    return pow(color, vec3(1.0 / czm_gamma));\n}\n",$G="/**\n * Determines if a time interval is empty.\n *\n * @name czm_isEmpty\n * @glslFunction \n * \n * @param {czm_raySegment} interval The interval to test.\n * \n * @returns {bool} <code>true</code> if the time interval is empty; otherwise, <code>false</code>.\n *\n * @example\n * bool b0 = czm_isEmpty(czm_emptyRaySegment);      // true\n * bool b1 = czm_isEmpty(czm_raySegment(0.0, 1.0)); // false\n * bool b2 = czm_isEmpty(czm_raySegment(1.0, 1.0)); // false, contains 1.0.\n */\nbool czm_isEmpty(czm_raySegment interval)\n{\n    return (interval.stop < 0.0);\n}\n",eW="/**\n * Determines if a time interval is empty.\n *\n * @name czm_isFull\n * @glslFunction \n * \n * @param {czm_raySegment} interval The interval to test.\n * \n * @returns {bool} <code>true</code> if the time interval is empty; otherwise, <code>false</code>.\n *\n * @example\n * bool b0 = czm_isEmpty(czm_emptyRaySegment);      // true\n * bool b1 = czm_isEmpty(czm_raySegment(0.0, 1.0)); // false\n * bool b2 = czm_isEmpty(czm_raySegment(1.0, 1.0)); // false, contains 1.0.\n */\nbool czm_isFull(czm_raySegment interval)\n{\n    return (interval.start == 0.0 && interval.stop == czm_infinity);\n}\n",tW="/**\n * Computes the fraction of a Web Wercator rectangle at which a given geodetic latitude is located.\n *\n * @name czm_latitudeToWebMercatorFraction\n * @glslFunction\n *\n * @param {float} latitude The geodetic latitude, in radians.\n * @param {float} southMercatorY The Web Mercator coordinate of the southern boundary of the rectangle.\n * @param {float} oneOverMercatorHeight The total height of the rectangle in Web Mercator coordinates.\n *\n * @returns {float} The fraction of the rectangle at which the latitude occurs.  If the latitude is the southern\n *          boundary of the rectangle, the return value will be zero.  If it is the northern boundary, the return\n *          value will be 1.0.  Latitudes in between are mapped according to the Web Mercator projection.\n */ \nfloat czm_latitudeToWebMercatorFraction(float latitude, float southMercatorY, float oneOverMercatorHeight)\n{\n    float sinLatitude = sin(latitude);\n    float mercatorY = 0.5 * log((1.0 + sinLatitude) / (1.0 - sinLatitude));\n    \n    return (mercatorY - southMercatorY) * oneOverMercatorHeight;\n}\n",nW="/**\n * Computes distance from an point in 2D to a line in 2D.\n *\n * @name czm_lineDistance\n * @glslFunction\n *\n * param {vec2} point1 A point along the line.\n * param {vec2} point2 A point along the line.\n * param {vec2} point A point that may or may not be on the line.\n * returns {float} The distance from the point to the line.\n */\nfloat czm_lineDistance(vec2 point1, vec2 point2, vec2 point) {\n    return abs((point2.y - point1.y) * point.x - (point2.x - point1.x) * point.y + point2.x * point1.y - point2.y * point1.x) / distance(point2, point1);\n}\n",iW="/**\n * Converts a linear RGB color to an sRGB color.\n *\n * @param {vec3|vec4} linearIn The color in linear color space.\n * @returns {vec3|vec4} The color in sRGB color space. The vector type matches the input.\n */\nvec3 czm_linearToSrgb(vec3 linearIn) \n{\n    return pow(linearIn, vec3(1.0/2.2));\n}\n\nvec4 czm_linearToSrgb(vec4 linearIn) \n{\n    vec3 srgbOut = pow(linearIn.rgb, vec3(1.0/2.2));\n    return vec4(srgbOut, linearIn.a);\n}\n",oW="/**\n * Computes the luminance of a color. \n *\n * @name czm_luminance\n * @glslFunction\n *\n * @param {vec3} rgb The color.\n * \n * @returns {float} The luminance.\n *\n * @example\n * float light = czm_luminance(vec3(0.0)); // 0.0\n * float dark = czm_luminance(vec3(1.0));  // ~1.0 \n */\nfloat czm_luminance(vec3 rgb)\n{\n    // Algorithm from Chapter 10 of Graphics Shaders.\n    const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n    return dot(rgb, W);\n}\n",rW="/**\n * Computes the size of a pixel in meters at a distance from the eye.\n * <p>\n * Use this version when passing in a custom pixel ratio. For example, passing in 1.0 will return meters per native device pixel.\n * </p>\n * @name czm_metersPerPixel\n * @glslFunction\n *\n * @param {vec3} positionEC The position to get the meters per pixel in eye coordinates.\n * @param {float} pixelRatio The scaling factor from pixel space to coordinate space\n *\n * @returns {float} The meters per pixel at positionEC.\n */\nfloat czm_metersPerPixel(vec4 positionEC, float pixelRatio)\n{\n    float width = czm_viewport.z;\n    float height = czm_viewport.w;\n    float pixelWidth;\n    float pixelHeight;\n\n    float top = czm_frustumPlanes.x;\n    float bottom = czm_frustumPlanes.y;\n    float left = czm_frustumPlanes.z;\n    float right = czm_frustumPlanes.w;\n\n    if (czm_sceneMode == czm_sceneMode2D || czm_orthographicIn3D == 1.0)\n    {\n        float frustumWidth = right - left;\n        float frustumHeight = top - bottom;\n        pixelWidth = frustumWidth / width;\n        pixelHeight = frustumHeight / height;\n    }\n    else\n    {\n        float distanceToPixel = -positionEC.z;\n        float inverseNear = 1.0 / czm_currentFrustum.x;\n        float tanTheta = top * inverseNear;\n        pixelHeight = 2.0 * distanceToPixel * tanTheta / height;\n        tanTheta = right * inverseNear;\n        pixelWidth = 2.0 * distanceToPixel * tanTheta / width;\n    }\n\n    return max(pixelWidth, pixelHeight) * pixelRatio;\n}\n\n/**\n * Computes the size of a pixel in meters at a distance from the eye.\n * <p>\n * Use this version when scaling by pixel ratio.\n * </p>\n * @name czm_metersPerPixel\n * @glslFunction\n *\n * @param {vec3} positionEC The position to get the meters per pixel in eye coordinates.\n *\n * @returns {float} The meters per pixel at positionEC.\n */\nfloat czm_metersPerPixel(vec4 positionEC)\n{\n    return czm_metersPerPixel(positionEC, czm_pixelRatio);\n}\n",sW="/**\n * Transforms a position from model to window coordinates.  The transformation\n * from model to clip coordinates is done using {@link czm_modelViewProjection}.\n * The transform from normalized device coordinates to window coordinates is\n * done using {@link czm_viewportTransformation}, which assumes a depth range\n * of <code>near = 0</code> and <code>far = 1</code>.\n * <br /><br />\n * This transform is useful when there is a need to manipulate window coordinates\n * in a vertex shader as done by {@link BillboardCollection}.\n * <br /><br />\n * This function should not be confused with {@link czm_viewportOrthographic},\n * which is an orthographic projection matrix that transforms from window \n * coordinates to clip coordinates.\n *\n * @name czm_modelToWindowCoordinates\n * @glslFunction\n *\n * @param {vec4} position The position in model coordinates to transform.\n *\n * @returns {vec4} The transformed position in window coordinates.\n *\n * @see czm_eyeToWindowCoordinates\n * @see czm_modelViewProjection\n * @see czm_viewportTransformation\n * @see czm_viewportOrthographic\n * @see BillboardCollection\n *\n * @example\n * vec4 positionWC = czm_modelToWindowCoordinates(positionMC);\n */\nvec4 czm_modelToWindowCoordinates(vec4 position)\n{\n    vec4 q = czm_modelViewProjection * position;                // clip coordinates\n    q.xyz /= q.w;                                                // normalized device coordinates\n    q.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz; // window coordinates\n    return q;\n}\n",aW="/**\n * DOC_TBA\n *\n * @name czm_multiplyWithColorBalance\n * @glslFunction\n */\nvec3 czm_multiplyWithColorBalance(vec3 left, vec3 right)\n{\n    // Algorithm from Chapter 10 of Graphics Shaders.\n    const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n    \n    vec3 target = left * right;\n    float leftLuminance = dot(left, W);\n    float rightLuminance = dot(right, W);\n    float targetLuminance = dot(target, W);\n    \n    return ((leftLuminance + rightLuminance) / (2.0 * targetLuminance)) * target;\n}\n",cW="/**\n * Computes a value that scales with distance.  The scaling is clamped at the near and\n * far distances, and does not extrapolate.  This function works with the\n * {@link NearFarScalar} JavaScript class.\n *\n * @name czm_nearFarScalar\n * @glslFunction\n *\n * @param {vec4} nearFarScalar A vector with 4 components: Near distance (x), Near value (y), Far distance (z), Far value (w).\n * @param {float} cameraDistSq The square of the current distance from the camera.\n *\n * @returns {float} The value at this distance.\n */\nfloat czm_nearFarScalar(vec4 nearFarScalar, float cameraDistSq)\n{\n    float valueAtMin = nearFarScalar.y;\n    float valueAtMax = nearFarScalar.w;\n    float nearDistanceSq = nearFarScalar.x * nearFarScalar.x;\n    float farDistanceSq = nearFarScalar.z * nearFarScalar.z;\n\n    float t = (cameraDistSq - nearDistanceSq) / (farDistanceSq - nearDistanceSq);\n\n    t = pow(clamp(t, 0.0, 1.0), 0.2);\n\n    return mix(valueAtMin, valueAtMax, t);\n}\n",lW=" /**\n  * Decodes a unit-length vector in 'oct' encoding to a normalized 3-component Cartesian vector.\n  * The 'oct' encoding is described in \"A Survey of Efficient Representations of Independent Unit Vectors\",\n  * Cigolle et al 2014: http://jcgt.org/published/0003/02/01/\n  *\n  * @name czm_octDecode\n  * @param {vec2} encoded The oct-encoded, unit-length vector\n  * @param {float} range The maximum value of the SNORM range. The encoded vector is stored in log2(rangeMax+1) bits.\n  * @returns {vec3} The decoded and normalized vector\n  */\n  vec3 czm_octDecode(vec2 encoded, float range)\n  {\n      if (encoded.x == 0.0 && encoded.y == 0.0) {\n          return vec3(0.0, 0.0, 0.0);\n      }\n\n     encoded = encoded / range * 2.0 - 1.0;\n     vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\n     if (v.z < 0.0)\n     {\n         v.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);\n     }\n\n     return normalize(v);\n  }\n\n/**\n * Decodes a unit-length vector in 'oct' encoding to a normalized 3-component Cartesian vector.\n * The 'oct' encoding is described in \"A Survey of Efficient Representations of Independent Unit Vectors\",\n * Cigolle et al 2014: http://jcgt.org/published/0003/02/01/\n *\n * @name czm_octDecode\n * @param {vec2} encoded The oct-encoded, unit-length vector\n * @returns {vec3} The decoded and normalized vector\n */\n vec3 czm_octDecode(vec2 encoded)\n {\n    return czm_octDecode(encoded, 255.0);\n }\n\n /**\n * Decodes a unit-length vector in 'oct' encoding packed into a floating-point number to a normalized 3-component Cartesian vector.\n * The 'oct' encoding is described in \"A Survey of Efficient Representations of Independent Unit Vectors\",\n * Cigolle et al 2014: http://jcgt.org/published/0003/02/01/\n *\n * @name czm_octDecode\n * @param {float} encoded The oct-encoded, unit-length vector\n * @returns {vec3} The decoded and normalized vector\n */\n vec3 czm_octDecode(float encoded)\n {\n    float temp = encoded / 256.0;\n    float x = floor(temp);\n    float y = (temp - x) * 256.0;\n    return czm_octDecode(vec2(x, y));\n }\n\n/**\n * Decodes three unit-length vectors in 'oct' encoding packed into two floating-point numbers to normalized 3-component Cartesian vectors.\n * The 'oct' encoding is described in \"A Survey of Efficient Representations of Independent Unit Vectors\",\n * Cigolle et al 2014: http://jcgt.org/published/0003/02/01/\n *\n * @name czm_octDecode\n * @param {vec2} encoded The packed oct-encoded, unit-length vectors.\n * @param {vec3} vector1 One decoded and normalized vector.\n * @param {vec3} vector2 One decoded and normalized vector.\n * @param {vec3} vector3 One decoded and normalized vector.\n */\n  void czm_octDecode(vec2 encoded, out vec3 vector1, out vec3 vector2, out vec3 vector3)\n {\n    float temp = encoded.x / 65536.0;\n    float x = floor(temp);\n    float encodedFloat1 = (temp - x) * 65536.0;\n\n    temp = encoded.y / 65536.0;\n    float y = floor(temp);\n    float encodedFloat2 = (temp - y) * 65536.0;\n\n    vector1 = czm_octDecode(encodedFloat1);\n    vector2 = czm_octDecode(encodedFloat2);\n    vector3 = czm_octDecode(vec2(x, y));\n }\n\n",uW="/**\n * Packs a depth value into a vec3 that can be represented by unsigned bytes.\n *\n * @name czm_packDepth\n * @glslFunction\n *\n * @param {float} depth The floating-point depth.\n * @returns {vec3} The packed depth.\n */\nvec4 czm_packDepth(float depth)\n{\n    // See Aras Pranckevičius' post Encoding Floats to RGBA\n    // http://aras-p.info/blog/2009/07/30/encoding-floats-to-rgba-the-final/\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n    return enc;\n}\n",hW="vec3 lambertianDiffuse(vec3 diffuseColor)\n{\n    return diffuseColor / czm_pi;\n}\n\nvec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH)\n{\n    return f0 + (f90 - f0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);\n}\n\nfloat smithVisibilityG1(float NdotV, float roughness)\n{\n    // this is the k value for direct lighting.\n    // for image based lighting it will be roughness^2 / 2\n    float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\n\nfloat smithVisibilityGGX(float roughness, float NdotL, float NdotV)\n{\n    return (\n        smithVisibilityG1(NdotL, roughness) *\n        smithVisibilityG1(NdotV, roughness)\n    );\n}\n\nfloat GGX(float roughness, float NdotH)\n{\n    float roughnessSquared = roughness * roughness;\n    float f = (NdotH * roughnessSquared - NdotH) * NdotH + 1.0;\n    return roughnessSquared / (czm_pi * f * f);\n}\n\n/**\n * Compute the diffuse and specular contributions using physically based\n * rendering. This function only handles direct lighting.\n * <p>\n * This function only handles the lighting calculations. Metallic/roughness\n * and specular/glossy must be handled separately. See {@czm_pbrMetallicRoughnessMaterial}, {@czm_pbrSpecularGlossinessMaterial} and {@czm_defaultPbrMaterial}\n * </p>\n *\n * @name czm_pbrlighting\n * @glslFunction\n *\n * @param {vec3} positionEC The position of the fragment in eye coordinates\n * @param {vec3} normalEC The surface normal in eye coordinates\n * @param {vec3} lightDirectionEC Unit vector pointing to the light source in eye coordinates.\n * @param {vec3} lightColorHdr radiance of the light source. This is a HDR value.\n * @param {czm_pbrParameters} The computed PBR parameters.\n * @return {vec3} The computed HDR color\n *\n * @example\n * czm_pbrParameters pbrParameters = czm_pbrMetallicRoughnessMaterial(\n *  baseColor,\n *  metallic,\n *  roughness\n * );\n * vec3 color = czm_pbrlighting(\n *  positionEC,\n *  normalEC,\n *  lightDirectionEC,\n *  lightColorHdr,\n *  pbrParameters);\n */\nvec3 czm_pbrLighting(\n    vec3 positionEC,\n    vec3 normalEC,\n    vec3 lightDirectionEC,\n    vec3 lightColorHdr,\n    czm_pbrParameters pbrParameters\n)\n{\n    vec3 v = -normalize(positionEC);\n    vec3 l = normalize(lightDirectionEC);\n    vec3 h = normalize(v + l);\n    vec3 n = normalEC;\n    float NdotL = clamp(dot(n, l), 0.001, 1.0);\n    float NdotV = abs(dot(n, v)) + 0.001;\n    float NdotH = clamp(dot(n, h), 0.0, 1.0);\n    float LdotH = clamp(dot(l, h), 0.0, 1.0);\n    float VdotH = clamp(dot(v, h), 0.0, 1.0);\n\n    vec3 f0 = pbrParameters.f0;\n    float reflectance = max(max(f0.r, f0.g), f0.b);\n    vec3 f90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));\n    vec3 F = fresnelSchlick2(f0, f90, VdotH);\n\n    float alpha = pbrParameters.roughness;\n    float G = smithVisibilityGGX(alpha, NdotL, NdotV);\n    float D = GGX(alpha, NdotH);\n    vec3 specularContribution = F * G * D / (4.0 * NdotL * NdotV);\n\n    vec3 diffuseColor = pbrParameters.diffuseColor;\n    // F here represents the specular contribution\n    vec3 diffuseContribution = (1.0 - F) * lambertianDiffuse(diffuseColor);\n\n    // Lo = (diffuse + specular) * Li * NdotL\n    return (diffuseContribution + specularContribution) * NdotL * lightColorHdr;\n}\n",dW="/**\n * Compute parameters for physically based rendering using the\n * metallic/roughness workflow. All inputs are linear; sRGB texture values must\n * be decoded beforehand\n *\n * @name czm_pbrMetallicRoughnessMaterial\n * @glslFunction\n *\n * @param {vec3} baseColor For dielectrics, this is the base color. For metals, this is the f0 value (reflectance at normal incidence)\n * @param {float} metallic 0.0 indicates dielectric. 1.0 indicates metal. Values in between are allowed (e.g. to model rust or dirt);\n * @param {float} roughness A value between 0.0 and 1.0\n * @return {czm_pbrParameters} parameters to pass into {@link czm_pbrLighting}\n */\nczm_pbrParameters czm_pbrMetallicRoughnessMaterial(\n    vec3 baseColor,\n    float metallic,\n    float roughness\n) \n{\n    czm_pbrParameters results;\n\n    // roughness is authored as perceptual roughness\n    // square it to get material roughness\n    roughness = clamp(roughness, 0.0, 1.0);\n    results.roughness = roughness * roughness;\n\n    // dielectrics us f0 = 0.04, metals use albedo as f0\n    metallic = clamp(metallic, 0.0, 1.0);\n    const vec3 REFLECTANCE_DIELECTRIC = vec3(0.04);\n    vec3 f0 = mix(REFLECTANCE_DIELECTRIC, baseColor, metallic);\n    results.f0 = f0;\n\n    // diffuse only applies to dielectrics.\n    results.diffuseColor = baseColor * (1.0 - f0) * (1.0 - metallic);\n\n    return results;\n}\n",fW="/**\n * Compute parameters for physically based rendering using the\n * specular/glossy workflow. All inputs are linear; sRGB texture values must\n * be decoded beforehand\n *\n * @name czm_pbrSpecularGlossinessMaterial\n * @glslFunction\n *\n * @param {vec3} diffuse The diffuse color for dielectrics (non-metals)\n * @param {vec3} specular The reflectance at normal incidence (f0)\n * @param {float} glossiness A number from 0.0 to 1.0 indicating how smooth the surface is.\n * @return {czm_pbrParameters} parameters to pass into {@link czm_pbrLighting}\n */\nczm_pbrParameters czm_pbrSpecularGlossinessMaterial(\n    vec3 diffuse,\n    vec3 specular,\n    float glossiness\n) \n{\n    czm_pbrParameters results;\n\n    // glossiness is the opposite of roughness, but easier for artists to use.\n    float roughness = 1.0 - glossiness;\n    results.roughness = roughness * roughness;\n\n    results.diffuseColor = diffuse * (1.0 - max(max(specular.r, specular.g), specular.b));\n    results.f0 = specular;\n\n    return results;\n}\n",pW="float czm_private_getLambertDiffuseOfMaterial(vec3 lightDirectionEC, czm_material material)\n{\n    return czm_getLambertDiffuse(lightDirectionEC, material.normal);\n}\n\nfloat czm_private_getSpecularOfMaterial(vec3 lightDirectionEC, vec3 toEyeEC, czm_material material)\n{\n    return czm_getSpecular(lightDirectionEC, toEyeEC, material.normal, material.shininess);\n}\n\n/**\n * Computes a color using the Phong lighting model.\n *\n * @name czm_phong\n * @glslFunction\n *\n * @param {vec3} toEye A normalized vector from the fragment to the eye in eye coordinates.\n * @param {czm_material} material The fragment's material.\n *\n * @returns {vec4} The computed color.\n *\n * @example\n * vec3 positionToEyeEC = // ...\n * czm_material material = // ...\n * vec3 lightDirectionEC = // ...\n * gl_FragColor = czm_phong(normalize(positionToEyeEC), material, lightDirectionEC);\n *\n * @see czm_getMaterial\n */\nvec4 czm_phong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\n    // Diffuse from directional light sources at eye (for top-down)\n    float diffuse = czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 0.0, 1.0), material);\n    if (czm_sceneMode == czm_sceneMode3D) {\n        // (and horizon views in 3D)\n        diffuse += czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 1.0, 0.0), material);\n    }\n\n    float specular = czm_private_getSpecularOfMaterial(lightDirectionEC, toEye, material);\n\n    // Temporary workaround for adding ambient.\n    vec3 materialDiffuse = material.diffuse * 0.5;\n\n    vec3 ambient = materialDiffuse;\n    vec3 color = ambient + material.emission;\n    color += materialDiffuse * diffuse * czm_lightColor;\n    color += material.specular * specular * czm_lightColor;\n\n    return vec4(color, material.alpha);\n}\n\nvec4 czm_private_phong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\n    float diffuse = czm_private_getLambertDiffuseOfMaterial(lightDirectionEC, material);\n    float specular = czm_private_getSpecularOfMaterial(lightDirectionEC, toEye, material);\n\n    vec3 ambient = vec3(0.0);\n    vec3 color = ambient + material.emission;\n    color += material.diffuse * diffuse * czm_lightColor;\n    color += material.specular * specular * czm_lightColor;\n\n    return vec4(color, material.alpha);\n}\n",mW="/**\n * Computes distance from a point to a plane.\n *\n * @name czm_planeDistance\n * @glslFunction\n *\n * param {vec4} plane A Plane in Hessian Normal Form. See Plane.js\n * param {vec3} point A point in the same space as the plane.\n * returns {float} The distance from the point to the plane.\n */\nfloat czm_planeDistance(vec4 plane, vec3 point) {\n    return (dot(plane.xyz, point) + plane.w);\n}\n\n/**\n * Computes distance from a point to a plane.\n *\n * @name czm_planeDistance\n * @glslFunction\n *\n * param {vec3} planeNormal Normal for a plane in Hessian Normal Form. See Plane.js\n * param {float} planeDistance Distance for a plane in Hessian Normal form. See Plane.js\n * param {vec3} point A point in the same space as the plane.\n * returns {float} The distance from the point to the plane.\n */\nfloat czm_planeDistance(vec3 planeNormal, float planeDistance, vec3 point) {\n    return (dot(planeNormal, point) + planeDistance);\n}\n",_W="/**\n * Computes the point along a ray at the given time.  <code>time</code> can be positive, negative, or zero.\n *\n * @name czm_pointAlongRay\n * @glslFunction\n *\n * @param {czm_ray} ray The ray to compute the point along.\n * @param {float} time The time along the ray.\n * \n * @returns {vec3} The point along the ray at the given time.\n * \n * @example\n * czm_ray ray = czm_ray(vec3(0.0), vec3(1.0, 0.0, 0.0)); // origin, direction\n * vec3 v = czm_pointAlongRay(ray, 2.0); // (2.0, 0.0, 0.0)\n */\nvec3 czm_pointAlongRay(czm_ray ray, float time)\n{\n    return ray.origin + (time * ray.direction);\n}\n",gW="/**\n * DOC_TBA\n *\n * @name czm_rayEllipsoidIntersectionInterval\n * @glslFunction\n */\nczm_raySegment czm_rayEllipsoidIntersectionInterval(czm_ray ray, vec3 ellipsoid_center, vec3 ellipsoid_inverseRadii)\n{\n   // ray and ellipsoid center in eye coordinates.  radii in model coordinates.\n    vec3 q = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ray.origin, 1.0)).xyz;\n    vec3 w = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ray.direction, 0.0)).xyz;\n\n    q = q - ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ellipsoid_center, 1.0)).xyz;\n\n    float q2 = dot(q, q);\n    float qw = dot(q, w);\n\n    if (q2 > 1.0) // Outside ellipsoid.\n    {\n        if (qw >= 0.0) // Looking outward or tangent (0 intersections).\n        {\n            return czm_emptyRaySegment;\n        }\n        else // qw < 0.0.\n        {\n            float qw2 = qw * qw;\n            float difference = q2 - 1.0; // Positively valued.\n            float w2 = dot(w, w);\n            float product = w2 * difference;\n\n            if (qw2 < product) // Imaginary roots (0 intersections).\n            {\n                return czm_emptyRaySegment;\n            }\n            else if (qw2 > product) // Distinct roots (2 intersections).\n            {\n                float discriminant = qw * qw - product;\n                float temp = -qw + sqrt(discriminant); // Avoid cancellation.\n                float root0 = temp / w2;\n                float root1 = difference / temp;\n                if (root0 < root1)\n                {\n                    czm_raySegment i = czm_raySegment(root0, root1);\n                    return i;\n                }\n                else\n                {\n                    czm_raySegment i = czm_raySegment(root1, root0);\n                    return i;\n                }\n            }\n            else // qw2 == product.  Repeated roots (2 intersections).\n            {\n                float root = sqrt(difference / w2);\n                czm_raySegment i = czm_raySegment(root, root);\n                return i;\n            }\n        }\n    }\n    else if (q2 < 1.0) // Inside ellipsoid (2 intersections).\n    {\n        float difference = q2 - 1.0; // Negatively valued.\n        float w2 = dot(w, w);\n        float product = w2 * difference; // Negatively valued.\n        float discriminant = qw * qw - product;\n        float temp = -qw + sqrt(discriminant); // Positively valued.\n        czm_raySegment i = czm_raySegment(0.0, temp / w2);\n        return i;\n    }\n    else // q2 == 1.0. On ellipsoid.\n    {\n        if (qw < 0.0) // Looking inward.\n        {\n            float w2 = dot(w, w);\n            czm_raySegment i = czm_raySegment(0.0, -qw / w2);\n            return i;\n        }\n        else // qw >= 0.0.  Looking outward or tangent.\n        {\n            return czm_emptyRaySegment;\n        }\n    }\n}\n",yW="float czm_readDepth(sampler2D depthTexture, vec2 texCoords)\n{\n    return czm_reverseLogDepth(texture2D(depthTexture, texCoords).r);\n}\n",vW="/**\n * Reads a value previously transformed with {@link czm_writeNonPerspective}\n * by dividing it by `w`, the value used in the perspective divide.\n * This function is intended to be called in a fragment shader to access a\n * `varying` that should not be subject to perspective interpolation.\n * For example, screen-space texture coordinates. The value should have been\n * previously written in the vertex shader with a call to\n * {@link czm_writeNonPerspective}.\n *\n * @name czm_readNonPerspective\n * @glslFunction\n *\n * @param {float|vec2|vec3|vec4} value The non-perspective value to be read.\n * @param {float} oneOverW One over the perspective divide value, `w`. Usually this is simply `gl_FragCoord.w`.\n * @returns {float|vec2|vec3|vec4} The usable value.\n */\nfloat czm_readNonPerspective(float value, float oneOverW) {\n    return value * oneOverW;\n}\n\nvec2 czm_readNonPerspective(vec2 value, float oneOverW) {\n    return value * oneOverW;\n}\n\nvec3 czm_readNonPerspective(vec3 value, float oneOverW) {\n    return value * oneOverW;\n}\n\nvec4 czm_readNonPerspective(vec4 value, float oneOverW) {\n    return value * oneOverW;\n}\n",bW="float czm_reverseLogDepth(float logZ)\n{\n#ifdef LOG_DEPTH\n    float near = czm_currentFrustum.x;\n    float far = czm_currentFrustum.y;\n    float log2Depth = logZ * czm_log2FarDepthFromNearPlusOne;\n    float depthFromNear = pow(2.0, log2Depth) - 1.0;\n    return far * (1.0 - near / (depthFromNear + near)) / (far - near);\n#endif\n    return logZ;\n}\n",AW="/**\n * Round a floating point value. This function exists because round() doesn't\n * exist in GLSL 1.00. \n *\n * @param {float|vec2|vec3|vec4} value The value to round\n * @param {float|vec2|vec3|vec3} The rounded value. The type matches the input.\n */\nfloat czm_round(float value) {\n  return floor(value + 0.5);\n}\n\nvec2 czm_round(vec2 value) {\n  return floor(value + 0.5);\n}\n\nvec3 czm_round(vec3 value) {\n  return floor(value + 0.5);\n}\n\nvec4 czm_round(vec4 value) {\n  return floor(value + 0.5);\n}\n",wW="/**\n * Samples the 4 neighboring pixels and return the weighted average.\n *\n * @private\n */\nvec3 czm_sampleOctahedralProjectionWithFiltering(sampler2D projectedMap, vec2 textureSize, vec3 direction, float lod)\n{\n    direction /= dot(vec3(1.0), abs(direction));\n    vec2 rev = abs(direction.zx) - vec2(1.0);\n    vec2 neg = vec2(direction.x < 0.0 ? rev.x : -rev.x,\n                    direction.z < 0.0 ? rev.y : -rev.y);\n    vec2 uv = direction.y < 0.0 ? neg : direction.xz;\n    vec2 coord = 0.5 * uv + vec2(0.5);\n    vec2 pixel = 1.0 / textureSize;\n\n    if (lod > 0.0)\n    {\n        // Each subseqeuent mip level is half the size\n        float scale = 1.0 / pow(2.0, lod);\n        float offset = ((textureSize.y + 1.0) / textureSize.x);\n\n        coord.x *= offset;\n        coord *= scale;\n\n        coord.x += offset + pixel.x;\n        coord.y += (1.0 - (1.0 / pow(2.0, lod - 1.0))) + pixel.y * (lod - 1.0) * 2.0;\n    }\n    else\n    {\n        coord.x *= (textureSize.y / textureSize.x);\n    }\n\n    // Do bilinear filtering\n    #ifndef OES_texture_float_linear\n        vec3 color1 = texture2D(projectedMap, coord + vec2(0.0, pixel.y)).rgb;\n        vec3 color2 = texture2D(projectedMap, coord + vec2(pixel.x, 0.0)).rgb;\n        vec3 color3 = texture2D(projectedMap, coord + pixel).rgb;\n        vec3 color4 = texture2D(projectedMap, coord).rgb;\n\n        vec2 texturePosition = coord * textureSize;\n\n        float fu = fract(texturePosition.x);\n        float fv = fract(texturePosition.y);\n\n        vec3 average1 = mix(color4, color2, fu);\n        vec3 average2 = mix(color1, color3, fu);\n\n        vec3 color = mix(average1, average2, fv);\n    #else\n        vec3 color = texture2D(projectedMap, coord).rgb;\n    #endif\n\n    return color;\n}\n\n\n/**\n * Samples from a cube map that has been projected using an octahedral projection from the given direction.\n *\n * @name czm_sampleOctahedralProjection\n * @glslFunction\n *\n * @param {sampler2D} projectedMap The texture with the octahedral projected cube map.\n * @param {vec2} textureSize The width and height dimensions in pixels of the projected map.\n * @param {vec3} direction The normalized direction used to sample the cube map.\n * @param {float} lod The level of detail to sample.\n * @param {float} maxLod The maximum level of detail.\n * @returns {vec3} The color of the cube map at the direction.\n */\nvec3 czm_sampleOctahedralProjection(sampler2D projectedMap, vec2 textureSize, vec3 direction, float lod, float maxLod) {\n    float currentLod = floor(lod + 0.5);\n    float nextLod = min(currentLod + 1.0, maxLod);\n\n    vec3 colorCurrentLod = czm_sampleOctahedralProjectionWithFiltering(projectedMap, textureSize, direction, currentLod);\n    vec3 colorNextLod = czm_sampleOctahedralProjectionWithFiltering(projectedMap, textureSize, direction, nextLod);\n\n    return mix(colorNextLod, colorCurrentLod, nextLod - lod);\n}\n",TW="/**\n * Adjusts the saturation of a color.\n * \n * @name czm_saturation\n * @glslFunction\n * \n * @param {vec3} rgb The color.\n * @param {float} adjustment The amount to adjust the saturation of the color.\n *\n * @returns {float} The color with the saturation adjusted.\n *\n * @example\n * vec3 greyScale = czm_saturation(color, 0.0);\n * vec3 doubleSaturation = czm_saturation(color, 2.0);\n */\nvec3 czm_saturation(vec3 rgb, float adjustment)\n{\n    // Algorithm from Chapter 16 of OpenGL Shading Language\n    const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n    vec3 intensity = vec3(dot(rgb, W));\n    return mix(intensity, rgb, adjustment);\n}\n",CW="\nfloat czm_sampleShadowMap(highp samplerCube shadowMap, vec3 d)\n{\n    return czm_unpackDepth(textureCube(shadowMap, d));\n}\n\nfloat czm_sampleShadowMap(highp sampler2D shadowMap, vec2 uv)\n{\n#ifdef USE_SHADOW_DEPTH_TEXTURE\n    return texture2D(shadowMap, uv).r;\n#else\n    return czm_unpackDepth(texture2D(shadowMap, uv));\n#endif\n}\n\nfloat czm_shadowDepthCompare(samplerCube shadowMap, vec3 uv, float depth)\n{\n    return step(depth, czm_sampleShadowMap(shadowMap, uv));\n}\n\nfloat czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth)\n{\n    return step(depth, czm_sampleShadowMap(shadowMap, uv));\n}\n",EW="\nfloat czm_private_shadowVisibility(float visibility, float nDotL, float normalShadingSmooth, float darkness)\n{\n#ifdef USE_NORMAL_SHADING\n#ifdef USE_NORMAL_SHADING_SMOOTH\n    float strength = clamp(nDotL / normalShadingSmooth, 0.0, 1.0);\n#else\n    float strength = step(0.0, nDotL);\n#endif\n    visibility *= strength;\n#endif\n\n    visibility = max(visibility, darkness);\n    return visibility;\n}\n\n#ifdef USE_CUBE_MAP_SHADOW\nfloat czm_shadowVisibility(samplerCube shadowMap, czm_shadowParameters shadowParameters)\n{\n    float depthBias = shadowParameters.depthBias;\n    float depth = shadowParameters.depth;\n    float nDotL = shadowParameters.nDotL;\n    float normalShadingSmooth = shadowParameters.normalShadingSmooth;\n    float darkness = shadowParameters.darkness;\n    vec3 uvw = shadowParameters.texCoords;\n\n    depth -= depthBias;\n    float visibility = czm_shadowDepthCompare(shadowMap, uvw, depth);\n    return czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);\n}\n#else\nfloat czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters)\n{\n    float depthBias = shadowParameters.depthBias;\n    float depth = shadowParameters.depth;\n    float nDotL = shadowParameters.nDotL;\n    float normalShadingSmooth = shadowParameters.normalShadingSmooth;\n    float darkness = shadowParameters.darkness;\n    vec2 uv = shadowParameters.texCoords;\n\n    depth -= depthBias;\n#ifdef USE_SOFT_SHADOWS\n    vec2 texelStepSize = shadowParameters.texelStepSize;\n    float radius = 1.0;\n    float dx0 = -texelStepSize.x * radius;\n    float dy0 = -texelStepSize.y * radius;\n    float dx1 = texelStepSize.x * radius;\n    float dy1 = texelStepSize.y * radius;\n    float visibility = (\n        czm_shadowDepthCompare(shadowMap, uv, depth) +\n        czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +\n        czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +\n        czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +\n        czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +\n        czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +\n        czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +\n        czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +\n        czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)\n    ) * (1.0 / 9.0);\n#else\n    float visibility = czm_shadowDepthCompare(shadowMap, uv, depth);\n#endif\n\n    return czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);\n}\n#endif\n",xW="/**\n * Returns 1.0 if the given value is positive or zero, and -1.0 if it is negative.  This is similar to the GLSL\n * built-in function <code>sign</code> except that returns 1.0 instead of 0.0 when the input value is 0.0.\n * \n * @name czm_signNotZero\n * @glslFunction\n *\n * @param {} value The value for which to determine the sign.\n * @returns {} 1.0 if the value is positive or zero, -1.0 if the value is negative.\n */\nfloat czm_signNotZero(float value)\n{\n    return value >= 0.0 ? 1.0 : -1.0;\n}\n\nvec2 czm_signNotZero(vec2 value)\n{\n    return vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));\n}\n\nvec3 czm_signNotZero(vec3 value)\n{\n    return vec3(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z));\n}\n\nvec4 czm_signNotZero(vec4 value)\n{\n    return vec4(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z), czm_signNotZero(value.w));\n}\n",SW="/**\n * Computes a color from the third order spherical harmonic coefficients and a normalized direction vector.\n * <p>\n * The order of the coefficients is [L00, L1_1, L10, L11, L2_2, L2_1, L20, L21, L22].\n * </p>\n *\n * @name czm_sphericalHarmonics\n * @glslFunction\n *\n * @param {vec3} normal The normalized direction.\n * @param {vec3[9]} coefficients The third order spherical harmonic coefficients.\n * @returns {vec3} The color at the direction.\n *\n * @see https://graphics.stanford.edu/papers/envmap/envmap.pdf\n */\nvec3 czm_sphericalHarmonics(vec3 normal, vec3 coefficients[9])\n{\n    vec3 L00 = coefficients[0];\n    vec3 L1_1 = coefficients[1];\n    vec3 L10 = coefficients[2];\n    vec3 L11 = coefficients[3];\n    vec3 L2_2 = coefficients[4];\n    vec3 L2_1 = coefficients[5];\n    vec3 L20 = coefficients[6];\n    vec3 L21 = coefficients[7];\n    vec3 L22 = coefficients[8];\n\n    float x = normal.x;\n    float y = normal.y;\n    float z = normal.z;\n\n    return\n          L00\n        + L1_1 * y\n        + L10 * z\n        + L11 * x\n        + L2_2 * (y * x)\n        + L2_1 * (y * z)\n        + L20 * (3.0 * z * z - 1.0)\n        + L21 * (z * x)\n        + L22 * (x * x - y * y);\n}\n",IW="/**\n * Converts an sRGB color to a linear RGB color.\n *\n * @param {vec3|vec4} srgbIn The color in sRGB space\n * @returns {vec3|vec4} The color in linear color space. The vector type matches the input.\n */\nvec3 czm_srgbToLinear(vec3 srgbIn)\n{\n    return pow(srgbIn, vec3(2.2));\n}\n\nvec4 czm_srgbToLinear(vec4 srgbIn) \n{\n    vec3 linearOut = pow(srgbIn.rgb, vec3(2.2));\n    return vec4(linearOut, srgbIn.a);\n}\n",OW="/**\n * Creates a matrix that transforms vectors from tangent space to eye space.\n *\n * @name czm_tangentToEyeSpaceMatrix\n * @glslFunction\n *\n * @param {vec3} normalEC The normal vector in eye coordinates.\n * @param {vec3} tangentEC The tangent vector in eye coordinates.\n * @param {vec3} bitangentEC The bitangent vector in eye coordinates.\n *\n * @returns {mat3} The matrix that transforms from tangent space to eye space.\n *\n * @example\n * mat3 tangentToEye = czm_tangentToEyeSpaceMatrix(normalEC, tangentEC, bitangentEC);\n * vec3 normal = tangentToEye * texture2D(normalMap, st).xyz;\n */\nmat3 czm_tangentToEyeSpaceMatrix(vec3 normalEC, vec3 tangentEC, vec3 bitangentEC)\n{\n    vec3 normal = normalize(normalEC);\n    vec3 tangent = normalize(tangentEC);\n    vec3 bitangent = normalize(bitangentEC);\n    return mat3(tangent.x  , tangent.y  , tangent.z,\n                bitangent.x, bitangent.y, bitangent.z,\n                normal.x   , normal.y   , normal.z);\n}\n",DW="/**\n * Transforms a plane.\n * \n * @name czm_transformPlane\n * @glslFunction\n *\n * @param {vec4} plane The plane in Hessian Normal Form.\n * @param {mat4} transform The inverse-transpose of a transformation matrix.\n */\nvec4 czm_transformPlane(vec4 plane, mat4 transform) {\n    vec4 transformedPlane = transform * plane;\n    // Convert the transformed plane to Hessian Normal Form\n    float normalMagnitude = length(transformedPlane.xyz);\n    return transformedPlane / normalMagnitude;\n}\n",PW="/**\n * Translates a position (or any <code>vec3</code>) that was encoded with {@link EncodedCartesian3},\n * and then provided to the shader as separate <code>high</code> and <code>low</code> bits to\n * be relative to the eye.  As shown in the example, the position can then be transformed in eye\n * or clip coordinates using {@link czm_modelViewRelativeToEye} or {@link czm_modelViewProjectionRelativeToEye},\n * respectively.\n * <p>\n * This technique, called GPU RTE, eliminates jittering artifacts when using large coordinates as\n * described in {@link http://help.agi.com/AGIComponents/html/BlogPrecisionsPrecisions.htm|Precisions, Precisions}.\n * </p>\n *\n * @name czm_translateRelativeToEye\n * @glslFunction\n *\n * @param {vec3} high The position's high bits.\n * @param {vec3} low The position's low bits.\n * @returns {vec3} The position translated to be relative to the camera's position.\n *\n * @example\n * attribute vec3 positionHigh;\n * attribute vec3 positionLow;\n *\n * void main()\n * {\n *   vec4 p = czm_translateRelativeToEye(positionHigh, positionLow);\n *   gl_Position = czm_modelViewProjectionRelativeToEye * p;\n * }\n *\n * @see czm_modelViewRelativeToEye\n * @see czm_modelViewProjectionRelativeToEye\n * @see czm_computePosition\n * @see EncodedCartesian3\n */\nvec4 czm_translateRelativeToEye(vec3 high, vec3 low)\n{\n    vec3 highDifference = high - czm_encodedCameraPositionMCHigh;\n    vec3 lowDifference = low - czm_encodedCameraPositionMCLow;\n\n    return vec4(highDifference + lowDifference, 1.0);\n}\n",RW="/**\n * @private\n */\nvec4 czm_translucentPhong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\n    // Diffuse from directional light sources at eye (for top-down and horizon views)\n    float diffuse = czm_getLambertDiffuse(vec3(0.0, 0.0, 1.0), material.normal);\n\n    if (czm_sceneMode == czm_sceneMode3D) {\n        // (and horizon views in 3D)\n        diffuse += czm_getLambertDiffuse(vec3(0.0, 1.0, 0.0), material.normal);\n    }\n\n    diffuse = clamp(diffuse, 0.0, 1.0);\n\n    float specular = czm_getSpecular(lightDirectionEC, toEye, material.normal, material.shininess);\n\n    // Temporary workaround for adding ambient.\n    vec3 materialDiffuse = material.diffuse * 0.5;\n\n    vec3 ambient = materialDiffuse;\n    vec3 color = ambient + material.emission;\n    color += materialDiffuse * diffuse * czm_lightColor;\n    color += material.specular * specular * czm_lightColor;\n\n    return vec4(color, material.alpha);\n}\n",LW="/**\n * Returns the transpose of the matrix.  The input <code>matrix</code> can be\n * a <code>mat2</code>, <code>mat3</code>, or <code>mat4</code>.\n *\n * @name czm_transpose\n * @glslFunction\n *\n * @param {} matrix The matrix to transpose.\n *\n * @returns {} The transposed matrix.\n *\n * @example\n * // GLSL declarations\n * mat2 czm_transpose(mat2 matrix);\n * mat3 czm_transpose(mat3 matrix);\n * mat4 czm_transpose(mat4 matrix);\n *\n * // Transpose a 3x3 rotation matrix to find its inverse.\n * mat3 eastNorthUpToEye = czm_eastNorthUpToEyeCoordinates(\n *     positionMC, normalEC);\n * mat3 eyeToEastNorthUp = czm_transpose(eastNorthUpToEye);\n */\nmat2 czm_transpose(mat2 matrix)\n{\n    return mat2(\n        matrix[0][0], matrix[1][0],\n        matrix[0][1], matrix[1][1]);\n}\n\nmat3 czm_transpose(mat3 matrix)\n{\n    return mat3(\n        matrix[0][0], matrix[1][0], matrix[2][0],\n        matrix[0][1], matrix[1][1], matrix[2][1],\n        matrix[0][2], matrix[1][2], matrix[2][2]);\n}\n\nmat4 czm_transpose(mat4 matrix)\n{\n    return mat4(\n        matrix[0][0], matrix[1][0], matrix[2][0], matrix[3][0],\n        matrix[0][1], matrix[1][1], matrix[2][1], matrix[3][1],\n        matrix[0][2], matrix[1][2], matrix[2][2], matrix[3][2],\n        matrix[0][3], matrix[1][3], matrix[2][3], matrix[3][3]);\n}\n",MW="/**\n * Unpacks a vec4 depth value to a float in [0, 1) range.\n *\n * @name czm_unpackDepth\n * @glslFunction\n *\n * @param {vec4} packedDepth The packed depth.\n *\n * @returns {float} The floating-point depth in [0, 1) range.\n */\n float czm_unpackDepth(vec4 packedDepth)\n {\n    // See Aras Pranckevičius' post Encoding Floats to RGBA\n    // http://aras-p.info/blog/2009/07/30/encoding-floats-to-rgba-the-final/\n    return dot(packedDepth, vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n }\n",BW="/**\n * Unpack an IEEE 754 single-precision float that is packed as a little-endian unsigned normalized vec4.\n *\n * @name czm_unpackFloat\n * @glslFunction\n *\n * @param {vec4} packedFloat The packed float.\n *\n * @returns {float} The floating-point depth in arbitrary range.\n */\nfloat czm_unpackFloat(vec4 packedFloat)\n{\n    // Convert to [0.0, 255.0] and round to integer\n    packedFloat = floor(packedFloat * 255.0 + 0.5);\n    float sign = 1.0 - step(128.0, packedFloat[3]) * 2.0;\n    float exponent = 2.0 * mod(packedFloat[3], 128.0) + step(128.0, packedFloat[2]) - 127.0;    \n    if (exponent == -127.0)\n    {\n        return 0.0;\n    }\n    float mantissa = mod(packedFloat[2], 128.0) * 65536.0 + packedFloat[1] * 256.0 + packedFloat[0] + float(0x800000);\n    float result = sign * exp2(exponent - 23.0) * mantissa;\n    return result;\n}\n",NW="/**\n * Unpack unsigned integers of 1-4 bytes. in WebGL 1, there is no uint type,\n * so the return value is an int.\n * <p>\n * There are also precision limitations in WebGL 1. highp int is still limited\n * to 24 bits. Above the value of 2^24 = 16777216, precision loss may occur.\n * </p>\n *\n * @param {float|vec2|vec3|vec4} packed The packed value. For vectors, the components are listed in little-endian order.\n *\n * @return {int} The unpacked value.\n */\n int czm_unpackUint(float packedValue) {\n   float rounded = czm_round(packedValue * 255.0);\n   return int(rounded);\n }\n\n int czm_unpackUint(vec2 packedValue) {\n   vec2 rounded = czm_round(packedValue * 255.0);\n   return int(dot(rounded, vec2(1.0, 256.0)));\n }\n\n int czm_unpackUint(vec3 packedValue) {\n   vec3 rounded = czm_round(packedValue * 255.0);\n   return int(dot(rounded, vec3(1.0, 256.0, 65536.0)));\n }\n\n int czm_unpackUint(vec4 packedValue) {\n   vec4 rounded = czm_round(packedValue * 255.0);\n   return int(dot(rounded, vec4(1.0, 256.0, 65536.0, 16777216.0)));\n }\n",FW="/**\n * Transform metadata values following the EXT_structural_metadata spec\n * by multiplying by scale and adding the offset. Operations are always\n * performed component-wise, even for matrices.\n * \n * @param {float|vec2|vec3|vec4|mat2|mat3|mat4} offset The offset to add\n * @param {float|vec2|vec3|vec4|mat2|mat3|mat4} scale The scale factor to multiply\n * @param {float|vec2|vec3|vec4|mat2|mat3|mat4} value The original value.\n *\n * @return {float|vec2|vec3|vec4|mat2|mat3|mat4} The transformed value of the same scalar/vector/matrix type as the input.\n */\nfloat czm_valueTransform(float offset, float scale, float value) {\n  return scale * value + offset;\n}\n\nvec2 czm_valueTransform(vec2 offset, vec2 scale, vec2 value) {\n  return scale * value + offset;\n}\n\nvec3 czm_valueTransform(vec3 offset, vec3 scale, vec3 value) {\n  return scale * value + offset;\n}\n\nvec4 czm_valueTransform(vec4 offset, vec4 scale, vec4 value) {\n  return scale * value + offset;\n}\n\nmat2 czm_valueTransform(mat2 offset, mat2 scale, mat2 value) {\n  return matrixCompMult(scale, value) + offset;\n}\n\nmat3 czm_valueTransform(mat3 offset, mat3 scale, mat3 value) {\n  return matrixCompMult(scale, value) + offset;\n}\n\nmat4 czm_valueTransform(mat4 offset, mat4 scale, mat4 value) {\n  return matrixCompMult(scale, value) + offset;\n}\n",zW="#ifdef LOG_DEPTH\n// 1.0 at the near plane, increasing linearly from there.\nvarying float v_depthFromNearPlusOne;\n#ifdef SHADOW_MAP\nvarying vec3 v_logPositionEC;\n#endif\n#endif\n\nvec4 czm_updatePositionDepth(vec4 coords) {\n#if defined(LOG_DEPTH)\n\n#ifdef SHADOW_MAP\n    vec3 logPositionEC = (czm_inverseProjection * coords).xyz;\n    v_logPositionEC = logPositionEC;\n#endif\n\n    // With the very high far/near ratios used with the logarithmic depth\n    // buffer, floating point rounding errors can cause linear depth values\n    // to end up on the wrong side of the far plane, even for vertices that\n    // are really nowhere near it. Since we always write a correct logarithmic\n    // depth value in the fragment shader anyway, we just need to make sure\n    // such errors don't cause the primitive to be clipped entirely before\n    // we even get to the fragment shader.\n    coords.z = clamp(coords.z / coords.w, -1.0, 1.0) * coords.w;\n#endif\n\n    return coords;\n}\n\n/**\n * Writes the logarithmic depth to gl_Position using the already computed gl_Position.\n *\n * @name czm_vertexLogDepth\n * @glslFunction\n */\nvoid czm_vertexLogDepth()\n{\n#ifdef LOG_DEPTH\n    v_depthFromNearPlusOne = (gl_Position.w - czm_currentFrustum.x) + 1.0;\n    gl_Position = czm_updatePositionDepth(gl_Position);\n#endif\n}\n\n/**\n * Writes the logarithmic depth to gl_Position using the provided clip coordinates.\n * <p>\n * An example use case for this function would be moving the vertex in window coordinates\n * before converting back to clip coordinates. Use the original vertex clip coordinates.\n * </p>\n * @name czm_vertexLogDepth\n * @glslFunction\n *\n * @param {vec4} clipCoords The vertex in clip coordinates.\n *\n * @example\n * czm_vertexLogDepth(czm_projection * vec4(positionEyeCoordinates, 1.0));\n */\nvoid czm_vertexLogDepth(vec4 clipCoords)\n{\n#ifdef LOG_DEPTH\n    v_depthFromNearPlusOne = (clipCoords.w - czm_currentFrustum.x) + 1.0;\n    czm_updatePositionDepth(clipCoords);\n#endif\n}\n",kW="/**\n * Transforms a position from window to eye coordinates.\n * The transform from window to normalized device coordinates is done using components\n * of (@link czm_viewport} and {@link czm_viewportTransformation} instead of calculating\n * the inverse of <code>czm_viewportTransformation</code>. The transformation from\n * normalized device coordinates to clip coordinates is done using <code>fragmentCoordinate.w</code>,\n * which is expected to be the scalar used in the perspective divide. The transformation\n * from clip to eye coordinates is done using {@link czm_inverseProjection}.\n *\n * @name czm_windowToEyeCoordinates\n * @glslFunction\n *\n * @param {vec4} fragmentCoordinate The position in window coordinates to transform.\n *\n * @returns {vec4} The transformed position in eye coordinates.\n *\n * @see czm_modelToWindowCoordinates\n * @see czm_eyeToWindowCoordinates\n * @see czm_inverseProjection\n * @see czm_viewport\n * @see czm_viewportTransformation\n *\n * @example\n * vec4 positionEC = czm_windowToEyeCoordinates(gl_FragCoord);\n */\nvec4 czm_windowToEyeCoordinates(vec4 fragmentCoordinate)\n{\n    // Reconstruct NDC coordinates\n    float x = 2.0 * (fragmentCoordinate.x - czm_viewport.x) / czm_viewport.z - 1.0;\n    float y = 2.0 * (fragmentCoordinate.y - czm_viewport.y) / czm_viewport.w - 1.0;\n    float z = (fragmentCoordinate.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\n    vec4 q = vec4(x, y, z, 1.0);\n\n    // Reverse the perspective division to obtain clip coordinates.\n    q /= fragmentCoordinate.w;\n\n    // Reverse the projection transformation to obtain eye coordinates.\n    if (!(czm_inverseProjection == mat4(0.0))) // IE and Edge sometimes do something weird with != between mat4s\n    {\n        q = czm_inverseProjection * q;\n    }\n    else\n    {\n        float top = czm_frustumPlanes.x;\n        float bottom = czm_frustumPlanes.y;\n        float left = czm_frustumPlanes.z;\n        float right = czm_frustumPlanes.w;\n\n        float near = czm_currentFrustum.x;\n        float far = czm_currentFrustum.y;\n\n        q.x = (q.x * (right - left) + left + right) * 0.5;\n        q.y = (q.y * (top - bottom) + bottom + top) * 0.5;\n        q.z = (q.z * (near - far) - near - far) * 0.5;\n        q.w = 1.0;\n    }\n\n    return q;\n}\n\n/**\n * Transforms a position given as window x/y and a depth or a log depth from window to eye coordinates.\n * This function produces more accurate results for window positions with log depth than\n * conventionally unpacking the log depth using czm_reverseLogDepth and using the standard version\n * of czm_windowToEyeCoordinates.\n *\n * @name czm_windowToEyeCoordinates\n * @glslFunction\n *\n * @param {vec2} fragmentCoordinateXY The XY position in window coordinates to transform.\n * @param {float} depthOrLogDepth A depth or log depth for the fragment.\n *\n * @see czm_modelToWindowCoordinates\n * @see czm_eyeToWindowCoordinates\n * @see czm_inverseProjection\n * @see czm_viewport\n * @see czm_viewportTransformation\n *\n * @returns {vec4} The transformed position in eye coordinates.\n */\nvec4 czm_windowToEyeCoordinates(vec2 fragmentCoordinateXY, float depthOrLogDepth)\n{\n    // See reverseLogDepth.glsl. This is separate to re-use the pow.\n#ifdef LOG_DEPTH\n    float near = czm_currentFrustum.x;\n    float far = czm_currentFrustum.y;\n    float log2Depth = depthOrLogDepth * czm_log2FarDepthFromNearPlusOne;\n    float depthFromNear = pow(2.0, log2Depth) - 1.0;\n    float depthFromCamera = depthFromNear + near;\n    vec4 windowCoord = vec4(fragmentCoordinateXY, far * (1.0 - near / depthFromCamera) / (far - near), 1.0);\n    vec4 eyeCoordinate = czm_windowToEyeCoordinates(windowCoord);\n    eyeCoordinate.w = 1.0 / depthFromCamera; // Better precision\n    return eyeCoordinate;\n#else\n    vec4 windowCoord = vec4(fragmentCoordinateXY, depthOrLogDepth, 1.0);\n    vec4 eyeCoordinate = czm_windowToEyeCoordinates(windowCoord);\n#endif\n    return eyeCoordinate;\n}\n",UW="// emulated noperspective\n#if defined(GL_EXT_frag_depth) && !defined(LOG_DEPTH)\nvarying float v_WindowZ;\n#endif\n\n/**\n * Emulates GL_DEPTH_CLAMP. Clamps a fragment to the near and far plane\n * by writing the fragment's depth. See czm_depthClamp for more details.\n * <p>\n * The shader must enable the GL_EXT_frag_depth extension.\n * </p>\n *\n * @name czm_writeDepthClamp\n * @glslFunction\n *\n * @example\n * gl_FragColor = color;\n * czm_writeDepthClamp();\n *\n * @see czm_depthClamp\n */\nvoid czm_writeDepthClamp()\n{\n#if defined(GL_EXT_frag_depth) && !defined(LOG_DEPTH)\n    gl_FragDepthEXT = clamp(v_WindowZ * gl_FragCoord.w, 0.0, 1.0);\n#endif\n}\n",VW="#ifdef LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n\n#ifdef POLYGON_OFFSET\nuniform vec2 u_polygonOffset;\n#endif\n\n#endif\n\n/**\n * Writes the fragment depth to the logarithmic depth buffer.\n * <p>\n * Use this when the vertex shader does not call {@link czm_vertexlogDepth}, for example, when\n * ray-casting geometry using a full screen quad.\n * </p>\n * @name czm_writeLogDepth\n * @glslFunction\n *\n * @param {float} depth The depth coordinate, where 1.0 is on the near plane and\n *                      depth increases in eye-space units from there\n *\n * @example\n * czm_writeLogDepth((czm_projection * v_positionEyeCoordinates).w + 1.0);\n */\nvoid czm_writeLogDepth(float depth)\n{\n#if defined(GL_EXT_frag_depth) && defined(LOG_DEPTH)\n    // Discard the vertex if it's not between the near and far planes.\n    // We allow a bit of epsilon on the near plane comparison because a 1.0\n    // from the vertex shader (indicating the vertex should be _on_ the near\n    // plane) will not necessarily come here as exactly 1.0.\n    if (depth <= 0.9999999 || depth > czm_farDepthFromNearPlusOne) {\n        discard;\n    }\n\n#ifdef POLYGON_OFFSET\n    // Polygon offset: m * factor + r * units\n    float factor = u_polygonOffset[0];\n    float units = u_polygonOffset[1];\n\n    // If we can't compute derivatives, just leave out the factor I guess?\n#ifdef GL_OES_standard_derivatives\n    // m = sqrt(dZdX^2 + dZdY^2);\n    float x = dFdx(depth);\n    float y = dFdy(depth);\n    float m = sqrt(x * x + y * y);\n\n    // Apply the factor before computing the log depth.\n    depth += m * factor;\n#endif\n\n#endif\n\n    gl_FragDepthEXT = log2(depth) * czm_oneOverLog2FarDepthFromNearPlusOne;\n\n#ifdef POLYGON_OFFSET\n    // Apply the units after the log depth.\n    gl_FragDepthEXT += czm_epsilon7 * units;\n#endif\n\n#endif\n}\n\n/**\n * Writes the fragment depth to the logarithmic depth buffer.\n * <p>\n * Use this when the vertex shader calls {@link czm_vertexlogDepth}.\n * </p>\n *\n * @name czm_writeLogDepth\n * @glslFunction\n */\nvoid czm_writeLogDepth() {\n#ifdef LOG_DEPTH\n    czm_writeLogDepth(v_depthFromNearPlusOne);\n#endif\n}\n",HW="/**\n * Transforms a value for non-perspective interpolation by multiplying\n * it by w, the value used in the perspective divide. This function is\n * intended to be called in a vertex shader to compute the value of a\n * `varying` that should not be subject to perspective interpolation.\n * For example, screen-space texture coordinates. The fragment shader\n * must call {@link czm_readNonPerspective} to retrieve the final\n * non-perspective value.\n *\n * @name czm_writeNonPerspective\n * @glslFunction\n *\n * @param {float|vec2|vec3|vec4} value The value to be interpolated without accounting for perspective.\n * @param {float} w The perspective divide value. Usually this is the computed `gl_Position.w`.\n * @returns {float|vec2|vec3|vec4} The transformed value, intended to be stored in a `varying` and read in the\n *          fragment shader with {@link czm_readNonPerspective}.\n */\nfloat czm_writeNonPerspective(float value, float w) {\n    return value * w;\n}\n\nvec2 czm_writeNonPerspective(vec2 value, float w) {\n    return value * w;\n}\n\nvec3 czm_writeNonPerspective(vec3 value, float w) {\n    return value * w;\n}\n\nvec4 czm_writeNonPerspective(vec4 value, float w) {\n    return value * w;\n}\n",GW={czm_degreesPerRadian:TH,czm_depthRange:CH,czm_epsilon1:EH,czm_epsilon2:xH,czm_epsilon3:SH,czm_epsilon4:IH,czm_epsilon5:OH,czm_epsilon6:DH,czm_epsilon7:PH,czm_infinity:RH,czm_oneOverPi:LH,czm_oneOverTwoPi:MH,czm_passCesium3DTile:BH,czm_passCesium3DTileClassification:NH,czm_passCesium3DTileClassificationIgnoreShow:FH,czm_passClassification:zH,czm_passCompute:kH,czm_passEnvironment:UH,czm_passGlobe:VH,czm_passOpaque:HH,czm_passOverlay:GH,czm_passTerrainClassification:WH,czm_passTranslucent:qH,czm_pi:jH,czm_piOverFour:YH,czm_piOverSix:KH,czm_piOverThree:XH,czm_piOverTwo:QH,czm_radiansPerDegree:JH,czm_sceneMode2D:ZH,czm_sceneMode3D:$H,czm_sceneModeColumbusView:eG,czm_sceneModeMorphing:tG,czm_solarRadius:nG,czm_threePiOver2:iG,czm_twoPi:oG,czm_webMercatorMaxLatitude:rG,czm_depthRangeStruct:sG,czm_material:aG,czm_materialInput:cG,czm_modelMaterial:lG,czm_modelVertexOutput:uG,czm_pbrParameters:hG,czm_ray:dG,czm_raySegment:fG,czm_shadowParameters:pG,czm_HSBToRGB:mG,czm_HSLToRGB:_G,czm_RGBToHSB:gG,czm_RGBToHSL:yG,czm_RGBToXYZ:vG,czm_XYZToRGB:bG,czm_acesTonemapping:AG,czm_alphaWeight:wG,czm_antialias:TG,czm_approximateSphericalCoordinates:CG,czm_backFacing:EG,czm_branchFreeTernary:xG,czm_cascadeColor:SG,czm_cascadeDistance:IG,czm_cascadeMatrix:OG,czm_cascadeWeights:DG,czm_columbusViewMorph:PG,czm_computePosition:RG,czm_cosineAndSine:LG,czm_decompressTextureCoordinates:MG,czm_defaultPbrMaterial:BG,czm_depthClamp:NG,czm_eastNorthUpToEyeCoordinates:FG,czm_ellipsoidContainsPoint:zG,czm_ellipsoidWgs84TextureCoordinates:kG,czm_equalsEpsilon:UG,czm_eyeOffset:VG,czm_eyeToWindowCoordinates:HG,czm_fastApproximateAtan:GG,czm_fog:WG,czm_gammaCorrect:qG,czm_geodeticSurfaceNormal:jG,czm_getDefaultMaterial:YG,czm_getLambertDiffuse:KG,czm_getSpecular:XG,czm_getWaterNoise:QG,czm_hue:JG,czm_inverseGamma:ZG,czm_isEmpty:$G,czm_isFull:eW,czm_latitudeToWebMercatorFraction:tW,czm_lineDistance:nW,czm_linearToSrgb:iW,czm_luminance:oW,czm_metersPerPixel:rW,czm_modelToWindowCoordinates:sW,czm_multiplyWithColorBalance:aW,czm_nearFarScalar:cW,czm_octDecode:lW,czm_packDepth:uW,czm_pbrLighting:hW,czm_pbrMetallicRoughnessMaterial:dW,czm_pbrSpecularGlossinessMaterial:fW,czm_phong:pW,czm_planeDistance:mW,czm_pointAlongRay:_W,czm_rayEllipsoidIntersectionInterval:gW,czm_readDepth:yW,czm_readNonPerspective:vW,czm_reverseLogDepth:bW,czm_round:AW,czm_sampleOctahedralProjection:wW,czm_saturation:TW,czm_shadowDepthCompare:CW,czm_shadowVisibility:EW,czm_signNotZero:xW,czm_sphericalHarmonics:SW,czm_srgbToLinear:IW,czm_tangentToEyeSpaceMatrix:OW,czm_transformPlane:DW,czm_translateRelativeToEye:PW,czm_translucentPhong:RW,czm_transpose:LW,czm_unpackDepth:MW,czm_unpackFloat:BW,czm_unpackUint:NW,czm_valueTransform:FW,czm_vertexLogDepth:zW,czm_windowToEyeCoordinates:kW,czm_writeDepthClamp:UW,czm_writeLogDepth:VW,czm_writeNonPerspective:HW};function WW(e){return e=e.replace(/\/\/.*/g,""),e.replace(/\/\*\*[\s\S]*?\*\//gm,(function(e){const t=e.match(/\n/gm).length;let n="";for(let i=0;i<t;++i)n+="\n";return n}))}function qW(e,t,n){let i;for(let o=0;o<n.length;++o)n[o].name===e&&(i=n[o]);return C(i)||(t=WW(t),i={name:e,glslSource:t,dependsOn:[],requiredBy:[],evaluated:!1},n.push(i)),i}function jW(e,t){if(e.evaluated)return;e.evaluated=!0;let n=e.glslSource.match(/\bczm_[a-zA-Z0-9_]*/g);C(n)&&null!==n&&(n=n.filter((function(e,t){return n.indexOf(e)===t})),n.forEach((function(n){if(n!==e.name&&QW._czmBuiltinsAndUniforms.hasOwnProperty(n)){const i=qW(n,QW._czmBuiltinsAndUniforms[n],t);e.dependsOn.push(i),i.requiredBy.push(e),jW(i,t)}})))}function YW(e){const t=[],n=[];while(e.length>0){const i=e.pop();n.push(i),0===i.requiredBy.length&&t.push(i)}while(t.length>0){const n=t.shift();e.push(n);for(let e=0;e<n.dependsOn.length;++e){const i=n.dependsOn[e],o=i.requiredBy.indexOf(n);i.requiredBy.splice(o,1),0===i.requiredBy.length&&t.push(i)}}const i=[];for(let o=0;o<n.length;++o)0!==n[o].requiredBy.length&&i.push(n[o]);if(0!==i.length){let e="A circular dependency was found in the following built-in functions/structs/constants: \n";for(let t=0;t<i.length;++t)e=`${e+i[t].name}\n`;throw new x(e)}}function KW(e){const t=[],n=qW("main",e,t);jW(n,t),YW(t);let i="";for(let o=t.length-1;o>=0;--o)i=`${i+t[o].glslSource}\n`;return i.replace(n.glslSource,"")}function XW(e,t,n){let i,o,r="";const s=e.sources;if(C(s))for(i=0,o=s.length;i<o;++i)r+=`\n#line 0\n${s[i]}`;let a;r=WW(r),r=r.replace(/#version\s+(.*?)\n/gm,(function(e,t){if(C(a)&&a!==t)throw new x(`inconsistent versions found: ${a} and ${t}`);return a=t,"\n"}));const c=[];r=r.replace(/#extension.*\n/gm,(function(e){return c.push(e),"\n"})),r=r.replace(/precision\s(lowp|mediump|highp)\s(float|int);/,"");const l=e.pickColorQualifier;C(l)&&(r=QW.createPickFragmentShaderSource(r,l));let u="";C(a)&&(u=`#version ${a}\n`);const h=c.length;for(i=0;i<h;i++)u+=c[i];t&&(u+="#ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    precision highp int;\n#else\n    precision mediump float;\n    precision mediump int;\n    #define highp mediump\n#endif\n\n");const d=e.defines;if(C(d))for(i=0,o=d.length;i<o;++i){const e=d[i];0!==e.length&&(u+=`#define ${e}\n`)}return n.webgl2&&(u+="#define OUTPUT_DECLARATION\n\n"),n.textureFloatLinear&&(u+="#define OES_texture_float_linear\n\n"),n.floatingPointTexture&&(u+="#define OES_texture_float\n\n"),e.includeBuiltIns&&(u+=KW(r)),u+="\n#line 0\n",u+=r,n.webgl2&&(u=wH(u,t,!0)),u}function QW(e){e=R(e,R.EMPTY_OBJECT);const t=e.pickColorQualifier;if(C(t)&&"uniform"!==t&&"varying"!==t)throw new x("options.pickColorQualifier must be 'uniform' or 'varying'.");this.defines=C(e.defines)?e.defines.slice(0):[],this.sources=C(e.sources)?e.sources.slice(0):[],this.pickColorQualifier=t,this.includeBuiltIns=R(e.includeBuiltIns,!0)}QW.prototype.clone=function(){return new QW({sources:this.sources,defines:this.defines,pickColorQualifier:this.pickColorQualifier,includeBuiltIns:this.includeBuiltIns})},QW.replaceMain=function(e,t){return t=`void ${t}()`,e.replace(/void\s+main\s*\(\s*(?:void)?\s*\)/g,t)},QW.prototype.createCombinedVertexShader=function(e){return XW(this,!1,e)},QW.prototype.createCombinedFragmentShader=function(e){return XW(this,!0,e)},QW._czmBuiltinsAndUniforms={};for(const ko in GW)GW.hasOwnProperty(ko)&&(QW._czmBuiltinsAndUniforms[ko]=GW[ko]);for(const ko in TV)if(TV.hasOwnProperty(ko)){const e=TV[ko];"function"===typeof e.getDeclaration&&(QW._czmBuiltinsAndUniforms[ko]=e.getDeclaration(ko))}function JW(e,t){const n=e.sources,i=n.length;for(let o=0;o<i;++o)if(-1!==n[o].indexOf(t))return!0;return!1}function ZW(e,t){const n=t.length;for(let i=0;i<n;++i){const n=t[i];if(JW(e,n))return n}}QW.createPickVertexShaderSource=function(e){const t=QW.replaceMain(e,"czm_old_main"),n="attribute vec4 pickColor; \nvarying vec4 czm_pickColor; \nvoid main() \n{ \n    czm_old_main(); \n    czm_pickColor = pickColor; \n}";return`${t}\n${n}`},QW.createPickFragmentShaderSource=function(e,t){const n=QW.replaceMain(e,"czm_old_main"),i=`${t} vec4 czm_pickColor; \nvoid main() \n{ \n    czm_old_main(); \n    if (gl_FragColor.a == 0.0) { \n       discard; \n    } \n    gl_FragColor = czm_pickColor; \n}`;return`${n}\n${i}`};const $W=["v_normalEC","v_normal"];QW.findNormalVarying=function(e){return JW(e,"#ifdef HAS_NORMALS")?JW(e,"#define HAS_NORMALS")?"v_normalEC":void 0:ZW(e,$W)};const eq=["v_positionEC"];QW.findPositionVarying=function(e){return ZW(e,eq)};var tq=QW,nq='attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute float batchId;\n\n#ifdef EXTRUDED_GEOMETRY\nattribute vec3 extrudeDirection;\n\nuniform float u_globeMinimumAltitude;\n#endif // EXTRUDED_GEOMETRY\n\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#endif // PER_INSTANCE_COLOR\n\n#ifdef TEXTURE_COORDINATES\n#ifdef SPHERICAL\nvarying vec4 v_sphericalExtents;\n#else // SPHERICAL\nvarying vec2 v_inversePlaneExtents;\nvarying vec4 v_westPlane;\nvarying vec4 v_southPlane;\n#endif // SPHERICAL\nvarying vec3 v_uvMinAndSphericalLongitudeRotation;\nvarying vec3 v_uMaxAndInverseDistance;\nvarying vec3 v_vMaxAndInverseDistance;\n#endif // TEXTURE_COORDINATES\n\nvoid main()\n{\n    vec4 position = czm_computePosition();\n\n#ifdef EXTRUDED_GEOMETRY\n    float delta = min(u_globeMinimumAltitude, czm_geometricToleranceOverMeter * length(position.xyz));\n    delta *= czm_sceneMode == czm_sceneMode3D ? 1.0 : 0.0;\n\n    //extrudeDirection is zero for the top layer\n    position = position + vec4(extrudeDirection * delta, 0.0);\n#endif\n\n#ifdef TEXTURE_COORDINATES\n#ifdef SPHERICAL\n    v_sphericalExtents = czm_batchTable_sphericalExtents(batchId);\n    v_uvMinAndSphericalLongitudeRotation.z = czm_batchTable_longitudeRotation(batchId);\n#else // SPHERICAL\n#ifdef COLUMBUS_VIEW_2D\n    vec4 planes2D_high = czm_batchTable_planes2D_HIGH(batchId);\n    vec4 planes2D_low = czm_batchTable_planes2D_LOW(batchId);\n\n    // If the primitive is split across the IDL (planes2D_high.x > planes2D_high.w):\n    // - If this vertex is on the east side of the IDL (position3DLow.y > 0.0, comparison with position3DHigh may produce artifacts)\n    // - existing "east" is on the wrong side of the world, far away (planes2D_high/low.w)\n    // - so set "east" as beyond the eastmost extent of the projection (idlSplitNewPlaneHiLow)\n    vec2 idlSplitNewPlaneHiLow = vec2(EAST_MOST_X_HIGH - (WEST_MOST_X_HIGH - planes2D_high.w), EAST_MOST_X_LOW - (WEST_MOST_X_LOW - planes2D_low.w));\n    bool idlSplit = planes2D_high.x > planes2D_high.w && position3DLow.y > 0.0;\n    planes2D_high.w = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.x, planes2D_high.w);\n    planes2D_low.w = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.y, planes2D_low.w);\n\n    // - else, if this vertex is on the west side of the IDL (position3DLow.y < 0.0)\n    // - existing "west" is on the wrong side of the world, far away (planes2D_high/low.x)\n    // - so set "west" as beyond the westmost extent of the projection (idlSplitNewPlaneHiLow)\n    idlSplit = planes2D_high.x > planes2D_high.w && position3DLow.y < 0.0;\n    idlSplitNewPlaneHiLow = vec2(WEST_MOST_X_HIGH - (EAST_MOST_X_HIGH - planes2D_high.x), WEST_MOST_X_LOW - (EAST_MOST_X_LOW - planes2D_low.x));\n    planes2D_high.x = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.x, planes2D_high.x);\n    planes2D_low.x = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.y, planes2D_low.x);\n\n    vec3 southWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.xy), vec3(0.0, planes2D_low.xy))).xyz;\n    vec3 northWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.x, planes2D_high.z), vec3(0.0, planes2D_low.x, planes2D_low.z))).xyz;\n    vec3 southEastCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.w, planes2D_high.y), vec3(0.0, planes2D_low.w, planes2D_low.y))).xyz;\n#else // COLUMBUS_VIEW_2D\n    // 3D case has smaller "plane extents," so planes encoded as a 64 bit position and 2 vec3s for distances/direction\n    vec3 southWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(czm_batchTable_southWest_HIGH(batchId), czm_batchTable_southWest_LOW(batchId))).xyz;\n    vec3 northWestCorner = czm_normal * czm_batchTable_northward(batchId) + southWestCorner;\n    vec3 southEastCorner = czm_normal * czm_batchTable_eastward(batchId) + southWestCorner;\n#endif // COLUMBUS_VIEW_2D\n\n    vec3 eastWard = southEastCorner - southWestCorner;\n    float eastExtent = length(eastWard);\n    eastWard /= eastExtent;\n\n    vec3 northWard = northWestCorner - southWestCorner;\n    float northExtent = length(northWard);\n    northWard /= northExtent;\n\n    v_westPlane = vec4(eastWard, -dot(eastWard, southWestCorner));\n    v_southPlane = vec4(northWard, -dot(northWard, southWestCorner));\n    v_inversePlaneExtents = vec2(1.0 / eastExtent, 1.0 / northExtent);\n#endif // SPHERICAL\n    vec4 uvMinAndExtents = czm_batchTable_uvMinAndExtents(batchId);\n    vec4 uMaxVmax = czm_batchTable_uMaxVmax(batchId);\n\n    v_uMaxAndInverseDistance = vec3(uMaxVmax.xy, uvMinAndExtents.z);\n    v_vMaxAndInverseDistance = vec3(uMaxVmax.zw, uvMinAndExtents.w);\n    v_uvMinAndSphericalLongitudeRotation.xy = uvMinAndExtents.xy;\n#endif // TEXTURE_COORDINATES\n\n#ifdef PER_INSTANCE_COLOR\n    v_color = czm_batchTable_color(batchId);\n#endif\n\n    gl_Position = czm_depthClamp(czm_modelViewProjectionRelativeToEye * position);\n}\n',iq="#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\n\nvoid main(void)\n{\n#ifdef VECTOR_TILE\n    gl_FragColor = czm_gammaCorrect(u_highlightColor);\n#else\n    gl_FragColor = vec4(1.0);\n#endif\n    czm_writeDepthClamp();\n}\n";const oq={TERRAIN:0,CESIUM_3D_TILE:1,BOTH:2,NUMBER_OF_CLASSIFICATION_TYPES:3};var rq=Object.freeze(oq);const sq={NEVER:th.NEVER,LESS:th.LESS,EQUAL:th.EQUAL,LESS_OR_EQUAL:th.LEQUAL,GREATER:th.GREATER,NOT_EQUAL:th.NOTEQUAL,GREATER_OR_EQUAL:th.GEQUAL,ALWAYS:th.ALWAYS};var aq=Object.freeze(sq);const cq={STREAM_DRAW:th.STREAM_DRAW,STATIC_DRAW:th.STATIC_DRAW,DYNAMIC_DRAW:th.DYNAMIC_DRAW,validate:function(e){return e===cq.STREAM_DRAW||e===cq.STATIC_DRAW||e===cq.DYNAMIC_DRAW}};var lq=Object.freeze(cq);function uq(e){if(e=R(e,R.EMPTY_OBJECT),D.defined("options.context",e.context),!C(e.typedArray)&&!C(e.sizeInBytes))throw new x("Either options.sizeInBytes or options.typedArray is required.");if(C(e.typedArray)&&C(e.sizeInBytes))throw new x("Cannot pass in both options.sizeInBytes and options.typedArray.");if(C(e.typedArray)&&(D.typeOf.object("options.typedArray",e.typedArray),D.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),!lq.validate(e.usage))throw new x("usage is invalid.");const t=e.context._gl,n=e.bufferTarget,i=e.typedArray;let o=e.sizeInBytes;const r=e.usage,s=C(i);s&&(o=i.byteLength),D.typeOf.number.greaterThan("sizeInBytes",o,0);const a=t.createBuffer();t.bindBuffer(n,a),t.bufferData(n,s?i:o,r),t.bindBuffer(n,null),this._gl=t,this._webgl2=e.context._webgl2,this._bufferTarget=n,this._sizeInBytes=o,this._usage=r,this._buffer=a,this.vertexArrayDestroyable=!0}uq.createVertexBuffer=function(e){return D.defined("options.context",e.context),new uq({context:e.context,bufferTarget:th.ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage})},uq.createIndexBuffer=function(e){if(D.defined("options.context",e.context),!fd.validate(e.indexDatatype))throw new x("Invalid indexDatatype.");if(e.indexDatatype===fd.UNSIGNED_INT&&!e.context.elementIndexUint)throw new x("IndexDatatype.UNSIGNED_INT requires OES_element_index_uint, which is not supported on this system.  Check context.elementIndexUint.");const t=e.context,n=e.indexDatatype,i=fd.getSizeInBytes(n),o=new uq({context:t,bufferTarget:th.ELEMENT_ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage}),r=o.sizeInBytes/i;return Object.defineProperties(o,{indexDatatype:{get:function(){return n}},bytesPerIndex:{get:function(){return i}},numberOfIndices:{get:function(){return r}}}),o},Object.defineProperties(uq.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}}),uq.prototype._getBuffer=function(){return this._buffer},uq.prototype.copyFromArrayView=function(e,t){t=R(t,0),D.defined("arrayView",e),D.typeOf.number.lessThanOrEquals("offsetInBytes + arrayView.byteLength",t+e.byteLength,this._sizeInBytes);const n=this._gl,i=this._bufferTarget;n.bindBuffer(i,this._buffer),n.bufferSubData(i,t,e),n.bindBuffer(i,null)},uq.prototype.copyFromBuffer=function(e,t,n,i){if(!this._webgl2)throw new x("A WebGL 2 context is required.");if(!C(e))throw new x("readBuffer must be defined.");if(!C(i)||i<=0)throw new x("sizeInBytes must be defined and be greater than zero.");if(!C(t)||t<0||t+i>e._sizeInBytes)throw new x("readOffset must be greater than or equal to zero and readOffset + sizeInBytes must be less than of equal to readBuffer.sizeInBytes.");if(!C(n)||n<0||n+i>this._sizeInBytes)throw new x("writeOffset must be greater than or equal to zero and writeOffset + sizeInBytes must be less than of equal to this.sizeInBytes.");if(this._buffer===e._buffer&&(n>=t&&n<t+i||t>n&&t<n+i))throw new x("When readBuffer is equal to this, the ranges [readOffset + sizeInBytes) and [writeOffset, writeOffset + sizeInBytes) must not overlap.");if(this._bufferTarget===th.ELEMENT_ARRAY_BUFFER&&e._bufferTarget!==th.ELEMENT_ARRAY_BUFFER||this._bufferTarget!==th.ELEMENT_ARRAY_BUFFER&&e._bufferTarget===th.ELEMENT_ARRAY_BUFFER)throw new x("Can not copy an index buffer into another buffer type.");const o=th.COPY_READ_BUFFER,r=th.COPY_WRITE_BUFFER,s=this._gl;s.bindBuffer(r,this._buffer),s.bindBuffer(o,e._buffer),s.copyBufferSubData(o,r,t,n,i),s.bindBuffer(r,null),s.bindBuffer(o,null)},uq.prototype.getBufferData=function(e,t,n,i){if(t=R(t,0),n=R(n,0),!this._webgl2)throw new x("A WebGL 2 context is required.");if(!C(e))throw new x("arrayView is required.");let o,r,s=e.byteLength;if(C(i)?(o=i,C(s)?r=1:(s=e.length,r=e.BYTES_PER_ELEMENT)):C(s)?(o=s-n,r=1):(s=e.length,o=s-n,r=e.BYTES_PER_ELEMENT),n<0||n>s)throw new x("destinationOffset must be greater than zero and less than the arrayView length.");if(n+o>s)throw new x("destinationOffset + length must be less than or equal to the arrayViewLength.");if(t<0||t>this._sizeInBytes)throw new x("sourceOffset must be greater than zero and less than the buffers size.");if(t+o*r>this._sizeInBytes)throw new x("sourceOffset + length must be less than the buffers size.");const a=this._gl,c=th.COPY_READ_BUFFER;a.bindBuffer(c,this._buffer),a.getBufferSubData(c,t,e,n,i),a.bindBuffer(c,null)},uq.prototype.isDestroyed=function(){return!1},uq.prototype.destroy=function(){return this._gl.deleteBuffer(this._buffer),Qh(this)};var hq=uq;function dq(e,t,n,i){const o=C(t.vertexBuffer),r=C(t.value),s=t.value?t.value.length:t.componentsPerAttribute;if(!o&&!r)throw new x("attribute must have a vertexBuffer or a value.");if(o&&r)throw new x("attribute cannot have both a vertexBuffer and a value.  It must have either a vertexBuffer property defining per-vertex data or a value property defining data for all vertices.");if(1!==s&&2!==s&&3!==s&&4!==s){if(r)throw new x("attribute.value.length must be in the range [1, 4].");throw new x("attribute.componentsPerAttribute must be in the range [1, 4].")}if(C(t.componentDatatype)&&!ih.validate(t.componentDatatype))throw new x("attribute must have a valid componentDatatype or not specify it.");if(C(t.strideInBytes)&&t.strideInBytes>255)throw new x("attribute must have a strideInBytes less than or equal to 255 or not specify it.");if(C(t.instanceDivisor)&&t.instanceDivisor>0&&!i.instancedArrays)throw new x("instanced arrays is not supported");if(C(t.instanceDivisor)&&t.instanceDivisor<0)throw new x("attribute must have an instanceDivisor greater than or equal to zero");if(C(t.instanceDivisor)&&r)throw new x("attribute cannot have have an instanceDivisor if it is not backed by a buffer");if(C(t.instanceDivisor)&&t.instanceDivisor>0&&0===t.index)throw new x("attribute zero cannot have an instanceDivisor greater than 0");const a={index:R(t.index,n),enabled:R(t.enabled,!0),vertexBuffer:t.vertexBuffer,value:r?t.value.slice(0):void 0,componentsPerAttribute:s,componentDatatype:R(t.componentDatatype,ih.FLOAT),normalize:R(t.normalize,!1),offsetInBytes:R(t.offsetInBytes,0),strideInBytes:R(t.strideInBytes,0),instanceDivisor:R(t.instanceDivisor,0)};if(o)a.vertexAttrib=function(e){const t=this.index;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer._getBuffer()),e.vertexAttribPointer(t,this.componentsPerAttribute,this.componentDatatype,this.normalize,this.strideInBytes,this.offsetInBytes),e.enableVertexAttribArray(t),this.instanceDivisor>0&&(i.glVertexAttribDivisor(t,this.instanceDivisor),i._vertexAttribDivisors[t]=this.instanceDivisor,i._previousDrawInstanced=!0)},a.disableVertexAttribArray=function(e){e.disableVertexAttribArray(this.index),this.instanceDivisor>0&&i.glVertexAttribDivisor(n,0)};else{switch(a.componentsPerAttribute){case 1:a.vertexAttrib=function(e){e.vertexAttrib1fv(this.index,this.value)};break;case 2:a.vertexAttrib=function(e){e.vertexAttrib2fv(this.index,this.value)};break;case 3:a.vertexAttrib=function(e){e.vertexAttrib3fv(this.index,this.value)};break;case 4:a.vertexAttrib=function(e){e.vertexAttrib4fv(this.index,this.value)};break}a.disableVertexAttribArray=function(e){}}e.push(a)}function fq(e,t,n){for(let i=0;i<t.length;++i){const n=t[i];n.enabled&&n.vertexAttrib(e)}C(n)&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n._getBuffer())}function pq(e){e=R(e,R.EMPTY_OBJECT),D.defined("options.context",e.context),D.defined("options.attributes",e.attributes);const t=e.context,n=t._gl,i=e.attributes,o=e.indexBuffer;let r;const s=[];let a=1,c=!1,l=!1,u=i.length;for(r=0;r<u;++r)dq(s,i[r],r,t);for(u=s.length,r=0;r<u;++r){const e=s[r];if(C(e.vertexBuffer)&&0===e.instanceDivisor){const t=e.strideInBytes||e.componentsPerAttribute*ih.getSizeInBytes(e.componentDatatype);a=e.vertexBuffer.sizeInBytes/t;break}}for(r=0;r<u;++r)s[r].instanceDivisor>0&&(c=!0),C(s[r].value)&&(l=!0);const h={};for(r=0;r<u;++r){const e=s[r].index;if(h[e])throw new x(`Index ${e} is used by more than one attribute.`);h[e]=!0}let d;t.vertexArrayObject&&(d=t.glCreateVertexArray(),t.glBindVertexArray(d),fq(n,s,o),t.glBindVertexArray(null)),this._numberOfVertices=a,this._hasInstancedAttributes=c,this._hasConstantAttributes=l,this._context=t,this._gl=n,this._vao=d,this._attributes=s,this._indexBuffer=o}function mq(e){return e.values.length/e.componentsPerAttribute}function _q(e){return ih.getSizeInBytes(e.componentDatatype)*e.componentsPerAttribute}function gq(e){let t,n,i;const o=[];for(n in e)e.hasOwnProperty(n)&&C(e[n])&&C(e[n].values)&&(o.push(n),e[n].componentDatatype===ih.DOUBLE&&(e[n].componentDatatype=ih.FLOAT,e[n].values=ih.createTypedArray(ih.FLOAT,e[n].values)));let r;const s=o.length;if(s>0)for(r=mq(e[o[0]]),t=1;t<s;++t){const n=mq(e[o[t]]);if(n!==r)throw new Je(`Each attribute list must have the same number of vertices.  Attribute ${o[t]} has a different number of vertices (${n.toString()}) than attribute ${o[0]} (${r.toString()}).`)}o.sort((function(t,n){return ih.getSizeInBytes(e[n].componentDatatype)-ih.getSizeInBytes(e[t].componentDatatype)}));let a=0;const c={};for(t=0;t<s;++t)n=o[t],i=e[n],c[n]=a,a+=_q(i);if(a>0){const l=ih.getSizeInBytes(e[o[0]].componentDatatype),u=a%l;0!==u&&(a+=l-u);const h=r*a,d=new ArrayBuffer(h),f={};for(t=0;t<s;++t){n=o[t];const i=ih.getSizeInBytes(e[n].componentDatatype);f[n]={pointer:ih.createTypedArray(e[n].componentDatatype,d),index:c[n]/i,strideInComponentType:a/i}}for(t=0;t<r;++t)for(let r=0;r<s;++r){n=o[r],i=e[n];const s=i.values,a=f[n],c=a.pointer,l=i.componentsPerAttribute;for(let e=0;e<l;++e)c[a.index+e]=s[t*l+e];a.index+=a.strideInComponentType}return{buffer:d,offsetsInBytes:c,vertexSizeInBytes:a}}}function yq(e){const t=e._context,n=e._hasInstancedAttributes;if(!n&&!t._previousDrawInstanced)return;t._previousDrawInstanced=n;const i=t._vertexAttribDivisors,o=e._attributes,r=Ck.maximumVertexAttributes;let s;if(n){const e=o.length;for(s=0;s<e;++s){const e=o[s];if(e.enabled){const n=e.instanceDivisor,o=e.index;n!==i[o]&&(t.glVertexAttribDivisor(o,n),i[o]=n)}}}else for(s=0;s<r;++s)i[s]>0&&(t.glVertexAttribDivisor(s,0),i[s]=0)}function vq(e,t){const n=e._attributes,i=n.length;for(let o=0;o<i;++o){const e=n[o];e.enabled&&C(e.value)&&e.vertexAttrib(t)}}pq.fromGeometry=function(e){e=R(e,R.EMPTY_OBJECT),D.defined("options.context",e.context);const t=e.context,n=R(e.geometry,R.EMPTY_OBJECT),i=R(e.bufferUsage,lq.DYNAMIC_DRAW),o=R(e.attributeLocations,R.EMPTY_OBJECT),r=R(e.interleave,!1),s=e.vertexArrayAttributes;let a,c,l;const u=C(s)?s:[],h=n.attributes;if(r){const e=gq(h);if(C(e)){l=hq.createVertexBuffer({context:t,typedArray:e.buffer,usage:i});const n=e.offsetsInBytes,r=e.vertexSizeInBytes;for(a in h)h.hasOwnProperty(a)&&C(h[a])&&(c=h[a],C(c.values)?u.push({index:o[a],vertexBuffer:l,componentDatatype:c.componentDatatype,componentsPerAttribute:c.componentsPerAttribute,normalize:c.normalize,offsetInBytes:n[a],strideInBytes:r}):u.push({index:o[a],value:c.value,componentDatatype:c.componentDatatype,normalize:c.normalize}))}}else for(a in h)if(h.hasOwnProperty(a)&&C(h[a])){c=h[a];let e=c.componentDatatype;e===ih.DOUBLE&&(e=ih.FLOAT),l=void 0,C(c.values)&&(l=hq.createVertexBuffer({context:t,typedArray:ih.createTypedArray(e,c.values),usage:i})),u.push({index:o[a],vertexBuffer:l,value:c.value,componentDatatype:e,componentsPerAttribute:c.componentsPerAttribute,normalize:c.normalize})}let d;const f=n.indices;return C(f)&&(d=zf.computeNumberOfVertices(n)>=z.SIXTY_FOUR_KILOBYTES&&t.elementIndexUint?hq.createIndexBuffer({context:t,typedArray:new Uint32Array(f),usage:i,indexDatatype:fd.UNSIGNED_INT}):hq.createIndexBuffer({context:t,typedArray:new Uint16Array(f),usage:i,indexDatatype:fd.UNSIGNED_SHORT})),new pq({context:t,attributes:u,indexBuffer:d})},Object.defineProperties(pq.prototype,{numberOfAttributes:{get:function(){return this._attributes.length}},numberOfVertices:{get:function(){return this._numberOfVertices}},indexBuffer:{get:function(){return this._indexBuffer}}}),pq.prototype.getAttribute=function(e){return D.defined("index",e),this._attributes[e]},pq.prototype._bind=function(){C(this._vao)?(this._context.glBindVertexArray(this._vao),this._context.instancedArrays&&yq(this),this._hasConstantAttributes&&vq(this,this._gl)):fq(this._gl,this._attributes,this._indexBuffer)},pq.prototype._unBind=function(){if(C(this._vao))this._context.glBindVertexArray(null);else{const e=this._attributes,t=this._gl;for(let n=0;n<e.length;++n){const i=e[n];i.enabled&&i.disableVertexAttribArray(t)}this._indexBuffer&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}},pq.prototype.isDestroyed=function(){return!1},pq.prototype.destroy=function(){const e=this._attributes;for(let n=0;n<e.length;++n){const t=e[n].vertexBuffer;C(t)&&!t.isDestroyed()&&t.vertexArrayDestroyable&&t.destroy()}const t=this._indexBuffer;return C(t)&&!t.isDestroyed()&&t.vertexArrayDestroyable&&t.destroy(),C(this._vao)&&this._context.glDeleteVertexArray(this._vao),Qh(this)};var bq=pq;function Aq(e,t,n){if(!C(e))throw new x("context is required");if(!C(t))throw new x("attributes is required");if(!C(n))throw new x("numberOfInstances is required");if(this._attributes=t,this._numberOfInstances=n,0===t.length)return;const i=wq(t),o=e.floatingPointTexture,r=i===hD.FLOAT&&!o,s=Cq(t,r),a=Eq(s,t,r),c=Math.floor(Ck.maximumTextureSize/a),l=Math.min(n,c),u=a*l,h=Math.ceil(n/l),d=1/u,f=.5*d,p=1/h,m=.5*p;this._textureDimensions=new ro(u,h),this._textureStep=new Xe(d,f,p,m),this._pixelDatatype=r?hD.UNSIGNED_BYTE:i,this._packFloats=r,this._offsets=s,this._stride=a,this._texture=void 0;const _=4*u*h;this._batchValues=i!==hD.FLOAT||r?new Uint8Array(_):new Float32Array(_),this._batchValuesDirty=!1}function wq(e){let t=!1;const n=e.length;for(let i=0;i<n;++i)if(e[i].componentDatatype!==ih.UNSIGNED_BYTE){t=!0;break}return t?hD.FLOAT:hD.UNSIGNED_BYTE}function Tq(e,t){const n=e[t].componentsPerAttribute;return 2===n?ro:3===n?K:4===n?Xe:Number}function Cq(e,t){const n=new Array(e.length);let i=0;const o=e.length;for(let r=0;r<o;++r){const o=e[r],s=o.componentDatatype;n[r]=i,s!==ih.UNSIGNED_BYTE&&t?i+=4:++i}return n}function Eq(e,t,n){const i=e.length,o=e[i-1],r=t[i-1],s=r.componentDatatype;return s!==ih.UNSIGNED_BYTE&&n?o+4:o+1}Object.defineProperties(Aq.prototype,{attributes:{get:function(){return this._attributes}},numberOfInstances:{get:function(){return this._numberOfInstances}}});const xq=new Xe;function Sq(e,t,n){let i=Xe.unpack(e,t,xq);const o=Xe.unpackFloat(i);i=Xe.unpack(e,t+4,xq);const r=Xe.unpackFloat(i);i=Xe.unpack(e,t+8,xq);const s=Xe.unpackFloat(i);i=Xe.unpack(e,t+12,xq);const a=Xe.unpackFloat(i);return Xe.fromElements(o,r,s,a,n)}function Iq(e,t,n){let i=Xe.packFloat(e.x,xq);Xe.pack(i,t,n),i=Xe.packFloat(e.y,i),Xe.pack(i,t,n+4),i=Xe.packFloat(e.z,i),Xe.pack(i,t,n+8),i=Xe.packFloat(e.w,i),Xe.pack(i,t,n+12)}const Oq=new Xe;Aq.prototype.getBatchedAttribute=function(e,t,n){if(e<0||e>=this._numberOfInstances)throw new x("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new x("attributeIndex is out of range");const i=this._attributes,o=this._offsets[t],r=this._stride,s=4*r*e+4*o;let a;a=this._packFloats&&i[t].componentDatatype!==hD.UNSIGNED_BYTE?Sq(this._batchValues,s,Oq):Xe.unpack(this._batchValues,s,Oq);const c=Tq(i,t);return C(c.fromCartesian4)?c.fromCartesian4(a,n):C(c.clone)?c.clone(a,n):a.x};const Dq=[void 0,void 0,new ro,new K,new Xe],Pq=new Xe;function Rq(e,t){const n=e._textureDimensions;e._texture=new Uk({context:t,pixelFormat:fD.RGBA,pixelDatatype:e._pixelDatatype,width:n.x,height:n.y,sampler:Nk.NEAREST,flipY:!1})}function Lq(e){const t=e._textureDimensions;e._texture.copyFrom({source:{width:t.x,height:t.y,arrayBufferView:e._batchValues}})}function Mq(e){const t=e._stride;return 1===e._textureDimensions.y?`uniform vec4 batchTextureStep; \nvec2 computeSt(float batchId) \n{ \n    float stepX = batchTextureStep.x; \n    float centerX = batchTextureStep.y; \n    float numberOfAttributes = float(${t}); \n    return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5); \n} \n`:`uniform vec4 batchTextureStep; \nuniform vec2 batchTextureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX = batchTextureStep.x; \n    float centerX = batchTextureStep.y; \n    float stepY = batchTextureStep.z; \n    float centerY = batchTextureStep.w; \n    float numberOfAttributes = float(${t}); \n    float xId = mod(batchId * numberOfAttributes, batchTextureDimensions.x); \n    float yId = floor(batchId * numberOfAttributes / batchTextureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n`}function Bq(e){return 1===e?"float":`vec${e}`}function Nq(e){return 1===e?".x":2===e?".xy":3===e?".xyz":""}function Fq(e,t){const n=e._attributes,i=n[t],o=i.componentsPerAttribute,r=i.functionName,s=Bq(o),a=Nq(o),c=e._offsets[t];let l=`${s} ${r}(float batchId) \n{ \n    vec2 st = computeSt(batchId); \n    st.x += batchTextureStep.x * float(${c}); \n`;return e._packFloats&&i.componentDatatype!==hD.UNSIGNED_BYTE?l+="vec4 textureValue; \ntextureValue.x = czm_unpackFloat(texture2D(batchTexture, st)); \ntextureValue.y = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x, 0.0))); \ntextureValue.z = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 2.0, 0.0))); \ntextureValue.w = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 3.0, 0.0))); \n":l+="    vec4 textureValue = texture2D(batchTexture, st); \n",l+=`    ${s} value = textureValue${a}; \n`,e._pixelDatatype!==hD.UNSIGNED_BYTE||i.componentDatatype!==ih.UNSIGNED_BYTE||i.normalize?e._pixelDatatype===hD.FLOAT&&i.componentDatatype===ih.UNSIGNED_BYTE&&i.normalize&&(l+="value /= 255.0; \n"):l+="value *= 255.0; \n",l+="    return value; \n} \n",l}Aq.prototype.setBatchedAttribute=function(e,t,n){if(e<0||e>=this._numberOfInstances)throw new x("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new x("attributeIndex is out of range");if(!C(n))throw new x("value is required.");const i=this._attributes,o=Dq[i[t].componentsPerAttribute],r=this.getBatchedAttribute(e,t,o),s=Tq(this._attributes,t),a=C(s.equals)?s.equals(r,n):r===n;if(a)return;const c=Pq;c.x=C(n.x)?n.x:n,c.y=C(n.y)?n.y:0,c.z=C(n.z)?n.z:0,c.w=C(n.w)?n.w:0;const l=this._offsets[t],u=this._stride,h=4*u*e+4*l;this._packFloats&&i[t].componentDatatype!==hD.UNSIGNED_BYTE?Iq(c,this._batchValues,h):Xe.pack(c,this._batchValues,h),this._batchValuesDirty=!0},Aq.prototype.update=function(e){C(this._texture)&&!this._batchValuesDirty||0===this._attributes.length||(this._batchValuesDirty=!1,C(this._texture)||Rq(this,e.context),Lq(this))},Aq.prototype.getUniformMapCallback=function(){const e=this;return function(t){if(0===e._attributes.length)return t;const n={batchTexture:function(){return e._texture},batchTextureDimensions:function(){return e._textureDimensions},batchTextureStep:function(){return e._textureStep}};return _n(t,n)}},Aq.prototype.getVertexShaderCallback=function(){const e=this._attributes;if(0===e.length)return function(e){return e};let t="uniform highp sampler2D batchTexture; \n";t+=`${Mq(this)}\n`;const n=e.length;for(let i=0;i<n;++i)t+=Fq(this,i);return function(e){const n=e.indexOf("void main"),i=e.substring(0,n),o=e.substring(n);return`${i}\n${t}\n${o}`}},Aq.prototype.isDestroyed=function(){return!1},Aq.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),Qh(this)};var zq=Aq;function kq(e,t,n){let i=!n;const o=e.length;let r;if(!i&&o>1){const t=e[0].modelMatrix;for(r=1;r<o;++r)if(!ft.equals(t,e[r].modelMatrix)){i=!0;break}}if(i)for(r=0;r<o;++r)C(e[r].geometry)&&fg.transformToWorldCoordinates(e[r]);else ft.multiplyTransformation(t,e[0].modelMatrix,t)}function Uq(e,t){const n=e.attributes,i=n.position,o=i.values.length/i.componentsPerAttribute;n.batchId=new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:1,values:new Float32Array(o)});const r=n.batchId.values;for(let s=0;s<o;++s)r[s]=t}function Vq(e){const t=e.length;for(let n=0;n<t;++n){const t=e[n];C(t.geometry)?Uq(t.geometry,n):C(t.westHemisphereGeometry)&&C(t.eastHemisphereGeometry)&&(Uq(t.westHemisphereGeometry,n),Uq(t.eastHemisphereGeometry,n))}}function Hq(e){const t=e.instances,n=e.projection,i=e.elementIndexUintSupported,o=e.scene3DOnly,r=e.vertexCacheOptimize,s=e.compressVertices,a=e.modelMatrix;let c,l,u,h=t.length;for(c=0;c<h;++c)if(C(t[c].geometry)){u=t[c].geometry.primitiveType;break}for(c=1;c<h;++c)if(C(t[c].geometry)&&t[c].geometry.primitiveType!==u)throw new x("All instance geometries must have the same primitiveType.");if(kq(t,a,o),!o)for(c=0;c<h;++c)C(t[c].geometry)&&fg.splitLongitude(t[c]);if(Vq(t),r)for(c=0;c<h;++c){const e=t[c];C(e.geometry)?(fg.reorderForPostVertexCache(e.geometry),fg.reorderForPreVertexCache(e.geometry)):C(e.westHemisphereGeometry)&&C(e.eastHemisphereGeometry)&&(fg.reorderForPostVertexCache(e.westHemisphereGeometry),fg.reorderForPreVertexCache(e.westHemisphereGeometry),fg.reorderForPostVertexCache(e.eastHemisphereGeometry),fg.reorderForPreVertexCache(e.eastHemisphereGeometry))}let d=fg.combineInstances(t);for(h=d.length,c=0;c<h;++c){l=d[c];const e=l.attributes;if(o)for(const t in e)e.hasOwnProperty(t)&&e[t].componentDatatype===ih.DOUBLE&&fg.encodeAttribute(l,t,`${t}3DHigh`,`${t}3DLow`);else for(const t in e)if(e.hasOwnProperty(t)&&e[t].componentDatatype===ih.DOUBLE){const e=`${t}3D`,i=`${t}2D`;fg.projectTo2D(l,t,e,i,n),C(l.boundingSphere)&&"position"===t&&(l.boundingSphereCV=nn.fromVertices(l.attributes.position2D.values)),fg.encodeAttribute(l,e,`${e}High`,`${e}Low`),fg.encodeAttribute(l,i,`${i}High`,`${i}Low`)}s&&fg.compressVertices(l)}if(!i){let e=[];for(h=d.length,c=0;c<h;++c)l=d[c],e=e.concat(fg.fitToUnsignedShortIndices(l));d=e}return d}function Gq(e,t,n,i){let o,r,s;const a=i.length-1;if(a>=0){const e=i[a];o=e.offset+e.count,s=e.index,r=n[s].indices.length}else o=0,s=0,r=n[s].indices.length;const c=e.length;for(let l=0;l<c;++l){const a=e[l],c=a[t];if(!C(c))continue;const u=c.indices.length;o+u>r&&(o=0,r=n[++s].indices.length),i.push({index:s,offset:o,count:u}),o+=u}}function Wq(e,t){const n=[];return Gq(e,"geometry",t,n),Gq(e,"westHemisphereGeometry",t,n),Gq(e,"eastHemisphereGeometry",t,n),n}const qq={};function jq(e,t){const n=e.attributes;for(const i in n)if(n.hasOwnProperty(i)){const e=n[i];C(e)&&C(e.values)&&t.push(e.values.buffer)}C(e.indices)&&t.push(e.indices.buffer)}function Yq(e,t){const n=e.length;for(let i=0;i<n;++i)jq(e[i],t)}function Kq(e){let t=1;const n=e.length;for(let i=0;i<n;i++){const n=e[i];if(++t,!C(n))continue;const o=n.attributes;t+=7+2*nn.packedLength+(C(n.indices)?n.indices.length:0);for(const e in o)if(o.hasOwnProperty(e)&&C(o[e])){const n=o[e];t+=5+n.values.length}}return t}function Xq(e,t){const n=e.length,i=new Float64Array(1+19*n);let o=0;i[o++]=n;for(let r=0;r<n;r++){const t=e[r];if(ft.pack(t.modelMatrix,i,o),o+=ft.packedLength,C(t.attributes)&&C(t.attributes.offset)){const e=t.attributes.offset.value;i[o]=e[0],i[o+1]=e[1],i[o+2]=e[2]}o+=3}return t.push(i.buffer),i}function Qq(e){const t=e,n=new Array(t[0]);let i=0,o=1;while(o<t.length){const e=ft.unpack(t,o);let r;o+=ft.packedLength,C(t[o])&&(r={offset:new JO(t[o],t[o+1],t[o+2])}),o+=3,n[i++]={modelMatrix:e,attributes:r}}return n}function Jq(e){const t=e.length,n=1+(nn.packedLength+1)*t,i=new Float32Array(n);let o=0;i[o++]=t;for(let r=0;r<t;++r){const t=e[r];C(t)?(i[o++]=1,nn.pack(e[r],i,o)):i[o++]=0,o+=nn.packedLength}return i}function Zq(e){const t=new Array(e[0]);let n=0,i=1;while(i<e.length)1===e[i++]&&(t[n]=nn.unpack(e,i)),++n,i+=nn.packedLength;return t}qq.combineGeometry=function(e){let t,n;const i=e.instances,o=i.length;let r,s,a=!1;o>0&&(t=Hq(e),t.length>0&&(n=fg.createAttributeLocations(t[0]),e.createPickOffsets&&(r=Wq(i,t))),C(i[0].attributes)&&C(i[0].attributes.offset)&&(s=new Array(o),a=!0));const c=new Array(o),l=new Array(o);for(let u=0;u<o;++u){const e=i[u],t=e.geometry;C(t)&&(c[u]=t.boundingSphere,l[u]=t.boundingSphereCV,a&&(s[u]=e.geometry.offsetAttribute));const n=e.eastHemisphereGeometry,o=e.westHemisphereGeometry;C(n)&&C(o)&&(C(n.boundingSphere)&&C(o.boundingSphere)&&(c[u]=nn.union(n.boundingSphere,o.boundingSphere)),C(n.boundingSphereCV)&&C(o.boundingSphereCV)&&(l[u]=nn.union(n.boundingSphereCV,o.boundingSphereCV)))}return{geometries:t,modelMatrix:e.modelMatrix,attributeLocations:n,pickOffsets:r,offsetInstanceExtend:s,boundingSpheres:c,boundingSpheresCV:l}},qq.packCreateGeometryResults=function(e,t){const n=new Float64Array(Kq(e)),i=[],o={},r=e.length;let s=0;n[s++]=r;for(let a=0;a<r;a++){const t=e[a],r=C(t);if(n[s++]=r?1:0,!r)continue;n[s++]=t.primitiveType,n[s++]=t.geometryType,n[s++]=R(t.offsetAttribute,-1);const c=C(t.boundingSphere)?1:0;n[s++]=c,c&&nn.pack(t.boundingSphere,n,s),s+=nn.packedLength;const l=C(t.boundingSphereCV)?1:0;n[s++]=l,l&&nn.pack(t.boundingSphereCV,n,s),s+=nn.packedLength;const u=t.attributes,h=[];for(const e in u)u.hasOwnProperty(e)&&C(u[e])&&(h.push(e),C(o[e])||(o[e]=i.length,i.push(e)));n[s++]=h.length;for(let e=0;e<h.length;e++){const t=h[e],i=u[t];n[s++]=o[t],n[s++]=i.componentDatatype,n[s++]=i.componentsPerAttribute,n[s++]=i.normalize?1:0,n[s++]=i.values.length,n.set(i.values,s),s+=i.values.length}const d=C(t.indices)?t.indices.length:0;n[s++]=d,d>0&&(n.set(t.indices,s),s+=d)}return t.push(n.buffer),{stringTable:i,packedData:n}},qq.unpackCreateGeometryResults=function(e){const t=e.stringTable,n=e.packedData;let i;const o=new Array(n[0]);let r=0,s=1;while(s<n.length){const e=1===n[s++];if(!e){o[r++]=void 0;continue}const a=n[s++],c=n[s++];let l,u,h=n[s++];-1===h&&(h=void 0);const d=1===n[s++];d&&(l=nn.unpack(n,s)),s+=nn.packedLength;const f=1===n[s++];let p,m,_;f&&(u=nn.unpack(n,s)),s+=nn.packedLength;const g=new Hf,y=n[s++];for(i=0;i<y;i++){const e=t[n[s++]],i=n[s++];_=n[s++];const o=0!==n[s++];p=n[s++],m=ih.createTypedArray(i,p);for(let t=0;t<p;t++)m[t]=n[s++];g[e]=new Uf({componentDatatype:i,componentsPerAttribute:_,normalize:o,values:m})}let v;if(p=n[s++],p>0){const e=m.length/_;for(v=fd.createTypedArray(e,p),i=0;i<p;i++)v[i]=n[s++]}o[r++]=new zf({primitiveType:a,geometryType:c,boundingSphere:l,boundingSphereCV:u,indices:v,attributes:g,offsetAttribute:h})}return o},qq.packCombineGeometryParameters=function(e,t){const n=e.createGeometryResults,i=n.length;for(let o=0;o<i;o++)t.push(n[o].packedData.buffer);return{createGeometryResults:e.createGeometryResults,packedInstances:Xq(e.instances,t),ellipsoid:e.ellipsoid,isGeographic:e.projection instanceof ve,elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e.createPickOffsets}},qq.unpackCombineGeometryParameters=function(e){const t=Qq(e.packedInstances),n=e.createGeometryResults,i=n.length;let o=0;for(let a=0;a<i;a++){const e=qq.unpackCreateGeometryResults(n[a]),i=e.length;for(let n=0;n<i;n++){const i=e[n],r=t[o];r.geometry=i,++o}}const r=ge.clone(e.ellipsoid),s=e.isGeographic?new ve(r):new Vh(r);return{instances:t,ellipsoid:r,projection:s,elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:ft.clone(e.modelMatrix),createPickOffsets:e.createPickOffsets}},qq.packCombineGeometryResults=function(e,t){C(e.geometries)&&Yq(e.geometries,t);const n=Jq(e.boundingSpheres),i=Jq(e.boundingSpheresCV);return t.push(n.buffer,i.buffer),{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:n,boundingSpheresCV:i}},qq.unpackCombineGeometryResults=function(e){return{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:Zq(e.boundingSpheres),boundingSpheresCV:Zq(e.boundingSpheresCV)}};var $q=qq;const ej={READY:0,CREATING:1,CREATED:2,COMBINING:3,COMBINED:4,COMPLETE:5,FAILED:6};var tj=Object.freeze(ej);const nj={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3,getMorphTime:function(e){return e===nj.SCENE3D?1:e!==nj.MORPHING?0:void 0}};var ij=Object.freeze(nj);const oj={DISABLED:0,ENABLED:1,CAST_ONLY:2,RECEIVE_ONLY:3,NUMBER_OF_SHADOW_MODES:4,castShadows:function(e){return e===oj.ENABLED||e===oj.CAST_ONLY},receiveShadows:function(e){return e===oj.ENABLED||e===oj.RECEIVE_ONLY},fromCastReceive:function(e,t){return e&&t?oj.ENABLED:e?oj.CAST_ONLY:t?oj.RECEIVE_ONLY:oj.DISABLED}};var rj=Object.freeze(oj);function sj(e){if(e=R(e,R.EMPTY_OBJECT),this.geometryInstances=e.geometryInstances,this.appearance=e.appearance,this._appearance=void 0,this._material=void 0,this.depthFailAppearance=e.depthFailAppearance,this._depthFailAppearance=void 0,this._depthFailMaterial=void 0,this.modelMatrix=ft.clone(R(e.modelMatrix,ft.IDENTITY)),this._modelMatrix=new ft,this.show=R(e.show,!0),this._vertexCacheOptimize=R(e.vertexCacheOptimize,!1),this._interleave=R(e.interleave,!1),this._releaseGeometryInstances=R(e.releaseGeometryInstances,!0),this._allowPicking=R(e.allowPicking,!0),this._asynchronous=R(e.asynchronous,!0),this._compressVertices=R(e.compressVertices,!0),this.cull=R(e.cull,!0),this.debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this.rtcCenter=e.rtcCenter,C(this.rtcCenter)&&(!C(this.geometryInstances)||Array.isArray(this.geometryInstances)&&1!==this.geometryInstances.length))throw new x("Relative-to-center rendering only supports one geometry instance.");this.shadows=R(e.shadows,rj.DISABLED),this._translucent=void 0,this._state=tj.READY,this._geometries=[],this._error=void 0,this._numberOfInstances=0,this._boundingSpheres=[],this._boundingSphereWC=[],this._boundingSphereCV=[],this._boundingSphere2D=[],this._boundingSphereMorph=[],this._perInstanceAttributeCache=[],this._instanceIds=[],this._lastPerInstanceAttributeIndex=0,this._va=[],this._attributeLocations=void 0,this._primitiveType=void 0,this._frontFaceRS=void 0,this._backFaceRS=void 0,this._sp=void 0,this._depthFailAppearance=void 0,this._spDepthFail=void 0,this._frontFaceDepthFailRS=void 0,this._backFaceDepthFailRS=void 0,this._pickIds=[],this._colorCommands=[],this._pickCommands=[],this._createBoundingVolumeFunction=e._createBoundingVolumeFunction,this._createRenderStatesFunction=e._createRenderStatesFunction,this._createShaderProgramFunction=e._createShaderProgramFunction,this._createCommandsFunction=e._createCommandsFunction,this._updateAndQueueCommandsFunction=e._updateAndQueueCommandsFunction,this._createPickOffsets=e._createPickOffsets,this._pickOffsets=void 0,this._createGeometryResults=void 0,this._ready=!1,this._readyPromise=yn(),this._batchTable=void 0,this._batchTableAttributeIndices=void 0,this._offsetInstanceExtend=void 0,this._batchTableOffsetAttribute2DIndex=void 0,this._batchTableOffsetsUpdated=!1,this._instanceBoundingSpheres=void 0,this._instanceBoundingSpheresCV=void 0,this._tempBoundingSpheres=void 0,this._recomputeBoundingSpheres=!1,this._batchTableBoundingSpheresUpdated=!1,this._batchTableBoundingSphereAttributeIndices=void 0}function aj(e){const t=e.length,n=[],i=e[0].attributes;let o;for(o in i)if(i.hasOwnProperty(o)&&C(i[o])){const r=i[o];let s=!0;for(let n=1;n<t;++n){const t=e[n].attributes[o];if(!C(t)||r.componentDatatype!==t.componentDatatype||r.componentsPerAttribute!==t.componentsPerAttribute||r.normalize!==t.normalize){s=!1;break}}s&&n.push(o)}return n}Object.defineProperties(sj.prototype,{vertexCacheOptimize:{get:function(){return this._vertexCacheOptimize}},interleave:{get:function(){return this._interleave}},releaseGeometryInstances:{get:function(){return this._releaseGeometryInstances}},allowPicking:{get:function(){return this._allowPicking}},asynchronous:{get:function(){return this._asynchronous}},compressVertices:{get:function(){return this._compressVertices}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}}});const cj=new ro,lj=new K,uj=new Xe;function hj(e){const t=e.length;return 1===t?e[0]:2===t?ro.unpack(e,0,cj):3===t?K.unpack(e,0,lj):4===t?Xe.unpack(e,0,uj):void 0}function dj(e,t){const n=e.geometryInstances,i=Array.isArray(n)?n:[n],o=i.length;if(0===o)return;const r=aj(i),s=r.length,a=[],c={},l={};let u;const h=i[0];let d,f,p,m=h.attributes;for(d=0;d<s;++d)f=r[d],p=m[f],c[f]=d,a.push({functionName:`czm_batchTable_${f}`,componentDatatype:p.componentDatatype,componentsPerAttribute:p.componentsPerAttribute,normalize:p.normalize});-1!==r.indexOf("distanceDisplayCondition")&&(a.push({functionName:"czm_batchTable_boundingSphereCenter3DHigh",componentDatatype:ih.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter3DLow",componentDatatype:ih.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DHigh",componentDatatype:ih.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DLow",componentDatatype:ih.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereRadius",componentDatatype:ih.FLOAT,componentsPerAttribute:1}),l.center3DHigh=a.length-5,l.center3DLow=a.length-4,l.center2DHigh=a.length-3,l.center2DLow=a.length-2,l.radius=a.length-1),-1!==r.indexOf("offset")&&(a.push({functionName:"czm_batchTable_offset2D",componentDatatype:ih.FLOAT,componentsPerAttribute:3}),u=a.length-1),a.push({functionName:"czm_batchTable_pickColor",componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0});const _=a.length,g=new zq(t,a,o);for(d=0;d<o;++d){const n=i[d];m=n.attributes;for(let e=0;e<s;++e){f=r[e],p=m[f];const t=hj(p.value),n=c[f];g.setBatchedAttribute(d,n,t)}const o={primitive:R(n.pickPrimitive,e)};C(n.id)&&(o.id=n.id);const a=t.createPickId(o);e._pickIds.push(a);const l=a.color,u=uj;u.x=xy.floatToByte(l.red),u.y=xy.floatToByte(l.green),u.z=xy.floatToByte(l.blue),u.w=xy.floatToByte(l.alpha),g.setBatchedAttribute(d,_-1,u)}e._batchTable=g,e._batchTableAttributeIndices=c,e._batchTableBoundingSphereAttributeIndices=l,e._batchTableOffsetAttribute2DIndex=u}function fj(e){let t;return t=Array.isArray(e.values)?e.values.slice(0):new e.values.constructor(e.values),new Uf({componentDatatype:e.componentDatatype,componentsPerAttribute:e.componentsPerAttribute,normalize:e.normalize,values:t})}function pj(e){const t=e.attributes,n=new Hf;for(const o in t)t.hasOwnProperty(o)&&C(t[o])&&(n[o]=fj(t[o]));let i;if(C(e.indices)){const t=e.indices;i=Array.isArray(t)?t.slice(0):new t.constructor(t)}return new zf({attributes:n,indices:i,primitiveType:e.primitiveType,boundingSphere:nn.clone(e.boundingSphere)})}function mj(e,t){return{geometry:t,attributes:e.attributes,modelMatrix:ft.clone(e.modelMatrix),pickPrimitive:e.pickPrimitive,id:e.id}}const _j=/attribute\s+vec(?:3|4)\s+(.*)3DHigh;/g;function gj(e){const t=tq.replaceMain(e,"czm_non_pick_main"),n="varying vec4 v_pickColor; \nvoid main() \n{ \n    czm_non_pick_main(); \n    v_pickColor = czm_batchTable_pickColor(batchId); \n}";return`${t}\n${n}`}function yj(e){return`varying vec4 v_pickColor;\n${e}`}function vj(e,t){if(!e.compressVertices)return t;const n=-1!==t.search(/attribute\s+vec3\s+normal;/g),i=-1!==t.search(/attribute\s+vec2\s+st;/g);if(!n&&!i)return t;const o=-1!==t.search(/attribute\s+vec3\s+tangent;/g),r=-1!==t.search(/attribute\s+vec3\s+bitangent;/g);let s=i&&n?2:1;s+=o||r?1:0;const a=s>1?`vec${s}`:"float",c="compressedAttributes",l=`attribute ${a} ${c};`;let u="",h="";if(i){u+="vec2 st;\n";const e=s>1?`${c}.x`:c;h+=`    st = czm_decompressTextureCoordinates(${e});\n`}n&&o&&r?(u+="vec3 normal;\nvec3 tangent;\nvec3 bitangent;\n",h+=`    czm_octDecode(${c}.${i?"yz":"xy"}, normal, tangent, bitangent);\n`):(n&&(u+="vec3 normal;\n",h+=`    normal = czm_octDecode(${c}${s>1?"."+(i?"y":"x"):""});\n`),o&&(u+="vec3 tangent;\n",h+=`    tangent = czm_octDecode(${c}.${i&&n?"z":"y"});\n`),r&&(u+="vec3 bitangent;\n",h+=`    bitangent = czm_octDecode(${c}.${i&&n?"z":"y"});\n`));let d=t;d=d.replace(/attribute\s+vec3\s+normal;/g,""),d=d.replace(/attribute\s+vec2\s+st;/g,""),d=d.replace(/attribute\s+vec3\s+tangent;/g,""),d=d.replace(/attribute\s+vec3\s+bitangent;/g,""),d=tq.replaceMain(d,"czm_non_compressed_main");const f=`void main() \n{ \n${h}    czm_non_compressed_main(); \n}`;return[l,u,d,f].join("\n")}function bj(e){let t=tq.replaceMain(e,"czm_non_depth_clamp_main");return t+="void main() {\n    czm_non_depth_clamp_main();\n    gl_Position = czm_depthClamp(gl_Position);}\n",t}function Aj(e){let t=tq.replaceMain(e,"czm_non_depth_clamp_main");return t+="void main() {\n    czm_non_depth_clamp_main();\n#if defined(GL_EXT_frag_depth)\n    #if defined(LOG_DEPTH)\n        czm_writeLogDepth();\n    #else\n        czm_writeDepthClamp();\n    #endif\n#endif\n}\n",t=`#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n${t}`,t}function wj(e,t){const n=e.vertexAttributes;for(const i in n)if(n.hasOwnProperty(i)&&!C(t[i]))throw new x(`Appearance/Geometry mismatch.  The appearance requires vertex shader attribute input '${i}', which was not computed as part of the Geometry.  Use the appearance's vertexFormat property when constructing the geometry.`)}function Tj(e,t){return function(){return e[t]}}sj._modifyShaderPosition=function(e,t,n){let i,o="",r="",s="";while(null!==(i=_j.exec(t))){const a=i[1],c=`vec4 czm_compute${a[0].toUpperCase()}${a.substr(1)}()`;"vec4 czm_computePosition()"!==c&&(o+=`${c};\n`),C(e.rtcCenter)?(t=t.replace(/attribute\s+vec(?:3|4)\s+position3DHigh;/g,""),t=t.replace(/attribute\s+vec(?:3|4)\s+position3DLow;/g,""),o+="uniform mat4 u_modifiedModelView;\n",r+="attribute vec4 position;\n",s+=`${c}\n{\n    return u_modifiedModelView * position;\n}\n\n`,t=t.replace(/czm_modelViewRelativeToEye\s+\*\s+/g,""),t=t.replace(/czm_modelViewProjectionRelativeToEye/g,"czm_projection")):n?s+=`${c}\n{\n    return czm_translateRelativeToEye(${a}3DHigh, ${a}3DLow);\n}\n\n`:(r+=`attribute vec3 ${a}2DHigh;\nattribute vec3 ${a}2DLow;\n`,s+=`${c}\n{\n    vec4 p;\n    if (czm_morphTime == 1.0)\n    {\n        p = czm_translateRelativeToEye(${a}3DHigh, ${a}3DLow);\n    }\n    else if (czm_morphTime == 0.0)\n    {\n        p = czm_translateRelativeToEye(${a}2DHigh.zxy, ${a}2DLow.zxy);\n    }\n    else\n    {\n        p = czm_columbusViewMorph(\n                czm_translateRelativeToEye(${a}2DHigh.zxy, ${a}2DLow.zxy),\n                czm_translateRelativeToEye(${a}3DHigh, ${a}3DLow),\n                czm_morphTime);\n    }\n    return p;\n}\n\n`)}return[o,r,t,s].join("\n")},sj._appendShowToShader=function(e,t){if(!C(e._batchTableAttributeIndices.show))return t;const n=tq.replaceMain(t,"czm_non_show_main"),i="void main() \n{ \n    czm_non_show_main(); \n    gl_Position *= czm_batchTable_show(batchId); \n}";return`${n}\n${i}`},sj._updateColorAttribute=function(e,t,n){if(!C(e._batchTableAttributeIndices.color)&&!C(e._batchTableAttributeIndices.depthFailColor))return t;if(-1===t.search(/attribute\s+vec4\s+color;/g))return t;if(n&&!C(e._batchTableAttributeIndices.depthFailColor))throw new x("A depthFailColor per-instance attribute is required when using a depth fail appearance that uses a color attribute.");let i=t;return i=i.replace(/attribute\s+vec4\s+color;/g,""),i=n?i.replace(/(\b)color(\b)/g,"$1czm_batchTable_depthFailColor(batchId)$2"):i.replace(/(\b)color(\b)/g,"$1czm_batchTable_color(batchId)$2"),i},sj._updatePickColorAttribute=function(e){let t=e.replace(/attribute\s+vec4\s+pickColor;/g,"");return t=t.replace(/(\b)pickColor(\b)/g,"$1czm_batchTable_pickColor(batchId)$2"),t},sj._appendOffsetToShader=function(e,t){if(!C(e._batchTableAttributeIndices.offset))return t;let n="attribute float batchId;\n";n+="attribute float applyOffset;";let i=t.replace(/attribute\s+float\s+batchId;/g,n),o="vec4 $1 = czm_computePosition();\n";return o+="    if (czm_sceneMode == czm_sceneMode3D)\n",o+="    {\n",o+="        $1 = $1 + vec4(czm_batchTable_offset(batchId) * applyOffset, 0.0);",o+="    }\n",o+="    else\n",o+="    {\n",o+="        $1 = $1 + vec4(czm_batchTable_offset2D(batchId) * applyOffset, 0.0);",o+="    }\n",i=i.replace(/vec4\s+([A-Za-z0-9_]+)\s+=\s+czm_computePosition\(\);/g,o),i},sj._appendDistanceDisplayConditionToShader=function(e,t,n){if(!C(e._batchTableAttributeIndices.distanceDisplayCondition))return t;const i=tq.replaceMain(t,"czm_non_distanceDisplayCondition_main");let o="void main() \n{ \n    czm_non_distanceDisplayCondition_main(); \n    vec2 distanceDisplayCondition = czm_batchTable_distanceDisplayCondition(batchId);\n    vec3 boundingSphereCenter3DHigh = czm_batchTable_boundingSphereCenter3DHigh(batchId);\n    vec3 boundingSphereCenter3DLow = czm_batchTable_boundingSphereCenter3DLow(batchId);\n    float boundingSphereRadius = czm_batchTable_boundingSphereRadius(batchId);\n";return o+=n?"    vec4 centerRTE = czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);\n":"    vec3 boundingSphereCenter2DHigh = czm_batchTable_boundingSphereCenter2DHigh(batchId);\n    vec3 boundingSphereCenter2DLow = czm_batchTable_boundingSphereCenter2DLow(batchId);\n    vec4 centerRTE;\n    if (czm_morphTime == 1.0)\n    {\n        centerRTE = czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);\n    }\n    else if (czm_morphTime == 0.0)\n    {\n        centerRTE = czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy);\n    }\n    else\n    {\n        centerRTE = czm_columbusViewMorph(\n                czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy),\n                czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow),\n                czm_morphTime);\n    }\n",o+="    float radiusSq = boundingSphereRadius * boundingSphereRadius; \n    float distanceSq; \n    if (czm_sceneMode == czm_sceneMode2D) \n    { \n        distanceSq = czm_eyeHeight2D.y - radiusSq; \n    } \n    else \n    { \n        distanceSq = dot(centerRTE.xyz, centerRTE.xyz) - radiusSq; \n    } \n    distanceSq = max(distanceSq, 0.0); \n    float nearSq = distanceDisplayCondition.x * distanceDisplayCondition.x; \n    float farSq = distanceDisplayCondition.y * distanceDisplayCondition.y; \n    float show = (distanceSq >= nearSq && distanceSq <= farSq) ? 1.0 : 0.0; \n    gl_Position *= show; \n}",`${i}\n${o}`};const Cj=Math.max(Oc.hardwareConcurrency-1,1);let Ej;const xj=new ad("combineGeometry");function Sj(e,t){let n,i,o,r;const s=e._instanceIds;if(e._state===tj.READY){n=Array.isArray(e.geometryInstances)?e.geometryInstances:[e.geometryInstances];const a=e._numberOfInstances=n.length,c=[];let l,u=[];for(o=0;o<a;++o){if(i=n[o].geometry,s.push(n[o].id),!C(i._workerName))throw new x("_workerName must be defined for asynchronous geometry.");u.push({moduleName:i._workerName,geometry:i})}if(!C(Ej))for(Ej=new Array(Cj),o=0;o<Cj;o++)Ej[o]=new ad("createGeometry");for(u=mz(u,Cj),o=0;o<u.length;o++){let e=0;const t=u[o],n=t.length;for(r=0;r<n;++r)l=t[r],i=l.geometry,C(i.constructor.pack)&&(l.offset=e,e+=R(i.constructor.packedLength,i.packedLength));let s;if(e>0){const o=new Float64Array(e);for(s=[o.buffer],r=0;r<n;++r)l=t[r],i=l.geometry,C(i.constructor.pack)&&(i.constructor.pack(i,o,l.offset),l.geometry=o)}c.push(Ej[o].scheduleTask({subTasks:u[o]},s))}e._state=tj.CREATING,Promise.all(c).then((function(t){e._createGeometryResults=t,e._state=tj.CREATED})).catch((function(n){eY(e,t,tj.FAILED,n)}))}else if(e._state===tj.CREATED){const i=[];n=Array.isArray(e.geometryInstances)?e.geometryInstances:[e.geometryInstances];const o=t.scene3DOnly,r=t.mapProjection,s=xj.scheduleTask($q.packCombineGeometryParameters({createGeometryResults:e._createGeometryResults,instances:n,ellipsoid:r.ellipsoid,projection:r,elementIndexUintSupported:t.context.elementIndexUint,scene3DOnly:o,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e._createPickOffsets},i),i);e._createGeometryResults=void 0,e._state=tj.COMBINING,Promise.resolve(s).then((function(n){const i=$q.unpackCombineGeometryResults(n);e._geometries=i.geometries,e._attributeLocations=i.attributeLocations,e.modelMatrix=ft.clone(i.modelMatrix,e.modelMatrix),e._pickOffsets=i.pickOffsets,e._offsetInstanceExtend=i.offsetInstanceExtend,e._instanceBoundingSpheres=i.boundingSpheres,e._instanceBoundingSpheresCV=i.boundingSpheresCV,C(e._geometries)&&e._geometries.length>0?(e._recomputeBoundingSpheres=!0,e._state=tj.COMBINED):eY(e,t,tj.FAILED,void 0)})).catch((function(n){eY(e,t,tj.FAILED,n)}))}}function Ij(e,t){const n=Array.isArray(e.geometryInstances)?e.geometryInstances:[e.geometryInstances],i=e._numberOfInstances=n.length,o=new Array(i),r=e._instanceIds;let s,a,c=0;for(a=0;a<i;a++){s=n[a];const e=s.geometry;let t;t=C(e.attributes)&&C(e.primitiveType)?pj(e):e.constructor.createGeometry(e),o[c++]=mj(s,t),r.push(s.id)}o.length=c;const l=t.scene3DOnly,u=t.mapProjection,h=$q.combineGeometry({instances:o,ellipsoid:u.ellipsoid,projection:u,elementIndexUintSupported:t.context.elementIndexUint,scene3DOnly:l,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e._createPickOffsets});e._geometries=h.geometries,e._attributeLocations=h.attributeLocations,e.modelMatrix=ft.clone(h.modelMatrix,e.modelMatrix),e._pickOffsets=h.pickOffsets,e._offsetInstanceExtend=h.offsetInstanceExtend,e._instanceBoundingSpheres=h.boundingSpheres,e._instanceBoundingSpheresCV=h.boundingSpheresCV,C(e._geometries)&&e._geometries.length>0?(e._recomputeBoundingSpheres=!0,e._state=tj.COMBINED):eY(e,t,tj.FAILED,void 0)}function Oj(e,t){const n=e._batchTableAttributeIndices.offset;if(!e._recomputeBoundingSpheres||!C(n))return void(e._recomputeBoundingSpheres=!1);let i;const o=e._offsetInstanceExtend,r=e._instanceBoundingSpheres,s=r.length;let a=e._tempBoundingSpheres;if(!C(a)){for(a=new Array(s),i=0;i<s;i++)a[i]=new nn;e._tempBoundingSpheres=a}for(i=0;i<s;++i){let t=a[i];const s=e._batchTable.getBatchedAttribute(i,n,new K);t=r[i].clone(t),Kj(t,s,o[i])}const c=[],l=[],u=[];for(i=0;i<s;++i){const e=a[i],t=e.center.x-e.radius;t>0||nn.intersectPlane(e,Gs.ORIGIN_ZX_PLANE)!==Ae.INTERSECTING?c.push(e):(l.push(e),u.push(e))}let h=c[0],d=u[0],f=l[0];for(i=1;i<c.length;i++)h=nn.union(h,c[i]);for(i=1;i<u.length;i++)d=nn.union(d,u[i]);for(i=1;i<l.length;i++)f=nn.union(f,l[i]);const p=[];for(C(h)&&p.push(h),C(d)&&p.push(d),C(f)&&p.push(f),i=0;i<p.length;i++){const n=p[i].clone(e._boundingSpheres[i]);e._boundingSpheres[i]=n,e._boundingSphereCV[i]=nn.projectTo2D(n,t.mapProjection,e._boundingSphereCV[i])}sj._updateBoundingVolumes(e,t,e.modelMatrix,!0),e._recomputeBoundingSpheres=!1}const Dj=new Nm,Pj=new se,Rj=new K,Lj=new nn;function Mj(e,t){const n=C(e._batchTableAttributeIndices.distanceDisplayCondition);if(!n||e._batchTableBoundingSpheresUpdated)return;const i=e._batchTableBoundingSphereAttributeIndices,o=i.center3DHigh,r=i.center3DLow,s=i.center2DHigh,a=i.center2DLow,c=i.radius,l=t.mapProjection,u=l.ellipsoid,h=e._batchTable,d=e._instanceBoundingSpheres,f=d.length;for(let p=0;p<f;++p){let n=d[p];if(!C(n))continue;const i=e.modelMatrix;C(i)&&(n=nn.transform(n,i,Lj));const f=n.center,m=n.radius;let _=Nm.fromCartesian(f,Dj);if(h.setBatchedAttribute(p,o,_.high),h.setBatchedAttribute(p,r,_.low),!t.scene3DOnly){const e=u.cartesianToCartographic(f,Pj),t=l.project(e,Rj);_=Nm.fromCartesian(t,Dj),h.setBatchedAttribute(p,s,_.high),h.setBatchedAttribute(p,a,_.low)}h.setBatchedAttribute(p,c,m)}e._batchTableBoundingSpheresUpdated=!0}const Bj=new K,Nj=new K;function Fj(e,t){const n=C(e._batchTableAttributeIndices.offset);if(!n||e._batchTableOffsetsUpdated||t.scene3DOnly)return;const i=e._batchTableOffsetAttribute2DIndex,o=t.mapProjection,r=o.ellipsoid,s=e._batchTable,a=e._instanceBoundingSpheres,c=a.length;for(let l=0;l<c;++l){let t=a[l];if(!C(t))continue;const n=s.getBatchedAttribute(l,e._batchTableAttributeIndices.offset);if(K.equals(n,K.ZERO)){s.setBatchedAttribute(l,i,K.ZERO);continue}const c=e.modelMatrix;C(c)&&(t=nn.transform(t,c,Lj));let u=t.center;u=r.scaleToGeodeticSurface(u,Nj);let h=r.cartesianToCartographic(u,Pj);const d=o.project(h,Rj),f=K.add(n,u,Bj);h=r.cartesianToCartographic(f,h);const p=o.project(h,Bj),m=K.subtract(p,d,Bj),_=m.x;m.x=m.z,m.z=m.y,m.y=_,s.setBatchedAttribute(l,i,m)}e._batchTableOffsetsUpdated=!0}function zj(e,t){const n=e._attributeLocations,i=e._geometries,o=t.scene3DOnly,r=t.context,s=[],a=i.length;for(let c=0;c<a;++c){const a=i[c];if(s.push(bq.fromGeometry({context:r,geometry:a,attributeLocations:n,bufferUsage:lq.STATIC_DRAW,interleave:e._interleave})),C(e._createBoundingVolumeFunction))e._createBoundingVolumeFunction(t,a);else if(e._boundingSpheres.push(nn.clone(a.boundingSphere)),e._boundingSphereWC.push(new nn),!o){const t=a.boundingSphereCV.center,n=t.x,i=t.y,o=t.z;t.x=o,t.y=n,t.z=i,e._boundingSphereCV.push(nn.clone(a.boundingSphereCV)),e._boundingSphere2D.push(new nn),e._boundingSphereMorph.push(new nn)}}e._va=s,e._primitiveType=i[0].primitiveType,e.releaseGeometryInstances&&(e.geometryInstances=void 0),e._geometries=void 0,eY(e,t,tj.COMPLETE,void 0)}function kj(e,t,n,i){let o,r=n.getRenderState();i?(o=pn(r,!1),o.cull={enabled:!0,face:yk.BACK},e._frontFaceRS=yV.fromCache(o),o.cull.face=yk.FRONT,e._backFaceRS=yV.fromCache(o)):(e._frontFaceRS=yV.fromCache(r),e._backFaceRS=e._frontFaceRS),o=pn(r,!1),C(e._depthFailAppearance)&&(o.depthTest.enabled=!1),C(e._depthFailAppearance)&&(r=e._depthFailAppearance.getRenderState(),o=pn(r,!1),o.depthTest.func=aq.GREATER,i?(o.cull={enabled:!0,face:yk.BACK},e._frontFaceDepthFailRS=yV.fromCache(o),o.cull.face=yk.FRONT,e._backFaceDepthFailRS=yV.fromCache(o)):(e._frontFaceDepthFailRS=yV.fromCache(o),e._backFaceDepthFailRS=e._frontFaceRS))}function Uj(e,t,n){const i=t.context,o=e._attributeLocations;let r=e._batchTable.getVertexShaderCallback()(n.vertexShaderSource);r=sj._appendOffsetToShader(e,r),r=sj._appendShowToShader(e,r),r=sj._appendDistanceDisplayConditionToShader(e,r,t.scene3DOnly),r=gj(r),r=sj._updateColorAttribute(e,r,!1),r=vj(e,r),r=sj._modifyShaderPosition(e,r,t.scene3DOnly);let s=n.getFragmentShaderSource();s=yj(s),e._sp=fH.replaceCache({context:i,shaderProgram:e._sp,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:o}),wj(e._sp,o),C(e._depthFailAppearance)&&(r=e._batchTable.getVertexShaderCallback()(e._depthFailAppearance.vertexShaderSource),r=sj._appendShowToShader(e,r),r=sj._appendDistanceDisplayConditionToShader(e,r,t.scene3DOnly),r=gj(r),r=sj._updateColorAttribute(e,r,!0),r=vj(e,r),r=sj._modifyShaderPosition(e,r,t.scene3DOnly),r=bj(r),s=e._depthFailAppearance.getFragmentShaderSource(),s=yj(s),s=Aj(s),e._spDepthFail=fH.replaceCache({context:i,shaderProgram:e._spDepthFail,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:o}),wj(e._spDepthFail,o))}const Vj=new ft,Hj=new K;function Gj(e,t,n,i){const o=C(n)?n._uniforms:void 0,r={},s=t.uniforms;if(C(s))for(const c in s)if(s.hasOwnProperty(c)){if(C(o)&&C(o[c]))throw new x(`Appearance and material have a uniform with the same name: ${c}`);r[c]=Tj(s,c)}let a=_n(r,o);return a=e._batchTable.getUniformMapCallback()(a),C(e.rtcCenter)&&(a.u_modifiedModelView=function(){const t=i.context.uniformState.view;return ft.multiply(t,e._modelMatrix,Vj),ft.multiplyByPoint(Vj,e.rtcCenter,Hj),ft.setTranslation(Vj,Hj,Vj),Vj}),a}function Wj(e,t,n,i,o,r,s,a){const c=Gj(e,t,n,a);let l;C(e._depthFailAppearance)&&(l=Gj(e,e._depthFailAppearance,e._depthFailAppearance.material,a));const u=i?HU.TRANSLUCENT:HU.OPAQUE;let h=o?2:1;h*=C(e._depthFailAppearance)?2:1,r.length=e._va.length*h;const d=r.length;let f=0;for(let p=0;p<d;++p){let t;o&&(t=r[p],C(t)||(t=r[p]=new UU({owner:e,primitiveType:e._primitiveType})),t.vertexArray=e._va[f],t.renderState=e._backFaceRS,t.shaderProgram=e._sp,t.uniformMap=c,t.pass=u,++p),t=r[p],C(t)||(t=r[p]=new UU({owner:e,primitiveType:e._primitiveType})),t.vertexArray=e._va[f],t.renderState=e._frontFaceRS,t.shaderProgram=e._sp,t.uniformMap=c,t.pass=u,C(e._depthFailAppearance)&&(o&&(++p,t=r[p],C(t)||(t=r[p]=new UU({owner:e,primitiveType:e._primitiveType})),t.vertexArray=e._va[f],t.renderState=e._backFaceDepthFailRS,t.shaderProgram=e._spDepthFail,t.uniformMap=l,t.pass=u),++p,t=r[p],C(t)||(t=r[p]=new UU({owner:e,primitiveType:e._primitiveType})),t.vertexArray=e._va[f],t.renderState=e._frontFaceDepthFailRS,t.shaderProgram=e._spDepthFail,t.uniformMap=l,t.pass=u),++f}}function qj(e,t,n,i,o,r,s,a){if(t.mode!==ij.SCENE3D&&!ft.equals(o,ft.IDENTITY))throw new x("Primitive.modelMatrix is only supported in 3D mode.");let c;sj._updateBoundingVolumes(e,t,o),t.mode===ij.SCENE3D?c=e._boundingSphereWC:t.mode===ij.COLUMBUS_VIEW?c=e._boundingSphereCV:t.mode===ij.SCENE2D&&C(e._boundingSphere2D)?c=e._boundingSphere2D:C(e._boundingSphereMorph)&&(c=e._boundingSphereMorph);const l=t.commandList,u=t.passes;if(u.render||u.pick){const t=e.allowPicking,i=rj.castShadows(e.shadows),u=rj.receiveShadows(e.shadows),h=n.length;let d=a?2:1;d*=C(e._depthFailAppearance)?2:1;for(let e=0;e<h;++e){const a=Math.floor(e/d),h=n[e];h.modelMatrix=o,h.boundingVolume=c[a],h.cull=r,h.debugShowBoundingVolume=s,h.castShadows=i,h.receiveShadows=u,h.pickId=t?"v_pickColor":void 0,l.push(h)}}}sj._updateBoundingVolumes=function(e,t,n,i){let o,r,s;if(i||!ft.equals(n,e._modelMatrix))for(ft.clone(n,e._modelMatrix),r=e._boundingSpheres.length,o=0;o<r;++o)s=e._boundingSpheres[o],C(s)&&(e._boundingSphereWC[o]=nn.transform(s,n,e._boundingSphereWC[o]),t.scene3DOnly||(e._boundingSphere2D[o]=nn.clone(e._boundingSphereCV[o],e._boundingSphere2D[o]),e._boundingSphere2D[o].center.x=0,e._boundingSphereMorph[o]=nn.union(e._boundingSphereWC[o],e._boundingSphereCV[o])));const a=e.appearance.pixelSize;if(C(a))for(r=e._boundingSpheres.length,o=0;o<r;++o){s=e._boundingSpheres[o];const n=e._boundingSphereWC[o],i=t.camera.getPixelSize(s,t.context.drawingBufferWidth,t.context.drawingBufferHeight),r=i*a;n.radius=s.radius+r}},sj.prototype.update=function(e){if(!C(this.geometryInstances)&&0===this._va.length||C(this.geometryInstances)&&Array.isArray(this.geometryInstances)&&0===this.geometryInstances.length||!C(this.appearance)||e.mode!==ij.SCENE3D&&e.scene3DOnly||!e.passes.render&&!e.passes.pick)return;if(C(this._error))throw this._error;if(C(this.rtcCenter)&&!e.scene3DOnly)throw new x("RTC rendering is only available for 3D only scenes.");if(this._state===tj.FAILED)return;const t=e.context;if(C(this._batchTable)||dj(this,t),this._batchTable.attributes.length>0){if(0===Ck.maximumVertexTextureImageUnits)throw new Je("Vertex texture fetch support is required to render primitives with per-instance attributes. The maximum number of vertex texture image units must be greater than zero.");this._batchTable.update(e)}if(this._state!==tj.COMPLETE&&this._state!==tj.COMBINED&&(this.asynchronous?Sj(this,e):Ij(this,e)),this._state===tj.COMBINED&&(Mj(this,e),Fj(this,e),zj(this,e)),!this.show||this._state!==tj.COMPLETE)return;this._batchTableOffsetsUpdated||Fj(this,e),this._recomputeBoundingSpheres&&Oj(this,e);const n=this.appearance,i=n.material;let o=!1,r=!1;this._appearance!==n?(this._appearance=n,this._material=i,o=!0,r=!0):this._material!==i&&(this._material=i,r=!0);const s=this.depthFailAppearance,a=C(s)?s.material:void 0;this._depthFailAppearance!==s?(this._depthFailAppearance=s,this._depthFailMaterial=a,o=!0,r=!0):this._depthFailMaterial!==a&&(this._depthFailMaterial=a,r=!0);const c=this._appearance.isTranslucent();this._translucent!==c&&(this._translucent=c,o=!0),C(this._material)&&this._material.update(t);const l=n.closed&&c;if(o){const e=R(this._createRenderStatesFunction,kj);e(this,t,n,l)}if(r){const t=R(this._createShaderProgramFunction,Uj);t(this,e,n)}if(o||r){const t=R(this._createCommandsFunction,Wj);t(this,n,i,c,l,this._colorCommands,this._pickCommands,e)}const u=R(this._updateAndQueueCommandsFunction,qj);u(this,e,this._colorCommands,this._pickCommands,this.modelMatrix,this.cull,this.debugShowBoundingVolume,l)};const jj=new nn,Yj=new nn;function Kj(e,t,n){if(n===Wf.TOP){const n=nn.clone(e,jj),i=nn.clone(e,Yj);i.center=K.add(i.center,t,i.center),e=nn.union(n,i,e)}else n===Wf.ALL&&(e.center=K.add(e.center,t,e.center));return e}function Xj(e,t,n){return function(){const i=e.getBatchedAttribute(t,n),o=e.attributes[n],r=o.componentsPerAttribute,s=ih.createTypedArray(o.componentDatatype,r);return C(i.constructor.pack)?i.constructor.pack(i,s,0):s[0]=i,s}}function Qj(e,t,n,i,o){return function(r){if(!C(r)||!C(r.length)||r.length<1||r.length>4)throw new x("value must be and array with length between 1 and 4.");const s=hj(r);e.setBatchedAttribute(t,n,s),"offset"===o&&(i._recomputeBoundingSpheres=!0,i._batchTableOffsetsUpdated=!1)}}const Jj=new K;function Zj(e,t,n){t.boundingSphere={get:function(){let i=e._instanceBoundingSpheres[n];if(C(i)){i=i.clone();const o=e.modelMatrix,r=t.offset;C(r)&&Kj(i,K.fromArray(r.get(),0,Jj),e._offsetInstanceExtend[n]),C(o)&&(i=nn.transform(i,o))}return i}},t.boundingSphereCV={get:function(){return e._instanceBoundingSpheresCV[n]}}}function $j(e,t,n){t.pickId={get:function(){return e._pickIds[n]}}}function eY(e,t,n,i){e._error=i,e._state=n,t.afterRender.push((function(){e._ready=e._state===tj.COMPLETE||e._state===tj.FAILED,C(i)?e._readyPromise.reject(i):e._readyPromise.resolve(e)}))}sj.prototype.getGeometryInstanceAttributes=function(e){if(!C(e))throw new x("id is required");if(!C(this._batchTable))throw new x("must call update before calling getGeometryInstanceAttributes");let t=-1;const n=this._lastPerInstanceAttributeIndex,i=this._instanceIds,o=i.length;for(let l=0;l<o;++l){const r=(n+l)%o;if(e===i[r]){t=r;break}}if(-1===t)return;let r=this._perInstanceAttributeCache[t];if(C(r))return r;const s=this._batchTable,a=this._batchTableAttributeIndices;r={};const c={};for(const l in a)if(a.hasOwnProperty(l)){const e=a[l];c[l]={get:Xj(s,t,e),set:Qj(s,t,e,this,l)}}return Zj(this,c,t),$j(this,c,t),Object.defineProperties(r,c),this._lastPerInstanceAttributeIndex=t,this._perInstanceAttributeCache[t]=r,r},sj.prototype.isDestroyed=function(){return!1},sj.prototype.destroy=function(){let e,t;this._sp=this._sp&&this._sp.destroy(),this._spDepthFail=this._spDepthFail&&this._spDepthFail.destroy();const n=this._va;for(e=n.length,t=0;t<e;++t)n[t].destroy();this._va=void 0;const i=this._pickIds;for(e=i.length,t=0;t<e;++t)i[t].destroy();return this._pickIds=void 0,this._batchTable=this._batchTable&&this._batchTable.destroy(),this._instanceIds=void 0,this._perInstanceAttributeCache=void 0,this._attributeLocations=void 0,Qh(this)};var tY=sj,nY="#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#ifdef TEXTURE_COORDINATES\n#ifdef SPHERICAL\nvarying vec4 v_sphericalExtents;\n#else // SPHERICAL\nvarying vec2 v_inversePlaneExtents;\nvarying vec4 v_westPlane;\nvarying vec4 v_southPlane;\n#endif // SPHERICAL\nvarying vec3 v_uvMinAndSphericalLongitudeRotation;\nvarying vec3 v_uMaxAndInverseDistance;\nvarying vec3 v_vMaxAndInverseDistance;\n#endif // TEXTURE_COORDINATES\n\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#endif\n\n#ifdef NORMAL_EC\nvec3 getEyeCoordinate3FromWindowCoordinate(vec2 fragCoord, float logDepthOrDepth) {\n    vec4 eyeCoordinate = czm_windowToEyeCoordinates(fragCoord, logDepthOrDepth);\n    return eyeCoordinate.xyz / eyeCoordinate.w;\n}\n\nvec3 vectorFromOffset(vec4 eyeCoordinate, vec2 positiveOffset) {\n    vec2 glFragCoordXY = gl_FragCoord.xy;\n    // Sample depths at both offset and negative offset\n    float upOrRightLogDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, (glFragCoordXY + positiveOffset) / czm_viewport.zw));\n    float downOrLeftLogDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, (glFragCoordXY - positiveOffset) / czm_viewport.zw));\n    // Explicitly evaluate both paths\n    // Necessary for multifrustum and for edges of the screen\n    bvec2 upOrRightInBounds = lessThan(glFragCoordXY + positiveOffset, czm_viewport.zw);\n    float useUpOrRight = float(upOrRightLogDepth > 0.0 && upOrRightInBounds.x && upOrRightInBounds.y);\n    float useDownOrLeft = float(useUpOrRight == 0.0);\n    vec3 upOrRightEC = getEyeCoordinate3FromWindowCoordinate(glFragCoordXY + positiveOffset, upOrRightLogDepth);\n    vec3 downOrLeftEC = getEyeCoordinate3FromWindowCoordinate(glFragCoordXY - positiveOffset, downOrLeftLogDepth);\n    return (upOrRightEC - (eyeCoordinate.xyz / eyeCoordinate.w)) * useUpOrRight + ((eyeCoordinate.xyz / eyeCoordinate.w) - downOrLeftEC) * useDownOrLeft;\n}\n#endif // NORMAL_EC\n\nvoid main(void)\n{\n#ifdef REQUIRES_EC\n    float logDepthOrDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw));\n    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);\n#endif\n\n#ifdef REQUIRES_WC\n    vec4 worldCoordinate4 = czm_inverseView * eyeCoordinate;\n    vec3 worldCoordinate = worldCoordinate4.xyz / worldCoordinate4.w;\n#endif\n\n#ifdef TEXTURE_COORDINATES\n    vec2 uv;\n#ifdef SPHERICAL\n    // Treat world coords as a sphere normal for spherical coordinates\n    vec2 sphericalLatLong = czm_approximateSphericalCoordinates(worldCoordinate);\n    sphericalLatLong.y += v_uvMinAndSphericalLongitudeRotation.z;\n    sphericalLatLong.y = czm_branchFreeTernary(sphericalLatLong.y < czm_pi, sphericalLatLong.y, sphericalLatLong.y - czm_twoPi);\n    uv.x = (sphericalLatLong.y - v_sphericalExtents.y) * v_sphericalExtents.w;\n    uv.y = (sphericalLatLong.x - v_sphericalExtents.x) * v_sphericalExtents.z;\n#else // SPHERICAL\n    // Unpack planes and transform to eye space\n    uv.x = czm_planeDistance(v_westPlane, eyeCoordinate.xyz / eyeCoordinate.w) * v_inversePlaneExtents.x;\n    uv.y = czm_planeDistance(v_southPlane, eyeCoordinate.xyz / eyeCoordinate.w) * v_inversePlaneExtents.y;\n#endif // SPHERICAL\n#endif // TEXTURE_COORDINATES\n\n#ifdef PICK\n#ifdef CULL_FRAGMENTS\n    // When classifying translucent geometry, logDepthOrDepth == 0.0\n    // indicates a region that should not be classified, possibly due to there\n    // being opaque pixels there in another buffer.\n    // Check for logDepthOrDepth != 0.0 to make sure this should be classified.\n    if (0.0 <= uv.x && uv.x <= 1.0 && 0.0 <= uv.y && uv.y <= 1.0 || logDepthOrDepth != 0.0) {\n        gl_FragColor.a = 1.0; // 0.0 alpha leads to discard from ShaderSource.createPickFragmentShaderSource\n        czm_writeDepthClamp();\n    }\n#else // CULL_FRAGMENTS\n        gl_FragColor.a = 1.0;\n#endif // CULL_FRAGMENTS\n#else // PICK\n\n#ifdef CULL_FRAGMENTS\n    // When classifying translucent geometry, logDepthOrDepth == 0.0\n    // indicates a region that should not be classified, possibly due to there\n    // being opaque pixels there in another buffer.\n    if (uv.x <= 0.0 || 1.0 <= uv.x || uv.y <= 0.0 || 1.0 <= uv.y || logDepthOrDepth == 0.0) {\n        discard;\n    }\n#endif\n\n#ifdef NORMAL_EC\n    // Compute normal by sampling adjacent pixels in 2x2 block in screen space\n    vec3 downUp = vectorFromOffset(eyeCoordinate, vec2(0.0, 1.0));\n    vec3 leftRight = vectorFromOffset(eyeCoordinate, vec2(1.0, 0.0));\n    vec3 normalEC = normalize(cross(leftRight, downUp));\n#endif\n\n\n#ifdef PER_INSTANCE_COLOR\n\n    vec4 color = czm_gammaCorrect(v_color);\n#ifdef FLAT\n    gl_FragColor = color;\n#else // FLAT\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = -eyeCoordinate.xyz;\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    material.diffuse = color.rgb;\n    material.alpha = color.a;\n\n    gl_FragColor = czm_phong(normalize(-eyeCoordinate.xyz), material, czm_lightDirectionEC);\n#endif // FLAT\n\n    // Premultiply alpha. Required for classification primitives on translucent globe.\n    gl_FragColor.rgb *= gl_FragColor.a;\n\n#else // PER_INSTANCE_COLOR\n\n    // Material support.\n    // USES_ is distinct from REQUIRES_, because some things are dependencies of each other or\n    // dependencies for culling but might not actually be used by the material.\n\n    czm_materialInput materialInput;\n\n#ifdef USES_NORMAL_EC\n    materialInput.normalEC = normalEC;\n#endif\n\n#ifdef USES_POSITION_TO_EYE_EC\n    materialInput.positionToEyeEC = -eyeCoordinate.xyz;\n#endif\n\n#ifdef USES_TANGENT_TO_EYE\n    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(worldCoordinate, normalEC);\n#endif\n\n#ifdef USES_ST\n    // Remap texture coordinates from computed (approximately aligned with cartographic space) to the desired\n    // texture coordinate system, which typically forms a tight oriented bounding box around the geometry.\n    // Shader is provided a set of reference points for remapping.\n    materialInput.st.x = czm_lineDistance(v_uvMinAndSphericalLongitudeRotation.xy, v_uMaxAndInverseDistance.xy, uv) * v_uMaxAndInverseDistance.z;\n    materialInput.st.y = czm_lineDistance(v_uvMinAndSphericalLongitudeRotation.xy, v_vMaxAndInverseDistance.xy, uv) * v_vMaxAndInverseDistance.z;\n#endif\n\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else // FLAT\n    gl_FragColor = czm_phong(normalize(-eyeCoordinate.xyz), material, czm_lightDirectionEC);\n#endif // FLAT\n\n    // Premultiply alpha. Required for classification primitives on translucent globe.\n    gl_FragColor.rgb *= gl_FragColor.a;\n\n#endif // PER_INSTANCE_COLOR\n    czm_writeDepthClamp();\n#endif // PICK\n}\n";function iY(e,t,n){D.typeOf.bool("extentsCulling",e),D.typeOf.bool("planarExtents",t),D.typeOf.object("appearance",n),this._projectionExtentDefines={eastMostYhighDefine:"",eastMostYlowDefine:"",westMostYhighDefine:"",westMostYlowDefine:""};const i=new cY;i.requiresTextureCoordinates=e,i.requiresEC=!n.flat;const o=new cY;if(o.requiresTextureCoordinates=e,n instanceof LU)i.requiresNormalEC=!n.flat;else{const e=`${n.material.shaderSource}\n${n.fragmentShaderSource}`;i.normalEC=-1!==e.indexOf("materialInput.normalEC")||-1!==e.indexOf("czm_getDefaultMaterial"),i.positionToEyeEC=-1!==e.indexOf("materialInput.positionToEyeEC"),i.tangentToEyeMatrix=-1!==e.indexOf("materialInput.tangentToEyeMatrix"),i.st=-1!==e.indexOf("materialInput.st")}this._colorShaderDependencies=i,this._pickShaderDependencies=o,this._appearance=n,this._extentsCulling=e,this._planarExtents=t}iY.prototype.createFragmentShader=function(e){D.typeOf.bool("columbusView2D",e);const t=this._appearance,n=this._colorShaderDependencies,i=[];e||this._planarExtents||i.push("SPHERICAL"),n.requiresEC&&i.push("REQUIRES_EC"),n.requiresWC&&i.push("REQUIRES_WC"),n.requiresTextureCoordinates&&i.push("TEXTURE_COORDINATES"),this._extentsCulling&&i.push("CULL_FRAGMENTS"),n.requiresNormalEC&&i.push("NORMAL_EC"),t instanceof LU&&i.push("PER_INSTANCE_COLOR"),n.normalEC&&i.push("USES_NORMAL_EC"),n.positionToEyeEC&&i.push("USES_POSITION_TO_EYE_EC"),n.tangentToEyeMatrix&&i.push("USES_TANGENT_TO_EYE"),n.st&&i.push("USES_ST"),t.flat&&i.push("FLAT");let o="";return t instanceof LU||(o=t.material.shaderSource),new tq({defines:i,sources:[o,nY]})},iY.prototype.createPickFragmentShader=function(e){D.typeOf.bool("columbusView2D",e);const t=this._pickShaderDependencies,n=["PICK"];return e||this._planarExtents||n.push("SPHERICAL"),t.requiresEC&&n.push("REQUIRES_EC"),t.requiresWC&&n.push("REQUIRES_WC"),t.requiresTextureCoordinates&&n.push("TEXTURE_COORDINATES"),this._extentsCulling&&n.push("CULL_FRAGMENTS"),new tq({defines:n,sources:[nY],pickColorQualifier:"varying"})},iY.prototype.createVertexShader=function(e,t,n,i){return D.defined("defines",e),D.typeOf.string("vertexShaderSource",t),D.typeOf.bool("columbusView2D",n),D.defined("mapProjection",i),aY(this._colorShaderDependencies,this._planarExtents,n,e,t,this._appearance,i,this._projectionExtentDefines)},iY.prototype.createPickVertexShader=function(e,t,n,i){return D.defined("defines",e),D.typeOf.string("vertexShaderSource",t),D.typeOf.bool("columbusView2D",n),D.defined("mapProjection",i),aY(this._pickShaderDependencies,this._planarExtents,n,e,t,void 0,i,this._projectionExtentDefines)};const oY=new K,rY=new se,sY={high:0,low:0};function aY(e,t,n,i,o,r,s,a){const c=i.slice();if(""===a.eastMostYhighDefine){const e=rY;e.longitude=z.PI,e.latitude=0,e.height=0;const t=s.project(e,oY);let n=Nm.encode(t.x,sY);a.eastMostYhighDefine=`EAST_MOST_X_HIGH ${n.high.toFixed(`${n.high}`.length+1)}`,a.eastMostYlowDefine=`EAST_MOST_X_LOW ${n.low.toFixed(`${n.low}`.length+1)}`;const i=rY;i.longitude=-z.PI,i.latitude=0,i.height=0;const o=s.project(i,oY);n=Nm.encode(o.x,sY),a.westMostYhighDefine=`WEST_MOST_X_HIGH ${n.high.toFixed(`${n.high}`.length+1)}`,a.westMostYlowDefine=`WEST_MOST_X_LOW ${n.low.toFixed(`${n.low}`.length+1)}`}return n&&(c.push(a.eastMostYhighDefine),c.push(a.eastMostYlowDefine),c.push(a.westMostYhighDefine),c.push(a.westMostYlowDefine)),C(r)&&r instanceof LU&&c.push("PER_INSTANCE_COLOR"),e.requiresTextureCoordinates&&(c.push("TEXTURE_COORDINATES"),t||n||c.push("SPHERICAL"),n&&c.push("COLUMBUS_VIEW_2D")),new tq({defines:c,sources:[o]})}function cY(){this._requiresEC=!1,this._requiresWC=!1,this._requiresNormalEC=!1,this._requiresTextureCoordinates=!1,this._usesNormalEC=!1,this._usesPositionToEyeEC=!1,this._usesTangentToEyeMat=!1,this._usesSt=!1}function lY(e,t,n){return Math.abs((t.y-e.y)*n.x-(t.x-e.x)*n.y+t.x*e.y-t.y*e.x)/ro.distance(t,e)}Object.defineProperties(cY.prototype,{requiresEC:{get:function(){return this._requiresEC},set:function(e){this._requiresEC=e||this._requiresEC}},requiresWC:{get:function(){return this._requiresWC},set:function(e){this._requiresWC=e||this._requiresWC,this.requiresEC=this._requiresWC}},requiresNormalEC:{get:function(){return this._requiresNormalEC},set:function(e){this._requiresNormalEC=e||this._requiresNormalEC,this.requiresEC=this._requiresNormalEC}},requiresTextureCoordinates:{get:function(){return this._requiresTextureCoordinates},set:function(e){this._requiresTextureCoordinates=e||this._requiresTextureCoordinates,this.requiresWC=this._requiresTextureCoordinates}},normalEC:{set:function(e){this.requiresNormalEC=e,this._usesNormalEC=e},get:function(){return this._usesNormalEC}},tangentToEyeMatrix:{set:function(e){this.requiresWC=e,this.requiresNormalEC=e,this._usesTangentToEyeMat=e},get:function(){return this._usesTangentToEyeMat}},positionToEyeEC:{set:function(e){this.requiresEC=e,this._usesPositionToEyeEC=e},get:function(){return this._usesPositionToEyeEC}},st:{set:function(e){this.requiresTextureCoordinates=e,this._usesSt=e},get:function(){return this._usesSt}}});const uY=[new ro,new ro,new ro,new ro];function hY(e,t){const n=uY,i=ro.unpack(t,0,n[0]),o=ro.unpack(t,2,n[1]),r=ro.unpack(t,4,n[2]);e.uMaxVmax=new zE({componentDatatype:ih.FLOAT,componentsPerAttribute:4,normalize:!1,value:[o.x,o.y,r.x,r.y]});const s=1/lY(i,o,r),a=1/lY(i,r,o);e.uvMinAndExtents=new zE({componentDatatype:ih.FLOAT,componentsPerAttribute:4,normalize:!1,value:[i.x,i.y,s,a]})}const dY=new se,fY=new K,pY=new K,mY=new K,_Y={high:0,low:0};function gY(e,t,n){const i=dY;i.height=0,i.longitude=e.west,i.latitude=e.south;const o=t.project(i,fY);i.latitude=e.north;const r=t.project(i,pY);i.longitude=e.east,i.latitude=e.south;const s=t.project(i,mY),a=[0,0,0,0],c=[0,0,0,0];let l=Nm.encode(o.x,_Y);a[0]=l.high,c[0]=l.low,l=Nm.encode(o.y,_Y),a[1]=l.high,c[1]=l.low,l=Nm.encode(r.y,_Y),a[2]=l.high,c[2]=l.low,l=Nm.encode(s.x,_Y),a[3]=l.high,c[3]=l.low,n.planes2D_HIGH=new zE({componentDatatype:ih.FLOAT,componentsPerAttribute:4,normalize:!1,value:a}),n.planes2D_LOW=new zE({componentDatatype:ih.FLOAT,componentsPerAttribute:4,normalize:!1,value:c})}const yY=new ft,vY=new ft,bY=new K,AY=new se,wY=[new se,new se,new se,new se,new se,new se,new se,new se];function TY(e,t,n,i,o,r){const s=_t.center(e,AY);s.height=n;const a=se.toCartesian(s,t,bY),c=Kl.eastNorthUpToFixedFrame(a,t,yY),l=ft.inverse(c,vY),u=e.west,h=e.east,d=e.north,f=e.south,p=wY;p[0].latitude=f,p[0].longitude=u,p[1].latitude=d,p[1].longitude=u,p[2].latitude=d,p[2].longitude=h,p[3].latitude=f,p[3].longitude=h;const m=.5*(u+h),_=.5*(d+f);p[4].latitude=f,p[4].longitude=m,p[5].latitude=d,p[5].longitude=m,p[6].latitude=_,p[6].longitude=u,p[7].latitude=_,p[7].longitude=h;let g=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,v=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY;for(let C=0;C<8;C++){p[C].height=n;const e=se.toCartesian(p[C],t,bY);ft.multiplyByPoint(l,e,e),e.z=0,g=Math.min(g,e.x),y=Math.max(y,e.x),v=Math.min(v,e.y),b=Math.max(b,e.y)}const A=i;A.x=g,A.y=v,A.z=0,ft.multiplyByPoint(c,A,A);const w=o;w.x=y,w.y=v,w.z=0,ft.multiplyByPoint(c,w,w),K.subtract(w,A,o);const T=r;T.x=g,T.y=b,T.z=0,ft.multiplyByPoint(c,T,T),K.subtract(T,A,r)}const CY=new K,EY=new K,xY=new Nm;iY.getPlanarTextureCoordinateAttributes=function(e,t,n,i,o){D.typeOf.object("boundingRectangle",e),D.defined("textureCoordinateRotationPoints",t),D.typeOf.object("ellipsoid",n),D.typeOf.object("projection",i);const r=fY,s=CY,a=EY;TY(e,n,R(o,0),r,s,a);const c={};hY(c,t);const l=Nm.fromCartesian(r,xY);return c.southWest_HIGH=new zE({componentDatatype:ih.FLOAT,componentsPerAttribute:3,normalize:!1,value:K.pack(l.high,[0,0,0])}),c.southWest_LOW=new zE({componentDatatype:ih.FLOAT,componentsPerAttribute:3,normalize:!1,value:K.pack(l.low,[0,0,0])}),c.eastward=new zE({componentDatatype:ih.FLOAT,componentsPerAttribute:3,normalize:!1,value:K.pack(s,[0,0,0])}),c.northward=new zE({componentDatatype:ih.FLOAT,componentsPerAttribute:3,normalize:!1,value:K.pack(a,[0,0,0])}),gY(e,i,c),c};const SY=new K;function IY(e,t,n,i){const o=dY;o.latitude=e,o.longitude=t,o.height=0;const r=se.toCartesian(o,n,SY),s=Math.sqrt(r.x*r.x+r.y*r.y),a=z.fastApproximateAtan2(s,r.z),c=z.fastApproximateAtan2(r.x,r.y);return i.x=a,i.y=c,i}const OY=new ro;function DY(e){return Math.max(e.width,e.height)>iY.MAX_WIDTH_FOR_PLANAR_EXTENTS}iY.getSphericalExtentGeometryInstanceAttributes=function(e,t,n,i){D.typeOf.object("boundingRectangle",e),D.defined("textureCoordinateRotationPoints",t),D.typeOf.object("ellipsoid",n),D.typeOf.object("projection",i);const o=IY(e.south,e.west,n,OY);let r=o.x,s=o.y;const a=IY(e.north,e.east,n,OY);let c=a.x,l=a.y,u=0;s>l&&(u=z.PI-s,s=-z.PI,l+=u),r-=z.EPSILON5,s-=z.EPSILON5,c+=z.EPSILON5,l+=z.EPSILON5;const h=1/(l-s),d=1/(c-r),f={sphericalExtents:new zE({componentDatatype:ih.FLOAT,componentsPerAttribute:4,normalize:!1,value:[r,s,d,h]}),longitudeRotation:new zE({componentDatatype:ih.FLOAT,componentsPerAttribute:1,normalize:!1,value:[u]})};return hY(f,t),gY(e,i,f),f},iY.hasAttributesForTextureCoordinatePlanes=function(e){return C(e.southWest_HIGH)&&C(e.southWest_LOW)&&C(e.northward)&&C(e.eastward)&&C(e.planes2D_HIGH)&&C(e.planes2D_LOW)&&C(e.uMaxVmax)&&C(e.uvMinAndExtents)},iY.hasAttributesForSphericalExtents=function(e){return C(e.sphericalExtents)&&C(e.longitudeRotation)&&C(e.planes2D_HIGH)&&C(e.planes2D_LOW)&&C(e.uMaxVmax)&&C(e.uvMinAndExtents)},iY.shouldUseSphericalCoordinates=function(e){return D.typeOf.object("rectangle",e),DY(e)},iY.MAX_WIDTH_FOR_PLANAR_EXTENTS=z.toRadians(1);var PY=iY;const RY={NEVER:th.NEVER,LESS:th.LESS,EQUAL:th.EQUAL,LESS_OR_EQUAL:th.LEQUAL,GREATER:th.GREATER,NOT_EQUAL:th.NOTEQUAL,GREATER_OR_EQUAL:th.GEQUAL,ALWAYS:th.ALWAYS};var LY=Object.freeze(RY);const MY={ZERO:th.ZERO,KEEP:th.KEEP,REPLACE:th.REPLACE,INCREMENT:th.INCR,DECREMENT:th.DECR,INVERT:th.INVERT,INCREMENT_WRAP:th.INCR_WRAP,DECREMENT_WRAP:th.DECR_WRAP};var BY=Object.freeze(MY);const NY={CESIUM_3D_TILE_MASK:128,SKIP_LOD_MASK:112,SKIP_LOD_BIT_SHIFT:4,CLASSIFICATION_MASK:15,setCesium3DTileBit:function(){return{enabled:!0,frontFunction:LY.ALWAYS,frontOperation:{fail:BY.KEEP,zFail:BY.KEEP,zPass:BY.REPLACE},backFunction:LY.ALWAYS,backOperation:{fail:BY.KEEP,zFail:BY.KEEP,zPass:BY.REPLACE},reference:NY.CESIUM_3D_TILE_MASK,mask:NY.CESIUM_3D_TILE_MASK}}};var FY=Object.freeze(NY);function zY(e){e=R(e,R.EMPTY_OBJECT);const t=e.geometryInstances;this.geometryInstances=t,this.show=R(e.show,!0),this.classificationType=R(e.classificationType,rq.BOTH),this.debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this.debugShowShadowVolume=R(e.debugShowShadowVolume,!1),this._debugShowShadowVolume=!1,this._extruded=R(e._extruded,!1),this._uniformMap=e._uniformMap,this._sp=void 0,this._spStencil=void 0,this._spPick=void 0,this._spColor=void 0,this._spPick2D=void 0,this._spColor2D=void 0,this._rsStencilDepthPass=void 0,this._rsStencilDepthPass3DTiles=void 0,this._rsColorPass=void 0,this._rsPickPass=void 0,this._commandsIgnoreShow=[],this._ready=!1,this._readyPromise=yn(),this._primitive=void 0,this._pickPrimitive=e._pickPrimitive,this._hasSphericalExtentsAttribute=!1,this._hasPlanarExtentsAttributes=!1,this._hasPerColorAttribute=!1,this.appearance=e.appearance,this._createBoundingVolumeFunction=e._createBoundingVolumeFunction,this._updateAndQueueCommandsFunction=e._updateAndQueueCommandsFunction,this._usePickOffsets=!1,this._primitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:R(e.vertexCacheOptimize,!1),interleave:R(e.interleave,!1),releaseGeometryInstances:R(e.releaseGeometryInstances,!0),allowPicking:R(e.allowPicking,!0),asynchronous:R(e.asynchronous,!0),compressVertices:R(e.compressVertices,!0),_createBoundingVolumeFunction:void 0,_createRenderStatesFunction:void 0,_createShaderProgramFunction:void 0,_createCommandsFunction:void 0,_updateAndQueueCommandsFunction:void 0,_createPickOffsets:!0}}function kY(e,t){const n=t?LY.EQUAL:LY.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:e,frontFunction:n,frontOperation:{fail:BY.KEEP,zFail:BY.DECREMENT_WRAP,zPass:BY.KEEP},backFunction:n,backOperation:{fail:BY.KEEP,zFail:BY.INCREMENT_WRAP,zPass:BY.KEEP},reference:FY.CESIUM_3D_TILE_MASK,mask:FY.CESIUM_3D_TILE_MASK},stencilMask:FY.CLASSIFICATION_MASK,depthTest:{enabled:!0,func:aq.LESS_OR_EQUAL},depthMask:!1}}function UY(e){return{stencilTest:{enabled:e,frontFunction:LY.NOT_EQUAL,frontOperation:{fail:BY.ZERO,zFail:BY.ZERO,zPass:BY.ZERO},backFunction:LY.NOT_EQUAL,backOperation:{fail:BY.ZERO,zFail:BY.ZERO,zPass:BY.ZERO},reference:0,mask:FY.CLASSIFICATION_MASK},stencilMask:FY.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:_k.PRE_MULTIPLIED_ALPHA_BLEND}}Object.defineProperties(zY.prototype,{vertexCacheOptimize:{get:function(){return this._primitiveOptions.vertexCacheOptimize}},interleave:{get:function(){return this._primitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._primitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._primitiveOptions.allowPicking}},asynchronous:{get:function(){return this._primitiveOptions.asynchronous}},compressVertices:{get:function(){return this._primitiveOptions.compressVertices}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},_needs2DShader:{get:function(){return this._hasPlanarExtentsAttributes||this._hasSphericalExtentsAttribute}}}),zY.isSupported=function(e){return e.context.stencilBuffer};const VY={stencilTest:{enabled:!0,frontFunction:LY.NOT_EQUAL,frontOperation:{fail:BY.ZERO,zFail:BY.ZERO,zPass:BY.ZERO},backFunction:LY.NOT_EQUAL,backOperation:{fail:BY.ZERO,zFail:BY.ZERO,zPass:BY.ZERO},reference:0,mask:FY.CLASSIFICATION_MASK},stencilMask:FY.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1};function HY(e,t,n,i){if(C(e._rsStencilDepthPass))return;const o=!e.debugShowShadowVolume;e._rsStencilDepthPass=yV.fromCache(kY(o,!1)),e._rsStencilDepthPass3DTiles=yV.fromCache(kY(o,!0)),e._rsColorPass=yV.fromCache(UY(o,!1)),e._rsPickPass=yV.fromCache(VY)}function GY(e,t){if(!e.compressVertices)return t;if(-1!==t.search(/attribute\s+vec3\s+extrudeDirection;/g)){const e="compressedAttributes",n=`attribute vec2 ${e};`,i="vec3 extrudeDirection;\n",o=`    extrudeDirection = czm_octDecode(${e}, 65535.0);\n`;let r=t;r=r.replace(/attribute\s+vec3\s+extrudeDirection;/g,""),r=tq.replaceMain(r,"czm_non_compressed_main");const s=`void main() \n{ \n${o}    czm_non_compressed_main(); \n}`;return[n,i,r,s].join("\n")}}function WY(e,t){const n=t.context,i=e._primitive;let o=nq;o=e._primitive._batchTable.getVertexShaderCallback()(o),o=tY._appendDistanceDisplayConditionToShader(i,o),o=tY._modifyShaderPosition(e,o,t.scene3DOnly),o=tY._updateColorAttribute(i,o);const r=e._hasPlanarExtentsAttributes,s=r||e._hasSphericalExtentsAttribute;e._extruded&&(o=GY(i,o));const a=e._extruded?"EXTRUDED_GEOMETRY":"";let c=new tq({defines:[a],sources:[o]});const l=new tq({sources:[iq]}),u=e._primitive._attributeLocations,h=new PY(s,r,e.appearance);if(e._spStencil=fH.replaceCache({context:n,shaderProgram:e._spStencil,vertexShaderSource:c,fragmentShaderSource:l,attributeLocations:u}),e._primitive.allowPicking){let r=tq.createPickVertexShaderSource(o);r=tY._appendShowToShader(i,r),r=tY._updatePickColorAttribute(r);const c=h.createPickFragmentShader(!1),l=h.createPickVertexShader([a],r,!1,t.mapProjection);if(e._spPick=fH.replaceCache({context:n,shaderProgram:e._spPick,vertexShaderSource:l,fragmentShaderSource:c,attributeLocations:u}),s){let i=n.shaderCache.getDerivedShaderProgram(e._spPick,"2dPick");if(!C(i)){const o=h.createPickFragmentShader(!0),s=h.createPickVertexShader([a],r,!0,t.mapProjection);i=n.shaderCache.createDerivedShaderProgram(e._spPick,"2dPick",{vertexShaderSource:s,fragmentShaderSource:o,attributeLocations:u})}e._spPick2D=i}}else e._spPick=fH.fromCache({context:n,vertexShaderSource:c,fragmentShaderSource:l,attributeLocations:u});o=tY._appendShowToShader(i,o),c=new tq({defines:[a],sources:[o]}),e._sp=fH.replaceCache({context:n,shaderProgram:e._sp,vertexShaderSource:c,fragmentShaderSource:l,attributeLocations:u});const d=h.createFragmentShader(!1),f=h.createVertexShader([a],o,!1,t.mapProjection);if(e._spColor=fH.replaceCache({context:n,shaderProgram:e._spColor,vertexShaderSource:f,fragmentShaderSource:d,attributeLocations:u}),s){let i=n.shaderCache.getDerivedShaderProgram(e._spColor,"2dColor");if(!C(i)){const r=h.createFragmentShader(!0),s=h.createVertexShader([a],o,!0,t.mapProjection);i=n.shaderCache.createDerivedShaderProgram(e._spColor,"2dColor",{vertexShaderSource:s,fragmentShaderSource:r,attributeLocations:u})}e._spColor2D=i}}function qY(e,t){const n=e._primitive;let i,o,r,s=2*n._va.length;t.length=s;let a=0,c=n._batchTable.getUniformMapCallback()(e._uniformMap);const l=e._needs2DShader;for(i=0;i<s;i+=2){const s=n._va[a++];o=t[i],C(o)||(o=t[i]=new UU({owner:e,primitiveType:n._primitiveType})),o.vertexArray=s,o.renderState=e._rsStencilDepthPass,o.shaderProgram=e._sp,o.uniformMap=c,o.pass=HU.TERRAIN_CLASSIFICATION,r=UU.shallowClone(o,o.derivedCommands.tileset),r.renderState=e._rsStencilDepthPass3DTiles,r.pass=HU.CESIUM_3D_TILE_CLASSIFICATION,o.derivedCommands.tileset=r,o=t[i+1],C(o)||(o=t[i+1]=new UU({owner:e,primitiveType:n._primitiveType})),o.vertexArray=s,o.renderState=e._rsColorPass,o.shaderProgram=e._spColor,o.pass=HU.TERRAIN_CLASSIFICATION;const u=e.appearance,h=u.material;if(C(h)&&(c=_n(c,h._uniforms)),o.uniformMap=c,r=UU.shallowClone(o,o.derivedCommands.tileset),r.pass=HU.CESIUM_3D_TILE_CLASSIFICATION,o.derivedCommands.tileset=r,l){let t=UU.shallowClone(o,o.derivedCommands.appearance2D);t.shaderProgram=e._spColor2D,o.derivedCommands.appearance2D=t,t=UU.shallowClone(r,r.derivedCommands.appearance2D),t.shaderProgram=e._spColor2D,r.derivedCommands.appearance2D=t}}const u=e._commandsIgnoreShow,h=e._spStencil;let d=0;s=u.length=s/2;for(let f=0;f<s;++f){const e=u[f]=UU.shallowClone(t[d],u[f]);e.shaderProgram=h,e.pass=HU.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,d+=2}}function jY(e,t){const n=e._usePickOffsets,i=e._primitive;let o,r,s,a,c,l=2*i._va.length,u=0;n&&(o=i._pickOffsets,l=2*o.length),t.length=l;let h=0;const d=i._batchTable.getUniformMapCallback()(e._uniformMap),f=e._needs2DShader;for(s=0;s<l;s+=2){let l=i._va[h++];if(n&&(r=o[u++],l=i._va[r.index]),a=t[s],C(a)||(a=t[s]=new UU({owner:e,primitiveType:i._primitiveType,pickOnly:!0})),a.vertexArray=l,a.renderState=e._rsStencilDepthPass,a.shaderProgram=e._sp,a.uniformMap=d,a.pass=HU.TERRAIN_CLASSIFICATION,n&&(a.offset=r.offset,a.count=r.count),c=UU.shallowClone(a,a.derivedCommands.tileset),c.renderState=e._rsStencilDepthPass3DTiles,c.pass=HU.CESIUM_3D_TILE_CLASSIFICATION,a.derivedCommands.tileset=c,a=t[s+1],C(a)||(a=t[s+1]=new UU({owner:e,primitiveType:i._primitiveType,pickOnly:!0})),a.vertexArray=l,a.renderState=e._rsPickPass,a.shaderProgram=e._spPick,a.uniformMap=d,a.pass=HU.TERRAIN_CLASSIFICATION,n&&(a.offset=r.offset,a.count=r.count),c=UU.shallowClone(a,a.derivedCommands.tileset),c.pass=HU.CESIUM_3D_TILE_CLASSIFICATION,a.derivedCommands.tileset=c,f){let t=UU.shallowClone(a,a.derivedCommands.pick2D);t.shaderProgram=e._spPick2D,a.derivedCommands.pick2D=t,t=UU.shallowClone(c,c.derivedCommands.pick2D),t.shaderProgram=e._spPick2D,c.derivedCommands.pick2D=t}}}function YY(e,t,n,i,o,r,s){qY(e,r),jY(e,s)}function KY(e,t){return Math.floor(e%t/2)}function XY(e,t,n,i,o,r){e.modelMatrix=n,e.boundingVolume=o,e.cull=i,e.debugShowBoundingVolume=r,t.commandList.push(e)}function QY(e,t,n,i,o){e.modelMatrix=n,e.boundingVolume=o,e.cull=i,t.commandList.push(e)}function JY(e,t,n,i,o,r,s,a){const c=e._primitive;let l;tY._updateBoundingVolumes(c,t,o),t.mode===ij.SCENE3D?l=c._boundingSphereWC:t.mode===ij.COLUMBUS_VIEW?l=c._boundingSphereCV:t.mode===ij.SCENE2D&&C(c._boundingSphere2D)?l=c._boundingSphere2D:C(c._boundingSphereMorph)&&(l=c._boundingSphereMorph);const u=e.classificationType,h=u!==rq.CESIUM_3D_TILE,d=u!==rq.TERRAIN,f=t.passes;let p,m,_;if(f.render){const i=n.length;for(p=0;p<i;++p)m=l[KY(p,i)],h&&(_=n[p],XY(_,t,o,r,m,s)),d&&(_=n[p].derivedCommands.tileset,XY(_,t,o,r,m,s));if(t.invertClassification){const n=e._commandsIgnoreShow,i=n.length;for(p=0;p<i;++p)m=l[p],_=n[p],XY(_,t,o,r,m,s)}}if(f.pick){const e=i.length,n=c._pickOffsets;for(p=0;p<e;++p){const s=n[KY(p,e)];m=l[s.index],h&&(_=i[p],QY(_,t,o,r,m)),d&&(_=i[p].derivedCommands.tileset,QY(_,t,o,r,m))}}}zY.prototype.update=function(e){if(!C(this._primitive)&&!C(this.geometryInstances))return;let t=this.appearance;C(t)&&C(t.material)&&t.material.update(e.context);const n=this,i=this._primitiveOptions;if(!C(this._primitive)){const e=Array.isArray(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],o=e.length;let r,s,a,c,l=!1,u=!0,h=!1,d=!1;for(o>0&&(a=e[0].attributes,h=PY.hasAttributesForSphericalExtents(a),d=PY.hasAttributesForTextureCoordinatePlanes(a),c=a.color),r=0;r<o;r++){s=e[r];const t=s.attributes.color;if(C(t))l=!0;else if(l)throw new x("All GeometryInstances must have color attributes to use per-instance color.");u=u&&C(t)&&Iy.equals(c,t)}if(!u&&!h&&!d)throw new x("All GeometryInstances must have the same color attribute except via GroundPrimitives");if(l&&!C(t)&&(t=new LU({flat:!0}),this.appearance=t),!l&&t instanceof LU)throw new x("PerInstanceColorAppearance requires color GeometryInstanceAttributes on all GeometryInstances");if(C(t.material)&&!h&&!d)throw new x("Materials on ClassificationPrimitives are not supported except via GroundPrimitives");this._usePickOffsets=!h&&!d,this._hasSphericalExtentsAttribute=h,this._hasPlanarExtentsAttributes=d,this._hasPerColorAttribute=l;const f=new Array(o);for(r=0;r<o;++r)s=e[r],f[r]=new Sm({geometry:s.geometry,attributes:s.attributes,modelMatrix:s.modelMatrix,id:s.id,pickPrimitive:R(this._pickPrimitive,n)});i.appearance=t,i.geometryInstances=f,C(this._createBoundingVolumeFunction)&&(i._createBoundingVolumeFunction=function(e,t){n._createBoundingVolumeFunction(e,t)}),i._createRenderStatesFunction=function(e,t,i,o){HY(n,t)},i._createShaderProgramFunction=function(e,t,i){WY(n,t)},i._createCommandsFunction=function(e,t,i,o,r,s,a){YY(n,void 0,void 0,!0,!1,s,a)},C(this._updateAndQueueCommandsFunction)?i._updateAndQueueCommandsFunction=function(e,t,i,o,r,s,a,c){n._updateAndQueueCommandsFunction(e,t,i,o,r,s,a,c)}:i._updateAndQueueCommandsFunction=function(e,t,i,o,r,s,a,c){JY(n,t,i,o,r,s,a,c)},this._primitive=new tY(i),this._primitive.readyPromise.then((function(e){n._ready=!0,n.releaseGeometryInstances&&(n.geometryInstances=void 0);const t=e._error;C(t)?n._readyPromise.reject(t):n._readyPromise.resolve(n)}))}if(this.debugShowShadowVolume&&!this._debugShowShadowVolume&&this._ready?(this._debugShowShadowVolume=!0,this._rsStencilDepthPass=yV.fromCache(kY(!1,!1)),this._rsStencilDepthPass3DTiles=yV.fromCache(kY(!1,!0)),this._rsColorPass=yV.fromCache(UY(!1))):!this.debugShowShadowVolume&&this._debugShowShadowVolume&&(this._debugShowShadowVolume=!1,this._rsStencilDepthPass=yV.fromCache(kY(!0,!1)),this._rsStencilDepthPass3DTiles=yV.fromCache(kY(!0,!0)),this._rsColorPass=yV.fromCache(UY(!0))),this._primitive.appearance!==t){if(!this._hasSphericalExtentsAttribute&&!this._hasPlanarExtentsAttributes&&C(t.material))throw new x("Materials on ClassificationPrimitives are not supported except via GroundPrimitive");if(!this._hasPerColorAttribute&&t instanceof LU)throw new x("PerInstanceColorAppearance requires color GeometryInstanceAttribute");this._primitive.appearance=t}this._primitive.show=this.show,this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.update(e)},zY.prototype.getGeometryInstanceAttributes=function(e){if(!C(this._primitive))throw new x("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(e)},zY.prototype.isDestroyed=function(){return!1},zY.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._spColor=this._spColor&&this._spColor.destroy(),this._spPick2D=void 0,this._spColor2D=void 0,Qh(this)};var ZY=zY;const $Y={u_globeMinimumAltitude:function(){return 55e3}};function eK(e){e=R(e,R.EMPTY_OBJECT);let t=e.appearance;const n=e.geometryInstances;if(!C(t)&&C(n)){const e=Array.isArray(n)?n:[n],i=e.length;for(let n=0;n<i;n++){const i=e[n].attributes;if(C(i)&&C(i.color)){t=new LU({flat:!0});break}}}this.appearance=t,this.geometryInstances=e.geometryInstances,this.show=R(e.show,!0),this.classificationType=R(e.classificationType,rq.BOTH),this.debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this.debugShowShadowVolume=R(e.debugShowShadowVolume,!1),this._boundingVolumes=[],this._boundingVolumes2D=[],this._ready=!1,this._readyPromise=yn(),this._primitive=void 0,this._maxHeight=void 0,this._minHeight=void 0,this._maxTerrainHeight=bo._defaultMaxTerrainHeight,this._minTerrainHeight=bo._defaultMinTerrainHeight,this._boundingSpheresKeys=[],this._boundingSpheres=[],this._useFragmentCulling=!1,this._zIndex=void 0;const i=this;this._classificationPrimitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:R(e.vertexCacheOptimize,!1),interleave:R(e.interleave,!1),releaseGeometryInstances:R(e.releaseGeometryInstances,!0),allowPicking:R(e.allowPicking,!0),asynchronous:R(e.asynchronous,!0),compressVertices:R(e.compressVertices,!0),_createBoundingVolumeFunction:void 0,_updateAndQueueCommandsFunction:void 0,_pickPrimitive:i,_extruded:!0,_uniformMap:$Y}}function tK(e){return function(t,n){const i=n.maximumRadius,o=i/Math.cos(.5*t)-i;return e._maxHeight+o}}function nK(e){return function(t,n){return e._minHeight}}Object.defineProperties(eK.prototype,{vertexCacheOptimize:{get:function(){return this._classificationPrimitiveOptions.vertexCacheOptimize}},interleave:{get:function(){return this._classificationPrimitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._classificationPrimitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._classificationPrimitiveOptions.allowPicking}},asynchronous:{get:function(){return this._classificationPrimitiveOptions.asynchronous}},compressVertices:{get:function(){return this._classificationPrimitiveOptions.compressVertices}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}}}),eK.isSupported=ZY.isSupported;const iK=new K,oK=new K,rK=new K,sK=new se,aK=new _t;function cK(e,t){const n=e.mapProjection.ellipsoid;if(!C(t.attributes)||!C(t.attributes.position3DHigh))return C(t.rectangle)?t.rectangle:void 0;const i=t.attributes.position3DHigh.values,o=t.attributes.position3DLow.values,r=i.length;let s=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;for(let h=0;h<r;h+=3){const e=K.unpack(i,h,iK),t=K.unpack(o,h,oK),r=K.add(e,t,rK),u=n.cartesianToCartographic(r,sK),d=u.latitude,f=u.longitude;s=Math.min(s,d),a=Math.min(a,f),c=Math.max(c,d),l=Math.max(l,f)}const u=aK;return u.north=c,u.south=s,u.east=l,u.west=a,u}function lK(e,t,n){const i=bo.getMinimumMaximumHeights(t,n);e._minTerrainHeight=i.minimumTerrainHeight,e._maxTerrainHeight=i.maximumTerrainHeight}function uK(e,t,n){const i=t.mapProjection.ellipsoid,o=cK(t,n),r=$u.fromRectangle(o,e._minHeight,e._maxHeight,i);if(e._boundingVolumes.push(r),!t.scene3DOnly){const n=t.mapProjection,i=nn.fromRectangleWithHeights2D(o,n,e._maxHeight,e._minHeight);K.fromElements(i.center.z,i.center.x,i.center.y,i.center),e._boundingVolumes2D.push(i)}}function hK(e,t){return Math.floor(e%t/2)}function dK(e,t,n,i,o,r,s){const a=e._primitive;n.mode!==ij.SCENE3D&&t.shaderProgram===a._spColor&&a._needs2DShader&&(t=t.derivedCommands.appearance2D),t.owner=e,t.modelMatrix=i,t.boundingVolume=r,t.cull=o,t.debugShowBoundingVolume=s,n.commandList.push(t)}function fK(e,t,n,i,o,r){const s=e._primitive;n.mode!==ij.SCENE3D&&t.shaderProgram===s._spPick&&s._needs2DShader&&(t=t.derivedCommands.pick2D),t.owner=e,t.modelMatrix=i,t.boundingVolume=r,t.cull=o,n.commandList.push(t)}function pK(e,t,n,i,o,r,s,a){let c;c=t.mode===ij.SCENE3D?e._boundingVolumes:e._boundingVolumes2D;const l=e.classificationType,u=l!==rq.CESIUM_3D_TILE,h=l!==rq.TERRAIN,d=t.passes,f=e._primitive;let p,m,_;if(d.render){const i=n.length;for(p=0;p<i;++p)m=c[hK(p,i)],u&&(_=n[p],dK(e,_,t,o,r,m,s)),h&&(_=n[p].derivedCommands.tileset,dK(e,_,t,o,r,m,s));if(t.invertClassification){const n=f._commandsIgnoreShow,i=n.length;for(p=0;p<i;++p)m=c[p],_=n[p],dK(e,_,t,o,r,m,s)}}if(d.pick){const n=i.length;let s;for(e._useFragmentCulling||(s=f._primitive._pickOffsets),p=0;p<n;++p){if(m=c[hK(p,n)],!e._useFragmentCulling){const e=s[hK(p,n)];m=c[e.index]}u&&(_=i[p],fK(e,_,t,o,r,m)),h&&(_=i[p].derivedCommands.tileset,fK(e,_,t,o,r,m))}}}eK.initializeTerrainHeights=function(){return bo.initialize()},eK.prototype.update=function(e){if(!C(this._primitive)&&!C(this.geometryInstances))return;if(!bo.initialized){if(!this.asynchronous)throw new x("For synchronous GroundPrimitives, you must call GroundPrimitive.initializeTerrainHeights() and wait for the returned promise to resolve.");return void eK.initializeTerrainHeights()}const t=this,n=this._classificationPrimitiveOptions;if(!C(this._primitive)){const i=e.mapProjection.ellipsoid;let o,r,s;const a=Array.isArray(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],c=a.length,l=new Array(c);let u,h;for(u=0;u<c;++u){o=a[u],r=o.geometry;const t=cK(e,r);C(h)?C(t)&&_t.union(h,t,h):h=_t.clone(t);const n=o.id;if(C(n)&&C(t)){const e=bo.getBoundingSphere(t,i);this._boundingSpheresKeys.push(n),this._boundingSpheres.push(e)}if(s=r.constructor,!C(s)||!C(s.createShadowVolume))throw new x("Not all of the geometry instances have GroundPrimitive support.")}lK(this,h,i);const d=e.terrainExaggeration,f=e.terrainExaggerationRelativeHeight;this._minHeight=Eh.getHeight(this._minTerrainHeight,d,f),this._maxHeight=Eh.getHeight(this._maxTerrainHeight,d,f);const p=eK._supportsMaterials(e.context);if(this._useFragmentCulling=p,p){let t,n=!0;for(u=0;u<c;++u)if(o=a[u],r=o.geometry,h=cK(e,r),PY.shouldUseSphericalCoordinates(h)){n=!1;break}for(u=0;u<c;++u){o=a[u],r=o.geometry,s=r.constructor;const c=cK(e,r),h=r.textureCoordinateRotationPoints;t=n?PY.getPlanarTextureCoordinateAttributes(c,h,i,e.mapProjection,this._maxHeight):PY.getSphericalExtentGeometryInstanceAttributes(c,h,i,e.mapProjection);const d=o.attributes;for(const e in d)d.hasOwnProperty(e)&&(t[e]=d[e]);l[u]=new Sm({geometry:s.createShadowVolume(r,nK(this),tK(this)),attributes:t,id:o.id})}}else for(u=0;u<c;++u)o=a[u],r=o.geometry,s=r.constructor,l[u]=new Sm({geometry:s.createShadowVolume(r,nK(this),tK(this)),attributes:o.attributes,id:o.id});n.geometryInstances=l,n.appearance=this.appearance,n._createBoundingVolumeFunction=function(e,n){uK(t,e,n)},n._updateAndQueueCommandsFunction=function(e,n,i,o,r,s,a,c){pK(t,n,i,o,r,s,a,c)},this._primitive=new ZY(n),this._primitive.readyPromise.then((function(e){t._ready=!0,t.releaseGeometryInstances&&(t.geometryInstances=void 0);const n=e._error;C(n)?t._readyPromise.reject(n):t._readyPromise.resolve(t)}))}this._primitive.appearance=this.appearance,this._primitive.show=this.show,this._primitive.debugShowShadowVolume=this.debugShowShadowVolume,this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.update(e)},eK.prototype.getBoundingSphere=function(e){const t=this._boundingSpheresKeys.indexOf(e);if(-1!==t)return this._boundingSpheres[t]},eK.prototype.getGeometryInstanceAttributes=function(e){if(!C(this._primitive))throw new x("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(e)},eK.prototype.isDestroyed=function(){return!1},eK.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Qh(this)},eK._supportsMaterials=function(e){return e.depthTexture},eK.supportsMaterials=function(e){return D.typeOf.object("scene",e),eK._supportsMaterials(e.frameState.context)};var mK=eK;function _K(){x.throwInstantiationError()}Object.defineProperties(_K.prototype,{isConstant:{get:x.throwInstantiationError},definitionChanged:{get:x.throwInstantiationError}}),_K.prototype.getType=x.throwInstantiationError,_K.prototype.getValue=x.throwInstantiationError,_K.prototype.equals=x.throwInstantiationError,_K.getValue=function(e,t,n){let i;return C(t)&&(i=t.getType(e),C(i))?(C(n)&&n.type===i||(n=EU.fromType(i)),t.getValue(e,n.uniforms),n):(C(n)&&n.type===EU.ColorType||(n=EU.fromType(EU.ColorType)),xy.clone(xy.WHITE,n.uniforms.color),n)};var gK=_K;function yK(e,t,n){D.defined("geometryUpdater",e),D.defined("primitives",t),D.defined("orderedGroundPrimitives",n),this._primitives=t,this._orderedGroundPrimitives=n,this._primitive=void 0,this._outlinePrimitive=void 0,this._geometryUpdater=e,this._options=e._options,this._entity=e._entity,this._material=void 0}yK.prototype._isHidden=function(e,t,n){return!e.isShowing||!e.isAvailable(n)||!Bz.getValueOrDefault(t.show,n,!0)},yK.prototype._setOptions=x.throwInstantiationError,yK.prototype.update=function(e){D.defined("time",e);const t=this._geometryUpdater,n=t._onTerrain,i=this._primitives,o=this._orderedGroundPrimitives;n?o.remove(this._primitive):(i.removeAndDestroy(this._primitive),i.removeAndDestroy(this._outlinePrimitive),this._outlinePrimitive=void 0),this._primitive=void 0;const r=this._entity,s=r[this._geometryUpdater._geometryPropertyName];if(this._setOptions(r,s,e),this._isHidden(r,s,e))return;const a=this._geometryUpdater.shadowsProperty.getValue(e),c=this._options;if(!C(s.fill)||s.fill.getValue(e)){const r=t.fillMaterialProperty,s=r instanceof BU;let l;const u=t._getIsClosed(c);if(s)l=new LU({closed:u,flat:n&&!t._supportsMaterialsforEntitiesOnTerrain});else{const t=gK.getValue(e,r,this._material);this._material=t,l=new SU({material:t,translucent:t.isTranslucent(),closed:u})}if(n)c.vertexFormat=LU.VERTEX_FORMAT,this._primitive=o.add(new mK({geometryInstances:this._geometryUpdater.createFillGeometryInstance(e),appearance:l,asynchronous:!1,shadows:a,classificationType:this._geometryUpdater.classificationTypeProperty.getValue(e)}),Bz.getValueOrUndefined(this._geometryUpdater.zIndex,e));else{c.vertexFormat=l.vertexFormat;const t=this._geometryUpdater.createFillGeometryInstance(e);s&&(l.translucent=255!==t.attributes.color.value[3]),this._primitive=i.add(new tY({geometryInstances:t,appearance:l,asynchronous:!1,shadows:a}))}}if(!n&&C(s.outline)&&s.outline.getValue(e)){const n=this._geometryUpdater.createOutlineGeometryInstance(e),o=Bz.getValueOrDefault(s.outlineWidth,e,1);this._outlinePrimitive=i.add(new tY({geometryInstances:n,appearance:new LU({flat:!0,translucent:255!==n.attributes.color.value[3],renderState:{lineWidth:t._scene.clampLineWidth(o)}}),asynchronous:!1,shadows:a}))}},yK.prototype.getBoundingSphere=function(e){if(!C(e))throw new x("result is required.");const t=this._entity,n=this._primitive,i=this._outlinePrimitive;let o;return C(n)&&n.show&&n.ready&&(o=n.getGeometryInstanceAttributes(t),C(o)&&C(o.boundingSphere))||C(i)&&i.show&&i.ready&&(o=i.getGeometryInstanceAttributes(t),C(o)&&C(o.boundingSphere))?(nn.clone(o.boundingSphere,e),Lz.DONE):C(n)&&!n.ready||C(i)&&!i.ready?Lz.PENDING:Lz.FAILED},yK.prototype.isDestroyed=function(){return!1},yK.prototype.destroy=function(){const e=this._primitives,t=this._orderedGroundPrimitives;this._geometryUpdater._onTerrain?t.remove(this._primitive):e.removeAndDestroy(this._primitive),e.removeAndDestroy(this._outlinePrimitive),Qh(this)};var vK=yK,bK='#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n\nvarying vec4 v_startPlaneNormalEcAndHalfWidth;\nvarying vec4 v_endPlaneNormalEcAndBatchId;\nvarying vec4 v_rightPlaneEC; // Technically can compute distance for this here\nvarying vec4 v_endEcAndStartEcX;\nvarying vec4 v_texcoordNormalizationAndStartEcYZ;\n\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#endif\n\nvoid main(void)\n{\n    float logDepthOrDepth = czm_branchFreeTernary(czm_sceneMode == czm_sceneMode2D, gl_FragCoord.z, czm_unpackDepth(texture2D(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw)));\n    vec3 ecStart = vec3(v_endEcAndStartEcX.w, v_texcoordNormalizationAndStartEcYZ.zw);\n\n    // Discard for sky\n    if (logDepthOrDepth == 0.0) {\n#ifdef DEBUG_SHOW_VOLUME\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 0.5);\n        return;\n#else // DEBUG_SHOW_VOLUME\n        discard;\n#endif // DEBUG_SHOW_VOLUME\n    }\n\n    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);\n    eyeCoordinate /= eyeCoordinate.w;\n\n    float halfMaxWidth = v_startPlaneNormalEcAndHalfWidth.w * czm_metersPerPixel(eyeCoordinate);\n    // Check distance of the eye coordinate against the right-facing plane\n    float widthwiseDistance = czm_planeDistance(v_rightPlaneEC, eyeCoordinate.xyz);\n\n    // Check eye coordinate against the mitering planes\n    float distanceFromStart = czm_planeDistance(v_startPlaneNormalEcAndHalfWidth.xyz, -dot(ecStart, v_startPlaneNormalEcAndHalfWidth.xyz), eyeCoordinate.xyz);\n    float distanceFromEnd = czm_planeDistance(v_endPlaneNormalEcAndBatchId.xyz, -dot(v_endEcAndStartEcX.xyz, v_endPlaneNormalEcAndBatchId.xyz), eyeCoordinate.xyz);\n\n    if (abs(widthwiseDistance) > halfMaxWidth || distanceFromStart < 0.0 || distanceFromEnd < 0.0) {\n#ifdef DEBUG_SHOW_VOLUME\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 0.5);\n        return;\n#else // DEBUG_SHOW_VOLUME\n        discard;\n#endif // DEBUG_SHOW_VOLUME\n    }\n\n    // Check distance of the eye coordinate against start and end planes with normals in the right plane.\n    // For computing unskewed lengthwise texture coordinate.\n    // Can also be used for clipping extremely pointy miters, but in practice unnecessary because of miter breaking.\n\n    // aligned plane: cross the right plane normal with miter plane normal, then cross the result with right again to point it more "forward"\n    vec3 alignedPlaneNormal;\n\n    // start aligned plane\n    alignedPlaneNormal = cross(v_rightPlaneEC.xyz, v_startPlaneNormalEcAndHalfWidth.xyz);\n    alignedPlaneNormal = normalize(cross(alignedPlaneNormal, v_rightPlaneEC.xyz));\n    distanceFromStart = czm_planeDistance(alignedPlaneNormal, -dot(alignedPlaneNormal, ecStart), eyeCoordinate.xyz);\n\n    // end aligned plane\n    alignedPlaneNormal = cross(v_rightPlaneEC.xyz, v_endPlaneNormalEcAndBatchId.xyz);\n    alignedPlaneNormal = normalize(cross(alignedPlaneNormal, v_rightPlaneEC.xyz));\n    distanceFromEnd = czm_planeDistance(alignedPlaneNormal, -dot(alignedPlaneNormal, v_endEcAndStartEcX.xyz), eyeCoordinate.xyz);\n\n#ifdef PER_INSTANCE_COLOR\n    gl_FragColor = czm_gammaCorrect(v_color);\n#else // PER_INSTANCE_COLOR\n    // Clamp - distance to aligned planes may be negative due to mitering,\n    // so fragment texture coordinate might be out-of-bounds.\n    float s = clamp(distanceFromStart / (distanceFromStart + distanceFromEnd), 0.0, 1.0);\n    s = (s * v_texcoordNormalizationAndStartEcYZ.x) + v_texcoordNormalizationAndStartEcYZ.y;\n    float t = (widthwiseDistance + halfMaxWidth) / (2.0 * halfMaxWidth);\n\n    czm_materialInput materialInput;\n\n    materialInput.s = s;\n    materialInput.st = vec2(s, t);\n    materialInput.str = vec3(s, t, 0.0);\n\n    czm_material material = czm_getMaterial(materialInput);\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#endif // PER_INSTANCE_COLOR\n\n    // Premultiply alpha. Required for classification primitives on translucent globe.\n    gl_FragColor.rgb *= gl_FragColor.a;\n\n    czm_writeDepthClamp();\n}\n',AK="varying vec3 v_forwardDirectionEC;\nvarying vec3 v_texcoordNormalizationAndHalfWidth;\nvarying float v_batchId;\n\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#else\nvarying vec2 v_alignedPlaneDistances;\nvarying float v_texcoordT;\n#endif\n\nfloat rayPlaneDistanceUnsafe(vec3 origin, vec3 direction, vec3 planeNormal, float planeDistance) {\n    // We don't expect the ray to ever be parallel to the plane\n    return (-planeDistance - dot(planeNormal, origin)) / dot(planeNormal, direction);\n}\n\nvoid main(void)\n{\n    vec4 eyeCoordinate = gl_FragCoord;\n    eyeCoordinate /= eyeCoordinate.w;\n\n#ifdef PER_INSTANCE_COLOR\n    gl_FragColor = czm_gammaCorrect(v_color);\n#else // PER_INSTANCE_COLOR\n    // Use distances for planes aligned with segment to prevent skew in dashing\n    float distanceFromStart = rayPlaneDistanceUnsafe(eyeCoordinate.xyz, -v_forwardDirectionEC, v_forwardDirectionEC.xyz, v_alignedPlaneDistances.x);\n    float distanceFromEnd = rayPlaneDistanceUnsafe(eyeCoordinate.xyz, v_forwardDirectionEC, -v_forwardDirectionEC.xyz, v_alignedPlaneDistances.y);\n\n    // Clamp - distance to aligned planes may be negative due to mitering\n    distanceFromStart = max(0.0, distanceFromStart);\n    distanceFromEnd = max(0.0, distanceFromEnd);\n\n    float s = distanceFromStart / (distanceFromStart + distanceFromEnd);\n    s = (s * v_texcoordNormalizationAndHalfWidth.x) + v_texcoordNormalizationAndHalfWidth.y;\n\n    czm_materialInput materialInput;\n\n    materialInput.s = s;\n    materialInput.st = vec2(s, v_texcoordT);\n    materialInput.str = vec3(s, v_texcoordT, 0.0);\n\n    czm_material material = czm_getMaterial(materialInput);\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#endif // PER_INSTANCE_COLOR\n}\n",wK='attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\n\nattribute vec4 startHiAndForwardOffsetX;\nattribute vec4 startLoAndForwardOffsetY;\nattribute vec4 startNormalAndForwardOffsetZ;\nattribute vec4 endNormalAndTextureCoordinateNormalizationX;\nattribute vec4 rightNormalAndTextureCoordinateNormalizationY;\nattribute vec4 startHiLo2D;\nattribute vec4 offsetAndRight2D;\nattribute vec4 startEndNormals2D;\nattribute vec2 texcoordNormalization2D;\n\nattribute float batchId;\n\nvarying vec3 v_forwardDirectionEC;\nvarying vec3 v_texcoordNormalizationAndHalfWidth;\nvarying float v_batchId;\n\n// For materials\n#ifdef WIDTH_VARYING\nvarying float v_width;\n#endif\n#ifdef ANGLE_VARYING\nvarying float v_polylineAngle;\n#endif\n\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#else\nvarying vec2 v_alignedPlaneDistances;\nvarying float v_texcoordT;\n#endif\n\n// Morphing planes using SLERP or NLERP doesn\'t seem to work, so instead draw the material directly on the shadow volume.\n// Morph views are from very far away and aren\'t meant to be used precisely, so this should be sufficient.\nvoid main()\n{\n    v_batchId = batchId;\n\n    // Start position\n    vec4 posRelativeToEye2D = czm_translateRelativeToEye(vec3(0.0, startHiLo2D.xy), vec3(0.0, startHiLo2D.zw));\n    vec4 posRelativeToEye3D = czm_translateRelativeToEye(startHiAndForwardOffsetX.xyz, startLoAndForwardOffsetY.xyz);\n    vec4 posRelativeToEye = czm_columbusViewMorph(posRelativeToEye2D, posRelativeToEye3D, czm_morphTime);\n    vec3 posEc2D = (czm_modelViewRelativeToEye * posRelativeToEye2D).xyz;\n    vec3 posEc3D = (czm_modelViewRelativeToEye * posRelativeToEye3D).xyz;\n    vec3 startEC = (czm_modelViewRelativeToEye * posRelativeToEye).xyz;\n\n    // Start plane\n    vec4 startPlane2D;\n    vec4 startPlane3D;\n    startPlane2D.xyz = czm_normal * vec3(0.0, startEndNormals2D.xy);\n    startPlane3D.xyz = czm_normal * startNormalAndForwardOffsetZ.xyz;\n    startPlane2D.w = -dot(startPlane2D.xyz, posEc2D);\n    startPlane3D.w = -dot(startPlane3D.xyz, posEc3D);\n\n    // Right plane\n    vec4 rightPlane2D;\n    vec4 rightPlane3D;\n    rightPlane2D.xyz = czm_normal * vec3(0.0, offsetAndRight2D.zw);\n    rightPlane3D.xyz = czm_normal * rightNormalAndTextureCoordinateNormalizationY.xyz;\n    rightPlane2D.w = -dot(rightPlane2D.xyz, posEc2D);\n    rightPlane3D.w = -dot(rightPlane3D.xyz, posEc3D);\n\n    // End position\n    posRelativeToEye2D = posRelativeToEye2D + vec4(0.0, offsetAndRight2D.xy, 0.0);\n    posRelativeToEye3D = posRelativeToEye3D + vec4(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w, 0.0);\n    posRelativeToEye = czm_columbusViewMorph(posRelativeToEye2D, posRelativeToEye3D, czm_morphTime);\n    posEc2D = (czm_modelViewRelativeToEye * posRelativeToEye2D).xyz;\n    posEc3D = (czm_modelViewRelativeToEye * posRelativeToEye3D).xyz;\n    vec3 endEC = (czm_modelViewRelativeToEye * posRelativeToEye).xyz;\n    vec3 forwardEc3D = czm_normal * normalize(vec3(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w));\n    vec3 forwardEc2D = czm_normal * normalize(vec3(0.0, offsetAndRight2D.xy));\n\n    // End plane\n    vec4 endPlane2D;\n    vec4 endPlane3D;\n    endPlane2D.xyz = czm_normal * vec3(0.0, startEndNormals2D.zw);\n    endPlane3D.xyz = czm_normal * endNormalAndTextureCoordinateNormalizationX.xyz;\n    endPlane2D.w = -dot(endPlane2D.xyz, posEc2D);\n    endPlane3D.w = -dot(endPlane3D.xyz, posEc3D);\n\n    // Forward direction\n    v_forwardDirectionEC = normalize(endEC - startEC);\n\n    vec2 cleanTexcoordNormalization2D;\n    cleanTexcoordNormalization2D.x = abs(texcoordNormalization2D.x);\n    cleanTexcoordNormalization2D.y = czm_branchFreeTernary(texcoordNormalization2D.y > 1.0, 0.0, abs(texcoordNormalization2D.y));\n    vec2 cleanTexcoordNormalization3D;\n    cleanTexcoordNormalization3D.x = abs(endNormalAndTextureCoordinateNormalizationX.w);\n    cleanTexcoordNormalization3D.y = rightNormalAndTextureCoordinateNormalizationY.w;\n    cleanTexcoordNormalization3D.y = czm_branchFreeTernary(cleanTexcoordNormalization3D.y > 1.0, 0.0, abs(cleanTexcoordNormalization3D.y));\n\n    v_texcoordNormalizationAndHalfWidth.xy = mix(cleanTexcoordNormalization2D, cleanTexcoordNormalization3D, czm_morphTime);\n\n#ifdef PER_INSTANCE_COLOR\n    v_color = czm_batchTable_color(batchId);\n#else // PER_INSTANCE_COLOR\n    // For computing texture coordinates\n\n    v_alignedPlaneDistances.x = -dot(v_forwardDirectionEC, startEC);\n    v_alignedPlaneDistances.y = -dot(-v_forwardDirectionEC, endEC);\n#endif // PER_INSTANCE_COLOR\n\n#ifdef WIDTH_VARYING\n    float width = czm_batchTable_width(batchId);\n    float halfWidth = width * 0.5;\n    v_width = width;\n    v_texcoordNormalizationAndHalfWidth.z = halfWidth;\n#else\n    float halfWidth = 0.5 * czm_batchTable_width(batchId);\n    v_texcoordNormalizationAndHalfWidth.z = halfWidth;\n#endif\n\n    // Compute a normal along which to "push" the position out, extending the miter depending on view distance.\n    // Position has already been "pushed" by unit length along miter normal, and miter normals are encoded in the planes.\n    // Decode the normal to use at this specific vertex, push the position back, and then push to where it needs to be.\n    // Since this is morphing, compute both 3D and 2D positions and then blend.\n\n    // ****** 3D ******\n    // Check distance to the end plane and start plane, pick the plane that is closer\n    vec4 positionEc3D = czm_modelViewRelativeToEye * czm_translateRelativeToEye(position3DHigh, position3DLow); // w = 1.0, see czm_computePosition\n    float absStartPlaneDistance = abs(czm_planeDistance(startPlane3D, positionEc3D.xyz));\n    float absEndPlaneDistance = abs(czm_planeDistance(endPlane3D, positionEc3D.xyz));\n    vec3 planeDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlane3D.xyz, endPlane3D.xyz);\n    vec3 upOrDown = normalize(cross(rightPlane3D.xyz, planeDirection)); // Points "up" for start plane, "down" at end plane.\n    vec3 normalEC = normalize(cross(planeDirection, upOrDown));         // In practice, the opposite seems to work too.\n\n    // Nudge the top vertex upwards to prevent flickering\n    vec3 geodeticSurfaceNormal = normalize(cross(normalEC, forwardEc3D));\n    geodeticSurfaceNormal *= float(0.0 <= rightNormalAndTextureCoordinateNormalizationY.w && rightNormalAndTextureCoordinateNormalizationY.w <= 1.0);\n    geodeticSurfaceNormal *= MAX_TERRAIN_HEIGHT;\n    positionEc3D.xyz += geodeticSurfaceNormal;\n\n    // Determine if this vertex is on the "left" or "right"\n    normalEC *= sign(endNormalAndTextureCoordinateNormalizationX.w);\n\n    // A "perfect" implementation would push along normals according to the angle against forward.\n    // In practice, just pushing the normal out by halfWidth is sufficient for morph views.\n    positionEc3D.xyz += halfWidth * max(0.0, czm_metersPerPixel(positionEc3D)) * normalEC; // prevent artifacts when czm_metersPerPixel is negative (behind camera)\n\n    // ****** 2D ******\n    // Check distance to the end plane and start plane, pick the plane that is closer\n    vec4 positionEc2D = czm_modelViewRelativeToEye * czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy); // w = 1.0, see czm_computePosition\n    absStartPlaneDistance = abs(czm_planeDistance(startPlane2D, positionEc2D.xyz));\n    absEndPlaneDistance = abs(czm_planeDistance(endPlane2D, positionEc2D.xyz));\n    planeDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlane2D.xyz, endPlane2D.xyz);\n    upOrDown = normalize(cross(rightPlane2D.xyz, planeDirection)); // Points "up" for start plane, "down" at end plane.\n    normalEC = normalize(cross(planeDirection, upOrDown));         // In practice, the opposite seems to work too.\n\n    // Nudge the top vertex upwards to prevent flickering\n    geodeticSurfaceNormal = normalize(cross(normalEC, forwardEc2D));\n    geodeticSurfaceNormal *= float(0.0 <= texcoordNormalization2D.y && texcoordNormalization2D.y <= 1.0);\n    geodeticSurfaceNormal *= MAX_TERRAIN_HEIGHT;\n    positionEc2D.xyz += geodeticSurfaceNormal;\n\n    // Determine if this vertex is on the "left" or "right"\n    normalEC *= sign(texcoordNormalization2D.x);\n#ifndef PER_INSTANCE_COLOR\n    // Use vertex\'s sidedness to compute its texture coordinate.\n    v_texcoordT = clamp(sign(texcoordNormalization2D.x), 0.0, 1.0);\n#endif\n\n    // A "perfect" implementation would push along normals according to the angle against forward.\n    // In practice, just pushing the normal out by halfWidth is sufficient for morph views.\n    positionEc2D.xyz += halfWidth * max(0.0, czm_metersPerPixel(positionEc2D)) * normalEC; // prevent artifacts when czm_metersPerPixel is negative (behind camera)\n\n    // Blend for actual position\n    gl_Position = czm_projection * mix(positionEc2D, positionEc3D, czm_morphTime);\n\n#ifdef ANGLE_VARYING\n    // Approximate relative screen space direction of the line.\n    vec2 approxLineDirection = normalize(vec2(v_forwardDirectionEC.x, -v_forwardDirectionEC.y));\n    approxLineDirection.y = czm_branchFreeTernary(approxLineDirection.x == 0.0 && approxLineDirection.y == 0.0, -1.0, approxLineDirection.y);\n    v_polylineAngle = czm_fastApproximateAtan(approxLineDirection.x, approxLineDirection.y);\n#endif\n}\n',TK='attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\n\n// In 2D and in 3D, texture coordinate normalization component signs encodes:\n// * X sign - sidedness relative to right plane\n// * Y sign - is negative OR magnitude is greater than 1.0 if vertex is on bottom of volume\n#ifndef COLUMBUS_VIEW_2D\nattribute vec4 startHiAndForwardOffsetX;\nattribute vec4 startLoAndForwardOffsetY;\nattribute vec4 startNormalAndForwardOffsetZ;\nattribute vec4 endNormalAndTextureCoordinateNormalizationX;\nattribute vec4 rightNormalAndTextureCoordinateNormalizationY;\n#else\nattribute vec4 startHiLo2D;\nattribute vec4 offsetAndRight2D;\nattribute vec4 startEndNormals2D;\nattribute vec2 texcoordNormalization2D;\n#endif\n\nattribute float batchId;\n\nvarying vec4 v_startPlaneNormalEcAndHalfWidth;\nvarying vec4 v_endPlaneNormalEcAndBatchId;\nvarying vec4 v_rightPlaneEC;\nvarying vec4 v_endEcAndStartEcX;\nvarying vec4 v_texcoordNormalizationAndStartEcYZ;\n\n// For materials\n#ifdef WIDTH_VARYING\nvarying float v_width;\n#endif\n#ifdef ANGLE_VARYING\nvarying float v_polylineAngle;\n#endif\n\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#endif\n\nvoid main()\n{\n#ifdef COLUMBUS_VIEW_2D\n    vec3 ecStart = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, startHiLo2D.xy), vec3(0.0, startHiLo2D.zw))).xyz;\n\n    vec3 forwardDirectionEC = czm_normal * vec3(0.0, offsetAndRight2D.xy);\n    vec3 ecEnd = forwardDirectionEC + ecStart;\n    forwardDirectionEC = normalize(forwardDirectionEC);\n\n    // Right plane\n    v_rightPlaneEC.xyz = czm_normal * vec3(0.0, offsetAndRight2D.zw);\n    v_rightPlaneEC.w = -dot(v_rightPlaneEC.xyz, ecStart);\n\n    // start plane\n    vec4 startPlaneEC;\n    startPlaneEC.xyz =  czm_normal * vec3(0.0, startEndNormals2D.xy);\n    startPlaneEC.w = -dot(startPlaneEC.xyz, ecStart);\n\n    // end plane\n    vec4 endPlaneEC;\n    endPlaneEC.xyz =  czm_normal * vec3(0.0, startEndNormals2D.zw);\n    endPlaneEC.w = -dot(endPlaneEC.xyz, ecEnd);\n\n    v_texcoordNormalizationAndStartEcYZ.x = abs(texcoordNormalization2D.x);\n    v_texcoordNormalizationAndStartEcYZ.y = texcoordNormalization2D.y;\n\n#else // COLUMBUS_VIEW_2D\n    vec3 ecStart = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(startHiAndForwardOffsetX.xyz, startLoAndForwardOffsetY.xyz)).xyz;\n    vec3 offset = czm_normal * vec3(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w);\n    vec3 ecEnd = ecStart + offset;\n\n    vec3 forwardDirectionEC = normalize(offset);\n\n    // start plane\n    vec4 startPlaneEC;\n    startPlaneEC.xyz = czm_normal * startNormalAndForwardOffsetZ.xyz;\n    startPlaneEC.w = -dot(startPlaneEC.xyz, ecStart);\n\n    // end plane\n    vec4 endPlaneEC;\n    endPlaneEC.xyz = czm_normal * endNormalAndTextureCoordinateNormalizationX.xyz;\n    endPlaneEC.w = -dot(endPlaneEC.xyz, ecEnd);\n\n    // Right plane\n    v_rightPlaneEC.xyz = czm_normal * rightNormalAndTextureCoordinateNormalizationY.xyz;\n    v_rightPlaneEC.w = -dot(v_rightPlaneEC.xyz, ecStart);\n\n    v_texcoordNormalizationAndStartEcYZ.x = abs(endNormalAndTextureCoordinateNormalizationX.w);\n    v_texcoordNormalizationAndStartEcYZ.y = rightNormalAndTextureCoordinateNormalizationY.w;\n\n#endif // COLUMBUS_VIEW_2D\n\n    v_endEcAndStartEcX.xyz = ecEnd;\n    v_endEcAndStartEcX.w = ecStart.x;\n    v_texcoordNormalizationAndStartEcYZ.zw = ecStart.yz;\n\n#ifdef PER_INSTANCE_COLOR\n    v_color = czm_batchTable_color(batchId);\n#endif // PER_INSTANCE_COLOR\n\n    // Compute a normal along which to "push" the position out, extending the miter depending on view distance.\n    // Position has already been "pushed" by unit length along miter normal, and miter normals are encoded in the planes.\n    // Decode the normal to use at this specific vertex, push the position back, and then push to where it needs to be.\n    vec4 positionRelativeToEye = czm_computePosition();\n\n    // Check distance to the end plane and start plane, pick the plane that is closer\n    vec4 positionEC = czm_modelViewRelativeToEye * positionRelativeToEye; // w = 1.0, see czm_computePosition\n    float absStartPlaneDistance = abs(czm_planeDistance(startPlaneEC, positionEC.xyz));\n    float absEndPlaneDistance = abs(czm_planeDistance(endPlaneEC, positionEC.xyz));\n    vec3 planeDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlaneEC.xyz, endPlaneEC.xyz);\n    vec3 upOrDown = normalize(cross(v_rightPlaneEC.xyz, planeDirection)); // Points "up" for start plane, "down" at end plane.\n    vec3 normalEC = normalize(cross(planeDirection, upOrDown));           // In practice, the opposite seems to work too.\n\n    // Extrude bottom vertices downward for far view distances, like for GroundPrimitives\n    upOrDown = cross(forwardDirectionEC, normalEC);\n    upOrDown = float(czm_sceneMode == czm_sceneMode3D) * upOrDown;\n    upOrDown = float(v_texcoordNormalizationAndStartEcYZ.y > 1.0 || v_texcoordNormalizationAndStartEcYZ.y < 0.0) * upOrDown;\n    upOrDown = min(GLOBE_MINIMUM_ALTITUDE, czm_geometricToleranceOverMeter * length(positionRelativeToEye.xyz)) * upOrDown;\n    positionEC.xyz += upOrDown;\n\n    v_texcoordNormalizationAndStartEcYZ.y = czm_branchFreeTernary(v_texcoordNormalizationAndStartEcYZ.y > 1.0, 0.0, abs(v_texcoordNormalizationAndStartEcYZ.y));\n\n    // Determine distance along normalEC to push for a volume of appropriate width.\n    // Make volumes about double pixel width for a conservative fit - in practice the\n    // extra cost here is minimal compared to the loose volume heights.\n    //\n    // N = normalEC (guaranteed "right-facing")\n    // R = rightEC\n    // p = angle between N and R\n    // w = distance to push along R if R == N\n    // d = distance to push along N\n    //\n    //   N   R\n    //  {  p| }      * cos(p) = dot(N, R) = w / d\n    //  d  |  |w    * d = w / dot(N, R)\n    //    { | }\n    //       o---------- polyline segment ----\x3e\n    //\n    float width = czm_batchTable_width(batchId);\n#ifdef WIDTH_VARYING\n    v_width = width;\n#endif\n\n    v_startPlaneNormalEcAndHalfWidth.xyz = startPlaneEC.xyz;\n    v_startPlaneNormalEcAndHalfWidth.w = width * 0.5;\n\n    v_endPlaneNormalEcAndBatchId.xyz = endPlaneEC.xyz;\n    v_endPlaneNormalEcAndBatchId.w = batchId;\n\n    width = width * max(0.0, czm_metersPerPixel(positionEC)); // width = distance to push along R\n    width = width / dot(normalEC, v_rightPlaneEC.xyz); // width = distance to push along N\n\n    // Determine if this vertex is on the "left" or "right"\n#ifdef COLUMBUS_VIEW_2D\n        normalEC *= sign(texcoordNormalization2D.x);\n#else\n        normalEC *= sign(endNormalAndTextureCoordinateNormalizationX.w);\n#endif\n\n    positionEC.xyz += width * normalEC;\n    gl_Position = czm_depthClamp(czm_projection * positionEC);\n\n#ifdef ANGLE_VARYING\n    // Approximate relative screen space direction of the line.\n    vec2 approxLineDirection = normalize(vec2(forwardDirectionEC.x, -forwardDirectionEC.y));\n    approxLineDirection.y = czm_branchFreeTernary(approxLineDirection.x == 0.0 && approxLineDirection.y == 0.0, -1.0, approxLineDirection.y);\n    v_polylineAngle = czm_fastApproximateAtan(approxLineDirection.x, approxLineDirection.y);\n#endif\n}\n',CK="attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 prevPosition3DHigh;\nattribute vec3 prevPosition3DLow;\nattribute vec3 nextPosition3DHigh;\nattribute vec3 nextPosition3DLow;\nattribute vec2 expandAndWidth;\nattribute vec4 color;\nattribute float batchId;\n\nvarying vec4 v_color;\n\nvoid main()\n{\n    float expandDir = expandAndWidth.x;\n    float width = abs(expandAndWidth.y) + 0.5;\n    bool usePrev = expandAndWidth.y < 0.0;\n\n    vec4 p = czm_computePosition();\n    vec4 prev = czm_computePrevPosition();\n    vec4 next = czm_computeNextPosition();\n\n    float angle;\n    vec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, angle);\n    gl_Position = czm_viewportOrthographic * positionWC;\n\n    v_color = color;\n}\n",EK="void clipLineSegmentToNearPlane(\n    vec3 p0,\n    vec3 p1,\n    out vec4 positionWC,\n    out bool clipped,\n    out bool culledByNearPlane,\n    out vec4 clippedPositionEC)\n{\n    culledByNearPlane = false;\n    clipped = false;\n\n    vec3 p0ToP1 = p1 - p0;\n    float magnitude = length(p0ToP1);\n    vec3 direction = normalize(p0ToP1);\n\n    // Distance that p0 is behind the near plane. Negative means p0 is\n    // in front of the near plane.\n    float endPoint0Distance =  czm_currentFrustum.x + p0.z;\n\n    // Camera looks down -Z.\n    // When moving a point along +Z: LESS VISIBLE\n    //   * Points in front of the camera move closer to the camera.\n    //   * Points behind the camrea move farther away from the camera.\n    // When moving a point along -Z: MORE VISIBLE\n    //   * Points in front of the camera move farther away from the camera.\n    //   * Points behind the camera move closer to the camera.\n\n    // Positive denominator: -Z, becoming more visible\n    // Negative denominator: +Z, becoming less visible\n    // Nearly zero: parallel to near plane\n    float denominator = -direction.z;\n\n    if (endPoint0Distance > 0.0 && abs(denominator) < czm_epsilon7)\n    {\n        // p0 is behind the near plane and the line to p1 is nearly parallel to\n        // the near plane, so cull the segment completely.\n        culledByNearPlane = true;\n    }\n    else if (endPoint0Distance > 0.0)\n    {\n        // p0 is behind the near plane, and the line to p1 is moving distinctly\n        // toward or away from it.\n\n        // t = (-plane distance - dot(plane normal, ray origin)) / dot(plane normal, ray direction)\n        float t = endPoint0Distance / denominator;\n        if (t < 0.0 || t > magnitude)\n        {\n            // Near plane intersection is not between the two points.\n            // We already confirmed p0 is behind the naer plane, so now\n            // we know the entire segment is behind it.\n            culledByNearPlane = true;\n        }\n        else\n        {\n            // Segment crosses the near plane, update p0 to lie exactly on it.\n            p0 = p0 + t * direction;\n\n            // Numerical noise might put us a bit on the wrong side of the near plane.\n            // Don't let that happen.\n            p0.z = min(p0.z, -czm_currentFrustum.x);\n\n            clipped = true;\n        }\n    }\n\n    clippedPositionEC = vec4(p0, 1.0);\n    positionWC = czm_eyeToWindowCoordinates(clippedPositionEC);\n}\n\nvec4 getPolylineWindowCoordinatesEC(vec4 positionEC, vec4 prevEC, vec4 nextEC, float expandDirection, float width, bool usePrevious, out float angle)\n{\n    // expandDirection +1 is to the _left_ when looking from positionEC toward nextEC.\n\n#ifdef POLYLINE_DASH\n    // Compute the window coordinates of the points.\n    vec4 positionWindow = czm_eyeToWindowCoordinates(positionEC);\n    vec4 previousWindow = czm_eyeToWindowCoordinates(prevEC);\n    vec4 nextWindow = czm_eyeToWindowCoordinates(nextEC);\n\n    // Determine the relative screen space direction of the line.\n    vec2 lineDir;\n    if (usePrevious) {\n        lineDir = normalize(positionWindow.xy - previousWindow.xy);\n    }\n    else {\n        lineDir = normalize(nextWindow.xy - positionWindow.xy);\n    }\n    angle = atan(lineDir.x, lineDir.y) - 1.570796327; // precomputed atan(1,0)\n\n    // Quantize the angle so it doesn't change rapidly between segments.\n    angle = floor(angle / czm_piOverFour + 0.5) * czm_piOverFour;\n#endif\n\n    vec4 clippedPrevWC, clippedPrevEC;\n    bool prevSegmentClipped, prevSegmentCulled;\n    clipLineSegmentToNearPlane(prevEC.xyz, positionEC.xyz, clippedPrevWC, prevSegmentClipped, prevSegmentCulled, clippedPrevEC);\n\n    vec4 clippedNextWC, clippedNextEC;\n    bool nextSegmentClipped, nextSegmentCulled;\n    clipLineSegmentToNearPlane(nextEC.xyz, positionEC.xyz, clippedNextWC, nextSegmentClipped, nextSegmentCulled, clippedNextEC);\n\n    bool segmentClipped, segmentCulled;\n    vec4 clippedPositionWC, clippedPositionEC;\n    clipLineSegmentToNearPlane(positionEC.xyz, usePrevious ? prevEC.xyz : nextEC.xyz, clippedPositionWC, segmentClipped, segmentCulled, clippedPositionEC);\n\n    if (segmentCulled)\n    {\n        return vec4(0.0, 0.0, 0.0, 1.0);\n    }\n\n    vec2 directionToPrevWC = normalize(clippedPrevWC.xy - clippedPositionWC.xy);\n    vec2 directionToNextWC = normalize(clippedNextWC.xy - clippedPositionWC.xy);\n\n    // If a segment was culled, we can't use the corresponding direction\n    // computed above. We should never see both of these be true without\n    // `segmentCulled` above also being true.\n    if (prevSegmentCulled)\n    {\n        directionToPrevWC = -directionToNextWC;\n    }\n    else if (nextSegmentCulled)\n    {\n        directionToNextWC = -directionToPrevWC;\n    }\n\n    vec2 thisSegmentForwardWC, otherSegmentForwardWC;\n    if (usePrevious)\n    {\n        thisSegmentForwardWC = -directionToPrevWC;\n        otherSegmentForwardWC = directionToNextWC;\n    }\n    else\n    {\n        thisSegmentForwardWC = directionToNextWC;\n        otherSegmentForwardWC =  -directionToPrevWC;\n    }\n\n    vec2 thisSegmentLeftWC = vec2(-thisSegmentForwardWC.y, thisSegmentForwardWC.x);\n\n    vec2 leftWC = thisSegmentLeftWC;\n    float expandWidth = width * 0.5;\n\n    // When lines are split at the anti-meridian, the position may be at the\n    // same location as the next or previous position, and we need to handle\n    // that to avoid producing NaNs.\n    if (!czm_equalsEpsilon(prevEC.xyz - positionEC.xyz, vec3(0.0), czm_epsilon1) && !czm_equalsEpsilon(nextEC.xyz - positionEC.xyz, vec3(0.0), czm_epsilon1))\n    {\n        vec2 otherSegmentLeftWC = vec2(-otherSegmentForwardWC.y, otherSegmentForwardWC.x);\n\n        vec2 leftSumWC = thisSegmentLeftWC + otherSegmentLeftWC;\n        float leftSumLength = length(leftSumWC);\n        leftWC = leftSumLength < czm_epsilon6 ? thisSegmentLeftWC : (leftSumWC / leftSumLength);\n\n        // The sine of the angle between the two vectors is given by the formula\n        //         |a x b| = |a||b|sin(theta)\n        // which is\n        //     float sinAngle = length(cross(vec3(leftWC, 0.0), vec3(-thisSegmentForwardWC, 0.0)));\n        // Because the z components of both vectors are zero, the x and y coordinate will be zero.\n        // Therefore, the sine of the angle is just the z component of the cross product.\n        vec2 u = -thisSegmentForwardWC;\n        vec2 v = leftWC;\n        float sinAngle = abs(u.x * v.y - u.y * v.x);\n        expandWidth = clamp(expandWidth / sinAngle, 0.0, width * 2.0);\n    }\n\n    vec2 offset = leftWC * expandDirection * expandWidth * czm_pixelRatio;\n    return vec4(clippedPositionWC.xy + offset, -clippedPositionWC.z, 1.0) * (czm_projection * clippedPositionEC).w;\n}\n\nvec4 getPolylineWindowCoordinates(vec4 position, vec4 previous, vec4 next, float expandDirection, float width, bool usePrevious, out float angle)\n{\n    vec4 positionEC = czm_modelViewRelativeToEye * position;\n    vec4 prevEC = czm_modelViewRelativeToEye * previous;\n    vec4 nextEC = czm_modelViewRelativeToEye * next;\n    return getPolylineWindowCoordinatesEC(positionEC, prevEC, nextEC, expandDirection, width, usePrevious, angle);\n}\n";let xK=`${EK}\n${CK}`;const SK=DU;function IK(e){e=R(e,R.EMPTY_OBJECT);const t=R(e.translucent,!0),n=!1,i=IK.VERTEX_FORMAT;this.material=void 0,this.translucent=t,this._vertexShaderSource=R(e.vertexShaderSource,xK),this._fragmentShaderSource=R(e.fragmentShaderSource,SK),this._renderState=bk.getDefaultRenderState(t,n,e.renderState),this._closed=n,this._vertexFormat=i}Oc.isInternetExplorer()||(xK=`#define CLIP_POLYLINE \n${xK}`),Object.defineProperties(IK.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}}),IK.VERTEX_FORMAT=jf.POSITION_ONLY,IK.prototype.getFragmentShaderSource=bk.prototype.getFragmentShaderSource,IK.prototype.isTranslucent=bk.prototype.isTranslucent,IK.prototype.getRenderState=bk.prototype.getRenderState;var OK=IK,DK="attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 prevPosition3DHigh;\nattribute vec3 prevPosition3DLow;\nattribute vec3 nextPosition3DHigh;\nattribute vec3 nextPosition3DLow;\nattribute vec2 expandAndWidth;\nattribute vec2 st;\nattribute float batchId;\n\nvarying float v_width;\nvarying vec2 v_st;\nvarying float v_polylineAngle;\n\nvoid main()\n{\n    float expandDir = expandAndWidth.x;\n    float width = abs(expandAndWidth.y) + 0.5;\n    bool usePrev = expandAndWidth.y < 0.0;\n\n    vec4 p = czm_computePosition();\n    vec4 prev = czm_computePrevPosition();\n    vec4 next = czm_computeNextPosition();\n\n    float angle;\n    vec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, angle);\n    gl_Position = czm_viewportOrthographic * positionWC;\n\n    v_width = width;\n    v_st.s = st.s;\n    v_st.t = czm_writeNonPerspective(st.t, gl_Position.w);\n    v_polylineAngle = angle;\n}\n",PK="#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\n\nvarying vec2 v_st;\n\nvoid main()\n{\n    czm_materialInput materialInput;\n\n    vec2 st = v_st;\n    st.t = czm_readNonPerspective(st.t, gl_FragCoord.w);\n\n    materialInput.s = st.s;\n    materialInput.st = st;\n    materialInput.str = vec3(st, 0.0);\n\n    czm_material material = czm_getMaterial(materialInput);\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#ifdef VECTOR_TILE\n    gl_FragColor *= u_highlightColor;\n#endif\n\n    czm_writeLogDepth();\n}\n";let RK=`${EK}\n${DK}`;const LK=PK;function MK(e){e=R(e,R.EMPTY_OBJECT);const t=R(e.translucent,!0),n=!1,i=MK.VERTEX_FORMAT;this.material=C(e.material)?e.material:EU.fromType(EU.ColorType),this.translucent=t,this._vertexShaderSource=R(e.vertexShaderSource,RK),this._fragmentShaderSource=R(e.fragmentShaderSource,LK),this._renderState=bk.getDefaultRenderState(t,n,e.renderState),this._closed=n,this._vertexFormat=i}Oc.isInternetExplorer()||(RK=`#define CLIP_POLYLINE \n${RK}`),Object.defineProperties(MK.prototype,{vertexShaderSource:{get:function(){let e=this._vertexShaderSource;return-1!==this.material.shaderSource.search(/varying\s+float\s+v_polylineAngle;/g)&&(e=`#define POLYLINE_DASH\n${e}`),e}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}}),MK.VERTEX_FORMAT=jf.POSITION_AND_ST,MK.prototype.getFragmentShaderSource=bk.prototype.getFragmentShaderSource,MK.prototype.isTranslucent=bk.prototype.isTranslucent,MK.prototype.getRenderState=bk.prototype.getRenderState;var BK=MK;function NK(e){e=R(e,R.EMPTY_OBJECT),this.geometryInstances=e.geometryInstances,this._hasPerInstanceColors=!0;let t=e.appearance;C(t)||(t=new BK),this.appearance=t,this.show=R(e.show,!0),this.classificationType=R(e.classificationType,rq.BOTH),this.debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this._debugShowShadowVolume=R(e.debugShowShadowVolume,!1),this._primitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:!1,interleave:R(e.interleave,!1),releaseGeometryInstances:R(e.releaseGeometryInstances,!0),allowPicking:R(e.allowPicking,!0),asynchronous:R(e.asynchronous,!0),compressVertices:!1,_createShaderProgramFunction:void 0,_createCommandsFunction:void 0,_updateAndQueueCommandsFunction:void 0},this._zIndex=void 0,this._ready=!1,this._readyPromise=yn(),this._primitive=void 0,this._sp=void 0,this._sp2D=void 0,this._spMorph=void 0,this._renderState=zK(!1),this._renderState3DTiles=zK(!0),this._renderStateMorph=yV.fromCache({cull:{enabled:!0,face:yk.FRONT},depthTest:{enabled:!0},blending:_k.PRE_MULTIPLIED_ALPHA_BLEND,depthMask:!1})}function FK(e,t,n){const i=t.context,o=e._primitive,r=o._attributeLocations;let s=o._batchTable.getVertexShaderCallback()(TK);s=tY._appendShowToShader(o,s),s=tY._appendDistanceDisplayConditionToShader(o,s),s=tY._modifyShaderPosition(e,s,t.scene3DOnly);let a=o._batchTable.getVertexShaderCallback()(wK);a=tY._appendShowToShader(o,a),a=tY._appendDistanceDisplayConditionToShader(o,a),a=tY._modifyShaderPosition(e,a,t.scene3DOnly);let c=o._batchTable.getVertexShaderCallback()(bK);const l=[`GLOBE_MINIMUM_ALTITUDE ${t.mapProjection.ellipsoid.minimumRadius.toFixed(1)}`];let u="",h="";C(n.material)?(h=C(n.material)?n.material.shaderSource:"",-1!==h.search(/varying\s+float\s+v_polylineAngle;/g)&&l.push("ANGLE_VARYING"),-1!==h.search(/varying\s+float\s+v_width;/g)&&l.push("WIDTH_VARYING")):u="PER_INSTANCE_COLOR",l.push(u);const d=e.debugShowShadowVolume?["DEBUG_SHOW_VOLUME",u]:[u],f=new tq({defines:l,sources:[s]}),p=new tq({defines:d,sources:[h,c]});e._sp=fH.replaceCache({context:i,shaderProgram:o._sp,vertexShaderSource:f,fragmentShaderSource:p,attributeLocations:r});let m=i.shaderCache.getDerivedShaderProgram(e._sp,"2dColor");if(!C(m)){const t=new tq({defines:l.concat(["COLUMBUS_VIEW_2D"]),sources:[s]});m=i.shaderCache.createDerivedShaderProgram(e._sp,"2dColor",{context:i,shaderProgram:e._sp2D,vertexShaderSource:t,fragmentShaderSource:p,attributeLocations:r})}e._sp2D=m;let _=i.shaderCache.getDerivedShaderProgram(e._sp,"MorphColor");if(!C(_)){const t=new tq({defines:l.concat([`MAX_TERRAIN_HEIGHT ${bo._defaultMaxTerrainHeight.toFixed(1)}`]),sources:[a]});c=o._batchTable.getVertexShaderCallback()(AK);const n=new tq({defines:d,sources:[h,c]});_=i.shaderCache.createDerivedShaderProgram(e._sp,"MorphColor",{context:i,shaderProgram:e._spMorph,vertexShaderSource:t,fragmentShaderSource:n,attributeLocations:r})}e._spMorph=_}function zK(e){return yV.fromCache({cull:{enabled:!0},blending:_k.PRE_MULTIPLIED_ALPHA_BLEND,depthMask:!1,stencilTest:{enabled:e,frontFunction:LY.EQUAL,frontOperation:{fail:BY.KEEP,zFail:BY.KEEP,zPass:BY.KEEP},backFunction:LY.EQUAL,backOperation:{fail:BY.KEEP,zFail:BY.KEEP,zPass:BY.KEEP},reference:FY.CESIUM_3D_TILE_MASK,mask:FY.CESIUM_3D_TILE_MASK}})}function kK(e,t,n,i,o,r){const s=e._primitive,a=s._va.length;o.length=a,r.length=a;const c=t instanceof OK,l=c?{}:n._uniforms,u=s._batchTable.getUniformMapCallback()(l);for(let h=0;h<a;h++){const t=s._va[h];let n=o[h];C(n)||(n=o[h]=new UU({owner:e,primitiveType:s._primitiveType})),n.vertexArray=t,n.renderState=e._renderState,n.shaderProgram=e._sp,n.uniformMap=u,n.pass=HU.TERRAIN_CLASSIFICATION,n.pickId="czm_batchTable_pickColor(v_endPlaneNormalEcAndBatchId.w)";const i=UU.shallowClone(n,n.derivedCommands.tileset);i.renderState=e._renderState3DTiles,i.pass=HU.CESIUM_3D_TILE_CLASSIFICATION,n.derivedCommands.tileset=i;const r=UU.shallowClone(n,n.derivedCommands.color2D);r.shaderProgram=e._sp2D,n.derivedCommands.color2D=r;const a=UU.shallowClone(i,i.derivedCommands.color2D);a.shaderProgram=e._sp2D,i.derivedCommands.color2D=a;const c=UU.shallowClone(n,n.derivedCommands.colorMorph);c.renderState=e._renderStateMorph,c.shaderProgram=e._spMorph,c.pickId="czm_batchTable_pickColor(v_batchId)",n.derivedCommands.colorMorph=c}}function UK(e,t,n,i,o,r,s){n.mode===ij.MORPHING?t=t.derivedCommands.colorMorph:n.mode!==ij.SCENE3D&&(t=t.derivedCommands.color2D),t.modelMatrix=i,t.boundingVolume=r,t.cull=o,t.debugShowBoundingVolume=s,n.commandList.push(t)}function VK(e,t,n,i,o,r,s){const a=e._primitive;let c;tY._updateBoundingVolumes(a,t,o),t.mode===ij.SCENE3D?c=a._boundingSphereWC:t.mode===ij.COLUMBUS_VIEW?c=a._boundingSphereCV:t.mode===ij.SCENE2D&&C(a._boundingSphere2D)?c=a._boundingSphere2D:C(a._boundingSphereMorph)&&(c=a._boundingSphereMorph);const l=t.mode===ij.MORPHING,u=e.classificationType,h=u!==rq.CESIUM_3D_TILE,d=u!==rq.TERRAIN&&!l;let f;const p=t.passes;if(p.render||p.pick&&a.allowPicking){const i=n.length;for(let a=0;a<i;++a){const i=c[a];h&&(f=n[a],UK(e,f,t,o,r,i,s)),d&&(f=n[a].derivedCommands.tileset,UK(e,f,t,o,r,i,s))}}}Object.defineProperties(NK.prototype,{interleave:{get:function(){return this._primitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._primitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._primitiveOptions.allowPicking}},asynchronous:{get:function(){return this._primitiveOptions.asynchronous}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},debugShowShadowVolume:{get:function(){return this._debugShowShadowVolume}}}),NK.initializeTerrainHeights=function(){return bo.initialize()},NK.prototype.update=function(e){if(!C(this._primitive)&&!C(this.geometryInstances))return;if(!bo.initialized){if(!this.asynchronous)throw new x("For synchronous GroundPolylinePrimitives, you must call GroundPolylinePrimitives.initializeTerrainHeights() and wait for the returned promise to resolve.");return void NK.initializeTerrainHeights()}let t;const n=this,i=this._primitiveOptions;if(!C(this._primitive)){const o=Array.isArray(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],r=o.length,s=new Array(r);let a;for(t=0;t<r;++t)if(a=o[t].attributes,!C(a)||!C(a.color)){this._hasPerInstanceColors=!1;break}for(t=0;t<r;++t){const i=o[t];a={};const r=i.attributes;for(const e in r)r.hasOwnProperty(e)&&(a[e]=r[e]);C(a.width)||(a.width=new zE({componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:1,value:[i.geometry.width]})),i.geometry._scene3DOnly=e.scene3DOnly,cI.setProjectionAndEllipsoid(i.geometry,e.mapProjection),s[t]=new Sm({geometry:i.geometry,attributes:a,id:i.id,pickPrimitive:n})}i.geometryInstances=s,i.appearance=this.appearance,i._createShaderProgramFunction=function(e,t,i){FK(n,t,i)},i._createCommandsFunction=function(e,t,i,o,r,s,a){kK(n,t,i,o,s,a)},i._updateAndQueueCommandsFunction=function(e,t,i,o,r,s,a,c){VK(n,t,i,o,r,s,a)},this._primitive=new tY(i),this._primitive.readyPromise.then((function(e){n._ready=!0,n.releaseGeometryInstances&&(n.geometryInstances=void 0);const t=e._error;C(t)?n._readyPromise.reject(t):n._readyPromise.resolve(n)}))}if(this.appearance instanceof OK&&!this._hasPerInstanceColors)throw new x("All GeometryInstances must have color attributes to use PolylineColorAppearance with GroundPolylinePrimitive.");this._primitive.appearance=this.appearance,this._primitive.show=this.show,this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.update(e)},NK.prototype.getGeometryInstanceAttributes=function(e){if(!C(this._primitive))throw new x("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(e)},NK.isSupported=function(e){return e.frameState.context.depthTexture},NK.prototype.isDestroyed=function(){return!1},NK.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),this._sp=this._sp&&this._sp.destroy(),this._sp2D=void 0,this._spMorph=void 0,Qh(this)};var HK=NK;const GK=new ro(1,1),WK=!1,qK=xy.WHITE;function jK(e){e=R(e,R.EMPTY_OBJECT),this._definitionChanged=new $n,this._image=void 0,this._imageSubscription=void 0,this._repeat=void 0,this._repeatSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._transparent=void 0,this._transparentSubscription=void 0,this.image=e.image,this.repeat=e.repeat,this.color=e.color,this.transparent=e.transparent}Object.defineProperties(jK.prototype,{isConstant:{get:function(){return Bz.isConstant(this._image)&&Bz.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},image:Tz("image"),repeat:Tz("repeat"),color:Tz("color"),transparent:Tz("transparent")}),jK.prototype.getType=function(e){return"Image"},jK.prototype.getValue=function(e,t){return C(t)||(t={}),t.image=Bz.getValueOrUndefined(this._image,e),t.repeat=Bz.getValueOrClonedDefault(this._repeat,e,GK,t.repeat),t.color=Bz.getValueOrClonedDefault(this._color,e,qK,t.color),Bz.getValueOrDefault(this._transparent,e,WK)&&(t.color.alpha=Math.min(.99,t.color.alpha)),t},jK.prototype.equals=function(e){return this===e||e instanceof jK&&Bz.equals(this._image,e._image)&&Bz.equals(this._repeat,e._repeat)&&Bz.equals(this._color,e._color)&&Bz.equals(this._transparent,e._transparent)};var YK=jK;function KK(e){if(e instanceof xy)return new BU(e);if("string"===typeof e||e instanceof Vi||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){const t=new YK;return t.image=e,t}throw new x(`Unable to infer material type: ${e}`)}function XK(e,t){return Tz(e,t,KK)}var QK=XK;function JK(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._dimensions=void 0,this._dimensionsSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(JK.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),dimensions:Tz("dimensions"),heightReference:Tz("heightReference"),fill:Tz("fill"),material:QK("material"),outline:Tz("outline"),outlineColor:Tz("outlineColor"),outlineWidth:Tz("outlineWidth"),shadows:Tz("shadows"),distanceDisplayCondition:Tz("distanceDisplayCondition")}),JK.prototype.clone=function(e){return C(e)?(e.show=this.show,e.dimensions=this.dimensions,e.heightReference=this.heightReference,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new JK(this)},JK.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.dimensions=R(this.dimensions,e.dimensions),this.heightReference=R(this.heightReference,e.heightReference),this.fill=R(this.fill,e.fill),this.material=R(this.material,e.material),this.outline=R(this.outline,e.outline),this.outlineColor=R(this.outlineColor,e.outlineColor),this.outlineWidth=R(this.outlineWidth,e.outlineWidth),this.shadows=R(this.shadows,e.shadows),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition)};var ZK=JK;function $K(){x.throwInstantiationError()}Object.defineProperties($K.prototype,{isConstant:{get:x.throwInstantiationError},definitionChanged:{get:x.throwInstantiationError},referenceFrame:{get:x.throwInstantiationError}}),$K.prototype.getValue=x.throwInstantiationError,$K.prototype.getValueInReferenceFrame=x.throwInstantiationError,$K.prototype.equals=x.throwInstantiationError;const eX=new ke;$K.convertToReferenceFrame=function(e,t,n,i,o){if(!C(t))return t;if(C(o)||(o=new K),n===i)return K.clone(t,o);let r=Kl.computeIcrfToFixedMatrix(e,eX);return C(r)||(r=Kl.computeTemeToPseudoFixedMatrix(e,eX)),n===vL.INERTIAL?ke.multiplyByVector(r,t,o):n===vL.FIXED?ke.multiplyByVector(ke.transpose(r,eX),t,o):void 0};var tX=$K;function nX(e,t){this._definitionChanged=new $n,this._value=K.clone(e),this._referenceFrame=R(t,vL.FIXED)}Object.defineProperties(nX.prototype,{isConstant:{get:function(){return!C(this._value)||this._referenceFrame===vL.FIXED}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}}}),nX.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,vL.FIXED,t)},nX.prototype.setValue=function(e,t){let n=!1;K.equals(this._value,e)||(n=!0,this._value=K.clone(e)),C(t)&&this._referenceFrame!==t&&(n=!0,this._referenceFrame=t),n&&this._definitionChanged.raiseEvent(this)},nX.prototype.getValueInReferenceFrame=function(e,t,n){if(!C(e))throw new x("time is required.");if(!C(t))throw new x("referenceFrame is required.");return tX.convertToReferenceFrame(e,this._value,this._referenceFrame,t,n)},nX.prototype.equals=function(e){return this===e||e instanceof nX&&K.equals(this._value,e._value)&&this._referenceFrame===e._referenceFrame};var iX=nX;function oX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._cornerType=void 0,this._cornerTypeSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(oX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),positions:Tz("positions"),width:Tz("width"),height:Tz("height"),heightReference:Tz("heightReference"),extrudedHeight:Tz("extrudedHeight"),extrudedHeightReference:Tz("extrudedHeightReference"),cornerType:Tz("cornerType"),granularity:Tz("granularity"),fill:Tz("fill"),material:QK("material"),outline:Tz("outline"),outlineColor:Tz("outlineColor"),outlineWidth:Tz("outlineWidth"),shadows:Tz("shadows"),distanceDisplayCondition:Tz("distanceDisplayCondition"),classificationType:Tz("classificationType"),zIndex:Tz("zIndex")}),oX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.positions=this.positions,e.width=this.width,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.cornerType=this.cornerType,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new oX(this)},oX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.positions=R(this.positions,e.positions),this.width=R(this.width,e.width),this.height=R(this.height,e.height),this.heightReference=R(this.heightReference,e.heightReference),this.extrudedHeight=R(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=R(this.extrudedHeightReference,e.extrudedHeightReference),this.cornerType=R(this.cornerType,e.cornerType),this.granularity=R(this.granularity,e.granularity),this.fill=R(this.fill,e.fill),this.material=R(this.material,e.material),this.outline=R(this.outline,e.outline),this.outlineColor=R(this.outlineColor,e.outlineColor),this.outlineWidth=R(this.outlineWidth,e.outlineWidth),this.shadows=R(this.shadows,e.shadows),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=R(this.classificationType,e.classificationType),this.zIndex=R(this.zIndex,e.zIndex)};var rX=oX;function sX(e){return e}function aX(e,t){return Tz(e,t,sX)}var cX=aX;function lX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._length=void 0,this._lengthSubscription=void 0,this._topRadius=void 0,this._topRadiusSubscription=void 0,this._bottomRadius=void 0,this._bottomRadiusSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._numberOfVerticalLines=void 0,this._numberOfVerticalLinesSubscription=void 0,this._slices=void 0,this._slicesSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(lX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),length:Tz("length"),topRadius:Tz("topRadius"),bottomRadius:Tz("bottomRadius"),heightReference:Tz("heightReference"),fill:Tz("fill"),material:QK("material"),outline:Tz("outline"),outlineColor:Tz("outlineColor"),outlineWidth:Tz("outlineWidth"),numberOfVerticalLines:Tz("numberOfVerticalLines"),slices:Tz("slices"),shadows:Tz("shadows"),distanceDisplayCondition:Tz("distanceDisplayCondition")}),lX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.length=this.length,e.topRadius=this.topRadius,e.bottomRadius=this.bottomRadius,e.heightReference=this.heightReference,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.numberOfVerticalLines=this.numberOfVerticalLines,e.slices=this.slices,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new lX(this)},lX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.length=R(this.length,e.length),this.topRadius=R(this.topRadius,e.topRadius),this.bottomRadius=R(this.bottomRadius,e.bottomRadius),this.heightReference=R(this.heightReference,e.heightReference),this.fill=R(this.fill,e.fill),this.material=R(this.material,e.material),this.outline=R(this.outline,e.outline),this.outlineColor=R(this.outlineColor,e.outlineColor),this.outlineWidth=R(this.outlineWidth,e.outlineWidth),this.numberOfVerticalLines=R(this.numberOfVerticalLines,e.numberOfVerticalLines),this.slices=R(this.slices,e.slices),this.shadows=R(this.shadows,e.shadows),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition)};var uX=lX;function hX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._semiMajorAxis=void 0,this._semiMajorAxisSubscription=void 0,this._semiMinorAxis=void 0,this._semiMinorAxisSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._stRotation=void 0,this._stRotationSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._numberOfVerticalLines=void 0,this._numberOfVerticalLinesSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(hX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),semiMajorAxis:Tz("semiMajorAxis"),semiMinorAxis:Tz("semiMinorAxis"),height:Tz("height"),heightReference:Tz("heightReference"),extrudedHeight:Tz("extrudedHeight"),extrudedHeightReference:Tz("extrudedHeightReference"),rotation:Tz("rotation"),stRotation:Tz("stRotation"),granularity:Tz("granularity"),fill:Tz("fill"),material:QK("material"),outline:Tz("outline"),outlineColor:Tz("outlineColor"),outlineWidth:Tz("outlineWidth"),numberOfVerticalLines:Tz("numberOfVerticalLines"),shadows:Tz("shadows"),distanceDisplayCondition:Tz("distanceDisplayCondition"),classificationType:Tz("classificationType"),zIndex:Tz("zIndex")}),hX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.semiMajorAxis=this.semiMajorAxis,e.semiMinorAxis=this.semiMinorAxis,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.rotation=this.rotation,e.stRotation=this.stRotation,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.numberOfVerticalLines=this.numberOfVerticalLines,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new hX(this)},hX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.semiMajorAxis=R(this.semiMajorAxis,e.semiMajorAxis),this.semiMinorAxis=R(this.semiMinorAxis,e.semiMinorAxis),this.height=R(this.height,e.height),this.heightReference=R(this.heightReference,e.heightReference),this.extrudedHeight=R(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=R(this.extrudedHeightReference,e.extrudedHeightReference),this.rotation=R(this.rotation,e.rotation),this.stRotation=R(this.stRotation,e.stRotation),this.granularity=R(this.granularity,e.granularity),this.fill=R(this.fill,e.fill),this.material=R(this.material,e.material),this.outline=R(this.outline,e.outline),this.outlineColor=R(this.outlineColor,e.outlineColor),this.outlineWidth=R(this.outlineWidth,e.outlineWidth),this.numberOfVerticalLines=R(this.numberOfVerticalLines,e.numberOfVerticalLines),this.shadows=R(this.shadows,e.shadows),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=R(this.classificationType,e.classificationType),this.zIndex=R(this.zIndex,e.zIndex)};var dX=hX;function fX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._radii=void 0,this._radiiSubscription=void 0,this._innerRadii=void 0,this._innerRadiiSubscription=void 0,this._minimumClock=void 0,this._minimumClockSubscription=void 0,this._maximumClock=void 0,this._maximumClockSubscription=void 0,this._minimumCone=void 0,this._minimumConeSubscription=void 0,this._maximumCone=void 0,this._maximumConeSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._stackPartitions=void 0,this._stackPartitionsSubscription=void 0,this._slicePartitions=void 0,this._slicePartitionsSubscription=void 0,this._subdivisions=void 0,this._subdivisionsSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(fX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),radii:Tz("radii"),innerRadii:Tz("innerRadii"),minimumClock:Tz("minimumClock"),maximumClock:Tz("maximumClock"),minimumCone:Tz("minimumCone"),maximumCone:Tz("maximumCone"),heightReference:Tz("heightReference"),fill:Tz("fill"),material:QK("material"),outline:Tz("outline"),outlineColor:Tz("outlineColor"),outlineWidth:Tz("outlineWidth"),stackPartitions:Tz("stackPartitions"),slicePartitions:Tz("slicePartitions"),subdivisions:Tz("subdivisions"),shadows:Tz("shadows"),distanceDisplayCondition:Tz("distanceDisplayCondition")}),fX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.radii=this.radii,e.innerRadii=this.innerRadii,e.minimumClock=this.minimumClock,e.maximumClock=this.maximumClock,e.minimumCone=this.minimumCone,e.maximumCone=this.maximumCone,e.heightReference=this.heightReference,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.stackPartitions=this.stackPartitions,e.slicePartitions=this.slicePartitions,e.subdivisions=this.subdivisions,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new fX(this)},fX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.radii=R(this.radii,e.radii),this.innerRadii=R(this.innerRadii,e.innerRadii),this.minimumClock=R(this.minimumClock,e.minimumClock),this.maximumClock=R(this.maximumClock,e.maximumClock),this.minimumCone=R(this.minimumCone,e.minimumCone),this.maximumCone=R(this.maximumCone,e.maximumCone),this.heightReference=R(this.heightReference,e.heightReference),this.fill=R(this.fill,e.fill),this.material=R(this.material,e.material),this.outline=R(this.outline,e.outline),this.outlineColor=R(this.outlineColor,e.outlineColor),this.outlineWidth=R(this.outlineWidth,e.outlineWidth),this.stackPartitions=R(this.stackPartitions,e.stackPartitions),this.slicePartitions=R(this.slicePartitions,e.slicePartitions),this.subdivisions=R(this.subdivisions,e.subdivisions),this.shadows=R(this.shadows,e.shadows),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition)};var pX=fX;function mX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._text=void 0,this._textSubscription=void 0,this._font=void 0,this._fontSubscription=void 0,this._style=void 0,this._styleSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this._showBackground=void 0,this._showBackgroundSubscription=void 0,this._backgroundColor=void 0,this._backgroundColorSubscription=void 0,this._backgroundPadding=void 0,this._backgroundPaddingSubscription=void 0,this._pixelOffset=void 0,this._pixelOffsetSubscription=void 0,this._eyeOffset=void 0,this._eyeOffsetSubscription=void 0,this._horizontalOrigin=void 0,this._horizontalOriginSubscription=void 0,this._verticalOrigin=void 0,this._verticalOriginSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._fillColor=void 0,this._fillColorSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._translucencyByDistance=void 0,this._translucencyByDistanceSubscription=void 0,this._pixelOffsetScaleByDistance=void 0,this._pixelOffsetScaleByDistanceSubscription=void 0,this._scaleByDistance=void 0,this._scaleByDistanceSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._disableDepthTestDistance=void 0,this._disableDepthTestDistanceSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(mX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),text:Tz("text"),font:Tz("font"),style:Tz("style"),scale:Tz("scale"),showBackground:Tz("showBackground"),backgroundColor:Tz("backgroundColor"),backgroundPadding:Tz("backgroundPadding"),pixelOffset:Tz("pixelOffset"),eyeOffset:Tz("eyeOffset"),horizontalOrigin:Tz("horizontalOrigin"),verticalOrigin:Tz("verticalOrigin"),heightReference:Tz("heightReference"),fillColor:Tz("fillColor"),outlineColor:Tz("outlineColor"),outlineWidth:Tz("outlineWidth"),translucencyByDistance:Tz("translucencyByDistance"),pixelOffsetScaleByDistance:Tz("pixelOffsetScaleByDistance"),scaleByDistance:Tz("scaleByDistance"),distanceDisplayCondition:Tz("distanceDisplayCondition"),disableDepthTestDistance:Tz("disableDepthTestDistance")}),mX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.text=this.text,e.font=this.font,e.style=this.style,e.scale=this.scale,e.showBackground=this.showBackground,e.backgroundColor=this.backgroundColor,e.backgroundPadding=this.backgroundPadding,e.pixelOffset=this.pixelOffset,e.eyeOffset=this.eyeOffset,e.horizontalOrigin=this.horizontalOrigin,e.verticalOrigin=this.verticalOrigin,e.heightReference=this.heightReference,e.fillColor=this.fillColor,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.translucencyByDistance=this.translucencyByDistance,e.pixelOffsetScaleByDistance=this.pixelOffsetScaleByDistance,e.scaleByDistance=this.scaleByDistance,e.distanceDisplayCondition=this.distanceDisplayCondition,e.disableDepthTestDistance=this.disableDepthTestDistance,e):new mX(this)},mX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.text=R(this.text,e.text),this.font=R(this.font,e.font),this.style=R(this.style,e.style),this.scale=R(this.scale,e.scale),this.showBackground=R(this.showBackground,e.showBackground),this.backgroundColor=R(this.backgroundColor,e.backgroundColor),this.backgroundPadding=R(this.backgroundPadding,e.backgroundPadding),this.pixelOffset=R(this.pixelOffset,e.pixelOffset),this.eyeOffset=R(this.eyeOffset,e.eyeOffset),this.horizontalOrigin=R(this.horizontalOrigin,e.horizontalOrigin),this.verticalOrigin=R(this.verticalOrigin,e.verticalOrigin),this.heightReference=R(this.heightReference,e.heightReference),this.fillColor=R(this.fillColor,e.fillColor),this.outlineColor=R(this.outlineColor,e.outlineColor),this.outlineWidth=R(this.outlineWidth,e.outlineWidth),this.translucencyByDistance=R(this.translucencyByDistance,e.translucencyByDistance),this.pixelOffsetScaleByDistance=R(this.pixelOffsetScaleByDistance,e.pixelOffsetScaleByDistance),this.scaleByDistance=R(this.scaleByDistance,e.scaleByDistance),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition),this.disableDepthTestDistance=R(this.disableDepthTestDistance,e.disableDepthTestDistance)};var _X=mX;const gX=new VN;function yX(e){e=R(e,R.EMPTY_OBJECT),this._definitionChanged=new $n,this._translation=void 0,this._translationSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this.translation=e.translation,this.rotation=e.rotation,this.scale=e.scale}Object.defineProperties(yX.prototype,{isConstant:{get:function(){return Bz.isConstant(this._translation)&&Bz.isConstant(this._rotation)&&Bz.isConstant(this._scale)}},definitionChanged:{get:function(){return this._definitionChanged}},translation:Tz("translation"),rotation:Tz("rotation"),scale:Tz("scale")}),yX.prototype.getValue=function(e,t){return C(t)||(t=new VN),t.translation=Bz.getValueOrClonedDefault(this._translation,e,gX.translation,t.translation),t.rotation=Bz.getValueOrClonedDefault(this._rotation,e,gX.rotation,t.rotation),t.scale=Bz.getValueOrClonedDefault(this._scale,e,gX.scale,t.scale),t},yX.prototype.equals=function(e){return this===e||e instanceof yX&&Bz.equals(this._translation,e._translation)&&Bz.equals(this._rotation,e._rotation)&&Bz.equals(this._scale,e._scale)};var vX=yX;function bX(e,t){this._propertyNames=[],this._definitionChanged=new $n,C(e)&&this.merge(e,t)}function AX(e){return new vz(e)}function wX(e,t){const n=e._propertyNames,i=t._propertyNames,o=n.length;if(o!==i.length)return!1;for(let r=0;r<o;++r){const o=n[r],s=i.indexOf(o);if(-1===s)return!1;if(!Bz.equals(e[o],t[o]))return!1}return!0}Object.defineProperties(bX.prototype,{propertyNames:{get:function(){return this._propertyNames}},isConstant:{get:function(){const e=this._propertyNames;for(let t=0,n=e.length;t<n;t++)if(!Bz.isConstant(this[e[t]]))return!1;return!0}},definitionChanged:{get:function(){return this._definitionChanged}}}),bX.prototype.hasProperty=function(e){return-1!==this._propertyNames.indexOf(e)},bX.prototype.addProperty=function(e,t,n){const i=this._propertyNames;if(!C(e))throw new x("propertyName is required.");if(-1!==i.indexOf(e))throw new x(`${e} is already a registered property.`);i.push(e),Object.defineProperty(this,e,Tz(e,!0,R(n,AX))),C(t)&&(this[e]=t),this._definitionChanged.raiseEvent(this)},bX.prototype.removeProperty=function(e){const t=this._propertyNames,n=t.indexOf(e);if(!C(e))throw new x("propertyName is required.");if(-1===n)throw new x(`${e} is not a registered property.`);this._propertyNames.splice(n,1),delete this[e],this._definitionChanged.raiseEvent(this)},bX.prototype.getValue=function(e,t){if(!C(e))throw new x("time is required.");C(t)||(t={});const n=this._propertyNames;for(let i=0,o=n.length;i<o;i++){const o=n[i];t[o]=Bz.getValueOrUndefined(this[o],e,t[o])}return t},bX.prototype.merge=function(e,t){if(!C(e))throw new x("source is required.");const n=this._propertyNames,i=C(e._propertyNames)?e._propertyNames:Object.keys(e);for(let o=0,r=i.length;o<r;o++){const r=i[o],s=this[r],a=e[r];void 0===s&&-1===n.indexOf(r)&&this.addProperty(r,void 0,t),void 0!==a&&(void 0!==s?C(s)&&C(s.merge)&&s.merge(a):C(a)&&C(a.merge)&&C(a.clone)?this[r]=a.clone():this[r]=a)}},bX.prototype.equals=function(e){return this===e||e instanceof bX&&wX(this,e)};var TX=bX;function CX(e){return new vX(e)}function EX(e){return new TX(e,CX)}function xX(e){return new TX(e)}function SX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._uri=void 0,this._uriSubscription=void 0,this._scale=void 0,this._scaleSubscription=void 0,this._minimumPixelSize=void 0,this._minimumPixelSizeSubscription=void 0,this._maximumScale=void 0,this._maximumScaleSubscription=void 0,this._incrementallyLoadTextures=void 0,this._incrementallyLoadTexturesSubscription=void 0,this._runAnimations=void 0,this._runAnimationsSubscription=void 0,this._clampAnimations=void 0,this._clampAnimationsSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._silhouetteColor=void 0,this._silhouetteColorSubscription=void 0,this._silhouetteSize=void 0,this._silhouetteSizeSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._colorBlendMode=void 0,this._colorBlendModeSubscription=void 0,this._colorBlendAmount=void 0,this._colorBlendAmountSubscription=void 0,this._imageBasedLightingFactor=void 0,this._imageBasedLightingFactorSubscription=void 0,this._lightColor=void 0,this._lightColorSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._nodeTransformations=void 0,this._nodeTransformationsSubscription=void 0,this._articulations=void 0,this._articulationsSubscription=void 0,this._clippingPlanes=void 0,this._clippingPlanesSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(SX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),uri:Tz("uri"),scale:Tz("scale"),minimumPixelSize:Tz("minimumPixelSize"),maximumScale:Tz("maximumScale"),incrementallyLoadTextures:Tz("incrementallyLoadTextures"),runAnimations:Tz("runAnimations"),clampAnimations:Tz("clampAnimations"),shadows:Tz("shadows"),heightReference:Tz("heightReference"),silhouetteColor:Tz("silhouetteColor"),silhouetteSize:Tz("silhouetteSize"),color:Tz("color"),colorBlendMode:Tz("colorBlendMode"),colorBlendAmount:Tz("colorBlendAmount"),imageBasedLightingFactor:Tz("imageBasedLightingFactor"),lightColor:Tz("lightColor"),distanceDisplayCondition:Tz("distanceDisplayCondition"),nodeTransformations:Tz("nodeTransformations",void 0,EX),articulations:Tz("articulations",void 0,xX),clippingPlanes:Tz("clippingPlanes")}),SX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.uri=this.uri,e.scale=this.scale,e.minimumPixelSize=this.minimumPixelSize,e.maximumScale=this.maximumScale,e.incrementallyLoadTextures=this.incrementallyLoadTextures,e.runAnimations=this.runAnimations,e.clampAnimations=this.clampAnimations,e.heightReference=this._heightReference,e.silhouetteColor=this.silhouetteColor,e.silhouetteSize=this.silhouetteSize,e.color=this.color,e.colorBlendMode=this.colorBlendMode,e.colorBlendAmount=this.colorBlendAmount,e.imageBasedLightingFactor=this.imageBasedLightingFactor,e.lightColor=this.lightColor,e.distanceDisplayCondition=this.distanceDisplayCondition,e.nodeTransformations=this.nodeTransformations,e.articulations=this.articulations,e.clippingPlanes=this.clippingPlanes,e):new SX(this)},SX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.uri=R(this.uri,e.uri),this.scale=R(this.scale,e.scale),this.minimumPixelSize=R(this.minimumPixelSize,e.minimumPixelSize),this.maximumScale=R(this.maximumScale,e.maximumScale),this.incrementallyLoadTextures=R(this.incrementallyLoadTextures,e.incrementallyLoadTextures),this.runAnimations=R(this.runAnimations,e.runAnimations),this.clampAnimations=R(this.clampAnimations,e.clampAnimations),this.shadows=R(this.shadows,e.shadows),this.heightReference=R(this.heightReference,e.heightReference),this.silhouetteColor=R(this.silhouetteColor,e.silhouetteColor),this.silhouetteSize=R(this.silhouetteSize,e.silhouetteSize),this.color=R(this.color,e.color),this.colorBlendMode=R(this.colorBlendMode,e.colorBlendMode),this.colorBlendAmount=R(this.colorBlendAmount,e.colorBlendAmount),this.imageBasedLightingFactor=R(this.imageBasedLightingFactor,e.imageBasedLightingFactor),this.lightColor=R(this.lightColor,e.lightColor),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition),this.clippingPlanes=R(this.clippingPlanes,e.clippingPlanes);const t=e.nodeTransformations;if(C(t)){const e=this.nodeTransformations;C(e)?e.merge(t):this.nodeTransformations=new TX(t,CX)}const n=e.articulations;if(C(n)){const e=this.articulations;C(e)?e.merge(n):this.articulations=new TX(n)}};var IX=SX;function OX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._uri=void 0,this._uriSubscription=void 0,this._maximumScreenSpaceError=void 0,this._maximumScreenSpaceErrorSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(OX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),uri:Tz("uri"),maximumScreenSpaceError:Tz("maximumScreenSpaceError")}),OX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.uri=this.uri,e.maximumScreenSpaceError=this.maximumScreenSpaceError,e):new OX(this)},OX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.uri=R(this.uri,e.uri),this.maximumScreenSpaceError=R(this.maximumScreenSpaceError,e.maximumScreenSpaceError)};var DX=OX;function PX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._leadTime=void 0,this._leadTimeSubscription=void 0,this._trailTime=void 0,this._trailTimeSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._resolution=void 0,this._resolutionSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(PX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),leadTime:Tz("leadTime"),trailTime:Tz("trailTime"),width:Tz("width"),resolution:Tz("resolution"),material:QK("material"),distanceDisplayCondition:Tz("distanceDisplayCondition")}),PX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.leadTime=this.leadTime,e.trailTime=this.trailTime,e.width=this.width,e.resolution=this.resolution,e.material=this.material,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new PX(this)},PX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.leadTime=R(this.leadTime,e.leadTime),this.trailTime=R(this.trailTime,e.trailTime),this.width=R(this.width,e.width),this.resolution=R(this.resolution,e.resolution),this.material=R(this.material,e.material),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition)};var RX=PX;function LX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._plane=void 0,this._planeSubscription=void 0,this._dimensions=void 0,this._dimensionsSubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(LX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),plane:Tz("plane"),dimensions:Tz("dimensions"),fill:Tz("fill"),material:QK("material"),outline:Tz("outline"),outlineColor:Tz("outlineColor"),outlineWidth:Tz("outlineWidth"),shadows:Tz("shadows"),distanceDisplayCondition:Tz("distanceDisplayCondition")}),LX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.plane=this.plane,e.dimensions=this.dimensions,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new LX(this)},LX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.plane=R(this.plane,e.plane),this.dimensions=R(this.dimensions,e.dimensions),this.fill=R(this.fill,e.fill),this.material=R(this.material,e.material),this.outline=R(this.outline,e.outline),this.outlineColor=R(this.outlineColor,e.outlineColor),this.outlineWidth=R(this.outlineWidth,e.outlineWidth),this.shadows=R(this.shadows,e.shadows),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition)};var MX=LX;function BX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._pixelSize=void 0,this._pixelSizeSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._scaleByDistance=void 0,this._scaleByDistanceSubscription=void 0,this._translucencyByDistance=void 0,this._translucencyByDistanceSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._disableDepthTestDistance=void 0,this._disableDepthTestDistanceSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(BX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),pixelSize:Tz("pixelSize"),heightReference:Tz("heightReference"),color:Tz("color"),outlineColor:Tz("outlineColor"),outlineWidth:Tz("outlineWidth"),scaleByDistance:Tz("scaleByDistance"),translucencyByDistance:Tz("translucencyByDistance"),distanceDisplayCondition:Tz("distanceDisplayCondition"),disableDepthTestDistance:Tz("disableDepthTestDistance")}),BX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.pixelSize=this.pixelSize,e.heightReference=this.heightReference,e.color=this.color,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.scaleByDistance=this.scaleByDistance,e.translucencyByDistance=this._translucencyByDistance,e.distanceDisplayCondition=this.distanceDisplayCondition,e.disableDepthTestDistance=this.disableDepthTestDistance,e):new BX(this)},BX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.pixelSize=R(this.pixelSize,e.pixelSize),this.heightReference=R(this.heightReference,e.heightReference),this.color=R(this.color,e.color),this.outlineColor=R(this.outlineColor,e.outlineColor),this.outlineWidth=R(this.outlineWidth,e.outlineWidth),this.scaleByDistance=R(this.scaleByDistance,e.scaleByDistance),this.translucencyByDistance=R(this._translucencyByDistance,e.translucencyByDistance),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition),this.disableDepthTestDistance=R(this.disableDepthTestDistance,e.disableDepthTestDistance)};var NX=BX;function FX(e){return Array.isArray(e)&&(e=new sP(e)),new vz(e)}function zX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._hierarchy=void 0,this._hierarchySubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._stRotation=void 0,this._stRotationSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._perPositionHeight=void 0,this._perPositionHeightSubscription=void 0,this._closeTop=void 0,this._closeTopSubscription=void 0,this._closeBottom=void 0,this._closeBottomSubscription=void 0,this._arcType=void 0,this._arcTypeSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(zX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),hierarchy:Tz("hierarchy",void 0,FX),height:Tz("height"),heightReference:Tz("heightReference"),extrudedHeight:Tz("extrudedHeight"),extrudedHeightReference:Tz("extrudedHeightReference"),stRotation:Tz("stRotation"),granularity:Tz("granularity"),fill:Tz("fill"),material:QK("material"),outline:Tz("outline"),outlineColor:Tz("outlineColor"),outlineWidth:Tz("outlineWidth"),perPositionHeight:Tz("perPositionHeight"),closeTop:Tz("closeTop"),closeBottom:Tz("closeBottom"),arcType:Tz("arcType"),shadows:Tz("shadows"),distanceDisplayCondition:Tz("distanceDisplayCondition"),classificationType:Tz("classificationType"),zIndex:Tz("zIndex")}),zX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.hierarchy=this.hierarchy,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.stRotation=this.stRotation,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.perPositionHeight=this.perPositionHeight,e.closeTop=this.closeTop,e.closeBottom=this.closeBottom,e.arcType=this.arcType,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new zX(this)},zX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.hierarchy=R(this.hierarchy,e.hierarchy),this.height=R(this.height,e.height),this.heightReference=R(this.heightReference,e.heightReference),this.extrudedHeight=R(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=R(this.extrudedHeightReference,e.extrudedHeightReference),this.stRotation=R(this.stRotation,e.stRotation),this.granularity=R(this.granularity,e.granularity),this.fill=R(this.fill,e.fill),this.material=R(this.material,e.material),this.outline=R(this.outline,e.outline),this.outlineColor=R(this.outlineColor,e.outlineColor),this.outlineWidth=R(this.outlineWidth,e.outlineWidth),this.perPositionHeight=R(this.perPositionHeight,e.perPositionHeight),this.closeTop=R(this.closeTop,e.closeTop),this.closeBottom=R(this.closeBottom,e.closeBottom),this.arcType=R(this.arcType,e.arcType),this.shadows=R(this.shadows,e.shadows),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=R(this.classificationType,e.classificationType),this.zIndex=R(this.zIndex,e.zIndex)};var kX=zX;function UX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._width=void 0,this._widthSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._depthFailMaterial=void 0,this._depthFailMaterialSubscription=void 0,this._arcType=void 0,this._arcTypeSubscription=void 0,this._clampToGround=void 0,this._clampToGroundSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(UX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),positions:Tz("positions"),width:Tz("width"),granularity:Tz("granularity"),material:QK("material"),depthFailMaterial:QK("depthFailMaterial"),arcType:Tz("arcType"),clampToGround:Tz("clampToGround"),shadows:Tz("shadows"),distanceDisplayCondition:Tz("distanceDisplayCondition"),classificationType:Tz("classificationType"),zIndex:Tz("zIndex")}),UX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.positions=this.positions,e.width=this.width,e.granularity=this.granularity,e.material=this.material,e.depthFailMaterial=this.depthFailMaterial,e.arcType=this.arcType,e.clampToGround=this.clampToGround,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new UX(this)},UX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.positions=R(this.positions,e.positions),this.width=R(this.width,e.width),this.granularity=R(this.granularity,e.granularity),this.material=R(this.material,e.material),this.depthFailMaterial=R(this.depthFailMaterial,e.depthFailMaterial),this.arcType=R(this.arcType,e.arcType),this.clampToGround=R(this.clampToGround,e.clampToGround),this.shadows=R(this.shadows,e.shadows),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=R(this.classificationType,e.classificationType),this.zIndex=R(this.zIndex,e.zIndex)};var VX=UX;function HX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._shape=void 0,this._shapeSubscription=void 0,this._cornerType=void 0,this._cornerTypeSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubsription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(HX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),positions:Tz("positions"),shape:Tz("shape"),cornerType:Tz("cornerType"),granularity:Tz("granularity"),fill:Tz("fill"),material:QK("material"),outline:Tz("outline"),outlineColor:Tz("outlineColor"),outlineWidth:Tz("outlineWidth"),shadows:Tz("shadows"),distanceDisplayCondition:Tz("distanceDisplayCondition")}),HX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.positions=this.positions,e.shape=this.shape,e.cornerType=this.cornerType,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new HX(this)},HX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.positions=R(this.positions,e.positions),this.shape=R(this.shape,e.shape),this.cornerType=R(this.cornerType,e.cornerType),this.granularity=R(this.granularity,e.granularity),this.fill=R(this.fill,e.fill),this.material=R(this.material,e.material),this.outline=R(this.outline,e.outline),this.outlineColor=R(this.outlineColor,e.outlineColor),this.outlineWidth=R(this.outlineWidth,e.outlineWidth),this.shadows=R(this.shadows,e.shadows),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition)};var GX=HX;function WX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._coordinates=void 0,this._coordinatesSubscription=void 0,this._height=void 0,this._heightSubscription=void 0,this._heightReference=void 0,this._heightReferenceSubscription=void 0,this._extrudedHeight=void 0,this._extrudedHeightSubscription=void 0,this._extrudedHeightReference=void 0,this._extrudedHeightReferenceSubscription=void 0,this._rotation=void 0,this._rotationSubscription=void 0,this._stRotation=void 0,this._stRotationSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distancedisplayConditionSubscription=void 0,this._classificationType=void 0,this._classificationTypeSubscription=void 0,this._zIndex=void 0,this._zIndexSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(WX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),coordinates:Tz("coordinates"),height:Tz("height"),heightReference:Tz("heightReference"),extrudedHeight:Tz("extrudedHeight"),extrudedHeightReference:Tz("extrudedHeightReference"),rotation:Tz("rotation"),stRotation:Tz("stRotation"),granularity:Tz("granularity"),fill:Tz("fill"),material:QK("material"),outline:Tz("outline"),outlineColor:Tz("outlineColor"),outlineWidth:Tz("outlineWidth"),shadows:Tz("shadows"),distanceDisplayCondition:Tz("distanceDisplayCondition"),classificationType:Tz("classificationType"),zIndex:Tz("zIndex")}),WX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.coordinates=this.coordinates,e.height=this.height,e.heightReference=this.heightReference,e.extrudedHeight=this.extrudedHeight,e.extrudedHeightReference=this.extrudedHeightReference,e.rotation=this.rotation,e.stRotation=this.stRotation,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e.classificationType=this.classificationType,e.zIndex=this.zIndex,e):new WX(this)},WX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.coordinates=R(this.coordinates,e.coordinates),this.height=R(this.height,e.height),this.heightReference=R(this.heightReference,e.heightReference),this.extrudedHeight=R(this.extrudedHeight,e.extrudedHeight),this.extrudedHeightReference=R(this.extrudedHeightReference,e.extrudedHeightReference),this.rotation=R(this.rotation,e.rotation),this.stRotation=R(this.stRotation,e.stRotation),this.granularity=R(this.granularity,e.granularity),this.fill=R(this.fill,e.fill),this.material=R(this.material,e.material),this.outline=R(this.outline,e.outline),this.outlineColor=R(this.outlineColor,e.outlineColor),this.outlineWidth=R(this.outlineWidth,e.outlineWidth),this.shadows=R(this.shadows,e.shadows),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition),this.classificationType=R(this.classificationType,e.classificationType),this.zIndex=R(this.zIndex,e.zIndex)};var qX=WX;function jX(e){this._definitionChanged=new $n,this._show=void 0,this._showSubscription=void 0,this._positions=void 0,this._positionsSubscription=void 0,this._minimumHeights=void 0,this._minimumHeightsSubscription=void 0,this._maximumHeights=void 0,this._maximumHeightsSubscription=void 0,this._granularity=void 0,this._granularitySubscription=void 0,this._fill=void 0,this._fillSubscription=void 0,this._material=void 0,this._materialSubscription=void 0,this._outline=void 0,this._outlineSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this._shadows=void 0,this._shadowsSubscription=void 0,this._distanceDisplayCondition=void 0,this._distanceDisplayConditionSubscription=void 0,this.merge(R(e,R.EMPTY_OBJECT))}Object.defineProperties(jX.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:Tz("show"),positions:Tz("positions"),minimumHeights:Tz("minimumHeights"),maximumHeights:Tz("maximumHeights"),granularity:Tz("granularity"),fill:Tz("fill"),material:QK("material"),outline:Tz("outline"),outlineColor:Tz("outlineColor"),outlineWidth:Tz("outlineWidth"),shadows:Tz("shadows"),distanceDisplayCondition:Tz("distanceDisplayCondition")}),jX.prototype.clone=function(e){return C(e)?(e.show=this.show,e.positions=this.positions,e.minimumHeights=this.minimumHeights,e.maximumHeights=this.maximumHeights,e.granularity=this.granularity,e.fill=this.fill,e.material=this.material,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.shadows=this.shadows,e.distanceDisplayCondition=this.distanceDisplayCondition,e):new jX(this)},jX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.show=R(this.show,e.show),this.positions=R(this.positions,e.positions),this.minimumHeights=R(this.minimumHeights,e.minimumHeights),this.maximumHeights=R(this.maximumHeights,e.maximumHeights),this.granularity=R(this.granularity,e.granularity),this.fill=R(this.fill,e.fill),this.material=R(this.material,e.material),this.outline=R(this.outline,e.outline),this.outlineColor=R(this.outlineColor,e.outlineColor),this.outlineWidth=R(this.outlineWidth,e.outlineWidth),this.shadows=R(this.shadows,e.shadows),this.distanceDisplayCondition=R(this.distanceDisplayCondition,e.distanceDisplayCondition)};var YX=jX;const KX=new se;function XX(e){return new iX(e)}function QX(e){return Tz(e,void 0,XX)}function JX(e,t){return Tz(e,void 0,(function(e){return e instanceof t?e:new t(e)}))}function ZX(e){e=R(e,R.EMPTY_OBJECT);let t=e.id;C(t)||(t=wk()),this._availability=void 0,this._id=t,this._definitionChanged=new $n,this._name=e.name,this._show=R(e.show,!0),this._parent=void 0,this._propertyNames=["billboard","box","corridor","cylinder","description","ellipse","ellipsoid","label","model","tileset","orientation","path","plane","point","polygon","polyline","polylineVolume","position","properties","rectangle","viewFrom","wall"],this._billboard=void 0,this._billboardSubscription=void 0,this._box=void 0,this._boxSubscription=void 0,this._corridor=void 0,this._corridorSubscription=void 0,this._cylinder=void 0,this._cylinderSubscription=void 0,this._description=void 0,this._descriptionSubscription=void 0,this._ellipse=void 0,this._ellipseSubscription=void 0,this._ellipsoid=void 0,this._ellipsoidSubscription=void 0,this._label=void 0,this._labelSubscription=void 0,this._model=void 0,this._modelSubscription=void 0,this._tileset=void 0,this._tilesetSubscription=void 0,this._orientation=void 0,this._orientationSubscription=void 0,this._path=void 0,this._pathSubscription=void 0,this._plane=void 0,this._planeSubscription=void 0,this._point=void 0,this._pointSubscription=void 0,this._polygon=void 0,this._polygonSubscription=void 0,this._polyline=void 0,this._polylineSubscription=void 0,this._polylineVolume=void 0,this._polylineVolumeSubscription=void 0,this._position=void 0,this._positionSubscription=void 0,this._properties=void 0,this._propertiesSubscription=void 0,this._rectangle=void 0,this._rectangleSubscription=void 0,this._viewFrom=void 0,this._viewFromSubscription=void 0,this._wall=void 0,this._wallSubscription=void 0,this._children=[],this.entityCollection=void 0,this.parent=e.parent,this.merge(e)}function $X(e,t,n){const i=t.length;for(let o=0;o<i;o++){const e=t[o],i=e._show,r=!n&&i,s=n&&i;r!==s&&$X(e,e._children,n)}e._definitionChanged.raiseEvent(e,"isShowing",n,!n)}Object.defineProperties(ZX.prototype,{availability:cX("availability"),id:{get:function(){return this._id}},definitionChanged:{get:function(){return this._definitionChanged}},name:cX("name"),show:{get:function(){return this._show},set:function(e){if(!C(e))throw new x("value is required.");if(e===this._show)return;const t=this.isShowing;this._show=e;const n=this.isShowing;t!==n&&$X(this,this._children,n),this._definitionChanged.raiseEvent(this,"show",e,!e)}},isShowing:{get:function(){return this._show&&(!C(this.entityCollection)||this.entityCollection.show)&&(!C(this._parent)||this._parent.isShowing)}},parent:{get:function(){return this._parent},set:function(e){const t=this._parent;if(t===e)return;const n=this.isShowing;if(C(t)){const e=t._children.indexOf(this);t._children.splice(e,1)}this._parent=e,C(e)&&e._children.push(this);const i=this.isShowing;n!==i&&$X(this,this._children,i),this._definitionChanged.raiseEvent(this,"parent",e,t)}},propertyNames:{get:function(){return this._propertyNames}},billboard:JX("billboard",Ez),box:JX("box",ZK),corridor:JX("corridor",rX),cylinder:JX("cylinder",uX),description:Tz("description"),ellipse:JX("ellipse",dX),ellipsoid:JX("ellipsoid",pX),label:JX("label",_X),model:JX("model",IX),tileset:JX("tileset",DX),orientation:Tz("orientation"),path:JX("path",RX),plane:JX("plane",MX),point:JX("point",NX),polygon:JX("polygon",kX),polyline:JX("polyline",VX),polylineVolume:JX("polylineVolume",GX),properties:JX("properties",TX),position:QX("position"),rectangle:JX("rectangle",qX),viewFrom:Tz("viewFrom"),wall:JX("wall",YX)}),ZX.prototype.isAvailable=function(e){if(!C(e))throw new x("time is required.");const t=this._availability;return!C(t)||t.contains(e)},ZX.prototype.addProperty=function(e){const t=this._propertyNames;if(!C(e))throw new x("propertyName is required.");if(-1!==t.indexOf(e))throw new x(`${e} is already a registered property.`);if(e in this)throw new x(`${e} is a reserved property name.`);t.push(e),Object.defineProperty(this,e,cX(e,!0))},ZX.prototype.removeProperty=function(e){const t=this._propertyNames,n=t.indexOf(e);if(!C(e))throw new x("propertyName is required.");if(-1===n)throw new x(`${e} is not a registered property.`);this._propertyNames.splice(n,1),delete this[e]},ZX.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.name=R(this.name,e.name),this.availability=R(this.availability,e.availability);const t=this._propertyNames,n=C(e._propertyNames)?e._propertyNames:Object.keys(e),i=n.length;for(let o=0;o<i;o++){const i=n[o];if("parent"===i||"name"===i||"availability"===i)continue;const r=this[i],s=e[i];C(r)||-1!==t.indexOf(i)||this.addProperty(i),C(s)&&(C(r)?C(r.merge)&&r.merge(s):C(s.merge)&&C(s.clone)?this[i]=s.clone():this[i]=s)}};const eQ=new ke,tQ=new K,nQ=new il;ZX.prototype.computeModelMatrix=function(e,t){D.typeOf.object("time",e);const n=Bz.getValueOrUndefined(this._position,e,tQ);if(!C(n))return;const i=Bz.getValueOrUndefined(this._orientation,e,nQ);return t=C(i)?ft.fromRotationTranslation(ke.fromQuaternion(i,eQ),n,t):Kl.eastNorthUpToFixedFrame(n,void 0,t),t},ZX.prototype.computeModelMatrixForHeightReference=function(e,t,n,i,o){D.typeOf.object("time",e);const r=Bz.getValueOrDefault(t,e,Sz.NONE);let s=Bz.getValueOrUndefined(this._position,e,tQ);if(r===Sz.NONE||!C(s)||K.equalsEpsilon(s,K.ZERO,z.EPSILON8))return this.computeModelMatrix(e,o);const a=i.cartesianToCartographic(s,KX);r===Sz.CLAMP_TO_GROUND?a.height=n:a.height+=n,s=i.cartographicToCartesian(a,s);const c=Bz.getValueOrUndefined(this._orientation,e,nQ);return o=C(c)?ft.fromRotationTranslation(ke.fromQuaternion(c,eQ),s,o):Kl.eastNorthUpToFixedFrame(s,void 0,o),o},ZX.supportsMaterialsforEntitiesOnTerrain=function(e){return mK.supportsMaterials(e)},ZX.supportsPolylinesOnTerrain=function(e){return HK.isSupported(e)};var iQ=ZX;const oQ=new BU(xy.WHITE),rQ=new vz(!0),sQ=new vz(!0),aQ=new vz(!1),cQ=new vz(xy.BLACK),lQ=new vz(rj.DISABLED),uQ=new vz(new WT),hQ=new vz(rq.BOTH);function dQ(e){D.defined("options.entity",e.entity),D.defined("options.scene",e.scene),D.defined("options.geometryOptions",e.geometryOptions),D.defined("options.geometryPropertyName",e.geometryPropertyName),D.defined("options.observedPropertyNames",e.observedPropertyNames);const t=e.entity,n=e.geometryPropertyName;this._entity=t,this._scene=e.scene,this._fillEnabled=!1,this._isClosed=!1,this._onTerrain=!1,this._dynamic=!1,this._outlineEnabled=!1,this._geometryChanged=new $n,this._showProperty=void 0,this._materialProperty=void 0,this._showOutlineProperty=void 0,this._outlineColorProperty=void 0,this._outlineWidth=1,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._options=e.geometryOptions,this._geometryPropertyName=n,this._id=`${n}-${t.id}`,this._observedPropertyNames=e.observedPropertyNames,this._supportsMaterialsforEntitiesOnTerrain=iQ.supportsMaterialsforEntitiesOnTerrain(e.scene)}Object.defineProperties(dQ.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!C(this._entity.availability)&&Bz.isConstant(this._showProperty)&&Bz.isConstant(this._fillProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},outlineEnabled:{get:function(){return this._outlineEnabled}},hasConstantOutline:{get:function(){return!this._outlineEnabled||!C(this._entity.availability)&&Bz.isConstant(this._showProperty)&&Bz.isConstant(this._showOutlineProperty)}},outlineColorProperty:{get:function(){return this._outlineColorProperty}},outlineWidth:{get:function(){return this._outlineWidth}},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{get:function(){return this._isClosed}},onTerrain:{get:function(){return this._onTerrain}},geometryChanged:{get:function(){return this._geometryChanged}}}),dQ.prototype.isOutlineVisible=function(e){const t=this._entity,n=this._outlineEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e);return R(n,!1)},dQ.prototype.isFilled=function(e){const t=this._entity,n=this._fillEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e);return R(n,!1)},dQ.prototype.createFillGeometryInstance=x.throwInstantiationError,dQ.prototype.createOutlineGeometryInstance=x.throwInstantiationError,dQ.prototype.isDestroyed=function(){return!1},dQ.prototype.destroy=function(){Qh(this)},dQ.prototype._isHidden=function(e,t){const n=t.show;return C(n)&&n.isConstant&&!n.getValue(fO.MINIMUM_VALUE)},dQ.prototype._isOnTerrain=function(e,t){return!1},dQ.prototype._getIsClosed=function(e){return!0},dQ.prototype._isDynamic=x.throwInstantiationError,dQ.prototype._setStaticOptions=x.throwInstantiationError,dQ.prototype._onEntityPropertyChanged=function(e,t,n,i){if(-1===this._observedPropertyNames.indexOf(t))return;const o=this._entity[this._geometryPropertyName];if(!C(o))return void((this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this)));const r=o.fill,s=!C(r)||!r.isConstant||r.getValue(fO.MINIMUM_VALUE),a=o.outline;let c=C(a);if(c&&a.isConstant&&(c=a.getValue(fO.MINIMUM_VALUE)),!s&&!c)return void((this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this)));const l=o.show;if(this._isHidden(e,o))return void((this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this)));this._materialProperty=R(o.material,oQ),this._fillProperty=R(r,sQ),this._showProperty=R(l,rQ),this._showOutlineProperty=R(o.outline,aQ),this._outlineColorProperty=c?R(o.outlineColor,cQ):void 0,this._shadowsProperty=R(o.shadows,lQ),this._distanceDisplayConditionProperty=R(o.distanceDisplayCondition,uQ),this._classificationTypeProperty=R(o.classificationType,hQ),this._fillEnabled=s;const u=this._isOnTerrain(e,o)&&(this._supportsMaterialsforEntitiesOnTerrain||this._materialProperty instanceof BU);if(c&&u&&(CA(CA.geometryOutlines),c=!1),this._onTerrain=u,this._outlineEnabled=c,this._isDynamic(e,o))this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this));else{this._setStaticOptions(e,o),this._isClosed=this._getIsClosed(this._options);const t=o.outlineWidth;this._outlineWidth=C(t)?t.getValue(fO.MINIMUM_VALUE):1,this._dynamic=!1,this._geometryChanged.raiseEvent(this)}},dQ.prototype.createDynamicUpdater=function(e,t){if(D.defined("primitives",e),D.defined("groundPrimitives",t),!this._dynamic)throw new x("This instance does not represent dynamic geometry.");return new this.constructor.DynamicGeometryUpdater(this,e,t)};var fQ=dQ;function pQ(e,t){this._callback=void 0,this._isConstant=void 0,this._definitionChanged=new $n,this.setCallback(e,t)}Object.defineProperties(pQ.prototype,{isConstant:{get:function(){return this._isConstant}},definitionChanged:{get:function(){return this._definitionChanged}}}),pQ.prototype.getValue=function(e,t){return this._callback(e,t)},pQ.prototype.setCallback=function(e,t){if(!C(e))throw new x("callback is required.");if(!C(t))throw new x("isConstant is required.");const n=this._callback!==e||this._isConstant!==t;this._callback=e,this._isConstant=t,n&&this._definitionChanged.raiseEvent(this)},pQ.prototype.equals=function(e){return this===e||e instanceof pQ&&this._callback===e._callback&&this._isConstant===e._isConstant};var mQ=pQ;const _Q=new K,gQ=new se;function yQ(e,t,n,i){D.defined("scene",e),D.defined("positionProperty",t),this._scene=e,this._heightReference=n,this._extrudedHeightReference=i,this._positionProperty=t,this._position=new K,this._cartographicPosition=new se,this._normal=new K,this._definitionChanged=new $n,this._terrainHeight=0,this._removeCallbackFunc=void 0,this._removeEventListener=void 0,this._removeModeListener=void 0;const o=this;if(C(e.globe)&&(this._removeEventListener=e.terrainProviderChanged.addEventListener((function(){o._updateClamping()})),this._removeModeListener=e.morphComplete.addEventListener((function(){o._updateClamping()}))),t.isConstant){const n=t.getValue(fO.MINIMUM_VALUE,_Q);if(!C(n)||K.equals(n,K.ZERO)||!C(e.globe))return;this._position=K.clone(n,this._position),this._updateClamping(),this._normal=e.globe.ellipsoid.geodeticSurfaceNormal(n,this._normal)}}Object.defineProperties(yQ.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}}}),yQ.prototype._updateClamping=function(){C(this._removeCallbackFunc)&&this._removeCallbackFunc();const e=this._scene,t=e.globe,n=this._position;if(!C(t)||K.equals(n,K.ZERO))return void(this._terrainHeight=0);const i=t.ellipsoid,o=t._surface,r=this,s=i.cartesianToCartographic(n,this._cartographicPosition),a=t.getHeight(s);function c(t){if(e.mode===ij.SCENE3D){const e=i.cartesianToCartographic(t,gQ);r._terrainHeight=e.height}else r._terrainHeight=t.x;r.definitionChanged.raiseEvent()}C(a)?this._terrainHeight=a:this._terrainHeight=0,this._removeCallbackFunc=o.updateHeight(s,c)},yQ.prototype.getValue=function(e,t){const n=Bz.getValueOrDefault(this._heightReference,e,Sz.NONE),i=Bz.getValueOrDefault(this._extrudedHeightReference,e,Sz.NONE);if(n===Sz.NONE&&i!==Sz.RELATIVE_TO_GROUND)return this._position=K.clone(K.ZERO,this._position),K.clone(K.ZERO,t);if(this._positionProperty.isConstant)return K.multiplyByScalar(this._normal,this._terrainHeight,t);const o=this._scene,r=this._positionProperty.getValue(e,_Q);if(!C(r)||K.equals(r,K.ZERO)||!C(o.globe))return K.clone(K.ZERO,t);if(K.equalsEpsilon(this._position,r,z.EPSILON10))return K.multiplyByScalar(this._normal,this._terrainHeight,t);this._position=K.clone(r,this._position),this._updateClamping();const s=o.globe.ellipsoid.geodeticSurfaceNormal(r,this._normal);return K.multiplyByScalar(s,this._terrainHeight,t)},yQ.prototype.isDestroyed=function(){return!1},yQ.prototype.destroy=function(){return C(this._removeEventListener)&&this._removeEventListener(),C(this._removeModeListener)&&this._removeModeListener(),C(this._removeCallbackFunc)&&this._removeCallbackFunc(),Qh(this)};var vQ=yQ;function bQ(e,t,n,i){if(fQ.prototype._onEntityPropertyChanged.call(this,e,t,n,i),-1===this._observedPropertyNames.indexOf(t))return;const o=this._entity[this._geometryPropertyName];if(!C(o))return;C(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);const r=o.heightReference;if(C(r)){const e=new mQ(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new vQ(this._scene,e,r)}}var AQ=bQ;const wQ=K.ZERO,TQ=new K,CQ=new K,EQ=new xy;function xQ(e){this.id=e,this.vertexFormat=void 0,this.dimensions=void 0,this.offsetAttribute=void 0}function SQ(e,t){fQ.call(this,{entity:e,scene:t,geometryOptions:new xQ(e),geometryPropertyName:"box",observedPropertyNames:["availability","position","orientation","box"]}),this._onEntityPropertyChanged(e,"box",e.box,void 0)}function IQ(e,t,n){vK.call(this,e,t,n)}C(Object.create)&&(SQ.prototype=Object.create(fQ.prototype),SQ.prototype.constructor=SQ),Object.defineProperties(SQ.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),SQ.prototype.createFillGeometryInstance=function(e){if(D.defined("time",e),!this._fillEnabled)throw new x("This instance does not represent a filled geometry.");const t=this._entity,n=t.isAvailable(e),i=new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),r=jT.fromDistanceDisplayCondition(o),s={show:i,distanceDisplayCondition:r,color:void 0,offset:void 0};if(this._materialProperty instanceof BU){let t;C(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(t=this._materialProperty.color.getValue(e,EQ)),C(t)||(t=xy.WHITE),s.color=Iy.fromColor(t)}return C(this._options.offsetAttribute)&&(s.offset=JO.fromCartesian3(Bz.getValueOrDefault(this._terrainOffsetProperty,e,wQ,TQ))),new Sm({id:t,geometry:ep.fromDimensions(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:s})},SQ.prototype.createOutlineGeometryInstance=function(e){if(D.defined("time",e),!this._outlineEnabled)throw new x("This instance does not represent an outlined geometry.");const t=this._entity,n=t.isAvailable(e),i=Bz.getValueOrDefault(this._outlineColorProperty,e,xy.BLACK,EQ),o=this._distanceDisplayConditionProperty.getValue(e),r={show:new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Iy.fromColor(i),distanceDisplayCondition:jT.fromDistanceDisplayCondition(o),offset:void 0};return C(this._options.offsetAttribute)&&(r.offset=JO.fromCartesian3(Bz.getValueOrDefault(this._terrainOffsetProperty,e,wQ,TQ))),new Sm({id:t,geometry:sp.fromDimensions(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:r})},SQ.prototype._computeCenter=function(e,t){return Bz.getValueOrUndefined(this._entity.position,e,t)},SQ.prototype._isHidden=function(e,t){return!C(t.dimensions)||!C(e.position)||fQ.prototype._isHidden.call(this,e,t)},SQ.prototype._isDynamic=function(e,t){return!e.position.isConstant||!Bz.isConstant(e.orientation)||!t.dimensions.isConstant||!Bz.isConstant(t.outlineWidth)},SQ.prototype._setStaticOptions=function(e,t){const n=Bz.getValueOrDefault(t.heightReference,fO.MINIMUM_VALUE,Sz.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof BU?LU.VERTEX_FORMAT:SU.MaterialSupport.TEXTURED.vertexFormat,i.dimensions=t.dimensions.getValue(fO.MINIMUM_VALUE,i.dimensions),i.offsetAttribute=n!==Sz.NONE?Wf.ALL:void 0},SQ.prototype._onEntityPropertyChanged=AQ,SQ.DynamicGeometryUpdater=IQ,C(Object.create)&&(IQ.prototype=Object.create(vK.prototype),IQ.prototype.constructor=IQ),IQ.prototype._isHidden=function(e,t,n){const i=Bz.getValueOrUndefined(e.position,n,CQ),o=this._options.dimensions;return!C(i)||!C(o)||vK.prototype._isHidden.call(this,e,t,n)},IQ.prototype._setOptions=function(e,t,n){const i=Bz.getValueOrDefault(t.heightReference,n,Sz.NONE),o=this._options;o.dimensions=Bz.getValueOrUndefined(t.dimensions,n,o.dimensions),o.offsetAttribute=i!==Sz.NONE?Wf.ALL:void 0};var OQ=SQ;function DQ(e){e=R(e,R.EMPTY_OBJECT),this.vertexArray=e.vertexArray,this.fragmentShaderSource=e.fragmentShaderSource,this.shaderProgram=e.shaderProgram,this.uniformMap=e.uniformMap,this.outputTexture=e.outputTexture,this.preExecute=e.preExecute,this.postExecute=e.postExecute,this.canceled=e.canceled,this.persists=R(e.persists,!1),this.pass=HU.COMPUTE,this.owner=e.owner}DQ.prototype.execute=function(e){e.execute(this)};var PQ=DQ,RQ="varying vec2 v_textureCoordinates;\n\nuniform float originalSize;\nuniform sampler2D texture0;\nuniform sampler2D texture1;\nuniform sampler2D texture2;\nuniform sampler2D texture3;\nuniform sampler2D texture4;\nuniform sampler2D texture5;\n\nconst float yMipLevel1 = 1.0 - (1.0 / pow(2.0, 1.0));\nconst float yMipLevel2 = 1.0 - (1.0 / pow(2.0, 2.0));\nconst float yMipLevel3 = 1.0 - (1.0 / pow(2.0, 3.0));\nconst float yMipLevel4 = 1.0 - (1.0 / pow(2.0, 4.0));\n\nvoid main()\n{\n    vec2 uv = v_textureCoordinates;\n    vec2 textureSize = vec2(originalSize * 1.5 + 2.0, originalSize);\n    vec2 pixel = 1.0 / textureSize;\n\n    float mipLevel = 0.0;\n\n    if (uv.x - pixel.x > (textureSize.y / textureSize.x))\n    {\n        mipLevel = 1.0;\n        if (uv.y - pixel.y > yMipLevel1)\n        {\n            mipLevel = 2.0;\n            if (uv.y - pixel.y * 3.0 > yMipLevel2)\n            {\n                mipLevel = 3.0;\n                if (uv.y - pixel.y * 5.0 > yMipLevel3)\n                {\n                    mipLevel = 4.0;\n                    if (uv.y - pixel.y * 7.0 > yMipLevel4)\n                    {\n                        mipLevel = 5.0;\n                    }\n                }\n            }\n        }\n    }\n\n    if (mipLevel > 0.0)\n    {\n        float scale = pow(2.0, mipLevel);\n\n        uv.y -= (pixel.y * (mipLevel - 1.0) * 2.0);\n        uv.x *= ((textureSize.x - 2.0) / textureSize.y);\n\n        uv.x -= 1.0 + pixel.x;\n        uv.y -= (1.0 - (1.0 / pow(2.0, mipLevel - 1.0)));\n        uv *= scale;\n    }\n    else\n    {\n        uv.x *= (textureSize.x / textureSize.y);\n    }\n\n    if(mipLevel == 0.0)\n    {\n        gl_FragColor = texture2D(texture0, uv);\n    }\n    else if(mipLevel == 1.0)\n    {\n        gl_FragColor = texture2D(texture1, uv);\n    }\n    else if(mipLevel == 2.0)\n    {\n        gl_FragColor = texture2D(texture2, uv);\n    }\n    else if(mipLevel == 3.0)\n    {\n        gl_FragColor = texture2D(texture3, uv);\n    }\n    else if(mipLevel == 4.0)\n    {\n        gl_FragColor = texture2D(texture4, uv);\n    }\n    else if(mipLevel == 5.0)\n    {\n        gl_FragColor = texture2D(texture5, uv);\n    }\n    else\n    {\n        gl_FragColor = vec4(0.0);\n    }\n}\n",LQ="varying vec3 v_cubeMapCoordinates;\nuniform samplerCube cubeMap;\n\nvoid main()\n{\n    vec4 rgba = textureCube(cubeMap, v_cubeMapCoordinates);\n    #ifdef RGBA_NORMALIZED\n        gl_FragColor = vec4(rgba.rgb, 1.0);\n    #else\n        float m = rgba.a * 16.0;\n        vec3 r = rgba.rgb * m;\n        gl_FragColor = vec4(r * r, 1.0);\n    #endif\n}\n",MQ="attribute vec4 position;\nattribute vec3 cubeMapCoordinates;\n\nvarying vec3 v_cubeMapCoordinates;\n\nvoid main()\n{\n    gl_Position = position;\n    v_cubeMapCoordinates = cubeMapCoordinates;\n}\n";function BQ(e){this._url=e,this._cubeMapBuffers=void 0,this._cubeMaps=void 0,this._texture=void 0,this._mipTextures=void 0,this._va=void 0,this._sp=void 0,this._maximumMipmapLevel=void 0,this._loading=!1,this._ready=!1,this._readyPromise=yn()}Object.defineProperties(BQ.prototype,{url:{get:function(){return this._url}},texture:{get:function(){return this._texture}},maximumMipmapLevel:{get:function(){return this._maximumMipmapLevel}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}}}),BQ.isSupported=function(e){return e.colorBufferHalfFloat&&e.halfFloatingPointTexture||e.floatingPointTexture&&e.colorBufferFloat};const NQ=new K(1,0,0),FQ=new K(0,0,1),zQ=new K(-1,0,0),kQ=new K(0,0,-1),UQ=new K(0,1,0),VQ=new K(0,-1,0),HQ=[UQ,zQ,FQ,VQ,NQ,UQ,kQ,UQ,UQ],GQ=HQ.length,WQ=new Float32Array(3*GQ);let qQ=0;for(let ko=0;ko<GQ;++ko,qQ+=3)K.pack(HQ[ko],WQ,qQ);const jQ=new Float32Array([-1,1,-1,0,0,1,0,0,1,0,1,1,0,-1,-1,-1,1,-1]),YQ=new Uint16Array([0,1,2,2,3,1,7,6,1,3,6,1,2,5,4,3,4,2,4,8,6,3,4,6]);function KQ(e){const t=hq.createVertexBuffer({context:e,typedArray:jQ,usage:lq.STATIC_DRAW}),n=hq.createVertexBuffer({context:e,typedArray:WQ,usage:lq.STATIC_DRAW}),i=hq.createIndexBuffer({context:e,typedArray:YQ,usage:lq.STATIC_DRAW,indexDatatype:fd.UNSIGNED_SHORT}),o=[{index:0,vertexBuffer:t,componentsPerAttribute:2,componentDatatype:ih.FLOAT},{index:1,vertexBuffer:n,componentsPerAttribute:3,componentDatatype:ih.FLOAT}];return new bq({context:e,attributes:o,indexBuffer:i})}function XQ(e){return function(){return e}}function QQ(e){let t,n;e._va=e._va&&e._va.destroy(),e._sp=e._sp&&e._sp.destroy();const i=e._cubeMaps;if(C(i))for(n=i.length,t=0;t<n;++t)i[t].destroy();const o=e._mipTextures;if(C(o))for(n=o.length,t=0;t<n;++t)o[t].destroy();e._va=void 0,e._sp=void 0,e._cubeMaps=void 0,e._cubeMapBuffers=void 0,e._mipTextures=void 0}BQ.prototype.update=function(e){const t=e.context;if(!BQ.isSupported(t))return;if(C(this._texture)&&C(this._va)&&QQ(this),C(this._texture))return;if(!C(this._texture)&&!this._loading){const e=t.textureCache.getTexture(this._url);if(C(e))return QQ(this),this._texture=e,this._maximumMipmapLevel=this._texture.maximumMipmapLevel,this._ready=!0,void this._readyPromise.resolve()}const n=this._cubeMapBuffers;if(!C(n)&&!this._loading){const e=this;XF(this._url).then((function(t){e._cubeMapBuffers=t,e._loading=!1})).catch((function(t){e._readyPromise.reject(t)})),this._loading=!0}if(!C(this._cubeMapBuffers))return;const i=[];let o=n[0].positiveX.pixelDatatype;C(o)?i.push("RGBA_NORMALIZED"):o=t.halfFloatingPointTexture?hD.HALF_FLOAT:hD.FLOAT;const r=fD.RGBA,s=new tq({defines:i,sources:[LQ]});this._va=KQ(t),this._sp=fH.fromCache({context:t,vertexShaderSource:MQ,fragmentShaderSource:s,attributeLocations:{position:0,cubeMapCoordinates:1}});const a=Math.min(n.length,6);this._maximumMipmapLevel=a-1;const c=this._cubeMaps=new Array(a),l=this._mipTextures=new Array(a),u=2*n[0].positiveX.width,h={originalSize:function(){return u}};for(let f=0;f<a;++f){const i=n[f].positiveY;n[f].positiveY=n[f].negativeY,n[f].negativeY=i;const s=c[f]=new zk({context:t,source:n[f],pixelDatatype:o}),a=2*c[f].width,u=l[f]=new Uk({context:t,width:a,height:a,pixelDatatype:o,pixelFormat:r}),d=new PQ({vertexArray:this._va,shaderProgram:this._sp,uniformMap:{cubeMap:XQ(s)},outputTexture:u,persists:!0,owner:this});e.commandList.push(d),h[`texture${f}`]=XQ(u)}this._texture=new Uk({context:t,width:1.5*u+2,height:u,pixelDatatype:o,pixelFormat:r}),this._texture.maximumMipmapLevel=this._maximumMipmapLevel,t.textureCache.addTexture(this._url,this._texture);const d=new PQ({fragmentShaderSource:RQ,uniformMap:h,outputTexture:this._texture,persists:!1,owner:this});e.commandList.push(d),this._ready=!0,this._readyPromise.resolve()},BQ.prototype.isDestroyed=function(){return!1},BQ.prototype.destroy=function(){return QQ(this),this._texture=this._texture&&this._texture.destroy(),Qh(this)};var JQ=BQ;function ZQ(e){e=R(e,R.EMPTY_OBJECT);const t=C(e.imageBasedLightingFactor)?ro.clone(e.imageBasedLightingFactor):new ro(1,1);D.typeOf.object("options.imageBasedLightingFactor",t),D.typeOf.number.greaterThanOrEquals("options.imageBasedLightingFactor.x",t.x,0),D.typeOf.number.lessThanOrEquals("options.imageBasedLightingFactor.x",t.x,1),D.typeOf.number.greaterThanOrEquals("options.imageBasedLightingFactor.y",t.y,0),D.typeOf.number.lessThanOrEquals("options.imageBasedLightingFactor.y",t.y,1),this._imageBasedLightingFactor=t;const n=R(e.luminanceAtZenith,.2);D.typeOf.number("options.luminanceAtZenith",n),this._luminanceAtZenith=n;const i=e.sphericalHarmonicCoefficients;if(C(i)&&(!Array.isArray(i)||9!==i.length))throw new x("options.sphericalHarmonicCoefficients must be an array of 9 Cartesian3 values.");this._sphericalHarmonicCoefficients=i,this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._specularEnvironmentMapAtlas=void 0,this._specularEnvironmentMapAtlasDirty=!0,this._specularEnvironmentMapLoaded=!1,this._previousSpecularEnvironmentMapLoaded=!1,this._useDefaultSpecularMaps=!1,this._useDefaultSphericalHarmonics=!1,this._shouldRegenerateShaders=!1,this._previousFrameNumber=void 0,this._previousImageBasedLightingFactor=ro.clone(t),this._previousLuminanceAtZenith=n,this._previousSphericalHarmonicCoefficients=i}function $Q(e,t){if(JQ.isSupported(t)){if(e._specularEnvironmentMapAtlas=e._specularEnvironmentMapAtlas&&e._specularEnvironmentMapAtlas.destroy(),C(e._specularEnvironmentMaps)){const t=new JQ(e._specularEnvironmentMaps);e._specularEnvironmentMapAtlas=t,t.readyPromise.then((function(){e._specularEnvironmentMapLoaded=!0})).catch((function(e){console.error(`Error loading specularEnvironmentMaps: ${e}`)}))}e._shouldRegenerateShaders=!0}}function eJ(e){e=R(e,R.EMPTY_OBJECT),this.color=e.color,this.depth=e.depth,this.stencil=e.stencil,this.renderState=e.renderState,this.framebuffer=e.framebuffer,this.owner=e.owner,this.pass=e.pass}Object.defineProperties(ZQ.prototype,{imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){D.typeOf.object("imageBasedLightingFactor",e),D.typeOf.number.greaterThanOrEquals("imageBasedLightingFactor.x",e.x,0),D.typeOf.number.lessThanOrEquals("imageBasedLightingFactor.x",e.x,1),D.typeOf.number.greaterThanOrEquals("imageBasedLightingFactor.y",e.y,0),D.typeOf.number.lessThanOrEquals("imageBasedLightingFactor.y",e.y,1),this._previousImageBasedLightingFactor=ro.clone(this._imageBasedLightingFactor,this._previousImageBasedLightingFactor),this._imageBasedLightingFactor=ro.clone(e,this._imageBasedLightingFactor)}},luminanceAtZenith:{get:function(){return this._luminanceAtZenith},set:function(e){this._previousLuminanceAtZenith=this._luminanceAtZenith,this._luminanceAtZenith=e}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients},set:function(e){if(C(e)&&(!Array.isArray(e)||9!==e.length))throw new x("sphericalHarmonicCoefficients must be an array of 9 Cartesian3 values.");this._previousSphericalHarmonicCoefficients=this._sphericalHarmonicCoefficients,this._sphericalHarmonicCoefficients=e}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps},set:function(e){e!==this._specularEnvironmentMaps&&(this._specularEnvironmentMapAtlasDirty=this._specularEnvironmentMapAtlasDirty||e!==this._specularEnvironmentMaps,this._specularEnvironmentMapLoaded=!1),this._specularEnvironmentMaps=e}},enabled:{get:function(){return this._imageBasedLightingFactor.x>0||this._imageBasedLightingFactor.y>0}},shouldRegenerateShaders:{get:function(){return this._shouldRegenerateShaders}},useDefaultSphericalHarmonics:{get:function(){return this._useDefaultSphericalHarmonics}},useSphericalHarmonicCoefficients:{get:function(){return C(this._sphericalHarmonicCoefficients)||this._useDefaultSphericalHarmonics}},specularEnvironmentMapAtlas:{get:function(){return this._specularEnvironmentMapAtlas}},useDefaultSpecularMaps:{get:function(){return this._useDefaultSpecularMaps}},useSpecularEnvironmentMaps:{get:function(){return C(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready||this._useDefaultSpecularMaps}}}),ZQ.prototype.update=function(e){if(e.frameNumber===this._previousFrameNumber)return;this._previousFrameNumber=e.frameNumber;const t=e.context;e.brdfLutGenerator.update(e),this._shouldRegenerateShaders=!1;const n=this._imageBasedLightingFactor,i=this._previousImageBasedLightingFactor;ro.equals(n,i)||(this._shouldRegenerateShaders=n.x>0&&0===i.x||0===n.x&&i.x>0,this._shouldRegenerateShaders=this._shouldRegenerateShaders||n.y>0&&0===i.y||0===n.y&&i.y>0,this._previousImageBasedLightingFactor=ro.clone(this._imageBasedLightingFactor,this._previousImageBasedLightingFactor)),this._luminanceAtZenith!==this._previousLuminanceAtZenith&&(this._shouldRegenerateShaders=this._shouldRegenerateShaders||C(this._luminanceAtZenith)!==C(this._previousLuminanceAtZenith),this._previousLuminanceAtZenith=this._luminanceAtZenith),this._previousSphericalHarmonicCoefficients!==this._sphericalHarmonicCoefficients&&(this._shouldRegenerateShaders=this._shouldRegenerateShaders||C(this._previousSphericalHarmonicCoefficients)!==C(this._sphericalHarmonicCoefficients),this._previousSphericalHarmonicCoefficients=this._sphericalHarmonicCoefficients),this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._previousSpecularEnvironmentMapLoaded!==this._specularEnvironmentMapLoaded,this._previousSpecularEnvironmentMapLoaded=this._specularEnvironmentMapLoaded,this._specularEnvironmentMapAtlasDirty&&($Q(this,t),this._specularEnvironmentMapAtlasDirty=!1),C(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e);const o=!C(this._specularEnvironmentMapAtlas)&&C(e.specularEnvironmentMaps)&&!this._useDefaultSpecularMaps,r=!C(e.specularEnvironmentMaps)&&this._useDefaultSpecularMaps,s=!C(this._sphericalHarmonicCoefficients)&&C(e.sphericalHarmonicCoefficients)&&!this._useDefaultSphericalHarmonics,a=!C(e.sphericalHarmonicCoefficients)&&this._useDefaultSphericalHarmonics;this._shouldRegenerateShaders=this._shouldRegenerateShaders||o||r||s||a,this._useDefaultSpecularMaps=!C(this._specularEnvironmentMapAtlas)&&C(e.specularEnvironmentMaps),this._useDefaultSphericalHarmonics=!C(this._sphericalHarmonicCoefficients)&&C(e.sphericalHarmonicCoefficients)},ZQ.prototype.isDestroyed=function(){return!1},ZQ.prototype.destroy=function(){return this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),Qh(this)},eJ.ALL=Object.freeze(new eJ({color:new xy(0,0,0,0),depth:1,stencil:0})),eJ.prototype.execute=function(e,t){e.clear(this,t)};var tJ=eJ;const nJ={X:0,Y:1,Z:2};nJ.Y_UP_TO_Z_UP=ft.fromRotationTranslation(ke.fromRotationX(z.PI_OVER_TWO)),nJ.Z_UP_TO_Y_UP=ft.fromRotationTranslation(ke.fromRotationX(-z.PI_OVER_TWO)),nJ.X_UP_TO_Z_UP=ft.fromRotationTranslation(ke.fromRotationY(-z.PI_OVER_TWO)),nJ.Z_UP_TO_X_UP=ft.fromRotationTranslation(ke.fromRotationY(z.PI_OVER_TWO)),nJ.X_UP_TO_Y_UP=ft.fromRotationTranslation(ke.fromRotationZ(z.PI_OVER_TWO)),nJ.Y_UP_TO_X_UP=ft.fromRotationTranslation(ke.fromRotationZ(-z.PI_OVER_TWO)),nJ.fromName=function(e){return D.typeOf.string("name",e),nJ[e]};var iJ=Object.freeze(nJ);function oJ(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.object("options.metadata",e.metadata),this._metadata=e.metadata}Object.defineProperties(oJ.prototype,{metadata:{get:function(){return this._metadata}}});const rJ={};rJ._deprecationWarning=UF;const sJ=Uint32Array.BYTES_PER_ELEMENT;rJ.parse=function(e,t){const n=R(t,0);D.defined("arrayBuffer",e),t=n;const i=new Uint8Array(e),o=new DataView(e);t+=sJ;const r=o.getUint32(t,!0);if(1!==r)throw new Je(`Only Batched 3D Model version 1 is supported.  Version ${r} is not.`);t+=sJ;const s=o.getUint32(t,!0);t+=sJ;let a=o.getUint32(t,!0);t+=sJ;let c=o.getUint32(t,!0);t+=sJ;let l=o.getUint32(t,!0);t+=sJ;let u,h,d=o.getUint32(t,!0);t+=sJ,l>=570425344?(t-=2*sJ,u=a,l=c,d=0,a=0,c=0,rJ._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchLength] [batchTableByteLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/main/specification/TileFormats/Batched3DModel.")):d>=570425344&&(t-=sJ,u=l,l=a,d=c,a=0,c=0,rJ._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchTableJsonByteLength] [batchTableBinaryByteLength] [batchLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/main/specification/TileFormats/Batched3DModel.")),0===a?h={BATCH_LENGTH:R(u,0)}:(h=Fp(i,t,a),t+=a);const f=new Uint8Array(e,t,c);let p,m;t+=c,l>0&&(p=Fp(i,t,l),t+=l,d>0&&(m=new Uint8Array(e,t,d),m=new Uint8Array(m),t+=d));const _=n+s-t;if(0===_)throw new Je("glTF byte length must be greater than 0.");let g;return t%4===0?g=new Uint8Array(e,t,_):(rJ._deprecationWarning("b3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),g=new Uint8Array(i.subarray(t,t+_))),{batchLength:u,featureTableJson:h,featureTableBinary:f,batchTableJson:p,batchTableBinary:m,gltf:g}};var aJ=rJ;function cJ(e){D.typeOf.number("options.featuresLength",e.featuresLength),D.typeOf.object("options.owner",e.owner);const t=e.featuresLength;let n,i;if(this._showAlphaProperties=void 0,this._batchValues=void 0,this._batchValuesDirty=!1,this._batchTexture=void 0,this._defaultTexture=void 0,this._pickTexture=void 0,this._pickIds=[],t>0){const e=Math.min(t,Ck.maximumTextureSize),o=Math.ceil(t/Ck.maximumTextureSize),r=1/e,s=.5*r,a=1/o,c=.5*a;n=new ro(e,o),i=new Xe(r,s,a,c)}this._translucentFeaturesLength=0,this._featuresLength=t,this._textureDimensions=n,this._textureStep=i,this._owner=e.owner,this._statistics=e.statistics,this._colorChangedCallback=e.colorChangedCallback}function lJ(e){const t=e._textureDimensions;return t.x*t.y*4}function uJ(e){if(!C(e._batchValues)){const t=lJ(e),n=new Uint8Array(t);wf(n,255),e._batchValues=n}return e._batchValues}function hJ(e){if(!C(e._showAlphaProperties)){const t=2*e._featuresLength,n=new Uint8Array(t);wf(n,255),e._showAlphaProperties=n}return e._showAlphaProperties}function dJ(e,t){if(!C(e)||e<0||e>=t)throw new x(`batchId is required and between zero and featuresLength - 1 (${t}`-NaN)}Object.defineProperties(cJ.prototype,{translucentFeaturesLength:{get:function(){return this._translucentFeaturesLength}},memorySizeInBytes:{get:function(){let e=0;return C(this._pickTexture)&&(e+=this._pickTexture.sizeInBytes),C(this._batchTexture)&&(e+=this._batchTexture.sizeInBytes),e}},textureDimensions:{get:function(){return this._textureDimensions}},textureStep:{get:function(){return this._textureStep}},batchTexture:{get:function(){return this._batchTexture}},defaultTexture:{get:function(){return this._defaultTexture}},pickTexture:{get:function(){return this._pickTexture}}}),cJ.DEFAULT_COLOR_VALUE=xy.WHITE,cJ.DEFAULT_SHOW_VALUE=!0,cJ.prototype.setShow=function(e,t){if(dJ(e,this._featuresLength),D.typeOf.bool("show",t),t&&!C(this._showAlphaProperties))return;const n=hJ(this),i=2*e,o=t?255:0;if(n[i]!==o){n[i]=o;const r=uJ(this),s=4*e+3;r[s]=t?n[i+1]:0,this._batchValuesDirty=!0}},cJ.prototype.setAllShow=function(e){D.typeOf.bool("show",e);const t=this._featuresLength;for(let n=0;n<t;++n)this.setShow(n,e)},cJ.prototype.getShow=function(e){if(dJ(e,this._featuresLength),!C(this._showAlphaProperties))return!0;const t=2*e;return 255===this._showAlphaProperties[t]};const fJ=new Array(4);function pJ(e,t,n){const i=e._textureDimensions;return new Uk({context:t,pixelFormat:fD.RGBA,pixelDatatype:hD.UNSIGNED_BYTE,source:{width:i.x,height:i.y,arrayBufferView:n},flipY:!1,sampler:Nk.NEAREST})}function mJ(e,t){const n=e._featuresLength;if(!C(e._pickTexture)&&n>0){const i=e._pickIds,o=lJ(e),r=new Uint8Array(o),s=e._owner,a=e._statistics;for(let e=0;e<n;++e){const n=t.createPickId(s.getFeature(e));i.push(n);const o=n.color,a=4*e;r[a]=xy.floatToByte(o.red),r[a+1]=xy.floatToByte(o.green),r[a+2]=xy.floatToByte(o.blue),r[a+3]=xy.floatToByte(o.alpha)}e._pickTexture=pJ(e,t,r),C(a)&&(a.batchTableByteLength+=e._pickTexture.sizeInBytes)}}function _J(e){const t=e._textureDimensions;e._batchTexture.copyFrom({source:{width:t.x,height:t.y,arrayBufferView:e._batchValues}})}cJ.prototype.setColor=function(e,t){if(dJ(e,this._featuresLength),D.typeOf.object("color",t),xy.equals(t,cJ.DEFAULT_COLOR_VALUE)&&!C(this._batchValues))return;const n=t.toBytes(fJ),i=n[3],o=uJ(this),r=4*e,s=hJ(this),a=2*e;if(o[r]!==n[0]||o[r+1]!==n[1]||o[r+2]!==n[2]||s[a+1]!==i){o[r]=n[0],o[r+1]=n[1],o[r+2]=n[2];const c=255!==s[a+1],l=0!==s[a];o[r+3]=l?i:0,s[a+1]=i;const u=255!==i;u&&!c?++this._translucentFeaturesLength:!u&&c&&--this._translucentFeaturesLength,this._batchValuesDirty=!0,C(this._colorChangedCallback)&&this._colorChangedCallback(e,t)}},cJ.prototype.setAllColor=function(e){D.typeOf.object("color",e);const t=this._featuresLength;for(let n=0;n<t;++n)this.setColor(n,e)},cJ.prototype.getColor=function(e,t){if(dJ(e,this._featuresLength),D.typeOf.object("result",t),!C(this._batchValues))return xy.clone(cJ.DEFAULT_COLOR_VALUE,t);const n=this._batchValues,i=4*e,o=this._showAlphaProperties,r=2*e;return xy.fromBytes(n[i],n[i+1],n[i+2],o[r+1],t)},cJ.prototype.getPickColor=function(e){return dJ(e,this._featuresLength),this._pickIds[e]},cJ.prototype.update=function(e,t){const n=t.context;this._defaultTexture=n.defaultTexture;const i=t.passes;(i.pick||i.postProcess)&&mJ(this,n),this._batchValuesDirty&&(this._batchValuesDirty=!1,C(this._batchTexture)||(this._batchTexture=pJ(this,n,this._batchValues),C(this._statistics)&&(this._statistics.batchTableByteLength+=this._batchTexture.sizeInBytes)),_J(this))},cJ.prototype.isDestroyed=function(){return!1},cJ.prototype.destroy=function(){this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),this._pickTexture=this._pickTexture&&this._pickTexture.destroy();const e=this._pickIds,t=e.length;for(let n=0;n<t;++n)e[n].destroy();return Qh(this)};const gJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},yJ={SCALAR:void 0,VEC2:ro,VEC3:K,VEC4:Xe,MAT2:hh,MAT3:ke,MAT4:ft};function vJ(e){const t=e.componentType;let n;n="string"===typeof t?ih.fromName(t):t;const i=gJ[e.type],o=yJ[e.type];return{componentsPerAttribute:i,classType:o,createArrayBufferView:function(e,t,o){return ih.createArrayBufferView(n,e,t,i*o)}}}var bJ=vJ;function AJ(e){this._classes=void 0,this._classIds=void 0,this._classIndexes=void 0,this._parentCounts=void 0,this._parentIndexes=void 0,this._parentIds=void 0,D.typeOf.object("options.extension",e.extension),wJ(this,e.extension,e.binaryBody),EJ(this)}function wJ(e,t,n){let i,o,r;const s=t.instancesLength,a=t.classes;let c,l=t.classIds,u=t.parentCounts,h=t.parentIds,d=s;if(C(l.byteOffset)&&(l.componentType=R(l.componentType,ih.UNSIGNED_SHORT),l.type=fh.SCALAR,r=bJ(l),l=r.createArrayBufferView(n.buffer,n.byteOffset+l.byteOffset,s)),C(u))for(C(u.byteOffset)&&(u.componentType=R(u.componentType,ih.UNSIGNED_SHORT),u.type=fh.SCALAR,r=bJ(u),u=r.createArrayBufferView(n.buffer,n.byteOffset+u.byteOffset,s)),c=new Uint16Array(s),d=0,i=0;i<s;++i)c[i]=d,d+=u[i];C(h)&&C(h.byteOffset)&&(h.componentType=R(h.componentType,ih.UNSIGNED_SHORT),h.type=fh.SCALAR,r=bJ(h),h=r.createArrayBufferView(n.buffer,n.byteOffset+h.byteOffset,d));const f=a.length;for(i=0;i<f;++i){const e=a[i].length,t=a[i].instances,o=TJ(e,t,n);a[i].instances=_n(o,t)}const p=wf(new Array(f),0),m=new Uint16Array(s);for(i=0;i<s;++i)o=l[i],m[i]=p[o],++p[o];e._classes=a,e._classIds=l,e._classIndexes=m,e._parentCounts=u,e._parentIndexes=c,e._parentIds=h}function TJ(e,t,n){let i;for(const o in t)if(t.hasOwnProperty(o)){const r=t[o],s=r.byteOffset;if(C(s)){const t=r.componentType,a=r.type;if(!C(t))throw new Je("componentType is required.");if(!C(a))throw new Je("type is required.");if(!C(n))throw new Je(`Property ${o} requires a batch table binary.`);const c=bJ(r),l=c.componentsPerAttribute,u=c.classType,h=c.createArrayBufferView(n.buffer,n.byteOffset+s,e);C(i)||(i={}),i[o]={typedArray:h,componentCount:l,type:u}}}return i}const CJ=[];function EJ(e){const t=CJ;t.length=0;const n=e._classIds,i=n.length;for(let o=0;o<i;++o)xJ(e,o,t)}function xJ(e,t,n){const i=e._parentCounts,o=e._parentIds,r=e._parentIndexes,s=e._classIds,a=s.length;if(!C(o))return;if(t>=a)throw new x(`Parent index ${t} exceeds the total number of instances: ${a}`);if(n.indexOf(t)>-1)throw new x("Circular dependency detected in the batch table hierarchy.");n.push(t);const c=C(i)?i[t]:1,l=C(i)?r[t]:t;for(let u=0;u<c;++u){const i=o[l+u];i!==t&&xJ(e,i,n)}n.pop(t)}const SJ=[],IJ=[];let OJ=0;function DJ(e,t,n){const i=e._classIds,o=e._parentCounts,r=e._parentIds,s=e._parentIndexes,a=i.length,c=SJ;c.length=Math.max(c.length,a);const l=++OJ,u=IJ;u.length=0,u.push(t);while(u.length>0){if(t=u.pop(),c[t]===l)continue;c[t]=l;const i=n(e,t);if(C(i))return i;const a=o[t],h=s[t];for(let e=0;e<a;++e){const n=r[h+e];n!==t&&u.push(n)}}}function PJ(e,t,n){let i=!0;while(i){const o=n(e,t);if(C(o))return o;const r=e._parentIds[t];i=r!==t,t=r}}function RJ(e,t,n){const i=e._parentCounts,o=e._parentIds;return C(o)?C(i)?DJ(e,t,n):PJ(e,t,n):n(e,t)}function LJ(e,t){const n=e.typedArray,i=e.componentCount;return 1===i?n[t]:e.type.unpack(n,t*i)}function MJ(e,t,n){const i=e.typedArray,o=e.componentCount;1===o?i[t]=n:e.type.pack(n,i,t*o)}AJ.prototype.hasProperty=function(e,t){const n=RJ(this,e,(function(e,n){const i=e._classIds[n],o=e._classes[i].instances;if(C(o[t]))return!0}));return C(n)},AJ.prototype.propertyExists=function(e){const t=this._classes,n=t.length;for(let i=0;i<n;++i){const n=t[i].instances;if(C(n[e]))return!0}return!1},AJ.prototype.getPropertyIds=function(e,t){return t=C(t)?t:[],t.length=0,RJ(this,e,(function(e,n){const i=e._classIds[n],o=e._classes[i].instances;for(const r in o)o.hasOwnProperty(r)&&-1===t.indexOf(r)&&t.push(r)})),t},AJ.prototype.getProperty=function(e,t){return RJ(this,e,(function(e,n){const i=e._classIds[n],o=e._classes[i],r=e._classIndexes[n],s=o.instances[t];if(C(s))return C(s.typedArray)?LJ(s,r):pn(s[r],!0)}))},AJ.prototype.setProperty=function(e,t,n){const i=RJ(this,e,(function(i,o){const r=i._classIds[o],s=i._classes[r],a=i._classIndexes[o],c=s.instances[t];if(C(c)){if(o!==e)throw new x(`Inherited property "${t}" is read-only.`);return C(c.typedArray)?MJ(c,a,n):c[a]=pn(n,!0),!0}}));return C(i)},AJ.prototype.isClass=function(e,t){const n=RJ(this,e,(function(e,n){const i=e._classIds[n],o=e._classes[i];if(o.name===t)return!0}));return C(n)},AJ.prototype.getClassName=function(e){const t=this._classIds[e],n=this._classes[t];return n.name};const BJ={HIGHLIGHT:0,REPLACE:1,MIX:2};var NJ=Object.freeze(BJ);const FJ=cJ.DEFAULT_COLOR_VALUE,zJ=cJ.DEFAULT_SHOW_VALUE;function kJ(e,t,n,i,o){let r;this.featuresLength=t,C(n)&&(r=n.extensions),this._extensions=R(r,{});const s=UJ(n);this._properties=s,this._batchTableHierarchy=VJ(this,n,i),this._batchTableBinaryProperties=HJ(t,s,i),this._content=e,this._batchTexture=new cJ({featuresLength:t,colorChangedCallback:o,owner:e,statistics:e.tileset.statistics})}function UJ(e){const t={};if(!C(e))return t;for(const n in e)e.hasOwnProperty(n)&&"HIERARCHY"!==n&&"extensions"!==n&&"extras"!==n&&(t[n]=pn(e[n],!0));return t}function VJ(e,t,n){if(!C(t))return;let i=e._extensions["3DTILES_batch_table_hierarchy"];const o=t.HIERARCHY;return C(o)&&(kJ._deprecationWarning("batchTableHierarchyExtension","The batch table HIERARCHY property has been moved to an extension. Use extensions.3DTILES_batch_table_hierarchy instead."),e._extensions["3DTILES_batch_table_hierarchy"]=o,i=o),C(i)?new AJ({extension:i,binaryBody:n}):void 0}function HJ(e,t,n){let i;for(const o in t)if(t.hasOwnProperty(o)){const r=t[o],s=r.byteOffset;if(C(s)){const t=r.componentType,a=r.type;if(!C(t))throw new Je("componentType is required.");if(!C(a))throw new Je("type is required.");if(!C(n))throw new Je(`Property ${o} requires a batch table binary.`);const c=bJ(r),l=c.componentsPerAttribute,u=c.classType,h=c.createArrayBufferView(n.buffer,n.byteOffset+s,e);C(i)||(i={}),i[o]={typedArray:h,componentCount:l,type:u}}}return i}kJ._deprecationWarning=UF,Object.defineProperties(kJ.prototype,{memorySizeInBytes:{get:function(){return this._batchTexture.memorySizeInBytes}}}),kJ.getBinaryProperties=function(e,t,n){return HJ(e,t,n)},kJ.prototype.setShow=function(e,t){this._batchTexture.setShow(e,t)},kJ.prototype.setAllShow=function(e){this._batchTexture.setAllShow(e)},kJ.prototype.getShow=function(e){return this._batchTexture.getShow(e)},kJ.prototype.setColor=function(e,t){this._batchTexture.setColor(e,t)},kJ.prototype.setAllColor=function(e){this._batchTexture.setAllColor(e)},kJ.prototype.getColor=function(e,t){return this._batchTexture.getColor(e,t)},kJ.prototype.getPickColor=function(e){return this._batchTexture.getPickColor(e)};const GJ=new xy;function WJ(e,t){const n=e.typedArray,i=e.componentCount;return 1===i?n[t]:e.type.unpack(n,t*i)}function qJ(e,t,n){const i=e.typedArray,o=e.componentCount;1===o?i[t]=n:e.type.pack(n,i,t*o)}function jJ(e,t){if(!C(e)||e<0||e>=t)throw new x(`batchId is required and between zero and featuresLength - 1 (${t}`-NaN)}function YJ(e){return 1===e._batchTexture.textureDimensions.y?"uniform vec4 tile_textureStep; \nvec2 computeSt(float batchId) \n{ \n    float stepX = tile_textureStep.x; \n    float centerX = tile_textureStep.y; \n    return vec2(centerX + (batchId * stepX), 0.5); \n} \n":"uniform vec4 tile_textureStep; \nuniform vec2 tile_textureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX = tile_textureStep.x; \n    float centerX = tile_textureStep.y; \n    float stepY = tile_textureStep.z; \n    float centerY = tile_textureStep.w; \n    float xId = mod(batchId, tile_textureDimensions.x); \n    float yId = floor(batchId / tile_textureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n"}function KJ(e,t){return e=tq.replaceMain(e,"tile_main"),t?`${e}uniform float tile_colorBlend; \nvoid tile_color(vec4 tile_featureColor) \n{ \n    tile_main(); \n    tile_featureColor = czm_gammaCorrect(tile_featureColor); \n    gl_FragColor.a *= tile_featureColor.a; \n    float highlight = ceil(tile_colorBlend); \n    gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); \n} \n`:`${e}void tile_color(vec4 tile_featureColor) \n{ \n    tile_main(); \n} \n`}function XJ(e,t){const n=`texture2D(${t}`;let i,o=0,r=e.indexOf(n,o);while(r>-1){let t=0;for(let n=r;n<e.length;++n){const o=e.charAt(n);if("("===o)++t;else if(")"===o&&(--t,0===t)){i=n+1;break}}const s=e.slice(r,i),a=`tile_diffuse_final(${s}, tile_diffuse)`;e=e.slice(0,r)+a+e.slice(i),o=r+a.length,r=e.indexOf(n,o)}return e}function QJ(e,t,n){if(!C(t))return KJ(e,n);let i=new RegExp(`(uniform|attribute|in)\\s+(vec[34]|sampler2D)\\s+${t};`);const o=e.match(i);if(!C(o))return KJ(e,n);const r=o[0],s=o[2];e=tq.replaceMain(e,"tile_main"),e=e.replace(r,"");const a="bool isWhite(vec3 color) \n{ \n    return all(greaterThan(color, vec3(1.0 - czm_epsilon3))); \n} \nvec4 tile_diffuse_final(vec4 sourceDiffuse, vec4 tileDiffuse) \n{ \n    vec4 blendDiffuse = mix(sourceDiffuse, tileDiffuse, tile_colorBlend); \n    vec4 diffuse = isWhite(tileDiffuse.rgb) ? sourceDiffuse : blendDiffuse; \n    return vec4(diffuse.rgb, sourceDiffuse.a); \n} \n",c="    tile_featureColor = czm_gammaCorrect(tile_featureColor); \n    gl_FragColor.a *= tile_featureColor.a; \n    float highlight = ceil(tile_colorBlend); \n    gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); \n";let l;if("vec3"===s||"vec4"===s){const n="vec3"===s?`vec4(${t}, 1.0)`:t,o="vec3"===s?"tile_diffuse.xyz":"tile_diffuse";i=new RegExp(t,"g"),e=e.replace(i,o),l=`    vec4 source = ${n}; \n    tile_diffuse = tile_diffuse_final(source, tile_featureColor); \n    tile_main(); \n`}else"sampler2D"===s&&(e=XJ(e,t),l="    tile_diffuse = tile_featureColor; \n    tile_main(); \n");return e=`uniform float tile_colorBlend; \nvec4 tile_diffuse = vec4(1.0); \n${a}${r}\n${e}\nvoid tile_color(vec4 tile_featureColor) \n{ \n${l}`,n&&(e+=c),e+="} \n",e}function JJ(e){const t=e._content.tileset,n=t.colorBlendMode,i=t.colorBlendAmount;if(n===NJ.HIGHLIGHT)return 0;if(n===NJ.REPLACE)return 1;if(n===NJ.MIX)return z.clamp(i,z.EPSILON4,1);throw new x(`Invalid color blend mode "${n}".`)}kJ.prototype.applyStyle=function(e){if(!C(e))return this.setAllColor(FJ),void this.setAllShow(zJ);const t=this._content,n=this.featuresLength;for(let i=0;i<n;++i){const n=t.getFeature(i),o=C(e.color)?R(e.color.evaluateColor(n,GJ),FJ):FJ,r=C(e.show)?R(e.show.evaluate(n),zJ):zJ;this.setColor(i,o),this.setShow(i,r)}},kJ.prototype.isClass=function(e,t){jJ(e,this.featuresLength),D.typeOf.string("className",t);const n=this._batchTableHierarchy;return!!C(n)&&n.isClass(e,t)},kJ.prototype.isExactClass=function(e,t){return D.typeOf.string("className",t),this.getExactClassName(e)===t},kJ.prototype.getExactClassName=function(e){jJ(e,this.featuresLength);const t=this._batchTableHierarchy;if(C(t))return t.getClassName(e)},kJ.prototype.hasProperty=function(e,t){return jJ(e,this.featuresLength),D.typeOf.string("name",t),C(this._properties[t])||C(this._batchTableHierarchy)&&this._batchTableHierarchy.hasProperty(e,t)},kJ.prototype.hasPropertyBySemantic=function(){return!1},kJ.prototype.getPropertyNames=function(e,t){jJ(e,this.featuresLength),t=C(t)?t:[],t.length=0;const n=Object.keys(this._properties);return t.push.apply(t,n),C(this._batchTableHierarchy)&&t.push.apply(t,this._batchTableHierarchy.getPropertyIds(e,n)),t},kJ.prototype.getPropertyBySemantic=function(e,t){},kJ.prototype.getProperty=function(e,t){if(jJ(e,this.featuresLength),D.typeOf.string("name",t),C(this._batchTableBinaryProperties)){const n=this._batchTableBinaryProperties[t];if(C(n))return WJ(n,e)}const n=this._properties[t];if(C(n))return pn(n[e],!0);if(C(this._batchTableHierarchy)){const n=this._batchTableHierarchy.getProperty(e,t);if(C(n))return n}},kJ.prototype.setProperty=function(e,t,n){const i=this.featuresLength;if(jJ(e,i),D.typeOf.string("name",t),C(this._batchTableBinaryProperties)){const i=this._batchTableBinaryProperties[t];if(C(i))return void qJ(i,e,n)}if(C(this._batchTableHierarchy)&&this._batchTableHierarchy.setProperty(e,t,n))return;let o=this._properties[t];C(o)||(this._properties[t]=new Array(i),o=this._properties[t]),o[e]=pn(n,!0)},kJ.prototype.getVertexShaderCallback=function(e,t,n){if(0===this.featuresLength)return;const i=this;return function(o){const r=QJ(o,n,!1);let s;return Ck.maximumVertexTextureImageUnits>0?(s="",e&&(s+="uniform bool tile_translucentCommand; \n"),s+=`uniform sampler2D tile_batchTexture; \nvarying vec4 tile_featureColor; \nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    vec2 st = computeSt(${t}); \n    vec4 featureProperties = texture2D(tile_batchTexture, st); \n    tile_color(featureProperties); \n    float show = ceil(featureProperties.a); \n    gl_Position *= show; \n`,e&&(s+="    bool isStyleTranslucent = (featureProperties.a != 1.0); \n    if (czm_pass == czm_passTranslucent) \n    { \n        if (!isStyleTranslucent && !tile_translucentCommand) \n        { \n            gl_Position *= 0.0; \n        } \n    } \n    else \n    { \n        if (isStyleTranslucent) \n        { \n            gl_Position *= 0.0; \n        } \n    } \n"),s+="    tile_featureColor = featureProperties; \n    tile_featureSt = st; \n}"):s=`varying vec2 tile_featureSt; \nvoid main() \n{ \n    tile_color(vec4(1.0)); \n    tile_featureSt = computeSt(${t}); \n}`,`${r}\n${YJ(i)}${s}`}},kJ.prototype.getFragmentShaderCallback=function(e,t,n){if(0!==this.featuresLength)return function(i){return i=QJ(i,t,!0),Ck.maximumVertexTextureImageUnits>0?(i+="uniform sampler2D tile_pickTexture; \nvarying vec2 tile_featureSt; \nvarying vec4 tile_featureColor; \nvoid main() \n{ \n    tile_color(tile_featureColor); \n",n&&(i+="    gl_FragColor.rgb *= gl_FragColor.a; \n"),i+="}"):(e&&(i+="uniform bool tile_translucentCommand; \n"),i+="uniform sampler2D tile_pickTexture; \nuniform sampler2D tile_batchTexture; \nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); \n    if (featureProperties.a == 0.0) { \n        discard; \n    } \n",e&&(i+="    bool isStyleTranslucent = (featureProperties.a != 1.0); \n    if (czm_pass == czm_passTranslucent) \n    { \n        if (!isStyleTranslucent && !tile_translucentCommand) \n        { \n            discard; \n        } \n    } \n    else \n    { \n        if (isStyleTranslucent) \n        { \n            discard; \n        } \n    } \n"),i+="    tile_color(featureProperties); \n",n&&(i+="    gl_FragColor.rgb *= gl_FragColor.a; \n"),i+="} \n"),i}},kJ.prototype.getClassificationFragmentShaderCallback=function(){if(0!==this.featuresLength)return function(e){return e=tq.replaceMain(e,"tile_main"),Ck.maximumVertexTextureImageUnits>0?e+="uniform sampler2D tile_pickTexture;\nvarying vec2 tile_featureSt; \nvarying vec4 tile_featureColor; \nvoid main() \n{ \n    tile_main(); \n    gl_FragColor = tile_featureColor; \n    gl_FragColor.rgb *= gl_FragColor.a; \n}":e+="uniform sampler2D tile_batchTexture; \nuniform sampler2D tile_pickTexture;\nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    tile_main(); \n    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); \n    if (featureProperties.a == 0.0) { \n        discard; \n    } \n    gl_FragColor = featureProperties; \n    gl_FragColor.rgb *= gl_FragColor.a; \n} \n",e}},kJ.prototype.getUniformMapCallback=function(){if(0===this.featuresLength)return;const e=this;return function(t){const n={tile_batchTexture:function(){return R(e._batchTexture.batchTexture,e._batchTexture.defaultTexture)},tile_textureDimensions:function(){return e._batchTexture.textureDimensions},tile_textureStep:function(){return e._batchTexture.textureStep},tile_colorBlend:function(){return JJ(e)},tile_pickTexture:function(){return e._batchTexture.pickTexture}};return _n(t,n)}},kJ.prototype.getPickId=function(){return"texture2D(tile_pickTexture, tile_featureSt)"};const ZJ={ALL_OPAQUE:0,ALL_TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2};function $J(e){const t=e._batchTexture.translucentFeaturesLength;return 0===t?ZJ.ALL_OPAQUE:t===e.featuresLength?ZJ.ALL_TRANSLUCENT:ZJ.OPAQUE_AND_TRANSLUCENT}function eZ(e){const t=UU.shallowClone(e),n=t.pass===HU.TRANSLUCENT;return t.uniformMap=C(t.uniformMap)?t.uniformMap:{},t.uniformMap.tile_translucentCommand=function(){return n},t}function tZ(e){const t=UU.shallowClone(e);return t.pass=HU.TRANSLUCENT,t.renderState=aZ(e.renderState),t}function nZ(e){const t=UU.shallowClone(e);return t.renderState=cZ(e.renderState),t}function iZ(e,t){let n=e.shaderCache.getDerivedShaderProgram(t,"zBackfaceLogDepth");if(!C(n)){const i=t.fragmentShaderSource.clone();i.defines=C(i.defines)?i.defines.slice(0):[],i.defines.push("POLYGON_OFFSET"),i.sources.unshift("#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n"),n=e.shaderCache.createDerivedShaderProgram(t,"zBackfaceLogDepth",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:i,attributeLocations:t._attributeLocations})}return n}function oZ(e,t){const n=UU.shallowClone(t),i=pn(n.renderState,!0);i.cull.enabled=!0,i.cull.face=yk.FRONT,i.colorMask={red:!1,green:!1,blue:!1,alpha:!1},i.polygonOffset={enabled:!0,factor:5,units:5},i.stencilTest=FY.setCesium3DTileBit(),i.stencilMask=FY.CESIUM_3D_TILE_MASK,n.renderState=yV.fromCache(i),n.castShadows=!1,n.receiveShadows=!1,n.uniformMap=pn(t.uniformMap);const o=new ro(5,5);return n.uniformMap.u_polygonOffset=function(){return o},n.shaderProgram=iZ(e,t.shaderProgram),n}function rZ(e,t){const n=UU.shallowClone(e),i=pn(n.renderState,!0);return i.stencilTest.enabled=!0,i.stencilTest.mask=FY.SKIP_LOD_MASK,i.stencilTest.reference=FY.CESIUM_3D_TILE_MASK|t<<FY.SKIP_LOD_BIT_SHIFT,i.stencilTest.frontFunction=LY.GREATER_OR_EQUAL,i.stencilTest.frontOperation.zPass=BY.REPLACE,i.stencilTest.backFunction=LY.GREATER_OR_EQUAL,i.stencilTest.backOperation.zPass=BY.REPLACE,i.stencilMask=FY.CESIUM_3D_TILE_MASK|FY.SKIP_LOD_MASK,n.renderState=yV.fromCache(i),n}function sZ(e){const t=e.renderState.stencilTest.reference;return(t&FY.SKIP_LOD_MASK)>>>FY.SKIP_LOD_BIT_SHIFT}function aZ(e){const t=pn(e,!0);return t.cull.enabled=!1,t.depthTest.enabled=!0,t.depthMask=!1,t.blending=_k.ALPHA_BLEND,t.stencilTest=FY.setCesium3DTileBit(),t.stencilMask=FY.CESIUM_3D_TILE_MASK,yV.fromCache(t)}function cZ(e){const t=pn(e,!0);return t.stencilTest=FY.setCesium3DTileBit(),t.stencilMask=FY.CESIUM_3D_TILE_MASK,yV.fromCache(t)}kJ.prototype.addDerivedCommands=function(e,t){const n=e.commandList,i=n.length,o=this._content._tile,r=o._finalResolution,s=o.tileset,a=s._skipLevelOfDetail&&s._hasMixedContent&&e.context.stencilBuffer,c=$J(this);for(let l=t;l<i;++l){const t=n[l];if(t.pass===HU.COMPUTE)continue;let i=t.derivedCommands.tileset;C(i)&&!t.dirty||(i={},t.derivedCommands.tileset=i,i.originalCommand=eZ(t),t.dirty=!1);const u=i.originalCommand;c!==ZJ.ALL_OPAQUE&&t.pass!==HU.TRANSLUCENT&&(C(i.translucent)||(i.translucent=tZ(u))),c!==ZJ.ALL_TRANSLUCENT&&t.pass!==HU.TRANSLUCENT&&(C(i.opaque)||(i.opaque=nZ(u)),a&&(r||(C(i.zback)||(i.zback=oZ(e.context,u)),s._backfaceCommands.push(i.zback)),C(i.stencil)&&o._selectionDepth===sZ(i.stencil)||(t.renderState.depthMask?i.stencil=rZ(u,o._selectionDepth):i.stencil=i.opaque)));const h=a?i.stencil:i.opaque,d=i.translucent;t.pass!==HU.TRANSLUCENT?(c===ZJ.ALL_OPAQUE&&(n[l]=h),c===ZJ.ALL_TRANSLUCENT&&(n[l]=d),c===ZJ.OPAQUE_AND_TRANSLUCENT&&(n[l]=h,n.push(d))):n[l]=u}},kJ.prototype.update=function(e,t){this._batchTexture.update(e,t)},kJ.prototype.isDestroyed=function(){return!1},kJ.prototype.destroy=function(){return this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),Qh(this)};var lZ=kJ;function uZ(e,t){this._content=e,this._batchId=t,this._color=void 0}Object.defineProperties(uZ.prototype,{show:{get:function(){return this._content.batchTable.getShow(this._batchId)},set:function(e){this._content.batchTable.setShow(this._batchId,e)}},color:{get:function(){return C(this._color)||(this._color=new xy),this._content.batchTable.getColor(this._batchId,this._color)},set:function(e){this._content.batchTable.setColor(this._batchId,e)}},polylinePositions:{get:function(){if(C(this._content.getPolylinePositions))return this._content.getPolylinePositions(this._batchId)}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},featureId:{get:function(){return this._batchId}},pickId:{get:function(){return this._content.batchTable.getPickColor(this._batchId)}}}),uZ.prototype.hasProperty=function(e){return this._content.batchTable.hasProperty(this._batchId,e)},uZ.prototype.getPropertyNames=function(e){return this._content.batchTable.getPropertyNames(this._batchId,e)},uZ.prototype.getProperty=function(e){return this._content.batchTable.getProperty(this._batchId,e)},uZ.getPropertyInherited=function(e,t,n){const i=e.batchTable;if(C(i)){if(i.hasPropertyBySemantic(t,n))return i.getPropertyBySemantic(t,n);if(i.hasProperty(t,n))return i.getProperty(t,n)}const o=e.metadata;if(C(o)){if(o.hasPropertyBySemantic(n))return o.getPropertyBySemantic(n);if(o.hasProperty(n))return o.getProperty(n)}const r=e.tile,s=r.metadata;if(C(s)){if(s.hasPropertyBySemantic(n))return s.getPropertyBySemantic(n);if(s.hasProperty(n))return s.getProperty(n)}let a;if(C(r.implicitSubtree)&&(a=r.implicitSubtree.metadata),C(a)){if(a.hasPropertyBySemantic(n))return a.getPropertyBySemantic(n);if(a.hasProperty(n))return a.getProperty(n)}const c=C(e.group)?e.group.metadata:void 0;if(C(c)){if(c.hasPropertyBySemantic(n))return c.getPropertyBySemantic(n);if(c.hasProperty(n))return c.getProperty(n)}const l=e.tileset.metadata;if(C(l)){if(l.hasPropertyBySemantic(n))return l.getPropertyBySemantic(n);if(l.hasProperty(n))return l.getProperty(n)}},uZ.prototype.getPropertyInherited=function(e){return uZ.getPropertyInherited(this._content,this._batchId,e)},uZ.prototype.setProperty=function(e,t){this._content.batchTable.setProperty(this._batchId,e,t),this._content.featurePropertiesDirty=!0},uZ.prototype.isExactClass=function(e){return this._content.batchTable.isExactClass(this._batchId,e)},uZ.prototype.isClass=function(e){return this._content.batchTable.isClass(this._batchId,e)},uZ.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};var hZ=uZ;function dZ(e,t){this.json=e,this.buffer=t,this._cachedTypedArrays={},this.featuresLength=0}function fZ(e,t,n,i,o,r){const s=e._cachedTypedArrays;let a=s[t];return C(a)||(a=ih.createArrayBufferView(n,e.buffer.buffer,e.buffer.byteOffset+r,o*i),s[t]=a),a}function pZ(e,t,n,i){const o=e._cachedTypedArrays;let r=o[t];return C(r)||(r=ih.createTypedArray(n,i),o[t]=r),r}dZ.prototype.getGlobalProperty=function(e,t,n){const i=this.json[e];if(C(i))return C(i.byteOffset)?(t=R(t,ih.UNSIGNED_INT),n=R(n,1),fZ(this,e,t,n,1,i.byteOffset)):i},dZ.prototype.hasProperty=function(e){return C(this.json[e])},dZ.prototype.getPropertyArray=function(e,t,n){const i=this.json[e];if(C(i))return C(i.byteOffset)?(C(i.componentType)&&(t=ih.fromName(i.componentType)),fZ(this,e,t,n,this.featuresLength,i.byteOffset)):pZ(this,e,t,i)},dZ.prototype.getProperty=function(e,t,n,i,o){const r=this.json[e];if(!C(r))return;const s=this.getPropertyArray(e,t,n);if(1===n)return s[i];for(let a=0;a<n;++a)o[a]=s[n*i+a];return o};var mZ=dZ;function _Z(e,t,n){if(n=R(n,!1),n){const n=e.indexOf(t);if(n>-1)return n}return e.push(t),e.length-1}var gZ=_Z;function yZ(e,t){return C(e.extensionsUsed)&&e.extensionsUsed.indexOf(t)>=0}var vZ=yZ;function bZ(){}bZ.objectLegacy=function(e,t){if(C(e))for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const i=e[n],o=t(i,n);if(C(o))return o}},bZ.object=function(e,t){if(C(e)){const n=e.length;for(let i=0;i<n;i++){const n=e[i],o=t(n,i);if(C(o))return o}}},bZ.topLevel=function(e,t,n){const i=e[t];return C(i)&&!Array.isArray(i)?bZ.objectLegacy(i,n):bZ.object(i,n)},bZ.accessor=function(e,t){return bZ.topLevel(e,"accessors",t)},bZ.accessorWithSemantic=function(e,t,n){const i={};return bZ.mesh(e,(function(e){return bZ.meshPrimitive(e,(function(e){const o=bZ.meshPrimitiveAttribute(e,(function(e,o){if(0===o.indexOf(t)&&!C(i[e])){i[e]=!0;const t=n(e);if(C(t))return t}}));return C(o)?o:bZ.meshPrimitiveTarget(e,(function(e){return bZ.meshPrimitiveTargetAttribute(e,(function(e,o){if(0===o.indexOf(t)&&!C(i[e])){i[e]=!0;const t=n(e);if(C(t))return t}}))}))}))}))},bZ.accessorContainingVertexAttributeData=function(e,t){const n={};return bZ.mesh(e,(function(e){return bZ.meshPrimitive(e,(function(e){const i=bZ.meshPrimitiveAttribute(e,(function(e){if(!C(n[e])){n[e]=!0;const i=t(e);if(C(i))return i}}));return C(i)?i:bZ.meshPrimitiveTarget(e,(function(e){return bZ.meshPrimitiveTargetAttribute(e,(function(e){if(!C(n[e])){n[e]=!0;const i=t(e);if(C(i))return i}}))}))}))}))},bZ.accessorContainingIndexData=function(e,t){const n={};return bZ.mesh(e,(function(e){return bZ.meshPrimitive(e,(function(e){const i=e.indices;if(C(i)&&!C(n[i])){n[i]=!0;const e=t(i);if(C(e))return e}}))}))},bZ.animation=function(e,t){return bZ.topLevel(e,"animations",t)},bZ.animationChannel=function(e,t){const n=e.channels;return bZ.object(n,t)},bZ.animationSampler=function(e,t){const n=e.samplers;return bZ.object(n,t)},bZ.buffer=function(e,t){return bZ.topLevel(e,"buffers",t)},bZ.bufferView=function(e,t){return bZ.topLevel(e,"bufferViews",t)},bZ.camera=function(e,t){return bZ.topLevel(e,"cameras",t)},bZ.image=function(e,t){return bZ.topLevel(e,"images",t)},bZ.material=function(e,t){return bZ.topLevel(e,"materials",t)},bZ.materialValue=function(e,t){let n=e.values;C(e.extensions)&&C(e.extensions.KHR_techniques_webgl)&&(n=e.extensions.KHR_techniques_webgl.values);for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const e=t(n[i],i);if(C(e))return e}},bZ.mesh=function(e,t){return bZ.topLevel(e,"meshes",t)},bZ.meshPrimitive=function(e,t){const n=e.primitives;if(C(n)){const e=n.length;for(let i=0;i<e;i++){const e=n[i],o=t(e,i);if(C(o))return o}}},bZ.meshPrimitiveAttribute=function(e,t){const n=e.attributes;for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const e=t(n[i],i);if(C(e))return e}},bZ.meshPrimitiveTarget=function(e,t){const n=e.targets;if(C(n)){const e=n.length;for(let i=0;i<e;++i){const e=t(n[i],i);if(C(e))return e}}},bZ.meshPrimitiveTargetAttribute=function(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const i=e[n],o=t(i,n);if(C(o))return o}},bZ.node=function(e,t){return bZ.topLevel(e,"nodes",t)},bZ.nodeInTree=function(e,t,n){const i=e.nodes;if(C(i)){const o=t.length;for(let r=0;r<o;r++){const o=t[r],s=i[o];if(C(s)){let t=n(s,o);if(C(t))return t;const i=s.children;if(C(i)&&(t=bZ.nodeInTree(e,i,n),C(t)))return t}}}},bZ.nodeInScene=function(e,t,n){const i=t.nodes;if(C(i))return bZ.nodeInTree(e,i,n)},bZ.program=function(e,t){return vZ(e,"KHR_techniques_webgl")?bZ.object(e.extensions.KHR_techniques_webgl.programs,t):bZ.topLevel(e,"programs",t)},bZ.sampler=function(e,t){return bZ.topLevel(e,"samplers",t)},bZ.scene=function(e,t){return bZ.topLevel(e,"scenes",t)},bZ.shader=function(e,t){return vZ(e,"KHR_techniques_webgl")?bZ.object(e.extensions.KHR_techniques_webgl.shaders,t):bZ.topLevel(e,"shaders",t)},bZ.skin=function(e,t){return bZ.topLevel(e,"skins",t)},bZ.skinJoint=function(e,t){const n=e.joints;if(C(n)){const e=n.length;for(let i=0;i<e;i++){const e=n[i],o=t(e);if(C(o))return o}}},bZ.techniqueAttribute=function(e,t){const n=e.attributes;for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const e=t(n[i],i);if(C(e))return e}},bZ.techniqueUniform=function(e,t){const n=e.uniforms;for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const e=t(n[i],i);if(C(e))return e}},bZ.techniqueParameter=function(e,t){const n=e.parameters;for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const e=t(n[i],i);if(C(e))return e}},bZ.technique=function(e,t){return vZ(e,"KHR_techniques_webgl")?bZ.object(e.extensions.KHR_techniques_webgl.techniques,t):bZ.topLevel(e,"techniques",t)},bZ.texture=function(e,t){return bZ.topLevel(e,"textures",t)};var AZ=bZ;function wZ(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}}var TZ=wZ;function CZ(e,t){const n=t.bufferView;if(C(n)){const t=e.bufferViews[n];if(C(t.byteStride)&&t.byteStride>0)return t.byteStride}return ih.getSizeInBytes(t.componentType)*TZ(t.type)}var EZ=CZ;function xZ(e){AZ.accessor(e,(function(e){C(e.bufferView)&&(e.byteOffset=R(e.byteOffset,0))})),AZ.bufferView(e,(function(e){C(e.buffer)&&(e.byteOffset=R(e.byteOffset,0))})),AZ.mesh(e,(function(t){AZ.meshPrimitive(t,(function(t){if(t.mode=R(t.mode,th.TRIANGLES),!C(t.material)){C(e.materials)||(e.materials=[]);const n={name:"default"};t.material=gZ(e.materials,n)}}))})),AZ.accessorContainingVertexAttributeData(e,(function(t){const n=e.accessors[t],i=n.bufferView;if(n.normalized=R(n.normalized,!1),C(i)){const t=e.bufferViews[i];t.byteStride=EZ(e,n),t.target=th.ARRAY_BUFFER}})),AZ.accessorContainingIndexData(e,(function(t){const n=e.accessors[t],i=n.bufferView;if(C(i)){const t=e.bufferViews[i];t.target=th.ELEMENT_ARRAY_BUFFER}})),AZ.material(e,(function(e){const t=R(e.extensions,R.EMPTY_OBJECT),n=t.KHR_materials_common;if(C(n)){const e=n.technique,t=C(n.values)?n.values:{};return n.values=t,t.ambient=C(t.ambient)?t.ambient:[0,0,0,1],t.emission=C(t.emission)?t.emission:[0,0,0,1],t.transparency=R(t.transparency,1),t.transparent=R(t.transparent,!1),t.doubleSided=R(t.doubleSided,!1),void("CONSTANT"!==e&&(t.diffuse=C(t.diffuse)?t.diffuse:[0,0,0,1],"LAMBERT"!==e&&(t.specular=C(t.specular)?t.specular:[0,0,0,1],t.shininess=R(t.shininess,0))))}e.emissiveFactor=R(e.emissiveFactor,[0,0,0]),e.alphaMode=R(e.alphaMode,"OPAQUE"),e.doubleSided=R(e.doubleSided,!1),"MASK"===e.alphaMode&&(e.alphaCutoff=R(e.alphaCutoff,.5));const i=t.KHR_techniques_webgl;C(i)&&AZ.materialValue(e,(function(e){C(e.index)&&IZ(e)})),IZ(e.emissiveTexture),IZ(e.normalTexture),IZ(e.occlusionTexture);const o=e.pbrMetallicRoughness;C(o)&&(o.baseColorFactor=R(o.baseColorFactor,[1,1,1,1]),o.metallicFactor=R(o.metallicFactor,1),o.roughnessFactor=R(o.roughnessFactor,1),IZ(o.baseColorTexture),IZ(o.metallicRoughnessTexture));const r=t.KHR_materials_pbrSpecularGlossiness;C(r)&&(r.diffuseFactor=R(r.diffuseFactor,[1,1,1,1]),r.specularFactor=R(r.specularFactor,[1,1,1]),r.glossinessFactor=R(r.glossinessFactor,1),IZ(r.specularGlossinessTexture))})),AZ.animation(e,(function(e){AZ.animationSampler(e,(function(e){e.interpolation=R(e.interpolation,"LINEAR")}))}));const t=SZ(e);return AZ.node(e,(function(e,n){const i=C(t[n]);i||C(e.translation)||C(e.rotation)||C(e.scale)?(e.translation=R(e.translation,[0,0,0]),e.rotation=R(e.rotation,[0,0,0,1]),e.scale=R(e.scale,[1,1,1])):e.matrix=R(e.matrix,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])})),AZ.sampler(e,(function(e){e.wrapS=R(e.wrapS,th.REPEAT),e.wrapT=R(e.wrapT,th.REPEAT)})),C(e.scenes)&&!C(e.scene)&&(e.scene=0),e}function SZ(e){const t={};return AZ.animation(e,(function(e){AZ.animationChannel(e,(function(e){const n=e.target,i=n.node,o=n.path;"translation"!==o&&"rotation"!==o&&"scale"!==o||(t[i]=!0)}))})),t}function IZ(e){C(e)&&(e.texCoord=R(e.texCoord,0))}var OZ=xZ;function DZ(e){return AZ.shader(e,(function(e){PZ(e)})),AZ.buffer(e,(function(e){PZ(e)})),AZ.image(e,(function(e){PZ(e)})),PZ(e),e}function PZ(e){e.extras=C(e.extras)?e.extras:{},e.extras._pipeline=C(e.extras._pipeline)?e.extras._pipeline:{}}var RZ=DZ;function LZ(e,t){const n=e.extensionsRequired;if(C(n)){const i=n.indexOf(t);i>=0&&n.splice(i,1),0===n.length&&delete e.extensionsRequired}}var MZ=LZ;function BZ(e,t){const n=e.extensionsUsed;if(C(n)){const i=n.indexOf(t);i>=0&&n.splice(i,1),MZ(e,t),0===n.length&&delete e.extensionsUsed}}var NZ=BZ;const FZ=4;function zZ(e){const t=WF(e);if("glTF"!==t)throw new Je("File is not valid binary glTF");const n=kZ(e,0,5),i=n[1];if(1!==i&&2!==i)throw new Je("Binary glTF version is not 1 or 2");return 1===i?UZ(e,n):VZ(e,n)}function kZ(e,t,n){const i=new DataView(e.buffer),o=new Array(n);for(let r=0;r<n;++r)o[r]=i.getUint32(e.byteOffset+t+r*FZ,!0);return o}function UZ(e,t){const n=t[2],i=t[3],o=t[4];if(0!==o)throw new Je("Binary glTF scene format is not JSON");const r=20,s=r+i,a=Bp(e,r,i),c=JSON.parse(a);RZ(c);const l=e.subarray(s,n),u=c.buffers;if(C(u)&&Object.keys(u).length>0){const e=R(u.binary_glTF,u.KHR_binary_glTF);C(e)&&(e.extras._pipeline.source=l,delete e.uri)}return NZ(c,"KHR_binary_glTF"),c}function VZ(e,t){const n=t[2];let i,o,r=12;while(r<n){const t=kZ(e,r,2),n=t[0],s=t[1];r+=8;const a=e.subarray(r,r+n);if(r+=n,1313821514===s){const e=Bp(a);i=JSON.parse(e),RZ(i)}else 5130562===s&&(o=a)}if(C(i)&&C(o)){const e=i.buffers;if(C(e)&&e.length>0){const t=e[0];t.extras._pipeline.source=o}}return i}var HZ=zZ;function GZ(e,t){let n=e.extensionsUsed;C(n)||(n=[],e.extensionsUsed=n),gZ(n,t,!0)}var WZ=GZ;function qZ(e){switch(e){case ih.BYTE:return function(e,t,n,i,o){for(let r=0;r<n;++r)o[r]=e.getInt8(t+r*i)};case ih.UNSIGNED_BYTE:return function(e,t,n,i,o){for(let r=0;r<n;++r)o[r]=e.getUint8(t+r*i)};case ih.SHORT:return function(e,t,n,i,o){for(let r=0;r<n;++r)o[r]=e.getInt16(t+r*i,!0)};case ih.UNSIGNED_SHORT:return function(e,t,n,i,o){for(let r=0;r<n;++r)o[r]=e.getUint16(t+r*i,!0)};case ih.INT:return function(e,t,n,i,o){for(let r=0;r<n;++r)o[r]=e.getInt32(t+r*i,!0)};case ih.UNSIGNED_INT:return function(e,t,n,i,o){for(let r=0;r<n;++r)o[r]=e.getUint32(t+r*i,!0)};case ih.FLOAT:return function(e,t,n,i,o){for(let r=0;r<n;++r)o[r]=e.getFloat32(t+r*i,!0)};case ih.DOUBLE:return function(e,t,n,i,o){for(let r=0;r<n;++r)o[r]=e.getFloat64(t+r*i,!0)}}}var jZ=qZ;function YZ(e,t){const n=e.bufferViews,i=e.buffers,o=t.bufferView,r=TZ(t.type);if(!C(t.bufferView))return{min:wf(new Array(r),0),max:wf(new Array(r),0)};const s=wf(new Array(r),Number.POSITIVE_INFINITY),a=wf(new Array(r),Number.NEGATIVE_INFINITY),c=n[o],l=c.buffer,u=i[l],h=u.extras._pipeline.source,d=t.count,f=EZ(e,t);let p=t.byteOffset+c.byteOffset+h.byteOffset;const m=t.componentType,_=ih.getSizeInBytes(m),g=new DataView(h.buffer),y=new Array(r),v=jZ(m);for(let b=0;b<d;b++){v(g,p,r,_,y);for(let e=0;e<r;e++){const t=y[e];s[e]=Math.min(s[e],t),a[e]=Math.max(a[e],t)}p+=f}return{min:s,max:a}}var KZ=YZ;const XZ=[th.FUNC_ADD,th.FUNC_ADD],QZ=[th.ONE,th.ZERO,th.ONE,th.ZERO];function JZ(e,t){const n=e.enable;return!!C(n)&&n.indexOf(t)>-1}const ZZ=[th.ZERO,th.ONE,th.SRC_COLOR,th.ONE_MINUS_SRC_COLOR,th.SRC_ALPHA,th.ONE_MINUS_SRC_ALPHA,th.DST_ALPHA,th.ONE_MINUS_DST_ALPHA,th.DST_COLOR,th.ONE_MINUS_DST_COLOR];function $Z(e,t){if(!C(e))return t;for(let n=0;n<4;n++)if(-1===ZZ.indexOf(e[n]))return t;return e}function e$(e){const t={},n={},i=e.techniques;return C(i)?(AZ.technique(e,(function(e,i){const o=e.states;if(C(o)){const r=n[i]={};if(JZ(o,th.BLEND)){r.alphaMode="BLEND";const e=o.functions;C(e)&&(C(e.blendEquationSeparate)||C(e.blendFuncSeparate))&&(t[i]={blendEquation:R(e.blendEquationSeparate,XZ),blendFactors:$Z(e.blendFuncSeparate,QZ)})}JZ(o,th.CULL_FACE)||(r.doubleSided=!0),delete e.states}})),Object.keys(t).length>0&&(C(e.extensions)||(e.extensions={}),WZ(e,"KHR_blend")),AZ.material(e,(function(e){if(C(e.technique)){const i=n[e.technique];AZ.objectLegacy(i,(function(t,n){e[n]=t}));const o=t[e.technique];C(o)&&(C(e.extensions)||(e.extensions={}),e.extensions.KHR_blend=o)}})),e):e}var t$=e$;function n$(e,t){let n=e.extensionsRequired;C(n)||(n=[],e.extensionsRequired=n),gZ(n,t,!0),WZ(e,t)}var i$=n$;function o$(e){const t=e.techniques,n={},i={},o={};if(C(t)){const t={programs:[],shaders:[],techniques:[]},r=e.glExtensionsUsed;delete e.glExtensionsUsed,AZ.technique(e,(function(s,a){const c={name:s.name,program:void 0,attributes:{},uniforms:{}};let l;if(AZ.techniqueAttribute(s,(function(e,t){l=s.parameters[e],c.attributes[t]={semantic:l.semantic}})),AZ.techniqueUniform(s,(function(e,t){l=s.parameters[e],c.uniforms[t]={count:l.count,node:l.node,type:l.type,semantic:l.semantic,value:l.value},C(n[a])||(n[a]={}),n[a][e]=t})),C(o[s.program]))c.program=o[s.program];else{const n=e.programs[s.program],i={name:n.name,fragmentShader:void 0,vertexShader:void 0,glExtensions:r},a=e.shaders[n.fragmentShader];i.fragmentShader=gZ(t.shaders,a,!0);const l=e.shaders[n.vertexShader];i.vertexShader=gZ(t.shaders,l,!0),c.program=gZ(t.programs,i),o[s.program]=c.program}i[a]=gZ(t.techniques,c)})),t.techniques.length>0&&(C(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl=t,WZ(e,"KHR_techniques_webgl"),i$(e,"KHR_techniques_webgl"))}return AZ.material(e,(function(e){if(C(e.technique)){const t={technique:i[e.technique]};AZ.objectLegacy(e.values,(function(i,o){C(t.values)||(t.values={});const r=n[e.technique][o];t.values[r]=i})),C(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl=t}delete e.technique,delete e.values})),delete e.techniques,delete e.programs,delete e.shaders,e}var r$=o$;function s$(e,t){D.typeOf.object("material",e),D.defined("handler",t);const n=e.pbrMetallicRoughness;if(C(n)){if(C(n.baseColorTexture)){const e=n.baseColorTexture,i=t(e.index,e);if(C(i))return i}if(C(n.metallicRoughnessTexture)){const e=n.metallicRoughnessTexture,i=t(e.index,e);if(C(i))return i}}if(C(e.extensions)){const n=e.extensions.KHR_materials_pbrSpecularGlossiness;if(C(n)){if(C(n.diffuseTexture)){const e=n.diffuseTexture,i=t(e.index,e);if(C(i))return i}if(C(n.specularGlossinessTexture)){const e=n.specularGlossinessTexture,i=t(e.index,e);if(C(i))return i}}const i=e.extensions.KHR_materials_common;if(C(i)){const e=i.values.diffuse,n=i.values.ambient,o=i.values.emission,r=i.values.specular;if(C(e)&&C(e.index)){const n=t(e.index,e);if(C(n))return n}if(C(n)&&C(n.index)){const e=t(n.index,n);if(C(e))return e}if(C(o)&&C(o.index)){const e=t(o.index,o);if(C(e))return e}if(C(r)&&C(r.index)){const e=t(r.index,r);if(C(e))return e}}}const i=AZ.materialValue(e,(function(e){if(C(e.index)){const n=t(e.index,e);if(C(n))return n}}));if(C(i))return i;if(C(e.emissiveTexture)){const n=e.emissiveTexture,i=t(n.index,n);if(C(i))return i}if(C(e.normalTexture)){const n=e.normalTexture,i=t(n.index,n);if(C(i))return i}if(C(e.occlusionTexture)){const n=e.occlusionTexture,i=t(n.index,n);if(C(i))return i}}var a$=s$;const c$=["mesh","node","material","accessor","bufferView","buffer","texture","sampler","image"];function l$(e,t){return t=R(t,c$),c$.forEach((function(n){t.indexOf(n)>-1&&h$(e,n)})),e}const u$={accessor:"accessors",buffer:"buffers",bufferView:"bufferViews",image:"images",node:"nodes",material:"materials",mesh:"meshes",sampler:"samplers",texture:"textures"};function h$(e,t){const n=u$[t],i=e[n];if(C(i)){let n=0;const o=f$[t](e),r=i.length;for(let i=0;i<r;++i)o[i]||(d$[t](e,i-n),n++)}}function d$(){}function f$(){}function p$(e,t,n){const i=e.nodes[t];return!(C(i.mesh)||C(i.camera)||C(i.skin)||C(i.weights)||C(i.extras)||C(i.extensions)&&0!==Object.keys(i.extensions).length||C(n[t]))&&(!C(i.children)||0===i.children.filter((function(t){return!p$(e,t,n)})).length)}d$.accessor=function(e,t){const n=e.accessors;n.splice(t,1),AZ.mesh(e,(function(e){AZ.meshPrimitive(e,(function(e){AZ.meshPrimitiveAttribute(e,(function(n,i){n>t&&e.attributes[i]--})),AZ.meshPrimitiveTarget(e,(function(e){AZ.meshPrimitiveTargetAttribute(e,(function(n,i){n>t&&e[i]--}))}));const n=e.indices;C(n)&&n>t&&e.indices--}))})),AZ.skin(e,(function(e){C(e.inverseBindMatrices)&&e.inverseBindMatrices>t&&e.inverseBindMatrices--})),AZ.animation(e,(function(e){AZ.animationSampler(e,(function(e){C(e.input)&&e.input>t&&e.input--,C(e.output)&&e.output>t&&e.output--}))}))},d$.buffer=function(e,t){const n=e.buffers;n.splice(t,1),AZ.bufferView(e,(function(e){C(e.buffer)&&e.buffer>t&&e.buffer--,C(e.extensions)&&C(e.extensions.EXT_meshopt_compression)&&e.extensions.EXT_meshopt_compression.buffer--}))},d$.bufferView=function(e,t){const n=e.bufferViews;if(n.splice(t,1),AZ.accessor(e,(function(e){C(e.bufferView)&&e.bufferView>t&&e.bufferView--})),AZ.shader(e,(function(e){C(e.bufferView)&&e.bufferView>t&&e.bufferView--})),AZ.image(e,(function(e){C(e.bufferView)&&e.bufferView>t&&e.bufferView--})),vZ(e,"KHR_draco_mesh_compression")&&AZ.mesh(e,(function(e){AZ.meshPrimitive(e,(function(e){C(e.extensions)&&C(e.extensions.KHR_draco_mesh_compression)&&e.extensions.KHR_draco_mesh_compression.bufferView>t&&e.extensions.KHR_draco_mesh_compression.bufferView--}))})),vZ(e,"EXT_feature_metadata")){const n=e.extensions.EXT_feature_metadata,i=n.featureTables;for(const e in i)if(i.hasOwnProperty(e)){const n=i[e],o=n.properties;if(C(o))for(const e in o)if(o.hasOwnProperty(e)){const n=o[e];C(n.bufferView)&&n.bufferView>t&&n.bufferView--,C(n.arrayOffsetBufferView)&&n.arrayOffsetBufferView>t&&n.arrayOffsetBufferView--,C(n.stringOffsetBufferView)&&n.stringOffsetBufferView>t&&n.stringOffsetBufferView--}}}},d$.image=function(e,t){const n=e.images;n.splice(t,1),AZ.texture(e,(function(e){C(e.source)&&e.source>t&&--e.source;const n=e.extensions;C(n)&&C(n.EXT_texture_webp)&&n.EXT_texture_webp.source>t?--e.extensions.EXT_texture_webp.source:C(n)&&C(n.KHR_texture_basisu)&&n.KHR_texture_basisu.source>t&&--e.extensions.KHR_texture_basisu.source}))},d$.mesh=function(e,t){const n=e.meshes;n.splice(t,1),AZ.node(e,(function(e){C(e.mesh)&&(e.mesh>t?e.mesh--:e.mesh===t&&delete e.mesh)}))},d$.node=function(e,t){const n=e.nodes;n.splice(t,1),AZ.skin(e,(function(e){C(e.skeleton)&&e.skeleton>t&&e.skeleton--,e.joints=e.joints.map((function(e){return e>t?e-1:e}))})),AZ.animation(e,(function(e){AZ.animationChannel(e,(function(e){C(e.target)&&C(e.target.node)&&e.target.node>t&&e.target.node--}))})),AZ.technique(e,(function(e){AZ.techniqueUniform(e,(function(e){C(e.node)&&e.node>t&&e.node--}))})),AZ.node(e,(function(e){C(e.children)&&(e.children=e.children.filter((function(e){return e!==t})).map((function(e){return e>t?e-1:e})))})),AZ.scene(e,(function(e){e.nodes=e.nodes.filter((function(e){return e!==t})).map((function(e){return e>t?e-1:e}))}))},d$.material=function(e,t){const n=e.materials;n.splice(t,1),AZ.mesh(e,(function(e){AZ.meshPrimitive(e,(function(e){C(e.material)&&e.material>t&&e.material--}))}))},d$.sampler=function(e,t){const n=e.samplers;n.splice(t,1),AZ.texture(e,(function(e){C(e.sampler)&&e.sampler>t&&--e.sampler}))},d$.texture=function(e,t){const n=e.textures;if(n.splice(t,1),AZ.material(e,(function(e){a$(e,(function(e,n){n.index>t&&--n.index}))})),vZ(e,"EXT_feature_metadata")){AZ.mesh(e,(function(e){AZ.meshPrimitive(e,(function(e){const n=e.extensions;if(C(n)&&C(n.EXT_feature_metadata)){const e=n.EXT_feature_metadata,i=e.featureIdTextures;if(C(i)){const e=i.length;for(let n=0;n<e;++n){const e=i[n],o=e.featureIds.texture;o.index>t&&--o.index}}}}))}));const n=e.extensions.EXT_feature_metadata,i=n.featureTextures;for(const e in i)if(i.hasOwnProperty(e)){const n=i[e],o=n.properties;if(C(o))for(const e in o)if(o.hasOwnProperty(e)){const n=o[e],i=n.texture;i.index>t&&--i.index}}}},f$.accessor=function(e){const t={};return AZ.mesh(e,(function(e){AZ.meshPrimitive(e,(function(e){AZ.meshPrimitiveAttribute(e,(function(e){t[e]=!0})),AZ.meshPrimitiveTarget(e,(function(e){AZ.meshPrimitiveTargetAttribute(e,(function(e){t[e]=!0}))}));const n=e.indices;C(n)&&(t[n]=!0)}))})),AZ.skin(e,(function(e){C(e.inverseBindMatrices)&&(t[e.inverseBindMatrices]=!0)})),AZ.animation(e,(function(e){AZ.animationSampler(e,(function(e){C(e.input)&&(t[e.input]=!0),C(e.output)&&(t[e.output]=!0)}))})),vZ(e,"EXT_mesh_gpu_instancing")&&AZ.node(e,(function(e){C(e.extensions)&&C(e.extensions.EXT_mesh_gpu_instancing)&&Object.keys(e.extensions.EXT_mesh_gpu_instancing.attributes).forEach((function(n){const i=e.extensions.EXT_mesh_gpu_instancing.attributes[n];t[i]=!0}))})),t},f$.buffer=function(e){const t={};return AZ.bufferView(e,(function(e){C(e.buffer)&&(t[e.buffer]=!0),C(e.extensions)&&C(e.extensions.EXT_meshopt_compression)&&(t[e.extensions.EXT_meshopt_compression.buffer]=!0)})),t},f$.bufferView=function(e){const t={};if(AZ.accessor(e,(function(e){C(e.bufferView)&&(t[e.bufferView]=!0)})),AZ.shader(e,(function(e){C(e.bufferView)&&(t[e.bufferView]=!0)})),AZ.image(e,(function(e){C(e.bufferView)&&(t[e.bufferView]=!0)})),vZ(e,"KHR_draco_mesh_compression")&&AZ.mesh(e,(function(e){AZ.meshPrimitive(e,(function(e){C(e.extensions)&&C(e.extensions.KHR_draco_mesh_compression)&&(t[e.extensions.KHR_draco_mesh_compression.bufferView]=!0)}))})),vZ(e,"EXT_feature_metadata")){const n=e.extensions.EXT_feature_metadata,i=n.featureTables;for(const e in i)if(i.hasOwnProperty(e)){const n=i[e],o=n.properties;if(C(o))for(const e in o)if(o.hasOwnProperty(e)){const n=o[e];C(n.bufferView)&&(t[n.bufferView]=!0),C(n.arrayOffsetBufferView)&&(t[n.arrayOffsetBufferView]=!0),C(n.stringOffsetBufferView)&&(t[n.stringOffsetBufferView]=!0)}}}return t},f$.image=function(e){const t={};return AZ.texture(e,(function(e){C(e.source)&&(t[e.source]=!0),C(e.extensions)&&C(e.extensions.EXT_texture_webp)?t[e.extensions.EXT_texture_webp.source]=!0:C(e.extensions)&&C(e.extensions.KHR_texture_basisu)&&(t[e.extensions.KHR_texture_basisu.source]=!0)})),t},f$.mesh=function(e){const t={};return AZ.node(e,(function(n){if(C(n.mesh&&C(e.meshes))){const i=e.meshes[n.mesh];C(i)&&C(i.primitives)&&i.primitives.length>0&&(t[n.mesh]=!0)}})),t},f$.node=function(e){const t={};return AZ.skin(e,(function(e){C(e.skeleton)&&(t[e.skeleton]=!0),AZ.skinJoint(e,(function(e){t[e]=!0}))})),AZ.animation(e,(function(e){AZ.animationChannel(e,(function(e){C(e.target)&&C(e.target.node)&&(t[e.target.node]=!0)}))})),AZ.technique(e,(function(e){AZ.techniqueUniform(e,(function(e){C(e.node)&&(t[e.node]=!0)}))})),AZ.node(e,(function(n,i){p$(e,i,t)||(t[i]=!0)})),t},f$.material=function(e){const t={};return AZ.mesh(e,(function(e){AZ.meshPrimitive(e,(function(e){C(e.material)&&(t[e.material]=!0)}))})),t},f$.texture=function(e){const t={};if(AZ.material(e,(function(e){a$(e,(function(e){t[e]=!0}))})),vZ(e,"EXT_feature_metadata")){AZ.mesh(e,(function(e){AZ.meshPrimitive(e,(function(e){const n=e.extensions;if(C(n)&&C(n.EXT_feature_metadata)){const e=n.EXT_feature_metadata,i=e.featureIdTextures;if(C(i)){const e=i.length;for(let n=0;n<e;++n){const e=i[n],o=e.featureIds.texture;t[o.index]=!0}}}}))}));const n=e.extensions.EXT_feature_metadata,i=n.featureTextures;for(const e in i)if(i.hasOwnProperty(e)){const n=i[e],o=n.properties;if(C(o))for(const e in o)if(o.hasOwnProperty(e)){const n=o[e],i=n.texture;t[i.index]=!0}}}return t},f$.sampler=function(e){const t={};return AZ.texture(e,(function(e){C(e.sampler)&&(t[e.sampler]=!0)})),t};var m$=l$;function _$(e,t){const n={byteLength:t.length,extras:{_pipeline:{source:t}}},i=gZ(e.buffers,n),o={buffer:i,byteOffset:0,byteLength:t.length};return gZ(e.bufferViews,o)}var g$=_$;function y$(e,t){const n=EZ(e,t),i=ih.getSizeInBytes(t.componentType),o=TZ(t.type),r=t.count,s=new Array(o*r);if(!C(t.bufferView))return wf(s,0),s;const a=e.bufferViews[t.bufferView],c=e.buffers[a.buffer].extras._pipeline.source;let l=t.byteOffset+a.byteOffset+c.byteOffset;const u=new DataView(c.buffer),h=new Array(o),d=jZ(t.componentType);for(let f=0;f<r;++f){d(u,l,o,i,h);for(let e=0;e<o;++e)s[f*o+e]=h[e];l+=n}return s}var v$=y$;function b$(e){let t;return AZ.accessorWithSemantic(e,"JOINTS_0",(function(n){const i=e.accessors[n];t=i.componentType,t===th.BYTE?A$(e,i,ih.UNSIGNED_BYTE):t!==th.UNSIGNED_BYTE&&t!==th.UNSIGNED_SHORT&&A$(e,i,ih.UNSIGNED_SHORT)})),AZ.accessorWithSemantic(e,"WEIGHTS_0",(function(n){const i=e.accessors[n];t=i.componentType,t===th.BYTE?A$(e,i,ih.UNSIGNED_BYTE):t===th.SHORT&&A$(e,i,ih.UNSIGNED_SHORT)})),e}function A$(e,t,n){const i=ih.createTypedArray(n,v$(e,t)),o=new Uint8Array(i.buffer);t.bufferView=g$(e,o),t.componentType=n,t.byteOffset=0}var w$=b$;const T$={.8:D$,"1.0":e0,"2.0":void 0};function C$(e,t){t=R(t,R.EMPTY_OBJECT);const n=t.targetVersion;let i=e.version;e.asset=R(e.asset,{version:"1.0"}),e.asset.version=R(e.asset.version,"1.0"),i=R(i,e.asset.version).toString(),Object.prototype.hasOwnProperty.call(T$,i)||(C(i)&&(i=i.substring(0,3)),Object.prototype.hasOwnProperty.call(T$,i)||(i="1.0"));let o=T$[i];while(C(o)){if(i===n)break;o(e,t),i=e.asset.version,o=T$[i]}return e}function E$(e){const t=e.materials;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const e=t[n],i=e.instanceTechnique;C(i)&&(e.technique=i.technique,e.values=i.values,delete e.instanceTechnique)}}function x$(e){const t=e.meshes;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const e=t[n],i=e.primitives;if(C(i)){const e=i.length;for(let t=0;t<e;++t){const e=i[t],n=R(e.primitive,th.TRIANGLES);e.mode=R(e.mode,n),delete e.primitive}}}}function S$(e){const t=e.nodes,n=new K,i=new il;for(const o in t)if(Object.prototype.hasOwnProperty.call(t,o)){const e=t[o];if(C(e.rotation)){const t=e.rotation;K.fromArray(t,0,n),il.fromAxisAngle(n,t[3],i),e.rotation=[i.x,i.y,i.z,i.w]}const r=e.instanceSkin;C(r)&&(e.skeletons=r.skeletons,e.skin=r.skin,e.meshes=r.meshes,delete e.instanceSkin)}}function I$(e){const t=e.animations,n=e.accessors,i=e.bufferViews,o=e.buffers,r={},s=new K,a=new il;for(const c in t)if(Object.prototype.hasOwnProperty.call(t,c)){const e=t[c],l=e.channels,u=e.parameters,h=e.samplers;if(C(l)){const e=l.length;for(let t=0;t<e;++t){const e=l[t];if("rotation"===e.target.path){const t=u[h[e.sampler].output];if(C(r[t]))continue;r[t]=!0;const c=n[t],l=i[c.bufferView],d=o[l.buffer],f=d.extras._pipeline.source,p=f.byteOffset+l.byteOffset+c.byteOffset,m=c.componentType,_=c.count,g=TZ(c.type),y=c.count*g,v=ih.createArrayBufferView(m,f.buffer,p,y);for(let e=0;e<_;e++){const t=e*g;K.unpack(v,t,s);const n=v[t+3];il.fromAxisAngle(s,n,a),il.pack(a,v,t)}}}}}}function O$(e){const t=e.techniques;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const e=t[n],i=e.passes;if(C(i)){const t=R(e.pass,"defaultPass");if(Object.prototype.hasOwnProperty.call(i,t)){const n=i[t],o=n.instanceProgram;e.attributes=R(e.attributes,o.attributes),e.program=R(e.program,o.program),e.uniforms=R(e.uniforms,o.uniforms),e.states=R(e.states,n.states)}delete e.passes,delete e.pass}}}function D$(e){C(e.asset)||(e.asset={});const t=e.asset;if(t.version="1.0","string"===typeof t.profile){const e=t.profile.split(" ");t.profile={api:e[0],version:e[1]}}else t.profile={};if(C(e.version)&&delete e.version,E$(e),x$(e),S$(e),I$(e),O$(e),C(e.allExtensions)&&(e.extensionsUsed=e.allExtensions,delete e.allExtensions),C(e.lights)){const t=R(e.extensions,{});e.extensions=t;const n=R(t.KHR_materials_common,{});t.KHR_materials_common=n,n.lights=e.lights,delete e.lights,WZ(e,"KHR_materials_common")}}function P$(e){const t=e.animations;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const e=t[n],i=e.parameters;if(C(i)){const t=e.samplers;for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const n=t[e];n.input=i[n.input],n.output=i[n.output]}delete e.parameters}}}function R$(e,t){const n=[];for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)){const o=e[i];t[i]=n.length,n.push(o),C(o.name)||(o.name=i)}return n}function L$(e){let t;const n={accessors:{},animations:{},buffers:{},bufferViews:{},cameras:{},images:{},materials:{},meshes:{},nodes:{},programs:{},samplers:{},scenes:{},shaders:{},skins:{},textures:{},techniques:{}};let i;const o={},r=e.nodes;for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i=r[s].jointName,C(i)&&(o[i]=s));for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&C(n[s])){const t={},i=e[s];e[s]=R$(i,t),n[s]=t}for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(o[i]=n.nodes[o[i]]);C(e.scene)&&(e.scene=n.scenes[e.scene]),AZ.bufferView(e,(function(e){C(e.buffer)&&(e.buffer=n.buffers[e.buffer])})),AZ.accessor(e,(function(e){C(e.bufferView)&&(e.bufferView=n.bufferViews[e.bufferView])})),AZ.shader(e,(function(e){const t=e.extensions;if(C(t)){const i=t.KHR_binary_glTF;C(i)&&(e.bufferView=n.bufferViews[i.bufferView],delete t.KHR_binary_glTF),0===Object.keys(t).length&&delete e.extensions}})),AZ.program(e,(function(e){C(e.vertexShader)&&(e.vertexShader=n.shaders[e.vertexShader]),C(e.fragmentShader)&&(e.fragmentShader=n.shaders[e.fragmentShader])})),AZ.technique(e,(function(e){C(e.program)&&(e.program=n.programs[e.program]),AZ.techniqueParameter(e,(function(e){C(e.node)&&(e.node=n.nodes[e.node]);const t=e.value;"string"===typeof t&&(e.value={index:n.textures[t]})}))})),AZ.mesh(e,(function(e){AZ.meshPrimitive(e,(function(e){C(e.indices)&&(e.indices=n.accessors[e.indices]),AZ.meshPrimitiveAttribute(e,(function(t,i){e.attributes[i]=n.accessors[t]})),C(e.material)&&(e.material=n.materials[e.material])}))})),AZ.node(e,(function(i){let o=i.children;if(C(o)){const e=o.length;for(t=0;t<e;++t)o[t]=n.nodes[o[t]]}if(C(i.meshes)){const r=i.meshes,s=r.length;if(s>0)for(i.mesh=n.meshes[r[0]],t=1;t<s;++t){const s={mesh:n.meshes[r[t]]},a=gZ(e.nodes,s);C(o)||(o=[],i.children=o),o.push(a)}delete i.meshes}if(C(i.camera)&&(i.camera=n.cameras[i.camera]),C(i.skin)&&(i.skin=n.skins[i.skin]),C(i.skeletons)){const t=i.skeletons,o=t.length;if(o>0&&C(i.skin)){const o=e.skins[i.skin];o.skeleton=n.nodes[t[0]]}delete i.skeletons}C(i.jointName)&&delete i.jointName})),AZ.skin(e,(function(e){C(e.inverseBindMatrices)&&(e.inverseBindMatrices=n.accessors[e.inverseBindMatrices]);const i=e.jointNames;if(C(i)){const n=[],r=i.length;for(t=0;t<r;++t)n[t]=o[i[t]];e.joints=n,delete e.jointNames}})),AZ.scene(e,(function(e){const i=e.nodes;if(C(i)){const e=i.length;for(t=0;t<e;++t)i[t]=n.nodes[i[t]]}})),AZ.animation(e,(function(e){const t={};e.samplers=R$(e.samplers,t),AZ.animationSampler(e,(function(e){e.input=n.accessors[e.input],e.output=n.accessors[e.output]})),AZ.animationChannel(e,(function(e){e.sampler=t[e.sampler];const i=e.target;C(i)&&(i.node=n.nodes[i.id],delete i.id)}))})),AZ.material(e,(function(e){C(e.technique)&&(e.technique=n.techniques[e.technique]),AZ.materialValue(e,(function(t,i){"string"===typeof t&&(e.values[i]={index:n.textures[t]})}));const t=e.extensions;if(C(t)){const e=t.KHR_materials_common;C(e)&&AZ.materialValue(e,(function(t,i){"string"===typeof t&&(e.values[i]={index:n.textures[t]})}))}})),AZ.image(e,(function(e){const t=e.extensions;if(C(t)){const i=t.KHR_binary_glTF;C(i)&&(e.bufferView=n.bufferViews[i.bufferView],e.mimeType=i.mimeType,delete t.KHR_binary_glTF),0===Object.keys(t).length&&delete e.extensions}})),AZ.texture(e,(function(e){C(e.sampler)&&(e.sampler=n.samplers[e.sampler]),C(e.source)&&(e.source=n.images[e.source])}))}function M$(e){AZ.animation(e,(function(e){AZ.animationSampler(e,(function(e){delete e.name}))}))}function B$(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];Array.isArray(n)&&0===n.length&&delete e[t]}AZ.node(e,(function(e){C(e.children)&&0===e.children.length&&delete e.children}))}function N$(e){const t=e.asset;delete t.profile,delete t.premultipliedAlpha}const F$={CESIUM_RTC:!0,KHR_materials_common:!0,WEB3D_quantized_attributes:!0};function z$(e){const t=e.extensionsUsed;if(e.extensionsRequired=R(e.extensionsRequired,[]),C(t)){const n=t.length;for(let i=0;i<n;++i){const n=t[i];C(F$[n])&&e.extensionsRequired.push(n)}}}function k$(e){AZ.buffer(e,(function(e){delete e.type}))}function U$(e){AZ.texture(e,(function(e){delete e.format,delete e.internalFormat,delete e.target,delete e.type}))}function V$(e){AZ.mesh(e,(function(e){AZ.meshPrimitive(e,(function(e){AZ.meshPrimitiveAttribute(e,(function(t,n){"TEXCOORD"===n?e.attributes.TEXCOORD_0=t:"COLOR"===n&&(e.attributes.COLOR_0=t)})),delete e.attributes.TEXCOORD,delete e.attributes.COLOR}))})),AZ.technique(e,(function(e){AZ.techniqueParameter(e,(function(e){const t=e.semantic;C(t)&&("TEXCOORD"===t?e.semantic="TEXCOORD_0":"COLOR"===t&&(e.semantic="COLOR_0"))}))}))}const H$={POSITION:!0,NORMAL:!0,TANGENT:!0},G$={COLOR:"COLOR",JOINT:"JOINTS",JOINTS:"JOINTS",TEXCOORD:"TEXCOORD",WEIGHT:"WEIGHTS",WEIGHTS:"WEIGHTS"};function W$(e){const t={};AZ.mesh(e,(function(e){AZ.meshPrimitive(e,(function(e){AZ.meshPrimitiveAttribute(e,(function(e,n){if("_"!==n.charAt(0)){const e=n.search(/_[0-9]+/g);let i,o=n,r="_0";e>=0&&(o=n.substring(0,e),r=n.substring(e));const s=G$[o];C(s)?(i=s+r,t[n]=i):C(H$[o])||(i="_"+n,t[n]=i)}}));for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const i=t[n],o=e.attributes[n];C(o)&&(delete e.attributes[n],e.attributes[i]=o)}}))})),AZ.technique(e,(function(e){AZ.techniqueParameter(e,(function(e){const n=t[e.semantic];C(n)&&(e.semantic=n)}))}))}function q$(e){AZ.camera(e,(function(e){const t=e.perspective;if(C(t)){const e=t.aspectRatio;C(e)&&0===e&&delete t.aspectRatio;const n=t.yfov;C(n)&&0===n&&(t.yfov=1)}}))}function j$(e,t){return C(t.byteStride)&&0!==t.byteStride?t.byteStride:EZ(e,t)}function Y$(e){AZ.buffer(e,(function(e){C(e.byteLength)||(e.byteLength=e.extras._pipeline.source.length)})),AZ.accessor(e,(function(t){const n=t.bufferView;if(C(n)){const i=e.bufferViews[n],o=j$(e,t),r=t.byteOffset+t.count*o;i.byteLength=Math.max(R(i.byteLength,0),r)}}))}function K$(e){let t,n,i;const o=e.bufferViews,r={};AZ.accessorContainingVertexAttributeData(e,(function(t){const n=e.accessors[t];C(n.bufferView)&&(r[n.bufferView]=!0)}));const s={};AZ.accessor(e,(function(e){C(e.bufferView)&&(s[e.bufferView]=R(s[e.bufferView],[]),s[e.bufferView].push(e))}));for(const a in s)if(Object.prototype.hasOwnProperty.call(s,a)){i=o[a];const c=s[a];c.sort((function(e,t){return e.byteOffset-t.byteOffset}));let l=0,u=0;const h=c.length;for(t=0;t<h;++t){let s=c[t];const d=j$(e,s),f=s.byteOffset,p=s.count*d;delete s.byteStride;const m=t<h-1,_=m?j$(e,c[t+1]):void 0;if(d!==_){const e=pn(i,!0);r[a]&&(e.byteStride=d),e.byteOffset+=l,e.byteLength=f+p-l;const h=gZ(o,e);for(n=u;n<=t;++n)s=c[n],s.bufferView=h,s.byteOffset=s.byteOffset-l;l=m?c[t+1].byteOffset:void 0,u=t+1}}}m$(e,["accessor","bufferView","buffer"])}function X$(e){AZ.accessorWithSemantic(e,"POSITION",(function(t){const n=e.accessors[t];if(!C(n.min)||!C(n.max)){const t=KZ(e,n);n.min=t.min,n.max=t.max}}))}function Q$(e){return(!C(e.children)||0===e.children.length)&&(!C(e.meshes)||0===e.meshes.length)&&!C(e.camera)&&!C(e.skin)&&!C(e.skeletons)&&!C(e.jointName)&&(!C(e.translation)||K.fromArray(e.translation).equals(K.ZERO))&&(!C(e.scale)||K.fromArray(e.scale).equals(new K(1,1,1)))&&(!C(e.rotation)||Xe.fromArray(e.rotation).equals(new Xe(0,0,0,1)))&&(!C(e.matrix)||ft.fromColumnMajorArray(e.matrix).equals(ft.IDENTITY))&&!C(e.extensions)&&!C(e.extras)}function J$(e,t){AZ.scene(e,(function(e){const n=e.nodes;if(C(n)){const e=n.length;for(let i=e;i>=0;--i)if(n[i]===t)return void n.splice(i,1)}})),AZ.node(e,(function(n,i){if(C(n.children)){const o=n.children.indexOf(t);o>-1&&(n.children.splice(o,1),Q$(n)&&J$(e,i))}})),delete e.nodes[t]}function Z$(e){return AZ.node(e,(function(t,n){Q$(t)&&J$(e,n)})),e}function $$(e){AZ.animation(e,(function(t){AZ.animationSampler(t,(function(t){const n=e.accessors[t.input];if(!C(n.min)||!C(n.max)){const t=KZ(e,n);n.min=t.min,n.max=t.max}}))}))}function e0(e){e.asset=R(e.asset,{}),e.asset.version="2.0",E$(e),P$(e),Z$(e),L$(e),M$(e),N$(e),z$(e),Y$(e),K$(e),X$(e),$$(e),k$(e),U$(e),V$(e),W$(e),w$(e),q$(e),t$(e),r$(e),B$(e)}var t0=C$;function n0(){this.initialized=!1,this.resourcesParsed=!1,this.vertexBuffersToCreate=new Jv,this.indexBuffersToCreate=new Jv,this.buffers={},this.pendingBufferLoads=0,this.programsToCreate=new Jv,this.shaders={},this.pendingShaderLoads=0,this.texturesToCreate=new Jv,this.pendingTextureLoads=0,this.texturesToCreateFromBufferView=new Jv,this.pendingBufferViewToImage=0,this.createSamplers=!0,this.createSkins=!0,this.createRuntimeAnimations=!0,this.createVertexArrays=!0,this.createRenderStates=!0,this.createUniformMaps=!0,this.createRuntimeNodes=!0,this.createdBufferViews={},this.primitivesToDecode=new Jv,this.activeDecodingTasks=0,this.pendingDecodingCache=!1,this.skinnedNodesIds=[]}function i0(e,t,n){return e.subarray(t,t+n)}n0.prototype.getBuffer=function(e){return i0(this.buffers[e.buffer],e.byteOffset,e.byteLength)},n0.prototype.finishedPendingBufferLoads=function(){return 0===this.pendingBufferLoads},n0.prototype.finishedBuffersCreation=function(){return 0===this.pendingBufferLoads&&0===this.vertexBuffersToCreate.length&&0===this.indexBuffersToCreate.length},n0.prototype.finishedProgramCreation=function(){return 0===this.pendingShaderLoads&&0===this.programsToCreate.length},n0.prototype.finishedTextureCreation=function(){const e=0===this.pendingTextureLoads,t=0===this.texturesToCreate.length&&0===this.texturesToCreateFromBufferView.length;return e&&t},n0.prototype.finishedEverythingButTextureCreation=function(){const e=0===this.pendingBufferLoads&&0===this.pendingShaderLoads,t=0===this.vertexBuffersToCreate.length&&0===this.indexBuffersToCreate.length&&0===this.programsToCreate.length&&0===this.pendingBufferViewToImage;return this.finishedDecoding()&&e&&t},n0.prototype.finishedDecoding=function(){return 0===this.primitivesToDecode.length&&0===this.activeDecodingTasks&&!this.pendingDecodingCache},n0.prototype.finished=function(){return this.finishedDecoding()&&this.finishedTextureCreation()&&this.finishedEverythingButTextureCreation()};var o0=n0;const r0={updateForwardAxis:function(e){const t=e.gltf.extras.sourceVersion;(C(t)&&"2.0"!==t||"2.0"!==r0.getAssetVersion(e.gltf))&&(e._gltfForwardAxis=iJ.X)},getAssetVersion:function(e){return C(e.asset)&&C(e.asset.version)?e.asset.version:"1.0"},splitIncompatibleMaterials:function(e){const t=e.accessors,n=e.materials,i={};return AZ.mesh(e,(function(e){AZ.meshPrimitive(e,(function(e){let o=e.material;const r=n[o],s=e.attributes.JOINTS_0;let a,c;if(C(s)){const e=t[s];a=e.componentType,c=e.type}const l=C(s)&&"VEC4"===c,u=C(e.attributes.COLOR_0),h=C(e.targets),d=C(e.attributes.NORMAL),f=C(e.attributes.TANGENT),p=C(e.attributes.TEXCOORD_0),m=p&&C(e.attributes.TEXCOORD_1),_=C(e.extensions)&&C(e.extensions.CESIUM_primitive_outline),g=i[o];if(C(g)){if(g.skinning.skinned!==l||g.hasVertexColors!==u||g.hasMorphTargets!==h||g.hasNormals!==d||g.hasTangents!==f||g.hasTexCoords!==p||g.hasTexCoord1!==m||g.hasOutline!==_){const t=pn(r,!0);o=gZ(n,t),e.material=o,i[o]={skinning:{skinned:l,componentType:a},hasVertexColors:u,hasMorphTargets:h,hasNormals:d,hasTangents:f,hasTexCoords:p,hasTexCoord1:m,hasOutline:_}}}else i[o]={skinning:{skinned:l,componentType:a},hasVertexColors:u,hasMorphTargets:h,hasNormals:d,hasTangents:f,hasTexCoords:p,hasTexCoord1:m,hasOutline:_}}))})),i},getShaderVariable:function(e){return"SCALAR"===e?"float":e.toLowerCase()},ModelState:{NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3},getFailedLoadFunction:function(e,t,n){return function(i){e._state=r0.ModelState.FAILED;let o=`Failed to load ${t}: ${n}`;C(i)&&(o+=`\n${i.message}`),e._readyPromise.reject(new Je(o))}},parseBuffers:function(e,t){const n=e._loadResources;AZ.buffer(e.gltf,(function(i,o){if(C(i.extras._pipeline.source))n.buffers[o]=i.extras._pipeline.source;else if(C(t)){const r=e._resource.getDerivedResource({url:i.uri});++n.pendingBufferLoads,r.fetchArrayBuffer().then(t(e,o)).catch(r0.getFailedLoadFunction(e,"buffer",r.url))}}))}},s0=new K,a0=new K;function c0(e,t){return AZ.techniqueAttribute(e,(function(e,n){if(e.semantic===t)return n}))}function l0(e,t){const n=e.accessors,i=e.materials,o=e.extensions.KHR_techniques_webgl,r=o.techniques,s=o.programs,a=o.shaders,c=t.targets,l=t.attributes;for(const p in c)if(c.hasOwnProperty(p)){const e=c[p];for(const t in e)"extras"!==t&&(l[`${t}_${p}`]=e[t])}const u=i[t.material],h=r[u.extensions.KHR_techniques_webgl.technique],d=s[h.program],f=a[d.vertexShader];for(const p in l)if(l.hasOwnProperty(p)&&!C(c0(h,p))){const e=l[p],t=n[e];let i=p.toLowerCase();"_"===i.charAt(0)&&(i=i.slice(1));const o=`a_${i}`;h.attributes[o]={semantic:p,type:t.componentType};const r=f.extras._pipeline;let s=r.source;s=`attribute ${r0.getShaderVariable(t.type)} ${o};\n${s}`,r.source=s}}function u0(e,t,n,i){return vZ(e,"KHR_techniques_webgl")?function(e,t){if(e.semantic===n&&(!i||!C(e.node)))return t}:function(e,o){const r=t.parameters[e];if(r.semantic===n&&(!i||!C(r.node)))return o}}r0.computeBoundingSphere=function(e){const t=e.gltf,n=t.nodes,i=t.meshes,o=t.scenes[t.scene].nodes,r=o.length,s=[],a=new K(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c=new K(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let u=0;u<r;++u){let e=n[o[u]];e._transformToRoot=r0.getTransform(e),s.push(e);while(s.length>0){e=s.pop();const o=e._transformToRoot,r=e.mesh;if(C(r)){const e=i[r],n=e.primitives,s=n.length;for(let i=0;i<s;++i){const e=n[i].attributes.POSITION;if(C(e)){const n=r0.getAccessorMinMax(t,e);if(C(n.min)&&C(n.max)){const e=K.fromArray(n.min,0,s0),t=K.fromArray(n.max,0,a0);ft.multiplyByPoint(o,e,e),ft.multiplyByPoint(o,t,t),K.minimumByComponent(a,e,a),K.maximumByComponent(c,t,c)}}}}const l=e.children;if(C(l)){const e=l.length;for(let t=0;t<e;++t){const e=n[l[t]];e._transformToRoot=r0.getTransform(e),ft.multiplyTransformation(o,e._transformToRoot,e._transformToRoot),s.push(e)}}delete e._transformToRoot}}const l=nn.fromCornerPoints(a,c);return e._forwardAxis===iJ.Z&&nn.transformWithoutScale(l,iJ.Z_UP_TO_X_UP,l),e._upAxis===iJ.Y?nn.transformWithoutScale(l,iJ.Y_UP_TO_Z_UP,l):e._upAxis===iJ.X&&nn.transformWithoutScale(l,iJ.X_UP_TO_Z_UP,l),l},r0.ensureSemanticExistence=function(e){return AZ.mesh(e,(function(t){AZ.meshPrimitive(t,(function(t){l0(e,t)}))})),e},r0.createAttributeLocations=function(e,t){const n={};let i=!1,o=1;if(AZ.techniqueAttribute(e,(function(e,t){/pos/i.test(t)&&!i?(n[t]=0,i=!0):n[t]=o++})),C(t))for(const r in t)t.hasOwnProperty(r)&&(n[r]=o++);return n},r0.getAccessorMinMax=function(e,t){const n=e.accessors[t],i=n.extensions;let o=n.min,r=n.max;if(C(i)){const e=i.WEB3D_quantized_attributes;C(e)&&(o=e.decodedMin,r=e.decodedMax)}return{min:o,max:r}},r0.getAttributeOrUniformBySemantic=function(e,t,n,i){return AZ.technique(e,(function(o){if(C(n)&&o.program!==n)return;const r=AZ.techniqueAttribute(o,u0(e,o,t,i));return C(r)?r:AZ.techniqueUniform(o,u0(e,o,t,i))}))},r0.getDiffuseAttributeOrUniform=function(e,t){let n=r0.getAttributeOrUniformBySemantic(e,"COLOR_0",t);return C(n)||(n=r0.getAttributeOrUniformBySemantic(e,"_3DTILESDIFFUSE",t)),n};const h0=new K,d0=new il,f0=new K;function p0(e,t,n){t+="(?!\\w)",t=new RegExp(t,"g");const i=e.search(t);return e.replace(t,(function(e,t){return i===t?e:n}))}function m0(e,t){const n=e.accessors[t],i=n.extensions;if(C(i))return i.WEB3D_quantized_attributes}function _0(e,t,n){const i=t.material,o=e.materials[i];if(!vZ(e,"KHR_techniques_webgl")||!C(o.extensions)||!C(o.extensions.KHR_techniques_webgl))return;const r=o.extensions.KHR_techniques_webgl.technique,s=e.extensions.KHR_techniques_webgl,a=s.techniques[r];return AZ.techniqueAttribute(a,(function(e,t){const i=e.semantic;if(i===n)return t}))}function g0(e){const t={value:e,clone:function(e,t){return e},func:function(){return t.value}};return t}function y0(e){const t={value:ro.fromArray(e),clone:ro.clone,func:function(){return t.value}};return t}function v0(e){const t={value:K.fromArray(e),clone:K.clone,func:function(){return t.value}};return t}function b0(e){const t={value:Xe.fromArray(e),clone:Xe.clone,func:function(){return t.value}};return t}function A0(e){const t={value:hh.fromColumnMajorArray(e),clone:hh.clone,func:function(){return t.value}};return t}function w0(e){const t={value:ke.fromColumnMajorArray(e),clone:ke.clone,func:function(){return t.value}};return t}function T0(e){const t={value:ft.fromColumnMajorArray(e),clone:ft.clone,func:function(){return t.value}};return t}function C0(e,t,n){this._value=void 0,this._textureId=e.index,this._textures=t,this._defaultTexture=n}function E0(e,t,n){const i=new C0(e,t,n);return i.func=function(){return i.value},i}r0.getTransform=function(e,t){return C(e.matrix)?ft.fromColumnMajorArray(e.matrix,t):ft.fromTranslationQuaternionRotationScale(K.fromArray(e.translation,0,h0),il.unpack(e.rotation,0,d0),K.fromArray(e.scale,0,f0),t)},r0.getUsedExtensions=function(e){const t=e.extensionsUsed,n={};if(C(t)){const e=t.length;for(let i=0;i<e;i++){const e=t[i];n[e]=!0}}return n},r0.getRequiredExtensions=function(e){const t=e.extensionsRequired,n={};if(C(t)){const e=t.length;for(let i=0;i<e;i++){const e=t[i];n[e]=!0}}return n},r0.supportedExtensions={AGI_articulations:!0,CESIUM_RTC:!0,EXT_texture_webp:!0,KHR_blend:!0,KHR_binary_glTF:!0,KHR_texture_basisu:!0,KHR_draco_mesh_compression:!0,KHR_materials_common:!0,KHR_techniques_webgl:!0,KHR_materials_unlit:!0,KHR_materials_pbrSpecularGlossiness:!0,KHR_texture_transform:!0,WEB3D_quantized_attributes:!0},r0.checkSupportedExtensions=function(e,t){for(const n in e)if(e.hasOwnProperty(n)){if(!r0.supportedExtensions[n])throw new Je(`Unsupported glTF Extension: ${n}`);if("EXT_texture_webp"===n&&!1===t)throw new Je("Loaded model requires WebP but browser does not support it.")}},r0.checkSupportedGlExtensions=function(e,t){if(C(e)){const n=e.length;for(let i=0;i<n;i++){const n=e[i];if("OES_element_index_uint"!==n)throw new Je(`Unsupported WebGL Extension: ${n}`);if(!t.elementIndexUint)throw new Je("OES_element_index_uint WebGL extension is not enabled.")}}},r0.modifyShaderForDracoQuantizedAttributes=function(e,t,n,i){const o={};for(let r in i)if(i.hasOwnProperty(r)){const s=i[r],a=s.quantization;if(!C(a))continue;const c=_0(e,t,r);"_"===r.charAt(0)&&(r=r.substring(1));const l=`gltf_u_dec_${r.toLowerCase()}`;if(!C(o[l])){const e=`gltf_decoded_${r}`,t=c.replace("a_","gltf_a_dec_"),i=s.componentsPerAttribute;let o;n=p0(n,c,t),o=a.octEncoded?"vec3":i>1?`vec${i}`:"float",n=`${o} ${t};\n${n}`;const u=3===i&&"COLOR_0"===r;u&&(n=p0(n,t,`vec4(${t}, 1.0)`));let h="";if(a.octEncoded){const i=`${l}_rangeConstant`;n=`uniform float ${i};\n${n}`,h=`\nvoid main() {\n    ${t} = czm_octDecode(${c}.xy, ${i}).zxy;\n    ${e}();\n}\n`}else{const i=`${l}_normConstant`,r=`${l}_min`;n=`uniform float ${i};\nuniform ${o} ${r};\n${n}`;const s=u?".xyz":"";h=`\nvoid main() {\n    ${t} = ${r} + ${c}${s} * ${i};\n    ${e}();\n}\n`}n=tq.replaceMain(n,e),n+=h}}return{shader:n}},r0.modifyShaderForQuantizedAttributes=function(e,t,n){const i={},o=t.attributes;for(let r in o)if(o.hasOwnProperty(r)){const o=_0(e,t,r),s=t.attributes[r];"_"===r.charAt(0)&&(r=r.substring(1));const a=`gltf_u_dec_${r.toLowerCase()}`,c=`${a}_scale`,l=`${a}_translate`;if(!C(i[a])&&!C(i[c])){const t=m0(e,s);if(C(t)){const e=t.decodeMatrix,s=`gltf_decoded_${r}`,u=o.replace("a_","gltf_a_dec_"),h=Math.floor(Math.sqrt(e.length));let d;n=p0(n,o,u),d=h>2?"vec"+(h-1):"float",n=`${d} ${u};\n${n}`;let f="";5===h?(n=`uniform mat4 ${c};\n${n}`,n=`uniform vec4 ${l};\n${n}`,f=`\nvoid main() {\n    ${u} = ${c} * ${o} + ${l};\n    ${s}();\n}\n`,i[c]={mat:4},i[l]={vec:4}):(n=`uniform mat${h} ${a};\n${n}`,f=`\nvoid main() {\n    ${u} = ${d}(${a} * vec${h}(${o},1.0));\n    ${s}();\n}\n`,i[a]={mat:h}),n=tq.replaceMain(n,s),n+=f}}}return{shader:n,uniforms:i}},Object.defineProperties(C0.prototype,{value:{get:function(){if(!C(this._value)){const e=this._textures[this._textureId];if(!C(e))return this._defaultTexture;this._value=e}return this._value},set:function(e){this._value=e}}}),C0.prototype.clone=function(e){return e},C0.prototype.func=void 0;const x0={};function S0(e){return[e[0],e[1],e[2],e[3],e[5],e[6],e[7],e[8],e[10],e[11],e[12],e[13],e[15],e[16],e[17],e[18]]}function I0(e){return[e[20],e[21],e[22],e[23]]}x0[th.FLOAT]=g0,x0[th.FLOAT_VEC2]=y0,x0[th.FLOAT_VEC3]=v0,x0[th.FLOAT_VEC4]=b0,x0[th.INT]=g0,x0[th.INT_VEC2]=y0,x0[th.INT_VEC3]=v0,x0[th.INT_VEC4]=b0,x0[th.BOOL]=g0,x0[th.BOOL_VEC2]=y0,x0[th.BOOL_VEC3]=v0,x0[th.BOOL_VEC4]=b0,x0[th.FLOAT_MAT2]=A0,x0[th.FLOAT_MAT3]=w0,x0[th.FLOAT_MAT4]=T0,x0[th.SAMPLER_2D]=E0,r0.createUniformFunction=function(e,t,n,i){return x0[e](t,n,i)},r0.createUniformsForDracoQuantizedAttributes=function(e){const t={};for(let n in e)if(e.hasOwnProperty(n)){const i=e[n],o=i.quantization;if(!C(o))continue;"_"===n.charAt(0)&&(n=n.substring(1));const r=`gltf_u_dec_${n.toLowerCase()}`;if(o.octEncoded){const e=`${r}_rangeConstant`,n=(1<<o.quantizationBits)-1;t[e]=g0(n).func;continue}const s=`${r}_normConstant`,a=o.range/(1<<o.quantizationBits);t[s]=g0(a).func;const c=`${r}_min`;switch(i.componentsPerAttribute){case 1:t[c]=g0(o.minValues).func;break;case 2:t[c]=y0(o.minValues).func;break;case 3:t[c]=v0(o.minValues).func;break;case 4:t[c]=b0(o.minValues).func;break}}return t},r0.createUniformsForQuantizedAttributes=function(e,t,n){const i=e.accessors,o={},r={},s=t.attributes;for(let a in s)if(s.hasOwnProperty(a)){const e=s[a],t=i[e],n=t.extensions;if("_"===a.charAt(0)&&(a=a.substring(1)),C(n)){const e=n.WEB3D_quantized_attributes;if(C(e)){const n=e.decodeMatrix,i=`gltf_u_dec_${a.toLowerCase()}`;let s,c;switch(t.type){case fh.SCALAR:r[i]=A0(n).func,o[i]=!0;break;case fh.VEC2:r[i]=w0(n).func,o[i]=!0;break;case fh.VEC3:r[i]=T0(n).func,o[i]=!0;break;case fh.VEC4:s=`${i}_scale`,c=`${i}_translate`,r[s]=T0(S0(n)).func,r[c]=b0(I0(n)).func,o[s]=!0,o[c]=!0;break}}}}for(const a in n)if(n.hasOwnProperty(a)&&!o[a]){const e=n[a];C(e.mat)&&(2===e.mat?r[a]=A0(hh.IDENTITY).func:3===e.mat?r[a]=w0(ke.IDENTITY).func:4===e.mat&&(r[a]=T0(ft.IDENTITY).func)),C(e.vec)&&4===e.vec&&(r[a]=b0([0,0,0,0]).func)}return r};const O0=new K,D0={MODEL:function(e,t){return function(){return e.model}},VIEW:function(e,t){return function(){return e.view}},PROJECTION:function(e,t){return function(){return e.projection}},MODELVIEW:function(e,t){return function(){return e.modelView}},CESIUM_RTC_MODELVIEW:function(e,t){const n=new ft;return function(){return C(t._rtcCenter)?(ft.getTranslation(e.model,O0),K.add(O0,t._rtcCenter,O0),ft.multiplyByPoint(e.view,O0,O0),ft.setTranslation(e.modelView,O0,n)):e.modelView}},MODELVIEWPROJECTION:function(e,t){return function(){return e.modelViewProjection}},MODELINVERSE:function(e,t){return function(){return e.inverseModel}},VIEWINVERSE:function(e,t){return function(){return e.inverseView}},PROJECTIONINVERSE:function(e,t){return function(){return e.inverseProjection}},MODELVIEWINVERSE:function(e,t){return function(){return e.inverseModelView}},MODELVIEWPROJECTIONINVERSE:function(e,t){return function(){return e.inverseModelViewProjection}},MODELINVERSETRANSPOSE:function(e,t){return function(){return e.inverseTransposeModel}},MODELVIEWINVERSETRANSPOSE:function(e,t){return function(){return e.normal}},VIEWPORT:function(e,t){return function(){return e.viewportCartesian4}}};r0.getGltfSemanticUniforms=function(){return D0};var P0=r0;function R0(e,t){if(t=R(t,R.EMPTY_OBJECT),!C(e))return;if(!vZ(e,"KHR_materials_common"))return;vZ(e,"KHR_techniques_webgl")||(C(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]},e.extensionsUsed.push("KHR_techniques_webgl"),e.extensionsRequired.push("KHR_techniques_webgl"));const n=e.extensions.KHR_techniques_webgl;F0(e);const i=L0(e),o=P0.splitIncompatibleMaterials(e),r={};let s=!1;return AZ.material(e,(function(a,c){if(C(a.extensions)&&C(a.extensions.KHR_materials_common)){const l=a.extensions.KHR_materials_common,u=o[c],h=N0(l,u);let d=r[h];C(d)||(d=M0(e,n,u,l,i,t.addBatchIdToGeneratedShaders),r[h]=d,s=!0);const f={},p=l.values;let m;for(const e in p)p.hasOwnProperty(e)&&"transparent"!==e&&"doubleSided"!==e&&(m=`u_${e.toLowerCase()}`,f[m]=p[e]);a.extensions.KHR_techniques_webgl={technique:d,values:f},a.alphaMode="OPAQUE",l.transparent&&(a.alphaMode="BLEND"),l.doubleSided&&(a.doubleSided=!0)}})),s?(P0.ensureSemanticExistence(e),e):e}function L0(e){const t={};let n;if(C(e.extensions)&&C(e.extensions.KHR_materials_common)&&(n=e.extensions.KHR_materials_common.lights),C(n)){const i=e.nodes;for(const e in i)if(i.hasOwnProperty(e)){const t=i[e];if(C(t.extensions)&&C(t.extensions.KHR_materials_common)){const i=t.extensions.KHR_materials_common.light;C(i)&&C(n[i])&&(n[i].node=e),delete t.extensions.KHR_materials_common}}let o=0;for(const e in n)if(n.hasOwnProperty(e)){const i=n[e],r=i.type;if("ambient"!==r&&!C(i.node)){delete n[e];continue}const s=`light${o.toString()}`;let a,c,l,u;switch(i.baseName=s,r){case"ambient":a=i.ambient,t[`${s}Color`]={type:th.FLOAT_VEC3,value:a.color};break;case"directional":c=i.directional,t[`${s}Color`]={type:th.FLOAT_VEC3,value:c.color},C(i.node)&&(t[`${s}Transform`]={node:i.node,semantic:"MODELVIEW",type:th.FLOAT_MAT4});break;case"point":l=i.point,t[`${s}Color`]={type:th.FLOAT_VEC3,value:l.color},C(i.node)&&(t[`${s}Transform`]={node:i.node,semantic:"MODELVIEW",type:th.FLOAT_MAT4}),t[`${s}Attenuation`]={type:th.FLOAT_VEC3,value:[l.constantAttenuation,l.linearAttenuation,l.quadraticAttenuation]};break;case"spot":u=i.spot,t[`${s}Color`]={type:th.FLOAT_VEC3,value:u.color},C(i.node)&&(t[`${s}Transform`]={node:i.node,semantic:"MODELVIEW",type:th.FLOAT_MAT4},t[`${s}InverseTransform`]={node:i.node,semantic:"MODELVIEWINVERSE",type:th.FLOAT_MAT4,useInFragment:!0}),t[`${s}Attenuation`]={type:th.FLOAT_VEC3,value:[u.constantAttenuation,u.linearAttenuation,u.quadraticAttenuation]},t[`${s}FallOff`]={type:th.FLOAT_VEC2,value:[u.fallOffAngle,u.fallOffExponent]};break}++o}}return t}function M0(e,t,n,i,o,r){C(i)||(i={}),r=R(r,!1);const s=t.techniques,a=t.shaders,c=t.programs,l=i.technique.toUpperCase();let u;C(e.extensions)&&C(e.extensions.KHR_materials_common)&&(u=e.extensions.KHR_materials_common.lights);const h=i.values,d=R(i.jointCount,0);let f,p=!1,m=!1;C(n)&&(f=n.skinning,p=f.skinned,m=n.hasVertexColors);let _="precision highp float;\n",g="precision highp float;\n";const y="CONSTANT"!==l,v={u_modelViewMatrix:{semantic:vZ(e,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:th.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:th.FLOAT_MAT4}};let b;y&&(v.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:th.FLOAT_MAT3}),p&&(v.u_jointMatrix={count:d,semantic:"JOINTMATRIX",type:th.FLOAT_MAT4});let A=!1;for(const C in h)if(h.hasOwnProperty(C)&&"transparent"!==C&&"doubleSided"!==C){const e=B0(C,h[C]);b=`u_${C.toLowerCase()}`,A||e!==th.SAMPLER_2D||(A=!0),v[b]={type:e}}if(C(v.u_diffuse)&&(v.u_diffuse.semantic="_3DTILESDIFFUSE"),C(o))for(const C in o)o.hasOwnProperty(C)&&(b=`u_${C}`,v[b]=o[C]);for(b in v)if(v.hasOwnProperty(b)){const e=v[b],t=C(e.count)?`[${e.count}]`:"";e.type!==th.FLOAT_MAT3&&e.type!==th.FLOAT_MAT4||e.useInFragment?(g+=`uniform ${gz(e.type)} ${b}${t};\n`,delete e.useInFragment):_+=`uniform ${gz(e.type)} ${b}${t};\n`}let w="";p&&(w+="    mat4 skinMatrix =\n        a_weight.x * u_jointMatrix[int(a_joint.x)] +\n        a_weight.y * u_jointMatrix[int(a_joint.y)] +\n        a_weight.z * u_jointMatrix[int(a_joint.z)] +\n        a_weight.w * u_jointMatrix[int(a_joint.w)];\n");const T={a_position:{semantic:"POSITION"}};let E;_+="attribute vec3 a_position;\n",_+="varying vec3 v_positionEC;\n",w+=p?"  vec4 pos = u_modelViewMatrix * skinMatrix * vec4(a_position,1.0);\n":"  vec4 pos = u_modelViewMatrix * vec4(a_position,1.0);\n",w+="  v_positionEC = pos.xyz;\n",w+="  gl_Position = u_projectionMatrix * pos;\n",g+="varying vec3 v_positionEC;\n",y&&(T.a_normal={semantic:"NORMAL"},_+="attribute vec3 a_normal;\n",_+="varying vec3 v_normal;\n",w+=p?"  v_normal = u_normalMatrix * mat3(skinMatrix) * a_normal;\n":"  v_normal = u_normalMatrix * a_normal;\n",g+="varying vec3 v_normal;\n"),A&&(T.a_texcoord_0={semantic:"TEXCOORD_0"},E="v_texcoord_0",_+="attribute vec2 a_texcoord_0;\n",_+=`varying vec2 ${E};\n`,w+=`  ${E} = a_texcoord_0;\n`,g+=`varying vec2 ${E};\n`),p&&(T.a_joint={semantic:"JOINTS_0"},T.a_weight={semantic:"WEIGHTS_0"},_+="attribute vec4 a_joint;\n",_+="attribute vec4 a_weight;\n"),m&&(T.a_vertexColor={semantic:"COLOR_0"},_+="attribute vec4 a_vertexColor;\n",_+="varying vec4 v_vertexColor;\n",w+="  v_vertexColor = a_vertexColor;\n",g+="varying vec4 v_vertexColor;\n"),r&&(T.a_batchId={semantic:"_BATCHID"},_+="attribute float a_batchId;\n");const x=y&&("BLINN"===l||"PHONG"===l)&&C(v.u_specular)&&C(v.u_shininess)&&v.u_shininess>0;let S=!1,I=!1,O="";for(const C in u)if(u.hasOwnProperty(C)){const e=u[C],t=e.type.toLowerCase(),n=e.baseName;O+="  {\n";const i=`u_${n}Color`;if("ambient"===t)I=!0,O+=`    ambientLight += ${i};\n`;else if(y){S=!0;const e=`v_${n}Direction`,o=`v_${n}Position`;"point"!==t&&(_+=`varying vec3 ${e};\n`,g+=`varying vec3 ${e};\n`,w+=`  ${e} = mat3(u_${n}Transform) * vec3(0.,0.,1.);\n`,"directional"===t&&(O+=`    vec3 l = normalize(${e});\n`)),"directional"!==t?(_+=`varying vec3 ${o};\n`,g+=`varying vec3 ${o};\n`,w+=`  ${o} = u_${n}Transform[3].xyz;\n`,O+=`    vec3 VP = ${o} - v_positionEC;\n`,O+="    vec3 l = normalize(VP);\n",O+="    float range = length(VP);\n",O+=`    float attenuation = 1.0 / (u_${n}Attenuation.x + `,O+=`(u_${n}Attenuation.y * range) + `,O+=`(u_${n}Attenuation.z * range * range));\n`):O+="    float attenuation = 1.0;\n","spot"===t&&(O+=`    float spotDot = dot(l, normalize(${e}));\n`,O+=`    if (spotDot < cos(u_${n}FallOff.x * 0.5))\n`,O+="    {\n",O+="      attenuation = 0.0;\n",O+="    }\n",O+="    else\n",O+="    {\n",O+=`        attenuation *= max(0.0, pow(spotDot, u_${n}FallOff.y));\n`,O+="    }\n"),O+=`    diffuseLight += ${i}* max(dot(normal,l), 0.) * attenuation;\n`,x&&("BLINN"===l?(O+="    vec3 h = normalize(l + viewDir);\n",O+="    float specularIntensity = max(0., pow(max(dot(normal, h), 0.), u_shininess)) * attenuation;\n"):(O+="    vec3 reflectDir = reflect(-l, normal);\n",O+="    float specularIntensity = max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess)) * attenuation;\n"),O+=`    specularLight += ${i} * specularIntensity;\n`)}O+="  }\n"}if(I||(O+="  ambientLight += vec3(0.2, 0.2, 0.2);\n"),!S&&"CONSTANT"!==l){g+="#ifdef USE_CUSTOM_LIGHT_COLOR \n",g+="uniform vec3 gltf_lightColor; \n",g+="#endif \n",O+="#ifndef USE_CUSTOM_LIGHT_COLOR \n",O+="    vec3 lightColor = czm_lightColor;\n",O+="#else \n",O+="    vec3 lightColor = gltf_lightColor;\n",O+="#endif \n",O+="  vec3 l = normalize(czm_lightDirectionEC);\n";const e="0.2";O+=`  diffuseLight += lightColor * max(dot(normal,l), ${e});\n`,x&&("BLINN"===l?(O+="  vec3 h = normalize(l + viewDir);\n",O+="  float specularIntensity = max(0., pow(max(dot(normal, h), 0.), u_shininess));\n"):(O+="  vec3 reflectDir = reflect(-l, normal);\n",O+="  float specularIntensity = max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess));\n"),O+="  specularLight += lightColor * specularIntensity;\n")}_+="void main(void) {\n",_+=w,_+="}\n",g+="void main(void) {\n";let D,P="  vec3 color = vec3(0.0, 0.0, 0.0);\n";y&&(g+="  vec3 normal = normalize(v_normal);\n",i.doubleSided&&(g+="  if (czm_backFacing())\n",g+="  {\n",g+="    normal = -normal;\n",g+="  }\n")),"CONSTANT"!==l?(C(v.u_diffuse)&&(v.u_diffuse.type===th.SAMPLER_2D?g+=`  vec4 diffuse = texture2D(u_diffuse, ${E});\n`:g+="  vec4 diffuse = u_diffuse;\n",g+="  vec3 diffuseLight = vec3(0.0, 0.0, 0.0);\n",P+="  color += diffuse.rgb * diffuseLight;\n"),x&&(v.u_specular.type===th.SAMPLER_2D?g+=`  vec3 specular = texture2D(u_specular, ${E}).rgb;\n`:g+="  vec3 specular = u_specular.rgb;\n",g+="  vec3 specularLight = vec3(0.0, 0.0, 0.0);\n",P+="  color += specular * specularLight;\n"),D=C(v.u_transparency)?"  gl_FragColor = vec4(color * diffuse.a * u_transparency, diffuse.a * u_transparency);\n":"  gl_FragColor = vec4(color * diffuse.a, diffuse.a);\n"):D=C(v.u_transparency)?"  gl_FragColor = vec4(color * u_transparency, u_transparency);\n":"  gl_FragColor = vec4(color, 1.0);\n",m&&(P+="  color *= v_vertexColor.rgb;\n"),C(v.u_emission)&&(v.u_emission.type===th.SAMPLER_2D?g+=`  vec3 emission = texture2D(u_emission, ${E}).rgb;\n`:g+="  vec3 emission = u_emission.rgb;\n",P+="  color += emission;\n"),(C(v.u_ambient)||"CONSTANT"!==l)&&(C(v.u_ambient)?v.u_ambient.type===th.SAMPLER_2D?g+=`  vec3 ambient = texture2D(u_ambient, ${E}).rgb;\n`:g+="  vec3 ambient = u_ambient.rgb;\n":g+="  vec3 ambient = diffuse.rgb;\n",P+="  color += ambient * ambientLight;\n"),g+="  vec3 viewDir = -normalize(v_positionEC);\n",g+="  vec3 ambientLight = vec3(0.0, 0.0, 0.0);\n",g+=O,g+=P,g+=D,g+="}\n";const L=gZ(a,{type:th.VERTEX_SHADER,extras:{_pipeline:{source:_,extension:".glsl"}}}),M=gZ(a,{type:th.FRAGMENT_SHADER,extras:{_pipeline:{source:g,extension:".glsl"}}}),B=gZ(c,{fragmentShader:M,vertexShader:L}),N=gZ(s,{attributes:T,program:B,uniforms:v});return N}function B0(e,t){let n;switch(n=C(t.value)?t.value:C(t.index)?[t.index]:t,e){case"ambient":return 1===n.length?th.SAMPLER_2D:th.FLOAT_VEC4;case"diffuse":return 1===n.length?th.SAMPLER_2D:th.FLOAT_VEC4;case"emission":return 1===n.length?th.SAMPLER_2D:th.FLOAT_VEC4;case"specular":return 1===n.length?th.SAMPLER_2D:th.FLOAT_VEC4;case"shininess":return th.FLOAT;case"transparency":return th.FLOAT;case"transparent":return th.BOOL;case"doubleSided":return th.BOOL}}function N0(e,t){let n="";n+=`technique:${e.technique};`;const i=e.values,o=Object.keys(i).sort(),r=o.length;for(let a=0;a<r;++a){const e=o[a];i.hasOwnProperty(e)&&(n+=`${e}:${B0(e,i[e])}`,n+=";")}const s=R(e.jointCount,0);if(n+=`${s.toString()};`,C(t)){const e=t.skinning;s>0&&(n+=`${e.type};`),n+=t.hasVertexColors}return n}function F0(e){const t=e.extensions.KHR_materials_common;if(!C(t)||!C(t.lights))return;const n=t.lights,i=n.length;for(let o=0;o<i;o++){const e=n[o];if("ambient"===e.type){C(e.ambient)||(e.ambient={});const t=e.ambient;C(t.color)||(t.color=[1,1,1])}else if("directional"===e.type){C(e.directional)||(e.directional={});const t=e.directional;C(t.color)||(t.color=[1,1,1])}else if("point"===e.type){C(e.point)||(e.point={});const t=e.point;C(t.color)||(t.color=[1,1,1]),t.constantAttenuation=R(t.constantAttenuation,1),t.linearAttenuation=R(t.linearAttenuation,0),t.quadraticAttenuation=R(t.quadraticAttenuation,0)}else if("spot"===e.type){C(e.spot)||(e.spot={});const t=e.spot;C(t.color)||(t.color=[1,1,1]),t.constantAttenuation=R(t.constantAttenuation,1),t.fallOffAngle=R(t.fallOffAngle,3.14159265),t.fallOffExponent=R(t.fallOffExponent,0),t.linearAttenuation=R(t.linearAttenuation,0),t.quadraticAttenuation=R(t.quadraticAttenuation,0)}}}var z0=R0;function k0(e,t){if(t=R(t,R.EMPTY_OBJECT),vZ(e,"KHR_techniques_webgl"))return e;if(!C(e.materials)||0===e.materials.length)return e;C(e.extensions)||(e.extensions={}),C(e.extensionsUsed)||(e.extensionsUsed=[]),C(e.extensionsRequired)||(e.extensionsRequired=[]),e.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]},e.extensionsUsed.push("KHR_techniques_webgl"),e.extensionsRequired.push("KHR_techniques_webgl");const n=P0.splitIncompatibleMaterials(e);return AZ.material(e,(function(i,o){const r={},s=j0(e,i,o,r,n,t);C(i.extensions)||(i.extensions={}),i.extensions.KHR_techniques_webgl={values:r,technique:s}})),P0.ensureSemanticExistence(e),e}function U0(e){return C(e.extensions)&&C(e.extensions.KHR_materials_pbrSpecularGlossiness)}function V0(e,t,n,i,o){let r;const s=n[t];return C(s)&&C(s.texCoord)&&1===s.texCoord&&(i=i.replace("0","1")),C(n[`${t}Offset`])?(r=`${t}Coord`,o.fragmentShaderMain+=`    vec2 ${r} = computeTexCoord(${i}, ${t}Offset, ${t}Rotation, ${t}Scale);\n`):r=i,r}const H0=[0,0],G0=[0],W0=[1,1];function q0(e,t,n){if(-1===e.indexOf("Texture")||!C(t.extensions)||!C(t.extensions.KHR_texture_transform))return;const i=`u_${e}`,o=t.extensions.KHR_texture_transform;n[`${i}Offset`]=R(o.offset,H0),n[`${i}Rotation`]=R(o.rotation,G0),n[`${i}Scale`]=R(o.scale,W0),C(t.texCoord)&&C(o.texCoord)&&(n[i].texCoord=o.texCoord)}function j0(e,t,n,i,o,r){const s=R(r.addBatchIdToGeneratedShaders,!1),a=e.extensions.KHR_techniques_webgl,c=a.techniques,l=a.shaders,u=a.programs,h=U0(t);let d,f,p;const m=t.pbrMetallicRoughness;if(C(m)&&!h)for(f in m)m.hasOwnProperty(f)&&(p=m[f],d=`u_${f}`,i[d]=p,q0(f,p,i));if(h){const e=t.extensions.KHR_materials_pbrSpecularGlossiness;for(f in e)e.hasOwnProperty(f)&&(p=e[f],d=`u_${f}`,i[d]=p,q0(f,p,i))}for(const C in t)t.hasOwnProperty(C)&&(C.indexOf("Texture")>=0||C.indexOf("Factor")>=0)&&(p=t[C],d=`u_${C}`,i[d]=p,q0(C,p,i));let _,g="precision highp float;\n",y="precision highp float;\n";C(e.skins)&&(_=e.skins[0]);const v=C(_)?_.joints:[],b=v.length,A=o[n];let w,T,E=!1,x=!1,S=!1,I=!1,O=!1,D=!1,P=!1,L=!1,M=!1;C(A)&&(w=A.skinning,E=w.skinned&&v.length>0,x=A.hasVertexColors,S=A.hasMorphTargets,I=A.hasNormals,O=A.hasTangents,D=A.hasTexCoords,P=A.hasTexCoord1,L=A.hasOutline),S&&AZ.mesh(e,(function(e){AZ.meshPrimitive(e,(function(e){if(e.material===n){const t=e.targets;C(t)&&(T=t)}}))}));const B={u_modelViewMatrix:{semantic:vZ(e,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:th.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:th.FLOAT_MAT4}};C(t.extensions)&&C(t.extensions.KHR_materials_unlit)&&(M=!0),I&&(B.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:th.FLOAT_MAT3}),E&&(B.u_jointMatrix={count:b,semantic:"JOINTMATRIX",type:th.FLOAT_MAT4}),S&&(B.u_morphWeights={count:T.length,semantic:"MORPHWEIGHTS",type:th.FLOAT});const N=t.alphaMode;for(d in C(N)&&"MASK"===N&&(B.u_alphaCutoff={semantic:"ALPHACUTOFF",type:th.FLOAT}),i)i.hasOwnProperty(d)&&(B[d]={type:Y0(d)});const F=R(B.u_baseColorTexture,B.u_baseColorFactor);for(d in C(F)&&(F.semantic="_3DTILESDIFFUSE"),B)if(B.hasOwnProperty(d)){const e=B[d],t=C(e.count)?`[${e.count}]`:"";e.type!==th.FLOAT_MAT3&&e.type!==th.FLOAT_MAT4&&"u_morphWeights"!==d||e.useInFragment?(y+=`uniform ${gz(e.type)} ${d}${t};\n`,delete e.useInFragment):g+=`uniform ${gz(e.type)} ${d}${t};\n`}L&&(y+="uniform sampler2D u_outlineTexture;\n");let z="";E&&(z+="    mat4 skinMatrix =\n        a_weight.x * u_jointMatrix[int(a_joint.x)] +\n        a_weight.y * u_jointMatrix[int(a_joint.y)] +\n        a_weight.z * u_jointMatrix[int(a_joint.z)] +\n        a_weight.w * u_jointMatrix[int(a_joint.w)];\n");const k={a_position:{semantic:"POSITION"}};if(L&&(k.a_outlineCoordinates={semantic:"_OUTLINE_COORDINATES"}),g+="attribute vec3 a_position;\n",I&&(g+="varying vec3 v_positionEC;\n"),L&&(g+="attribute vec3 a_outlineCoordinates;\n",g+="varying vec3 v_outlineCoordinates;\n"),z+="    vec3 weightedPosition = a_position;\n",I&&(z+="    vec3 weightedNormal = a_normal;\n"),O&&(z+="    vec4 weightedTangent = a_tangent;\n"),S)for(let C=0;C<T.length;C++){const e=T[C];for(const t in e)if(e.hasOwnProperty(t)&&"extras"!==t){const e=`a_${t}_${C}`;k[e]={semantic:`${t}_${C}`},g+=`attribute vec3 ${e};\n`,"POSITION"===t?z+=`    weightedPosition += u_morphWeights[${C}] * ${e};\n`:"NORMAL"===t?z+=`    weightedNormal += u_morphWeights[${C}] * ${e};\n`:O&&"TANGENT"===t&&(z+=`    weightedTangent.xyz += u_morphWeights[${C}] * ${e};\n`)}}z+=E?"    vec4 position = skinMatrix * vec4(weightedPosition, 1.0);\n":"    vec4 position = vec4(weightedPosition, 1.0);\n",z+="    position = u_modelViewMatrix * position;\n",I&&(z+="    v_positionEC = position.xyz;\n"),z+="    gl_Position = u_projectionMatrix * position;\n",L&&(z+="    v_outlineCoordinates = a_outlineCoordinates;\n"),I&&(k.a_normal={semantic:"NORMAL"},g+="attribute vec3 a_normal;\n",M||(g+="varying vec3 v_normal;\n",z+=E?"    v_normal = u_normalMatrix * mat3(skinMatrix) * weightedNormal;\n":"    v_normal = u_normalMatrix * weightedNormal;\n",y+="varying vec3 v_normal;\n"),y+="varying vec3 v_positionEC;\n"),O&&(k.a_tangent={semantic:"TANGENT"},g+="attribute vec4 a_tangent;\n",g+="varying vec4 v_tangent;\n",z+="    v_tangent.xyz = u_normalMatrix * weightedTangent.xyz;\n",z+="    v_tangent.w = weightedTangent.w;\n",y+="varying vec4 v_tangent;\n"),L&&(y+="varying vec3 v_outlineCoordinates;\n");let U,V,H,G,W,q,j,Y,K="";if(D){if(k.a_texcoord_0={semantic:"TEXCOORD_0"},U="v_texcoord_0",g+="attribute vec2 a_texcoord_0;\n",g+=`varying vec2 ${U};\n`,z+=`    ${U} = a_texcoord_0;\n`,y+=`varying vec2 ${U};\n`,P){k.a_texcoord_1={semantic:"TEXCOORD_1"};const e=U.replace("0","1");g+="attribute vec2 a_texcoord_1;\n",g+=`varying vec2 ${e};\n`,z+=`    ${e} = a_texcoord_1;\n`,y+=`varying vec2 ${e};\n`}const t={fragmentShaderMain:K};V=V0(e,"u_normalTexture",i,U,t),H=V0(e,"u_baseColorTexture",i,U,t),G=V0(e,"u_specularGlossinessTexture",i,U,t),W=V0(e,"u_diffuseTexture",i,U,t),q=V0(e,"u_metallicRoughnessTexture",i,U,t),j=V0(e,"u_occlusionTexture",i,U,t),Y=V0(e,"u_emissiveTexture",i,U,t),K=t.fragmentShaderMain}E&&(k.a_joint={semantic:"JOINTS_0"},k.a_weight={semantic:"WEIGHTS_0"},g+="attribute vec4 a_joint;\n",g+="attribute vec4 a_weight;\n"),x&&(k.a_vertexColor={semantic:"COLOR_0"},g+="attribute vec4 a_vertexColor;\n",g+="varying vec4 v_vertexColor;\n",z+="  v_vertexColor = a_vertexColor;\n",y+="varying vec4 v_vertexColor;\n"),s&&(k.a_batchId={semantic:"_BATCHID"},g+="attribute float a_batchId;\n"),g+="void main(void) \n{\n",g+=z,g+="}\n",I&&!M&&(y+="const float M_PI = 3.141592653589793;\n",y+="vec3 lambertianDiffuse(vec3 diffuseColor) \n{\n    return diffuseColor / M_PI;\n}\n\n",y+="vec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH) \n{\n    return f0 + (f90 - f0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);\n}\n\n",y+="vec3 fresnelSchlick(float metalness, float VdotH) \n{\n    return metalness + (vec3(1.0) - metalness) * pow(1.0 - VdotH, 5.0);\n}\n\n",y+="float smithVisibilityG1(float NdotV, float roughness) \n{\n    float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\n\n",y+="float smithVisibilityGGX(float roughness, float NdotL, float NdotV) \n{\n    return smithVisibilityG1(NdotL, roughness) * smithVisibilityG1(NdotV, roughness);\n}\n\n",y+="float GGX(float roughness, float NdotH) \n{\n    float roughnessSquared = roughness * roughness;\n    float f = (NdotH * roughnessSquared - NdotH) * NdotH + 1.0;\n    return roughnessSquared / (M_PI * f * f);\n}\n\n"),y+="vec3 SRGBtoLINEAR3(vec3 srgbIn) \n{\n    return pow(srgbIn, vec3(2.2));\n}\n\n",y+="vec4 SRGBtoLINEAR4(vec4 srgbIn) \n{\n    vec3 linearOut = pow(srgbIn.rgb, vec3(2.2));\n    return vec4(linearOut, srgbIn.a);\n}\n\n",y+="vec3 applyTonemapping(vec3 linearIn) \n{\n#ifndef HDR \n    return czm_acesTonemapping(linearIn);\n#else \n    return linearIn;\n#endif \n}\n\n",y+="vec3 LINEARtoSRGB(vec3 linearIn) \n{\n#ifndef HDR \n    return pow(linearIn, vec3(1.0/2.2));\n#else \n    return linearIn;\n#endif \n}\n\n",y+="vec2 computeTexCoord(vec2 texCoords, vec2 offset, float rotation, vec2 scale) \n{\n    rotation = -rotation; \n    mat3 transform = mat3(\n        cos(rotation) * scale.x, sin(rotation) * scale.x, 0.0, \n       -sin(rotation) * scale.y, cos(rotation) * scale.y, 0.0, \n        offset.x, offset.y, 1.0); \n    vec2 transformedTexCoords = (transform * vec3(fract(texCoords), 1.0)).xy; \n    return transformedTexCoords; \n}\n\n",y+="#ifdef USE_IBL_LIGHTING \n",y+="uniform vec2 gltf_iblFactor; \n",y+="#endif \n",y+="#ifdef USE_CUSTOM_LIGHT_COLOR \n",y+="uniform vec3 gltf_lightColor; \n",y+="#endif \n",y+="void main(void) \n{\n",y+=K,I&&!M&&(y+="    vec3 ng = normalize(v_normal);\n",y+="    vec3 positionWC = vec3(czm_inverseView * vec4(v_positionEC, 1.0));\n",C(i.u_normalTexture)?O?(y+="    vec3 t = normalize(v_tangent.xyz);\n",y+="    vec3 b = normalize(cross(ng, t) * v_tangent.w);\n",y+="    mat3 tbn = mat3(t, b, ng);\n",y+=`    vec3 n = texture2D(u_normalTexture, ${V}).rgb;\n`,y+="    n = normalize(tbn * (2.0 * n - 1.0));\n"):(y=`#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n${y}`,y+="#ifdef GL_OES_standard_derivatives\n",y+="    vec3 pos_dx = dFdx(v_positionEC);\n",y+="    vec3 pos_dy = dFdy(v_positionEC);\n",y+=`    vec3 tex_dx = dFdx(vec3(${V},0.0));\n`,y+=`    vec3 tex_dy = dFdy(vec3(${V},0.0));\n`,y+="    vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n",y+="    t = normalize(t - ng * dot(ng, t));\n",y+="    vec3 b = normalize(cross(ng, t));\n",y+="    mat3 tbn = mat3(t, b, ng);\n",y+=`    vec3 n = texture2D(u_normalTexture, ${V}).rgb;\n`,y+="    n = normalize(tbn * (2.0 * n - 1.0));\n",y+="#else\n",y+="    vec3 n = ng;\n",y+="#endif\n"):y+="    vec3 n = ng;\n",t.doubleSided&&(y+="    if (czm_backFacing())\n",y+="    {\n",y+="        n = -n;\n",y+="    }\n")),C(i.u_baseColorTexture)?(y+=`    vec4 baseColorWithAlpha = SRGBtoLINEAR4(texture2D(u_baseColorTexture, ${H}));\n`,C(i.u_baseColorFactor)&&(y+="    baseColorWithAlpha *= u_baseColorFactor;\n")):C(i.u_baseColorFactor)?y+="    vec4 baseColorWithAlpha = u_baseColorFactor;\n":y+="    vec4 baseColorWithAlpha = vec4(1.0);\n",x&&(y+="    baseColorWithAlpha *= v_vertexColor;\n"),y+="    vec3 baseColor = baseColorWithAlpha.rgb;\n",I&&!M?(h?(C(i.u_specularGlossinessTexture)?(y+=`    vec4 specularGlossiness = SRGBtoLINEAR4(texture2D(u_specularGlossinessTexture, ${G}));\n`,y+="    vec3 specular = specularGlossiness.rgb;\n",y+="    float glossiness = specularGlossiness.a;\n",C(i.u_specularFactor)&&(y+="    specular *= u_specularFactor;\n"),C(i.u_glossinessFactor)&&(y+="    glossiness *= u_glossinessFactor;\n")):(C(i.u_specularFactor)?y+="    vec3 specular = clamp(u_specularFactor, vec3(0.0), vec3(1.0));\n":y+="    vec3 specular = vec3(1.0);\n",C(i.u_glossinessFactor)?y+="    float glossiness = clamp(u_glossinessFactor, 0.0, 1.0);\n":y+="    float glossiness = 1.0;\n"),C(i.u_diffuseTexture)?(y+=`    vec4 diffuse = SRGBtoLINEAR4(texture2D(u_diffuseTexture, ${W}));\n`,C(i.u_diffuseFactor)&&(y+="    diffuse *= u_diffuseFactor;\n")):C(i.u_diffuseFactor)?y+="    vec4 diffuse = clamp(u_diffuseFactor, vec4(0.0), vec4(1.0));\n":y+="    vec4 diffuse = vec4(1.0);\n",y+="    baseColorWithAlpha.a = diffuse.a;\n"):C(i.u_metallicRoughnessTexture)?(y+=`    vec3 metallicRoughness = texture2D(u_metallicRoughnessTexture, ${q}).rgb;\n`,y+="    float metalness = clamp(metallicRoughness.b, 0.0, 1.0);\n",y+="    float roughness = clamp(metallicRoughness.g, 0.04, 1.0);\n",C(i.u_metallicFactor)&&(y+="    metalness *= u_metallicFactor;\n"),C(i.u_roughnessFactor)&&(y+="    roughness *= u_roughnessFactor;\n")):(C(i.u_metallicFactor)?y+="    float metalness = clamp(u_metallicFactor, 0.0, 1.0);\n":y+="    float metalness = 1.0;\n",C(i.u_roughnessFactor)?y+="    float roughness = clamp(u_roughnessFactor, 0.04, 1.0);\n":y+="    float roughness = 1.0;\n"),y+="    vec3 v = -normalize(v_positionEC);\n",y+="#ifndef USE_CUSTOM_LIGHT_COLOR \n",y+="    vec3 lightColorHdr = czm_lightColorHdr;\n",y+="#else \n",y+="    vec3 lightColorHdr = gltf_lightColor;\n",y+="#endif \n",y+="    vec3 l = normalize(czm_lightDirectionEC);\n",y+="    vec3 h = normalize(v + l);\n",y+="    float NdotL = clamp(dot(n, l), 0.001, 1.0);\n",y+="    float NdotV = abs(dot(n, v)) + 0.001;\n",y+="    float NdotH = clamp(dot(n, h), 0.0, 1.0);\n",y+="    float LdotH = clamp(dot(l, h), 0.0, 1.0);\n",y+="    float VdotH = clamp(dot(v, h), 0.0, 1.0);\n",y+="    vec3 f0 = vec3(0.04);\n",h?(y+="    float roughness = 1.0 - glossiness;\n",y+="    vec3 diffuseColor = diffuse.rgb * (1.0 - max(max(specular.r, specular.g), specular.b));\n",y+="    vec3 specularColor = specular;\n"):(y+="    vec3 diffuseColor = baseColor * (1.0 - metalness) * (1.0 - f0);\n",y+="    vec3 specularColor = mix(f0, baseColor, metalness);\n"),y+="    float alpha = roughness * roughness;\n",y+="    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n",y+="    vec3 r90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));\n",y+="    vec3 r0 = specularColor.rgb;\n",y+="    vec3 F = fresnelSchlick2(r0, r90, VdotH);\n",y+="    float G = smithVisibilityGGX(alpha, NdotL, NdotV);\n",y+="    float D = GGX(alpha, NdotH);\n",y+="    vec3 diffuseContribution = (1.0 - F) * lambertianDiffuse(diffuseColor);\n",y+="    vec3 specularContribution = F * G * D / (4.0 * NdotL * NdotV);\n",y+="    vec3 color = NdotL * lightColorHdr * (diffuseContribution + specularContribution);\n",y+="#if defined(USE_IBL_LIGHTING) && !defined(DIFFUSE_IBL) && !defined(SPECULAR_IBL) \n",y+="    vec3 r = normalize(czm_inverseViewRotation * normalize(reflect(v, n)));\n",y+="    float vertexRadius = length(positionWC);\n",y+="    float horizonDotNadir = 1.0 - min(1.0, czm_ellipsoidRadii.x / vertexRadius);\n",y+="    float reflectionDotNadir = dot(r, normalize(positionWC));\n",y+="    r.x = -r.x;\n",y+="    r = -normalize(czm_temeToPseudoFixed * r);\n",y+="    r.x = -r.x;\n",y+="    float inverseRoughness = 1.04 - roughness;\n",y+="    inverseRoughness *= inverseRoughness;\n",y+="    vec3 sceneSkyBox = textureCube(czm_environmentMap, r).rgb * inverseRoughness;\n",y+="    float atmosphereHeight = 0.05;\n",y+="    float blendRegionSize = 0.1 * ((1.0 - inverseRoughness) * 8.0 + 1.1 - horizonDotNadir);\n",y+="    float blendRegionOffset = roughness * -1.0;\n",y+="    float farAboveHorizon = clamp(horizonDotNadir - blendRegionSize * 0.5 + blendRegionOffset, 1.0e-10 - blendRegionSize, 0.99999);\n",y+="    float aroundHorizon = clamp(horizonDotNadir + blendRegionSize * 0.5, 1.0e-10 - blendRegionSize, 0.99999);\n",y+="    float farBelowHorizon = clamp(horizonDotNadir + blendRegionSize * 1.5, 1.0e-10 - blendRegionSize, 0.99999);\n",y+="    float smoothstepHeight = smoothstep(0.0, atmosphereHeight, horizonDotNadir);\n",y+="    vec3 belowHorizonColor = mix(vec3(0.1, 0.15, 0.25), vec3(0.4, 0.7, 0.9), smoothstepHeight);\n",y+="    vec3 nadirColor = belowHorizonColor * 0.5;\n",y+="    vec3 aboveHorizonColor = mix(vec3(0.9, 1.0, 1.2), belowHorizonColor, roughness * 0.5);\n",y+="    vec3 blueSkyColor = mix(vec3(0.18, 0.26, 0.48), aboveHorizonColor, reflectionDotNadir * inverseRoughness * 0.5 + 0.75);\n",y+="    vec3 zenithColor = mix(blueSkyColor, sceneSkyBox, smoothstepHeight);\n",y+="    vec3 blueSkyDiffuseColor = vec3(0.7, 0.85, 0.9);\n",y+="    float diffuseIrradianceFromEarth = (1.0 - horizonDotNadir) * (reflectionDotNadir * 0.25 + 0.75) * smoothstepHeight;\n",y+="    float diffuseIrradianceFromSky = (1.0 - smoothstepHeight) * (1.0 - (reflectionDotNadir * 0.25 + 0.25));\n",y+="    vec3 diffuseIrradiance = blueSkyDiffuseColor * clamp(diffuseIrradianceFromEarth + diffuseIrradianceFromSky, 0.0, 1.0);\n",y+="    float notDistantRough = (1.0 - horizonDotNadir * roughness * 0.8);\n",y+="    vec3 specularIrradiance = mix(zenithColor, aboveHorizonColor, smoothstep(farAboveHorizon, aroundHorizon, reflectionDotNadir) * notDistantRough);\n",y+="    specularIrradiance = mix(specularIrradiance, belowHorizonColor, smoothstep(aroundHorizon, farBelowHorizon, reflectionDotNadir) * inverseRoughness);\n",y+="    specularIrradiance = mix(specularIrradiance, nadirColor, smoothstep(farBelowHorizon, 1.0, reflectionDotNadir) * inverseRoughness);\n",y+="#ifdef USE_SUN_LUMINANCE \n",y+="    float LdotZenith = clamp(dot(normalize(czm_inverseViewRotation * l), normalize(positionWC * -1.0)), 0.001, 1.0);\n",y+="    float S = acos(LdotZenith);\n",y+="    float NdotZenith = clamp(dot(normalize(czm_inverseViewRotation * n), normalize(positionWC * -1.0)), 0.001, 1.0);\n",y+="    float gamma = acos(NdotL);\n",y+="    float numerator = ((0.91 + 10.0 * exp(-3.0 * gamma) + 0.45 * pow(NdotL, 2.0)) * (1.0 - exp(-0.32 / NdotZenith)));\n",y+="    float denominator = (0.91 + 10.0 * exp(-3.0 * S) + 0.45 * pow(LdotZenith,2.0)) * (1.0 - exp(-0.32));\n",y+="    float luminance = gltf_luminanceAtZenith * (numerator / denominator);\n",y+="#endif \n",y+="    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;\n",y+="    vec3 IBLColor = (diffuseIrradiance * diffuseColor * gltf_iblFactor.x) + (specularIrradiance * SRGBtoLINEAR3(specularColor * brdfLut.x + brdfLut.y) * gltf_iblFactor.y);\n",y+="    float maximumComponent = max(max(lightColorHdr.x, lightColorHdr.y), lightColorHdr.z);\n",y+="    vec3 lightColor = lightColorHdr / max(maximumComponent, 1.0);\n",y+="    IBLColor *= lightColor;\n",y+="#ifdef USE_SUN_LUMINANCE \n",y+="    color += IBLColor * luminance;\n",y+="#else \n",y+="    color += IBLColor; \n",y+="#endif \n",y+="#elif defined(DIFFUSE_IBL) || defined(SPECULAR_IBL) \n",y+="    const mat3 yUpToZUp = mat3(-1.0, 0.0, 0.0, 0.0, 0.0, -1.0, 0.0, 1.0, 0.0); \n",y+="    vec3 cubeDir = normalize(yUpToZUp * gltf_iblReferenceFrameMatrix * normalize(reflect(-v, n))); \n",y+="#ifdef DIFFUSE_IBL \n",y+="#ifdef CUSTOM_SPHERICAL_HARMONICS \n",y+="    vec3 diffuseIrradiance = czm_sphericalHarmonics(cubeDir, gltf_sphericalHarmonicCoefficients); \n",y+="#else \n",y+="    vec3 diffuseIrradiance = czm_sphericalHarmonics(cubeDir, czm_sphericalHarmonicCoefficients); \n",y+="#endif \n",y+="#else \n",y+="    vec3 diffuseIrradiance = vec3(0.0); \n",y+="#endif \n",y+="#ifdef SPECULAR_IBL \n",y+="    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;\n",y+="#ifdef CUSTOM_SPECULAR_IBL \n",y+="    vec3 specularIBL = czm_sampleOctahedralProjection(gltf_specularMap, gltf_specularMapSize, cubeDir,  roughness * gltf_maxSpecularLOD, gltf_maxSpecularLOD);\n",y+="#else \n",y+="    vec3 specularIBL = czm_sampleOctahedralProjection(czm_specularEnvironmentMaps, czm_specularEnvironmentMapSize, cubeDir,  roughness * czm_specularEnvironmentMapsMaximumLOD, czm_specularEnvironmentMapsMaximumLOD);\n",y+="#endif \n",y+="    specularIBL *= F * brdfLut.x + brdfLut.y;\n",y+="#else \n",y+="    vec3 specularIBL = vec3(0.0); \n",y+="#endif \n",y+="    color += diffuseIrradiance * diffuseColor + specularColor * specularIBL;\n",y+="#endif \n"):y+="    vec3 color = baseColor;\n",M||(C(i.u_occlusionTexture)&&(y+=`    color *= texture2D(u_occlusionTexture, ${j}).r;\n`),C(i.u_emissiveTexture)?(y+=`    vec3 emissive = SRGBtoLINEAR3(texture2D(u_emissiveTexture, ${Y}).rgb);\n`,C(i.u_emissiveFactor)&&(y+="    emissive *= u_emissiveFactor;\n"),y+="    color += emissive;\n"):C(i.u_emissiveFactor)&&(y+="    color += u_emissiveFactor;\n")),M||(y+="    color = applyTonemapping(color);\n"),y+="    color = LINEARtoSRGB(color);\n",L&&(y+="    float outlineness = max(\n",y+="        texture2D(u_outlineTexture, vec2(v_outlineCoordinates.x, 0.5)).r,\n",y+="        max(\n",y+="          texture2D(u_outlineTexture, vec2(v_outlineCoordinates.y, 0.5)).r,\n",y+="          texture2D(u_outlineTexture, vec2(v_outlineCoordinates.z, 0.5)).r));\n",y+="    color = mix(color, vec3(0.0, 0.0, 0.0), outlineness);\n"),C(N)?"MASK"===N?(y+="    if (baseColorWithAlpha.a < u_alphaCutoff) {\n",y+="        discard;\n",y+="    }\n",y+="    gl_FragColor = vec4(color, 1.0);\n"):y+="BLEND"===N?"    gl_FragColor = vec4(color, baseColorWithAlpha.a);\n":"    gl_FragColor = vec4(color, 1.0);\n":y+="    gl_FragColor = vec4(color, 1.0);\n",y+="}\n";const X=gZ(l,{type:th.VERTEX_SHADER,extras:{_pipeline:{source:g,extension:".glsl"}}}),Q=gZ(l,{type:th.FRAGMENT_SHADER,extras:{_pipeline:{source:y,extension:".glsl"}}}),J=gZ(u,{fragmentShader:Q,vertexShader:X}),Z=gZ(c,{attributes:k,program:J,uniforms:B});return Z}function Y0(e){if(-1!==e.indexOf("Offset"))return th.FLOAT_VEC2;if(-1!==e.indexOf("Rotation"))return th.FLOAT;if(-1!==e.indexOf("Scale"))return th.FLOAT_VEC2;if(-1!==e.indexOf("Texture"))return th.SAMPLER_2D;switch(e){case"u_baseColorFactor":return th.FLOAT_VEC4;case"u_metallicFactor":return th.FLOAT;case"u_roughnessFactor":return th.FLOAT;case"u_emissiveFactor":return th.FLOAT_VEC3;case"u_diffuseFactor":return th.FLOAT_VEC4;case"u_specularFactor":return th.FLOAT_VEC3;case"u_glossinessFactor":return th.FLOAT}}var K0=k0;function X0(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}var Q0=X0,J0="attribute vec3 position;\nattribute float a_batchId;\n\nuniform mat4 u_modifiedModelViewProjection;\n\nvoid main()\n{\n    gl_Position = czm_depthClamp(u_modifiedModelViewProjection * vec4(position, 1.0));\n}\n",Z0=(0,on.c)((function(e,t){(function(n){var i="Compound",o="Identifier",r="MemberExpression",s="Literal",a="ThisExpression",c="CallExpression",l="UnaryExpression",u="BinaryExpression",h="LogicalExpression",d="ConditionalExpression",f="ArrayExpression",p=46,m=44,_=39,g=34,y=40,v=41,b=91,A=93,w=63,T=59,C=58,E=function(e,t){var n=new Error(e+" at character "+t);throw n.index=t,n.description=e,n},x=!0,S={"-":x,"!":x,"~":x,"+":x},I={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},O=function(e){var t,n=0;for(var i in e)(t=i.length)>n&&e.hasOwnProperty(i)&&(n=t);return n},D=O(S),P=O(I),R={true:!0,false:!1,null:null},L="this",M=function(e){return I[e]||0},B=function(e,t,n){var i="||"===e||"&&"===e?h:u;return{type:i,operator:e,left:t,right:n}},N=function(e){return e>=48&&e<=57},F=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=128&&!I[String.fromCharCode(e)]},z=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e>=128&&!I[String.fromCharCode(e)]},k=function(e){var t,n,u=0,h=e.charAt,x=e.charCodeAt,O=function(t){return h.call(e,t)},k=function(t){return x.call(e,t)},U=e.length,V=function(){var e=k(u);while(32===e||9===e||10===e||13===e)e=k(++u)},H=function(){var e,t,n=W();return V(),k(u)!==w?n:(u++,e=H(),e||E("Expected expression",u),V(),k(u)===C?(u++,t=H(),t||E("Expected expression",u),{type:d,test:n,consequent:e,alternate:t}):void E("Expected :",u))},G=function(){V();var t=e.substr(u,P),n=t.length;while(n>0){if(I.hasOwnProperty(t)&&(!F(k(u))||u+t.length<e.length&&!z(k(u+t.length))))return u+=n,t;t=t.substr(0,--n)}return!1},W=function(){var e,t,n,i,o,r,s,a,c;if(r=q(),t=G(),!t)return r;o={value:t,prec:M(t)},s=q(),s||E("Expected expression after "+t,u),i=[r,o,s];while(t=G()){if(n=M(t),0===n)break;o={value:t,prec:n},c=t;while(i.length>2&&n<=i[i.length-2].prec)s=i.pop(),t=i.pop().value,r=i.pop(),e=B(t,r,s),i.push(e);e=q(),e||E("Expected expression after "+c,u),i.push(o,e)}a=i.length-1,e=i[a];while(a>1)e=B(i[a-1].value,i[a-2],e),a-=2;return e},q=function(){var t,n,i;if(V(),t=k(u),N(t)||t===p)return j();if(t===_||t===g)return Y();if(t===b)return Z();n=e.substr(u,D),i=n.length;while(i>0){if(S.hasOwnProperty(n)&&(!F(k(u))||u+n.length<e.length&&!z(k(u+n.length))))return u+=i,{type:l,operator:n,argument:q(),prefix:!0};n=n.substr(0,--i)}return!(!F(t)&&t!==y)&&Q()},j=function(){var e,t,n="";while(N(k(u)))n+=O(u++);if(k(u)===p){n+=O(u++);while(N(k(u)))n+=O(u++)}if(e=O(u),"e"===e||"E"===e){n+=O(u++),e=O(u),"+"!==e&&"-"!==e||(n+=O(u++));while(N(k(u)))n+=O(u++);N(k(u-1))||E("Expected exponent ("+n+O(u)+")",u)}return t=k(u),F(t)?E("Variable names cannot start with a number ("+n+O(u)+")",u):t===p&&E("Unexpected period",u),{type:s,value:parseFloat(n),raw:n}},Y=function(){var e,t="",n=O(u++),i=!1;while(u<U){if(e=O(u++),e===n){i=!0;break}if("\\"===e)switch(e=O(u++),e){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return i||E('Unclosed quote after "'+t+'"',u),{type:s,value:t,raw:n+t+n}},K=function(){var t,n=k(u),i=u;F(n)?u++:E("Unexpected "+O(u),u);while(u<U){if(n=k(u),!z(n))break;u++}return t=e.slice(i,u),R.hasOwnProperty(t)?{type:s,value:R[t],raw:t}:t===L?{type:a}:{type:o,name:t}},X=function(e){var t,n,o=[],r=!1,s=0;while(u<U){if(V(),t=k(u),t===e){r=!0,u++,e===v&&s&&s>=o.length&&E("Unexpected token "+String.fromCharCode(e),u);break}if(t===m){if(u++,s++,s!==o.length)if(e===v)E("Unexpected token ,",u);else if(e===A)for(var a=o.length;a<s;a++)o.push(null)}else n=H(),n&&n.type!==i||E("Expected comma",u),o.push(n)}return r||E("Expected "+String.fromCharCode(e),u),o},Q=function(){var e,t;e=k(u),t=e===y?J():K(),V(),e=k(u);while(e===p||e===b||e===y)u++,e===p?(V(),t={type:r,computed:!1,object:t,property:K()}):e===b?(t={type:r,computed:!0,object:t,property:H()},V(),e=k(u),e!==A&&E("Unclosed [",u),u++):e===y&&(t={type:c,arguments:X(v),callee:t}),V(),e=k(u);return t},J=function(){u++;var e=H();if(V(),k(u)===v)return u++,e;E("Unclosed (",u)},Z=function(){return u++,{type:f,elements:X(A)}},$=[];while(u<U)t=k(u),t===T||t===m?u++:(n=H())?$.push(n):u<U&&E('Unexpected "'+O(u)+'"',u);return 1===$.length?$[0]:{type:i,body:$}};k.version="0.3.5",k.toString=function(){return"JavaScript Expression Parser (JSEP) v"+k.version},k.addUnaryOp=function(e){return D=Math.max(e.length,D),S[e]=x,this},k.addBinaryOp=function(e,t){return P=Math.max(e.length,P),I[e]=t,this},k.addLiteral=function(e,t){return R[e]=t,this},k.removeUnaryOp=function(e){return delete S[e],e.length===D&&(D=O(S)),this},k.removeAllUnaryOps=function(){return S={},D=0,this},k.removeBinaryOp=function(e){return delete I[e],e.length===P&&(P=O(I)),this},k.removeAllBinaryOps=function(){return I={},P=0,this},k.removeLiteral=function(e){return delete R[e],this},k.removeAllLiterals=function(){return R={},this},e.exports?t=e.exports=k:t.parse=k})()}));const $0={VARIABLE:0,UNARY:1,BINARY:2,TERNARY:3,CONDITIONAL:4,MEMBER:5,FUNCTION_CALL:6,ARRAY:7,REGEX:8,VARIABLE_IN_STRING:9,LITERAL_NULL:10,LITERAL_BOOLEAN:11,LITERAL_NUMBER:12,LITERAL_STRING:13,LITERAL_COLOR:14,LITERAL_VECTOR:15,LITERAL_REGEX:16,LITERAL_UNDEFINED:17,BUILTIN_VARIABLE:18};var e1=Object.freeze($0);function t1(e,t){let n;D.typeOf.string("expression",e),this._expression=e,e=E1(e,t),e=I1(x1(e)),Z0.addBinaryOp("=~",0),Z0.addBinaryOp("!~",0);try{n=Z0(e)}catch(i){throw new Je(i)}this._runtimeAst=k1(this,n)}Object.defineProperties(t1.prototype,{expression:{get:function(){return this._expression}}});const n1={arrayIndex:0,arrayArray:[[]],cartesian2Index:0,cartesian3Index:0,cartesian4Index:0,cartesian2Array:[new ro],cartesian3Array:[new K],cartesian4Array:[new Xe],reset:function(){this.arrayIndex=0,this.cartesian2Index=0,this.cartesian3Index=0,this.cartesian4Index=0},getArray:function(){this.arrayIndex>=this.arrayArray.length&&this.arrayArray.push([]);const e=this.arrayArray[this.arrayIndex++];return e.length=0,e},getCartesian2:function(){return this.cartesian2Index>=this.cartesian2Array.length&&this.cartesian2Array.push(new ro),this.cartesian2Array[this.cartesian2Index++]},getCartesian3:function(){return this.cartesian3Index>=this.cartesian3Array.length&&this.cartesian3Array.push(new K),this.cartesian3Array[this.cartesian3Index++]},getCartesian4:function(){return this.cartesian4Index>=this.cartesian4Array.length&&this.cartesian4Array.push(new Xe),this.cartesian4Array[this.cartesian4Index++]}};t1.prototype.evaluate=function(e,t){n1.reset();const n=this._runtimeAst.evaluate(e);return t instanceof xy&&n instanceof Xe?xy.fromCartesian4(n,t):n instanceof ro||n instanceof K||n instanceof Xe?n.clone(t):n},t1.prototype.evaluateColor=function(e,t){n1.reset();const n=this._runtimeAst.evaluate(e);return xy.fromCartesian4(n,t)},t1.prototype.getShaderFunction=function(e,t,n,i){let o=this.getShaderExpression(t,n);return o=`${i} ${e}\n{\n    return ${o};\n}\n`,o},t1.prototype.getShaderExpression=function(e,t){return this._runtimeAst.getShaderExpression(e,t)},t1.prototype.getVariables=function(){let e=[];return this._runtimeAst.getVariables(e),e=e.filter((function(e,t,n){return n.indexOf(e)===t})),e};const i1=["!","-","+"],o1=["+","-","*","/","%","===","!==",">",">=","<","<=","&&","||","!~","=~"],r1=/\${(.*?)}/g,s1=/\\/g,a1="@#%",c1=/@#%/g,l1=new xy,u1={abs:_1(Math.abs),sqrt:_1(Math.sqrt),cos:_1(Math.cos),sin:_1(Math.sin),tan:_1(Math.tan),acos:_1(Math.acos),asin:_1(Math.asin),atan:_1(Math.atan),radians:_1(z.toRadians),degrees:_1(z.toDegrees),sign:_1(z.sign),floor:_1(Math.floor),ceil:_1(Math.ceil),round:_1(Math.round),exp:_1(Math.exp),exp2:_1(p1),log:_1(Math.log),log2:_1(m1),fract:_1(f1),length:v1,normalize:b1},h1={atan2:g1(Math.atan2,!1),pow:g1(Math.pow,!1),min:g1(Math.min,!0),max:g1(Math.max,!0),distance:A1,dot:w1,cross:T1},d1={clamp:y1(z.clamp,!0),mix:y1(z.lerp,!0)};function f1(e){return e-Math.floor(e)}function p1(e){return Math.pow(2,e)}function m1(e){return z.log2(e)}function _1(e){return function(t,n){if("number"===typeof n)return e(n);if(n instanceof ro)return ro.fromElements(e(n.x),e(n.y),n1.getCartesian2());if(n instanceof K)return K.fromElements(e(n.x),e(n.y),e(n.z),n1.getCartesian3());if(n instanceof Xe)return Xe.fromElements(e(n.x),e(n.y),e(n.z),e(n.w),n1.getCartesian4());throw new Je(`Function "${t}" requires a vector or number argument. Argument is ${n}.`)}}function g1(e,t){return function(n,i,o){if(t&&"number"===typeof o){if("number"===typeof i)return e(i,o);if(i instanceof ro)return ro.fromElements(e(i.x,o),e(i.y,o),n1.getCartesian2());if(i instanceof K)return K.fromElements(e(i.x,o),e(i.y,o),e(i.z,o),n1.getCartesian3());if(i instanceof Xe)return Xe.fromElements(e(i.x,o),e(i.y,o),e(i.z,o),e(i.w,o),n1.getCartesian4())}if("number"===typeof i&&"number"===typeof o)return e(i,o);if(i instanceof ro&&o instanceof ro)return ro.fromElements(e(i.x,o.x),e(i.y,o.y),n1.getCartesian2());if(i instanceof K&&o instanceof K)return K.fromElements(e(i.x,o.x),e(i.y,o.y),e(i.z,o.z),n1.getCartesian3());if(i instanceof Xe&&o instanceof Xe)return Xe.fromElements(e(i.x,o.x),e(i.y,o.y),e(i.z,o.z),e(i.w,o.w),n1.getCartesian4());throw new Je(`Function "${n}" requires vector or number arguments of matching types. Arguments are ${i} and ${o}.`)}}function y1(e,t){return function(n,i,o,r){if(t&&"number"===typeof r){if("number"===typeof i&&"number"===typeof o)return e(i,o,r);if(i instanceof ro&&o instanceof ro)return ro.fromElements(e(i.x,o.x,r),e(i.y,o.y,r),n1.getCartesian2());if(i instanceof K&&o instanceof K)return K.fromElements(e(i.x,o.x,r),e(i.y,o.y,r),e(i.z,o.z,r),n1.getCartesian3());if(i instanceof Xe&&o instanceof Xe)return Xe.fromElements(e(i.x,o.x,r),e(i.y,o.y,r),e(i.z,o.z,r),e(i.w,o.w,r),n1.getCartesian4())}if("number"===typeof i&&"number"===typeof o&&"number"===typeof r)return e(i,o,r);if(i instanceof ro&&o instanceof ro&&r instanceof ro)return ro.fromElements(e(i.x,o.x,r.x),e(i.y,o.y,r.y),n1.getCartesian2());if(i instanceof K&&o instanceof K&&r instanceof K)return K.fromElements(e(i.x,o.x,r.x),e(i.y,o.y,r.y),e(i.z,o.z,r.z),n1.getCartesian3());if(i instanceof Xe&&o instanceof Xe&&r instanceof Xe)return Xe.fromElements(e(i.x,o.x,r.x),e(i.y,o.y,r.y),e(i.z,o.z,r.z),e(i.w,o.w,r.w),n1.getCartesian4());throw new Je(`Function "${n}" requires vector or number arguments of matching types. Arguments are ${i}, ${o}, and ${r}.`)}}function v1(e,t){if("number"===typeof t)return Math.abs(t);if(t instanceof ro)return ro.magnitude(t);if(t instanceof K)return K.magnitude(t);if(t instanceof Xe)return Xe.magnitude(t);throw new Je(`Function "${e}" requires a vector or number argument. Argument is ${t}.`)}function b1(e,t){if("number"===typeof t)return 1;if(t instanceof ro)return ro.normalize(t,n1.getCartesian2());if(t instanceof K)return K.normalize(t,n1.getCartesian3());if(t instanceof Xe)return Xe.normalize(t,n1.getCartesian4());throw new Je(`Function "${e}" requires a vector or number argument. Argument is ${t}.`)}function A1(e,t,n){if("number"===typeof t&&"number"===typeof n)return Math.abs(t-n);if(t instanceof ro&&n instanceof ro)return ro.distance(t,n);if(t instanceof K&&n instanceof K)return K.distance(t,n);if(t instanceof Xe&&n instanceof Xe)return Xe.distance(t,n);throw new Je(`Function "${e}" requires vector or number arguments of matching types. Arguments are ${t} and ${n}.`)}function w1(e,t,n){if("number"===typeof t&&"number"===typeof n)return t*n;if(t instanceof ro&&n instanceof ro)return ro.dot(t,n);if(t instanceof K&&n instanceof K)return K.dot(t,n);if(t instanceof Xe&&n instanceof Xe)return Xe.dot(t,n);throw new Je(`Function "${e}" requires vector or number arguments of matching types. Arguments are ${t} and ${n}.`)}function T1(e,t,n){if(t instanceof K&&n instanceof K)return K.cross(t,n,n1.getCartesian3());throw new Je(`Function "${e}" requires vec3 arguments. Arguments are ${t} and ${n}.`)}function C1(e,t,n,i,o){this._type=e,this._value=t,this._left=n,this._right=i,this._test=o,this.evaluate=void 0,U1(this)}function E1(e,t){if(!C(t))return e;for(const n in t)if(t.hasOwnProperty(n)){const i=new RegExp(`\\$\\{${n}\\}`,"g"),o=`(${t[n]})`;C(o)&&(e=e.replace(i,o))}return e}function x1(e){return e.replace(s1,a1)}function S1(e){return e.replace(c1,"\\")}function I1(e){let t=e,n="",i=t.indexOf("${");while(i>=0){const e=t.indexOf("'"),o=t.indexOf('"');let r;if(e>=0&&e<i)r=t.indexOf("'",e+1),n+=t.substr(0,r+1),t=t.substr(r+1),i=t.indexOf("${");else if(o>=0&&o<i)r=t.indexOf('"',o+1),n+=t.substr(0,r+1),t=t.substr(r+1),i=t.indexOf("${");else{n+=t.substr(0,i);const e=t.indexOf("}");if(e<0)throw new Je("Unmatched {.");n+=`czm_${t.substr(i+2,e-(i+2))}`,t=t.substr(e+1),i=t.indexOf("${")}}return n+=t,n}function O1(e){const t=typeof e.value;return null===e.value?new C1(e1.LITERAL_NULL,null):"boolean"===t?new C1(e1.LITERAL_BOOLEAN,e.value):"number"===t?new C1(e1.LITERAL_NUMBER,e.value):"string"===t?e.value.indexOf("${")>=0?new C1(e1.VARIABLE_IN_STRING,e.value):new C1(e1.LITERAL_STRING,S1(e.value)):void 0}function D1(e,t){const n=t.arguments,i=n.length;let o,r,s,a;if("MemberExpression"===t.callee.type){o=t.callee.property.name;const c=t.callee.object;if("test"===o||"exec"===o){if("regExp"!==c.callee.name)throw new Je(`${o} is not a function.`);return 0===i?"test"===o?new C1(e1.LITERAL_BOOLEAN,!1):new C1(e1.LITERAL_NULL,null):(s=k1(e,c),a=k1(e,n[0]),new C1(e1.FUNCTION_CALL,o,s,a))}if("toString"===o)return r=k1(e,c),new C1(e1.FUNCTION_CALL,o,r);throw new Je(`Unexpected function call "${o}".`)}if(o=t.callee.name,"color"===o){if(0===i)return new C1(e1.LITERAL_COLOR,o);if(r=k1(e,n[0]),C(n[1])){const t=k1(e,n[1]);return new C1(e1.LITERAL_COLOR,o,[r,t])}return new C1(e1.LITERAL_COLOR,o,[r])}if("rgb"===o||"hsl"===o){if(i<3)throw new Je(`${o} requires three arguments.`);return r=[k1(e,n[0]),k1(e,n[1]),k1(e,n[2])],new C1(e1.LITERAL_COLOR,o,r)}if("rgba"===o||"hsla"===o){if(i<4)throw new Je(`${o} requires four arguments.`);return r=[k1(e,n[0]),k1(e,n[1]),k1(e,n[2]),k1(e,n[3])],new C1(e1.LITERAL_COLOR,o,r)}if("vec2"===o||"vec3"===o||"vec4"===o){r=new Array(i);for(let t=0;t<i;++t)r[t]=k1(e,n[t]);return new C1(e1.LITERAL_VECTOR,o,r)}if("isNaN"===o||"isFinite"===o)return 0===i?new C1(e1.LITERAL_BOOLEAN,"isNaN"===o):(r=k1(e,n[0]),new C1(e1.UNARY,o,r));if("isExactClass"===o||"isClass"===o){if(i<1||i>1)throw new Je(`${o} requires exactly one argument.`);return r=k1(e,n[0]),new C1(e1.UNARY,o,r)}if("getExactClassName"===o){if(i>0)throw new Je(`${o} does not take any argument.`);return new C1(e1.UNARY,o)}if(C(u1[o])){if(1!==i)throw new Je(`${o} requires exactly one argument.`);return r=k1(e,n[0]),new C1(e1.UNARY,o,r)}if(C(h1[o])){if(2!==i)throw new Je(`${o} requires exactly two arguments.`);return s=k1(e,n[0]),a=k1(e,n[1]),new C1(e1.BINARY,o,s,a)}if(C(d1[o])){if(3!==i)throw new Je(`${o} requires exactly three arguments.`);s=k1(e,n[0]),a=k1(e,n[1]);const t=k1(e,n[2]);return new C1(e1.TERNARY,o,s,a,t)}if("Boolean"===o)return 0===i?new C1(e1.LITERAL_BOOLEAN,!1):(r=k1(e,n[0]),new C1(e1.UNARY,o,r));if("Number"===o)return 0===i?new C1(e1.LITERAL_NUMBER,0):(r=k1(e,n[0]),new C1(e1.UNARY,o,r));if("String"===o)return 0===i?new C1(e1.LITERAL_STRING,""):(r=k1(e,n[0]),new C1(e1.UNARY,o,r));if("regExp"===o)return P1(e,t);throw new Je(`Unexpected function call "${o}".`)}function P1(e,t){const n=t.arguments;if(0===n.length)return new C1(e1.LITERAL_REGEX,new RegExp);const i=k1(e,n[0]);let o;if(n.length>1){const t=k1(e,n[1]);if(N1(i)&&N1(t)){try{o=new RegExp(S1(String(i._value)),t._value)}catch(r){throw new Je(r)}return new C1(e1.LITERAL_REGEX,o)}return new C1(e1.REGEX,i,t)}if(N1(i)){try{o=new RegExp(S1(String(i._value)))}catch(r){throw new Je(r)}return new C1(e1.LITERAL_REGEX,o)}return new C1(e1.REGEX,i)}function R1(e){if(F1(e.name)){const t=z1(e.name);return"tiles3d_"===t.substr(0,8)?new C1(e1.BUILTIN_VARIABLE,t):new C1(e1.VARIABLE,t)}if("NaN"===e.name)return new C1(e1.LITERAL_NUMBER,NaN);if("Infinity"===e.name)return new C1(e1.LITERAL_NUMBER,1/0);if("undefined"===e.name)return new C1(e1.LITERAL_UNDEFINED,void 0);throw new Je(`${e.name} is not defined.`)}function L1(e){const t=e.property.name;return"PI"===t?new C1(e1.LITERAL_NUMBER,Math.PI):"E"===t?new C1(e1.LITERAL_NUMBER,Math.E):void 0}function M1(e){const t=e.property.name;if("POSITIVE_INFINITY"===t)return new C1(e1.LITERAL_NUMBER,Number.POSITIVE_INFINITY)}function B1(e,t){if("Math"===t.object.name)return L1(t);if("Number"===t.object.name)return M1(t);let n;const i=k1(e,t.object);return t.computed?(n=k1(e,t.property),new C1(e1.MEMBER,"brackets",i,n)):(n=new C1(e1.LITERAL_STRING,t.property.name),new C1(e1.MEMBER,"dot",i,n))}function N1(e){return e._type>=e1.LITERAL_NULL}function F1(e){return"czm_"===e.substr(0,4)}function z1(e){return e.substr(4)}function k1(e,t){let n,i,o,r;if("Literal"===t.type)n=O1(t);else if("CallExpression"===t.type)n=D1(e,t);else if("Identifier"===t.type)n=R1(t);else if("UnaryExpression"===t.type){i=t.operator;const o=k1(e,t.argument);if(!(i1.indexOf(i)>-1))throw new Je(`Unexpected operator "${i}".`);n=new C1(e1.UNARY,i,o)}else if("BinaryExpression"===t.type){if(i=t.operator,o=k1(e,t.left),r=k1(e,t.right),!(o1.indexOf(i)>-1))throw new Je(`Unexpected operator "${i}".`);n=new C1(e1.BINARY,i,o,r)}else if("LogicalExpression"===t.type)i=t.operator,o=k1(e,t.left),r=k1(e,t.right),o1.indexOf(i)>-1&&(n=new C1(e1.BINARY,i,o,r));else if("ConditionalExpression"===t.type){const i=k1(e,t.test);o=k1(e,t.consequent),r=k1(e,t.alternate),n=new C1(e1.CONDITIONAL,"?",o,r,i)}else if("MemberExpression"===t.type)n=B1(e,t);else{if("ArrayExpression"!==t.type)throw"Compound"===t.type?new Je("Provide exactly one expression."):new Je("Cannot parse expression.");{const i=[];for(let n=0;n<t.elements.length;n++)i[n]=k1(e,t.elements[n]);n=new C1(e1.ARRAY,i)}}return n}function U1(e){e._type===e1.CONDITIONAL?e.evaluate=e._evaluateConditional:e._type===e1.FUNCTION_CALL?"test"===e._value?e.evaluate=e._evaluateRegExpTest:"exec"===e._value?e.evaluate=e._evaluateRegExpExec:"toString"===e._value&&(e.evaluate=e._evaluateToString):e._type===e1.UNARY?"!"===e._value?e.evaluate=e._evaluateNot:"-"===e._value?e.evaluate=e._evaluateNegative:"+"===e._value?e.evaluate=e._evaluatePositive:"isNaN"===e._value?e.evaluate=e._evaluateNaN:"isFinite"===e._value?e.evaluate=e._evaluateIsFinite:"isExactClass"===e._value?e.evaluate=e._evaluateIsExactClass:"isClass"===e._value?e.evaluate=e._evaluateIsClass:"getExactClassName"===e._value?e.evaluate=e._evaluateGetExactClassName:"Boolean"===e._value?e.evaluate=e._evaluateBooleanConversion:"Number"===e._value?e.evaluate=e._evaluateNumberConversion:"String"===e._value?e.evaluate=e._evaluateStringConversion:C(u1[e._value])&&(e.evaluate=H1(e._value)):e._type===e1.BINARY?"+"===e._value?e.evaluate=e._evaluatePlus:"-"===e._value?e.evaluate=e._evaluateMinus:"*"===e._value?e.evaluate=e._evaluateTimes:"/"===e._value?e.evaluate=e._evaluateDivide:"%"===e._value?e.evaluate=e._evaluateMod:"==="===e._value?e.evaluate=e._evaluateEqualsStrict:"!=="===e._value?e.evaluate=e._evaluateNotEqualsStrict:"<"===e._value?e.evaluate=e._evaluateLessThan:"<="===e._value?e.evaluate=e._evaluateLessThanOrEquals:">"===e._value?e.evaluate=e._evaluateGreaterThan:">="===e._value?e.evaluate=e._evaluateGreaterThanOrEquals:"&&"===e._value?e.evaluate=e._evaluateAnd:"||"===e._value?e.evaluate=e._evaluateOr:"=~"===e._value?e.evaluate=e._evaluateRegExpMatch:"!~"===e._value?e.evaluate=e._evaluateRegExpNotMatch:C(h1[e._value])&&(e.evaluate=G1(e._value)):e._type===e1.TERNARY?e.evaluate=W1(e._value):e._type===e1.MEMBER?"brackets"===e._value?e.evaluate=e._evaluateMemberBrackets:e.evaluate=e._evaluateMemberDot:e._type===e1.ARRAY?e.evaluate=e._evaluateArray:e._type===e1.VARIABLE?e.evaluate=e._evaluateVariable:e._type===e1.VARIABLE_IN_STRING?e.evaluate=e._evaluateVariableString:e._type===e1.LITERAL_COLOR?e.evaluate=e._evaluateLiteralColor:e._type===e1.LITERAL_VECTOR?e.evaluate=e._evaluateLiteralVector:e._type===e1.LITERAL_STRING?e.evaluate=e._evaluateLiteralString:e._type===e1.REGEX?e.evaluate=e._evaluateRegExp:e._type===e1.BUILTIN_VARIABLE?"tiles3d_tileset_time"===e._value&&(e.evaluate=V1):e.evaluate=e._evaluateLiteral}function V1(e){return C(e)?e.content.tileset.timeSinceLoad:0}function H1(e){const t=u1[e];return function(n){const i=this._left.evaluate(n);return t(e,i)}}function G1(e){const t=h1[e];return function(n){const i=this._left.evaluate(n),o=this._right.evaluate(n);return t(e,i,o)}}function W1(e){const t=d1[e];return function(n){const i=this._left.evaluate(n),o=this._right.evaluate(n),r=this._test.evaluate(n);return t(e,i,o,r)}}function q1(e,t){if(C(e))return e.getPropertyInherited(t)}function j1(e){return"feature"===e._value}function Y1(e){const t=e._left,n=t.length;for(let a=0;a<n;++a)if(t[a]._type!==e1.LITERAL_NUMBER)return;const i=t[0]._value,o=t[1]._value,r=t[2]._value,s=4===n?t[3]._value:1;return xy.fromHsl(i,o,r,s,l1)}function K1(e){const t=e._left,n=t.length;for(let o=0;o<n;++o)if(t[o]._type!==e1.LITERAL_NUMBER)return;const i=l1;return i.red=t[0]._value/255,i.green=t[1]._value/255,i.blue=t[2]._value/255,i.alpha=4===n?t[3]._value:1,i}function X1(e){return e%1===0?e.toFixed(1):e.toString()}function Q1(e){const t=X1(e.red),n=X1(e.green),i=X1(e.blue);return`vec3(${t}, ${n}, ${i})`}function J1(e){const t=X1(e.red),n=X1(e.green),i=X1(e.blue),o=X1(e.alpha);return`vec4(${t}, ${n}, ${i}, ${o})`}function Z1(e,t,n,i){const o=e.length,r=new Array(o);for(let s=0;s<o;++s)r[s]=e[s].getShaderExpression(t,n,i);return r}function $1(e,t){return C(t[e])?t[e]:t1.NULL_SENTINEL}C1.prototype._evaluateLiteral=function(){return this._value},C1.prototype._evaluateLiteralColor=function(e){const t=l1,n=this._left;if("color"===this._value)C(n)?n.length>1?(xy.fromCssColorString(n[0].evaluate(e),t),t.alpha=n[1].evaluate(e)):xy.fromCssColorString(n[0].evaluate(e),t):xy.fromBytes(255,255,255,255,t);else if("rgb"===this._value)xy.fromBytes(n[0].evaluate(e),n[1].evaluate(e),n[2].evaluate(e),255,t);else if("rgba"===this._value){const i=255*n[3].evaluate(e);xy.fromBytes(n[0].evaluate(e),n[1].evaluate(e),n[2].evaluate(e),i,t)}else"hsl"===this._value?xy.fromHsl(n[0].evaluate(e),n[1].evaluate(e),n[2].evaluate(e),1,t):"hsla"===this._value&&xy.fromHsl(n[0].evaluate(e),n[1].evaluate(e),n[2].evaluate(e),n[3].evaluate(e),t);return Xe.fromColor(t,n1.getCartesian4())},C1.prototype._evaluateLiteralVector=function(e){const t=n1.getArray(),n=this._value,i=this._left,o=i.length;for(let a=0;a<o;++a){const o=i[a].evaluate(e);if("number"===typeof o)t.push(o);else if(o instanceof ro)t.push(o.x,o.y);else if(o instanceof K)t.push(o.x,o.y,o.z);else{if(!(o instanceof Xe))throw new Je(`${n} argument must be a vector or number. Argument is ${o}.`);t.push(o.x,o.y,o.z,o.w)}}const r=t.length,s=parseInt(n.charAt(3));if(0===r)throw new Je(`Invalid ${n} constructor. No valid arguments.`);if(r<s&&r>1)throw new Je(`Invalid ${n} constructor. Not enough arguments.`);if(r>s&&o>1)throw new Je(`Invalid ${n} constructor. Too many arguments.`);if(1===r){const e=t[0];t.push(e,e,e)}return"vec2"===n?ro.fromArray(t,0,n1.getCartesian2()):"vec3"===n?K.fromArray(t,0,n1.getCartesian3()):"vec4"===n?Xe.fromArray(t,0,n1.getCartesian4()):void 0},C1.prototype._evaluateLiteralString=function(){return this._value},C1.prototype._evaluateVariableString=function(e){let t=this._value,n=r1.exec(t);while(null!==n){const i=n[0],o=n[1];let r=q1(e,o);C(r)||(r=""),t=t.replace(i,r),n=r1.exec(t)}return t},C1.prototype._evaluateVariable=function(e){return q1(e,this._value)},C1.prototype._evaluateMemberDot=function(e){if(j1(this._left))return q1(e,this._right.evaluate(e));const t=this._left.evaluate(e);if(!C(t))return;const n=this._right.evaluate(e);if(t instanceof ro||t instanceof K||t instanceof Xe){if("r"===n)return t.x;if("g"===n)return t.y;if("b"===n)return t.z;if("a"===n)return t.w}return t[n]},C1.prototype._evaluateMemberBrackets=function(e){if(j1(this._left))return q1(e,this._right.evaluate(e));const t=this._left.evaluate(e);if(!C(t))return;const n=this._right.evaluate(e);if(t instanceof ro||t instanceof K||t instanceof Xe){if(0===n||"r"===n)return t.x;if(1===n||"g"===n)return t.y;if(2===n||"b"===n)return t.z;if(3===n||"a"===n)return t.w}return t[n]},C1.prototype._evaluateArray=function(e){const t=[];for(let n=0;n<this._value.length;n++)t[n]=this._value[n].evaluate(e);return t},C1.prototype._evaluateNot=function(e){const t=this._left.evaluate(e);if("boolean"!==typeof t)throw new Je(`Operator "!" requires a boolean argument. Argument is ${t}.`);return!t},C1.prototype._evaluateNegative=function(e){const t=this._left.evaluate(e);if(t instanceof ro)return ro.negate(t,n1.getCartesian2());if(t instanceof K)return K.negate(t,n1.getCartesian3());if(t instanceof Xe)return Xe.negate(t,n1.getCartesian4());if("number"===typeof t)return-t;throw new Je(`Operator "-" requires a vector or number argument. Argument is ${t}.`)},C1.prototype._evaluatePositive=function(e){const t=this._left.evaluate(e);if(!(t instanceof ro||t instanceof K||t instanceof Xe||"number"===typeof t))throw new Je(`Operator "+" requires a vector or number argument. Argument is ${t}.`);return t},C1.prototype._evaluateLessThan=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if("number"!==typeof t||"number"!==typeof n)throw new Je(`Operator "<" requires number arguments. Arguments are ${t} and ${n}.`);return t<n},C1.prototype._evaluateLessThanOrEquals=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if("number"!==typeof t||"number"!==typeof n)throw new Je(`Operator "<=" requires number arguments. Arguments are ${t} and ${n}.`);return t<=n},C1.prototype._evaluateGreaterThan=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if("number"!==typeof t||"number"!==typeof n)throw new Je(`Operator ">" requires number arguments. Arguments are ${t} and ${n}.`);return t>n},C1.prototype._evaluateGreaterThanOrEquals=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if("number"!==typeof t||"number"!==typeof n)throw new Je(`Operator ">=" requires number arguments. Arguments are ${t} and ${n}.`);return t>=n},C1.prototype._evaluateOr=function(e){const t=this._left.evaluate(e);if("boolean"!==typeof t)throw new Je(`Operator "||" requires boolean arguments. First argument is ${t}.`);if(t)return!0;const n=this._right.evaluate(e);if("boolean"!==typeof n)throw new Je(`Operator "||" requires boolean arguments. Second argument is ${n}.`);return t||n},C1.prototype._evaluateAnd=function(e){const t=this._left.evaluate(e);if("boolean"!==typeof t)throw new Je(`Operator "&&" requires boolean arguments. First argument is ${t}.`);if(!t)return!1;const n=this._right.evaluate(e);if("boolean"!==typeof n)throw new Je(`Operator "&&" requires boolean arguments. Second argument is ${n}.`);return t&&n},C1.prototype._evaluatePlus=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof ro&&t instanceof ro)return ro.add(t,n,n1.getCartesian2());if(n instanceof K&&t instanceof K)return K.add(t,n,n1.getCartesian3());if(n instanceof Xe&&t instanceof Xe)return Xe.add(t,n,n1.getCartesian4());if("string"===typeof t||"string"===typeof n)return t+n;if("number"===typeof t&&"number"===typeof n)return t+n;throw new Je(`Operator "+" requires vector or number arguments of matching types, or at least one string argument. Arguments are ${t} and ${n}.`)},C1.prototype._evaluateMinus=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof ro&&t instanceof ro)return ro.subtract(t,n,n1.getCartesian2());if(n instanceof K&&t instanceof K)return K.subtract(t,n,n1.getCartesian3());if(n instanceof Xe&&t instanceof Xe)return Xe.subtract(t,n,n1.getCartesian4());if("number"===typeof t&&"number"===typeof n)return t-n;throw new Je(`Operator "-" requires vector or number arguments of matching types. Arguments are ${t} and ${n}.`)},C1.prototype._evaluateTimes=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof ro&&t instanceof ro)return ro.multiplyComponents(t,n,n1.getCartesian2());if(n instanceof ro&&"number"===typeof t)return ro.multiplyByScalar(n,t,n1.getCartesian2());if(t instanceof ro&&"number"===typeof n)return ro.multiplyByScalar(t,n,n1.getCartesian2());if(n instanceof K&&t instanceof K)return K.multiplyComponents(t,n,n1.getCartesian3());if(n instanceof K&&"number"===typeof t)return K.multiplyByScalar(n,t,n1.getCartesian3());if(t instanceof K&&"number"===typeof n)return K.multiplyByScalar(t,n,n1.getCartesian3());if(n instanceof Xe&&t instanceof Xe)return Xe.multiplyComponents(t,n,n1.getCartesian4());if(n instanceof Xe&&"number"===typeof t)return Xe.multiplyByScalar(n,t,n1.getCartesian4());if(t instanceof Xe&&"number"===typeof n)return Xe.multiplyByScalar(t,n,n1.getCartesian4());if("number"===typeof t&&"number"===typeof n)return t*n;throw new Je(`Operator "*" requires vector or number arguments. If both arguments are vectors they must be matching types. Arguments are ${t} and ${n}.`)},C1.prototype._evaluateDivide=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof ro&&t instanceof ro)return ro.divideComponents(t,n,n1.getCartesian2());if(t instanceof ro&&"number"===typeof n)return ro.divideByScalar(t,n,n1.getCartesian2());if(n instanceof K&&t instanceof K)return K.divideComponents(t,n,n1.getCartesian3());if(t instanceof K&&"number"===typeof n)return K.divideByScalar(t,n,n1.getCartesian3());if(n instanceof Xe&&t instanceof Xe)return Xe.divideComponents(t,n,n1.getCartesian4());if(t instanceof Xe&&"number"===typeof n)return Xe.divideByScalar(t,n,n1.getCartesian4());if("number"===typeof t&&"number"===typeof n)return t/n;throw new Je(`Operator "/" requires vector or number arguments of matching types, or a number as the second argument. Arguments are ${t} and ${n}.`)},C1.prototype._evaluateMod=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof ro&&t instanceof ro)return ro.fromElements(t.x%n.x,t.y%n.y,n1.getCartesian2());if(n instanceof K&&t instanceof K)return K.fromElements(t.x%n.x,t.y%n.y,t.z%n.z,n1.getCartesian3());if(n instanceof Xe&&t instanceof Xe)return Xe.fromElements(t.x%n.x,t.y%n.y,t.z%n.z,t.w%n.w,n1.getCartesian4());if("number"===typeof t&&"number"===typeof n)return t%n;throw new Je(`Operator "%" requires vector or number arguments of matching types. Arguments are ${t} and ${n}.`)},C1.prototype._evaluateEqualsStrict=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);return n instanceof ro&&t instanceof ro||n instanceof K&&t instanceof K||n instanceof Xe&&t instanceof Xe?t.equals(n):t===n},C1.prototype._evaluateNotEqualsStrict=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);return n instanceof ro&&t instanceof ro||n instanceof K&&t instanceof K||n instanceof Xe&&t instanceof Xe?!t.equals(n):t!==n},C1.prototype._evaluateConditional=function(e){const t=this._test.evaluate(e);if("boolean"!==typeof t)throw new Je(`Conditional argument of conditional expression must be a boolean. Argument is ${t}.`);return t?this._left.evaluate(e):this._right.evaluate(e)},C1.prototype._evaluateNaN=function(e){return isNaN(this._left.evaluate(e))},C1.prototype._evaluateIsFinite=function(e){return isFinite(this._left.evaluate(e))},C1.prototype._evaluateIsExactClass=function(e){return!!C(e)&&e.isExactClass(this._left.evaluate(e))},C1.prototype._evaluateIsClass=function(e){return!!C(e)&&e.isClass(this._left.evaluate(e))},C1.prototype._evaluateGetExactClassName=function(e){if(C(e))return e.getExactClassName()},C1.prototype._evaluateBooleanConversion=function(e){return Boolean(this._left.evaluate(e))},C1.prototype._evaluateNumberConversion=function(e){return Number(this._left.evaluate(e))},C1.prototype._evaluateStringConversion=function(e){return String(this._left.evaluate(e))},C1.prototype._evaluateRegExp=function(e){const t=this._value.evaluate(e);let n,i="";C(this._left)&&(i=this._left.evaluate(e));try{n=new RegExp(t,i)}catch(o){throw new Je(o)}return n},C1.prototype._evaluateRegExpTest=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(!(t instanceof RegExp&&"string"===typeof n))throw new Je(`RegExp.test requires the first argument to be a RegExp and the second argument to be a string. Arguments are ${t} and ${n}.`);return t.test(n)},C1.prototype._evaluateRegExpMatch=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(t instanceof RegExp&&"string"===typeof n)return t.test(n);if(n instanceof RegExp&&"string"===typeof t)return n.test(t);throw new Je(`Operator "=~" requires one RegExp argument and one string argument. Arguments are ${t} and ${n}.`)},C1.prototype._evaluateRegExpNotMatch=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(t instanceof RegExp&&"string"===typeof n)return!t.test(n);if(n instanceof RegExp&&"string"===typeof t)return!n.test(t);throw new Je(`Operator "!~" requires one RegExp argument and one string argument. Arguments are ${t} and ${n}.`)},C1.prototype._evaluateRegExpExec=function(e){const t=this._left.evaluate(e),n=this._right.evaluate(e);if(!(t instanceof RegExp&&"string"===typeof n))throw new Je(`RegExp.exec requires the first argument to be a RegExp and the second argument to be a string. Arguments are ${t} and ${n}.`);const i=t.exec(n);return C(i)?i[1]:null},C1.prototype._evaluateToString=function(e){const t=this._left.evaluate(e);if(t instanceof RegExp||t instanceof ro||t instanceof K||t instanceof Xe)return String(t);throw new Je(`Unexpected function call "${this._value}".`)},t1.NULL_SENTINEL="czm_infinity",C1.prototype.getShaderExpression=function(e,t,n){let i,o,r,s;const a=this._type;let c,l,u,h=this._value;switch(C(this._left)&&(o=Array.isArray(this._left)?Z1(this._left,e,t,this):this._left.getShaderExpression(e,t,this)),C(this._right)&&(r=this._right.getShaderExpression(e,t,this)),C(this._test)&&(s=this._test.getShaderExpression(e,t,this)),Array.isArray(this._value)&&(h=Z1(this._value,e,t,this)),a){case e1.VARIABLE:if(j1(this))return;return $1(h,e);case e1.UNARY:if("Boolean"===h)return`bool(${o})`;if("Number"===h)return`float(${o})`;if("round"===h)return`floor(${o} + 0.5)`;if(C(u1[h]))return`${h}(${o})`;if("isNaN"===h)return`(${o} != ${o})`;if("isFinite"===h)return`(abs(${o}) < czm_infinity)`;if("String"===h||"isExactClass"===h||"isClass"===h||"getExactClassName"===h)throw new Je(`Error generating style shader: "${h}" is not supported.`);return h+o;case e1.BINARY:return"%"===h?`mod(${o}, ${r})`:"==="===h?`(${o} == ${r})`:"!=="===h?`(${o} != ${r})`:"atan2"===h?`atan(${o}, ${r})`:C(h1[h])?`${h}(${o}, ${r})`:`(${o} ${h} ${r})`;case e1.TERNARY:if(C(d1[h]))return`${h}(${o}, ${r}, ${s})`;break;case e1.CONDITIONAL:return`(${s} ? ${o} : ${r})`;case e1.MEMBER:return j1(this._left)?$1(r,e):"r"===r||"x"===r||"0.0"===r?`${o}[0]`:"g"===r||"y"===r||"1.0"===r?`${o}[1]`:"b"===r||"z"===r||"2.0"===r?`${o}[2]`:"a"===r||"w"===r||"3.0"===r?`${o}[3]`:`${o}[int(${r})]`;case e1.FUNCTION_CALL:throw new Je(`Error generating style shader: "${h}" is not supported.`);case e1.ARRAY:if(4===h.length)return`vec4(${h[0]}, ${h[1]}, ${h[2]}, ${h[3]})`;if(3===h.length)return`vec3(${h[0]}, ${h[1]}, ${h[2]})`;if(2===h.length)return`vec2(${h[0]}, ${h[1]})`;throw new Je("Error generating style shader: Invalid array length. Array length should be 2, 3, or 4.");case e1.REGEX:throw new Je("Error generating style shader: Regular expressions are not supported.");case e1.VARIABLE_IN_STRING:throw new Je("Error generating style shader: Converting a variable to a string is not supported.");case e1.LITERAL_NULL:return t1.NULL_SENTINEL;case e1.LITERAL_BOOLEAN:return h?"true":"false";case e1.LITERAL_NUMBER:return X1(h);case e1.LITERAL_STRING:if(C(n)&&n._type===e1.MEMBER&&("r"===h||"g"===h||"b"===h||"a"===h||"x"===h||"y"===h||"z"===h||"w"===h||j1(n._left)))return h;if(i=xy.fromCssColorString(h,l1),C(i))return Q1(i);throw new Je("Error generating style shader: String literals are not supported.");case e1.LITERAL_COLOR:if(c=o,"color"===h){if(!C(c))return"vec4(1.0)";if(c.length>1){const e=c[0],n=c[1];return"1.0"!==n&&(t.translucent=!0),`vec4(${e}, ${n})`}return`vec4(${c[0]}, 1.0)`}if("rgb"===h)return i=K1(this),C(i)?J1(i):`vec4(${c[0]} / 255.0, ${c[1]} / 255.0, ${c[2]} / 255.0, 1.0)`;if("rgba"===h)return"1.0"!==c[3]&&(t.translucent=!0),i=K1(this),C(i)?J1(i):`vec4(${c[0]} / 255.0, ${c[1]} / 255.0, ${c[2]} / 255.0, ${c[3]})`;if("hsl"===h)return i=Y1(this),C(i)?J1(i):`vec4(czm_HSLToRGB(vec3(${c[0]}, ${c[1]}, ${c[2]})), 1.0)`;if("hsla"===h)return i=Y1(this),C(i)?(1!==i.alpha&&(t.translucent=!0),J1(i)):("1.0"!==c[3]&&(t.translucent=!0),`vec4(czm_HSLToRGB(vec3(${c[0]}, ${c[1]}, ${c[2]})), ${c[3]})`);break;case e1.LITERAL_VECTOR:if(!C(o))throw new x("left should always be defined for type ExpressionNodeType.LITERAL_VECTOR");l=o.length,u=`${h}(`;for(let e=0;e<l;++e)u+=o[e],e<l-1&&(u+=", ");return u+=")",u;case e1.LITERAL_REGEX:throw new Je("Error generating style shader: Regular expressions are not supported.");case e1.LITERAL_UNDEFINED:return t1.NULL_SENTINEL;case e1.BUILTIN_VARIABLE:if("tiles3d_tileset_time"===h)return"u_time"}},C1.prototype.getVariables=function(e,t){let n,i,o;const r=this._type,s=this._value;if(C(this._left))if(Array.isArray(this._left))for(n=this._left,i=n.length,o=0;o<i;++o)n[o].getVariables(e,this);else this._left.getVariables(e,this);if(C(this._right)&&this._right.getVariables(e,this),C(this._test)&&this._test.getVariables(e,this),Array.isArray(this._value))for(n=this._value,i=n.length,o=0;o<i;++o)n[o].getVariables(e,this);let a;switch(r){case e1.VARIABLE:j1(this)||e.push(s);break;case e1.VARIABLE_IN_STRING:a=r1.exec(s);while(null!==a)e.push(a[1]),a=r1.exec(s);break;case e1.LITERAL_STRING:C(t)&&t._type===e1.MEMBER&&j1(t._left)&&e.push(s);break}};var e2=t1;function t2(e){e=R(e,R.EMPTY_OBJECT),this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._positions=e.positions,this._vertexBatchIds=e.vertexBatchIds,this._indices=e.indices,this._indexCounts=e.indexCounts,this._indexOffsets=e.indexOffsets,this._batchedIndices=e.batchedIndices,this._boundingVolume=e.boundingVolume,this._boundingVolumes=e.boundingVolumes,this._center=R(e.center,K.ZERO),this._va=void 0,this._sp=void 0,this._spStencil=void 0,this._spPick=void 0,this._uniformMap=void 0,this._vaSwap=void 0,this._rsStencilDepthPass=void 0,this._rsStencilDepthPass3DTiles=void 0,this._rsColorPass=void 0,this._rsPickPass=void 0,this._rsWireframe=void 0,this._commands=[],this._commandsIgnoreShow=[],this._pickCommands=[],this._constantColor=xy.clone(xy.WHITE),this._highlightColor=this._constantColor,this._batchDirty=!0,this._pickCommandsDirty=!0,this._framesSinceLastRebatch=0,this._updatingAllCommands=!1,this._trianglesLength=this._indices.length/3,this._geometryByteLength=this._indices.byteLength+this._positions.byteLength+this._vertexBatchIds.byteLength,this.debugWireframe=!1,this._debugWireframe=this.debugWireframe,this._wireframeDirty=!1,this.forceRebatch=!1,this.classificationType=R(e.classificationType,rq.BOTH),this._vertexShaderSource=e._vertexShaderSource,this._fragmentShaderSource=e._fragmentShaderSource,this._attributeLocations=e._attributeLocations,this._uniformMap=e._uniformMap,this._pickId=e._pickId,this._modelMatrix=e._modelMatrix,this._boundingSphere=e._boundingSphere,this._batchIdLookUp={};const t=this._batchIds.length;for(let n=0;n<t;++n){const e=this._batchIds[n];this._batchIdLookUp[e]=n}}Object.defineProperties(t2.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}}});const n2={position:0,a_batchId:1};function i2(e,t){if(C(e._va))return;const n=hq.createVertexBuffer({context:t,typedArray:e._positions,usage:lq.STATIC_DRAW}),i=hq.createVertexBuffer({context:t,typedArray:e._vertexBatchIds,usage:lq.STATIC_DRAW}),o=hq.createIndexBuffer({context:t,typedArray:e._indices,usage:lq.DYNAMIC_DRAW,indexDatatype:2===e._indices.BYTES_PER_ELEMENT?fd.UNSIGNED_SHORT:fd.UNSIGNED_INT}),r=[{index:0,vertexBuffer:n,componentDatatype:ih.fromTypedArray(e._positions),componentsPerAttribute:3},{index:1,vertexBuffer:i,componentDatatype:ih.fromTypedArray(e._vertexBatchIds),componentsPerAttribute:1}];e._va=new bq({context:t,attributes:r,indexBuffer:o}),t.webgl2&&(e._vaSwap=new bq({context:t,attributes:r,indexBuffer:hq.createIndexBuffer({context:t,sizeInBytes:o.sizeInBytes,usage:lq.DYNAMIC_DRAW,indexDatatype:o.indexDatatype})})),e._batchedPositions=void 0,e._transferrableBatchIds=void 0,e._vertexBatchIds=void 0,e._verticesPromise=void 0}function o2(e,t){if(C(e._sp))return;const n=e._batchTable,i=R(e._attributeLocations,n2);let o=e._pickId;const r=e._vertexShaderSource;let s=e._fragmentShaderSource;if(C(r))return e._sp=fH.fromCache({context:t,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:i}),e._spStencil=e._sp,s=tq.replaceMain(s,"czm_non_pick_main"),s=`${s}void main() \n{ \n    czm_non_pick_main(); \n    gl_FragColor = ${o}; \n} \n`,void(e._spPick=fH.fromCache({context:t,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:i}));const a=n.getVertexShaderCallback(!1,"a_batchId",void 0)(J0);let c=n.getFragmentShaderCallback(!1,void 0,!0)(iq);o=n.getPickId();let l=new tq({sources:[a]}),u=new tq({defines:["VECTOR_TILE"],sources:[c]});e._sp=fH.fromCache({context:t,vertexShaderSource:l,fragmentShaderSource:u,attributeLocations:i}),l=new tq({sources:[J0]}),u=new tq({defines:["VECTOR_TILE"],sources:[iq]}),e._spStencil=fH.fromCache({context:t,vertexShaderSource:l,fragmentShaderSource:u,attributeLocations:i}),c=tq.replaceMain(c,"czm_non_pick_main"),c=`${c}\nvoid main() \n{ \n    czm_non_pick_main(); \n    gl_FragColor = ${o}; \n} \n`;const h=new tq({sources:[a]}),d=new tq({defines:["VECTOR_TILE"],sources:[c]});e._spPick=fH.fromCache({context:t,vertexShaderSource:h,fragmentShaderSource:d,attributeLocations:i})}function r2(e){const t=e?LY.EQUAL:LY.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:!0,frontFunction:t,frontOperation:{fail:BY.KEEP,zFail:BY.DECREMENT_WRAP,zPass:BY.KEEP},backFunction:t,backOperation:{fail:BY.KEEP,zFail:BY.INCREMENT_WRAP,zPass:BY.KEEP},reference:FY.CESIUM_3D_TILE_MASK,mask:FY.CESIUM_3D_TILE_MASK},stencilMask:FY.CLASSIFICATION_MASK,depthTest:{enabled:!0,func:aq.LESS_OR_EQUAL},depthMask:!1}}const s2={stencilTest:{enabled:!0,frontFunction:LY.NOT_EQUAL,frontOperation:{fail:BY.ZERO,zFail:BY.ZERO,zPass:BY.ZERO},backFunction:LY.NOT_EQUAL,backOperation:{fail:BY.ZERO,zFail:BY.ZERO,zPass:BY.ZERO},reference:0,mask:FY.CLASSIFICATION_MASK},stencilMask:FY.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:_k.PRE_MULTIPLIED_ALPHA_BLEND},a2={stencilTest:{enabled:!0,frontFunction:LY.NOT_EQUAL,frontOperation:{fail:BY.ZERO,zFail:BY.ZERO,zPass:BY.ZERO},backFunction:LY.NOT_EQUAL,backOperation:{fail:BY.ZERO,zFail:BY.ZERO,zPass:BY.ZERO},reference:0,mask:FY.CLASSIFICATION_MASK},stencilMask:FY.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1};function c2(e){C(e._rsStencilDepthPass)||(e._rsStencilDepthPass=yV.fromCache(r2(!1)),e._rsStencilDepthPass3DTiles=yV.fromCache(r2(!0)),e._rsColorPass=yV.fromCache(s2),e._rsPickPass=yV.fromCache(a2))}const l2=new ft,u2=new K;function h2(e,t){if(C(e._uniformMap))return;const n={u_modifiedModelViewProjection:function(){const n=t.uniformState.view,i=t.uniformState.projection;return ft.clone(n,l2),ft.multiplyByPoint(l2,e._center,u2),ft.setTranslation(l2,u2,l2),ft.multiply(i,l2,l2),l2},u_highlightColor:function(){return e._highlightColor}};e._uniformMap=e._batchTable.getUniformMapCallback()(n)}function d2(e,t,n,i,o,r,s){const a=e.constructor.BYTES_PER_ELEMENT,c=r.length;for(let l=0;l<c;++l){const c=r[l],u=s[c],h=i[u],d=o[u],f=new e.constructor(e.buffer,a*h,d);t.set(f,n),i[u]=n,n+=d}return n}function f2(e,t){const n=e._indices,i=e._indexOffsets,o=e._indexCounts,r=e._batchIdLookUp,s=new n.constructor(n.length);let a=t.pop();const c=[a];let l=d2(n,s,0,i,o,a.batchIds,r);a.offset=0,a.count=l;while(t.length>0){const e=t.pop();if(xy.equals(e.color,a.color))l=d2(n,s,l,i,o,e.batchIds,r),a.batchIds=a.batchIds.concat(e.batchIds),a.count=l-a.offset;else{const t=l;l=d2(n,s,l,i,o,e.batchIds,r),e.offset=t,e.count=l-t,c.push(e),a=e}}e._va.indexBuffer.copyFromArrayView(s),e._indices=s,e._batchedIndices=c}function p2(e,t,n,i,o,r,s){const a=e.bytesPerIndex,c=r.length;for(let l=0;l<c;++l){const c=r[l],u=s[c],h=i[u],d=o[u];t.copyFromBuffer(e,h*a,n*a,d*a),i[u]=n,n+=d}return n}function m2(e,t){const n=e._indexOffsets,i=e._indexCounts,o=e._batchIdLookUp;let r=t.pop();const s=[r],a=e._va.indexBuffer,c=e._vaSwap.indexBuffer;let l=p2(a,c,0,n,i,r.batchIds,o);r.offset=0,r.count=l;while(t.length>0){const e=t.pop();if(xy.equals(e.color,r.color))l=p2(a,c,l,n,i,e.batchIds,o),r.batchIds=r.batchIds.concat(e.batchIds),r.count=l-r.offset;else{const t=l;l=p2(a,c,l,n,i,e.batchIds,o),e.offset=t,e.count=l-t,s.push(e),r=e}}const u=e._va;e._va=e._vaSwap,e._vaSwap=u,e._batchedIndices=s}function _2(e,t){return t.color.toRgba()-e.color.toRgba()}function g2(e,t){if(!e._batchDirty)return!1;const n=e._batchedIndices,i=n.length;let o=!1;const r={};for(let s=0;s<i;++s){const e=n[s].color,t=e.toRgba();if(C(r[t])){o=!0;break}r[t]=!0}return o?o&&!e.forceRebatch&&e._framesSinceLastRebatch<120?void++e._framesSinceLastRebatch:(n.sort(_2),t.webgl2?m2(e,n):f2(e,n),e._framesSinceLastRebatch=0,e._batchDirty=!1,e._pickCommandsDirty=!0,e._wireframeDirty=!0,!0):(e._batchDirty=!1,!1)}function y2(e,t){const n=g2(e,t),i=e._commands,o=e._batchedIndices,r=o.length,s=2*r;if(C(i)&&!n&&i.length===s)return;i.length=s;const a=e._va,c=e._sp,l=R(e._modelMatrix,ft.IDENTITY),u=e._uniformMap,h=e._boundingVolume;for(let d=0;d<r;++d){const t=o[d].offset,n=o[d].count;let r=i[2*d];C(r)||(r=i[2*d]=new UU({owner:e})),r.vertexArray=a,r.modelMatrix=l,r.offset=t,r.count=n,r.renderState=e._rsStencilDepthPass,r.shaderProgram=c,r.uniformMap=u,r.boundingVolume=h,r.cull=!1,r.pass=HU.TERRAIN_CLASSIFICATION;const s=UU.shallowClone(r,r.derivedCommands.tileset);s.renderState=e._rsStencilDepthPass3DTiles,s.pass=HU.CESIUM_3D_TILE_CLASSIFICATION,r.derivedCommands.tileset=s;let f=i[2*d+1];C(f)||(f=i[2*d+1]=new UU({owner:e})),f.vertexArray=a,f.modelMatrix=l,f.offset=t,f.count=n,f.renderState=e._rsColorPass,f.shaderProgram=c,f.uniformMap=u,f.boundingVolume=h,f.cull=!1,f.pass=HU.TERRAIN_CLASSIFICATION;const p=UU.shallowClone(f,f.derivedCommands.tileset);p.pass=HU.CESIUM_3D_TILE_CLASSIFICATION,f.derivedCommands.tileset=p}e._commandsDirty=!0}function v2(e,t){if(e.classificationType===rq.TERRAIN||!t.invertClassification||C(e._commandsIgnoreShow)&&!e._commandsDirty)return;const n=e._commands,i=e._commandsIgnoreShow,o=e._spStencil,r=n.length,s=i.length=r/2;let a=0;for(let c=0;c<s;++c){const e=i[c]=UU.shallowClone(n[a],i[c]);e.shaderProgram=o,e.pass=HU.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,a+=2}e._commandsDirty=!1}function b2(e){if(!e._pickCommandsDirty)return;const t=e._indexOffsets.length,n=e._pickCommands;n.length=2*t;const i=e._va,o=e._spStencil,r=e._spPick,s=R(e._modelMatrix,ft.IDENTITY),a=e._uniformMap;for(let c=0;c<t;++c){const t=e._indexOffsets[c],l=e._indexCounts[c],u=C(e._boundingVolumes)?e._boundingVolumes[c]:e.boundingVolume;let h=n[2*c];C(h)||(h=n[2*c]=new UU({owner:e,pickOnly:!0})),h.vertexArray=i,h.modelMatrix=s,h.offset=t,h.count=l,h.renderState=e._rsStencilDepthPass,h.shaderProgram=o,h.uniformMap=a,h.boundingVolume=u,h.pass=HU.TERRAIN_CLASSIFICATION;const d=UU.shallowClone(h,h.derivedCommands.tileset);d.renderState=e._rsStencilDepthPass3DTiles,d.pass=HU.CESIUM_3D_TILE_CLASSIFICATION,h.derivedCommands.tileset=d;let f=n[2*c+1];C(f)||(f=n[2*c+1]=new UU({owner:e,pickOnly:!0})),f.vertexArray=i,f.modelMatrix=s,f.offset=t,f.count=l,f.renderState=e._rsPickPass,f.shaderProgram=r,f.uniformMap=a,f.boundingVolume=u,f.pass=HU.TERRAIN_CLASSIFICATION;const p=UU.shallowClone(f,f.derivedCommands.tileset);p.pass=HU.CESIUM_3D_TILE_CLASSIFICATION,f.derivedCommands.tileset=p}e._pickCommandsDirty=!1}function A2(e,t){e._updatingAllCommands=!0;const n=e._batchIds;let i,o=n.length;for(i=0;i<o;++i){const e=n[i],o=t[e];o.show=!0,o.color=xy.WHITE}const r=e._batchedIndices;for(o=r.length,i=0;i<o;++i)r[i].color=xy.clone(xy.WHITE);e._updatingAllCommands=!1,e._batchDirty=!0}t2.prototype.createFeatures=function(e,t){const n=this._batchIds,i=n.length;for(let o=0;o<i;++o){const i=n[o];t[i]=new hZ(e,i)}},t2.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};const w2=new xy,T2=xy.WHITE,C2=!0,E2=/\$/;function x2(e,t,n,i){const o=e.classificationType,r=o!==rq.CESIUM_3D_TILE,s=o!==rq.TERRAIN,a=t.commandList;let c,l,u=n.length;for(l=0;l<u;++l)r&&(c=n[l],c.pass=HU.TERRAIN_CLASSIFICATION,a.push(c)),s&&(c=n[l].derivedCommands.tileset,c.pass=HU.CESIUM_3D_TILE_CLASSIFICATION,a.push(c));if(t.invertClassification&&C(i))for(u=i.length,l=0;l<u;++l)a.push(i[l])}function S2(e,t){const n=e.commandList,i=t.length;for(let o=0;o<i;o+=2){const e=t[o+1];e.pass=HU.OPAQUE,n.push(e)}}function I2(e){let t,n,i=e.debugWireframe===e._debugWireframe;if(i=i&&!(e.debugWireframe&&e._wireframeDirty),i)return;C(e._rsWireframe)||(e._rsWireframe=yV.fromCache({})),e.debugWireframe?(t=e._rsWireframe,n=xf.LINES):(t=e._rsColorPass,n=xf.TRIANGLES);const o=e._commands,r=o.length;for(let s=0;s<r;s+=2){const e=o[s+1];e.renderState=t,e.primitiveType=n}e._debugWireframe=e.debugWireframe,e._wireframeDirty=!1}t2.prototype.applyStyle=function(e,t){if(!C(e))return void A2(this,t);const n=e.color,i=n instanceof e2&&!E2.test(n.expression);this._updatingAllCommands=i;const o=this._batchIds;let r,s=o.length;for(r=0;r<s;++r){const n=o[r],i=t[n];i.color=C(e.color)?e.color.evaluateColor(i,w2):T2,i.show=C(e.show)?e.show.evaluate(i):C2}if(i){const e=this._batchedIndices;for(s=e.length,r=0;r<s;++r)e[r].color=xy.clone(xy.WHITE);this._updatingAllCommands=!1,this._batchDirty=!0}},t2.prototype.updateCommands=function(e,t){if(this._updatingAllCommands)return;const n=this._batchIdLookUp,i=n[e];if(!C(i))return;const o=this._indexOffsets,r=this._indexCounts,s=o[i],a=r[i],c=this._batchedIndices,l=c.length;let u;for(u=0;u<l;++u){const e=c[u].offset,t=c[u].count;if(s>=e&&s<e+t)break}c.push(new Q0({color:xy.clone(t),offset:s,count:a,batchIds:[e]}));const h=[],d=[],f=c[u].batchIds,p=f.length;for(let m=0;m<p;++m){const t=f[m];if(t===e)continue;const i=n[t];o[i]<s?h.push(t):d.push(t)}0!==d.length&&c.push(new Q0({color:xy.clone(c[u].color),offset:s+a,count:c[u].offset+c[u].count-(s+a),batchIds:d})),0!==h.length?(c[u].count=s-c[u].offset,c[u].batchIds=h):c.splice(u,1),this._batchDirty=!0},t2.prototype.update=function(e){const t=e.context;i2(this,t),o2(this,t),c2(this),h2(this,t);const n=e.passes;n.render&&(y2(this,t),v2(this,e),I2(this),this._debugWireframe?S2(e,this._commands):x2(this,e,this._commands,this._commandsIgnoreShow)),n.pick&&(b2(this),x2(this,e,this._pickCommands))},t2.prototype.isDestroyed=function(){return!1},t2.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._vaSwap=this._vaSwap&&this._vaSwap.destroy(),Qh(this)};var O2=t2;const D2=new K,P2=P0.ModelState;function R2(e){e=R(e,R.EMPTY_OBJECT);let t=e.gltf;if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),!(t instanceof Uint8Array))throw new Je("Only binary glTF is supported as a classifier.");t=HZ(t),t0(t),OZ(t),z0(t),K0(t),AZ.buffer(t,(function(e){if(!C(e.extras._pipeline.source))throw new Je("Buffer data must be embedded in the binary gltf.")}));const n=t.nodes,i=t.meshes,o=n[0],r=o.mesh;if(1!==n.length||!C(r))throw new Je("Only one node is supported for classification and it must have a mesh.");if(1!==i.length)throw new Je("Only one mesh is supported when using b3dm for classification.");const s=i[0].primitives;if(1!==s.length)throw new Je("Only one primitive per mesh is supported when using b3dm for classification.");const a=s[0].attributes.POSITION;if(!C(a))throw new Je("The mesh must have a position attribute.");const c=s[0].attributes._BATCHID;if(!C(c))throw new Je("The mesh must have a batch id attribute.");this._gltf=t,this.show=R(e.show,!0),this.modelMatrix=ft.clone(R(e.modelMatrix,ft.IDENTITY)),this._modelMatrix=ft.clone(this.modelMatrix),this._ready=!1,this._readyPromise=yn(),this.debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=R(e.debugWireframe,!1),this._debugWireframe=!1,this._classificationType=e.classificationType,this._vertexShaderLoaded=e.vertexShaderLoaded,this._classificationShaderLoaded=e.classificationShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._pickIdLoaded=e.pickIdLoaded,this._ignoreCommands=R(e.ignoreCommands,!1),this._upAxis=R(e.upAxis,iJ.Y),this._batchTable=e.batchTable,this._computedModelMatrix=new ft,this._initialRadius=void 0,this._boundingSphere=void 0,this._scaledBoundingSphere=new nn,this._state=P2.NEEDS_LOAD,this._loadResources=void 0,this._mode=void 0,this._dirty=!1,this._nodeMatrix=new ft,this._primitive=void 0,this._extensionsUsed=void 0,this._extensionsRequired=void 0,this._quantizedUniforms=void 0,this._buffers={},this._vertexArray=void 0,this._shaderProgram=void 0,this._uniformMap=void 0,this._geometryByteLength=0,this._trianglesLength=0,this._rtcCenter=void 0,this._rtcCenterEye=void 0,this._rtcCenter3D=void 0,this._rtcCenter2D=void 0}function L2(e){const t=e.gltf,n=e._loadResources;AZ.buffer(t,(function(e,t){n.buffers[t]=e.extras._pipeline.source}))}function M2(e){const t=e.gltf.bufferViews,n=e._loadResources.vertexBuffersToCreate;AZ.bufferView(e.gltf,(function(e,t){e.target===th.ARRAY_BUFFER&&n.enqueue(t)}));const i=e._loadResources.indexBuffersToCreate,o={};AZ.accessor(e.gltf,(function(e){const n=e.bufferView,r=t[n];r.target!==th.ELEMENT_ARRAY_BUFFER||C(o[n])||(o[n]=!0,i.enqueue({id:n,componentType:e.componentType}))}))}function B2(e,t){const n=t._loadResources,i=t.gltf.bufferViews,o=i[e],r=n.getBuffer(o);t._buffers[e]=r,t._geometryByteLength+=r.byteLength}function N2(e,t,n){const i=n._loadResources,o=n.gltf.bufferViews,r=o[e],s={typedArray:i.getBuffer(r),indexDatatype:t};n._buffers[e]=s,n._geometryByteLength+=s.typedArray.byteLength}function F2(e){const t=e._loadResources;if(0!==t.pendingBufferLoads)return;const n=t.vertexBuffersToCreate,i=t.indexBuffersToCreate;while(n.length>0)B2(n.dequeue(),e);while(i.length>0){const t=i.dequeue();N2(t.id,t.componentType,e)}}function z2(e,t){const n=t.gltf.meshes[0].primitives[0],i=P0.modifyShaderForQuantizedAttributes(t.gltf,n,e);return t._quantizedUniforms=i.uniforms,i.shader}function k2(e,t){return C(t)&&(e=t(e)),e}function U2(e){const t=e.gltf,n=P0.getAttributeOrUniformBySemantic(t,"POSITION"),i=P0.getAttributeOrUniformBySemantic(t,"_BATCHID"),o={};o[n]=0,o[i]=1;const r=P0.getAttributeOrUniformBySemantic(t,"MODELVIEWPROJECTION");let s,a;if(C(r))s=`uniform mat4 ${r};\n`,a=`${r} * vec4(${n}, 1.0)`;else{const e=P0.getAttributeOrUniformBySemantic(t,"PROJECTION");let i=P0.getAttributeOrUniformBySemantic(t,"MODELVIEW");C(i)||(i=P0.getAttributeOrUniformBySemantic(t,"CESIUM_RTC_MODELVIEW")),s=`uniform mat4 ${i};\nuniform mat4 ${e};\n`,a=`${e} * ${i} * vec4(${n}, 1.0)`}const c=`    vec4 positionInClipCoords = ${a};\n`;let l=`attribute vec3 ${n};\nattribute float ${i};\n${s}void main() {\n${c}    gl_Position = czm_depthClamp(positionInClipCoords);\n}\n`;const u="#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\nvoid main() \n{ \n    gl_FragColor = vec4(1.0); \n    czm_writeDepthClamp();\n}\n";e.extensionsUsed.WEB3D_quantized_attributes&&(l=z2(l,e));const h=k2(l,e._vertexShaderLoaded),d=k2(u,e._classificationShaderLoaded);e._shaderProgram={vertexShaderSource:h,fragmentShaderSource:d,attributeLocations:o}}function V2(){return{POSITION:0,_BATCHID:1}}function H2(e){const t=e._loadResources;if(!t.finishedBuffersCreation()||C(e._vertexArray))return;const n=e._buffers,i=e.gltf,o=i.accessors,r=i.meshes,s=r[0].primitives,a=s[0],c=V2(),l={};let u;if(AZ.meshPrimitiveAttribute(a,(function(e,t){const r=c[t];if(C(r)){const s=o[e];l[t]={index:r,vertexBuffer:n[s.bufferView],componentsPerAttribute:TZ(s.type),componentDatatype:s.componentType,offsetInBytes:s.byteOffset,strideInBytes:EZ(i,s)}}})),C(a.indices)){const e=o[a.indices];u=n[e.bufferView]}e._vertexArray={attributes:l,indexBuffer:u}}Object.defineProperties(R2.prototype,{gltf:{get:function(){return this._gltf}},boundingSphere:{get:function(){if(this._state!==P2.LOADED)throw new x("The model is not loaded.  Use ClassificationModel.readyPromise or wait for ClassificationModel.ready to be true.");const e=this.modelMatrix,t=ft.getScale(e,D2),n=this._scaledBoundingSphere;return n.center=K.multiplyComponents(this._boundingSphere.center,t,n.center),n.radius=K.maximumComponent(t)*this._initialRadius,C(this._rtcCenter)&&K.add(this._rtcCenter,n.center,n.center),n}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},dirty:{get:function(){return this._dirty}},extensionsUsed:{get:function(){return C(this._extensionsUsed)||(this._extensionsUsed=P0.getUsedExtensions(this.gltf)),this._extensionsUsed}},extensionsRequired:{get:function(){return C(this._extensionsRequired)||(this._extensionsRequired=P0.getRequiredExtensions(this.gltf)),this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return 0}},classificationType:{get:function(){return this._classificationType}}});const G2={PROJECTION:function(e,t){return P0.getGltfSemanticUniforms().PROJECTION(e,t)},MODELVIEW:function(e,t){return P0.getGltfSemanticUniforms().MODELVIEW(e,t)},CESIUM_RTC_MODELVIEW:function(e,t){return P0.getGltfSemanticUniforms().CESIUM_RTC_MODELVIEW(e,t)},MODELVIEWPROJECTION:function(e,t){return P0.getGltfSemanticUniforms().MODELVIEWPROJECTION(e,t)}};function W2(e,t){if(C(e._uniformMap))return;const n={};AZ.technique(e.gltf,(function(i){AZ.techniqueUniform(i,(function(i,o){C(i.semantic)&&C(G2[i.semantic])&&(n[o]=G2[i.semantic](t.uniformState,e))}))})),e._uniformMap=n}function q2(e,t){return P0.createUniformsForQuantizedAttributes(e.gltf,t,e._quantizedUniforms)}function j2(e,t){switch(e.mode){case xf.TRIANGLES:return t/3;case xf.TRIANGLE_STRIP:case xf.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function Y2(e){const t=e._batchTable;let n=e._uniformMap;const i=e._vertexArray,o=e.gltf,r=o.accessors,s=o.meshes,a=s[0].primitives[0],c=r[a.indices],l=a.attributes.POSITION,u=P0.getAccessorMinMax(o,l),h=nn.fromCornerPoints(K.fromArray(u.min),K.fromArray(u.max));let d,f;if(C(c))f=c.count,d=c.byteOffset/fd.getSizeInBytes(c.componentType);else{const e=r[a.attributes.POSITION];f=e.count,d=0}if(e._trianglesLength+=j2(a,f),C(e._uniformMapLoaded)&&(n=e._uniformMapLoaded(n)),e.extensionsUsed.WEB3D_quantized_attributes){const t=q2(e,a);n=_n(n,t)}let p=i.attributes.POSITION,m=p.componentDatatype,_=p.vertexBuffer,g=_.byteOffset,y=_.byteLength/ih.getSizeInBytes(m),v=ih.createArrayBufferView(m,_.buffer,g,y);p=i.attributes._BATCHID,m=p.componentDatatype,_=p.vertexBuffer,g=_.byteOffset,y=_.byteLength/ih.getSizeInBytes(m);let b=ih.createArrayBufferView(m,_.buffer,g,y);const A=i.indexBuffer.typedArray;let w;w=i.indexBuffer.indexDatatype===fd.UNSIGNED_SHORT?new Uint16Array(A.buffer,A.byteOffset,A.byteLength/Uint16Array.BYTES_PER_ELEMENT):new Uint32Array(A.buffer,A.byteOffset,A.byteLength/Uint32Array.BYTES_PER_ELEMENT),v=xF(v),b=xF(b),w=xF(w,d,d+f);const T=[],E=[],x=[],S=[];let I,O,D,P=b[w[0]];T.push(P),x.push(0);const R=w.length;for(let C=1;C<R;++C)I=b[w[C]],I!==P&&(O=x[x.length-1],D=C-O,T.push(I),E.push(D),x.push(C),S.push(new Q0({offset:O,count:D,batchIds:[P],color:xy.WHITE})),P=I);O=x[x.length-1],D=R-O,E.push(D),S.push(new Q0({offset:O,count:D,batchIds:[P],color:xy.WHITE}));const L=e._shaderProgram,M=L.vertexShaderSource,B=L.fragmentShaderSource,N=L.attributeLocations,F=C(e._pickIdLoaded)?e._pickIdLoaded():void 0;e._primitive=new O2({classificationType:e._classificationType,positions:v,indices:w,indexOffsets:x,indexCounts:E,batchIds:T,vertexBatchIds:b,batchedIndices:S,batchTable:t,boundingVolume:new nn,_vertexShaderSource:M,_fragmentShaderSource:B,_attributeLocations:N,_uniformMap:n,_pickId:F,_modelMatrix:new ft,_boundingSphere:h}),e._buffers=void 0,e._vertexArray=void 0,e._shaderProgram=void 0,e._uniformMap=void 0}function K2(e){const t=e._loadResources;if(!t.finished())return;if(C(e._primitive))return;const n=e.gltf,i=n.nodes,o=i[0];e._nodeMatrix=P0.getTransform(o,e._nodeMatrix),Y2(e)}function X2(e,t){const n=t.context;P0.checkSupportedGlExtensions(e.gltf.glExtensionsUsed,n),F2(e),U2(e),H2(e),W2(e,n),K2(e)}const Q2=new Xe,J2=new ft;function Z2(e,t,n,i){let o=e._computedModelMatrix;if(e._mode!==ij.SCENE3D&&!e._ignoreCommands){const t=ft.getColumn(o,3,Q2);if(Xe.equals(t,Xe.UNIT_W)){const t=e.boundingSphere.center,n=Kl.wgs84To2DModelMatrix(i,t,J2);o=ft.multiply(n,o,J2),C(e._rtcCenter)&&(ft.setTranslation(o,Xe.UNIT_W,o),e._rtcCenter=e._rtcCenter2D)}else o=Kl.basisTo2D(i,o,J2),e._rtcCenter=e._rtcCenter3D}const r=e._primitive;(t||n)&&(ft.multiplyTransformation(o,e._nodeMatrix,r._modelMatrix),nn.transform(r._boundingSphere,r._modelMatrix,r._boundingVolume),C(e._rtcCenter)&&K.add(e._rtcCenter,r._boundingVolume.center,r._boundingVolume.center))}R2.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)},R2.prototype.update=function(e){if(e.mode===ij.MORPHING)return;if(!Oc.supportsWebP.initialized)return void Oc.supportsWebP.initialize();const t=Oc.supportsWebP();if(this._state===P2.NEEDS_LOAD&&C(this.gltf)&&(this._state=P2.LOADING,this._state!==P2.FAILED)){const t=this.gltf.extensions;if(C(t)&&C(t.CESIUM_RTC)){const n=K.fromArray(t.CESIUM_RTC.center);if(!K.equals(n,K.ZERO)){this._rtcCenter3D=n;const t=e.mapProjection,i=t.ellipsoid,o=i.cartesianToCartographic(this._rtcCenter3D),r=t.project(o);K.fromElements(r.z,r.x,r.y,r),this._rtcCenter2D=r,this._rtcCenterEye=new K,this._rtcCenter=this._rtcCenter3D}}this._loadResources=new o0,P0.parseBuffers(this)}const n=this._loadResources;let i=!1;this._state===P2.LOADING&&(0===n.pendingBufferLoads&&(P0.checkSupportedExtensions(this.extensionsRequired,t),L2(this),M2(this),this._boundingSphere=P0.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,X2(this,e)),n.finished()&&(this._state=P2.LOADED,i=!0)),C(n)&&this._state===P2.LOADED&&(i||X2(this,e),n.finished()&&(this._loadResources=void 0));const o=this.show;if(o&&this._state===P2.LOADED||i){this._dirty=!1;const t=this.modelMatrix,n=e.mode!==this._mode;this._mode=e.mode;const o=!ft.equals(this._modelMatrix,t)||n;if(o||i){ft.clone(t,this._modelMatrix);const e=this._computedModelMatrix;ft.clone(t,e),this._upAxis===iJ.Y?ft.multiplyTransformation(e,iJ.Y_UP_TO_Z_UP,e):this._upAxis===iJ.X&&ft.multiplyTransformation(e,iJ.X_UP_TO_Z_UP,e)}(o||i)&&(Z2(this,o,i,e.mapProjection),this._dirty=!0)}if(i){const t=this;e.afterRender.push((function(){t._ready=!0,t._readyPromise.resolve(t)}))}else o&&!this._ignoreCommands&&(this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.debugWireframe=this.debugWireframe,this._primitive.update(e))},R2.prototype.isDestroyed=function(){return!1},R2.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Qh(this)};var $2=R2;function e3(e,t){D.typeOf.object("normal",e),D.typeOf.number("distance",t),this._distance=t,this._normal=new t3(e,this),this.onChangeCallback=void 0,this.index=-1}function t3(e,t){this._clippingPlane=t,this._cartesian3=K.clone(e)}Object.defineProperties(e3.prototype,{distance:{get:function(){return this._distance},set:function(e){D.typeOf.number("value",e),C(this.onChangeCallback)&&e!==this._distance&&this.onChangeCallback(this.index),this._distance=e}},normal:{get:function(){return this._normal},set:function(e){D.typeOf.object("value",e),C(this.onChangeCallback)&&!K.equals(this._normal._cartesian3,e)&&this.onChangeCallback(this.index),K.clone(e,this._normal._cartesian3)}}}),e3.fromPlane=function(e,t){return D.typeOf.object("plane",e),C(t)?(t.normal=e.normal,t.distance=e.distance):t=new e3(e.normal,e.distance),t},e3.clone=function(e,t){return C(t)?(t.normal=e.normal,t.distance=e.distance,t):new e3(e.normal,e.distance)},Object.defineProperties(t3.prototype,{x:{get:function(){return this._cartesian3.x},set:function(e){D.typeOf.number("value",e),C(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.x&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.x=e}},y:{get:function(){return this._cartesian3.y},set:function(e){D.typeOf.number("value",e),C(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.y&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.y=e}},z:{get:function(){return this._cartesian3.z},set:function(e){D.typeOf.number("value",e),C(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.z&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.z=e}}});var n3=e3;function i3(e){e=R(e,R.EMPTY_OBJECT),this._planes=[],this._dirtyIndex=-1,this._multipleDirtyPlanes=!1,this._enabled=R(e.enabled,!0),this.modelMatrix=ft.clone(R(e.modelMatrix,ft.IDENTITY)),this.edgeColor=xy.clone(R(e.edgeColor,xy.WHITE)),this.edgeWidth=R(e.edgeWidth,0),this.planeAdded=new $n,this.planeRemoved=new $n,this._owner=void 0;const t=R(e.unionClippingRegions,!1);this._unionClippingRegions=t,this._testIntersection=t?o3:r3,this._uint8View=void 0,this._float32View=void 0,this._clippingPlanesTexture=void 0;const n=e.planes;if(C(n)){const e=n.length;for(let t=0;t<e;++t)this.add(n[t])}}function o3(e){return e===Ae.OUTSIDE}function r3(e){return e===Ae.INSIDE}function s3(e,t){e._multipleDirtyPlanes=e._multipleDirtyPlanes||-1!==e._dirtyIndex&&e._dirtyIndex!==t,e._dirtyIndex=t}function a3(e,t){const n=e.length;for(let i=0;i<n;++i)if(Gs.equals(e[i],t))return i;return-1}Object.defineProperties(i3.prototype,{length:{get:function(){return this._planes.length}},unionClippingRegions:{get:function(){return this._unionClippingRegions},set:function(e){this._unionClippingRegions!==e&&(this._unionClippingRegions=e,this._testIntersection=e?o3:r3)}},enabled:{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e)}},texture:{get:function(){return this._clippingPlanesTexture}},owner:{get:function(){return this._owner}},clippingPlanesState:{get:function(){return this._unionClippingRegions?this._planes.length:-this._planes.length}}}),i3.prototype.add=function(e){const t=this._planes.length,n=this;e.onChangeCallback=function(e){s3(n,e)},e.index=t,s3(this,t),this._planes.push(e),this.planeAdded.raiseEvent(e,t)},i3.prototype.get=function(e){return D.typeOf.number("index",e),this._planes[e]},i3.prototype.contains=function(e){return-1!==a3(this._planes,e)},i3.prototype.remove=function(e){const t=this._planes,n=a3(t,e);if(-1===n)return!1;e instanceof n3&&(e.onChangeCallback=void 0,e.index=-1);const i=t.length-1;for(let o=n;o<i;++o){const e=t[o+1];t[o]=e,e instanceof n3&&(e.index=o)}return this._multipleDirtyPlanes=!0,t.length=i,this.planeRemoved.raiseEvent(e,n),!0},i3.prototype.removeAll=function(){const e=this._planes,t=e.length;for(let n=0;n<t;++n){const t=e[n];t instanceof n3&&(t.onChangeCallback=void 0,t.index=-1),this.planeRemoved.raiseEvent(t,n)}this._multipleDirtyPlanes=!0,this._planes=[]};const c3=new Xe,l3=new Xe;function u3(e,t,n){const i=e._uint8View,o=e._planes;let r=0;for(let s=t;s<n;++s){const e=o[s],t=wh.octEncodeToCartesian4(e.normal,l3);i[r]=t.x,i[r+1]=t.y,i[r+2]=t.z,i[r+3]=t.w;const n=Xe.packFloat(e.distance,c3);i[r+4]=n.x,i[r+5]=n.y,i[r+6]=n.z,i[r+7]=n.w,r+=8}}function h3(e,t,n){const i=e._float32View,o=e._planes;let r=0;for(let s=t;s<n;++s){const e=o[s],t=e.normal;i[r]=t.x,i[r+1]=t.y,i[r+2]=t.z,i[r+3]=e.distance,r+=4}}function d3(e,t){const n=Ck.maximumTextureSize;return t.x=Math.min(e,n),t.y=Math.ceil(e/t.x),t}const f3=new ro;i3.prototype.update=function(e){let t=this._clippingPlanesTexture;const n=e.context,i=i3.useFloatTexture(n),o=i?this.length:2*this.length;if(C(t)){const e=t.width*t.height;(e<o||o<.25*e)&&(t.destroy(),t=void 0,this._clippingPlanesTexture=void 0)}if(0===this.length)return;if(!C(t)){const e=d3(o,f3);e.y*=2,i?(t=new Uk({context:n,width:e.x,height:e.y,pixelFormat:fD.RGBA,pixelDatatype:hD.FLOAT,sampler:Nk.NEAREST,flipY:!1}),this._float32View=new Float32Array(e.x*e.y*4)):(t=new Uk({context:n,width:e.x,height:e.y,pixelFormat:fD.RGBA,pixelDatatype:hD.UNSIGNED_BYTE,sampler:Nk.NEAREST,flipY:!1}),this._uint8View=new Uint8Array(e.x*e.y*4)),this._clippingPlanesTexture=t,this._multipleDirtyPlanes=!0}const r=this._dirtyIndex;if(this._multipleDirtyPlanes||-1!==r){if(this._multipleDirtyPlanes)i?(h3(this,0,this._planes.length),t.copyFrom({source:{width:t.width,height:t.height,arrayBufferView:this._float32View}})):(u3(this,0,this._planes.length),t.copyFrom({source:{width:t.width,height:t.height,arrayBufferView:this._uint8View}}));else{let e=0,n=0;i?(n=Math.floor(r/t.width),e=Math.floor(r-n*t.width),h3(this,r,r+1),t.copyFrom({source:{width:1,height:1,arrayBufferView:this._float32View},xOffset:e,yOffset:n})):(n=Math.floor(2*r/t.width),e=Math.floor(2*r-n*t.width),u3(this,r,r+1),t.copyFrom({source:{width:2,height:1,arrayBufferView:this._uint8View},xOffset:e,yOffset:n}))}this._multipleDirtyPlanes=!1,this._dirtyIndex=-1}};const p3=new ft,m3=new Gs(K.UNIT_X,0);i3.prototype.computeIntersectionWithBoundingVolume=function(e,t){const n=this._planes,i=n.length;let o=this.modelMatrix;C(t)&&(o=ft.multiply(t,o,p3));let r=Ae.INSIDE;!this.unionClippingRegions&&i>0&&(r=Ae.OUTSIDE);for(let s=0;s<i;++s){const t=n[s];Gs.transform(t,o,m3);const i=e.intersectPlane(m3);if(i===Ae.INTERSECTING)r=i;else if(this._testIntersection(i))return i}return r},i3.setOwner=function(e,t,n){if(e!==t[n]&&(t[n]=t[n]&&t[n].destroy(),C(e))){if(C(e._owner))throw new x("ClippingPlaneCollection should only be assigned to one object");e._owner=t,t[n]=e}},i3.useFloatTexture=function(e){return e.floatingPointTexture},i3.getTextureResolution=function(e,t,n){const i=e.texture;if(C(i))return n.x=i.width,n.y=i.height,n;const o=i3.useFloatTexture(t)?e.length:2*e.length,r=d3(o,n);return r.y*=2,r},i3.prototype.isDestroyed=function(){return!1},i3.prototype.destroy=function(){return this._clippingPlanesTexture=this._clippingPlanesTexture&&this._clippingPlanesTexture.destroy(),Qh(this)};var _3=i3;const g3={HIGHLIGHT:0,REPLACE:1,MIX:2,getColorBlend:function(e,t){return e===g3.HIGHLIGHT?0:e===g3.REPLACE?1:e===g3.MIX?z.clamp(t,z.EPSILON4,1):void 0}};var y3=Object.freeze(g3);function v3(){}function b3(e,t){const n=`runtime.${Object.keys(e.createdBufferViews).length}`,i=e.buffers,o=Object.keys(i).length;return i[o]=t,e.createdBufferViews[n]={buffer:o,byteOffset:0,byteLength:t.byteLength},n}function A3(e,t,n){const i=t._loadResources,o=b3(i,e);return i.vertexBuffersToCreate.enqueue(o),o}function w3(e,t,n){const i=e.typedArray,o=t._loadResources,r=b3(o,i);return o.indexBuffersToCreate.enqueue({id:r,componentType:ih.fromTypedArray(i)}),{bufferViewId:r,numberOfIndices:e.numberOfIndices}}function T3(e,t,n,i){if(!v3._taskProcessorReady)return;const o=n.primitivesToDecode.peek();if(!C(o))return;const r=e.scheduleTask(o,[o.array.buffer]);return C(r)?(n.activeDecodingTasks++,n.primitivesToDecode.dequeue(),r.then((function(e){n.activeDecodingTasks--;const r=w3(e.indexArray,t,i),s={},a=e.attributeData;for(const n in a)if(a.hasOwnProperty(n)){const e=a[n],o=e.array,r=A3(o,t,i),c=e.data;c.bufferView=r,s[n]=c}t._decodedData[`${o.mesh}.primitive.${o.primitive}`]={bufferView:r.bufferViewId,numberOfIndices:r.numberOfIndices,attributes:s}}))):void 0}v3._maxDecodingConcurrency=Math.max(Oc.hardwareConcurrency-1,1),v3._decoderTaskProcessor=void 0,v3._taskProcessorReady=!1,v3._getDecoderTaskProcessor=function(){if(!C(v3._decoderTaskProcessor)){const e=new ad("decodeDraco",v3._maxDecodingConcurrency);e.initWebAssemblyModule({modulePath:"ThirdParty/Workers/draco_decoder_nodejs.js",wasmBinaryFile:"ThirdParty/draco_decoder.wasm"}).then((function(){v3._taskProcessorReady=!0})),v3._decoderTaskProcessor=e}return v3._decoderTaskProcessor},v3.hasExtension=function(e){return C(e.extensionsRequired.KHR_draco_mesh_compression)||C(e.extensionsUsed.KHR_draco_mesh_compression)},v3._decodedModelResourceCache=void 0,v3.parse=function(e,t){if(!v3.hasExtension(e))return;const n=e._loadResources,i=e.cacheKey;if(C(i)){C(v3._decodedModelResourceCache)||(C(t.cache.modelDecodingCache)||(t.cache.modelDecodingCache={}),v3._decodedModelResourceCache=t.cache.modelDecodingCache);const e=v3._decodedModelResourceCache[i];if(C(e))return e.count++,void(n.pendingDecodingCache=!0)}const o=e._dequantizeInShader,r=e.gltf;AZ.mesh(r,(function(e,t){AZ.meshPrimitive(e,(function(e,i){if(!C(e.extensions))return;const s=e.extensions.KHR_draco_mesh_compression;if(!C(s))return;const a=r.bufferViews[s.bufferView],c=xF(r.buffers[a.buffer].extras._pipeline.source,a.byteOffset,a.byteOffset+a.byteLength);n.primitivesToDecode.enqueue({mesh:t,primitive:i,array:c,bufferView:a,compressedAttributes:s.attributes,dequantizeInShader:o})}))}))},v3.decodeModel=function(e,t){if(!v3.hasExtension(e))return Promise.resolve();const n=e._loadResources,i=e.cacheKey;if(C(i)&&C(v3._decodedModelResourceCache)){const t=v3._decodedModelResourceCache[i];if(C(t)&&n.pendingDecodingCache)return Promise.resolve(t.ready).then((function(){e._decodedData=t.data,n.pendingDecodingCache=!1}));v3._decodedModelResourceCache[i]={ready:!1,count:1,data:void 0}}if(0===n.primitivesToDecode.length)return Promise.resolve();const o=v3._getDecoderTaskProcessor(),r=[];let s=T3(o,e,n,t);while(C(s))r.push(s),s=T3(o,e,n,t);return Promise.all(r)},v3.decodePointCloud=function(e){const t=v3._getDecoderTaskProcessor();if(v3._taskProcessorReady)return t.scheduleTask(e,[e.buffer.buffer])},v3.decodeBufferView=function(e){const t=v3._getDecoderTaskProcessor();if(v3._taskProcessorReady)return t.scheduleTask(e,[e.array.buffer])},v3.cacheDataForModel=function(e){const t=e.cacheKey;if(C(t)&&C(v3._decodedModelResourceCache)){const n=v3._decodedModelResourceCache[t];C(n)&&(n.ready=!0,n.data=e._decodedData)}},v3.destroyCachedDataForModel=function(e){const t=e.cacheKey;if(C(t)&&C(v3._decodedModelResourceCache)){const e=v3._decodedModelResourceCache[t];C(e)&&0===--e.count&&delete v3._decodedModelResourceCache[t]}};var C3=v3;function E3(e,t,n){D.typeOf.string("samplerUniformName",e),D.typeOf.string("matrixUniformName",t),D.typeOf.string("styleUniformName",n);const i=`    float clipDistance = clip(gl_FragCoord, ${e}, ${t}); \n    vec4 clippingPlanesEdgeColor = vec4(1.0); \n    clippingPlanesEdgeColor.rgb = ${n}.rgb; \n    float clippingPlanesEdgeWidth = ${n}.a; \n    if (clipDistance > 0.0 && clipDistance < clippingPlanesEdgeWidth) \n    { \n        gl_FragColor = clippingPlanesEdgeColor;\n    } \n`;return i}var x3=E3;const S3=new ro;function I3(e,t){D.typeOf.object("clippingPlaneCollection",e),D.typeOf.object("context",t);const n=e.unionClippingRegions,i=e.length,o=_3.useFloatTexture(t),r=_3.getTextureResolution(e,t,S3),s=r.x,a=r.y;let c=o?P3(s,a):R3(s,a);return c+="\n",c+=n?O3(i):D3(i),c}function O3(e){const t=`float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix)\n{\n    vec4 position = czm_windowToEyeCoordinates(fragCoord);\n    vec3 clipNormal = vec3(0.0);\n    vec3 clipPosition = vec3(0.0);\n    float clipAmount;\n    float pixelWidth = czm_metersPerPixel(position);\n    bool breakAndDiscard = false;\n    for (int i = 0; i < ${e}; ++i)\n    {\n        vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);\n        clipNormal = clippingPlane.xyz;\n        clipPosition = -clippingPlane.w * clipNormal;\n        float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;\n        clipAmount = czm_branchFreeTernary(i == 0, amount, min(amount, clipAmount));\n        if (amount <= 0.0)\n        {\n           breakAndDiscard = true;\n           break;\n        }\n    }\n    if (breakAndDiscard) {\n        discard;\n    }\n    return clipAmount;\n}\n`;return t}function D3(e){const t=`float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix)\n{\n    bool clipped = true;\n    vec4 position = czm_windowToEyeCoordinates(fragCoord);\n    vec3 clipNormal = vec3(0.0);\n    vec3 clipPosition = vec3(0.0);\n    float clipAmount = 0.0;\n    float pixelWidth = czm_metersPerPixel(position);\n    for (int i = 0; i < ${e}; ++i)\n    {\n        vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);\n        clipNormal = clippingPlane.xyz;\n        clipPosition = -clippingPlane.w * clipNormal;\n        float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;\n        clipAmount = max(amount, clipAmount);\n        clipped = clipped && (amount <= 0.0);\n    }\n    if (clipped)\n    {\n        discard;\n    }\n    return clipAmount;\n}\n`;return t}function P3(e,t){const n=1/e,i=1/t;let o=`${n}`;-1===o.indexOf(".")&&(o+=".0");let r=`${i}`;-1===r.indexOf(".")&&(r+=".0");const s=`vec4 getClippingPlane(highp sampler2D packedClippingPlanes, int clippingPlaneNumber, mat4 transform)\n{\n    int pixY = clippingPlaneNumber / ${e};\n    int pixX = clippingPlaneNumber - (pixY * ${e});\n    float u = (float(pixX) + 0.5) * ${o};\n    float v = (float(pixY) + 0.5) * ${r};\n    vec4 plane = texture2D(packedClippingPlanes, vec2(u, v));\n    return czm_transformPlane(plane, transform);\n}\n`;return s}function R3(e,t){const n=1/e,i=1/t;let o=`${n}`;-1===o.indexOf(".")&&(o+=".0");let r=`${i}`;-1===r.indexOf(".")&&(r+=".0");const s=`vec4 getClippingPlane(highp sampler2D packedClippingPlanes, int clippingPlaneNumber, mat4 transform)\n{\n    int clippingPlaneStartIndex = clippingPlaneNumber * 2;\n    int pixY = clippingPlaneStartIndex / ${e};\n    int pixX = clippingPlaneStartIndex - (pixY * ${e});\n    float u = (float(pixX) + 0.5) * ${o};\n    float v = (float(pixY) + 0.5) * ${r};\n    vec4 oct32 = texture2D(packedClippingPlanes, vec2(u, v)) * 255.0;\n    vec2 oct = vec2(oct32.x * 256.0 + oct32.y, oct32.z * 256.0 + oct32.w);\n    vec4 plane;\n    plane.xyz = czm_octDecode(oct, 65535.0);\n    plane.w = czm_unpackFloat(texture2D(packedClippingPlanes, vec2(u + ${o}, v)));\n    return czm_transformPlane(plane, transform);\n}\n`;return s}var L3=I3;const M3={TEXTURE:0,PROGRAM:1,BUFFER:2,NUMBER_OF_JOB_TYPES:3};var B3=Object.freeze(M3);function N3(){}const F3=/^data\:/i;function z3(e,t){const n=e.gltf,i=n.buffers,o=n.bufferViews,r=o[t.bufferView],s=i[r.buffer],a=r.byteOffset+t.byteOffset,c=t.count*TZ(t.type),l=F3.test(s.uri)?"":s.uri;return`${e.cacheKey}//${l}/${a}/${c}`}const k3={};N3.getAnimationParameterValues=function(e,t){const n=z3(e,t);let i=k3[n];if(!C(i)){const o=e.gltf,r=o.buffers,s=o.bufferViews,a=s[t.bufferView],c=a.buffer,l=r[c],u=l.extras._pipeline.source,h=t.componentType,d=t.type,f=TZ(d),p=t.count,m=EZ(o,t);i=new Array(p);const _=R(t.byteOffset,0);let g=a.byteOffset+_;for(let e=0;e<p;e++){const t=ih.createArrayBufferView(h,u.buffer,u.byteOffset+g,f);"SCALAR"===d?i[e]=t[0]:"VEC3"===d?i[e]=K.fromArray(t):"VEC4"===d&&(i[e]=il.unpack(t)),g+=m}C(e.cacheKey)&&(k3[n]=i)}return i};const U3={};function V3(e,t,n){return`${e.cacheKey}//${t}/${n}`}function H3(e){this._value=e}function G3(e){this._spline=e,this._lastTimeIndex=0}H3.prototype.evaluate=function(e,t){return this._value},H3.prototype.wrapTime=function(e){return 0},H3.prototype.clampTime=function(e){return 0},G3.prototype.findTimeInterval=up.prototype.findTimeInterval,G3.prototype.evaluate=function(e,t){const n=this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex),i=this._spline.times,o=e>=i[n+1]?i[n+1]:i[n];return this._spline.evaluate(o,t)},Object.defineProperties(G3.prototype,{times:{get:function(){return this._spline.times}}}),G3.prototype.wrapTime=function(e){return this._spline.wrapTime(e)},G3.prototype.clampTime=function(e){return this._spline.clampTime(e)},N3.getAnimationSpline=function(e,t,n,i,o,r,s,a){const c=V3(e,t,i);let l=U3[c];if(!C(l)){const t=r,n=a;1===t.length&&1===n.length?l=new H3(n[0]):"LINEAR"!==o.interpolation&&"STEP"!==o.interpolation||("translation"===s||"scale"===s?l=new dp({times:t,points:n}):"rotation"===s?l=new HP({times:t,points:n}):"weights"===s&&(l=new CF({times:t,weights:n})),C(l)&&"STEP"===o.interpolation&&(l=new G3(l))),C(e.cacheKey)&&(U3[c]=l)}return l};const W3={};N3.getSkinInverseBindMatrices=function(e,t){const n=z3(e,t);let i=W3[n];if(!C(i)){const o=e.gltf,r=o.buffers,s=o.bufferViews,a=t.bufferView,c=s[a],l=c.buffer,u=r[l],h=u.extras._pipeline.source,d=t.componentType,f=t.type,p=t.count,m=EZ(o,t);let _=c.byteOffset+t.byteOffset;const g=TZ(f);if(i=new Array(p),d===th.FLOAT&&f===fh.MAT4)for(let e=0;e<p;++e){const t=ih.createArrayBufferView(d,h.buffer,h.byteOffset+_,g);i[e]=ft.fromArray(t),_+=m}W3[n]=i}return i};var q3=N3;const j3={NONE:0,REPEAT:1,MIRRORED_REPEAT:2};var Y3=Object.freeze(j3),K3=Object.freeze({STOPPED:0,ANIMATING:1});function X3(e,t,n){this._name=n.name,this._startTime=Ea.clone(e.startTime),this._delay=R(e.delay,0),this._stopTime=e.stopTime,this.removeOnStop=R(e.removeOnStop,!1),this._multiplier=R(e.multiplier,1),this._reverse=R(e.reverse,!1),this._loop=R(e.loop,Y3.NONE),this.start=new $n,this.update=new $n,this.stop=new $n,this._state=K3.STOPPED,this._runtimeAnimation=n,this._computedStartTime=void 0,this._duration=void 0;const i=this;this._raiseStartEvent=function(){i.start.raiseEvent(t,i)},this._updateEventTime=0,this._raiseUpdateEvent=function(){i.update.raiseEvent(t,i,i._updateEventTime)},this._raiseStopEvent=function(){i.stop.raiseEvent(t,i)}}Object.defineProperties(X3.prototype,{name:{get:function(){return this._name}},startTime:{get:function(){return this._startTime}},delay:{get:function(){return this._delay}},stopTime:{get:function(){return this._stopTime}},multiplier:{get:function(){return this._multiplier}},reverse:{get:function(){return this._reverse}},loop:{get:function(){return this._loop}}});var Q3=X3;function J3(e){this.animationAdded=new $n,this.animationRemoved=new $n,this._model=e,this._scheduledAnimations=[],this._previousTime=void 0}function Z3(e,t,n){const i=e._model,o=i._runtime.animations,r=o[t],s=new Q3(n,i,r);return e._scheduledAnimations.push(s),e.animationAdded.raiseEvent(i,s),s}function $3(e,t){const n=e.channelEvaluators,i=n.length;for(let o=0;o<i;++o)n[o](t)}Object.defineProperties(J3.prototype,{length:{get:function(){return this._scheduledAnimations.length}}}),J3.prototype.add=function(e){e=R(e,R.EMPTY_OBJECT);const t=this._model,n=t._runtime.animations;if(!C(n))throw new x("Animations are not loaded.  Wait for Model.readyPromise to resolve.");if(!C(e.name)&&!C(e.index))throw new x("Either options.name or options.index must be defined.");if(C(e.multiplier)&&e.multiplier<=0)throw new x("options.multiplier must be greater than zero.");if(C(e.index)&&(e.index>=n.length||e.index<0))throw new x("options.index must be a valid animation index.");if(C(e.index))return Z3(this,e.index,e);let i;const o=n.length;for(let r=0;r<o;++r)if(n[r].name===e.name){i=r;break}if(!C(i))throw new x("options.name must be a valid animation name.");return Z3(this,i,e)},J3.prototype.addAll=function(e){if(e=R(e,R.EMPTY_OBJECT),!C(this._model._runtime.animations))throw new x("Animations are not loaded.  Wait for Model.readyPromise to resolve.");if(C(e.multiplier)&&e.multiplier<=0)throw new x("options.multiplier must be greater than zero.");const t=[],n=this._model,i=n._runtime.animations,o=i.length;for(let r=0;r<o;++r)t.push(Z3(this,r,e));return t},J3.prototype.remove=function(e){if(C(e)){const t=this._scheduledAnimations,n=t.indexOf(e);if(-1!==n)return t.splice(n,1),this.animationRemoved.raiseEvent(this._model,e),!0}return!1},J3.prototype.removeAll=function(){const e=this._model,t=this._scheduledAnimations,n=t.length;this._scheduledAnimations=[];for(let i=0;i<n;++i)this.animationRemoved.raiseEvent(e,t[i])},J3.prototype.contains=function(e){return!!C(e)&&-1!==this._scheduledAnimations.indexOf(e)},J3.prototype.get=function(e){if(!C(e))throw new x("index is required.");return this._scheduledAnimations[e]};const e4=[];function t4(e,t,n){return function(){e.animationRemoved.raiseEvent(t,n)}}J3.prototype.update=function(e){const t=this._scheduledAnimations;let n=t.length;if(0===n)return this._previousTime=void 0,!1;if(Ea.equals(e.time,this._previousTime))return!1;this._previousTime=Ea.clone(e.time,this._previousTime);let i=!1;const o=e.time,r=this._model;for(let s=0;s<n;++s){const n=t[s],r=n._runtimeAnimation;C(n._computedStartTime)||(n._computedStartTime=Ea.addSeconds(R(n.startTime,o),n.delay,new Ea)),C(n._duration)||(n._duration=r.stopTime*(1/n.multiplier));const a=n._computedStartTime,c=n._duration,l=n.stopTime;let u=0!==c?Ea.secondsDifference(o,a)/c:0;0!==c&&C(l)&&Ea.greaterThan(o,l)&&(u=Ea.secondsDifference(l,a)/c);const h=u>=0,d=n.loop===Y3.REPEAT||n.loop===Y3.MIRRORED_REPEAT,f=(h||d&&!C(n.startTime))&&(u<=1||d)&&(!C(l)||Ea.lessThanOrEquals(o,l));if(f||n._state===K3.ANIMATING){if(f&&n._state===K3.STOPPED&&(n._state=K3.ANIMATING,n.start.numberOfListeners>0&&e.afterRender.push(n._raiseStartEvent)),n.loop===Y3.REPEAT)u-=Math.floor(u);else if(n.loop===Y3.MIRRORED_REPEAT){const e=Math.floor(u),t=u-e;u=e%2===1?1-t:t}n.reverse&&(u=1-u);let t=u*c*n.multiplier;t=z.clamp(t,r.startTime,r.stopTime),$3(r,t),n.update.numberOfListeners>0&&(n._updateEventTime=t,e.afterRender.push(n._raiseUpdateEvent)),i=!0,f||(n._state=K3.STOPPED,n.stop.numberOfListeners>0&&e.afterRender.push(n._raiseStopEvent),n.removeOnStop&&e4.push(n))}}n=e4.length;for(let s=0;s<n;++s){const n=e4[s];t.splice(t.indexOf(n),1),e.afterRender.push(t4(this,r,n))}return e4.length=0,i};var n4=J3;function i4(e,t,n){this._name=t.name,this._id=n,this._uniformMap=e._uniformMaps[n],this._technique=void 0,this._program=void 0,this._values=void 0}Object.defineProperties(i4.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}}}),i4.prototype.setValue=function(e,t){if(!C(e))throw new x("name is required.");const n=`u_${e}`,i=this._uniformMap.values[n];if(!C(i))throw new x("name must match a parameter name in the material's technique that is targetable and not optimized out.");i.value=i.clone(t,i.value)},i4.prototype.getValue=function(e){if(!C(e))throw new x("name is required.");const t=`u_${e}`,n=this._uniformMap.values[t];if(C(n))return n.value};var o4=i4;function r4(e,t,n){const i=[],o=e.primitives,r=o.length;for(let s=0;s<r;++s){const e=o[s];i[s]=t[e.material]}this._name=e.name,this._materials=i,this._id=n}Object.defineProperties(r4.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},materials:{get:function(){return this._materials}}});var s4=r4;function a4(e,t,n,i,o){this._model=e,this._runtimeNode=n,this._name=t.name,this._id=i,this.useMatrix=!1,this._show=!0,this._matrix=ft.clone(o),this._originalMatrix=ft.clone(o)}Object.defineProperties(a4.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},show:{get:function(){return this._show},set:function(e){this._show!==e&&(this._show=e,this._model._perNodeShowDirty=!0)}},matrix:{get:function(){return this._matrix},set:function(e){this._matrix=ft.clone(e,this._matrix),this.useMatrix=!0;const t=this._model;t._cesiumAnimationsDirty=!0,this._runtimeNode.dirtyNumber=t._maxDirtyNumber}},originalMatrix:{get:function(){return this._originalMatrix}}}),a4.prototype.setMatrix=function(e){ft.clone(e,this._matrix)};var c4=a4;const l4=65534;function u4(){}function h4(e,t,n,i,o){const r=o.vertexCopies,s=o.extraVertices,a=o.outlineCoordinates,c=e.gltf,l=c.meshes[t],u=l.primitives[n],h=c.accessors,d=c.bufferViews;let f;for(const S in u.attributes)if(u.attributes.hasOwnProperty(S)){const e=u.attributes[S],t=h[e];if(C(t)){f=t.count;break}}if(!C(f))return;const p=h[u.indices],m=d[p.bufferView],_=h[i],g=d[_.bufferView],y=e._loadResources,v=y.getBuffer(m),b=y.getBuffer(g);let A=5123===p.componentType?new Uint16Array(v.buffer,v.byteOffset+p.byteOffset,p.count):new Uint32Array(v.buffer,v.byteOffset+p.byteOffset,p.count);const w=5123===_.componentType?new Uint16Array(b.buffer,b.byteOffset+_.byteOffset,_.count):new Uint32Array(b.buffer,b.byteOffset+_.byteOffset,_.count),T=f,E=[T];let x;for(x=0;x<w.length;x+=2){const e=w[x],t=w[x+1],n=Math.min(e,t),i=Math.max(e,t);E[n*T+i]=1}for(x=0;x<A.length;x+=3){let t=A[x],n=A[x+1],i=A[x+2];const o=!1,l=o||m4(E,t,n),u=o||m4(E,n,i),h=o||m4(E,i,t);let d=p4(a,t,n,i,l,u,h);while(d>=0){let o;if(o=d===t?r[t]:d===n?r[n]:r[i],void 0===o){o=f+s.length;let e=d;while(e>=f)e=s[e-f];s.push(e),r[d]=o}o>l4&&A instanceof Uint16Array&&(A=new Uint32Array(A),p.componentType=5125,m.buffer=c.buffers.push({byteLength:A.byteLength,extras:{_pipeline:{source:A.buffer}}})-1,m.byteLength=A.byteLength,m.byteOffset=0,e._loadResources.buffers[m.buffer]=new Uint8Array(A.buffer,0,A.byteLength),y.indexBuffersToCreate._array.forEach((function(e){e.id===p.bufferView&&(e.componentType=p.componentType)}))),d===t?(t=o,A[x]=o):d===n?(n=o,A[x+1]=o):(i=o,A[x+2]=o),C(p.max)&&(p.max[0]=Math.max(p.max[0],o)),d=p4(a,t,n,i,l,u,h)}}}function d4(e,t,n,i,o){const r=3*t,s=e[r],a=e[r+1],c=e[r+2];return void 0===s?63:((s===n&&a===i&&c===o)<<0)+((s===n&&a===o&&c===i)<<1)+((s===i&&a===n&&c===o)<<2)+((s===i&&a===o&&c===n)<<3)+((s===o&&a===n&&c===i)<<4)+((s===o&&a===i&&c===n)<<5)}function f4(e){return(1&e)+(e>>1&1)+(e>>2&1)+(e>>3&1)+(e>>4&1)+(e>>5&1)}function p4(e,t,n,i,o,r,s){const a=s?1:0,c=o?1:0,l=0,u=d4(e,t,a,c,l);if(0===u)return t;const h=0,d=o?1:0,f=r?1:0,p=d4(e,n,h,d,f);if(0===p)return n;const m=s?1:0,_=0,g=r?1:0,y=d4(e,i,m,_,g);if(0===y)return i;const v=u&p&y;let b,A,w;if(1&v)b=0,A=1,w=2;else if(2&v)b=0,w=1,A=2;else if(4&v)A=0,b=1,w=2;else if(8&v)A=0,w=1,b=2;else if(16&v)w=0,b=1,A=2;else{if(!(32&v)){const e=f4(u),o=f4(p),r=f4(y);return e<o&&e<r?t:o<r?n:i}w=0,A=1,b=2}const T=3*t;e[T+b]=a,e[T+A]=c,e[T+w]=l;const C=3*n;e[C+b]=h,e[C+A]=d,e[C+w]=f;const E=3*i;return e[E+b]=m,e[E+A]=_,e[E+w]=g,-1}function m4(e,t,n){const i=e[0],o=Math.min(t,n)*i+Math.max(t,n);return 1===e[o]}function _4(e){const t=new Uint8Array(e);return t[e-1]=192,8===e?t[e-1]=96:4===e?t[e-1]=48:2===e?t[e-1]=24:1===e&&(t[e-1]=12),t}function g4(e,t){const n=e.gltf,i=e._loadResources;let o,r;for(o=0;o<t.length;++o){const s=t[o],a=s.extras._pipeline.vertexNumberingScope;s.extras._pipeline.vertexNumberingScope=void 0;const c=a.extraVertices,l=i.getBuffer(s),u=s.byteStride||4,h=c.length,d=new Uint8Array(l.byteLength+h*u);for(d.set(l),r=0;r<h;++r){const e=c[r]*u,t=l.length+r*u;for(let n=0;n<u;++n)d[t+n]=d[e+n]}s.byteOffset=0,s.byteLength=d.byteLength;const f=n.buffers.push({byteLength:d.byteLength,extras:{_pipeline:{source:d.buffer}}})-1;s.buffer=f,i.buffers[f]=d;const p=a.accessors;for(r=0;r<p.length;++r){const e=p[r];n.accessors[e].count+=h}if(!a.createdOutlines){const t=a.outlineCoordinates,n=new Float32Array(t),o=e.gltf.buffers.push({byteLength:n.byteLength,extras:{_pipeline:{source:n.buffer}}})-1;i.buffers[o]=new Uint8Array(n.buffer,0,n.byteLength);const s=e.gltf.bufferViews.push({buffer:o,byteLength:n.byteLength,byteOffset:0,byteStride:3*Float32Array.BYTES_PER_ELEMENT,target:34962})-1,c=e.gltf.accessors.push({bufferView:s,byteOffset:0,componentType:5126,count:n.length/3,type:"VEC3",min:[0,0,0],max:[1,1,1]})-1,l=a.primitives;for(r=0;r<l.length;++r)l[r].attributes._OUTLINE_COORDINATES=c;i.vertexBuffersToCreate.enqueue(s),a.createdOutlines=!0}}}function y4(e){const t=e.gltf,n=e._loadResources;let i;for(i=0;i<t.buffers.length;++i){const e=t.buffers[i],o=t.bufferViews.filter(v4.bind(void 0,i)),r=o.reduce((function(e,t){return e+t.byteLength}),0);if(r===e.byteLength)continue;const s=new Uint8Array(r);let a=0;for(let t=0;t<o.length;++t){const e=o[t],i=n.getBuffer(e);s.set(i,a),e.byteOffset=a,a+=i.byteLength}n.buffers[i]=s,e.extras._pipeline.source=s.buffer,e.byteLength=r}}function v4(e,t){return t.buffer===e}function b4(e,t){const n=t.attributes;if(void 0===n)return;const i=e.gltf;let o;for(const r in n){if(!n.hasOwnProperty(r))continue;const e=n[r],t=i.accessors[e],s=t.bufferView,a=i.bufferViews[s];if(C(a.extras)||(a.extras={}),C(a.extras._pipeline)||(a.extras._pipeline={}),C(a.extras._pipeline.vertexNumberingScope)){if(void 0!==o&&a.extras._pipeline.vertexNumberingScope!==o)return}else a.extras._pipeline.vertexNumberingScope=o||{vertexCopies:[],extraVertices:[],outlineCoordinates:[],accessors:[],bufferViews:[],primitives:[],createdOutlines:!1};o=a.extras._pipeline.vertexNumberingScope,o.bufferViews.indexOf(a)<0&&o.bufferViews.push(a),o.accessors.indexOf(e)<0&&o.accessors.push(e)}return o.primitives.push(t),o}u4.hasExtension=function(e){return C(e.extensionsRequired.CESIUM_primitive_outline)||C(e.extensionsUsed.CESIUM_primitive_outline)},u4.outlinePrimitives=function(e){if(!u4.hasExtension(e))return;const t=e.gltf,n=[];AZ.mesh(t,(function(t,i){AZ.meshPrimitive(t,(function(t,o){if(!C(t.extensions))return;const r=t.extensions.CESIUM_primitive_outline;if(!C(r))return;const s=b4(e,t);void 0!==s&&(n.indexOf(s)<0&&n.push(s),h4(e,i,o,r.indices,s))}))}));for(let i=0;i<n.length;++i)g4(e,n[i].bufferViews);y4(e)},u4.createTexture=function(e,t){let n=t.cache.modelOutliningCache;if(C(n)||(n=t.cache.modelOutliningCache={}),C(n.outlineTexture))return n.outlineTexture;const i=Math.min(4096,Ck.maximumTextureSize);let o=i;const r=_4(o),s=[];while(o>1)o>>=1,s.push(_4(o));const a=new Uk({context:t,source:{arrayBufferView:r,mipLevels:s},width:i,height:1,pixelFormat:fD.LUMINANCE,sampler:new Nk({wrapS:Mk.CLAMP_TO_EDGE,wrapT:Mk.CLAMP_TO_EDGE,minificationFilter:Rk.LINEAR_MIPMAP_LINEAR,magnificationFilter:Dk.LINEAR})});return n.outlineTexture=a,a};var A4=u4;const w4={LEFT:-1,NONE:0,RIGHT:1};var T4=Object.freeze(w4);const C4={modifyFragmentShader:function(e){return e=tq.replaceMain(e,"czm_splitter_main"),e+="uniform float czm_splitDirection; \nvoid main() \n{ \n#ifndef SHADOW_MAP\n    if (czm_splitDirection < 0.0 && gl_FragCoord.x > czm_splitPosition) discard; \n    if (czm_splitDirection > 0.0 && gl_FragCoord.x < czm_splitPosition) discard; \n#endif\n    czm_splitter_main(); \n} \n",e},addUniforms:function(e,t){t.czm_splitDirection=function(){return e.splitDirection}}};var E4=C4;const x4=new K,S4=P0.ModelState,I4="model/gltf-binary,model/gltf+json;q=0.8,application/json;q=0.2,*/*;q=0.01",O4=z.EPSILON16;function D4(e,t){e._cachedGltf=t}function P4(e){this._gltf=e.gltf,this.ready=e.ready,this.modelsToLoad=[],this.count=0}Object.defineProperties(P4.prototype,{gltf:{set:function(e){this._gltf=e},get:function(){return this._gltf}}}),P4.prototype.makeReady=function(e){this.gltf=e;const t=this.modelsToLoad,n=t.length;for(let i=0;i<n;++i){const e=t[i];e.isDestroyed()||D4(e,this)}this.modelsToLoad=void 0,this.ready=!0};const R4={},L4={};function M4(e){e=R(e,R.EMPTY_OBJECT);const t=e.cacheKey;let n;if(this._cacheKey=t,this._cachedGltf=void 0,this._releaseGltfJson=R(e.releaseGltfJson,!1),C(t)&&C(R4[t])&&R4[t].ready)n=R4[t],++n.count;else{let i=e.gltf;if(C(i)){if(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),i instanceof Uint8Array){const e=HZ(i);n=new P4({gltf:e,ready:!0})}else n=new P4({gltf:e.gltf,ready:!0});n.count=1,C(t)&&(R4[t]=n)}}D4(this,n);const i=R(e.basePath,"");this._resource=Vi.createIfNeeded(i);let o=e.credit;"string"===typeof o&&(o=new Tr(o)),this._credit=o,this._resourceCredits=[],this._gltfCredits=[],this._showCreditsOnScreen=R(e.showCreditsOnScreen,!1),this.show=R(e.show,!0),this.silhouetteColor=R(e.silhouetteColor,xy.RED),this._silhouetteColor=new xy,this._silhouetteColorPreviousAlpha=1,this._normalAttributeName=void 0,this.silhouetteSize=R(e.silhouetteSize,0),this.modelMatrix=ft.clone(R(e.modelMatrix,ft.IDENTITY)),this._modelMatrix=ft.clone(this.modelMatrix),this._clampedModelMatrix=void 0,this.scale=R(e.scale,1),this._scale=this.scale,this.minimumPixelSize=R(e.minimumPixelSize,0),this._minimumPixelSize=this.minimumPixelSize,this.maximumScale=e.maximumScale,this._maximumScale=this.maximumScale,this.id=e.id,this._id=e.id,this.heightReference=R(e.heightReference,Sz.NONE),this._heightReference=this.heightReference,this._heightChanged=!1,this._removeUpdateHeightCallback=void 0;const r=e.scene;this._scene=r,C(r)&&C(r.terrainProviderChanged)&&(this._terrainProviderChangedCallback=r.terrainProviderChanged.addEventListener((function(){this._heightChanged=!0}),this)),this._pickObject=e.pickObject,this._allowPicking=R(e.allowPicking,!0),this._ready=!1,this._readyPromise=yn(),this.activeAnimations=new n4(this),this.clampAnimations=R(e.clampAnimations,!0),this._defaultTexture=void 0,this._incrementallyLoadTextures=R(e.incrementallyLoadTextures,!0),this._asynchronous=R(e.asynchronous,!0),this.shadows=R(e.shadows,rj.ENABLED),this._shadows=this.shadows,this.color=xy.clone(R(e.color,xy.WHITE)),this._colorPreviousAlpha=1,this.colorBlendMode=R(e.colorBlendMode,y3.HIGHLIGHT),this.colorBlendAmount=R(e.colorBlendAmount,.5),this._colorShadingEnabled=!1,this._clippingPlanes=void 0,this.clippingPlanes=e.clippingPlanes,this._clippingPlanesState=0,this.referenceMatrix=void 0,this.backFaceCulling=R(e.backFaceCulling,!0),this.showOutline=R(e.showOutline,!0),this.splitDirection=R(e.splitDirection,T4.NONE),this._splittingEnabled=!1,this.debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=R(e.debugWireframe,!1),this._debugWireframe=!1,this._distanceDisplayCondition=e.distanceDisplayCondition,this._addBatchIdToGeneratedShaders=e.addBatchIdToGeneratedShaders,this._precreatedAttributes=e.precreatedAttributes,this._vertexShaderLoaded=e.vertexShaderLoaded,this._fragmentShaderLoaded=e.fragmentShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._pickIdLoaded=e.pickIdLoaded,this._ignoreCommands=R(e.ignoreCommands,!1),this._requestType=e.requestType,this._upAxis=R(e.upAxis,iJ.Y),this._gltfForwardAxis=iJ.Z,this._forwardAxis=e.forwardAxis,this.cull=R(e.cull,!0),this.opaquePass=R(e.opaquePass,HU.OPAQUE),this._computedModelMatrix=new ft,this._clippingPlanesMatrix=ft.clone(ft.IDENTITY),this._iblReferenceFrameMatrix=ke.clone(ke.IDENTITY),this._initialRadius=void 0,this._boundingSphere=void 0,this._scaledBoundingSphere=new nn,this._state=S4.NEEDS_LOAD,this._loadResources=void 0,this._mode=void 0,this._perNodeShowDirty=!1,this._cesiumAnimationsDirty=!1,this._dirty=!1,this._maxDirtyNumber=0,this._runtime={animations:void 0,articulationsByName:void 0,articulationsByStageKey:void 0,stagesByKey:void 0,rootNodes:void 0,nodes:void 0,nodesByName:void 0,skinnedNodes:void 0,meshesByName:void 0,materialsByName:void 0,materialsById:void 0},this._uniformMaps={},this._extensionsUsed=void 0,this._extensionsRequired=void 0,this._quantizedUniforms={},this._programPrimitives={},this._rendererResources={buffers:{},vertexArrays:{},programs:{},sourceShaders:{},silhouettePrograms:{},textures:{},samplers:{},renderStates:{}},this._cachedRendererResources=void 0,this._loadRendererResourcesFromCache=!1,this._dequantizeInShader=R(e.dequantizeInShader,!0),this._decodedData={},this._cachedGeometryByteLength=0,this._cachedTexturesByteLength=0,this._geometryByteLength=0,this._texturesByteLength=0,this._trianglesLength=0,this._pointsLength=0,this._sourceTechniques={},this._sourcePrograms={},this._quantizedVertexShaders={},this._nodeCommands=[],this._pickIds=[],this._rtcCenter=void 0,this._rtcCenterEye=void 0,this._rtcCenter3D=void 0,this._rtcCenter2D=void 0,this._sourceVersion=void 0,this._sourceKHRTechniquesWebGL=void 0,this._lightColor=K.clone(e.lightColor);const s=C(e.imageBasedLightingFactor)||C(e.luminanceAtZenith)||C(e.sphericalHarmonicCoefficients)||C(e.specularEnvironmentMaps);C(e.imageBasedLighting)?(this._imageBasedLighting=e.imageBasedLighting,this._shouldDestroyImageBasedLighting=!1):s?(UF("ImageBasedLightingConstructor","Individual image-based lighting parameters were deprecated in Cesium 1.92. They will be removed in version 1.94. Use options.imageBasedLighting instead."),this._imageBasedLighting=new ZQ({imageBasedLightingFactor:e.imageBasedLightingFactor,luminanceAtZenith:e.luminanceAtZenith,sphericalHarmonicCoefficients:e.sphericalHarmonicCoefficients,specularEnvironmentMaps:e.specularEnvironmentMaps}),this._shouldDestroyImageBasedLighting=!0):(this._imageBasedLighting=new ZQ,this._shouldDestroyImageBasedLighting=!0),this._shouldRegenerateShaders=!1}function B4(e){return e.stencilBuffer}function N4(e){return!xy.equals(e.color,xy.WHITE)||e.colorBlendMode!==y3.HIGHLIGHT}function F4(e){const t=e._clippingPlanes;return C(t)&&t.enabled&&0!==t.length}function z4(e){const t=WF(e);return"glTF"===t}function k4(e,t,n){if(e._state!==S4.LOADED)throw new x("The model is not loaded.  Use Model.readyPromise or wait for Model.ready to be true.");if(!C(n))throw new x("name is required.");return e._runtime[t][n]}Object.defineProperties(M4.prototype,{gltf:{get:function(){return C(this._cachedGltf)?this._cachedGltf.gltf:void 0}},releaseGltfJson:{get:function(){return this._releaseGltfJson}},cacheKey:{get:function(){return this._cacheKey}},basePath:{get:function(){return this._resource.url}},boundingSphere:{get:function(){if(this._state!==S4.LOADED)throw new x("The model is not loaded.  Use Model.readyPromise or wait for Model.ready to be true.");let e=this.modelMatrix;this.heightReference!==Sz.NONE&&this._clampedModelMatrix&&(e=this._clampedModelMatrix);const t=ft.getScale(e,x4),n=C(this.maximumScale)?Math.min(this.maximumScale,this.scale):this.scale;K.multiplyByScalar(t,n,t);const i=this._scaledBoundingSphere;return i.center=K.multiplyComponents(this._boundingSphere.center,t,i.center),i.radius=K.maximumComponent(t)*this._initialRadius,C(this._rtcCenter)&&K.add(this._rtcCenter,i.center,i.center),i}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},asynchronous:{get:function(){return this._asynchronous}},allowPicking:{get:function(){return this._allowPicking}},incrementallyLoadTextures:{get:function(){return this._incrementallyLoadTextures}},pendingTextureLoads:{get:function(){return C(this._loadResources)?this._loadResources.pendingTextureLoads:0}},dirty:{get:function(){return this._dirty}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(C(e)&&e.far<=e.near)throw new x("far must be greater than near");this._distanceDisplayCondition=WT.clone(e,this._distanceDisplayCondition)}},extensionsUsed:{get:function(){return C(this._extensionsUsed)||(this._extensionsUsed=P0.getUsedExtensions(this.gltf)),this._extensionsUsed}},extensionsRequired:{get:function(){return C(this._extensionsRequired)||(this._extensionsRequired=P0.getRequiredExtensions(this.gltf)),this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},forwardAxis:{get:function(){return C(this._forwardAxis)?this._forwardAxis:this._gltfForwardAxis}},trianglesLength:{get:function(){return this._trianglesLength}},pointsLength:{get:function(){return this._pointsLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return this._texturesByteLength}},cachedGeometryByteLength:{get:function(){return this._cachedGeometryByteLength}},cachedTexturesByteLength:{get:function(){return this._cachedTexturesByteLength}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){e!==this._clippingPlanes&&_3.setOwner(e,this,"_clippingPlanes")}},pickIds:{get:function(){return this._pickIds}},lightColor:{get:function(){return this._lightColor},set:function(e){const t=this._lightColor;e===t||K.equals(e,t)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||C(t)&&!C(e)||C(e)&&!C(t),this._lightColor=K.clone(e,t))}},imageBasedLighting:{get:function(){return this._imageBasedLighting},set:function(e){D.typeOf.object("imageBasedLighting",this._imageBasedLighting),e!==this._imageBasedLighting&&(this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=e,this._shouldDestroyImageBasedLighting=!1,this._shouldRegenerateShaders=!0)}},imageBasedLightingFactor:{get:function(){return this._imageBasedLighting.imageBasedLightingFactor},set:function(e){this._imageBasedLighting.imageBasedLightingFactor=e}},luminanceAtZenith:{get:function(){return this._imageBasedLighting.luminanceAtZenith},set:function(e){this._imageBasedLighting.luminanceAtZenith=e}},sphericalHarmonicCoefficients:{get:function(){return this._imageBasedLighting.sphericalHarmonicCoefficients},set:function(e){this._imageBasedLighting.sphericalHarmonicCoefficients=e}},specularEnvironmentMaps:{get:function(){return this._imageBasedLighting.specularEnvironmentMaps},set:function(e){this._imageBasedLighting.specularEnvironmentMaps=e}},credit:{get:function(){return this._credit}},showCreditsOnScreen:{get:function(){return this._showCreditsOnScreen},set:function(e){if(this._showCreditsOnScreen!==e){C(this._credit)&&(this._credit.showOnScreen=e);const t=this._resourceCredits.length;for(let i=0;i<t;i++)this._resourceCredits[i].showOnScreen=e;const n=this._gltfCredits.length;for(let i=0;i<n;i++)this._gltfCredits[i].showOnScreen=e}this._showCreditsOnScreen=e}}}),M4.silhouetteSupported=function(e){return B4(e.context)},M4.fromGltf=function(e){if(!C(e)||!C(e.url))throw new x("options.url is required");const t=e.url;e=pn(e);const n=Vi.createIfNeeded(t),i=R(e.basePath,n.clone()),o=Vi.createIfNeeded(i);let r=R(e.cacheKey,L4[un(n.url)]);C(r)||(r=wk(),L4[un(n.url)]=r),C(e.basePath)&&!C(e.cacheKey)&&(r+=o.url),e.cacheKey=r,e.basePath=o;const s=new M4(e);let a=R4[r];return C(a)?a.ready||(++a.count,a.modelsToLoad.push(s)):(a=new P4({ready:!1}),a.count=1,a.modelsToLoad.push(s),D4(s,a),R4[r]=a,C(n.headers.Accept)||(n.headers.Accept=I4),n.fetchArrayBuffer().then((function(e){const t=new Uint8Array(e);if(z4(t)){const e=HZ(t);a.makeReady(e)}else{const e=Fp(t);a.makeReady(e)}const i=s._resourceCredits,o=n.credits;if(C(o)){const e=o.length;for(let t=0;t<e;t++)i.push(o[t])}})).catch(P0.getFailedLoadFunction(s,"model",n.url))),s},M4._gltfCache=R4,M4.prototype.getNode=function(e){const t=k4(this,"nodesByName",e);return C(t)?t.publicNode:void 0},M4.prototype.getMesh=function(e){return k4(this,"meshesByName",e)},M4.prototype.getMaterial=function(e){return k4(this,"materialsByName",e)},M4.prototype.setArticulationStage=function(e,t){D.typeOf.number("value",t);const n=k4(this,"stagesByKey",e),i=k4(this,"articulationsByStageKey",e);C(n)&&C(i)&&(t=z.clamp(t,n.minimumValue,n.maximumValue),z.equalsEpsilon(n.currentValue,t,O4)||(n.currentValue=t,i.isDirty=!0))};const U4=new K,V4=new ke;function H4(e,t){D.typeOf.object("stage",e),D.typeOf.object("result",t);const n=e.currentValue,i=U4;let o;switch(e.type){case"xRotate":o=ke.fromRotationX(z.toRadians(n),V4),ft.multiplyByMatrix3(t,o,t);break;case"yRotate":o=ke.fromRotationY(z.toRadians(n),V4),ft.multiplyByMatrix3(t,o,t);break;case"zRotate":o=ke.fromRotationZ(z.toRadians(n),V4),ft.multiplyByMatrix3(t,o,t);break;case"xTranslate":i.x=n,i.y=0,i.z=0,ft.multiplyByTranslation(t,i,t);break;case"yTranslate":i.x=0,i.y=n,i.z=0,ft.multiplyByTranslation(t,i,t);break;case"zTranslate":i.x=0,i.y=0,i.z=n,ft.multiplyByTranslation(t,i,t);break;case"xScale":i.x=n,i.y=1,i.z=1,ft.multiplyByScale(t,i,t);break;case"yScale":i.x=1,i.y=n,i.z=1,ft.multiplyByScale(t,i,t);break;case"zScale":i.x=1,i.y=1,i.z=n,ft.multiplyByScale(t,i,t);break;case"uniformScale":ft.multiplyByUniformScale(t,n,t);break;default:break}return t}const G4=new ft;function W4(e){const t=e.gltf,n=e._loadResources;AZ.buffer(t,(function(e,t){n.buffers[t]=e.extras._pipeline.source}))}function q4(e,t){return function(n){const i=e._loadResources,o=new Uint8Array(n);--i.pendingBufferLoads,e.gltf.buffers[t].extras._pipeline.source=o}}function j4(e){const t=e.gltf.bufferViews,n=e._loadResources.vertexBuffersToCreate;AZ.bufferView(e.gltf,(function(e,t){e.target===th.ARRAY_BUFFER&&n.enqueue(t)}));const i=e._loadResources.indexBuffersToCreate,o={};AZ.accessor(e.gltf,(function(e){const n=e.bufferView;if(!C(n))return;const r=t[n];r.target!==th.ELEMENT_ARRAY_BUFFER||C(o[n])||(o[n]=!0,i.enqueue({id:n,componentType:e.componentType}))}))}function Y4(e){const t=e.gltf;if(!vZ(t,"KHR_techniques_webgl"))return;const n=e._sourcePrograms,i=e._sourceTechniques,o=t.extensions.KHR_techniques_webgl.programs;AZ.technique(t,(function(e,t){i[t]=pn(e);const r=e.program;C(n[r])||(n[r]=pn(o[r]))}))}function K4(e,t,n){return function(i){const o=e._loadResources;o.shaders[n]={source:i,type:t,bufferView:void 0},--o.pendingShaderLoads,e._rendererResources.sourceShaders[n]=i}}function X4(e){const t=e.gltf,n=t.buffers,i=t.bufferViews,o=e._rendererResources.sourceShaders;AZ.shader(t,(function(t,r){if(C(t.bufferView)){const e=t.bufferView,s=i[e],a=s.buffer,c=n[a],l=Bp(c.extras._pipeline.source,s.byteOffset,s.byteLength);o[r]=l}else if(C(t.extras._pipeline.source))o[r]=t.extras._pipeline.source;else{++e._loadResources.pendingShaderLoads;const n=e._resource.getDerivedResource({url:t.uri});n.fetchText().then(K4(e,t.type,r)).catch(P0.getFailedLoadFunction(e,"shader",n.url))}}))}function Q4(e){const t=e._sourceTechniques;for(const n in t)if(t.hasOwnProperty(n)){const i=t[n];e._loadResources.programsToCreate.enqueue({programId:i.program,techniqueId:n})}}function J4(e){const t={},n={},i={};e._runtime.articulationsByName=t,e._runtime.articulationsByStageKey=n,e._runtime.stagesByKey=i;const o=e.gltf;if(!vZ(o,"AGI_articulations")||!C(o.extensions)||!C(o.extensions.AGI_articulations))return;const r=o.extensions.AGI_articulations.articulations;if(!C(r))return;const s=r.length;for(let a=0;a<s;++a){const e=pn(r[a]);e.nodes=[],e.isDirty=!0,t[e.name]=e;const o=e.stages.length;for(let t=0;t<o;++t){const o=e.stages[t];o.currentValue=o.initialValue;const r=`${e.name} ${o.name}`;n[r]=e,i[r]=o}}}function Z4(e,t){return function(n){const i=e._loadResources;let o;--i.pendingTextureLoads,Array.isArray(n)&&(o=n.slice(1,n.length).map((function(e){return e.bufferView})),n=n[0]),i.texturesToCreate.enqueue({id:t,image:n,bufferView:n.bufferView,width:n.width,height:n.height,internalFormat:n.internalFormat,mipLevels:o})}}M4.prototype.applyArticulations=function(){const e=this._runtime.articulationsByName;for(const t in e)if(e.hasOwnProperty(t)){const n=e[t];if(n.isDirty){n.isDirty=!1;const e=n.nodes.length;for(let t=0;t<e;++t){const e=n.nodes[t];let i=ft.clone(e.originalMatrix,G4);const o=n.stages.length;for(let t=0;t<o;++t){const e=n.stages[t];i=H4(e,i)}e.matrix=i}}}};const $4=/(^data:image\/ktx2)|(\.ktx2$)/i;function e5(e,t,n){const i=e.gltf,o=i.images;let r;AZ.texture(i,(function(i,s){let a=i.source;C(i.extensions)&&C(i.extensions.EXT_texture_webp)&&n?a=i.extensions.EXT_texture_webp.source:C(i.extensions)&&C(i.extensions.KHR_texture_basisu)&&t.supportsBasis&&(a=i.extensions.KHR_texture_basisu.source);const c=o[a],l=c.bufferView,u=c.mimeType;if(r=c.uri,C(l))e._loadResources.texturesToCreateFromBufferView.enqueue({id:s,image:void 0,bufferView:l,mimeType:u});else{++e._loadResources.pendingTextureLoads;const t=e._resource.getDerivedResource({url:r});let n;n=$4.test(r)?XF(t):t.fetchImage({skipColorSpaceConversion:!0,preferImageBitmap:!0}),n.then(Z4(e,s,a)).catch(P0.getFailedLoadFunction(e,"image",t.url))}}))}const t5=new ft;function n5(e){const t={},n={},i=[],o=e._loadResources.skinnedNodesIds,r=e._runtime.articulationsByName;AZ.node(e.gltf,(function(s,a){const c={matrix:void 0,translation:void 0,rotation:void 0,scale:void 0,computedShow:!0,transformToRoot:new ft,computedMatrix:new ft,dirtyNumber:0,commands:[],inverseBindMatrices:void 0,bindShapeMatrix:void 0,joints:[],computedJointMatrices:[],jointName:s.jointName,weights:[],children:[],parents:[],publicNode:void 0};if(c.publicNode=new c4(e,s,c,a,P0.getTransform(s)),t[a]=c,n[s.name]=c,C(s.skin)&&(o.push(a),i.push(c)),C(s.extensions)&&C(s.extensions.AGI_articulations)){const e=s.extensions.AGI_articulations.articulationName;if(C(e)){let t=ft.clone(c.publicNode.originalMatrix,t5);const n=r[e];n.nodes.push(c.publicNode);const i=n.stages.length;for(let e=0;e<i;++e){const i=n.stages[e];t=H4(i,t)}c.publicNode.matrix=t}}})),e._runtime.nodes=t,e._runtime.nodesByName=n,e._runtime.skinnedNodes=i}function i5(e){const t=e.gltf,n=e._sourceTechniques,i={},o={},r=e._uniformMaps;AZ.material(t,(function(t,s){r[s]={uniformMap:void 0,values:void 0,jointMatrixUniformName:void 0,morphWeightsUniformName:void 0};const a=new o4(e,t,s);if(C(t.extensions)&&C(t.extensions.KHR_techniques_webgl)){const e=t.extensions.KHR_techniques_webgl.technique;a._technique=e,a._program=n[e].program,AZ.materialValue(t,(function(e,t){C(a._values)||(a._values={}),a._values[t]=pn(e)}))}i[t.name]=a,o[s]=a})),e._runtime.materialsByName=i,e._runtime.materialsById=o}function o5(e){const t={},n=e._runtime.materialsById;AZ.mesh(e.gltf,(function(i,o){t[i.name]=new s4(i,n,o),(C(e.extensionsUsed.WEB3D_quantized_attributes)||e._dequantizeInShader)&&AZ.meshPrimitive(i,(function(t,n){const i=f5(e,t);let r=e._programPrimitives[i];C(r)||(r={},e._programPrimitives[i]=r),r[`${o}.primitive.${n}`]=t}))})),e._runtime.meshesByName=t}function r5(e){const t=e.gltf.asset,n=t.copyright;if(!C(n))return;const i=e._showCreditsOnScreen,o=n.split(";").map((function(e){return new Tr(e.trim(),i)}));e._gltfCredits=o}const s5=function(){this.id=void 0,this.model=void 0,this.context=void 0};function a5(e,t,n){const i=t._loadResources,o=t.gltf.bufferViews;let r=o[e];C(r)||(r=i.createdBufferViews[e]);const s=hq.createVertexBuffer({context:n,typedArray:i.getBuffer(r),usage:lq.STATIC_DRAW});s.vertexArrayDestroyable=!1,t._rendererResources.buffers[e]=s,t._geometryByteLength+=s.sizeInBytes}s5.prototype.set=function(e,t,n){this.id=e,this.model=t,this.context=n},s5.prototype.execute=function(){a5(this.id,this.model,this.context)};const c5=function(){this.id=void 0,this.componentType=void 0,this.model=void 0,this.context=void 0};function l5(e,t,n,i){const o=n._loadResources,r=n.gltf.bufferViews;let s=r[e];C(s)||(s=o.createdBufferViews[e]);const a=hq.createIndexBuffer({context:i,typedArray:o.getBuffer(s),usage:lq.STATIC_DRAW,indexDatatype:t});a.vertexArrayDestroyable=!1,n._rendererResources.buffers[e]=a,n._geometryByteLength+=a.sizeInBytes}c5.prototype.set=function(e,t,n,i){this.id=e,this.componentType=t,this.model=n,this.context=i},c5.prototype.execute=function(){l5(this.id,this.componentType,this.model,this.context)};const u5=new s5,h5=new c5;function d5(e,t){const n=e._loadResources;if(0!==n.pendingBufferLoads)return;const i=t.context,o=n.vertexBuffersToCreate,r=n.indexBuffersToCreate;let s;if(e.asynchronous){while(o.length>0){if(u5.set(o.peek(),e,i),!t.jobScheduler.execute(u5,B3.BUFFER))break;o.dequeue()}while(r.length>0){if(s=r.peek(),h5.set(s.id,s.componentType,e,i),!t.jobScheduler.execute(h5,B3.BUFFER))break;r.dequeue()}}else{while(o.length>0)a5(o.dequeue(),e,i);while(r.length>0)s=r.dequeue(),l5(s.id,s.componentType,e,i)}}function f5(e,t){const n=e._runtime.materialsById[t.material];if(C(n))return n._program}function p5(e,t,n){let i;const o=n._programPrimitives[t];if(!C(o))return e;let r,s;for(r in o)if(o.hasOwnProperty(r)&&(i=o[r],f5(n,i)===t))break;if(n._programPrimitives[t]=void 0,n.extensionsUsed.WEB3D_quantized_attributes)s=P0.modifyShaderForQuantizedAttributes(n.gltf,i,e),n._quantizedUniforms[t]=s.uniforms;else{const t=n._decodedData[r];if(!C(t))return e;s=P0.modifyShaderForDracoQuantizedAttributes(n.gltf,i,e,t.attributes)}return s.shader}function m5(e){return e=tq.replaceMain(e,"gltf_blend_main"),e+="uniform vec4 gltf_color; \nuniform float gltf_colorBlend; \nvoid main() \n{ \n    gltf_blend_main(); \n    gl_FragColor.rgb = mix(gl_FragColor.rgb, gltf_color.rgb, gltf_colorBlend); \n    float highlight = ceil(gltf_colorBlend); \n    gl_FragColor.rgb *= mix(gltf_color.rgb, vec3(1.0), highlight); \n    gl_FragColor.a *= gltf_color.a; \n} \n",e}function _5(e,t,n){return C(n)&&(e=n(e,t)),e}const g5=function(){this.programToCreate=void 0,this.model=void 0,this.context=void 0};function y5(e,t,n){const i=e.programId,o=e.techniqueId,r=t._sourcePrograms[i],s=t._rendererResources.sourceShaders;let a=s[r.vertexShader];const c=s[r.fragmentShader],l=t._quantizedVertexShaders;if(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader){let e=l[i];C(e)||(e=p5(a,i,t),l[i]=e),a=e}const u=_5(a,i,t._vertexShaderLoaded);let h=_5(c,i,t._fragmentShaderLoaded);C(t._uniformMapLoaded)||(h=`uniform vec4 czm_pickColor;\n${h}`);const d=t._imageBasedLighting,f=d.enabled;if(f&&(h=`#define USE_IBL_LIGHTING \n\n${h}`),C(t._lightColor)&&(h=`#define USE_CUSTOM_LIGHT_COLOR \n\n${h}`),("2.0"!==t._sourceVersion||t._sourceKHRTechniquesWebGL)&&(h=tq.replaceMain(h,"non_gamma_corrected_main"),h=`${h}\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor = czm_gammaCorrect(gl_FragColor); \n} \n`),JQ.isSupported(n)){const e=d.useSphericalHarmonicCoefficients,t=d.useSpecularEnvironmentMaps,n=e||t||f;n&&(h=`uniform mat3 gltf_iblReferenceFrameMatrix; \n${h}`),C(d.sphericalHarmonicCoefficients)?h=`#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n${h}`:d.useDefaultSphericalHarmonics&&(h=`#define DIFFUSE_IBL \n${h}`),C(d.specularEnvironmentMapAtlas)&&d.specularEnvironmentMapAtlas.ready?h=`#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n${h}`:d.useDefaultSpecularMaps&&(h=`#define SPECULAR_IBL \n${h}`)}C(d.luminanceAtZenith)&&(h=`#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n${h}`),b5(i,o,h,u,t,n)}function v5(e,t,n){const i=e.programId,o=e.techniqueId,r=t._sourcePrograms[i],s=t._rendererResources.sourceShaders,a=t._quantizedVertexShaders,c=t.clippingPlanes,l=F4(t);let u=s[r.vertexShader];const h=s[r.fragmentShader];(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&(u=a[i]);let d=h;N4(t)&&(d=M4._modifyShaderForColor(d)),l&&(d=V6(d,c,n)),t.splitDirection!==T4.NONE&&(d=E4.modifyFragmentShader(d));const f=_5(u,i,t._vertexShaderLoaded);let p=_5(d,i,t._fragmentShaderLoaded);C(t._uniformMapLoaded)||(p=`uniform vec4 czm_pickColor;\n${p}`);const m=t._imageBasedLighting,_=m.enabled;if(_&&(p=`#define USE_IBL_LIGHTING \n\n${p}`),C(t._lightColor)&&(p=`#define USE_CUSTOM_LIGHT_COLOR \n\n${p}`),("2.0"!==t._sourceVersion||t._sourceKHRTechniquesWebGL)&&(p=tq.replaceMain(p,"non_gamma_corrected_main"),p=`${p}\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor = czm_gammaCorrect(gl_FragColor); \n} \n`),JQ.isSupported(n)){const e=m.useSphericalHarmonicCoefficients,t=m.useSpecularEnvironmentMaps,n=e||t||_;n&&(p=`uniform mat3 gltf_iblReferenceFrameMatrix; \n${p}`),C(m.sphericalHarmonicCoefficients)?p=`#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n${p}`:m.useDefaultSphericalHarmonics&&(p=`#define DIFFUSE_IBL \n${p}`),C(m.specularEnvironmentMapAtlas)&&m.specularEnvironmentMapAtlas.ready?p=`#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n${p}`:m.useDefaultSpecularMaps&&(p=`#define SPECULAR_IBL \n${p}`)}C(m.luminanceAtZenith)&&(p=`#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n${p}`),b5(i,o,p,f,t,n)}function b5(e,t,n,i,o,r){const s=o._sourceTechniques[t],a=P0.createAttributeLocations(s,o._precreatedAttributes);o._rendererResources.programs[e]=fH.fromCache({context:r,vertexShaderSource:i,fragmentShaderSource:n,attributeLocations:a})}g5.prototype.set=function(e,t,n){this.programToCreate=e,this.model=t,this.context=n},g5.prototype.execute=function(){y5(this.programToCreate,this.model,this.context)};const A5=new g5;function w5(e,t){const n=e._loadResources,i=n.programsToCreate;if(0!==n.pendingShaderLoads)return;if(0!==n.pendingBufferLoads)return;const o=t.context;if(e.asynchronous)while(i.length>0){if(A5.set(i.peek(),e,o),!t.jobScheduler.execute(A5,B3.PROGRAM))break;i.dequeue()}else while(i.length>0)y5(i.dequeue(),e,o)}function T5(e,t){return function(n){e.texturesToCreate.enqueue({id:t.id,image:n,bufferView:void 0}),--e.pendingBufferViewToImage}}function C5(e){const t=e._loadResources;if(0===t.pendingBufferLoads)while(t.texturesToCreateFromBufferView.length>0){const n=t.texturesToCreateFromBufferView.dequeue(),i=e.gltf,o=i.bufferViews[n.bufferView],r=i.textures[n.id].source,s=P0.getFailedLoadFunction(e,"image",`id: ${n.id}, bufferView: ${n.bufferView}`);if("image/ktx2"===n.mimeType){const i=new Uint8Array(t.getBuffer(o));XF(i).then(Z4(e,n.id,r)).catch(s),++e._loadResources.pendingTextureLoads}else{const e=T5(t,n);jF({uint8Array:t.getBuffer(o),format:n.mimeType,flipY:!1,skipColorSpaceConversion:!0}).then(e).catch(s),++t.pendingBufferViewToImage}}}function E5(e){const t=e._loadResources;if(t.createSamplers){t.createSamplers=!1;const n=e._rendererResources.samplers;AZ.sampler(e.gltf,(function(e,t){n[t]=new Nk({wrapS:e.wrapS,wrapT:e.wrapT,minificationFilter:e.minFilter,magnificationFilter:e.magFilter})}))}}const x5=function(){this.gltfTexture=void 0,this.model=void 0,this.context=void 0};function S5(e,t,n){const i=t.gltf.textures,o=i[e.id],r=t._rendererResources.samplers;let s=r[o.sampler];C(s)||(s=new Nk({wrapS:Mk.REPEAT,wrapT:Mk.REPEAT}));let a=!1;const c=t.gltf.materials,l=c.length;for(let v=0;v<l;++v){const t=c[v];if(C(t.extensions)&&C(t.extensions.KHR_techniques_webgl)){const n=t.extensions.KHR_techniques_webgl.values;for(const t in n)if(n.hasOwnProperty(t)&&-1!==t.indexOf("Texture")){const i=n[t];if(i.index===e.id&&C(i.extensions)&&C(i.extensions.KHR_texture_transform)){a=!0;break}}}if(a)break}const u=s.wrapS,h=s.wrapT;let d=s.minificationFilter;a&&d!==Rk.LINEAR&&d!==Rk.NEAREST&&(d=d===Rk.NEAREST_MIPMAP_NEAREST||d===Rk.NEAREST_MIPMAP_LINEAR?Rk.NEAREST:Rk.LINEAR,s=new Nk({wrapS:s.wrapS,wrapT:s.wrapT,minificationFilter:d,magnificationFilter:s.magnificationFilter}));const f=e.internalFormat,p=!(C(f)&&fD.isCompressedFormat(f))&&(d===Rk.NEAREST_MIPMAP_NEAREST||d===Rk.NEAREST_MIPMAP_LINEAR||d===Rk.LINEAR_MIPMAP_NEAREST||d===Rk.LINEAR_MIPMAP_LINEAR),m=p||u===Mk.REPEAT||u===Mk.MIRRORED_REPEAT||h===Mk.REPEAT||h===Mk.MIRRORED_REPEAT;let _,g,y=e.image;if(C(f)){_=!z.isPowerOfTwo(e.width)||!z.isPowerOfTwo(e.height),!n.webgl2&&fD.isCompressedFormat(f)&&_&&m&&console.warn("Compressed texture uses REPEAT or MIRRORED_REPEAT texture wrap mode and dimensions are not powers of two. The texture may be rendered incorrectly. See the Model.js constructor documentation for more information.");let t=s.minificationFilter;C(e.mipLevels)||d!==Rk.NEAREST_MIPMAP_NEAREST&&d!==Rk.NEAREST_MIPMAP_LINEAR?C(e.mipLevels)||d!==Rk.LINEAR_MIPMAP_NEAREST&&d!==Rk.LINEAR_MIPMAP_LINEAR||(t=Rk.LINEAR):t=Rk.NEAREST,s=new Nk({wrapS:s.wrapS,wrapT:s.wrapT,minificationFilter:t,magnificationFilter:s.magnificationFilter}),g=new Uk({context:n,source:{arrayBufferView:e.bufferView,mipLevels:e.mipLevels},width:e.width,height:e.height,pixelFormat:f,sampler:s})}else if(C(y)){if(_=!z.isPowerOfTwo(y.width)||!z.isPowerOfTwo(y.height),m&&_){const e=document.createElement("canvas");e.width=z.nextPowerOfTwo(y.width),e.height=z.nextPowerOfTwo(y.height);const t=e.getContext("2d");t.drawImage(y,0,0,y.width,y.height,0,0,e.width,e.height),y=e}g=new Uk({context:n,source:y,pixelFormat:o.internalFormat,pixelDatatype:o.type,sampler:s,flipY:!1,skipColorSpaceConversion:!0}),p&&g.generateMipmap()}C(g)&&(t._rendererResources.textures[e.id]=g,t._texturesByteLength+=g.sizeInBytes)}x5.prototype.set=function(e,t,n){this.gltfTexture=e,this.model=t,this.context=n},x5.prototype.execute=function(){S5(this.gltfTexture,this.model,this.context)};const I5=new x5;function O5(e,t){const n=t.context,i=e._loadResources.texturesToCreate;if(e.asynchronous)while(i.length>0){if(I5.set(i.peek(),e,n),!t.jobScheduler.execute(I5,B3.TEXTURE))break;i.dequeue()}else while(i.length>0)S5(i.dequeue(),e,n)}function D5(e,t){const n=e._sourceTechniques,i={};let o,r;const s=e._runtime.materialsById[t.material];if(!C(s))return i;const a=n[s._technique];if(!C(a))return i;const c=a.attributes,l=e._rendererResources.programs[a.program],u=l._attributeLocations;for(o in u)if(u.hasOwnProperty(o)){const e=c[o];C(e)&&(r=u[o],i[e.semantic]=r)}const h=e._precreatedAttributes;if(C(h))for(o in h)h.hasOwnProperty(o)&&(r=u[o],i[o]=r);return i}function P5(e,t){const n=e.gltf,i=n.skins,o=n.nodes,r=e._runtime.nodes,s=e._loadResources.skinnedNodesIds,a=s.length;for(let c=0;c<a;++c){const e=s[c],n=r[e],a=o[e],l=t[a.skin];n.inverseBindMatrices=l.inverseBindMatrices,n.bindShapeMatrix=l.bindShapeMatrix;const u=i[a.skin].joints,h=u.length;for(let t=0;t<h;++t){const e=u[t],i=r[e];n.joints.push(i)}}}function R5(e){const t=e._loadResources;if(0!==t.pendingBufferLoads)return;if(!t.createSkins)return;t.createSkins=!1;const n=e.gltf,i=n.accessors,o={};AZ.skin(n,(function(t,n){const r=i[t.inverseBindMatrices];let s;ft.equals(t.bindShapeMatrix,ft.IDENTITY)||(s=ft.clone(t.bindShapeMatrix)),o[n]={inverseBindMatrices:q3.getSkinInverseBindMatrices(e,r),bindShapeMatrix:s}})),P5(e,o)}function L5(e,t,n,i){return function(o){C(i)&&(o=e.clampAnimations?i.clampTime(o):i.wrapTime(o),t[n]=i.evaluate(o,t[n]),t.dirtyNumber=e._maxDirtyNumber)}}function M5(e){const t=e._loadResources;if(!t.finishedPendingBufferLoads())return;if(!t.createRuntimeAnimations)return;t.createRuntimeAnimations=!1,e._runtime.animations=[];const n=e._runtime.nodes,i=e.gltf.accessors;AZ.animation(e.gltf,(function(t,o){const r=t.channels,s=t.samplers;let a=Number.MAX_VALUE,c=-Number.MAX_VALUE;const l=r.length,u=new Array(l);for(let h=0;h<l;++h){const l=r[h],d=l.target,f=d.path,p=s[l.sampler],m=q3.getAnimationParameterValues(e,i[p.input]),_=q3.getAnimationParameterValues(e,i[p.output]);a=Math.min(a,m[0]),c=Math.max(c,m[m.length-1]);const g=q3.getAnimationSpline(e,o,t,l.sampler,p,m,f,_);u[h]=L5(e,n[d.node],d.path,g)}e._runtime.animations[o]={name:t.name,startTime:a,stopTime:c,channelEvaluators:u}}))}function B5(e,t){const n=e._loadResources;if(!n.finishedBuffersCreation()||!n.finishedProgramCreation()||!n.createVertexArrays)return;n.createVertexArrays=!1;const i=e._rendererResources.buffers,o=e._rendererResources.vertexArrays,r=e.gltf,s=r.accessors;AZ.mesh(r,(function(n,a){AZ.meshPrimitive(n,(function(n,c){const l=[];let u;const h=D5(e,n),d=e._decodedData[`${a}.primitive.${c}`];let f,p;AZ.meshPrimitiveAttribute(n,(function(e,t){if(u=h[t],C(u)){if(C(d)){const e=d.attributes;if(e.hasOwnProperty(t)){const n=e[t];return void l.push({index:u,vertexBuffer:i[n.bufferView],componentsPerAttribute:n.componentsPerAttribute,componentDatatype:n.componentDatatype,normalize:n.normalized,offsetInBytes:n.byteOffset,strideInBytes:n.byteStride})}}const n=s[e],o=C(n.normalized)&&n.normalized;l.push({index:u,vertexBuffer:i[n.bufferView],componentsPerAttribute:TZ(n.type),componentDatatype:n.componentType,normalize:o,offsetInBytes:n.byteOffset,strideInBytes:EZ(r,n)})}}));const m=e._precreatedAttributes;if(C(m))for(p in m)m.hasOwnProperty(p)&&(u=h[p],C(u)&&(f=m[p],f.index=u,l.push(f)));let _;if(C(n.indices)){const e=s[n.indices];let t=e.bufferView;C(d)&&(t=d.bufferView),_=i[t]}o[`${a}.primitive.${c}`]=new bq({context:t,attributes:l,indexBuffer:_})}))}))}function N5(e){const t=e._loadResources;t.createRenderStates&&(t.createRenderStates=!1,AZ.material(e.gltf,(function(t,n){F5(e,t,n)})))}function F5(e,t,n){const i=e._rendererResources.renderStates;let o=[th.FUNC_ADD,th.FUNC_ADD],r=[th.ONE,th.ONE_MINUS_SRC_ALPHA,th.ONE,th.ONE_MINUS_SRC_ALPHA];C(t.extensions)&&C(t.extensions.KHR_blend)&&(o=t.extensions.KHR_blend.blendEquation,r=t.extensions.KHR_blend.blendFactors);const s=!t.doubleSided,a="BLEND"===t.alphaMode;i[n]=yV.fromCache({cull:{enabled:s},depthTest:{enabled:!0,func:aq.LESS_OR_EQUAL},depthMask:!a,blending:{enabled:a,equationRgb:o[0],equationAlpha:o[1],functionSourceRgb:r[0],functionDestinationRgb:r[1],functionSourceAlpha:r[2],functionDestinationAlpha:r[3]}})}const z5={MODEL:function(e,t,n){return function(){return n.computedMatrix}},VIEW:function(e,t,n){return function(){return e.view}},PROJECTION:function(e,t,n){return function(){return e.projection}},MODELVIEW:function(e,t,n){const i=new ft;return function(){return ft.multiplyTransformation(e.view,n.computedMatrix,i)}},CESIUM_RTC_MODELVIEW:function(e,t,n){const i=new ft;return function(){return ft.multiplyTransformation(e.view,n.computedMatrix,i),ft.setTranslation(i,t._rtcCenterEye,i)}},MODELVIEWPROJECTION:function(e,t,n){const i=new ft;return function(){return ft.multiplyTransformation(e.view,n.computedMatrix,i),ft.multiply(e._projection,i,i)}},MODELINVERSE:function(e,t,n){const i=new ft;return function(){return ft.inverse(n.computedMatrix,i)}},VIEWINVERSE:function(e,t){return function(){return e.inverseView}},PROJECTIONINVERSE:function(e,t,n){return function(){return e.inverseProjection}},MODELVIEWINVERSE:function(e,t,n){const i=new ft,o=new ft;return function(){return ft.multiplyTransformation(e.view,n.computedMatrix,i),ft.inverse(i,o)}},MODELVIEWPROJECTIONINVERSE:function(e,t,n){const i=new ft,o=new ft;return function(){return ft.multiplyTransformation(e.view,n.computedMatrix,i),ft.multiply(e._projection,i,i),ft.inverse(i,o)}},MODELINVERSETRANSPOSE:function(e,t,n){const i=new ft,o=new ke;return function(){return ft.inverse(n.computedMatrix,i),ft.getMatrix3(i,o),ke.transpose(o,o)}},MODELVIEWINVERSETRANSPOSE:function(e,t,n){const i=new ft,o=new ft,r=new ke;return function(){return ft.multiplyTransformation(e.view,n.computedMatrix,i),ft.inverse(i,o),ft.getMatrix3(o,r),ke.transpose(r,r)}},VIEWPORT:function(e,t,n){return function(){return e.viewportCartesian4}}};function k5(e,t,n,i){const o=t._runtime.nodes[e];return z5[n](i,t,o)}function U5(e,t,n,i,o,r,s){const a={},c={};let l,u;return AZ.techniqueUniform(n,(function(n,h){let d;if(C(i)&&C(i[h]))d=P0.createUniformFunction(n.type,i[h],r,s),a[h]=d.func,c[h]=d;else if(C(n.node))a[h]=k5(n.node,e,n.semantic,o.uniformState);else if(C(n.semantic))if("JOINTMATRIX"===n.semantic)l=h;else if("MORPHWEIGHTS"===n.semantic)u=h;else if("ALPHACUTOFF"===n.semantic){const e=t.alphaMode;if(C(e)&&"MASK"===e){const e=R(t.alphaCutoff,.5);d=P0.createUniformFunction(n.type,e,r,s),a[h]=d.func,c[h]=d}}else a[h]=P0.getGltfSemanticUniforms()[n.semantic](o.uniformState,e);else if(C(n.value)){const e=P0.createUniformFunction(n.type,n.value,r,s);a[h]=e.func,c[h]=e}})),{map:a,values:c,jointMatrixUniformName:l,morphWeightsUniformName:u}}function V5(e,t){const n=e._loadResources;if(!n.finishedProgramCreation())return;if(!n.createUniformMaps)return;n.createUniformMaps=!1;const i=e.gltf,o=e._sourceTechniques,r=e._uniformMaps,s=e._rendererResources.textures,a=e._defaultTexture;AZ.material(i,(function(n,i){const c=e._runtime.materialsById[i],l=o[c._technique],u=c._values,h=U5(e,n,l,u,t,s,a),d=r[i];if(d.uniformMap=h.map,d.values=h.values,d.jointMatrixUniformName=h.jointMatrixUniformName,d.morphWeightsUniformName=h.morphWeightsUniformName,C(l.attributes.a_outlineCoordinates)){const n=A4.createTexture(e,t);d.uniformMap.u_outlineTexture=function(){return n}}}))}function H5(e){return P0.createUniformsForDracoQuantizedAttributes(e.attributes)}function G5(e,t){const n=f5(e,t),i=e._quantizedUniforms[n];return P0.createUniformsForQuantizedAttributes(e.gltf,t,i)}function W5(e){return function(){return e}}function q5(e){return function(){return e.computedJointMatrices}}function j5(e){return function(){return e.weights}}function Y5(e){return function(){return e.silhouetteColor}}function K5(e){return function(){return e.silhouetteSize}}function X5(e){return function(){return e.color}}function Q5(e){return function(){return e._clippingPlanesMatrix}}function J5(e){return function(){return e._iblReferenceFrameMatrix}}function Z5(e){return function(){const t=e.clippingPlanes;return C(t)&&t.enabled?t.texture:e._defaultTexture}}function $5(e){return function(){const t=e.clippingPlanes;if(!C(t))return xy.WHITE.withAlpha(0);const n=xy.clone(t.edgeColor);return n.alpha=t.edgeWidth,n}}function e6(e){return function(){return y3.getColorBlend(e.colorBlendMode,e.colorBlendAmount)}}function t6(e){return function(){return e._imageBasedLighting.imageBasedLightingFactor}}function n6(e){return function(){return e._lightColor}}function i6(e){return function(){return e._imageBasedLighting.luminanceAtZenith}}function o6(e){return function(){return e._imageBasedLighting.sphericalHarmonicCoefficients}}function r6(e){return function(){return e._imageBasedLighting.specularEnvironmentMapAtlas.texture}}function s6(e){return function(){return e._imageBasedLighting.specularEnvironmentMapAtlas.texture.dimensions}}function a6(e){return function(){return e._imageBasedLighting.specularEnvironmentMapAtlas.maximumMipmapLevel}}function c6(e,t){switch(e.mode){case xf.TRIANGLES:return t/3;case xf.TRIANGLE_STRIP:case xf.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function l6(e,t,n,i,o){const r=e._nodeCommands,s=e._pickIds,a=e.allowPicking,c=e._runtime.meshesByName,l=e._rendererResources,u=l.vertexArrays,h=l.programs,d=l.renderStates,f=e._uniformMaps,p=e.gltf,m=p.accessors,_=p.meshes,g=t.mesh,y=_[g],v=y.primitives,b=v.length;for(let A=0;A<b;++A){const t=v[A],l=m[t.indices],_=e._runtime.materialsById[t.material],b=_._program,w=e._decodedData[`${g}.primitive.${A}`];let T;const E=t.attributes.POSITION;if(C(E)){const e=P0.getAccessorMinMax(p,E);T=nn.fromCornerPoints(K.fromArray(e.min),K.fromArray(e.max))}const x=u[`${g}.primitive.${A}`];let S,I;if(C(w))I=w.numberOfIndices,S=0;else if(C(l))I=l.count,S=l.byteOffset/fd.getSizeInBytes(l.componentType);else{const e=m[t.attributes.POSITION];I=e.count,S=0}e._trianglesLength+=c6(t,I),t.mode===xf.POINTS&&(e._pointsLength+=I);const O=f[t.material];let D=O.uniformMap;if(C(O.jointMatrixUniformName)){const e={};e[O.jointMatrixUniformName]=q5(n),D=_n(D,e)}if(C(O.morphWeightsUniformName)){const e={};e[O.morphWeightsUniformName]=j5(n),D=_n(D,e)}D=_n(D,{gltf_color:X5(e),gltf_colorBlend:e6(e),gltf_clippingPlanes:Z5(e),gltf_clippingPlanesEdgeStyle:$5(e),gltf_clippingPlanesMatrix:Q5(e),gltf_iblReferenceFrameMatrix:J5(e),gltf_iblFactor:t6(e),gltf_lightColor:n6(e),gltf_sphericalHarmonicCoefficients:o6(e),gltf_specularMap:r6(e),gltf_specularMapSize:s6(e),gltf_maxSpecularLOD:a6(e),gltf_luminanceAtZenith:i6(e)}),E4.addUniforms(e,D),C(e._uniformMapLoaded)&&(D=e._uniformMapLoaded(D,b,n));let P={};e.extensionsUsed.WEB3D_quantized_attributes?P=G5(e,t):e._dequantizeInShader&&C(w)&&(P=H5(w)),D=_n(D,P);const R=d[t.material],L=R.blending.enabled;let M=e._pickObject;C(M)||(M={primitive:e,id:e.id,node:n.publicNode,mesh:c[y.name]});const B=rj.castShadows(e._shadows),N=rj.receiveShadows(e._shadows);let F;if(a&&!C(e._uniformMapLoaded)){F=i.createPickId(M),s.push(F);const e={czm_pickColor:W5(F.color)};D=_n(D,e)}a&&(F=C(e._pickIdLoaded)&&C(e._uniformMapLoaded)?e._pickIdLoaded():"czm_pickColor");const z=new UU({boundingVolume:new nn,cull:e.cull,modelMatrix:new ft,primitiveType:t.mode,vertexArray:x,count:I,offset:S,shaderProgram:h[b],castShadows:B,receiveShadows:N,uniformMap:D,renderState:R,owner:M,pass:L?HU.TRANSLUCENT:e.opaquePass,pickId:F});let k;o||(k=UU.shallowClone(z),k.boundingVolume=new nn,k.modelMatrix=new ft);const U={show:!0,boundingSphere:T,command:z,command2D:k,silhouetteModelCommand:void 0,silhouetteModelCommand2D:void 0,silhouetteColorCommand:void 0,silhouetteColorCommand2D:void 0,translucentCommand:void 0,translucentCommand2D:void 0,disableCullingCommand:void 0,disableCullingCommand2D:void 0,programId:b};n.commands.push(U),r.push(U)}}function u6(e,t,n){const i=e._loadResources;if(!i.finishedEverythingButTextureCreation())return;if(!i.createRuntimeNodes)return;i.createRuntimeNodes=!1;const o=[],r=e._runtime.nodes,s=e.gltf,a=s.nodes,c=s.scenes[s.scene],l=c.nodes,u=l.length,h=[],d={};for(let f=0;f<u;++f){h.push({parentRuntimeNode:void 0,gltfNode:a[l[f]],id:l[f]});while(h.length>0){const i=h.pop();d[i.id]=!0;const s=i.parentRuntimeNode,c=i.gltfNode,l=r[i.id];if(0===l.parents.length)if(C(c.matrix))l.matrix=ft.fromColumnMajorArray(c.matrix);else{const e=c.rotation;l.translation=K.fromArray(c.translation),l.rotation=il.unpack(e),l.scale=K.fromArray(c.scale)}C(s)?(s.children.push(l),l.parents.push(s)):o.push(l),C(c.mesh)&&l6(e,c,l,t,n);const u=c.children;if(C(u)){const e=u.length;for(let t=0;t<e;t++){const e=u[t];d[e]||h.push({parentRuntimeNode:l,gltfNode:a[e],id:u[t]})}}}}e._runtime.rootNodes=o,e._runtime.nodes=r}function h6(e){let t=0;for(const n in e)e.hasOwnProperty(n)&&(t+=e[n].sizeInBytes);return t}function d6(e){let t=0;for(const n in e)e.hasOwnProperty(n)&&(t+=e[n].sizeInBytes);return t}function f6(e,t){const n=t.context,i=t.scene3DOnly,o=e._quantizedVertexShaders,r=e._sourceTechniques,s=e._sourcePrograms,a=e._rendererResources;let c=a.sourceShaders;e._loadRendererResourcesFromCache&&(c=a.sourceShaders=e._cachedRendererResources.sourceShaders);for(const l in r)if(r.hasOwnProperty(l)){const t=r[l].program,i=s[t];let a=c[i.vertexShader];if(P0.checkSupportedGlExtensions(i.glExtensions,n),e.extensionsUsed.WEB3D_quantized_attributes||e._dequantizeInShader){let n=o[t];C(n)||(n=p5(a,t,e),o[t]=n),a=n}a=_5(a,t,e._vertexShaderLoaded)}if(e._loadRendererResourcesFromCache){const t=e._cachedRendererResources;a.buffers=t.buffers,a.vertexArrays=t.vertexArrays,a.programs=t.programs,a.silhouettePrograms=t.silhouettePrograms,a.textures=t.textures,a.samplers=t.samplers,a.renderStates=t.renderStates,C(e._precreatedAttributes)&&B5(e,n),e._cachedGeometryByteLength+=h6(t.buffers),e._cachedTexturesByteLength+=d6(t.textures)}else d5(e,t),w5(e,t),E5(e,n),C5(e),O5(e,t);R5(e),M5(e),e._loadRendererResourcesFromCache||(B5(e,n),N5(e)),V5(e,n),u6(e,n,i)}function p6(e,t){const n=e.publicNode,i=n.matrix;n.useMatrix&&C(i)?ft.clone(i,t):C(e.matrix)?ft.clone(e.matrix,t):(ft.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t),n.setMatrix(t))}const m6=[],_6=new Xe,g6=new ft;function y6(e,t,n,i){const o=e._maxDirtyNumber,r=e._runtime.rootNodes,s=r.length,a=m6;let c=e._computedModelMatrix;if(e._mode!==ij.SCENE3D&&!e._ignoreCommands){const t=ft.getColumn(c,3,_6);if(Xe.equals(t,Xe.UNIT_W)){const t=e.boundingSphere.center,n=Kl.wgs84To2DModelMatrix(i,t,g6);c=ft.multiply(n,c,g6),C(e._rtcCenter)&&(ft.setTranslation(c,Xe.UNIT_W,c),e._rtcCenter=e._rtcCenter2D)}else c=Kl.basisTo2D(i,c,g6),e._rtcCenter=e._rtcCenter3D}for(let l=0;l<s;++l){let s=r[l];p6(s,s.transformToRoot),a.push(s);while(a.length>0){s=a.pop();const r=s.transformToRoot,l=s.commands;if(s.dirtyNumber===o||t||n){const t=ft.multiplyTransformation(c,r,s.computedMatrix),n=l.length;if(n>0)for(let o=0;o<n;++o){const n=l[o];let r=n.command;ft.clone(t,r.modelMatrix),nn.transform(n.boundingSphere,r.modelMatrix,r.boundingVolume),C(e._rtcCenter)&&K.add(e._rtcCenter,r.boundingVolume.center,r.boundingVolume.center),r=n.command2D,C(r)&&e._mode===ij.SCENE2D&&(ft.clone(t,r.modelMatrix),r.modelMatrix[13]-=2*z.sign(r.modelMatrix[13])*z.PI*i.ellipsoid.maximumRadius,nn.transform(n.boundingSphere,r.modelMatrix,r.boundingVolume))}}const u=s.children;if(C(u)){const e=u.length;for(let t=0;t<e;++t){const e=u[t];e.dirtyNumber=Math.max(e.dirtyNumber,s.dirtyNumber),(e.dirtyNumber===o||n)&&(p6(e,e.transformToRoot),ft.multiplyTransformation(r,e.transformToRoot,e.transformToRoot)),a.push(e)}}}}++e._maxDirtyNumber}let v6=new ft;function b6(e){const t=e._runtime.skinnedNodes,n=t.length;for(let i=0;i<n;++i){const e=t[i];v6=ft.inverseTransformation(e.transformToRoot,v6);const n=e.computedJointMatrices,o=e.joints,r=e.bindShapeMatrix,s=e.inverseBindMatrices,a=s.length;for(let t=0;t<a;++t)C(n[t])||(n[t]=new ft),n[t]=ft.multiplyTransformation(v6,o[t].transformToRoot,n[t]),n[t]=ft.multiplyTransformation(n[t],s[t],n[t]),C(r)&&(n[t]=ft.multiplyTransformation(n[t],r,n[t]))}}function A6(e){const t=e._runtime.rootNodes,n=t.length,i=m6;for(let o=0;o<n;++o){let e=t[o];e.computedShow=e.publicNode.show,i.push(e);while(i.length>0){e=i.pop();const t=e.computedShow,n=e.commands,o=n.length;for(let e=0;e<o;++e)n[e].show=t;const r=e.children;if(C(r)){const e=r.length;for(let n=0;n<e;++n){const e=r[n];e.computedShow=t&&e.publicNode.show,i.push(e)}}}}}function w6(e,t){const n=e.id;if(e._id!==n){e._id=n;const t=e._pickIds,i=t.length;for(let e=0;e<i;++e)t[e].object.id=n}}function T6(e){if(e._debugWireframe!==e.debugWireframe){e._debugWireframe=e.debugWireframe;const t=e.debugWireframe?xf.LINES:xf.TRIANGLES,n=e._nodeCommands,i=n.length;for(let e=0;e<i;++e)n[e].command.primitiveType=t}}function C6(e){if(e.debugShowBoundingVolume!==e._debugShowBoundingVolume){e._debugShowBoundingVolume=e.debugShowBoundingVolume;const t=e.debugShowBoundingVolume,n=e._nodeCommands,i=n.length;for(let e=0;e<i;++e)n[e].command.debugShowBoundingVolume=t}}function E6(e){if(e.shadows!==e._shadows){e._shadows=e.shadows;const t=rj.castShadows(e.shadows),n=rj.receiveShadows(e.shadows),i=e._nodeCommands,o=i.length;for(let e=0;e<o;e++){const o=i[e];o.command.castShadows=t,o.command.receiveShadows=n}}}function x6(e,t){const n=pn(t,!0);return n.cull.enabled=!1,n.depthTest.enabled=!0,n.depthMask=!1,n.blending=_k.ALPHA_BLEND,e.opaquePass===HU.CESIUM_3D_TILE&&(n.stencilTest=FY.setCesium3DTileBit(),n.stencilMask=FY.CESIUM_3D_TILE_MASK),yV.fromCache(n)}function S6(e,t){const n=UU.shallowClone(t);return n.pass=HU.TRANSLUCENT,n.renderState=x6(e,t.renderState),n}function I6(e,t,n){const i=t.scene3DOnly,o=e.color.alpha;if(o>0&&o<1){const t=e._nodeCommands,o=t.length;if(o>0&&(!C(t[0].translucentCommand)||n))for(let n=0;n<o;++n){const o=t[n],r=o.command;if(o.translucentCommand=S6(e,r),!i){const t=o.command2D;o.translucentCommand2D=S6(e,t)}}}}function O6(e){const t=pn(e,!0);return t.cull.enabled=!1,yV.fromCache(t)}function D6(e){const t=UU.shallowClone(e);return t.renderState=O6(e.renderState),t}function P6(e,t,n){const i=t.scene3DOnly,o=e.backFaceCulling;if(!o){const t=e._nodeCommands,o=t.length;if(o>0&&(!C(t[0].disableCullingCommand)||n))for(let e=0;e<o;++e){const n=t[e],o=n.command;if(n.disableCullingCommand=D6(o),!i){const e=n.command2D;n.disableCullingCommand2D=D6(e)}}}}function R6(e,t){const n=e._rendererResources.programs;for(const i in n)if(n.hasOwnProperty(i)&&n[i]===t)return i}function L6(e,t,n){let i=t.vertexShaderSource.sources[0];const o=t._attributeLocations,r=e._normalAttributeName;i=tq.replaceMain(i,"gltf_silhouette_main"),i+=`uniform float gltf_silhouetteSize; \nvoid main() \n{ \n    gltf_silhouette_main(); \n    vec3 n = normalize(czm_normal3D * ${r}); \n    n.x *= czm_projection[0][0]; \n    n.y *= czm_projection[1][1]; \n    vec4 clip = gl_Position; \n    clip.xy += n.xy * clip.w * gltf_silhouetteSize * czm_pixelRatio / czm_viewport.z; \n    gl_Position = clip; \n}`;const s="uniform vec4 gltf_silhouetteColor; \nvoid main() \n{ \n    gl_FragColor = czm_gammaCorrect(gltf_silhouetteColor); \n}";return fH.fromCache({context:n.context,vertexShaderSource:i,fragmentShaderSource:s,attributeLocations:o})}function M6(e,t){return B4(t.context)&&e.silhouetteSize>0&&e.silhouetteColor.alpha>0&&C(e._normalAttributeName)}function B6(e){const t=e._nodeCommands,n=t.length;for(let i=0;i<n;++i){const e=t[i],n=e.command;if(n.pass===HU.TRANSLUCENT)return!0}return!1}function N6(e){return e.color.alpha>0&&e.color.alpha<1}function F6(e){return 0===e.color.alpha}function z6(e,t){return Math.floor(e)!==Math.floor(t)||Math.ceil(e)!==Math.ceil(t)}let k6=0;function U6(e,t){const n=++k6%255,i=B6(e)||N6(e)||e.silhouetteColor.alpha<1,o=e._rendererResources.silhouettePrograms,r=t.scene3DOnly,s=e._nodeCommands,a=s.length;for(let c=0;c<a;++c){const a=s[c],l=a.command,u=N6(e)?a.translucentCommand:l,h=UU.shallowClone(u);let d=pn(u.renderState);d.stencilTest={enabled:!0,frontFunction:th.ALWAYS,backFunction:th.ALWAYS,reference:n,mask:-1,frontOperation:{fail:th.KEEP,zFail:th.KEEP,zPass:th.REPLACE},backOperation:{fail:th.KEEP,zFail:th.KEEP,zPass:th.REPLACE}},F6(e)&&(d.colorMask={red:!1,green:!1,blue:!1,alpha:!1},d.depthMask=!1),d=yV.fromCache(d),h.renderState=d,a.silhouetteModelCommand=h;const f=UU.shallowClone(l);d=pn(l.renderState,!0),d.depthTest.enabled=!0,d.cull.enabled=!1,i&&(f.pass=HU.TRANSLUCENT,d.depthMask=!1,d.blending=_k.ALPHA_BLEND),d.stencilTest={enabled:!0,frontFunction:th.NOTEQUAL,backFunction:th.NOTEQUAL,reference:n,mask:-1,frontOperation:{fail:th.KEEP,zFail:th.KEEP,zPass:th.KEEP},backOperation:{fail:th.KEEP,zFail:th.KEEP,zPass:th.KEEP}},d=yV.fromCache(d);const p=l.shaderProgram,m=R6(e,p);let _=o[m];C(_)||(_=L6(e,p,t),o[m]=_);const g=_n(l.uniformMap,{gltf_silhouetteColor:Y5(e),gltf_silhouetteSize:K5(e)});if(f.renderState=d,f.shaderProgram=_,f.uniformMap=g,f.castShadows=!1,f.receiveShadows=!1,a.silhouetteColorCommand=f,!r){const e=a.command2D,t=UU.shallowClone(h);t.boundingVolume=e.boundingVolume,t.modelMatrix=e.modelMatrix,a.silhouetteModelCommand2D=t;const n=UU.shallowClone(f);t.boundingVolume=e.boundingVolume,t.modelMatrix=e.modelMatrix,a.silhouetteColorCommand2D=n}}}function V6(e,t,n){return e=tq.replaceMain(e,"gltf_clip_main"),e+=`${M4._getClippingFunction(t,n)}\n`,e+=`uniform highp sampler2D gltf_clippingPlanes; \nuniform mat4 gltf_clippingPlanesMatrix; \nuniform vec4 gltf_clippingPlanesEdgeStyle; \nvoid main() \n{ \n    gltf_clip_main(); \n${x3("gltf_clippingPlanes","gltf_clippingPlanesMatrix","gltf_clippingPlanesEdgeStyle")}} \n`,e}function H6(e,t,n){if(!M6(e,t))return;const i=e._nodeCommands,o=i.length>0&&(z6(e.color.alpha,e._colorPreviousAlpha)||z6(e.silhouetteColor.alpha,e._silhouetteColorPreviousAlpha)||!C(i[0].silhouetteModelCommand));e._colorPreviousAlpha=e.color.alpha,e._silhouetteColorPreviousAlpha=e.silhouetteColor.alpha,(o||n)&&U6(e,t)}function G6(e,t){const n=e._clippingPlanes;C(n)&&n.owner===e&&n.enabled&&n.update(t)}const W6=new nn;function q6(e,t,n){return W6.center=e,W6.radius=t,n.camera.getPixelSize(W6,n.context.drawingBufferWidth,n.context.drawingBufferHeight)}const j6=new K,Y6=new se;function K6(e,t){let n=e.scale;if(0!==e.minimumPixelSize){const i=t.context,o=Math.max(i.drawingBufferWidth,i.drawingBufferHeight),r=C(e._clampedModelMatrix)?e._clampedModelMatrix:e.modelMatrix;if(j6.x=r[12],j6.y=r[13],j6.z=r[14],C(e._rtcCenter)&&K.add(e._rtcCenter,j6,j6),e._mode!==ij.SCENE3D){const e=t.mapProjection,n=e.ellipsoid.cartesianToCartographic(j6,Y6);e.project(n,j6),K.fromElements(j6.z,j6.x,j6.y,j6)}const s=e.boundingSphere.radius,a=q6(j6,s,t),c=1/a,l=Math.min(c*(2*s),o);l<e.minimumPixelSize&&(n=e.minimumPixelSize*a/(2*e._initialRadius))}return C(e.maximumScale)?Math.min(e.maximumScale,n):n}function X6(e){C(e._cacheKey)&&C(e._cachedGltf)&&0===--e._cachedGltf.count&&delete R4[e._cacheKey],e._cachedGltf=void 0}function Q6(e,t){this.buffers=void 0,this.vertexArrays=void 0,this.programs=void 0,this.sourceShaders=void 0,this.silhouettePrograms=void 0,this.textures=void 0,this.samplers=void 0,this.renderStates=void 0,this.ready=!1,this.context=e,this.cacheKey=t,this.count=0}function J6(e){for(const t in e)e.hasOwnProperty(t)&&e[t].destroy()}function Z6(e){J6(e.buffers),J6(e.vertexArrays),J6(e.programs),J6(e.silhouettePrograms),J6(e.textures)}function $6(e,t,n){return function(i){if(e.heightReference===Sz.RELATIVE_TO_GROUND){const e=t.cartesianToCartographic(i,Y6);e.height+=n.height,t.cartographicToCartesian(e,i)}const o=e._clampedModelMatrix;ft.clone(e.modelMatrix,o),o[12]=i.x,o[13]=i.y,o[14]=i.z,e._heightChanged=!0}}function e8(e){C(e._removeUpdateHeightCallback)&&(e._removeUpdateHeightCallback(),e._removeUpdateHeightCallback=void 0);const t=e._scene;if(!C(t)||!C(t.globe)||e.heightReference===Sz.NONE){if(e.heightReference!==Sz.NONE)throw new x("Height reference is not supported without a scene and globe.");return void(e._clampedModelMatrix=void 0)}const n=t.globe,i=n.ellipsoid,o=e.modelMatrix;j6.x=o[12],j6.y=o[13],j6.z=o[14];const r=i.cartesianToCartographic(j6);C(e._clampedModelMatrix)||(e._clampedModelMatrix=ft.clone(o,new ft));const s=n._surface;e._removeUpdateHeightCallback=s.updateHeight(r,$6(e,i,r));const a=n.getHeight(r);if(C(a)){const t=$6(e,i,r);se.clone(r,Y6),Y6.height=a,i.cartographicToCartesian(Y6,j6),t(j6)}}Q6.prototype.release=function(){if(0===--this.count)return C(this.cacheKey)&&delete this.context.cache.modelRendererResourceCache[this.cacheKey],Z6(this),Qh(this)};const t8=new K,n8=new se;function i8(e,t){let n;const i=e.distanceDisplayCondition,o=i.near*i.near,r=i.far*i.far;if(t.mode===ij.SCENE2D){const e=t.camera.frustum.right-t.camera.frustum.left;n=.5*e,n*=n}else{let i=ft.getTranslation(e.modelMatrix,t8);if(t.mode===ij.COLUMBUS_VIEW){const e=t.mapProjection,n=e.ellipsoid,o=n.cartesianToCartographic(i,n8);i=e.project(o,i),K.fromElements(i.z,i.x,i.y,i)}n=K.distanceSquared(i,t.camera.positionWC)}return n>=o&&n<=r}const o8=new ft,r8=new ke,s8=new ft;function a8(e,t){e.programs!==t.programs&&J6(e.programs),e.silhouettePrograms!==t.silhouettePrograms&&J6(e.silhouettePrograms)}function c8(e,t){const n=e._rendererResources,i=e._cachedRendererResources;let o;if(a8(n,i),F4(e)||N4(e)||e.splitDirection!==T4.NONE||e._shouldRegenerateShaders){e._shouldRegenerateShaders=!1,n.programs={},n.silhouettePrograms={};const i={},r=e._sourceTechniques;let s;for(const n in r)r.hasOwnProperty(n)&&(s=r[n],o=s.program,i[o]||(i[o]=!0,v5({programId:o,techniqueId:n},e,t.context)))}else n.programs=i.programs,n.silhouettePrograms=i.silhouettePrograms;const r=n.programs,s=e._nodeCommands,a=s.length;for(let c=0;c<a;++c){const e=s[c];o=e.programId;const t=r[o];e.command.shaderProgram=t,C(e.command2D)&&(e.command2D.shaderProgram=t)}I6(e,t,!0),P6(e,t,!0),H6(e,t,!0)}M4.prototype.update=function(e){if(e.mode===ij.MORPHING)return;if(!Oc.supportsWebP.initialized)return void Oc.supportsWebP.initialize();const t=e.context;this._defaultTexture=t.defaultTexture;const n=Oc.supportsWebP();if(this._state===S4.NEEDS_LOAD&&C(this.gltf)){let n;const i=this.cacheKey;if(C(i)){t.cache.modelRendererResourceCache=R(t.cache.modelRendererResourceCache,{});const e=t.cache.modelRendererResourceCache;if(n=e[this.cacheKey],C(n)){if(!n.ready)return;++n.count,this._loadRendererResourcesFromCache=!0}else n=new Q6(t,i),n.count=1,e[this.cacheKey]=n;this._cachedRendererResources=n}else n=new Q6(t),n.count=1,this._cachedRendererResources=n;if(this._state=S4.LOADING,this._state!==S4.FAILED){const t=this.gltf.extensions;if(C(t)&&C(t.CESIUM_RTC)){const n=K.fromArray(t.CESIUM_RTC.center);if(!K.equals(n,K.ZERO)){this._rtcCenter3D=n;const t=e.mapProjection,i=t.ellipsoid,o=i.cartesianToCartographic(this._rtcCenter3D),r=t.project(o);K.fromElements(r.z,r.x,r.y,r),this._rtcCenter2D=r,this._rtcCenterEye=new K,this._rtcCenter=this._rtcCenter3D}}RZ(this.gltf),this._loadResources=new o0,this._loadRendererResourcesFromCache||P0.parseBuffers(this,q4)}}const i=this._loadResources,o=this._incrementallyLoadTextures;let r=!1;if(this._state===S4.LOADING){if(0===i.pendingBufferLoads){if(!i.initialized){if(e.brdfLutGenerator.update(e),P0.checkSupportedExtensions(this.extensionsRequired,n),P0.updateForwardAxis(this),!C(this.gltf.extras.sourceVersion)){const e=this.gltf;e.extras.sourceVersion=P0.getAssetVersion(e),e.extras.sourceKHRTechniquesWebGL=C(P0.getUsedExtensions(e).KHR_techniques_webgl),this._sourceVersion=e.extras.sourceVersion,this._sourceKHRTechniquesWebGL=e.extras.sourceKHRTechniquesWebGL,t0(e),OZ(e);const t={addBatchIdToGeneratedShaders:this._addBatchIdToGeneratedShaders};z0(e,t),K0(e,t)}this._sourceVersion=this.gltf.extras.sourceVersion,this._sourceKHRTechniquesWebGL=this.gltf.extras.sourceKHRTechniquesWebGL,this._dequantizeInShader=this._dequantizeInShader&&C3.hasExtension(this),W4(this),J4(this),Y4(this),this._loadRendererResourcesFromCache||(j4(this),X4(this),Q4(this),e5(this,t,n)),i5(this),o5(this),n5(this),r5(this),C3.parse(this,t),i.initialized=!0}i.finishedDecoding()||C3.decodeModel(this,t).catch(P0.getFailedLoadFunction(this,"model",this.basePath)),i.finishedDecoding()&&!i.resourcesParsed&&(this._boundingSphere=P0.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,C3.cacheDataForModel(this),i.resourcesParsed=!0),i.resourcesParsed&&0===i.pendingShaderLoads&&(this.showOutline&&A4.outlinePrimitives(this),f6(this,e))}(i.finished()||o&&i.finishedEverythingButTextureCreation())&&(this._state=S4.LOADED,r=!0)}if(C(i)&&this._state===S4.LOADED&&(o&&!r&&f6(this,e),i.finished())){this._loadResources=void 0;const e=this._rendererResources,t=this._cachedRendererResources;t.buffers=e.buffers,t.vertexArrays=e.vertexArrays,t.programs=e.programs,t.sourceShaders=e.sourceShaders,t.silhouettePrograms=e.silhouettePrograms,t.textures=e.textures,t.samplers=e.samplers,t.renderStates=e.renderStates,t.ready=!0,this._normalAttributeName=P0.getAttributeOrUniformBySemantic(this.gltf,"NORMAL"),C(this._precreatedAttributes)&&(t.vertexArrays={}),this.releaseGltfJson&&X6(this)}const s=M6(this,e),a=N6(this),c=F6(this),l=this.backFaceCulling,u=!C(this.distanceDisplayCondition)||i8(this,e),h=this.show&&u&&0!==this.scale&&(!c||s);if(this._imageBasedLighting.update(e),h&&this._state===S4.LOADED||r){const n=this.activeAnimations.update(e)||this._cesiumAnimationsDirty;this._cesiumAnimationsDirty=!1,this._dirty=!1;let i=this.modelMatrix;const o=e.mode!==this._mode;this._mode=e.mode;const s=!ft.equals(this._modelMatrix,i)||this._scale!==this.scale||this._minimumPixelSize!==this.minimumPixelSize||0!==this.minimumPixelSize||this._maximumScale!==this.maximumScale||this._heightReference!==this.heightReference||this._heightChanged||o;if(s||r){ft.clone(i,this._modelMatrix),e8(this),C(this._clampedModelMatrix)&&(i=this._clampedModelMatrix),this._scale=this.scale,this._minimumPixelSize=this.minimumPixelSize,this._maximumScale=this.maximumScale,this._heightReference=this.heightReference,this._heightChanged=!1;const t=K6(this,e),n=this._computedModelMatrix;ft.multiplyByUniformScale(i,t,n),this._upAxis===iJ.Y?ft.multiplyTransformation(n,iJ.Y_UP_TO_Z_UP,n):this._upAxis===iJ.X&&ft.multiplyTransformation(n,iJ.X_UP_TO_Z_UP,n),this.forwardAxis===iJ.Z&&ft.multiplyTransformation(n,iJ.Z_UP_TO_X_UP,n)}(n||s||r)&&(y6(this,s,r,e.mapProjection),this._dirty=!0,(n||r)&&b6(this)),this._perNodeShowDirty&&(this._perNodeShowDirty=!1,A6(this)),w6(this,t),T6(this),C6(this),E6(this),G6(this,e);const a=this._clippingPlanes;let c=0;const l=R(this.referenceMatrix,i);if(this._imageBasedLighting.useSphericalHarmonicCoefficients||this._imageBasedLighting.useSpecularEnvironmentMaps){let e=r8,n=o8;n=ft.multiply(t.uniformState.view3D,l,n),e=ft.getMatrix3(n,e),e=ke.getRotation(e,e),this._iblReferenceFrameMatrix=ke.transpose(e,this._iblReferenceFrameMatrix)}if(this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._imageBasedLighting.shouldRegenerateShaders,F4(this)){let e=s8;e=ft.multiply(t.uniformState.view3D,l,e),e=ft.multiply(e,a.modelMatrix,e),this._clippingPlanesMatrix=ft.inverseTranspose(e,this._clippingPlanesMatrix),c=a.clippingPlanesState}this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._clippingPlanesState!==c,this._clippingPlanesState=c;const u=N4(this);u!==this._colorShadingEnabled&&(this._colorShadingEnabled=u,this._shouldRegenerateShaders=!0);const h=this.splitDirection!==T4.NONE;this._splittingEnabled!==h&&(this._splittingEnabled=h,this._shouldRegenerateShaders=!0),this._shouldRegenerateShaders?c8(this,e):(I6(this,e,!1),P6(this,e,!1),H6(this,e,!1))}if(r){const t=this;return void e.afterRender.push((function(){t._ready=!0,t._readyPromise.resolve(t)}))}if(h&&!this._ignoreCommands){const t=e.commandList,n=e.passes,i=this._nodeCommands,o=i.length;let r,c;const u=e.mapProjection.ellipsoid.maximumRadius*z.PI;let h;if(n.render||n.pick&&this.allowPicking){for(r=0;r<o;++r)if(c=i[r],c.show){let n=c.command;if(s?n=c.silhouetteModelCommand:a?n=c.translucentCommand:l||(n=c.disableCullingCommand),t.push(n),h=c.command.boundingVolume,e.mode===ij.SCENE2D&&(h.center.y+h.radius>u||h.center.y-h.radius<u)){let e=c.command2D;s?e=c.silhouetteModelCommand2D:a?e=c.translucentCommand2D:l||(e=c.disableCullingCommand2D),t.push(e)}}if(s&&!n.pick)for(r=0;r<o;++r)c=i[r],c.show&&(t.push(c.silhouetteColorCommand),h=c.command.boundingVolume,e.mode===ij.SCENE2D&&(h.center.y+h.radius>u||h.center.y-h.radius<u)&&t.push(c.silhouetteColorCommand2D))}}const d=this._credit;C(d)&&e.creditDisplay.addCredit(d);const f=this._resourceCredits,p=f.length;for(let g=0;g<p;g++)e.creditDisplay.addCredit(f[g]);const m=this._gltfCredits,_=m.length;for(let g=0;g<_;g++)e.creditDisplay.addCredit(m[g])},M4.prototype.isDestroyed=function(){return!1},M4.prototype.destroy=function(){C(this._precreatedAttributes)&&J6(this._rendererResources.vertexArrays),C(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0),C(this._terrainProviderChangedCallback)&&(this._terrainProviderChangedCallback(),this._terrainProviderChangedCallback=void 0),C(this._cachedRendererResources)&&a8(this._rendererResources,this._cachedRendererResources),this._rendererResources=void 0,this._cachedRendererResources=this._cachedRendererResources&&this._cachedRendererResources.release(),C3.destroyCachedDataForModel(this);const e=this._pickIds,t=e.length;for(let i=0;i<t;++i)e[i].destroy();X6(this),this._quantizedVertexShaders=void 0;const n=this._clippingPlanes;return C(n)&&!n.isDestroyed()&&n.owner===this&&n.destroy(),this._clippingPlanes=void 0,this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=void 0,Qh(this)},M4._getClippingFunction=L3,M4._modifyShaderForColor=m5;var l8=M4;function u8(e,t,n,i,o){this._tileset=e,this._tile=t,this._resource=n,this._model=void 0,this._batchTable=void 0,this._features=void 0,this._classificationType=e.vectorClassificationOnly?void 0:e.classificationType,this._metadata=void 0,this._batchIdAttributeName=void 0,this._diffuseAttributeOrUniformName={},this._rtcCenterTransform=void 0,this._contentModelMatrix=void 0,this.featurePropertiesDirty=!1,this._group=void 0,g8(this,i,o)}function h8(e){let t=P0.getAttributeOrUniformBySemantic(e,"_BATCHID");return C(t)||(t=P0.getAttributeOrUniformBySemantic(e,"BATCHID"),C(t)&&u8._deprecationWarning("b3dm-legacy-batchid","The glTF in this b3dm uses the semantic `BATCHID`. Application-specific semantics should be prefixed with an underscore: `_BATCHID`.")),t}function d8(e){return function(t,n){const i=e._batchTable,o=!C(e._classificationType),r=e._model.gltf;C(r)&&(e._batchIdAttributeName=h8(r),e._diffuseAttributeOrUniformName[n]=P0.getDiffuseAttributeOrUniform(r,n));const s=i.getVertexShaderCallback(o,e._batchIdAttributeName,e._diffuseAttributeOrUniformName[n]);return C(s)?s(t):t}}function f8(e){return function(t,n){const i=e._batchTable,o=!C(e._classificationType),r=e._model.gltf;C(r)&&(e._diffuseAttributeOrUniformName[n]=P0.getDiffuseAttributeOrUniform(r,n));const s=i.getFragmentShaderCallback(o,e._diffuseAttributeOrUniformName[n],!1);return C(s)?s(t):t}}function p8(e){return function(){return e._batchTable.getPickId()}}function m8(e){return function(t){const n=e._batchTable,i=n.getClassificationFragmentShaderCallback();return C(i)?i(t):t}}function _8(e){return function(t,n){e._model.updateCommands(t,n)}}function g8(e,t,n){const i=e._tileset,o=e._tile,r=e._resource,s=aJ.parse(t,n);let a=s.batchLength;const c=s.featureTableJson,l=s.featureTableBinary,u=new mZ(c,l);a=u.getGlobalProperty("BATCH_LENGTH"),u.featuresLength=a;const h=s.batchTableJson,d=s.batchTableBinary;let f;C(e._classificationType)&&(f=_8(e));const p=new lZ(e,a,h,d,f);e._batchTable=p;const m=s.gltf,_={content:e,primitive:i};e._rtcCenterTransform=ft.IDENTITY;const g=u.getGlobalProperty("RTC_CENTER",ih.FLOAT,3);C(g)&&(e._rtcCenterTransform=ft.fromTranslation(K.fromArray(g))),e._contentModelMatrix=ft.multiply(o.computedTransform,e._rtcCenterTransform,new ft),C(e._classificationType)?e._model=new $2({gltf:m,cull:!1,basePath:r,requestType:Wn.TILES3D,modelMatrix:e._contentModelMatrix,upAxis:i._gltfUpAxis,forwardAxis:iJ.X,debugWireframe:i.debugWireframe,vertexShaderLoaded:d8(e),classificationShaderLoaded:m8(e),uniformMapLoaded:p.getUniformMapCallback(),pickIdLoaded:p8(e),classificationType:e._classificationType,batchTable:p}):(e._model=new l8({gltf:m,cull:!1,releaseGltfJson:!0,opaquePass:HU.CESIUM_3D_TILE,basePath:r,requestType:Wn.TILES3D,modelMatrix:e._contentModelMatrix,upAxis:i._gltfUpAxis,forwardAxis:iJ.X,shadows:i.shadows,debugWireframe:i.debugWireframe,incrementallyLoadTextures:!1,vertexShaderLoaded:d8(e),fragmentShaderLoaded:f8(e),uniformMapLoaded:p.getUniformMapCallback(),pickIdLoaded:p8(e),addBatchIdToGeneratedShaders:a>0,pickObject:_,lightColor:i.lightColor,imageBasedLighting:i.imageBasedLighting,backFaceCulling:i.backFaceCulling,showOutline:i.showOutline,showCreditsOnScreen:i.showCreditsOnScreen}),e._model.readyPromise.then((function(e){e.activeAnimations.addAll({loop:Y3.REPEAT})})))}function y8(e){const t=e.featuresLength;if(!C(e._features)&&t>0){const n=new Array(t);for(let i=0;i<t;++i)n[i]=new hZ(e,i);e._features=n}}u8._deprecationWarning=UF,Object.defineProperties(u8.prototype,{featuresLength:{get:function(){return this.batchTable.featuresLength}},pointsLength:{get:function(){return this._model.pointsLength}},trianglesLength:{get:function(){return this._model.trianglesLength}},geometryByteLength:{get:function(){return this._model.geometryByteLength}},texturesByteLength:{get:function(){return this._model.texturesByteLength}},batchTableByteLength:{get:function(){return this.batchTable.memorySizeInBytes}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._model.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},batchTable:{get:function(){return this._batchTable}},group:{get:function(){return this._group},set:function(e){this._group=e}}}),u8.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},u8.prototype.getFeature=function(e){const t=this.featuresLength;if(!C(e)||e<0||e>=t)throw new x(`batchId is required and between zero and featuresLength - 1 (${t-1}).`);return y8(this),this._features[e]},u8.prototype.applyDebugSettings=function(e,t){t=e?t:xy.WHITE,0===this.featuresLength?this._model.color=t:this._batchTable.setAllColor(t)},u8.prototype.applyStyle=function(e){if(0===this.featuresLength){const t=C(e)&&C(e.color),n=C(e)&&C(e.show);this._model.color=t?e.color.evaluateColor(void 0,this._model.color):xy.clone(xy.WHITE,this._model.color),this._model.show=!n||e.show.evaluate(void 0)}else this._batchTable.applyStyle(e)},u8.prototype.update=function(e,t){const n=t.commandList.length,i=this._model,o=this._tile,r=this._batchTable;r.update(e,t),this._contentModelMatrix=ft.multiply(o.computedTransform,this._rtcCenterTransform,this._contentModelMatrix),i.modelMatrix=this._contentModelMatrix,i.shadows=e.shadows,i.lightColor=e.lightColor,i.imageBasedLighting=e.imageBasedLighting,i.backFaceCulling=e.backFaceCulling,i.debugWireframe=e.debugWireframe,i.showCreditsOnScreen=e.showCreditsOnScreen,i.splitDirection=e.splitDirection;const s=e.clippingPlanes;i.referenceMatrix=e.clippingPlanesOriginMatrix,C(s)&&o.clippingPlanesDirty&&(i._clippingPlanes=s.enabled&&o._isClipped?s:void 0),C(s)&&C(i._clippingPlanes)&&i._clippingPlanes!==s&&(i._clippingPlanes=s),i.update(t);const a=t.commandList.length;n<a&&(t.passes.render||t.passes.pick)&&!C(this._classificationType)&&r.addDerivedCommands(t,n)},u8.prototype.isDestroyed=function(){return!1},u8.prototype.destroy=function(){return this._model=this._model&&this._model.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Qh(this)};var v8=u8;function b8(e,t,n,i,o,r){this._tileset=e,this._tile=t,this._resource=n,this._contents=[],this._readyPromise=yn(),this._metadata=void 0,this._group=void 0,w8(this,i,o,r)}Object.defineProperties(b8.prototype,{featurePropertiesDirty:{get:function(){const e=this._contents,t=e.length;for(let n=0;n<t;++n)if(e[n].featurePropertiesDirty)return!0;return!1},set:function(e){const t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].featurePropertiesDirty=e}},featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){return this._contents}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e;const t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].metadata=e}},batchTable:{get:function(){}},group:{get:function(){return this._group},set:function(e){this._group=e;const t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].group=e}}});const A8=Uint32Array.BYTES_PER_ELEMENT;function w8(e,t,n,i){n=R(n,0);const o=new Uint8Array(t),r=new DataView(t);n+=A8;const s=r.getUint32(n,!0);if(1!==s)throw new Je(`Only Composite Tile version 1 is supported. Version ${s} is not.`);n+=A8,n+=A8;const a=r.getUint32(n,!0);n+=A8;const c=[];for(let l=0;l<a;++l){const s=WF(o,n),a=r.getUint32(n+2*A8,!0),l=i[s];if(!C(l))throw new Je(`Unknown tile content type, ${s}, inside Composite tile`);{const i=l(e._tileset,e._tile,e._resource,t,n);e._contents.push(i),c.push(i.readyPromise)}n+=a}Promise.all(c).then((function(){e._readyPromise.resolve(e)})).catch((function(t){e._readyPromise.reject(t)}))}b8.prototype.hasProperty=function(e,t){return!1},b8.prototype.getFeature=function(e){},b8.prototype.applyDebugSettings=function(e,t){const n=this._contents,i=n.length;for(let o=0;o<i;++o)n[o].applyDebugSettings(e,t)},b8.prototype.applyStyle=function(e){const t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].applyStyle(e)},b8.prototype.update=function(e,t){const n=this._contents,i=n.length;for(let o=0;o<i;++o)n[o].update(e,t)},b8.prototype.isDestroyed=function(){return!1},b8.prototype.destroy=function(){const e=this._contents,t=e.length;for(let n=0;n<t;++n)e[n].destroy();return Qh(this)};var T8=b8;function C8(e){this._boxes=e.boxes,this._boxBatchIds=e.boxBatchIds,this._cylinders=e.cylinders,this._cylinderBatchIds=e.cylinderBatchIds,this._ellipsoids=e.ellipsoids,this._ellipsoidBatchIds=e.ellipsoidBatchIds,this._spheres=e.spheres,this._sphereBatchIds=e.sphereBatchIds,this._modelMatrix=e.modelMatrix,this._batchTable=e.batchTable,this._boundingVolume=e.boundingVolume,this._center=e.center,C(this._center)||(C(this._boundingVolume)?this._center=K.clone(this._boundingVolume.center):this._center=K.clone(K.ZERO)),this._boundingVolumes=void 0,this._batchedIndices=void 0,this._indices=void 0,this._indexOffsets=void 0,this._indexCounts=void 0,this._positions=void 0,this._vertexBatchIds=void 0,this._batchIds=void 0,this._batchTableColors=void 0,this._packedBuffer=void 0,this._ready=!1,this._readyPromise=yn(),this._verticesPromise=void 0,this._primitive=void 0,this.debugWireframe=!1,this.forceRebatch=!1,this.classificationType=rq.BOTH}function E8(e){const t=new Float64Array(ft.packedLength+K.packedLength);let n=0;return K.pack(e._center,t,n),n+=K.packedLength,ft.pack(e._modelMatrix,t,n),t}function x8(e,t){let n=0;const i=t[n++],o=t[n++],r=e._boundingVolumes=new Array(o);for(let c=0;c<o;++c)r[c]=nn.unpack(t,n),n+=nn.packedLength;const s=t[n++],a=e._batchedIndices=new Array(s);for(let c=0;c<s;++c){const e=xy.unpack(t,n);n+=xy.packedLength;const i=t[n++],o=t[n++],r=t[n++],s=new Array(r);for(let a=0;a<r;++a)s[a]=t[n++];a[c]=new Q0({color:e,offset:i,count:o,batchIds:s})}return i}Object.defineProperties(C8.prototype,{trianglesLength:{get:function(){return C(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return C(this._primitive)?this._primitive.geometryByteLength:0}},readyPromise:{get:function(){return this._readyPromise.promise}}}),C8.packedBoxLength=ft.packedLength+K.packedLength,C8.packedCylinderLength=ft.packedLength+2,C8.packedEllipsoidLength=ft.packedLength+K.packedLength,C8.packedSphereLength=K.packedLength+1;const S8=new ad("createVectorTileGeometries",5),I8=new xy;function O8(e){if(!C(e._primitive)){if(!C(e._verticesPromise)){let t=e._boxes,n=e._boxBatchIds,i=e._cylinders,o=e._cylinderBatchIds,r=e._ellipsoids,s=e._ellipsoidBatchIds,a=e._spheres,c=e._sphereBatchIds,l=e._batchTableColors,u=e._packedBuffer;if(!C(l)){let h=0;C(e._boxes)&&(t=e._boxes=xF(t),n=e._boxBatchIds=xF(n),h+=n.length),C(e._cylinders)&&(i=e._cylinders=xF(i),o=e._cylinderBatchIds=xF(o),h+=o.length),C(e._ellipsoids)&&(r=e._ellipsoids=xF(r),s=e._ellipsoidBatchIds=xF(s),h+=s.length),C(e._spheres)&&(a=e._sphere=xF(a),c=e._sphereBatchIds=xF(c),h+=c.length),l=e._batchTableColors=new Uint32Array(h);const d=e._batchTable;for(let e=0;e<h;++e){const t=d.getColor(e,I8);l[e]=t.toRgba()}u=e._packedBuffer=E8(e)}const h=[];C(t)&&h.push(t.buffer,n.buffer),C(i)&&h.push(i.buffer,o.buffer),C(r)&&h.push(r.buffer,s.buffer),C(a)&&h.push(a.buffer,c.buffer),h.push(l.buffer,u.buffer);const d={boxes:C(t)?t.buffer:void 0,boxBatchIds:C(t)?n.buffer:void 0,cylinders:C(i)?i.buffer:void 0,cylinderBatchIds:C(i)?o.buffer:void 0,ellipsoids:C(r)?r.buffer:void 0,ellipsoidBatchIds:C(r)?s.buffer:void 0,spheres:C(a)?a.buffer:void 0,sphereBatchIds:C(a)?c.buffer:void 0,batchTableColors:l.buffer,packedBuffer:u.buffer},f=e._verticesPromise=S8.scheduleTask(d,h);if(!C(f))return;f.then((function(t){const n=new Float64Array(t.packedBuffer),i=x8(e,n);e._indices=2===i?new Uint16Array(t.indices):new Uint32Array(t.indices),e._indexOffsets=new Uint32Array(t.indexOffsets),e._indexCounts=new Uint32Array(t.indexCounts),e._positions=new Float32Array(t.positions),e._vertexBatchIds=new Uint16Array(t.vertexBatchIds),e._batchIds=new Uint16Array(t.batchIds),e._ready=!0}))}e._ready&&!C(e._primitive)&&(e._primitive=new O2({batchTable:e._batchTable,positions:e._positions,batchIds:e._batchIds,vertexBatchIds:e._vertexBatchIds,indices:e._indices,indexOffsets:e._indexOffsets,indexCounts:e._indexCounts,batchedIndices:e._batchedIndices,boundingVolume:e._boundingVolume,boundingVolumes:e._boundingVolumes,center:e._center,pickObject:R(e._pickObject,e)}),e._boxes=void 0,e._boxBatchIds=void 0,e._cylinders=void 0,e._cylinderBatchIds=void 0,e._ellipsoids=void 0,e._ellipsoidBatchIds=void 0,e._spheres=void 0,e._sphereBatchIds=void 0,e._center=void 0,e._modelMatrix=void 0,e._batchTable=void 0,e._boundingVolume=void 0,e._boundingVolumes=void 0,e._batchedIndices=void 0,e._indices=void 0,e._indexOffsets=void 0,e._indexCounts=void 0,e._positions=void 0,e._vertexBatchIds=void 0,e._batchIds=void 0,e._batchTableColors=void 0,e._packedBuffer=void 0,e._verticesPromise=void 0,e._readyPromise.resolve())}}C8.prototype.createFeatures=function(e,t){this._primitive.createFeatures(e,t)},C8.prototype.applyDebugSettings=function(e,t){this._primitive.applyDebugSettings(e,t)},C8.prototype.applyStyle=function(e,t){this._primitive.applyStyle(e,t)},C8.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)},C8.prototype.update=function(e){O8(this),this._ready&&(this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(e))},C8.prototype.isDestroyed=function(){return!1},C8.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Qh(this)};var D8=C8;function P8(e,t,n,i,o){this._tileset=e,this._tile=t,this._resource=n,this._geometries=void 0,this._contentReadyPromise=void 0,this._readyPromise=yn(),this._metadata=void 0,this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,this._group=void 0,B8(this,i,o)}function R8(e){return function(t,n){C(e._geometries)&&e._geometries.updateCommands(t,n)}}function L8(e,t){let n,i,o,r,s;const a=R(e.BOXES_LENGTH,0),c=R(e.CYLINDERS_LENGTH,0),l=R(e.ELLIPSOIDS_LENGTH,0),u=R(e.SPHERES_LENGTH,0);if(a>0&&C(e.BOX_BATCH_IDS)){const i=t.byteOffset+e.BOX_BATCH_IDS.byteOffset;n=new Uint16Array(t.buffer,i,a)}if(c>0&&C(e.CYLINDER_BATCH_IDS)){const n=t.byteOffset+e.CYLINDER_BATCH_IDS.byteOffset;i=new Uint16Array(t.buffer,n,c)}if(l>0&&C(e.ELLIPSOID_BATCH_IDS)){const n=t.byteOffset+e.ELLIPSOID_BATCH_IDS.byteOffset;o=new Uint16Array(t.buffer,n,l)}if(u>0&&C(e.SPHERE_BATCH_IDS)){const n=t.byteOffset+e.SPHERE_BATCH_IDS.byteOffset;r=new Uint16Array(t.buffer,n,u)}const h=C(n)||C(i)||C(o)||C(r),d=a>0&&!C(n)||c>0&&!C(i)||l>0&&!C(o)||u>0&&!C(r);if(h&&d)throw new Je("If one group of batch ids is defined, then all batch ids must be defined.");const f=!C(n)&&!C(i)&&!C(o)&&!C(r);if(f){let e=0;if(!C(n)&&a>0)for(n=new Uint16Array(a),s=0;s<a;++s)n[s]=e++;if(!C(i)&&c>0)for(i=new Uint16Array(c),s=0;s<c;++s)i[s]=e++;if(!C(o)&&l>0)for(o=new Uint16Array(l),s=0;s<l;++s)o[s]=e++;if(!C(r)&&u>0)for(r=new Uint16Array(u),s=0;s<u;++s)r[s]=e++}return{boxes:n,cylinders:i,ellipsoids:o,spheres:r}}Object.defineProperties(P8.prototype,{featuresLength:{get:function(){return C(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return C(this._geometries)?this._geometries.trianglesLength:0}},geometryByteLength:{get:function(){return C(this._geometries)?this._geometries.geometryByteLength:0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return C(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},batchTable:{get:function(){return this._batchTable}},group:{get:function(){return this._group},set:function(e){this._group=e}}});const M8=Uint32Array.BYTES_PER_ELEMENT;function B8(e,t,n){n=R(n,0);const i=new Uint8Array(t),o=new DataView(t);n+=M8;const r=o.getUint32(n,!0);if(1!==r)throw new Je(`Only Geometry tile version 1 is supported.  Version ${r} is not.`);n+=M8;const s=o.getUint32(n,!0);if(n+=M8,0===s)return void e._readyPromise.resolve(e);const a=o.getUint32(n,!0);if(n+=M8,0===a)throw new Je("Feature table must have a byte length greater than zero");const c=o.getUint32(n,!0);n+=M8;const l=o.getUint32(n,!0);n+=M8;const u=o.getUint32(n,!0);n+=M8;const h=Fp(i,n,a);n+=a;const d=new Uint8Array(t,n,c);let f,p;n+=c,l>0&&(f=Fp(i,n,l),n+=l,u>0&&(p=new Uint8Array(t,n,u),p=new Uint8Array(p)));const m=R(h.BOXES_LENGTH,0),_=R(h.CYLINDERS_LENGTH,0),g=R(h.ELLIPSOIDS_LENGTH,0),y=R(h.SPHERES_LENGTH,0),v=m+_+g+y,b=new lZ(e,v,f,p,R8(e));if(e._batchTable=b,0===v)return;const A=e.tile.computedTransform;let w;C(h.RTC_CENTER)&&(w=K.unpack(h.RTC_CENTER),ft.multiplyByPoint(A,w,w));const T=L8(h,d);if(m>0||_>0||g>0||y>0){let t,n,i,o;if(m>0){const e=d.byteOffset+h.BOXES.byteOffset;t=new Float32Array(d.buffer,e,D8.packedBoxLength*m)}if(_>0){const e=d.byteOffset+h.CYLINDERS.byteOffset;n=new Float32Array(d.buffer,e,D8.packedCylinderLength*_)}if(g>0){const e=d.byteOffset+h.ELLIPSOIDS.byteOffset;i=new Float32Array(d.buffer,e,D8.packedEllipsoidLength*g)}if(y>0){const e=d.byteOffset+h.SPHERES.byteOffset;o=new Float32Array(d.buffer,e,D8.packedSphereLength*y)}e._geometries=new D8({boxes:t,boxBatchIds:T.boxes,cylinders:n,cylinderBatchIds:T.cylinders,ellipsoids:i,ellipsoidBatchIds:T.ellipsoids,spheres:o,sphereBatchIds:T.spheres,center:w,modelMatrix:A,batchTable:b,boundingVolume:e.tile.boundingVolume.boundingVolume})}}function N8(e){const t=e.featuresLength;if(!C(e._features)&&t>0){const n=new Array(t);C(e._geometries)&&e._geometries.createFeatures(e,n),e._features=n}}P8.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},P8.prototype.getFeature=function(e){const t=this.featuresLength;if(!C(e)||e<0||e>=t)throw new x(`batchId is required and between zero and featuresLength - 1 (${t-1}).`);return N8(this),this._features[e]},P8.prototype.applyDebugSettings=function(e,t){C(this._geometries)&&this._geometries.applyDebugSettings(e,t)},P8.prototype.applyStyle=function(e){N8(this),C(this._geometries)&&this._geometries.applyStyle(e,this._features)},P8.prototype.update=function(e,t){if(C(this._geometries)&&(this._geometries.classificationType=this._tileset.classificationType,this._geometries.debugWireframe=this._tileset.debugWireframe,this._geometries.update(t)),C(this._batchTable)&&this._geometries._ready&&this._batchTable.update(e,t),!C(this._contentReadyPromise)){const e=this;this._contentReadyPromise=this._geometries.readyPromise.then((function(){e._readyPromise.resolve(e)}))}},P8.prototype.isDestroyed=function(){return!1},P8.prototype.destroy=function(){return this._geometries=this._geometries&&this._geometries.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Qh(this)};var F8=P8;function z8(e,t){return C(e)&&C(e.extensions)&&C(e.extensions[t])}function k8(e){const t=e.lengthBits;let n=e.availableCount;D.typeOf.number("options.lengthBits",t);const i=e.constant,o=e.bitstream;if(C(i))n=t;else{const i=Math.ceil(t/8);if(o.length!==i)throw new Je(`Availability bitstream must be exactly ${i} bytes long to store ${t} bits. Actual bitstream was ${o.length} bytes long.`);const r=R(e.computeAvailableCountEnabled,!1);!C(n)&&r&&(n=U8(o,t))}this._lengthBits=t,this._availableCount=n,this._constant=i,this._bitstream=o}function U8(e,t){let n=0;for(let i=0;i<t;i++){const t=i>>3,o=i%8;n+=e[t]>>o&1}return n}function V8(e){e=R(e,R.EMPTY_OBJECT);const t=e.metadataTable,n=e.class,i=e.entityId,o=e.propertyTableJson;D.typeOf.object("options.metadataTable",t),D.typeOf.object("options.class",n),D.typeOf.number("options.entityId",i),D.typeOf.object("options.propertyTableJson",o),this._class=n,this._metadataTable=t,this._entityId=i,this._extensions=o.extensions,this._extras=o.extras}Object.defineProperties(k8.prototype,{lengthBits:{get:function(){return this._lengthBits}},availableCount:{get:function(){return this._availableCount}}}),k8.prototype.getBit=function(e){if(e<0||e>=this._lengthBits)throw new x("Bit index out of bounds.");if(C(this._constant))return this._constant;const t=e>>3,n=e%8;return 1===(this._bitstream[t]>>n&1)},Object.defineProperties(V8.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),V8.prototype.hasProperty=function(e){return this._metadataTable.hasProperty(e)},V8.prototype.hasPropertyBySemantic=function(e){return this._metadataTable.hasPropertyBySemantic(e)},V8.prototype.getPropertyIds=function(e){return this._metadataTable.getPropertyIds(e)},V8.prototype.getProperty=function(e){return this._metadataTable.getProperty(this._entityId,e)},V8.prototype.setProperty=function(e,t){return this._metadataTable.setProperty(this._entityId,e,t)},V8.prototype.getPropertyBySemantic=function(e){return this._metadataTable.getPropertyBySemantic(this._entityId,e)},V8.prototype.setPropertyBySemantic=function(e,t){return this._metadataTable.setPropertyBySemantic(this._entityId,e,t)};const H8={QUADTREE:"QUADTREE",OCTREE:"OCTREE",getBranchingFactor:function(e){switch(e){case H8.OCTREE:return 8;case H8.QUADTREE:return 4;default:throw new x("subdivisionScheme is not a valid value.")}}};var G8=Object.freeze(H8);function W8(){}Object.defineProperties(W8.prototype,{class:{get:function(){x.throwInstantiationError()}}}),W8.prototype.hasProperty=function(e){x.throwInstantiationError()},W8.prototype.hasPropertyBySemantic=function(e){x.throwInstantiationError()},W8.prototype.getPropertyIds=function(e){x.throwInstantiationError()},W8.prototype.getProperty=function(e){x.throwInstantiationError()},W8.prototype.setProperty=function(e,t){x.throwInstantiationError()},W8.prototype.getPropertyBySemantic=function(e){x.throwInstantiationError()},W8.prototype.setPropertyBySemantic=function(e,t){x.throwInstantiationError()},W8.hasProperty=function(e,t,n){if(D.typeOf.string("propertyId",e),D.typeOf.object("properties",t),D.typeOf.object("classDefinition",n),C(t[e]))return!0;const i=n.properties;if(!C(i))return!1;const o=i[e];return!(!C(o)||!C(o.default))},W8.hasPropertyBySemantic=function(e,t,n){D.typeOf.string("semantic",e),D.typeOf.object("properties",t),D.typeOf.object("classDefinition",n);const i=n.propertiesBySemantic;if(!C(i))return!1;const o=i[e];return C(o)},W8.getPropertyIds=function(e,t,n){D.typeOf.object("properties",e),D.typeOf.object("classDefinition",t),n=C(n)?n:[],n.length=0;for(const o in e)e.hasOwnProperty(o)&&C(e[o])&&n.push(o);const i=t.properties;if(C(i))for(const o in i)i.hasOwnProperty(o)&&!C(e[o])&&C(i[o].default)&&n.push(o);return n},W8.getProperty=function(e,t,n){if(D.typeOf.string("propertyId",e),D.typeOf.object("properties",t),D.typeOf.object("classDefinition",n),!C(n.properties[e]))throw new x(`Class definition missing property ${e}`);const i=n.properties[e];let o=t[e];Array.isArray(o)&&(o=o.slice());const r=!0;return o=i.handleNoData(o),!C(o)&&C(i.default)?(o=pn(i.default,!0),i.unpackVectorAndMatrixTypes(o,r)):C(o)?(o=i.normalize(o),o=i.applyValueTransform(o),i.unpackVectorAndMatrixTypes(o,r)):void 0},W8.setProperty=function(e,t,n,i){if(D.typeOf.string("propertyId",e),D.defined("value",t),D.typeOf.object("properties",n),D.typeOf.object("classDefinition",i),!C(n[e]))return!1;let o;Array.isArray(t)&&(t=t.slice());const r=i.properties;C(r)&&(o=r[e]);const s=!0;return C(o)&&(t=o.packVectorAndMatrixTypes(t,s),t=o.unapplyValueTransform(t),t=o.unnormalize(t)),n[e]=t,!0},W8.getPropertyBySemantic=function(e,t,n){D.typeOf.string("semantic",e),D.typeOf.object("properties",t),D.typeOf.object("classDefinition",n);const i=n.propertiesBySemantic;if(!C(i))return;const o=i[e];return C(o)?W8.getProperty(o.id,t,n):void 0},W8.setPropertyBySemantic=function(e,t,n,i){D.typeOf.string("semantic",e),D.defined("value",t),D.typeOf.object("properties",n),D.typeOf.object("classDefinition",i);const o=i.propertiesBySemantic;if(!C(o))return!1;const r=i.propertiesBySemantic[e];return!!C(r)&&W8.setProperty(r.id,t,n,i)};var q8=W8;function j8(e){e=R(e,R.EMPTY_OBJECT);const t=e.subtreeMetadata,n=e.class;D.typeOf.object("options.subtreeMetadata",t),D.typeOf.object("options.class",n);const i=C(t.properties)?t.properties:{};this._class=n,this._properties=i,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(j8.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),j8.prototype.hasProperty=function(e){return q8.hasProperty(e,this._properties,this._class)},j8.prototype.hasPropertyBySemantic=function(e){return q8.hasPropertyBySemantic(e,this._properties,this._class)},j8.prototype.getPropertyIds=function(e){return q8.getPropertyIds(this._properties,this._class,e)},j8.prototype.getProperty=function(e){return q8.getProperty(e,this._properties,this._class)},j8.prototype.setProperty=function(e,t){return q8.setProperty(e,t,this._properties,this._class)},j8.prototype.getPropertyBySemantic=function(e){return q8.getPropertyBySemantic(e,this._properties,this._class)},j8.prototype.setPropertyBySemantic=function(e,t){return q8.setPropertyBySemantic(e,t,this._properties,this._class)};var Y8=j8;const K8={INT8:"INT8",UINT8:"UINT8",INT16:"INT16",UINT16:"UINT16",INT32:"INT32",UINT32:"UINT32",INT64:"INT64",UINT64:"UINT64",FLOAT32:"FLOAT32",FLOAT64:"FLOAT64",getMinimum:function(e){if(!K8.isNumericType(e))throw new x("type must be a numeric type");switch(e){case K8.INT8:return-128;case K8.UINT8:return 0;case K8.INT16:return-32768;case K8.UINT16:return 0;case K8.INT32:return-2147483648;case K8.UINT32:return 0;case K8.INT64:return Oc.supportsBigInt()?BigInt("-9223372036854775808"):-Math.pow(2,63);case K8.UINT64:return Oc.supportsBigInt()?BigInt(0):0;case K8.FLOAT32:return-34028234663852886e22;case K8.FLOAT64:return-Number.MAX_VALUE}},getMaximum:function(e){if(!K8.isNumericType(e))throw new x("type must be a numeric type");switch(e){case K8.INT8:return 127;case K8.UINT8:return 255;case K8.INT16:return 32767;case K8.UINT16:return 65535;case K8.INT32:return 2147483647;case K8.UINT32:return 4294967295;case K8.INT64:return Oc.supportsBigInt()?BigInt("9223372036854775807"):Math.pow(2,63)-1;case K8.UINT64:return Oc.supportsBigInt()?BigInt("18446744073709551615"):Math.pow(2,64)-1;case K8.FLOAT32:return 34028234663852886e22;case K8.FLOAT64:return Number.MAX_VALUE}},isNumericType:function(e){switch(D.typeOf.string("type",e),e){case K8.INT8:case K8.UINT8:case K8.INT16:case K8.UINT16:case K8.INT32:case K8.UINT32:case K8.INT64:case K8.UINT64:case K8.FLOAT32:case K8.FLOAT64:return!0;default:return!1}},isIntegerType:function(e){switch(D.typeOf.string("type",e),e){case K8.INT8:case K8.UINT8:case K8.INT16:case K8.UINT16:case K8.INT32:case K8.UINT32:case K8.INT64:case K8.UINT64:return!0;default:return!1}},isUnsignedIntegerType:function(e){switch(D.typeOf.string("type",e),e){case K8.UINT8:case K8.UINT16:case K8.UINT32:case K8.UINT64:return!0;default:return!1}},isVectorCompatible:function(e){switch(D.typeOf.string("type",e),e){case K8.INT8:case K8.UINT8:case K8.INT16:case K8.UINT16:case K8.INT32:case K8.UINT32:case K8.FLOAT32:case K8.FLOAT64:return!0;default:return!1}},normalize:function(e,t){if("number"!==typeof e&&"bigint"!==typeof e)throw new x("value must be a number or a BigInt");if(!K8.isIntegerType(t))throw new x("type must be an integer type");return Math.max(Number(e)/Number(K8.getMaximum(t)),-1)},unnormalize:function(e,t){if(D.typeOf.number("value",e),!K8.isIntegerType(t))throw new x("type must be an integer type");const n=K8.getMaximum(t),i=K8.isUnsignedIntegerType(t)?0:-n;return e=z.sign(e)*Math.round(Math.abs(e)*Number(n)),t!==K8.INT64&&t!==K8.UINT64||!Oc.supportsBigInt()||(e=BigInt(e)),e>n?n:e<i?i:e},applyValueTransform:function(e,t,n){return n*e+t},unapplyValueTransform:function(e,t,n){return 0===n?0:(e-t)/n},getSizeInBytes:function(e){if(!K8.isNumericType(e))throw new x("type must be a numeric type");switch(e){case K8.INT8:case K8.UINT8:return 1;case K8.INT16:case K8.UINT16:return 2;case K8.INT32:case K8.UINT32:return 4;case K8.INT64:case K8.UINT64:return 8;case K8.FLOAT32:return 4;case K8.FLOAT64:return 8}}};var X8=Object.freeze(K8);const Q8={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4",BOOLEAN:"BOOLEAN",STRING:"STRING",ENUM:"ENUM",isVectorType:function(e){switch(D.typeOf.string("type",e),e){case Q8.VEC2:case Q8.VEC3:case Q8.VEC4:return!0;default:return!1}},isMatrixType:function(e){switch(D.typeOf.string("type",e),e){case Q8.MAT2:case Q8.MAT3:case Q8.MAT4:return!0;default:return!1}},getComponentCount:function(e){switch(D.typeOf.string("type",e),e){case Q8.SCALAR:case Q8.STRING:case Q8.ENUM:case Q8.BOOLEAN:return 1;case Q8.VEC2:return 2;case Q8.VEC3:return 3;case Q8.VEC4:return 4;case Q8.MAT2:return 4;case Q8.MAT3:return 9;case Q8.MAT4:return 16;default:throw new x(`Invalid metadata type ${e}`)}},getMathType:function(e){switch(e){case Q8.VEC2:return ro;case Q8.VEC3:return K;case Q8.VEC4:return Xe;case Q8.MAT2:return hh;case Q8.MAT3:return ke;case Q8.MAT4:return ft;default:return}}};var J8=Object.freeze(Q8);function Z8(e){e=R(e,R.EMPTY_OBJECT);const t=e.id,n=e.property;D.typeOf.string("options.id",t),D.typeOf.object("options.property",n),D.typeOf.string("options.property.type",n.type);const i=$8(n),o=e9(n,e.enums),r=o.componentType,s=C(r)&&X8.isIntegerType(r)&&R(n.normalized,!1);this._id=t,this._name=n.name,this._description=n.description,this._semantic=n.semantic,this._isLegacyExtension=i,this._type=o.type,this._componentType=r,this._enumType=o.enumType,this._valueType=o.valueType,this._isArray=o.isArray,this._isVariableLengthArray=o.isVariableLengthArray,this._arrayLength=o.arrayLength,this._min=n.min,this._max=n.max,this._normalized=s;let a=n.offset,c=n.scale;const l=C(a)||C(c),u=!0;let h;C(a)||(a=this.expandConstant(0,u)),C(c)||(c=this.expandConstant(1,u)),this._offset=a,this._scale=c,this._hasValueTransform=l,this._noData=n.noData,this._default=n.default,h=!!C(i)&&(i?!C(n.optional)||!n.optional:R(n.required,!1)),this._required=h,this._extras=n.extras,this._extensions=n.extensions}function $8(e){if("ARRAY"===e.type)return!0;const t=e.type;return t!==J8.SCALAR&&!J8.isMatrixType(t)&&!J8.isVectorType(t)&&(!!X8.isNumericType(t)||!(C(e.noData)||C(e.scale)||C(e.offset)||C(e.required)||C(e.count)||C(e.array))&&(!C(e.optional)&&void 0))}function e9(e,t){const n=e.type,i=e.componentType,o="ARRAY"===n;let r,s,a,c;if(o?(r=!0,s=e.componentCount,a=!C(s)):e.array?(r=!0,s=e.count,a=!C(e.count)):(r=!1,s=void 0,a=!1),C(e.enumType)&&(c=t[e.enumType]),n===J8.ENUM)return{type:n,componentType:void 0,enumType:c,valueType:c.valueType,isArray:r,isVariableLengthArray:a,arrayLength:s};if(o&&i===J8.ENUM)return{type:i,componentType:void 0,enumType:c,valueType:c.valueType,isArray:r,isVariableLengthArray:a,arrayLength:s};if(n===J8.SCALAR||J8.isMatrixType(n)||J8.isVectorType(n))return{type:n,componentType:i,enumType:void 0,valueType:i,isArray:r,isVariableLengthArray:a,arrayLength:s};if(n===J8.BOOLEAN||n===J8.STRING)return{type:n,componentType:void 0,enumType:void 0,valueType:void 0,isArray:r,isVariableLengthArray:a,arrayLength:s};if(o&&(i===J8.BOOLEAN||i===J8.STRING))return{type:i,componentType:void 0,enumType:void 0,valueType:void 0,isArray:r,isVariableLengthArray:a,arrayLength:s};if(C(i)&&X8.isNumericType(i))return{type:J8.SCALAR,componentType:i,enumType:void 0,valueType:i,isArray:r,isVariableLengthArray:a,arrayLength:s};if(X8.isNumericType(n))return{type:J8.SCALAR,componentType:n,enumType:void 0,valueType:n,isArray:r,isVariableLengthArray:a,arrayLength:s};throw new x(`unknown metadata type {type: ${n}, componentType: ${i})`)}function t9(e,t){if(!Array.isArray(e))return e===t;if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!t9(e[n],t[n]))return!1;return!0}function n9(e,t){if(!Array.isArray(t))return`value ${t} must be an array`;const n=t.length;if(!e._isVariableLengthArray&&n!==e._arrayLength)return"Array length does not match property.arrayLength";for(let i=0;i<n;i++){const n=i9(e,t[i]);if(C(n))return n}}function i9(e,t){const n=e._type,i=e._componentType,o=e._enumType,r=e._normalized;return J8.isVectorType(n)?o9(t,n,i):J8.isMatrixType(n)?r9(t,n,i):n===J8.STRING?s9(t):n===J8.BOOLEAN?a9(t):n===J8.ENUM?c9(t,o):l9(t,i,r)}function o9(e,t,n){return X8.isVectorCompatible(n)?t!==J8.VEC2||e instanceof ro?t!==J8.VEC3||e instanceof K?t!==J8.VEC4||e instanceof Xe?void 0:`vector value ${e} must be a Cartesian4`:`vector value ${e} must be a Cartesian3`:`vector value ${e} must be a Cartesian2`:`componentType ${n} is incompatible with vector type ${t}`}function r9(e,t,n){return X8.isVectorCompatible(n)?t!==J8.MAT2||e instanceof hh?t!==J8.MAT3||e instanceof ke?t!==J8.MAT4||e instanceof ft?void 0:`matrix value ${e} must be a Matrix4`:`matrix value ${e} must be a Matrix3`:`matrix value ${e} must be a Matrix2`:`componentType ${n} is incompatible with matrix type ${t}`}function s9(e){if("string"!==typeof e)return u9(e,J8.STRING)}function a9(e){if("boolean"!==typeof e)return u9(e,J8.BOOLEAN)}function c9(e,t){const n=typeof e;if(C(t))return"string"===n&&C(t.valuesByName[e])?void 0:`value ${e} is not a valid enum name for ${t.id}`}function l9(e,t,n){const i=typeof e;switch(t){case X8.INT8:case X8.UINT8:case X8.INT16:case X8.UINT16:case X8.INT32:case X8.UINT32:case X8.FLOAT32:case X8.FLOAT64:return"number"!==i?u9(e,t):isFinite(e)?d9(e,t,n):f9(e,t);case X8.INT64:case X8.UINT64:return"number"!==i&&"bigint"!==i?u9(e,t):"number"!==i||isFinite(e)?d9(e,t,n):f9(e,t)}}function u9(e,t){return`value ${e} does not match type ${t}`}function h9(e,t,n){let i=`value ${e} is out of range for type ${t}`;return n&&(i+=" (normalized)"),i}function d9(e,t,n){if(n){const i=X8.isUnsignedIntegerType(t)?0:-1,o=1;return e<i||e>o?h9(e,t,n):void 0}if(e<X8.getMinimum(t)||e>X8.getMaximum(t))return h9(e,t,n)}function f9(e,t){return`value ${e} of type ${t} must be finite`}function p9(e,t,n){if(!Array.isArray(e))return n(e,t);for(let i=0;i<e.length;i++)e[i]=p9(e[i],t,n);return e}Object.defineProperties(Z8.prototype,{id:{get:function(){return this._id}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},type:{get:function(){return this._type}},enumType:{get:function(){return this._enumType}},componentType:{get:function(){return this._componentType}},valueType:{get:function(){return this._valueType}},isArray:{get:function(){return this._isArray}},isVariableLengthArray:{get:function(){return this._isVariableLengthArray}},arrayLength:{get:function(){return this._arrayLength}},normalized:{get:function(){return this._normalized}},max:{get:function(){return this._max}},min:{get:function(){return this._min}},noData:{get:function(){return this._noData}},default:{get:function(){return this._default}},required:{get:function(){return this._required}},semantic:{get:function(){return this._semantic}},hasValueTransform:{get:function(){return this._hasValueTransform}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),Z8.prototype.normalize=function(e){return this._normalized?p9(e,this._valueType,X8.normalize):e},Z8.prototype.unnormalize=function(e){return this._normalized?p9(e,this._valueType,X8.unnormalize):e},Z8.prototype.applyValueTransform=function(e){return!this._hasValueTransform||this._isVariableLengthArray?e:Z8.valueTransformInPlace(e,this._offset,this._scale,X8.applyValueTransform)},Z8.prototype.unapplyValueTransform=function(e){return!this._hasValueTransform||this._isVariableLengthArray?e:Z8.valueTransformInPlace(e,this._offset,this._scale,X8.unapplyValueTransform)},Z8.prototype.expandConstant=function(e,t){t=R(t,!1);const n=this._isArray,i=this._arrayLength,o=J8.getComponentCount(this._type),r=n&&o>1;if(!n&&1===o)return e;if(!n)return new Array(o).fill(e);if(!r)return new Array(i).fill(e);if(!t)return new Array(this._arrayLength*o).fill(e);const s=new Array(o).fill(e);return new Array(this._arrayLength).fill(s)},Z8.prototype.handleNoData=function(e){const t=this._noData;return C(t)&&t9(e,t)?void 0:e},Z8.prototype.unpackVectorAndMatrixTypes=function(e,t){t=R(t,!1);const n=J8.getMathType(this._type),i=this._isArray,o=J8.getComponentCount(this._type),r=i&&o>1;return C(n)?t&&r?e.map((function(e){return n.unpack(e)})):i?n.unpackArray(e):n.unpack(e):e},Z8.prototype.packVectorAndMatrixTypes=function(e,t){t=R(t,!1);const n=J8.getMathType(this._type),i=this._isArray,o=J8.getComponentCount(this._type),r=i&&o>1;return C(n)?t&&r?e.map((function(e){return n.pack(e,[])})):i?n.packArray(e,[]):n.pack(e,[]):e},Z8.prototype.validate=function(e){if(C(e)||!C(this._default))return this._required&&!C(e)?"required property must have a value":this._isArray?n9(this,e):i9(this,e)},Z8.valueTransformInPlace=function(e,t,n,i){if(!Array.isArray(e))return i(e,t,n);for(let o=0;o<e.length;o++)e[o]=Z8.valueTransformInPlace(e[o],t[o],n[o],i);return e};var m9=Z8;function _9(e){e=R(e,R.EMPTY_OBJECT);const t=e.count,n=e.property,i=e.classProperty,o=e.bufferViews;D.typeOf.number.greaterThan("options.count",t,0),D.typeOf.object("options.property",n),D.typeOf.object("options.classProperty",i),D.typeOf.object("options.bufferViews",o);const r=i.type,s=i.isArray,a=i.isVariableLengthArray;let c=i.valueType;const l=i.enumType,u=r===J8.STRING,h=r===J8.BOOLEAN;let d;if(a){let e=R(n.arrayOffsetType,n.offsetType);e=R(X8[e],X8.UINT32);const i=R(n.arrayOffsets,n.arrayOffsetBufferView);d=new N9(o[i],e,t+1)}const f=J8.getComponentCount(r);let p;p=a?d.get(t)-d.get(0):s?t*i.arrayLength:t;const m=f*p;let _,g;if(u){let e=R(n.stringOffsetType,n.offsetType);e=R(X8[e],X8.UINT32);const t=R(n.stringOffsets,n.stringOffsetBufferView);_=new N9(o[t],e,m+1)}(u||h)&&(c=X8.UINT8),g=u?_.get(m)-_.get(0):h?Math.ceil(m/8):m;const y=R(n.values,n.bufferView),v=new N9(o[y],c,g);let b=n.offset,A=n.scale;const w=i.hasValueTransform||C(b)||C(A);let T,E;b=R(b,i.offset),A=R(A,i.scale),b=g9(b),A=g9(A);const x=this;u?T=function(e){return w9(e,x._values,x._stringOffsets)}:h?(T=function(e){return T9(e,x._values)},E=function(e,t){C9(e,x._values,t)}):C(l)?(T=function(e){const t=x._values.get(e);return l.namesByValue[t]},E=function(e,t){const n=l.valuesByName[t];x._values.set(e,n)}):(T=function(e){return x._values.get(e)},E=function(e,t){x._values.set(e,t)}),this._arrayOffsets=d,this._stringOffsets=_,this._values=v,this._classProperty=i,this._count=t,this._vectorComponentCount=f,this._min=n.min,this._max=n.max,this._offset=b,this._scale=A,this._hasValueTransform=w,this._getValue=T,this._setValue=E,this._unpackedValues=void 0,this._extras=n.extras,this._extensions=n.extensions}function g9(e){if(!Array.isArray(e))return e;const t=[];for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)?t.push.apply(t,i):t.push(i)}return t}function y9(e,t){const n=e._count;if(!C(t)||t<0||t>=n){const e=n-1;throw new x(`index is required and between zero and count - 1. Actual value: ${e}`)}}function v9(e,t){D9(e)&&R9(e);const n=e._classProperty,i=n.isArray,o=n.type,r=J8.getComponentCount(o);if(C(e._unpackedValues)){const n=e._unpackedValues[t];return i?pn(n,!0):n}return i||1!==r?b9(e,n,t):e._getValue(t)}function b9(e,t,n){let i,o;if(t.isVariableLengthArray){i=e._arrayOffsets.get(n),o=e._arrayOffsets.get(n+1)-i;const r=J8.getComponentCount(t.type);i*=r,o*=r}else{const r=R(t.arrayLength,1),s=r*e._vectorComponentCount;i=n*s,o=s}const r=new Array(o);for(let s=0;s<o;s++)r[s]=e._getValue(i+s);return r}function A9(e,t,n){P9(e,t,n)&&R9(e);const i=e._classProperty,o=i.isArray,r=i.type,s=J8.getComponentCount(r);if(C(e._unpackedValues))return i.isArray&&(n=pn(n,!0)),void(e._unpackedValues[t]=n);if(!o&&1===s)return void e._setValue(t,n);let a,c;if(i.isVariableLengthArray)a=e._arrayOffsets.get(t),c=e._arrayOffsets.get(t+1)-a;else{const n=R(i.arrayLength,1),o=n*e._vectorComponentCount;a=t*o,c=o}for(let l=0;l<c;++l)e._setValue(a+l,n[l])}function w9(e,t,n){const i=n.get(e),o=n.get(e+1)-i;return Bp(t.typedArray,i,o)}function T9(e,t){const n=e>>3,i=e%8;return 1===(t.typedArray[n]>>i&1)}function C9(e,t,n){const i=e>>3,o=e%8;n?t.typedArray[i]|=1<<o:t.typedArray[i]&=~(1<<o)}function E9(e,t){const n=t.dataView,i=8*e;let o=0;const r=(128&n.getUint8(i+7))>0;let s=!0;for(let a=0;a<8;++a){let e=n.getUint8(i+a);r&&(s?0!==e&&(e=255&~(e-1),s=!1):e=255&~e),o+=e*Math.pow(256,a)}return r&&(o=-o),o}function x9(e,t){const n=t.dataView,i=8*e;let o=BigInt(0);const r=(128&n.getUint8(i+7))>0;let s=!0;for(let a=0;a<8;++a){let e=n.getUint8(i+a);r&&(s?0!==e&&(e=255&~(e-1),s=!1):e=255&~e),o+=BigInt(e)*(BigInt(1)<<BigInt(8*a))}return r&&(o=-o),o}function S9(e,t){const n=t.dataView,i=8*e,o=n.getUint32(i,!0),r=n.getUint32(i+4,!0),s=o+4294967296*r;return s}function I9(e,t){const n=t.dataView,i=8*e,o=BigInt(n.getUint32(i,!0)),r=BigInt(n.getUint32(i+4,!0)),s=o+BigInt(4294967296)*r;return s}function O9(e){switch(e){case X8.INT8:return ih.BYTE;case X8.UINT8:return ih.UNSIGNED_BYTE;case X8.INT16:return ih.SHORT;case X8.UINT16:return ih.UNSIGNED_SHORT;case X8.INT32:return ih.INT;case X8.UINT32:return ih.UNSIGNED_INT;case X8.FLOAT32:return ih.FLOAT;case X8.FLOAT64:return ih.DOUBLE}}function D9(e){if(C(e._unpackedValues))return!1;const t=e._classProperty,n=t.type,i=t.valueType;return n===J8.STRING||(i===X8.INT64&&!Oc.supportsBigInt64Array()||i===X8.UINT64&&!Oc.supportsBigUint64Array())}function P9(e,t,n){if(D9(e))return!0;const i=e._arrayOffsets;if(C(i)){const e=i.get(t+1)-i.get(t),o=n.length;if(e!==o)return!0}return!1}function R9(e){e._unpackedValues=L9(e),e._arrayOffsets=void 0,e._stringOffsets=void 0,e._values=void 0}function L9(e){const t=e._count,n=new Array(t),i=e._classProperty,o=i.isArray,r=i.type,s=J8.getComponentCount(r);if(!o&&1===s){for(let i=0;i<t;++i)n[i]=e._getValue(i);return n}for(let a=0;a<t;a++)n[a]=b9(e,i,a);return n}function M9(e,t){const n=e._classProperty,i=n.isVariableLengthArray;return!e._hasValueTransform||i?t:m9.valueTransformInPlace(t,e._offset,e._scale,X8.applyValueTransform)}function B9(e,t){const n=e._classProperty,i=n.isVariableLengthArray;return!e._hasValueTransform||i?t:m9.valueTransformInPlace(t,e._offset,e._scale,X8.unapplyValueTransform)}function N9(e,t,n){const i=this;let o,r,s;if(t===X8.INT64)Oc.supportsBigInt()?Oc.supportsBigInt64Array()?(o=new BigInt64Array(e.buffer,e.byteOffset,n),s=function(e,t){i.typedArray[e]=BigInt(t)}):(o=new Uint8Array(e.buffer,e.byteOffset,8*n),r=function(e){return x9(e,i)}):(CA("INT64 type is not fully supported on this platform. Values greater than 2^53 - 1 or less than -(2^53 - 1) may lose precision when read."),o=new Uint8Array(e.buffer,e.byteOffset,8*n),r=function(e){return E9(e,i)});else if(t===X8.UINT64)Oc.supportsBigInt()?Oc.supportsBigUint64Array()?(o=new BigUint64Array(e.buffer,e.byteOffset,n),s=function(e,t){i.typedArray[e]=BigInt(t)}):(o=new Uint8Array(e.buffer,e.byteOffset,8*n),r=function(e){return I9(e,i)}):(CA("UINT64 type is not fully supported on this platform. Values greater than 2^53 - 1 may lose precision when read."),o=new Uint8Array(e.buffer,e.byteOffset,8*n),r=function(e){return S9(e,i)});else{const r=O9(t);o=ih.createArrayBufferView(r,e.buffer,e.byteOffset,n),s=function(e,t){i.typedArray[e]=t}}C(r)||(r=function(e){return i.typedArray[e]}),this.typedArray=o,this.dataView=new DataView(o.buffer,o.byteOffset),this.get=r,this.set=s,this._componentType=t}Object.defineProperties(_9.prototype,{hasValueTransform:{get:function(){return this._hasValueTransform}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),_9.prototype.get=function(e){y9(this,e);let t=v9(this,e);return t=this._classProperty.handleNoData(t),C(t)?(t=this._classProperty.normalize(t),t=M9(this,t),this._classProperty.unpackVectorAndMatrixTypes(t)):(t=this._classProperty.default,this._classProperty.unpackVectorAndMatrixTypes(t))},_9.prototype.set=function(e,t){const n=this._classProperty;D.defined("value",t),y9(this,e);const i=n.validate(t);if(C(i))throw new x(i);t=n.packVectorAndMatrixTypes(t),t=B9(this,t),t=n.unnormalize(t),A9(this,e,t)},_9.prototype.getTypedArray=function(){if(C(this._values))return this._values.typedArray};var F9=_9;function z9(e){e=R(e,R.EMPTY_OBJECT);const t=e.count,n=e.class;D.typeOf.number.greaterThan("options.count",t,0),D.typeOf.object("options.class",n);const i={};if(C(e.properties))for(const o in e.properties)e.properties.hasOwnProperty(o)&&(i[o]=new F9({count:t,property:e.properties[o],classProperty:n.properties[o],bufferViews:e.bufferViews}));this._count=t,this._class=n,this._properties=i}function k9(e,t){const n=e.properties;if(!C(n))return;const i=n[t];if(C(i)&&C(i.default)){let e=i.default;return i.isArray&&(e=pn(e,!0)),e=i.normalize(e),i.unpackVectorAndMatrixTypes(e)}}Object.defineProperties(z9.prototype,{count:{get:function(){return this._count}},class:{get:function(){return this._class}}}),z9.prototype.hasProperty=function(e){return q8.hasProperty(e,this._properties,this._class)},z9.prototype.hasPropertyBySemantic=function(e){return q8.hasPropertyBySemantic(e,this._properties,this._class)},z9.prototype.getPropertyIds=function(e){return q8.getPropertyIds(this._properties,this._class,e)},z9.prototype.getProperty=function(e,t){D.typeOf.string("propertyId",t);const n=this._properties[t];let i;return i=C(n)?n.get(e):k9(this._class,t),i},z9.prototype.setProperty=function(e,t,n){D.typeOf.string("propertyId",t);const i=this._properties[t];return!!C(i)&&(i.set(e,n),!0)},z9.prototype.getPropertyBySemantic=function(e,t){let n;D.typeOf.string("semantic",t);const i=this._class.propertiesBySemantic;if(C(i)&&(n=i[t]),C(n))return this.getProperty(e,n.id)},z9.prototype.setPropertyBySemantic=function(e,t,n){let i;D.typeOf.string("semantic",t);const o=this._class.propertiesBySemantic;return C(o)&&(i=o[t]),!!C(i)&&this.setProperty(e,i.id,n)},z9.prototype.getPropertyTypedArray=function(e){D.typeOf.string("propertyId",e);const t=this._properties[e];if(C(t))return t.getTypedArray()},z9.prototype.getPropertyTypedArrayBySemantic=function(e){let t;D.typeOf.string("semantic",e);const n=this._class.propertiesBySemantic;if(C(n)&&(t=n[e]),C(t))return this.getPropertyTypedArray(t.id)};var U9=z9;function V9(){}Object.defineProperties(V9.prototype,{promise:{get:function(){x.throwInstantiationError()}},cacheKey:{get:function(){x.throwInstantiationError()}}}),V9.prototype.load=function(){x.throwInstantiationError()},V9.prototype.unload=function(){},V9.prototype.process=function(e){},V9.prototype.getError=function(e,t){return D.typeOf.string("errorMessage",e),C(t)&&(e+=`\n${t.message}`),new Je(e)},V9.prototype.isDestroyed=function(){return!1},V9.prototype.destroy=function(){return this.unload(),Qh(this)};const H9={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,FAILED:4};var G9=Object.freeze(H9);function W9(e){e=R(e,R.EMPTY_OBJECT);const t=e.typedArray,n=e.resource,i=e.cacheKey;if(C(t)===C(n))throw new x("One of options.typedArray and options.resource must be defined.");this._typedArray=t,this._resource=n,this._cacheKey=i,this._state=G9.UNLOADED,this._promise=yn()}function q9(e){const t=e._resource;e._state=G9.LOADING,W9._fetchArrayBuffer(t).then((function(t){e.isDestroyed()||(e._typedArray=new Uint8Array(t),e._state=G9.READY,e._promise.resolve(e))})).catch((function(n){if(e.isDestroyed())return;e._state=G9.FAILED;const i=`Failed to load external buffer: ${t.url}`;e._promise.reject(e.getError(i,n))}))}C(Object.create)&&(W9.prototype=Object.create(V9.prototype),W9.prototype.constructor=W9),Object.defineProperties(W9.prototype,{promise:{get:function(){return this._promise.promise}},cacheKey:{get:function(){return this._cacheKey}},typedArray:{get:function(){return this._typedArray}}}),W9.prototype.load=function(){C(this._typedArray)?this._promise.resolve(this):q9(this)},W9._fetchArrayBuffer=function(e){return e.fetchArrayBuffer()},W9.prototype.unload=function(){this._typedArray=void 0},function(){var e,t="B9h79tEBBBENQ9gEUEU9gEUB9gBB9gVUUUUUEU9gDUUEU9gLUUUUEU9gIUUUEU9gVUUUUUB9gLUUUUB9gD99UE99Ie8aDILEVOLEVLRRRRRWWVBOOBEdddLVE9wEIIVIEBEOWEUEC+Q/KEKR/QIhO9tw9t9vv95DBh9f9f939h79t9f9j9h229f9jT9vv7BB8a9tw79o9v9wT9fw9u9j9v9kw9WwvTw949C919m9mwvBE8f9tw79o9v9wT9fw9u9j9v9kw9WwvTw949C919m9mwv9C9v919u9kBDe9tw79o9v9wT9fw9u9j9v9kw9WwvTw949Wwv79p9v9uBIy9tw79o9v9wT9fw9u9j9v9kw69u9kw949C919m9mwvBL8e9tw79o9v9wT9fw9u9j9v9kw69u9kw949C919m9mwv9C9v919u9kBO8a9tw79o9v9wT9fw9u9j9v9kw69u9kw949Wwv79p9v9uBRe9tw79o9v9wT9fw9u9j9v9kw69u9kw949Twg91w9u9jwBWA9tw79o9v9wT9fw9u9j9v9kw69u9kw949Twg91w9u9jw9C9v919u9kBdl9tw79o9v9wT9fw9u9j9v9kws9p2Twv9P9jTBQk9tw79o9v9wT9fw9u9j9v9kws9p2Twv9R919hTBKl9tw79o9v9wT9fw9u9j9v9kws9p2Twvt949wBXe9tw79o9v9wT9f9v9wT9p9t9p96w9WwvTw94j9h9j9owBSA9tw79o9v9wT9f9v9wT9p9t9p96w9WwvTw94j9h9j9ow9TTv9p9wBZA9tw79o9v9wT9f9v9wT9p9t9p96w9WwvTw94swT9j9o9Sw9t9h9wBhL79iv9rBodWEBCEKDqxQ+f9Q8aDBK/EpE8jU8jJJJJBCJO9rGV8kJJJJBCBHODNALCEFAE0MBABCBrBJ+KJJBC+gEv86BBAVCJDFCBCJDZnJJJB8aDNAItMBAVCJDFADALZ+TJJJB8aKABAEFHRABCEFHEAVALFCBCBCJDAL9rALCfE0eZnJJJB8aAVAVCJDFALZ+TJJJBHWCJ/ABAL9uHODNAItMBAOC/wfBgGOCJDAOCJD6eHdCBHQINAWCJLFCBCJDZnJJJB8aAdAIAQ9rAQAdFAI6eHKADAQAL2FHXDNALtMBAKCSFGOC9wgHMAOCL4CIFCD4HpCBHSAXHZAEHhINDNAKtMBAWASFrBBHoCBHEAZHOINAWCJLFAEFAOrBBGaAo9rGoCETAoCkTCk91CR4786BBAOALFHOAaHoAECEFGEAK9HMBKKDNARAh9rAp6MBAhCBApZnJJJBGcApFHEDNAMtMBCBHxAWCJLFHqINARAE9rCk6MDAWCJLFAxFGlrBDHoCUHODNAlrBEGaAlrBBGkvCfEgMBCBHaAoCfEgMBCBHoDNAlrBIMBAlrBLMBAlrBVMBAlrBOMBAlrBRMBAlrBWMBAlrBdMBAlrBQMBAlrBKMBAlrBXMBAlrBMMBCBHaAlrBpMECBHoCUCBAlrBSeHOKCBHaKDNDNDNDNCLCDCECWAOCZ6GheAkCfEgGkCD0CLvAaCfEgGaCD0FAoCfEgGoCD0FAlrBIGyCD0FAlrBLG8aCD0FAlrBVGeCD0FAlrBOG3CD0FAlrBRG5CD0FAlrBWG8eCD0FAlrBdG8fCD0FAlrBQGACD0FAlrBKGHCD0FAlrBXGGCD0FAlrBMG8jCD0FAlrBpG8kCD0FAlrBSG8lCD0FG8mAOCZAheG8n6GOeAkCp0CWvAaCp0FAoCp0FAyCp0FA8aCp0FAeCp0FA3Cp0FA5Cp0FA8eCp0FA8fCp0FAACp0FAHCp0FAGCp0FA8jCp0FA8kCp0FA8lCp0FA8mA8nAOe6GoeGyCUFpDIEBKAcAxCO4FGaAarBBCDCIAoeAxCI4COgTv86BBAyCW9HMEAEAl8pBB83BBAECWFAlCWF8pBB83BBAECZFHEXDKAcAxCO4FGaAarBBCEAxCI4COgTv86BBKCDCLCWCEAheAOeAoeH8aCUAyTCU7HaCBH5AqHeINAEH3A8aHoAeHECBHOINAErBBGhAaAhAaCfEgGk6eAOCfEgAyTvHOAECEFHEAoCUFGoMBKA3AO86BBAeA8aFHeA3CEFHEA5A8aFG5CZ6MBKDNAlrBBGOAk6MBA3AO86BEA3CDFHEKDNAlrBEGOAk6MBAEAO86BBAECEFHEKDNAlrBDGOAk6MBAEAO86BBAECEFHEKDNAlrBIGOAk6MBAEAO86BBAECEFHEKDNAlrBLGOAk6MBAEAO86BBAECEFHEKDNAlrBVGOAk6MBAEAO86BBAECEFHEKDNAlrBOGOAk6MBAEAO86BBAECEFHEKDNAlrBRGOAk6MBAEAO86BBAECEFHEKDNAlrBWGOAk6MBAEAO86BBAECEFHEKDNAlrBdGOAk6MBAEAO86BBAECEFHEKDNAlrBQGOAk6MBAEAO86BBAECEFHEKDNAlrBKGOAk6MBAEAO86BBAECEFHEKDNAlrBXGOAk6MBAEAO86BBAECEFHEKDNAlrBMGOAk6MBAEAO86BBAECEFHEKDNAlrBpGOAk6MBAEAO86BBAECEFHEKAlrBSGOAk6MBAEAO86BBAECEFHEKAqCZFHqAxCZFGxAM6MBKKAEtMBAZCEFHZAEHhASCEFGSALsMDXEKKCBHOXIKAWAXAKCUFAL2FALZ+TJJJB8aAKAQFGQAI6MBKKCBHOARAE9rCAALALCA6e6MBDNALC8f0MBAECBCAAL9rGOZnJJJBAOFHEKAEAWCJDFALZ+TJJJBALFAB9rHOKAVCJOF8kJJJJBAOK9HEEUAECAAECA0eABCJ/ABAE9uC/wfBgGDCJDADCJD6eGDFCUFAD9uAE2ADCL4CIFCD4ADv2FCEFKMBCBABbDJ+KJJBK/pSEeU8jJJJJBC/AE9rGL8kJJJJBCBHVDNAICI9uGOChFAE0MBABCBYD+E+KJJBGRC/gEv86BBALC/ABFCfECJEZnJJJB8aALCuFGW9CU83IBALC8wFGd9CU83IBALCYFGQ9CU83IBALCAFGK9CU83IBALCkFGX9CU83IBALCZFGM9CU83IBAL9CU83IWAL9CU83IBABAEFC9wFGpABCEFGSAOFGE6HODNAItMBCMCSARCB9KeHZCBHhCBHoCBHaCBHcCBHxINDNAOCEgtMBCBHVXIKCDHqADAaCDTFGOYDBHlAOCWFYDBHkAOCLFYDBHyCBH8aCBHODNDNDNDNDNDNDNDNDNINALC/ABFAOCU7AxFCSgCITFGVYDLHeDNAVYDBGVAl9HMBAeAy9HMBAqC9+FHqXDKDNAVAy9HMBAeAk9HMBAqCUFHqXDKDNAVAk9HMBAeAlsMDKAqCLFHqA8aCZFH8aAOCEFGOCZ9HMBXDKKAqC870MBADAqCIgCX2GVC+E1JJBFYDBAaFCDTFYDBHqADAVCJ1JJBFYDBAaFCDTFYDBHyALADAVC11JJBFYDBAaFCDTFYDBGVAcZ+FJJJBGeCBCSAVAhsGkeAeCB9KAeAZ9IgGleHeAkAlCE7gHkDNARCE9IMBAeCS9HMBAVAVAoAVCEFAosGeeGoCEFsMDCMCSAeeHeKASAeA8av86BBAeCS9HMDAVAo9rGOCETAOC8f917HOINAEAOCfB0CRTAOCfBgv86BBAECEFHEAOCR4GOMBKAVHoXIKADCEAkAhsCETAyAhseCX2GOC11JJBFYDBAaFCDTFYDBHqADAOC+E1JJBFYDBAaFCDTFYDBHeADAOCJ1JJBFYDBAaFCDTFYDBHVCBHlDNARCE9IMBAhtMBAVMBAeCE9HMBAqCD9HMBAW9CU83IBAd9CU83IBAQ9CU83IBAK9CU83IBAX9CU83IBAM9CU83IBAL9CU83IWAL9CU83IBCBHhCEHlKAhAVAhsGOFH8aALAeAcZ+FJJJBHyALAqAcZ+FJJJBHkAyCM0MLAyCEFHyXVKCpHeASAOCLTCpv86BBAVHoKAetMBAeAZ9IMEKALAcCDTFAVbDBAcCEFCSgHcKAhAkFHhALC/ABFAxCITFGOAqbDLAOAVbDBALC/ABFAxCEFCSgGOCITFGeAVbDLAeAybDBAOCEFHVXDKCBCSAeA8asG3eHyA8aA3FH8aKDNDNAkCM0MBAkCEFHkXEKCBCSAqA8asG3eHkA8aA3FH8aKDNDNDNDNDNDNDNDNDNDNDNDNDNDNDNDNDNAkAyCLTvG3CfEgG5C+qUFp9UISSSSSSSSSSSSSSWSLQMSSSSSSSSSSSSESVSSSSSSSSSSSSSRDSdSSSSSSSSSSSSSSKSSSSSSSSSSSSSSSSOBKC/wEH8eA5pDMKpKC/xEH8eXXKC/yEH8eXKKC/zEH8eXQKC/0EH8eXdKC/1EH8eXWKC/2EH8eXRKC/3EH8eXOKC/4EH8eXVKC/5EH8eXLKC/6EH8eXIKC/7EH8eXDKC/8EH8eXEKCPEH8eKAlAVAh9HvMBASA8e86BBXEKASC9+CUAOe86BBAEA386BBAECEFHEKDNAOMBAVAo9rGOCETAOC8f917HOINAEAOCfB0CRTAOCfBgv86BBAECEFHEAOCR4GOMBKAVHoKDNAyCS9HMBAeAo9rGOCETAOC8f917HOINAEAOCfB0CRTAOCfBgv86BBAECEFHEAOCR4GOMBKAeHoKDNAkCS9HMBAqAo9rGOCETAOC8f917HOINAEAOCfB0CRTAOCfBgv86BBAECEFHEAOCR4GOMBKAqHoKALAcCDTFAVbDBAcCEFCSgHODNDNAypZBEEEEEEEEEEEEEEBEKALAOCDTFAebDBAcCDFCSgHOKDNDNAkpZBEEEEEEEEEEEEEEBEKALAOCDTFAqbDBAOCEFCSgHOKALC/ABFAxCITFGyAVbDLAyAebDBALC/ABFAxCEFCSgCITFGyAebDLAyAqbDBALC/ABFAxCDFCSgCITFGeAqbDLAeAVbDBAxCIFHVAOHcA8aHhKApAE6HOASCEFHSAVCSgHxAaCIFGaAI6MBKKCBHVAOMBAE9C/lm+i/D+Z+g8a83BWAE9CJ/s+d+0/1+M/e/U+GU83BBAEAB9rCZFHVKALC/AEF8kJJJJBAVK+mIEEUCBHIDNABADCUFCSgCDTFYDBAEsMBCEHIABADCpFCSgCDTFYDBAEsMBCDHIABADCMFCSgCDTFYDBAEsMBCIHIABADCXFCSgCDTFYDBAEsMBCLHIABADCKFCSgCDTFYDBAEsMBCVHIABADCQFCSgCDTFYDBAEsMBCOHIABADCdFCSgCDTFYDBAEsMBCRHIABADCWFCSgCDTFYDBAEsMBCWHIABADCRFCSgCDTFYDBAEsMBCdHIABADCOFCSgCDTFYDBAEsMBCQHIABADCVFCSgCDTFYDBAEsMBCKHIABADCLFCSgCDTFYDBAEsMBCXHIABADCIFCSgCDTFYDBAEsMBCMHIABADCDFCSgCDTFYDBAEsMBCpHIABADCEFCSgCDTFYDBAEsMBCSCUABADCSgCDTFYDBAEseSKAIKjEIUCRHDDNINADCEFHIADC96FGLC8f0MEAIHDCEALTAE6MBKKAICR9uCI2CDFABCI9u2ChFKMBCBABbD+E+KJJBK+YDERU8jJJJJBCZ9rHLCBHVDNAICVFAE0MBCBHVABCBrB+E+KJJBC/QEv86BBAL9CB83IWABCEFHOABAEFC98FHRDNAItMBCBHWINDNARAO0MBCBSKAVADAWCDTFYDBGdALCWFAVCDTFYDB9rGEAEC8f91GEFAE7C59K7GVAdALCWFAVCDTFGQYDB9rGEC8f91CETAECDT7vHEINAOAECfB0CRTAECfBgv86BBAOCEFHOAECR4GEMBKAQAdbDBAWCEFGWAI9HMBKKCBHVARAO6MBAOCBbBBAOAB9rCLFHVKAVK86EIUCWHDDNINADCEFHIADC95FGLC8f0MEAIHDCEALTAE6MBKKAICR9uAB2CVFK+yWDEUO99DNAEtMBADCLsHVCUADCETCUFTCU7HDDNDNCUAICUFTCU7+yGOjBBBzmGR+LjBBB9P9dtMBAR+oHIXEKCJJJJ94HIKAD+yHWDNAVMBABCOFHDINALCLFiDBGRjBBBBjBBJzALiDBGd+LAR+LmALCWFiDBGQ+LmGR+VARjBBBB9beGRnHKAdARnHRALCXFiDBHdDNDNAQjBBBB9gtMBAKHQXEKjBBJzAR+L+TGQAQ+MAKjBBBB9geHQjBBJzAK+L+TGKAK+MARjBBBB9geHRKADC9+FAI87EBDNDNjBBBzjBBB+/AdjBBBB9geAdjBBJ+/AdjBBJ+/9geGdjBBJzAdjBBJz9feAWnmGd+LjBBB9P9dtMBAd+oHBXEKCJJJJ94HBKADAB87EBDNDNjBBBzjBBB+/AQjBBBB9geAQjBBJ+/AQjBBJ+/9geGdjBBJzAdjBBJz9feAOnmGd+LjBBB9P9dtMBAd+oHBXEKCJJJJ94HBKADC98FAB87EBDNDNjBBBzjBBB+/ARjBBBB9geARjBBJ+/ARjBBJ+/9geGRjBBJzARjBBJz9feAOnmGR+LjBBB9P9dtMBAR+oHBXEKCJJJJ94HBKADC96FAB87EBALCZFHLADCWFHDAECUFGEMBXDKKABCIFHDINALCLFiDBGRjBBBBjBBJzALiDBGd+LAR+LmALCWFiDBGQ+LmGR+VARjBBBB9beGRnHKAdARnHRALCXFiDBHdDNDNAQjBBBB9gtMBAKHQXEKjBBJzAR+L+TGQAQ+MAKjBBBB9geHQjBBJzAK+L+TGKAK+MARjBBBB9geHRKADCUFAI86BBDNDNjBBBzjBBB+/AdjBBBB9geAdjBBJ+/AdjBBJ+/9geGdjBBJzAdjBBJz9feAWnmGd+LjBBB9P9dtMBAd+oHBXEKCJJJJ94HBKADAB86BBDNDNjBBBzjBBB+/AQjBBBB9geAQjBBJ+/AQjBBJ+/9geGdjBBJzAdjBBJz9feAOnmGd+LjBBB9P9dtMBAd+oHBXEKCJJJJ94HBKADC9+FAB86BBDNDNjBBBzjBBB+/ARjBBBB9geARjBBJ+/ARjBBJ+/9geGRjBBJzARjBBJz9feAOnmGR+LjBBB9P9dtMBAR+oHBXEKCJJJJ94HBKADC99FAB86BBALCZFHLADCLFHDAECUFGEMBKKK/KLLD99EUE99EUDNAEtMBDNDNCUAICUFTCU7+yGVjBBBzmGO+LjBBB9P9dtMBAO+oHIXEKCJJJJ94HIKAIC/8fIgHRINABCOFCICDALCLFiDB+LALiDB+L9eGIALCWFiDB+LALAICDTFiDB+L9eeGIALCXFiDB+LALAICDTFiDB+L9eeGIARv87EBDNDNjBBBzjBBB+/ALAICEFCIgCDTFiDBj/zL+1znjBBJ+/jBBJzALAICDTFiDBjBBBB9deGOnGWjBBBB9geAWjBBJ+/AWjBBJ+/9geGWjBBJzAWjBBJz9feAVnmGW+LjBBB9P9dtMBAW+oHdXEKCJJJJ94HdKABAd87EBDNDNjBBBzjBBB+/AOALAICDFCIgCDTFiDBj/zL+1znnGWjBBBB9geAWjBBJ+/AWjBBJ+/9geGWjBBJzAWjBBJz9feAVnmGW+LjBBB9P9dtMBAW+oHdXEKCJJJJ94HdKABCDFAd87EBDNDNjBBBzjBBB+/AOALAICUFCIgCDTFiDBj/zL+1znnGOjBBBB9geAOjBBJ+/AOjBBJ+/9geGOjBBJzAOjBBJz9feAVnmGO+LjBBB9P9dtMBAO+oHIXEKCJJJJ94HIKABCLFAI87EBABCWFHBALCZFHLAECUFGEMBKKK+tDDWUE998jJJJJBCZ9rGV8kJJJJBDNAEtMBADCD4GOtMBCEAI9rHRAOCDTHWCBHdINC+cUHDALHIAOHQINAIiDBAVCXFZ+YJJJB8aAVYDXGKADADAK9IeHDAICLFHIAQCUFGQMBKARADFGICkTHKCBHDCBAI9rHXAOHIINDNDNALADFiDBGMAXZ+XJJJBjBBBzjBBB+/AMjBBBB9gemGM+LjBBB9P9dtMBAM+oHQXEKCJJJJ94HQKABADFAQCfffRgAKvbDBADCLFHDAICUFGIMBKABAWFHBALAWFHLAdCEFGdAE9HMBKKAVCZF8kJJJJBK+iMDlUI998jJJJJBC+QD9rGV8kJJJJBAVC+oEFCBC/kBZnJJJB8aCBHODNADtMBCBHOAItMBDNABAE9HMBAVCUADCDTGRADCffffI0eCBYD/4+JJJBhJJJJBBGEbD+oEAVCEbD1DAEABARZ+TJJJB8aKAVC+YEFCWFCBbDBAV9CB83I+YEAVC+YEFAEADAIAVC+oEFZ+OJJJBCUAICDTGWAICffffI0eGdCBYD/4+JJJBhJJJJBBHRAVC+oEFAVYD1DGOCDTFARbDBAVAOCEFGQbD1DARAVYD+YEGKAWZ+TJJJBHXAVC+oEFAQCDTFADCI9uGMCBYD/4+JJJBhJJJJBBGRbDBAVAOCDFGWbD1DARCBAMZnJJJBHpAVC+oEFAWCDTFAdCBYD/4+JJJBhJJJJBBGSbDBAVAOCIFGQbD1DAXHRASHWINAWALiDBALARYDBGdCWAdCW6eCDTFC/EBFiDBmuDBARCLFHRAWCLFHWAICUFGIMBKCBHIAVC+oEFAQCDTFCUAMCDTADCffff970eCBYD/4+JJJBhJJJJBBGQbDBAVAOCLFGObD1DDNADCI6MBAEHRAQHWINAWASARYDBCDTFiDBASARCLFYDBCDTFiDBmASARCWFYDBCDTFiDBmuDBARCXFHRAWCLFHWAICEFGIAM6MBKKAVC/MBFHZAVYD+cEHhAVYD+gEHoAVHRCBHdCBHWCBHaCEHcINARHxAEAWCX2FGqCWFGlYDBHDAqYDBHkABAaCX2FGRCLFAqCLFGyYDBG8abDBARAkbDBARCWFADbDBApAWFCE86BBAZADbDWAZA8abDLAZAkbDBAQAWCDTFCBbDBCIHeDNAdtMBAxHRINDNARYDBGIADsMBAIAksMBAIA8asMBAZAeCDTFAIbDBAeCEFHeKARCLFHRAdCUFGdMBKKAXAkCDTFGRARYDBCUFbDBAXA8aCDTFGRARYDBCUFbDBAXADCDTFGRARYDBCUFbDBAoAhAqYDBCDTGIFYDBCDTFGkHRAKAIFGDYDBGdHIDNAdtMBDNINARYDBAWsMEARCLFHRAICUFGItMDXBKKARAdCDTAkFC98FYDBbDBADADYDBCUFbDBKAoAhAyYDBCDTGIFYDBCDTFGkHRAKAIFGDYDBGdHIDNAdtMBDNINARYDBAWsMEARCLFHRAICUFGIMBXDKKARAdCDTAkFC98FYDBbDBADADYDBCUFbDBKDNAKAlYDBCDTGRFGDYDBGdtMBAoAhARFYDBCDTFGkHRAdHIDNINARYDBAWsMEARCLFHRAICUFGIMBXDKKARAdCDTAkFC98FYDBbDBADADYDBCUFbDBKDNDNAetMBCUHWjBBBBH3CBHRINASAZARCDTFYDBCDTGIFGdiDBH5AdALCBARCEFGkARCS0eCDTFiDBALAXAIFYDBGRCWARCW6eCDTFC/EBFiDBmG8euDBDNAKAIFYDBGdtMBA8eA5+TH8eAoAhAIFYDBCDTFHRAdCDTHIINAQARYDBGdCDTFGDA8eADiDBmG5uDBA5A3A3A59dGDeH3AdAWADeHWARCLFHRAIC98FGIMBKKAkHRAkAe9HMBKAWCU9HMEKAcAM9PMDINDNApAcFrBBMBAcHWXDKAMAcCEFGc9HMBXIKKAaCEFHaAeCZAeCZ6eHdAZHRAxHZAWCU9HMBKKAOCDTAVC+oEFFC98FHRDNINAOtMEARYDBCBYD/0+JJJBh+BJJJBBARC98FHRAOCUFHOXBKKAVC+QDF8kJJJJBK/iLEVUCUAICDTGVAICffffI0eGOCBYD/4+JJJBhJJJJBBHRALALYD9gGWCDTFARbDBALAWCEFbD9gABARbDBAOCBYD/4+JJJBhJJJJBBHRALALYD9gGOCDTFARbDBALAOCEFbD9gABARbDLCUADCDTADCffffI0eCBYD/4+JJJBhJJJJBBHRALALYD9gGOCDTFARbDBALAOCEFbD9gABARbDWABYDBCBAVZnJJJB8aADCI9uHdDNADtMBABYDBHOAEHLADHRINAOALYDBCDTFGVAVYDBCEFbDBALCLFHLARCUFGRMBKKDNAItMBABYDBHLABYDLHRCBHVAIHOINARAVbDBARCLFHRALYDBAVFHVALCLFHLAOCUFGOMBKKDNADCI6MBABYDLHRABYDWHVCBHLINAECWFYDBHOAECLFYDBHDARAEYDBCDTFGWAWYDBGWCEFbDBAVAWCDTFALbDBARADCDTFGDADYDBGDCEFbDBAVADCDTFALbDBARAOCDTFGOAOYDBGOCEFbDBAVAOCDTFALbDBAECXFHEALCEFGLAd6MBKKDNAItMBABYDLHEABYDBHLINAEAEYDBALYDB9rbDBALCLFHLAECLFHEAICUFGIMBKKKqBABAEADAIC+k1JJBZ+NJJJBKqBABAEADAIC+M+JJJBZ+NJJJBK9dEEUABCfEAICDTZnJJJBHLCBHIDNADtMBINDNALAEYDBCDTFGBYDBCU9HMBABAIbDBAICEFHIKAECLFHEADCUFGDMBKKAIK9TEIUCBCBYD/8+JJJBGEABCIFC98gFGBbD/8+JJJBDNDNABzBCZTGD9NMBCUHIABAD9rCffIFCZ4NBCUsMEKAEHIKAIK/lEEEUDNDNAEABvCIgtMBABHIXEKDNDNADCZ9PMBABHIXEKABHIINAIAEYDBbDBAICLFAECLFYDBbDBAICWFAECWFYDBbDBAICXFAECXFYDBbDBAICZFHIAECZFHEADC9wFGDCS0MBKKADCL6MBINAIAEYDBbDBAECLFHEAICLFHIADC98FGDCI0MBKKDNADtMBINAIAErBB86BBAICEFHIAECEFHEADCUFGDMBKKABK/AEEDUDNDNABCIgtMBABHIXEKAECfEgC+B+C+EW2HLDNDNADCZ9PMBABHIXEKABHIINAIALbDBAICXFALbDBAICWFALbDBAICLFALbDBAICZFHIADC9wFGDCS0MBKKADCL6MBINAIALbDBAICLFHIADC98FGDCI0MBKKDNADtMBINAIAE86BBAICEFHIADCUFGDMBKKABK9TEIUCBCBYD/8+JJJBGEABCIFC98gFGBbD/8+JJJBDNDNABzBCZTGD9NMBCUHIABAD9rCffIFCZ4NBCUsMEKAEHIKAIK9+EIUzBHEDNDNCBYD/8+JJJBGDAECZTGI9NMBCUHEADAI9rCffIFCZ4NBCUsMEKADHEKCBABAE9rCIFC98gCBYD/8+JJJBFGDbD/8+JJJBDNADzBCZTGE9NMBADAE9rCffIFCZ4NB8aKKXBABAEZ+ZJJJBK+BEEIUDNAB+8GDCl4GICfEgGLCfEsMBDNALMBDNABjBBBB9cMBAECBbDBABSKABjBBJ9fnAEZ+YJJJBHBAEAEYDBCNFbDBABSKAEAICfEgC+CUFbDBADCfff+D94gCJJJ/4Iv++HBKABK+gEBDNDNAECJE9IMBABjBBBUnHBDNAECfE9OMBAEC+BUFHEXDKABjBBBUnHBAECPDAECPD9IeC+C9+FHEXEKAEC+BU9KMBABjBBJXnHBDNAEC+b9+9MMBAEC/mBFHEXEKABjBBJXnHBAEC+299AEC+2999KeC/MEFHEKABAEClTCJJJ/8IF++nKK+ODDBCJWK/0EBBBBEBBBDBBBEBBBDBBBBBBBDBBBBBBBEBBBBBBB+L29Hz/69+9Kz/n/76z/RG97z/Z/O9Xz8j/b85z/+/U9Yz/B/K9hz+2/z9dz9E+L9Mz59a8kz+R/t3z+a+Zyz79ohz/J4++8++y+d9v8+BBBB9S+49+z8r+Hbz9m9m/m8+l/Z/O8+/8+pg89Q/X+j878r+Hq8++m+b/E87BBBBBBJzBBJzBBJz+e/v/n8++y+dSz9I/h/68+XD/r8+/H0838+/w+nOzBBBB+wv9o8+UF888+9I/h/68+9C9g/l89/N/M9M89/d8kO8+BBBBF+8Tz9M836zs+2azl/Zpzz818ez9E+LXz/u98f8+819e/68+BC/0dKXEBBBDBBBZwBB",n=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!==typeof WebAssembly)return{supported:!1};var i=WebAssembly.instantiate(o(t),{}).then((function(t){e=t.instance,e.exports.__wasm_call_ctors(),e.exports.meshopt_encodeVertexVersion(0),e.exports.meshopt_encodeIndexVersion(1)}));function o(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;++i){var o=e.charCodeAt(i);t[i]=o>96?o-71:o>64?o-65:o>47?o+4:o>46?63:62}var r=0;for(i=0;i<e.length;++i)t[r++]=t[i]<60?n[t[i]]:64*(t[i]-60)+t[++i];return t.buffer.slice(0,r)}function r(e){if(!e)throw new Error("Assertion failed")}function s(t,n,i){var o=e.exports.sbrk,r=o(4*t.length),s=o(4*n),a=new Uint8Array(e.exports.memory.buffer),c=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);a.set(c,r),i&&i(r,r,t.length,n);var l=e.exports.meshopt_optimizeVertexFetchRemap(s,r,t.length,n);new Uint8Array(e.exports.memory.buffer);var u=new Uint32Array(n);new Uint8Array(u.buffer).set(a.subarray(s,s+4*n)),c.set(a.subarray(r,r+4*t.length)),o(r-o(0));for(var h=0;h<t.length;++h)t[h]=u[t[h]];return[u,l]}function a(t,n,i,o,r){var s=e.exports.sbrk,a=s(n),c=s(o*r),l=new Uint8Array(e.exports.memory.buffer);l.set(new Uint8Array(i.buffer,i.byteOffset,i.byteLength),c);var u=t(a,n,c,o,r),h=new Uint8Array(u);return h.set(l.subarray(a,a+u)),s(a-s(0)),h}function c(e){for(var t=0,n=0;n<e.length;++n){var i=e[n];t<i?i:t}return t}function l(e,t){if(r(2==t||4==t),4==t)return new Uint32Array(e.buffer,e.byteOffset,e.byteLength/4);var n=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2);return new Uint32Array(n)}function u(t,n,i,o,r,s){var a=e.exports.sbrk,c=a(i*o),l=a(i*s),u=new Uint8Array(e.exports.memory.buffer);u.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),l),t(c,i,o,r,l);var h=new Uint8Array(i*o);return h.set(u.subarray(c,c+i*o)),a(c-a(0)),h}}();var j9=function(){var e="B9h79tEBBBE8fV9gBB9gVUUUUUEU9gIUUUB9gEUEU9gIUUUEUIKQBEEEDDDILLLVE9wEEEVIEBEOWEUEC+Q/IEKR/LEdO9tw9t9vv95DBh9f9f939h79t9f9j9h229f9jT9vv7BB8a9tw79o9v9wT9f9kw9j9v9kw9WwvTw949C919m9mwvBEy9tw79o9v9wT9f9kw9j9v9kw69u9kw949C919m9mwvBDe9tw79o9v9wT9f9kw9j9v9kw69u9kw949Twg91w9u9jwBIl9tw79o9v9wT9f9kw9j9v9kws9p2Twv9P9jTBLk9tw79o9v9wT9f9kw9j9v9kws9p2Twv9R919hTBVl9tw79o9v9wT9f9kw9j9v9kws9p2Twvt949wBOL79iv9rBRQ+x8yQDBK/qMEZU8jJJJJBCJ/EB9rGV8kJJJJBC9+HODNADCEFAL0MBCUHOAIrBBC+gE9HMBAVAIALFGRAD9rADZ1JJJBHWCJ/ABAD9uC/wfBgGOCJDAOCJD6eHdAICEFHLCBHQDNINAQAE9PMEAdAEAQ9rAQAdFAE6eHKDNDNADtMBAKCSFGOC9wgHXAOCL4CIFCD4HMAWCJDFHpCBHSALHZINDNARAZ9rAM9PMBCBHLXIKAZAMFHLDNAXtMBCBHhCBHIINDNARAL9rCk9PMBCBHLXVKAWCJ/CBFAIFHODNDNDNDNDNAZAICO4FrBBAhCOg4CIgpLBEDIBKAO9CB83IBAOCWF9CB83IBXIKAOALrBLALrBBGoCO4GaAaCIsGae86BBAOCEFALCLFAaFGarBBAoCL4CIgGcAcCIsGce86BBAOCDFAaAcFGarBBAoCD4CIgGcAcCIsGce86BBAOCIFAaAcFGarBBAoCIgGoAoCIsGoe86BBAOCLFAaAoFGarBBALrBEGoCO4GcAcCIsGce86BBAOCVFAaAcFGarBBAoCL4CIgGcAcCIsGce86BBAOCOFAaAcFGarBBAoCD4CIgGcAcCIsGce86BBAOCRFAaAcFGarBBAoCIgGoAoCIsGoe86BBAOCWFAaAoFGarBBALrBDGoCO4GcAcCIsGce86BBAOCdFAaAcFGarBBAoCL4CIgGcAcCIsGce86BBAOCQFAaAcFGarBBAoCD4CIgGcAcCIsGce86BBAOCKFAaAcFGarBBAoCIgGoAoCIsGoe86BBAOCXFAaAoFGorBBALrBIGLCO4GaAaCIsGae86BBAOCMFAoAaFGorBBALCL4CIgGaAaCIsGae86BBAOCpFAoAaFGorBBALCD4CIgGaAaCIsGae86BBAOCSFAoAaFGOrBBALCIgGLALCIsGLe86BBAOALFHLXDKAOALrBWALrBBGoCL4GaAaCSsGae86BBAOCEFALCWFAaFGarBBAoCSgGoAoCSsGoe86BBAOCDFAaAoFGorBBALrBEGaCL4GcAcCSsGce86BBAOCIFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCLFAoAaFGorBBALrBDGaCL4GcAcCSsGce86BBAOCVFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCOFAoAaFGorBBALrBIGaCL4GcAcCSsGce86BBAOCRFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCWFAoAaFGorBBALrBLGaCL4GcAcCSsGce86BBAOCdFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCQFAoAaFGorBBALrBVGaCL4GcAcCSsGce86BBAOCKFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCXFAoAaFGorBBALrBOGaCL4GcAcCSsGce86BBAOCMFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCpFAoAaFGorBBALrBRGLCL4GaAaCSsGae86BBAOCSFAoAaFGOrBBALCSgGLALCSsGLe86BBAOALFHLXEKAOAL8pBB83BBAOCWFALCWF8pBB83BBALCZFHLKAhCDFHhAICZFGIAX6MBKKDNALMBCBHLXIKDNAKtMBAWASFrBBHhCBHOApHIINAIAWCJ/CBFAOFrBBGZCE4CBAZCEg9r7AhFGh86BBAIADFHIAOCEFGOAK9HMBKKApCEFHpALHZASCEFGSAD9HMBKKABAQAD2FAWCJDFAKAD2Z1JJJB8aAWAWCJDFAKCUFAD2FADZ1JJJB8aKAKCBALeAQFHQALMBKC9+HOXEKCBC99ARAL9rADCAADCA0eseHOKAVCJ/EBF8kJJJJBAOK+OoEZU8jJJJJBC/AE9rGV8kJJJJBC9+HODNAECI9uGRChFAL0MBCUHOAIrBBGWC/wEgC/gE9HMBAWCSgGdCE0MBAVC/ABFCfECJEZ+JJJJB8aAVCuF9CU83IBAVC8wF9CU83IBAVCYF9CU83IBAVCAF9CU83IBAVCkF9CU83IBAVCZF9CU83IBAV9CU83IWAV9CU83IBAIALFC9wFHQAICEFGWARFHKDNAEtMBCMCSAdCEseHXABHICBHdCBHMCBHpCBHLCBHOINDNAKAQ9NMBC9+HOXIKDNDNAWrBBGRC/vE0MBAVC/ABFARCL4CU7AOFCSgCITFGSYDLHZASYDBHhDNARCSgGSAX9PMBAVARCU7ALFCSgCDTFYDBAdASeHRAStHSDNDNADCD9HMBABAh87EBABCLFAR87EBABCDFAZ87EBXEKAIAhbDBAICWFARbDBAICLFAZbDBKAdASFHdAVC/ABFAOCITFGoARbDBAoAZbDLAVALCDTFARbDBAVC/ABFAOCEFCSgGOCITFGZAhbDBAZARbDLALASFHLAOCEFHOXDKDNDNASCSsMBAMASFASC987FCEFHMXEKAK8sBBGSCfEgHRDNDNASCU9MMBAKCEFHKXEKAK8sBEGSCfBgCRTARCfBgvHRDNASCU9MMBAKCDFHKXEKAK8sBDGSCfBgCpTARvHRDNASCU9MMBAKCIFHKXEKAK8sBIGSCfBgCxTARvHRDNASCU9MMBAKCLFHKXEKAKrBLC3TARvHRAKCVFHKKARCE4CBARCEg9r7AMFHMKDNDNADCD9HMBABAh87EBABCLFAM87EBABCDFAZ87EBXEKAIAhbDBAICWFAMbDBAICLFAZbDBKAVC/ABFAOCITFGRAMbDBARAZbDLAVALCDTFAMbDBAVC/ABFAOCEFCSgGOCITFGRAhbDBARAMbDLALCEFHLAOCEFHOXEKDNARCPE0MBAVALAQARCSgFrBBGSCL4GZ9rCSgCDTFYDBAdCEFGhAZeHRAVALAS9rCSgCDTFYDBAhAZtGoFGhASCSgGZeHSAZtHZDNDNADCD9HMBABAd87EBABCLFAS87EBABCDFAR87EBXEKAIAdbDBAICWFASbDBAICLFARbDBKAVALCDTFAdbDBAVC/ABFAOCITFGaARbDBAaAdbDLAVALCEFGLCSgCDTFARbDBAVC/ABFAOCEFCSgCITFGaASbDBAaARbDLAVALAoFCSgGLCDTFASbDBAVC/ABFAOCDFCSgGOCITFGRAdbDBARASbDLAOCEFHOALAZFHLAhAZFHdXEKAdCBAKrBBGaeGZARC/+EsGcFHRAaCSgHhDNDNAaCL4GoMBARCEFHSXEKARHSAVALAo9rCSgCDTFYDBHRKDNDNAhMBASCEFHdXEKASHdAVALAa9rCSgCDTFYDBHSKDNDNActMBAKCEFHaXEKAK8sBEGaCfEgHZDNDNAaCU9MMBAKCDFHaXEKAK8sBDGaCfBgCRTAZCfBgvHZDNAaCU9MMBAKCIFHaXEKAK8sBIGaCfBgCpTAZvHZDNAaCU9MMBAKCLFHaXEKAK8sBLGaCfBgCxTAZvHZDNAaCU9MMBAKCVFHaXEKAKCOFHaAKrBVC3TAZvHZKAZCE4CBAZCEg9r7AMFGMHZKDNDNAoCSsMBAaHcXEKAa8sBBGKCfEgHRDNDNAKCU9MMBAaCEFHcXEKAa8sBEGKCfBgCRTARCfBgvHRDNAKCU9MMBAaCDFHcXEKAa8sBDGKCfBgCpTARvHRDNAKCU9MMBAaCIFHcXEKAa8sBIGKCfBgCxTARvHRDNAKCU9MMBAaCLFHcXEKAaCVFHcAarBLC3TARvHRKARCE4CBARCEg9r7AMFGMHRKDNDNAhCSsMBAcHKXEKAc8sBBGKCfEgHSDNDNAKCU9MMBAcCEFHKXEKAc8sBEGKCfBgCRTASCfBgvHSDNAKCU9MMBAcCDFHKXEKAc8sBDGKCfBgCpTASvHSDNAKCU9MMBAcCIFHKXEKAc8sBIGKCfBgCxTASvHSDNAKCU9MMBAcCLFHKXEKAcCVFHKAcrBLC3TASvHSKASCE4CBASCEg9r7AMFGMHSKDNDNADCD9HMBABAZ87EBABCLFAS87EBABCDFAR87EBXEKAIAZbDBAICWFASbDBAICLFARbDBKAVC/ABFAOCITFGaARbDBAaAZbDLAVALCDTFAZbDBAVC/ABFAOCEFCSgCITFGaASbDBAaARbDLAVALCEFGLCSgCDTFARbDBAVC/ABFAOCDFCSgCITFGRAZbDBARASbDLAVALAotAoCSsvFGLCSgCDTFASbDBALAhtAhCSsvFHLAOCIFHOKAWCEFHWABCOFHBAICXFHIAOCSgHOALCSgHLApCIFGpAE6MBKKCBC99AKAQseHOKAVC/AEF8kJJJJBAOK/tLEDU8jJJJJBCZ9rHVC9+HODNAECVFAL0MBCUHOAIrBBC/+EgC/QE9HMBAV9CB83IWAICEFHOAIALFC98FHIDNAEtMBDNADCDsMBINDNAOAI6MBC9+SKAO8sBBGDCfEgHLDNDNADCU9MMBAOCEFHOXEKAO8sBEGDCfBgCRTALCfBgvHLDNADCU9MMBAOCDFHOXEKAO8sBDGDCfBgCpTALvHLDNADCU9MMBAOCIFHOXEKAO8sBIGDCfBgCxTALvHLDNADCU9MMBAOCLFHOXEKAOrBLC3TALvHLAOCVFHOKAVCWFALCEgCDTvGDALCD4CBALCE4CEg9r7ADYDBFGLbDBABALbDBABCLFHBAECUFGEMBXDKKINDNAOAI6MBC9+SKAO8sBBGDCfEgHLDNDNADCU9MMBAOCEFHOXEKAO8sBEGDCfBgCRTALCfBgvHLDNADCU9MMBAOCDFHOXEKAO8sBDGDCfBgCpTALvHLDNADCU9MMBAOCIFHOXEKAO8sBIGDCfBgCxTALvHLDNADCU9MMBAOCLFHOXEKAOrBLC3TALvHLAOCVFHOKABALCD4CBALCE4CEg9r7AVCWFALCEgCDTvGLYDBFGD87EBALADbDBABCDFHBAECUFGEMBKKCBC99AOAIseHOKAOK+lVOEUE99DUD99EUD99DNDNADCL9HMBAEtMEINDNDNjBBBzjBBB+/ABCDFGD8sBB+yAB8sBBGI+yGL+L+TABCEFGV8sBBGO+yGR+L+TGWjBBBB9gGdeAWjBB/+9CAWAWnjBBBBAWAdeGQAQ+MGKAICU9KeALmGLALnAQAKAOCU9KeARmGQAQnmm+R+VGRnmGW+LjBBB9P9dtMBAW+oHIXEKCJJJJ94HIKADAI86BBDNDNjBBBzjBBB+/AQjBBBB9geAQARnmGW+LjBBB9P9dtMBAW+oHDXEKCJJJJ94HDKAVAD86BBDNDNjBBBzjBBB+/ALjBBBB9geALARnmGW+LjBBB9P9dtMBAW+oHDXEKCJJJJ94HDKABAD86BBABCLFHBAECUFGEMBXDKKAEtMBINDNDNjBBBzjBBB+/ABCLFGD8uEB+yAB8uEBGI+yGL+L+TABCDFGV8uEBGO+yGR+L+TGWjBBBB9gGdeAWjB/+fsAWAWnjBBBBAWAdeGQAQ+MGKAICU9KeALmGLALnAQAKAOCU9KeARmGQAQnmm+R+VGRnmGW+LjBBB9P9dtMBAW+oHIXEKCJJJJ94HIKADAI87EBDNDNjBBBzjBBB+/AQjBBBB9geAQARnmGW+LjBBB9P9dtMBAW+oHDXEKCJJJJ94HDKAVAD87EBDNDNjBBBzjBBB+/ALjBBBB9geALARnmGW+LjBBB9P9dtMBAW+oHDXEKCJJJJ94HDKABAD87EBABCWFHBAECUFGEMBKKK/SILIUI99IUE99DNAEtMBCBHIABHLINDNDNj/zL81zALCOF8uEBGVCIv+y+VGOAL8uEB+ynGRjB/+fsnjBBBzjBBB+/ARjBBBB9gemGW+LjBBB9P9dtMBAW+oHdXEKCJJJJ94HdKALCLF8uEBHQALCDF8uEBHKABAVCEFCIgAIvCETFAd87EBDNDNAOAK+ynGWjB/+fsnjBBBzjBBB+/AWjBBBB9gemGX+LjBBB9P9dtMBAX+oHKXEKCJJJJ94HKKABAVCDFCIgAIvCETFAK87EBDNDNAOAQ+ynGOjB/+fsnjBBBzjBBB+/AOjBBBB9gemGX+LjBBB9P9dtMBAX+oHQXEKCJJJJ94HQKABAVCUFCIgAIvCETFAQ87EBDNDNjBBJzARARn+TAWAWn+TAOAOn+TGRjBBBBARjBBBB9ge+RjB/+fsnjBBBzmGR+LjBBB9P9dtMBAR+oHQXEKCJJJJ94HQKABAVCIgAIvCETFAQ87EBALCWFHLAICLFHIAECUFGEMBKKK6BDNADCD4AE2GEtMBINABABYDBGDCWTCW91+yADCk91ClTCJJJ/8IF++nuDBABCLFHBAECUFGEMBKKK9TEIUCBCBYDJ1JJBGEABCIFC98gFGBbDJ1JJBDNDNABzBCZTGD9NMBCUHIABAD9rCffIFCZ4NBCUsMEKAEHIKAIK/lEEEUDNDNAEABvCIgtMBABHIXEKDNDNADCZ9PMBABHIXEKABHIINAIAEYDBbDBAICLFAECLFYDBbDBAICWFAECWFYDBbDBAICXFAECXFYDBbDBAICZFHIAECZFHEADC9wFGDCS0MBKKADCL6MBINAIAEYDBbDBAECLFHEAICLFHIADC98FGDCI0MBKKDNADtMBINAIAErBB86BBAICEFHIAECEFHEADCUFGDMBKKABK/AEEDUDNDNABCIgtMBABHIXEKAECfEgC+B+C+EW2HLDNDNADCZ9PMBABHIXEKABHIINAIALbDBAICXFALbDBAICWFALbDBAICLFALbDBAICZFHIADC9wFGDCS0MBKKADCL6MBINAIALbDBAICLFHIADC98FGDCI0MBKKDNADtMBINAIAE86BBAICEFHIADCUFGDMBKKABKKKEBCJWKLZ9kBB",t="B9h79tEBBBE5V9gBB9gVUUUUUEU9gIUUUB9gDUUB9gEUEUIMXBBEBEEDIDIDLLVE9wEEEVIEBEOWEUEC+Q/aEKR/LEdO9tw9t9vv95DBh9f9f939h79t9f9j9h229f9jT9vv7BB8a9tw79o9v9wT9f9kw9j9v9kw9WwvTw949C919m9mwvBDy9tw79o9v9wT9f9kw9j9v9kw69u9kw949C919m9mwvBLe9tw79o9v9wT9f9kw9j9v9kw69u9kw949Twg91w9u9jwBVl9tw79o9v9wT9f9kw9j9v9kws9p2Twv9P9jTBOk9tw79o9v9wT9f9kw9j9v9kws9p2Twv9R919hTBWl9tw79o9v9wT9f9kw9j9v9kws9p2Twvt949wBQL79iv9rBKQ/j6XLBZIK9+EVU8jJJJJBCZ9rHBCBHEINCBHDCBHIINABCWFADFAICJUAEAD4CEgGLe86BBAIALFHIADCEFGDCW9HMBKAEC+Q+YJJBFAI86BBAECITC+Q1JJBFAB8pIW83IBAECEFGECJD9HMBKK1HLSUD97EUO978jJJJJBCJ/KB9rGV8kJJJJBC9+HODNADCEFAL0MBCUHOAIrBBC+gE9HMBAVAIALFGRAD9rAD/8QBBCJ/ABAD9uC/wfBgGOCJDAOCJD6eHWAICEFHOCBHdDNINAdAE9PMEAWAEAd9rAdAWFAE6eHQDNDNADtMBAQCSFGLC9wgGKCI2HXAKCETHMALCL4CIFCD4HpCBHSINAOHZCBHhDNINDNARAZ9rAp9PMBCBHOXVKAVCJ/CBFAhAK2FHoAZApFHOCBHIDNAKC/AB6MBARAO9rC/gB6MBCBHLINAoALFHIDNDNDNDNDNAZALCO4FrBBGaCIgpLBEDIBKAICBPhPKLBXIKAIAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLBAOCLFAlPqBFAqC+Q+YJJBFrBBFHOXDKAIAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLBAOCWFAlPqBFAqC+Q+YJJBFrBBFHOXEKAIAOPBBBPKLBAOCZFHOKDNDNDNDNDNAaCD4CIgpLBEDIBKAICBPhPKLZXIKAIAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLZAOCLFAlPqBFAqC+Q+YJJBFrBBFHOXDKAIAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLZAOCWFAlPqBFAqC+Q+YJJBFrBBFHOXEKAIAOPBBBPKLZAOCZFHOKDNDNDNDNDNAaCL4CIgpLBEDIBKAICBPhPKLAXIKAIAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLAAOCLFAlPqBFAqC+Q+YJJBFrBBFHOXDKAIAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLAAOCWFAlPqBFAqC+Q+YJJBFrBBFHOXEKAIAOPBBBPKLAAOCZFHOKDNDNDNDNDNAaCO4pLBEDIBKAICBPhPKL8wXIKAIAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGaCITC+Q1JJBFPBIBAaC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGaCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKL8wAOCLFAlPqBFAaC+Q+YJJBFrBBFHOXDKAIAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGaCITC+Q1JJBFPBIBAaC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGaCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKL8wAOCWFAlPqBFAaC+Q+YJJBFrBBFHOXEKAIAOPBBBPKL8wAOCZFHOKALC/ABFHIALCJEFAK0MEAIHLARAO9rC/fB0MBKKDNAIAK9PMBAICI4HLINDNARAO9rCk9PMBCBHOXRKAoAIFHaDNDNDNDNDNAZAICO4FrBBALCOg4CIgpLBEDIBKAaCBPhPKLBXIKAaAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLBAOCLFAlPqBFAqC+Q+YJJBFrBBFHOXDKAaAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLBAOCWFAlPqBFAqC+Q+YJJBFrBBFHOXEKAaAOPBBBPKLBAOCZFHOKALCDFHLAICZFGIAK6MBKKDNAOtMBAOHZAhCEFGhCLsMDXEKKCBHOXIKDNAKtMBAVCJDFASFHIAVASFPBDBHlCBHaINAIAVCJ/CBFAaFGLPBLBGxCEP9tAxCEPSGcP9OP9hP9RGxALAKFPBLBGkCEP9tAkAcP9OP9hP9RGkPMBZEhDoIaLcVxOqRlGyALAMFPBLBG8aCEP9tA8aAcP9OP9hP9RG8aALAXFPBLBGeCEP9tAeAcP9OP9hP9RGePMBZEhDoIaLcVxOqRlG3PMBEZhDIoaLVcxORqlGcAcPMBEDIBEDIBEDIBEDIAlP9uGlPeBbDBAIADFGLAlAcAcPMLVORLVORLVORLVORP9uGlPeBbDBALADFGLAlAcAcPMWdQKWdQKWdQKWdQKP9uGlPeBbDBALADFGLAlAcAcPMXMpSXMpSXMpSXMpSP9uGlPeBbDBALADFGLAlAyA3PMWdkyQK8aeXM35pS8e8fGcAcPMBEDIBEDIBEDIBEDIP9uGlPeBbDBALADFGLAlAcAcPMLVORLVORLVORLVORP9uGlPeBbDBALADFGLAlAcAcPMWdQKWdQKWdQKWdQKP9uGlPeBbDBALADFGLAlAcAcPMXMpSXMpSXMpSXMpSP9uGlPeBbDBALADFGLAlAxAkPMWkdyQ8aKeX3M5p8eS8fGxA8aAePMWkdyQ8aKeX3M5p8eS8fGkPMBEZhDIoaLVcxORqlGcAcPMBEDIBEDIBEDIBEDIP9uGlPeBbDBALADFGLAlAcAcPMLVORLVORLVORLVORP9uGlPeBbDBALADFGLAlAcAcPMWdQKWdQKWdQKWdQKP9uGlPeBbDBALADFGLAlAcAcPMXMpSXMpSXMpSXMpSP9uGlPeBbDBALADFGLAlAxAkPMWdkyQK8aeXM35pS8e8fGcAcPMBEDIBEDIBEDIBEDIP9uGlPeBbDBALADFGLAlAcAcPMLVORLVORLVORLVORP9uGlPeBbDBALADFGLAlAcAcPMWdQKWdQKWdQKWdQKP9uGlPeBbDBALADFGLAlAcAcPMXMpSXMpSXMpSXMpSP9uGlPeBbDBALADFHIAaCZFGaAK6MBKKASCLFGSAD6MBKKABAdAD2FAVCJDFAQAD2/8QBBAVAVCJDFAQCUFAD2FAD/8QBBKAQCBAOeAdFHdAOMBKC9+HOXEKCBC99ARAO9rADCAADCA0eseHOKAVCJ/KBF8kJJJJBAOKWBZ+BJJJBK+KoEZU8jJJJJBC/AE9rGV8kJJJJBC9+HODNAECI9uGRChFAL0MBCUHOAIrBBGWC/wEgC/gE9HMBAWCSgGdCE0MBAVC/ABFCfECJE/8KBAVCuF9CU83IBAVC8wF9CU83IBAVCYF9CU83IBAVCAF9CU83IBAVCkF9CU83IBAVCZF9CU83IBAV9CU83IWAV9CU83IBAIALFC9wFHQAICEFGWARFHKDNAEtMBCMCSAdCEseHXABHICBHdCBHMCBHpCBHLCBHOINDNAKAQ9NMBC9+HOXIKDNDNAWrBBGRC/vE0MBAVC/ABFARCL4CU7AOFCSgCITFGSYDLHZASYDBHhDNARCSgGSAX9PMBAVARCU7ALFCSgCDTFYDBAdASeHRAStHSDNDNADCD9HMBABAh87EBABCLFAR87EBABCDFAZ87EBXEKAIAhbDBAICWFARbDBAICLFAZbDBKAdASFHdAVC/ABFAOCITFGoARbDBAoAZbDLAVALCDTFARbDBAVC/ABFAOCEFCSgGOCITFGZAhbDBAZARbDLALASFHLAOCEFHOXDKDNDNASCSsMBAMASFASC987FCEFHMXEKAK8sBBGSCfEgHRDNDNASCU9MMBAKCEFHKXEKAK8sBEGSCfBgCRTARCfBgvHRDNASCU9MMBAKCDFHKXEKAK8sBDGSCfBgCpTARvHRDNASCU9MMBAKCIFHKXEKAK8sBIGSCfBgCxTARvHRDNASCU9MMBAKCLFHKXEKAKrBLC3TARvHRAKCVFHKKARCE4CBARCEg9r7AMFHMKDNDNADCD9HMBABAh87EBABCLFAM87EBABCDFAZ87EBXEKAIAhbDBAICWFAMbDBAICLFAZbDBKAVC/ABFAOCITFGRAMbDBARAZbDLAVALCDTFAMbDBAVC/ABFAOCEFCSgGOCITFGRAhbDBARAMbDLALCEFHLAOCEFHOXEKDNARCPE0MBAVALAQARCSgFrBBGSCL4GZ9rCSgCDTFYDBAdCEFGhAZeHRAVALAS9rCSgCDTFYDBAhAZtGoFGhASCSgGZeHSAZtHZDNDNADCD9HMBABAd87EBABCLFAS87EBABCDFAR87EBXEKAIAdbDBAICWFASbDBAICLFARbDBKAVALCDTFAdbDBAVC/ABFAOCITFGaARbDBAaAdbDLAVALCEFGLCSgCDTFARbDBAVC/ABFAOCEFCSgCITFGaASbDBAaARbDLAVALAoFCSgGLCDTFASbDBAVC/ABFAOCDFCSgGOCITFGRAdbDBARASbDLAOCEFHOALAZFHLAhAZFHdXEKAdCBAKrBBGaeGZARC/+EsGcFHRAaCSgHhDNDNAaCL4GoMBARCEFHSXEKARHSAVALAo9rCSgCDTFYDBHRKDNDNAhMBASCEFHdXEKASHdAVALAa9rCSgCDTFYDBHSKDNDNActMBAKCEFHaXEKAK8sBEGaCfEgHZDNDNAaCU9MMBAKCDFHaXEKAK8sBDGaCfBgCRTAZCfBgvHZDNAaCU9MMBAKCIFHaXEKAK8sBIGaCfBgCpTAZvHZDNAaCU9MMBAKCLFHaXEKAK8sBLGaCfBgCxTAZvHZDNAaCU9MMBAKCVFHaXEKAKCOFHaAKrBVC3TAZvHZKAZCE4CBAZCEg9r7AMFGMHZKDNDNAoCSsMBAaHcXEKAa8sBBGKCfEgHRDNDNAKCU9MMBAaCEFHcXEKAa8sBEGKCfBgCRTARCfBgvHRDNAKCU9MMBAaCDFHcXEKAa8sBDGKCfBgCpTARvHRDNAKCU9MMBAaCIFHcXEKAa8sBIGKCfBgCxTARvHRDNAKCU9MMBAaCLFHcXEKAaCVFHcAarBLC3TARvHRKARCE4CBARCEg9r7AMFGMHRKDNDNAhCSsMBAcHKXEKAc8sBBGKCfEgHSDNDNAKCU9MMBAcCEFHKXEKAc8sBEGKCfBgCRTASCfBgvHSDNAKCU9MMBAcCDFHKXEKAc8sBDGKCfBgCpTASvHSDNAKCU9MMBAcCIFHKXEKAc8sBIGKCfBgCxTASvHSDNAKCU9MMBAcCLFHKXEKAcCVFHKAcrBLC3TASvHSKASCE4CBASCEg9r7AMFGMHSKDNDNADCD9HMBABAZ87EBABCLFAS87EBABCDFAR87EBXEKAIAZbDBAICWFASbDBAICLFARbDBKAVC/ABFAOCITFGaARbDBAaAZbDLAVALCDTFAZbDBAVC/ABFAOCEFCSgCITFGaASbDBAaARbDLAVALCEFGLCSgCDTFARbDBAVC/ABFAOCDFCSgCITFGRAZbDBARASbDLAVALAotAoCSsvFGLCSgCDTFASbDBALAhtAhCSsvFHLAOCIFHOKAWCEFHWABCOFHBAICXFHIAOCSgHOALCSgHLApCIFGpAE6MBKKCBC99AKAQseHOKAVC/AEF8kJJJJBAOK/tLEDU8jJJJJBCZ9rHVC9+HODNAECVFAL0MBCUHOAIrBBC/+EgC/QE9HMBAV9CB83IWAICEFHOAIALFC98FHIDNAEtMBDNADCDsMBINDNAOAI6MBC9+SKAO8sBBGDCfEgHLDNDNADCU9MMBAOCEFHOXEKAO8sBEGDCfBgCRTALCfBgvHLDNADCU9MMBAOCDFHOXEKAO8sBDGDCfBgCpTALvHLDNADCU9MMBAOCIFHOXEKAO8sBIGDCfBgCxTALvHLDNADCU9MMBAOCLFHOXEKAOrBLC3TALvHLAOCVFHOKAVCWFALCEgCDTvGDALCD4CBALCE4CEg9r7ADYDBFGLbDBABALbDBABCLFHBAECUFGEMBXDKKINDNAOAI6MBC9+SKAO8sBBGDCfEgHLDNDNADCU9MMBAOCEFHOXEKAO8sBEGDCfBgCRTALCfBgvHLDNADCU9MMBAOCDFHOXEKAO8sBDGDCfBgCpTALvHLDNADCU9MMBAOCIFHOXEKAO8sBIGDCfBgCxTALvHLDNADCU9MMBAOCLFHOXEKAOrBLC3TALvHLAOCVFHOKABALCD4CBALCE4CEg9r7AVCWFALCEgCDTvGLYDBFGD87EBALADbDBABCDFHBAECUFGEMBKKCBC99AOAIseHOKAOK/xVDIUO978jJJJJBCA9rGI8kJJJJBDNDNADCL9HMBDNAEC98gGLtMBABHDCBHVINADADPBBBGOCkP+rECkP+sEP/6EGRAOCWP+rECkP+sEP/6EARP/gEAOCZP+rECkP+sEP/6EGWP/gEP/kEP/lEGdCBPhP+2EGQARCJJJJ94PhGKP9OP9RP/kEGRjBB/+9CPaARARP/mEAdAdP/mEAWAQAWAKP9OP9RP/kEGRARP/mEP/kEP/kEP/jEP/nEGWP/mEjBBN0PaGQP/kECfEPhP9OAOCJJJ94PhP9OP9QARAWP/mEAQP/kECWP+rECJ/+IPhP9OP9QAdAWP/mEAQP/kECZP+rECJJ/8RPhP9OP9QPKBBADCZFHDAVCLFGVAL6MBKKALAE9PMEAIAECIgGVCDTGDvCBCZAD9r/8KBAIABALCDTFGLAD/8QBBDNAVtMBAIAIPBLBGOCkP+rECkP+sEP/6EGRAOCWP+rECkP+sEP/6EARP/gEAOCZP+rECkP+sEP/6EGWP/gEP/kEP/lEGdCBPhP+2EGQARCJJJJ94PhGKP9OP9RP/kEGRjBB/+9CPaARARP/mEAdAdP/mEAWAQAWAKP9OP9RP/kEGRARP/mEP/kEP/kEP/jEP/nEGWP/mEjBBN0PaGQP/kECfEPhP9OAOCJJJ94PhP9OP9QARAWP/mEAQP/kECWP+rECJ/+IPhP9OP9QAdAWP/mEAQP/kECZP+rECJJ/8RPhP9OP9QPKLBKALAIAD/8QBBXEKABAEC98gGDZ+HJJJBADAE9PMBAIAECIgGLCITGVFCBCAAV9r/8KBAIABADCITFGDAV/8QBBAIALZ+HJJJBADAIAV/8QBBKAICAF8kJJJJBK+yIDDUR97DNAEtMBCBHDINABCZFGIAIPBBBGLCBPhGVCJJ98P3ECJJ98P3IGOP9OABPBBBGRALPMLVORXMpScxql358e8fCffEPhP9OP/6EARALPMBEDIWdQKZhoaky8aeGLCZP+sEP/6EGWP/gEALCZP+rECZP+sEP/6EGdP/gEP/kEP/lEGLjB/+fsPaAdALAVP+2EGVAdCJJJJ94PhGQP9OP9RP/kEGdAdP/mEALALP/mEAWAVAWAQP9OP9RP/kEGLALP/mEP/kEP/kEP/jEP/nEGWP/mEjBBN0PaGVP/kECZP+rEAdAWP/mEAVP/kECffIPhP9OP9QGdALAWP/mEAVP/kECUPSCBPlDCBPlICBPlOCBPlRCBPlQCBPlKCBPlpCBPlSP9OGLPMWdkyQK8aeXM35pS8e8fP9QPKBBABARAOP9OAdALPMBEZhDIoaLVcxORqlP9QPKBBABCAFHBADCLFGDAE6MBKKK94EIU8jJJJJBCA9rGI8kJJJJBABAEC98gGLZ+JJJJBDNALAE9PMBAIAECIgGVCITGEFCBCAAE9r/8KBAIABALCITFGBAE/8QBBAIAVZ+JJJJBABAIAE/8QBBKAICAF8kJJJJBK/hILDUE97EUV978jJJJJBCZ9rHDDNAEtMBCBHIINADABPBBBGLABCZFGVPBBBGOPMLVORXMpScxql358e8fGRCZP+sEGWCLP+rEPKLBABjBBJzPaj/zL81zPaAWCIPhP9QP/6EP/nEGWALAOPMBEDIWdQKZhoaky8aeGLCZP+rECZP+sEP/6EP/mEGOAOP/mEAWALCZP+sEP/6EP/mEGdAdP/mEAWARCZP+rECZP+sEP/6EP/mEGRARP/mEP/kEP/kEP/lECBPhP+4EP/jEjB/+fsPaGWP/mEjBBN0PaGLP/kECffIPhGQP9OAdAWP/mEALP/kECZP+rEP9QGdARAWP/mEALP/kECZP+rEAOAWP/mEALP/kEAQP9OP9QGWPMBEZhDIoaLVcxORqlGLP5BADPBLBPeB+t+J83IBABCWFALP5EADPBLBPeE+t+J83IBAVAdAWPMWdkyQK8aeXM35pS8e8fGWP5BADPBLBPeD+t+J83IBABCkFAWP5EADPBLBPeI+t+J83IBABCAFHBAICLFGIAE6MBKKK/3EDIUE978jJJJJBC/AB9rHIDNADCD4AE2GLC98gGVtMBCBHDABHEINAEAEPBBBGOCWP+rECWP+sEP/6EAOCkP+sEClP+rECJJJ/8IPhP+uEP/mEPKBBAECZFHEADCLFGDAV6MBKKDNAVAL9PMBAIALCIgGDCDTGEvCBC/ABAE9r/8KBAIABAVCDTFGVAE/8QBBDNADtMBAIAIPBLBGOCWP+rECWP+sEP/6EAOCkP+sEClP+rECJJJ/8IPhP+uEP/mEPKLBKAVAIAE/8QBBKK9TEIUCBCBYDJ1JJBGEABCIFC98gFGBbDJ1JJBDNDNABzBCZTGD9NMBCUHIABAD9rCffIFCZ4NBCUsMEKAEHIKAIKKKEBCJWKLZ9tBB",n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!==typeof WebAssembly)return{supported:!1};var o,r=e;WebAssembly.validate(n)&&(r=t);var s=WebAssembly.instantiate(a(r),{}).then((function(e){o=e.instance,o.exports.__wasm_call_ctors()}));function a(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;++n){var o=e.charCodeAt(n);t[n]=o>96?o-71:o>64?o-65:o>47?o+4:o>46?63:62}var r=0;for(n=0;n<e.length;++n)t[r++]=t[n]<60?i[t[n]]:64*(t[n]-60)+t[++n];return t.buffer.slice(0,r)}function c(e,t,n,i,r,s){var a=o.exports.sbrk,c=n+3&-4,l=a(c*i),u=a(r.length),h=new Uint8Array(o.exports.memory.buffer);h.set(r,u);var d=e(l,n,i,u,r.length);if(0==d&&s&&s(l,c,i),t.set(h.subarray(l,l+n*i)),a(l-a(0)),0!=d)throw new Error("Malformed buffer data: "+d)}var l={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:s,supported:!0,decodeVertexBuffer:function(e,t,n,i,r){c(o.exports.meshopt_decodeVertexBuffer,e,t,n,i,o.exports[l[r]])},decodeIndexBuffer:function(e,t,n,i){c(o.exports.meshopt_decodeIndexBuffer,e,t,n,i)},decodeIndexSequence:function(e,t,n,i){c(o.exports.meshopt_decodeIndexSequence,e,t,n,i)},decodeGltfBuffer:function(e,t,n,i,r,s){c(o.exports[u[r]],e,t,n,i,o.exports[l[s]])}}}();function Y9(e){e=R(e,R.EMPTY_OBJECT);const t=e.resourceCache,n=e.gltf,i=e.bufferViewId,o=e.gltfResource,r=e.baseResource,s=e.cacheKey;D.typeOf.func("options.resourceCache",t),D.typeOf.object("options.gltf",n),D.typeOf.number("options.bufferViewId",i),D.typeOf.object("options.gltfResource",o),D.typeOf.object("options.baseResource",r);const a=n.bufferViews[i];let c,l,u,h,d=a.buffer,f=a.byteOffset,p=a.byteLength,m=!1;if(z8(a,"EXT_meshopt_compression")){const e=a.extensions.EXT_meshopt_compression;d=e.buffer,f=R(e.byteOffset,0),p=e.byteLength,m=!0,c=e.byteStride,l=e.count,u=e.mode,h=R(e.filter,"NONE")}const _=n.buffers[d];this._hasMeshopt=m,this._meshoptByteStride=c,this._meshoptCount=l,this._meshoptMode=u,this._meshoptFilter=h,this._resourceCache=t,this._gltfResource=o,this._baseResource=r,this._buffer=_,this._bufferId=d,this._byteOffset=f,this._byteLength=p,this._cacheKey=s,this._bufferLoader=void 0,this._typedArray=void 0,this._state=G9.UNLOADED,this._promise=yn()}function K9(e){const t=e._resourceCache,n=e._buffer;if(C(n.uri)){const i=e._baseResource,o=i.getDerivedResource({url:n.uri});return t.loadExternalBuffer({resource:o})}return t.loadEmbeddedBuffer({parentResource:e._gltfResource,bufferId:e._bufferId})}function X9(e){e=R(e,R.EMPTY_OBJECT);const t=e.resourceCache,n=e.gltf,i=e.draco,o=e.gltfResource,r=e.baseResource,s=e.cacheKey;D.typeOf.func("options.resourceCache",t),D.typeOf.object("options.gltf",n),D.typeOf.object("options.draco",i),D.typeOf.object("options.gltfResource",o),D.typeOf.object("options.baseResource",r),this._resourceCache=t,this._gltfResource=o,this._baseResource=r,this._gltf=n,this._draco=i,this._cacheKey=s,this._bufferViewLoader=void 0,this._bufferViewTypedArray=void 0,this._decodePromise=void 0,this._decodedData=void 0,this._state=G9.UNLOADED,this._promise=yn()}function Q9(e,t){e.unload(),e._state=G9.FAILED;const n="Failed to load Draco";e._promise.reject(e.getError(n,t))}function J9(e){e=R(e,R.EMPTY_OBJECT);const t=e.resourceCache,n=e.gltf,i=e.imageId,o=e.gltfResource,r=e.baseResource,s=e.cacheKey;D.typeOf.func("options.resourceCache",t),D.typeOf.object("options.gltf",n),D.typeOf.number("options.imageId",i),D.typeOf.object("options.gltfResource",o),D.typeOf.object("options.baseResource",r);const a=n.images[i],c=a.bufferView,l=a.uri;this._resourceCache=t,this._gltfResource=o,this._baseResource=r,this._gltf=n,this._bufferViewId=c,this._uri=l,this._cacheKey=s,this._bufferViewLoader=void 0,this._image=void 0,this._mipLevels=void 0,this._state=G9.UNLOADED,this._promise=yn()}function Z9(e){let t;return Array.isArray(e)&&(t=e.slice(1,e.length).map((function(e){return e.bufferView})),e=e[0]),{image:e,mipLevels:t}}function $9(e){const t=e._resourceCache,n=t.loadBufferView({gltf:e._gltf,bufferViewId:e._bufferViewId,gltfResource:e._gltfResource,baseResource:e._baseResource});e._bufferViewLoader=n,e._state=G9.LOADING,n.promise.then((function(){if(e.isDestroyed())return;const t=n.typedArray;return i7(t).then((function(t){if(e.isDestroyed())return;const n=Z9(t);e.unload(),e._image=n.image,e._mipLevels=n.mipLevels,e._state=G9.READY,e._promise.resolve(e)}))})).catch((function(t){e.isDestroyed()||t7(e,t,"Failed to load embedded image")}))}function e7(e){const t=e._baseResource,n=e._uri,i=t.getDerivedResource({url:n});e._state=G9.LOADING,r7(i).then((function(t){if(e.isDestroyed())return;const n=Z9(t);e.unload(),e._image=n.image,e._mipLevels=n.mipLevels,e._state=G9.READY,e._promise.resolve(e)})).catch((function(t){e.isDestroyed()||t7(e,t,`Failed to load image: ${n}`)}))}function t7(e,t,n){e.unload(),e._state=G9.FAILED,e._promise.reject(e.getError(n,t))}function n7(e){const t=e.subarray(0,2),n=e.subarray(0,4),i=e.subarray(8,12);if(255===t[0]&&216===t[1])return"image/jpeg";if(137===t[0]&&80===t[1])return"image/png";if(171===t[0]&&75===t[1])return"image/ktx2";if(82===n[0]&&73===n[1]&&70===n[2]&&70===n[3]&&87===i[0]&&69===i[1]&&66===i[2]&&80===i[3])return"image/webp";throw new Je("Image format is not recognized")}function i7(e){const t=n7(e);if("image/ktx2"===t){const t=new Uint8Array(e);return XF(t)}return J9._loadImageFromTypedArray({uint8Array:e,format:t,flipY:!1,skipColorSpaceConversion:!0})}C(Object.create)&&(Y9.prototype=Object.create(V9.prototype),Y9.prototype.constructor=Y9),Object.defineProperties(Y9.prototype,{promise:{get:function(){return this._promise.promise}},cacheKey:{get:function(){return this._cacheKey}},typedArray:{get:function(){return this._typedArray}}}),Y9.prototype.load=function(){const e=K9(this);this._bufferLoader=e,this._state=G9.LOADING;const t=this;e.promise.then((function(){if(t.isDestroyed())return;const n=e.typedArray,i=new Uint8Array(n.buffer,n.byteOffset+t._byteOffset,t._byteLength);t.unload(),t._typedArray=i,t._hasMeshopt?t._state=G9.PROCESSING:(t._state=G9.READY,t._promise.resolve(t))})).catch((function(e){if(t.isDestroyed())return;t.unload(),t._state=G9.FAILED;const n="Failed to load buffer view";t._promise.reject(t.getError(n,e))}))},Y9.prototype.process=function(e){if(D.typeOf.object("frameState",e),!this._hasMeshopt)return;if(!C(this._typedArray))return;if(this._state!==G9.PROCESSING)return;const t=this._meshoptCount,n=this._meshoptByteStride,i=new Uint8Array(t*n);j9.decodeGltfBuffer(i,t,n,this._typedArray,this._meshoptMode,this._meshoptFilter),this._typedArray=i,this._state=G9.READY,this._promise.resolve(this)},Y9.prototype.unload=function(){C(this._bufferLoader)&&this._resourceCache.unload(this._bufferLoader),this._bufferLoader=void 0,this._typedArray=void 0},C(Object.create)&&(X9.prototype=Object.create(V9.prototype),X9.prototype.constructor=X9),Object.defineProperties(X9.prototype,{promise:{get:function(){return this._promise.promise}},cacheKey:{get:function(){return this._cacheKey}},decodedData:{get:function(){return this._decodedData}}}),X9.prototype.load=function(){const e=this._resourceCache,t=e.loadBufferView({gltf:this._gltf,bufferViewId:this._draco.bufferView,gltfResource:this._gltfResource,baseResource:this._baseResource});this._bufferViewLoader=t,this._state=G9.LOADING;const n=this;t.promise.then((function(){n.isDestroyed()||(n._bufferViewTypedArray=t.typedArray,n._state=G9.PROCESSING)})).catch((function(e){n.isDestroyed()||Q9(n,e)}))},X9.prototype.process=function(e){if(D.typeOf.object("frameState",e),!C(this._bufferViewTypedArray))return;if(C(this._decodePromise))return;const t=this._draco,n=this._gltf,i=n.bufferViews,o=t.bufferView,r=i[o],s=t.attributes,a={array:new Uint8Array(this._bufferViewTypedArray),bufferView:r,compressedAttributes:s,dequantizeInShader:!0},c=C3.decodeBufferView(a);if(!C(c))return;const l=this;this._decodePromise=c.then((function(e){l.isDestroyed()||(l.unload(),l._decodedData={indices:e.indexArray,vertexAttributes:e.attributeData},l._state=G9.READY,l._promise.resolve(l))})).catch((function(e){l.isDestroyed()||Q9(l,e)}))},X9.prototype.unload=function(){C(this._bufferViewLoader)&&this._resourceCache.unload(this._bufferViewLoader),this._bufferViewLoader=void 0,this._bufferViewTypedArray=void 0,this._decodedData=void 0,this._gltf=void 0},C(Object.create)&&(J9.prototype=Object.create(V9.prototype),J9.prototype.constructor=J9),Object.defineProperties(J9.prototype,{promise:{get:function(){return this._promise.promise}},cacheKey:{get:function(){return this._cacheKey}},image:{get:function(){return this._image}},mipLevels:{get:function(){return this._mipLevels}}}),J9.prototype.load=function(){C(this._bufferViewId)?$9(this):e7(this)};const o7=/(^data:image\/ktx2)|(\.ktx2$)/i;function r7(e){const t=e.url;return o7.test(t)?XF(e):e.fetchImage({skipColorSpaceConversion:!0,preferImageBitmap:!0})}function s7(e){e=R(e,R.EMPTY_OBJECT);const t=e.resourceCache,n=e.gltf,i=e.accessorId,o=e.gltfResource,r=e.baseResource,s=e.draco,a=e.cacheKey,c=R(e.asynchronous,!0),l=R(e.loadAsTypedArray,!1);D.typeOf.func("options.resourceCache",t),D.typeOf.object("options.gltf",n),D.typeOf.number("options.accessorId",i),D.typeOf.object("options.gltfResource",o),D.typeOf.object("options.baseResource",r);const u=n.accessors[i].componentType;this._resourceCache=t,this._gltfResource=o,this._baseResource=r,this._gltf=n,this._accessorId=i,this._indexDatatype=u,this._draco=s,this._cacheKey=a,this._asynchronous=c,this._loadAsTypedArray=l,this._bufferViewLoader=void 0,this._dracoLoader=void 0,this._typedArray=void 0,this._buffer=void 0,this._state=G9.UNLOADED,this._promise=yn()}function a7(e){const t=e._resourceCache,n=t.loadDraco({gltf:e._gltf,draco:e._draco,gltfResource:e._gltfResource,baseResource:e._baseResource});e._dracoLoader=n,e._state=G9.LOADING,n.promise.then((function(){if(e.isDestroyed())return;const t=n.decodedData.indices.typedArray;e._typedArray=t,e._indexDatatype=ih.fromTypedArray(t),e._state=G9.PROCESSING})).catch((function(t){e.isDestroyed()||u7(e,t)}))}function c7(e){const t=e._gltf,n=e._accessorId,i=t.accessors[n],o=i.bufferView,r=e._resourceCache,s=r.loadBufferView({gltf:t,bufferViewId:o,gltfResource:e._gltfResource,baseResource:e._baseResource});e._state=G9.LOADING,e._bufferViewLoader=s,s.promise.then((function(){if(e.isDestroyed())return;const t=s.typedArray;e._typedArray=l7(e,t),e._state=G9.PROCESSING})).catch((function(t){e.isDestroyed()||u7(e,t)}))}function l7(e,t){const n=e._gltf,i=e._accessorId,o=n.accessors[i],r=o.count,s=o.componentType,a=t.buffer,c=t.byteOffset+o.byteOffset;let l;return s===fd.UNSIGNED_BYTE?l=new Uint8Array(a,c,r):s===fd.UNSIGNED_SHORT?l=new Uint16Array(a,c,r):s===fd.UNSIGNED_INT&&(l=new Uint32Array(a,c,r)),l}function u7(e,t){e.unload(),e._state=G9.FAILED;const n="Failed to load index buffer";t=e.getError(n,t),e._promise.reject(t)}function h7(){this.typedArray=void 0,this.indexDatatype=void 0,this.context=void 0,this.buffer=void 0}function d7(e,t,n){const i=hq.createIndexBuffer({typedArray:e,context:n,usage:lq.STATIC_DRAW,indexDatatype:t});return i.vertexArrayDestroyable=!1,i}J9.prototype.unload=function(){C(this._bufferViewLoader)&&this._resourceCache.unload(this._bufferViewLoader),this._bufferViewLoader=void 0,this._uri=void 0,this._image=void 0,this._mipLevels=void 0,this._gltf=void 0},J9._loadImageFromTypedArray=jF,C(Object.create)&&(s7.prototype=Object.create(V9.prototype),s7.prototype.constructor=s7),Object.defineProperties(s7.prototype,{promise:{get:function(){return this._promise.promise}},cacheKey:{get:function(){return this._cacheKey}},buffer:{get:function(){return this._buffer}},typedArray:{get:function(){return this._typedArray}},indexDatatype:{get:function(){return this._indexDatatype}}}),s7.prototype.load=function(){C(this._draco)?a7(this):c7(this)},h7.prototype.set=function(e,t,n){this.typedArray=e,this.indexDatatype=t,this.context=n},h7.prototype.execute=function(){this.buffer=d7(this.typedArray,this.indexDatatype,this.context)};const f7=new h7;function p7(e){return AZ.shader(e,(function(e){m7(e)})),AZ.buffer(e,(function(e){m7(e)})),AZ.image(e,(function(e){m7(e)})),m7(e),e}function m7(e){C(e.extras)&&(C(e.extras._pipeline)&&delete e.extras._pipeline,0===Object.keys(e.extras).length&&delete e.extras)}s7.prototype.process=function(e){if(D.typeOf.object("frameState",e),this._state===G9.READY)return;const t=this._typedArray,n=this._indexDatatype;if(C(this._dracoLoader)&&this._dracoLoader.process(e),C(this._bufferViewLoader)&&this._bufferViewLoader.process(e),!C(t))return;if(this._loadAsTypedArray)return this.unload(),this._typedArray=t,this._state=G9.READY,void this._promise.resolve(this);let i;if(this._asynchronous){const o=f7;o.set(t,n,e.context);const r=e.jobScheduler;if(!r.execute(o,B3.BUFFER))return;i=o.buffer}else i=d7(t,n,e.context);this.unload(),this._buffer=i,this._state=G9.READY,this._promise.resolve(this)},s7.prototype.unload=function(){C(this._buffer)&&this._buffer.destroy();const e=this._resourceCache;C(this._bufferViewLoader)&&e.unload(this._bufferViewLoader),C(this._dracoLoader)&&e.unload(this._dracoLoader),this._bufferViewLoader=void 0,this._dracoLoader=void 0,this._typedArray=void 0,this._buffer=void 0,this._gltf=void 0};var _7=p7;function g7(e){e=R(e,R.EMPTY_OBJECT);const t=e.resourceCache,n=e.gltfResource,i=e.baseResource,o=e.typedArray,r=e.gltfJson,s=e.cacheKey;D.typeOf.func("options.resourceCache",t),D.typeOf.object("options.gltfResource",n),D.typeOf.object("options.baseResource",i),this._resourceCache=t,this._gltfResource=n,this._baseResource=i,this._typedArray=o,this._gltfJson=r,this._cacheKey=s,this._gltf=void 0,this._bufferLoaders=[],this._state=G9.UNLOADED,this._promise=yn()}function y7(e){return e._fetchGltf().then((function(t){if(e.isDestroyed())return;const n=new Uint8Array(t);return C7(e,n)}))}function v7(e,t){e.unload(),e._state=G9.FAILED;const n=`Failed to load glTF: ${e._gltfResource.url}`;e._promise.reject(e.getError(n,t))}function b7(e,t){if("2.0"===t.asset.version)return Promise.resolve();const n=[];return AZ.buffer(t,(function(t){if(!C(t.extras._pipeline.source)&&C(t.uri)){const i=e._baseResource.getDerivedResource({url:t.uri}),o=e._resourceCache,r=o.loadExternalBuffer({resource:i});e._bufferLoaders.push(r),n.push(r.promise.then((function(e){t.extras._pipeline.source=e.typedArray})))}})),Promise.all(n).then((function(){t0(t)}))}function A7(e){const t=[];return AZ.buffer(e,(function(e){const n=e.uri;!C(e.extras._pipeline.source)&&C(n)&&Mn(n)&&(delete e.uri,t.push(Vi.fetchArrayBuffer(n).then((function(t){e.extras._pipeline.source=new Uint8Array(t)}))))})),Promise.all(t)}function w7(e,t){const n=[];return AZ.buffer(t,(function(t,i){const o=t.extras._pipeline.source;if(C(o)&&!C(t.uri)){const t=e._resourceCache,r=t.loadEmbeddedBuffer({parentResource:e._gltfResource,bufferId:i,typedArray:o});e._bufferLoaders.push(r),n.push(r.promise)}})),Promise.all(n)}function T7(e,t){return RZ(t),A7(t).then((function(){return b7(e,t).then((function(){return OZ(t),w7(e,t).then((function(){return _7(t),t}))}))}))}function C7(e,t){let n;return n="glTF"===WF(t)?HZ(t):Fp(t),T7(e,n)}C(Object.create)&&(g7.prototype=Object.create(V9.prototype),g7.prototype.constructor=g7),Object.defineProperties(g7.prototype,{promise:{get:function(){return this._promise.promise}},cacheKey:{get:function(){return this._cacheKey}},gltf:{get:function(){return this._gltf}}}),g7.prototype.load=function(){let e;this._state=G9.LOADING,e=C(this._gltfJson)?T7(this,this._gltfJson):C(this._typedArray)?C7(this,this._typedArray):y7(this);const t=this;return e.then((function(e){t.isDestroyed()||(t._gltf=e,t._state=G9.READY,t._promise.resolve(t))})).catch((function(e){t.isDestroyed()||v7(t,e)}))},g7.prototype.unload=function(){const e=this._bufferLoaders,t=e.length;for(let n=0;n<t;++n)this._resourceCache.unload(e[n]);this._bufferLoaders.length=0,this._gltf=void 0},g7.prototype._fetchGltf=function(){return this._gltfResource.fetchArrayBuffer()};const E7={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};var x7=Object.freeze(E7);const S7={};function I7(){this.octEncoded=!1,this.octEncodedZXY=!1,this.normalizationRange=void 0,this.quantizedVolumeOffset=void 0,this.quantizedVolumeDimensions=void 0,this.quantizedVolumeStepSize=void 0,this.componentDatatype=void 0,this.type=void 0}function O7(){this.name=void 0,this.semantic=void 0,this.setIndex=void 0,this.componentDatatype=void 0,this.type=void 0,this.normalized=!1,this.count=void 0,this.min=void 0,this.max=void 0,this.constant=void 0,this.quantization=void 0,this.packedTypedArray=void 0,this.buffer=void 0,this.typedArray=void 0,this.byteOffset=0,this.byteStride=void 0}function D7(){this.indexDatatype=void 0,this.count=void 0,this.buffer=void 0,this.typedArray=void 0}function P7(){this.featureCount=void 0,this.nullFeatureId=void 0,this.propertyTableId=void 0,this.setIndex=void 0,this.label=void 0,this.positionalLabel=void 0}function R7(){this.featureCount=void 0,this.nullFeatureId=void 0,this.propertyTableId=void 0,this.offset=0,this.repeat=void 0,this.label=void 0,this.positionalLabel=void 0}function L7(){this.featureCount=void 0,this.nullFeatureId=void 0,this.propertyTableId=void 0,this.textureReader=void 0,this.label=void 0,this.positionalLabel=void 0}function M7(){this.attributes=[]}function B7(){this.attributes=[],this.morphTargets=[],this.morphWeights=[],this.indices=void 0,this.material=void 0,this.primitiveType=void 0,this.featureIds=[],this.propertyTextureIds=[],this.propertyAttributeIds=[]}function N7(){this.attributes=[],this.featureIds=[],this.transformInWorldSpace=!1}function F7(){this.joints=void 0,this.inverseBindMatrices=void 0}function z7(){this.children=[],this.primitives=[],this.instances=void 0,this.skin=void 0,this.matrix=void 0,this.translation=void 0,this.rotation=void 0,this.scale=void 0}function k7(){this.nodes=[]}function U7(){this.credits=[]}function V7(){this.asset=new U7,this.scene=void 0,this.nodes=void 0,this.structuralMetadata=void 0,this.upAxis=void 0,this.forwardAxis=void 0,this.transform=ft.clone(ft.IDENTITY)}function H7(){this.texture=void 0,this.index=void 0,this.texCoord=0,this.transform=ke.clone(ke.IDENTITY),this.channels=void 0}function G7(){this.baseColorTexture=void 0,this.metallicRoughnessTexture=void 0,this.baseColorFactor=Xe.clone(G7.DEFAULT_BASE_COLOR_FACTOR),this.metallicFactor=G7.DEFAULT_METALLIC_FACTOR,this.roughnessFactor=G7.DEFAULT_ROUGHNESS_FACTOR}function W7(){this.diffuseTexture=void 0,this.specularGlossinessTexture=void 0,this.diffuseFactor=Xe.clone(W7.DEFAULT_DIFFUSE_FACTOR),this.specularFactor=K.clone(W7.DEFAULT_SPECULAR_FACTOR),this.glossinessFactor=W7.DEFAULT_GLOSSINESS_FACTOR}function q7(){this.metallicRoughness=new G7,this.specularGlossiness=void 0,this.emissiveTexture=void 0,this.normalTexture=void 0,this.occlusionTexture=void 0,this.emissiveFactor=K.clone(q7.DEFAULT_EMISSIVE_FACTOR),this.alphaMode=x7.OPAQUE,this.alphaCutoff=.5,this.doubleSided=!1,this.unlit=!1}G7.DEFAULT_BASE_COLOR_FACTOR=Xe.ONE,G7.DEFAULT_METALLIC_FACTOR=1,G7.DEFAULT_ROUGHNESS_FACTOR=1,W7.DEFAULT_DIFFUSE_FACTOR=Xe.ONE,W7.DEFAULT_SPECULAR_FACTOR=K.ONE,W7.DEFAULT_GLOSSINESS_FACTOR=1,q7.DEFAULT_EMISSIVE_FACTOR=K.ZERO,S7.Quantization=I7,S7.Attribute=O7,S7.Indices=D7,S7.FeatureIdAttribute=P7,S7.FeatureIdTexture=L7,S7.FeatureIdImplicitRange=R7,S7.MorphTarget=M7,S7.Primitive=B7,S7.Instances=N7,S7.Skin=F7,S7.Node=z7,S7.Scene=k7,S7.Asset=U7,S7.Components=V7,S7.TextureReader=H7,S7.MetallicRoughness=G7,S7.SpecularGlossiness=W7,S7.Material=q7;var j7=S7;const Y7={getImageIdFromTexture:function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.textureId,i=e.supportedImageFormats;D.typeOf.object("options.gltf",t),D.typeOf.number("options.textureId",n),D.typeOf.object("options.supportedImageFormats",i);const o=t.textures[n],r=o.extensions;if(C(r)){if(i.webp&&C(r.EXT_texture_webp))return r.EXT_texture_webp.source;if(i.basis&&C(r.KHR_texture_basisu))return r.KHR_texture_basisu.source}return o.source},createSampler:function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.textureInfo,i=R(e.compressedTextureNoMipmap,!1);D.typeOf.object("options.gltf",t),D.typeOf.object("options.textureInfo",n);let o=Mk.REPEAT,r=Mk.REPEAT,s=Rk.LINEAR,a=Dk.LINEAR;const c=n.index,l=t.textures[c],u=l.sampler;if(C(u)){const e=t.samplers[u];o=R(e.wrapS,o),r=R(e.wrapT,r),s=R(e.minFilter,s),a=R(e.magFilter,a)}let h=!1;const d=n.extensions;return C(d)&&C(d.KHR_texture_transform)&&(h=!0),(i||h)&&s!==Rk.LINEAR&&s!==Rk.NEAREST&&(s=s===Rk.NEAREST_MIPMAP_NEAREST||s===Rk.NEAREST_MIPMAP_LINEAR?Rk.NEAREST:Rk.LINEAR),new Nk({wrapS:o,wrapT:r,minificationFilter:s,magnificationFilter:a})}},K7=new ro(1,1);Y7.createModelTextureReader=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.textureInfo,n=e.channels,i=e.texture;D.typeOf.object("options.textureInfo",t);let o,r=R(t.texCoord,0);const s=R(t.extensions,R.EMPTY_OBJECT).KHR_texture_transform;if(C(s)){r=R(s.texCoord,r);const e=C(s.offset)?ro.unpack(s.offset):ro.ZERO;let t=R(s.rotation,0);const n=C(s.scale)?ro.unpack(s.scale):K7;t=-t,o=new ke(Math.cos(t)*n.x,-Math.sin(t)*n.y,e.x,Math.sin(t)*n.x,Math.cos(t)*n.y,e.y,0,0,1)}const a=new j7.TextureReader;return a.index=t.index,a.texture=i,a.texCoord=r,a.transform=o,a.channels=n,a};var X7=Y7;function Q7(e){e=R(e,R.EMPTY_OBJECT);const t=e.resourceCache,n=e.gltf,i=e.textureInfo,o=e.gltfResource,r=e.baseResource,s=e.supportedImageFormats,a=e.cacheKey,c=R(e.asynchronous,!0);D.typeOf.func("options.resourceCache",t),D.typeOf.object("options.gltf",n),D.typeOf.object("options.textureInfo",i),D.typeOf.object("options.gltfResource",o),D.typeOf.object("options.baseResource",r),D.typeOf.object("options.supportedImageFormats",s);const l=i.index,u=X7.getImageIdFromTexture({gltf:n,textureId:l,supportedImageFormats:s});this._resourceCache=t,this._gltf=n,this._textureInfo=i,this._imageId=u,this._gltfResource=o,this._baseResource=r,this._cacheKey=a,this._asynchronous=c,this._imageLoader=void 0,this._image=void 0,this._mipLevels=void 0,this._texture=void 0,this._state=G9.UNLOADED,this._promise=yn()}function J7(){this.gltf=void 0,this.textureInfo=void 0,this.image=void 0,this.context=void 0,this.texture=void 0}function Z7(e){const t=document.createElement("canvas");t.width=z.nextPowerOfTwo(e.width),t.height=z.nextPowerOfTwo(e.height);const n=t.getContext("2d");return n.drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}function $7(e,t,n,i,o){const r=n.internalFormat;let s=!1;fD.isCompressedFormat(r)&&!C(i)&&(s=!0);const a=X7.createSampler({gltf:e,textureInfo:t,compressedTextureNoMipmap:s}),c=a.minificationFilter,l=a.wrapS,u=a.wrapT,h=c===Rk.NEAREST_MIPMAP_NEAREST||c===Rk.NEAREST_MIPMAP_LINEAR||c===Rk.LINEAR_MIPMAP_NEAREST||c===Rk.LINEAR_MIPMAP_LINEAR,d=!C(r)&&h,f=d||l===Mk.REPEAT||l===Mk.MIRRORED_REPEAT||u===Mk.REPEAT||u===Mk.MIRRORED_REPEAT,p=!z.isPowerOfTwo(n.width)||!z.isPowerOfTwo(n.height),m=f&&p;let _;return C(r)?(!o.webgl2&&fD.isCompressedFormat(r)&&p&&f&&console.warn("Compressed texture uses REPEAT or MIRRORED_REPEAT texture wrap mode and dimensions are not powers of two. The texture may be rendered incorrectly."),_=Uk.create({context:o,source:{arrayBufferView:n.bufferView,mipLevels:i},width:n.width,height:n.height,pixelFormat:n.internalFormat,sampler:a})):(m&&(n=Z7(n)),_=Uk.create({context:o,source:n,sampler:a,flipY:!1,skipColorSpaceConversion:!0})),d&&_.generateMipmap(),_}C(Object.create)&&(Q7.prototype=Object.create(V9.prototype),Q7.prototype.constructor=Q7),Object.defineProperties(Q7.prototype,{promise:{get:function(){return this._promise.promise}},cacheKey:{get:function(){return this._cacheKey}},texture:{get:function(){return this._texture}}}),Q7.prototype.load=function(){const e=this._resourceCache,t=e.loadImage({gltf:this._gltf,imageId:this._imageId,gltfResource:this._gltfResource,baseResource:this._baseResource});this._imageLoader=t,this._state=G9.LOADING;const n=this;t.promise.then((function(){n.isDestroyed()||(n._image=t.image,n._mipLevels=t.mipLevels,n._state=G9.PROCESSING)})).catch((function(e){if(n.isDestroyed())return;n.unload(),n._state=G9.FAILED;const t="Failed to load texture";n._promise.reject(n.getError(t,e))}))},J7.prototype.set=function(e,t,n,i,o){this.gltf=e,this.textureInfo=t,this.image=n,this.mipLevels=i,this.context=o},J7.prototype.execute=function(){this.texture=$7(this.gltf,this.textureInfo,this.image,this.mipLevels,this.context)};const eee=new J7;function tee(e){e=R(e,R.EMPTY_OBJECT);const t=e.resourceCache,n=e.gltf,i=e.gltfResource,o=e.baseResource,r=e.bufferViewId,s=e.draco,a=e.attributeSemantic,c=e.accessorId,l=e.cacheKey,u=R(e.asynchronous,!0),h=R(e.dequantize,!1),d=R(e.loadAsTypedArray,!1);D.typeOf.func("options.resourceCache",t),D.typeOf.object("options.gltf",n),D.typeOf.object("options.gltfResource",i),D.typeOf.object("options.baseResource",o);const f=C(r),p=C(s),m=C(a),_=C(c);if(f===p)throw new x("One of options.bufferViewId and options.draco must be defined.");if(p&&!m)throw new x("When options.draco is defined options.attributeSemantic must also be defined.");if(p&&!_)throw new x("When options.draco is defined options.accessorId must also be defined.");p&&(D.typeOf.object("options.draco",s),D.typeOf.string("options.attributeSemantic",a),D.typeOf.number("options.accessorId",c)),this._resourceCache=t,this._gltfResource=i,this._baseResource=o,this._gltf=n,this._bufferViewId=r,this._draco=s,this._attributeSemantic=a,this._accessorId=c,this._cacheKey=l,this._asynchronous=u,this._dequantize=h,this._loadAsTypedArray=d,this._bufferViewLoader=void 0,this._dracoLoader=void 0,this._quantization=void 0,this._typedArray=void 0,this._buffer=void 0,this._state=G9.UNLOADED,this._promise=yn()}function nee(e,t,n,i){const o=e.quantizationBits,r=(1<<o)-1,s=1/r,a=new j7.Quantization;if(a.componentDatatype=t,a.octEncoded=e.octEncoded,a.octEncodedZXY=!0,a.type=i,a.octEncoded)a.type=fh.VEC2,a.normalizationRange=r;else{const t=fh.getMathType(i);if(t===Number){const t=e.range;a.quantizedVolumeOffset=e.minValues[0],a.quantizedVolumeDimensions=t,a.normalizationRange=r,a.quantizedVolumeStepSize=t*s}else{a.quantizedVolumeOffset=t.unpack(e.minValues),a.normalizationRange=t.unpack(wf(new Array(n),r));const i=wf(new Array(n),e.range);a.quantizedVolumeDimensions=t.unpack(i);const o=i.map((function(e){return e*s}));a.quantizedVolumeStepSize=t.unpack(o)}}return a}function iee(e){const t=e._resourceCache,n=t.loadDraco({gltf:e._gltf,draco:e._draco,gltfResource:e._gltfResource,baseResource:e._baseResource});e._dracoLoader=n,e._state=G9.LOADING,n.promise.then((function(){if(e.isDestroyed())return;const t=n.decodedData.vertexAttributes,i=e._attributeSemantic,o=t[i],r=e._accessorId,s=e._gltf.accessors[r],a=s.type,c=o.array,l=o.data.quantization;C(l)&&(e._quantization=nee(l,o.data.componentDatatype,o.data.componentsPerAttribute,a)),e._typedArray=c,e._state=G9.PROCESSING})).catch((function(t){e.isDestroyed()||ree(e,t)}))}function oee(e){const t=e._resourceCache,n=t.loadBufferView({gltf:e._gltf,bufferViewId:e._bufferViewId,gltfResource:e._gltfResource,baseResource:e._baseResource});e._state=G9.LOADING,e._bufferViewLoader=n,n.promise.then((function(){e.isDestroyed()||(e._typedArray=n.typedArray,e._state=G9.PROCESSING)})).catch((function(t){e.isDestroyed()||ree(e,t)}))}function ree(e,t){e.unload(),e._state=G9.FAILED;const n="Failed to load vertex buffer";t=e.getError(n,t),e._promise.reject(t)}function see(){this.typedArray=void 0,this.dequantize=void 0,this.componentType=void 0,this.type=void 0,this.count=void 0,this.context=void 0,this.buffer=void 0}function aee(e,t,n,i,o,r){t&&n!==ih.FLOAT&&(e=wh.dequantize(e,n,i,o));const s=hq.createVertexBuffer({typedArray:e,context:r,usage:lq.STATIC_DRAW});return s.vertexArrayDestroyable=!1,s}Q7.prototype.process=function(e){if(D.typeOf.object("frameState",e),C(this._texture))return;if(!C(this._image))return;let t;if(this._asynchronous){const n=eee;n.set(this._gltf,this._textureInfo,this._image,this._mipLevels,e.context);const i=e.jobScheduler;if(!i.execute(n,B3.TEXTURE))return;t=n.texture}else t=$7(this._gltf,this._textureInfo,this._image,this._mipLevels,e.context);this.unload(),this._texture=t,this._state=G9.READY,this._promise.resolve(this)},Q7.prototype.unload=function(){C(this._texture)&&this._texture.destroy(),C(this._imageLoader)&&this._resourceCache.unload(this._imageLoader),this._imageLoader=void 0,this._image=void 0,this._mipLevels=void 0,this._texture=void 0,this._gltf=void 0},C(Object.create)&&(tee.prototype=Object.create(V9.prototype),tee.prototype.constructor=tee),Object.defineProperties(tee.prototype,{promise:{get:function(){return this._promise.promise}},cacheKey:{get:function(){return this._cacheKey}},buffer:{get:function(){return this._buffer}},typedArray:{get:function(){return this._typedArray}},quantization:{get:function(){return this._quantization}}}),tee.prototype.load=function(){C(this._draco)?iee(this):oee(this)},see.prototype.set=function(e,t,n,i,o,r){this.typedArray=e,this.dequantize=t,this.componentType=n,this.type=i,this.count=o,this.context=r},see.prototype.execute=function(){this.buffer=aee(this.typedArray,this.dequantize,this.componentType,this.type,this.count,this.context)};const cee=new see;function lee(e){e=R(e,R.EMPTY_OBJECT);const t=e.id,n=e.class;D.typeOf.string("options.id",t),D.typeOf.object("options.class",n);const i={},o={};for(const r in n.properties)if(n.properties.hasOwnProperty(r)){const t=new m9({id:r,property:n.properties[r],enums:e.enums});i[r]=t,C(t.semantic)&&(o[t.semantic]=t)}this._properties=i,this._propertiesBySemantic=o,this._id=t,this._name=n.name,this._description=n.description,this._extras=n.extras,this._extensions=n.extensions}tee.prototype.process=function(e){if(D.typeOf.object("frameState",e),this._state===G9.READY)return;const t=this._typedArray,n=this._dequantize;if(C(this._dracoLoader)&&this._dracoLoader.process(e),C(this._bufferViewLoader)&&this._bufferViewLoader.process(e),!C(t))return;if(this._loadAsTypedArray)return this.unload(),this._typedArray=t,this._state=G9.READY,void this._promise.resolve(this);const i=this._gltf.accessors[this._accessorId];let o;if(this._asynchronous){const r=cee;r.set(t,n,i.componentType,i.type,i.count,e.context);const s=e.jobScheduler;if(!s.execute(r,B3.BUFFER))return;o=r.buffer}else o=aee(t,n,i.componentType,i.type,i.count,e.context);this.unload(),this._buffer=o,this._state=G9.READY,this._promise.resolve(this)},tee.prototype.unload=function(){C(this._buffer)&&this._buffer.destroy();const e=this._resourceCache;C(this._bufferViewLoader)&&e.unload(this._bufferViewLoader),C(this._dracoLoader)&&e.unload(this._dracoLoader),this._bufferViewLoader=void 0,this._dracoLoader=void 0,this._typedArray=void 0,this._buffer=void 0,this._gltf=void 0},Object.defineProperties(lee.prototype,{properties:{get:function(){return this._properties}},propertiesBySemantic:{get:function(){return this._propertiesBySemantic}},id:{get:function(){return this._id}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),lee.BATCH_TABLE_CLASS_NAME="_batchTable";var uee=lee;function hee(e){D.typeOf.object("value",e),this._value=e.value,this._name=e.name,this._description=e.description,this._extras=e.extras,this._extensions=e.extensions}Object.defineProperties(hee.prototype,{value:{get:function(){return this._value}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});var dee=hee;function fee(e){e=R(e,R.EMPTY_OBJECT);const t=e.id,n=e.enum;D.typeOf.string("options.id",t),D.typeOf.object("options.enum",n);const i={},o={},r=n.values.map((function(e){return i[e.value]=e.name,o[e.name]=e.value,new dee(e)})),s=R(X8[n.valueType],X8.UINT16);this._values=r,this._namesByValue=i,this._valuesByName=o,this._valueType=s,this._id=t,this._name=n.name,this._description=n.description,this._extras=n.extras,this._extensions=n.extensions}Object.defineProperties(fee.prototype,{values:{get:function(){return this._values}},namesByValue:{get:function(){return this._namesByValue}},valuesByName:{get:function(){return this._valuesByName}},valueType:{get:function(){return this._valueType}},id:{get:function(){return this._id}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});var pee=fee;function mee(e){D.typeOf.object("schema",e);const t={};if(C(e.enums))for(const i in e.enums)e.enums.hasOwnProperty(i)&&(t[i]=new pee({id:i,enum:e.enums[i]}));const n={};if(C(e.classes))for(const i in e.classes)e.classes.hasOwnProperty(i)&&(n[i]=new uee({id:i,class:e.classes[i],enums:t}));this._classes=n,this._enums=t,this._id=e.id,this._name=e.name,this._description=e.description,this._version=e.version,this._extras=e.extras,this._extensions=e.extensions}Object.defineProperties(mee.prototype,{classes:{get:function(){return this._classes}},enums:{get:function(){return this._enums}},id:{get:function(){return this._id}},name:{get:function(){return this._name}},description:{get:function(){return this._description}},version:{get:function(){return this._version}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});var _ee=mee;function gee(e){e=R(e,R.EMPTY_OBJECT);const t=e.schema,n=e.resource,i=e.cacheKey;if(C(t)===C(n))throw new x("One of options.schema and options.resource must be defined.");this._schema=C(t)?new _ee(t):void 0,this._resource=n,this._cacheKey=i,this._state=G9.UNLOADED,this._promise=yn()}function yee(e){const t=e._resource;e._state=G9.LOADING,t.fetchJson().then((function(t){e.isDestroyed()||(e._schema=new _ee(t),e._state=G9.READY,e._promise.resolve(e))})).catch((function(n){if(e.isDestroyed())return;e._state=G9.FAILED;const i=`Failed to load schema: ${t.url}`;e._promise.reject(e.getError(i,n))}))}C(Object.create)&&(gee.prototype=Object.create(V9.prototype),gee.prototype.constructor=gee),Object.defineProperties(gee.prototype,{promise:{get:function(){return this._promise.promise}},cacheKey:{get:function(){return this._cacheKey}},schema:{get:function(){return this._schema}}}),gee.prototype.load=function(){C(this._schema)?this._promise.resolve(this):yee(this)},gee.prototype.unload=function(){this._schema=void 0};const vee={};function bee(e){return un(e.url)}function Aee(e){let t=e.byteOffset,n=e.byteLength;if(z8(e,"EXT_meshopt_compression")){const i=e.extensions.EXT_meshopt_compression;t=R(i.byteOffset,0),n=i.byteLength}return`${t}-${t+n}`}function wee(e,t){const n=t.byteOffset+e.byteOffset,i=e.componentType,o=e.type,r=e.count;return`${n}-${i}-${o}-${r}`}function Tee(e){return bee(e)}function Cee(e,t){const n=bee(e);return`${n}-buffer-id-${t}`}function Eee(e,t,n,i){if(C(e.uri)){const t=i.getDerivedResource({url:e.uri});return Tee(t)}return Cee(n,t)}function xee(e,t,n,i){const o=t.bufferView,r=e.bufferViews[o],s=r.buffer,a=e.buffers[s],c=Eee(a,s,n,i),l=Aee(r);return`${c}-range-${l}`}function See(e,t,n,i){const o=e.images[t],r=o.bufferView,s=o.uri;if(C(s)){const e=i.getDerivedResource({url:s});return bee(e)}const a=e.bufferViews[r],c=a.buffer,l=e.buffers[c],u=Eee(l,c,n,i),h=Aee(a);return`${u}-range-${h}`}function Iee(e,t){const n=X7.createSampler({gltf:e,textureInfo:t});return`${n.wrapS}-${n.wrapT}-${n.minificationFilter}-${n.magnificationFilter}`}vee.getSchemaCacheKey=function(e){const t=e.schema,n=e.resource;if(C(t)===C(n))throw new x("One of options.schema and options.resource must be defined.");return C(t)?`embedded-schema:${JSON.stringify(t)}`:`external-schema:${bee(n)}`},vee.getExternalBufferCacheKey=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.resource;return D.typeOf.object("options.resource",t),`external-buffer:${Tee(t)}`},vee.getEmbeddedBufferCacheKey=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.parentResource,n=e.bufferId;return D.typeOf.object("options.parentResource",t),D.typeOf.number("options.bufferId",n),`embedded-buffer:${Cee(t,n)}`},vee.getGltfCacheKey=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltfResource;return D.typeOf.object("options.gltfResource",t),`gltf:${bee(t)}`},vee.getBufferViewCacheKey=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.bufferViewId,i=e.gltfResource,o=e.baseResource;D.typeOf.object("options.gltf",t),D.typeOf.number("options.bufferViewId",n),D.typeOf.object("options.gltfResource",i),D.typeOf.object("options.baseResource",o);const r=t.bufferViews[n];let s=r.buffer;const a=t.buffers[s];if(z8(r,"EXT_meshopt_compression")){const e=r.extensions.EXT_meshopt_compression;s=e.buffer}const c=Eee(a,s,i,o),l=Aee(r);return`buffer-view:${c}-range-${l}`},vee.getDracoCacheKey=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.draco,i=e.gltfResource,o=e.baseResource;return D.typeOf.object("options.gltf",t),D.typeOf.object("options.draco",n),D.typeOf.object("options.gltfResource",i),D.typeOf.object("options.baseResource",o),`draco:${xee(t,n,i,o)}`},vee.getVertexBufferCacheKey=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.gltfResource,i=e.baseResource,o=e.bufferViewId,r=e.draco,s=e.attributeSemantic,a=R(e.dequantize,!1),c=R(e.loadAsTypedArray,!1);D.typeOf.object("options.gltf",t),D.typeOf.object("options.gltfResource",n),D.typeOf.object("options.baseResource",i);const l=C(o),u=C(r),h=C(s);if(l===u)throw new x("One of options.bufferViewId and options.draco must be defined.");if(u&&!h)throw new x("When options.draco is defined options.attributeSemantic must also be defined.");u&&(D.typeOf.object("options.draco",r),D.typeOf.string("options.attributeSemantic",s));let d="";if(a&&(d+="-dequantize"),c&&(d+="-typed-array"),C(r)){const e=xee(t,r,n,i);return`vertex-buffer:${e}-draco-${s}${d}`}const f=t.bufferViews[o],p=f.buffer,m=t.buffers[p],_=Eee(m,p,n,i),g=Aee(f);return`vertex-buffer:${_}-range-${g}${d}`},vee.getIndexBufferCacheKey=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.accessorId,i=e.gltfResource,o=e.baseResource,r=e.draco,s=R(e.loadAsTypedArray,!1);D.typeOf.object("options.gltf",t),D.typeOf.number("options.accessorId",n),D.typeOf.object("options.gltfResource",i),D.typeOf.object("options.baseResource",o);let a="";if(s&&(a+="-typed-array"),C(r)){const e=xee(t,r,i,o);return`index-buffer:${e}-draco${a}`}const c=t.accessors[n],l=c.bufferView,u=t.bufferViews[l],h=u.buffer,d=t.buffers[h],f=Eee(d,h,i,o),p=wee(c,u);return`index-buffer:${f}-accessor-${p}${a}`},vee.getImageCacheKey=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.imageId,i=e.gltfResource,o=e.baseResource;D.typeOf.object("options.gltf",t),D.typeOf.number("options.imageId",n),D.typeOf.object("options.gltfResource",i),D.typeOf.object("options.baseResource",o);const r=See(t,n,i,o);return`image:${r}`},vee.getTextureCacheKey=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.textureInfo,i=e.gltfResource,o=e.baseResource,r=e.supportedImageFormats;D.typeOf.object("options.gltf",t),D.typeOf.object("options.textureInfo",n),D.typeOf.object("options.gltfResource",i),D.typeOf.object("options.baseResource",o),D.typeOf.object("options.supportedImageFormats",r);const s=n.index,a=X7.getImageIdFromTexture({gltf:t,textureId:s,supportedImageFormats:r}),c=See(t,a,i,o),l=Iee(t,n);return`texture:${c}-sampler-${l}`};var Oee=vee;function Dee(){}function Pee(e){this.referenceCount=1,this.resourceLoader=e}Dee.cacheEntries={},Dee.get=function(e){D.typeOf.string("cacheKey",e);const t=Dee.cacheEntries[e];if(C(t))return++t.referenceCount,t.resourceLoader},Dee.load=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.resourceLoader;D.typeOf.object("options.resourceLoader",t);const n=t.cacheKey;if(D.typeOf.string("options.resourceLoader.cacheKey",n),C(Dee.cacheEntries[n]))throw new x(`Resource with this cacheKey is already in the cache: ${n}`);Dee.cacheEntries[n]=new Pee(t),t.load()},Dee.unload=function(e){D.typeOf.object("resourceLoader",e);const t=e.cacheKey,n=Dee.cacheEntries[t];if(!C(n))throw new x(`Resource is not in the cache: ${t}`);--n.referenceCount,0===n.referenceCount&&(e.destroy(),delete Dee.cacheEntries[t])},Dee.loadSchema=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.schema,n=e.resource;if(C(t)===C(n))throw new x("One of options.schema and options.resource must be defined.");const i=Oee.getSchemaCacheKey({schema:t,resource:n});let o=Dee.get(i);return C(o)||(o=new gee({schema:t,resource:n,cacheKey:i}),Dee.load({resourceLoader:o})),o},Dee.loadEmbeddedBuffer=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.parentResource,n=e.bufferId,i=e.typedArray;D.typeOf.object("options.parentResource",t),D.typeOf.number("options.bufferId",n);const o=Oee.getEmbeddedBufferCacheKey({parentResource:t,bufferId:n});let r=Dee.get(o);return C(r)||(D.typeOf.object("options.typedArray",i),r=new W9({typedArray:i,cacheKey:o}),Dee.load({resourceLoader:r})),r},Dee.loadExternalBuffer=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.resource;D.typeOf.object("options.resource",t);const n=Oee.getExternalBufferCacheKey({resource:t});let i=Dee.get(n);return C(i)||(i=new W9({resource:t,cacheKey:n}),Dee.load({resourceLoader:i})),i},Dee.loadGltfJson=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltfResource,n=e.baseResource,i=e.typedArray,o=e.gltfJson;D.typeOf.object("options.gltfResource",t),D.typeOf.object("options.baseResource",n);const r=Oee.getGltfCacheKey({gltfResource:t});let s=Dee.get(r);return C(s)||(s=new g7({resourceCache:Dee,gltfResource:t,baseResource:n,typedArray:i,gltfJson:o,cacheKey:r}),Dee.load({resourceLoader:s})),s},Dee.loadBufferView=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.bufferViewId,i=e.gltfResource,o=e.baseResource;D.typeOf.object("options.gltf",t),D.typeOf.number("options.bufferViewId",n),D.typeOf.object("options.gltfResource",i),D.typeOf.object("options.baseResource",o);const r=Oee.getBufferViewCacheKey({gltf:t,bufferViewId:n,gltfResource:i,baseResource:o});let s=Dee.get(r);return C(s)||(s=new Y9({resourceCache:Dee,gltf:t,bufferViewId:n,gltfResource:i,baseResource:o,cacheKey:r}),Dee.load({resourceLoader:s})),s},Dee.loadDraco=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.draco,i=e.gltfResource,o=e.baseResource;D.typeOf.object("options.gltf",t),D.typeOf.object("options.draco",n),D.typeOf.object("options.gltfResource",i),D.typeOf.object("options.baseResource",o);const r=Oee.getDracoCacheKey({gltf:t,draco:n,gltfResource:i,baseResource:o});let s=Dee.get(r);return C(s)||(s=new X9({resourceCache:Dee,gltf:t,draco:n,gltfResource:i,baseResource:o,cacheKey:r}),Dee.load({resourceLoader:s})),s},Dee.loadVertexBuffer=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.gltfResource,i=e.baseResource,o=e.bufferViewId,r=e.draco,s=e.attributeSemantic,a=e.accessorId,c=R(e.asynchronous,!0),l=R(e.dequantize,!1),u=R(e.loadAsTypedArray,!1);D.typeOf.object("options.gltf",t),D.typeOf.object("options.gltfResource",n),D.typeOf.object("options.baseResource",i);const h=C(o),d=C(r),f=C(s),p=C(a);if(h===d)throw new x("One of options.bufferViewId and options.draco must be defined.");if(d&&!f)throw new x("When options.draco is defined options.attributeSemantic must also be defined.");if(d&&!p)throw new x("When options.draco is defined options.haAccessorId must also be defined.");d&&(D.typeOf.object("options.draco",r),D.typeOf.string("options.attributeSemantic",s),D.typeOf.number("options.accessorId",a));const m=Oee.getVertexBufferCacheKey({gltf:t,gltfResource:n,baseResource:i,bufferViewId:o,draco:r,attributeSemantic:s,dequantize:l,loadAsTypedArray:u});let _=Dee.get(m);return C(_)||(_=new tee({resourceCache:Dee,gltf:t,gltfResource:n,baseResource:i,bufferViewId:o,draco:r,attributeSemantic:s,accessorId:a,cacheKey:m,asynchronous:c,dequantize:l,loadAsTypedArray:u}),Dee.load({resourceLoader:_})),_},Dee.loadIndexBuffer=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.accessorId,i=e.gltfResource,o=e.baseResource,r=e.draco,s=R(e.asynchronous,!0),a=R(e.loadAsTypedArray,!1);D.typeOf.object("options.gltf",t),D.typeOf.number("options.accessorId",n),D.typeOf.object("options.gltfResource",i),D.typeOf.object("options.baseResource",o);const c=Oee.getIndexBufferCacheKey({gltf:t,accessorId:n,gltfResource:i,baseResource:o,draco:r,loadAsTypedArray:a});let l=Dee.get(c);return C(l)||(l=new s7({resourceCache:Dee,gltf:t,accessorId:n,gltfResource:i,baseResource:o,draco:r,cacheKey:c,asynchronous:s,loadAsTypedArray:a}),Dee.load({resourceLoader:l})),l},Dee.loadImage=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.imageId,i=e.gltfResource,o=e.baseResource;D.typeOf.object("options.gltf",t),D.typeOf.number("options.imageId",n),D.typeOf.object("options.gltfResource",i),D.typeOf.object("options.baseResource",o);const r=Oee.getImageCacheKey({gltf:t,imageId:n,gltfResource:i,baseResource:o});let s=Dee.get(r);return C(s)||(s=new J9({resourceCache:Dee,gltf:t,imageId:n,gltfResource:i,baseResource:o,cacheKey:r}),Dee.load({resourceLoader:s})),s},Dee.loadTexture=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.textureInfo,i=e.gltfResource,o=e.baseResource,r=e.supportedImageFormats,s=R(e.asynchronous,!0);D.typeOf.object("options.gltf",t),D.typeOf.object("options.textureInfo",n),D.typeOf.object("options.gltfResource",i),D.typeOf.object("options.baseResource",o);const a=Oee.getTextureCacheKey({gltf:t,textureInfo:n,gltfResource:i,baseResource:o,supportedImageFormats:r});let c=Dee.get(a);return C(c)||(c=new Q7({resourceCache:Dee,gltf:t,textureInfo:n,gltfResource:i,baseResource:o,supportedImageFormats:r,cacheKey:a,asynchronous:s}),Dee.load({resourceLoader:c})),c},Dee.clearForSpecs=function(){const e=[tee,s7,X9,Q7,J9,Y9,W9,gee,g7];let t;const n=Dee.cacheEntries,i=[];for(t in n)n.hasOwnProperty(t)&&i.push(n[t]);i.sort((function(t,n){const i=e.indexOf(t.resourceLoader.constructor),o=e.indexOf(n.resourceLoader.constructor);return i-o}));const o=i.length;for(let r=0;r<o;++r){const e=i[r];t=e.resourceLoader.cacheKey,C(n[t])&&(e.resourceLoader.destroy(),delete n[t])}};var Ree=Dee;function Lee(e,t,n,i,o){if(D.typeOf.object("resource",e),C(t)===C(n))throw new x("One of json and subtreeView must be defined.");D.typeOf.object("implicitTileset",i),D.typeOf.object("implicitCoordinates",o),this._resource=e,this._subtreeJson=void 0,this._bufferLoader=void 0,this._tileAvailability=void 0,this._contentAvailabilityBitstreams=[],this._childSubtreeAvailability=void 0,this._implicitCoordinates=o,this._subtreeLevels=i.subtreeLevels,this._subdivisionScheme=i.subdivisionScheme,this._branchingFactor=i.branchingFactor,this._readyPromise=yn(),this._metadata=void 0,this._tileMetadataTable=void 0,this._tilePropertyTableJson=void 0,this._contentMetadataTables=[],this._contentPropertyTableJsons=[],this._tileJumpBuffer=void 0,this._contentJumpBuffers=[],Mee(this,t,n,i)}function Mee(e,t,n,i){let o;o=C(t)?{json:t,binary:void 0}:Bee(n);const r=o.json;let s;if(e._subtreeJson=r,z8(r,"3DTILES_metadata"))s=r.extensions["3DTILES_metadata"];else if(C(r.tileMetadata)){const e=r.tileMetadata;s=r.propertyTables[e]}const a=[];if(C(r.contentMetadata)){const e=r.contentMetadata.length;for(let t=0;t<e;t++){const e=r.contentMetadata[t];a.push(r.propertyTables[e])}}let c;const l=i.metadataSchema,u=r.subtreeMetadata;if(C(u)){const e=u.class,t=l.classes[e];c=new Y8({subtreeMetadata:u,class:t})}e._metadata=c,e._tilePropertyTableJson=s,e._contentPropertyTableJsons=a;const h={constant:0};r.contentAvailabilityHeaders=[],z8(r,"3DTILES_multiple_contents")?r.contentAvailabilityHeaders=r.extensions["3DTILES_multiple_contents"].contentAvailability:Array.isArray(r.contentAvailability)?r.contentAvailabilityHeaders=r.contentAvailability:r.contentAvailabilityHeaders.push(R(r.contentAvailability,h));const d=Nee(r.buffers),f=Fee(r.bufferViews,d);zee(r,f),C(s)&&kee(s,f);for(let p=0;p<a.length;p++){const e=a[p];kee(e,f)}Uee(e,d,o.binary).then((function(t){const n=Hee(f,t);Gee(e,r,i,n),C(s)&&(qee(e,i,n),Kee(e)),jee(e,i,n),Xee(e),e._readyPromise.resolve(e)})).catch((function(t){e._readyPromise.reject(t)}))}function Bee(e){const t=!0,n=new DataView(e.buffer,e.byteOffset);let i=8;const o=n.getUint32(i,t);i+=8;const r=n.getUint32(i,t);i+=8;const s=Fp(e,i,o);i+=o;const a=e.subarray(i,i+r);return{json:s,binary:a}}function Nee(e){e=C(e)?e:[];for(let t=0;t<e.length;t++){const n=e[t];n.isExternal=C(n.uri),n.isActive=!1}return e}function Fee(e,t){e=C(e)?e:[];for(let n=0;n<e.length;n++){const i=e[n],o=t[i.buffer];i.bufferHeader=o,i.isActive=!1}return e}function zee(e,t){let n;const i=e.tileAvailability;C(i.bitstream)?n=t[i.bitstream]:C(i.bufferView)&&(n=t[i.bufferView]),C(n)&&(n.isActive=!0,n.bufferHeader.isActive=!0);const o=e.contentAvailabilityHeaders;for(let s=0;s<o.length;s++)n=void 0,C(o[s].bitstream)?n=t[o[s].bitstream]:C(o[s].bufferView)&&(n=t[o[s].bufferView]),C(n)&&(n.isActive=!0,n.bufferHeader.isActive=!0);n=void 0;const r=e.childSubtreeAvailability;C(r.bitstream)?n=t[r.bitstream]:C(r.bufferView)&&(n=t[r.bufferView]),C(n)&&(n.isActive=!0,n.bufferHeader.isActive=!0)}function kee(e,t){const n=e.properties;let i;for(const o in n)if(n.hasOwnProperty(o)){const e=n[o],r=R(e.values,e.bufferView);i=t[r],i.isActive=!0,i.bufferHeader.isActive=!0;const s=R(e.stringOffsets,e.stringOffsetBufferView);C(s)&&(i=t[s],i.isActive=!0,i.bufferHeader.isActive=!0);const a=R(e.arrayOffsets,e.arrayOffsetBufferView);C(a)&&(i=t[a],i.isActive=!0,i.bufferHeader.isActive=!0)}}function Uee(e,t,n){const i=[];for(let o=0;o<t.length;o++){const r=t[o];if(r.isActive)if(r.isExternal){const t=Vee(e,r);i.push(t)}else i.push(Promise.resolve(n));else i.push(Promise.resolve(void 0))}return Promise.all(i).then((function(e){const t={};for(let n=0;n<e.length;n++){const i=e[n];C(i)&&(t[n]=i)}return t}))}function Vee(e,t){const n=e._resource,i=n.getDerivedResource({url:t.uri}),o=Ree.loadExternalBuffer({resource:i});return e._bufferLoader=o,o.promise.then((function(e){return e.typedArray}))}function Hee(e,t){const n={};for(let i=0;i<e.length;i++){const o=e[i];if(!o.isActive)continue;const r=o.byteOffset,s=r+o.byteLength,a=t[o.buffer],c=a.subarray(r,s);n[i]=c}return n}function Gee(e,t,n,i){const o=n.branchingFactor,r=n.subtreeLevels,s=(Math.pow(o,r)-1)/(o-1),a=Math.pow(o,r),c=z8(t,"3DTILES_metadata"),l=C(e._tilePropertyTableJson);let u=c||l;e._tileAvailability=Wee(t.tileAvailability,i,s,u);const h=e._contentPropertyTableJsons.length>0;u=u||h;for(let d=0;d<t.contentAvailabilityHeaders.length;d++){const n=Wee(t.contentAvailabilityHeaders[d],i,s,u);e._contentAvailabilityBitstreams.push(n)}e._childSubtreeAvailability=Wee(t.childSubtreeAvailability,i,a)}function Wee(e,t,n,i){if(C(e.constant))return new k8({constant:Boolean(e.constant),lengthBits:n,availableCount:e.availableCount});let o;return C(e.bitstream)?o=t[e.bitstream]:C(e.bufferView)&&(o=t[e.bufferView]),new k8({bitstream:o,lengthBits:n,availableCount:e.availableCount,computeAvailableCountEnabled:i})}function qee(e,t,n){const i=e._tilePropertyTableJson,o=e._tileAvailability.availableCount,r=t.metadataSchema,s=i.class,a=r.classes[s];e._tileMetadataTable=new U9({class:a,count:o,properties:i.properties,bufferViews:n})}function jee(e,t,n){const i=e._contentPropertyTableJsons,o=e._contentAvailabilityBitstreams,r=t.metadataSchema,s=e._contentMetadataTables;for(let a=0;a<i.length;a++){const e=i[a],t=o[a],c=t.availableCount,l=e.class,u=r.classes[l],h=new U9({class:u,count:c,properties:e.properties,bufferViews:n});s.push(h)}}function Yee(e){let t=0;const n=e.lengthBits,i=e.availableCount;let o;o=i<256?new Uint8Array(n):i<65536?new Uint16Array(n):new Uint32Array(n);for(let r=0;r<e.lengthBits;r++)e.getBit(r)&&(o[r]=t,t++);return o}function Kee(e){const t=Yee(e._tileAvailability);e._tileJumpBuffer=t}function Xee(e){const t=e._contentJumpBuffers,n=e._contentAvailabilityBitstreams;for(let i=0;i<n.length;i++){const e=n[i],o=Yee(e);t.push(o)}}function Qee(e,t){if(!C(e._tileMetadataTable))return;const n=e.getTileIndex(t);return e._tileAvailability.getBit(n)?e._tileJumpBuffer[n]:void 0}function Jee(e,t,n){const i=e._contentMetadataTables;if(!C(i))return;const o=i[n];if(!C(o))return;const r=e._contentAvailabilityBitstreams[n],s=e.getTileIndex(t);if(r.getBit(s)){const t=e._contentJumpBuffers[n];return t[s]}}Object.defineProperties(Lee.prototype,{readyPromise:{get:function(){return this._readyPromise.promise}},metadata:{get:function(){return this._metadata}},tileMetadataTable:{get:function(){return this._tileMetadataTable}},tilePropertyTableJson:{get:function(){return this._tilePropertyTableJson}},contentMetadataTables:{get:function(){return this._contentMetadataTables}},contentPropertyTableJsons:{get:function(){return this._contentPropertyTableJsons}},implicitCoordinates:{get:function(){return this._implicitCoordinates}}}),Lee.prototype.tileIsAvailableAtIndex=function(e){return this._tileAvailability.getBit(e)},Lee.prototype.tileIsAvailableAtCoordinates=function(e){const t=this.getTileIndex(e);return this.tileIsAvailableAtIndex(t)},Lee.prototype.contentIsAvailableAtIndex=function(e,t){if(t=R(t,0),t<0||t>=this._contentAvailabilityBitstreams.length)throw new x("contentIndex out of bounds.");return this._contentAvailabilityBitstreams[t].getBit(e)},Lee.prototype.contentIsAvailableAtCoordinates=function(e,t){const n=this.getTileIndex(e);return this.contentIsAvailableAtIndex(n,t)},Lee.prototype.childSubtreeIsAvailableAtIndex=function(e){return this._childSubtreeAvailability.getBit(e)},Lee.prototype.childSubtreeIsAvailableAtCoordinates=function(e){const t=this.getChildSubtreeIndex(e);return this.childSubtreeIsAvailableAtIndex(t)},Lee.prototype.getLevelOffset=function(e){const t=this._branchingFactor;return(Math.pow(t,e)-1)/(t-1)},Lee.prototype.getParentMortonIndex=function(e){let t=2;return this._subdivisionScheme===G8.OCTREE&&(t=3),e>>t},Lee.prototype.getTileIndex=function(e){const t=e.level-this._implicitCoordinates.level;if(t<0||this._subtreeLevels<=t)throw new Je("level is out of bounds for this subtree");const n=e.getSubtreeCoordinates(),i=n.getOffsetCoordinates(e),o=i.tileIndex;return o},Lee.prototype.getChildSubtreeIndex=function(e){const t=e.level-this._implicitCoordinates.level;if(t!==this._implicitCoordinates.subtreeLevels)throw new Je("level is out of bounds for this subtree");const n=e.getParentSubtreeCoordinates(),i=n.getOffsetCoordinates(e),o=i.mortonIndex;return o},Lee.prototype.getTileMetadataView=function(e){const t=Qee(this,e);if(!C(t))return;const n=this._tileMetadataTable;return new V8({class:n.class,metadataTable:n,entityId:t,propertyTableJson:this._tilePropertyTableJson})},Lee.prototype.getContentMetadataView=function(e,t){const n=Jee(this,e,t);if(!C(n))return;const i=this._contentMetadataTables[t],o=this._contentPropertyTableJsons[t];return new V8({class:i.class,metadataTable:i,entityId:n,contentIndex:t,propertyTableJson:o})},Lee.prototype.isDestroyed=function(){return!1},Lee.prototype.destroy=function(){return C(this._bufferLoader)&&Ree.unload(this._bufferLoader),Qh(this)};const Zee={ID:"ID",NAME:"NAME",DESCRIPTION:"DESCRIPTION",TILE_BOUNDING_BOX:"TILE_BOUNDING_BOX",TILE_BOUNDING_REGION:"TILE_BOUNDING_REGION",TILE_BOUNDING_SPHERE:"TILE_BOUNDING_SPHERE",TILE_MINIMUM_HEIGHT:"TILE_MINIMUM_HEIGHT",TILE_MAXIMUM_HEIGHT:"TILE_MAXIMUM_HEIGHT",TILE_HORIZON_OCCLUSION_POINT:"TILE_HORIZON_OCCLUSION_POINT",TILE_GEOMETRIC_ERROR:"TILE_GEOMETRIC_ERROR",CONTENT_BOUNDING_BOX:"CONTENT_BOUNDING_BOX",CONTENT_BOUNDING_REGION:"CONTENT_BOUNDING_REGION",CONTENT_BOUNDING_SPHERE:"CONTENT_BOUNDING_SPHERE",CONTENT_MINIMUM_HEIGHT:"CONTENT_MINIMUM_HEIGHT",CONTENT_MAXIMUM_HEIGHT:"CONTENT_MAXIMUM_HEIGHT",CONTENT_HORIZON_OCCLUSION_POINT:"CONTENT_HORIZON_OCCLUSION_POINT"};var $ee=Object.freeze(Zee);function ete(e){return D.typeOf.object("tileMetadata",e),{tile:{boundingVolume:tte("TILE",e),minimumHeight:nte("TILE",e),maximumHeight:ite("TILE",e)},content:{boundingVolume:tte("CONTENT",e),minimumHeight:nte("CONTENT",e),maximumHeight:ite("CONTENT",e)}}}function tte(e,t){const n=`${e}_BOUNDING_BOX`,i=t.getPropertyBySemantic(n);if(C(i))return{box:i};const o=`${e}_BOUNDING_REGION`,r=t.getPropertyBySemantic(o);if(C(r))return{region:r};const s=`${e}_BOUNDING_SPHERE`,a=t.getPropertyBySemantic(s);return C(a)?{sphere:a}:void 0}function nte(e,t){const n=`${e}_MINIMUM_HEIGHT`;return t.getPropertyBySemantic(n)}function ite(e,t){const n=`${e}_MAXIMUM_HEIGHT`;return t.getPropertyBySemantic(n)}function ote(e,t,n,i,o,r){if(D.defined("tile.implicitTileset",t.implicitTileset),D.defined("tile.implicitCoordinates",t.implicitCoordinates),C(i)===C(o))throw new x("One of json and arrayBuffer must be defined.");const s=t.implicitTileset,a=t.implicitCoordinates;this._implicitTileset=s,this._implicitCoordinates=a,this._implicitSubtree=void 0,this._tileset=e,this._tile=t,this._resource=n,this._readyPromise=yn(),this._metadata=void 0,this.featurePropertiesDirty=!1,this._group=void 0;const c=a.getTemplateValues(),l=s.subtreeUriTemplate.getDerivedResource({templateValues:c});this._url=l.getUrlComponent(!0),rte(this,i,o,r)}function rte(e,t,n,i){let o;i=R(i,0),C(n)&&(o=new Uint8Array(n,i));const r=new Lee(e._resource,t,o,e._implicitTileset,e._implicitCoordinates);e._implicitSubtree=r,r.readyPromise.then((function(){ste(e,r),e._readyPromise.resolve()})).catch((function(t){e._readyPromise.reject(t)}))}function ste(e,t){const n=e._tile,i=e._implicitCoordinates.childIndex,o=cte(e,t,n,i);n.children.push(o.rootTile);const r=ate(e,t,o.bottomRow);for(let s=0;s<r.length;s++){const t=r[s],n=t.tile,i=xte(e,n,t.childIndex);n.children.push(i)}}function ate(e,t,n){const i=[],o=e._implicitTileset.branchingFactor;for(let r=0;r<n.length;r++){const e=n[r];if(C(e))for(let n=0;n<o;n++){const s=r*o+n;t.childSubtreeIsAvailableAtIndex(s)&&i.push({tile:e,childIndex:n})}}return i}function cte(e,t,n,i){const o=0,r=!0,s=ute(e,t,n,i,o,r);let a=[s],c=[];const l=e._implicitTileset;for(let u=1;u<l.subtreeLevels;u++){const n=t.getLevelOffset(u),i=l.branchingFactor*a.length;for(let o=0;o<i;o++){const i=n+o;if(!t.tileIsAvailableAtIndex(i)){c.push(void 0);continue}const r=t.getParentMortonIndex(o),s=a[r],u=o%l.branchingFactor,h=ute(e,t,s,u,i);s.children.push(h),c.push(h)}a=c,c=[]}return{rootTile:s,bottomRow:a}}function lte(e,t,n){const i=$ee.TILE_GEOMETRIC_ERROR;return C(e)&&e.hasPropertyBySemantic(i)?e.getPropertyBySemantic(i):t.geometricError/Math.pow(2,n.level)}function ute(e,t,n,i,o,r){const s=e._implicitTileset;let a,c,l,u;if(a=R(r,!1)?n.implicitCoordinates:n.implicitCoordinates.getChildCoordinates(i),C(t.tilePropertyTableJson)){c=t.getTileMetadataView(a);const e=ete(c);l=e.tile,u=e.content}const h=t.contentPropertyTableJsons,d=h.length;let f=!1;for(let w=0;w<d;w++)if(t.contentIsAvailableAtCoordinates(a,w)){f=!0;break}const p=mte(s,a,i,r,n,l),m=[];for(let w=0;w<s.contentCount;w++){if(!t.contentIsAvailableAtIndex(o,w))continue;const e=s.contentUriTemplates[w],n=e.getDerivedResource({templateValues:a.getTemplateValues()}).url,i={uri:n},r=_te(p,u);C(r)&&(i.boundingVolume=r),m.push(_n(i,s.contentHeaders[w]))}const _=lte(c,s,a),g={boundingVolume:p,geometricError:_,refine:s.refine,contents:m},y=!0,v=pn(s.tileHeader,y);delete v.boundingVolume,delete v.transform;const b=_n(g,v,y),A=Ste(e,s.baseResource,b,n);return A.implicitCoordinates=a,A.implicitSubtree=t,A.metadata=c,A.hasImplicitContentMetadata=f,A}function hte(e,t){return C(e)&&C(t)&&(C(t.minimumHeight)||C(t.maximumHeight))&&(z8(e,"3DTILES_bounding_volume_S2")||C(e.region))}function dte(e,t){C(t)&&(z8(e,"3DTILES_bounding_volume_S2")?pte(e.extensions["3DTILES_bounding_volume_S2"],t.minimumHeight,t.maximumHeight):C(e.region)&&fte(e.region,t.minimumHeight,t.maximumHeight))}function fte(e,t,n){C(t)&&(e[4]=t),C(n)&&(e[5]=n)}function pte(e,t,n){C(t)&&(e.minimumHeight=t),C(n)&&(e.maximumHeight=n)}function mte(e,t,n,i,o,r){let s;return s=!C(r)||!C(r.boundingVolume)||!hte(r.boundingVolume,r)&&hte(e.boundingVolume,r)?gte(e,t,n,R(i,!1),o):r.boundingVolume,dte(s,r),s}function _te(e,t){let n;return C(t)&&(n=t.boundingVolume),hte(n,t)?dte(n,t):hte(e,t)&&(n=pn(e,!0),dte(n,t)),n}function gte(e,t,n,i,o){const r=e.boundingVolume;if(z8(r,"3DTILES_bounding_volume_S2"))return yte(i,o,n,t.level,t.x,t.y,t.z);if(C(r.region)){const e=Ete(r.region,t.level,t.x,t.y,t.z);return{region:e}}const s=Tte(r.box,t.level,t.x,t.y,t.z);return{box:s}}function yte(e,t,n,i,o,r,s){D.typeOf.bool("parentIsPlaceholderTile",e),D.typeOf.object("parentTile",t),D.typeOf.number("childIndex",n),D.typeOf.number("level",i),D.typeOf.number("x",o),D.typeOf.number("y",r),C(s)&&D.typeOf.number("z",s);const a=t._boundingVolume;if(e)return{extensions:{"3DTILES_bounding_volume_S2":{token:XL.getTokenFromId(a.s2Cell._cellId),minimumHeight:a.minimumHeight,maximumHeight:a.maximumHeight}}};const c=Number(t._boundingVolume.s2Cell._cellId>>BigInt(61)),l=c%2===0?vI.encode2D(i,o,r):vI.encode2D(i,r,o),u=XL.fromFacePositionLevel(c,BigInt(l),i);let h,d;if(C(s)){const e=(a.maximumHeight+a.minimumHeight)/2;h=n<4?a.minimumHeight:e,d=n<4?e:a.maximumHeight}else h=a.minimumHeight,d=a.maximumHeight;return{extensions:{"3DTILES_bounding_volume_S2":{token:XL.getTokenFromId(u._cellId),minimumHeight:h,maximumHeight:d}}}}Object.defineProperties(ote.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._url}},metadata:{get:function(){},set:function(){throw new x("Implicit3DTileContent cannot have metadata")}},batchTable:{get:function(){}},group:{get:function(){return this._group},set:function(e){this._group=e}}});const vte=new K,bte=new K,Ate=new K,wte=new ke;function Tte(e,t,n,i,o){if(D.typeOf.object("rootBox",e),D.typeOf.number("level",t),D.typeOf.number("x",n),D.typeOf.number("y",i),C(o)&&D.typeOf.number("z",o),0===t)return e;const r=K.unpack(e,0,bte),s=ke.unpack(e,3,wte),a=Math.pow(2,-t),c=(2*n+1)*a-1,l=(2*i+1)*a-1;let u=0;const h=K.fromElements(a,a,1,vte);C(o)&&(u=(2*o+1)*a-1,h.z=a);let d=K.fromElements(c,l,u,Ate);d=ke.multiplyByVector(s,d,Ate),d=K.add(d,r,Ate);let f=ke.clone(s);f=ke.multiplyByScale(f,h,f);const p=new Array(12);return K.pack(d,p),ke.pack(f,p,3),p}const Cte=new _t;function Ete(e,t,n,i,o){if(D.typeOf.object("rootRegion",e),D.typeOf.number("level",t),D.typeOf.number("x",n),D.typeOf.number("y",i),C(o)&&D.typeOf.number("z",o),0===t)return e.slice();const r=_t.unpack(e,0,Cte),s=e[4],a=e[5],c=Math.pow(2,-t),l=c*r.width,u=z.negativePiToPi(r.west+n*l),h=z.negativePiToPi(u+l),d=c*r.height,f=z.negativePiToPi(r.south+i*d),p=z.negativePiToPi(f+d);let m=s,_=a;if(C(o)){const e=c*(a-s);m+=o*e,_=m+e}return[u,f,h,p,m,_]}function xte(e,t,n){const i=e._implicitTileset,o=t.implicitCoordinates.getChildCoordinates(n),r=gte(i,o,n,!1,t),s=lte(void 0,i,o),a=i.subtreeUriTemplate.getDerivedResource({templateValues:o.getTemplateValues()}).url,c={boundingVolume:r,geometricError:s,refine:i.refine,contents:[{uri:a}]},l=Ste(e,i.baseResource,c,t);return l.implicitTileset=i,l.implicitCoordinates=o,l}function Ste(e,t,n,i){const o=e._tile.constructor;return new o(e._tileset,t,n,i)}ote.prototype.hasProperty=function(e,t){return!1},ote.prototype.getFeature=function(e){},ote.prototype.applyDebugSettings=function(e,t){},ote.prototype.applyStyle=function(e){},ote.prototype.update=function(e,t){},ote.prototype.isDestroyed=function(){return!1},ote.prototype.destroy=function(){return this._implicitSubtree=this._implicitSubtree&&this._implicitSubtree.destroy(),Qh(this)},ote._deriveBoundingBox=Tte,ote._deriveBoundingRegion=Ete,ote._deriveBoundingVolumeS2=yte;const Ite={};Ite._deprecationWarning=UF;const Ote=Uint32Array.BYTES_PER_ELEMENT;Ite.parse=function(e,t){D.defined("arrayBuffer",e);const n=R(t,0);t=n;const i=new Uint8Array(e),o=new DataView(e);t+=Ote;const r=o.getUint32(t,!0);if(1!==r)throw new Je(`Only Instanced 3D Model version 1 is supported. Version ${r} is not.`);t+=Ote;const s=o.getUint32(t,!0);t+=Ote;const a=o.getUint32(t,!0);if(0===a)throw new Je("featureTableJsonByteLength is zero, the feature table must be defined.");t+=Ote;const c=o.getUint32(t,!0);t+=Ote;const l=o.getUint32(t,!0);t+=Ote;const u=o.getUint32(t,!0);t+=Ote;const h=o.getUint32(t,!0);if(1!==h&&0!==h)throw new Je(`Only glTF format 0 (uri) or 1 (embedded) are supported. Format ${h} is not.`);t+=Ote;const d=Fp(i,t,a);t+=a;const f=new Uint8Array(e,t,c);let p,m;t+=c,l>0&&(p=Fp(i,t,l),t+=l,u>0&&(m=new Uint8Array(e,t,u),m=new Uint8Array(m),t+=u));const _=n+s-t;if(0===_)throw new Je("glTF byte length must be greater than 0.");let g;return t%4===0?g=new Uint8Array(e,t,_):(Ite._deprecationWarning("i3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),g=new Uint8Array(i.subarray(t,t+_))),{gltfFormat:h,featureTableJson:d,featureTableBinary:f,batchTableJson:p,batchTableBinary:m,gltf:g}};var Dte=Ite;function Pte(e,t,n){this.primitive=e,this._modelMatrix=ft.clone(t),this._instanceId=n}Object.defineProperties(Pte.prototype,{instanceId:{get:function(){return this._instanceId}},model:{get:function(){return this.primitive._model}},modelMatrix:{get:function(){return ft.clone(this._modelMatrix)},set:function(e){ft.clone(e,this._modelMatrix),this.primitive.expandBoundingSphere(this._modelMatrix),this.primitive._dirty=!0}}});var Rte=Pte;const Lte={NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3};function Mte(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.gltf)&&!C(e.url))throw new x("Either options.gltf or options.url is required.");if(C(e.gltf)&&C(e.url))throw new x("Cannot pass in both options.gltf and options.url.");this.show=R(e.show,!0),this._instancingSupported=!1,this._dynamic=R(e.dynamic,!1),this._allowPicking=R(e.allowPicking,!0),this._ready=!1,this._readyPromise=yn(),this._state=Lte.NEEDS_LOAD,this._dirty=!1,this._cull=R(e.cull,!0),this._opaquePass=R(e.opaquePass,HU.OPAQUE),this._instances=Bte(this,e.instances),this._batchTable=e.batchTable,this._model=void 0,this._vertexBufferTypedArray=void 0,this._vertexBuffer=void 0,this._batchIdBuffer=void 0,this._instancedUniformsByProgram=void 0,this._drawCommands=[],this._modelCommands=void 0,this._renderStates=void 0,this._disableCullingRenderStates=void 0,this._boundingSphere=Nte(this),this._center=K.clone(this._boundingSphere.center),this._rtcTransform=new ft,this._rtcModelView=new ft,this._mode=void 0,this.modelMatrix=ft.clone(ft.IDENTITY),this._modelMatrix=ft.clone(this.modelMatrix),this._url=Vi.createIfNeeded(e.url),this._requestType=e.requestType,this._gltf=e.gltf,this._basePath=Vi.createIfNeeded(e.basePath),this._asynchronous=e.asynchronous,this._incrementallyLoadTextures=e.incrementallyLoadTextures,this._upAxis=e.upAxis,this._forwardAxis=e.forwardAxis,this.shadows=R(e.shadows,rj.ENABLED),this._shadows=this.shadows,this._pickIdLoaded=e.pickIdLoaded,this.splitDirection=R(e.splitDirection,T4.NONE),this.debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=R(e.debugWireframe,!1),this._debugWireframe=!1,C(e.imageBasedLighting)?(this._imageBasedLighting=e.imageBasedLighting,this._shouldDestroyImageBasedLighting=!1):(this._imageBasedLighting=new ZQ({imageBasedLightingFactor:e.imageBasedLightingFactor,luminanceAtZenith:e.luminanceAtZenith,sphericalHarmonicCoefficients:e.sphericalHarmonicCoefficients,specularEnvironmentMaps:e.specularEnvironmentMaps}),this._shouldDestroyImageBasedLighting=!0),this.backFaceCulling=R(e.backFaceCulling,!0),this._backFaceCulling=this.backFaceCulling,this.showCreditsOnScreen=R(e.showCreditsOnScreen,!1)}function Bte(e,t){t=R(t,[]);const n=t.length,i=new Array(n);for(let o=0;o<n;++o){const n=t[o],r=n.modelMatrix,s=R(n.batchId,o);i[o]=new Rte(e,r,s)}return i}function Nte(e){const t=e.length,n=new Array(t);for(let i=0;i<t;++i)n[i]=ft.getTranslation(e._instances[i]._modelMatrix,new K);return nn.fromPoints(n)}Object.defineProperties(Mte.prototype,{allowPicking:{get:function(){return this._allowPicking}},length:{get:function(){return this._instances.length}},activeAnimations:{get:function(){return this._model.activeAnimations}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},imageBasedLighting:{get:function(){return this._imageBasedLighting},set:function(e){e!==this._imageBasedLighting&&(this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=e,this._shouldDestroyImageBasedLighting=!1)}},imageBasedLightingFactor:{get:function(){return this._imageBasedLighting.imageBasedLightingFactor},set:function(e){this._imageBasedLighting.imageBasedLightingFactor=e}},luminanceAtZenith:{get:function(){return this._imageBasedLighting.luminanceAtZenith},set:function(e){this._imageBasedLighting.luminanceAtZenith=e}},sphericalHarmonicCoefficients:{get:function(){return this._imageBasedLighting.sphericalHarmonicCoefficients},set:function(e){this._imageBasedLighting.sphericalHarmonicCoefficients=e}},specularEnvironmentMaps:{get:function(){return this._imageBasedLighting.specularEnvironmentMaps},set:function(e){this._imageBasedLighting.specularEnvironmentMaps=e}}});const Fte=new K,zte=new ft;function kte(e,t,n,i){return function(o,r){const s=o.semantic;if(C(s)&&e.indexOf(s)>-1){if(!(t.indexOf(s)>-1))throw new Je(`Shader program cannot be optimized for instancing. Uniform "${r}" in program "${n}" uses unsupported semantic "${s}"`);i[r]=s}}}function Ute(e,t){if(C(e._instancedUniformsByProgram))return e._instancedUniformsByProgram[t];const n={};e._instancedUniformsByProgram=n;const i=["MODEL","MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELINVERSE","MODELVIEWINVERSE","MODELVIEWPROJECTIONINVERSE","MODELINVERSETRANSPOSE","MODELVIEWINVERSETRANSPOSE"],o=["MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELVIEWINVERSETRANSPOSE"],r=e._model._sourceTechniques;for(const s in r)if(r.hasOwnProperty(s)){const e=r[s],a=e.program;if(!C(n[a])){const r={};n[a]=r,AZ.techniqueUniform(e,kte(i,o,t,r))}}return n[t]}function Vte(e){return function(t,n){const i=Ute(e,n),o=C(e._batchTable);let r=tq.replaceMain(t,"czm_instancing_main"),s="",a="";for(const e in i)if(i.hasOwnProperty(e)){const t=i[e];let n;"MODELVIEW"===t||"CESIUM_RTC_MODELVIEW"===t?n="czm_instanced_modelView":"MODELVIEWPROJECTION"===t?(n="czm_instanced_modelViewProjection",s+="mat4 czm_instanced_modelViewProjection;\n",a+="czm_instanced_modelViewProjection = czm_projection * czm_instanced_modelView;\n"):"MODELVIEWINVERSETRANSPOSE"===t&&(n="czm_instanced_modelViewInverseTranspose",s+="mat3 czm_instanced_modelViewInverseTranspose;\n",a+="czm_instanced_modelViewInverseTranspose = mat3(czm_instanced_modelView);\n");let o=new RegExp(`uniform.*${e}.*`);r=r.replace(o,""),o=new RegExp(`${e}\\b`,"g"),r=r.replace(o,n)}const c="uniform mat4 czm_instanced_modifiedModelView;\nuniform mat4 czm_instanced_nodeTransform;\n";let l,u,h;o?(l="attribute float a_batchId;\n",u="",h=""):(l="",u="attribute vec4 pickColor;\nvarying vec4 v_pickColor;\n",h="    v_pickColor = pickColor;\n");let d=`${c+s}mat4 czm_instanced_modelView;\nattribute vec4 czm_modelMatrixRow0;\nattribute vec4 czm_modelMatrixRow1;\nattribute vec4 czm_modelMatrixRow2;\n${l}${u}${r}void main()\n{\n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0, czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0);\n    czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model * czm_instanced_nodeTransform;\n${a}    czm_instancing_main();\n${h}}\n`;if(o){const t=e._model.gltf,i=P0.getDiffuseAttributeOrUniform(t,n);d=e._batchTable.getVertexShaderCallback(!0,"a_batchId",i)(d)}return d}}function Hte(e){return function(t,n){const i=e._batchTable;if(C(i)){const o=e._model.gltf,r=P0.getDiffuseAttributeOrUniform(o,n);t=i.getFragmentShaderCallback(!0,r,!1)(t)}else t=`varying vec4 v_pickColor;\n${t}`;return t}}function Gte(e,t){return function(){return ft.multiply(t.uniformState.view,e._rtcTransform,e._rtcModelView)}}function Wte(e){return function(){return e.computedMatrix}}function qte(e,t){return function(n,i,o){n=pn(n),n.czm_instanced_modifiedModelView=Gte(e,t),n.czm_instanced_nodeTransform=Wte(o);const r=Ute(e,i);for(const e in r)r.hasOwnProperty(e)&&delete n[e];return C(e._batchTable)&&(n=e._batchTable.getUniformMapCallback()(n)),n}}function jte(e){return function(t,n){if(C(e._batchTable)){const i=e._model.gltf,o=P0.getDiffuseAttributeOrUniform(i,n);t=e._batchTable.getVertexShaderCallback(!0,"a_batchId",o)(t),t=`uniform float a_batchId\n;${t}`}return t}}function Yte(e){return function(t,n){const i=e._batchTable;if(C(i)){const o=e._model.gltf,r=P0.getDiffuseAttributeOrUniform(o,n);t=i.getFragmentShaderCallback(!0,r,!1)(t)}else t=`uniform vec4 czm_pickColor;\n${t}`;return t}}function Kte(e){return function(t){return C(e._batchTable)&&(t=e._batchTable.getUniformMapCallback()(t)),t}}function Xte(e){const t=e._instances,n=e.length,i=e._center,o=12;let r=e._vertexBufferTypedArray;C(r)||(r=new Float32Array(n*o)),e._dynamic&&(e._vertexBufferTypedArray=r);for(let s=0;s<n;++s){const e=t[s]._modelMatrix,n=ft.clone(e,zte);n[12]-=i.x,n[13]-=i.y,n[14]-=i.z;const a=s*o;r[a+0]=n[0],r[a+1]=n[4],r[a+2]=n[8],r[a+3]=n[12],r[a+4]=n[1],r[a+5]=n[5],r[a+6]=n[9],r[a+7]=n[13],r[a+8]=n[2],r[a+9]=n[6],r[a+10]=n[10],r[a+11]=n[14]}return r}function Qte(e,t){let n;const i=e._instances,o=e.length,r=e._dynamic,s=C(e._batchTable);if(s){const r=new Uint16Array(o);for(n=0;n<o;++n)r[n]=i[n]._instanceId;e._batchIdBuffer=hq.createVertexBuffer({context:t,typedArray:r,usage:lq.STATIC_DRAW})}if(!s){const i=new Uint8Array(4*o);for(n=0;n<o;++n){const t=e._pickIds[n],o=t.color,r=4*n;i[r]=xy.floatToByte(o.red),i[r+1]=xy.floatToByte(o.green),i[r+2]=xy.floatToByte(o.blue),i[r+3]=xy.floatToByte(o.alpha)}e._pickIdBuffer=hq.createVertexBuffer({context:t,typedArray:i,usage:lq.STATIC_DRAW})}const a=Xte(e);e._vertexBuffer=hq.createVertexBuffer({context:t,typedArray:a,usage:r?lq.STREAM_DRAW:lq.STATIC_DRAW})}function Jte(e){const t=Xte(e);e._vertexBuffer.copyFromArrayView(t)}function Zte(e,t){const n=e._instances,i=n.length,o=new Array(i);for(let r=0;r<i;++r)o[r]=t.createPickId(n[r]);return o}function $te(e,t){const n=e._instancingSupported,i=C(e._batchTable),o=e._allowPicking,r={url:e._url,requestType:e._requestType,gltf:e._gltf,basePath:e._basePath,shadows:e._shadows,cacheKey:void 0,asynchronous:e._asynchronous,allowPicking:o,incrementallyLoadTextures:e._incrementallyLoadTextures,upAxis:e._upAxis,forwardAxis:e._forwardAxis,precreatedAttributes:void 0,vertexShaderLoaded:void 0,fragmentShaderLoaded:void 0,uniformMapLoaded:void 0,pickIdLoaded:e._pickIdLoaded,ignoreCommands:!0,opaquePass:e._opaquePass,imageBasedLighting:e._imageBasedLighting,showOutline:e.showOutline,showCreditsOnScreen:e.showCreditsOnScreen};if(i||(e._pickIds=Zte(e,t)),n){Qte(e,t);const n=12,o=ih.getSizeInBytes(ih.FLOAT),s={czm_modelMatrixRow0:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:ih.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:o*n,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:ih.FLOAT,normalize:!1,offsetInBytes:4*o,strideInBytes:o*n,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:ih.FLOAT,normalize:!1,offsetInBytes:8*o,strideInBytes:o*n,instanceDivisor:1}};i&&(s.a_batchId={index:0,vertexBuffer:e._batchIdBuffer,componentsPerAttribute:1,componentDatatype:ih.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),i||(s.pickColor={index:0,vertexBuffer:e._pickIdBuffer,componentsPerAttribute:4,componentDatatype:ih.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),r.precreatedAttributes=s,r.vertexShaderLoaded=Vte(e),r.fragmentShaderLoaded=Hte(e),r.uniformMapLoaded=qte(e,t),C(e._url)&&(r.cacheKey=`${e._url.getUrlComponent()}#instanced`)}else r.vertexShaderLoaded=jte(e),r.fragmentShaderLoaded=Yte(e),r.uniformMapLoaded=Kte(e,t);C(e._url)?e._model=l8.fromGltf(r):e._model=new l8(r)}function ene(e,t){if(e._debugWireframe!==e.debugWireframe||t){e._debugWireframe=e.debugWireframe;const t=e.debugWireframe?xf.LINES:xf.TRIANGLES,n=e._drawCommands,i=n.length;for(let e=0;e<i;++e)n[e].primitiveType=t}}function tne(e){const t=pn(e,!0);return t.cull.enabled=!1,yV.fromCache(t)}function nne(e,t){if(e._backFaceCulling!==e.backFaceCulling||t){e._backFaceCulling=e.backFaceCulling;const t=e._drawCommands,n=t.length;let i;if(!C(e._disableCullingRenderStates))for(e._disableCullingRenderStates=new Array(n),e._renderStates=new Array(n),i=0;i<n;++i){const n=t[i].renderState,o=tne(n);e._disableCullingRenderStates[i]=o,e._renderStates[i]=n}for(i=0;i<n;++i)t[i].renderState=e._backFaceCulling?e._renderStates[i]:e._disableCullingRenderStates[i]}}function ine(e,t){if(e.debugShowBoundingVolume!==e._debugShowBoundingVolume||t){e._debugShowBoundingVolume=e.debugShowBoundingVolume;const t=e._drawCommands,n=t.length;for(let i=0;i<n;++i)t[i].debugShowBoundingVolume=e.debugShowBoundingVolume}}function one(e,t){const n=t.length,i=e.length,o=e._boundingSphere,r=e._cull;for(let s=0;s<n;++s){const n=UU.shallowClone(t[s]);n.instanceCount=i,n.boundingVolume=o,n.cull=r,C(e._batchTable)?n.pickId=e._batchTable.getPickId():n.pickId="v_pickColor",e._drawCommands.push(n)}}function rne(e){return function(){return e}}function sne(e){return function(){return e}}function ane(e,t){const n=e._instances,i=t.length,o=e.length,r=e._batchTable,s=C(r),a=e._cull;for(let c=0;c<i;++c)for(let i=0;i<o;++i){const o=UU.shallowClone(t[c]);if(o.modelMatrix=new ft,o.boundingVolume=new nn,o.cull=a,o.uniformMap=pn(o.uniformMap),s)o.uniformMap.a_batchId=rne(n[i]._instanceId);else{const t=e._pickIds[i];o.uniformMap.czm_pickColor=sne(t.color)}e._drawCommands.push(o)}}function cne(e){const t=e._modelCommands,n=t.length,i=e.length,o=e._rtcTransform,r=e._center;for(let s=0;s<n;++s){const n=t[s];for(let t=0;t<i;++t){const a=s*i+t,c=e._drawCommands[a];let l=ft.clone(e._instances[t]._modelMatrix,zte);l[12]-=r.x,l[13]-=r.y,l[14]-=r.z,l=ft.multiply(o,l,zte);const u=n.modelMatrix,h=c.modelMatrix;ft.multiply(l,u,h);const d=n.boundingVolume,f=c.boundingVolume;nn.transform(d,l,f)}}}function lne(e){const t=e._nodeCommands,n=t.length,i=[];for(let o=0;o<n;++o){const e=t[o];e.show&&i.push(e.command)}return i}function une(e){const t=e._nodeCommands,n=t.length;let i=!1;for(let o=0;o<n;o++){const e=t[o];e.command.dirty&&(e.command.dirty=!1,i=!0)}return i}function hne(e,t){e._drawCommands=[];const n=lne(e._model);t?one(e,n):(ane(e,n),cne(e))}function dne(e,t){if(e.shadows!==e._shadows||t){e._shadows=e.shadows;const t=rj.castShadows(e.shadows),n=rj.receiveShadows(e.shadows),i=e._drawCommands,o=i.length;for(let e=0;e<o;++e){const o=i[e];o.castShadows=t,o.receiveShadows=n}}}Mte.prototype.expandBoundingSphere=function(e){const t=ft.getTranslation(e,Fte);nn.expand(this._boundingSphere,t,this._boundingSphere)},Mte.prototype.update=function(e){if(e.mode===ij.MORPHING)return;if(!this.show)return;if(0===this.length)return;const t=e.context;if(this._state===Lte.NEEDS_LOAD){this._state=Lte.LOADING,this._instancingSupported=t.instancedArrays,$te(this,t);const e=this;this._model.readyPromise.catch((function(t){e._state=Lte.FAILED,e._readyPromise.reject(t)}))}const n=this._instancingSupported,i=this._model;if(i.imageBasedLighting=this._imageBasedLighting,i.showCreditsOnScreen=this.showCreditsOnScreen,i.splitDirection=this.splitDirection,i.update(e),i.ready&&this._state===Lte.LOADING){this._state=Lte.LOADED,this._ready=!0;const e=i.boundingSphere.radius+K.magnitude(i.boundingSphere.center);return this._boundingSphere.radius+=e,this._modelCommands=lne(i),hne(this,n),void this._readyPromise.resolve(this)}if(this._state!==Lte.LOADED)return;const o=e.mode!==this._mode,r=this.modelMatrix,s=!ft.equals(this._modelMatrix,r);if(o||s){this._mode=e.mode,ft.clone(r,this._modelMatrix);let t=ft.multiplyByTranslation(this._modelMatrix,this._center,this._rtcTransform);this._mode!==ij.SCENE3D&&(t=Kl.basisTo2D(e.mapProjection,t,t)),ft.getTranslation(t,this._boundingSphere.center)}n&&this._dirty&&(this._dynamic=!0,this._dirty=!1,Jte(this));const a=une(i);a&&hne(this,n),!n&&(i.dirty||this._dirty||o||s)&&cne(this),dne(this,a),ene(this,a),nne(this,a),ine(this,a);const c=e.passes;if(!c.render&&!c.pick)return;const l=e.commandList,u=this._drawCommands,h=u.length;for(let d=0;d<h;++d)l.push(u[d])},Mte.prototype.isDestroyed=function(){return!1},Mte.prototype.destroy=function(){this._model=this._model&&this._model.destroy();const e=this._pickIds;if(C(e)){const t=e.length;for(let n=0;n<t;++n)e[n].destroy()}return this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=void 0,Qh(this)};var fne=Mte;function pne(e,t,n,i,o){this._tileset=e,this._tile=t,this._resource=n,this._modelInstanceCollection=void 0,this._metadata=void 0,this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,this._group=void 0,yne(this,i,o)}function mne(e){return function(){return e._batchTable.getPickId()}}pne._deprecationWarning=UF,Object.defineProperties(pne.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){const e=this._modelInstanceCollection._model;return C(e)?e.trianglesLength:0}},geometryByteLength:{get:function(){const e=this._modelInstanceCollection._model;return C(e)?e.geometryByteLength:0}},texturesByteLength:{get:function(){const e=this._modelInstanceCollection._model;return C(e)?e.texturesByteLength:0}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._modelInstanceCollection.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},batchTable:{get:function(){return this._batchTable}},group:{get:function(){return this._group},set:function(e){this._group=e}}});const _ne=new Array(4),gne=new Array(4);function yne(e,t,n){const i=Dte.parse(t,n),o=i.gltfFormat,r=i.gltf,s=i.featureTableJson,a=i.featureTableBinary,c=i.batchTableJson,l=i.batchTableBinary,u=new mZ(s,a),h=u.getGlobalProperty("INSTANCES_LENGTH");if(u.featuresLength=h,!C(h))throw new Je("Feature table global property: INSTANCES_LENGTH must be defined");e._batchTable=new lZ(e,h,c,l);const d=e._tileset,f={instances:new Array(h),batchTable:e._batchTable,cull:!1,url:void 0,requestType:Wn.TILES3D,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,upAxis:d._gltfUpAxis,forwardAxis:iJ.X,opaquePass:HU.CESIUM_3D_TILE,pickIdLoaded:mne(e),imageBasedLighting:d.imageBasedLighting,specularEnvironmentMaps:d.specularEnvironmentMaps,backFaceCulling:d.backFaceCulling,showOutline:d.showOutline,showCreditsOnScreen:d.showCreditsOnScreen};if(0===o){let t=Bp(r);t=t.replace(/[\s\0]+$/,""),f.url=e._resource.getDerivedResource({url:t})}else f.gltf=r,f.basePath=e._resource.clone();const p=u.getGlobalProperty("EAST_NORTH_UP");let m;const _=u.getGlobalProperty("RTC_CENTER",ih.FLOAT,3);C(_)&&(m=K.unpack(_));const g=f.instances,y=new K,v=new Array(3),b=new K,A=new K,w=new K,T=new ke,E=new il;let x=new K;const S=new VN,I=new ft;for(let O=0;O<h;O++){let e=u.getProperty("POSITION",ih.FLOAT,3,O,_ne);if(!C(e)){e=v;const t=u.getProperty("POSITION_QUANTIZED",ih.UNSIGNED_SHORT,3,O,_ne);if(!C(t))throw new Je("Either POSITION or POSITION_QUANTIZED must be defined for each instance.");const n=u.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ih.FLOAT,3);if(!C(n))throw new Je("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const i=u.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ih.FLOAT,3);if(!C(i))throw new Je("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(let o=0;o<3;o++)e[o]=t[o]/65535*i[o]+n[o]}K.unpack(e,0,y),C(m)&&K.add(y,m,y),S.translation=y;const t=u.getProperty("NORMAL_UP",ih.FLOAT,3,O,_ne),n=u.getProperty("NORMAL_RIGHT",ih.FLOAT,3,O,gne);let i=!1;if(C(t)){if(!C(n))throw new Je("To define a custom orientation, both NORMAL_UP and NORMAL_RIGHT must be defined.");K.unpack(t,0,A),K.unpack(n,0,b),i=!0}else{const e=u.getProperty("NORMAL_UP_OCT32P",ih.UNSIGNED_SHORT,2,O,_ne),t=u.getProperty("NORMAL_RIGHT_OCT32P",ih.UNSIGNED_SHORT,2,O,gne);if(C(e)){if(!C(t))throw new Je("To define a custom orientation with oct-encoded vectors, both NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P must be defined.");wh.octDecodeInRange(e[0],e[1],65535,A),wh.octDecodeInRange(t[0],t[1],65535,b),i=!0}else p?(Kl.eastNorthUpToFixedFrame(y,ge.WGS84,I),ft.getMatrix3(I,T)):ke.clone(ke.IDENTITY,T)}i&&(K.cross(b,A,w),K.normalize(w,w),ke.setColumn(T,0,b,T),ke.setColumn(T,1,A,T),ke.setColumn(T,2,w,T)),il.fromRotationMatrix(T,E),S.rotation=E,x=K.fromElements(1,1,1,x);const o=u.getProperty("SCALE",ih.FLOAT,1,O);C(o)&&K.multiplyByScalar(x,o,x);const r=u.getProperty("SCALE_NON_UNIFORM",ih.FLOAT,3,O,_ne);C(r)&&(x.x*=r[0],x.y*=r[1],x.z*=r[2]),S.scale=x;let s=u.getProperty("BATCH_ID",ih.UNSIGNED_SHORT,1,O);C(s)||(s=O),ft.fromTranslationRotationScale(S,I);const a=I.clone();g[O]={modelMatrix:a,batchId:s}}e._modelInstanceCollection=new fne(f),e._modelInstanceCollection.readyPromise.catch((function(){})).then((function(t){e._modelInstanceCollection.ready&&t.activeAnimations.addAll({loop:Y3.REPEAT})}))}function vne(e){const t=e.featuresLength;if(!C(e._features)&&t>0){const n=new Array(t);for(let i=0;i<t;++i)n[i]=new hZ(e,i);e._features=n}}pne.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},pne.prototype.getFeature=function(e){const t=this.featuresLength;if(!C(e)||e<0||e>=t)throw new x(`batchId is required and between zero and featuresLength - 1 (${t-1}).`);return vne(this),this._features[e]},pne.prototype.applyDebugSettings=function(e,t){t=e?t:xy.WHITE,this._batchTable.setAllColor(t)},pne.prototype.applyStyle=function(e){this._batchTable.applyStyle(e)},pne.prototype.update=function(e,t){const n=t.commandList.length;this._batchTable.update(e,t),this._modelInstanceCollection.modelMatrix=this._tile.computedTransform,this._modelInstanceCollection.shadows=this._tileset.shadows,this._modelInstanceCollection.lightColor=this._tileset.lightColor,this._modelInstanceCollection.imageBasedLighting=this._tileset.imageBasedLighting,this._modelInstanceCollection.backFaceCulling=this._tileset.backFaceCulling,this._modelInstanceCollection.debugWireframe=this._tileset.debugWireframe,this._modelInstanceCollection.showCreditsOnScreen=this._tileset.showCreditsOnScreen,this._modelInstanceCollection.splitDirection=this._tileset.splitDirection;const i=this._modelInstanceCollection._model;if(C(i)){const e=this._tileset.clippingPlanes;i.referenceMatrix=this._tileset.clippingPlanesOriginMatrix,C(e)&&this._tile.clippingPlanesDirty&&(i._clippingPlanes=e.enabled&&this._tile._isClipped?e:void 0),C(e)&&C(i._clippingPlanes)&&i._clippingPlanes!==e&&(i._clippingPlanes=e)}this._modelInstanceCollection.update(t);const o=t.commandList.length;n<o&&(t.passes.render||t.passes.pick)&&this._batchTable.addDerivedCommands(t,n,!1)},pne.prototype.isDestroyed=function(){return!1},pne.prototype.destroy=function(){return this._modelInstanceCollection=this._modelInstanceCollection&&this._modelInstanceCollection.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Qh(this)};var bne=pne;const Ane={ADD:0,REPLACE:1};var wne=Object.freeze(Ane);const Tne={POSITION:"POSITION",NORMAL:"NORMAL",TANGENT:"TANGENT",TEXCOORD:"TEXCOORD",COLOR:"COLOR",JOINTS:"JOINTS",WEIGHTS:"WEIGHTS",FEATURE_ID:"_FEATURE_ID"};function Cne(e){switch(e){case Tne.POSITION:return"positionMC";case Tne.NORMAL:return"normalMC";case Tne.TANGENT:return"tangentMC";case Tne.TEXCOORD:return"texCoord";case Tne.COLOR:return"color";case Tne.JOINTS:return"joints";case Tne.WEIGHTS:return"weights";case Tne.FEATURE_ID:return"featureId";default:throw new x("semantic is not a valid value.")}}Tne.hasSetIndex=function(e){switch(D.typeOf.string("semantic",e),e){case Tne.POSITION:case Tne.NORMAL:case Tne.TANGENT:return!1;case Tne.TEXCOORD:case Tne.COLOR:case Tne.JOINTS:case Tne.WEIGHTS:case Tne.FEATURE_ID:return!0;default:throw new x("semantic is not a valid value.")}},Tne.fromGltfSemantic=function(e){D.typeOf.string("gltfSemantic",e);let t=e;const n=/^(\w+)_\d+$/,i=n.exec(e);switch(null!==i&&(t=i[1]),t){case"POSITION":return Tne.POSITION;case"NORMAL":return Tne.NORMAL;case"TANGENT":return Tne.TANGENT;case"TEXCOORD":return Tne.TEXCOORD;case"COLOR":return Tne.COLOR;case"JOINTS":return Tne.JOINTS;case"WEIGHTS":return Tne.WEIGHTS;case"_FEATURE_ID":return Tne.FEATURE_ID}},Tne.fromPntsSemantic=function(e){switch(D.typeOf.string("pntsSemantic",e),e){case"POSITION":case"POSITION_QUANTIZED":return Tne.POSITION;case"RGBA":case"RGB":case"RGB565":return Tne.COLOR;case"NORMAL":case"NORMAL_OCT16P":return Tne.NORMAL;case"BATCH_ID":return Tne.FEATURE_ID;default:throw new x("pntsSemantic is not a valid value.")}},Tne.getGlslType=function(e){switch(D.typeOf.string("semantic",e),e){case Tne.POSITION:case Tne.NORMAL:case Tne.TANGENT:return"vec3";case Tne.TEXCOORD:return"vec2";case Tne.COLOR:return"vec4";case Tne.JOINTS:return"ivec4";case Tne.WEIGHTS:return"vec4";case Tne.FEATURE_ID:return"int";default:throw new x("semantic is not a valid value.")}},Tne.getVariableName=function(e,t){D.typeOf.string("semantic",e);let n=Cne(e);return C(t)&&(n+=`_${t}`),n};var Ene=Object.freeze(Tne);const xne={},Sne=Uint32Array.BYTES_PER_ELEMENT;function Ine(e,t){const n=e.json;let i,o,r;const s=C(n.extensions)?n.extensions["3DTILES_draco_point_compression"]:void 0,a=C(t)&&C(t.extensions)?t.extensions["3DTILES_draco_point_compression"]:void 0;let c,l,u,h,d,f;if(C(a)&&(r=a.properties),C(s)){o=s.properties;const t=s.byteOffset,n=s.byteLength;if(!C(o)||!C(t)||!C(n))throw new Je("Draco properties, byteOffset, and byteLength must be defined");i=xF(e.buffer,t,t+n),c=C(o.POSITION),l=C(o.RGB)||C(o.RGBA),u=C(o.NORMAL),h=C(o.BATCH_ID),d=C(o.RGBA)}return C(i)&&(f={buffer:i,featureTableProperties:o,batchTableProperties:r,properties:_n(o,r),dequantizeInShader:!0}),{draco:f,hasPositions:c,hasColors:l,isTranslucent:d,hasNormals:u,hasBatchIds:h}}function One(e){const t=e.json;let n;if(C(t.POSITION))return n=e.getPropertyArray("POSITION",ih.FLOAT,3),{name:Ene.POSITION,semantic:Ene.POSITION,typedArray:n,isQuantized:!1,componentDatatype:ih.FLOAT,type:fh.VEC3};if(C(t.POSITION_QUANTIZED)){n=e.getPropertyArray("POSITION_QUANTIZED",ih.UNSIGNED_SHORT,3);const t=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ih.FLOAT,3);if(!C(t))throw new Je("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const i=65535,o=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ih.FLOAT,3);if(!C(o))throw new Je("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");return{name:Ene.POSITION,semantic:Ene.POSITION,typedArray:n,isQuantized:!0,componentDatatype:ih.FLOAT,type:fh.VEC3,quantizedRange:i,quantizedVolumeOffset:K.unpack(o),quantizedVolumeScale:K.unpack(t),quantizedComponentDatatype:ih.UNSIGNED_SHORT,quantizedType:fh.VEC3}}}function Dne(e){const t=e.json;let n;if(C(t.RGBA))return n=e.getPropertyArray("RGBA",ih.UNSIGNED_BYTE,4),{name:Ene.COLOR,semantic:Ene.COLOR,setIndex:0,typedArray:n,componentDatatype:ih.UNSIGNED_BYTE,type:fh.VEC4,normalized:!0,isRGB565:!1,isTranslucent:!0};if(C(t.RGB))return n=e.getPropertyArray("RGB",ih.UNSIGNED_BYTE,3),{name:"COLOR",semantic:Ene.COLOR,setIndex:0,typedArray:n,componentDatatype:ih.UNSIGNED_BYTE,type:fh.VEC3,normalized:!0,isRGB565:!1,isTranslucent:!1};if(C(t.RGB565))return n=e.getPropertyArray("RGB565",ih.UNSIGNED_SHORT,1),{name:"COLOR",semantic:Ene.COLOR,setIndex:0,typedArray:n,componentDatatype:ih.FLOAT,type:fh.VEC3,normalized:!1,isRGB565:!0,isTranslucent:!1};if(C(t.CONSTANT_RGBA)){const t=e.getGlobalProperty("CONSTANT_RGBA",ih.UNSIGNED_BYTE,4),n=t[3],i=xy.fromBytes(t[0],t[1],t[2],n),o=n<255;return{name:Ene.COLOR,semantic:Ene.COLOR,setIndex:0,constantColor:i,componentDatatype:ih.FLOAT,type:fh.VEC4,isQuantized:!1,isTranslucent:o}}}function Pne(e){const t=e.json;let n;if(C(t.NORMAL))return n=e.getPropertyArray("NORMAL",ih.FLOAT,3),{name:Ene.NORMAL,semantic:Ene.NORMAL,typedArray:n,octEncoded:!1,octEncodedZXY:!1,componentDatatype:ih.FLOAT,type:fh.VEC3};if(C(t.NORMAL_OCT16P)){n=e.getPropertyArray("NORMAL_OCT16P",ih.UNSIGNED_BYTE,2);const t=8;return{name:Ene.NORMAL,semantic:Ene.NORMAL,typedArray:n,octEncoded:!0,octEncodedZXY:!1,quantizedRange:(1<<t)-1,quantizedType:fh.VEC2,quantizedComponentDatatype:ih.UNSIGNED_BYTE,componentDatatype:ih.FLOAT,type:fh.VEC3}}}function Rne(e){const t=e.json;if(C(t.BATCH_ID)){const t=e.getPropertyArray("BATCH_ID",ih.UNSIGNED_SHORT,1);return{name:Ene.FEATURE_ID,semantic:Ene.FEATURE_ID,setIndex:0,typedArray:t,componentDatatype:ih.fromTypedArray(t),type:fh.SCALAR}}}xne.parse=function(e,t){t=R(t,0),D.defined("arrayBuffer",e);const n=new Uint8Array(e),i=new DataView(e);t+=Sne;const o=i.getUint32(t,!0);if(1!==o)throw new Je(`Only Point Cloud tile version 1 is supported.  Version ${o} is not.`);t+=Sne,t+=Sne;const r=i.getUint32(t,!0);if(0===r)throw new Je("Feature table must have a byte length greater than zero");t+=Sne;const s=i.getUint32(t,!0);t+=Sne;const a=i.getUint32(t,!0);t+=Sne;const c=i.getUint32(t,!0);t+=Sne;const l=Fp(n,t,r);t+=r;const u=new Uint8Array(e,t,s);let h,d;t+=s,a>0&&(h=Fp(n,t,a),t+=a,c>0&&(d=new Uint8Array(e,t,c),t+=c));const f=new mZ(l,u),p=f.getGlobalProperty("POINTS_LENGTH");if(f.featuresLength=p,!C(p))throw new Je("Feature table global property: POINTS_LENGTH must be defined");let m=f.getGlobalProperty("RTC_CENTER",ih.FLOAT,3);C(m)&&(m=K.unpack(m));const _=Ine(f,h);if(_.rtcCenter=m,_.pointsLength=p,!_.hasPositions){const e=One(f);_.positions=e,_.hasPositions=_.hasPositions||C(e)}if(!_.hasPositions)throw new Je("Either POSITION or POSITION_QUANTIZED must be defined.");if(!_.hasNormals){const e=Pne(f);_.normals=e,_.hasNormals=_.hasNormals||C(e)}if(!_.hasColors){const e=Dne(f);_.colors=e,_.hasColors=_.hasColors||C(e),_.hasConstantColor=C(_.constantColor),_.isTranslucent=C(e)&&e.isTranslucent}if(!_.hasBatchIds){const e=Rne(f);_.batchIds=e,_.hasBatchIds=_.hasBatchIds||C(e)}if(_.hasBatchIds){const e=f.getGlobalProperty("BATCH_LENGTH");if(!C(e))throw new Je("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");_.batchLength=e}return C(d)&&(d=new Uint8Array(d),_.batchTableJson=h,_.batchTableBinary=d),_};var Lne=xne;const Mne={NEEDS_DECODE:0,DECODING:1,READY:2,FAILED:3};function Bne(e){D.typeOf.object("options",e),D.typeOf.object("options.arrayBuffer",e.arrayBuffer),this._parsedContent=void 0,this._drawCommand=void 0,this._isTranslucent=!1,this._styleTranslucent=!1,this._constantColor=xy.clone(xy.DARKGRAY),this._highlightColor=xy.clone(xy.WHITE),this._pointSize=1,this._rtcCenter=void 0,this._quantizedVolumeScale=void 0,this._quantizedVolumeOffset=void 0,this._styleableShaderAttributes=void 0,this._isQuantized=!1,this._isOctEncoded16P=!1,this._isRGB565=!1,this._hasColors=!1,this._hasNormals=!1,this._hasBatchIds=!1,this._decodingState=Mne.READY,this._dequantizeInShader=!0,this._isQuantizedDraco=!1,this._isOctEncodedDraco=!1,this._quantizedRange=0,this._octEncodedRange=0,this.backFaceCulling=!1,this._backFaceCulling=!1,this.normalShading=!0,this._normalShading=!0,this._opaqueRenderState=void 0,this._translucentRenderState=void 0,this._mode=void 0,this._ready=!1,this._readyPromise=yn(),this._pointsLength=0,this._geometryByteLength=0,this._vertexShaderLoaded=e.vertexShaderLoaded,this._fragmentShaderLoaded=e.fragmentShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._batchTableLoaded=e.batchTableLoaded,this._pickIdLoaded=e.pickIdLoaded,this._opaquePass=R(e.opaquePass,HU.OPAQUE),this._cull=R(e.cull,!0),this.style=void 0,this._style=void 0,this.styleDirty=!1,this.modelMatrix=ft.clone(ft.IDENTITY),this._modelMatrix=ft.clone(ft.IDENTITY),this.time=0,this.shadows=rj.ENABLED,this._boundingSphere=void 0,this.clippingPlanes=void 0,this.isClipped=!1,this.clippingPlanesDirty=!1,this.clippingPlanesOriginMatrix=void 0,this.attenuation=!1,this._attenuation=!1,this.geometricError=0,this.geometricErrorScale=1,this.maximumAttenuation=this._pointSize,this.splitDirection=R(e.splitDirection,T4.NONE),this._splittingEnabled=!1,Nne(this,e)}function Nne(e,t){const n=Lne.parse(t.arrayBuffer,t.byteOffset);if(e._parsedContent=n,e._rtcCenter=n.rtcCenter,e._hasNormals=n.hasNormals,e._hasColors=n.hasColors,e._hasBatchIds=n.hasBatchIds,e._isTranslucent=n.isTranslucent,!n.hasBatchIds&&C(n.batchTableBinary)&&(n.styleableProperties=lZ.getBinaryProperties(n.pointsLength,n.batchTableJson,n.batchTableBinary)),C(n.draco)){const t=n.draco;e._decodingState=Mne.NEEDS_DECODE,t.dequantizeInShader=e._dequantizeInShader}const i=n.positions;C(i)&&(e._isQuantized=i.isQuantized,e._quantizedVolumeScale=i.quantizedVolumeScale,e._quantizedVolumeOffset=i.quantizedVolumeOffset,e._quantizedRange=i.quantizedRange);const o=n.normals;C(o)&&(e._isOctEncoded16P=o.octEncoded);const r=n.colors;C(r)&&(C(r.constantColor)&&(e._constantColor=xy.clone(r.constantColor,e._constantColor),e._hasColors=!1),e._isRGB565=r.isRGB565);const s=n.batchIds;C(n.batchIds)&&(s.name="BATCH_ID",s.semantic="BATCH_ID",s.setIndex=void 0),n.hasBatchIds&&e._batchTableLoaded(n.batchLength,n.batchTableJson,n.batchTableBinary),e._pointsLength=n.pointsLength}Object.defineProperties(Bne.prototype,{pointsLength:{get:function(){return this._pointsLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},color:{get:function(){return xy.clone(this._highlightColor)},set:function(e){this._highlightColor=xy.clone(e,this._highlightColor)}},boundingSphere:{get:function(){if(C(this._drawCommand))return this._drawCommand.boundingVolume},set:function(e){this._boundingSphere=nn.clone(e,this._boundingSphere)}}});const Fne=new K,zne=new K,kne=new K;let Une,Vne;function Hne(e){if(!C(Vne)){Une=new M(0),Vne=new Array(e);for(let t=0;t<e;++t)Vne[t]=Une.random()}return Vne}function Gne(e){const t=20,n=e.length/3,i=Math.min(n,t),o=Hne(t),r=Number.MAX_VALUE,s=-Number.MAX_VALUE,a=K.fromElements(r,r,r,Fne),c=K.fromElements(s,s,s,zne);for(let u=0;u<i;++u){const t=Math.floor(o[u]*n),i=K.unpack(e,3*t,kne);K.minimumByComponent(a,i,a),K.maximumByComponent(c,i,c)}const l=nn.fromCornerPoints(a,c);return l.radius+=z.EPSILON2,l}function Wne(e,t){const n=ih.fromTypedArray(e);return n===ih.INT||n===ih.UNSIGNED_INT||n===ih.DOUBLE?(CA("Cast pnts property to floats",`Point cloud property "${t}" will be casted to a float array because INT, UNSIGNED_INT, and DOUBLE are not valid WebGL vertex attribute types. Some precision may be lost.`),new Float32Array(e)):e}const qne=new Xe,jne=new Xe,Yne=new xy,Kne=0,Xne=1,Qne=2,Jne=3,Zne=4,$ne=new ft,eie=new ft;function tie(e,t){const n=t.context,i=e._parsedContent,o=e._pointsLength,r=i.positions,s=i.colors,a=i.normals;let c=i.batchIds;const l=i.styleableProperties,u=C(l),h=e._isQuantized,d=e._isQuantizedDraco,f=e._isOctEncoded16P,p=e._isOctEncodedDraco,m=e._quantizedRange,_=e._octEncodedRange,g=e._isRGB565,y=e._isTranslucent,v=e._hasColors,b=e._hasNormals,A=e._hasBatchIds;let w,T;const E=[],x={};if(e._styleableShaderAttributes=x,u){let t=Zne;for(const i in l)if(l.hasOwnProperty(i)){const o=l[i],r=Wne(o.typedArray,i);w=o.componentCount,T=ih.fromTypedArray(r);const s=hq.createVertexBuffer({context:n,typedArray:r,usage:lq.STATIC_DRAW});e._geometryByteLength+=s.sizeInBytes;const a={index:t,vertexBuffer:s,componentsPerAttribute:w,componentDatatype:T,normalize:!1,offsetInBytes:0,strideInBytes:0};E.push(a),x[i]={location:t,componentCount:w},++t}}const S=hq.createVertexBuffer({context:n,typedArray:r.typedArray,usage:lq.STATIC_DRAW});let I,O,D;e._geometryByteLength+=S.sizeInBytes,v&&(I=hq.createVertexBuffer({context:n,typedArray:s.typedArray,usage:lq.STATIC_DRAW}),e._geometryByteLength+=I.sizeInBytes),b&&(O=hq.createVertexBuffer({context:n,typedArray:a.typedArray,usage:lq.STATIC_DRAW}),e._geometryByteLength+=O.sizeInBytes),A&&(c=Wne(c,"batchIds"),D=hq.createVertexBuffer({context:n,typedArray:c.typedArray,usage:lq.STATIC_DRAW}),e._geometryByteLength+=D.sizeInBytes);let P=[];if(T=h?ih.UNSIGNED_SHORT:d?m<=255?ih.UNSIGNED_BYTE:ih.UNSIGNED_SHORT:ih.FLOAT,P.push({index:Kne,vertexBuffer:S,componentsPerAttribute:3,componentDatatype:T,normalize:!1,offsetInBytes:0,strideInBytes:0}),e._cull&&(e._boundingSphere=h||d?nn.fromCornerPoints(K.ZERO,e._quantizedVolumeScale):Gne(r.typedArray)),v)if(g)P.push({index:Xne,vertexBuffer:I,componentsPerAttribute:1,componentDatatype:ih.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0});else{const e=y?4:3;P.push({index:Xne,vertexBuffer:I,componentsPerAttribute:e,componentDatatype:ih.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0})}b&&(f?(w=2,T=ih.UNSIGNED_BYTE):p?(w=2,T=_<=255?ih.UNSIGNED_BYTE:ih.UNSIGNED_SHORT):(w=3,T=ih.FLOAT),P.push({index:Qne,vertexBuffer:O,componentsPerAttribute:w,componentDatatype:T,normalize:!1,offsetInBytes:0,strideInBytes:0})),A&&P.push({index:Jne,vertexBuffer:D,componentsPerAttribute:1,componentDatatype:ih.fromTypedArray(c.typedArray),normalize:!1,offsetInBytes:0,strideInBytes:0}),u&&(P=P.concat(E));const R=new bq({context:n,attributes:P}),L={depthTest:{enabled:!0}},M={depthTest:{enabled:!0},depthMask:!1,blending:_k.ALPHA_BLEND};e._opaquePass===HU.CESIUM_3D_TILE&&(L.stencilTest=FY.setCesium3DTileBit(),L.stencilMask=FY.CESIUM_3D_TILE_MASK,M.stencilTest=FY.setCesium3DTileBit(),M.stencilMask=FY.CESIUM_3D_TILE_MASK),e._opaqueRenderState=yV.fromCache(L),e._translucentRenderState=yV.fromCache(M),e._drawCommand=new UU({boundingVolume:new nn,cull:e._cull,modelMatrix:new ft,primitiveType:xf.POINTS,vertexArray:R,count:o,shaderProgram:void 0,uniformMap:void 0,renderState:y?e._translucentRenderState:e._opaqueRenderState,pass:y?HU.TRANSLUCENT:e._opaquePass,owner:e,castShadows:!1,receiveShadows:!1,pickId:e._pickIdLoaded()})}function nie(e,t){const n=t.context,i=e._isQuantized,o=e._isQuantizedDraco,r=e._isOctEncodedDraco;let s={u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier:function(){const i=qne;if(i.x=e._attenuation?e.maximumAttenuation:e._pointSize,i.x*=t.pixelRatio,i.y=e.time,e._attenuation){const o=t.camera.frustum;let r;r=t.mode===ij.SCENE2D||o instanceof jC?Number.POSITIVE_INFINITY:n.drawingBufferHeight/t.camera.frustum.sseDenominator,i.z=e.geometricError*e.geometricErrorScale,i.w=r}return i},u_highlightColor:function(){return e._highlightColor},u_constantColor:function(){return e._constantColor},u_clippingPlanes:function(){const t=e.clippingPlanes,i=e.isClipped;return i?t.texture:n.defaultTexture},u_clippingPlanesEdgeStyle:function(){const t=e.clippingPlanes;if(!C(t))return xy.TRANSPARENT;const n=xy.clone(t.edgeColor,Yne);return n.alpha=t.edgeWidth,n},u_clippingPlanesMatrix:function(){const t=e.clippingPlanes;if(!C(t))return ft.IDENTITY;const i=R(e.clippingPlanesOriginMatrix,e._modelMatrix);ft.multiply(n.uniformState.view3D,i,$ne);const o=ft.multiply($ne,t.modelMatrix,$ne);return ft.inverseTranspose(o,eie)}};E4.addUniforms(e,s),(i||o||r)&&(s=_n(s,{u_quantizedVolumeScaleAndOctEncodedRange:function(){const t=jne;if(C(e._quantizedVolumeScale)){const n=K.clone(e._quantizedVolumeScale,t);K.divideByScalar(n,e._quantizedRange,t)}return t.w=e._octEncodedRange,t}})),C(e._uniformMapLoaded)&&(s=e._uniformMapLoaded(s)),e._drawCommand.uniformMap=s}function iie(e,t){const n=/czm_3dtiles_property_(\d+)/g;let i=n.exec(e);while(null!==i){const o=parseInt(i[1]);-1===t.indexOf(o)&&t.push(o),i=n.exec(e)}}function oie(e,t){e=e.slice(e.indexOf("\n"));const n=/czm_3dtiles_builtin_property_(\w+)/g;let i=n.exec(e);while(null!==i){const o=i[1];-1===t.indexOf(o)&&t.push(o),i=n.exec(e)}}function rie(e,t){const n=e.numberOfAttributes;for(let i=0;i<n;++i){const n=e.getAttribute(i);if(n.index===t)return n}}const sie={POSITION:"czm_3dtiles_builtin_property_POSITION",POSITION_ABSOLUTE:"czm_3dtiles_builtin_property_POSITION_ABSOLUTE",COLOR:"czm_3dtiles_builtin_property_COLOR",NORMAL:"czm_3dtiles_builtin_property_NORMAL"};function aie(e,t,n){let i,o,r;const s=t.context,a=C(n),c=e._isQuantized,l=e._isQuantizedDraco,u=e._isOctEncoded16P,h=e._isOctEncodedDraco,d=e._isRGB565,f=e._isTranslucent,p=e._hasColors,m=e._hasNormals,_=e._hasBatchIds,g=e._backFaceCulling,y=e._normalShading,v=e._drawCommand.vertexArray,b=e.clippingPlanes,A=e._attenuation;let w,T,E,x=f;const S=pn(sie),I={},O=e._styleableShaderAttributes;for(o in O)O.hasOwnProperty(o)&&(r=O[o],S[o]=`czm_3dtiles_property_${r.location}`,I[r.location]=r);if(a){const e={translucent:!1},t="(vec3 czm_3dtiles_builtin_property_POSITION, vec3 czm_3dtiles_builtin_property_POSITION_ABSOLUTE, vec4 czm_3dtiles_builtin_property_COLOR, vec3 czm_3dtiles_builtin_property_NORMAL)";w=n.getColorShaderFunction(`getColorFromStyle${t}`,S,e),T=n.getShowShaderFunction(`getShowFromStyle${t}`,S,e),E=n.getPointSizeShaderFunction(`getPointSizeFromStyle${t}`,S,e),C(w)&&e.translucent&&(x=!0)}e._styleTranslucent=x;const D=C(w),P=C(T),R=C(E),L=e.isClipped,M=[],B=[];D&&(iie(w,M),oie(w,B)),P&&(iie(T,M),oie(T,B)),R&&(iie(E,M),oie(E,B));const N=B.indexOf("COLOR")>=0,F=B.indexOf("NORMAL")>=0;if(F&&!m)throw new Je("Style references the NORMAL semantic but the point cloud does not have normals");for(o in O)if(O.hasOwnProperty(o)){r=O[o];const e=M.indexOf(r.location)>=0,t=rie(v,r.location);t.enabled=e}const z=p&&(!D||N);if(p){const e=rie(v,Xne);e.enabled=z}const k=m&&(y||g||F);if(m){const e=rie(v,Qne);e.enabled=k}const U={a_position:Kne};z&&(U.a_color=Xne),k&&(U.a_normal=Qne),_&&(U.a_batchId=Jne);let V="";const H=M.length;for(i=0;i<H;++i){const e=M[i];r=I[e];const t=r.componentCount,n=`czm_3dtiles_property_${e}`;let o;o=1===t?"float":`vec${t}`,V+=`attribute ${o} ${n}; \n`,U[n]=r.location}nie(e,t);let G="attribute vec3 a_position; \nvarying vec4 v_color; \nuniform vec4 u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier; \nuniform vec4 u_constantColor; \nuniform vec4 u_highlightColor; \n";G+="float u_pointSize; \nfloat u_time; \n",A&&(G+="float u_geometricError; \nfloat u_depthMultiplier; \n"),G+=V,z&&(G+=f?"attribute vec4 a_color; \n":d?"attribute float a_color; \nconst float SHIFT_RIGHT_11 = 1.0 / 2048.0; \nconst float SHIFT_RIGHT_5 = 1.0 / 32.0; \nconst float SHIFT_LEFT_11 = 2048.0; \nconst float SHIFT_LEFT_5 = 32.0; \nconst float NORMALIZE_6 = 1.0 / 64.0; \nconst float NORMALIZE_5 = 1.0 / 32.0; \n":"attribute vec3 a_color; \n"),k&&(G+=u||h?"attribute vec2 a_normal; \n":"attribute vec3 a_normal; \n"),_&&(G+="attribute float a_batchId; \n"),(c||l||h)&&(G+="uniform vec4 u_quantizedVolumeScaleAndOctEncodedRange; \n"),D&&(G+=w),P&&(G+=T),R&&(G+=E),G+="void main() \n{ \n    u_pointSize = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.x; \n    u_time = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.y; \n",A&&(G+="    u_geometricError = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.z; \n    u_depthMultiplier = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.w; \n"),G+=z?f?"    vec4 color = a_color; \n":d?"    float compressed = a_color; \n    float r = floor(compressed * SHIFT_RIGHT_11); \n    compressed -= r * SHIFT_LEFT_11; \n    float g = floor(compressed * SHIFT_RIGHT_5); \n    compressed -= g * SHIFT_LEFT_5; \n    float b = compressed; \n    vec3 rgb = vec3(r * NORMALIZE_5, g * NORMALIZE_6, b * NORMALIZE_5); \n    vec4 color = vec4(rgb, 1.0); \n":"    vec4 color = vec4(a_color, 1.0); \n":"    vec4 color = u_constantColor; \n",G+=c||l?"    vec3 position = a_position * u_quantizedVolumeScaleAndOctEncodedRange.xyz; \n":"    vec3 position = a_position; \n",G+="    vec3 position_absolute = vec3(czm_model * vec4(position, 1.0)); \n",k?(G+=u?"    vec3 normal = czm_octDecode(a_normal); \n":h?"    vec3 normal = czm_octDecode(a_normal, u_quantizedVolumeScaleAndOctEncodedRange.w).zxy; \n":"    vec3 normal = a_normal; \n",G+="    vec3 normalEC = czm_normal * normal; \n"):G+="    vec3 normal = vec3(1.0); \n",D&&(G+="    color = getColorFromStyle(position, position_absolute, color, normal); \n"),P&&(G+="    float show = float(getShowFromStyle(position, position_absolute, color, normal)); \n"),G+=R?"    gl_PointSize = getPointSizeFromStyle(position, position_absolute, color, normal) * czm_pixelRatio; \n":A?"    vec4 positionEC = czm_modelView * vec4(position, 1.0); \n    float depth = -positionEC.z; \n    gl_PointSize = min((u_geometricError / depth) * u_depthMultiplier, u_pointSize); \n":"    gl_PointSize = u_pointSize; \n",G+="    color = color * u_highlightColor; \n",k&&y&&(G+="    float diffuseStrength = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC); \n    diffuseStrength = max(diffuseStrength, 0.4); \n    color.xyz *= diffuseStrength * czm_lightColor; \n"),G+="    v_color = color; \n    gl_Position = czm_modelViewProjection * vec4(position, 1.0); \n",k&&g&&(G+="    float visible = step(-normalEC.z, 0.0); \n    gl_Position *= visible; \n    gl_PointSize *= visible; \n"),P&&(G+="    gl_Position.w *= float(show); \n    gl_PointSize *= float(show); \n"),G+="} \n";let W="varying vec4 v_color; \n";L&&(W+="uniform highp sampler2D u_clippingPlanes; \nuniform mat4 u_clippingPlanesMatrix; \nuniform vec4 u_clippingPlanesEdgeStyle; \n",W+="\n",W+=L3(b,s),W+="\n"),W+="void main() \n{ \n    gl_FragColor = czm_gammaCorrect(v_color); \n",L&&(W+=x3("u_clippingPlanes","u_clippingPlanesMatrix","u_clippingPlanesEdgeStyle")),W+="} \n",e.splitDirection!==T4.NONE&&(W=E4.modifyFragmentShader(W)),C(e._vertexShaderLoaded)&&(G=e._vertexShaderLoaded(G)),C(e._fragmentShaderLoaded)&&(W=e._fragmentShaderLoaded(W));const q=e._drawCommand;C(q.shaderProgram)&&q.shaderProgram.destroy(),q.shaderProgram=fH.fromCache({context:s,vertexShaderSource:G,fragmentShaderSource:W,attributeLocations:U});try{q.shaderProgram._bind()}catch(j){throw new Je("Error generating style shader: this may be caused by a type mismatch, index out-of-bounds, or other syntax error.")}}function cie(e,t){if(e._decodingState===Mne.READY)return!1;if(e._decodingState===Mne.NEEDS_DECODE){const n=e._parsedContent,i=n.draco,o=C3.decodePointCloud(i,t);C(o)&&(e._decodingState=Mne.DECODING,o.then((function(t){e._decodingState=Mne.READY;const o=C(t.POSITION)?t.POSITION.array:void 0,r=C(t.RGB)?t.RGB.array:void 0,s=C(t.RGBA)?t.RGBA.array:void 0,a=C(t.NORMAL)?t.NORMAL.array:void 0,c=C(t.BATCH_ID)?t.BATCH_ID.array:void 0,l=C(o)&&C(t.POSITION.data.quantization),u=C(a)&&C(t.NORMAL.data.quantization);if(l){const n=t.POSITION.data.quantization,i=n.range;e._quantizedVolumeScale=K.fromElements(i,i,i),e._quantizedVolumeOffset=K.unpack(n.minValues),e._quantizedRange=(1<<n.quantizationBits)-1,e._isQuantizedDraco=!0}u&&(e._octEncodedRange=(1<<t.NORMAL.data.quantization.quantizationBits)-1,e._isOctEncodedDraco=!0);let h=n.styleableProperties;const d=i.batchTableProperties;for(const e in d)if(d.hasOwnProperty(e)){const n=t[e];C(h)||(h={}),h[e]={typedArray:n.array,componentCount:n.data.componentsPerAttribute}}C(o)&&(n.positions={typedArray:o});const f=R(s,r);C(f)&&(n.colors={typedArray:f}),C(a)&&(n.normals={typedArray:a}),C(c)&&(n.batchIds={typedArray:c}),n.styleableProperties=h})).catch((function(t){e._decodingState=Mne.FAILED,e._readyPromise.reject(t)})))}return!0}const lie=new Xe,uie=new K;Bne.prototype.update=function(e){const t=e.context,n=cie(this,t);if(n)return;let i=!1,o=!ft.equals(this._modelMatrix,this.modelMatrix);if(this._mode!==e.mode&&(this._mode=e.mode,o=!0),C(this._drawCommand)||(tie(this,e),o=!0,i=!0,this._ready=!0,this._readyPromise.resolve(this),this._parsedContent=void 0),o){ft.clone(this.modelMatrix,this._modelMatrix);const t=this._drawCommand.modelMatrix;if(ft.clone(this._modelMatrix,t),C(this._rtcCenter)&&ft.multiplyByTranslation(t,this._rtcCenter,t),C(this._quantizedVolumeOffset)&&ft.multiplyByTranslation(t,this._quantizedVolumeOffset,t),e.mode!==ij.SCENE3D){const n=e.mapProjection,i=ft.getColumn(t,3,lie);Xe.equals(i,Xe.UNIT_W)||Kl.basisTo2D(n,t,t)}const n=this._drawCommand.boundingVolume;if(nn.clone(this._boundingSphere,n),this._cull){const e=n.center;ft.multiplyByPoint(t,e,e);const i=ft.getScale(t,uie);n.radius*=K.maximumComponent(i)}}this.clippingPlanesDirty&&(this.clippingPlanesDirty=!1,i=!0),this._attenuation!==this.attenuation&&(this._attenuation=this.attenuation,i=!0),this.backFaceCulling!==this._backFaceCulling&&(this._backFaceCulling=this.backFaceCulling,i=!0),this.normalShading!==this._normalShading&&(this._normalShading=this.normalShading,i=!0),(this._style!==this.style||this.styleDirty)&&(this._style=this.style,this.styleDirty=!1,i=!0);const r=this.splitDirection!==T4.NONE;this._splittingEnabled!==r&&(this._splittingEnabled=r,i=!0),i&&aie(this,e,this._style),this._drawCommand.castShadows=rj.castShadows(this.shadows),this._drawCommand.receiveShadows=rj.receiveShadows(this.shadows);const s=this._highlightColor.alpha<1||this._constantColor.alpha<1||this._styleTranslucent;this._drawCommand.renderState=s?this._translucentRenderState:this._opaqueRenderState,this._drawCommand.pass=s?HU.TRANSLUCENT:this._opaquePass;const a=e.commandList,c=e.passes;(c.render||c.pick)&&a.push(this._drawCommand)},Bne.prototype.isDestroyed=function(){return!1},Bne.prototype.destroy=function(){const e=this._drawCommand;return C(e)&&(e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy()),Qh(this)};var hie=Bne;function die(e,t,n){const i=e._gl;i.framebufferTexture2D(i.FRAMEBUFFER,t,n._target,n._texture,0)}function fie(e,t,n){const i=e._gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,t,i.RENDERBUFFER,n._getRenderbuffer())}function pie(e){e=R(e,R.EMPTY_OBJECT);const t=e.context;D.defined("options.context",t);const n=t._gl,i=Ck.maximumColorAttachments;if(this._gl=n,this._framebuffer=n.createFramebuffer(),this._colorTextures=[],this._colorRenderbuffers=[],this._activeColorAttachments=[],this._depthTexture=void 0,this._depthRenderbuffer=void 0,this._stencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this.destroyAttachments=R(e.destroyAttachments,!0),C(e.colorTextures)&&C(e.colorRenderbuffers))throw new x("Cannot have both color texture and color renderbuffer attachments.");if(C(e.depthTexture)&&C(e.depthRenderbuffer))throw new x("Cannot have both a depth texture and depth renderbuffer attachment.");if(C(e.depthStencilTexture)&&C(e.depthStencilRenderbuffer))throw new x("Cannot have both a depth-stencil texture and depth-stencil renderbuffer attachment.");const o=C(e.depthTexture)||C(e.depthRenderbuffer),r=C(e.depthStencilTexture)||C(e.depthStencilRenderbuffer);if(o&&r)throw new x("Cannot have both a depth and depth-stencil attachment.");if(C(e.stencilRenderbuffer)&&r)throw new x("Cannot have both a stencil and depth-stencil attachment.");if(o&&C(e.stencilRenderbuffer))throw new x("Cannot have both a depth and stencil attachment.");let s,a,c,l,u;if(this._bind(),C(e.colorTextures)){const n=e.colorTextures;if(l=this._colorTextures.length=this._activeColorAttachments.length=n.length,l>i)throw new x("The number of color attachments exceeds the number supported.");for(c=0;c<l;++c){if(s=n[c],!fD.isColorFormat(s.pixelFormat))throw new x("The color-texture pixel-format must be a color format.");if(s.pixelDatatype===hD.FLOAT&&!t.colorBufferFloat)throw new x("The color texture pixel datatype is FLOAT and the WebGL implementation does not support the EXT_color_buffer_float or WEBGL_color_buffer_float extensions. See Context.colorBufferFloat.");if(s.pixelDatatype===hD.HALF_FLOAT&&!t.colorBufferHalfFloat)throw new x("The color texture pixel datatype is HALF_FLOAT and the WebGL implementation does not support the EXT_color_buffer_half_float extension. See Context.colorBufferHalfFloat.");u=this._gl.COLOR_ATTACHMENT0+c,die(this,u,s),this._activeColorAttachments[c]=u,this._colorTextures[c]=s}}if(C(e.colorRenderbuffers)){const t=e.colorRenderbuffers;if(l=this._colorRenderbuffers.length=this._activeColorAttachments.length=t.length,l>i)throw new x("The number of color attachments exceeds the number supported.");for(c=0;c<l;++c)a=t[c],u=this._gl.COLOR_ATTACHMENT0+c,fie(this,u,a),this._activeColorAttachments[c]=u,this._colorRenderbuffers[c]=a}if(C(e.depthTexture)){if(s=e.depthTexture,s.pixelFormat!==fD.DEPTH_COMPONENT)throw new x("The depth-texture pixel-format must be DEPTH_COMPONENT.");die(this,this._gl.DEPTH_ATTACHMENT,s),this._depthTexture=s}if(C(e.depthRenderbuffer)&&(a=e.depthRenderbuffer,fie(this,this._gl.DEPTH_ATTACHMENT,a),this._depthRenderbuffer=a),C(e.stencilRenderbuffer)&&(a=e.stencilRenderbuffer,fie(this,this._gl.STENCIL_ATTACHMENT,a),this._stencilRenderbuffer=a),C(e.depthStencilTexture)){if(s=e.depthStencilTexture,s.pixelFormat!==fD.DEPTH_STENCIL)throw new x("The depth-stencil pixel-format must be DEPTH_STENCIL.");die(this,this._gl.DEPTH_STENCIL_ATTACHMENT,s),this._depthStencilTexture=s}C(e.depthStencilRenderbuffer)&&(a=e.depthStencilRenderbuffer,fie(this,this._gl.DEPTH_STENCIL_ATTACHMENT,a),this._depthStencilRenderbuffer=a),this._unBind()}Object.defineProperties(pie.prototype,{status:{get:function(){this._bind();const e=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER);return this._unBind(),e}},numberOfColorAttachments:{get:function(){return this._activeColorAttachments.length}},depthTexture:{get:function(){return this._depthTexture}},depthRenderbuffer:{get:function(){return this._depthRenderbuffer}},stencilRenderbuffer:{get:function(){return this._stencilRenderbuffer}},depthStencilTexture:{get:function(){return this._depthStencilTexture}},depthStencilRenderbuffer:{get:function(){return this._depthStencilRenderbuffer}},hasDepthAttachment:{get:function(){return!!(this.depthTexture||this.depthRenderbuffer||this.depthStencilTexture||this.depthStencilRenderbuffer)}}}),pie.prototype._bind=function(){const e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer)},pie.prototype._unBind=function(){const e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,null)},pie.prototype.bindDraw=function(){const e=this._gl;e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this._framebuffer)},pie.prototype.bindRead=function(){const e=this._gl;e.bindFramebuffer(e.READ_FRAMEBUFFER,this._framebuffer)},pie.prototype._getActiveColorAttachments=function(){return this._activeColorAttachments},pie.prototype.getColorTexture=function(e){if(!C(e)||e<0||e>=this._colorTextures.length)throw new x("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorTextures[e]},pie.prototype.getColorRenderbuffer=function(e){if(!C(e)||e<0||e>=this._colorRenderbuffers.length)throw new x("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorRenderbuffers[e]},pie.prototype.isDestroyed=function(){return!1},pie.prototype.destroy=function(){if(this.destroyAttachments){let e=0;const t=this._colorTextures;let n=t.length;for(;e<n;++e){const n=t[e];C(n)&&n.destroy()}const i=this._colorRenderbuffers;for(n=i.length,e=0;e<n;++e){const t=i[e];C(t)&&t.destroy()}this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy(),this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()}return this._gl.deleteFramebuffer(this._framebuffer),Qh(this)};var mie=pie;function _ie(e){e=R(e,R.EMPTY_OBJECT);const t=e.context,n=e.width,i=e.height;D.defined("options.context",t),D.defined("options.width",n),D.defined("options.height",i),this._width=n,this._height=i;const o=e.colorRenderbuffers,r=e.colorTextures;if(C(o)!==C(r))throw new x("Both color renderbuffer and texture attachments must be provided.");const s=e.depthStencilRenderbuffer,a=e.depthStencilTexture;if(C(s)!==C(a))throw new x("Both depth-stencil renderbuffer and texture attachments must be provided.");this._renderFramebuffer=new mie({context:t,colorRenderbuffers:o,depthStencilRenderbuffer:s,destroyAttachments:e.destroyAttachments}),this._colorFramebuffer=new mie({context:t,colorTextures:r,depthStencilTexture:a,destroyAttachments:e.destroyAttachments})}_ie.prototype.getRenderFramebuffer=function(){return this._renderFramebuffer},_ie.prototype.getColorFramebuffer=function(){return this._colorFramebuffer},_ie.prototype.blitFramebuffers=function(e,t){this._renderFramebuffer.bindRead(),this._colorFramebuffer.bindDraw();const n=e._gl;let i=0;this._colorFramebuffer._colorTextures.length>0&&(i|=n.COLOR_BUFFER_BIT),C(this._colorFramebuffer.depthStencilTexture)&&(i|=n.DEPTH_BUFFER_BIT|(t?n.STENCIL_BUFFER_BIT:0)),n.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,i,n.NEAREST),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null)},_ie.prototype.isDestroyed=function(){return!1},_ie.prototype.destroy=function(){return this._renderFramebuffer.destroy(),this._colorFramebuffer.destroy(),Qh(this)};var gie=_ie;const yie={RGBA4:th.RGBA4,RGBA8:th.RGBA8,RGBA16F:th.RGBA16F,RGBA32F:th.RGBA32F,RGB5_A1:th.RGB5_A1,RGB565:th.RGB565,DEPTH_COMPONENT16:th.DEPTH_COMPONENT16,STENCIL_INDEX8:th.STENCIL_INDEX8,DEPTH_STENCIL:th.DEPTH_STENCIL,DEPTH24_STENCIL8:th.DEPTH24_STENCIL8,validate:function(e){return e===yie.RGBA4||e===yie.RGBA8||e===yie.RGBA16F||e===yie.RGBA32F||e===yie.RGB5_A1||e===yie.RGB565||e===yie.DEPTH_COMPONENT16||e===yie.STENCIL_INDEX8||e===yie.DEPTH_STENCIL||e===yie.DEPTH24_STENCIL8},getColorFormat:function(e){return e===th.FLOAT?yie.RGBA32F:e===th.HALF_FLOAT_OES?yie.RGBA16F:yie.RGBA8}};var vie=Object.freeze(yie);function bie(e){e=R(e,R.EMPTY_OBJECT),D.defined("options.context",e.context);const t=e.context,n=t._gl,i=Ck.maximumRenderbufferSize,o=R(e.format,vie.RGBA4),r=C(e.width)?e.width:n.drawingBufferWidth,s=C(e.height)?e.height:n.drawingBufferHeight,a=R(e.numSamples,1);if(!vie.validate(o))throw new x("Invalid format.");if(D.typeOf.number.greaterThan("width",r,0),r>i)throw new x(`Width must be less than or equal to the maximum renderbuffer size (${i}).  Check maximumRenderbufferSize.`);if(D.typeOf.number.greaterThan("height",s,0),s>i)throw new x(`Height must be less than or equal to the maximum renderbuffer size (${i}).  Check maximumRenderbufferSize.`);this._gl=n,this._format=o,this._width=r,this._height=s,this._renderbuffer=this._gl.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,this._renderbuffer),a>1?n.renderbufferStorageMultisample(n.RENDERBUFFER,a,o,r,s):n.renderbufferStorage(n.RENDERBUFFER,o,r,s),n.bindRenderbuffer(n.RENDERBUFFER,null)}Object.defineProperties(bie.prototype,{format:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}}}),bie.prototype._getRenderbuffer=function(){return this._renderbuffer},bie.prototype.isDestroyed=function(){return!1},bie.prototype.destroy=function(){return this._gl.deleteRenderbuffer(this._renderbuffer),Qh(this)};var Aie=bie;function wie(e){if(e=R(e,R.EMPTY_OBJECT),this._numSamples=R(e.numSamples,1),this._colorAttachmentsLength=R(e.colorAttachmentsLength,1),this._color=R(e.color,!0),this._depth=R(e.depth,!1),this._depthStencil=R(e.depthStencil,!1),this._supportsDepthTexture=R(e.supportsDepthTexture,!1),!this._color&&!this._depth&&!this._depthStencil)throw new x("Must enable at least one type of framebuffer attachment.");if(this._depth&&this._depthStencil)throw new x("Cannot have both a depth and depth-stencil attachment.");this._createColorAttachments=R(e.createColorAttachments,!0),this._createDepthAttachments=R(e.createDepthAttachments,!0),this._pixelDatatype=e.pixelDatatype,this._pixelFormat=e.pixelFormat,this._width=void 0,this._height=void 0,this._framebuffer=void 0,this._multisampleFramebuffer=void 0,this._colorTextures=void 0,this._color&&(this._colorTextures=new Array(this._colorAttachmentsLength),this._colorRenderbuffers=new Array(this._colorAttachmentsLength)),this._colorRenderbuffer=void 0,this._depthStencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthRenderbuffer=void 0,this._depthTexture=void 0,this._attachmentsDirty=!1}Object.defineProperties(wie.prototype,{framebuffer:{get:function(){return this._numSamples>1?this._multisampleFramebuffer.getRenderFramebuffer():this._framebuffer}},numSamples:{get:function(){return this._numSamples}},status:{get:function(){return this.framebuffer.status}}}),wie.prototype.isDirty=function(e,t,n,i,o){n=R(n,1);const r=this._width!==e||this._height!==t,s=this._numSamples!==n,a=C(i)&&this._pixelDatatype!==i||C(o)&&this._pixelFormat!==o,c=C(1===n?this._framebuffer:this._multisampleFramebuffer);return this._attachmentsDirty||r||s||a||!c||this._color&&!C(this._colorTextures[0])},wie.prototype.update=function(e,t,n,i,o,r){if(!C(t)||!C(n))throw new x("width and height must be defined.");if(i=e.msaa?R(i,1):1,o=R(o,this._color?R(this._pixelDatatype,hD.UNSIGNED_BYTE):void 0),r=R(r,this._color?R(this._pixelFormat,fD.RGBA):void 0),this.isDirty(t,n,i,o,r)){if(this.destroy(),this._width=t,this._height=n,this._numSamples=i,this._pixelDatatype=o,this._pixelFormat=r,this._attachmentsDirty=!1,this._color&&this._createColorAttachments)for(let i=0;i<this._colorAttachmentsLength;++i)if(this._colorTextures[i]=new Uk({context:e,width:t,height:n,pixelFormat:r,pixelDatatype:o,sampler:Nk.NEAREST}),this._numSamples>1){const r=vie.getColorFormat(o);this._colorRenderbuffers[i]=new Aie({context:e,width:t,height:n,format:r,numSamples:this._numSamples})}this._depthStencil&&this._createDepthAttachments&&(this._supportsDepthTexture&&e.depthTexture?(this._depthStencilTexture=new Uk({context:e,width:t,height:n,pixelFormat:fD.DEPTH_STENCIL,pixelDatatype:hD.UNSIGNED_INT_24_8,sampler:Nk.NEAREST}),this._numSamples>1&&(this._depthStencilRenderbuffer=new Aie({context:e,width:t,height:n,format:vie.DEPTH24_STENCIL8,numSamples:this._numSamples}))):this._depthStencilRenderbuffer=new Aie({context:e,width:t,height:n,format:vie.DEPTH_STENCIL})),this._depth&&this._createDepthAttachments&&(this._supportsDepthTexture&&e.depthTexture?this._depthTexture=new Uk({context:e,width:t,height:n,pixelFormat:fD.DEPTH_COMPONENT,pixelDatatype:hD.UNSIGNED_INT,sampler:Nk.NEAREST}):this._depthRenderbuffer=new Aie({context:e,width:t,height:n,format:vie.DEPTH_COMPONENT16})),this._numSamples>1?this._multisampleFramebuffer=new gie({context:e,width:this._width,height:this._height,colorTextures:this._colorTextures,colorRenderbuffers:this._colorRenderbuffers,depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}):this._framebuffer=new mie({context:e,colorTextures:this._colorTextures,depthTexture:this._depthTexture,depthRenderbuffer:this._depthRenderbuffer,depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1})}},wie.prototype.getColorTexture=function(e){if(e=R(e,0),e>=this._colorAttachmentsLength)throw new x("index must be smaller than total number of color attachments.");return this._colorTextures[e]},wie.prototype.setColorTexture=function(e,t){if(t=R(t,0),this._createColorAttachments)throw new x("createColorAttachments must be false if setColorTexture is called.");if(t>=this._colorAttachmentsLength)throw new x("index must be smaller than total number of color attachments.");this._attachmentsDirty=e!==this._colorTextures[t],this._colorTextures[t]=e},wie.prototype.getColorRenderbuffer=function(e){if(e=R(e,0),e>=this._colorAttachmentsLength)throw new x("index must be smaller than total number of color attachments.");return this._colorRenderbuffers[e]},wie.prototype.setColorRenderbuffer=function(e,t){if(t=R(t,0),this._createColorAttachments)throw new x("createColorAttachments must be false if setColorRenderbuffer is called.");if(t>=this._colorAttachmentsLength)throw new x("index must be smaller than total number of color attachments.");this._attachmentsDirty=e!==this._colorRenderbuffers[t],this._colorRenderbuffers[t]=e},wie.prototype.getDepthRenderbuffer=function(){return this._depthRenderbuffer},wie.prototype.setDepthRenderbuffer=function(e){if(this._createDepthAttachments)throw new x("createDepthAttachments must be false if setDepthRenderbuffer is called.");this._attachmentsDirty=e!==this._depthRenderbuffer,this._depthRenderbuffer=e},wie.prototype.getDepthTexture=function(){return this._depthTexture},wie.prototype.setDepthTexture=function(e){if(this._createDepthAttachments)throw new x("createDepthAttachments must be false if setDepthTexture is called.");this._attachmentsDirty=e!==this._depthTexture,this._depthTexture=e},wie.prototype.getDepthStencilRenderbuffer=function(){return this._depthStencilRenderbuffer},wie.prototype.setDepthStencilRenderbuffer=function(e){if(this._createDepthAttachments)throw new x("createDepthAttachments must be false if setDepthStencilRenderbuffer is called.");this._attachmentsDirty=e!==this._depthStencilRenderbuffer,this._depthStencilRenderbuffer=e},wie.prototype.getDepthStencilTexture=function(){return this._depthStencilTexture},wie.prototype.setDepthStencilTexture=function(e){if(this._createDepthAttachments)throw new x("createDepthAttachments must be false if setDepthStencilTexture is called.");this._attachmentsDirty=e!==this._depthStencilTexture,this._depthStencilTexture=e},wie.prototype.prepareTextures=function(e,t){this._numSamples>1&&this._multisampleFramebuffer.blitFramebuffers(e,t)},wie.prototype.clear=function(e,t,n){const i=t.framebuffer;t.framebuffer=this.framebuffer,t.execute(e,n),t.framebuffer=i},wie.prototype.destroyFramebuffer=function(){this._framebuffer=this._framebuffer&&this._framebuffer.destroy(),this._multisampleFramebuffer=this._multisampleFramebuffer&&this._multisampleFramebuffer.destroy()},wie.prototype.destroy=function(){if(this._color){let e;const t=this._colorTextures.length;for(e=0;e<t;++e){const t=this._colorTextures[e];this._createColorAttachments&&C(t)&&!t.isDestroyed()&&(this._colorTextures[e].destroy(),this._colorTextures[e]=void 0),C(t)&&t.isDestroyed()&&(this._colorTextures[e]=void 0);const n=this._colorRenderbuffers[e];this._createColorAttachments&&C(n)&&!n.isDestroyed()&&(this._colorRenderbuffers[e].destroy(),this._colorRenderbuffers[e]=void 0),C(n)&&n.isDestroyed()&&(this._colorRenderbuffers[e]=void 0)}}this._depthStencil&&(this._createDepthAttachments&&(this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()),C(this._depthStencilTexture)&&this._depthStencilTexture.isDestroyed()&&(this._depthStencilTexture=void 0),C(this._depthStencilRenderbuffer)&&this._depthStencilRenderbuffer.isDestroyed()&&(this._depthStencilRenderbuffer=void 0)),this._depth&&(this._createDepthAttachments&&(this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy()),C(this._depthTexture)&&this._depthTexture.isDestroyed()&&(this._depthTexture=void 0),C(this._depthRenderbuffer)&&this._depthRenderbuffer.isDestroyed()&&(this._depthRenderbuffer=void 0)),this.destroyFramebuffer()};var Tie=wie,Cie="#extension GL_EXT_frag_depth : enable\n\nuniform sampler2D u_pointCloud_colorGBuffer;\nuniform sampler2D u_pointCloud_depthGBuffer;\nuniform vec2 u_distanceAndEdlStrength;\nvarying vec2 v_textureCoordinates;\n\nvec2 neighborContribution(float log2Depth, vec2 offset)\n{\n    float dist = u_distanceAndEdlStrength.x;\n    vec2 texCoordOrig = v_textureCoordinates + offset * dist;\n    vec2 texCoord0 = v_textureCoordinates + offset * floor(dist);\n    vec2 texCoord1 = v_textureCoordinates + offset * ceil(dist);\n\n    float depthOrLogDepth0 = czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, texCoord0));\n    float depthOrLogDepth1 = czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, texCoord1));\n\n    // ignore depth values that are the clear depth\n    if (depthOrLogDepth0 == 0.0 || depthOrLogDepth1 == 0.0) {\n        return vec2(0.0);\n    }\n\n    // interpolate the two adjacent depth values\n    float depthMix = mix(depthOrLogDepth0, depthOrLogDepth1, fract(dist));\n    vec4 eyeCoordinate = czm_windowToEyeCoordinates(texCoordOrig, depthMix);\n    return vec2(max(0.0, log2Depth - log2(-eyeCoordinate.z / eyeCoordinate.w)), 1.0);\n}\n\nvoid main()\n{\n    float depthOrLogDepth = czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, v_textureCoordinates));\n\n    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, depthOrLogDepth);\n    eyeCoordinate /= eyeCoordinate.w;\n\n    float log2Depth = log2(-eyeCoordinate.z);\n\n    if (depthOrLogDepth == 0.0) // 0.0 is the clear value for the gbuffer\n    {\n        discard;\n    }\n\n    vec4 color = texture2D(u_pointCloud_colorGBuffer, v_textureCoordinates);\n\n    // sample from neighbors left, right, down, up\n    vec2 texelSize = 1.0 / czm_viewport.zw;\n\n    vec2 responseAndCount = vec2(0.0);\n\n    responseAndCount += neighborContribution(log2Depth, vec2(-texelSize.x, 0.0));\n    responseAndCount += neighborContribution(log2Depth, vec2(+texelSize.x, 0.0));\n    responseAndCount += neighborContribution(log2Depth, vec2(0.0, -texelSize.y));\n    responseAndCount += neighborContribution(log2Depth, vec2(0.0, +texelSize.y));\n\n    float response = responseAndCount.x / responseAndCount.y;\n    float strength = u_distanceAndEdlStrength.y;\n    float shade = exp(-response * 300.0 * strength);\n    color.rgb *= shade;\n    gl_FragColor = vec4(color);\n\n    // Input and output depth are the same.\n    gl_FragDepthEXT = depthOrLogDepth;\n}\n";function Eie(){this._framebuffer=new Tie({colorAttachmentsLength:2,depth:!0,supportsDepthTexture:!0}),this._drawCommand=void 0,this._clearCommand=void 0,this._strength=1,this._radius=1}function xie(e){e._framebuffer.destroy(),e._drawCommand=void 0,e._clearCommand=void 0}Object.defineProperties(Eie.prototype,{framebuffer:{get:function(){return this._framebuffer.framebuffer}},colorGBuffer:{get:function(){return this._framebuffer.getColorTexture(0)}},depthGBuffer:{get:function(){return this._framebuffer.getColorTexture(1)}}});const Sie=new ro;function Iie(e,t){const n=new tq({defines:["LOG_DEPTH_WRITE"],sources:[Cie]}),i={u_pointCloud_colorGBuffer:function(){return e.colorGBuffer},u_pointCloud_depthGBuffer:function(){return e.depthGBuffer},u_distanceAndEdlStrength:function(){return Sie.x=e._radius,Sie.y=e._strength,Sie}},o=yV.fromCache({blending:_k.ALPHA_BLEND,depthMask:!0,depthTest:{enabled:!0},stencilTest:FY.setCesium3DTileBit(),stencilMask:FY.CESIUM_3D_TILE_MASK});e._drawCommand=t.createViewportQuadCommand(n,{uniformMap:i,renderState:o,pass:HU.CESIUM_3D_TILE,owner:e}),e._clearCommand=new tJ({framebuffer:e.framebuffer,color:new xy(0,0,0,0),depth:1,renderState:yV.fromCache(),pass:HU.CESIUM_3D_TILE,owner:e})}function Oie(e,t){const n=t.drawingBufferWidth,i=t.drawingBufferHeight;e._framebuffer.update(t,n,i),Iie(e,t)}function Die(e){return e.drawBuffers&&e.fragmentDepth}function Pie(e,t){let n=e.shaderCache.getDerivedShaderProgram(t,"EC");if(!C(n)){const i=t._attributeLocations,o=t.fragmentShaderSource.clone();o.sources=o.sources.map((function(e){return e=tq.replaceMain(e,"czm_point_cloud_post_process_main"),e=e.replace(/gl_FragColor/g,"gl_FragData[0]"),e})),o.sources.unshift("#extension GL_EXT_draw_buffers : enable \n"),o.sources.push("void main() \n{ \n    czm_point_cloud_post_process_main(); \n#ifdef LOG_DEPTH\n    czm_writeLogDepth();\n    gl_FragData[1] = czm_packDepth(gl_FragDepthEXT); \n#else\n    gl_FragData[1] = czm_packDepth(gl_FragCoord.z);\n#endif\n}"),n=e.shaderCache.createDerivedShaderProgram(t,"EC",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:o,attributeLocations:i})}return n}Eie.isSupported=Die,Eie.prototype.update=function(e,t,n,i){if(!Die(e.context))return;let o;this._strength=n.eyeDomeLightingStrength,this._radius=n.eyeDomeLightingRadius*e.pixelRatio,Oie(this,e.context);const r=e.commandList,s=r.length;for(o=t;o<s;++o){const t=r[o];if(t.primitiveType!==xf.POINTS||t.pass===HU.TRANSLUCENT)continue;let n,i,s=t.derivedCommands.pointCloudProcessor;C(s)&&(n=s.command,i=s.originalShaderProgram),C(n)&&!t.dirty&&i===t.shaderProgram&&n.framebuffer===this.framebuffer||(n=UU.shallowClone(t,n),n.framebuffer=this.framebuffer,n.shaderProgram=Pie(e.context,t.shaderProgram),n.castShadows=!1,n.receiveShadows=!1,C(s)||(s={command:n,originalShaderProgram:t.shaderProgram},t.derivedCommands.pointCloudProcessor=s),s.originalShaderProgram=t.shaderProgram),r[o]=n}const a=this._clearCommand,c=this._drawCommand;c.boundingVolume=i,r.push(c),r.push(a)},Eie.prototype.isDestroyed=function(){return!1},Eie.prototype.destroy=function(){return xie(this),Qh(this)};var Rie=Eie;function Lie(e){const t=R(e,{});this.attenuation=R(t.attenuation,!1),this.geometricErrorScale=R(t.geometricErrorScale,1),this.maximumAttenuation=t.maximumAttenuation,this.baseResolution=t.baseResolution,this.eyeDomeLighting=R(t.eyeDomeLighting,!0),this.eyeDomeLightingStrength=R(t.eyeDomeLightingStrength,1),this.eyeDomeLightingRadius=R(t.eyeDomeLightingRadius,1),this.backFaceCulling=R(t.backFaceCulling,!1),this.normalShading=R(t.normalShading,!0)}Lie.isSupported=function(e){return Rie.isSupported(e.context)};var Mie=Lie;function Bie(e,t,n,i,o){this._tileset=e,this._tile=t,this._resource=n,this._metadata=void 0,this._pickId=void 0,this._batchTable=void 0,this._styleDirty=!1,this._features=void 0,this.featurePropertiesDirty=!1,this._group=void 0,this._pointCloud=new hie({arrayBuffer:i,byteOffset:o,cull:!1,opaquePass:HU.CESIUM_3D_TILE,vertexShaderLoaded:Nie(this),fragmentShaderLoaded:Fie(this),uniformMapLoaded:zie(this),batchTableLoaded:kie(this),pickIdLoaded:Uie(this)})}function Nie(e){return function(t){return C(e._batchTable)?e._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(t):t}}function Fie(e){return function(t){return C(e._batchTable)?e._batchTable.getFragmentShaderCallback(!1,void 0,!1)(t):`uniform vec4 czm_pickColor;\n${t}`}}function zie(e){return function(t){return C(e._batchTable)?e._batchTable.getUniformMapCallback()(t):_n(t,{czm_pickColor:function(){return e._pickId.color}})}}function kie(e){return function(t,n,i){e._batchTable=new lZ(e,t,n,i)}}function Uie(e){return function(){return C(e._batchTable)?e._batchTable.getPickId():"czm_pickColor"}}function Vie(e){const t=e._tileset.pointCloudShading,n=e._tile.contentBoundingVolume.boundingSphere.volume(),i=z.cbrt(n/e.pointsLength);let o=e._tile.geometricError;return 0===o&&(o=C(t)&&C(t.baseResolution)?t.baseResolution:i),o}function Hie(e){const t=e.featuresLength;if(!C(e._features)&&t>0){const n=new Array(t);for(let i=0;i<t;++i)n[i]=new hZ(e,i);e._features=n}}Object.defineProperties(Bie.prototype,{featuresLength:{get:function(){return C(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return this._pointCloud.pointsLength}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return this._pointCloud.geometryByteLength}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return C(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._pointCloud.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},batchTable:{get:function(){return this._batchTable}},group:{get:function(){return this._group},set:function(e){this._group=e}}}),Bie.prototype.hasProperty=function(e,t){return!!C(this._batchTable)&&this._batchTable.hasProperty(e,t)},Bie.prototype.getFeature=function(e){if(!C(this._batchTable))return;const t=this.featuresLength;if(!C(e)||e<0||e>=t)throw new x(`batchId is required and between zero and featuresLength - 1 (${t-1}).`);return Hie(this),this._features[e]},Bie.prototype.applyDebugSettings=function(e,t){this._pointCloud.color=e?t:xy.WHITE},Bie.prototype.applyStyle=function(e){C(this._batchTable)?this._batchTable.applyStyle(e):this._styleDirty=!0};const Gie=new Mie;Bie.prototype.update=function(e,t){const n=this._pointCloud,i=R(e.pointCloudShading,Gie),o=this._tile,r=this._batchTable,s=t.mode,a=e.clippingPlanes;let c;C(this._pickId)||C(r)||(this._pickId=t.context.createPickId({primitive:e,content:this})),C(r)&&r.update(e,t),c=C(o._contentBoundingVolume)?s===ij.SCENE3D?o._contentBoundingVolume.boundingSphere:o._contentBoundingVolume2D.boundingSphere:s===ij.SCENE3D?o._boundingVolume.boundingSphere:o._boundingVolume2D.boundingSphere;const l=this._styleDirty;this._styleDirty=!1,n.clippingPlanesOriginMatrix=e.clippingPlanesOriginMatrix,n.style=C(r)?void 0:e.style,n.styleDirty=l,n.modelMatrix=o.computedTransform,n.time=e.timeSinceLoad,n.shadows=e.shadows,n.boundingSphere=c,n.clippingPlanes=a,n.isClipped=C(a)&&a.enabled&&o._isClipped,n.clippingPlanesDirty=o.clippingPlanesDirty,n.attenuation=i.attenuation,n.backFaceCulling=i.backFaceCulling,n.normalShading=i.normalShading,n.geometricError=Vie(this),n.geometricErrorScale=i.geometricErrorScale,n.splitDirection=e.splitDirection,C(i)&&C(i.maximumAttenuation)?n.maximumAttenuation=i.maximumAttenuation:o.refine===wne.ADD?n.maximumAttenuation=5:n.maximumAttenuation=e.maximumScreenSpaceError,n.update(t)},Bie.prototype.isDestroyed=function(){return!1},Bie.prototype.destroy=function(){return this._pickId=this._pickId&&this._pickId.destroy(),this._pointCloud=this._pointCloud&&this._pointCloud.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Qh(this)};var Wie=Bie;function qie(e,t,n,i){this._tileset=e,this._tile=t,this._resource=n,this._readyPromise=yn(),this.featurePropertiesDirty=!1,this._metadata=void 0,this._group=void 0,jie(this,i)}function jie(e,t){e._tileset.loadTileset(e._resource,t,e._tile),e._readyPromise.resolve(e)}Object.defineProperties(qie.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},group:{get:function(){return this._group},set:function(e){this._group=e}}}),qie.prototype.hasProperty=function(e,t){return!1},qie.prototype.getFeature=function(e){},qie.prototype.applyDebugSettings=function(e,t){},qie.prototype.applyStyle=function(e){},qie.prototype.update=function(e,t){},qie.prototype.isDestroyed=function(){return!1},qie.prototype.destroy=function(){return Qh(this)};var Yie=qie;function Kie(e,t,n,i){if(D.defined("context",e),!t||0===t.length)throw new x("At least one attribute is required.");const o=Kie._verifyAttributes(t);n=R(n,0);const r=[],s={};let a,c;const l=o.length;for(let h=0;h<l;++h){const e=o[h];e.vertexBuffer?r.push(e):(c=e.usage,a=s[c],C(a)||(a=s[c]=[]),a.push(e))}function u(e,t){return ih.getSizeInBytes(t.componentDatatype)-ih.getSizeInBytes(e.componentDatatype)}for(c in this._allBuffers=[],s)if(s.hasOwnProperty(c)){a=s[c],a.sort(u);const e=Kie._vertexSizeInBytes(a),t=a[0].usage,n={vertexSizeInBytes:e,vertexBuffer:void 0,usage:t,needsCommit:!1,arrayBuffer:void 0,arrayViews:Kie._createArrayViews(a,e)};this._allBuffers.push(n)}this._size=0,this._instanced=R(i,!1),this._precreated=r,this._context=e,this.writers=void 0,this.va=void 0,this.resize(n)}Kie._verifyAttributes=function(e){const t=[];for(let i=0;i<e.length;++i){const n=e[i],o={index:R(n.index,i),enabled:R(n.enabled,!0),componentsPerAttribute:n.componentsPerAttribute,componentDatatype:R(n.componentDatatype,ih.FLOAT),normalize:R(n.normalize,!1),vertexBuffer:n.vertexBuffer,usage:R(n.usage,lq.STATIC_DRAW)};if(t.push(o),1!==o.componentsPerAttribute&&2!==o.componentsPerAttribute&&3!==o.componentsPerAttribute&&4!==o.componentsPerAttribute)throw new x("attribute.componentsPerAttribute must be in the range [1, 4].");const r=o.componentDatatype;if(!ih.validate(r))throw new x("Attribute must have a valid componentDatatype or not specify it.");if(!lq.validate(o.usage))throw new x("Attribute must have a valid usage or not specify it.")}const n=new Array(t.length);for(let i=0;i<t.length;++i){const e=t[i],o=e.index;if(n[o])throw new x(`Index ${o} is used by more than one attribute.`);n[o]=!0}return t},Kie._vertexSizeInBytes=function(e){let t=0;const n=e.length;for(let s=0;s<n;++s){const n=e[s];t+=n.componentsPerAttribute*ih.getSizeInBytes(n.componentDatatype)}const i=n>0?ih.getSizeInBytes(e[0].componentDatatype):0,o=i>0?t%i:0,r=0===o?0:i-o;return t+=r,t},Kie._createArrayViews=function(e,t){const n=[];let i=0;const o=e.length;for(let r=0;r<o;++r){const o=e[r],s=o.componentDatatype;n.push({index:o.index,enabled:o.enabled,componentsPerAttribute:o.componentsPerAttribute,componentDatatype:s,normalize:o.normalize,offsetInBytes:i,vertexSizeInComponentType:t/ih.getSizeInBytes(s),view:void 0}),i+=o.componentsPerAttribute*ih.getSizeInBytes(s)}return n},Kie.prototype.resize=function(e){this._size=e;const t=this._allBuffers;this.writers=[];for(let n=0,i=t.length;n<i;++n){const e=t[n];Kie._resize(e,this._size),Kie._appendWriters(this.writers,e)}Zie(this)},Kie._resize=function(e,t){if(e.vertexSizeInBytes>0){const n=new ArrayBuffer(t*e.vertexSizeInBytes);if(C(e.arrayBuffer)){const t=new Uint8Array(n),i=new Uint8Array(e.arrayBuffer),o=i.length;for(let e=0;e<o;++e)t[e]=i[e]}const i=e.arrayViews,o=i.length;for(let e=0;e<o;++e){const t=i[e];t.view=ih.createArrayBufferView(t.componentDatatype,n,t.offsetInBytes)}e.arrayBuffer=n}};const Xie=[function(e,t,n){return function(i,o){t[i*n]=o,e.needsCommit=!0}},function(e,t,n){return function(i,o,r){const s=i*n;t[s]=o,t[s+1]=r,e.needsCommit=!0}},function(e,t,n){return function(i,o,r,s){const a=i*n;t[a]=o,t[a+1]=r,t[a+2]=s,e.needsCommit=!0}},function(e,t,n){return function(i,o,r,s,a){const c=i*n;t[c]=o,t[c+1]=r,t[c+2]=s,t[c+3]=a,e.needsCommit=!0}}];function Qie(e,t){if(t.needsCommit&&t.vertexSizeInBytes>0){t.needsCommit=!1;const n=t.vertexBuffer,i=e._size*t.vertexSizeInBytes,o=C(n);if(!o||n.sizeInBytes<i)return o&&n.destroy(),t.vertexBuffer=hq.createVertexBuffer({context:e._context,typedArray:t.arrayBuffer,usage:t.usage}),t.vertexBuffer.vertexArrayDestroyable=!1,!0;t.vertexBuffer.copyFromArrayView(t.arrayBuffer)}return!1}function Jie(e,t,n){if(e.needsCommit&&e.vertexSizeInBytes>0){const i=e.vertexSizeInBytes*t,o=e.vertexSizeInBytes*n;e.vertexBuffer.copyFromArrayView(new Uint8Array(e.arrayBuffer,i,o),i)}}function Zie(e){const t=e.va;if(!C(t))return;const n=t.length;for(let i=0;i<n;++i)t[i].va.destroy();e.va=void 0}Kie._appendWriters=function(e,t){const n=t.arrayViews,i=n.length;for(let o=0;o<i;++o){const i=n[o];e[i.index]=Xie[i.componentsPerAttribute-1](t,i.view,i.vertexSizeInComponentType)}},Kie.prototype.commit=function(e){let t=!1;const n=this._allBuffers;let i,o,r;for(o=0,r=n.length;o<r;++o)i=n[o],t=Qie(this,i)||t;if(t||!C(this.va)){Zie(this);const t=this.va=[],s=z.SIXTY_FOUR_KILOBYTES-4,a=C(e)&&!this._instanced?Math.ceil(this._size/s):1;for(let c=0;c<a;++c){let l=[];for(o=0,r=n.length;o<r;++o){i=n[o];const e=c*(i.vertexSizeInBytes*s);Kie._appendAttributes(l,i,e,this._instanced)}l=l.concat(this._precreated),t.push({va:new bq({context:this._context,attributes:l,indexBuffer:e}),indicesCount:1.5*(c!==a-1?s:this._size%s)})}}},Kie._appendAttributes=function(e,t,n,i){const o=t.arrayViews,r=o.length;for(let s=0;s<r;++s){const r=o[s];e.push({index:r.index,enabled:r.enabled,componentsPerAttribute:r.componentsPerAttribute,componentDatatype:r.componentDatatype,normalize:r.normalize,vertexBuffer:t.vertexBuffer,offsetInBytes:n+r.offsetInBytes,strideInBytes:t.vertexSizeInBytes,instanceDivisor:i?1:0})}},Kie.prototype.subCommit=function(e,t){if(e<0||e>=this._size)throw new x("offsetInVertices must be greater than or equal to zero and less than the vertex array size.");if(e+t>this._size)throw new x("offsetInVertices + lengthInVertices cannot exceed the vertex array size.");const n=this._allBuffers;for(let i=0,o=n.length;i<o;++i)Jie(n[i],e,t)},Kie.prototype.endSubCommits=function(){const e=this._allBuffers;for(let t=0,n=e.length;t<n;++t)e[t].needsCommit=!1},Kie.prototype.isDestroyed=function(){return!1},Kie.prototype.destroy=function(){const e=this._allBuffers;for(let t=0,n=e.length;t<n;++t){const n=e[t];n.vertexBuffer=n.vertexBuffer&&n.vertexBuffer.destroy()}return Zie(this),Qh(this)};var $ie=Kie,eoe='#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n\nuniform sampler2D u_atlas;\n\n#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\n\nvarying vec2 v_textureCoordinates;\nvarying vec4 v_pickColor;\nvarying vec4 v_color;\n\n#ifdef SDF\nvarying vec4 v_outlineColor;\nvarying float v_outlineWidth;\n#endif\n\n#ifdef FRAGMENT_DEPTH_CHECK\nvarying vec4 v_textureCoordinateBounds;                  // the min and max x and y values for the texture coordinates\nvarying vec4 v_originTextureCoordinateAndTranslate;      // texture coordinate at the origin, billboard translate (used for label glyphs)\nvarying vec4 v_compressed;                               // x: eyeDepth, y: applyTranslate & enableDepthCheck, z: dimensions, w: imageSize\nvarying mat2 v_rotationMatrix;\n\nconst float SHIFT_LEFT12 = 4096.0;\nconst float SHIFT_LEFT1 = 2.0;\n\nconst float SHIFT_RIGHT12 = 1.0 / 4096.0;\nconst float SHIFT_RIGHT1 = 1.0 / 2.0;\n\nfloat getGlobeDepth(vec2 adjustedST, vec2 depthLookupST, bool applyTranslate, vec2 dimensions, vec2 imageSize)\n{\n    vec2 lookupVector = imageSize * (depthLookupST - adjustedST);\n    lookupVector = v_rotationMatrix * lookupVector;\n    vec2 labelOffset = (dimensions - imageSize) * (depthLookupST - vec2(0.0, v_originTextureCoordinateAndTranslate.y)); // aligns label glyph with bounding rectangle.  Will be zero for billboards because dimensions and imageSize will be equal\n\n    vec2 translation = v_originTextureCoordinateAndTranslate.zw;\n\n    if (applyTranslate)\n    {\n        // this is only needed for labels where the horizontal origin is not LEFT\n        // it moves the label back to where the "origin" should be since all label glyphs are set to HorizontalOrigin.LEFT\n        translation += (dimensions * v_originTextureCoordinateAndTranslate.xy * vec2(1.0, 0.0));\n    }\n\n    vec2 st = ((lookupVector - translation + labelOffset) + gl_FragCoord.xy) / czm_viewport.zw;\n    float logDepthOrDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, st));\n\n    if (logDepthOrDepth == 0.0)\n    {\n        return 0.0; // not on the globe\n    }\n\n    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);\n    return eyeCoordinate.z / eyeCoordinate.w;\n}\n#endif\n\n\n#ifdef SDF\n\n// Get the distance from the edge of a glyph at a given position sampling an SDF texture.\nfloat getDistance(vec2 position)\n{\n    return texture2D(u_atlas, position).r;\n}\n\n// Samples the sdf texture at the given position and produces a color based on the fill color and the outline.\nvec4 getSDFColor(vec2 position, float outlineWidth, vec4 outlineColor, float smoothing)\n{\n    float distance = getDistance(position);\n\n    if (outlineWidth > 0.0)\n    {\n        // Don\'t get the outline edge exceed the SDF_EDGE\n        float outlineEdge = clamp(SDF_EDGE - outlineWidth, 0.0, SDF_EDGE);\n        float outlineFactor = smoothstep(SDF_EDGE - smoothing, SDF_EDGE + smoothing, distance);\n        vec4 sdfColor = mix(outlineColor, v_color, outlineFactor);\n        float alpha = smoothstep(outlineEdge - smoothing, outlineEdge + smoothing, distance);\n        return vec4(sdfColor.rgb, sdfColor.a * alpha);\n    }\n    else\n    {\n        float alpha = smoothstep(SDF_EDGE - smoothing, SDF_EDGE + smoothing, distance);\n        return vec4(v_color.rgb, v_color.a * alpha);\n    }\n}\n#endif\n\nvoid main()\n{\n    vec4 color = texture2D(u_atlas, v_textureCoordinates);\n\n#ifdef SDF\n    float outlineWidth = v_outlineWidth;\n    vec4 outlineColor = v_outlineColor;\n\n    // Get the current distance\n    float distance = getDistance(v_textureCoordinates);\n\n#ifdef GL_OES_standard_derivatives\n    float smoothing = fwidth(distance);\n    // Get an offset that is approximately half the distance to the neighbor pixels\n    // 0.354 is approximately half of 1/sqrt(2)\n    vec2 sampleOffset = 0.354 * vec2(dFdx(v_textureCoordinates) + dFdy(v_textureCoordinates));\n\n    // Sample the center point\n    vec4 center = getSDFColor(v_textureCoordinates, outlineWidth, outlineColor, smoothing);\n\n    // Sample the 4 neighbors\n    vec4 color1 = getSDFColor(v_textureCoordinates + vec2(sampleOffset.x, sampleOffset.y), outlineWidth, outlineColor, smoothing);\n    vec4 color2 = getSDFColor(v_textureCoordinates + vec2(-sampleOffset.x, sampleOffset.y), outlineWidth, outlineColor, smoothing);\n    vec4 color3 = getSDFColor(v_textureCoordinates + vec2(-sampleOffset.x, -sampleOffset.y), outlineWidth, outlineColor, smoothing);\n    vec4 color4 = getSDFColor(v_textureCoordinates + vec2(sampleOffset.x, -sampleOffset.y), outlineWidth, outlineColor, smoothing);\n\n    // Equally weight the center sample and the 4 neighboring samples\n    color = (center + color1 + color2 + color3 + color4)/5.0;\n#else\n    // Just do a single sample\n    float smoothing = 1.0/32.0;\n    color = getSDFColor(v_textureCoordinates, outlineWidth, outlineColor, smoothing);\n#endif\n\n    color = czm_gammaCorrect(color);\n#else\n    color = czm_gammaCorrect(color);\n    color *= czm_gammaCorrect(v_color);\n#endif\n\n// Fully transparent parts of the billboard are not pickable.\n#if !defined(OPAQUE) && !defined(TRANSLUCENT)\n    if (color.a < 0.005)   // matches 0/255 and 1/255\n    {\n        discard;\n    }\n#else\n// The billboard is rendered twice. The opaque pass discards translucent fragments\n// and the translucent pass discards opaque fragments.\n#ifdef OPAQUE\n    if (color.a < 0.995)   // matches < 254/255\n    {\n        discard;\n    }\n#else\n    if (color.a >= 0.995)  // matches 254/255 and 255/255\n    {\n        discard;\n    }\n#endif\n#endif\n\n#ifdef VECTOR_TILE\n    color *= u_highlightColor;\n#endif\n    gl_FragColor = color;\n\n#ifdef LOG_DEPTH\n    czm_writeLogDepth();\n#endif\n\n#ifdef FRAGMENT_DEPTH_CHECK\n    float temp = v_compressed.y;\n\n    temp = temp * SHIFT_RIGHT1;\n\n    float temp2 = (temp - floor(temp)) * SHIFT_LEFT1;\n    bool enableDepthTest = temp2 != 0.0;\n    bool applyTranslate = floor(temp) != 0.0;\n\n    if (enableDepthTest) {\n        temp = v_compressed.z;\n        temp = temp * SHIFT_RIGHT12;\n\n        vec2 dimensions;\n        dimensions.y = (temp - floor(temp)) * SHIFT_LEFT12;\n        dimensions.x = floor(temp);\n\n        temp = v_compressed.w;\n        temp = temp * SHIFT_RIGHT12;\n\n        vec2 imageSize;\n        imageSize.y = (temp - floor(temp)) * SHIFT_LEFT12;\n        imageSize.x = floor(temp);\n\n        vec2 adjustedST = v_textureCoordinates - v_textureCoordinateBounds.xy;\n        adjustedST = adjustedST / vec2(v_textureCoordinateBounds.z - v_textureCoordinateBounds.x, v_textureCoordinateBounds.w - v_textureCoordinateBounds.y);\n\n        float epsilonEyeDepth = v_compressed.x + czm_epsilon1;\n        float globeDepth1 = getGlobeDepth(adjustedST, v_originTextureCoordinateAndTranslate.xy, applyTranslate, dimensions, imageSize);\n\n        // negative values go into the screen\n        if (globeDepth1 != 0.0 && globeDepth1 > epsilonEyeDepth)\n        {\n            float globeDepth2 = getGlobeDepth(adjustedST, vec2(0.0, 1.0), applyTranslate, dimensions, imageSize); // top left corner\n            if (globeDepth2 != 0.0 && globeDepth2 > epsilonEyeDepth)\n            {\n                float globeDepth3 = getGlobeDepth(adjustedST, vec2(1.0, 1.0), applyTranslate, dimensions, imageSize); // top right corner\n                if (globeDepth3 != 0.0 && globeDepth3 > epsilonEyeDepth)\n                {\n                    discard;\n                }\n            }\n        }\n    }\n#endif\n\n}\n',toe="#ifdef INSTANCED\nattribute vec2 direction;\n#endif\nattribute vec4 positionHighAndScale;\nattribute vec4 positionLowAndRotation;\nattribute vec4 compressedAttribute0;                       // pixel offset, translate, horizontal origin, vertical origin, show, direction, texture coordinates (texture offset)\nattribute vec4 compressedAttribute1;                       // aligned axis, translucency by distance, image width\nattribute vec4 compressedAttribute2;                       // label horizontal origin, image height, color, pick color, size in meters, valid aligned axis, 13 bits free\nattribute vec4 eyeOffset;                                  // eye offset in meters, 4 bytes free (texture range)\nattribute vec4 scaleByDistance;                            // near, nearScale, far, farScale\nattribute vec4 pixelOffsetScaleByDistance;                 // near, nearScale, far, farScale\nattribute vec4 compressedAttribute3;                       // distance display condition near, far, disableDepthTestDistance, dimensions\nattribute vec2 sdf;                                        // sdf outline color (rgb) and width (w)\n#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)\nattribute vec4 textureCoordinateBoundsOrLabelTranslate;    // the min and max x and y values for the texture coordinates\n#endif\n#ifdef VECTOR_TILE\nattribute float a_batchId;\n#endif\n\nvarying vec2 v_textureCoordinates;\n#ifdef FRAGMENT_DEPTH_CHECK\nvarying vec4 v_textureCoordinateBounds;\nvarying vec4 v_originTextureCoordinateAndTranslate;\nvarying vec4 v_compressed;                                 // x: eyeDepth, y: applyTranslate & enableDepthCheck, z: dimensions, w: imageSize\nvarying mat2 v_rotationMatrix;\n#endif\n\nvarying vec4 v_pickColor;\nvarying vec4 v_color;\n#ifdef SDF\nvarying vec4 v_outlineColor;\nvarying float v_outlineWidth;\n#endif\n\nconst float UPPER_BOUND = 32768.0;\n\nconst float SHIFT_LEFT16 = 65536.0;\nconst float SHIFT_LEFT12 = 4096.0;\nconst float SHIFT_LEFT8 = 256.0;\nconst float SHIFT_LEFT7 = 128.0;\nconst float SHIFT_LEFT5 = 32.0;\nconst float SHIFT_LEFT3 = 8.0;\nconst float SHIFT_LEFT2 = 4.0;\nconst float SHIFT_LEFT1 = 2.0;\n\nconst float SHIFT_RIGHT12 = 1.0 / 4096.0;\nconst float SHIFT_RIGHT8 = 1.0 / 256.0;\nconst float SHIFT_RIGHT7 = 1.0 / 128.0;\nconst float SHIFT_RIGHT5 = 1.0 / 32.0;\nconst float SHIFT_RIGHT3 = 1.0 / 8.0;\nconst float SHIFT_RIGHT2 = 1.0 / 4.0;\nconst float SHIFT_RIGHT1 = 1.0 / 2.0;\n\nvec4 addScreenSpaceOffset(vec4 positionEC, vec2 imageSize, float scale, vec2 direction, vec2 origin, vec2 translate, vec2 pixelOffset, vec3 alignedAxis, bool validAlignedAxis, float rotation, bool sizeInMeters, out mat2 rotationMatrix, out float mpp)\n{\n    // Note the halfSize cannot be computed in JavaScript because it is sent via\n    // compressed vertex attributes that coerce it to an integer.\n    vec2 halfSize = imageSize * scale * 0.5;\n    halfSize *= ((direction * 2.0) - 1.0);\n\n    vec2 originTranslate = origin * abs(halfSize);\n\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\n    if (validAlignedAxis || rotation != 0.0)\n    {\n        float angle = rotation;\n        if (validAlignedAxis)\n        {\n            vec4 projectedAlignedAxis = czm_modelViewProjection * vec4(alignedAxis, 0.0);\n            angle += sign(-projectedAlignedAxis.x) * acos(sign(projectedAlignedAxis.y) * (projectedAlignedAxis.y * projectedAlignedAxis.y) /\n                    (projectedAlignedAxis.x * projectedAlignedAxis.x + projectedAlignedAxis.y * projectedAlignedAxis.y));\n        }\n\n        float cosTheta = cos(angle);\n        float sinTheta = sin(angle);\n        rotationMatrix = mat2(cosTheta, sinTheta, -sinTheta, cosTheta);\n        halfSize = rotationMatrix * halfSize;\n    }\n    else\n    {\n        rotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);\n    }\n#endif\n\n    mpp = czm_metersPerPixel(positionEC);\n    positionEC.xy += (originTranslate + halfSize) * czm_branchFreeTernary(sizeInMeters, 1.0, mpp);\n    positionEC.xy += (translate + pixelOffset) * mpp;\n\n    return positionEC;\n}\n\n#ifdef VERTEX_DEPTH_CHECK\nfloat getGlobeDepth(vec4 positionEC)\n{\n    vec4 posWC = czm_eyeToWindowCoordinates(positionEC);\n\n    float globeDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, posWC.xy / czm_viewport.zw));\n\n    if (globeDepth == 0.0)\n    {\n        return 0.0; // not on the globe\n    }\n\n    vec4 eyeCoordinate = czm_windowToEyeCoordinates(posWC.xy, globeDepth);\n    return eyeCoordinate.z / eyeCoordinate.w;\n}\n#endif\nvoid main()\n{\n    // Modifying this shader may also require modifications to Billboard._computeScreenSpacePosition\n\n    // unpack attributes\n    vec3 positionHigh = positionHighAndScale.xyz;\n    vec3 positionLow = positionLowAndRotation.xyz;\n    float scale = positionHighAndScale.w;\n\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\n    float rotation = positionLowAndRotation.w;\n#else\n    float rotation = 0.0;\n#endif\n\n    float compressed = compressedAttribute0.x;\n\n    vec2 pixelOffset;\n    pixelOffset.x = floor(compressed * SHIFT_RIGHT7);\n    compressed -= pixelOffset.x * SHIFT_LEFT7;\n    pixelOffset.x -= UPPER_BOUND;\n\n    vec2 origin;\n    origin.x = floor(compressed * SHIFT_RIGHT5);\n    compressed -= origin.x * SHIFT_LEFT5;\n\n    origin.y = floor(compressed * SHIFT_RIGHT3);\n    compressed -= origin.y * SHIFT_LEFT3;\n\n#ifdef FRAGMENT_DEPTH_CHECK\n    vec2 depthOrigin = origin.xy;\n#endif\n    origin -= vec2(1.0);\n\n    float show = floor(compressed * SHIFT_RIGHT2);\n    compressed -= show * SHIFT_LEFT2;\n\n#ifdef INSTANCED\n    vec2 textureCoordinatesBottomLeft = czm_decompressTextureCoordinates(compressedAttribute0.w);\n    vec2 textureCoordinatesRange = czm_decompressTextureCoordinates(eyeOffset.w);\n    vec2 textureCoordinates = textureCoordinatesBottomLeft + direction * textureCoordinatesRange;\n#else\n    vec2 direction;\n    direction.x = floor(compressed * SHIFT_RIGHT1);\n    direction.y = compressed - direction.x * SHIFT_LEFT1;\n\n    vec2 textureCoordinates = czm_decompressTextureCoordinates(compressedAttribute0.w);\n#endif\n\n    float temp = compressedAttribute0.y  * SHIFT_RIGHT8;\n    pixelOffset.y = -(floor(temp) - UPPER_BOUND);\n\n    vec2 translate;\n    translate.y = (temp - floor(temp)) * SHIFT_LEFT16;\n\n    temp = compressedAttribute0.z * SHIFT_RIGHT8;\n    translate.x = floor(temp) - UPPER_BOUND;\n\n    translate.y += (temp - floor(temp)) * SHIFT_LEFT8;\n    translate.y -= UPPER_BOUND;\n\n    temp = compressedAttribute1.x * SHIFT_RIGHT8;\n    float temp2 = floor(compressedAttribute2.w * SHIFT_RIGHT2);\n\n    vec2 imageSize = vec2(floor(temp), temp2);\n\n#ifdef FRAGMENT_DEPTH_CHECK\n    float labelHorizontalOrigin = floor(compressedAttribute2.w - (temp2 * SHIFT_LEFT2));\n    float applyTranslate = 0.0;\n    if (labelHorizontalOrigin != 0.0) // is a billboard, so set apply translate to false\n    {\n        applyTranslate = 1.0;\n        labelHorizontalOrigin -= 2.0;\n        depthOrigin.x = labelHorizontalOrigin + 1.0;\n    }\n\n    depthOrigin = vec2(1.0) - (depthOrigin * 0.5);\n#endif\n\n#ifdef EYE_DISTANCE_TRANSLUCENCY\n    vec4 translucencyByDistance;\n    translucencyByDistance.x = compressedAttribute1.z;\n    translucencyByDistance.z = compressedAttribute1.w;\n\n    translucencyByDistance.y = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\n\n    temp = compressedAttribute1.y * SHIFT_RIGHT8;\n    translucencyByDistance.w = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\n#endif\n\n#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)\n    temp = compressedAttribute3.w;\n    temp = temp * SHIFT_RIGHT12;\n\n    vec2 dimensions;\n    dimensions.y = (temp - floor(temp)) * SHIFT_LEFT12;\n    dimensions.x = floor(temp);\n#endif\n\n#ifdef ALIGNED_AXIS\n    vec3 alignedAxis = czm_octDecode(floor(compressedAttribute1.y * SHIFT_RIGHT8));\n    temp = compressedAttribute2.z * SHIFT_RIGHT5;\n    bool validAlignedAxis = (temp - floor(temp)) * SHIFT_LEFT1 > 0.0;\n#else\n    vec3 alignedAxis = vec3(0.0);\n    bool validAlignedAxis = false;\n#endif\n\n    vec4 pickColor;\n    vec4 color;\n\n    temp = compressedAttribute2.y;\n    temp = temp * SHIFT_RIGHT8;\n    pickColor.b = (temp - floor(temp)) * SHIFT_LEFT8;\n    temp = floor(temp) * SHIFT_RIGHT8;\n    pickColor.g = (temp - floor(temp)) * SHIFT_LEFT8;\n    pickColor.r = floor(temp);\n\n    temp = compressedAttribute2.x;\n    temp = temp * SHIFT_RIGHT8;\n    color.b = (temp - floor(temp)) * SHIFT_LEFT8;\n    temp = floor(temp) * SHIFT_RIGHT8;\n    color.g = (temp - floor(temp)) * SHIFT_LEFT8;\n    color.r = floor(temp);\n\n    temp = compressedAttribute2.z * SHIFT_RIGHT8;\n    bool sizeInMeters = floor((temp - floor(temp)) * SHIFT_LEFT7) > 0.0;\n    temp = floor(temp) * SHIFT_RIGHT8;\n\n    pickColor.a = (temp - floor(temp)) * SHIFT_LEFT8;\n    pickColor /= 255.0;\n\n    color.a = floor(temp);\n    color /= 255.0;\n\n    ///////////////////////////////////////////////////////////////////////////\n\n    vec4 p = czm_translateRelativeToEye(positionHigh, positionLow);\n    vec4 positionEC = czm_modelViewRelativeToEye * p;\n\n#if defined(FRAGMENT_DEPTH_CHECK) || defined(VERTEX_DEPTH_CHECK)\n    float eyeDepth = positionEC.z;\n#endif\n\n    positionEC = czm_eyeOffset(positionEC, eyeOffset.xyz);\n    positionEC.xyz *= show;\n\n    ///////////////////////////////////////////////////////////////////////////\n\n#if defined(EYE_DISTANCE_SCALING) || defined(EYE_DISTANCE_TRANSLUCENCY) || defined(EYE_DISTANCE_PIXEL_OFFSET) || defined(DISTANCE_DISPLAY_CONDITION) || defined(DISABLE_DEPTH_DISTANCE)\n    float lengthSq;\n    if (czm_sceneMode == czm_sceneMode2D)\n    {\n        // 2D camera distance is a special case\n        // treat all billboards as flattened to the z=0.0 plane\n        lengthSq = czm_eyeHeight2D.y;\n    }\n    else\n    {\n        lengthSq = dot(positionEC.xyz, positionEC.xyz);\n    }\n#endif\n\n#ifdef EYE_DISTANCE_SCALING\n    float distanceScale = czm_nearFarScalar(scaleByDistance, lengthSq);\n    scale *= distanceScale;\n    translate *= distanceScale;\n    // push vertex behind near plane for clipping\n    if (scale == 0.0)\n    {\n        positionEC.xyz = vec3(0.0);\n    }\n#endif\n\n    float translucency = 1.0;\n#ifdef EYE_DISTANCE_TRANSLUCENCY\n    translucency = czm_nearFarScalar(translucencyByDistance, lengthSq);\n    // push vertex behind near plane for clipping\n    if (translucency == 0.0)\n    {\n        positionEC.xyz = vec3(0.0);\n    }\n#endif\n\n#ifdef EYE_DISTANCE_PIXEL_OFFSET\n    float pixelOffsetScale = czm_nearFarScalar(pixelOffsetScaleByDistance, lengthSq);\n    pixelOffset *= pixelOffsetScale;\n#endif\n\n#ifdef DISTANCE_DISPLAY_CONDITION\n    float nearSq = compressedAttribute3.x;\n    float farSq = compressedAttribute3.y;\n    if (lengthSq < nearSq || lengthSq > farSq)\n    {\n        positionEC.xyz = vec3(0.0);\n    }\n#endif\n\n    mat2 rotationMatrix;\n    float mpp;\n\n#ifdef DISABLE_DEPTH_DISTANCE\n    float disableDepthTestDistance = compressedAttribute3.z;\n#endif\n\n#ifdef VERTEX_DEPTH_CHECK\nif (lengthSq < disableDepthTestDistance) {\n    float depthsilon = 10.0;\n\n    vec2 labelTranslate = textureCoordinateBoundsOrLabelTranslate.xy;\n    vec4 pEC1 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\n    float globeDepth1 = getGlobeDepth(pEC1);\n\n    if (globeDepth1 != 0.0 && pEC1.z + depthsilon < globeDepth1)\n    {\n        vec4 pEC2 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0, 1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\n        float globeDepth2 = getGlobeDepth(pEC2);\n\n        if (globeDepth2 != 0.0 && pEC2.z + depthsilon < globeDepth2)\n        {\n            vec4 pEC3 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\n            float globeDepth3 = getGlobeDepth(pEC3);\n            if (globeDepth3 != 0.0 && pEC3.z + depthsilon < globeDepth3)\n            {\n                positionEC.xyz = vec3(0.0);\n            }\n        }\n    }\n}\n#endif\n\n    positionEC = addScreenSpaceOffset(positionEC, imageSize, scale, direction, origin, translate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\n    gl_Position = czm_projection * positionEC;\n    v_textureCoordinates = textureCoordinates;\n\n#ifdef LOG_DEPTH\n    czm_vertexLogDepth();\n#endif\n\n#ifdef DISABLE_DEPTH_DISTANCE\n    if (disableDepthTestDistance == 0.0 && czm_minimumDisableDepthTestDistance != 0.0)\n    {\n        disableDepthTestDistance = czm_minimumDisableDepthTestDistance;\n    }\n\n    if (disableDepthTestDistance != 0.0)\n    {\n        // Don't try to \"multiply both sides\" by w.  Greater/less-than comparisons won't work for negative values of w.\n        float zclip = gl_Position.z / gl_Position.w;\n        bool clipped = (zclip < -1.0 || zclip > 1.0);\n        if (!clipped && (disableDepthTestDistance < 0.0 || (lengthSq > 0.0 && lengthSq < disableDepthTestDistance)))\n        {\n            // Position z on the near plane.\n            gl_Position.z = -gl_Position.w;\n#ifdef LOG_DEPTH\n            v_depthFromNearPlusOne = 1.0;\n#endif\n        }\n    }\n#endif\n\n#ifdef FRAGMENT_DEPTH_CHECK\n    if (sizeInMeters) {\n        translate /= mpp;\n        dimensions /= mpp;\n        imageSize /= mpp;\n    }\n\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\n    v_rotationMatrix = rotationMatrix;\n#else\n    v_rotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);\n#endif\n\n    float enableDepthCheck = 0.0;\n    if (lengthSq < disableDepthTestDistance)\n    {\n        enableDepthCheck = 1.0;\n    }\n\n    float dw = floor(clamp(dimensions.x, 0.0, SHIFT_LEFT12));\n    float dh = floor(clamp(dimensions.y, 0.0, SHIFT_LEFT12));\n\n    float iw = floor(clamp(imageSize.x, 0.0, SHIFT_LEFT12));\n    float ih = floor(clamp(imageSize.y, 0.0, SHIFT_LEFT12));\n\n    v_compressed.x = eyeDepth;\n    v_compressed.y = applyTranslate * SHIFT_LEFT1 + enableDepthCheck;\n    v_compressed.z = dw * SHIFT_LEFT12 + dh;\n    v_compressed.w = iw * SHIFT_LEFT12 + ih;\n    v_originTextureCoordinateAndTranslate.xy = depthOrigin;\n    v_originTextureCoordinateAndTranslate.zw = translate;\n    v_textureCoordinateBounds = textureCoordinateBoundsOrLabelTranslate;\n\n#endif\n\n#ifdef SDF\n    vec4 outlineColor;\n    float outlineWidth;\n\n    temp = sdf.x;\n    temp = temp * SHIFT_RIGHT8;\n    outlineColor.b = (temp - floor(temp)) * SHIFT_LEFT8;\n    temp = floor(temp) * SHIFT_RIGHT8;\n    outlineColor.g = (temp - floor(temp)) * SHIFT_LEFT8;\n    outlineColor.r = floor(temp);\n\n    temp = sdf.y;\n    temp = temp * SHIFT_RIGHT8;\n    float temp3 = (temp - floor(temp)) * SHIFT_LEFT8;\n    temp = floor(temp) * SHIFT_RIGHT8;\n    outlineWidth = (temp - floor(temp)) * SHIFT_LEFT8;\n    outlineColor.a = floor(temp);\n    outlineColor /= 255.0;\n\n    v_outlineWidth = outlineWidth / 255.0;\n    v_outlineColor = outlineColor;\n    v_outlineColor.a *= translucency;\n#endif\n\n    v_pickColor = pickColor;\n\n    v_color = color;\n    v_color.a *= translucency;\n\n}\n";const noe={},ioe=new Xe(0,0,0,1);let ooe=new Xe;const roe=new bf,soe=new ro,aoe=new ro;noe.wgs84ToWindowCoordinates=function(e,t,n){return noe.wgs84WithEyeOffsetToWindowCoordinates(e,t,K.ZERO,n)};const coe=new Xe,loe=new K;function uoe(e,t,n,i){const o=n.viewMatrix,r=ft.multiplyByVector(o,Xe.fromElements(e.x,e.y,e.z,1,coe),coe),s=K.multiplyComponents(t,K.normalize(r,loe),loe);return r.x+=t.x+s.x,r.y+=t.y+s.y,r.z+=s.z,ft.multiplyByVector(n.frustum.projectionMatrix,r,i)}const hoe=new se(Math.PI,z.PI_OVER_TWO),doe=new K,foe=new K;noe.wgs84WithEyeOffsetToWindowCoordinates=function(e,t,n,i){if(!C(e))throw new x("scene is required.");if(!C(t))throw new x("position is required.");const o=e.frameState,r=noe.computeActualWgs84Position(o,t,ioe);if(!C(r))return;const s=e.canvas,a=roe;a.x=0,a.y=0,a.width=s.clientWidth,a.height=s.clientHeight;const c=e.camera;let l=!1;if(o.mode===ij.SCENE2D){const t=e.mapProjection,o=hoe,u=t.project(o,doe),h=K.clone(c.position,foe),d=c.frustum.clone(),f=ft.computeViewportTransformation(a,0,1,new ft),p=c.frustum.projectionMatrix,m=c.positionWC.y,_=K.fromElements(z.sign(m)*u.x-m,0,-c.positionWC.x),g=Kl.pointToGLWindowCoordinates(p,f,_);if(0===m||g.x<=0||g.x>=s.clientWidth)l=!0;else{if(g.x>.5*s.clientWidth){a.width=g.x,c.frustum.right=u.x-m,ooe=uoe(r,n,c,ooe),noe.clipToGLWindowCoordinates(a,ooe,soe),a.x+=g.x,c.position.x=-c.position.x;const e=c.frustum.right;c.frustum.right=-c.frustum.left,c.frustum.left=-e,ooe=uoe(r,n,c,ooe),noe.clipToGLWindowCoordinates(a,ooe,aoe)}else{a.x+=g.x,a.width-=g.x,c.frustum.left=-u.x-m,ooe=uoe(r,n,c,ooe),noe.clipToGLWindowCoordinates(a,ooe,soe),a.x=a.x-a.width,c.position.x=-c.position.x;const e=c.frustum.left;c.frustum.left=-c.frustum.right,c.frustum.right=-e,ooe=uoe(r,n,c,ooe),noe.clipToGLWindowCoordinates(a,ooe,aoe)}K.clone(h,c.position),c.frustum=d.clone(),i=ro.clone(soe,i),(i.x<0||i.x>s.clientWidth)&&(i.x=aoe.x)}}if(o.mode!==ij.SCENE2D||l){if(ooe=uoe(r,n,c,ooe),ooe.z<0&&!(c.frustum instanceof jC)&&!(c.frustum instanceof GC))return;i=noe.clipToGLWindowCoordinates(a,ooe,i)}return i.y=s.clientHeight-i.y,i},noe.wgs84ToDrawingBufferCoordinates=function(e,t,n){if(n=noe.wgs84ToWindowCoordinates(e,t,n),C(n))return noe.transformWindowToDrawingBuffer(e,n,n)};const poe=new K,moe=new se;noe.computeActualWgs84Position=function(e,t,n){const i=e.mode;if(i===ij.SCENE3D)return K.clone(t,n);const o=e.mapProjection,r=o.ellipsoid.cartesianToCartographic(t,moe);if(!C(r))return;if(o.project(r,poe),i===ij.COLUMBUS_VIEW)return K.fromElements(poe.z,poe.x,poe.y,n);if(i===ij.SCENE2D)return K.fromElements(0,poe.x,poe.y,n);const s=e.morphTime;return K.fromElements(z.lerp(poe.z,t.x,s),z.lerp(poe.x,t.y,s),z.lerp(poe.y,t.z,s),n)};const _oe=new K,goe=new K,yoe=new ft;noe.clipToGLWindowCoordinates=function(e,t,n){return K.divideByScalar(t,t.w,_oe),ft.computeViewportTransformation(e,0,1,yoe),ft.multiplyByPoint(yoe,_oe,goe),ro.fromCartesian3(goe,n)},noe.transformWindowToDrawingBuffer=function(e,t,n){const i=e.canvas,o=e.drawingBufferWidth/i.clientWidth,r=e.drawingBufferHeight/i.clientHeight;return ro.fromElements(t.x*o,t.y*r,n)};const voe=new Xe,boe=new Xe;noe.drawingBufferToWgs84Coordinates=function(e,t,n,i){const o=e.context,r=o.uniformState,s=r.currentFrustum,a=s.x,c=s.y;if(e.frameState.useLogDepth){const e=n*r.log2FarDepthFromNearPlusOne,t=Math.pow(2,e)-1;n=c*(1-a/(t+a))/(c-a)}const l=e.view.passState.viewport,u=Xe.clone(Xe.UNIT_W,voe);let h;u.x=(t.x-l.x)/l.width*2-1,u.y=(t.y-l.y)/l.height*2-1,u.z=2*n-1,u.w=1;let d=e.camera.frustum;if(C(d.fovy)){h=ft.multiplyByVector(r.inverseViewProjection,u,boe);const e=1/h.w;K.multiplyByScalar(h,e,h)}else C(d._offCenterFrustum)&&(d=d._offCenterFrustum),h=boe,h.x=.5*(u.x*(d.right-d.left)+d.left+d.right),h.y=.5*(u.y*(d.top-d.bottom)+d.bottom+d.top),h.z=.5*(u.z*(a-c)-a-c),h.w=1,h=ft.multiplyByVector(r.inverseView,h,h);return K.fromCartesian4(h,i)};var Aoe=noe;function woe(e,t){if(e=R(e,R.EMPTY_OBJECT),C(e.disableDepthTestDistance)&&e.disableDepthTestDistance<0)throw new x("disableDepthTestDistance must be greater than or equal to 0.0.");let n=e.translucencyByDistance,i=e.pixelOffsetScaleByDistance,o=e.scaleByDistance,r=e.distanceDisplayCondition;if(C(n)){if(n.far<=n.near)throw new x("translucencyByDistance.far must be greater than translucencyByDistance.near.");n=LO.clone(n)}if(C(i)){if(i.far<=i.near)throw new x("pixelOffsetScaleByDistance.far must be greater than pixelOffsetScaleByDistance.near.");i=LO.clone(i)}if(C(o)){if(o.far<=o.near)throw new x("scaleByDistance.far must be greater than scaleByDistance.near.");o=LO.clone(o)}if(C(r)){if(r.far<=r.near)throw new x("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");r=WT.clone(r)}this._show=R(e.show,!0),this._position=K.clone(R(e.position,K.ZERO)),this._actualPosition=K.clone(this._position),this._pixelOffset=ro.clone(R(e.pixelOffset,ro.ZERO)),this._translate=new ro(0,0),this._eyeOffset=K.clone(R(e.eyeOffset,K.ZERO)),this._heightReference=R(e.heightReference,Sz.NONE),this._verticalOrigin=R(e.verticalOrigin,Pz.CENTER),this._horizontalOrigin=R(e.horizontalOrigin,Oz.CENTER),this._scale=R(e.scale,1),this._color=xy.clone(R(e.color,xy.WHITE)),this._rotation=R(e.rotation,0),this._alignedAxis=K.clone(R(e.alignedAxis,K.ZERO)),this._width=e.width,this._height=e.height,this._scaleByDistance=o,this._translucencyByDistance=n,this._pixelOffsetScaleByDistance=i,this._sizeInMeters=R(e.sizeInMeters,!1),this._distanceDisplayCondition=r,this._disableDepthTestDistance=e.disableDepthTestDistance,this._id=e.id,this._collection=R(e.collection,t),this._pickId=void 0,this._pickPrimitive=R(e._pickPrimitive,this),this._billboardCollection=t,this._dirty=!1,this._index=-1,this._batchIndex=void 0,this._imageIndex=-1,this._imageIndexPromise=void 0,this._imageId=void 0,this._image=void 0,this._imageSubRegion=void 0,this._imageWidth=void 0,this._imageHeight=void 0,this._labelDimensions=void 0,this._labelHorizontalOrigin=void 0,this._labelTranslate=void 0;const s=e.image;let a=e.imageId;C(s)&&(C(a)||(a="string"===typeof s?s:C(s.src)?s.src:wk()),this._imageId=a,this._image=s),C(e.imageSubRegion)&&(this._imageId=a,this._imageSubRegion=e.imageSubRegion),C(this._billboardCollection._textureAtlas)&&this._loadImage(),this._actualClampedPosition=void 0,this._removeCallbackFunc=void 0,this._mode=ij.SCENE3D,this._clusterShow=!0,this._outlineColor=xy.clone(R(e.outlineColor,xy.BLACK)),this._outlineWidth=R(e.outlineWidth,0),this._updateClamping()}const Toe=woe.SHOW_INDEX=0,Coe=woe.POSITION_INDEX=1,Eoe=woe.PIXEL_OFFSET_INDEX=2,xoe=woe.EYE_OFFSET_INDEX=3,Soe=woe.HORIZONTAL_ORIGIN_INDEX=4,Ioe=woe.VERTICAL_ORIGIN_INDEX=5,Ooe=woe.SCALE_INDEX=6,Doe=woe.IMAGE_INDEX_INDEX=7,Poe=woe.COLOR_INDEX=8,Roe=woe.ROTATION_INDEX=9,Loe=woe.ALIGNED_AXIS_INDEX=10,Moe=woe.SCALE_BY_DISTANCE_INDEX=11,Boe=woe.TRANSLUCENCY_BY_DISTANCE_INDEX=12,Noe=woe.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX=13,Foe=woe.DISTANCE_DISPLAY_CONDITION=14,zoe=woe.DISABLE_DEPTH_DISTANCE=15;woe.TEXTURE_COORDINATE_BOUNDS=16;const koe=woe.SDF_INDEX=17;function Uoe(e,t){const n=e._billboardCollection;C(n)&&(n._updateBillboard(e,t),e._dirty=!0)}woe.NUMBER_OF_PROPERTIES=18,Object.defineProperties(woe.prototype,{show:{get:function(){return this._show},set:function(e){D.typeOf.bool("value",e),this._show!==e&&(this._show=e,Uoe(this,Toe))}},position:{get:function(){return this._position},set:function(e){D.typeOf.object("value",e);const t=this._position;K.equals(t,e)||(K.clone(e,t),K.clone(e,this._actualPosition),this._updateClamping(),Uoe(this,Coe))}},heightReference:{get:function(){return this._heightReference},set:function(e){D.typeOf.number("value",e);const t=this._heightReference;e!==t&&(this._heightReference=e,this._updateClamping(),Uoe(this,Coe))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(e){D.typeOf.object("value",e);const t=this._pixelOffset;ro.equals(t,e)||(ro.clone(e,t),Uoe(this,Eoe))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){if(C(e)&&(D.typeOf.object("value",e),e.far<=e.near))throw new x("far distance must be greater than near distance.");const t=this._scaleByDistance;LO.equals(t,e)||(this._scaleByDistance=LO.clone(e,t),Uoe(this,Moe))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){if(C(e)&&(D.typeOf.object("value",e),e.far<=e.near))throw new x("far distance must be greater than near distance.");const t=this._translucencyByDistance;LO.equals(t,e)||(this._translucencyByDistance=LO.clone(e,t),Uoe(this,Boe))}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){if(C(e)&&(D.typeOf.object("value",e),e.far<=e.near))throw new x("far distance must be greater than near distance.");const t=this._pixelOffsetScaleByDistance;LO.equals(t,e)||(this._pixelOffsetScaleByDistance=LO.clone(e,t),Uoe(this,Noe))}},eyeOffset:{get:function(){return this._eyeOffset},set:function(e){D.typeOf.object("value",e);const t=this._eyeOffset;K.equals(t,e)||(K.clone(e,t),Uoe(this,xoe))}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){D.typeOf.number("value",e),this._horizontalOrigin!==e&&(this._horizontalOrigin=e,Uoe(this,Soe))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){D.typeOf.number("value",e),this._verticalOrigin!==e&&(this._verticalOrigin=e,Uoe(this,Ioe))}},scale:{get:function(){return this._scale},set:function(e){D.typeOf.number("value",e),this._scale!==e&&(this._scale=e,Uoe(this,Ooe))}},color:{get:function(){return this._color},set:function(e){D.typeOf.object("value",e);const t=this._color;xy.equals(t,e)||(xy.clone(e,t),Uoe(this,Poe))}},rotation:{get:function(){return this._rotation},set:function(e){D.typeOf.number("value",e),this._rotation!==e&&(this._rotation=e,Uoe(this,Roe))}},alignedAxis:{get:function(){return this._alignedAxis},set:function(e){D.typeOf.object("value",e);const t=this._alignedAxis;K.equals(t,e)||(K.clone(e,t),Uoe(this,Loe))}},width:{get:function(){return R(this._width,this._imageWidth)},set:function(e){C(e)&&D.typeOf.number("value",e),this._width!==e&&(this._width=e,Uoe(this,Doe))}},height:{get:function(){return R(this._height,this._imageHeight)},set:function(e){C(e)&&D.typeOf.number("value",e),this._height!==e&&(this._height=e,Uoe(this,Doe))}},sizeInMeters:{get:function(){return this._sizeInMeters},set:function(e){D.typeOf.bool("value",e),this._sizeInMeters!==e&&(this._sizeInMeters=e,Uoe(this,Poe))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(!WT.equals(e,this._distanceDisplayCondition)){if(C(e)&&(D.typeOf.object("value",e),e.far<=e.near))throw new x("far distance must be greater than near distance.");this._distanceDisplayCondition=WT.clone(e,this._distanceDisplayCondition),Uoe(this,Foe)}}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){if(C(e)&&(D.typeOf.number("value",e),e<0))throw new x("disableDepthTestDistance must be greater than or equal to 0.0.");this._disableDepthTestDistance!==e&&(this._disableDepthTestDistance=e,Uoe(this,zoe))}},id:{get:function(){return this._id},set:function(e){this._id=e,C(this._pickId)&&(this._pickId.object.id=e)}},pickPrimitive:{get:function(){return this._pickPrimitive},set:function(e){this._pickPrimitive=e,C(this._pickId)&&(this._pickId.object.primitive=e)}},pickId:{get:function(){return this._pickId}},image:{get:function(){return this._imageId},set:function(e){C(e)?"string"===typeof e?this.setImage(e,e):e instanceof Vi?this.setImage(e.url,e):C(e.src)?this.setImage(e.src,e):this.setImage(wk(),e):(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=void 0,this._image=void 0,this._imageIndexPromise=void 0,Uoe(this,Doe))}},ready:{get:function(){return-1!==this._imageIndex}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(e){this._actualClampedPosition=K.clone(e,this._actualClampedPosition),Uoe(this,Coe)}},clusterShow:{get:function(){return this._clusterShow},set:function(e){this._clusterShow!==e&&(this._clusterShow=e,Uoe(this,Toe))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){if(!C(e))throw new x("value is required.");const t=this._outlineColor;xy.equals(t,e)||(xy.clone(e,t),Uoe(this,koe))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,Uoe(this,koe))}}}),woe.prototype.getPickId=function(e){return C(this._pickId)||(this._pickId=e.createPickId({primitive:this._pickPrimitive,collection:this._collection,id:this._id})),this._pickId},woe.prototype._updateClamping=function(){woe._updateClamping(this._billboardCollection,this)};const Voe=new se,Hoe=new K;woe._updateClamping=function(e,t){const n=e._scene;if(!C(n)||!C(n.globe)){if(t._heightReference!==Sz.NONE)throw new x("Height reference is not supported without a scene and globe.");return}const i=n.globe,o=i.ellipsoid,r=i._surface,s=n.frameState.mode,a=s!==t._mode;if(t._mode=s,(t._heightReference===Sz.NONE||a)&&C(t._removeCallbackFunc)&&(t._removeCallbackFunc(),t._removeCallbackFunc=void 0,t._clampedPosition=void 0),t._heightReference===Sz.NONE||!C(t._position))return;const c=o.cartesianToCartographic(t._position);if(!C(c))return void(t._actualClampedPosition=void 0);function l(e){if(t._heightReference===Sz.RELATIVE_TO_GROUND)if(t._mode===ij.SCENE3D){const t=o.cartesianToCartographic(e,Voe);t.height+=c.height,o.cartographicToCartesian(t,e)}else e.x+=c.height;t._clampedPosition=K.clone(e,t._clampedPosition)}C(t._removeCallbackFunc)&&t._removeCallbackFunc(),t._removeCallbackFunc=r.updateHeight(c,l),se.clone(c,Voe);const u=i.getHeight(c);C(u)&&(Voe.height=u),o.cartographicToCartesian(Voe,Hoe),l(Hoe)},woe.prototype._loadImage=function(){const e=this._billboardCollection._textureAtlas,t=this._imageId,n=this._image,i=this._imageSubRegion;let o;if(C(n)&&(o=e.addImage(t,n)),C(i)&&(o=e.addSubRegion(t,i)),this._imageIndexPromise=o,!C(o))return;const r=this;o.then((function(o){if(r._imageId!==t||r._image!==n||!bf.equals(r._imageSubRegion,i))return;const s=e.textureCoordinates[o];r._imageWidth=e.texture.width*s.width,r._imageHeight=e.texture.height*s.height,r._imageIndex=o,r._ready=!0,r._image=void 0,r._imageIndexPromise=void 0,Uoe(r,Doe)})).catch((function(e){console.error(`Error loading image for billboard: ${e}`),r._imageIndexPromise=void 0}))},woe.prototype.setImage=function(e,t){if(!C(e))throw new x("id is required.");if(!C(t))throw new x("image is required.");this._imageId!==e&&(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=e,this._image=t,C(this._billboardCollection._textureAtlas)&&this._loadImage())},woe.prototype.setImageSubRegion=function(e,t){if(!C(e))throw new x("id is required.");if(!C(t))throw new x("subRegion is required.");this._imageId===e&&bf.equals(this._imageSubRegion,t)||(this._imageIndex=-1,this._imageId=e,this._imageSubRegion=bf.clone(t),C(this._billboardCollection._textureAtlas)&&this._loadImage())},woe.prototype._setTranslate=function(e){if(!C(e))throw new x("value is required.");const t=this._translate;ro.equals(t,e)||(ro.clone(e,t),Uoe(this,Eoe))},woe.prototype._getActualPosition=function(){return C(this._clampedPosition)?this._clampedPosition:this._actualPosition},woe.prototype._setActualPosition=function(e){C(this._clampedPosition)||K.clone(e,this._actualPosition),Uoe(this,Coe)};const Goe=new Xe;woe._computeActualPosition=function(e,t,n,i){return C(e._clampedPosition)?(n.mode!==e._mode&&e._updateClamping(),e._clampedPosition):n.mode===ij.SCENE3D?t:(ft.multiplyByPoint(i,t,Goe),Aoe.computeActualWgs84Position(n,Goe))};const Woe=new K;woe._computeScreenSpacePosition=function(e,t,n,i,o,r){const s=ft.multiplyByPoint(e,t,Woe),a=Aoe.wgs84WithEyeOffsetToWindowCoordinates(o,s,n,r);if(C(a))return ro.add(a,i,a),a};const qoe=new ro(0,0);woe.prototype.computeScreenSpacePosition=function(e,t){const n=this._billboardCollection;if(C(t)||(t=new ro),!C(n))throw new x("Billboard must be in a collection.  Was it removed?");if(!C(e))throw new x("scene is required.");ro.clone(this._pixelOffset,qoe),ro.add(qoe,this._translate,qoe);let i=n.modelMatrix,o=this._position;if(C(this._clampedPosition)&&(o=this._clampedPosition,e.mode!==ij.SCENE3D)){const t=e.mapProjection,n=t.ellipsoid,r=t.unproject(o,Voe);o=n.cartographicToCartesian(r,Woe),i=ft.IDENTITY}const r=woe._computeScreenSpacePosition(i,o,this._eyeOffset,qoe,e,t);return r},woe.getScreenSpaceBoundingBox=function(e,t,n){let i=e.width,o=e.height;const r=e.scale;i*=r,o*=r;let s=t.x;e.horizontalOrigin===Oz.RIGHT?s-=i:e.horizontalOrigin===Oz.CENTER&&(s-=.5*i);let a=t.y;return e.verticalOrigin===Pz.BOTTOM||e.verticalOrigin===Pz.BASELINE?a-=o:e.verticalOrigin===Pz.CENTER&&(a-=.5*o),C(n)||(n=new bf),n.x=s,n.y=a,n.width=i,n.height=o,n},woe.prototype.equals=function(e){return this===e||C(e)&&this._id===e._id&&K.equals(this._position,e._position)&&this._imageId===e._imageId&&this._show===e._show&&this._scale===e._scale&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&this._heightReference===e._heightReference&&bf.equals(this._imageSubRegion,e._imageSubRegion)&&xy.equals(this._color,e._color)&&ro.equals(this._pixelOffset,e._pixelOffset)&&ro.equals(this._translate,e._translate)&&K.equals(this._eyeOffset,e._eyeOffset)&&LO.equals(this._scaleByDistance,e._scaleByDistance)&&LO.equals(this._translucencyByDistance,e._translucencyByDistance)&&LO.equals(this._pixelOffsetScaleByDistance,e._pixelOffsetScaleByDistance)&&WT.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance},woe.prototype._destroy=function(){C(this._customData)&&(this._billboardCollection._scene.globe._surface.removeTileCustomData(this._customData),this._customData=void 0),C(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this.image=void 0,this._pickId=this._pickId&&this._pickId.destroy(),this._billboardCollection=void 0};var joe=woe;const Yoe={OPAQUE:0,TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2};var Koe=Object.freeze(Yoe);const Xoe={FONT_SIZE:48,PADDING:10,RADIUS:8,CUTOFF:.25};var Qoe=Object.freeze(Xoe);function Joe(e,t,n,i,o){this.bottomLeft=R(e,ro.ZERO),this.topRight=R(t,ro.ZERO),this.childNode1=n,this.childNode2=i,this.imageIndex=o}const Zoe=new ro(16,16);function $oe(e){e=R(e,R.EMPTY_OBJECT);const t=R(e.borderWidthInPixels,1),n=R(e.initialSize,Zoe);if(!C(e.context))throw new x("context is required.");if(t<0)throw new x("borderWidthInPixels must be greater than or equal to zero.");if(n.x<1||n.y<1)throw new x("initialSize must be greater than zero.");this._context=e.context,this._pixelFormat=R(e.pixelFormat,fD.RGBA),this._borderWidthInPixels=t,this._textureCoordinates=[],this._guid=wk(),this._idHash={},this._initialSize=n,this._root=void 0}function ere(e,t){const n=e._context,i=e.numberOfImages,o=2,r=e._borderWidthInPixels;if(i>0){const i=e._texture.width,s=e._texture.height,a=o*(i+t.width+r),c=o*(s+t.height+r),l=i/a,u=s/c,h=new Joe(new ro(i+r,r),new ro(a,s)),d=new Joe(new ro,new ro(a,s),e._root,h),f=new Joe(new ro(r,s+r),new ro(a,c)),p=new Joe(new ro,new ro(a,c),d,f);for(let t=0;t<e._textureCoordinates.length;t++){const n=e._textureCoordinates[t];C(n)&&(n.x*=l,n.y*=u,n.width*=l,n.height*=u)}const m=new Uk({context:e._context,width:a,height:c,pixelFormat:e._pixelFormat}),_=new mie({context:n,colorTextures:[e._texture],destroyAttachments:!1});_._bind(),m.copyFromFramebuffer(0,0,0,0,a,c),_._unBind(),_.destroy(),e._texture=e._texture&&e._texture.destroy(),e._texture=m,e._root=p}else{let n=o*(t.width+2*r),i=o*(t.height+2*r);n<e._initialSize.x&&(n=e._initialSize.x),i<e._initialSize.y&&(i=e._initialSize.y),e._texture=e._texture&&e._texture.destroy(),e._texture=new Uk({context:e._context,width:n,height:i,pixelFormat:e._pixelFormat}),e._root=new Joe(new ro(r,r),new ro(n,i))}}function tre(e,t,n){if(C(t)){if(!C(t.childNode1)&&!C(t.childNode2)){if(C(t.imageIndex))return;const i=t.topRight.x-t.bottomLeft.x,o=t.topRight.y-t.bottomLeft.y,r=i-n.width,s=o-n.height;if(r<0||s<0)return;if(0===r&&0===s)return t;if(r>s){t.childNode1=new Joe(new ro(t.bottomLeft.x,t.bottomLeft.y),new ro(t.bottomLeft.x+n.width,t.topRight.y));const i=t.bottomLeft.x+n.width+e._borderWidthInPixels;i<t.topRight.x&&(t.childNode2=new Joe(new ro(i,t.bottomLeft.y),new ro(t.topRight.x,t.topRight.y)))}else{t.childNode1=new Joe(new ro(t.bottomLeft.x,t.bottomLeft.y),new ro(t.topRight.x,t.bottomLeft.y+n.height));const i=t.bottomLeft.y+n.height+e._borderWidthInPixels;i<t.topRight.y&&(t.childNode2=new Joe(new ro(t.bottomLeft.x,i),new ro(t.topRight.x,t.topRight.y)))}return tre(e,t.childNode1,n)}return tre(e,t.childNode1,n)||tre(e,t.childNode2,n)}}function nre(e,t,n){const i=tre(e,e._root,t);if(C(i)){i.imageIndex=n;const o=e._texture.width,r=e._texture.height,s=i.topRight.x-i.bottomLeft.x,a=i.topRight.y-i.bottomLeft.y,c=i.bottomLeft.x/o,l=i.bottomLeft.y/r,u=s/o,h=a/r;e._textureCoordinates[n]=new bf(c,l,u,h),e._texture.copyFrom({source:t,xOffset:i.bottomLeft.x,yOffset:i.bottomLeft.y})}else ere(e,t),nre(e,t,n);e._guid=wk()}function ire(e,t){if(!C(e)||e.isDestroyed())return-1;const n=e.numberOfImages;return nre(e,t,n),n}Object.defineProperties($oe.prototype,{borderWidthInPixels:{get:function(){return this._borderWidthInPixels}},textureCoordinates:{get:function(){return this._textureCoordinates}},texture:{get:function(){return C(this._texture)||(this._texture=new Uk({context:this._context,width:this._initialSize.x,height:this._initialSize.y,pixelFormat:this._pixelFormat})),this._texture}},numberOfImages:{get:function(){return this._textureCoordinates.length}},guid:{get:function(){return this._guid}}}),$oe.prototype.addImageSync=function(e,t){if(!C(e))throw new x("id is required.");if(!C(t))throw new x("image is required.");let n=this._idHash[e];return C(n)||(n=ire(this,t),this._idHash[e]=Promise.resolve(n)),n},$oe.prototype.addImage=function(e,t){if(!C(e))throw new x("id is required.");if(!C(t))throw new x("image is required.");let n=this._idHash[e];if(C(n))return n;if("function"===typeof t){if(t=t(e),!C(t))throw new x("image is required.")}else if("string"===typeof t||t instanceof Vi){const e=Vi.createIfNeeded(t);t=e.fetchImage()}const i=this;return n=Promise.resolve(t).then((function(e){return ire(i,e)})),this._idHash[e]=n,n},$oe.prototype.addSubRegion=function(e,t){if(!C(e))throw new x("id is required.");if(!C(t))throw new x("subRegion is required.");const n=this._idHash[e];if(!C(n))throw new Je(`image with id "${e}" not found in the atlas.`);const i=this;return Promise.resolve(n).then((function(e){if(-1===e)return-1;const n=i._texture.width,o=i._texture.height,r=i.numberOfImages,s=i._textureCoordinates[e],a=s.x+t.x/n,c=s.y+t.y/o,l=t.width/n,u=t.height/o;return i._textureCoordinates.push(new bf(a,c,l,u)),i._guid=wk(),r}))},$oe.prototype.isDestroyed=function(){return!1},$oe.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),Qh(this)};var ore=$oe;const rre=joe.SHOW_INDEX,sre=joe.POSITION_INDEX,are=joe.PIXEL_OFFSET_INDEX,cre=joe.EYE_OFFSET_INDEX,lre=joe.HORIZONTAL_ORIGIN_INDEX,ure=joe.VERTICAL_ORIGIN_INDEX,hre=joe.SCALE_INDEX,dre=joe.IMAGE_INDEX_INDEX,fre=joe.COLOR_INDEX,pre=joe.ROTATION_INDEX,mre=joe.ALIGNED_AXIS_INDEX,_re=joe.SCALE_BY_DISTANCE_INDEX,gre=joe.TRANSLUCENCY_BY_DISTANCE_INDEX,yre=joe.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX,vre=joe.DISTANCE_DISPLAY_CONDITION,bre=joe.DISABLE_DEPTH_DISTANCE,Are=joe.TEXTURE_COORDINATE_BOUNDS,wre=joe.SDF_INDEX,Tre=joe.NUMBER_OF_PROPERTIES;let Cre;const Ere={positionHighAndScale:0,positionLowAndRotation:1,compressedAttribute0:2,compressedAttribute1:3,compressedAttribute2:4,eyeOffset:5,scaleByDistance:6,pixelOffsetScaleByDistance:7,compressedAttribute3:8,textureCoordinateBoundsOrLabelTranslate:9,a_batchId:10,sdf:11},xre={direction:0,positionHighAndScale:1,positionLowAndRotation:2,compressedAttribute0:3,compressedAttribute1:4,compressedAttribute2:5,eyeOffset:6,scaleByDistance:7,pixelOffsetScaleByDistance:8,compressedAttribute3:9,textureCoordinateBoundsOrLabelTranslate:10,a_batchId:11,sdf:12};function Sre(e){e=R(e,R.EMPTY_OBJECT),this._scene=e.scene,this._batchTable=e.batchTable,this._textureAtlas=void 0,this._textureAtlasGUID=void 0,this._destroyTextureAtlas=!0,this._sp=void 0,this._spTranslucent=void 0,this._rsOpaque=void 0,this._rsTranslucent=void 0,this._vaf=void 0,this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!1,this._shaderRotation=!1,this._compiledShaderRotation=!1,this._shaderAlignedAxis=!1,this._compiledShaderAlignedAxis=!1,this._shaderScaleByDistance=!1,this._compiledShaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._compiledShaderTranslucencyByDistance=!1,this._shaderPixelOffsetScaleByDistance=!1,this._compiledShaderPixelOffsetScaleByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDisableDepthDistance=!1,this._compiledShaderDisableDepthDistance=!1,this._shaderClampToGround=!1,this._compiledShaderClampToGround=!1,this._propertiesChanged=new Uint32Array(Tre),this._maxSize=0,this._maxEyeOffset=0,this._maxScale=1,this._maxPixelOffset=0,this._allHorizontalCenter=!0,this._allVerticalCenter=!0,this._allSizedInMeters=!0,this._baseVolume=new nn,this._baseVolumeWC=new nn,this._baseVolume2D=new nn,this._boundingVolume=new nn,this._boundingVolumeDirty=!1,this._colorCommands=[],this.show=R(e.show,!0),this.modelMatrix=ft.clone(R(e.modelMatrix,ft.IDENTITY)),this._modelMatrix=ft.clone(ft.IDENTITY),this.debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this.debugShowTextureAtlas=R(e.debugShowTextureAtlas,!1),this.blendOption=R(e.blendOption,Koe.OPAQUE_AND_TRANSLUCENT),this._blendOption=void 0,this._mode=ij.SCENE3D,this._buffersUsage=[lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW],this._highlightColor=xy.clone(xy.WHITE);const t=this;this._uniforms={u_atlas:function(){return t._textureAtlas.texture},u_highlightColor:function(){return t._highlightColor}};const n=this._scene;C(n)&&C(n.terrainProviderChanged)&&(this._removeCallbackFunc=n.terrainProviderChanged.addEventListener((function(){const e=this._billboards,t=e.length;for(let n=0;n<t;++n)C(e[n])&&e[n]._updateClamping()}),this))}function Ire(e){const t=e.length;for(let n=0;n<t;++n)e[n]&&e[n]._destroy()}function Ore(e){if(e._billboardsRemoved){e._billboardsRemoved=!1;const t=[],n=e._billboards,i=n.length;for(let e=0,o=0;e<i;++e){const i=n[e];C(i)&&(i._index=o++,t.push(i))}e._billboards=t}}let Dre;function Pre(e){const t=16384;let n=e.cache.billboardCollection_indexBufferBatched;if(C(n))return n;const i=6*t-6,o=new Uint16Array(i);for(let r=0,s=0;r<i;r+=6,s+=4)o[r]=s,o[r+1]=s+1,o[r+2]=s+2,o[r+3]=s+0,o[r+4]=s+2,o[r+5]=s+3;return n=hq.createIndexBuffer({context:e,typedArray:o,usage:lq.STATIC_DRAW,indexDatatype:fd.UNSIGNED_SHORT}),n.vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferBatched=n,n}function Rre(e){let t=e.cache.billboardCollection_indexBufferInstanced;return C(t)||(t=hq.createIndexBuffer({context:e,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:lq.STATIC_DRAW,indexDatatype:fd.UNSIGNED_SHORT}),t.vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferInstanced=t),t}function Lre(e){let t=e.cache.billboardCollection_vertexBufferInstanced;return C(t)||(t=hq.createVertexBuffer({context:e,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:lq.STATIC_DRAW}),t.vertexArrayDestroyable=!1,e.cache.billboardCollection_vertexBufferInstanced=t),t}function Mre(e,t,n,i,o,r){const s=[{index:Cre.positionHighAndScale,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[sre]},{index:Cre.positionLowAndRotation,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[sre]},{index:Cre.compressedAttribute0,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[are]},{index:Cre.compressedAttribute1,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[gre]},{index:Cre.compressedAttribute2,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[fre]},{index:Cre.eyeOffset,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[cre]},{index:Cre.scaleByDistance,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[_re]},{index:Cre.pixelOffsetScaleByDistance,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[yre]},{index:Cre.compressedAttribute3,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[vre]},{index:Cre.textureCoordinateBoundsOrLabelTranslate,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[Are]}];i&&s.push({index:Cre.direction,componentsPerAttribute:2,componentDatatype:ih.FLOAT,vertexBuffer:Lre(e)}),C(o)&&s.push({index:Cre.a_batchId,componentsPerAttribute:1,componentDatatype:ih.FLOAT,bufferUsage:lq.STATIC_DRAW}),r&&s.push({index:Cre.sdf,componentsPerAttribute:2,componentDatatype:ih.FLOAT,usage:n[wre]});const a=i?t:4*t;return new $ie(e,s,a,i)}Object.defineProperties(Sre.prototype,{length:{get:function(){return Ore(this),this._billboards.length}},textureAtlas:{get:function(){return this._textureAtlas},set:function(e){this._textureAtlas!==e&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=e,this._createVertexArray=!0)}},destroyTextureAtlas:{get:function(){return this._destroyTextureAtlas},set:function(e){this._destroyTextureAtlas=e}}}),Sre.prototype.add=function(e){const t=new joe(e,this);return t._index=this._billboards.length,this._billboards.push(t),this._createVertexArray=!0,t},Sre.prototype.remove=function(e){return!!this.contains(e)&&(this._billboards[e._index]=void 0,this._billboardsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0)},Sre.prototype.removeAll=function(){Ire(this._billboards),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!0},Sre.prototype._updateBillboard=function(e,t){e._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=e),++this._propertiesChanged[t]},Sre.prototype.contains=function(e){return C(e)&&e._billboardCollection===this},Sre.prototype.get=function(e){return D.typeOf.number("index",e),Ore(this),this._billboards[e]},Sre.prototype.computeNewBuffersUsage=function(){const e=this._buffersUsage;let t=!1;const n=this._propertiesChanged;for(let i=0;i<Tre;++i){const o=0===n[i]?lq.STATIC_DRAW:lq.STREAM_DRAW;t=t||e[i]!==o,e[i]=o}return t};const Bre=new Nm;function Nre(e,t,n,i,o){let r;const s=i[Cre.positionHighAndScale],a=i[Cre.positionLowAndRotation],c=o._getActualPosition();e._mode===ij.SCENE3D&&(nn.expand(e._baseVolume,c,e._baseVolume),e._boundingVolumeDirty=!0),Nm.fromCartesian(c,Bre);const l=o.scale,u=o.rotation;0!==u&&(e._shaderRotation=!0),e._maxScale=Math.max(e._maxScale,l);const h=Bre.high,d=Bre.low;e._instanced?(r=o._index,s(r,h.x,h.y,h.z,l),a(r,d.x,d.y,d.z,u)):(r=4*o._index,s(r+0,h.x,h.y,h.z,l),s(r+1,h.x,h.y,h.z,l),s(r+2,h.x,h.y,h.z,l),s(r+3,h.x,h.y,h.z,l),a(r+0,d.x,d.y,d.z,u),a(r+1,d.x,d.y,d.z,u),a(r+2,d.x,d.y,d.z,u),a(r+3,d.x,d.y,d.z,u))}const Fre=new ro,zre=32768,kre=65536,Ure=4096,Vre=256,Hre=128,Gre=32,Wre=8,qre=4,jre=1/256,Yre=0,Kre=2,Xre=3,Qre=1;function Jre(e,t,n,i,o){let r;const s=i[Cre.compressedAttribute0],a=o.pixelOffset,c=a.x,l=a.y,u=o._translate,h=u.x,d=u.y;e._maxPixelOffset=Math.max(e._maxPixelOffset,Math.abs(c+h),Math.abs(-l+d));const f=o.horizontalOrigin;let p=o._verticalOrigin,m=o.show&&o.clusterShow;0===o.color.alpha&&(m=!1),p===Pz.BASELINE&&(p=Pz.BOTTOM),e._allHorizontalCenter=e._allHorizontalCenter&&f===Oz.CENTER,e._allVerticalCenter=e._allVerticalCenter&&p===Pz.CENTER;let _=0,g=0,y=0,v=0;const b=o._imageIndex;if(-1!==b){const e=n[b];if(!C(e))throw new x(`Invalid billboard image index: ${b}`);_=e.x,g=e.y,y=e.width,v=e.height}const A=_+y,w=g+v;let T=Math.floor(z.clamp(c,-zre,zre)+zre)*Hre;T+=(f+1)*Gre,T+=(p+1)*Wre,T+=(m?1:0)*qre;let E=Math.floor(z.clamp(l,-zre,zre)+zre)*Vre,S=Math.floor(z.clamp(h,-zre,zre)+zre)*Vre;const I=(z.clamp(d,-zre,zre)+zre)*jre,O=Math.floor(I),D=Math.floor((I-O)*Vre);E+=O,S+=D,Fre.x=_,Fre.y=g;const P=wh.compressTextureCoordinates(Fre);Fre.x=A;const R=wh.compressTextureCoordinates(Fre);Fre.y=w;const L=wh.compressTextureCoordinates(Fre);Fre.x=_;const M=wh.compressTextureCoordinates(Fre);e._instanced?(r=o._index,s(r,T,E,S,P)):(r=4*o._index,s(r+0,T+Yre,E,S,P),s(r+1,T+Kre,E,S,R),s(r+2,T+Xre,E,S,L),s(r+3,T+Qre,E,S,M))}function Zre(e,t,n,i,o){let r;const s=i[Cre.compressedAttribute1],a=o.alignedAxis;K.equals(a,K.ZERO)||(e._shaderAlignedAxis=!0);let c=0,l=1,u=1,h=1;const d=o.translucencyByDistance;C(d)&&(c=d.near,l=d.nearValue,u=d.far,h=d.farValue,1===l&&1===h||(e._shaderTranslucencyByDistance=!0));let f=0;const p=o._imageIndex;if(-1!==p){const e=n[p];if(!C(e))throw new x(`Invalid billboard image index: ${p}`);f=e.width}const m=e._textureAtlas.texture.width,_=Math.round(R(o.width,m*f));e._maxSize=Math.max(e._maxSize,_);let g=z.clamp(_,0,kre),y=0;Math.abs(K.magnitudeSquared(a)-1)<z.EPSILON6&&(y=wh.octEncodeFloat(a)),l=z.clamp(l,0,1),l=1===l?255:255*l|0,g=g*Vre+l,h=z.clamp(h,0,1),h=1===h?255:255*h|0,y=y*Vre+h,e._instanced?(r=o._index,s(r,g,y,c,u)):(r=4*o._index,s(r+0,g,y,c,u),s(r+1,g,y,c,u),s(r+2,g,y,c,u),s(r+3,g,y,c,u))}function $re(e,t,n,i,o){let r;const s=i[Cre.compressedAttribute2],a=o.color,c=C(e._batchTable)?xy.WHITE:o.getPickId(t.context).color,l=o.sizeInMeters?1:0,u=Math.abs(K.magnitudeSquared(o.alignedAxis)-1)<z.EPSILON6?1:0;e._allSizedInMeters=e._allSizedInMeters&&1===l;let h=0;const d=o._imageIndex;if(-1!==d){const e=n[d];if(!C(e))throw new x(`Invalid billboard image index: ${d}`);h=e.height}const f=e._textureAtlas.texture.dimensions,p=Math.round(R(o.height,f.y*h));e._maxSize=Math.max(e._maxSize,p);let m=R(o._labelHorizontalOrigin,-2);m+=2;const _=p*qre+m;let g=xy.floatToByte(a.red),y=xy.floatToByte(a.green),v=xy.floatToByte(a.blue);const b=g*kre+y*Vre+v;g=xy.floatToByte(c.red),y=xy.floatToByte(c.green),v=xy.floatToByte(c.blue);const A=g*kre+y*Vre+v;let w=xy.floatToByte(a.alpha)*kre+xy.floatToByte(c.alpha)*Vre;w+=2*l+u,e._instanced?(r=o._index,s(r,b,A,w,_)):(r=4*o._index,s(r+0,b,A,w,_),s(r+1,b,A,w,_),s(r+2,b,A,w,_),s(r+3,b,A,w,_))}function ese(e,t,n,i,o){let r;const s=i[Cre.eyeOffset],a=o.eyeOffset;let c=a.z;if(o._heightReference!==Sz.NONE&&(c*=1.005),e._maxEyeOffset=Math.max(e._maxEyeOffset,Math.abs(a.x),Math.abs(a.y),Math.abs(c)),e._instanced){let e=0,t=0;const i=o._imageIndex;if(-1!==i){const o=n[i];if(!C(o))throw new x(`Invalid billboard image index: ${i}`);e=o.width,t=o.height}Fre.x=e,Fre.y=t;const l=wh.compressTextureCoordinates(Fre);r=o._index,s(r,a.x,a.y,c,l)}else r=4*o._index,s(r+0,a.x,a.y,c,0),s(r+1,a.x,a.y,c,0),s(r+2,a.x,a.y,c,0),s(r+3,a.x,a.y,c,0)}function tse(e,t,n,i,o){let r;const s=i[Cre.scaleByDistance];let a=0,c=1,l=1,u=1;const h=o.scaleByDistance;C(h)&&(a=h.near,c=h.nearValue,l=h.far,u=h.farValue,1===c&&1===u||(e._shaderScaleByDistance=!0)),e._instanced?(r=o._index,s(r,a,c,l,u)):(r=4*o._index,s(r+0,a,c,l,u),s(r+1,a,c,l,u),s(r+2,a,c,l,u),s(r+3,a,c,l,u))}function nse(e,t,n,i,o){let r;const s=i[Cre.pixelOffsetScaleByDistance];let a=0,c=1,l=1,u=1;const h=o.pixelOffsetScaleByDistance;C(h)&&(a=h.near,c=h.nearValue,l=h.far,u=h.farValue,1===c&&1===u||(e._shaderPixelOffsetScaleByDistance=!0)),e._instanced?(r=o._index,s(r,a,c,l,u)):(r=4*o._index,s(r+0,a,c,l,u),s(r+1,a,c,l,u),s(r+2,a,c,l,u),s(r+3,a,c,l,u))}function ise(e,t,n,i,o){let r;const s=i[Cre.compressedAttribute3];let a=0,c=Number.MAX_VALUE;const l=o.distanceDisplayCondition;C(l)&&(a=l.near,c=l.far,a*=a,c*=c,e._shaderDistanceDisplayCondition=!0);let u=o.disableDepthTestDistance;const h=o.heightReference===Sz.CLAMP_TO_GROUND&&t.context.depthTexture;let d,f;if(C(u)||(u=h?5e3:0),u*=u,(h||u>0)&&(e._shaderDisableDepthDistance=!0,u===Number.POSITIVE_INFINITY&&(u=-1)),C(o._labelDimensions))f=o._labelDimensions.x,d=o._labelDimensions.y;else{let t=0,i=0;const r=o._imageIndex;if(-1!==r){const e=n[r];if(!C(e))throw new x(`Invalid billboard image index: ${r}`);t=e.height,i=e.width}d=Math.round(R(o.height,e._textureAtlas.texture.dimensions.y*t));const s=e._textureAtlas.texture.width;f=Math.round(R(o.width,s*i))}const p=Math.floor(z.clamp(f,0,Ure)),m=Math.floor(z.clamp(d,0,Ure)),_=p*Ure+m;e._instanced?(r=o._index,s(r,a,c,u,_)):(r=4*o._index,s(r+0,a,c,u,_),s(r+1,a,c,u,_),s(r+2,a,c,u,_),s(r+3,a,c,u,_))}function ose(e,t,n,i,o){if(o.heightReference===Sz.CLAMP_TO_GROUND){const n=e._scene,i=t.context,o=t.globeTranslucencyState.translucent,r=C(n.globe)&&n.globe.depthTestAgainstTerrain;e._shaderClampToGround=i.depthTexture&&!o&&r}let r;const s=i[Cre.textureCoordinateBoundsOrLabelTranslate];if(Ck.maximumVertexTextureImageUnits>0){let t=0,n=0;return C(o._labelTranslate)&&(t=o._labelTranslate.x,n=o._labelTranslate.y),void(e._instanced?(r=o._index,s(r,t,n,0,0)):(r=4*o._index,s(r+0,t,n,0,0),s(r+1,t,n,0,0),s(r+2,t,n,0,0),s(r+3,t,n,0,0)))}let a=0,c=0,l=0,u=0;const h=o._imageIndex;if(-1!==h){const e=n[h];if(!C(e))throw new x(`Invalid billboard image index: ${h}`);a=e.x,c=e.y,l=e.width,u=e.height}const d=a+l,f=c+u;e._instanced?(r=o._index,s(r,a,c,d,f)):(r=4*o._index,s(r+0,a,c,d,f),s(r+1,a,c,d,f),s(r+2,a,c,d,f),s(r+3,a,c,d,f))}function rse(e,t,n,i,o){if(!C(e._batchTable))return;const r=i[Cre.a_batchId],s=o._batchIndex;let a;e._instanced?(a=o._index,r(a,s)):(a=4*o._index,r(a+0,s),r(a+1,s),r(a+2,s),r(a+3,s))}function sse(e,t,n,i,o){if(!e._sdf)return;let r;const s=i[Cre.sdf],a=o.outlineColor,c=o.outlineWidth,l=xy.floatToByte(a.red),u=xy.floatToByte(a.green),h=xy.floatToByte(a.blue),d=l*kre+u*Vre+h,f=c/Qoe.RADIUS,p=xy.floatToByte(a.alpha)*kre+xy.floatToByte(f)*Vre;e._instanced?(r=o._index,s(r,d,p)):(r=4*o._index,s(r+0,d+Yre,p),s(r+1,d+Kre,p),s(r+2,d+Xre,p),s(r+3,d+Qre,p))}function ase(e,t,n,i,o){Nre(e,t,n,i,o),Jre(e,t,n,i,o),Zre(e,t,n,i,o),$re(e,t,n,i,o),ese(e,t,n,i,o),tse(e,t,n,i,o),nse(e,t,n,i,o),ise(e,t,n,i,o),ose(e,t,n,i,o),rse(e,t,n,i,o),sse(e,t,n,i,o)}function cse(e,t,n,i,o,r){let s;i.mode===ij.SCENE3D?(s=e._baseVolume,e._boundingVolumeDirty=!0):s=e._baseVolume2D;const a=[];for(let c=0;c<n;++c){const e=t[c],n=e.position,l=joe._computeActualPosition(e,n,i,o);C(l)&&(e._setActualPosition(l),r?a.push(l):nn.expand(s,l,s))}r&&nn.fromPoints(a,s)}function lse(e,t){const n=t.mode,i=e._billboards,o=e._billboardsToUpdate,r=e._modelMatrix;e._createVertexArray||e._mode!==n||n!==ij.SCENE3D&&!ft.equals(r,e.modelMatrix)?(e._mode=n,ft.clone(e.modelMatrix,r),e._createVertexArray=!0,n!==ij.SCENE3D&&n!==ij.SCENE2D&&n!==ij.COLUMBUS_VIEW||cse(e,i,i.length,t,r,!0)):n===ij.MORPHING?cse(e,i,i.length,t,r,!0):n!==ij.SCENE2D&&n!==ij.COLUMBUS_VIEW||cse(e,o,e._billboardsToUpdateIndex,t,r,!1)}function use(e,t,n){let i=1;e._allSizedInMeters&&0===e._maxPixelOffset||(i=t.camera.getPixelSize(n,t.context.drawingBufferWidth,t.context.drawingBufferHeight));let o=i*e._maxScale*e._maxSize*2;e._allHorizontalCenter&&e._allVerticalCenter&&(o*=.5);const r=i*e._maxPixelOffset+e._maxEyeOffset;n.radius+=o+r}function hse(e,t){const n="uniform sampler2D billboard_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    gl_FragColor = texture2D(billboard_texture, v_textureCoordinates); \n} \n",i=t.createViewportQuadCommand(n,{uniformMap:{billboard_texture:function(){return e._textureAtlas.texture}}});return i.pass=HU.OVERLAY,i}const dse=[];Sre.prototype.update=function(e){if(Ore(this),!this.show)return;let t=this._billboards,n=t.length;const i=e.context;this._instanced=i.instancedArrays,Cre=this._instanced?xre:Ere,Dre=this._instanced?Rre:Pre;let o=this._textureAtlas;if(!C(o)){o=this._textureAtlas=new ore({context:i});for(let e=0;e<n;++e)t[e]._loadImage()}const r=o.textureCoordinates;if(0===r.length)return;lse(this,e),t=this._billboards,n=t.length;const s=this._billboardsToUpdate,a=this._billboardsToUpdateIndex,c=this._propertiesChanged,l=o.guid,u=this._createVertexArray||this._textureAtlasGUID!==l;let h;this._textureAtlasGUID=l;const d=e.passes,f=d.pick;if(u||!f&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(let e=0;e<Tre;++e)c[e]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),n>0){this._vaf=Mre(i,n,this._buffersUsage,this._instanced,this._batchTable,this._sdf),h=this._vaf.writers;for(let t=0;t<n;++t){const n=this._billboards[t];n._dirty=!1,ase(this,e,r,h,n)}this._vaf.commit(Dre(i))}this._billboardsToUpdateIndex=0}else if(a>0){const t=dse;t.length=0,(c[sre]||c[pre]||c[hre])&&t.push(Nre),(c[dre]||c[are]||c[lre]||c[ure]||c[rre])&&(t.push(Jre),this._instanced&&t.push(ese)),(c[dre]||c[mre]||c[gre])&&(t.push(Zre),t.push($re)),(c[dre]||c[fre])&&t.push($re),c[cre]&&t.push(ese),c[_re]&&t.push(tse),c[yre]&&t.push(nse),(c[vre]||c[bre]||c[dre]||c[sre])&&t.push(ise),(c[dre]||c[sre])&&t.push(ose),c[wre]&&t.push(sse);const o=t.length;if(h=this._vaf.writers,a/n>.1){for(let n=0;n<a;++n){const i=s[n];i._dirty=!1;for(let n=0;n<o;++n)t[n](this,e,r,h,i)}this._vaf.commit(Dre(i))}else{for(let n=0;n<a;++n){const i=s[n];i._dirty=!1;for(let n=0;n<o;++n)t[n](this,e,r,h,i);this._instanced?this._vaf.subCommit(i._index,1):this._vaf.subCommit(4*i._index,4)}this._vaf.endSubCommits()}this._billboardsToUpdateIndex=0}if(a>1.5*n&&(s.length=n),!C(this._vaf)||!C(this._vaf.va))return;let p;this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,nn.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));let m=ft.IDENTITY;e.mode===ij.SCENE3D?(m=this.modelMatrix,p=nn.clone(this._baseVolumeWC,this._boundingVolume)):p=nn.clone(this._baseVolume2D,this._boundingVolume),use(this,e,p);const _=this._blendOption!==this.blendOption;if(this._blendOption=this.blendOption,_){this._blendOption===Koe.OPAQUE||this._blendOption===Koe.OPAQUE_AND_TRANSLUCENT?this._rsOpaque=yV.fromCache({depthTest:{enabled:!0,func:th.LESS},depthMask:!0}):this._rsOpaque=void 0;const e=this._blendOption===Koe.TRANSLUCENT;this._blendOption===Koe.TRANSLUCENT||this._blendOption===Koe.OPAQUE_AND_TRANSLUCENT?this._rsTranslucent=yV.fromCache({depthTest:{enabled:!0,func:e?th.LEQUAL:th.LESS},depthMask:e,blending:_k.ALPHA_BLEND}):this._rsTranslucent=void 0}let g,y,v,b,A;this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||0!==e.minimumDisableDepthTestDistance;const w=Ck.maximumVertexTextureImageUnits>0;if(_||this._shaderRotation!==this._compiledShaderRotation||this._shaderAlignedAxis!==this._compiledShaderAlignedAxis||this._shaderScaleByDistance!==this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance!==this._compiledShaderTranslucencyByDistance||this._shaderPixelOffsetScaleByDistance!==this._compiledShaderPixelOffsetScaleByDistance||this._shaderDistanceDisplayCondition!==this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance||this._shaderClampToGround!==this._compiledShaderClampToGround||this._sdf!==this._compiledSDF){g=toe,y=eoe,A=[],C(this._batchTable)&&(A.push("VECTOR_TILE"),g=this._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(g),y=this._batchTable.getFragmentShaderCallback(!1,void 0)(y)),v=new tq({defines:A,sources:[g]}),this._instanced&&v.defines.push("INSTANCED"),this._shaderRotation&&v.defines.push("ROTATION"),this._shaderAlignedAxis&&v.defines.push("ALIGNED_AXIS"),this._shaderScaleByDistance&&v.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&v.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderPixelOffsetScaleByDistance&&v.defines.push("EYE_DISTANCE_PIXEL_OFFSET"),this._shaderDistanceDisplayCondition&&v.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&v.defines.push("DISABLE_DEPTH_DISTANCE"),this._shaderClampToGround&&(w?v.defines.push("VERTEX_DEPTH_CHECK"):v.defines.push("FRAGMENT_DEPTH_CHECK"));const e=1-Qoe.CUTOFF;this._sdf&&v.defines.push("SDF");const t=C(this._batchTable)?"VECTOR_TILE":"";this._blendOption===Koe.OPAQUE_AND_TRANSLUCENT&&(b=new tq({defines:["OPAQUE",t],sources:[y]}),this._shaderClampToGround&&(w?b.defines.push("VERTEX_DEPTH_CHECK"):b.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(b.defines.push("SDF"),b.defines.push(`SDF_EDGE ${e}`)),this._sp=fH.replaceCache({context:i,shaderProgram:this._sp,vertexShaderSource:v,fragmentShaderSource:b,attributeLocations:Cre}),b=new tq({defines:["TRANSLUCENT",t],sources:[y]}),this._shaderClampToGround&&(w?b.defines.push("VERTEX_DEPTH_CHECK"):b.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(b.defines.push("SDF"),b.defines.push(`SDF_EDGE ${e}`)),this._spTranslucent=fH.replaceCache({context:i,shaderProgram:this._spTranslucent,vertexShaderSource:v,fragmentShaderSource:b,attributeLocations:Cre})),this._blendOption===Koe.OPAQUE&&(b=new tq({defines:[t],sources:[y]}),this._shaderClampToGround&&(w?b.defines.push("VERTEX_DEPTH_CHECK"):b.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(b.defines.push("SDF"),b.defines.push(`SDF_EDGE ${e}`)),this._sp=fH.replaceCache({context:i,shaderProgram:this._sp,vertexShaderSource:v,fragmentShaderSource:b,attributeLocations:Cre})),this._blendOption===Koe.TRANSLUCENT&&(b=new tq({defines:[t],sources:[y]}),this._shaderClampToGround&&(w?b.defines.push("VERTEX_DEPTH_CHECK"):b.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(b.defines.push("SDF"),b.defines.push(`SDF_EDGE ${e}`)),this._spTranslucent=fH.replaceCache({context:i,shaderProgram:this._spTranslucent,vertexShaderSource:v,fragmentShaderSource:b,attributeLocations:Cre})),this._compiledShaderRotation=this._shaderRotation,this._compiledShaderAlignedAxis=this._shaderAlignedAxis,this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderPixelOffsetScaleByDistance=this._shaderPixelOffsetScaleByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance,this._compiledShaderClampToGround=this._shaderClampToGround,this._compiledSDF=this._sdf}const T=e.commandList;if(d.render||d.pick){const t=this._colorCommands,i=this._blendOption===Koe.OPAQUE,o=this._blendOption===Koe.OPAQUE_AND_TRANSLUCENT,r=this._vaf.va,s=r.length;let a,c=this._uniforms;C(this._batchTable)?(c=this._batchTable.getUniformMapCallback()(c),a=this._batchTable.getPickId()):a="v_pickColor",t.length=s;const l=o?2*s:s;for(let e=0;e<l;++e){let s=t[e];C(s)||(s=t[e]=new UU);const l=i||o&&e%2===0;s.pass=l||!o?HU.OPAQUE:HU.TRANSLUCENT,s.owner=this;const u=o?Math.floor(e/2):e;s.boundingVolume=p,s.modelMatrix=m,s.count=r[u].indicesCount,s.shaderProgram=l?this._sp:this._spTranslucent,s.uniformMap=c,s.vertexArray=r[u].va,s.renderState=l?this._rsOpaque:this._rsTranslucent,s.debugShowBoundingVolume=this.debugShowBoundingVolume,s.pickId=a,this._instanced&&(s.count=6,s.instanceCount=n),T.push(s)}this.debugShowTextureAtlas&&(C(this.debugCommand)||(this.debugCommand=hse(this,e.context)),T.push(this.debugCommand))}},Sre.prototype.isDestroyed=function(){return!1},Sre.prototype.destroy=function(){return C(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),Ire(this._billboards),Qh(this)};var fse=Sre;function pse(e,t,n,i,o){return function(){const r=document.createElement("canvas"),s=o+2*i;r.height=r.width=s;const a=r.getContext("2d");return a.clearRect(0,0,s,s),0!==i&&(a.beginPath(),a.arc(s/2,s/2,s/2,0,2*Math.PI,!0),a.closePath(),a.fillStyle=n,a.fill(),e<1&&(a.save(),a.globalCompositeOperation="destination-out",a.beginPath(),a.arc(s/2,s/2,o/2,0,2*Math.PI,!0),a.closePath(),a.fillStyle="black",a.fill(),a.restore())),a.beginPath(),a.arc(s/2,s/2,o/2,0,2*Math.PI,!0),a.closePath(),a.fillStyle=t,a.fill(),r}}var mse=pse;function _se(e,t,n,i,o){this._content=e,this._billboard=n,this._label=i,this._polyline=o,this._batchId=t,this._billboardImage=void 0,this._billboardColor=void 0,this._billboardOutlineColor=void 0,this._billboardOutlineWidth=void 0,this._billboardSize=void 0,this._pointSize=void 0,this._color=void 0,this._pointSize=void 0,this._pointOutlineColor=void 0,this._pointOutlineWidth=void 0,this._heightOffset=void 0,this._pickIds=new Array(3),yse(this)}const gse=new se;function yse(e){const t=e._billboard;if(C(e._billboardImage)&&e._billboardImage!==t.image)return void(t.image=e._billboardImage);if(C(e._billboardImage))return;const n=R(e._color,_se.defaultColor),i=R(e._pointOutlineColor,_se.defaultPointOutlineColor),o=R(e._pointOutlineWidth,_se.defaultPointOutlineWidth),r=R(e._pointSize,_se.defaultPointSize),s=e._billboardColor,a=e._billboardOutlineColor,c=e._billboardOutlineWidth,l=e._billboardSize;if(xy.equals(n,s)&&xy.equals(i,a)&&o===c&&r===l)return;e._billboardColor=xy.clone(n,e._billboardColor),e._billboardOutlineColor=xy.clone(i,e._billboardOutlineColor),e._billboardOutlineWidth=o,e._billboardSize=r;const u=n.alpha,h=n.toCssColorString(),d=i.toCssColorString(),f=JSON.stringify([h,r,d,o]);t.setImage(f,mse(u,h,d,o,r))}Object.defineProperties(_se.prototype,{show:{get:function(){return this._label.show},set:function(e){this._label.show=e,this._billboard.show=e,this._polyline.show=e}},color:{get:function(){return this._color},set:function(e){this._color=xy.clone(e,this._color),yse(this)}},pointSize:{get:function(){return this._pointSize},set:function(e){this._pointSize=e,yse(this)}},pointOutlineColor:{get:function(){return this._pointOutlineColor},set:function(e){this._pointOutlineColor=xy.clone(e,this._pointOutlineColor),yse(this)}},pointOutlineWidth:{get:function(){return this._pointOutlineWidth},set:function(e){this._pointOutlineWidth=e,yse(this)}},labelColor:{get:function(){return this._label.fillColor},set:function(e){this._label.fillColor=e,this._polyline.show=this._label.show&&e.alpha>0}},labelOutlineColor:{get:function(){return this._label.outlineColor},set:function(e){this._label.outlineColor=e}},labelOutlineWidth:{get:function(){return this._label.outlineWidth},set:function(e){this._label.outlineWidth=e}},font:{get:function(){return this._label.font},set:function(e){this._label.font=e}},labelStyle:{get:function(){return this._label.style},set:function(e){this._label.style=e}},labelText:{get:function(){return this._label.text},set:function(e){C(e)||(e=""),this._label.text=e}},backgroundColor:{get:function(){return this._label.backgroundColor},set:function(e){this._label.backgroundColor=e}},backgroundPadding:{get:function(){return this._label.backgroundPadding},set:function(e){this._label.backgroundPadding=e}},backgroundEnabled:{get:function(){return this._label.showBackground},set:function(e){this._label.showBackground=e}},scaleByDistance:{get:function(){return this._label.scaleByDistance},set:function(e){this._label.scaleByDistance=e,this._billboard.scaleByDistance=e}},translucencyByDistance:{get:function(){return this._label.translucencyByDistance},set:function(e){this._label.translucencyByDistance=e,this._billboard.translucencyByDistance=e}},distanceDisplayCondition:{get:function(){return this._label.distanceDisplayCondition},set:function(e){this._label.distanceDisplayCondition=e,this._polyline.distanceDisplayCondition=e,this._billboard.distanceDisplayCondition=e}},heightOffset:{get:function(){return this._heightOffset},set:function(e){const t=R(this._heightOffset,0),n=this._content.tileset.ellipsoid,i=n.cartesianToCartographic(this._billboard.position,gse);i.height=i.height-t+e;const o=n.cartographicToCartesian(i);this._billboard.position=o,this._label.position=this._billboard.position,this._polyline.positions=[this._polyline.positions[0],o],this._heightOffset=e}},anchorLineEnabled:{get:function(){return this._polyline.show},set:function(e){this._polyline.show=e}},anchorLineColor:{get:function(){return this._polyline.material.uniforms.color},set:function(e){this._polyline.material.uniforms.color=xy.clone(e,this._polyline.material.uniforms.color)}},image:{get:function(){return this._billboardImage},set:function(e){const t=this._billboardImage!==e;this._billboardImage=e,t&&yse(this)}},disableDepthTestDistance:{get:function(){return this._label.disableDepthTestDistance},set:function(e){this._label.disableDepthTestDistance=e,this._billboard.disableDepthTestDistance=e}},horizontalOrigin:{get:function(){return this._billboard.horizontalOrigin},set:function(e){this._billboard.horizontalOrigin=e}},verticalOrigin:{get:function(){return this._billboard.verticalOrigin},set:function(e){this._billboard.verticalOrigin=e}},labelHorizontalOrigin:{get:function(){return this._label.horizontalOrigin},set:function(e){this._label.horizontalOrigin=e}},labelVerticalOrigin:{get:function(){return this._label.verticalOrigin},set:function(e){this._label.verticalOrigin=e}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickIds:{get:function(){const e=this._pickIds;return e[0]=this._billboard.pickId,e[1]=this._label.pickId,e[2]=this._polyline.pickId,e}}}),_se.defaultColor=xy.WHITE,_se.defaultPointOutlineColor=xy.BLACK,_se.defaultPointOutlineWidth=0,_se.defaultPointSize=8,_se.prototype.hasProperty=function(e){return this._content.batchTable.hasProperty(this._batchId,e)},_se.prototype.getPropertyNames=function(e){return this._content.batchTable.getPropertyNames(this._batchId,e)},_se.prototype.getProperty=function(e){return this._content.batchTable.getProperty(this._batchId,e)},_se.prototype.getPropertyInherited=function(e){return hZ.getPropertyInherited(this._content,this._batchId,e)},_se.prototype.setProperty=function(e,t){this._content.batchTable.setProperty(this._batchId,e,t),this._content.featurePropertiesDirty=!0},_se.prototype.isExactClass=function(e){return this._content.batchTable.isExactClass(this._batchId,e)},_se.prototype.isClass=function(e){return this._content.batchTable.isClass(this._batchId,e)},_se.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};var vse=_se,bse=Ase;function Ase(e,t,n){return t<n?e<t?t:e>n?n:e:e<n?n:e>t?t:e}var wse=Cse,Tse=1e20;function Cse(e,t){t||(t={});var n,i,o,r,s,a,c,l,u,h,d,f=null==t.cutoff?.25:t.cutoff,p=null==t.radius?8:t.radius,m=t.channel||0;if(ArrayBuffer.isView(e)||Array.isArray(e)){if(!t.width||!t.height)throw Error("For raw data width and height should be provided by options");n=t.width,i=t.height,r=e,a=t.stride?t.stride:Math.floor(e.length/n/i)}else window.HTMLCanvasElement&&e instanceof window.HTMLCanvasElement?(l=e,c=l.getContext("2d"),n=l.width,i=l.height,u=c.getImageData(0,0,n,i),r=u.data,a=4):window.CanvasRenderingContext2D&&e instanceof window.CanvasRenderingContext2D?(l=e.canvas,c=e,n=l.width,i=l.height,u=c.getImageData(0,0,n,i),r=u.data,a=4):window.ImageData&&e instanceof window.ImageData&&(u=e,n=e.width,i=e.height,r=u.data,a=4);if(o=Math.max(n,i),window.Uint8ClampedArray&&r instanceof window.Uint8ClampedArray||window.Uint8Array&&r instanceof window.Uint8Array)for(s=r,r=Array(n*i),h=0,d=s.length;h<d;h++)r[h]=s[h*a+m]/255;else if(1!==a)throw Error("Raw data can have only 1 value per pixel");var _=Array(n*i),g=Array(n*i),y=Array(o),v=Array(o),b=Array(o+1),A=Array(o);for(h=0,d=n*i;h<d;h++){var w=r[h];_[h]=1===w?0:0===w?Tse:Math.pow(Math.max(0,.5-w),2),g[h]=1===w?Tse:0===w?0:Math.pow(Math.max(0,w-.5),2)}Ese(_,n,i,y,v,A,b),Ese(g,n,i,y,v,A,b);var T=window.Float32Array?new Float32Array(n*i):new Array(n*i);for(h=0,d=n*i;h<d;h++)T[h]=bse(1-((_[h]-g[h])/p+f),0,1);return T}function Ese(e,t,n,i,o,r,s){for(var a=0;a<t;a++){for(var c=0;c<n;c++)i[c]=e[c*t+a];for(xse(i,o,r,s,n),c=0;c<n;c++)e[c*t+a]=o[c]}for(c=0;c<n;c++){for(a=0;a<t;a++)i[a]=e[c*t+a];for(xse(i,o,r,s,t),a=0;a<t;a++)e[c*t+a]=Math.sqrt(o[a])}}function xse(e,t,n,i,o){n[0]=0,i[0]=-Tse,i[1]=+Tse;for(var r=1,s=0;r<o;r++){var a=(e[r]+r*r-(e[n[s]]+n[s]*n[s]))/(2*r-2*n[s]);while(a<=i[s])s--,a=(e[r]+r*r-(e[n[s]]+n[s]*n[s]))/(2*r-2*n[s]);s++,n[s]=r,i[s]=a,i[s+1]=+Tse}for(r=0,s=0;r<o;r++){while(i[s+1]<r)s++;t[r]=(r-n[s])*(r-n[s])+e[n[s]]}}const Sse={FILL:0,OUTLINE:1,FILL_AND_OUTLINE:2};var Ise=Object.freeze(Sse);const Ose={};let Dse=0;const Pse=256,Rse=new xy(.165,.165,.165,.8),Lse=new ro(7,5),Mse=Object.freeze({LTR:0,RTL:1,WEAK:2,BRACKETS:3});function Bse(e){e._rebindAllGlyphs||e._repositionAllGlyphs||e._labelCollection._labelsToUpdate.push(e),e._rebindAllGlyphs=!0}function Nse(e){e._rebindAllGlyphs||e._repositionAllGlyphs||e._labelCollection._labelsToUpdate.push(e),e._repositionAllGlyphs=!0}function Fse(e,t){return document.defaultView.getComputedStyle(e,null).getPropertyValue(t)}function zse(e){let t=Ose[e._font];if(!C(t)){const n=document.createElement("div");n.style.position="absolute",n.style.opacity=0,n.style.font=e._font,document.body.appendChild(n);let i=parseFloat(Fse(n,"line-height"));isNaN(i)&&(i=void 0),t={family:Fse(n,"font-family"),size:Fse(n,"font-size").replace("px",""),style:Fse(n,"font-style"),weight:Fse(n,"font-weight"),lineHeight:i},document.body.removeChild(n),Dse<Pse&&(Ose[e._font]=t,Dse++)}e._fontFamily=t.family,e._fontSize=t.size,e._fontStyle=t.style,e._fontWeight=t.weight,e._lineHeight=t.lineHeight}function kse(e,t){if(e=R(e,R.EMPTY_OBJECT),C(e.disableDepthTestDistance)&&e.disableDepthTestDistance<0)throw new x("disableDepthTestDistance must be greater than 0.0.");let n=e.translucencyByDistance,i=e.pixelOffsetScaleByDistance,o=e.scaleByDistance,r=e.distanceDisplayCondition;if(C(n)){if(n.far<=n.near)throw new x("translucencyByDistance.far must be greater than translucencyByDistance.near.");n=LO.clone(n)}if(C(i)){if(i.far<=i.near)throw new x("pixelOffsetScaleByDistance.far must be greater than pixelOffsetScaleByDistance.near.");i=LO.clone(i)}if(C(o)){if(o.far<=o.near)throw new x("scaleByDistance.far must be greater than scaleByDistance.near.");o=LO.clone(o)}if(C(r)){if(r.far<=r.near)throw new x("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");r=WT.clone(r)}this._renderedText=void 0,this._text=void 0,this._show=R(e.show,!0),this._font=R(e.font,"30px sans-serif"),this._fillColor=xy.clone(R(e.fillColor,xy.WHITE)),this._outlineColor=xy.clone(R(e.outlineColor,xy.BLACK)),this._outlineWidth=R(e.outlineWidth,1),this._showBackground=R(e.showBackground,!1),this._backgroundColor=xy.clone(R(e.backgroundColor,Rse)),this._backgroundPadding=ro.clone(R(e.backgroundPadding,Lse)),this._style=R(e.style,Ise.FILL),this._verticalOrigin=R(e.verticalOrigin,Pz.BASELINE),this._horizontalOrigin=R(e.horizontalOrigin,Oz.LEFT),this._pixelOffset=ro.clone(R(e.pixelOffset,ro.ZERO)),this._eyeOffset=K.clone(R(e.eyeOffset,K.ZERO)),this._position=K.clone(R(e.position,K.ZERO)),this._scale=R(e.scale,1),this._id=e.id,this._translucencyByDistance=n,this._pixelOffsetScaleByDistance=i,this._scaleByDistance=o,this._heightReference=R(e.heightReference,Sz.NONE),this._distanceDisplayCondition=r,this._disableDepthTestDistance=e.disableDepthTestDistance,this._labelCollection=t,this._glyphs=[],this._backgroundBillboard=void 0,this._batchIndex=void 0,this._rebindAllGlyphs=!0,this._repositionAllGlyphs=!0,this._actualClampedPosition=void 0,this._removeCallbackFunc=void 0,this._mode=void 0,this._clusterShow=!0,this.text=R(e.text,""),this._relativeSize=1,zse(this),this._updateClamping()}function Use(e,t){const n=/[a-zA-Z0-9]/,i=/[()[\]{}<>]/,o=[];let r="",s=Mse.LTR,a="";const c=e.length;for(let l=0;l<c;++l){const c=e.charAt(l);a=t.test(c)?Mse.RTL:n.test(c)?Mse.LTR:i.test(c)?Mse.BRACKETS:Mse.WEAK,0===l&&(s=a),s===a&&a!==Mse.BRACKETS?r+=c:(""!==r&&o.push({Type:s,Word:r}),s=a,r=c)}return o.push({Type:a,Word:r}),o}function Vse(e){return e.split("").reverse().join("")}function Hse(e,t,n){return e.slice(0,t)+n+e.slice(t)}function Gse(e){switch(e){case"(":return")";case")":return"(";case"[":return"]";case"]":return"[";case"{":return"}";case"}":return"{";case"<":return">";case">":return"<"}}Object.defineProperties(kse.prototype,{show:{get:function(){return this._show},set:function(e){if(!C(e))throw new x("value is required.");if(this._show!==e){this._show=e;const t=this._glyphs;for(let i=0,o=t.length;i<o;i++){const n=t[i].billboard;C(n)&&(n.show=e)}const n=this._backgroundBillboard;C(n)&&(n.show=e)}}},position:{get:function(){return this._position},set:function(e){if(!C(e))throw new x("value is required.");const t=this._position;if(!K.equals(t,e)){K.clone(e,t);const n=this._glyphs;for(let t=0,o=n.length;t<o;t++){const i=n[t].billboard;C(i)&&(i.position=e)}const i=this._backgroundBillboard;C(i)&&(i.position=e),this._updateClamping()}}},heightReference:{get:function(){return this._heightReference},set:function(e){if(!C(e))throw new x("value is required.");if(e!==this._heightReference){this._heightReference=e;const t=this._glyphs;for(let i=0,o=t.length;i<o;i++){const n=t[i].billboard;C(n)&&(n.heightReference=e)}const n=this._backgroundBillboard;C(n)&&(n.heightReference=e),Nse(this),this._updateClamping()}}},text:{get:function(){return this._text},set:function(e){if(!C(e))throw new x("value is required.");if(this._text!==e){this._text=e;const t=e.replace(/\u00ad/g,"");this._renderedText=kse.enableRightToLeftDetection?Yse(t):t,Bse(this)}}},font:{get:function(){return this._font},set:function(e){if(!C(e))throw new x("value is required.");this._font!==e&&(this._font=e,Bse(this),zse(this))}},fillColor:{get:function(){return this._fillColor},set:function(e){if(!C(e))throw new x("value is required.");const t=this._fillColor;xy.equals(t,e)||(xy.clone(e,t),Bse(this))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){if(!C(e))throw new x("value is required.");const t=this._outlineColor;xy.equals(t,e)||(xy.clone(e,t),Bse(this))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){if(!C(e))throw new x("value is required.");this._outlineWidth!==e&&(this._outlineWidth=e,Bse(this))}},showBackground:{get:function(){return this._showBackground},set:function(e){if(!C(e))throw new x("value is required.");this._showBackground!==e&&(this._showBackground=e,Bse(this))}},backgroundColor:{get:function(){return this._backgroundColor},set:function(e){if(!C(e))throw new x("value is required.");const t=this._backgroundColor;if(!xy.equals(t,e)){xy.clone(e,t);const n=this._backgroundBillboard;C(n)&&(n.color=t)}}},backgroundPadding:{get:function(){return this._backgroundPadding},set:function(e){if(!C(e))throw new x("value is required.");const t=this._backgroundPadding;ro.equals(t,e)||(ro.clone(e,t),Nse(this))}},style:{get:function(){return this._style},set:function(e){if(!C(e))throw new x("value is required.");this._style!==e&&(this._style=e,Bse(this))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(e){if(!C(e))throw new x("value is required.");const t=this._pixelOffset;if(!ro.equals(t,e)){ro.clone(e,t);const n=this._glyphs;for(let t=0,o=n.length;t<o;t++){const i=n[t];C(i.billboard)&&(i.billboard.pixelOffset=e)}const i=this._backgroundBillboard;C(i)&&(i.pixelOffset=e)}}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){if(C(e)&&e.far<=e.near)throw new x("far distance must be greater than near distance.");const t=this._translucencyByDistance;if(!LO.equals(t,e)){this._translucencyByDistance=LO.clone(e,t);const n=this._glyphs;for(let t=0,o=n.length;t<o;t++){const i=n[t];C(i.billboard)&&(i.billboard.translucencyByDistance=e)}const i=this._backgroundBillboard;C(i)&&(i.translucencyByDistance=e)}}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){if(C(e)&&e.far<=e.near)throw new x("far distance must be greater than near distance.");const t=this._pixelOffsetScaleByDistance;if(!LO.equals(t,e)){this._pixelOffsetScaleByDistance=LO.clone(e,t);const n=this._glyphs;for(let t=0,o=n.length;t<o;t++){const i=n[t];C(i.billboard)&&(i.billboard.pixelOffsetScaleByDistance=e)}const i=this._backgroundBillboard;C(i)&&(i.pixelOffsetScaleByDistance=e)}}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){if(C(e)&&e.far<=e.near)throw new x("far distance must be greater than near distance.");const t=this._scaleByDistance;if(!LO.equals(t,e)){this._scaleByDistance=LO.clone(e,t);const n=this._glyphs;for(let t=0,o=n.length;t<o;t++){const i=n[t];C(i.billboard)&&(i.billboard.scaleByDistance=e)}const i=this._backgroundBillboard;C(i)&&(i.scaleByDistance=e)}}},eyeOffset:{get:function(){return this._eyeOffset},set:function(e){if(!C(e))throw new x("value is required.");const t=this._eyeOffset;if(!K.equals(t,e)){K.clone(e,t);const n=this._glyphs;for(let t=0,o=n.length;t<o;t++){const i=n[t];C(i.billboard)&&(i.billboard.eyeOffset=e)}const i=this._backgroundBillboard;C(i)&&(i.eyeOffset=e)}}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){if(!C(e))throw new x("value is required.");this._horizontalOrigin!==e&&(this._horizontalOrigin=e,Nse(this))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){if(!C(e))throw new x("value is required.");if(this._verticalOrigin!==e){this._verticalOrigin=e;const t=this._glyphs;for(let i=0,o=t.length;i<o;i++){const n=t[i];C(n.billboard)&&(n.billboard.verticalOrigin=e)}const n=this._backgroundBillboard;C(n)&&(n.verticalOrigin=e),Nse(this)}}},scale:{get:function(){return this._scale},set:function(e){if(!C(e))throw new x("value is required.");if(this._scale!==e){this._scale=e;const t=this._glyphs;for(let i=0,o=t.length;i<o;i++){const n=t[i];C(n.billboard)&&(n.billboard.scale=e*this._relativeSize)}const n=this._backgroundBillboard;C(n)&&(n.scale=e*this._relativeSize),Nse(this)}}},totalScale:{get:function(){return this._scale*this._relativeSize}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(C(e)&&e.far<=e.near)throw new x("far must be greater than near");if(!WT.equals(e,this._distanceDisplayCondition)){this._distanceDisplayCondition=WT.clone(e,this._distanceDisplayCondition);const t=this._glyphs;for(let i=0,o=t.length;i<o;i++){const n=t[i];C(n.billboard)&&(n.billboard.distanceDisplayCondition=e)}const n=this._backgroundBillboard;C(n)&&(n.distanceDisplayCondition=e)}}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){if(this._disableDepthTestDistance!==e){if(C(e)&&e<0)throw new x("disableDepthTestDistance must be greater than 0.0.");this._disableDepthTestDistance=e;const t=this._glyphs;for(let i=0,o=t.length;i<o;i++){const n=t[i];C(n.billboard)&&(n.billboard.disableDepthTestDistance=e)}const n=this._backgroundBillboard;C(n)&&(n.disableDepthTestDistance=e)}}},id:{get:function(){return this._id},set:function(e){if(this._id!==e){this._id=e;const t=this._glyphs;for(let i=0,o=t.length;i<o;i++){const n=t[i];C(n.billboard)&&(n.billboard.id=e)}const n=this._backgroundBillboard;C(n)&&(n.id=e)}}},pickId:{get:function(){if(0!==this._glyphs.length&&C(this._glyphs[0].billboard))return this._glyphs[0].billboard.pickId}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(e){this._actualClampedPosition=K.clone(e,this._actualClampedPosition);const t=this._glyphs;for(let i=0,o=t.length;i<o;i++){const n=t[i];C(n.billboard)&&(n.billboard._clampedPosition=e)}const n=this._backgroundBillboard;C(n)&&(n._clampedPosition=e)}},clusterShow:{get:function(){return this._clusterShow},set:function(e){if(this._clusterShow!==e){this._clusterShow=e;const t=this._glyphs;for(let i=0,o=t.length;i<o;i++){const n=t[i];C(n.billboard)&&(n.billboard.clusterShow=e)}const n=this._backgroundBillboard;C(n)&&(n.clusterShow=e)}}}}),kse.prototype._updateClamping=function(){joe._updateClamping(this._labelCollection,this)},kse.prototype.computeScreenSpacePosition=function(e,t){if(!C(e))throw new x("scene is required.");C(t)||(t=new ro);const n=this._labelCollection,i=n.modelMatrix,o=C(this._actualClampedPosition)?this._actualClampedPosition:this._position,r=joe._computeScreenSpacePosition(i,o,this._eyeOffset,this._pixelOffset,e,t);return r},kse.getScreenSpaceBoundingBox=function(e,t,n){let i=0,o=0,r=0,s=0;const a=e.totalScale,c=e._backgroundBillboard;if(C(c))i=t.x+c._translate.x,o=t.y-c._translate.y,r=c.width*a,s=c.height*a,e.verticalOrigin===Pz.BOTTOM||e.verticalOrigin===Pz.BASELINE?o-=s:e.verticalOrigin===Pz.CENTER&&(o-=.5*s);else{i=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY;let n=0,c=0;const l=e._glyphs,u=l.length;for(let r=0;r<u;++r){const s=l[r],u=s.billboard;if(!C(u))continue;const h=t.x+u._translate.x;let d=t.y-u._translate.y;const f=s.dimensions.width*a,p=s.dimensions.height*a;e.verticalOrigin===Pz.BOTTOM||e.verticalOrigin===Pz.BASELINE?d-=p:e.verticalOrigin===Pz.CENTER&&(d-=.5*p),e._verticalOrigin===Pz.TOP?d+=Qoe.PADDING*a:e._verticalOrigin!==Pz.BOTTOM&&e._verticalOrigin!==Pz.BASELINE||(d-=Qoe.PADDING*a),i=Math.min(i,h),o=Math.min(o,d),n=Math.max(n,h+f),c=Math.max(c,d+p)}r=n-i,s=c-o}return C(n)||(n=new bf),n.x=i,n.y=o,n.width=r,n.height=s,n},kse.prototype.equals=function(e){return this===e||C(e)&&this._show===e._show&&this._scale===e._scale&&this._outlineWidth===e._outlineWidth&&this._showBackground===e._showBackground&&this._style===e._style&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&this._heightReference===e._heightReference&&this._renderedText===e._renderedText&&this._font===e._font&&K.equals(this._position,e._position)&&xy.equals(this._fillColor,e._fillColor)&&xy.equals(this._outlineColor,e._outlineColor)&&xy.equals(this._backgroundColor,e._backgroundColor)&&ro.equals(this._backgroundPadding,e._backgroundPadding)&&ro.equals(this._pixelOffset,e._pixelOffset)&&K.equals(this._eyeOffset,e._eyeOffset)&&LO.equals(this._translucencyByDistance,e._translucencyByDistance)&&LO.equals(this._pixelOffsetScaleByDistance,e._pixelOffsetScaleByDistance)&&LO.equals(this._scaleByDistance,e._scaleByDistance)&&WT.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance&&this._id===e._id},kse.prototype.isDestroyed=function(){return!1},kse.enableRightToLeftDetection=!1;const Wse="א-ת",qse="؀-ۿݐ-ݿࢠ-ࣿ",jse=new RegExp(`[${Wse}${qse}]`);function Yse(e){const t=e.split("\n");let n="";for(let i=0;i<t.length;i++){const e=t[i],o=jse.test(e.charAt(0)),r=Use(e,jse);let s=0,a="";for(let t=0;t<r.length;++t){const e=r[t],n=e.Type===Mse.BRACKETS?Gse(e.Word):Vse(e.Word);o?e.Type===Mse.RTL?(a=n+a,s=0):e.Type===Mse.LTR?(a=Hse(a,s,e.Word),s+=e.Word.length):e.Type!==Mse.WEAK&&e.Type!==Mse.BRACKETS||(e.Type===Mse.WEAK&&r[t-1].Type===Mse.BRACKETS?a=n+a:r[t-1].Type===Mse.RTL?(a=n+a,s=0):r.length>t+1?r[t+1].Type===Mse.RTL?(a=n+a,s=0):(a=Hse(a,s,e.Word),s+=e.Word.length):a=Hse(a,0,n)):e.Type===Mse.RTL?a=Hse(a,s,n):e.Type===Mse.LTR?(a+=e.Word,s=a.length):e.Type!==Mse.WEAK&&e.Type!==Mse.BRACKETS||(t>0&&r[t-1].Type===Mse.RTL?r.length>t+1?r[t+1].Type===Mse.RTL?a=Hse(a,s,n):(a+=e.Word,s=a.length):a+=e.Word:(a+=e.Word,s=a.length))}n+=a,i<t.length-1&&(n+="\n")}return n}var Kse=kse,Xse=(0,on.c)((function(e){function t(){var e=0,t=1,n=2,i=3,o=4,r=5,s=6,a=7,c=8,l=9,u=10,h=11,d=12,f=13,p=14,m=15,_=16,g=17,y=0,v=1,b=2,A=3,w=4;function T(e,t){return 55296<=e.charCodeAt(t)&&e.charCodeAt(t)<=56319&&56320<=e.charCodeAt(t+1)&&e.charCodeAt(t+1)<=57343}function C(e,t){void 0===t&&(t=0);var n=e.charCodeAt(t);if(55296<=n&&n<=56319&&t<e.length-1){var i=n,o=e.charCodeAt(t+1);return 56320<=o&&o<=57343?1024*(i-55296)+(o-56320)+65536:i}if(56320<=n&&n<=57343&&t>=1){i=e.charCodeAt(t-1),o=n;return 55296<=i&&i<=56319?1024*(i-55296)+(o-56320)+65536:o}return n}function E(h,T,C){var E=[h].concat(T).concat([C]),x=E[E.length-2],S=C,I=E.lastIndexOf(p);if(I>1&&E.slice(1,I).every((function(e){return e==i}))&&-1==[i,f,g].indexOf(h))return b;var O=E.lastIndexOf(o);if(O>0&&E.slice(1,O).every((function(e){return e==o}))&&-1==[d,o].indexOf(x))return E.filter((function(e){return e==o})).length%2==1?A:w;if(x==e&&S==t)return y;if(x==n||x==e||x==t)return S==p&&T.every((function(e){return e==i}))?b:v;if(S==n||S==e||S==t)return v;if(x==s&&(S==s||S==a||S==l||S==u))return y;if(!(x!=l&&x!=a||S!=a&&S!=c))return y;if((x==u||x==c)&&S==c)return y;if(S==i||S==m)return y;if(S==r)return y;if(x==d)return y;var D=-1!=E.indexOf(i)?E.lastIndexOf(i)-1:E.length-2;return-1!=[f,g].indexOf(E[D])&&E.slice(D+1,-1).every((function(e){return e==i}))&&S==p||x==m&&-1!=[_,g].indexOf(S)?y:-1!=T.indexOf(o)?b:x==o&&S==o?y:v}function x(y){return 1536<=y&&y<=1541||1757==y||1807==y||2274==y||3406==y||69821==y||70082<=y&&y<=70083||72250==y||72326<=y&&y<=72329||73030==y?d:13==y?e:10==y?t:0<=y&&y<=9||11<=y&&y<=12||14<=y&&y<=31||127<=y&&y<=159||173==y||1564==y||6158==y||8203==y||8206<=y&&y<=8207||8232==y||8233==y||8234<=y&&y<=8238||8288<=y&&y<=8292||8293==y||8294<=y&&y<=8303||55296<=y&&y<=57343||65279==y||65520<=y&&y<=65528||65529<=y&&y<=65531||113824<=y&&y<=113827||119155<=y&&y<=119162||917504==y||917505==y||917506<=y&&y<=917535||917632<=y&&y<=917759||918e3<=y&&y<=921599?n:768<=y&&y<=879||1155<=y&&y<=1159||1160<=y&&y<=1161||1425<=y&&y<=1469||1471==y||1473<=y&&y<=1474||1476<=y&&y<=1477||1479==y||1552<=y&&y<=1562||1611<=y&&y<=1631||1648==y||1750<=y&&y<=1756||1759<=y&&y<=1764||1767<=y&&y<=1768||1770<=y&&y<=1773||1809==y||1840<=y&&y<=1866||1958<=y&&y<=1968||2027<=y&&y<=2035||2070<=y&&y<=2073||2075<=y&&y<=2083||2085<=y&&y<=2087||2089<=y&&y<=2093||2137<=y&&y<=2139||2260<=y&&y<=2273||2275<=y&&y<=2306||2362==y||2364==y||2369<=y&&y<=2376||2381==y||2385<=y&&y<=2391||2402<=y&&y<=2403||2433==y||2492==y||2494==y||2497<=y&&y<=2500||2509==y||2519==y||2530<=y&&y<=2531||2561<=y&&y<=2562||2620==y||2625<=y&&y<=2626||2631<=y&&y<=2632||2635<=y&&y<=2637||2641==y||2672<=y&&y<=2673||2677==y||2689<=y&&y<=2690||2748==y||2753<=y&&y<=2757||2759<=y&&y<=2760||2765==y||2786<=y&&y<=2787||2810<=y&&y<=2815||2817==y||2876==y||2878==y||2879==y||2881<=y&&y<=2884||2893==y||2902==y||2903==y||2914<=y&&y<=2915||2946==y||3006==y||3008==y||3021==y||3031==y||3072==y||3134<=y&&y<=3136||3142<=y&&y<=3144||3146<=y&&y<=3149||3157<=y&&y<=3158||3170<=y&&y<=3171||3201==y||3260==y||3263==y||3266==y||3270==y||3276<=y&&y<=3277||3285<=y&&y<=3286||3298<=y&&y<=3299||3328<=y&&y<=3329||3387<=y&&y<=3388||3390==y||3393<=y&&y<=3396||3405==y||3415==y||3426<=y&&y<=3427||3530==y||3535==y||3538<=y&&y<=3540||3542==y||3551==y||3633==y||3636<=y&&y<=3642||3655<=y&&y<=3662||3761==y||3764<=y&&y<=3769||3771<=y&&y<=3772||3784<=y&&y<=3789||3864<=y&&y<=3865||3893==y||3895==y||3897==y||3953<=y&&y<=3966||3968<=y&&y<=3972||3974<=y&&y<=3975||3981<=y&&y<=3991||3993<=y&&y<=4028||4038==y||4141<=y&&y<=4144||4146<=y&&y<=4151||4153<=y&&y<=4154||4157<=y&&y<=4158||4184<=y&&y<=4185||4190<=y&&y<=4192||4209<=y&&y<=4212||4226==y||4229<=y&&y<=4230||4237==y||4253==y||4957<=y&&y<=4959||5906<=y&&y<=5908||5938<=y&&y<=5940||5970<=y&&y<=5971||6002<=y&&y<=6003||6068<=y&&y<=6069||6071<=y&&y<=6077||6086==y||6089<=y&&y<=6099||6109==y||6155<=y&&y<=6157||6277<=y&&y<=6278||6313==y||6432<=y&&y<=6434||6439<=y&&y<=6440||6450==y||6457<=y&&y<=6459||6679<=y&&y<=6680||6683==y||6742==y||6744<=y&&y<=6750||6752==y||6754==y||6757<=y&&y<=6764||6771<=y&&y<=6780||6783==y||6832<=y&&y<=6845||6846==y||6912<=y&&y<=6915||6964==y||6966<=y&&y<=6970||6972==y||6978==y||7019<=y&&y<=7027||7040<=y&&y<=7041||7074<=y&&y<=7077||7080<=y&&y<=7081||7083<=y&&y<=7085||7142==y||7144<=y&&y<=7145||7149==y||7151<=y&&y<=7153||7212<=y&&y<=7219||7222<=y&&y<=7223||7376<=y&&y<=7378||7380<=y&&y<=7392||7394<=y&&y<=7400||7405==y||7412==y||7416<=y&&y<=7417||7616<=y&&y<=7673||7675<=y&&y<=7679||8204==y||8400<=y&&y<=8412||8413<=y&&y<=8416||8417==y||8418<=y&&y<=8420||8421<=y&&y<=8432||11503<=y&&y<=11505||11647==y||11744<=y&&y<=11775||12330<=y&&y<=12333||12334<=y&&y<=12335||12441<=y&&y<=12442||42607==y||42608<=y&&y<=42610||42612<=y&&y<=42621||42654<=y&&y<=42655||42736<=y&&y<=42737||43010==y||43014==y||43019==y||43045<=y&&y<=43046||43204<=y&&y<=43205||43232<=y&&y<=43249||43302<=y&&y<=43309||43335<=y&&y<=43345||43392<=y&&y<=43394||43443==y||43446<=y&&y<=43449||43452==y||43493==y||43561<=y&&y<=43566||43569<=y&&y<=43570||43573<=y&&y<=43574||43587==y||43596==y||43644==y||43696==y||43698<=y&&y<=43700||43703<=y&&y<=43704||43710<=y&&y<=43711||43713==y||43756<=y&&y<=43757||43766==y||44005==y||44008==y||44013==y||64286==y||65024<=y&&y<=65039||65056<=y&&y<=65071||65438<=y&&y<=65439||66045==y||66272==y||66422<=y&&y<=66426||68097<=y&&y<=68099||68101<=y&&y<=68102||68108<=y&&y<=68111||68152<=y&&y<=68154||68159==y||68325<=y&&y<=68326||69633==y||69688<=y&&y<=69702||69759<=y&&y<=69761||69811<=y&&y<=69814||69817<=y&&y<=69818||69888<=y&&y<=69890||69927<=y&&y<=69931||69933<=y&&y<=69940||70003==y||70016<=y&&y<=70017||70070<=y&&y<=70078||70090<=y&&y<=70092||70191<=y&&y<=70193||70196==y||70198<=y&&y<=70199||70206==y||70367==y||70371<=y&&y<=70378||70400<=y&&y<=70401||70460==y||70462==y||70464==y||70487==y||70502<=y&&y<=70508||70512<=y&&y<=70516||70712<=y&&y<=70719||70722<=y&&y<=70724||70726==y||70832==y||70835<=y&&y<=70840||70842==y||70845==y||70847<=y&&y<=70848||70850<=y&&y<=70851||71087==y||71090<=y&&y<=71093||71100<=y&&y<=71101||71103<=y&&y<=71104||71132<=y&&y<=71133||71219<=y&&y<=71226||71229==y||71231<=y&&y<=71232||71339==y||71341==y||71344<=y&&y<=71349||71351==y||71453<=y&&y<=71455||71458<=y&&y<=71461||71463<=y&&y<=71467||72193<=y&&y<=72198||72201<=y&&y<=72202||72243<=y&&y<=72248||72251<=y&&y<=72254||72263==y||72273<=y&&y<=72278||72281<=y&&y<=72283||72330<=y&&y<=72342||72344<=y&&y<=72345||72752<=y&&y<=72758||72760<=y&&y<=72765||72767==y||72850<=y&&y<=72871||72874<=y&&y<=72880||72882<=y&&y<=72883||72885<=y&&y<=72886||73009<=y&&y<=73014||73018==y||73020<=y&&y<=73021||73023<=y&&y<=73029||73031==y||92912<=y&&y<=92916||92976<=y&&y<=92982||94095<=y&&y<=94098||113821<=y&&y<=113822||119141==y||119143<=y&&y<=119145||119150<=y&&y<=119154||119163<=y&&y<=119170||119173<=y&&y<=119179||119210<=y&&y<=119213||119362<=y&&y<=119364||121344<=y&&y<=121398||121403<=y&&y<=121452||121461==y||121476==y||121499<=y&&y<=121503||121505<=y&&y<=121519||122880<=y&&y<=122886||122888<=y&&y<=122904||122907<=y&&y<=122913||122915<=y&&y<=122916||122918<=y&&y<=122922||125136<=y&&y<=125142||125252<=y&&y<=125258||917536<=y&&y<=917631||917760<=y&&y<=917999?i:127462<=y&&y<=127487?o:2307==y||2363==y||2366<=y&&y<=2368||2377<=y&&y<=2380||2382<=y&&y<=2383||2434<=y&&y<=2435||2495<=y&&y<=2496||2503<=y&&y<=2504||2507<=y&&y<=2508||2563==y||2622<=y&&y<=2624||2691==y||2750<=y&&y<=2752||2761==y||2763<=y&&y<=2764||2818<=y&&y<=2819||2880==y||2887<=y&&y<=2888||2891<=y&&y<=2892||3007==y||3009<=y&&y<=3010||3014<=y&&y<=3016||3018<=y&&y<=3020||3073<=y&&y<=3075||3137<=y&&y<=3140||3202<=y&&y<=3203||3262==y||3264<=y&&y<=3265||3267<=y&&y<=3268||3271<=y&&y<=3272||3274<=y&&y<=3275||3330<=y&&y<=3331||3391<=y&&y<=3392||3398<=y&&y<=3400||3402<=y&&y<=3404||3458<=y&&y<=3459||3536<=y&&y<=3537||3544<=y&&y<=3550||3570<=y&&y<=3571||3635==y||3763==y||3902<=y&&y<=3903||3967==y||4145==y||4155<=y&&y<=4156||4182<=y&&y<=4183||4228==y||6070==y||6078<=y&&y<=6085||6087<=y&&y<=6088||6435<=y&&y<=6438||6441<=y&&y<=6443||6448<=y&&y<=6449||6451<=y&&y<=6456||6681<=y&&y<=6682||6741==y||6743==y||6765<=y&&y<=6770||6916==y||6965==y||6971==y||6973<=y&&y<=6977||6979<=y&&y<=6980||7042==y||7073==y||7078<=y&&y<=7079||7082==y||7143==y||7146<=y&&y<=7148||7150==y||7154<=y&&y<=7155||7204<=y&&y<=7211||7220<=y&&y<=7221||7393==y||7410<=y&&y<=7411||7415==y||43043<=y&&y<=43044||43047==y||43136<=y&&y<=43137||43188<=y&&y<=43203||43346<=y&&y<=43347||43395==y||43444<=y&&y<=43445||43450<=y&&y<=43451||43453<=y&&y<=43456||43567<=y&&y<=43568||43571<=y&&y<=43572||43597==y||43755==y||43758<=y&&y<=43759||43765==y||44003<=y&&y<=44004||44006<=y&&y<=44007||44009<=y&&y<=44010||44012==y||69632==y||69634==y||69762==y||69808<=y&&y<=69810||69815<=y&&y<=69816||69932==y||70018==y||70067<=y&&y<=70069||70079<=y&&y<=70080||70188<=y&&y<=70190||70194<=y&&y<=70195||70197==y||70368<=y&&y<=70370||70402<=y&&y<=70403||70463==y||70465<=y&&y<=70468||70471<=y&&y<=70472||70475<=y&&y<=70477||70498<=y&&y<=70499||70709<=y&&y<=70711||70720<=y&&y<=70721||70725==y||70833<=y&&y<=70834||70841==y||70843<=y&&y<=70844||70846==y||70849==y||71088<=y&&y<=71089||71096<=y&&y<=71099||71102==y||71216<=y&&y<=71218||71227<=y&&y<=71228||71230==y||71340==y||71342<=y&&y<=71343||71350==y||71456<=y&&y<=71457||71462==y||72199<=y&&y<=72200||72249==y||72279<=y&&y<=72280||72343==y||72751==y||72766==y||72873==y||72881==y||72884==y||94033<=y&&y<=94078||119142==y||119149==y?r:4352<=y&&y<=4447||43360<=y&&y<=43388?s:4448<=y&&y<=4519||55216<=y&&y<=55238?a:4520<=y&&y<=4607||55243<=y&&y<=55291?c:44032==y||44060==y||44088==y||44116==y||44144==y||44172==y||44200==y||44228==y||44256==y||44284==y||44312==y||44340==y||44368==y||44396==y||44424==y||44452==y||44480==y||44508==y||44536==y||44564==y||44592==y||44620==y||44648==y||44676==y||44704==y||44732==y||44760==y||44788==y||44816==y||44844==y||44872==y||44900==y||44928==y||44956==y||44984==y||45012==y||45040==y||45068==y||45096==y||45124==y||45152==y||45180==y||45208==y||45236==y||45264==y||45292==y||45320==y||45348==y||45376==y||45404==y||45432==y||45460==y||45488==y||45516==y||45544==y||45572==y||45600==y||45628==y||45656==y||45684==y||45712==y||45740==y||45768==y||45796==y||45824==y||45852==y||45880==y||45908==y||45936==y||45964==y||45992==y||46020==y||46048==y||46076==y||46104==y||46132==y||46160==y||46188==y||46216==y||46244==y||46272==y||46300==y||46328==y||46356==y||46384==y||46412==y||46440==y||46468==y||46496==y||46524==y||46552==y||46580==y||46608==y||46636==y||46664==y||46692==y||46720==y||46748==y||46776==y||46804==y||46832==y||46860==y||46888==y||46916==y||46944==y||46972==y||47e3==y||47028==y||47056==y||47084==y||47112==y||47140==y||47168==y||47196==y||47224==y||47252==y||47280==y||47308==y||47336==y||47364==y||47392==y||47420==y||47448==y||47476==y||47504==y||47532==y||47560==y||47588==y||47616==y||47644==y||47672==y||47700==y||47728==y||47756==y||47784==y||47812==y||47840==y||47868==y||47896==y||47924==y||47952==y||47980==y||48008==y||48036==y||48064==y||48092==y||48120==y||48148==y||48176==y||48204==y||48232==y||48260==y||48288==y||48316==y||48344==y||48372==y||48400==y||48428==y||48456==y||48484==y||48512==y||48540==y||48568==y||48596==y||48624==y||48652==y||48680==y||48708==y||48736==y||48764==y||48792==y||48820==y||48848==y||48876==y||48904==y||48932==y||48960==y||48988==y||49016==y||49044==y||49072==y||49100==y||49128==y||49156==y||49184==y||49212==y||49240==y||49268==y||49296==y||49324==y||49352==y||49380==y||49408==y||49436==y||49464==y||49492==y||49520==y||49548==y||49576==y||49604==y||49632==y||49660==y||49688==y||49716==y||49744==y||49772==y||49800==y||49828==y||49856==y||49884==y||49912==y||49940==y||49968==y||49996==y||50024==y||50052==y||50080==y||50108==y||50136==y||50164==y||50192==y||50220==y||50248==y||50276==y||50304==y||50332==y||50360==y||50388==y||50416==y||50444==y||50472==y||50500==y||50528==y||50556==y||50584==y||50612==y||50640==y||50668==y||50696==y||50724==y||50752==y||50780==y||50808==y||50836==y||50864==y||50892==y||50920==y||50948==y||50976==y||51004==y||51032==y||51060==y||51088==y||51116==y||51144==y||51172==y||51200==y||51228==y||51256==y||51284==y||51312==y||51340==y||51368==y||51396==y||51424==y||51452==y||51480==y||51508==y||51536==y||51564==y||51592==y||51620==y||51648==y||51676==y||51704==y||51732==y||51760==y||51788==y||51816==y||51844==y||51872==y||51900==y||51928==y||51956==y||51984==y||52012==y||52040==y||52068==y||52096==y||52124==y||52152==y||52180==y||52208==y||52236==y||52264==y||52292==y||52320==y||52348==y||52376==y||52404==y||52432==y||52460==y||52488==y||52516==y||52544==y||52572==y||52600==y||52628==y||52656==y||52684==y||52712==y||52740==y||52768==y||52796==y||52824==y||52852==y||52880==y||52908==y||52936==y||52964==y||52992==y||53020==y||53048==y||53076==y||53104==y||53132==y||53160==y||53188==y||53216==y||53244==y||53272==y||53300==y||53328==y||53356==y||53384==y||53412==y||53440==y||53468==y||53496==y||53524==y||53552==y||53580==y||53608==y||53636==y||53664==y||53692==y||53720==y||53748==y||53776==y||53804==y||53832==y||53860==y||53888==y||53916==y||53944==y||53972==y||54e3==y||54028==y||54056==y||54084==y||54112==y||54140==y||54168==y||54196==y||54224==y||54252==y||54280==y||54308==y||54336==y||54364==y||54392==y||54420==y||54448==y||54476==y||54504==y||54532==y||54560==y||54588==y||54616==y||54644==y||54672==y||54700==y||54728==y||54756==y||54784==y||54812==y||54840==y||54868==y||54896==y||54924==y||54952==y||54980==y||55008==y||55036==y||55064==y||55092==y||55120==y||55148==y||55176==y?l:44033<=y&&y<=44059||44061<=y&&y<=44087||44089<=y&&y<=44115||44117<=y&&y<=44143||44145<=y&&y<=44171||44173<=y&&y<=44199||44201<=y&&y<=44227||44229<=y&&y<=44255||44257<=y&&y<=44283||44285<=y&&y<=44311||44313<=y&&y<=44339||44341<=y&&y<=44367||44369<=y&&y<=44395||44397<=y&&y<=44423||44425<=y&&y<=44451||44453<=y&&y<=44479||44481<=y&&y<=44507||44509<=y&&y<=44535||44537<=y&&y<=44563||44565<=y&&y<=44591||44593<=y&&y<=44619||44621<=y&&y<=44647||44649<=y&&y<=44675||44677<=y&&y<=44703||44705<=y&&y<=44731||44733<=y&&y<=44759||44761<=y&&y<=44787||44789<=y&&y<=44815||44817<=y&&y<=44843||44845<=y&&y<=44871||44873<=y&&y<=44899||44901<=y&&y<=44927||44929<=y&&y<=44955||44957<=y&&y<=44983||44985<=y&&y<=45011||45013<=y&&y<=45039||45041<=y&&y<=45067||45069<=y&&y<=45095||45097<=y&&y<=45123||45125<=y&&y<=45151||45153<=y&&y<=45179||45181<=y&&y<=45207||45209<=y&&y<=45235||45237<=y&&y<=45263||45265<=y&&y<=45291||45293<=y&&y<=45319||45321<=y&&y<=45347||45349<=y&&y<=45375||45377<=y&&y<=45403||45405<=y&&y<=45431||45433<=y&&y<=45459||45461<=y&&y<=45487||45489<=y&&y<=45515||45517<=y&&y<=45543||45545<=y&&y<=45571||45573<=y&&y<=45599||45601<=y&&y<=45627||45629<=y&&y<=45655||45657<=y&&y<=45683||45685<=y&&y<=45711||45713<=y&&y<=45739||45741<=y&&y<=45767||45769<=y&&y<=45795||45797<=y&&y<=45823||45825<=y&&y<=45851||45853<=y&&y<=45879||45881<=y&&y<=45907||45909<=y&&y<=45935||45937<=y&&y<=45963||45965<=y&&y<=45991||45993<=y&&y<=46019||46021<=y&&y<=46047||46049<=y&&y<=46075||46077<=y&&y<=46103||46105<=y&&y<=46131||46133<=y&&y<=46159||46161<=y&&y<=46187||46189<=y&&y<=46215||46217<=y&&y<=46243||46245<=y&&y<=46271||46273<=y&&y<=46299||46301<=y&&y<=46327||46329<=y&&y<=46355||46357<=y&&y<=46383||46385<=y&&y<=46411||46413<=y&&y<=46439||46441<=y&&y<=46467||46469<=y&&y<=46495||46497<=y&&y<=46523||46525<=y&&y<=46551||46553<=y&&y<=46579||46581<=y&&y<=46607||46609<=y&&y<=46635||46637<=y&&y<=46663||46665<=y&&y<=46691||46693<=y&&y<=46719||46721<=y&&y<=46747||46749<=y&&y<=46775||46777<=y&&y<=46803||46805<=y&&y<=46831||46833<=y&&y<=46859||46861<=y&&y<=46887||46889<=y&&y<=46915||46917<=y&&y<=46943||46945<=y&&y<=46971||46973<=y&&y<=46999||47001<=y&&y<=47027||47029<=y&&y<=47055||47057<=y&&y<=47083||47085<=y&&y<=47111||47113<=y&&y<=47139||47141<=y&&y<=47167||47169<=y&&y<=47195||47197<=y&&y<=47223||47225<=y&&y<=47251||47253<=y&&y<=47279||47281<=y&&y<=47307||47309<=y&&y<=47335||47337<=y&&y<=47363||47365<=y&&y<=47391||47393<=y&&y<=47419||47421<=y&&y<=47447||47449<=y&&y<=47475||47477<=y&&y<=47503||47505<=y&&y<=47531||47533<=y&&y<=47559||47561<=y&&y<=47587||47589<=y&&y<=47615||47617<=y&&y<=47643||47645<=y&&y<=47671||47673<=y&&y<=47699||47701<=y&&y<=47727||47729<=y&&y<=47755||47757<=y&&y<=47783||47785<=y&&y<=47811||47813<=y&&y<=47839||47841<=y&&y<=47867||47869<=y&&y<=47895||47897<=y&&y<=47923||47925<=y&&y<=47951||47953<=y&&y<=47979||47981<=y&&y<=48007||48009<=y&&y<=48035||48037<=y&&y<=48063||48065<=y&&y<=48091||48093<=y&&y<=48119||48121<=y&&y<=48147||48149<=y&&y<=48175||48177<=y&&y<=48203||48205<=y&&y<=48231||48233<=y&&y<=48259||48261<=y&&y<=48287||48289<=y&&y<=48315||48317<=y&&y<=48343||48345<=y&&y<=48371||48373<=y&&y<=48399||48401<=y&&y<=48427||48429<=y&&y<=48455||48457<=y&&y<=48483||48485<=y&&y<=48511||48513<=y&&y<=48539||48541<=y&&y<=48567||48569<=y&&y<=48595||48597<=y&&y<=48623||48625<=y&&y<=48651||48653<=y&&y<=48679||48681<=y&&y<=48707||48709<=y&&y<=48735||48737<=y&&y<=48763||48765<=y&&y<=48791||48793<=y&&y<=48819||48821<=y&&y<=48847||48849<=y&&y<=48875||48877<=y&&y<=48903||48905<=y&&y<=48931||48933<=y&&y<=48959||48961<=y&&y<=48987||48989<=y&&y<=49015||49017<=y&&y<=49043||49045<=y&&y<=49071||49073<=y&&y<=49099||49101<=y&&y<=49127||49129<=y&&y<=49155||49157<=y&&y<=49183||49185<=y&&y<=49211||49213<=y&&y<=49239||49241<=y&&y<=49267||49269<=y&&y<=49295||49297<=y&&y<=49323||49325<=y&&y<=49351||49353<=y&&y<=49379||49381<=y&&y<=49407||49409<=y&&y<=49435||49437<=y&&y<=49463||49465<=y&&y<=49491||49493<=y&&y<=49519||49521<=y&&y<=49547||49549<=y&&y<=49575||49577<=y&&y<=49603||49605<=y&&y<=49631||49633<=y&&y<=49659||49661<=y&&y<=49687||49689<=y&&y<=49715||49717<=y&&y<=49743||49745<=y&&y<=49771||49773<=y&&y<=49799||49801<=y&&y<=49827||49829<=y&&y<=49855||49857<=y&&y<=49883||49885<=y&&y<=49911||49913<=y&&y<=49939||49941<=y&&y<=49967||49969<=y&&y<=49995||49997<=y&&y<=50023||50025<=y&&y<=50051||50053<=y&&y<=50079||50081<=y&&y<=50107||50109<=y&&y<=50135||50137<=y&&y<=50163||50165<=y&&y<=50191||50193<=y&&y<=50219||50221<=y&&y<=50247||50249<=y&&y<=50275||50277<=y&&y<=50303||50305<=y&&y<=50331||50333<=y&&y<=50359||50361<=y&&y<=50387||50389<=y&&y<=50415||50417<=y&&y<=50443||50445<=y&&y<=50471||50473<=y&&y<=50499||50501<=y&&y<=50527||50529<=y&&y<=50555||50557<=y&&y<=50583||50585<=y&&y<=50611||50613<=y&&y<=50639||50641<=y&&y<=50667||50669<=y&&y<=50695||50697<=y&&y<=50723||50725<=y&&y<=50751||50753<=y&&y<=50779||50781<=y&&y<=50807||50809<=y&&y<=50835||50837<=y&&y<=50863||50865<=y&&y<=50891||50893<=y&&y<=50919||50921<=y&&y<=50947||50949<=y&&y<=50975||50977<=y&&y<=51003||51005<=y&&y<=51031||51033<=y&&y<=51059||51061<=y&&y<=51087||51089<=y&&y<=51115||51117<=y&&y<=51143||51145<=y&&y<=51171||51173<=y&&y<=51199||51201<=y&&y<=51227||51229<=y&&y<=51255||51257<=y&&y<=51283||51285<=y&&y<=51311||51313<=y&&y<=51339||51341<=y&&y<=51367||51369<=y&&y<=51395||51397<=y&&y<=51423||51425<=y&&y<=51451||51453<=y&&y<=51479||51481<=y&&y<=51507||51509<=y&&y<=51535||51537<=y&&y<=51563||51565<=y&&y<=51591||51593<=y&&y<=51619||51621<=y&&y<=51647||51649<=y&&y<=51675||51677<=y&&y<=51703||51705<=y&&y<=51731||51733<=y&&y<=51759||51761<=y&&y<=51787||51789<=y&&y<=51815||51817<=y&&y<=51843||51845<=y&&y<=51871||51873<=y&&y<=51899||51901<=y&&y<=51927||51929<=y&&y<=51955||51957<=y&&y<=51983||51985<=y&&y<=52011||52013<=y&&y<=52039||52041<=y&&y<=52067||52069<=y&&y<=52095||52097<=y&&y<=52123||52125<=y&&y<=52151||52153<=y&&y<=52179||52181<=y&&y<=52207||52209<=y&&y<=52235||52237<=y&&y<=52263||52265<=y&&y<=52291||52293<=y&&y<=52319||52321<=y&&y<=52347||52349<=y&&y<=52375||52377<=y&&y<=52403||52405<=y&&y<=52431||52433<=y&&y<=52459||52461<=y&&y<=52487||52489<=y&&y<=52515||52517<=y&&y<=52543||52545<=y&&y<=52571||52573<=y&&y<=52599||52601<=y&&y<=52627||52629<=y&&y<=52655||52657<=y&&y<=52683||52685<=y&&y<=52711||52713<=y&&y<=52739||52741<=y&&y<=52767||52769<=y&&y<=52795||52797<=y&&y<=52823||52825<=y&&y<=52851||52853<=y&&y<=52879||52881<=y&&y<=52907||52909<=y&&y<=52935||52937<=y&&y<=52963||52965<=y&&y<=52991||52993<=y&&y<=53019||53021<=y&&y<=53047||53049<=y&&y<=53075||53077<=y&&y<=53103||53105<=y&&y<=53131||53133<=y&&y<=53159||53161<=y&&y<=53187||53189<=y&&y<=53215||53217<=y&&y<=53243||53245<=y&&y<=53271||53273<=y&&y<=53299||53301<=y&&y<=53327||53329<=y&&y<=53355||53357<=y&&y<=53383||53385<=y&&y<=53411||53413<=y&&y<=53439||53441<=y&&y<=53467||53469<=y&&y<=53495||53497<=y&&y<=53523||53525<=y&&y<=53551||53553<=y&&y<=53579||53581<=y&&y<=53607||53609<=y&&y<=53635||53637<=y&&y<=53663||53665<=y&&y<=53691||53693<=y&&y<=53719||53721<=y&&y<=53747||53749<=y&&y<=53775||53777<=y&&y<=53803||53805<=y&&y<=53831||53833<=y&&y<=53859||53861<=y&&y<=53887||53889<=y&&y<=53915||53917<=y&&y<=53943||53945<=y&&y<=53971||53973<=y&&y<=53999||54001<=y&&y<=54027||54029<=y&&y<=54055||54057<=y&&y<=54083||54085<=y&&y<=54111||54113<=y&&y<=54139||54141<=y&&y<=54167||54169<=y&&y<=54195||54197<=y&&y<=54223||54225<=y&&y<=54251||54253<=y&&y<=54279||54281<=y&&y<=54307||54309<=y&&y<=54335||54337<=y&&y<=54363||54365<=y&&y<=54391||54393<=y&&y<=54419||54421<=y&&y<=54447||54449<=y&&y<=54475||54477<=y&&y<=54503||54505<=y&&y<=54531||54533<=y&&y<=54559||54561<=y&&y<=54587||54589<=y&&y<=54615||54617<=y&&y<=54643||54645<=y&&y<=54671||54673<=y&&y<=54699||54701<=y&&y<=54727||54729<=y&&y<=54755||54757<=y&&y<=54783||54785<=y&&y<=54811||54813<=y&&y<=54839||54841<=y&&y<=54867||54869<=y&&y<=54895||54897<=y&&y<=54923||54925<=y&&y<=54951||54953<=y&&y<=54979||54981<=y&&y<=55007||55009<=y&&y<=55035||55037<=y&&y<=55063||55065<=y&&y<=55091||55093<=y&&y<=55119||55121<=y&&y<=55147||55149<=y&&y<=55175||55177<=y&&y<=55203?u:9757==y||9977==y||9994<=y&&y<=9997||127877==y||127938<=y&&y<=127940||127943==y||127946<=y&&y<=127948||128066<=y&&y<=128067||128070<=y&&y<=128080||128110==y||128112<=y&&y<=128120||128124==y||128129<=y&&y<=128131||128133<=y&&y<=128135||128170==y||128372<=y&&y<=128373||128378==y||128400==y||128405<=y&&y<=128406||128581<=y&&y<=128583||128587<=y&&y<=128591||128675==y||128692<=y&&y<=128694||128704==y||128716==y||129304<=y&&y<=129308||129310<=y&&y<=129311||129318==y||129328<=y&&y<=129337||129341<=y&&y<=129342||129489<=y&&y<=129501?f:127995<=y&&y<=127999?p:8205==y?m:9792==y||9794==y||9877<=y&&y<=9878||9992==y||10084==y||127752==y||127806==y||127859==y||127891==y||127908==y||127912==y||127979==y||127981==y||128139==y||128187<=y&&y<=128188||128295==y||128300==y||128488==y||128640==y||128658==y?_:128102<=y&&y<=128105?g:h}return this.nextBreak=function(e,t){if(void 0===t&&(t=0),t<0)return 0;if(t>=e.length-1)return e.length;for(var n=x(C(e,t)),i=[],o=t+1;o<e.length;o++)if(!T(e,o-1)){var r=x(C(e,o));if(E(n,i,r))return o;i.push(r)}return e.length},this.splitGraphemes=function(e){var t,n=[],i=0;while((t=this.nextBreak(e,i))<e.length)n.push(e.slice(i,t)),i=t;return i<e.length&&n.push(e.slice(i)),n},this.iterateGraphemes=function(e){var t=0,n={next:function(){var n,i;return(i=this.nextBreak(e,t))<e.length?(n=e.slice(t,i),t=i,{value:n,done:!1}):t<e.length?(n=e.slice(t),t=e.length,{value:n,done:!1}):{value:void 0,done:!0}}.bind(this)};return"undefined"!==typeof Symbol&&Symbol.iterator&&(n[Symbol.iterator]=function(){return n}),n},this.countGraphemes=function(e){var t,n=0,i=0;while((t=this.nextBreak(e,i))<e.length)i=t,n++;return i<e.length&&n++,n},this}e.exports&&(e.exports=t)}));function Qse(){this.textureInfo=void 0,this.dimensions=void 0,this.billboard=void 0}function Jse(e,t,n){this.labelCollection=e,this.index=t,this.dimensions=n}const Zse=1.2,$se="ID_WHITE_PIXEL",eae=new ro(4,4),tae=new bf(1,1,1,1);function nae(e,t){const n=document.createElement("canvas");n.width=eae.x,n.height=eae.y;const i=n.getContext("2d");return i.fillStyle="#fff",i.fillRect(0,0,n.width,n.height),e.addImage($se,n).then((function(e){t._whitePixelIndex=e}))}const iae={};function oae(e,t,n,i,o,r,s){return iae.font=t,iae.fillColor=n,iae.strokeColor=i,iae.strokeWidth=o,iae.padding=Qoe.PADDING,s===Pz.CENTER?iae.textBaseline="middle":s===Pz.TOP?iae.textBaseline="top":iae.textBaseline="bottom",iae.fill=r===Ise.FILL||r===Ise.FILL_AND_OUTLINE,iae.stroke=r===Ise.OUTLINE||r===Ise.FILL_AND_OUTLINE,iae.backgroundColor=xy.BLACK,nD(e,iae)}function rae(e,t){t.textureInfo=void 0,t.dimensions=void 0;const n=t.billboard;C(n)&&(n.show=!1,n.image=void 0,C(n._removeCallbackFunc)&&(n._removeCallbackFunc(),n._removeCallbackFunc=void 0),e._spareBillboards.push(n),t.billboard=void 0)}function sae(e,t,n,i){i.index=e.addImageSync(t,n)}const aae=new Xse;function cae(e,t){const n=t._renderedText,i=aae.splitGraphemes(n),o=i.length,r=t._glyphs,s=r.length;let a,c,l;if(t._relativeSize=t._fontSize/Qoe.FONT_SIZE,o<s)for(c=o;c<s;++c)rae(e,r[c]);r.length=o;const u=t._showBackground&&n.split("\n").join("").length>0;let h=t._backgroundBillboard;const d=e._backgroundBillboardCollection;u?(C(h)||(h=d.add({collection:e,image:$se,imageSubRegion:tae}),t._backgroundBillboard=h),h.color=t._backgroundColor,h.show=t._show,h.position=t._position,h.eyeOffset=t._eyeOffset,h.pixelOffset=t._pixelOffset,h.horizontalOrigin=Oz.LEFT,h.verticalOrigin=t._verticalOrigin,h.heightReference=t._heightReference,h.scale=t.totalScale,h.pickPrimitive=t,h.id=t._id,h.translucencyByDistance=t._translucencyByDistance,h.pixelOffsetScaleByDistance=t._pixelOffsetScaleByDistance,h.scaleByDistance=t._scaleByDistance,h.distanceDisplayCondition=t._distanceDisplayCondition,h.disableDepthTestDistance=t._disableDepthTestDistance):C(h)&&(d.remove(h),t._backgroundBillboard=h=void 0);const f=e._glyphTextureCache;for(l=0;l<o;++l){const n=i[l],o=t._verticalOrigin,s=JSON.stringify([n,t._fontFamily,t._fontStyle,t._fontWeight,+o]);let c=f[s];if(!C(c)){const i=`${t._fontStyle} ${t._fontWeight} ${Qoe.FONT_SIZE}px ${t._fontFamily}`,r=oae(n,i,xy.WHITE,xy.WHITE,0,Ise.FILL,o);if(c=new Jse(e,-1,r.dimensions),f[s]=c,r.width>0&&r.height>0){const t=wse(r,{cutoff:Qoe.CUTOFF,radius:Qoe.RADIUS}),i=r.getContext("2d"),o=r.width,a=r.height,l=i.getImageData(0,0,o,a);for(let e=0;e<o;e++)for(let n=0;n<a;n++){const i=n*o+e,r=255*t[i],s=4*i;l.data[s+0]=r,l.data[s+1]=r,l.data[s+2]=r,l.data[s+3]=r}i.putImageData(l,0,0)," "!==n&&sae(e._textureAtlas,s,r,c)}}if(a=r[l],C(a)?-1===c.index?rae(e,a):C(a.textureInfo)&&(a.textureInfo=void 0):(a=new Qse,r[l]=a),a.textureInfo=c,a.dimensions=c.dimensions,-1!==c.index){let n=a.billboard;const i=e._spareBillboards;C(n)||(i.length>0?n=i.pop():(n=e._billboardCollection.add({collection:e}),n._labelDimensions=new ro,n._labelTranslate=new ro),a.billboard=n),n.show=t._show,n.position=t._position,n.eyeOffset=t._eyeOffset,n.pixelOffset=t._pixelOffset,n.horizontalOrigin=Oz.LEFT,n.verticalOrigin=t._verticalOrigin,n.heightReference=t._heightReference,n.scale=t.totalScale,n.pickPrimitive=t,n.id=t._id,n.image=s,n.translucencyByDistance=t._translucencyByDistance,n.pixelOffsetScaleByDistance=t._pixelOffsetScaleByDistance,n.scaleByDistance=t._scaleByDistance,n.distanceDisplayCondition=t._distanceDisplayCondition,n.disableDepthTestDistance=t._disableDepthTestDistance,n._batchIndex=t._batchIndex,n.outlineColor=t.outlineColor,t.style===Ise.FILL_AND_OUTLINE?(n.color=t._fillColor,n.outlineWidth=t.outlineWidth):t.style===Ise.FILL?(n.color=t._fillColor,n.outlineWidth=0):t.style===Ise.OUTLINE&&(n.color=xy.TRANSPARENT,n.outlineWidth=t.outlineWidth)}}t._repositionAllGlyphs=!0}function lae(e,t,n){return t===Oz.CENTER?-e/2:t===Oz.RIGHT?-(e+n.x):n.x}const uae=new ro,hae=new ro;function dae(e){const t=e._glyphs,n=e._renderedText;let i,o,r=0,s=0;const a=[];let c,l=Number.NEGATIVE_INFINITY,u=0,h=1;const d=t.length,f=e._backgroundBillboard,p=ro.clone(C(f)?e._backgroundPadding:ro.ZERO,hae);for(p.x/=e._relativeSize,p.y/=e._relativeSize,c=0;c<d;++c)"\n"===n.charAt(c)?(a.push(r),++h,r=0):(i=t[c],o=i.dimensions,u=Math.max(u,o.height-o.descent),l=Math.max(l,o.descent),r+=o.width-o.minx,c<d-1&&(r+=t[c+1].dimensions.minx),s=Math.max(s,r));a.push(r);const m=u+l,_=e.totalScale,g=e._horizontalOrigin,y=e._verticalOrigin;let v=0,b=a[v],A=lae(b,g,p);const w=(C(e._lineHeight)?e._lineHeight:Zse*e._fontSize)/e._relativeSize,T=w*(h-1);let E=s,x=m+T;C(f)&&(E+=2*p.x,x+=2*p.y,f._labelHorizontalOrigin=g),uae.x=A*_,uae.y=0;let S=!0,I=0;for(c=0;c<d;++c)if("\n"===n.charAt(c))++v,I+=w,b=a[v],A=lae(b,g,p),uae.x=A*_,S=!0;else if(i=t[c],o=i.dimensions,y===Pz.TOP?(uae.y=o.height-u-p.y,uae.y+=Qoe.PADDING):y===Pz.CENTER?uae.y=(T+o.height-u)/2:y===Pz.BASELINE?(uae.y=T,uae.y-=Qoe.PADDING):(uae.y=T+l+p.y,uae.y-=Qoe.PADDING),uae.y=(uae.y-o.descent-I)*_,S&&(uae.x-=Qoe.PADDING*_,S=!1),C(i.billboard)&&(i.billboard._setTranslate(uae),i.billboard._labelDimensions.x=E,i.billboard._labelDimensions.y=x,i.billboard._labelHorizontalOrigin=g),c<d-1){const e=t[c+1];uae.x+=(o.width-o.minx+e.dimensions.minx)*_}if(C(f)&&n.split("\n").join("").length>0&&(A=g===Oz.CENTER?-s/2-p.x:g===Oz.RIGHT?-(s+2*p.x):0,uae.x=A*_,y===Pz.TOP?uae.y=m-u-l:y===Pz.CENTER?uae.y=(m-u)/2-l:y===Pz.BASELINE?uae.y=-p.y-l:uae.y=0,uae.y=uae.y*_,f.width=E,f.height=x,f._setTranslate(uae),f._labelTranslate=ro.clone(uae,f._labelTranslate)),e.heightReference===Sz.CLAMP_TO_GROUND)for(c=0;c<d;++c){i=t[c];const e=i.billboard;C(e)&&(e._labelTranslate=ro.clone(uae,e._labelTranslate))}}function fae(e,t){const n=t._glyphs;for(let i=0,o=n.length;i<o;++i)rae(e,n[i]);C(t._backgroundBillboard)&&(e._backgroundBillboardCollection.remove(t._backgroundBillboard),t._backgroundBillboard=void 0),t._labelCollection=void 0,C(t._removeCallbackFunc)&&t._removeCallbackFunc(),Qh(t)}function pae(e){e=R(e,R.EMPTY_OBJECT),this._scene=e.scene,this._batchTable=e.batchTable,this._textureAtlas=void 0,this._backgroundTextureAtlas=void 0,this._whitePixelIndex=void 0,this._backgroundBillboardCollection=new fse({scene:this._scene}),this._backgroundBillboardCollection.destroyTextureAtlas=!1,this._backgroundImageReady=!0,this._billboardCollection=new fse({scene:this._scene,batchTable:this._batchTable}),this._billboardCollection.destroyTextureAtlas=!1,this._billboardCollection._sdf=!0,this._spareBillboards=[],this._glyphTextureCache={},this._labels=[],this._labelsToUpdate=[],this._totalGlyphCount=0,this._highlightColor=xy.clone(xy.WHITE),this.show=R(e.show,!0),this.modelMatrix=ft.clone(R(e.modelMatrix,ft.IDENTITY)),this.debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this.blendOption=R(e.blendOption,Koe.OPAQUE_AND_TRANSLUCENT)}Object.defineProperties(pae.prototype,{length:{get:function(){return this._labels.length}}}),pae.prototype.add=function(e){const t=new Kse(e,this);return this._labels.push(t),this._labelsToUpdate.push(t),t},pae.prototype.remove=function(e){if(C(e)&&e._labelCollection===this){const t=this._labels.indexOf(e);if(-1!==t)return this._labels.splice(t,1),fae(this,e),!0}return!1},pae.prototype.removeAll=function(){const e=this._labels;for(let t=0,n=e.length;t<n;++t)fae(this,e[t]);e.length=0},pae.prototype.contains=function(e){return C(e)&&e._labelCollection===this},pae.prototype.get=function(e){if(!C(e))throw new x("index is required.");return this._labels[e]},pae.prototype.update=function(e){if(!this.show)return;const t=this._billboardCollection,n=this._backgroundBillboardCollection;t.modelMatrix=this.modelMatrix,t.debugShowBoundingVolume=this.debugShowBoundingVolume,n.modelMatrix=this.modelMatrix,n.debugShowBoundingVolume=this.debugShowBoundingVolume;const i=e.context;C(this._textureAtlas)||(this._textureAtlas=new ore({context:i}),t.textureAtlas=this._textureAtlas);const o=this;if(C(this._backgroundTextureAtlas)||(this._backgroundTextureAtlas=new ore({context:i,initialSize:eae}),n.textureAtlas=this._backgroundTextureAtlas,o._backgroundImageReady=!1,nae(this._backgroundTextureAtlas,this).then((function(){o._backgroundImageReady=!0}))),!this._backgroundImageReady)return;const r=this._labelsToUpdate.length;for(let a=0;a<r;++a){const e=this._labelsToUpdate[a];if(e.isDestroyed())continue;const t=e._glyphs.length;e._rebindAllGlyphs&&(cae(this,e),e._rebindAllGlyphs=!1),e._repositionAllGlyphs&&(dae(e),e._repositionAllGlyphs=!1);const n=e._glyphs.length-t;this._totalGlyphCount+=n}const s=n.length>0?Koe.TRANSLUCENT:this.blendOption;t.blendOption=s,n.blendOption=s,t._highlightColor=this._highlightColor,n._highlightColor=this._highlightColor,this._labelsToUpdate.length=0,n.update(e),t.update(e)},pae.prototype.isDestroyed=function(){return!1},pae.prototype.destroy=function(){return this.removeAll(),this._billboardCollection=this._billboardCollection.destroy(),this._textureAtlas=this._textureAtlas&&this._textureAtlas.destroy(),this._backgroundBillboardCollection=this._backgroundBillboardCollection.destroy(),this._backgroundTextureAtlas=this._backgroundTextureAtlas&&this._backgroundTextureAtlas.destroy(),Qh(this)};var mae=pae,_ae="attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 position2DHigh;\nattribute vec3 position2DLow;\nattribute vec3 prevPosition3DHigh;\nattribute vec3 prevPosition3DLow;\nattribute vec3 prevPosition2DHigh;\nattribute vec3 prevPosition2DLow;\nattribute vec3 nextPosition3DHigh;\nattribute vec3 nextPosition3DLow;\nattribute vec3 nextPosition2DHigh;\nattribute vec3 nextPosition2DLow;\nattribute vec4 texCoordExpandAndBatchIndex;\n\nvarying vec2  v_st;\nvarying float v_width;\nvarying vec4 v_pickColor;\nvarying float v_polylineAngle;\n\nvoid main()\n{\n    float texCoord = texCoordExpandAndBatchIndex.x;\n    float expandDir = texCoordExpandAndBatchIndex.y;\n    bool usePrev = texCoordExpandAndBatchIndex.z < 0.0;\n    float batchTableIndex = texCoordExpandAndBatchIndex.w;\n\n    vec2 widthAndShow = batchTable_getWidthAndShow(batchTableIndex);\n    float width = widthAndShow.x + 0.5;\n    float show = widthAndShow.y;\n\n    if (width < 1.0)\n    {\n        show = 0.0;\n    }\n\n    vec4 pickColor = batchTable_getPickColor(batchTableIndex);\n\n    vec4 p, prev, next;\n    if (czm_morphTime == 1.0)\n    {\n        p = czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz);\n        prev = czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz);\n        next = czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz);\n    }\n    else if (czm_morphTime == 0.0)\n    {\n        p = czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy);\n        prev = czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy);\n        next = czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy);\n    }\n    else\n    {\n        p = czm_columbusViewMorph(\n                czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy),\n                czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz),\n                czm_morphTime);\n        prev = czm_columbusViewMorph(\n                czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy),\n                czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz),\n                czm_morphTime);\n        next = czm_columbusViewMorph(\n                czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy),\n                czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz),\n                czm_morphTime);\n    }\n\n    #ifdef DISTANCE_DISPLAY_CONDITION\n        vec3 centerHigh = batchTable_getCenterHigh(batchTableIndex);\n        vec4 centerLowAndRadius = batchTable_getCenterLowAndRadius(batchTableIndex);\n        vec3 centerLow = centerLowAndRadius.xyz;\n        float radius = centerLowAndRadius.w;\n        vec2 distanceDisplayCondition = batchTable_getDistanceDisplayCondition(batchTableIndex);\n\n        float lengthSq;\n        if (czm_sceneMode == czm_sceneMode2D)\n        {\n            lengthSq = czm_eyeHeight2D.y;\n        }\n        else\n        {\n            vec4 center = czm_translateRelativeToEye(centerHigh.xyz, centerLow.xyz);\n            lengthSq = max(0.0, dot(center.xyz, center.xyz) - radius * radius);\n        }\n\n        float nearSq = distanceDisplayCondition.x * distanceDisplayCondition.x;\n        float farSq = distanceDisplayCondition.y * distanceDisplayCondition.y;\n        if (lengthSq < nearSq || lengthSq > farSq)\n        {\n            show = 0.0;\n        }\n    #endif\n\n    float polylineAngle;\n    vec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, polylineAngle);\n    gl_Position = czm_viewportOrthographic * positionWC * show;\n\n    v_st.s = texCoord;\n    v_st.t = czm_writeNonPerspective(clamp(expandDir, 0.0, 1.0), gl_Position.w);\n\n    v_width = width;\n    v_pickColor = pickColor;\n    v_polylineAngle = polylineAngle;\n}\n";function gae(e,t){e=R(e,R.EMPTY_OBJECT),this._show=R(e.show,!0),this._width=R(e.width,1),this._loop=R(e.loop,!1),this._distanceDisplayCondition=e.distanceDisplayCondition,this._material=e.material,C(this._material)||(this._material=EU.fromType(EU.ColorType,{color:new xy(1,1,1,1)}));let n,i=e.positions;C(i)||(i=[]),this._positions=i,this._actualPositions=Ly(i,K.equalsEpsilon),this._loop&&this._actualPositions.length>2&&(this._actualPositions===this._positions&&(this._actualPositions=i.slice()),this._actualPositions.push(K.clone(this._actualPositions[0]))),this._length=this._actualPositions.length,this._id=e.id,C(t)&&(n=ft.clone(t.modelMatrix)),this._modelMatrix=n,this._segments=AA.wrapLongitude(this._actualPositions,n),this._actualLength=void 0,this._propertiesChanged=new Uint32Array(Cae),this._polylineCollection=t,this._dirty=!1,this._pickId=void 0,this._boundingVolume=nn.fromPoints(this._actualPositions),this._boundingVolumeWC=nn.transform(this._boundingVolume,this._modelMatrix),this._boundingVolume2D=new nn}const yae=gae.POSITION_INDEX=0,vae=gae.SHOW_INDEX=1,bae=gae.WIDTH_INDEX=2,Aae=gae.MATERIAL_INDEX=3,wae=gae.POSITION_SIZE_INDEX=4,Tae=gae.DISTANCE_DISPLAY_CONDITION=5,Cae=gae.NUMBER_OF_PROPERTIES=6;function Eae(e,t){++e._propertiesChanged[t];const n=e._polylineCollection;C(n)&&(n._updatePolyline(e,t),e._dirty=!0)}Object.defineProperties(gae.prototype,{show:{get:function(){return this._show},set:function(e){if(!C(e))throw new x("value is required.");e!==this._show&&(this._show=e,Eae(this,vae))}},positions:{get:function(){return this._positions},set:function(e){if(!C(e))throw new x("value is required.");let t=Ly(e,K.equalsEpsilon);this._loop&&t.length>2&&(t===e&&(t=e.slice()),t.push(K.clone(t[0]))),this._actualPositions.length===t.length&&this._actualPositions.length===this._length||Eae(this,wae),this._positions=e,this._actualPositions=t,this._length=t.length,this._boundingVolume=nn.fromPoints(this._actualPositions,this._boundingVolume),this._boundingVolumeWC=nn.transform(this._boundingVolume,this._modelMatrix,this._boundingVolumeWC),Eae(this,yae),this.update()}},material:{get:function(){return this._material},set:function(e){if(!C(e))throw new x("material is required.");this._material!==e&&(this._material=e,Eae(this,Aae))}},width:{get:function(){return this._width},set:function(e){if(!C(e))throw new x("value is required.");const t=this._width;e!==t&&(this._width=e,Eae(this,bae))}},loop:{get:function(){return this._loop},set:function(e){if(!C(e))throw new x("value is required.");if(e!==this._loop){let t=this._actualPositions;e?t.length>2&&!K.equals(t[0],t[t.length-1])&&(t.length===this._positions.length&&(this._actualPositions=t=this._positions.slice()),t.push(K.clone(t[0]))):t.length>2&&K.equals(t[0],t[t.length-1])&&(t.length-1===this._positions.length?this._actualPositions=this._positions:t.pop()),this._loop=e,Eae(this,wae)}}},id:{get:function(){return this._id},set:function(e){this._id=e,C(this._pickId)&&(this._pickId.object.id=e)}},pickId:{get:function(){return this._pickId}},isDestroyed:{get:function(){return!C(this._polylineCollection)}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(C(e)&&e.far<=e.near)throw new x("far distance must be greater than near distance.");WT.equals(e,this._distanceDisplayCondition)||(this._distanceDisplayCondition=WT.clone(e,this._distanceDisplayCondition),Eae(this,Tae))}}}),gae.prototype.update=function(){let e=ft.IDENTITY;C(this._polylineCollection)&&(e=this._polylineCollection.modelMatrix);const t=this._segments.positions.length,n=this._segments.lengths,i=this._propertiesChanged[yae]>0||this._propertiesChanged[wae]>0;if(ft.equals(e,this._modelMatrix)&&!i||(this._segments=AA.wrapLongitude(this._actualPositions,e),this._boundingVolumeWC=nn.transform(this._boundingVolume,e,this._boundingVolumeWC)),this._modelMatrix=ft.clone(e,this._modelMatrix),this._segments.positions.length!==t)Eae(this,wae);else{const e=n.length;for(let t=0;t<e;++t)if(n[t]!==this._segments.lengths[t]){Eae(this,wae);break}}},gae.prototype.getPickId=function(e){return C(this._pickId)||(this._pickId=e.createPickId({primitive:this,collection:this._polylineCollection,id:this._id})),this._pickId},gae.prototype._clean=function(){this._dirty=!1;const e=this._propertiesChanged;for(let t=0;t<Cae-1;++t)e[t]=0},gae.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._material=this._material&&this._material.destroy(),this._polylineCollection=void 0};var xae=gae;const Sae=xae.SHOW_INDEX,Iae=xae.WIDTH_INDEX,Oae=xae.POSITION_INDEX,Dae=xae.MATERIAL_INDEX,Pae=xae.POSITION_SIZE_INDEX,Rae=xae.DISTANCE_DISPLAY_CONDITION,Lae=xae.NUMBER_OF_PROPERTIES,Mae={texCoordExpandAndBatchIndex:0,position3DHigh:1,position3DLow:2,position2DHigh:3,position2DLow:4,prevPosition3DHigh:5,prevPosition3DLow:6,prevPosition2DHigh:7,prevPosition2DLow:8,nextPosition3DHigh:9,nextPosition3DLow:10,nextPosition2DHigh:11,nextPosition2DLow:12};function Bae(e){e=R(e,R.EMPTY_OBJECT),this.show=R(e.show,!0),this.modelMatrix=ft.clone(R(e.modelMatrix,ft.IDENTITY)),this._modelMatrix=ft.clone(ft.IDENTITY),this.debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this._opaqueRS=void 0,this._translucentRS=void 0,this._colorCommands=[],this._polylinesUpdated=!1,this._polylinesRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(Lae),this._polylines=[],this._polylineBuckets={},this._positionBufferUsage={bufferUsage:lq.STATIC_DRAW,frameCount:0},this._mode=void 0,this._polylinesToUpdate=[],this._vertexArrays=[],this._positionBuffer=void 0,this._texCoordExpandAndBatchIndexBuffer=void 0,this._batchTable=void 0,this._createBatchTable=!1,this._useHighlightColor=!1,this._highlightColor=xy.clone(xy.WHITE);const t=this;this._uniformMap={u_highlightColor:function(){return t._highlightColor}}}function Nae(e,t){C(e._batchTable)&&e._batchTable.destroy();const n=[{functionName:"batchTable_getWidthAndShow",componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:2},{functionName:"batchTable_getPickColor",componentDatatype:ih.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0},{functionName:"batchTable_getCenterHigh",componentDatatype:ih.FLOAT,componentsPerAttribute:3},{functionName:"batchTable_getCenterLowAndRadius",componentDatatype:ih.FLOAT,componentsPerAttribute:4},{functionName:"batchTable_getDistanceDisplayCondition",componentDatatype:ih.FLOAT,componentsPerAttribute:2}];e._batchTable=new zq(t,n,e._polylines.length)}Object.defineProperties(Bae.prototype,{length:{get:function(){return Jae(this),this._polylines.length}}}),Bae.prototype.add=function(e){const t=new xae(e,this);return t._index=this._polylines.length,this._polylines.push(t),this._createVertexArray=!0,this._createBatchTable=!0,t},Bae.prototype.remove=function(e){if(this.contains(e)){if(this._polylinesRemoved=!0,this._createVertexArray=!0,this._createBatchTable=!0,C(e._bucket)){const t=e._bucket;t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy()}return e._destroy(),!0}return!1},Bae.prototype.removeAll=function(){Zae(this),ece(this),this._polylineBuckets={},this._polylinesRemoved=!1,this._polylines.length=0,this._polylinesToUpdate.length=0,this._createVertexArray=!0},Bae.prototype.contains=function(e){return C(e)&&e._polylineCollection===this},Bae.prototype.get=function(e){if(!C(e))throw new x("index is required.");return Jae(this),this._polylines[e]};const Fae=new Nm,zae=new Xe,kae=new ro;Bae.prototype.update=function(e){if(Jae(this),0===this._polylines.length||!this.show)return;Qae(this,e);const t=e.context,n=e.mapProjection;let i,o=this._propertiesChanged;if(this._createBatchTable){if(0===Ck.maximumVertexTextureImageUnits)throw new Je("Vertex texture fetch support is required to render polylines. The maximum number of vertex texture image units must be greater than zero.");Nae(this,t),this._createBatchTable=!1}if(this._createVertexArray||Gae(this))qae(this,t,n);else if(this._polylinesUpdated){const r=this._polylinesToUpdate;if(this._mode!==ij.SCENE3D){const e=r.length;for(let t=0;t<e;++t)i=r[t],i.update()}if(o[Pae]||o[Dae])qae(this,t,n);else{const t=r.length,s=this._polylineBuckets;for(let a=0;a<t;++a){i=r[a],o=i._propertiesChanged;const t=i._bucket;let c=0;for(const e in s)if(s.hasOwnProperty(e)){if(s[e]===t){o[Oae]&&t.writeUpdate(c,i,this._positionBuffer,n);break}c+=s[e].lengthOfPositions}if((o[Sae]||o[Iae])&&this._batchTable.setBatchedAttribute(i._index,0,new ro(i._width,i._show)),this._batchTable.attributes.length>2){if(o[Oae]||o[Pae]){const t=e.mode===ij.SCENE2D?i._boundingVolume2D:i._boundingVolumeWC,n=Nm.fromCartesian(t.center,Fae),o=Xe.fromElements(n.low.x,n.low.y,n.low.z,t.radius,zae);this._batchTable.setBatchedAttribute(i._index,2,n.high),this._batchTable.setBatchedAttribute(i._index,3,o)}if(o[Rae]){const e=kae;e.x=0,e.y=Number.MAX_VALUE;const t=i.distanceDisplayCondition;C(t)&&(e.x=t.near,e.y=t.far),this._batchTable.setBatchedAttribute(i._index,4,e)}}i._clean()}}r.length=0,this._polylinesUpdated=!1}o=this._propertiesChanged;for(let c=0;c<Lae;++c)o[c]=0;let r=ft.IDENTITY;e.mode===ij.SCENE3D&&(r=this.modelMatrix);const s=e.passes,a=0!==e.morphTime;if(C(this._opaqueRS)&&this._opaqueRS.depthTest.enabled===a||(this._opaqueRS=yV.fromCache({depthMask:a,depthTest:{enabled:a}})),C(this._translucentRS)&&this._translucentRS.depthTest.enabled===a||(this._translucentRS=yV.fromCache({blending:_k.ALPHA_BLEND,depthMask:!a,depthTest:{enabled:a}})),this._batchTable.update(e),s.render||s.pick){const t=this._colorCommands;Hae(this,e,t,r)}};const Uae=new nn,Vae=new nn;function Hae(e,t,n,i){const o=t.context,r=t.commandList,s=n.length;let a=0,c=!0;const l=e._vertexArrays,u=e.debugShowBoundingVolume,h=e._batchTable,d=h.getUniformMapCallback(),f=l.length;for(let p=0;p<f;++p){const h=l[p],f=h.buckets,m=f.length;for(let l=0;l<m;++l){const p=f[l];let m=p.offset;const _=p.bucket.shaderProgram,g=p.bucket.polylines,y=g.length;let v,b,A,w,T=0;for(let l=0;l<y;++l){const f=g[l],y=Kae(f._material);if(y!==v){if(C(v)&&T>0){const t=b.isTranslucent();a>=s?(A=new UU({owner:e}),n.push(A)):A=n[a],++a,w=_n(d(b._uniforms),e._uniformMap),A.boundingVolume=nn.clone(Uae,A.boundingVolume),A.modelMatrix=i,A.shaderProgram=_,A.vertexArray=h.va,A.renderState=t?e._translucentRS:e._opaqueRS,A.pass=t?HU.TRANSLUCENT:HU.OPAQUE,A.debugShowBoundingVolume=u,A.pickId="v_pickColor",A.uniformMap=w,A.count=T,A.offset=m,m+=T,T=0,c=!0,r.push(A)}b=f._material,b.update(o),v=y}const E=f._locatorBuckets,x=E.length;for(let e=0;e<x;++e){const t=E[e];t.locator===p&&(T+=t.count)}let S;t.mode===ij.SCENE3D?S=f._boundingVolumeWC:t.mode===ij.COLUMBUS_VIEW?S=f._boundingVolume2D:t.mode===ij.SCENE2D?C(f._boundingVolume2D)&&(S=nn.clone(f._boundingVolume2D,Vae),S.center.x=0):C(f._boundingVolumeWC)&&C(f._boundingVolume2D)&&(S=nn.union(f._boundingVolumeWC,f._boundingVolume2D,Vae)),c?(c=!1,nn.clone(S,Uae)):nn.union(S,Uae,Uae)}C(v)&&T>0&&(a>=s?(A=new UU({owner:e}),n.push(A)):A=n[a],++a,w=_n(d(b._uniforms),e._uniformMap),A.boundingVolume=nn.clone(Uae,A.boundingVolume),A.modelMatrix=i,A.shaderProgram=_,A.vertexArray=h.va,A.renderState=b.isTranslucent()?e._translucentRS:e._opaqueRS,A.pass=b.isTranslucent()?HU.TRANSLUCENT:HU.OPAQUE,A.debugShowBoundingVolume=u,A.pickId="v_pickColor",A.uniformMap=w,A.count=T,A.offset=m,c=!0,r.push(A)),v=void 0}}n.length=a}function Gae(e){let t=!1;const n=e._propertiesChanged,i=e._positionBufferUsage;return n[Oae]?i.bufferUsage!==lq.STREAM_DRAW?(t=!0,i.bufferUsage=lq.STREAM_DRAW,i.frameCount=100):i.frameCount=100:i.bufferUsage!==lq.STATIC_DRAW&&(0===i.frameCount?(t=!0,i.bufferUsage=lq.STATIC_DRAW):i.frameCount--),t}Bae.prototype.isDestroyed=function(){return!1},Bae.prototype.destroy=function(){return $ae(this),Zae(this),ece(this),this._batchTable=this._batchTable&&this._batchTable.destroy(),Qh(this)};const Wae=[0,0,0];function qae(e,t,n){e._createVertexArray=!1,Zae(e),$ae(e),Xae(e);const i=[[]];let o=i[0];const r=e._batchTable,s=e._useHighlightColor,a=[0];let c=0;const l=[[]];let u=0;const h=e._polylineBuckets;let d,f;for(d in h)h.hasOwnProperty(d)&&(f=h[d],f.updateShader(t,r,s),u+=f.lengthOfPositions);if(u>0){const s=e._mode,p=new Float32Array(6*u*3),m=new Float32Array(4*u);let _,g=0,y=0,v=0;for(d in h)if(h.hasOwnProperty(d)){f=h[d],f.write(p,m,g,y,v,r,t,n),s===ij.MORPHING&&(C(_)||(_=new Float32Array(6*u*3)),f.writeForMorph(_,g));const e=f.lengthOfPositions;g+=6*e*3,y+=4*e,v+=4*e,c=f.updateIndices(i,a,l,c)}const b=e._positionBufferUsage.bufferUsage,A=lq.STATIC_DRAW;let w;e._positionBuffer=hq.createVertexBuffer({context:t,typedArray:p,usage:b}),C(_)&&(w=hq.createVertexBuffer({context:t,typedArray:_,usage:b})),e._texCoordExpandAndBatchIndexBuffer=hq.createVertexBuffer({context:t,typedArray:m,usage:A});const T=3*Float32Array.BYTES_PER_ELEMENT,E=4*Float32Array.BYTES_PER_ELEMENT;let x=0;const S=i.length;for(let n=0;n<S;++n)if(o=i[n],o.length>0){const i=new Uint16Array(o),r=hq.createIndexBuffer({context:t,typedArray:i,usage:lq.STATIC_DRAW,indexDatatype:fd.UNSIGNED_SHORT});x+=a[n];const c=6*(n*(T*z.SIXTY_FOUR_KILOBYTES)-x*T),u=T+c,h=T+u,d=T+h,f=T+d,p=T+f,m=n*(E*z.SIXTY_FOUR_KILOBYTES)-x*E,_=[{index:Mae.position3DHigh,componentsPerAttribute:3,componentDatatype:ih.FLOAT,offsetInBytes:c,strideInBytes:6*T},{index:Mae.position3DLow,componentsPerAttribute:3,componentDatatype:ih.FLOAT,offsetInBytes:u,strideInBytes:6*T},{index:Mae.position2DHigh,componentsPerAttribute:3,componentDatatype:ih.FLOAT,offsetInBytes:c,strideInBytes:6*T},{index:Mae.position2DLow,componentsPerAttribute:3,componentDatatype:ih.FLOAT,offsetInBytes:u,strideInBytes:6*T},{index:Mae.prevPosition3DHigh,componentsPerAttribute:3,componentDatatype:ih.FLOAT,offsetInBytes:h,strideInBytes:6*T},{index:Mae.prevPosition3DLow,componentsPerAttribute:3,componentDatatype:ih.FLOAT,offsetInBytes:d,strideInBytes:6*T},{index:Mae.prevPosition2DHigh,componentsPerAttribute:3,componentDatatype:ih.FLOAT,offsetInBytes:h,strideInBytes:6*T},{index:Mae.prevPosition2DLow,componentsPerAttribute:3,componentDatatype:ih.FLOAT,offsetInBytes:d,strideInBytes:6*T},{index:Mae.nextPosition3DHigh,componentsPerAttribute:3,componentDatatype:ih.FLOAT,offsetInBytes:f,strideInBytes:6*T},{index:Mae.nextPosition3DLow,componentsPerAttribute:3,componentDatatype:ih.FLOAT,offsetInBytes:p,strideInBytes:6*T},{index:Mae.nextPosition2DHigh,componentsPerAttribute:3,componentDatatype:ih.FLOAT,offsetInBytes:f,strideInBytes:6*T},{index:Mae.nextPosition2DLow,componentsPerAttribute:3,componentDatatype:ih.FLOAT,offsetInBytes:p,strideInBytes:6*T},{index:Mae.texCoordExpandAndBatchIndex,componentsPerAttribute:4,componentDatatype:ih.FLOAT,vertexBuffer:e._texCoordExpandAndBatchIndexBuffer,offsetInBytes:m}];let g,y,v,b;s===ij.SCENE3D?(y=e._positionBuffer,g="vertexBuffer",v=Wae,b="value"):s===ij.SCENE2D||s===ij.COLUMBUS_VIEW?(y=Wae,g="value",v=e._positionBuffer,b="vertexBuffer"):(y=w,g="vertexBuffer",v=e._positionBuffer,b="vertexBuffer"),_[0][g]=y,_[1][g]=y,_[2][b]=v,_[3][b]=v,_[4][g]=y,_[5][g]=y,_[6][b]=v,_[7][b]=v,_[8][g]=y,_[9][g]=y,_[10][b]=v,_[11][b]=v;const A=new bq({context:t,attributes:_,indexBuffer:r});e._vertexArrays.push({va:A,buckets:l[n]})}}}function jae(e,t){return t instanceof Uk?t.id:t}const Yae=[];function Kae(e){const t=EU._uniformList[e.type],n=t.length;Yae.length=2*n;let i=0;for(let o=0;o<n;++o){const n=t[o];Yae[i]=n,Yae[i+1]=e._uniforms[n](),i+=2}return`${e.type}:${JSON.stringify(Yae,jae)}`}function Xae(e){const t=e._mode,n=e._modelMatrix,i=e._polylineBuckets={},o=e._polylines,r=o.length;for(let s=0;s<r;++s){const e=o[s];if(e._actualPositions.length>1){e.update();const o=e.material;let r=i[o.type];C(r)||(r=i[o.type]=new nce(o,t,n)),r.addPolyline(e)}}}function Qae(e,t){const n=t.mode;e._mode===n&&ft.equals(e._modelMatrix,e.modelMatrix)||(e._mode=n,e._modelMatrix=ft.clone(e.modelMatrix),e._createVertexArray=!0)}function Jae(e){if(e._polylinesRemoved){e._polylinesRemoved=!1;const t=[],n=[];let i,o=0;const r=e._polylines.length;for(let s=0;s<r;++s)i=e._polylines[s],i.isDestroyed||(i._index=o++,n.push(i),t.push(i));e._polylines=t,e._polylinesToUpdate=n}}function Zae(e){const t=e._polylines,n=t.length;for(let i=0;i<n;++i)if(!t[i].isDestroyed){const e=t[i]._bucket;C(e)&&(e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy())}}function $ae(e){const t=e._vertexArrays.length;for(let n=0;n<t;++n)e._vertexArrays[n].va.destroy();e._vertexArrays.length=0}function ece(e){const t=e._polylines,n=t.length;for(let i=0;i<n;++i)t[i].isDestroyed||t[i]._destroy()}function tce(e,t,n){this.count=e,this.offset=t,this.bucket=n}function nce(e,t,n){this.polylines=[],this.lengthOfPositions=0,this.material=e,this.shaderProgram=void 0,this.mode=t,this.modelMatrix=n}function ice(e){return K.dot(K.UNIT_X,e._boundingVolume.center)<0||e._boundingVolume.intersectPlane(Gs.ORIGIN_ZX_PLANE)===Ae.INTERSECTING}Bae.prototype._updatePolyline=function(e,t){this._polylinesUpdated=!0,e._dirty||this._polylinesToUpdate.push(e),++this._propertiesChanged[t]},nce.prototype.addPolyline=function(e){const t=this.polylines;t.push(e),e._actualLength=this.getPolylinePositionsLength(e),this.lengthOfPositions+=e._actualLength,e._bucket=this},nce.prototype.updateShader=function(e,t,n){if(C(this.shaderProgram))return;const i=["DISTANCE_DISPLAY_CONDITION"];n&&i.push("VECTOR_TILE"),-1!==this.material.shaderSource.search(/varying\s+float\s+v_polylineAngle;/g)&&i.push("POLYLINE_DASH"),Oc.isInternetExplorer()||i.push("CLIP_POLYLINE");const o=new tq({defines:i,sources:["varying vec4 v_pickColor;\n",this.material.shaderSource,PK]}),r=t.getVertexShaderCallback()(_ae),s=new tq({defines:i,sources:[EK,r]});this.shaderProgram=fH.fromCache({context:e,vertexShaderSource:s,fragmentShaderSource:o,attributeLocations:Mae})},nce.prototype.getPolylinePositionsLength=function(e){let t;if(this.mode===ij.SCENE3D||!ice(e))return t=e._actualPositions.length,4*t-4;let n=0;const i=e._segments.lengths;t=i.length;for(let o=0;o<t;++o)n+=4*i[o]-4;return n};const oce=new K,rce=new K,sce=new K,ace=new K,cce=new Xe,lce=new ro;nce.prototype.write=function(e,t,n,i,o,r,s,a){const c=this.mode,l=a.ellipsoid.maximumRadius*z.PI,u=this.polylines,h=u.length;for(let d=0;d<h;++d){const i=u[d],h=i.width,f=i.show&&h>0,p=i._index,m=this.getSegments(i,a),_=m.positions,g=m.lengths,y=_.length,v=i.getPickId(s).color;let b,A=0,w=0;for(let r=0;r<y;++r){0===r?i._loop?b=_[y-2]:(b=ace,K.subtract(_[0],_[1],b),K.add(_[0],b,b)):b=_[r-1],K.clone(b,rce),K.clone(_[r],oce),r===y-1?i._loop?b=_[1]:(b=ace,K.subtract(_[y-1],_[y-2],b),K.add(_[y-1],b,b)):b=_[r+1],K.clone(b,sce);const s=g[A];r===w+s&&(w+=s,++A);const a=r-w===0,u=r===w+g[A]-1;c===ij.SCENE2D&&(rce.z=0,oce.z=0,sce.z=0),c!==ij.SCENE2D&&c!==ij.MORPHING||(a||u)&&l-Math.abs(oce.x)<1&&((oce.x<0&&rce.x>0||oce.x>0&&rce.x<0)&&K.clone(oce,rce),(oce.x<0&&sce.x>0||oce.x>0&&sce.x<0)&&K.clone(oce,sce));const h=a?2:0,d=u?2:4;for(let i=h;i<d;++i){Nm.writeElements(oce,e,n),Nm.writeElements(rce,e,n+6),Nm.writeElements(sce,e,n+12);const s=i-2<0?-1:1;t[o]=r/(y-1),t[o+1]=i%2*2-1,t[o+2]=s,t[o+3]=p,n+=18,o+=4}}const T=cce;T.x=xy.floatToByte(v.red),T.y=xy.floatToByte(v.green),T.z=xy.floatToByte(v.blue),T.w=xy.floatToByte(v.alpha);const E=lce;E.x=h,E.y=f?1:0;const x=c===ij.SCENE2D?i._boundingVolume2D:i._boundingVolumeWC,S=Nm.fromCartesian(x.center,Fae),I=S.high,O=Xe.fromElements(S.low.x,S.low.y,S.low.z,x.radius,zae),D=kae;D.x=0,D.y=Number.MAX_VALUE;const P=i.distanceDisplayCondition;C(P)&&(D.x=P.near,D.y=P.far),r.setBatchedAttribute(p,0,E),r.setBatchedAttribute(p,1,T),r.attributes.length>2&&(r.setBatchedAttribute(p,2,I),r.setBatchedAttribute(p,3,O),r.setBatchedAttribute(p,4,D))}};const uce=new K,hce=new K,dce=new K,fce=new K;nce.prototype.writeForMorph=function(e,t){const n=this.modelMatrix,i=this.polylines,o=i.length;for(let r=0;r<o;++r){const o=i[r],s=o._segments.positions,a=o._segments.lengths,c=s.length;let l=0,u=0;for(let i=0;i<c;++i){let r;0===i?o._loop?r=s[c-2]:(r=fce,K.subtract(s[0],s[1],r),K.add(s[0],r,r)):r=s[i-1],r=ft.multiplyByPoint(n,r,hce);const h=ft.multiplyByPoint(n,s[i],uce);let d;i===c-1?o._loop?d=s[1]:(d=fce,K.subtract(s[c-1],s[c-2],d),K.add(s[c-1],d,d)):d=s[i+1],d=ft.multiplyByPoint(n,d,dce);const f=a[l];i===u+f&&(u+=f,++l);const p=i-u===0,m=i===u+a[l]-1,_=p?2:0,g=m?2:4;for(let n=_;n<g;++n)Nm.writeElements(h,e,t),Nm.writeElements(r,e,t+6),Nm.writeElements(d,e,t+12),t+=18}}};const pce=new Array(1);nce.prototype.updateIndices=function(e,t,n,i){let o=n.length-1,r=new tce(0,i,this);n[o].push(r);let s=0,a=e[e.length-1],c=0;a.length>0&&(c=a[a.length-1]+1);const l=this.polylines,u=l.length;for(let h=0;h<u;++h){const u=l[h];let d;if(u._locatorBuckets=[],this.mode===ij.SCENE3D){d=pce;const e=u._actualPositions.length;if(!(e>0))continue;d[0]=e}else d=u._segments.lengths;const f=d.length;if(f>0){let l=0;for(let h=0;h<f;++h){const f=d[h]-1;for(let h=0;h<f;++h)c+4>z.SIXTY_FOUR_KILOBYTES&&(u._locatorBuckets.push({locator:r,count:l}),l=0,t.push(4),a=[],e.push(a),c=0,r.count=s,s=0,i=0,r=new tce(0,0,this),n[++o]=[r]),a.push(c,c+2,c+1),a.push(c+1,c+2,c+3),l+=6,s+=6,i+=6,c+=4}u._locatorBuckets.push({locator:r,count:l}),c+4>z.SIXTY_FOUR_KILOBYTES&&(t.push(0),a=[],e.push(a),c=0,r.count=s,i=0,s=0,r=new tce(0,0,this),n[++o]=[r])}u._clean()}return r.count=s,i},nce.prototype.getPolylineStartIndex=function(e){const t=this.polylines;let n=0;const i=t.length;for(let o=0;o<i;++o){const i=t[o];if(i===e)break;n+=i._actualLength}return n};const mce={positions:void 0,lengths:void 0},_ce=new Array(1),gce=new K,yce=new se;let vce;nce.prototype.getSegments=function(e,t){let n=e._actualPositions;if(this.mode===ij.SCENE3D)return _ce[0]=n.length,mce.positions=n,mce.lengths=_ce,mce;ice(e)&&(n=e._segments.positions);const i=t.ellipsoid,o=[],r=this.modelMatrix,s=n.length;let a,c=gce;for(let l=0;l<s;++l)a=n[l],c=ft.multiplyByPoint(r,a,c),o.push(t.project(i.cartesianToCartographic(c,yce)));if(o.length>0){e._boundingVolume2D=nn.fromPoints(o,e._boundingVolume2D);const t=e._boundingVolume2D.center;e._boundingVolume2D.center=new K(t.z,t.x,t.y)}return mce.positions=o,mce.lengths=e._segments.lengths,mce},nce.prototype.writeUpdate=function(e,t,n,i){const o=this.mode,r=i.ellipsoid.maximumRadius*z.PI;let s=t._actualLength;if(s){e+=this.getPolylineStartIndex(t);let a=vce;const c=6*s*3;!C(a)||a.length<c?a=vce=new Float32Array(c):a.length>c&&(a=new Float32Array(a.buffer,0,c));const l=this.getSegments(t,i),u=l.positions,h=l.lengths;let d,f=0,p=0,m=0;s=u.length;for(let e=0;e<s;++e){0===e?t._loop?d=u[s-2]:(d=ace,K.subtract(u[0],u[1],d),K.add(u[0],d,d)):d=u[e-1],K.clone(d,rce),K.clone(u[e],oce),e===s-1?t._loop?d=u[1]:(d=ace,K.subtract(u[s-1],u[s-2],d),K.add(u[s-1],d,d)):d=u[e+1],K.clone(d,sce);const n=h[p];e===m+n&&(m+=n,++p);const i=e-m===0,c=e===m+h[p]-1;o===ij.SCENE2D&&(rce.z=0,oce.z=0,sce.z=0),o!==ij.SCENE2D&&o!==ij.MORPHING||(i||c)&&r-Math.abs(oce.x)<1&&((oce.x<0&&rce.x>0||oce.x>0&&rce.x<0)&&K.clone(oce,rce),(oce.x<0&&sce.x>0||oce.x>0&&sce.x<0)&&K.clone(oce,sce));const l=i?2:0,_=c?2:4;for(let e=l;e<_;++e)Nm.writeElements(oce,a,f),Nm.writeElements(rce,a,f+6),Nm.writeElements(sce,a,f+12),f+=18}n.copyFromArrayView(a,18*Float32Array.BYTES_PER_ELEMENT*e)}};var bce=Bae;function Ace(e){this._positions=e.positions,this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._rectangle=e.rectangle,this._minHeight=e.minimumHeight,this._maxHeight=e.maximumHeight,this._billboardCollection=void 0,this._labelCollection=void 0,this._polylineCollection=void 0,this._verticesPromise=void 0,this._packedBuffer=void 0,this._ready=!1,this._readyPromise=yn(),this._resolvedPromise=!1}function wce(e,t){const n=e._rectangle,i=e._minHeight,o=e._maxHeight,r=2+_t.packedLength+ge.packedLength,s=new Float64Array(r);let a=0;return s[a++]=i,s[a++]=o,_t.pack(n,s,a),a+=_t.packedLength,ge.pack(t,s,a),s}Object.defineProperties(Ace.prototype,{pointsLength:{get:function(){return this._billboardCollection.length}},texturesByteLength:{get:function(){const e=this._billboardCollection.textureAtlas.texture.sizeInBytes,t=this._labelCollection._textureAtlas.texture.sizeInBytes;return e+t}},readyPromise:{get:function(){return this._readyPromise.promise}}});const Tce=new ad("createVectorTilePoints",5),Cce=new K;function Ece(e,t){if(C(e._billboardCollection))return;let n;if(!C(e._verticesPromise)){n=e._positions;let i=e._packedBuffer;C(i)||(n=e._positions=xF(n),e._batchIds=xF(e._batchIds),i=e._packedBuffer=wce(e,t));const o=[n.buffer,i.buffer],r={positions:n.buffer,packedBuffer:i.buffer},s=e._verticesPromise=Tce.scheduleTask(r,o);if(!C(s))return;s.then((function(t){e._positions=new Float64Array(t.positions),e._ready=!0}))}if(e._ready&&!C(e._billboardCollection)){n=e._positions;const t=e._batchTable,i=e._batchIds,o=e._billboardCollection=new fse({batchTable:t}),r=e._labelCollection=new mae({batchTable:t}),s=e._polylineCollection=new bce;s._useHighlightColor=!0;const a=n.length/3;for(let e=0;e<a;++e){const t=i[e],a=K.unpack(n,3*e,Cce),c=o.add();c.position=a,c._batchIndex=t;const l=r.add();l.text=" ",l.position=a,l._batchIndex=t;const u=s.add();u.positions=[K.clone(a),K.clone(a)]}e._positions=void 0,e._packedBuffer=void 0}}function xce(e,t){const n=e._batchIds,i=n.length;for(let o=0;o<i;++o){const e=n[o],i=t[e];i.show=!0,i.pointSize=vse.defaultPointSize,i.color=vse.defaultColor,i.pointOutlineColor=vse.defaultPointOutlineColor,i.pointOutlineWidth=vse.defaultPointOutlineWidth,i.labelColor=xy.WHITE,i.labelOutlineColor=xy.WHITE,i.labelOutlineWidth=1,i.font="30px sans-serif",i.labelStyle=Ise.FILL,i.labelText=void 0,i.backgroundColor=new xy(.165,.165,.165,.8),i.backgroundPadding=new ro(7,5),i.backgroundEnabled=!1,i.scaleByDistance=void 0,i.translucencyByDistance=void 0,i.distanceDisplayCondition=void 0,i.heightOffset=0,i.anchorLineEnabled=!1,i.anchorLineColor=xy.WHITE,i.image=void 0,i.disableDepthTestDistance=0,i.horizontalOrigin=Oz.CENTER,i.verticalOrigin=Pz.CENTER,i.labelHorizontalOrigin=Oz.RIGHT,i.labelVerticalOrigin=Pz.BASELINE}}Ace.prototype.createFeatures=function(e,t){const n=this._billboardCollection,i=this._labelCollection,o=this._polylineCollection,r=this._batchIds,s=r.length;for(let a=0;a<s;++a){const s=r[a],c=n.get(a),l=i.get(a),u=o.get(a);t[s]=new vse(e,s,c,l,u)}},Ace.prototype.applyDebugSettings=function(e,t){e?(xy.clone(t,this._billboardCollection._highlightColor),xy.clone(t,this._labelCollection._highlightColor),xy.clone(t,this._polylineCollection._highlightColor)):(xy.clone(xy.WHITE,this._billboardCollection._highlightColor),xy.clone(xy.WHITE,this._labelCollection._highlightColor),xy.clone(xy.WHITE,this._polylineCollection._highlightColor))};const Sce=new xy,Ice=new xy,Oce=new xy,Dce=new xy,Pce=new xy,Rce=new xy,Lce=new LO,Mce=new LO,Bce=new WT;Ace.prototype.applyStyle=function(e,t){if(!C(e))return void xce(this,t);const n=this._batchIds,i=n.length;for(let o=0;o<i;++o){const i=n[o],r=t[i];if(C(e.show)&&(r.show=e.show.evaluate(r)),C(e.pointSize)&&(r.pointSize=e.pointSize.evaluate(r)),C(e.color)&&(r.color=e.color.evaluateColor(r,Sce)),C(e.pointOutlineColor)&&(r.pointOutlineColor=e.pointOutlineColor.evaluateColor(r,Ice)),C(e.pointOutlineWidth)&&(r.pointOutlineWidth=e.pointOutlineWidth.evaluate(r)),C(e.labelColor)&&(r.labelColor=e.labelColor.evaluateColor(r,Oce)),C(e.labelOutlineColor)&&(r.labelOutlineColor=e.labelOutlineColor.evaluateColor(r,Dce)),C(e.labelOutlineWidth)&&(r.labelOutlineWidth=e.labelOutlineWidth.evaluate(r)),C(e.font)&&(r.font=e.font.evaluate(r)),C(e.labelStyle)&&(r.labelStyle=e.labelStyle.evaluate(r)),C(e.labelText)?r.labelText=e.labelText.evaluate(r):r.labelText=void 0,C(e.backgroundColor)&&(r.backgroundColor=e.backgroundColor.evaluateColor(r,Pce)),C(e.backgroundPadding)&&(r.backgroundPadding=e.backgroundPadding.evaluate(r)),C(e.backgroundEnabled)&&(r.backgroundEnabled=e.backgroundEnabled.evaluate(r)),C(e.scaleByDistance)){const t=e.scaleByDistance.evaluate(r);Lce.near=t.x,Lce.nearValue=t.y,Lce.far=t.z,Lce.farValue=t.w,r.scaleByDistance=Lce}else r.scaleByDistance=void 0;if(C(e.translucencyByDistance)){const t=e.translucencyByDistance.evaluate(r);Mce.near=t.x,Mce.nearValue=t.y,Mce.far=t.z,Mce.farValue=t.w,r.translucencyByDistance=Mce}else r.translucencyByDistance=void 0;if(C(e.distanceDisplayCondition)){const t=e.distanceDisplayCondition.evaluate(r);Bce.near=t.x,Bce.far=t.y,r.distanceDisplayCondition=Bce}else r.distanceDisplayCondition=void 0;C(e.heightOffset)&&(r.heightOffset=e.heightOffset.evaluate(r)),C(e.anchorLineEnabled)&&(r.anchorLineEnabled=e.anchorLineEnabled.evaluate(r)),C(e.anchorLineColor)&&(r.anchorLineColor=e.anchorLineColor.evaluateColor(r,Rce)),C(e.image)?r.image=e.image.evaluate(r):r.image=void 0,C(e.disableDepthTestDistance)&&(r.disableDepthTestDistance=e.disableDepthTestDistance.evaluate(r)),C(e.horizontalOrigin)&&(r.horizontalOrigin=e.horizontalOrigin.evaluate(r)),C(e.verticalOrigin)&&(r.verticalOrigin=e.verticalOrigin.evaluate(r)),C(e.labelHorizontalOrigin)&&(r.labelHorizontalOrigin=e.labelHorizontalOrigin.evaluate(r)),C(e.labelVerticalOrigin)&&(r.labelVerticalOrigin=e.labelVerticalOrigin.evaluate(r))}},Ace.prototype.update=function(e){Ece(this,e.mapProjection.ellipsoid),this._ready&&(this._polylineCollection.update(e),this._billboardCollection.update(e),this._labelCollection.update(e),this._resolvedPromise||(this._readyPromise.resolve(),this._resolvedPromise=!0))},Ace.prototype.isDestroyed=function(){return!1},Ace.prototype.destroy=function(){return this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),this._labelCollection=this._labelCollection&&this._labelCollection.destroy(),this._polylineCollection=this._polylineCollection&&this._polylineCollection.destroy(),Qh(this)};var Nce=Ace;function Fce(e){this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._positions=e.positions,this._counts=e.counts,this._indices=e.indices,this._indexCounts=e.indexCounts,this._indexOffsets=void 0,this._batchTableColors=void 0,this._packedBuffer=void 0,this._batchedPositions=void 0,this._transferrableBatchIds=void 0,this._vertexBatchIds=void 0,this._ellipsoid=R(e.ellipsoid,ge.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._polygonMinimumHeights=e.polygonMinimumHeights,this._polygonMaximumHeights=e.polygonMaximumHeights,this._center=R(e.center,K.ZERO),this._rectangle=e.rectangle,this._center=void 0,this._boundingVolume=e.boundingVolume,this._boundingVolumes=void 0,this._batchedIndices=void 0,this._ready=!1,this._readyPromise=yn(),this._verticesPromise=void 0,this._primitive=void 0,this.debugWireframe=!1,this.forceRebatch=!1,this.classificationType=rq.BOTH}function zce(e){const t=new Float64Array(3+K.packedLength+ge.packedLength+_t.packedLength);let n=0;return t[n++]=e._indices.BYTES_PER_ELEMENT,t[n++]=e._minimumHeight,t[n++]=e._maximumHeight,K.pack(e._center,t,n),n+=K.packedLength,ge.pack(e._ellipsoid,t,n),n+=ge.packedLength,_t.pack(e._rectangle,t,n),t}function kce(e,t){let n=1;const i=t[n++],o=e._boundingVolumes=new Array(i);for(let a=0;a<i;++a)o[a]=$u.unpack(t,n),n+=$u.packedLength;const r=t[n++],s=e._batchedIndices=new Array(r);for(let a=0;a<r;++a){const e=xy.unpack(t,n);n+=xy.packedLength;const i=t[n++],o=t[n++],r=t[n++],c=new Array(r);for(let s=0;s<r;++s)c[s]=t[n++];s[a]=new Q0({color:e,offset:i,count:o,batchIds:c})}}Object.defineProperties(Fce.prototype,{trianglesLength:{get:function(){return C(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return C(this._primitive)?this._primitive.geometryByteLength:0}},readyPromise:{get:function(){return this._readyPromise.promise}}});const Uce=new ad("createVectorTilePolygons",5),Vce=new xy;function Hce(e){if(!C(e._primitive)){if(!C(e._verticesPromise)){let t=e._positions,n=e._counts,i=e._indexCounts,o=e._indices,r=e._transferrableBatchIds,s=e._batchTableColors,a=e._packedBuffer;if(!C(s)){t=e._positions=xF(e._positions),n=e._counts=xF(e._counts),i=e._indexCounts=xF(e._indexCounts),o=e._indices=xF(e._indices),e._center=e._ellipsoid.cartographicToCartesian(_t.center(e._rectangle)),r=e._transferrableBatchIds=new Uint32Array(e._batchIds),s=e._batchTableColors=new Uint32Array(r.length);const c=e._batchTable,l=s.length;for(let e=0;e<l;++e){const t=c.getColor(e,Vce);s[e]=t.toRgba()}a=e._packedBuffer=zce(e)}const c=[t.buffer,n.buffer,i.buffer,o.buffer,r.buffer,s.buffer,a.buffer],l={packedBuffer:a.buffer,positions:t.buffer,counts:n.buffer,indexCounts:i.buffer,indices:o.buffer,batchIds:r.buffer,batchTableColors:s.buffer};let u=e._polygonMinimumHeights,h=e._polygonMaximumHeights;C(u)&&C(h)&&(u=xF(u),h=xF(h),c.push(u.buffer,h.buffer),l.minimumHeights=u,l.maximumHeights=h);const d=e._verticesPromise=Uce.scheduleTask(l,c);if(!C(d))return;d.then((function(t){e._positions=void 0,e._counts=void 0,e._polygonMinimumHeights=void 0,e._polygonMaximumHeights=void 0;const n=new Float64Array(t.packedBuffer),i=n[0];kce(e,n),e._indices=2===fd.getSizeInBytes(i)?new Uint16Array(t.indices):new Uint32Array(t.indices),e._indexOffsets=new Uint32Array(t.indexOffsets),e._indexCounts=new Uint32Array(t.indexCounts),e._batchedPositions=new Float32Array(t.positions),e._vertexBatchIds=new Uint16Array(t.batchIds),e._ready=!0}))}e._ready&&!C(e._primitive)&&(e._primitive=new O2({batchTable:e._batchTable,positions:e._batchedPositions,batchIds:e._batchIds,vertexBatchIds:e._vertexBatchIds,indices:e._indices,indexOffsets:e._indexOffsets,indexCounts:e._indexCounts,batchedIndices:e._batchedIndices,boundingVolume:e._boundingVolume,boundingVolumes:e._boundingVolumes,center:e._center}),e._batchTable=void 0,e._batchIds=void 0,e._positions=void 0,e._counts=void 0,e._indices=void 0,e._indexCounts=void 0,e._indexOffsets=void 0,e._batchTableColors=void 0,e._packedBuffer=void 0,e._batchedPositions=void 0,e._transferrableBatchIds=void 0,e._vertexBatchIds=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._polygonMinimumHeights=void 0,e._polygonMaximumHeights=void 0,e._center=void 0,e._rectangle=void 0,e._boundingVolume=void 0,e._boundingVolumes=void 0,e._batchedIndices=void 0,e._verticesPromise=void 0,e._readyPromise.resolve())}}Fce.prototype.createFeatures=function(e,t){this._primitive.createFeatures(e,t)},Fce.prototype.applyDebugSettings=function(e,t){this._primitive.applyDebugSettings(e,t)},Fce.prototype.applyStyle=function(e,t){this._primitive.applyStyle(e,t)},Fce.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)},Fce.prototype.update=function(e){Hce(this),this._ready&&(this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(e))},Fce.prototype.isDestroyed=function(){return!1},Fce.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Qh(this)};var Gce=Fce,Wce="attribute vec4 currentPosition;\nattribute vec4 previousPosition;\nattribute vec4 nextPosition;\nattribute vec2 expandAndWidth;\nattribute float a_batchId;\n\nuniform mat4 u_modifiedModelView;\n\nvoid main()\n{\n    float expandDir = expandAndWidth.x;\n    float width = abs(expandAndWidth.y) + 0.5;\n    bool usePrev = expandAndWidth.y < 0.0;\n\n    vec4 p = u_modifiedModelView * currentPosition;\n    vec4 prev = u_modifiedModelView * previousPosition;\n    vec4 next = u_modifiedModelView * nextPosition;\n\n    float angle;\n    vec4 positionWC = getPolylineWindowCoordinatesEC(p, prev, next, expandDir, width, usePrev, angle);\n    gl_Position = czm_viewportOrthographic * positionWC;\n}\n";function qce(e){this._positions=e.positions,this._widths=e.widths,this._counts=e.counts,this._batchIds=e.batchIds,this._ellipsoid=R(e.ellipsoid,ge.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._center=e.center,this._rectangle=e.rectangle,this._boundingVolume=e.boundingVolume,this._batchTable=e.batchTable,this._va=void 0,this._sp=void 0,this._rs=void 0,this._uniformMap=void 0,this._command=void 0,this._transferrableBatchIds=void 0,this._packedBuffer=void 0,this._keepDecodedPositions=e.keepDecodedPositions,this._decodedPositions=void 0,this._decodedPositionOffsets=void 0,this._currentPositions=void 0,this._previousPositions=void 0,this._nextPositions=void 0,this._expandAndWidth=void 0,this._vertexBatchIds=void 0,this._indices=void 0,this._constantColor=xy.clone(xy.WHITE),this._highlightColor=this._constantColor,this._trianglesLength=0,this._geometryByteLength=0,this._ready=!1,this._readyPromise=yn(),this._verticesPromise=void 0}function jce(e){const t=e._rectangle,n=e._minimumHeight,i=e._maximumHeight,o=e._ellipsoid,r=e._center,s=2+_t.packedLength+ge.packedLength+K.packedLength,a=new Float64Array(s);let c=0;return a[c++]=n,a[c++]=i,_t.pack(t,a,c),c+=_t.packedLength,ge.pack(o,a,c),c+=ge.packedLength,K.pack(r,a,c),a}Object.defineProperties(qce.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},readyPromise:{get:function(){return this._readyPromise.promise}}});const Yce=new ad("createVectorTilePolylines",5),Kce={previousPosition:0,currentPosition:1,nextPosition:2,expandAndWidth:3,a_batchId:4};function Xce(e,t){if(!C(e._va)){if(!C(e._verticesPromise)){let t=e._positions,n=e._widths,i=e._counts,o=e._transferrableBatchIds,r=e._packedBuffer;C(r)||(t=e._positions=xF(t),n=e._widths=xF(n),i=e._counts=xF(i),o=e._transferrableBatchIds=xF(e._batchIds),r=e._packedBuffer=jce(e));const s=[t.buffer,n.buffer,i.buffer,o.buffer,r.buffer],a={positions:t.buffer,widths:n.buffer,counts:i.buffer,batchIds:o.buffer,packedBuffer:r.buffer,keepDecodedPositions:e._keepDecodedPositions},c=e._verticesPromise=Yce.scheduleTask(a,s);if(!C(c))return;c.then((function(t){e._keepDecodedPositions&&(e._decodedPositions=new Float64Array(t.decodedPositions),e._decodedPositionOffsets=new Uint32Array(t.decodedPositionOffsets)),e._currentPositions=new Float32Array(t.currentPositions),e._previousPositions=new Float32Array(t.previousPositions),e._nextPositions=new Float32Array(t.nextPositions),e._expandAndWidth=new Float32Array(t.expandAndWidth),e._vertexBatchIds=new Uint16Array(t.batchIds);const n=t.indexDatatype;e._indices=n===fd.UNSIGNED_SHORT?new Uint16Array(t.indices):new Uint32Array(t.indices),e._ready=!0})).catch((function(t){e._readyPromise.reject(t)}))}if(e._ready&&!C(e._va)){const n=e._currentPositions,i=e._previousPositions,o=e._nextPositions,r=e._expandAndWidth,s=e._vertexBatchIds,a=e._indices;let c=i.byteLength+n.byteLength+o.byteLength;c+=r.byteLength+s.byteLength+a.byteLength,e._trianglesLength=a.length/3,e._geometryByteLength=c;const l=hq.createVertexBuffer({context:t,typedArray:i,usage:lq.STATIC_DRAW}),u=hq.createVertexBuffer({context:t,typedArray:n,usage:lq.STATIC_DRAW}),h=hq.createVertexBuffer({context:t,typedArray:o,usage:lq.STATIC_DRAW}),d=hq.createVertexBuffer({context:t,typedArray:r,usage:lq.STATIC_DRAW}),f=hq.createVertexBuffer({context:t,typedArray:s,usage:lq.STATIC_DRAW}),p=hq.createIndexBuffer({context:t,typedArray:a,usage:lq.STATIC_DRAW,indexDatatype:2===a.BYTES_PER_ELEMENT?fd.UNSIGNED_SHORT:fd.UNSIGNED_INT}),m=[{index:Kce.previousPosition,vertexBuffer:l,componentDatatype:ih.FLOAT,componentsPerAttribute:3},{index:Kce.currentPosition,vertexBuffer:u,componentDatatype:ih.FLOAT,componentsPerAttribute:3},{index:Kce.nextPosition,vertexBuffer:h,componentDatatype:ih.FLOAT,componentsPerAttribute:3},{index:Kce.expandAndWidth,vertexBuffer:d,componentDatatype:ih.FLOAT,componentsPerAttribute:2},{index:Kce.a_batchId,vertexBuffer:f,componentDatatype:ih.UNSIGNED_SHORT,componentsPerAttribute:1}];e._va=new bq({context:t,attributes:m,indexBuffer:p}),e._positions=void 0,e._widths=void 0,e._counts=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._rectangle=void 0,e._transferrableBatchIds=void 0,e._packedBuffer=void 0,e._currentPositions=void 0,e._previousPositions=void 0,e._nextPositions=void 0,e._expandAndWidth=void 0,e._vertexBatchIds=void 0,e._indices=void 0,e._readyPromise.resolve()}}}const Qce=new ft,Jce=new K;function Zce(e,t){C(e._uniformMap)||(e._uniformMap={u_modifiedModelView:function(){const n=t.uniformState.view;return ft.clone(n,Qce),ft.multiplyByPoint(Qce,e._center,Jce),ft.setTranslation(Qce,Jce,Qce),Qce},u_highlightColor:function(){return e._highlightColor}})}function $ce(e){if(C(e._rs))return;const t={enabled:!0,factor:-5,units:-5};e._rs=yV.fromCache({blending:_k.ALPHA_BLEND,depthMask:!1,depthTest:{enabled:!0},polygonOffset:t})}const ele="uniform vec4 u_highlightColor; \nvoid main()\n{\n    gl_FragColor = u_highlightColor;\n}\n";function tle(e,t){if(C(e._sp))return;const n=e._batchTable,i=n.getVertexShaderCallback(!1,"a_batchId",void 0)(Wce),o=n.getFragmentShaderCallback(!1,void 0,!1)(ele),r=new tq({defines:["VECTOR_TILE",Oc.isInternetExplorer()?"":"CLIP_POLYLINE"],sources:[EK,i]}),s=new tq({defines:["VECTOR_TILE"],sources:[o]});e._sp=fH.fromCache({context:t,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:Kce})}function nle(e,t){if(!C(e._command)){const t=e._batchTable.getUniformMapCallback()(e._uniformMap);e._command=new UU({owner:e,vertexArray:e._va,renderState:e._rs,shaderProgram:e._sp,uniformMap:t,boundingVolume:e._boundingVolume,pass:HU.TRANSLUCENT,pickId:e._batchTable.getPickId()})}t.commandList.push(e._command)}function ile(e,t){const n=e._batchIds,i=n.length;for(let o=0;o<i;++o){const e=n[o],i=t[e];i.show=!0,i.color=xy.WHITE}}qce.getPolylinePositions=function(e,t){const n=e._batchIds,i=e._decodedPositions,o=e._decodedPositionOffsets;if(!C(n)||!C(i))return;let r,s;const a=n.length;let c=0,l=0;for(r=0;r<a;++r)n[r]===t&&(c+=o[r+1]-o[r]);if(0===c)return;const u=new Float64Array(3*c);for(r=0;r<a;++r)if(n[r]===t){const e=o[r],t=o[r+1]-e;for(s=0;s<t;++s){const t=3*(e+s);u[l++]=i[t],u[l++]=i[t+1],u[l++]=i[t+2]}}return u},qce.prototype.getPositions=function(e){return qce.getPolylinePositions(this,e)},qce.prototype.createFeatures=function(e,t){const n=this._batchIds,i=n.length;for(let o=0;o<i;++o){const i=n[o];t[i]=new hZ(e,i)}},qce.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};const ole=new xy,rle=xy.WHITE,sle=!0;qce.prototype.applyStyle=function(e,t){if(!C(e))return void ile(this,t);const n=this._batchIds,i=n.length;for(let o=0;o<i;++o){const i=n[o],r=t[i];r.color=C(e.color)?e.color.evaluateColor(r,ole):rle,r.show=C(e.show)?e.show.evaluate(r):sle}},qce.prototype.update=function(e){const t=e.context;if(Xce(this,t),Zce(this,t),tle(this,t),$ce(this),!this._ready)return;const n=e.passes;(n.render||n.pick)&&nle(this,e)},qce.prototype.isDestroyed=function(){return!1},qce.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),Qh(this)};var ale=qce,cle='attribute vec3 startEllipsoidNormal;\nattribute vec3 endEllipsoidNormal;\nattribute vec4 startPositionAndHeight;\nattribute vec4 endPositionAndHeight;\nattribute vec4 startFaceNormalAndVertexCorner;\nattribute vec4 endFaceNormalAndHalfWidth;\nattribute float a_batchId;\n\nuniform mat4 u_modifiedModelView;\nuniform vec2 u_minimumMaximumVectorHeights;\n\nvarying vec4 v_startPlaneEC;\nvarying vec4 v_endPlaneEC;\nvarying vec4 v_rightPlaneEC;\nvarying float v_halfWidth;\nvarying vec3 v_volumeUpEC;\n\nvoid main()\n{\n    // vertex corner IDs\n    //          3-----------7\n    //         /|   left   /|\n    //        / | 1       / |\n    //       2-----------6  5  end\n    //       | /         | /\n    // start |/  right   |/\n    //       0-----------4\n    //\n    float isEnd = floor(startFaceNormalAndVertexCorner.w * 0.251); // 0 for front, 1 for end\n    float isTop = floor(startFaceNormalAndVertexCorner.w * mix(0.51, 0.19, isEnd)); // 0 for bottom, 1 for top\n\n    vec3 forward = endPositionAndHeight.xyz - startPositionAndHeight.xyz;\n    vec3 right = normalize(cross(forward, startEllipsoidNormal));\n\n    vec4 position = vec4(startPositionAndHeight.xyz, 1.0);\n    position.xyz += forward * isEnd;\n\n    v_volumeUpEC = czm_normal * normalize(cross(right, forward));\n\n    // Push for volume height\n    float offset;\n    vec3 ellipsoidNormal = mix(startEllipsoidNormal, endEllipsoidNormal, isEnd);\n\n    // offset height to create volume\n    offset = mix(startPositionAndHeight.w, endPositionAndHeight.w, isEnd);\n    offset = mix(u_minimumMaximumVectorHeights.y, u_minimumMaximumVectorHeights.x, isTop) - offset;\n    position.xyz += offset * ellipsoidNormal;\n\n    // move from RTC to EC\n    position = u_modifiedModelView * position;\n    right = czm_normal * right;\n\n    // Push for width in a direction that is in the start or end plane and in a plane with right\n    // N = normalEC ("right-facing" direction for push)\n    // R = right\n    // p = angle between N and R\n    // w = distance to push along R if R == N\n    // d = distance to push along N\n    //\n    //   N   R\n    //  {  p| }      * cos(p) = dot(N, R) = w / d\n    //  d  |  |w    * d = w / dot(N, R)\n    //    { | }\n    //       o---------- polyline segment ----\x3e\n    //\n    vec3 scratchNormal = mix(-startFaceNormalAndVertexCorner.xyz, endFaceNormalAndHalfWidth.xyz, isEnd);\n    scratchNormal = cross(scratchNormal, mix(startEllipsoidNormal, endEllipsoidNormal, isEnd));\n    vec3 miterPushNormal = czm_normal * normalize(scratchNormal);\n\n    offset = 2.0 * endFaceNormalAndHalfWidth.w * max(0.0, czm_metersPerPixel(position)); // offset = widthEC\n    offset = offset / dot(miterPushNormal, right);\n    position.xyz += miterPushNormal * (offset * sign(0.5 - mod(startFaceNormalAndVertexCorner.w, 2.0)));\n\n    gl_Position = czm_depthClamp(czm_projection * position);\n\n    position = u_modifiedModelView * vec4(startPositionAndHeight.xyz, 1.0);\n    vec3 startNormalEC = czm_normal * startFaceNormalAndVertexCorner.xyz;\n    v_startPlaneEC = vec4(startNormalEC, -dot(startNormalEC, position.xyz));\n    v_rightPlaneEC = vec4(right, -dot(right, position.xyz));\n\n    position = u_modifiedModelView * vec4(endPositionAndHeight.xyz, 1.0);\n    vec3 endNormalEC = czm_normal * endFaceNormalAndHalfWidth.xyz;\n    v_endPlaneEC = vec4(endNormalEC, -dot(endNormalEC, position.xyz));\n    v_halfWidth = endFaceNormalAndHalfWidth.w;\n}\n',lle="#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n\nvarying vec4 v_startPlaneEC;\nvarying vec4 v_endPlaneEC;\nvarying vec4 v_rightPlaneEC;\nvarying float v_halfWidth;\nvarying vec3 v_volumeUpEC;\n\nuniform vec4 u_highlightColor;\nvoid main()\n{\n    float logDepthOrDepth = czm_branchFreeTernary(czm_sceneMode == czm_sceneMode2D, gl_FragCoord.z, czm_unpackDepth(texture2D(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw)));\n\n    // Discard for sky\n    if (logDepthOrDepth == 0.0) {\n#ifdef DEBUG_SHOW_VOLUME\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 0.5);\n        return;\n#else // DEBUG_SHOW_VOLUME\n        discard;\n#endif // DEBUG_SHOW_VOLUME\n    }\n\n    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);\n    eyeCoordinate /= eyeCoordinate.w;\n\n    float halfMaxWidth = v_halfWidth * czm_metersPerPixel(eyeCoordinate);\n\n    // Expand halfMaxWidth if direction to camera is almost perpendicular with the volume's up direction\n    halfMaxWidth += halfMaxWidth * (1.0 - dot(-normalize(eyeCoordinate.xyz), v_volumeUpEC));\n\n    // Check distance of the eye coordinate against the right-facing plane\n    float widthwiseDistance = czm_planeDistance(v_rightPlaneEC, eyeCoordinate.xyz);\n\n    // Check eye coordinate against the mitering planes\n    float distanceFromStart = czm_planeDistance(v_startPlaneEC, eyeCoordinate.xyz);\n    float distanceFromEnd = czm_planeDistance(v_endPlaneEC, eyeCoordinate.xyz);\n\n    if (abs(widthwiseDistance) > halfMaxWidth || distanceFromStart < 0.0 || distanceFromEnd < 0.0) {\n#ifdef DEBUG_SHOW_VOLUME\n        gl_FragColor = vec4(logDepthOrDepth, 0.0, 0.0, 0.5);\n        return;\n#else // DEBUG_SHOW_VOLUME\n        discard;\n#endif // DEBUG_SHOW_VOLUME\n    }\n    gl_FragColor = u_highlightColor;\n\n    czm_writeDepthClamp();\n}\n";function ule(e){this._positions=e.positions,this._widths=e.widths,this._counts=e.counts,this._batchIds=e.batchIds,this._ellipsoid=R(e.ellipsoid,ge.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._center=e.center,this._rectangle=e.rectangle,this._batchTable=e.batchTable,this._va=void 0,this._sp=void 0,this._rs=void 0,this._uniformMap=void 0,this._command=void 0,this._transferrableBatchIds=void 0,this._packedBuffer=void 0,this._minimumMaximumVectorHeights=new ro(bo._defaultMinTerrainHeight,bo._defaultMaxTerrainHeight),this._boundingVolume=$u.fromRectangle(e.rectangle,bo._defaultMinTerrainHeight,bo._defaultMaxTerrainHeight,this._ellipsoid),this._classificationType=e.classificationType,this._keepDecodedPositions=e.keepDecodedPositions,this._decodedPositions=void 0,this._decodedPositionOffsets=void 0,this._startEllipsoidNormals=void 0,this._endEllipsoidNormals=void 0,this._startPositionAndHeights=void 0,this._startFaceNormalAndVertexCornerIds=void 0,this._endPositionAndHeights=void 0,this._endFaceNormalAndHalfWidths=void 0,this._vertexBatchIds=void 0,this._indices=void 0,this._constantColor=xy.clone(xy.WHITE),this._highlightColor=this._constantColor,this._trianglesLength=0,this._geometryByteLength=0,this._ready=!1,this._readyPromise=yn(),this._verticesPromise=void 0;const t=this;bo.initialize().then((function(){hle(t,t._rectangle,t._ellipsoid)})).catch((function(e){this._readyPromise.reject(e)}))}function hle(e,t,n){const i=bo.getMinimumMaximumHeights(t,n),o=i.minimumTerrainHeight,r=i.maximumTerrainHeight,s=e._minimumMaximumVectorHeights;s.x=o,s.y=r;const a=e._boundingVolume,c=e._rectangle;$u.fromRectangle(c,o,r,n,a)}function dle(e){const t=e._rectangle,n=e._minimumHeight,i=e._maximumHeight,o=e._ellipsoid,r=e._center,s=2+_t.packedLength+ge.packedLength+K.packedLength,a=new Float64Array(s);let c=0;return a[c++]=n,a[c++]=i,_t.pack(t,a,c),c+=_t.packedLength,ge.pack(o,a,c),c+=ge.packedLength,K.pack(r,a,c),a}Object.defineProperties(ule.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},readyPromise:{get:function(){return this._readyPromise.promise}}});const fle=new ad("createVectorTileClampedPolylines"),ple={startEllipsoidNormal:0,endEllipsoidNormal:1,startPositionAndHeight:2,endPositionAndHeight:3,startFaceNormalAndVertexCorner:4,endFaceNormalAndHalfWidth:5,a_batchId:6};function mle(e,t){if(!C(e._va)){if(!C(e._verticesPromise)){let t=e._positions,n=e._widths,i=e._counts,o=e._transferrableBatchIds,r=e._packedBuffer;C(r)||(t=e._positions=xF(t),n=e._widths=xF(n),i=e._counts=xF(i),o=e._transferrableBatchIds=xF(e._batchIds),r=e._packedBuffer=dle(e));const s=[t.buffer,n.buffer,i.buffer,o.buffer,r.buffer],a={positions:t.buffer,widths:n.buffer,counts:i.buffer,batchIds:o.buffer,packedBuffer:r.buffer,keepDecodedPositions:e._keepDecodedPositions},c=e._verticesPromise=fle.scheduleTask(a,s);if(!C(c))return;Promise.resolve(c).then((function(t){e._keepDecodedPositions&&(e._decodedPositions=new Float64Array(t.decodedPositions),e._decodedPositionOffsets=new Uint32Array(t.decodedPositionOffsets)),e._startEllipsoidNormals=new Float32Array(t.startEllipsoidNormals),e._endEllipsoidNormals=new Float32Array(t.endEllipsoidNormals),e._startPositionAndHeights=new Float32Array(t.startPositionAndHeights),e._startFaceNormalAndVertexCornerIds=new Float32Array(t.startFaceNormalAndVertexCornerIds),e._endPositionAndHeights=new Float32Array(t.endPositionAndHeights),e._endFaceNormalAndHalfWidths=new Float32Array(t.endFaceNormalAndHalfWidths),e._vertexBatchIds=new Uint16Array(t.vertexBatchIds);const n=t.indexDatatype;e._indices=n===fd.UNSIGNED_SHORT?new Uint16Array(t.indices):new Uint32Array(t.indices),e._ready=!0})).catch((function(t){e._readyPromise.reject(t)}))}if(e._ready&&!C(e._va)){const n=e._startEllipsoidNormals,i=e._endEllipsoidNormals,o=e._startPositionAndHeights,r=e._endPositionAndHeights,s=e._startFaceNormalAndVertexCornerIds,a=e._endFaceNormalAndHalfWidths,c=e._vertexBatchIds,l=e._indices;let u=n.byteLength+i.byteLength;u+=o.byteLength+r.byteLength,u+=s.byteLength+a.byteLength,u+=c.byteLength+l.byteLength,e._trianglesLength=l.length/3,e._geometryByteLength=u;const h=hq.createVertexBuffer({context:t,typedArray:n,usage:lq.STATIC_DRAW}),d=hq.createVertexBuffer({context:t,typedArray:i,usage:lq.STATIC_DRAW}),f=hq.createVertexBuffer({context:t,typedArray:o,usage:lq.STATIC_DRAW}),p=hq.createVertexBuffer({context:t,typedArray:r,usage:lq.STATIC_DRAW}),m=hq.createVertexBuffer({context:t,typedArray:s,usage:lq.STATIC_DRAW}),_=hq.createVertexBuffer({context:t,typedArray:a,usage:lq.STATIC_DRAW}),g=hq.createVertexBuffer({context:t,typedArray:c,usage:lq.STATIC_DRAW}),y=hq.createIndexBuffer({context:t,typedArray:l,usage:lq.STATIC_DRAW,indexDatatype:2===l.BYTES_PER_ELEMENT?fd.UNSIGNED_SHORT:fd.UNSIGNED_INT}),v=[{index:ple.startEllipsoidNormal,vertexBuffer:h,componentDatatype:ih.FLOAT,componentsPerAttribute:3},{index:ple.endEllipsoidNormal,vertexBuffer:d,componentDatatype:ih.FLOAT,componentsPerAttribute:3},{index:ple.startPositionAndHeight,vertexBuffer:f,componentDatatype:ih.FLOAT,componentsPerAttribute:4},{index:ple.endPositionAndHeight,vertexBuffer:p,componentDatatype:ih.FLOAT,componentsPerAttribute:4},{index:ple.startFaceNormalAndVertexCorner,vertexBuffer:m,componentDatatype:ih.FLOAT,componentsPerAttribute:4},{index:ple.endFaceNormalAndHalfWidth,vertexBuffer:_,componentDatatype:ih.FLOAT,componentsPerAttribute:4},{index:ple.a_batchId,vertexBuffer:g,componentDatatype:ih.UNSIGNED_SHORT,componentsPerAttribute:1}];e._va=new bq({context:t,attributes:v,indexBuffer:y}),e._positions=void 0,e._widths=void 0,e._counts=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._rectangle=void 0,e._transferrableBatchIds=void 0,e._packedBuffer=void 0,e._startEllipsoidNormals=void 0,e._endEllipsoidNormals=void 0,e._startPositionAndHeights=void 0,e._startFaceNormalAndVertexCornerIds=void 0,e._endPositionAndHeights=void 0,e._endFaceNormalAndHalfWidths=void 0,e._vertexBatchIds=void 0,e._indices=void 0,e._readyPromise.resolve()}}}const _le=new ft,gle=new K;function yle(e,t){C(e._uniformMap)||(e._uniformMap={u_modifiedModelView:function(){const n=t.uniformState.view;return ft.clone(n,_le),ft.multiplyByPoint(_le,e._center,gle),ft.setTranslation(_le,gle,_le),_le},u_highlightColor:function(){return e._highlightColor},u_minimumMaximumVectorHeights:function(){return e._minimumMaximumVectorHeights}})}function vle(e){return yV.fromCache({cull:{enabled:!0,face:yk.FRONT},blending:_k.PRE_MULTIPLIED_ALPHA_BLEND,depthMask:!1,stencilTest:{enabled:e,frontFunction:LY.EQUAL,frontOperation:{fail:BY.KEEP,zFail:BY.KEEP,zPass:BY.KEEP},backFunction:LY.EQUAL,backOperation:{fail:BY.KEEP,zFail:BY.KEEP,zPass:BY.KEEP},reference:FY.CESIUM_3D_TILE_MASK,mask:FY.CESIUM_3D_TILE_MASK}})}function ble(e){C(e._rs)||(e._rs=vle(!1),e._rs3DTiles=vle(!0))}function Ale(e,t){if(C(e._sp))return;const n=e._batchTable,i=n.getVertexShaderCallback(!1,"a_batchId",void 0)(cle),o=n.getFragmentShaderCallback(!1,void 0,!0)(lle),r=new tq({defines:["VECTOR_TILE",Oc.isInternetExplorer()?"":"CLIP_POLYLINE"],sources:[EK,i]}),s=new tq({defines:["VECTOR_TILE"],sources:[o]});e._sp=fH.fromCache({context:t,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:ple})}function wle(e,t){let n=e._command;if(!C(e._command)){const t=e._batchTable.getUniformMapCallback()(e._uniformMap);n=e._command=new UU({owner:e,vertexArray:e._va,renderState:e._rs,shaderProgram:e._sp,uniformMap:t,boundingVolume:e._boundingVolume,pass:HU.TERRAIN_CLASSIFICATION,pickId:e._batchTable.getPickId()});const i=UU.shallowClone(n,n.derivedCommands.tileset);i.renderState=e._rs3DTiles,i.pass=HU.CESIUM_3D_TILE_CLASSIFICATION,n.derivedCommands.tileset=i}const i=e._classificationType;i!==rq.TERRAIN&&i!==rq.BOTH||t.commandList.push(n),i!==rq.CESIUM_3D_TILE&&i!==rq.BOTH||t.commandList.push(n.derivedCommands.tileset)}function Tle(e,t){const n=e._batchIds,i=n.length;for(let o=0;o<i;++o){const e=n[o],i=t[e];i.show=!0,i.color=xy.WHITE}}ule.prototype.getPositions=function(e){return ale.getPolylinePositions(this,e)},ule.prototype.createFeatures=function(e,t){const n=this._batchIds,i=n.length;for(let o=0;o<i;++o){const i=n[o];t[i]=new hZ(e,i)}},ule.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};const Cle=new xy,Ele=xy.WHITE,xle=!0;ule.prototype.applyStyle=function(e,t){if(!C(e))return void Tle(this,t);const n=this._batchIds,i=n.length;for(let o=0;o<i;++o){const i=n[o],r=t[i];r.color=C(e.color)?e.color.evaluateColor(r,Cle):Ele,r.show=C(e.show)?e.show.evaluate(r):xle}},ule.prototype.update=function(e){const t=e.context;if(mle(this,t),yle(this,t),Ale(this,t),ble(this),!this._ready)return;const n=e.passes;(n.render||n.pick)&&wle(this,e)},ule.prototype.isDestroyed=function(){return!1},ule.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),Qh(this)};var Sle=ule;function Ile(e,t,n,i,o){this._tileset=e,this._tile=t,this._resource=n,this._polygons=void 0,this._polylines=void 0,this._points=void 0,this._contentReadyPromise=void 0,this._readyPromise=yn(),this._metadata=void 0,this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,this._group=void 0,Mle(this,i,o)}function Ole(e){return function(t,n){C(e._polygons)&&e._polygons.updateCommands(t,n)}}function Dle(e,t){let n,i,o,r;const s=R(e.POLYGONS_LENGTH,0),a=R(e.POLYLINES_LENGTH,0),c=R(e.POINTS_LENGTH,0);if(s>0&&C(e.POLYGON_BATCH_IDS)){const i=t.byteOffset+e.POLYGON_BATCH_IDS.byteOffset;n=new Uint16Array(t.buffer,i,s)}if(a>0&&C(e.POLYLINE_BATCH_IDS)){const n=t.byteOffset+e.POLYLINE_BATCH_IDS.byteOffset;i=new Uint16Array(t.buffer,n,a)}if(c>0&&C(e.POINT_BATCH_IDS)){const n=t.byteOffset+e.POINT_BATCH_IDS.byteOffset;o=new Uint16Array(t.buffer,n,c)}const l=C(n)||C(i)||C(o),u=s>0&&!C(n)||a>0&&!C(i)||c>0&&!C(o);if(l&&u)throw new Je("If one group of batch ids is defined, then all batch ids must be defined.");const h=!C(n)&&!C(i)&&!C(o);if(h){let e=0;if(!C(n)&&s>0)for(n=new Uint16Array(s),r=0;r<s;++r)n[r]=e++;if(!C(i)&&a>0)for(i=new Uint16Array(a),r=0;r<a;++r)i[r]=e++;if(!C(o)&&c>0)for(o=new Uint16Array(c),r=0;r<c;++r)o[r]=e++}return{polygons:n,polylines:i,points:o}}Object.defineProperties(Ile.prototype,{featuresLength:{get:function(){return C(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return C(this._points)?this._points.pointsLength:0}},trianglesLength:{get:function(){let e=0;return C(this._polygons)&&(e+=this._polygons.trianglesLength),C(this._polylines)&&(e+=this._polylines.trianglesLength),e}},geometryByteLength:{get:function(){let e=0;return C(this._polygons)&&(e+=this._polygons.geometryByteLength),C(this._polylines)&&(e+=this._polylines.geometryByteLength),e}},texturesByteLength:{get:function(){return C(this._points)?this._points.texturesByteLength:0}},batchTableByteLength:{get:function(){return C(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},batchTable:{get:function(){return this._batchTable}},group:{get:function(){return this._group},set:function(e){this._group=e}}});const Ple=Uint32Array.BYTES_PER_ELEMENT;function Rle(e){return new ale(e)}function Lle(e){return new Sle(e)}function Mle(e,t,n){n=R(n,0);const i=new Uint8Array(t),o=new DataView(t);n+=Ple;const r=o.getUint32(n,!0);if(1!==r)throw new Je(`Only Vector tile version 1 is supported.  Version ${r} is not.`);n+=Ple;const s=o.getUint32(n,!0);if(n+=Ple,0===s)return void e._readyPromise.resolve(e);const a=o.getUint32(n,!0);if(n+=Ple,0===a)throw new Je("Feature table must have a byte length greater than zero");const c=o.getUint32(n,!0);n+=Ple;const l=o.getUint32(n,!0);n+=Ple;const u=o.getUint32(n,!0);n+=Ple;const h=o.getUint32(n,!0);n+=Ple;const d=o.getUint32(n,!0);n+=Ple;const f=o.getUint32(n,!0);n+=Ple;const p=o.getUint32(n,!0);n+=Ple;const m=Fp(i,n,a);n+=a;const _=new Uint8Array(t,n,c);let g,y;n+=c,l>0&&(g=Fp(i,n,l),n+=l,u>0&&(y=new Uint8Array(t,n,u),y=new Uint8Array(y),n+=u));const v=R(m.POLYGONS_LENGTH,0),b=R(m.POLYLINES_LENGTH,0),A=R(m.POINTS_LENGTH,0),w=v+b+A,T=new lZ(e,w,g,y,Ole(e));if(e._batchTable=T,0===w)return;const E=new mZ(m,_),x=E.getGlobalProperty("REGION");if(!C(x))throw new Je("Feature table global property: REGION must be defined");const S=_t.unpack(x),I=x[4],O=x[5],D=e._tile.computedTransform;let P=E.getGlobalProperty("RTC_CENTER",ih.FLOAT,3);C(P)?(P=K.unpack(P),ft.multiplyByPoint(D,P,P)):(P=_t.center(S),P.height=z.lerp(I,O,.5),P=ge.WGS84.cartographicToCartesian(P));const L=Dle(m,_);if(n+=(4-n%4)%4,v>0){E.featuresLength=v;const i=R(E.getPropertyArray("POLYGON_COUNTS",ih.UNSIGNED_INT,1),E.getPropertyArray("POLYGON_COUNT",ih.UNSIGNED_INT,1));if(!C(i))throw new Je("Feature table property: POLYGON_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");const o=R(E.getPropertyArray("POLYGON_INDEX_COUNTS",ih.UNSIGNED_INT,1),E.getPropertyArray("POLYGON_INDEX_COUNT",ih.UNSIGNED_INT,1));if(!C(o))throw new Je("Feature table property: POLYGON_INDEX_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");const r=i.reduce((function(e,t){return e+2*t}),0),s=o.reduce((function(e,t){return e+t}),0),a=new Uint32Array(t,n,s);n+=h;const c=new Uint16Array(t,n,r);let l,u;n+=d,C(m.POLYGON_MINIMUM_HEIGHTS)&&C(m.POLYGON_MAXIMUM_HEIGHTS)&&(l=E.getPropertyArray("POLYGON_MINIMUM_HEIGHTS",ih.FLOAT,1),u=E.getPropertyArray("POLYGON_MAXIMUM_HEIGHTS",ih.FLOAT,1)),e._polygons=new Gce({positions:c,counts:i,indexCounts:o,indices:a,minimumHeight:I,maximumHeight:O,polygonMinimumHeights:l,polygonMaximumHeights:u,center:P,rectangle:S,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:T,batchIds:L.polygons,modelMatrix:D})}if(b>0){E.featuresLength=b;const i=R(E.getPropertyArray("POLYLINE_COUNTS",ih.UNSIGNED_INT,1),E.getPropertyArray("POLYLINE_COUNT",ih.UNSIGNED_INT,1));if(!C(i))throw new Je("Feature table property: POLYLINE_COUNTS must be defined when POLYLINES_LENGTH is greater than 0");let o=E.getPropertyArray("POLYLINE_WIDTHS",ih.UNSIGNED_SHORT,1);if(!C(o)){o=new Uint16Array(b);for(let e=0;e<b;++e)o[e]=2}const r=i.reduce((function(e,t){return e+3*t}),0),s=new Uint16Array(t,n,r);n+=f;const a=e._tileset,c=a.examineVectorLinesFunction;if(C(c)){const t=zF(new Uint16Array(s),S,I,O,ge.WGS84);Nle(t,i,L.polylines,T,e.url,c)}let l=Rle;C(a.classificationType)&&(l=Lle),e._polylines=l({positions:s,widths:o,counts:i,batchIds:L.polylines,minimumHeight:I,maximumHeight:O,center:P,rectangle:S,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:T,classificationType:a.classificationType,keepDecodedPositions:a.vectorKeepDecodedPositions})}if(A>0){const i=new Uint16Array(t,n,3*A);n+=p,e._points=new Nce({positions:i,batchIds:L.points,minimumHeight:I,maximumHeight:O,rectangle:S,batchTable:T})}}function Ble(e){const t=e.featuresLength;if(!C(e._features)&&t>0){const n=new Array(t);C(e._polygons)&&e._polygons.createFeatures(e,n),C(e._polylines)&&e._polylines.createFeatures(e,n),C(e._points)&&e._points.createFeatures(e,n),e._features=n}}function Nle(e,t,n,i,o,r){const s=t.length;let a=0;for(let c=0;c<s;c++){const s=3*t[c],l=e.slice(a,a+s);a+=s,r(l,n[c],o,i)}}Ile.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},Ile.prototype.getFeature=function(e){const t=this.featuresLength;if(!C(e)||e<0||e>=t)throw new x(`batchId is required and between zero and featuresLength - 1 (${t-1}).`);return Ble(this),this._features[e]},Ile.prototype.applyDebugSettings=function(e,t){C(this._polygons)&&this._polygons.applyDebugSettings(e,t),C(this._polylines)&&this._polylines.applyDebugSettings(e,t),C(this._points)&&this._points.applyDebugSettings(e,t)},Ile.prototype.applyStyle=function(e){Ble(this),C(this._polygons)&&this._polygons.applyStyle(e,this._features),C(this._polylines)&&this._polylines.applyStyle(e,this._features),C(this._points)&&this._points.applyStyle(e,this._features)},Ile.prototype.update=function(e,t){let n=!0;if(C(this._polygons)&&(this._polygons.classificationType=this._tileset.classificationType,this._polygons.debugWireframe=this._tileset.debugWireframe,this._polygons.update(t),n=n&&this._polygons._ready),C(this._polylines)&&(this._polylines.update(t),n=n&&this._polylines._ready),C(this._points)&&(this._points.update(t),n=n&&this._points._ready),C(this._batchTable)&&n&&this._batchTable.update(e,t),!C(this._contentReadyPromise)){const e=C(this._points)?this._points.readyPromise:void 0,t=C(this._polygons)?this._polygons.readyPromise:void 0,n=C(this._polylines)?this._polylines.readyPromise:void 0,i=this;this._contentReadyPromise=Promise.all([e,t,n]).then((function(){i._readyPromise.resolve(i)})).catch((function(e){i._readyPromise.reject(e)}))}},Ile.prototype.getPolylinePositions=function(e){const t=this._polylines;if(C(t))return t.getPositions(e)},Ile.prototype.isDestroyed=function(){return!1},Ile.prototype.destroy=function(){return this._polygons=this._polygons&&this._polygons.destroy(),this._polylines=this._polylines&&this._polylines.destroy(),this._points=this._points&&this._points.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Qh(this)};var Fle=Ile;function zle(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.number("options.count",e.count),this._name=e.name,this._id=e.id,this._count=e.count,this._extras=e.extras,this._extensions=e.extensions,this._metadataTable=e.metadataTable,this._jsonMetadataTable=e.jsonMetadataTable,this._batchTableHierarchy=e.batchTableHierarchy}Object.defineProperties(zle.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},count:{get:function(){return this._count}},class:{get:function(){if(C(this._metadataTable))return this._metadataTable.class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),zle.prototype.hasProperty=function(e,t){return D.typeOf.number("index",e),D.typeOf.string("propertyId",t),!(!C(this._metadataTable)||!this._metadataTable.hasProperty(t))||(!(!C(this._jsonMetadataTable)||!this._jsonMetadataTable.hasProperty(t))||!(!C(this._batchTableHierarchy)||!this._batchTableHierarchy.hasProperty(e,t)))},zle.prototype.hasPropertyBySemantic=function(e,t){return D.typeOf.number("index",e),D.typeOf.string("semantic",t),!!C(this._metadataTable)&&this._metadataTable.hasPropertyBySemantic(t)},zle.prototype.propertyExists=function(e){return D.typeOf.string("propertyId",e),!(!C(this._metadataTable)||!this._metadataTable.hasProperty(e))||(!(!C(this._jsonMetadataTable)||!this._jsonMetadataTable.hasProperty(e))||!(!C(this._batchTableHierarchy)||!this._batchTableHierarchy.propertyExists(e)))},zle.prototype.propertyExistsBySemantic=function(e){return D.typeOf.string("semantic",e),!!C(this._metadataTable)&&this._metadataTable.hasPropertyBySemantic(e)};const kle=[];zle.prototype.getPropertyIds=function(e,t){return t=C(t)?t:[],t.length=0,C(this._metadataTable)&&t.push.apply(t,this._metadataTable.getPropertyIds(kle)),C(this._jsonMetadataTable)&&t.push.apply(t,this._jsonMetadataTable.getPropertyIds(kle)),C(this._batchTableHierarchy)&&t.push.apply(t,this._batchTableHierarchy.getPropertyIds(e,kle)),t},zle.prototype.getProperty=function(e,t){let n;return C(this._metadataTable)&&(n=this._metadataTable.getProperty(e,t),C(n))||C(this._jsonMetadataTable)&&(n=this._jsonMetadataTable.getProperty(e,t),C(n))||C(this._batchTableHierarchy)&&(n=this._batchTableHierarchy.getProperty(e,t),C(n))?n:void 0},zle.prototype.setProperty=function(e,t,n){return!(!C(this._metadataTable)||!this._metadataTable.setProperty(e,t,n))||(!(!C(this._jsonMetadataTable)||!this._jsonMetadataTable.setProperty(e,t,n))||C(this._batchTableHierarchy)&&this._batchTableHierarchy.setProperty(e,t,n))},zle.prototype.getPropertyBySemantic=function(e,t){if(C(this._metadataTable))return this._metadataTable.getPropertyBySemantic(e,t)},zle.prototype.setPropertyBySemantic=function(e,t,n){return!!C(this._metadataTable)&&this._metadataTable.setPropertyBySemantic(e,t,n)},zle.prototype.getPropertyTypedArray=function(e){if(D.typeOf.string("propertyId",e),C(this._metadataTable))return this._metadataTable.getPropertyTypedArray(e)},zle.prototype.getPropertyTypedArrayBySemantic=function(e){if(D.typeOf.string("semantic",e),C(this._metadataTable))return this._metadataTable.getPropertyTypedArrayBySemantic(e)};var Ule=zle;function Vle(e){e=R(e,R.EMPTY_OBJECT);const t=e.property,n=e.classProperty,i=e.textures;D.typeOf.object("options.property",t),D.typeOf.object("options.classProperty",n),D.typeOf.object("options.textures",i);const o=t,r=X7.createModelTextureReader({textureInfo:o,channels:Wle(t.channels),texture:i[o.index]});this._min=t.min,this._max=t.max;let s=t.offset,a=t.scale;const c=n.hasValueTransform||C(s)||C(a);s=R(s,n.offset),a=R(a,n.scale),s=n.unpackVectorAndMatrixTypes(s),a=n.unpackVectorAndMatrixTypes(a),this._offset=s,this._scale=a,this._hasValueTransform=c,this._textureReader=r,this._classProperty=n,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(Vle.prototype,{textureReader:{get:function(){return this._textureReader}},hasValueTransform:{get:function(){return this._hasValueTransform}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),Vle.prototype.isGpuCompatible=function(){const e=this._classProperty,t=e.type,n=e.componentType;return e.isArray?!e.isVariableLengthArray&&e.arrayLength<=4&&t===J8.SCALAR&&n===X8.UINT8:!(!J8.isVectorType(t)&&t!==J8.SCALAR)&&n===X8.UINT8};const Hle=[void 0,"float","vec2","vec3","vec4"],Gle=[void 0,"int","ivec2","ivec3","ivec4"];function Wle(e){return e.map((function(e){return"rgba".charAt(e)})).join("")}Vle.prototype.getGlslType=function(){const e=this._classProperty;let t=J8.getComponentCount(e.type);return e.isArray&&(t=e.arrayLength),e.normalized?Hle[t]:Gle[t]},Vle.prototype.unpackInShader=function(e){const t=this._classProperty;if(t.normalized)return e;const n=this.getGlslType();return`${n}(255.0 * ${e})`};var qle=Vle;function jle(e){e=R(e,R.EMPTY_OBJECT);const t=e.propertyTexture,n=e.class,i=e.textures;D.typeOf.object("options.propertyTexture",t),D.typeOf.object("options.class",n),D.typeOf.object("options.textures",i);const o=t.extensions,r=t.extras,s={};if(C(t.properties))for(const a in t.properties)t.properties.hasOwnProperty(a)&&(s[a]=new qle({property:t.properties[a],classProperty:n.properties[a],textures:i}));this._name=e.name,this._id=e.id,this._class=n,this._properties=s,this._extras=r,this._extensions=o}Object.defineProperties(jle.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},class:{get:function(){return this._class}},properties:{get:function(){return this._properties}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),jle.prototype.getProperty=function(e){return D.typeOf.string("propertyId",e),this._properties[e]};var Yle=jle;function Kle(e){e=R(e,R.EMPTY_OBJECT);const t=e.property,n=e.classProperty;D.typeOf.object("options.property",t),D.typeOf.object("options.classProperty",n),this._attribute=t.attribute,this._classProperty=n,this._min=t.min,this._max=t.max;let i=t.offset,o=t.scale;const r=n.hasValueTransform||C(i)||C(o);i=R(i,n.offset),o=R(o,n.scale),i=n.unpackVectorAndMatrixTypes(i),o=n.unpackVectorAndMatrixTypes(o),this._offset=i,this._scale=o,this._hasValueTransform=r,this._extras=t.extras,this._extensions=t.extensions}function Xle(e){e=R(e,R.EMPTY_OBJECT);const t=e.propertyAttribute,n=e.class;D.typeOf.object("options.propertyAttribute",t),D.typeOf.object("options.class",n);const i={};if(C(t.properties))for(const o in t.properties)t.properties.hasOwnProperty(o)&&(i[o]=new Kle({property:t.properties[o],classProperty:n.properties[o]}));this._name=e.name,this._id=e.id,this._class=n,this._properties=i,this._extras=t.extras,this._extensions=t.extensions}function Qle(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.object("options.schema",e.schema),this._schema=e.schema;const t=e.propertyTables;this._propertyTableCount=C(t)?t.length:0,this._propertyTables=t,this._propertyTextures=e.propertyTextures,this._propertyAttributes=e.propertyAttributes,this._statistics=e.statistics,this._extras=e.extras,this._extensions=e.extensions}Object.defineProperties(Kle.prototype,{attribute:{get:function(){return this._attribute}},hasValueTransform:{get:function(){return this._hasValueTransform}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),Object.defineProperties(Xle.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},class:{get:function(){return this._class}},properties:{get:function(){return this._properties}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),Xle.prototype.getProperty=function(e){return D.typeOf.string("propertyId",e),this._properties[e]},Object.defineProperties(Qle.prototype,{schema:{get:function(){return this._schema}},statistics:{get:function(){return this._statistics}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}},propertyTableCount:{get:function(){return this._propertyTableCount}},propertyTables:{get:function(){return this._propertyTables}},propertyTextures:{get:function(){return this._propertyTextures}},propertyAttributes:{get:function(){return this._propertyAttributes}}}),Qle.prototype.getPropertyTable=function(e){return D.typeOf.number("propertyTableId",e),this._propertyTables[e]},Qle.prototype.getPropertyTexture=function(e){return D.typeOf.number("propertyTextureId",e),this._propertyTextures[e]},Qle.prototype.getPropertyAttribute=function(e){return D.typeOf.number("propertyAttributeId",e),this._propertyAttributes[e]};var Jle=Qle;function Zle(e){e=R(e,R.EMPTY_OBJECT);const t=e.extension,n=e.schema;D.typeOf.object("options.extension",t),D.typeOf.object("options.schema",n);const i=[];if(C(t.propertyTables))for(let s=0;s<t.propertyTables.length;s++){const o=t.propertyTables[s],r=n.classes[o.class],a=new U9({count:o.count,properties:o.properties,class:r,bufferViews:e.bufferViews});i.push(new Ule({id:s,name:o.name,count:o.count,metadataTable:a,extras:o.extras,extensions:o.extensions}))}const o=[];if(C(t.propertyTextures))for(let s=0;s<t.propertyTextures.length;s++){const i=t.propertyTextures[s];o.push(new Yle({id:s,name:i.name,propertyTexture:i,class:n.classes[i.class],textures:e.textures}))}const r=[];if(C(t.propertyAttributes))for(let s=0;s<t.propertyAttributes.length;s++){const e=t.propertyAttributes[s];r.push(new Xle({id:s,name:e.name,class:n.classes[e.class],propertyAttribute:e}))}return new Jle({schema:n,propertyTables:i,propertyTextures:o,propertyAttributes:r,statistics:t.statistics,extras:t.extras,extensions:t.extensions})}function $le(e){e=R(e,R.EMPTY_OBJECT);const t=e.extension,n=e.schema;let i;D.typeOf.object("options.extension",t),D.typeOf.object("options.schema",n);const o=[];let r;if(C(t.featureTables))for(r=Object.keys(t.featureTables).sort(),i=0;i<r.length;i++){const s=r[i],a=t.featureTables[s],c=n.classes[a.class],l=new U9({count:a.count,properties:a.properties,class:c,bufferViews:e.bufferViews});o.push(new Ule({id:s,count:a.count,metadataTable:l,extras:a.extras,extensions:a.extensions}))}const s=[];if(C(t.featureTextures))for(r=Object.keys(t.featureTextures).sort(),i=0;i<r.length;i++){const o=r[i],a=t.featureTextures[o];s.push(new Yle({id:o,propertyTexture:eue(a),class:n.classes[a.class],textures:e.textures}))}return new Jle({schema:n,propertyTables:o,propertyTextures:s,statistics:t.statistics,extras:t.extras,extensions:t.extensions})}function eue(e){const t={class:e.class,properties:{}},n=e.properties;for(const i in n)if(n.hasOwnProperty(i)){const e=n[i],o={channels:tue(e.channels),extras:e.extras,extensions:e.extensions};t.properties[i]=_n(e.texture,o,!0)}return t}function tue(e){const t=e.length,n=new Array(t);for(let i=0;i<t;i++)n[i]="rgba".indexOf(e[i]);return n}function nue(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltf,n=e.extension,i=e.extensionLegacy,o=e.gltfResource,r=e.baseResource,s=e.supportedImageFormats,a=e.cacheKey,c=R(e.asynchronous,!0);if(D.typeOf.object("options.gltf",t),D.typeOf.object("options.gltfResource",o),D.typeOf.object("options.baseResource",r),D.typeOf.object("options.supportedImageFormats",s),!C(e.extension)&&!C(e.extensionLegacy))throw new x("One of options.extension or options.extensionLegacy must be specified");this._gltfResource=o,this._baseResource=r,this._gltf=t,this._extension=n,this._extensionLegacy=i,this._supportedImageFormats=s,this._cacheKey=a,this._asynchronous=c,this._bufferViewLoaders=[],this._textureLoaders=[],this._schemaLoader=void 0,this._structuralMetadata=void 0,this._state=G9.UNLOADED,this._promise=yn()}function iue(e,t){for(const n in e)if(e.hasOwnProperty(n)){const i=e[n],o=i.values,r=i.arrayOffsets,s=i.stringOffsets;C(o)&&(t[o]=!0),C(r)&&(t[r]=!0),C(s)&&(t[s]=!0)}}function oue(e,t){for(const n in e)if(e.hasOwnProperty(n)){const i=e[n],o=i.bufferView,r=i.arrayOffsetBufferView,s=i.stringOffsetBufferView;C(o)&&(t[o]=!0),C(r)&&(t[r]=!0),C(s)&&(t[s]=!0)}}function rue(e){const t=e.propertyTables,n={};if(C(t))for(let i=0;i<t.length;i++){const e=t[i];iue(e.properties,n)}return n}function sue(e){const t=e.featureTables,n={};if(C(t))for(const i in t)if(t.hasOwnProperty(i)){const e=t[i],o=e.properties;C(o)&&oue(o,n)}return n}function aue(e){let t;t=C(e._extension)?rue(e._extension):sue(e._extensionLegacy);const n=[],i={};for(const o in t)if(t.hasOwnProperty(o)){const t=Ree.loadBufferView({gltf:e._gltf,bufferViewId:parseInt(o),gltfResource:e._gltfResource,baseResource:e._baseResource});n.push(t.promise),e._bufferViewLoaders.push(t),i[o]=t}return Promise.all(n).then((function(){const t={};for(const e in i)if(i.hasOwnProperty(e)){const n=i[e],o=new Uint8Array(n.typedArray);t[e]=o}return pue(e),t}))}function cue(e){const t={},n=e.propertyTextures;if(C(n))for(let i=0;i<n.length;i++){const e=n[i],o=e.properties;C(o)&&lue(o,t)}return t}function lue(e,t){for(const n in e)if(e.hasOwnProperty(n)){const i=e[n];t[i.index]=i}}function uue(e){const t={},n=e.featureTextures;if(C(n))for(const i in n)if(n.hasOwnProperty(i)){const e=n[i],o=e.properties;C(o)&&hue(o,t)}return t}function hue(e,t){for(const n in e)if(e.hasOwnProperty(n)){const i=e[n],o=i.texture;t[o.index]=o}}function due(e){let t;t=C(e._extension)?cue(e._extension):uue(e._extensionLegacy);const n=e._gltf,i=e._gltfResource,o=e._baseResource,r=e._supportedImageFormats,s=e._asynchronous,a=[],c={};for(const l in t)if(t.hasOwnProperty(l)){const u=Ree.loadTexture({gltf:n,textureInfo:t[l],gltfResource:i,baseResource:o,supportedImageFormats:r,asynchronous:s});a.push(u.promise),e._textureLoaders.push(u),c[l]=u}return Promise.all(a).then((function(){const e={};for(const t in c)if(c.hasOwnProperty(t)){const n=c[t];e[t]=n.texture}return e}))}function fue(e){const t=R(e._extension,e._extensionLegacy);let n;if(C(t.schemaUri)){const i=e._baseResource.getDerivedResource({url:t.schemaUri});n=Ree.loadSchema({resource:i})}else n=Ree.loadSchema({schema:t.schema});return e._schemaLoader=n,n.promise.then((function(e){return e.schema}))}function pue(e){const t=e._bufferViewLoaders,n=t.length;for(let i=0;i<n;++i)Ree.unload(t[i]);e._bufferViewLoaders.length=0}function mue(e){const t=e._textureLoaders,n=t.length;for(let i=0;i<n;++i)Ree.unload(t[i]);e._textureLoaders.length=0}C(Object.create)&&(nue.prototype=Object.create(V9.prototype),nue.prototype.constructor=nue),Object.defineProperties(nue.prototype,{promise:{get:function(){return this._promise.promise}},cacheKey:{get:function(){return this._cacheKey}},structuralMetadata:{get:function(){return this._structuralMetadata}}}),nue.prototype.load=function(){const e=aue(this),t=due(this),n=fue(this);this._gltf=void 0,this._state=G9.LOADING;const i=this;Promise.all([e,t,n]).then((function(e){if(i.isDestroyed())return;const t=e[0],n=e[1],o=e[2];C(i._extension)?i._structuralMetadata=Zle({extension:i._extension,schema:o,bufferViews:t,textures:n}):i._structuralMetadata=$le({extension:i._extensionLegacy,schema:o,bufferViews:t,textures:n}),i._state=G9.READY,i._promise.resolve(i)})).catch((function(e){if(i.isDestroyed())return;i.unload(),i._state=G9.FAILED;const t="Failed to load structural metadata";i._promise.reject(i.getError(t,e))}))},nue.prototype.process=function(e){if(D.typeOf.object("frameState",e),this._state!==G9.LOADING)return;const t=this._textureLoaders,n=t.length;for(let i=0;i<n;++i){const n=t[i];n.process(e)}},nue.prototype.unload=function(){pue(this),mue(this),C(this._schemaLoader)&&Ree.unload(this._schemaLoader),this._schemaLoader=void 0,this._structuralMetadata=void 0};const _ue={TRANSLATION:"TRANSLATION",ROTATION:"ROTATION",SCALE:"SCALE",FEATURE_ID:"_FEATURE_ID",fromGltfSemantic:function(e){D.typeOf.string("gltfSemantic",e);let t=e;const n=/^(\w+)_\d+$/,i=n.exec(e);switch(null!==i&&(t=i[1]),t){case"TRANSLATION":return _ue.TRANSLATION;case"ROTATION":return _ue.ROTATION;case"SCALE":return _ue.SCALE;case"_FEATURE_ID":return _ue.FEATURE_ID}}};var gue=Object.freeze(_ue);function yue(e){e=R(e,R.EMPTY_OBJECT),this.webp=R(e.webp,!1),this.basis=R(e.basis,!1)}const vue=j7.Attribute,bue=j7.Indices,Aue=j7.FeatureIdAttribute,wue=j7.FeatureIdTexture,Tue=j7.FeatureIdImplicitRange,Cue=j7.MorphTarget,Eue=j7.Primitive,xue=j7.Instances,Sue=j7.Skin,Iue=j7.Node,Oue=j7.Asset,Due=j7.Scene,Pue=j7.Components,Rue=j7.MetallicRoughness,Lue=j7.SpecularGlossiness,Mue=j7.Material,Bue={UNLOADED:0,LOADING:1,LOADED:2,PROCESSING:3,PROCESSED:4,READY:4,FAILED:5};function Nue(e){e=R(e,R.EMPTY_OBJECT);const t=e.gltfResource;let n=e.baseResource;const i=e.typedArray,o=R(e.releaseGltfJson,!1),r=R(e.asynchronous,!0),s=R(e.incrementallyLoadTextures,!0),a=R(e.upAxis,iJ.Y),c=R(e.forwardAxis,iJ.Z),l=R(e.loadAsTypedArray,!1),u=R(e.renameBatchIdSemantic,!1);D.typeOf.object("options.gltfResource",t),n=C(n)?n:t.clone(),this._gltfJson=e.gltfJson,this._gltfResource=t,this._baseResource=n,this._typedArray=i,this._releaseGltfJson=o,this._asynchronous=r,this._incrementallyLoadTextures=s,this._upAxis=a,this._forwardAxis=c,this._loadAsTypedArray=l,this._renameBatchIdSemantic=u,this._sortedPropertyTableIds=void 0,this._sortedFeatureTextureIds=void 0,this._gltfJsonLoader=void 0,this._state=Bue.UNLOADED,this._textureState=Bue.UNLOADED,this._promise=yn(),this._texturesLoadedPromise=yn(),this._textureLoaders=[],this._bufferViewLoaders=[],this._geometryLoaders=[],this._structuralMetadataLoader=void 0,this._components=void 0}function Fue(e,t){e.unload(),e._state=Bue.FAILED,e._textureState=Bue.FAILED;const n="Failed to load glTF";t=e.getError(n,t),e._promise.reject(t),e._texturesLoadedPromise.reject(t)}function zue(e,t){let n;const i=e._textureLoaders,o=i.length;for(n=0;n<o;++n)i[n].process(t);const r=e._bufferViewLoaders,s=r.length;for(n=0;n<s;++n)r[n].process(t);const a=e._geometryLoaders,c=a.length;for(n=0;n<c;++n)a[n].process(t);C(e._structuralMetadataLoader)&&e._structuralMetadataLoader.process(t)}function kue(e,t,n,i,o,r,s){const a=t.accessors[n],c=a.bufferView,l=Ree.loadVertexBuffer({gltf:t,gltfResource:e._gltfResource,baseResource:e._baseResource,bufferViewId:c,draco:o,attributeSemantic:i,accessorId:n,asynchronous:e._asynchronous,dequantize:r,loadAsTypedArray:s});return e._geometryLoaders.push(l),l}function Uue(e,t,n,i,o){const r=Ree.loadIndexBuffer({gltf:t,accessorId:n,gltfResource:e._gltfResource,baseResource:e._baseResource,draco:i,asynchronous:e._asynchronous,loadAsTypedArray:o});return e._geometryLoaders.push(r),r}function Vue(e,t,n){const i=Ree.loadBufferView({gltf:t,bufferViewId:n,gltfResource:e._gltfResource,baseResource:e._baseResource});return e._bufferViewLoaders.push(i),i}function Hue(e,t,n){let i=t.byteOffset;const o=EZ(e,t),r=t.count,s=TZ(t.type),a=t.componentType,c=ih.getSizeInBytes(a),l=c*s,u=r*s;if(o===l)return n=new Uint8Array(n),ih.createArrayBufferView(a,n.buffer,n.byteOffset+i,u);const h=ih.createTypedArray(a,u),d=new DataView(n.buffer),f=new Array(s),p=jZ(t.componentType);i=n.byteOffset+i;for(let m=0;m<r;++m){p(d,i,s,c,f);for(let e=0;e<s;++e)h[m*s+e]=f[e];i+=o}return h}function Gue(e,t){if(C(t))return e===Number?t[0]:e.unpack(t)}function Wue(e){return e===Number?0:new e}function que(e,t,n,i,o){const r=e.accessors[t],s=fh.getMathType(r.type),a=new vue;return a.name=n,a.semantic=i,a.setIndex=o,a.constant=Wue(s),a.componentDatatype=r.componentType,a.normalized=R(r.normalized,!1),a.count=r.count,a.type=r.type,a.min=Gue(s,r.min),a.max=Gue(s,r.max),a.byteOffset=r.byteOffset,a.byteStride=EZ(e,r),a}function jue(e){const t=/^\w+_(\d+)$/,n=t.exec(e);if(null!==n)return parseInt(n[1])}function Yue(e,t,n,i,o,r,s,a,c){const l=t.accessors[n],u=l.bufferView;let h=o;!e._renameBatchIdSemantic||"_BATCHID"!==o&&"BATCHID"!==o||(h="_FEATURE_ID_0");const d=o,f=i.fromGltfSemantic(h),p=C(f)?jue(h):void 0,m=que(t,n,d,f,p);if(!C(r)&&!C(u))return m;const _=kue(e,t,n,o,r,s,a);return _.promise.then((function(n){if(!e.isDestroyed()){if(c){const e=n.typedArray;m.packedTypedArray=Hue(t,l,e),m.byteOffset=0,m.byteStride=void 0}else a?m.typedArray=n.typedArray:m.buffer=n.buffer;C(r)&&C(r.attributes)&&C(r.attributes[o])&&(m.byteOffset=0,m.byteStride=void 0,m.quantization=n.quantization)}})),m}function Kue(e,t,n,i,o){return Yue(e,t,n,Ene,i,o,!1,e._loadAsTypedArray,!1)}function Xue(e,t,n,i,o){return Yue(e,t,n,gue,i,void 0,!0,o,o)}function Que(e,t,n,i){const o=t.accessors[n],r=o.bufferView;if(!C(i)&&!C(r))return;const s=new bue;s.count=o.count;const a=e._loadAsTypedArray,c=Uue(e,t,n,i,a);return c.promise.then((function(t){e.isDestroyed()||(s.indexDatatype=t.indexDatatype,a?s.typedArray=t.typedArray:s.buffer=t.buffer)})),s}function Jue(e,t,n,i,o){const r=X7.getImageIdFromTexture({gltf:t,textureId:n.index,supportedImageFormats:i});if(!C(r))return;const s=Ree.loadTexture({gltf:t,textureInfo:n,gltfResource:e._gltfResource,baseResource:e._baseResource,supportedImageFormats:i,asynchronous:e._asynchronous});e._textureLoaders.push(s);const a=X7.createModelTextureReader({textureInfo:n});return s.promise.then((function(t){e.isDestroyed()||(a.texture=t.texture,C(o)&&(a.texture.sampler=o))})),a}function Zue(e,t,n,i){const o=new Mue,r=R(n.extensions,R.EMPTY_OBJECT),s=r.KHR_materials_pbrSpecularGlossiness,a=n.pbrMetallicRoughness;if(o.unlit=C(r.KHR_materials_unlit),C(s)){const n=new Lue;o.specularGlossiness=n,C(s.diffuseTexture)&&(n.diffuseTexture=Jue(e,t,s.diffuseTexture,i)),C(s.specularGlossinessTexture)&&C(s.specularGlossinessTexture)&&(n.specularGlossinessTexture=Jue(e,t,s.specularGlossinessTexture,i)),n.diffuseFactor=Gue(Xe,s.diffuseFactor),n.specularFactor=Gue(K,s.specularFactor),n.glossinessFactor=s.glossinessFactor,o.pbrSpecularGlossiness=s}else if(C(a)){const n=new Rue;o.metallicRoughness=n,C(a.baseColorTexture)&&(n.baseColorTexture=Jue(e,t,a.baseColorTexture,i)),C(a.metallicRoughnessTexture)&&(n.metallicRoughnessTexture=Jue(e,t,a.metallicRoughnessTexture,i)),n.baseColorFactor=Gue(Xe,a.baseColorFactor),n.metallicFactor=a.metallicFactor,n.roughnessFactor=a.roughnessFactor,o.pbrMetallicRoughness=a}return C(n.emissiveTexture)&&(o.emissiveTexture=Jue(e,t,n.emissiveTexture,i)),C(n.normalTexture)&&(o.normalTexture=Jue(e,t,n.normalTexture,i)),C(n.occlusionTexture)&&(o.occlusionTexture=Jue(e,t,n.occlusionTexture,i)),o.emissiveFactor=Gue(K,n.emissiveFactor),o.alphaMode=n.alphaMode,o.alphaCutoff=n.alphaCutoff,o.doubleSided=n.doubleSided,o}function $ue(e,t){const n=new Aue;return n.featureCount=e.featureCount,n.nullFeatureId=e.nullFeatureId,n.propertyTableId=e.propertyTable,n.setIndex=e.attribute,n.label=e.label,n.positionalLabel=t,n}function ehe(e,t,n,i){const o=new Aue,r=e.featureIds;return o.featureCount=n,o.propertyTableId=t,o.setIndex=jue(r.attribute),o.positionalLabel=i,o}function the(e,t){const n=new Tue;return n.propertyTableId=e.propertyTable,n.featureCount=e.featureCount,n.nullFeatureId=e.nullFeatureId,n.label=e.label,n.positionalLabel=t,n.offset=0,n.repeat=1,n}function nhe(e,t,n,i){const o=new Tue,r=e.featureIds;o.propertyTableId=t,o.featureCount=n,o.offset=R(r.constant,0);const s=R(r.divisor,0);return o.repeat=0===s?void 0:s,o.positionalLabel=i,o}function ihe(e,t,n,i,o){const r=new wue;r.featureCount=n.featureCount,r.nullFeatureId=n.nullFeatureId,r.propertyTableId=n.propertyTable,r.label=n.label,r.positionalLabel=o;const s=n.texture;r.textureReader=Jue(e,t,s,i,Nk.NEAREST);const a=s.channels.map((function(e){return"rgba".charAt(e)})).join("");return r.textureReader.channels=a,r}function ohe(e,t,n,i,o,r,s){const a=new wue,c=n.featureIds,l=c.texture;return a.featureCount=r,a.propertyTableId=i,a.textureReader=Jue(e,t,l,o,Nk.NEAREST),a.textureReader.channels=c.channels,a.positionalLabel=s,a}function rhe(e,t,n){const i=new Cue;for(const o in n)if(n.hasOwnProperty(o)){const r=n[o];i.attributes.push(Kue(e,t,r,o,void 0))}return i}function she(e,t,n,i,o){const r=new Eue,s=n.material;C(s)&&(r.material=Zue(e,t,t.materials[s],o));const a=R(n.extensions,R.EMPTY_OBJECT),c=a.KHR_draco_mesh_compression,l=n.attributes;if(C(l))for(const _ in l)if(l.hasOwnProperty(_)){const n=l[_];r.attributes.push(Kue(e,t,n,_,c))}const u=n.targets;if(C(u)){const n=u.length;for(let i=0;i<n;++i)r.morphTargets.push(rhe(e,t,u[i]));r.morphWeights=C(i)?i.slice():wf(new Array(n),0)}const h=n.indices;C(h)&&(r.indices=Que(e,t,h,c));const d=a.EXT_structural_metadata,f=a.EXT_mesh_features,p=a.EXT_feature_metadata,m=C(p);return C(f)?ahe(e,t,r,f,o):m&&che(e,t,r,p,o),C(d)?lhe(r,d):m&&uhe(e,r,p),r.primitiveType=n.mode,r}function ahe(e,t,n,i,o){let r;r=C(i)&&C(i.featureIds)?i.featureIds:[];for(let s=0;s<r.length;s++){const i=r[s],a=`featureId_${s}`;let c;c=C(i.texture)?ihe(e,t,i,o,a):C(i.attribute)?$ue(i,a):the(i,a),n.featureIds.push(c)}}function che(e,t,n,i,o){const r=t.extensions.EXT_feature_metadata.featureTables;let s=0;const a=i.featureIdAttributes;if(C(a)){const t=a.length;for(let i=0;i<t;++i){const t=a[i],o=t.featureTable,c=e._sortedPropertyTableIds.indexOf(o),l=r[o].count,u=`featureId_${s}`;let h;s++,h=C(t.featureIds.attribute)?ehe(t,c,l,u):nhe(t,c,l,u),n.featureIds.push(h)}}const c=i.featureIdTextures;if(C(c)){const i=c.length;for(let a=0;a<i;++a){const i=c[a],l=i.featureTable,u=e._sortedPropertyTableIds.indexOf(l),h=r[l].count,d=`featureId_${s}`;s++;const f=ohe(e,t,i,u,o,h,d);n.featureIds.push(f)}}}function lhe(e,t){C(t)&&(C(t.propertyTextures)&&(e.propertyTextureIds=t.propertyTextures),C(t.propertyAttributes)&&(e.propertyAttributeIds=t.propertyAttributes))}function uhe(e,t,n){C(n.featureTextures)&&(t.propertyTextureIds=n.featureTextures.map((function(t){return e._sortedFeatureTextureIds.indexOf(t)})))}function hhe(e,t,n,i){const o=n.EXT_mesh_gpu_instancing,r=new xue,s=o.attributes;if(C(s)){const n=C(s.ROTATION),o=C(s.TRANSLATION)&&C(t.accessors[s.TRANSLATION].min)&&C(t.accessors[s.TRANSLATION].max);for(const a in s)if(s.hasOwnProperty(a)){const c=e._loadAsTypedArray||!i.context.instancedArrays||(n||!o)&&(a===gue.TRANSLATION||a===gue.ROTATION||a===gue.SCALE)||a.indexOf(gue.FEATURE_ID)>=0,l=s[a];r.attributes.push(Xue(e,t,l,a,c))}}const a=R(o.extensions,R.EMPTY_OBJECT),c=n.EXT_instance_features,l=a.EXT_feature_metadata;return C(c)?dhe(r,c):C(l)&&fhe(t,r,l,e._sortedPropertyTableIds),r}function dhe(e,t){const n=t.featureIds;for(let i=0;i<n.length;i++){const t=n[i],o=`instanceFeatureId_${i}`;let r;r=C(t.attribute)?$ue(t,o):the(t,o),e.featureIds.push(r)}}function fhe(e,t,n,i){const o=e.extensions.EXT_feature_metadata.featureTables,r=n.featureIdAttributes;if(C(r)){const e=r.length;for(let n=0;n<e;++n){const e=r[n],s=e.featureTable,a=i.indexOf(s),c=o[s].count,l=`instanceFeatureId_${n}`;let u;u=C(e.featureIds.attribute)?ehe(e,a,c,l):nhe(e,a,c,l),t.featureIds.push(u)}}}function phe(e,t,n,i){const o=new Sue,r=n.joints,s=r.length,a=new Array(s);for(let l=0;l<s;++l)a[l]=i[r[l]];o.joints=a;const c=n.inverseBindMatrices;if(C(c)){const n=t.accessors[c],i=n.bufferView;if(C(i)){const r=Vue(e,t,i);r.promise.then((function(i){if(e.isDestroyed())return;const r=i.typedArray,a=Hue(t,n,r),c=new Array(s);for(let e=0;e<s;++e)c[e]=ft.unpack(a,16*e);o.inverseBindMatrices=c}))}}else o.inverseBindMatrices=wf(new Array(s),ft.IDENTITY);return o}function mhe(e,t,n,i,o){const r=new Iue;r.matrix=Gue(ft,n.matrix),r.translation=Gue(K,n.translation),r.rotation=Gue(il,n.rotation),r.scale=Gue(K,n.scale);const s=n.mesh;if(C(s)){const o=t.meshes[s],a=R(n.weights,o.weights),c=o.primitives,l=c.length;for(let n=0;n<l;++n)r.primitives.push(she(e,t,c[n],a,i))}const a=R(n.extensions,R.EMPTY_OBJECT),c=a.EXT_mesh_gpu_instancing;return C(c)&&(r.instances=hhe(e,t,a,o)),r}function _he(e,t,n,i){let o,r;const s=t.nodes.length,a=new Array(s);for(o=0;o<s;++o)a[o]=mhe(e,t,t.nodes[o],n,i);for(o=0;o<s;++o){const e=t.nodes[o].children;if(C(e)){const t=e.length;for(r=0;r<t;++r)a[o].children.push(a[e[r]])}}for(o=0;o<s;++o){const n=t.nodes[o].skin;C(n)&&(a[o].skin=phe(e,t,t.skins[n],a))}return a}function ghe(e,t,n,i,o){const r=new nue({gltf:t,extension:n,extensionLegacy:i,gltfResource:e._gltfResource,baseResource:e._baseResource,supportedImageFormats:o,asynchronous:e._asynchronous});return r.load(),e._structuralMetadataLoader=r,r}function yhe(e){let t;return C(e.scenes)&&C(e.scene)&&(t=e.scenes[e.scene].nodes),t=R(t,e.nodes),t=C(t)?t:[],t}function vhe(e,t){const n=new Due,i=yhe(e);return n.nodes=i.map((function(e){return t[e]})),n}function bhe(e,t,n,i){const o=R(t.extensions,R.EMPTY_OBJECT),r=o.EXT_structural_metadata,s=o.EXT_feature_metadata;if(C(s)){const t=s.featureTables,n=s.featureTextures,i=C(t)?t:[],o=C(n)?n:[];e._sortedPropertyTableIds=Object.keys(i).sort(),e._sortedFeatureTextureIds=Object.keys(o).sort()}const a=_he(e,t,n,i),c=vhe(t,a),l=new Pue,u=new Oue,h=t.asset.copyright;if(C(h)){const e=h.split(";").map((function(e){return new Tr(e.trim())}));u.credits=e}if(l.asset=u,l.scene=c,l.nodes=a,l.upAxis=e._upAxis,l.forwardAxis=e._forwardAxis,e._components=l,C(r)||C(s)){const i=ghe(e,t,r,s,n);i.promise.then((function(t){e.isDestroyed()||(l.structuralMetadata=t.structuralMetadata)}))}const d=[];d.push.apply(d,e._bufferViewLoaders),d.push.apply(d,e._geometryLoaders),C(e._structuralMetadataLoader)&&d.push(e._structuralMetadataLoader),e._incrementallyLoadTextures||d.push.apply(d,e._textureLoaders);const f=d.map((function(e){return e.promise})),p=e._textureLoaders.map((function(e){return e.promise}));Promise.all(f).then((function(){e.isDestroyed()||(e._state=Bue.PROCESSED)})).catch((function(t){e.isDestroyed()||Fue(e,t)})),Promise.all(p).then((function(){e.isDestroyed()||(e._textureState=Bue.PROCESSED)}))}function Ahe(e){const t=e._textureLoaders,n=t.length;for(let i=0;i<n;++i)Ree.unload(t[i]);e._textureLoaders.length=0}function whe(e){const t=e._bufferViewLoaders,n=t.length;for(let i=0;i<n;++i)Ree.unload(t[i]);e._bufferViewLoaders.length=0}function The(e){const t=e._geometryLoaders,n=t.length;for(let i=0;i<n;++i)Ree.unload(t[i]);e._geometryLoaders.length=0}function Che(e){C(e._structuralMetadataLoader)&&(e._structuralMetadataLoader.destroy(),e._structuralMetadataLoader=void 0)}C(Object.create)&&(Nue.prototype=Object.create(V9.prototype),Nue.prototype.constructor=Nue),Object.defineProperties(Nue.prototype,{promise:{get:function(){return this._promise.promise}},cacheKey:{get:function(){}},components:{get:function(){return this._components}},texturesLoadedPromise:{get:function(){return this._texturesLoadedPromise.promise}}}),Nue.prototype.load=function(){const e=Ree.loadGltfJson({gltfResource:this._gltfResource,baseResource:this._baseResource,typedArray:this._typedArray,gltfJson:this._gltfJson});this._gltfJsonLoader=e,this._state=Bue.LOADING,this._textureState=Bue.LOADING;const t=this;e.promise.then((function(){t.isDestroyed()||(t._state=Bue.LOADED,t._textureState=Bue.LOADED)})).catch((function(e){t.isDestroyed()||Fue(t,e)}))},Nue.prototype.process=function(e){if(D.typeOf.object("frameState",e),Oc.supportsWebP.initialized){if(this._state===Bue.LOADED){this._state=Bue.PROCESSING;const t=new yue({webp:Oc.supportsWebP(),basis:e.context.supportsBasis});let n;n=C(this._gltfJsonLoader)?this._gltfJsonLoader.gltf:this._gltfJson,bhe(this,n,t,e),C(this._gltfJsonLoader)&&this._releaseGltfJson&&(Ree.unload(this._gltfJsonLoader),this._gltfJsonLoader=void 0)}this._textureState===Bue.LOADED&&(this._textureState=Bue.PROCESSING),this._state!==Bue.PROCESSING&&this._textureState!==Bue.PROCESSING||zue(this,e),this._state===Bue.PROCESSED&&(whe(this),this._state=Bue.READY,this._promise.resolve(this)),this._textureState===Bue.PROCESSED&&(this._textureState=Bue.READY,this._texturesLoadedPromise.resolve(this))}else Oc.supportsWebP.initialize()},Nue.prototype.unload=function(){C(this._gltfJsonLoader)&&Ree.unload(this._gltfJsonLoader),this._gltfJsonLoader=void 0,Ahe(this),whe(this),The(this),Che(this),this._components=void 0};var Ehe="#if defined(HAS_NORMALS) && !defined(HAS_TANGENTS) && !defined(LIGHTING_UNLIT)\n    #ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n    #endif\n#endif\n\nczm_modelMaterial defaultModelMaterial()\n{\n    czm_modelMaterial material;\n    material.diffuse = vec3(1.0);\n    material.specular = vec3(0.04); // dielectric (non-metal)\n    material.roughness = 0.0;\n    material.occlusion = 1.0;\n    material.normalEC = vec3(0.0, 0.0, 1.0);\n    material.emissive = vec3(0.0);\n    material.alpha = 1.0;\n    return material;\n}\n\nvec4 handleAlpha(vec3 color, float alpha)\n{\n    #ifdef ALPHA_MODE_MASK\n    if (alpha < u_alphaCutoff) {\n        discard;\n    }\n    return vec4(color, 1.0);\n    #elif defined(ALPHA_MODE_BLEND)\n    return vec4(color, alpha);\n    #else // OPAQUE\n    return vec4(color, 1.0);\n    #endif\n}\n\nSelectedFeature selectedFeature;\n\nvoid main()\n{\n    #ifdef HAS_MODEL_SPLITTER\n    modelSplitterStage();\n    #endif\n\n    czm_modelMaterial material = defaultModelMaterial();\n\n    ProcessedAttributes attributes;\n    geometryStage(attributes);\n\n    FeatureIds featureIds;\n    featureIdStage(featureIds, attributes);\n\n    Metadata metadata;\n    metadataStage(metadata, attributes);\n\n    #ifdef HAS_SELECTED_FEATURE_ID\n    selectedFeatureIdStage(selectedFeature, featureIds);\n    #endif\n\n    #ifndef CUSTOM_SHADER_REPLACE_MATERIAL\n    materialStage(material, attributes, selectedFeature);\n    #endif\n\n    #ifdef HAS_CUSTOM_FRAGMENT_SHADER\n    customShaderStage(material, attributes, featureIds, metadata);\n    #endif\n\n    lightingStage(material, attributes);\n\n    #ifdef HAS_SELECTED_FEATURE_ID\n    cpuStylingStage(material, selectedFeature);\n    #endif\n\n    #ifdef HAS_MODEL_COLOR\n    modelColorStage(material);\n    #endif\n\n    vec4 color = handleAlpha(material.diffuse, material.alpha);\n\n    #ifdef HAS_CLIPPING_PLANES\n    modelClippingPlanesStage(color);\n    #endif\n\n    gl_FragColor = color;\n}\n",xhe="precision highp float;\n\nczm_modelVertexOutput defaultVertexOutput(vec3 positionMC) {\n    czm_modelVertexOutput vsOutput;\n    vsOutput.positionMC = positionMC;\n    vsOutput.pointSize = 1.0;\n    return vsOutput;\n}\n\nvoid main() \n{\n    // Initialize the attributes struct with all\n    // attributes except quantized ones.\n    ProcessedAttributes attributes;\n    initializeAttributes(attributes);\n\n    // Dequantize the quantized ones and add them to the\n    // attributes struct.\n    #ifdef USE_DEQUANTIZATION\n    dequantizationStage(attributes);\n    #endif\n\n\n    FeatureIds featureIds;\n    featureIdStage(featureIds, attributes);\n\n    #ifdef HAS_SELECTED_FEATURE_ID\n    SelectedFeature feature;\n    selectedFeatureIdStage(feature, featureIds);\n    cpuStylingStage(attributes.positionMC, feature);\n    #endif\n\n    mat4 modelView = czm_modelView;\n    mat3 normal = czm_normal;\n\n    // Update the position for this instance in place\n    #ifdef HAS_INSTANCING\n\n        // The legacy instance stage  is used when rendering I3DM models that \n        // encode instances transforms in world space, as opposed to glTF models\n        // that use EXT_mesh_gpu_instancing, where instance transforms are encoded\n        // in object space.\n        #ifdef USE_LEGACY_INSTANCING\n        mat4 instanceModelView;\n        mat3 instanceModelViewInverseTranspose;\n        \n        legacyInstancingStage(attributes.positionMC, instanceModelView, instanceModelViewInverseTranspose);\n\n        modelView = instanceModelView;\n        normal = instanceModelViewInverseTranspose;\n        #else\n        instancingStage(attributes.positionMC);\n        #endif\n\n        #ifdef USE_PICKING\n        v_pickColor = a_pickColor;\n        #endif\n\n    #endif\n\n    Metadata metadata;\n    metadataStage(metadata, attributes);\n\n    #ifdef HAS_CUSTOM_VERTEX_SHADER\n    czm_modelVertexOutput vsOutput = defaultVertexOutput(attributes.positionMC);\n    customShaderStage(vsOutput, attributes, featureIds, metadata);\n    #endif\n\n    // Compute the final position in each coordinate system needed.\n    // This also sets gl_Position.\n    geometryStage(attributes, modelView, normal);    \n\n    #ifdef PRIMITIVE_TYPE_POINTS\n        #ifdef HAS_CUSTOM_VERTEX_SHADER\n        gl_PointSize = vsOutput.pointSize;\n        #elif defined(USE_POINT_CLOUD_ATTENUATION)\n        gl_PointSize = pointCloudAttenuationStage(v_positionEC);\n        #else\n        gl_PointSize = 1.0;\n        #endif\n    #endif\n}\n";const She={ALL_OPAQUE:0,ALL_TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2,getStyleCommandsNeeded:function(e,t){return 0===t?She.ALL_OPAQUE:t===e?She.ALL_TRANSLUCENT:She.OPAQUE_AND_TRANSLUCENT}};var Ihe=Object.freeze(She);function Ohe(e,t){const n=e.shaderBuilder;n.addVertexLines([xhe]),n.addFragmentLines([Ehe]);const i=C(e.indices)?e.indices.buffer:void 0,o=new bq({context:t.context,indexBuffer:i,attributes:e.attributes}),r=e.model;r._resources.push(o);let s=e.renderStateOptions;r.opaquePass===HU.CESIUM_3D_TILE&&(s=pn(s,!0),s.stencilTest=FY.setCesium3DTileBit(),s.stencilMask=FY.CESIUM_3D_TILE_MASK),s=yV.fromCache(s);const a=n.buildShaderProgram(t.context);r._resources.push(a);const c=e.alphaOptions.pass,l=r.sceneGraph,u=ft.multiply(l.computedModelMatrix,e.transform,new ft);e.boundingSphere=nn.transform(e.boundingSphere,u,e.boundingSphere);const h=new UU({boundingVolume:e.boundingSphere,modelMatrix:u,uniformMap:e.uniformMap,renderState:s,vertexArray:o,shaderProgram:a,cull:r.cull,pass:c,count:e.count,pickId:e.pickId,instanceCount:e.instanceCount,primitiveType:e.primitiveType,debugShowBoundingVolume:r.debugShowBoundingVolume,castShadows:rj.castShadows(r.shadows),receiveShadows:rj.receiveShadows(r.shadows)}),d=e.styleCommandsNeeded,f=[];if(C(d)){const e=Dhe(h);if(c!==HU.TRANSLUCENT)switch(d){case Ihe.ALL_OPAQUE:f.push(h);break;case Ihe.ALL_TRANSLUCENT:f.push(e.translucent);break;case Ihe.OPAQUE_AND_TRANSLUCENT:f.push(h,e.translucent);break;default:throw new Je("styleCommandsNeeded is not a valid value.")}else f.push(h)}else f.push(h);return f}function Dhe(e){const t={};return t.translucent=Phe(e),t}function Phe(e){const t=UU.shallowClone(e);t.pass=HU.TRANSLUCENT;const n=pn(e.renderState,!0);return n.cull.enabled=!1,n.depthTest.enabled=!0,n.depthMask=!1,n.blending=_k.ALPHA_BLEND,t.renderState=yV.fromCache(n),t}var Rhe="vec3 proceduralIBL(\n    vec3 positionEC,\n    vec3 normalEC,\n    vec3 lightDirectionEC,\n    vec3 lightColorHdr,\n    czm_pbrParameters pbrParameters\n) {\n    vec3 v = -positionEC;\n    vec3 positionWC = vec3(czm_inverseView * vec4(positionEC, 1.0));\n    vec3 vWC = -normalize(positionWC);\n    vec3 l = normalize(lightDirectionEC);\n    vec3 n = normalEC;\n    vec3 r = normalize(czm_inverseViewRotation * normalize(reflect(v, n)));\n\n    float NdotL = clamp(dot(n, l), 0.001, 1.0);\n    float NdotV = abs(dot(n, v)) + 0.001;\n\n    // Figure out if the reflection vector hits the ellipsoid\n    float vertexRadius = length(positionWC);\n    float horizonDotNadir = 1.0 - min(1.0, czm_ellipsoidRadii.x / vertexRadius);\n    float reflectionDotNadir = dot(r, normalize(positionWC));\n    // Flipping the X vector is a cheap way to get the inverse of czm_temeToPseudoFixed, since that's a rotation about Z.\n    r.x = -r.x;\n    r = -normalize(czm_temeToPseudoFixed * r);\n    r.x = -r.x;\n\n    vec3 diffuseColor = pbrParameters.diffuseColor;\n    float roughness = pbrParameters.roughness;\n    vec3 specularColor = pbrParameters.f0;\n\n    float inverseRoughness = 1.04 - roughness;\n    inverseRoughness *= inverseRoughness;\n    vec3 sceneSkyBox = textureCube(czm_environmentMap, r).rgb * inverseRoughness;\n\n    float atmosphereHeight = 0.05;\n    float blendRegionSize = 0.1 * ((1.0 - inverseRoughness) * 8.0 + 1.1 - horizonDotNadir);\n    float blendRegionOffset = roughness * -1.0;\n    float farAboveHorizon = clamp(horizonDotNadir - blendRegionSize * 0.5 + blendRegionOffset, 1.0e-10 - blendRegionSize, 0.99999);\n    float aroundHorizon = clamp(horizonDotNadir + blendRegionSize * 0.5, 1.0e-10 - blendRegionSize, 0.99999);\n    float farBelowHorizon = clamp(horizonDotNadir + blendRegionSize * 1.5, 1.0e-10 - blendRegionSize, 0.99999);\n    float smoothstepHeight = smoothstep(0.0, atmosphereHeight, horizonDotNadir);\n    vec3 belowHorizonColor = mix(vec3(0.1, 0.15, 0.25), vec3(0.4, 0.7, 0.9), smoothstepHeight);\n    vec3 nadirColor = belowHorizonColor * 0.5;\n    vec3 aboveHorizonColor = mix(vec3(0.9, 1.0, 1.2), belowHorizonColor, roughness * 0.5);\n    vec3 blueSkyColor = mix(vec3(0.18, 0.26, 0.48), aboveHorizonColor, reflectionDotNadir * inverseRoughness * 0.5 + 0.75);\n    vec3 zenithColor = mix(blueSkyColor, sceneSkyBox, smoothstepHeight);\n    vec3 blueSkyDiffuseColor = vec3(0.7, 0.85, 0.9); \n    float diffuseIrradianceFromEarth = (1.0 - horizonDotNadir) * (reflectionDotNadir * 0.25 + 0.75) * smoothstepHeight;  \n    float diffuseIrradianceFromSky = (1.0 - smoothstepHeight) * (1.0 - (reflectionDotNadir * 0.25 + 0.25));\n    vec3 diffuseIrradiance = blueSkyDiffuseColor * clamp(diffuseIrradianceFromEarth + diffuseIrradianceFromSky, 0.0, 1.0);\n    float notDistantRough = (1.0 - horizonDotNadir * roughness * 0.8);\n    vec3 specularIrradiance = mix(zenithColor, aboveHorizonColor, smoothstep(farAboveHorizon, aroundHorizon, reflectionDotNadir) * notDistantRough);\n    specularIrradiance = mix(specularIrradiance, belowHorizonColor, smoothstep(aroundHorizon, farBelowHorizon, reflectionDotNadir) * inverseRoughness);\n    specularIrradiance = mix(specularIrradiance, nadirColor, smoothstep(farBelowHorizon, 1.0, reflectionDotNadir) * inverseRoughness);\n\n    // Luminance model from page 40 of http://silviojemma.com/public/papers/lighting/spherical-harmonic-lighting.pdf\n    #ifdef USE_SUN_LUMINANCE \n    // Angle between sun and zenith\n    float LdotZenith = clamp(dot(normalize(czm_inverseViewRotation * l), vWC), 0.001, 1.0);\n    float S = acos(LdotZenith);\n    // Angle between zenith and current pixel\n    float NdotZenith = clamp(dot(normalize(czm_inverseViewRotation * n), vWC), 0.001, 1.0);\n    // Angle between sun and current pixel\n    float gamma = acos(NdotL);\n    float numerator = ((0.91 + 10.0 * exp(-3.0 * gamma) + 0.45 * pow(NdotL, 2.0)) * (1.0 - exp(-0.32 / NdotZenith)));\n    float denominator = (0.91 + 10.0 * exp(-3.0 * S) + 0.45 * pow(LdotZenith,2.0)) * (1.0 - exp(-0.32));\n    float luminance = model_luminanceAtZenith * (numerator / denominator);\n    #endif \n\n    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;\n    vec3 iblColor = (diffuseIrradiance * diffuseColor * model_iblFactor.x) + (specularIrradiance * czm_srgbToLinear(specularColor * brdfLut.x + brdfLut.y) * model_iblFactor.y);\n    float maximumComponent = max(max(lightColorHdr.x, lightColorHdr.y), lightColorHdr.z);\n    vec3 lightColor = lightColorHdr / max(maximumComponent, 1.0);\n    iblColor *= lightColor;\n\n    #ifdef USE_SUN_LUMINANCE \n    iblColor *= luminance;\n    #endif\n\n    return iblColor;\n}\n\nvec3 textureIBL(\n    vec3 positionEC,\n    vec3 normalEC,\n    vec3 lightDirectionEC,\n    czm_pbrParameters pbrParameters\n) {\n    vec3 diffuseColor = pbrParameters.diffuseColor;\n    float roughness = pbrParameters.roughness;\n    vec3 specularColor = pbrParameters.f0;\n\n    vec3 v = -positionEC;\n    vec3 n = normalEC;\n    vec3 l = normalize(lightDirectionEC);\n    vec3 h = normalize(v + l);\n\n    float NdotV = abs(dot(n, v)) + 0.001;\n    float VdotH = clamp(dot(v, h), 0.0, 1.0);\n\n    const mat3 yUpToZUp = mat3(\n        -1.0, 0.0, 0.0,\n        0.0, 0.0, -1.0, \n        0.0, 1.0, 0.0\n    ); \n    vec3 cubeDir = normalize(yUpToZUp * model_iblReferenceFrameMatrix * normalize(reflect(-v, n))); \n\n    #ifdef DIFFUSE_IBL \n        #ifdef CUSTOM_SPHERICAL_HARMONICS\n        vec3 diffuseIrradiance = czm_sphericalHarmonics(cubeDir, model_sphericalHarmonicCoefficients); \n        #else\n        vec3 diffuseIrradiance = czm_sphericalHarmonics(cubeDir, czm_sphericalHarmonicCoefficients); \n        #endif \n    #else \n    vec3 diffuseIrradiance = vec3(0.0); \n    #endif \n\n    #ifdef SPECULAR_IBL\n    vec3 r0 = specularColor.rgb;\n    float reflectance = max(max(r0.r, r0.g), r0.b);\n    vec3 r90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));\n    vec3 F = fresnelSchlick2(r0, r90, VdotH);\n    \n    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;\n      #ifdef CUSTOM_SPECULAR_IBL \n      vec3 specularIBL = czm_sampleOctahedralProjection(model_specularEnvironmentMaps, model_specularEnvironmentMapsSize, cubeDir, roughness * model_specularEnvironmentMapsMaximumLOD, model_specularEnvironmentMapsMaximumLOD);\n      #else \n      vec3 specularIBL = czm_sampleOctahedralProjection(czm_specularEnvironmentMaps, czm_specularEnvironmentMapSize, cubeDir,  roughness * czm_specularEnvironmentMapsMaximumLOD, czm_specularEnvironmentMapsMaximumLOD);\n      #endif \n    specularIBL *= F * brdfLut.x + brdfLut.y;\n    #else \n    vec3 specularIBL = vec3(0.0); \n    #endif\n\n    return diffuseColor * diffuseIrradiance + specularColor * specularIBL;\n}\n\nvec3 imageBasedLightingStage(\n    vec3 positionEC,\n    vec3 normalEC,\n    vec3 lightDirectionEC,\n    vec3 lightColorHdr,\n    czm_pbrParameters pbrParameters\n) {\n  #if defined(DIFFUSE_IBL) || defined(SPECULAR_IBL)\n  // Environment maps were provided, use them for IBL\n  return textureIBL(\n      positionEC,\n      normalEC,\n      lightDirectionEC,\n      pbrParameters\n  );\n  #else\n  // Use the procedural IBL if there are no environment maps\n  return proceduralIBL(\n      positionEC,\n      normalEC,\n      lightDirectionEC,\n      lightColorHdr,\n      pbrParameters\n  );\n  #endif\n}";const Lhe={VERTEX:0,FRAGMENT:1,BOTH:2,includesVertexShader:function(e){return D.typeOf.number("destination",e),e===Lhe.VERTEX||e===Lhe.BOTH},includesFragmentShader:function(e){return D.typeOf.number("destination",e),e===Lhe.FRAGMENT||e===Lhe.BOTH}};var Mhe=Object.freeze(Lhe);const Bhe={name:"ImageBasedLightingPipelineStage",process:function(e,t,n){const i=t.imageBasedLighting,o=e.shaderBuilder;if(o.addDefine("USE_IBL_LIGHTING",void 0,Mhe.FRAGMENT),o.addUniform("vec2","model_iblFactor",Mhe.FRAGMENT),JQ.isSupported(n.context)){const e=i.useSphericalHarmonics||i.useSpecularEnvironmentMaps||i.enabled;e&&o.addUniform("mat3","model_iblReferenceFrameMatrix",Mhe.FRAGMENT),C(i.sphericalHarmonicCoefficients)?(o.addDefine("DIFFUSE_IBL",void 0,Mhe.FRAGMENT),o.addDefine("CUSTOM_SPHERICAL_HARMONICS",void 0,Mhe.FRAGMENT),o.addUniform("vec3","model_sphericalHarmonicCoefficients[9]",Mhe.FRAGMENT)):i.useDefaultSphericalHarmonics&&o.addDefine("DIFFUSE_IBL",void 0,Mhe.FRAGMENT),C(i.specularEnvironmentMapAtlas)&&i.specularEnvironmentMapAtlas.ready?(o.addDefine("SPECULAR_IBL",void 0,Mhe.FRAGMENT),o.addDefine("CUSTOM_SPECULAR_IBL",void 0,Mhe.FRAGMENT),o.addUniform("sampler2D","model_specularEnvironmentMaps",Mhe.FRAGMENT),o.addUniform("vec2","model_specularEnvironmentMapsSize",Mhe.FRAGMENT),o.addUniform("float","model_specularEnvironmentMapsMaximumLOD",Mhe.FRAGMENT)):t.useDefaultSpecularMaps&&o.addDefine("SPECULAR_IBL",void 0,Mhe.FRAGMENT)}C(i.luminanceAtZenith)&&(o.addDefine("USE_SUN_LUMINANCE",void 0,Mhe.FRAGMENT),o.addUniform("float","model_luminanceAtZenith",Mhe.FRAGMENT)),o.addFragmentLines([Rhe]);const r={model_iblFactor:function(){return i.imageBasedLightingFactor},model_iblReferenceFrameMatrix:function(){return t._iblReferenceFrameMatrix},model_luminanceAtZenith:function(){return i.luminanceAtZenith},model_sphericalHarmonicCoefficients:function(){return i.sphericalHarmonicCoefficients},model_specularEnvironmentMaps:function(){return i.specularEnvironmentMapAtlas.texture},model_specularEnvironmentMapsSize:function(){return i.specularEnvironmentMapAtlas.texture.dimensions},model_specularEnvironmentMapsMaximumLOD:function(){return i.specularEnvironmentMapAtlas.maximumMipmapLevel}};e.uniformMap=_n(r,e.uniformMap)}};var Nhe=Bhe,Fhe="void modelColorStage(inout czm_modelMaterial material)\n{\n    material.diffuse = mix(material.diffuse, model_color.rgb, model_colorBlend);\n    float highlight = ceil(model_colorBlend);\n    material.diffuse *= mix(model_color.rgb, vec3(1.0), highlight);\n    material.alpha *= model_color.a;\n}";const zhe={name:"ModelColorPipelineStage",COLOR_UNIFORM_NAME:"model_color",COLOR_BLEND_UNIFORM_NAME:"model_colorBlend",process:function(e,t,n){const i=e.shaderBuilder;i.addDefine("HAS_MODEL_COLOR",void 0,Mhe.FRAGMENT),i.addFragmentLines([Fhe]);const o={},r=t.color,s=e.renderStateOptions;0===r.alpha?(s.colorMask={red:!1,green:!1,blue:!1,alpha:!1},s.depthMask=!1):r.alpha<1&&(e.alphaOptions.pass=HU.TRANSLUCENT,e.alphaOptions.alphaMode=x7.BLEND),i.addUniform("vec4",zhe.COLOR_UNIFORM_NAME,Mhe.FRAGMENT),o[zhe.COLOR_UNIFORM_NAME]=function(){return t.color},i.addUniform("float",zhe.COLOR_BLEND_UNIFORM_NAME,Mhe.FRAGMENT),o[zhe.COLOR_BLEND_UNIFORM_NAME]=function(){return y3.getColorBlend(t.colorBlendMode,t.colorBlendAmount)},e.uniformMap=_n(o,e.uniformMap)}};var khe=zhe;const Uhe={name:"AlphaPipelineStage",process:function(e,t,n){const i=e.alphaOptions,o=e.model;i.pass=R(i.pass,o.opaquePass);const r=e.renderStateOptions;i.pass===HU.TRANSLUCENT?r.blending=_k.ALPHA_BLEND:r.blending=_k.DISABLED;const s=e.shaderBuilder,a=e.uniformMap,c=i.alphaMode;c===x7.MASK?(s.addDefine("ALPHA_MODE_MASK",void 0,Mhe.FRAGMENT),s.addUniform("float","u_alphaCutoff",Mhe.FRAGMENT),a.u_alphaCutoff=function(){return i.alphaCutoff}):c===x7.BLEND?s.addDefine("ALPHA_MODE_BLEND",void 0,Mhe.FRAGMENT):s.addDefine("ALPHA_MODE_OPAQUE",void 0,Mhe.FRAGMENT)}};var Vhe=Uhe;const Hhe={name:"BatchTexturePipelineStage",process:function(e,t,n){const i=e.shaderBuilder,o={},r=e.model,s=r.featureTables[r.featureTableId],a=s.featuresLength;i.addUniform("int","model_featuresLength"),o.model_featuresLength=function(){return a};const c=s.batchTexture;i.addUniform("sampler2D","model_batchTexture"),o.model_batchTexture=function(){return R(c.batchTexture,c.defaultTexture)},i.addUniform("vec4","model_textureStep"),o.model_textureStep=function(){return c.textureStep},c.textureDimensions.y>1&&(i.addDefine("MULTILINE_BATCH_TEXTURE"),i.addUniform("vec2","model_textureDimensions"),o.model_textureDimensions=function(){return c.textureDimensions}),e.uniformMap=_n(o,e.uniformMap)}};var Ghe=Hhe;const Whe={MODIFY_MATERIAL:"MODIFY_MATERIAL",REPLACE_MATERIAL:"REPLACE_MATERIAL",getDefineName:function(e){return`CUSTOM_SHADER_${e}`}};var qhe=Object.freeze(Whe),jhe="void customShaderStage(\n    inout czm_modelVertexOutput vsOutput, \n    inout ProcessedAttributes attributes, \n    FeatureIds featureIds,\n    Metadata metadata\n) {\n    // VertexInput and initializeInputStruct() are dynamically generated in JS, \n    // see CustomShaderPipelineStage.js\n    VertexInput vsInput;\n    initializeInputStruct(vsInput, attributes);\n    vsInput.featureIds = featureIds;\n    vsInput.metadata = metadata;\n    vertexMain(vsInput, vsOutput);\n    attributes.positionMC = vsOutput.positionMC;\n}\n",Yhe="void customShaderStage(\n    inout czm_modelMaterial material,\n    ProcessedAttributes attributes,\n    FeatureIds featureIds,\n    Metadata metadata\n) {\n    // FragmentInput and initializeInputStruct() are dynamically generated in JS, \n    // see CustomShaderPipelineStage.js\n    FragmentInput fsInput;\n    initializeInputStruct(fsInput, attributes);\n    fsInput.featureIds = featureIds;\n    fsInput.metadata = metadata;\n    fragmentMain(fsInput, material);\n}\n";function Khe(){}Khe.getFailedLoadFunction=function(e,t,n){return function(i){let o=`Failed to load ${t}: ${n}`;C(i)&&(o+=`\n${i.message}`),e._readyPromise.reject(new Je(o))}},Khe.getNodeTransform=function(e){return C(e.matrix)?e.matrix:ft.fromTranslationQuaternionRotationScale(C(e.translation)?e.translation:K.ZERO,C(e.rotation)?e.rotation:il.IDENTITY,C(e.scale)?e.scale:K.ONE)},Khe.getAttributeBySemantic=function(e,t,n){const i=e.attributes,o=i.length;for(let r=0;r<o;++r){const e=i[r],o=!C(n)||e.setIndex===n;if(e.semantic===t&&o)return e}},Khe.getAttributeByName=function(e,t){const n=e.attributes,i=n.length;for(let o=0;o<i;++o){const e=n[o];if(e.name===t)return e}},Khe.getFeatureIdsByLabel=function(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.positionalLabel===t||i.label===t)return i}},Khe.hasQuantizedAttributes=function(e){if(!C(e))return!1;for(let t=0;t<e.length;t++){const n=e[t];if(C(n.quantization))return!0}return!1},Khe.getAttributeInfo=function(e){const t=e.semantic,n=e.setIndex;let i,o=!1;C(t)?(i=Ene.getVariableName(t,n),o=!0):(i=e.name,i=i.replace(/^_/,""),i=i.toLowerCase());const r=/^color_\d+$/.test(i),s=e.type;let a=fh.getGlslType(s);r&&(a="vec4");const c=C(e.quantization);let l;return c&&(l=r?"vec4":fh.getGlslType(e.quantization.type)),{attribute:e,isQuantized:c,variableName:i,hasSemantic:o,glslType:a,quantizedGlslType:l}};const Xhe=new K,Qhe=new K;Khe.createBoundingSphere=function(e,t,n,i){const o=Khe.getAttributeBySemantic(e,"POSITION"),r=o.max,s=o.min;let a;if(C(n)&&C(i)){const e=K.add(s,i,Qhe),t=K.add(r,n,Xhe);a=nn.fromCornerPoints(e,t)}else a=nn.fromCornerPoints(s,r);return nn.transform(a,t,a),a},Khe.correctModelMatrix=function(e,t,n,i){return i=ft.clone(e,i),t===iJ.Y?i=ft.multiplyTransformation(e,iJ.Y_UP_TO_Z_UP,i):t===iJ.X&&(i=ft.multiplyTransformation(e,iJ.X_UP_TO_Z_UP,i)),n===iJ.Z&&(i=ft.multiplyTransformation(i,iJ.Z_UP_TO_X_UP,i)),i};var Jhe="void featureIdStage(out FeatureIds featureIds, ProcessedAttributes attributes) {\n  initializeFeatureIds(featureIds, attributes);\n  initializeFeatureIdAliases(featureIds);\n}\n",Zhe="void featureIdStage(out FeatureIds featureIds, ProcessedAttributes attributes) \n{\n  initializeFeatureIds(featureIds, attributes);\n  initializeFeatureIdAliases(featureIds);\n  setFeatureIdVaryings();\n}\n";const $he={};function ede(e){e.addStruct($he.STRUCT_ID_FEATURE_IDS_VS,$he.STRUCT_NAME_FEATURE_IDS,Mhe.VERTEX),e.addStruct($he.STRUCT_ID_FEATURE_IDS_FS,$he.STRUCT_NAME_FEATURE_IDS,Mhe.FRAGMENT),e.addFunction($he.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,$he.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS,Mhe.VERTEX),e.addFunction($he.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,$he.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS,Mhe.FRAGMENT),e.addFunction($he.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS,$he.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES,Mhe.VERTEX),e.addFunction($he.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS,$he.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES,Mhe.FRAGMENT),e.addFunction($he.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,$he.FUNCTION_SIGNATURE_SET_FEATURE_ID_VARYINGS,Mhe.VERTEX)}function tde(e,t,n){const i=t.featureIds,o=t.attributes[0].count;for(let r=0;r<i.length;r++){const t=i[r],s=t.positionalLabel;if(t instanceof j7.FeatureIdAttribute)ide(e,t,s);else{const i=1;rde(e,t,s,o,i,n)}const a=t.label;C(a)&&ade(e,s,a,Mhe.BOTH)}}function nde(e,t,n){const i=t.featureIds,o=Khe.getAttributeBySemantic(t,Ene.POSITION),r=o.count;for(let s=0;s<i.length;s++){const t=i[s],o=t.positionalLabel;let a=Mhe.BOTH;t instanceof j7.FeatureIdAttribute?ode(e,t,o):t instanceof j7.FeatureIdImplicitRange?rde(e,t,o,r,void 0,n):(sde(e,t,o,s,n),a=Mhe.FRAGMENT);const c=t.label;C(c)&&ade(e,o,c,a)}}function ide(e,t,n){const i=e.shaderBuilder;i.addStructField($he.STRUCT_ID_FEATURE_IDS_VS,"int",n),i.addStructField($he.STRUCT_ID_FEATURE_IDS_FS,"int",n);const o=t.setIndex,r=n.replace(/_\d+$/,"_"),s=`a_${r}${o}`,a=`v_${r}${o}`,c=`featureIds.${n} = int(czm_round(${s}));`,l=`featureIds.${n} = int(czm_round(${a}));`;i.addFunctionLines($he.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,[c]),i.addFunctionLines($he.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[l]),i.addVarying("float",a),i.addFunctionLines($he.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,[`${a} = ${s};`])}function ode(e,t,n){const i=e.shaderBuilder;i.addStructField($he.STRUCT_ID_FEATURE_IDS_VS,"int",n),i.addStructField($he.STRUCT_ID_FEATURE_IDS_FS,"int",n);const o=t.setIndex,r=n.replace(/_\d+$/,"_"),s=[`featureIds.${n} = int(czm_round(attributes.${r}${o}));`];i.addFunctionLines($he.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,s),i.addFunctionLines($he.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,s)}function rde(e,t,n,i,o,r){cde(e,t,i,o,r);const s=e.shaderBuilder,a=`a_implicit_${n}`;s.addAttribute("float",a);const c=`v_implicit_${n}`;s.addVarying("float",c),s.addStructField($he.STRUCT_ID_FEATURE_IDS_VS,"int",n),s.addStructField($he.STRUCT_ID_FEATURE_IDS_FS,"int",n),s.addFunctionLines($he.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,[`${c} = ${a};`]),s.addFunctionLines($he.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,[`featureIds.${n} = int(czm_round(${a}));`]),s.addFunctionLines($he.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[`featureIds.${n} = int(czm_round(${c}));`])}function sde(e,t,n,i,o){const r=`u_featureIdTexture_${i}`,s=e.uniformMap,a=t.textureReader;s[r]=function(){return R(a.texture,o.context.defaultTexture)};const c=a.channels,l=e.shaderBuilder;l.addStructField($he.STRUCT_ID_FEATURE_IDS_FS,"int",n),l.addUniform("sampler2D",r,Mhe.FRAGMENT);const u=`v_texCoord_${a.texCoord}`,h=`texture2D(${r}, ${u}).${c}`,d=`featureIds.${n} = czm_unpackUint(${h});`;l.addFunctionLines($he.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[d])}function ade(e,t,n,i){const o=e.shaderBuilder,r=Mhe.includesVertexShader(i);r&&o.addStructField($he.STRUCT_ID_FEATURE_IDS_VS,"int",n),o.addStructField($he.STRUCT_ID_FEATURE_IDS_FS,"int",n);const s=[`featureIds.${n} = featureIds.${t};`];r&&o.addFunctionLines($he.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS,s),o.addFunctionLines($he.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS,s)}function cde(e,t,n,i,o){const r=e.model;let s,a;if(C(t.repeat)){const e=lde(t,n);s=hq.createVertexBuffer({context:o.context,typedArray:e,usage:lq.STATIC_DRAW}),s.vertexArrayDestroyable=!1,r._resources.push(s)}else a=[t.offset];const c={index:e.attributeIndex++,instanceDivisor:i,value:a,vertexBuffer:s,normalize:!1,componentsPerAttribute:1,componentDatatype:ih.FLOAT,strideInBytes:ih.getSizeInBytes(ih.FLOAT),offsetInBytes:0};e.attributes.push(c)}function lde(e,t){const n=e.offset,i=e.repeat,o=new Float32Array(t);for(let r=0;r<t;r++)o[r]=n+Math.floor(r/i);return o}$he.name="FeatureIdPipelineStage",$he.STRUCT_ID_FEATURE_IDS_VS="FeatureIdsVS",$he.STRUCT_ID_FEATURE_IDS_FS="FeatureIdsFS",$he.STRUCT_NAME_FEATURE_IDS="FeatureIds",$he.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS="initializeFeatureIdsVS",$he.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS="initializeFeatureIdsFS",$he.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS="initializeFeatureIdAliasesVS",$he.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS="initializeFeatureIdAliasesFS",$he.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS="void initializeFeatureIds(out FeatureIds featureIds, ProcessedAttributes attributes)",$he.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES="void initializeFeatureIdAliases(inout FeatureIds featureIds)",$he.FUNCTION_ID_SET_FEATURE_ID_VARYINGS="setFeatureIdVaryings",$he.FUNCTION_SIGNATURE_SET_FEATURE_ID_VARYINGS="void setFeatureIdVaryings()",$he.process=function(e,t,n){const i=e.shaderBuilder;ede(i);const o=e.runtimeNode.node.instances;C(o)&&tde(e,o,n),nde(e,t,n),i.addVertexLines([Zhe]),i.addFragmentLines([Jhe])};var ude=$he,hde="void metadataStage(out Metadata metadata, ProcessedAttributes attributes)\n{\n  initializeMetadata(metadata, attributes);\n}\n",dde="void metadataStage(out Metadata metadata, ProcessedAttributes attributes)\n{\n  initializeMetadata(metadata, attributes);\n  setMetadataVaryings();\n}\n";const fde={};function pde(e){e.addStruct(fde.STRUCT_ID_METADATA_VS,fde.STRUCT_NAME_METADATA,Mhe.VERTEX),e.addStruct(fde.STRUCT_ID_METADATA_FS,fde.STRUCT_NAME_METADATA,Mhe.FRAGMENT),e.addFunction(fde.FUNCTION_ID_INITIALIZE_METADATA_VS,fde.FUNCTION_SIGNATURE_INITIALIZE_METADATA,Mhe.VERTEX),e.addFunction(fde.FUNCTION_ID_INITIALIZE_METADATA_FS,fde.FUNCTION_SIGNATURE_INITIALIZE_METADATA,Mhe.FRAGMENT),e.addFunction(fde.FUNCTION_ID_SET_METADATA_VARYINGS,fde.FUNCTION_SIGNATURE_SET_METADATA_VARYINGS,Mhe.VERTEX)}function mde(e,t,n){const i=n.propertyAttributes;if(C(i))for(let o=0;o<i.length;o++){const n=i[o],r=n.properties;for(const i in r)if(r.hasOwnProperty(i)){const n=r[i],o=Khe.getAttributeByName(t,n.attribute),s=Khe.getAttributeInfo(o);_de(e,s,i,n)}}}function _de(e,t,n,i){const o=Ade(n),r=t.variableName,s=t.glslType,a=e.shaderBuilder;a.addStructField(fde.STRUCT_ID_METADATA_VS,s,o),a.addStructField(fde.STRUCT_ID_METADATA_FS,s,o);let c=`attributes.${r}`;i.hasValueTransform&&(c=bde(c,{renderResources:e,glslType:s,metadataVariable:o,shaderDestination:Mhe.BOTH,offset:i.offset,scale:i.scale}));const l=`metadata.${o} = ${c};`;a.addFunctionLines(fde.FUNCTION_ID_INITIALIZE_METADATA_VS,[l]),a.addFunctionLines(fde.FUNCTION_ID_INITIALIZE_METADATA_FS,[l])}function gde(e,t){const n=t.propertyTextures;if(C(n))for(let i=0;i<n.length;i++){const t=n[i],o=t.properties;for(const n in o)if(o.hasOwnProperty(n)){const t=o[n];t.isGpuCompatible()&&yde(e,n,t)}}}function yde(e,t,n){const i=n.textureReader,o=i.index,r=`u_propertyTexture_${o}`;e.uniformMap.hasOwnProperty(r)||vde(e,r,i);const s=Ade(t),a=n.getGlslType(),c=e.shaderBuilder;c.addStructField(fde.STRUCT_ID_METADATA_FS,a,s);const l=i.texCoord,u=`attributes.texCoord_${l}`,h=i.channels;let d=`texture2D(${r}, ${u}).${h}`;d=n.unpackInShader(d),n.hasValueTransform&&(d=bde(d,{renderResources:e,glslType:a,metadataVariable:s,shaderDestination:Mhe.FRAGMENT,offset:n.offset,scale:n.scale}));const f=`metadata.${s} = ${d};`;c.addFunctionLines(fde.FUNCTION_ID_INITIALIZE_METADATA_FS,[f])}function vde(e,t,n){const i=e.shaderBuilder;i.addUniform("sampler2D",t,Mhe.FRAGMENT);const o=e.uniformMap;o[t]=function(){return n.texture}}function bde(e,t){const n=t.metadataVariable,i=`u_${n}_offset`,o=`u_${n}_scale`,r=t.renderResources,s=r.shaderBuilder,a=t.glslType,c=t.shaderDestination;s.addUniform(a,i,c),s.addUniform(a,o,c);const l=r.uniformMap;return l[i]=function(){return t.offset},l[o]=function(){return t.scale},`czm_valueTransform(${i}, ${o}, ${e})`}function Ade(e){return e.replaceAll(/[^_a-zA-Z0-9]+/g,"_")}fde.name="MetadataPipelineStage",fde.STRUCT_ID_METADATA_VS="MetadataVS",fde.STRUCT_ID_METADATA_FS="MetadataFS",fde.STRUCT_NAME_METADATA="Metadata",fde.FUNCTION_ID_INITIALIZE_METADATA_VS="initializeMetadataVS",fde.FUNCTION_ID_INITIALIZE_METADATA_FS="initializeMetadataFS",fde.FUNCTION_SIGNATURE_INITIALIZE_METADATA="void initializeMetadata(out Metadata metadata, ProcessedAttributes attributes)",fde.FUNCTION_ID_SET_METADATA_VARYINGS="setMetadataVaryings",fde.FUNCTION_SIGNATURE_SET_METADATA_VARYINGS="void setMetadataVaryings()",fde.process=function(e,t,n){const i=e.shaderBuilder;pde(i),i.addVertexLines([dde]),i.addFragmentLines([hde]);const o=e.model.structuralMetadata;C(o)&&(mde(e,t,o),gde(e,o))};var wde=fde;const Tde={};function Cde(e){const t={};for(let n=0;n<e.length;n++){const i=e[n],o=Khe.getAttributeInfo(i);t[o.variableName]=o}return t}Tde.name="CustomShaderPipelineStage",Tde.STRUCT_ID_ATTRIBUTES_VS="AttributesVS",Tde.STRUCT_ID_ATTRIBUTES_FS="AttributesFS",Tde.STRUCT_NAME_ATTRIBUTES="Attributes",Tde.STRUCT_ID_VERTEX_INPUT="VertexInput",Tde.STRUCT_NAME_VERTEX_INPUT="VertexInput",Tde.STRUCT_ID_FRAGMENT_INPUT="FragmentInput",Tde.STRUCT_NAME_FRAGMENT_INPUT="FragmentInput",Tde.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_VS="initializeInputStructVS",Tde.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_VS="void initializeInputStruct(out VertexInput vsInput, ProcessedAttributes attributes)",Tde.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_FS="initializeInputStructFS",Tde.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_FS="void initializeInputStruct(out FragmentInput fsInput, ProcessedAttributes attributes)",Tde.process=function(e,t,n){const i=e.shaderBuilder,o=e.model.customShader;C(o.lightingModel)&&(e.lightingOptions.lightingModel=o.lightingModel);const r=e.alphaOptions;o.isTranslucent?(r.pass=HU.TRANSLUCENT,r.alphaMode=x7.BLEND):(r.pass=void 0,r.alphaMode=x7.OPAQUE);const s=Lde(o,t);if(!s.customShaderEnabled)return;if(Nde(i,o,s),s.shouldComputePositionWC&&i.addDefine("COMPUTE_POSITION_WC",void 0,Mhe.BOTH),C(o.vertexShaderText)&&i.addDefine("HAS_CUSTOM_VERTEX_SHADER",void 0,Mhe.VERTEX),C(o.fragmentShaderText)){i.addDefine("HAS_CUSTOM_FRAGMENT_SHADER",void 0,Mhe.FRAGMENT);const e=qhe.getDefineName(o.mode);i.addDefine(e,void 0,Mhe.FRAGMENT)}const a=o.uniforms;for(const l in a)if(a.hasOwnProperty(l)){const e=a[l];i.addUniform(e.type,l)}const c=o.varyings;for(const l in c)if(c.hasOwnProperty(l)){const e=c[l];i.addVarying(e,l)}e.uniformMap=_n(e.uniformMap,o.uniformMap)};const Ede={position:"vec3",normal:"vec3",tangent:"vec3",bitangent:"vec3",texCoord:"vec2",color:"vec4",joints:"ivec4",weights:"vec4"},xde={position:"vec3(0.0)",normal:"vec3(0.0, 0.0, 1.0)",tangent:"vec3(1.0, 0.0, 0.0)",bitangent:"vec3(0.0, 1.0, 0.0)",texCoord:"vec2(0.0)",color:"vec4(1.0)",joints:"ivec4(0)",weights:"vec4(0.0)"};function Sde(e){let t=e.replace(/_[0-9]+$/,"");t=t.replace(/(MC|EC)$/,"");const n=Ede[t],i=xde[t];if(C(n))return{attributeField:[n,e],value:i}}function Ide(e,t,n){const i=Rde(t,e.usedVariablesVertex.attributeSet,!1),o=i.addToShader,r=i.missingAttributes;let s,a;const c=[],l=[];for(s in o)if(o.hasOwnProperty(s)){const e=o[s],t=[e.glslType,s];c.push(t),a=`vsInput.attributes.${s} = attributes.${s};`,l.push(a)}for(let u=0;u<r.length;u++){s=r[u];const e=Sde(s);if(!C(e))return void Tde._oneTimeWarning("CustomShaderPipelineStage.incompatiblePrimitiveVS",`Primitive is missing attribute ${s}, disabling custom vertex shader`);c.push(e.attributeField),a=`vsInput.attributes.${s} = ${e.value};`,l.push(a)}n.enabled=!0,n.attributeFields=c,n.initializationLines=l}function Ode(e){const t=[],n=[],i=e.usedVariablesFragment.attributeSet;return i.hasOwnProperty("positionWC")&&(t.push(["vec3","positionWC"]),n.push("fsInput.attributes.positionWC = attributes.positionWC;")),i.hasOwnProperty("positionEC")&&(t.push(["vec3","positionEC"]),n.push("fsInput.attributes.positionEC = attributes.positionEC;")),{attributeFields:t,initializationLines:n}}function Dde(e,t,n){const i=Rde(t,e.usedVariablesFragment.attributeSet,!0),o=i.addToShader,r=i.missingAttributes;let s,a;const c=[],l=[];for(s in o)if(o.hasOwnProperty(s)){const e=o[s],t=[e.glslType,s];c.push(t),a=`fsInput.attributes.${s} = attributes.${s};`,l.push(a)}for(let h=0;h<r.length;h++){s=r[h];const e=Sde(s);if(!C(e))return void Tde._oneTimeWarning("CustomShaderPipelineStage.incompatiblePrimitiveFS",`Primitive is missing attribute ${s}, disabling custom fragment shader.`);c.push(e.attributeField),a=`fsInput.attributes.${s} = ${e.value};`,l.push(a)}const u=Ode(e);n.enabled=!0,n.attributeFields=c.concat(u.attributeFields),n.initializationLines=u.initializationLines.concat(l)}const Pde={positionWC:!0,positionEC:!0};function Rde(e,t,n){let i,o;const r={};for(o in e)if(e.hasOwnProperty(o)){const s=e[o];i=o,n&&"normalMC"===o?i="normalEC":n&&"tangentMC"===o&&(i="tangentEC"),t.hasOwnProperty(i)&&(r[i]=s)}const s=[];for(o in t)if(t.hasOwnProperty(o)){if(Pde.hasOwnProperty(o))continue;i=o,n&&"normalEC"===o?i="normalMC":n&&"tangentEC"===o&&(i="tangentMC"),e.hasOwnProperty(i)||s.push(o)}return{addToShader:r,missingAttributes:s}}function Lde(e,t){const n={enabled:!1},i={enabled:!1},o=Cde(t.attributes);C(e.vertexShaderText)&&Ide(e,o,n),C(e.fragmentShaderText)&&Dde(e,o,i);const r=e.usedVariablesFragment.attributeSet,s=r.hasOwnProperty("positionWC")&&i.enabled;return{vertexLines:n,fragmentLines:i,vertexLinesEnabled:n.enabled,fragmentLinesEnabled:i.enabled,customShaderEnabled:n.enabled||i.enabled,shouldComputePositionWC:s}}function Mde(e,t){let n,i=Tde.STRUCT_ID_ATTRIBUTES_VS;e.addStruct(i,Tde.STRUCT_NAME_ATTRIBUTES,Mhe.VERTEX);const o=t.attributeFields;for(n=0;n<o.length;n++){const t=o[n],r=t[0],s=t[1];e.addStructField(i,r,s)}i=Tde.STRUCT_ID_VERTEX_INPUT,e.addStruct(i,Tde.STRUCT_NAME_VERTEX_INPUT,Mhe.VERTEX),e.addStructField(i,Tde.STRUCT_NAME_ATTRIBUTES,"attributes"),e.addStructField(i,ude.STRUCT_NAME_FEATURE_IDS,"featureIds"),e.addStructField(i,wde.STRUCT_NAME_METADATA,"metadata");const r=Tde.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_VS;e.addFunction(r,Tde.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_VS,Mhe.VERTEX);const s=t.initializationLines;e.addFunctionLines(r,s)}function Bde(e,t){let n,i,o,r,s=Tde.STRUCT_ID_ATTRIBUTES_FS;e.addStruct(s,Tde.STRUCT_NAME_ATTRIBUTES,Mhe.FRAGMENT);const a=t.attributeFields;for(n=0;n<a.length;n++)i=a[n],o=i[0],r=i[1],e.addStructField(s,o,r);s=Tde.STRUCT_ID_FRAGMENT_INPUT,e.addStruct(s,Tde.STRUCT_NAME_FRAGMENT_INPUT,Mhe.FRAGMENT),e.addStructField(s,Tde.STRUCT_NAME_ATTRIBUTES,"attributes"),e.addStructField(s,ude.STRUCT_NAME_FEATURE_IDS,"featureIds"),e.addStructField(s,wde.STRUCT_NAME_METADATA,"metadata");const c=Tde.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_FS;e.addFunction(c,Tde.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_FS,Mhe.FRAGMENT);const l=t.initializationLines;e.addFunctionLines(c,l)}function Nde(e,t,n){const i=n.vertexLines;i.enabled&&(Mde(e,i),e.addVertexLines(["#line 0",t.vertexShaderText,jhe]));const o=n.fragmentLines;o.enabled&&(Bde(e,o),e.addFragmentLines(["#line 0",t.fragmentShaderText,Yhe]))}Tde._oneTimeWarning=CA;var Fde=Tde,zde="void filterByPassType(inout vec3 positionMC, vec4 featureColor)\n{\n    bool styleTranslucent = (featureColor.a != 1.0);\n    // Only render translucent features in the translucent pass (if the style or the original command has translucency).\n    if (czm_pass == czm_passTranslucent && !styleTranslucent && !model_commandTranslucent)\n    {\n        positionMC *= 0.0;\n    }\n    // If the current pass is not the transluceny pass and the style is not translucent, don't rendeer the feature.\n    else if (czm_pass != czm_passTranslucent && styleTranslucent)\n    {\n        positionMC *= 0.0;\n    }\n}\n\nvoid cpuStylingStage(inout vec3 positionMC, inout SelectedFeature feature)\n{\n    float show = ceil(feature.color.a);\n    positionMC *= show;\n\n    #ifdef HAS_SELECTED_FEATURE_ID_ATTRIBUTE\n    filterByPassType(positionMC, feature.color);\n    #endif\n}\n",kde="void filterByPassType(vec4 featureColor)\n{\n    bool styleTranslucent = (featureColor.a != 1.0);\n    // Only render translucent features in the translucent pass (if the style or the original command has translucency).\n    if (czm_pass == czm_passTranslucent && !styleTranslucent && !model_commandTranslucent)\n    {\n        discard;\n    }\n    // If the current pass is not the translucent pass and the style is not translucent, don't render the feature.\n    else if (czm_pass != czm_passTranslucent && styleTranslucent)\n    {\n        discard;\n    }\n}\n\nvoid cpuStylingStage(inout czm_modelMaterial material, SelectedFeature feature)\n{\n    vec4 featureColor = feature.color;\n\n    if (featureColor.a == 0.0)\n    {\n        discard;\n    }\n\n    // If a feature ID vertex attribute is used, the pass type filter is applied in the vertex shader.\n    // So, we only apply in in the fragment shader if the feature ID texture is used.\n    #ifdef HAS_SELECTED_FEATURE_ID_TEXTURE\n    filterByPassType(featureColor);\n    #endif\n\n    featureColor = czm_gammaCorrect(featureColor);\n\n    float highlight = ceil(model_colorBlend);\n    material.diffuse *= mix(featureColor.rgb, vec3(1.0), highlight);\n    material.alpha *= featureColor.a;\n}\n";const Ude={name:"CPUStylingPipelineStage",process:function(e,t,n){const i=e.model,o=e.shaderBuilder;o.addVertexLines([zde]),o.addFragmentLines([kde]),o.addDefine("USE_CPU_STYLING",void 0,Mhe.BOTH),C(i.color)||(o.addUniform("float",khe.COLOR_BLEND_UNIFORM_NAME,Mhe.FRAGMENT),e.uniformMap[khe.COLOR_BLEND_UNIFORM_NAME]=function(){return y3.getColorBlend(i.colorBlendMode,i.colorBlendAmount)}),o.addUniform("bool","model_commandTranslucent",Mhe.BOTH),e.uniformMap.model_commandTranslucent=function(){return e.alphaOptions.pass===HU.TRANSLUCENT};const r=i.featureTables[i.featureTableId],s=Ihe.getStyleCommandsNeeded(r.featuresLength,r.batchTexture.translucentFeaturesLength);s!==Ihe.ALL_OPAQUE&&(e.alphaOptions.alphaMode=x7.BLEND),e.styleCommandsNeeded=s}};var Vde=Ude;const Hde={};function Gde(e,t){const n=e.shaderBuilder,i=e.uniformMap,o=t.variableName,r=t.attribute.quantization;if(r.octEncoded){const e=`model_normalizationRange_${o}`;n.addUniform("float",e,Mhe.VERTEX),i[e]=function(){return r.normalizationRange}}else{const e=`model_quantizedVolumeOffset_${o}`,s=`model_quantizedVolumeStepSize_${o}`,a=t.glslType;n.addUniform(a,e,Mhe.VERTEX),n.addUniform(a,s,Mhe.VERTEX);let c=r.quantizedVolumeOffset,l=r.quantizedVolumeStepSize;/^color_\d+$/.test(o)&&(c=Wde(c,0),l=Wde(l,1)),i[e]=function(){return c},i[s]=function(){return l}}}function Wde(e,t){return e instanceof Xe?e:new Xe(e.x,e.y,e.z,t)}function qde(e,t){const n=t.variableName,i=t.attribute.quantization;let o;o=i.octEncoded?jde(n,i):Yde(n),e.addFunctionLines(Hde.FUNCTION_ID_DEQUANTIZATION_STAGE_VS,[o])}function jde(e,t){const n=`attributes.${e}`,i=`a_quantized_${e}`,o=`model_normalizationRange_${e}`,r=t.octEncodedZXY?".zxy":".xyz";return`${n} = czm_octDecode(${i}, ${o})${r};`}function Yde(e){const t=`attributes.${e}`,n=`a_quantized_${e}`,i=`model_quantizedVolumeOffset_${e}`,o=`model_quantizedVolumeStepSize_${e}`;return`${t} = ${i} + ${n} * ${o};`}Hde.name="DequantizationPipelineStage",Hde.FUNCTION_ID_DEQUANTIZATION_STAGE_VS="dequantizationStage",Hde.FUNCTION_SIGNATURE_DEQUANTIZATION_STAGE_VS="void dequantizationStage(inout ProcessedAttributes attributes)",Hde.process=function(e,t){const n=e.shaderBuilder;n.addFunction(Hde.FUNCTION_ID_DEQUANTIZATION_STAGE_VS,Hde.FUNCTION_SIGNATURE_DEQUANTIZATION_STAGE_VS,Mhe.VERTEX),n.addDefine("USE_DEQUANTIZATION",void 0,Mhe.VERTEX);const i=t.attributes;for(let o=0;o<i.length;o++){const t=i[o],r=t.quantization;if(!C(r))continue;const s=Khe.getAttributeInfo(t);qde(n,s),Gde(e,s)}};var Kde=Hde,Xde="void geometryStage(out ProcessedAttributes attributes)\n{\n  attributes.positionMC = v_positionMC;\n  attributes.positionEC = v_positionEC;\n\n  #ifdef COMPUTE_POSITION_WC\n  attributes.positionWC = v_positionWC;\n  #endif\n\n  #ifdef HAS_NORMALS\n  // renormalize after interpolation\n  attributes.normalEC = normalize(v_normalEC);\n  #endif\n\n  #ifdef HAS_TANGENTS\n  attributes.tangentEC = normalize(v_tangentEC);\n  #endif\n\n  #ifdef HAS_BITANGENTS\n  attributes.bitangentEC = normalize(v_bitangentEC);\n  #endif\n\n  // Everything else is dynamically generated in GeometryPipelineStage\n  setDynamicVaryings(attributes);\n}\n",Qde="void geometryStage(inout ProcessedAttributes attributes, mat4 modelView, mat3 normal) \n{\n    // Compute positions in different coordinate systems\n    vec3 positionMC = attributes.positionMC;\n    v_positionMC = positionMC;\n    v_positionEC = (modelView * vec4(positionMC, 1.0)).xyz;\n    gl_Position = czm_projection * vec4(v_positionEC, 1.0);\n\n    // Sometimes the fragment shader needs this (e.g. custom shaders)\n    #ifdef COMPUTE_POSITION_WC\n    // Note that this is a 32-bit position which may result in jitter on small\n    // scales.\n    v_positionWC = (czm_model * vec4(positionMC, 1.0)).xyz;\n    #endif\n\n    #ifdef HAS_NORMALS\n    v_normalEC = normal * attributes.normalMC;\n    #endif\n\n    #ifdef HAS_TANGENTS\n    v_tangentEC = normalize(normal * attributes.tangentMC);    \n    #endif\n\n    #ifdef HAS_BITANGENTS\n    v_bitangentEC = normalize(normal * attributes.bitangentMC);\n    #endif\n\n    // All other varyings need to be dynamically generated in\n    // GeometryPipelineStage\n    setDynamicVaryings(attributes);\n}\n",Jde="vec2 computeSt(float featureId)\n{\n    float stepX = model_textureStep.x;\n    float centerX = model_textureStep.y;\n\n    #ifdef MULTILINE_BATCH_TEXTURE\n    float stepY = model_textureStep.z;\n    float centerY = model_textureStep.w;\n\n    float xId = mod(featureId, model_textureDimensions.x); \n    float yId = floor(featureId / model_textureDimensions.x);\n    \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY));\n    #else\n    return vec2(centerX + (featureId * stepX), 0.5);\n    #endif\n}\n\nvoid selectedFeatureIdStage(out SelectedFeature feature, FeatureIds featureIds)\n{   \n    int featureId = featureIds.SELECTED_FEATURE_ID;\n\n\n    if (featureId < model_featuresLength)\n    {\n        vec2 featureSt = computeSt(float(featureId));\n\n        feature.id = featureId;\n        feature.st = featureSt;\n        feature.color = texture2D(model_batchTexture, featureSt);\n    }\n    // Floating point comparisons can be unreliable in GLSL, so we\n    // increment the feature ID to make sure it's always greater\n    // then the model_featuresLength - a condition we check for in the\n    // pick ID, to avoid sampling the pick texture if the feature ID is\n    // greater than the number of features.\n    else\n    {\n        feature.id = model_featuresLength + 1;\n        feature.st = vec2(0.0);\n        feature.color = vec4(1.0);\n    }\n\n    #ifdef HAS_NULL_FEATURE_ID\n    if (featureId == model_nullFeatureId) {\n        feature.id = featureId;\n        feature.st = vec2(0.0);\n        feature.color = vec4(1.0);\n    }\n    #endif\n}\n";const Zde={};function $de(e){return e instanceof j7.FeatureIdTexture?"HAS_SELECTED_FEATURE_ID_TEXTURE":"HAS_SELECTED_FEATURE_ID_ATTRIBUTE"}function efe(e){return e instanceof j7.FeatureIdTexture?Mhe.FRAGMENT:Mhe.BOTH}function tfe(e,t,n){let i,o;return C(t.instances)&&(o=Khe.getFeatureIdsByLabel(t.instances.featureIds,e.instanceFeatureIdLabel),C(o))?(i=R(o.label,o.positionalLabel),{featureIds:o,variableName:i,shaderDestination:efe(o),featureIdDefine:$de(o)}):(o=Khe.getFeatureIdsByLabel(n.featureIds,e.featureIdLabel),i=R(o.label,o.positionalLabel),{featureIds:o,variableName:i,shaderDestination:efe(o),featureIdDefine:$de(o)})}function nfe(e){e.addStructField(Zde.STRUCT_ID_SELECTED_FEATURE,"int","id"),e.addStructField(Zde.STRUCT_ID_SELECTED_FEATURE,"vec2","st"),e.addStructField(Zde.STRUCT_ID_SELECTED_FEATURE,"vec4","color")}Zde.name="SelectedFeatureIdPipelineStage",Zde.STRUCT_ID_SELECTED_FEATURE="SelectedFeature",Zde.STRUCT_NAME_SELECTED_FEATURE="SelectedFeature",Zde.FUNCTION_ID_FEATURE_VARYINGS_VS="updateFeatureStructVS",Zde.FUNCTION_ID_FEATURE_VARYINGS_FS="updateFeatureStructFS",Zde.FUNCTION_SIGNATURE_UPDATE_FEATURE="void updateFeatureStruct(inout SelectedFeature feature)",Zde.process=function(e,t,n){const i=e.shaderBuilder;e.hasPropertyTable=!0;const o=e.model,r=e.runtimeNode.node,s=tfe(o,r,t),a=s.shaderDestination;i.addDefine("HAS_SELECTED_FEATURE_ID",void 0,a),i.addDefine("SELECTED_FEATURE_ID",s.variableName,a),i.addDefine(s.featureIdDefine,void 0,a),nfe(i);const c=s.featureIds.nullFeatureId,l=e.uniformMap;C(c)&&(i.addDefine("HAS_NULL_FEATURE_ID",void 0,a),i.addUniform("int","model_nullFeatureId",a),l.model_nullFeatureId=function(){return c}),s.shaderDestination===Mhe.BOTH&&i.addVertexLines([Jde]),i.addFragmentLines([Jde])};var ife=Zde;const ofe={GLTF:"GLTF",TILE_GLTF:"TILE_GLTF",TILE_B3DM:"B3DM",TILE_I3DM:"I3DM",TILE_PNTS:"PNTS",is3DTiles:function(e){switch(D.typeOf.string("modelType",e),e){case ofe.TILE_GLTF:case ofe.TILE_B3DM:case ofe.TILE_I3DM:case ofe.TILE_PNTS:return!0;case ofe.GLTF:return!1;default:throw new x("modelType is not a valid value.")}}};var rfe=Object.freeze(ofe);const sfe={};function afe(e,t,n,i){const o=e.shaderBuilder,r=Khe.getAttributeInfo(t);i>1?ufe(e,t,n,i):lfe(e,t,n),dfe(o,r),hfe(o,r),C(t.semantic)&&cfe(o,t),ffe(o,r),pfe(o,r),mfe(o,r)}function cfe(e,t){const n=t.semantic,i=t.setIndex;switch(n){case Ene.NORMAL:e.addDefine("HAS_NORMALS");break;case Ene.TANGENT:e.addDefine("HAS_TANGENTS");break;case Ene.FEATURE_ID:e.addDefine(`HAS${n}_${i}`);break;case Ene.TEXCOORD:case Ene.COLOR:e.addDefine(`HAS_${n}_${i}`)}}function lfe(e,t,n){const i=t.quantization;let o,r;C(i)?(o=i.type,r=i.componentDatatype):(o=t.type,r=t.componentDatatype);const s=t.semantic,a=t.setIndex;s===Ene.FEATURE_ID&&a>=e.featureIdVertexAttributeSetIndex&&(e.featureIdVertexAttributeSetIndex=a+1);const c={index:n,value:C(t.buffer)?void 0:t.constant,vertexBuffer:t.buffer,componentsPerAttribute:fh.getNumberOfComponents(o),componentDatatype:r,offsetInBytes:t.byteOffset,strideInBytes:t.byteStride,normalize:t.normalized};e.attributes.push(c)}function ufe(e,t,n,i){const o=t.quantization;let r,s;C(o)?(r=o.type,s=o.componentDatatype):(r=t.type,s=t.componentDatatype);const a=t.normalized,c=fh.getNumberOfComponents(r),l=c/i,u=ih.getSizeInBytes(s),h=l*u,d=t.byteStride;for(let f=0;f<i;f++){const i=t.byteOffset+f*h,o={index:n+f,vertexBuffer:t.buffer,componentsPerAttribute:l,componentDatatype:s,offsetInBytes:i,strideInBytes:d,normalize:a};e.attributes.push(o)}}function hfe(e,t){const n=t.variableName;let i,o=`v_${n}`;"normalMC"===n?(o="v_normalEC",i=t.glslType):"tangentMC"===n?(i="vec3",o="v_tangentEC"):i=t.glslType,e.addVarying(i,o)}function dfe(e,t){const n=t.attribute.semantic,i=t.variableName;let o,r;t.isQuantized?(o=`a_quantized_${i}`,r=t.quantizedGlslType):(o=`a_${i}`,r=t.glslType),n===Ene.POSITION?e.setPositionAttribute(r,o):e.addAttribute(r,o)}function ffe(e,t){const n=sfe.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,i=sfe.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,o=t.variableName;"tangentMC"===o?(e.addStructField(n,"vec3","tangentMC"),e.addStructField(i,"vec3","tangentEC")):"normalMC"===o?(e.addStructField(n,"vec3","normalMC"),e.addStructField(i,"vec3","normalEC")):(e.addStructField(n,t.glslType,o),e.addStructField(i,t.glslType,o))}function pfe(e,t){if(t.isQuantized)return;const n=sfe.FUNCTION_ID_INITIALIZE_ATTRIBUTES,i=t.variableName;let o;o="tangentMC"===i?"attributes.tangentMC = a_tangentMC.xyz;":`attributes.${i} = a_${i};`,e.addFunctionLines(n,[o])}function mfe(e,t){const n=t.attribute.semantic,i=t.attribute.setIndex;if(C(n)&&!C(i))return;let o=sfe.FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS;const r=t.variableName;let s=`v_${r} = attributes.${r};`;e.addFunctionLines(o,[s]),o=sfe.FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS,s=`attributes.${r} = v_${r};`,e.addFunctionLines(o,[s])}function _fe(e,t){let n=!1,i=!1;for(let o=0;o<t.length;o++){const e=t[o];e.semantic===Ene.NORMAL?n=!0:e.semantic===Ene.TANGENT&&(i=!0)}n&&i&&(e.addDefine("HAS_BITANGENTS"),e.addFunctionLines(sfe.FUNCTION_ID_INITIALIZE_ATTRIBUTES,["attributes.bitangentMC = normalize(cross(a_normalMC, a_tangentMC.xyz) * a_tangentMC.w);"]),e.addVarying("vec3","v_bitangentEC"),e.addStructField(sfe.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,"vec3","bitangentMC"),e.addStructField(sfe.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","bitangentEC"))}sfe.name="GeometryPipelineStage",sfe.STRUCT_ID_PROCESSED_ATTRIBUTES_VS="ProcessedAttributesVS",sfe.STRUCT_ID_PROCESSED_ATTRIBUTES_FS="ProcessedAttributesFS",sfe.STRUCT_NAME_PROCESSED_ATTRIBUTES="ProcessedAttributes",sfe.FUNCTION_ID_INITIALIZE_ATTRIBUTES="initializeAttributes",sfe.FUNCTION_SIGNATURE_INITIALIZE_ATTRIBUTES="void initializeAttributes(out ProcessedAttributes attributes)",sfe.FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS="setDynamicVaryingsVS",sfe.FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS="setDynamicVaryingsFS",sfe.FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS="void setDynamicVaryings(inout ProcessedAttributes attributes)",sfe.process=function(e,t){const n=e.shaderBuilder;n.addStruct(sfe.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,"ProcessedAttributes",Mhe.VERTEX),n.addStruct(sfe.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"ProcessedAttributes",Mhe.FRAGMENT),n.addStruct(ife.STRUCT_ID_SELECTED_FEATURE,ife.STRUCT_NAME_SELECTED_FEATURE,Mhe.BOTH),n.addFunction(sfe.FUNCTION_ID_INITIALIZE_ATTRIBUTES,sfe.FUNCTION_SIGNATURE_INITIALIZE_ATTRIBUTES,Mhe.VERTEX),n.addVarying("vec3","v_positionWC"),n.addVarying("vec3","v_positionEC"),n.addStructField(sfe.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","positionWC"),n.addStructField(sfe.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","positionEC"),n.addFunction(sfe.FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS,sfe.FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS,Mhe.VERTEX),n.addFunction(sfe.FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS,sfe.FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS,Mhe.FRAGMENT);const i=e.model.type;i===rfe.TILE_PNTS&&n.addDefine("HAS_SRGB_COLOR",void 0,Mhe.FRAGMENT);for(let o=0;o<t.attributes.length;o++){const n=t.attributes[o],i=fh.getAttributeLocationCount(n.type);let r;i>1?(r=e.attributeIndex,e.attributeIndex+=i):r=n.semantic===Ene.POSITION?0:e.attributeIndex++,afe(e,n,r,i)}_fe(n,t.attributes),t.primitiveType===xf.POINTS&&n.addDefine("PRIMITIVE_TYPE_POINTS"),n.addVertexLines([Qde]),n.addFragmentLines([Xde])};var gfe=sfe,yfe="#ifdef LIGHTING_PBR\nvec3 computePbrLighting(czm_modelMaterial inputMaterial, ProcessedAttributes attributes)\n{\n    czm_pbrParameters pbrParameters;\n    pbrParameters.diffuseColor = inputMaterial.diffuse;\n    pbrParameters.f0 = inputMaterial.specular;\n    pbrParameters.roughness = inputMaterial.roughness;\n    \n    #ifdef USE_CUSTOM_LIGHT_COLOR\n    vec3 lightColorHdr = model_lightColorHdr;\n    #else\n    vec3 lightColorHdr = czm_lightColorHdr;\n    #endif\n\n    vec3 color = inputMaterial.diffuse;\n    #ifdef HAS_NORMALS\n    color = czm_pbrLighting(\n        attributes.positionEC,\n        inputMaterial.normalEC,\n        czm_lightDirectionEC,\n        lightColorHdr,\n        pbrParameters\n    );\n\n        #ifdef USE_IBL_LIGHTING\n        color += imageBasedLightingStage(\n            attributes.positionEC,\n            inputMaterial.normalEC,\n            czm_lightDirectionEC,\n            lightColorHdr,\n            pbrParameters\n        );\n        #endif\n    #endif\n\n    color *= inputMaterial.occlusion;\n    color += inputMaterial.emissive;\n\n    // In HDR mode, the frame buffer is in linear color space. The\n    // post-processing stages (see PostProcessStageCollection) will handle\n    // tonemapping. However, if HDR is not enabled, we must tonemap else large\n    // values may be clamped to 1.0\n    #ifndef HDR \n    color = czm_acesTonemapping(color);\n    #endif \n\n    return color;\n}\n#endif\n\nvoid lightingStage(inout czm_modelMaterial material, ProcessedAttributes attributes)\n{\n    // Even though the lighting will only set the diffuse color,\n    // pass all other properties so further stages have access to them.\n    vec3 color = vec3(0.0);\n\n    #ifdef LIGHTING_PBR\n    color = computePbrLighting(material, attributes);\n    #else // unlit\n    color = material.diffuse;\n    #endif\n\n    // If HDR is not enabled, the frame buffer stores sRGB colors rather than\n    // linear colors so the linear value must be converted.\n    #ifndef HDR\n    color = czm_linearToSrgb(color);\n    #endif\n\n    material.diffuse = color;\n}\n";const vfe={UNLIT:0,PBR:1};var bfe=Object.freeze(vfe);const Afe={name:"LightingPipelineStage",process:function(e,t){const n=e.model,i=e.lightingOptions,o=e.shaderBuilder;if(C(n.lightColor)){o.addDefine("USE_CUSTOM_LIGHT_COLOR",void 0,Mhe.FRAGMENT),o.addUniform("vec3","model_lightColorHdr",Mhe.FRAGMENT);const t=e.uniformMap;t.model_lightColorHdr=function(){return n.lightColor}}const r=i.lightingModel;r===bfe.PBR?o.addDefine("LIGHTING_PBR",void 0,Mhe.FRAGMENT):o.addDefine("LIGHTING_UNLIT",void 0,Mhe.FRAGMENT),o.addFragmentLines([yfe])}};var wfe=Afe,Tfe="// If the style color is white, it implies the feature has not been styled.\nbool isDefaultStyleColor(vec3 color)\n{\n    return all(greaterThan(color, vec3(1.0 - czm_epsilon3)));\n}\n\nvec3 blend(vec3 sourceColor, vec3 styleColor, float styleColorBlend)\n{\n    vec3 blendColor = mix(sourceColor, styleColor, styleColorBlend);\n    vec3 color = isDefaultStyleColor(styleColor.rgb) ? sourceColor : blendColor;\n    return color;\n}\n\nvec2 computeTextureTransform(vec2 texCoord, mat3 textureTransform)\n{\n    return vec2(textureTransform * vec3(texCoord, 1.0));\n}\n\n#ifdef HAS_NORMALS\nvec3 computeNormal(ProcessedAttributes attributes)\n{\n    // Geometry normal. This is already normalized \n    vec3 ng = attributes.normalEC;\n\n    vec3 normal = ng;\n    #ifdef HAS_NORMAL_TEXTURE\n    vec2 normalTexCoords = TEXCOORD_NORMAL;\n        #ifdef HAS_NORMAL_TEXTURE_TRANSFORM\n        normalTexCoords = computeTextureTransform(normalTexCoords, u_normalTextureTransform);\n        #endif\n\n        // If HAS_BITANGENTS is set, then HAS_TANGENTS is also set\n        #ifdef HAS_BITANGENTS\n        vec3 t = attributes.tangentEC;\n        vec3 b = attributes.bitangentEC;\n        mat3 tbn = mat3(t, b, ng);\n        vec3 n = texture2D(u_normalTexture, normalTexCoords).rgb;\n        normal = normalize(tbn * (2.0 * n - 1.0));\n        #elif defined(GL_OES_standard_derivatives)\n        // Compute tangents\n        vec3 positionEC = attributes.positionEC;\n        vec3 pos_dx = dFdx(positionEC);\n        vec3 pos_dy = dFdy(positionEC);\n        vec3 tex_dx = dFdx(vec3(normalTexCoords,0.0));\n        vec3 tex_dy = dFdy(vec3(normalTexCoords,0.0));\n        vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n        t = normalize(t - ng * dot(ng, t));\n        vec3 b = normalize(cross(ng, t));\n        mat3 tbn = mat3(t, b, ng);\n        vec3 n = texture2D(u_normalTexture, normalTexCoords).rgb;\n        normal = normalize(tbn * (2.0 * n - 1.0));\n        #endif\n    #endif\n\n    return normal;\n}\n#endif\n\nvoid materialStage(inout czm_modelMaterial material, ProcessedAttributes attributes, SelectedFeature feature)\n{\n\n    #ifdef HAS_NORMALS\n    material.normalEC = computeNormal(attributes);\n    #endif\n\n    vec4 baseColorWithAlpha = vec4(1.0);\n    // Regardless of whether we use PBR, set a base color\n    #ifdef HAS_BASE_COLOR_TEXTURE\n    vec2 baseColorTexCoords = TEXCOORD_BASE_COLOR;\n\n        #ifdef HAS_BASE_COLOR_TEXTURE_TRANSFORM\n        baseColorTexCoords = computeTextureTransform(baseColorTexCoords, u_baseColorTextureTransform);\n        #endif\n\n    baseColorWithAlpha = czm_srgbToLinear(texture2D(u_baseColorTexture, baseColorTexCoords));\n\n        #ifdef HAS_BASE_COLOR_FACTOR\n        baseColorWithAlpha *= u_baseColorFactor;\n        #endif\n    #elif defined(HAS_BASE_COLOR_FACTOR)\n    baseColorWithAlpha = u_baseColorFactor;\n    #endif\n\n    #ifdef HAS_COLOR_0\n    vec4 color = attributes.color_0;\n        // .pnts files store colors in the sRGB color space\n        #ifdef HAS_SRGB_COLOR\n        color = czm_srgbToLinear(color);\n        #endif\n    baseColorWithAlpha *= color;\n    #endif\n\n    material.diffuse = baseColorWithAlpha.rgb;\n    material.alpha = baseColorWithAlpha.a;\n\n    #ifdef USE_CPU_STYLING\n    material.diffuse = blend(material.diffuse, feature.color.rgb, model_colorBlend);\n    #endif\n\n    #ifdef HAS_OCCLUSION_TEXTURE\n    vec2 occlusionTexCoords = TEXCOORD_OCCLUSION;\n        #ifdef HAS_OCCLUSION_TEXTURE_TRANSFORM\n        occlusionTexCoords = computeTextureTransform(occlusionTexCoords, u_occlusionTextureTransform);\n        #endif\n    material.occlusion = texture2D(u_occlusionTexture, occlusionTexCoords).r;\n    #endif\n\n    #ifdef HAS_EMISSIVE_TEXTURE\n    vec2 emissiveTexCoords = TEXCOORD_EMISSIVE;\n        #ifdef HAS_EMISSIVE_TEXTURE_TRANSFORM\n        emissiveTexCoords = computeTextureTransform(emissiveTexCoords, u_emissiveTextureTransform);\n        #endif\n\n    vec3 emissive = czm_srgbToLinear(texture2D(u_emissiveTexture, emissiveTexCoords).rgb);\n        #ifdef HAS_EMISSIVE_FACTOR\n        emissive *= u_emissiveFactor;\n        #endif\n    material.emissive = emissive;\n    #elif defined(HAS_EMISSIVE_FACTOR)\n    material.emissive = u_emissiveFactor;\n    #endif\n\n    #if defined(LIGHTING_PBR) && defined(USE_SPECULAR_GLOSSINESS)\n        #ifdef HAS_SPECULAR_GLOSSINESS_TEXTURE\n        vec2 specularGlossinessTexCoords = TEXCOORD_SPECULAR_GLOSSINESS;\n          #ifdef HAS_SPECULAR_GLOSSINESS_TEXTURE_TRANSFORM\n          specularGlossinessTexCoords = computeTextureTransform(specularGlossinessTexCoords, u_specularGlossinessTextureTransform);\n          #endif\n\n        vec4 specularGlossiness = czm_srgbToLinear(texture2D(u_specularGlossinessTexture, specularGlossinessTexCoords));\n        vec3 specular = specularGlossiness.rgb;\n        float glossiness = specularGlossiness.a;\n            #ifdef HAS_SPECULAR_FACTOR\n            specular *= u_specularFactor;\n            #endif\n\n            #ifdef HAS_GLOSSINESS_FACTOR\n            glossiness *= u_glossinessFactor;\n            #endif\n        #else\n            #ifdef HAS_SPECULAR_FACTOR\n            vec3 specular = clamp(u_specularFactor, vec3(0.0), vec3(1.0));\n            #else\n            vec3 specular = vec3(1.0);\n            #endif\n\n            #ifdef HAS_GLOSSINESS_FACTOR\n            float glossiness = clamp(u_glossinessFactor, 0.0, 1.0);\n            #else\n            float glossiness = 1.0;\n            #endif\n        #endif\n\n        #ifdef HAS_DIFFUSE_TEXTURE\n        vec2 diffuseTexCoords = TEXCOORD_DIFFUSE;\n            #ifdef HAS_DIFFUSE_TEXTURE_TRANSFORM\n            diffuseTexCoords = computeTextureTransform(diffuseTexCoords, u_diffuseTextureTransform);\n            #endif\n\n        vec4 diffuse = czm_srgbToLinear(texture2D(u_diffuseTexture, diffuseTexCoords));\n            #ifdef HAS_DIFFUSE_FACTOR\n            diffuse *= u_diffuseFactor;\n            #endif\n        #elif defined(HAS_DIFFUSE_FACTOR)\n        vec4 diffuse = clamp(u_diffuseFactor, vec4(0.0), vec4(1.0));\n        #else\n        vec4 diffuse = vec4(1.0);\n        #endif\n    czm_pbrParameters parameters = czm_pbrSpecularGlossinessMaterial(\n      diffuse.rgb,\n      specular,\n      glossiness\n    );\n    material.diffuse = parameters.diffuseColor;\n    // the specular glossiness extension's alpha overrides anything set\n    // by the base material.\n    material.alpha = diffuse.a;\n    material.specular = parameters.f0;\n    material.roughness = parameters.roughness;\n    #elif defined(LIGHTING_PBR)\n        #ifdef HAS_METALLIC_ROUGHNESS_TEXTURE\n        vec2 metallicRoughnessTexCoords = TEXCOORD_METALLIC_ROUGHNESS;\n            #ifdef HAS_METALLIC_ROUGHNESS_TEXTURE_TRANSFORM\n            metallicRoughnessTexCoords = computeTextureTransform(metallicRoughnessTexCoords, u_metallicRoughnessTextureTransform);\n            #endif\n\n        vec3 metallicRoughness = texture2D(u_metallicRoughnessTexture, metallicRoughnessTexCoords).rgb;\n        float metalness = clamp(metallicRoughness.b, 0.0, 1.0);\n        float roughness = clamp(metallicRoughness.g, 0.04, 1.0);\n            #ifdef HAS_METALLIC_FACTOR\n            metalness *= u_metallicFactor;\n            #endif\n\n            #ifdef HAS_ROUGHNESS_FACTOR\n            roughness *= u_roughnessFactor;\n            #endif\n        #else\n            #ifdef HAS_METALLIC_FACTOR\n            float metalness = clamp(u_metallicFactor, 0.0, 1.0);\n            #else\n            float metalness = 1.0;\n            #endif\n\n            #ifdef HAS_ROUGHNESS_FACTOR\n            float roughness = clamp(u_roughnessFactor, 0.04, 1.0);\n            #else\n            float roughness = 1.0;\n            #endif\n        #endif\n    czm_pbrParameters parameters = czm_pbrMetallicRoughnessMaterial(\n      material.diffuse,\n      metalness,\n      roughness\n    );\n    material.diffuse = parameters.diffuseColor;\n    material.specular = parameters.f0;\n    material.roughness = parameters.roughness;\n    #endif\n}\n";const Cfe=j7.Material,Efe=j7.MetallicRoughness,xfe=j7.SpecularGlossiness,Sfe={};function Ife(e,t,n,i,o){const r=`HAS_${o}_TEXTURE_TRANSFORM`;e.addDefine(r,void 0,Mhe.FRAGMENT);const s=`${i}Transform`;e.addUniform("mat3",s,Mhe.FRAGMENT),t[s]=function(){return n.transform}}function Ofe(e,t,n,i,o,r){e.addUniform("sampler2D",i,Mhe.FRAGMENT),t[i]=function(){return R(n.texture,r)};const s=`HAS_${o}_TEXTURE`;e.addDefine(s,void 0,Mhe.FRAGMENT);const a=n.texCoord,c=`v_texCoord_${a}`,l=`TEXCOORD_${o}`;e.addDefine(l,c,Mhe.FRAGMENT);const u=n.transform;C(u)&&!ke.equals(u,ke.IDENTITY)&&Ife(e,t,n,i,o)}function Dfe(e,t,n,i,o,r){const s=e.emissiveTexture;C(s)&&Ofe(n,t,s,"u_emissiveTexture","EMISSIVE",r);const a=e.emissiveFactor;C(a)&&!K.equals(a,Cfe.DEFAULT_EMISSIVE_FACTOR)&&(n.addUniform("vec3","u_emissiveFactor",Mhe.FRAGMENT),t.u_emissiveFactor=function(){return e.emissiveFactor},n.addDefine("HAS_EMISSIVE_FACTOR",void 0,Mhe.FRAGMENT));const c=e.normalTexture;C(c)&&Ofe(n,t,c,"u_normalTexture","NORMAL",o);const l=e.occlusionTexture;C(l)&&Ofe(n,t,l,"u_occlusionTexture","OCCLUSION",i)}function Pfe(e,t,n,i){const o=e.specularGlossiness;n.addDefine("USE_SPECULAR_GLOSSINESS",void 0,Mhe.FRAGMENT);const r=o.diffuseTexture;C(r)&&Ofe(n,t,r,"u_diffuseTexture","DIFFUSE",i);const s=o.diffuseFactor;C(s)&&!Xe.equals(s,xfe.DEFAULT_DIFFUSE_FACTOR)&&(n.addUniform("vec4","u_diffuseFactor",Mhe.FRAGMENT),t.u_diffuseFactor=function(){return o.diffuseFactor},n.addDefine("HAS_DIFFUSE_FACTOR",void 0,Mhe.FRAGMENT));const a=o.specularGlossinessTexture;C(a)&&Ofe(n,t,a,"u_specularGlossinessTexture","SPECULAR_GLOSSINESS",i);const c=o.specularFactor;C(c)&&!K.equals(c,xfe.DEFAULT_SPECULAR_FACTOR)&&(n.addUniform("vec3","u_specularFactor",Mhe.FRAGMENT),t.u_specularFactor=function(){return o.specularFactor},n.addDefine("HAS_SPECULAR_FACTOR",void 0,Mhe.FRAGMENT));const l=o.glossinessFactor;C(l)&&l!==xfe.DEFAULT_GLOSSINESS_FACTOR&&(n.addUniform("float","u_glossinessFactor",Mhe.FRAGMENT),t.u_glossinessFactor=function(){return o.glossinessFactor},n.addDefine("HAS_GLOSSINESS_FACTOR",void 0,Mhe.FRAGMENT))}function Rfe(e,t,n,i){const o=e.metallicRoughness;n.addDefine("USE_METALLIC_ROUGHNESS",void 0,Mhe.FRAGMENT);const r=o.baseColorTexture;C(r)&&Ofe(n,t,r,"u_baseColorTexture","BASE_COLOR",i);const s=o.baseColorFactor;C(s)&&!Xe.equals(s,Efe.DEFAULT_BASE_COLOR_FACTOR)&&(n.addUniform("vec4","u_baseColorFactor",Mhe.FRAGMENT),t.u_baseColorFactor=function(){return o.baseColorFactor},n.addDefine("HAS_BASE_COLOR_FACTOR",void 0,Mhe.FRAGMENT));const a=o.metallicRoughnessTexture;C(a)&&Ofe(n,t,a,"u_metallicRoughnessTexture","METALLIC_ROUGHNESS",i);const c=o.metallicFactor;C(c)&&c!==Efe.DEFAULT_METALLIC_FACTOR&&(n.addUniform("float","u_metallicFactor",Mhe.FRAGMENT),t.u_metallicFactor=function(){return o.metallicFactor},n.addDefine("HAS_METALLIC_FACTOR",void 0,Mhe.FRAGMENT));const l=o.roughnessFactor;C(l)&&l!==Efe.DEFAULT_ROUGHNESS_FACTOR&&(n.addUniform("float","u_roughnessFactor",Mhe.FRAGMENT),t.u_roughnessFactor=function(){return o.roughnessFactor},n.addDefine("HAS_ROUGHNESS_FACTOR",void 0,Mhe.FRAGMENT))}Sfe.name="MaterialPipelineStage",Sfe.process=function(e,t,n){const i=t.material,o=e.uniformMap,r=e.shaderBuilder,s=n.context.defaultTexture,a=n.context.defaultNormalTexture,c=n.context.defaultEmissiveTexture;Dfe(i,o,r,s,a,c),C(i.specularGlossiness)?Pfe(i,o,r,s):Rfe(i,o,r,s);const l=Khe.getAttributeBySemantic(t,Ene.NORMAL),u=e.lightingOptions;i.unlit||!l?u.lightingModel=bfe.UNLIT:u.lightingModel=bfe.PBR;const h=e.model,d=h.backFaceCulling&&!i.doubleSided,f=C(h.color)&&h.color.alpha<1;e.renderStateOptions.cull={enabled:d&&!f};const p=e.alphaOptions;C(p.alphaMode)||(p.alphaMode=i.alphaMode,i.alphaMode===x7.BLEND?p.pass=HU.TRANSLUCENT:i.alphaMode===x7.MASK&&(p.alphaCutoff=i.alphaCutoff)),r.addFragmentLines([Tfe])},Sfe._processTexture=Ofe,Sfe._processTextureTransform=Ife;var Lfe=Sfe;const Mfe={};function Bfe(e,t){const n=e.model,i={model:n,node:e.runtimeNode,primitive:e.runtimePrimitive};let o;if(rfe.is3DTiles(n.type)){const e=n.content;o={content:e,primitive:e.tileset,detail:i}}else o={primitive:n,detail:i};return C(t)&&(o.instanceId=t),o}function Nfe(e,t,n){const i=e.model;let o,r;const s=i.featureIdLabel,a=i.instanceFeatureIdLabel;C(i.featureTableId)?o=i.featureTableId:C(n)?(r=Khe.getFeatureIdsByLabel(n.featureIds,a),o=r.propertyTableId):(r=Khe.getFeatureIdsByLabel(t.featureIds,s),o=r.propertyTableId);const c=i.featureTables[o],l=e.shaderBuilder;l.addUniform("sampler2D","model_pickTexture",Mhe.FRAGMENT);const u=c.batchTexture;e.uniformMap.model_pickTexture=function(){return R(u.pickTexture,u.defaultTexture)},e.pickId="((selectedFeature.id < int(model_featuresLength)) ? texture2D(model_pickTexture, selectedFeature.st) : vec4(0.0))"}function Ffe(e,t,n){const i=e.instanceCount,o=new Array(i),r=new Uint8Array(4*i),s=e.model,a=s._resources;for(let h=0;h<i;h++){const t=Bfe(e,h),i=n.createPickId(t);a.push(i),o[h]=i;const s=i.color;r[4*h+0]=xy.floatToByte(s.red),r[4*h+1]=xy.floatToByte(s.green),r[4*h+2]=xy.floatToByte(s.blue),r[4*h+3]=xy.floatToByte(s.alpha)}const c=hq.createVertexBuffer({context:n,typedArray:r,usage:lq.STATIC_DRAW});c.vertexArrayDestroyable=!1,a.push(c);const l={index:e.attributeIndex++,vertexBuffer:c,componentsPerAttribute:4,componentDatatype:ih.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0,instanceDivisor:1};e.attributes.push(l);const u=e.shaderBuilder;u.addDefine("USE_PICKING",void 0,Mhe.BOTH),u.addAttribute("vec4","a_pickColor"),u.addVarying("vec4","v_pickColor"),e.pickId="v_pickColor"}Mfe.name="PickingPipelineStage",Mfe.process=function(e,t,n){const i=n.context,o=e.runtimeNode,r=e.shaderBuilder,s=e.model,a=o.node.instances;if(e.hasPropertyTable)Nfe(e,t,a,i);else if(C(a))Ffe(e,a,i);else{const t=Bfe(e),n=i.createPickId(t);s._resources.push(n),r.addUniform("vec4","czm_pickColor",Mhe.FRAGMENT);const o=e.uniformMap;o.czm_pickColor=function(){return n.color},e.pickId="czm_pickColor"}};var zfe=Mfe,kfe="float pointCloudAttenuationStage(vec3 positionEC) {\n  // Variables are packed into a single vector to minimize gl.uniformXXX() calls\n  float pointSize = model_pointCloudAttenuation.x;\n  float geometricError = model_pointCloudAttenuation.y;\n  float depthMultiplier = model_pointCloudAttenuation.z;\n  float depth = -positionEC.z;\n  return min((geometricError / depth) * depthMultiplier, pointSize);\n}\n";const Ufe={name:"PointCloudAttenuationPipelineStage"},Vfe=new K;Ufe.process=function(e,t,n){const i=e.shaderBuilder;i.addVertexLines([kfe]),i.addDefine("USE_POINT_CLOUD_ATTENUATION",void 0,Mhe.VERTEX);const o=e.model,r=o.pointCloudShading;let s,a,c;rfe.is3DTiles(o.type)&&(a=!0,s=o.content,c=s.tile.refine===wne.ADD),i.addUniform("vec3","model_pointCloudAttenuation",Mhe.VERTEX),e.uniformMap.model_pointCloudAttenuation=function(){const i=Vfe;let o=1;a&&(o=c?5:s.tileset.maximumScreenSpaceError),i.x=R(r.maximumAttenuation,o),i.x*=n.pixelRatio;const l=Gfe(e,t,r,s);i.y=l*r.geometricErrorScale;const u=n.context,h=n.camera.frustum;let d;return d=n.mode===ij.SCENE2D||h instanceof jC?Number.POSITIVE_INFINITY:u.drawingBufferHeight/n.camera.frustum.sseDenominator,i.z=d,i}};const Hfe=new K;function Gfe(e,t,n,i){if(C(i)){const e=i.tile.geometricError;if(e>0)return e}if(C(n.baseResolution))return n.baseResolution;const o=Khe.getAttributeBySemantic(t,Ene.POSITION),r=o.count,s=e.runtimeNode.transform;let a=K.subtract(o.max,o.min,Hfe);a=ft.multiplyByPointAsVector(s,a,Hfe);const c=a.x*a.y*a.z,l=z.cbrt(c/r);return l}var Wfe=Ufe;function qfe(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.object("options.primitive",e.primitive),D.typeOf.object("options.node",e.node),D.typeOf.object("options.model",e.model),this.primitive=e.primitive,this.node=e.node,this.model=e.model,this.pipelineStages=[],this.drawCommands=[],this.boundingSphere=void 0,this.updateStages=[],this.configurePipeline()}function jfe(e,t,n){let i;return C(t.instances)&&(i=Khe.getFeatureIdsByLabel(t.instances.featureIds,e.instanceFeatureIdLabel),C(i))?{hasFeatureIds:!0,hasPropertyTable:C(i.propertyTableId)}:(i=Khe.getFeatureIdsByLabel(n.featureIds,e.featureIdLabel),C(i)?{hasFeatureIds:!0,hasPropertyTable:C(i.propertyTableId)}:{hasFeatureIds:!1,hasPropertyTable:!1})}qfe.prototype.configurePipeline=function(){const e=this.pipelineStages;e.length=0;const t=this.primitive,n=this.node,i=this.model,o=i.customShader,r=C(o),s=r&&C(o.fragmentShaderText),a=!s||o.mode!==qhe.REPLACE_MATERIAL,c=Khe.hasQuantizedAttributes(t.attributes),l=i.pointCloudShading,u=C(l)&&l.attenuation,h=jfe(i,n,t);e.push(gfe),u&&t.primitiveType===xf.POINTS&&e.push(Wfe),c&&e.push(Kde),a&&e.push(Lfe),e.push(ude),e.push(wde),h.hasPropertyTable&&(e.push(ife),e.push(Ghe),e.push(Vde)),r&&e.push(Fde),e.push(wfe),i.allowPicking&&e.push(zfe),e.push(Vhe)};var Yfe="mat4 getInstancingTransform()\n{\n    mat4 instancingTransform;\n\n    #ifdef HAS_INSTANCE_MATRICES\n    instancingTransform = mat4(\n        a_instancingTransformRow0.x, a_instancingTransformRow1.x, a_instancingTransformRow2.x, 0.0, // Column 1\n        a_instancingTransformRow0.y, a_instancingTransformRow1.y, a_instancingTransformRow2.y, 0.0, // Column 2\n        a_instancingTransformRow0.z, a_instancingTransformRow1.z, a_instancingTransformRow2.z, 0.0, // Column 3\n        a_instancingTransformRow0.w, a_instancingTransformRow1.w, a_instancingTransformRow2.w, 1.0  // Column 4\n    );\n    #else\n    vec3 translation = vec3(0.0, 0.0, 0.0);\n    vec3 scale = vec3(1.0, 1.0, 1.0);\n    \n        #ifdef HAS_INSTANCE_TRANSLATION\n        translation = a_instanceTranslation;\n        #endif\n        #ifdef HAS_INSTANCE_SCALE\n        scale = a_instanceScale;\n        #endif\n\n    instancingTransform = mat4(\n        scale.x, 0.0, 0.0, 0.0,\n        0.0, scale.y, 0.0, 0.0,\n        0.0, 0.0, scale.z, 0.0,\n        translation.x, translation.y, translation.z, 1.0\n    ); \n    #endif\n\n    return instancingTransform;\n}\n",Kfe="void instancingStage(inout vec3 positionMC) \n{\n    mat4 instancingTransform = getInstancingTransform();\n\n    positionMC = (instancingTransform * vec4(positionMC, 1.0)).xyz;\n}\n",Xfe="void legacyInstancingStage(inout vec3 positionMC, out mat4 instanceModelView, out mat3 instanceModelViewInverseTranspose)\n{\n    mat4 instancingTransform = getInstancingTransform();\n\n    mat4 instanceModel = instancingTransform * u_instance_nodeTransform;\n    instanceModelView = u_instance_modifiedModelView;\n    instanceModelViewInverseTranspose = mat3(u_instance_modifiedModelView * instanceModel);\n\n    positionMC = (instanceModel * vec4(positionMC, 1.0)).xyz;\n}\n";const Qfe=new ft,Jfe={name:"InstancingPipelineStage",process:function(e,t,n){const i=t.instances,o=i.attributes[0].count;let r=[];const s=e.model.sceneGraph,a=e.shaderBuilder;a.addDefine("HAS_INSTANCING"),a.addVertexLines([Yfe]);const c=Khe.getAttributeBySemantic(i,gue.TRANSLATION);let l,u;C(c)&&(l=c.max,u=c.min);const h=Khe.getAttributeBySemantic(i,gue.ROTATION);if(!C(h)&&C(l)&&C(u)){C(c)&&(r.push({index:e.attributeIndex++,vertexBuffer:c.buffer,componentsPerAttribute:fh.getNumberOfComponents(c.type),componentDatatype:c.componentDatatype,normalize:!1,offsetInBytes:c.byteOffset,strideInBytes:c.byteStride,instanceDivisor:1}),e.instancingTranslationMax=l,e.instancingTranslationMin=u,a.addDefine("HAS_INSTANCE_TRANSLATION"),a.addAttribute("vec3","a_instanceTranslation"));const t=Khe.getAttributeBySemantic(i,gue.SCALE);C(t)&&(r.push({index:e.attributeIndex++,vertexBuffer:t.buffer,componentsPerAttribute:fh.getNumberOfComponents(t.type),componentDatatype:t.componentDatatype,normalize:!1,offsetInBytes:t.byteOffset,strideInBytes:t.byteStride,instanceDivisor:1}),a.addDefine("HAS_INSTANCE_SCALE"),a.addAttribute("vec3","a_instanceScale"))}else r=ope(t,o,e,n);if(ipe(e,n,i,r),i.transformInWorldSpace){const t=e.uniformMap;a.addDefine("USE_LEGACY_INSTANCING",void 0,Mhe.VERTEX),a.addUniform("mat4","u_instance_modifiedModelView",Mhe.VERTEX),a.addUniform("mat4","u_instance_nodeTransform",Mhe.VERTEX),t.u_instance_modifiedModelView=function(){return ft.multiply(n.context.uniformState.view,s.components.transform,Qfe)},t.u_instance_nodeTransform=function(){return e.runtimeNode.axisCorrectedTransform},a.addVertexLines([Xfe])}else a.addVertexLines([Kfe]);e.instanceCount=o,e.attributes.push.apply(e.attributes,r)}},Zfe=new K,$fe=new il,epe=new K,tpe=new ft;function npe(e,t,n){const i=12,o=new Float32Array(t*i),r=Khe.getAttributeBySemantic(e,gue.TRANSLATION),s=Khe.getAttributeBySemantic(e,gue.ROTATION),a=Khe.getAttributeBySemantic(e,gue.SCALE),c=new K(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=new K(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),u=C(r),h=C(s),d=C(a),f=u?r.packedTypedArray:new Float32Array(3*t),p=h?s.packedTypedArray:new Float32Array(4*t);let m;d?m=a.packedTypedArray:(m=new Float32Array(3*t),m.fill(1));for(let _=0;_<t;_++){const e=new K(f[3*_],f[3*_+1],f[3*_+2],Zfe);K.maximumByComponent(c,e,c),K.minimumByComponent(l,e,l);const t=new il(p[4*_],p[4*_+1],p[4*_+2],h?p[4*_+3]:1,$fe),r=new K(m[3*_],m[3*_+1],m[3*_+2],epe),s=ft.fromTranslationQuaternionRotationScale(e,t,r,tpe),a=i*_;o[a+0]=s[0],o[a+1]=s[4],o[a+2]=s[8],o[a+3]=s[12],o[a+4]=s[1],o[a+5]=s[5],o[a+6]=s[9],o[a+7]=s[13],o[a+8]=s[2],o[a+9]=s[6],o[a+10]=s[10],o[a+11]=s[14],n.instancingTranslationMax=c,n.instancingTranslationMin=l}return o}function ipe(e,t,n,i){const o=n.attributes,r=e.model,s=e.shaderBuilder;for(let a=0;a<o.length;a++){const n=o[a];if(n.semantic!==gue.FEATURE_ID)continue;n.setIndex>=e.featureIdVertexAttributeSetIndex&&(e.featureIdVertexAttributeSetIndex=n.setIndex+1);const c=hq.createVertexBuffer({context:t.context,typedArray:n.packedTypedArray,usage:lq.STATIC_DRAW});c.vertexArrayDestroyable=!1,r._resources.push(c),i.push({index:e.attributeIndex++,vertexBuffer:c,componentsPerAttribute:fh.getNumberOfComponents(n.type),componentDatatype:n.componentDatatype,normalize:!1,offsetInBytes:n.byteOffset,strideInBytes:n.byteStride,instanceDivisor:1}),s.addAttribute("float",`a_instanceFeatureId_${n.setIndex}`)}}function ope(e,t,n,i){const o=npe(e.instances,t,n),r=hq.createVertexBuffer({context:i.context,typedArray:o,usage:lq.STATIC_DRAW});r.vertexArrayDestroyable=!1,n.model._resources.push(r);const s=12,a=ih.getSizeInBytes(ih.FLOAT),c=a*s,l=[{index:n.attributeIndex++,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:ih.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:c,instanceDivisor:1},{index:n.attributeIndex++,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:ih.FLOAT,normalize:!1,offsetInBytes:4*a,strideInBytes:c,instanceDivisor:1},{index:n.attributeIndex++,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:ih.FLOAT,normalize:!1,offsetInBytes:8*a,strideInBytes:c,instanceDivisor:1}],u=n.shaderBuilder;return u.addDefine("HAS_INSTANCE_MATRICES"),u.addAttribute("vec4","a_instancingTransformRow0"),u.addAttribute("vec4","a_instancingTransformRow1"),u.addAttribute("vec4","a_instancingTransformRow2"),l}Jfe._getInstanceTransformsTypedArray=npe;var rpe=Jfe;const spe={};function ape(e,t,n){let i,o;const r=ft.multiplyTransformation(n,e.transform,new ft);for(i=0;i<e.runtimePrimitives.length;i++){const n=e.runtimePrimitives[i];for(o=0;o<n.drawCommands.length;o++){const e=n.drawCommands[o];e.modelMatrix=ft.multiplyTransformation(t._computedModelMatrix,r,e.modelMatrix),e.boundingVolume=nn.transform(n.boundingSphere,e.modelMatrix,e.boundingVolume)}}if(C(e.children))for(i=0;i<e.children.length;i++){const n=t._runtimeNodes[e.children[i]];n._transformToRoot=ft.clone(r,n._transformToRoot),ape(n,t,r),n._transformDirty=!1}}spe.name="ModelMatrixUpdateStage",spe.update=function(e,t,n){e._transformDirty&&(ape(e,t,e.transformToRoot),e._transformDirty=!1)};var cpe=spe;function lpe(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.object("options.node",e.node),D.typeOf.object("options.transform",e.transform),D.typeOf.object("options.transformToRoot",e.transformToRoot),D.typeOf.object("options.sceneGraph",e.sceneGraph),D.typeOf.object("options.children",e.children);const t=e.sceneGraph,n=e.transform,i=e.transformToRoot;this._sceneGraph=t,this._children=e.children,this._node=e.node;const o=t.components;this._transform=ft.clone(n,this._transform),this._transformToRoot=ft.clone(i,this._transformToRoot),this._originalTransform=ft.clone(n,this._originalTransform),this._axisCorrectedTransform=Khe.correctModelMatrix(n,o.upAxis,o.forwardAxis,this._axisCorrectedTransform),this._transformDirty=!1,this.pipelineStages=[],this.runtimePrimitives=[],this.updateStages=[],this.configurePipeline()}function upe(){this.pass=void 0,this.alphaMode=void 0,this.alphaCutoff=void 0}function hpe(e){this.name=e,this.fields=[]}function dpe(e){this.signature=e,this.body=[]}function fpe(){this._positionAttributeLine=void 0,this._nextAttributeLocation=1,this._attributeLocations={},this._attributeLines=[],this._structs={},this._functions={},this._vertexShaderParts={defineLines:[],uniformLines:[],shaderLines:[],varyingLines:[],structIds:[],functionIds:[]},this._fragmentShaderParts={defineLines:[],uniformLines:[],shaderLines:[],varyingLines:[],structIds:[],functionIds:[]}}function ppe(e){const t=[],n=[];let i,o,r,s,a=e._vertexShaderParts.structIds;for(i=0;i<a.length;i++)o=a[i],r=e._structs[o],s=r.generateGlslLines(),t.push.apply(t,s);for(a=e._fragmentShaderParts.structIds,i=0;i<a.length;i++)o=a[i],r=e._structs[o],s=r.generateGlslLines(),n.push.apply(n,s);return{vertexLines:t,fragmentLines:n}}function mpe(e){switch(e){case"mat2":return 2;case"mat3":return 3;case"mat4":return 4;default:return 1}}function _pe(e){const t=[],n=[];let i,o,r,s,a=e._vertexShaderParts.functionIds;for(i=0;i<a.length;i++)o=a[i],r=e._functions[o],s=r.generateGlslLines(),t.push.apply(t,s);for(a=e._fragmentShaderParts.functionIds,i=0;i<a.length;i++)o=a[i],r=e._functions[o],s=r.generateGlslLines(),n.push.apply(n,s);return{vertexLines:t,fragmentLines:n}}function gpe(e){D.typeOf.object("model",e),this.shaderBuilder=new fpe,this.model=e,this.uniformMap={},this.alphaOptions=new upe,this.renderStateOptions={}}Object.defineProperties(lpe.prototype,{node:{get:function(){return this._node}},sceneGraph:{get:function(){return this._sceneGraph}},children:{get:function(){return this._children}},transform:{get:function(){return this._transform},set:function(e){ft.equals(this._transform,e)||(this._transformDirty=!0,this._transform=ft.clone(e,this._transform),this._axisCorrectedTransform=Khe.correctModelMatrix(e,this._sceneGraph.components.upAxis,this._sceneGraph.components.forwardAxis,this._axisCorrectedTransform))}},transformToRoot:{get:function(){return this._transformToRoot}},axisCorrectedTransform:{get:function(){return this._axisCorrectedTransform}},originalTransform:{get:function(){return this._originalTransform}}}),lpe.prototype.getChild=function(e){if(D.typeOf.number("index",e),e<0||e>=this.children.length)throw new x("index must be greater than or equal to 0 and less than the number of children.");return this.sceneGraph.runtimeNodes[this.children[e]]},lpe.prototype.configurePipeline=function(){const e=this.node,t=this.pipelineStages;t.length=0;const n=this.updateStages;n.length=0,C(e.instances)&&t.push(rpe),n.push(cpe)},hpe.prototype.addField=function(e,t){const n=`    ${e} ${t};`;this.fields.push(n)},hpe.prototype.generateGlslLines=function(){let e=this.fields;return 0===e.length&&(e=["    float _empty;"]),[].concat(`struct ${this.name}`,"{",e,"};")},dpe.prototype.addLines=function(e){const t=e.map((function(e){return`    ${e}`}));Array.prototype.push.apply(this.body,t)},dpe.prototype.generateGlslLines=function(){return[].concat(this.signature,"{",this.body,"}")},Object.defineProperties(fpe.prototype,{attributeLocations:{get:function(){return this._attributeLocations}}}),fpe.prototype.addDefine=function(e,t,n){D.typeOf.string("identifier",e),n=R(n,Mhe.BOTH);let i=e;C(t)&&(i+=` ${t.toString()}`),Mhe.includesVertexShader(n)&&this._vertexShaderParts.defineLines.push(i),Mhe.includesFragmentShader(n)&&this._fragmentShaderParts.defineLines.push(i)},fpe.prototype.addStruct=function(e,t,n){D.typeOf.string("structId",e),D.typeOf.string("structName",t),D.typeOf.number("destination",n),this._structs[e]=new hpe(t),Mhe.includesVertexShader(n)&&this._vertexShaderParts.structIds.push(e),Mhe.includesFragmentShader(n)&&this._fragmentShaderParts.structIds.push(e)},fpe.prototype.addStructField=function(e,t,n){D.typeOf.string("structId",e),D.typeOf.string("type",t),D.typeOf.string("identifier",n),this._structs[e].addField(t,n)},fpe.prototype.addFunction=function(e,t,n){D.typeOf.string("functionName",e),D.typeOf.string("signature",t),D.typeOf.number("destination",n),this._functions[e]=new dpe(t),Mhe.includesVertexShader(n)&&this._vertexShaderParts.functionIds.push(e),Mhe.includesFragmentShader(n)&&this._fragmentShaderParts.functionIds.push(e)},fpe.prototype.addFunctionLines=function(e,t){D.typeOf.string("functionName",e),D.typeOf.object("lines",t),this._functions[e].addLines(t)},fpe.prototype.addUniform=function(e,t,n){D.typeOf.string("type",e),D.typeOf.string("identifier",t),n=R(n,Mhe.BOTH);const i=`uniform ${e} ${t};`;Mhe.includesVertexShader(n)&&this._vertexShaderParts.uniformLines.push(i),Mhe.includesFragmentShader(n)&&this._fragmentShaderParts.uniformLines.push(i)},fpe.prototype.setPositionAttribute=function(e,t){if(D.typeOf.string("type",e),D.typeOf.string("identifier",t),C(this._positionAttributeLine))throw new x("setPositionAttribute() must be called exactly once for the attribute used for gl_Position. For other attributes, use addAttribute()");return this._positionAttributeLine=`attribute ${e} ${t};`,this._attributeLocations[t]=0,0},fpe.prototype.addAttribute=function(e,t){D.typeOf.string("type",e),D.typeOf.string("identifier",t);const n=`attribute ${e} ${t};`;this._attributeLines.push(n);const i=this._nextAttributeLocation;return this._attributeLocations[t]=i,this._nextAttributeLocation+=mpe(e),i},fpe.prototype.addVarying=function(e,t){D.typeOf.string("type",e),D.typeOf.string("identifier",t);const n=`varying ${e} ${t};`;this._vertexShaderParts.varyingLines.push(n),this._fragmentShaderParts.varyingLines.push(n)},fpe.prototype.addVertexLines=function(e){D.typeOf.object("lines",e),Array.prototype.push.apply(this._vertexShaderParts.shaderLines,e)},fpe.prototype.addFragmentLines=function(e){D.typeOf.object("lines",e),Array.prototype.push.apply(this._fragmentShaderParts.shaderLines,e)},fpe.prototype.buildShaderProgram=function(e){D.typeOf.object("context",e);const t=C(this._positionAttributeLine)?[this._positionAttributeLine]:[],n=ppe(this),i=_pe(this),o=t.concat(this._attributeLines,this._vertexShaderParts.uniformLines,this._vertexShaderParts.varyingLines,n.vertexLines,i.vertexLines,this._vertexShaderParts.shaderLines).join("\n"),r=new tq({defines:this._vertexShaderParts.defineLines,sources:[o]}),s=this._fragmentShaderParts.uniformLines.concat(this._fragmentShaderParts.varyingLines,n.fragmentLines,i.fragmentLines,this._fragmentShaderParts.shaderLines).join("\n"),a=new tq({defines:this._fragmentShaderParts.defineLines,sources:[s]});return fH.fromCache({context:e,vertexShaderSource:r,fragmentShaderSource:a,attributeLocations:this._attributeLocations})},fpe.prototype.clone=function(){return pn(this,!0)};var ype="void modelSplitterStage()\n{\n    // Don't split when rendering the shadow map, because it is rendered from\n    // the perspective of a totally different camera.\n#ifndef SHADOW_MAP\n    if (model_splitDirection < 0.0 && gl_FragCoord.x > czm_splitPosition) discard;\n    if (model_splitDirection > 0.0 && gl_FragCoord.x < czm_splitPosition) discard;\n#endif\n}\n";const vpe={name:"ModelSplitterPipelineStage",SPLIT_DIRECTION_UNIFORM_NAME:"model_splitDirection",process:function(e,t,n){const i=e.shaderBuilder;i.addDefine("HAS_MODEL_SPLITTER",void 0,Mhe.FRAGMENT),i.addFragmentLines([ype]);const o={};i.addUniform("float",vpe.SPLIT_DIRECTION_UNIFORM_NAME,Mhe.FRAGMENT),o[vpe.SPLIT_DIRECTION_UNIFORM_NAME]=function(){return t.splitDirection},e.uniformMap=_n(o,e.uniformMap)}};var bpe=vpe;function Ape(e,t){D.typeOf.object("modelRenderResources",e),D.typeOf.object("runtimeNode",t),this.model=e.model,this.shaderBuilder=e.shaderBuilder.clone(),this.uniformMap=pn(e.uniformMap),this.alphaOptions=pn(e.alphaOptions),this.renderStateOptions=pn(e.renderStateOptions),this.runtimeNode=t,this.transform=ft.multiplyTransformation(t.transformToRoot,t.transform,new ft),this.attributes=[],this.attributeIndex=1,this.featureIdVertexAttributeSetIndex=0,this.instanceCount=0,this.instancingTranslationMax=void 0,this.instancingTranslationMin=void 0}function wpe(e){e=R(e,R.EMPTY_OBJECT),this.lightingModel=R(e.lightingModel,bfe.UNLIT)}function Tpe(e,t){D.typeOf.object("nodeRenderResources",e),D.typeOf.object("runtimePrimitive",t),this.model=e.model,this.runtimeNode=e.runtimeNode,this.attributes=e.attributes.slice(),this.attributeIndex=e.attributeIndex,this.featureIdVertexAttributeSetIndex=e.featureIdVertexAttributeSetIndex,this.hasPropertyTable=!1,this.uniformMap=pn(e.uniformMap),this.alphaOptions=pn(e.alphaOptions),this.transform=e.transform,this.shaderBuilder=e.shaderBuilder.clone(),this.instanceCount=e.instanceCount,this.runtimePrimitive=t;const n=t.primitive;this.count=C(n.indices)?n.indices.count:Khe.getAttributeBySemantic(n,"POSITION").count,this.indices=n.indices,this.primitiveType=n.primitiveType,this.boundingSphere=Khe.createBoundingSphere(n,ft.IDENTITY,e.instancingTranslationMax,e.instancingTranslationMin),this.lightingOptions=new wpe,this.pickId=void 0,this.renderStateOptions=_n(e.renderStateOptions,{depthTest:{enabled:!0,func:aq.LESS_OR_EQUAL},blending:_k.DISABLED}),this.styleCommandsNeeded=void 0}var Cpe="#ifdef USE_CLIPPING_PLANES_FLOAT_TEXTURE\nvec4 getClippingPlane(\n    highp sampler2D packedClippingPlanes,\n    int clippingPlaneNumber,\n    mat4 transform\n) {\n    int pixY = clippingPlaneNumber / CLIPPING_PLANES_TEXTURE_WIDTH;\n    int pixX = clippingPlaneNumber - (pixY * CLIPPING_PLANES_TEXTURE_WIDTH);\n    float pixelWidth = 1.0 / float(CLIPPING_PLANES_TEXTURE_WIDTH);\n    float pixelHeight = 1.0 / float(CLIPPING_PLANES_TEXTURE_HEIGHT);\n    float u = (float(pixX) + 0.5) * pixelWidth; // sample from center of pixel\n    float v = (float(pixY) + 0.5) * pixelHeight;\n    vec4 plane = texture2D(packedClippingPlanes, vec2(u, v));\n    return czm_transformPlane(plane, transform);\n}\n#else\n// Handle uint8 clipping texture instead\nvec4 getClippingPlane(\n    highp sampler2D packedClippingPlanes,\n    int clippingPlaneNumber,\n    mat4 transform\n) {\n    int clippingPlaneStartIndex = clippingPlaneNumber * 2; // clipping planes are two pixels each\n    int pixY = clippingPlaneStartIndex / CLIPPING_PLANES_TEXTURE_WIDTH;\n    int pixX = clippingPlaneStartIndex - (pixY * CLIPPING_PLANES_TEXTURE_WIDTH);\n    float pixelWidth = 1.0 / float(CLIPPING_PLANES_TEXTURE_WIDTH);\n    float pixelHeight = 1.0 / float(CLIPPING_PLANES_TEXTURE_HEIGHT);\n    float u = (float(pixX) + 0.5) * pixelWidth; // sample from center of pixel\n    float v = (float(pixY) + 0.5) * pixelHeight;\n    vec4 oct32 = texture2D(packedClippingPlanes, vec2(u, v)) * 255.0;\n    vec2 oct = vec2(oct32.x * 256.0 + oct32.y, oct32.z * 256.0 + oct32.w);\n    vec4 plane;\n    plane.xyz = czm_octDecode(oct, 65535.0);\n    plane.w = czm_unpackFloat(texture2D(packedClippingPlanes, vec2(u + pixelWidth, v)));\n    return czm_transformPlane(plane, transform);\n}\n#endif\n\nfloat clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix) {\n    vec4 position = czm_windowToEyeCoordinates(fragCoord);\n    vec3 clipNormal = vec3(0.0);\n    vec3 clipPosition = vec3(0.0);\n    float pixelWidth = czm_metersPerPixel(position);\n    \n    #ifdef UNION_CLIPPING_REGIONS\n    float clipAmount; // For union planes, we want to get the min distance. So we set the initial value to the first plane distance in the loop below.\n    #else\n    float clipAmount = 0.0;\n    bool clipped = true;\n    #endif\n\n    for (int i = 0; i < CLIPPING_PLANES_LENGTH; ++i) {\n        vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);\n        clipNormal = clippingPlane.xyz;\n        clipPosition = -clippingPlane.w * clipNormal;\n        float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;\n        \n        #ifdef UNION_CLIPPING_REGIONS\n        clipAmount = czm_branchFreeTernary(i == 0, amount, min(amount, clipAmount));\n        if (amount <= 0.0) {\n            discard;\n        }\n        #else\n        clipAmount = max(amount, clipAmount);\n        clipped = clipped && (amount <= 0.0);\n        #endif\n    }\n\n    #ifndef UNION_CLIPPING_REGIONS\n    if (clipped) {\n        discard;\n    }\n    #endif\n    \n    return clipAmount;\n}\n\nvoid modelClippingPlanesStage(inout vec4 color)\n{\n    float clipDistance = clip(gl_FragCoord, model_clippingPlanes, model_clippingPlanesMatrix);\n    vec4 clippingPlanesEdgeColor = vec4(1.0);\n    clippingPlanesEdgeColor.rgb = model_clippingPlanesEdgeStyle.rgb;\n    float clippingPlanesEdgeWidth = model_clippingPlanesEdgeStyle.a;\n    \n    if (clipDistance > 0.0 && clipDistance < clippingPlanesEdgeWidth) {\n        color = clippingPlanesEdgeColor;\n    }\n}\n";const Epe={name:"ModelClippingPlanesPipelineStage"},xpe=new ro;Epe.process=function(e,t,n){const i=t.clippingPlanes,o=n.context,r=e.shaderBuilder;r.addDefine("HAS_CLIPPING_PLANES",void 0,Mhe.FRAGMENT),r.addDefine("CLIPPING_PLANES_LENGTH",i.length,Mhe.FRAGMENT),i.unionClippingRegions&&r.addDefine("UNION_CLIPPING_REGIONS",void 0,Mhe.FRAGMENT),_3.useFloatTexture(o)&&r.addDefine("USE_CLIPPING_PLANES_FLOAT_TEXTURE",void 0,Mhe.FRAGMENT);const s=_3.getTextureResolution(i,o,xpe);r.addDefine("CLIPPING_PLANES_TEXTURE_WIDTH",s.x,Mhe.FRAGMENT),r.addDefine("CLIPPING_PLANES_TEXTURE_HEIGHT",s.y,Mhe.FRAGMENT),r.addUniform("sampler2D","model_clippingPlanes",Mhe.FRAGMENT),r.addUniform("vec4","model_clippingPlanesEdgeStyle",Mhe.FRAGMENT),r.addUniform("mat4","model_clippingPlanesMatrix",Mhe.FRAGMENT),r.addFragmentLines([Cpe]);const a={model_clippingPlanes:function(){return i.texture},model_clippingPlanesEdgeStyle:function(){const e=xy.clone(i.edgeColor);return e.alpha=i.edgeWidth,e},model_clippingPlanesMatrix:function(){return t._clippingPlanesMatrix}};e.uniformMap=_n(a,e.uniformMap)};var Spe=Epe;function Ipe(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.object("options.model",e.model),D.typeOf.object("options.modelComponents",e.modelComponents),this._model=e.model,this._modelComponents=e.modelComponents,this._pipelineStages=[],this._updateStages=[],this._runtimeNodes=[],this._rootNodes=[],this._drawCommands=[],this.modelPipelineStages=[],this._boundingSphere=void 0,this._computedModelMatrix=ft.clone(ft.IDENTITY),Ope(this)}function Ope(e){const t=e._modelComponents,n=t.scene,i=e._model;e._computedModelMatrix=ft.multiplyTransformation(i.modelMatrix,t.transform,e._computedModelMatrix),e._computedModelMatrix=Khe.correctModelMatrix(e._computedModelMatrix,t.upAxis,t.forwardAxis,e._computedModelMatrix),e._computedModelMatrix=ft.multiplyByUniformScale(e._computedModelMatrix,i.computedScale,e._computedModelMatrix);const o=n.nodes,r=ft.IDENTITY;for(let s=0;s<o.length;s++){const t=n.nodes[s],i=Dpe(e,t,r);e._rootNodes.push(i)}}function Dpe(e,t,n){const i=[],o=Khe.getNodeTransform(t);let r;if(C(t.children))for(r=0;r<t.children.length;r++){const s=t.children[r],a=ft.multiplyTransformation(n,o,new ft),c=Dpe(e,s,a);i.push(c)}const s=new lpe({node:t,transform:o,transformToRoot:n,children:i,sceneGraph:e});if(C(t.primitives))for(r=0;r<t.primitives.length;r++)s.runtimePrimitives.push(new qfe({primitive:t.primitives[r],node:t,model:e._model}));return e._runtimeNodes.push(s),e._runtimeNodes.length-1}function Ppe(e,t){for(let n=0;n<e._runtimeNodes.length;n++){const i=e._runtimeNodes[n];for(let e=0;e<i.runtimePrimitives.length;e++){const n=i.runtimePrimitives[e];t(n)}}}function Rpe(e){this._model=e.model,this._featureTable=e.featureTable,this._featureId=e.featureId,this._color=void 0}function Lpe(e){const t=e.model,n=e.propertyTable;D.typeOf.object("propertyTable",n),D.typeOf.object("model",t),this._propertyTable=n,this._model=t,this._features=void 0,this._featuresLength=0,this._batchTexture=void 0,this._styleCommandsNeededDirty=!1,this._styleCommandsNeeded=Ihe.ALL_OPAQUE,Mpe(this)}function Mpe(e){const t=e._model,n=rfe.is3DTiles(t.type),i=e._propertyTable.count;if(0===i)return;let o;const r=new Array(i);if(n){const e=t.content;for(o=0;o<i;o++)r[o]=new hZ(e,o)}else for(o=0;o<i;o++)r[o]=new Rpe({model:t,featureId:o,featureTable:e});e._features=r,e._featuresLength=i,e._batchTexture=new cJ({featuresLength:i,owner:e,statistics:n?t.content.tileset.statistics:e._statistics})}Object.defineProperties(Ipe.prototype,{components:{get:function(){return this._modelComponents}},computedModelMatrix:{get:function(){return this._computedModelMatrix}},boundingSphere:{get:function(){return this._boundingSphere}}}),Ipe.prototype.buildDrawCommands=function(e){const t=this._model,n=new gpe(t);this.configurePipeline();const i=this.modelPipelineStages;let o,r,s;for(o=0;o<i.length;o++){const r=i[o];r.process(n,t,e)}const a=[];for(o=0;o<this._runtimeNodes.length;o++){const t=this._runtimeNodes[o];t.configurePipeline();const i=t.pipelineStages,c=new Ape(n,t);for(r=0;r<i.length;r++){const n=i[r];n.process(c,t.node,e)}for(r=0;r<t.runtimePrimitives.length;r++){const n=t.runtimePrimitives[r];n.configurePipeline();const i=n.pipelineStages,o=new Tpe(c,n);for(s=0;s<i.length;s++){const t=i[s];t.process(o,n.primitive,e)}n.boundingSphere=nn.clone(o.boundingSphere),a.push(n.boundingSphere);const l=Ohe(o,e);n.drawCommands=l}}this._boundingSphere=nn.fromBoundingSpheres(a),t._boundingSphere=nn.transform(this._boundingSphere,t.modelMatrix,t._boundingSphere),t._initialRadius=t._boundingSphere.radius,t._boundingSphere.radius*=t._clampedScale},Ipe.prototype.configurePipeline=function(){const e=this.modelPipelineStages;e.length=0;const t=this._model;C(t.color)&&e.push(khe),t.imageBasedLighting.enabled&&e.push(Nhe),t.isClippingEnabled()&&e.push(Spe),C(t.splitDirection)&&t.splitDirection!==T4.NONE&&e.push(bpe)},Ipe.prototype.update=function(e){let t,n,i;for(t=0;t<this._runtimeNodes.length;t++){const o=this._runtimeNodes[t];for(n=0;n<o.updateStages.length;n++){const t=o.updateStages[n];t.update(o,this,e)}for(n=0;n<o.runtimePrimitives.length;n++){const e=o.runtimePrimitives[n];for(i=0;i<e.updateStages.length;i++){const t=e.updateStages[i];t.update(e)}}}},Ipe.prototype.updateModelMatrix=function(){const e=this._model;this._computedModelMatrix=ft.multiplyTransformation(e.modelMatrix,this._modelComponents.transform,this._computedModelMatrix),this._computedModelMatrix=Khe.correctModelMatrix(this._computedModelMatrix,this._modelComponents.upAxis,this._modelComponents.forwardAxis,this._computedModelMatrix),this._computedModelMatrix=ft.multiplyByUniformScale(this._computedModelMatrix,e.computedScale,this._computedModelMatrix);const t=this._rootNodes;for(let n=0;n<t.length;n++){const e=this._runtimeNodes[t[n]];e._transformDirty=!0}},Ipe.prototype.updateBackFaceCulling=function(e){const t=this._model;Ppe(this,(function(n){for(let i=0;i<n.drawCommands.length;i++){const o=n.drawCommands[i],r=pn(o.renderState,!0),s=n.primitive.material.doubleSided,a=C(t.color)&&t.color.alpha<1;r.cull.enabled=e&&!s&&!a,o.renderState=yV.fromCache(r)}}))},Ipe.prototype.updateShadows=function(e){const t=this._model,n=rj.castShadows(t.shadows),i=rj.receiveShadows(t.shadows);Ppe(this,(function(e){for(let t=0;t<e.drawCommands.length;t++){const o=e.drawCommands[t];o.castShadows=n,o.receiveShadows=i}}))},Ipe.prototype.getDrawCommands=function(){const e=[];return Ppe(this,(function(t){e.push.apply(e,t.drawCommands)})),e},Object.defineProperties(Rpe.prototype,{show:{get:function(){return this._featureTable.getShow(this._featureId)},set:function(e){this._featureTable.setShow(this._featureId,e)}},color:{get:function(){return C(this._color)||(this._color=new xy),this._featureTable.getColor(this._featureId,this._color)},set:function(e){this._featureTable.setColor(this._featureId,e)}},primitive:{get:function(){return this._model}},featureTable:{get:function(){return this._featureTable}},featureId:{get:function(){return this._featureId}}}),Rpe.prototype.hasProperty=function(e){return this._featureTable.hasProperty(this._featureId,e)},Rpe.prototype.getProperty=function(e){return this._featureTable.getProperty(this._featureId,e)},Rpe.prototype.getPropertyInherited=function(e){return this._featureTable.hasPropertyBySemantic(this._featureId,e)?this._featureTable.getPropertyBySemantic(this._featureId,e):this._featureTable.getProperty(this._featureId,e)},Rpe.prototype.getPropertyNames=function(e){return this._featureTable.getPropertyNames(e)},Rpe.prototype.setProperty=function(e,t){return this._featureTable.setProperty(this._featureId,e,t)},Object.defineProperties(Lpe.prototype,{batchTexture:{get:function(){return this._batchTexture}},featuresLength:{get:function(){return this._featuresLength}},styleCommandsNeededDirty:{get:function(){return this._styleCommandsNeededDirty}}}),Lpe.prototype.update=function(e){this._styleCommandsNeededDirty=!1,this._batchTexture.update(void 0,e);const t=Ihe.getStyleCommandsNeeded(this._featuresLength,this._batchTexture.translucentFeaturesLength);this._styleCommandsNeeded!==t&&(this._styleCommandsNeededDirty=!0,this._styleCommandsNeeded=t)},Lpe.prototype.setShow=function(e,t){this._batchTexture.setShow(e,t)},Lpe.prototype.setAllShow=function(e){this._batchTexture.setAllShow(e)},Lpe.prototype.getShow=function(e){return this._batchTexture.getShow(e)},Lpe.prototype.setColor=function(e,t){this._batchTexture.setColor(e,t)},Lpe.prototype.setAllColor=function(e){this._batchTexture.setAllColor(e)},Lpe.prototype.getColor=function(e,t){return this._batchTexture.getColor(e,t)},Lpe.prototype.getPickColor=function(e){return this._batchTexture.getPickColor(e)},Lpe.prototype.getFeature=function(e){return this._features[e]},Lpe.prototype.hasProperty=function(e,t){return this._propertyTable.hasProperty(e,t)},Lpe.prototype.hasPropertyBySemantic=function(e,t){return this._propertyTable.hasPropertyBySemantic(e,t)},Lpe.prototype.getProperty=function(e,t){return this._propertyTable.getProperty(e,t)},Lpe.prototype.getPropertyBySemantic=function(e,t){return this._propertyTable.getPropertyBySemantic(e,t)},Lpe.prototype.getPropertyNames=function(e){return this._propertyTable.getPropertyIds(e)},Lpe.prototype.setProperty=function(e,t,n){return this._propertyTable.setProperty(e,t,n)};const Bpe=new xy;Lpe.prototype.applyStyle=function(e){if(!C(e))return this.setAllColor(cJ.DEFAULT_COLOR_VALUE),void this.setAllShow(cJ.DEFAULT_SHOW_VALUE);for(let t=0;t<this._featuresLength;t++){const n=this.getFeature(t),i=C(e.color)?R(e.color.evaluateColor(n,Bpe),cJ.DEFAULT_COLOR_VALUE):cJ.DEFAULT_COLOR_VALUE,o=C(e.show)?R(e.show.evaluate(n),cJ.DEFAULT_SHOW_VALUE):cJ.DEFAULT_SHOW_VALUE;this.setColor(t,i),this.setShow(t,o)}},Lpe.prototype.isDestroyed=function(){return!1},Lpe.prototype.destroy=function(e){this._batchTexture.destroy(),Qh(this)};const Npe={};function Fpe(e){D.typeOf.number.greaterThan("options.count",e.count,0),D.typeOf.object("options.properties",e.properties),this._count=e.count,this._properties=pn(e.properties,!0)}function zpe(e){D.typeOf.number("options.count",e.count),D.typeOf.object("options.batchTable",e.batchTable);const t=e.count,n=e.batchTable,i=e.binaryBody,o=kpe(n),r=new Fpe({count:t,properties:o.jsonProperties}),s=Gpe(o.hierarchy,i),a=uee.BATCH_TABLE_CLASS_NAME,c=Upe(t,a,o.binaryProperties,i),l=c.featureTableJson,u=new U9({count:l.count,properties:l.properties,class:c.transcodedClass,bufferViews:c.bufferViewsU8}),h=new Ule({id:0,name:"Batch Table",count:l.count,metadataTable:u,jsonMetadataTable:r,batchTableHierarchy:s});return new Jle({schema:c.transcodedSchema,propertyTables:[h],extensions:o.extensions,extras:o.extras})}function kpe(e){const t=e.HIERARCHY,n=e.extras,i=e.extensions;let o;C(t)?(zpe._deprecationWarning("batchTableHierarchyExtension","The batch table HIERARCHY property has been moved to an extension. Use extensions.3DTILES_batch_table_hierarchy instead."),o=t):C(i)&&(o=i["3DTILES_batch_table_hierarchy"]);const r={},s={};for(const a in e){if(!e.hasOwnProperty(a)||"HIERARCHY"===a||"extensions"===a||"extras"===a)continue;const t=e[a];Array.isArray(t)?r[a]=t:s[a]=t}return{binaryProperties:s,jsonProperties:r,hierarchy:o,extras:n,extensions:i}}function Upe(e,t,n,i){const o={},r={},s={};let a=0;for(const h in n){if(!n.hasOwnProperty(h))continue;if(!C(i))throw new Je(`Property ${h} requires a batch table binary.`);const t=n[h],c=bJ(t);r[h]={bufferView:a},o[h]=Vpe(t),s[a]=c.createArrayBufferView(i.buffer,i.byteOffset+t.byteOffset,e),a++}const c={classes:{}};c.classes[t]={properties:o};const l=new _ee(c),u={class:t,count:e,properties:r};return{featureTableJson:u,bufferViewsU8:s,transcodedSchema:l,transcodedClass:l.classes[t]}}function Vpe(e){const t=Hpe(e.componentType);return{type:e.type,componentType:t}}function Hpe(e){switch(e){case"BYTE":return"INT8";case"UNSIGNED_BYTE":return"UINT8";case"SHORT":return"INT16";case"UNSIGNED_SHORT":return"UINT16";case"INT":return"INT32";case"UNSIGNED_INT":return"UINT32";case"FLOAT":return"FLOAT32";case"DOUBLE":return"FLOAT64"}}function Gpe(e,t){if(C(e))return new AJ({extension:e,binaryBody:t})}Fpe.prototype.hasProperty=function(e){return q8.hasProperty(e,this._properties,Npe)},Fpe.prototype.getPropertyIds=function(e){return q8.getPropertyIds(this._properties,Npe,e)},Fpe.prototype.getProperty=function(e,t){if(D.typeOf.number("index",e),D.typeOf.string("propertyId",t),e<0||e>=this._count)throw new x(`index must be in the range [0, ${this._count})`);const n=this._properties[t];if(C(n))return pn(n[e],!0)},Fpe.prototype.setProperty=function(e,t,n){if(D.typeOf.number("index",e),D.typeOf.string("propertyId",t),e<0||e>=this._count)throw new x(`index must be in the range [0, ${this._count})`);const i=this._properties[t];return!!C(i)&&(i[e]=pn(n,!0),!0)},zpe._deprecationWarning=UF;const Wpe={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,FAILED:4},qpe=j7.FeatureIdAttribute;function jpe(e){e=R(e,R.EMPTY_OBJECT);const t=e.b3dmResource;let n=e.baseResource;const i=e.arrayBuffer,o=R(e.byteOffset,0),r=R(e.releaseGltfJson,!1),s=R(e.asynchronous,!0),a=R(e.incrementallyLoadTextures,!0),c=R(e.upAxis,iJ.Y),l=R(e.forwardAxis,iJ.X),u=R(e.loadAsTypedArray,!1);D.typeOf.object("options.b3dmResource",t),D.typeOf.object("options.arrayBuffer",i),n=C(n)?n:t.clone(),this._b3dmResource=t,this._baseResource=n,this._arrayBuffer=i,this._byteOffset=o,this._releaseGltfJson=r,this._asynchronous=s,this._incrementallyLoadTextures=a,this._upAxis=c,this._forwardAxis=l,this._loadAsTypedArray=u,this._state=Wpe.UNLOADED,this._promise=yn(),this._gltfLoader=void 0,this._batchLength=0,this._propertyTable=void 0,this._batchTable=void 0,this._components=void 0,this._transform=ft.IDENTITY}function Ype(e,t){e.unload(),e._state=Wpe.FAILED;const n="Failed to load b3dm";t=e.getError(n,t),e._promise.reject(t)}function Kpe(e,t){const n=e._batchTable,i=e._batchLength;if(0===i)return;let o;if(C(n.json))o=zpe({count:i,batchTable:n.json,binaryBody:n.binary});else{const e=new Ule({name:uee.BATCH_TABLE_CLASS_NAME,count:i});o=new Jle({schema:{},propertyTables:[e]})}const r=t.scene.nodes;for(let s=0;s<r.length;s++)Xpe(r[s]);t.structuralMetadata=o}function Xpe(e){if(!C(e.children)&&!C(e.primitives))return;let t;if(C(e.children))for(t=0;t<e.children.length;t++)Xpe(e.children[t]);if(C(e.primitives))for(t=0;t<e.primitives.length;t++){const n=e.primitives[t],i=Khe.getAttributeBySemantic(n,Ene.FEATURE_ID);if(C(i)){i.setIndex=0;const e=new qpe;e.propertyTableId=0,e.setIndex=0,e.positionalLabel="featureId_0",n.featureIds.push(e)}}}C(Object.create)&&(jpe.prototype=Object.create(V9.prototype),jpe.prototype.constructor=jpe),Object.defineProperties(jpe.prototype,{promise:{get:function(){return this._promise.promise}},texturesLoadedPromise:{get:function(){return this._gltfLoader.texturesLoadedPromise}},cacheKey:{get:function(){}},components:{get:function(){return this._components}}}),jpe.prototype.load=function(){const e=aJ.parse(this._arrayBuffer,this._byteOffset);let t=e.batchLength;const n=e.featureTableJson,i=e.featureTableBinary,o=e.batchTableJson,r=e.batchTableBinary,s=new mZ(n,i);t=s.getGlobalProperty("BATCH_LENGTH"),this._batchLength=t;const a=s.getGlobalProperty("RTC_CENTER",ih.FLOAT,3);C(a)&&(this._transform=ft.fromTranslation(K.fromArray(a))),this._batchTable={json:o,binary:r};const c=new Nue({typedArray:e.gltf,upAxis:this._upAxis,forwardAxis:this._forwardAxis,gltfResource:this._b3dmResource,baseResource:this._baseResource,releaseGltfJson:this._releaseGltfJson,incrementallyLoadTextures:this._incrementallyLoadTextures,loadAsTypedArray:this._loadAsTypedArray,renameBatchIdSemantic:!0});this._gltfLoader=c,this._state=Wpe.LOADING;const l=this;c.load(),c.promise.then((function(){if(l.isDestroyed())return;const e=c.components;e.transform=l._transform,Kpe(l,e),l._components=e,l._state=Wpe.READY,l._promise.resolve(l)})).catch((function(e){l.isDestroyed()||Ype(l,e)}))},jpe.prototype.process=function(e){D.typeOf.object("frameState",e),this._state===Wpe.LOADING&&(this._state=Wpe.PROCESSING),this._state===Wpe.PROCESSING&&this._gltfLoader.process(e)},jpe.prototype.unload=function(){C(this._gltfLoader)&&this._gltfLoader.unload(),this._components=void 0};var Qpe=jpe;const Jpe=j7.Components,Zpe=j7.Scene,$pe=j7.Node,eme=j7.Primitive,tme=j7.Attribute,nme=j7.Quantization,ime=j7.FeatureIdAttribute,ome=j7.Material,rme=j7.MetallicRoughness;function sme(e){e=R(e,R.EMPTY_OBJECT);const t=e.arrayBuffer,n=R(e.byteOffset,0);D.typeOf.object("options.arrayBuffer",t),this._arrayBuffer=t,this._byteOffset=n,this._parsedContent=void 0,this._decodePromise=void 0,this._decodedAttributes=void 0,this._promise=yn(),this._state=G9.UNLOADED,this._buffers=[],this._components=void 0,this._transform=ft.IDENTITY}function ame(e,t){const n=e._parsedContent,i=n.draco;let o;o=C(i)?C3.decodePointCloud(i,t):Promise.resolve(),C(o)&&(e._decodePromise=o,o.then((function(n){e.isDestroyed()||(C(n)&&cme(e,i,n),bme(e,t),e._state=G9.READY,e._promise.resolve(e))})).catch((function(t){e.unload(),e._state=G9.FAILED;const n="Failed to load Draco";e._promise.reject(e.getError(n,t))})))}function cme(e,t,n){e._state=G9.READY;const i=e._parsedContent;let o;if(C(n.POSITION)){if(o={name:"POSITION",semantic:Ene.POSITION,typedArray:n.POSITION.array,componentDatatype:ih.FLOAT,type:fh.VEC3,isQuantized:!1},C(n.POSITION.data.quantization)){const e=n.POSITION.data.quantization,t=e.range,i=K.fromElements(t,t,t),r=K.unpack(e.minValues),s=(1<<e.quantizationBits)-1;o.isQuantized=!0,o.quantizedRange=s,o.quantizedVolumeOffset=r,o.quantizedVolumeScale=i,o.quantizedComponentDatatype=ih.UNSIGNED_SHORT,o.quantizedType=fh.VEC3}i.positions=o}if(C(n.NORMAL)){if(o={name:"NORMAL",semantic:Ene.NORMAL,typedArray:n.NORMAL.array,componentDatatype:ih.FLOAT,type:fh.VEC3,isQuantized:!1,octEncoded:!1,octEncodedZXY:!1},C(n.NORMAL.data.quantization)){const e=(1<<n.NORMAL.data.quantization.quantizationBits)-1;o.quantizedRange=e,o.octEncoded=!0,o.octEncodedZXY=!0,o.quantizedComponentDatatype=ih.UNSIGNED_BYTE,o.quantizedType=fh.VEC2}i.normals=o}if(C(n.RGBA)?i.colors={name:"COLOR",semantic:Ene.COLOR,setIndex:0,typedArray:n.RGBA.array,componentDatatype:ih.UNSIGNED_BYTE,type:fh.VEC4,normalized:!0,isTranslucent:!0}:C(n.RGB)&&(i.colors={name:"COLOR",semantic:Ene.COLOR,setIndex:0,typedArray:n.RGB.array,componentDatatype:ih.UNSIGNED_BYTE,type:fh.VEC3,normalized:!0,isTranslucent:!1}),C(n.BATCH_ID)){const e=n.BATCH_ID.array;i.batchIds={name:"_FEATURE_ID",semantic:Ene.FEATURE_ID,setIndex:0,typedArray:e,componentDatatype:ih.fromTypedArray(e),type:fh.SCALAR}}let r=i.styleableProperties;const s=t.batchTableProperties;for(const a in s)if(s.hasOwnProperty(a)){const e=n[a];C(r)||(r={}),r[a]={typedArray:e.array,componentCount:e.data.componentsPerAttribute}}i.styleableProperties=r}function lme(e,t,n){let i,o=t.typedArray;if(t.octEncoded&&(i=new nme,i.octEncoded=t.octEncoded,i.octEncodedZXY=t.octEncodedZXY,i.normalizationRange=t.quantizedRange,i.type=t.quantizedType,i.componentDatatype=t.quantizedComponentDatatype),t.isQuantized){i=new nme;const e=t.quantizedRange;i.normalizationRange=e,i.quantizedVolumeOffset=K.ZERO;const n=t.quantizedVolumeScale;i.quantizedVolumeDimensions=n,i.quantizedVolumeStepSize=K.divideByScalar(n,e,new K),i.componentDatatype=t.quantizedComponentDatatype,i.type=t.quantizedType}const r=new tme;if(r.name=t.name,r.semantic=t.semantic,r.setIndex=t.setIndex,r.componentDatatype=t.componentDatatype,r.type=t.type,r.normalized=R(t.normalized,!1),r.min=t.min,r.max=t.max,r.quantization=i,t.isRGB565&&(o=wh.decodeRGB565(o)),C(t.constantColor)){const e=new Array(4);r.constant=xy.pack(t.constantColor,e)}else{const t=hq.createVertexBuffer({typedArray:o,context:n,usage:lq.STATIC_DRAW});t.vertexArrayDestroyable=!1,e._buffers.push(t),r.buffer=t}return r}let ume,hme;function dme(e){if(!C(hme)){ume=new M(0),hme=new Array(e);for(let t=0;t<e;++t)hme[t]=ume.random()}return hme}C(Object.create)&&(sme.prototype=Object.create(V9.prototype),sme.prototype.constructor=sme),Object.defineProperties(sme.prototype,{promise:{get:function(){return this._promise.promise}},cacheKey:{get:function(){}},components:{get:function(){return this._components}},transform:{get:function(){return this._transform}}}),sme.prototype.load=function(){this._parsedContent=Lne.parse(this._arrayBuffer,this._byteOffset),this._state=G9.PROCESSING},sme.prototype.process=function(e){this._state===G9.PROCESSING&&(C(this._decodePromise)||ame(this,e.context))};const fme=new K,pme=new K,mme=new K;function _me(e){const t=e.typedArray,n=20,i=t.length/3,o=Math.min(i,n),r=dme(n),s=Number.MAX_VALUE,a=-Number.MAX_VALUE;let c,l,u,h=K.fromElements(s,s,s,fme),d=K.fromElements(a,a,a,pme);if(e.isQuantized)h=K.ZERO,d=e.quantizedVolumeScale;else for(c=0;c<o;++c)l=Math.floor(r[c]*i),u=K.unpack(t,3*l,mme),K.minimumByComponent(h,u,h),K.maximumByComponent(d,u,d);e.min=K.clone(h),e.max=K.clone(d)}const gme={name:Ene.COLOR,semantic:Ene.COLOR,setIndex:0,constantColor:xy.DARKGRAY,componentDatatype:ih.FLOAT,type:fh.VEC4,isQuantized:!1,isTranslucent:!1};function yme(e,t,n){const i=[];let o;const r=t.positions;return C(r)&&(_me(r),o=lme(e,r,n),o.count=t.pointsLength,i.push(o)),C(t.normals)&&(o=lme(e,t.normals,n),i.push(o)),C(t.colors)?(o=lme(e,t.colors,n),i.push(o)):(o=lme(e,gme,n),i.push(o)),C(t.batchIds)&&(o=lme(e,t.batchIds,n),i.push(o)),i}function vme(e){const t=e.batchLength,n=e.pointsLength,i=e.batchTableBinary;if(C(i)){const o=R(t,n);return zpe({count:o,batchTable:e.batchTableJson,binaryBody:i})}const o=new Ule({name:uee.BATCH_TABLE_CLASS_NAME,count:n});return new Jle({schema:{},propertyTables:[o]})}function bme(e,t){const n=e._parsedContent,i=new rme;i.metallicFactor=0,i.roughnessFactor=.9;const o=new ome;o.metallicRoughness=i;const r=n.colors;C(r)&&r.isTranslucent&&(o.alphaMode=x7.BLEND);const s=!C(n.normals);o.unlit=s;const a=new eme;if(a.attributes=yme(e,n,t),a.primitiveType=xf.POINTS,a.material=o,C(n.batchIds)){const e=new ime;e.propertyTableId=0,e.setIndex=0,e.positionalLabel="featureId_0",a.featureIds.push(e)}const c=new $pe;c.primitives=[a];const l=new Zpe;l.nodes=[c],l.upAxis=iJ.Z,l.forwardAxis=iJ.X;const u=new Jpe;u.scene=l,u.nodes=[c],u.structuralMetadata=vme(n),C(n.rtcCenter)&&(u.transform=ft.multiplyByTranslation(u.transform,n.rtcCenter,u.transform));const h=n.positions;C(h)&&h.isQuantized&&(u.transform=ft.multiplyByTranslation(u.transform,h.quantizedVolumeOffset,u.transform)),e._components=u,e._parsedContent=void 0}sme.prototype.unload=function(){const e=this._buffers;for(let t=0;t<e.length;t++)e[t].destroy();e.length=0,this._components=void 0,this._parsedContent=void 0};const Ame={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,FAILED:4},wme=j7.Attribute,Tme=j7.FeatureIdAttribute,Cme=j7.Instances;function Eme(e){e=R(e,R.EMPTY_OBJECT);const t=e.i3dmResource,n=e.arrayBuffer;let i=e.baseResource;const o=R(e.byteOffset,0),r=R(e.releaseGltfJson,!1),s=R(e.asynchronous,!0),a=R(e.incrementallyLoadTextures,!0),c=R(e.upAxis,iJ.Y),l=R(e.forwardAxis,iJ.X),u=R(e.loadAsTypedArray,!1);D.typeOf.object("options.i3dmResource",t),D.typeOf.object("options.arrayBuffer",n),i=C(i)?i:t.clone(),this._i3dmResource=t,this._baseResource=i,this._arrayBuffer=n,this._byteOffset=o,this._releaseGltfJson=r,this._asynchronous=s,this._incrementallyLoadTextures=a,this._upAxis=c,this._forwardAxis=l,this._loadAsTypedArray=u,this._state=Ame.UNLOADED,this._promise=yn(),this._gltfLoader=void 0,this._transform=ft.IDENTITY,this._batchTable=void 0,this._featureTable=void 0,this._instancesLength=0}function xme(e,t){e.unload(),e._state=Ame.FAILED;const n="Failed to load I3DM";t=e.getError(n,t),e._promise.reject(t)}function Sme(e,t){const n=e._batchTable,i=e._instancesLength;if(0===i)return;let o;if(C(n.json))o=zpe({count:i,batchTable:n.json,binaryBody:n.binary});else{const e=new Ule({name:uee.BATCH_TABLE_CLASS_NAME,count:i});o=new Jle({schema:{},propertyTables:[e]})}t.structuralMetadata=o}C(Object.create)&&(Eme.prototype=Object.create(V9.prototype),Eme.prototype.constructor=Eme),Object.defineProperties(Eme.prototype,{promise:{get:function(){return this._promise.promise}},texturesLoadedPromise:{get:function(){return this._gltfLoader.texturesLoadedPromise}},cacheKey:{get:function(){}},components:{get:function(){return this._components}}}),Eme.prototype.load=function(){const e=Dte.parse(this._arrayBuffer,this._byteOffset),t=e.featureTableJson,n=e.featureTableBinary,i=e.batchTableJson,o=e.batchTableBinary,r=e.gltfFormat,s=new mZ(t,n);this._featureTable=s;const a=s.getGlobalProperty("INSTANCES_LENGTH");if(s.featuresLength=a,!C(a))throw new Je("Feature table global property: INSTANCES_LENGTH must be defined");this._instancesLength=a;const c=s.getGlobalProperty("RTC_CENTER",ih.FLOAT,3);C(c)&&(this._transform=ft.fromTranslation(K.fromArray(c))),this._batchTable={json:i,binary:o};const l={upAxis:this._upAxis,forwardAxis:this._forwardAxis,releaseGltfJson:this._releaseGltfJson,incrementallyLoadTextures:this._incrementallyLoadTextures,loadAsTypedArray:this._loadAsTypedArray};if(0===r){let t=Bp(e.gltf);t=t.replace(/[\s\0]+$/,"");const n=this._baseResource.getDerivedResource({url:t});l.gltfResource=n,l.baseResource=n}else l.gltfResource=this._i3dmResource,l.typedArray=e.gltf;const u=new Nue(l);this._gltfLoader=u,this._state=Ame.LOADING;const h=this;u.load(),u.promise.then((function(){if(h.isDestroyed())return;const e=u.components;e.transform=h._transform,Dme(h,e),Sme(h,e),h._components=e,h._state=Ame.READY,h._promise.resolve(h)})).catch((function(e){h.isDestroyed()||xme(h,e)}))},Eme.prototype.process=function(e){D.typeOf.object("frameState",e),this._state===Ame.LOADING&&(this._state=Ame.PROCESSING),this._state===Ame.PROCESSING&&this._gltfLoader.process(e)};const Ime=new K,Ome=new Array(4);function Dme(e,t){let n;const i=e._featureTable,o=e._instancesLength;if(0===o)return;const r=i.getGlobalProperty("RTC_CENTER",ih.FLOAT,3),s=i.getGlobalProperty("EAST_NORTH_UP"),a=i.hasProperty("NORMAL_UP")||i.hasProperty("NORMAL_UP_OCT32P")||s,c=i.hasProperty("SCALE")||i.hasProperty("SCALE_NON_UNIFORM"),l=Pme(i,o);let u,h;a&&(u=new Float32Array(4*o)),c&&(h=new Float32Array(3*o));const d=new Float32Array(o),f=K.unpackArray(l);let p=new K;const m=new K,_=new K,g=new K,y=new ke,v=new il,b=new Array(4),A=new K,w=new Array(3),T=new ft;if(!C(r)){const e=nn.fromPoints(f);for(n=0;n<f.length;n++)K.subtract(f[n],e.center,Ime),l[3*n+0]=Ime.x,l[3*n+1]=Ime.y,l[3*n+2]=Ime.z;t.transform=ft.fromTranslation(e.center)}for(n=0;n<o;n++){p=K.clone(f[n]),C(r)&&K.add(p,K.unpack(r),p),a&&(Lme(i,s,n,v,p,_,m,g,y,T),il.pack(v,b,0),u[4*n+0]=b[0],u[4*n+1]=b[1],u[4*n+2]=b[2],u[4*n+3]=b[3]),c&&(Mme(i,n,A),K.pack(A,w,0),h[3*n+0]=w[0],h[3*n+1]=w[1],h[3*n+2]=w[2]);let e=i.getProperty("BATCH_ID",ih.UNSIGNED_SHORT,1,n);C(e)||(e=n),d[n]=e}const E=new Cme;E.transformInWorldSpace=!0;const x=new wme;if(x.name="Instance Translation",x.semantic=gue.TRANSLATION,x.componentDatatype=ih.FLOAT,x.type=fh.VEC3,x.count=o,x.packedTypedArray=l,E.attributes.push(x),a){const e=new wme;e.name="Instance Rotation",e.semantic=gue.ROTATION,e.componentDatatype=ih.FLOAT,e.type=fh.VEC4,e.count=o,e.packedTypedArray=u,E.attributes.push(e)}if(c){const e=new wme;e.name="Instance Scale",e.semantic=gue.SCALE,e.componentDatatype=ih.FLOAT,e.type=fh.VEC3,e.count=o,e.packedTypedArray=h,E.attributes.push(e)}const S=new wme;S.name="Instance Feature ID",S.setIndex=0,S.semantic=gue.FEATURE_ID,S.componentDatatype=ih.FLOAT,S.type=fh.SCALAR,S.count=o,S.packedTypedArray=d,E.attributes.push(S);const I=new Tme;for(I.propertyTableId=0,I.setIndex=0,I.positionalLabel="instanceFeatureId_0",E.featureIds.push(I),n=0;n<t.nodes.length;n++){const e=t.nodes[n];e.primitives.length>0&&(e.instances=E)}}function Pme(e,t){if(e.hasProperty("POSITION"))return e.getPropertyArray("POSITION",ih.FLOAT,3);if(e.hasProperty("POSITION_QUANTIZED")){const t=e.getPropertyArray("POSITION_QUANTIZED",ih.UNSIGNED_SHORT,3),n=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ih.FLOAT,3);if(!C(n))throw new Je("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const i=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ih.FLOAT,3);if(!C(i))throw new Je("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(let e=0;e<t.length/3;e++){const o=t[e];for(let r=0;r<3;r++)t[3*e+r]=o[r]/65535*i[r]+n[r]}return t}throw new Je("Either POSITION or POSITION_QUANTIZED must be defined for each instance.")}const Rme=new Array(4);function Lme(e,t,n,i,o,r,s,a,c,l){const u=e.getProperty("NORMAL_UP",ih.FLOAT,3,n,Ome),h=e.getProperty("NORMAL_RIGHT",ih.FLOAT,3,n,Rme);let d=!1;if(C(u)){if(!C(h))throw new Je("To define a custom orientation, both NORMAL_UP and NORMAL_RIGHT must be defined.");K.unpack(u,0,r),K.unpack(h,0,s),d=!0}else{const i=e.getProperty("NORMAL_UP_OCT32P",ih.UNSIGNED_SHORT,2,n,Ome),a=e.getProperty("NORMAL_RIGHT_OCT32P",ih.UNSIGNED_SHORT,2,n,Rme);if(C(i)){if(!C(a))throw new Je("To define a custom orientation with oct-encoded vectors, both NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P must be defined.");wh.octDecodeInRange(i[0],i[1],65535,r),wh.octDecodeInRange(a[0],a[1],65535,s),d=!0}else t?(Kl.eastNorthUpToFixedFrame(o,ge.WGS84,l),ft.getMatrix3(l,c)):ke.clone(ke.IDENTITY,c)}d&&(K.cross(s,r,a),K.normalize(a,a),ke.setColumn(c,0,s,c),ke.setColumn(c,1,r,c),ke.setColumn(c,2,a,c)),il.fromRotationMatrix(c,i)}function Mme(e,t,n){n=K.fromElements(1,1,1,n);const i=e.getProperty("SCALE",ih.FLOAT,1,t);C(i)&&K.multiplyByScalar(n,i,n);const o=e.getProperty("SCALE_NON_UNIFORM",ih.FLOAT,3,t,Ome);C(o)&&(n.x*=o[0],n.y*=o[1],n.z*=o[2])}Eme.prototype.unload=function(){C(this._gltfLoader)&&this._gltfLoader.unload(),this._components=void 0};var Bme=Eme;function Nme(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.object("options.loader",e.loader),D.typeOf.object("options.resource",e.resource),this._loader=e.loader,this._resource=e.resource,this.type=R(e.type,rfe.GLTF),this.modelMatrix=ft.clone(R(e.modelMatrix,ft.IDENTITY)),this._modelMatrix=ft.clone(this.modelMatrix),this._scale=R(e.scale,1),this._minimumPixelSize=R(e.minimumPixelSize,0),this._maximumScale=e.maximumScale,this._clampedScale=C(this._maximumScale)?Math.min(this._scale,this._maximumScale):this._scale,this._computedScale=this._clampedScale,this._updateModelMatrix=!1,this.referenceMatrix=void 0,this._iblReferenceFrameMatrix=ke.clone(ke.IDENTITY),this._resourcesLoaded=!1,this._drawCommandsBuilt=!1,this._ready=!1,this._readyPromise=yn(),this._customShader=e.customShader,this._content=e.content,this._texturesLoaded=!1,this._defaultTexture=void 0;const t=e.color;this._color=R(t)?xy.clone(t):void 0,this._colorBlendMode=R(e.colorBlendMode,y3.HIGHLIGHT),this._colorBlendAmount=R(e.colorBlendAmount,.5),this._cull=R(e.cull,!0),this._opaquePass=R(e.opaquePass,HU.OPAQUE),this._allowPicking=R(e.allowPicking,!0),this._show=R(e.show,!0),this._style=void 0;let n=R(e.featureIdLabel,"featureId_0");"number"===typeof n&&(n=`featureId_${n}`),this._featureIdLabel=n;let i=R(e.instanceFeatureIdLabel,"instanceFeatureId_0");"number"===typeof i&&(i=`instanceFeatureId_${i}`),this._instanceFeatureIdLabel=i,this._featureTables=[],this._featureTableId=void 0,this._featureTableIdDirty=!0,this._resources=[],this._boundingSphere=new nn,this._initialRadius=void 0;const o=new Mie(e.pointCloudShading);this._attenuation=o.attenuation,this._pointCloudShading=o;const r=e.clippingPlanes;C(r)&&void 0===r.owner?_3.setOwner(r,this,"_clippingPlanes"):this._clippingPlanes=r,this._clippingPlanesState=0,this._clippingPlanesMatrix=ft.clone(ft.IDENTITY),this._lightColor=K.clone(e.lightColor),this._imageBasedLighting=C(e.imageBasedLighting)?e.imageBasedLighting:new ZQ,this._shouldDestroyImageBasedLighting=!C(e.imageBasedLighting),this._backFaceCulling=R(e.backFaceCulling,!0),this._backFaceCullingDirty=!1,this._shadows=R(e.shadows,rj.ENABLED),this._shadowsDirty=!1,this._debugShowBoundingVolumeDirty=!1,this._debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this._showCreditsOnScreen=R(e.showCreditsOnScreen,!1),this._splitDirection=R(e.splitDirection,T4.NONE),kme(this)}function Fme(e,t){const n=e._featureTables,i=t.propertyTables;for(let o=0;o<i.length;o++){const t=i[o],r=new Lpe({model:e,propertyTable:t});n.push(r)}return n}function zme(e,t){const n=t._featureIdLabel,i=t._instanceFeatureIdLabel;let o,r,s,a;for(o=0;o<e.nodes.length;o++)if(a=e.nodes[o],C(a.instances)&&(s=Khe.getFeatureIdsByLabel(a.instances.featureIds,i),C(s)&&C(s.propertyTableId)))return s.propertyTableId;for(o=0;o<e.nodes.length;o++)for(a=e.nodes[o],r=0;r<a.primitives.length;r++){const e=a.primitives[r],t=Khe.getFeatureIdsByLabel(e.featureIds,n);if(C(t))return t.propertyTableId}}function kme(e){const t=e._loader,n=e._resource;t.load(),t.promise.then((function(t){const n=t.components,i=n.structuralMetadata;C(i)&&i.propertyTableCount>0&&Fme(e,i),e._sceneGraph=new Ipe({model:e,modelComponents:n}),e._resourcesLoaded=!0})).catch(Khe.getFailedLoadFunction(e,"model",n));const i=R(t.texturesLoadedPromise,Promise.resolve());i.then((function(){e._texturesLoaded=!0})).catch(Khe.getFailedLoadFunction(e,"model",n))}Object.defineProperties(Nme.prototype,{ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},loader:{get:function(){return this._loader}},cull:{get:function(){return this._cull}},opaquePass:{get:function(){return this._opaquePass}},pointCloudShading:{get:function(){return this._pointCloudShading},set:function(e){D.defined("pointCloudShading",e),e!==this._pointCloudShading&&this.resetDrawCommands(),this._pointCloudShading=e}},customShader:{get:function(){return this._customShader},set:function(e){e!==this._customShader&&this.resetDrawCommands(),this._customShader=e}},sceneGraph:{get:function(){return this._sceneGraph}},content:{get:function(){return this._content}},structuralMetadata:{get:function(){return this._sceneGraph.components.structuralMetadata}},featureTableId:{get:function(){return this._featureTableId},set:function(e){this._featureTableId=e}},featureTables:{get:function(){return this._featureTables},set:function(e){this._featureTables=e}},allowPicking:{get:function(){return this._allowPicking}},style:{get:function(){return this._style},set:function(e){e!==this._style&&this.applyStyle(e),this._style=e}},color:{get:function(){return this._color},set:function(e){xy.equals(this._color,e)||this.resetDrawCommands(),this._color=xy.clone(e,this._color)}},colorBlendMode:{get:function(){return this._colorBlendMode},set:function(e){this._colorBlendMode=e}},colorBlendAmount:{get:function(){return this._colorBlendAmount},set:function(e){this._colorBlendAmount=e}},boundingSphere:{get:function(){if(!this._ready)throw new x("The model is not loaded. Use ModelExperimental.readyPromise or wait for ModelExperimental.ready to be true.");return this._boundingSphere}},debugShowBoundingVolume:{get:function(){return this._debugShowBoundingVolume},set:function(e){this._debugShowBoundingVolume!==e&&(this._debugShowBoundingVolumeDirty=!0),this._debugShowBoundingVolume=e}},show:{get:function(){return this._show},set:function(e){this._show=e}},featureIdLabel:{get:function(){return this._featureIdLabel},set:function(e){"number"===typeof e&&(e=`featureId_${e}`),D.typeOf.string("value",e),e!==this._featureIdLabel&&(this._featureTableIdDirty=!0),this._featureIdLabel=e}},instanceFeatureIdLabel:{get:function(){return this._instanceFeatureIdLabel},set:function(e){"number"===typeof e&&(e=`instanceFeatureId_${e}`),D.typeOf.string("value",e),e!==this._instanceFeatureIdLabel&&(this._featureTableIdDirty=!0),this._instanceFeatureIdLabel=e}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){e!==this._clippingPlanes&&(_3.setOwner(e,this,"_clippingPlanes"),this.resetDrawCommands())}},lightColor:{get:function(){return this._lightColor},set:function(e){C(e)!==C(this._lightColor)&&this.resetDrawCommands(),this._lightColor=K.clone(e,this._lightColor)}},imageBasedLighting:{get:function(){return this._imageBasedLighting},set:function(e){D.typeOf.object("imageBasedLighting",this._imageBasedLighting),e!==this._imageBasedLighting&&(this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=e,this._shouldDestroyImageBasedLighting=!1,this.resetDrawCommands())}},backFaceCulling:{get:function(){return this._backFaceCulling},set:function(e){e!==this._backFaceCulling&&(this._backFaceCullingDirty=!0),this._backFaceCulling=e}},scale:{get:function(){return this._scale},set:function(e){e!==this._scale&&(this._updateModelMatrix=!0),this._scale=e}},computedScale:{get:function(){return this._computedScale}},minimumPixelSize:{get:function(){return this._minimumPixelSize},set:function(e){e!==this._minimumPixelSize&&(this._updateModelMatrix=!0),this._minimumPixelSize=e}},maximumScale:{get:function(){return this._maximumScale},set:function(e){e!==this._maximumScale&&(this._updateModelMatrix=!0),this._maximumScale=e}},shadows:{get:function(){return this._shadows},set:function(e){e!==this._shadows&&(this._shadowsDirty=!0),this._shadows=e}},showCreditsOnScreen:{get:function(){return this._showCreditsOnScreen},set:function(e){this._showCreditsOnScreen=e}},splitDirection:{get:function(){return this._splitDirection},set:function(e){this._splitDirection!==e&&this.resetDrawCommands(),this._splitDirection=e}}}),Nme.prototype.resetDrawCommands=function(){this._drawCommandsBuilt&&(this.destroyResources(),this._drawCommandsBuilt=!1)};const Ume=new ft,Vme=new ke,Hme=new ft;function Gme(e){const t=e._sceneGraph.components,n=t.structuralMetadata;C(n)&&n.propertyTableCount>0&&(e.featureTableId=zme(t,e),e.applyStyle(e._style))}Nme.prototype.update=function(e){this._resourcesLoaded&&this._texturesLoaded||this._loader.process(e),C(this._customShader)&&this._customShader.update(e),this.pointCloudShading.attenuation!==this._attenuation&&(this.resetDrawCommands(),this._attenuation=this.pointCloudShading.attenuation);const t=e.context,n=R(this.referenceMatrix,this.modelMatrix);if(this._imageBasedLighting.update(e),this._imageBasedLighting.useSphericalHarmonicCoefficients||this._imageBasedLighting.useSpecularEnvironmentMaps){let e=Vme,i=Ume;i=ft.multiply(t.uniformState.view3D,n,i),e=ft.getMatrix3(i,e),e=ke.getRotation(e,e),this._iblReferenceFrameMatrix=ke.transpose(e,this._iblReferenceFrameMatrix)}this._imageBasedLighting.shouldRegenerateShaders&&this.resetDrawCommands();let i=0;if(this.isClippingEnabled()){this._clippingPlanes.owner===this&&this._clippingPlanes.update(e);let o=Hme;o=ft.multiply(t.uniformState.view3D,n,o),o=ft.multiply(o,this._clippingPlanes.modelMatrix,o),this._clippingPlanesMatrix=ft.inverseTranspose(o,this._clippingPlanesMatrix),i=this._clippingPlanes.clippingPlanesState}if(i!==this._clippingPlanesState&&(this.resetDrawCommands(),this._clippingPlanesState=i),this._defaultTexture=t.defaultTexture,!this._resourcesLoaded)return;this._featureTableIdDirty&&(Gme(this),this._featureTableIdDirty=!1);const o=this._featureTables;for(let r=0;r<o.length;r++)o[r].update(e),o[r].styleCommandsNeededDirty&&this.resetDrawCommands();if(!this._drawCommandsBuilt){this._sceneGraph.buildDrawCommands(e),this._drawCommandsBuilt=!0;const t=this;if(!t._ready)return void e.afterRender.push((function(){t._ready=!0,t._readyPromise.resolve(t)}))}if(this._debugShowBoundingVolumeDirty&&(Kme(this._sceneGraph,this._debugShowBoundingVolume),this._debugShowBoundingVolumeDirty=!1),ft.equals(this.modelMatrix,this._modelMatrix)||(this._updateModelMatrix=!0,this._modelMatrix=ft.clone(this.modelMatrix,this._modelMatrix),this._boundingSphere=nn.transform(this._sceneGraph.boundingSphere,this.modelMatrix,this._boundingSphere)),(this._updateModelMatrix||0!==this._minimumPixelSize)&&(this._clampedScale=C(this._maximumScale)?Math.min(this._scale,this._maximumScale):this._scale,this._boundingSphere.radius=this._initialRadius*this._clampedScale,this._computedScale=Yme(this,e),this._sceneGraph.updateModelMatrix(),this._updateModelMatrix=!1),this._backFaceCullingDirty&&(this.sceneGraph.updateBackFaceCulling(this._backFaceCulling),this._backFaceCullingDirty=!1),this._shadowsDirty&&(this.sceneGraph.updateShadows(this._shadows),this._shadowsDirty=!1),this._sceneGraph.update(e),this._show&&0!==this._computedScale){const t=this._sceneGraph.components.asset,n=t.credits,i=n.length;for(let r=0;r<i;r++){const t=n[r];t.showOnScreen=this._showCreditsOnScreen,e.creditDisplay.addCredit(t)}const o=this._sceneGraph.getDrawCommands();e.commandList.push.apply(e.commandList,o)}};const Wme=new nn;function qme(e,t,n){return Wme.center=e,Wme.radius=t,n.camera.getPixelSize(Wme,n.context.drawingBufferWidth,n.context.drawingBufferHeight)}const jme=new K;function Yme(e,t){let n=e.scale;if(0!==e.minimumPixelSize){const i=t.context,o=Math.max(i.drawingBufferWidth,i.drawingBufferHeight),r=e.modelMatrix;jme.x=r[12],jme.y=r[13],jme.z=r[14];const s=e.boundingSphere.radius,a=qme(jme,s,t),c=1/a,l=Math.min(c*(2*s),o);l<e.minimumPixelSize&&(n=e.minimumPixelSize*a/(2*e._initialRadius))}return C(e.maximumScale)?Math.min(e.maximumScale,n):n}function Kme(e,t){const n=e._drawCommands;for(let i=0;i<n.length;i++)n[i].debugShowBoundingVolume=t}function Xme(e,t,n){return{loader:e,type:t,resource:n.resource,modelMatrix:n.modelMatrix,scale:n.scale,minimumPixelSize:n.minimumPixelSize,maximumScale:n.maximumScale,debugShowBoundingVolume:n.debugShowBoundingVolume,cull:n.cull,opaquePass:n.opaquePass,allowPicking:n.allowPicking,customShader:n.customShader,content:n.content,show:n.show,color:n.color,colorBlendAmount:n.colorBlendAmount,colorBlendMode:n.colorBlendMode,featureIdLabel:n.featureIdLabel,instanceFeatureIdLabel:n.instanceFeatureIdLabel,pointCloudShading:n.pointCloudShading,clippingPlanes:n.clippingPlanes,lightColor:n.lightColor,imageBasedLighting:n.imageBasedLighting,backFaceCulling:n.backFaceCulling,shadows:n.shadows,showCreditsOnScreen:n.showCreditsOnScreen,splitDirection:n.splitDirection}}function Qme(e,t,n){this._tileset=e,this._tile=t,this._resource=n,this._model=void 0,this._metadata=void 0,this._group=void 0}function Jme(e,t,n,i){const o={cull:!1,releaseGltfJson:!0,opaquePass:HU.CESIUM_3D_TILE,modelMatrix:t.computedTransform,upAxis:e._gltfUpAxis,forwardAxis:iJ.X,incrementallyLoadTextures:!1,customShader:e.customShader,content:n,show:e.show,colorBlendMode:e.colorBlendMode,colorBlendAmount:e.colorBlendAmount,lightColor:e.lightColor,imageBasedLighting:e.imageBasedLighting,featureIdLabel:e.featureIdLabel,instanceFeatureIdLabel:e.instanceFeatureIdLabel,pointCloudShading:e.pointCloudShading,clippingPlanes:e.clippingPlanes,backFaceCulling:e.backFaceCulling,shadows:e.shadows,showCreditsOnScreen:e.showCreditsOnScreen,splitDirection:e.splitDirection};return _n(i,o)}Nme.prototype.isClippingEnabled=function(){const e=this._clippingPlanes;return C(e)&&e.enabled&&0!==e.length},Nme.prototype.isDestroyed=function(){return!1},Nme.prototype.destroy=function(){const e=this._loader;C(e)&&e.destroy();const t=this._featureTables;if(C(t))for(let i=0;i<t.length;i++)t[i].destroy();this.destroyResources();const n=this._clippingPlanes;C(n)&&!n.isDestroyed()&&n.owner===this&&n.destroy(),this._clippingPlanes=void 0,this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=void 0,Qh(this)},Nme.prototype.destroyResources=function(){const e=this._resources;for(let t=0;t<e.length;t++)e[t].destroy();this._resources=[]},Nme.fromGltf=function(e){e=R(e,R.EMPTY_OBJECT),D.defined("options.gltf",e.gltf);const t={releaseGltfJson:e.releaseGltfJson,incrementallyLoadTextures:e.incrementallyLoadTextures,upAxis:e.upAxis,forwardAxis:e.forwardAxis},n=e.gltf,i=R(e.basePath,""),o=Vi.createIfNeeded(i);C(n.asset)?(t.gltfJson=n,t.baseResource=o,t.gltfResource=o):n instanceof Uint8Array?(t.typedArray=n,t.baseResource=o,t.gltfResource=o):t.gltfResource=Vi.createIfNeeded(e.gltf);const r=new Nue(t),s=C(e.content),a=s?rfe.TILE_GLTF:rfe.GLTF,c=Xme(r,a,e);c.resource=t.gltfResource;const l=new Nme(c);return l},Nme.fromB3dm=function(e){const t={b3dmResource:e.resource,arrayBuffer:e.arrayBuffer,byteOffset:e.byteOffset,releaseGltfJson:e.releaseGltfJson,incrementallyLoadTextures:e.incrementallyLoadTextures,upAxis:e.upAxis,forwardAxis:e.forwardAxis},n=new Qpe(t),i=Xme(n,rfe.TILE_B3DM,e),o=new Nme(i);return o},Nme.fromPnts=function(e){const t={arrayBuffer:e.arrayBuffer,byteOffset:e.byteOffset},n=new sme(t),i=Xme(n,rfe.TILE_PNTS,e),o=new Nme(i);return o},Nme.fromI3dm=function(e){const t={i3dmResource:e.resource,arrayBuffer:e.arrayBuffer,byteOffset:e.byteOffset,releaseGltfJson:e.releaseGltfJson,incrementallyLoadTextures:e.incrementallyLoadTextures,upAxis:e.upAxis,forwardAxis:e.forwardAxis},n=new Bme(t),i=Xme(n,rfe.TILE_I3DM,e),o=new Nme(i);return o},Nme.prototype.applyColorAndShow=function(e){const t=C(e)&&C(e.color),n=C(e)&&C(e.show);this._color=t?e.color.evaluateColor(void 0,this._color):xy.clone(xy.WHITE,this._color),this._show=!n||e.show.evaluate(void 0)},Nme.prototype.applyStyle=function(e){if(C(this.featureTableId)&&this.featureTables[this.featureTableId].featuresLength>0){const t=this.featureTables[this.featureTableId];t.applyStyle(e)}else this.applyColorAndShow(e);this.resetDrawCommands()},Object.defineProperties(Qme.prototype,{featuresLength:{get:function(){const e=this._model,t=e.featureTables,n=e.featureTableId;return C(t)&&C(t[n])?t[n].featuresLength:0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._model.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){const e=this._model,t=e.featureTables,n=e.featureTableId;if(C(t)&&C(t[n]))return t[n]}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},group:{get:function(){return this._group},set:function(e){this._group=e}}}),Qme.prototype.getFeature=function(e){const t=this._model,n=t.featureTableId;if(!C(n))return;const i=t.featureTables[n];return i.getFeature(e)},Qme.prototype.hasProperty=function(e,t){const n=this._model,i=n.featureTableId;if(!C(i))return!1;const o=n.featureTables[i];return o.hasProperty(e,t)},Qme.prototype.applyDebugSettings=function(e,t){t=e?t:xy.WHITE,0===this.featuresLength?this._model.color=t:C(this.batchTable)&&this.batchTable.setAllColor(t)},Qme.prototype.applyStyle=function(e){this._model.style=e},Qme.prototype.update=function(e,t){const n=this._model,i=this._tile;n.colorBlendAmount=e.colorBlendAmount,n.colorBlendMode=e.colorBlendMode,n.modelMatrix=i.computedTransform,n.customShader=e.customShader,n.pointCloudShading=e.pointCloudShading,n.featureIdLabel=e.featureIdLabel,n.instanceFeatureIdLabel=e.instanceFeatureIdLabel,n.lightColor=e.lightColor,n.imageBasedLighting=e.imageBasedLighting,n.backFaceCulling=e.backFaceCulling,n.shadows=e.shadows,n.showCreditsOnScreen=e.showCreditsOnScreen,n.splitDirection=e.splitDirection;const o=e.clippingPlanes;n.referenceMatrix=e.clippingPlanesOriginMatrix,C(o)&&i.clippingPlanesDirty&&(n._clippingPlanes=o.enabled&&i._isClipped?o:void 0),C(o)&&C(n._clippingPlanes)&&n._clippingPlanes!==o&&(n._clippingPlanes=o),n.update(t)},Qme.prototype.isDestroyed=function(){return!1},Qme.prototype.destroy=function(){return this._model=this._model&&this._model.destroy(),Qh(this)},Qme.fromGltf=function(e,t,n,i){const o=new Qme(e,t,n),r={gltf:i,basePath:n},s=Jme(e,t,o,r);return o._model=Nme.fromGltf(s),o},Qme.fromB3dm=function(e,t,n,i,o){const r=new Qme(e,t,n),s={arrayBuffer:i,byteOffset:o,resource:n},a=Jme(e,t,r,s);return r._model=Nme.fromB3dm(a),r},Qme.fromI3dm=function(e,t,n,i,o){const r=new Qme(e,t,n),s={arrayBuffer:i,byteOffset:o,resource:n},a=Jme(e,t,r,s);return r._model=Nme.fromI3dm(a),r},Qme.fromPnts=function(e,t,n,i,o){const r=new Qme(e,t,n),s={arrayBuffer:i,byteOffset:o,resource:n},a=Jme(e,t,r,s);return r._model=Nme.fromPnts(a),r};const Zme={b3dm:function(e,t,n,i,o){return e.enableModelExperimental?Qme.fromB3dm(e,t,n,i,o):new v8(e,t,n,i,o)},pnts:function(e,t,n,i,o){return e.enableModelExperimental?Qme.fromPnts(e,t,n,i,o):new Wie(e,t,n,i,o)},i3dm:function(e,t,n,i,o){return e.enableModelExperimental?Qme.fromI3dm(e,t,n,i,o):new bne(e,t,n,i,o)},cmpt:function(e,t,n,i,o){return new T8(e,t,n,i,o,Zme)},externalTileset:function(e,t,n,i){return new Yie(e,t,n,i)},geom:function(e,t,n,i,o){return new F8(e,t,n,i,o)},vctr:function(e,t,n,i,o){return new Fle(e,t,n,i,o)},subt:function(e,t,n,i,o){return new ote(e,t,n,void 0,i,o)},subtreeJson:function(e,t,n,i){return new ote(e,t,n,i)},glb:function(e,t,n,i,o){const r=i.byteLength;if(r<12)throw new Je("Invalid glb content");const s=new DataView(i,o),a=s.getUint32(8,!0),c=new Uint8Array(i,o,a);return Qme.fromGltf(e,t,n,c)},gltf:function(e,t,n,i){return Qme.fromGltf(e,t,n,i)}};var $me=Zme;const e_e={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var t_e=Object.freeze(e_e);const n_e={BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",COMPOSITE:"cmpt",POINT_CLOUD:"pnts",VECTOR:"vctr",GEOMETRY:"geom",GLTF:"gltf",GLTF_BINARY:"glb",IMPLICIT_SUBTREE:"subt",IMPLICIT_SUBTREE_JSON:"subtreeJson",EXTERNAL_TILESET:"externalTileset",MULTIPLE_CONTENT:"multipleContent",isBinaryFormat:function(e){switch(e){case n_e.BATCHED_3D_MODEL:case n_e.INSTANCED_3D_MODEL:case n_e.COMPOSITE:case n_e.POINT_CLOUD:case n_e.VECTOR:case n_e.GEOMETRY:case n_e.IMPLICIT_SUBTREE:case n_e.GLTF_BINARY:return!0;default:return!1}}};var i_e=Object.freeze(n_e);const o_e={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};var r_e=Object.freeze(o_e);function s_e(){}const a_e={stack:new CO,stackMaximumLength:0};function c_e(e){return e._visible&&e._inRequestVolume}function l_e(e){return e.hasEmptyContent||e.hasTilesetContent||e.hasImplicitContent}function u_e(e){return!l_e(e)&&e.contentUnloaded}function h_e(e,t){return 0!==t.children.length&&(t.hasTilesetContent||t.hasImplicitContent?!t.contentExpired:(t.hasEmptyContent,!0))}function d_e(e,t,n,i){const o=t.children,r=o.length;for(let s=0;s<r;++s){const e=o[s];e.updateVisibility(i),c_e(e)&&n.push(e)}}function f_e(e,t){(u_e(t)||t.contentExpired)&&(t._priority=0,e._requestedTiles.push(t))}function p_e(e,t,n){t._touchedFrame!==n.frameNumber&&(e._cache.touch(t),t._touchedFrame=n.frameNumber)}function m_e(e){++e.statistics.visited}function __e(e,t,n){t.contentAvailable&&t.contentVisibility(n)!==Ae.OUTSIDE&&e._selectedTiles.push(t)}s_e.selectTiles=function(e,t){e._selectedTiles.length=0,e._requestedTiles.length=0,e._hasMixedContent=!1;let n=!0;const i=e.root;if(i.updateVisibility(t),!c_e(i))return n;const o=a_e.stack;o.push(e.root);while(o.length>0){a_e.stackMaximumLength=Math.max(a_e.stackMaximumLength,o.length);const i=o.pop(),r=i.refine===wne.ADD,s=i.refine===wne.REPLACE,a=h_e(e,i);a&&d_e(e,i,o,t),(r||s&&!a)&&(f_e(e,i),p_e(e,i,t),__e(e,i,t),l_e(i)||i.contentAvailable||(n=!1)),m_e(e)}return a_e.stack.trim(a_e.stackMaximumLength),n};var g_e=s_e;function y_e(){}function v_e(e){return e._visible&&e._inRequestVolume}const b_e={stack:new CO,stackMaximumLength:0},A_e={stack:new CO,stackMaximumLength:0},w_e={stack:new CO,stackMaximumLength:0},T_e={stack:new CO,stackMaximumLength:0,ancestorStack:new CO,ancestorStackMaximumLength:0},C_e=2;function E_e(e,t,n){const i=e._maximumScreenSpaceError,o=e._maximumScreenSpaceError;J_e(e,t,i,o,n)}function x_e(e,t,n){const i=Number.MAX_VALUE,o=e._maximumScreenSpaceError;J_e(e,t,i,o,n),$_e(e,t,n)}function S_e(e,t,n){const i=Math.max(e.baseScreenSpaceError,e.maximumScreenSpaceError),o=e.maximumScreenSpaceError;J_e(e,t,i,o,n),$_e(e,t,n)}function I_e(e){return e._skipLevelOfDetail}function O_e(e,t){e._emptyTiles.push(t)}function D_e(e,t,n){if(t.contentVisibility(n)!==Ae.OUTSIDE){const i=t.content;i.featurePropertiesDirty?(i.featurePropertiesDirty=!1,t.lastStyleTime=0,e._selectedTilesToStyle.push(t)):t._selectedFrame<n.frameNumber-1&&e._selectedTilesToStyle.push(t),t._selectedFrame=n.frameNumber,e._selectedTiles.push(t)}}function P_e(e,t,n){const i=w_e.stack;i.push(t);while(i.length>0){w_e.stackMaximumLength=Math.max(w_e.stackMaximumLength,i.length);const o=i.pop(),r=o.children,s=r.length;for(let a=0;a<s;++a){const o=r[a];v_e(o)&&(o.contentAvailable?(H_e(e,o,n),M_e(e,o,n),D_e(e,o,n)):o._depth-t._depth<C_e&&i.push(o))}}}function R_e(e,t,n){if(!I_e(e))return void(t.contentAvailable&&D_e(e,t,n));const i=t.contentAvailable?t:t._ancestorWithContentAvailable;C(i)?i._shouldSelect=!0:P_e(e,t,n)}function L_e(e,t,n){++e._statistics.visited,t._visitedFrame=n.frameNumber}function M_e(e,t,n){t._touchedFrame!==n.frameNumber&&(e._cache.touch(t),t._touchedFrame=n.frameNumber)}function B_e(e,t){e._maximumPriority.distance=Math.max(t._priorityHolder._distanceToCamera,e._maximumPriority.distance),e._minimumPriority.distance=Math.min(t._priorityHolder._distanceToCamera,e._minimumPriority.distance),e._maximumPriority.depth=Math.max(t._depth,e._maximumPriority.depth),e._minimumPriority.depth=Math.min(t._depth,e._minimumPriority.depth),e._maximumPriority.foveatedFactor=Math.max(t._priorityHolder._foveatedFactor,e._maximumPriority.foveatedFactor),e._minimumPriority.foveatedFactor=Math.min(t._priorityHolder._foveatedFactor,e._minimumPriority.foveatedFactor),e._maximumPriority.reverseScreenSpaceError=Math.max(t._priorityReverseScreenSpaceError,e._maximumPriority.reverseScreenSpaceError),e._minimumPriority.reverseScreenSpaceError=Math.min(t._priorityReverseScreenSpaceError,e._minimumPriority.reverseScreenSpaceError)}function N_e(e,t,n){if(!e._cullRequestsWhileMoving)return!0;const i=t.boundingSphere,o=Math.max(2*i.radius,1),r=n.camera,s=0!==r.positionWCDeltaMagnitude?r.positionWCDeltaMagnitude:r.positionWCDeltaMagnitudeLastFrame,a=e.cullRequestsWhileMovingMultiplier*s/o;return a<1}function F_e(e,t,n){if(t._requestedFrame===n.frameNumber||!q_e(t)&&!t.contentExpired)return;if(!N_e(e,t,n))return;const i=n.camera.timeSinceMoved<e.foveatedTimeDelay;t.priorityDeferred&&i||(t._requestedFrame=n.frameNumber,e._requestedTiles.push(t))}function z_e(e,t,n){t._updatedVisibilityFrame!==e._updatedVisibilityFrame&&(t.updateVisibility(n),t._updatedVisibilityFrame=e._updatedVisibilityFrame)}function k_e(e,t,n){let i=!1;const o=t.children,r=o.length;for(let s=0;s<r;++s){const t=o[s];z_e(e,t,n),i=i||v_e(t)}return i}function U_e(e,t,n){const i=t.parent;return!(!C(i)||i.hasTilesetContent||i.hasImplicitContent||i.refine!==wne.ADD)&&t.getScreenSpaceError(n,!0)<=e._maximumScreenSpaceError}function V_e(e,t,n){if(z_e(e,t,n),!v_e(t))return;const i=t.children.length>0;if((t.hasTilesetContent||t.hasImplicitContent)&&i){const i=t.children[0];return V_e(e,i,n),void(t._visible=i._visible)}if(U_e(e,t,n))return void(t._visible=!1);const o=t.refine===wne.REPLACE,r=t._optimChildrenWithinParent===r_e.USE_OPTIMIZATION;return o&&r&&i&&!k_e(e,t,n)?(++e._statistics.numberOfTilesCulledWithChildrenUnion,void(t._visible=!1)):void 0}function H_e(e,t,n){V_e(e,t,n),t.updateExpiration(),t._wasMinPriorityChild=!1,t._priorityHolder=t,B_e(e,t),t._shouldSelect=!1,t._finalResolution=!0}function G_e(e,t){e._ancestorWithContent=void 0,e._ancestorWithContentAvailable=void 0;const n=e.parent;if(C(n)){const i=!q_e(n)||n._requestedFrame===t.frameNumber;e._ancestorWithContent=i?n:n._ancestorWithContent,e._ancestorWithContentAvailable=n.contentAvailable?n:n._ancestorWithContentAvailable}}function W_e(e){return e.hasEmptyContent||e.hasTilesetContent||e.hasImplicitContent}function q_e(e){return!W_e(e)&&e.contentUnloaded}function j_e(e,t){const n=t._ancestorWithContent;return!e.immediatelyLoadDesiredLevelOfDetail&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf||C(n)&&t._screenSpaceError<n._screenSpaceError/e.skipScreenSpaceErrorFactor&&t._depth>n._depth+e.skipLevels)}function Y_e(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}function K_e(e,t,n,i){let o;const r=t.refine===wne.REPLACE,s=t.children,a=s.length;for(o=0;o<a;++o)H_e(e,s[o],i);s.sort(Y_e);const c=!I_e(e)&&r&&!W_e(t);let l,u=!0,h=!1,d=-1,f=Number.MAX_VALUE;for(o=0;o<a;++o)if(l=s[o],v_e(l)?(n.push(l),l._foveatedFactor<f&&(d=o,f=l._foveatedFactor),h=!0):(c||e.loadSiblings)&&(l._foveatedFactor<f&&(d=o,f=l._foveatedFactor),F_e(e,l,i),M_e(e,l,i)),c){let t;t=!!l._inRequestVolume&&(W_e(l)?Z_e(e,l,i):l.contentAvailable),u=u&&t}if(h||(u=!1),-1!==d&&!I_e(e)&&r){const n=s[d];n._wasMinPriorityChild=!0;const i=(t._wasMinPriorityChild||t===e.root)&&f<=t._priorityHolder._foveatedFactor?t._priorityHolder:t;for(i._foveatedFactor=Math.min(n._foveatedFactor,i._foveatedFactor),i._distanceToCamera=Math.min(n._distanceToCamera,i._distanceToCamera),o=0;o<a;++o)l=s[o],l._priorityHolder=i}return u}function X_e(e,t,n){return!I_e(e)||!e.immediatelyLoadDesiredLevelOfDetail&&(!C(t._ancestorWithContent)||(0===t._screenSpaceError?t.parent._screenSpaceError>n:t._screenSpaceError>n))}function Q_e(e,t){return 0!==t.children.length&&(t.hasTilesetContent||t.hasImplicitContent?!t.contentExpired:t._screenSpaceError>e._maximumScreenSpaceError)}function J_e(e,t,n,i,o){const r=b_e.stack;r.push(t);while(r.length>0){b_e.stackMaximumLength=Math.max(b_e.stackMaximumLength,r.length);const t=r.pop();G_e(t,o);const i=X_e(e,t,n),s=t.refine===wne.ADD,a=t.refine===wne.REPLACE,c=t.parent,l=!C(c)||c._refines;let u=!1;Q_e(e,t)&&(u=K_e(e,t,r,o)&&l);const h=!u&&l;W_e(t)?(O_e(e,t,o),F_e(e,t,o),h&&R_e(e,t,o)):s?(R_e(e,t,o),F_e(e,t,o)):a&&(i?(F_e(e,t,o),h&&R_e(e,t,o)):h?(R_e(e,t,o),F_e(e,t,o)):j_e(e,t)&&F_e(e,t,o)),L_e(e,t,o),M_e(e,t,o),t._refines=u}}function Z_e(e,t,n){let i=!0;const o=A_e.stack;o.push(t);while(o.length>0){A_e.stackMaximumLength=Math.max(A_e.stackMaximumLength,o.length);const t=o.pop(),r=t.children,s=r.length,a=W_e(t),c=a&&Q_e(e,t),l=a&&0===t.children.length;if(c||t.contentAvailable||l||(i=!1),H_e(e,t,n),v_e(t)||(F_e(e,t,n),M_e(e,t,n)),c)for(let e=0;e<s;++e){const t=r[e];o.push(t)}}return i}function $_e(e,t,n){const i=T_e.stack,o=T_e.ancestorStack;let r;i.push(t);while(i.length>0||o.length>0){if(T_e.stackMaximumLength=Math.max(T_e.stackMaximumLength,i.length),T_e.ancestorStackMaximumLength=Math.max(T_e.ancestorStackMaximumLength,o.length),o.length>0){const t=o.peek();if(t._stackLength===i.length){o.pop(),t!==r&&(t._finalResolution=!1),D_e(e,t,n);continue}}const t=i.pop();if(!C(t))continue;const s=t.refine===wne.ADD,a=t._shouldSelect,c=t.children,l=c.length,u=Q_e(e,t);if(a)if(s)D_e(e,t,n);else{if(t._selectionDepth=o.length,t._selectionDepth>0&&(e._hasMixedContent=!0),r=t,!u){D_e(e,t,n);continue}o.push(t),t._stackLength=i.length}if(u)for(let e=0;e<l;++e){const t=c[e];v_e(t)&&i.push(t)}}}y_e.selectTiles=function(e,t){if(e._requestedTiles.length=0,e.debugFreezeFrame)return;e._selectedTiles.length=0,e._selectedTilesToStyle.length=0,e._emptyTiles.length=0,e._hasMixedContent=!1;const n=e.root;if(H_e(e,n,t),!v_e(n))return;if(n.getScreenSpaceError(t,!0)<=e._maximumScreenSpaceError)return;I_e(e)?e.immediatelyLoadDesiredLevelOfDetail?x_e(e,n,t):S_e(e,n,t):E_e(e,n,t),b_e.stack.trim(b_e.stackMaximumLength),A_e.stack.trim(A_e.stackMaximumLength),w_e.stack.trim(w_e.stackMaximumLength),T_e.stack.trim(T_e.stackMaximumLength),T_e.ancestorStack.trim(T_e.ancestorStackMaximumLength);const i=e._requestedTiles,o=i.length;for(let r=0;r<o;++r)i[r].updatePriority()};var ege=y_e;const tge={RENDER:0,PICK:1,SHADOW:2,PRELOAD:3,PRELOAD_FLIGHT:4,REQUEST_RENDER_MODE_DEFER_CHECK:5,MOST_DETAILED_PRELOAD:6,MOST_DETAILED_PICK:7,NUMBER_OF_PASSES:8},nge=new Array(tge.NUMBER_OF_PASSES);nge[tge.RENDER]=Object.freeze({traversal:ege,isRender:!0,requestTiles:!0,ignoreCommands:!1}),nge[tge.PICK]=Object.freeze({traversal:ege,isRender:!1,requestTiles:!1,ignoreCommands:!1}),nge[tge.SHADOW]=Object.freeze({traversal:ege,isRender:!1,requestTiles:!0,ignoreCommands:!1}),nge[tge.PRELOAD]=Object.freeze({traversal:ege,isRender:!1,requestTiles:!0,ignoreCommands:!0}),nge[tge.PRELOAD_FLIGHT]=Object.freeze({traversal:ege,isRender:!1,requestTiles:!0,ignoreCommands:!0}),nge[tge.REQUEST_RENDER_MODE_DEFER_CHECK]=Object.freeze({traversal:ege,isRender:!1,requestTiles:!0,ignoreCommands:!0}),nge[tge.MOST_DETAILED_PRELOAD]=Object.freeze({traversal:g_e,isRender:!1,requestTiles:!0,ignoreCommands:!0}),nge[tge.MOST_DETAILED_PICK]=Object.freeze({traversal:g_e,isRender:!1,requestTiles:!1,ignoreCommands:!1}),tge.getPassOptions=function(e){return nge[e]};var ige=Object.freeze(tge);function oge(e,t){this._tileset=e,this._tile=t,this.featurePropertiesDirty=!1}Object.defineProperties(oge.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},readyPromise:{get:function(){}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){}},metadata:{get:function(){},set:function(e){throw new x("Empty3DTileContent cannot have content metadata")}},batchTable:{get:function(){}},group:{get:function(){},set:function(e){throw new x("Empty3DTileContent cannot have group metadata")}}}),oge.prototype.hasProperty=function(e,t){return!1},oge.prototype.getFeature=function(e){},oge.prototype.applyDebugSettings=function(e,t){},oge.prototype.applyStyle=function(e){},oge.prototype.update=function(e,t){},oge.prototype.isDestroyed=function(){return!1},oge.prototype.destroy=function(){return Qh(this)};var rge=oge;function sge(e){e=R(e,R.EMPTY_OBJECT);const t=e.content,n=e.class;D.typeOf.object("options.content",t),D.typeOf.object("options.class",n),this._class=n,this._properties=t.properties,this._extensions=t.extensions,this._extras=t.extras}function age(e,t){const n=z8(t,"3DTILES_metadata")?t.extensions["3DTILES_metadata"]:t.metadata;if(!C(n))return;const i=e.schema.classes;if(C(n.class)){const e=i[n.class];return new sge({content:n,class:e})}}function cge(e,t){const n=e.metadataExtension;if(!C(n))return;const i=n.groups,o=z8(t,"3DTILES_metadata")?t.extensions["3DTILES_metadata"].group:t.group;if("number"===typeof o)return i[o];const r=n.groupIds.findIndex((function(e){return e===o}));return r>=0?i[r]:void 0}function lge(e){e=R(e,R.EMPTY_OBJECT);const t=e.tile,n=e.class;D.typeOf.object("options.tile",t),D.typeOf.object("options.class",n),this._class=n,this._properties=t.properties,this._extensions=t.extensions,this._extras=t.extras}function uge(e,t){const n=z8(t,"3DTILES_metadata")?t.extensions["3DTILES_metadata"]:t.metadata;if(!C(n))return;const i=e.schema.classes;if(C(n.class)){const e=i[n.class];return new lge({tile:n,class:e})}}function hge(e){const t=new Uint8Array(e);let n=WF(t);if("glTF"===n&&(n="glb"),i_e.isBinaryFormat(n))return{contentType:n,binaryPayload:t};const i=dge(t);if(C(i.root))return{contentType:i_e.EXTERNAL_TILESET,jsonPayload:i};if(C(i.asset))return{contentType:i_e.GLTF,jsonPayload:i};if(C(i.tileAvailability))return{contentType:i_e.IMPLICIT_SUBTREE_JSON,jsonPayload:i};throw new Je("Invalid tile content.")}function dge(e){let t;try{t=Fp(e)}catch(n){throw new Je("Invalid tile content.")}return t}function fge(e,t,n,i){this._tileset=e,this._tile=t,this._tilesetResource=n,this._contents=[];const o=C(i.contents)?i.contents:i.content;this._innerContentHeaders=o,this._requestsInFlight=0,this._cancelCount=0;const r=this._innerContentHeaders.length;this._arrayFetchPromises=new Array(r),this._requests=new Array(r),this._innerContentResources=new Array(r),this._serverKeys=new Array(r);for(let s=0;s<r;s++){const e=n.getDerivedResource({url:o[s].uri}),t=vi.getServerKey(e.getUrlComponent());this._innerContentResources[s]=e,this._serverKeys[s]=t}this._contentsFetchedPromise=void 0,this._readyPromise=yn()}function pge(e,t){e._requestsInFlight+=t,e.tileset.statistics.numberOfPendingRequests+=t}function mge(e,t){e._cancelCount++,e._tile._contentState=t,e.tileset.statistics.numberOfPendingRequests-=e._requestsInFlight,e._requestsInFlight=0;const n=e._innerContentHeaders.length;e._arrayFetchPromises=new Array(n)}function _ge(e){const t={};for(let n=0;n<e.length;n++){const i=e[n];C(t[i])?t[i]++:t[i]=1}for(const n in t)if(t.hasOwnProperty(n)&&!vi.serverHasOpenSlots(n,t[n]))return!1;return vi.heapHasOpenSlots(e.length)}function gge(e,t,n,i){const o=e._innerContentResources[t].clone(),r=e.tile,s=function(){return r._priority},a=e._serverKeys[t],c=new jn({throttle:!0,throttleByServer:!0,type:Wn.TILES3D,priorityFunction:s,serverKey:a});return o.request=c,e._requests[t]=c,o.fetchArrayBuffer().then((function(t){if(!(n<e._cancelCount))return pge(e,-1),t})).catch((function(r){n<e._cancelCount||(o.request.state!==Hn.CANCELLED?(pge(e,-1),Age(e,t,r)):mge(e,i))}))}function yge(e){const t=e._cancelCount;Promise.all(e._arrayFetchPromises).then((function(n){if(!(t<e._cancelCount))return n.map((function(t,n){if(C(t))try{return vge(e,t,n)}catch(i){return void Age(e,n,i)}}))})).then((function(t){C(t)?(e._contents=t.filter(C),bge(e),C(e._contentsFetchedPromise)&&e._contentsFetchedPromise.resolve()):C(e._contentsFetchedPromise)&&(e._contentsFetchedPromise.resolve(),e._contentsFetchedPromise=void 0)})).catch((function(t){C(e._contentsFetchedPromise)&&e._contentsFetchedPromise.reject(t)}))}function vge(e,t,n){const i=hge(t);if(i.contentType===i_e.EXTERNAL_TILESET)throw new Je("External tilesets are disallowed inside multiple contents");e._disableSkipLevelOfDetail=e._disableSkipLevelOfDetail||i.contentType===i_e.GEOMETRY||i.contentType===i_e.VECTOR;const o=e._tileset,r=e._innerContentResources[n],s=e._tile;let a;const c=$me[i.contentType];a=C(i.binaryPayload)?c(o,s,r,i.binaryPayload.buffer,0):c(o,s,r,i.jsonPayload);const l=e._innerContentHeaders[n];if(s.hasImplicitContentMetadata){const e=s.implicitSubtree,t=s.implicitCoordinates;a.metadata=e.getContentMetadataView(t,n)}else s.hasImplicitContent||(a.metadata=age(o,l));const u=cge(o,l);return C(u)&&(a.group=new oJ({metadata:u})),a}function bge(e){const t=e._contents.map((function(e){return e.readyPromise}));Promise.all(t).then((function(){e._readyPromise.resolve(e)})).catch((function(t){e._readyPromise.reject(t)}))}function Age(e,t,n){const i=e._tileset,o=e._innerContentResources[t].url,r=C(n.message)?n.message:n.toString();i.tileFailed.numberOfListeners>0?i.tileFailed.raiseEvent({url:o,message:r}):(console.log(`A content failed to load: ${o}`),console.log(`Error: ${r}`))}function wge(e){D.typeOf.object("options",e),D.typeOf.object("options.rectangle",e.rectangle),this.rectangle=_t.clone(e.rectangle),this.minimumHeight=R(e.minimumHeight,0),this.maximumHeight=R(e.maximumHeight,0),this.southwestCornerCartesian=new K,this.northeastCornerCartesian=new K,this.westNormal=new K,this.southNormal=new K,this.eastNormal=new K,this.northNormal=new K;const t=R(e.ellipsoid,ge.WGS84);Rge(this,e.rectangle,t),this._orientedBoundingBox=void 0,this._boundingSphere=void 0,R(e.computeBoundingVolumes,!0)&&this.computeBoundingVolumes(t)}Object.defineProperties(sge.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),sge.prototype.hasProperty=function(e){return q8.hasProperty(e,this._properties,this._class)},sge.prototype.hasPropertyBySemantic=function(e){return q8.hasPropertyBySemantic(e,this._properties,this._class)},sge.prototype.getPropertyIds=function(e){return q8.getPropertyIds(this._properties,this._class,e)},sge.prototype.getProperty=function(e){return q8.getProperty(e,this._properties,this._class)},sge.prototype.setProperty=function(e,t){return q8.setProperty(e,t,this._properties,this._class)},sge.prototype.getPropertyBySemantic=function(e){return q8.getPropertyBySemantic(e,this._properties,this._class)},sge.prototype.setPropertyBySemantic=function(e,t){return q8.setPropertyBySemantic(e,t,this._properties,this._class)},Object.defineProperties(lge.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),lge.prototype.hasProperty=function(e){return q8.hasProperty(e,this._properties,this._class)},lge.prototype.hasPropertyBySemantic=function(e){return q8.hasPropertyBySemantic(e,this._properties,this._class)},lge.prototype.getPropertyIds=function(e){return q8.getPropertyIds(this._properties,this._class,e)},lge.prototype.getProperty=function(e){return q8.getProperty(e,this._properties,this._class)},lge.prototype.setProperty=function(e,t){return q8.setProperty(e,t,this._properties,this._class)},lge.prototype.getPropertyBySemantic=function(e){return q8.getPropertyBySemantic(e,this._properties,this._class)},lge.prototype.setPropertyBySemantic=function(e,t){return q8.setPropertyBySemantic(e,t,this._properties,this._class)},Object.defineProperties(fge.prototype,{featurePropertiesDirty:{get:function(){const e=this._contents,t=e.length;for(let n=0;n<t;++n)if(e[n].featurePropertiesDirty)return!0;return!1},set:function(e){const t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].featurePropertiesDirty=e}},featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){return this._contents}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){}},metadata:{get:function(){},set:function(){throw new x("Multiple3DTileContent cannot have metadata")}},batchTable:{get:function(){}},group:{get:function(){},set:function(){throw new x("Multiple3DTileContent cannot have group metadata")}},innerContentUrls:{get:function(){return this._innerContentHeaders.map((function(e){return e.uri}))}},contentsFetchedPromise:{get:function(){if(C(this._contentsFetchedPromise))return this._contentsFetchedPromise.promise}}}),fge.prototype.requestInnerContents=function(){if(!_ge(this._serverKeys))return this._serverKeys.length;const e=this._innerContentHeaders;pge(this,e.length);for(let t=0;t<e.length;t++)this._arrayFetchPromises[t]=gge(this,t,this._cancelCount,this._tile._contentState);return C(this._contentsFetchedPromise)||(this._contentsFetchedPromise=yn()),yge(this),0},fge.prototype.cancelRequests=function(){for(let e=0;e<this._requests.length;e++){const t=this._requests[e];C(t)&&t.cancel()}},fge.prototype.hasProperty=function(e,t){return!1},fge.prototype.getFeature=function(e){},fge.prototype.applyDebugSettings=function(e,t){const n=this._contents,i=n.length;for(let o=0;o<i;++o)n[o].applyDebugSettings(e,t)},fge.prototype.applyStyle=function(e){const t=this._contents,n=t.length;for(let i=0;i<n;++i)t[i].applyStyle(e)},fge.prototype.update=function(e,t){const n=this._contents,i=n.length;for(let o=0;o<i;++o)n[o].update(e,t)},fge.prototype.isDestroyed=function(){return!1},fge.prototype.destroy=function(){const e=this._contents,t=e.length;for(let n=0;n<t;++n)e[n].destroy();return Qh(this)},Object.defineProperties(wge.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}}),wge.prototype.computeBoundingVolumes=function(e){this._orientedBoundingBox=$u.fromRectangle(this.rectangle,this.minimumHeight,this.maximumHeight,e),this._boundingSphere=nn.fromOrientedBoundingBox(this._orientedBoundingBox)};const Tge=new K,Cge=new K,Ege=new K,xge=new K,Sge=new K,Ige=new K,Oge=new se,Dge=new Gs(K.UNIT_X,0),Pge=new os;function Rge(e,t,n){n.cartographicToCartesian(_t.southwest(t),e.southwestCornerCartesian),n.cartographicToCartesian(_t.northeast(t),e.northeastCornerCartesian),Oge.longitude=t.west,Oge.latitude=.5*(t.south+t.north),Oge.height=0;const i=n.cartographicToCartesian(Oge,Sge),o=K.cross(i,K.UNIT_Z,Tge);K.normalize(o,e.westNormal),Oge.longitude=t.east;const r=n.cartographicToCartesian(Oge,Ige),s=K.cross(K.UNIT_Z,r,Tge);K.normalize(s,e.eastNormal);const a=K.subtract(i,r,Tge),c=K.normalize(a,xge),l=t.south;let u;if(l>0){Oge.longitude=.5*(t.west+t.east),Oge.latitude=l;const i=n.cartographicToCartesian(Oge,Pge.origin);K.clone(c,Pge.direction);const o=Gs.fromPointNormal(e.southwestCornerCartesian,e.westNormal,Dge);Ns.rayPlane(Pge,o,e.southwestCornerCartesian),u=n.geodeticSurfaceNormal(i,Cge)}else u=n.geodeticSurfaceNormalCartographic(_t.southeast(t),Cge);const h=K.cross(u,a,Ege);K.normalize(h,e.southNormal);const d=t.north;let f;if(d<0){Oge.longitude=.5*(t.west+t.east),Oge.latitude=d;const i=n.cartographicToCartesian(Oge,Pge.origin);K.negate(c,Pge.direction);const o=Gs.fromPointNormal(e.northeastCornerCartesian,e.eastNormal,Dge);Ns.rayPlane(Pge,o,e.northeastCornerCartesian),f=n.geodeticSurfaceNormal(i,Cge)}else f=n.geodeticSurfaceNormalCartographic(_t.northwest(t),Cge);const p=K.cross(a,f,Ege);K.normalize(p,e.northNormal)}const Lge=new K,Mge=new K,Bge=new K(0,-1,0),Nge=new K(0,0,-1),Fge=new K;function zge(e,t){const n=t.camera,i=n.positionWC,o=n.positionCartographic;let r,s,a,c=0;if(!_t.contains(e.rectangle,o)){let n=e.southwestCornerCartesian,o=e.northeastCornerCartesian,r=e.westNormal,s=e.southNormal,a=e.eastNormal,l=e.northNormal;t.mode!==ij.SCENE3D&&(n=t.mapProjection.project(_t.southwest(e.rectangle),Lge),n.z=n.y,n.y=n.x,n.x=0,o=t.mapProjection.project(_t.northeast(e.rectangle),Mge),o.z=o.y,o.y=o.x,o.x=0,r=Bge,a=K.UNIT_Y,s=Nge,l=K.UNIT_Z);const u=K.subtract(i,n,Fge),h=K.dot(u,r),d=K.dot(u,s),f=K.subtract(i,o,Fge),p=K.dot(f,a),m=K.dot(f,l);h>0?c+=h*h:p>0&&(c+=p*p),d>0?c+=d*d:m>0&&(c+=m*m)}if(t.mode===ij.SCENE3D?(r=o.height,s=e.minimumHeight,a=e.maximumHeight):(r=i.x,s=0,a=0),r>a){const e=r-a;c+=e*e}else if(r<s){const e=s-r;c+=e*e}return Math.sqrt(c)}wge.prototype.distanceToCamera=function(e){D.defined("frameState",e);const t=zge(this,e);if(e.mode===ij.SCENE3D&&C(this._orientedBoundingBox)){const n=Math.sqrt(this._orientedBoundingBox.distanceSquaredTo(e.camera.positionWC));return Math.max(t,n)}return t},wge.prototype.intersectPlane=function(e){return D.defined("plane",e),this._orientedBoundingBox.intersectPlane(e)},wge.prototype.createDebugVolume=function(e){D.defined("color",e);const t=new ft.clone(ft.IDENTITY),n=new gL({rectangle:this.rectangle,height:this.minimumHeight,extrudedHeight:this.maximumHeight}),i=new Sm({geometry:n,id:"outline",modelMatrix:t,attributes:{color:Iy.fromColor(e)}});return new tY({geometryInstances:i,appearance:new LU({translucent:!1,flat:!0}),asynchronous:!1})};var kge=wge;let Uge=new se;function Vge(e){D.typeOf.object("options",e),D.typeOf.string("options.token",e.token);const t=XL.fromToken(e.token),n=R(e.minimumHeight,0),i=R(e.maximumHeight,0),o=R(e.ellipsoid,ge.WGS84);this.s2Cell=t,this.minimumHeight=n,this.maximumHeight=i,this.ellipsoid=o;const r=Qge(t,n,i,o);this._boundingPlanes=r;const s=dye(r);let a;for(this._vertices=s,this._edgeNormals=new Array(6),this._edgeNormals[0]=mye(r[0],s.slice(0,4)),a=0;a<4;a++)this._edgeNormals[0][a]=K.negate(this._edgeNormals[0][a],this._edgeNormals[0][a]);for(this._edgeNormals[1]=mye(r[1],s.slice(4,8)),a=0;a<4;a++)this._edgeNormals[2+a]=mye(r[2+a],[s[a%4],s[(a+1)%4],s[4+(a+1)%4],s[4+a]]);for(this._planeVertices=[this._vertices.slice(0,4),this._vertices.slice(4,8)],a=0;a<4;a++)this._planeVertices.push([this._vertices[a%4],this._vertices[(a+1)%4],this._vertices[4+(a+1)%4],this._vertices[4+a]]);const c=t.getCenter();Uge=o.cartesianToCartographic(c,Uge),Uge.height=(i+n)/2,this.center=o.cartographicToCartesian(Uge,c),this._boundingSphere=nn.fromPoints(s)}const Hge=new K,Gge=new se,Wge=new K,qge=new se,jge=new K,Yge=new K,Kge=new K,Xge=new K;function Qge(e,t,n,i){const o=new Array(6),r=e.getCenter(),s=i.geodeticSurfaceNormal(r,Hge),a=i.cartesianToCartographic(r,Gge);a.height=n;const c=i.cartographicToCartesian(a,Wge),l=Gs.fromPointNormal(c,s);o[0]=l;let u,h=0;const d=[];let f,p;for(u=0;u<4;u++){f=e.getVertex(u),d[u]=f,p=i.cartesianToCartographic(f,qge),p.height=t;const n=Gs.getPointDistance(l,i.cartographicToCartesian(p,jge));n<h&&(h=n)}const m=Gs.clone(l);for(m.normal=K.negate(m.normal,m.normal),m.distance=-1*m.distance+h,o[1]=m,u=0;u<4;u++){f=d[u];const e=d[(u+1)%4],t=i.geodeticSurfaceNormal(f,Yge),n=K.subtract(e,f,Xge);let r=K.cross(n,t,Kge);r=K.normalize(r,r),o[2+u]=Gs.fromPointNormal(f,r)}return o}let Jge=new K,Zge=new K,$ge=new K,eye=new K,tye=new K,nye=new K;const iye=new K,oye=new K,rye=new K;let sye=new K,aye=new K,cye=new K,lye=new K;const uye=new ke;function hye(e,t,n){Jge=e.normal,Zge=t.normal,$ge=n.normal,eye=K.multiplyByScalar(e.normal,-e.distance,eye),tye=K.multiplyByScalar(t.normal,-t.distance,tye),nye=K.multiplyByScalar(n.normal,-n.distance,nye),sye=K.multiplyByScalar(K.cross(Zge,$ge,iye),K.dot(eye,Jge),sye),aye=K.multiplyByScalar(K.cross($ge,Jge,oye),K.dot(tye,Zge),aye),cye=K.multiplyByScalar(K.cross(Jge,Zge,rye),K.dot(nye,$ge),cye),uye[0]=Jge.x,uye[1]=Zge.x,uye[2]=$ge.x,uye[3]=Jge.y,uye[4]=Zge.y,uye[5]=$ge.y,uye[6]=Jge.z,uye[7]=Zge.z,uye[8]=$ge.z;const i=ke.determinant(uye);return lye=K.add(sye,aye,lye),lye=K.add(lye,cye,lye),new K(lye.x/i,lye.y/i,lye.z/i)}function dye(e){const t=new Array(8);for(let n=0;n<4;n++)t[n]=hye(e[0],e[2+(n+3)%4],e[2+n%4]),t[n+4]=hye(e[1],e[2+(n+3)%4],e[2+n%4]);return t}let fye=new K,pye=new K;function mye(e,t){const n=[];for(let i=0;i<4;i++)fye=K.subtract(t[(i+1)%4],t[i],fye),pye=K.cross(e.normal,fye,pye),pye=K.normalize(pye,pye),n[i]=K.clone(pye);return n}Object.defineProperties(Vge.prototype,{boundingVolume:{get:function(){return this}},boundingSphere:{get:function(){return this._boundingSphere}}});const _ye=new K;Vge.prototype.distanceToCamera=function(e){D.defined("frameState",e);const t=e.camera.positionWC,n=[],i=[];let o,r,s,a,c;for(Gs.getPointDistance(this._boundingPlanes[0],t)>0?(n.push(0),i.push(this._planeVertices[0]),o=this._edgeNormals[0]):Gs.getPointDistance(this._boundingPlanes[1],t)>0&&(n.push(1),i.push(this._planeVertices[1]),o=this._edgeNormals[1]),r=0;r<4;r++)s=2+r,Gs.getPointDistance(this._boundingPlanes[s],t)>0&&(n.push(s),i.push(this._planeVertices[s]),o=this._edgeNormals[s]);if(0===n.length)return 0;if(1===n.length)return c=this._boundingPlanes[n[0]],a=Aye(Gs.projectPointOntoPlane(c,t,_ye),i[0],c,o),K.distance(a,t);if(2===n.length){if(0===n[0]){const e=[this._vertices[4*n[0]+(n[1]-2)],this._vertices[4*n[0]+(n[1]-2+1)%4]];return a=vye(t,e[0],e[1]),K.distance(a,t)}let e,o=Number.MAX_VALUE;for(r=0;r<2;r++)c=this._boundingPlanes[n[r]],a=Aye(Gs.projectPointOntoPlane(c,t,_ye),i[r],c,this._edgeNormals[n[r]]),e=K.distanceSquared(a,t),e<o&&(o=e);return Math.sqrt(o)}if(n.length>3)return a=Aye(Gs.projectPointOntoPlane(this._boundingPlanes[1],t,_ye),this._planeVertices[1],this._boundingPlanes[1],this._edgeNormals[1]),K.distance(a,t);const l=2===n[1]&&5===n[2]?0:1;return 0===n[0]?K.distance(t,this._vertices[(n[1]-2+l)%4]):K.distance(t,this._vertices[4+(n[1]-2+l)%4])};const gye=new K,yye=new K;function vye(e,t,n){const i=K.subtract(n,t,gye),o=K.subtract(e,t,yye);let r=K.dot(i,o);if(r<=0)return t;const s=K.dot(i,i);return r>=s?n:(r/=s,new K((1-r)*t.x+r*n.x,(1-r)*t.y+r*n.y,(1-r)*t.z+r*n.z))}const bye=new Gs(K.UNIT_X,0);function Aye(e,t,n,i){let o,r,s,a=Number.MAX_VALUE;for(let c=0;c<t.length;c++){const n=Gs.fromPointNormal(t[c],i[c],bye),l=Gs.getPointDistance(n,e);l<0||(s=vye(e,t[c],t[(c+1)%4]),o=K.distance(e,s),o<a&&(a=o,r=s))}return C(r)?r:e}Vge.prototype.intersectPlane=function(e){D.defined("plane",e);let t=0,n=0;for(let i=0;i<this._vertices.length;i++){const o=K.dot(e.normal,this._vertices[i])+e.distance;o<0?n++:t++}return t===this._vertices.length?Ae.INSIDE:n===this._vertices.length?Ae.OUTSIDE:Ae.INTERSECTING},Vge.prototype.createDebugVolume=function(e){D.defined("color",e);const t=new ft.clone(ft.IDENTITY),n=new Ub({polygonHierarchy:{positions:this._planeVertices[0]}}),i=Ub.createGeometry(n),o=new Sm({geometry:i,id:"outline",modelMatrix:t,attributes:{color:Iy.fromColor(e)}}),r=new Ub({polygonHierarchy:{positions:this._planeVertices[1]}}),s=Ub.createGeometry(r),a=new Sm({geometry:s,id:"outline",modelMatrix:t,attributes:{color:Iy.fromColor(e)}}),c=[];for(let l=0;l<4;l++){const n=new Ub({polygonHierarchy:{positions:this._planeVertices[2+l]}}),i=Ub.createGeometry(n);c[l]=new Sm({geometry:i,id:"outline",modelMatrix:t,attributes:{color:Iy.fromColor(e)}})}return new tY({geometryInstances:[c[0],c[1],c[2],c[3],a,o],appearance:new LU({translucent:!1,flat:!0}),asynchronous:!1})};var wye=Vge;function Tye(e,t){0===t&&(t=z.EPSILON7),this._boundingSphere=new nn(e,t)}Object.defineProperties(Tye.prototype,{center:{get:function(){return this._boundingSphere.center}},radius:{get:function(){return this._boundingSphere.radius}},boundingVolume:{get:function(){return this._boundingSphere}},boundingSphere:{get:function(){return this._boundingSphere}}}),Tye.prototype.distanceToCamera=function(e){D.defined("frameState",e);const t=this._boundingSphere;return Math.max(0,K.distance(t.center,e.camera.positionWC)-t.radius)},Tye.prototype.intersectPlane=function(e){return D.defined("plane",e),nn.intersectPlane(this._boundingSphere,e)},Tye.prototype.update=function(e,t){K.clone(e,this._boundingSphere.center),this._boundingSphere.radius=t},Tye.prototype.createDebugVolume=function(e){D.defined("color",e);const t=new bN({radius:this.radius}),n=ft.fromTranslation(this.center,new ft.clone(ft.IDENTITY)),i=new Sm({geometry:t,id:"outline",modelMatrix:n,attributes:{color:Iy.fromColor(e)}});return new tY({geometryInstances:i,appearance:new LU({translucent:!1,flat:!0}),asynchronous:!1})};var Cye=Tye;const Eye=new K,xye=new K,Sye=new K,Iye=new K;function Oye(e,t,n){n=K.cross(e,t,n);const i=K.magnitude(n);return K.multiplyByScalar(n,z.EPSILON7/i,n)}function Dye(e,t){const n=K.normalize(e,Iye),i=K.equalsEpsilon(n,K.UNIT_X,z.EPSILON6)?K.UNIT_Y:K.UNIT_X;return Oye(e,i,t)}function Pye(e){let t=ke.getColumn(e,0,Eye),n=ke.getColumn(e,1,xye),i=ke.getColumn(e,2,Sye);const o=K.equals(t,K.ZERO),r=K.equals(n,K.ZERO),s=K.equals(i,K.ZERO);return o||r||s?o&&r&&s?(e[0]=z.EPSILON7,e[4]=z.EPSILON7,e[8]=z.EPSILON7,e):(!o||r||s?o||!r||s?o||r||!s?o?r?s||(t=Dye(i,t),n=Oye(i,t,n)):(t=Dye(n,t),i=Oye(n,t,i)):(n=Dye(t,n),i=Oye(n,t,i)):i=Oye(n,t,i):n=Oye(t,i,n):t=Oye(n,i,t),ke.setColumn(e,0,t,e),ke.setColumn(e,1,n,e),ke.setColumn(e,2,i,e),e):e}function Rye(e,t){t=Pye(t),this._orientedBoundingBox=new $u(e,t),this._boundingSphere=nn.fromOrientedBoundingBox(this._orientedBoundingBox)}Object.defineProperties(Rye.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}}),Rye.prototype.distanceToCamera=function(e){return D.defined("frameState",e),Math.sqrt(this._orientedBoundingBox.distanceSquaredTo(e.camera.positionWC))},Rye.prototype.intersectPlane=function(e){return D.defined("plane",e),this._orientedBoundingBox.intersectPlane(e)},Rye.prototype.update=function(e,t){K.clone(e,this._orientedBoundingBox.center),t=Pye(t),ke.clone(t,this._orientedBoundingBox.halfAxes),nn.fromOrientedBoundingBox(this._orientedBoundingBox,this._boundingSphere)},Rye.prototype.createDebugVolume=function(e){D.defined("color",e);const t=new sp({minimum:new K(-1,-1,-1),maximum:new K(1,1,1)}),n=ft.fromRotationTranslation(this.boundingVolume.halfAxes,this.boundingVolume.center),i=new Sm({geometry:t,id:"outline",modelMatrix:n,attributes:{color:Iy.fromColor(e)}});return new tY({geometryInstances:i,appearance:new LU({translucent:!1,flat:!0}),asynchronous:!1})};var Lye=Rye;function Mye(e,t,n,i){this._tileset=e,this._header=n;const o=C(n.contents),r=o&&n.contents.length>1||z8(n,"3DTILES_multiple_contents"),s=o&&!r?n.contents[0]:n.content;this.transform=C(n.transform)?ft.unpack(n.transform):ft.clone(ft.IDENTITY);const a=C(i)?i.computedTransform:e.modelMatrix,c=ft.multiply(a,this.transform,new ft),l=C(i)?i._initialTransform:ft.IDENTITY;let u,h,d,f;this._initialTransform=ft.multiply(l,this.transform,new ft),this.computedTransform=c,this._boundingVolume=this.createBoundingVolume(n.boundingVolume,c),this._boundingVolume2D=void 0,C(s)&&C(s.boundingVolume)&&(u=this.createBoundingVolume(s.boundingVolume,c)),this._contentBoundingVolume=u,this._contentBoundingVolume2D=void 0,C(n.viewerRequestVolume)&&(h=this.createBoundingVolume(n.viewerRequestVolume,c)),this._viewerRequestVolume=h,this.geometricError=n.geometricError,this._geometricError=n.geometricError,C(this._geometricError)||(this._geometricError=C(i)?i.geometricError:e._geometricError,Mye._deprecationWarning("geometricErrorUndefined","Required property geometricError is undefined for this tile. Using parent's geometric error instead.")),this.updateGeometricErrorScale(),C(n.refine)?("replace"!==n.refine&&"add"!==n.refine||Mye._deprecationWarning("lowercase-refine",`This tile uses a lowercase refine "${n.refine}". Instead use "${n.refine.toUpperCase()}".`),d="REPLACE"===n.refine.toUpperCase()?wne.REPLACE:wne.ADD):d=C(i)?i.refine:wne.REPLACE,this.refine=d,this.children=[],this.parent=i;let p,m,_,g=!1;if(t=Vi.createIfNeeded(t),r)p=t_e.UNLOADED,m=t.clone();else if(C(s)){let e=s.uri;C(s.url)&&(Mye._deprecationWarning("contentUrl",'This tileset JSON uses the "content.url" property which has been deprecated. Use "content.uri" instead.'),e=s.url),p=t_e.UNLOADED,m=t.getDerivedResource({url:e}),_=vi.getServerKey(m.getUrlComponent())}else f=new rge(e,this),g=!0,p=t_e.READY;this._content=f,this._contentResource=m,this._contentState=p,this._contentReadyToProcessPromise=void 0,this._contentReadyPromise=void 0,this._expiredContent=void 0,this._serverKey=_,this.hasEmptyContent=g,this.hasTilesetContent=!1,this.hasImplicitContent=!1,this.hasImplicitContentMetadata=!1,this.hasMultipleContents=r,this.metadata=uge(e,n),this.cacheNode=void 0;const y=n.expire;let v,b;C(y)&&(v=y.duration,C(y.date)&&(b=Ea.fromIso8601(y.date))),this.expireDuration=v,this.expireDate=b,this.lastStyleTime=0,this._optimChildrenWithinParent=r_e.NOT_COMPUTED,this.clippingPlanesDirty=!1,this.priorityDeferred=!1,this.implicitTileset=void 0,this.implicitCoordinates=void 0,this.implicitSubtree=void 0,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._screenSpaceErrorProgressiveResolution=0,this._visibilityPlaneMask=0,this._visible=!1,this._inRequestVolume=!1,this._finalResolution=!0,this._depth=0,this._stackLength=0,this._selectionDepth=0,this._updatedVisibilityFrame=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._shouldSelect=!1,this._isClipped=!0,this._clippingPlanesState=0,this._debugBoundingVolume=void 0,this._debugContentBoundingVolume=void 0,this._debugViewerRequestVolume=void 0,this._debugColor=xy.fromRandom({alpha:1}),this._debugColorizeTiles=!1,this._priority=0,this._priorityHolder=this,this._priorityProgressiveResolution=!1,this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1,this._priorityReverseScreenSpaceError=0,this._foveatedFactor=0,this._wasMinPriorityChild=!1,this._loadTimestamp=new Ea,this._commandsLength=0,this._color=void 0,this._colorDirty=!1,this._request=void 0}Mye._deprecationWarning=UF,Object.defineProperties(Mye.prototype,{tileset:{get:function(){return this._tileset}},content:{get:function(){return this._content}},boundingVolume:{get:function(){return this._boundingVolume}},contentBoundingVolume:{get:function(){return R(this._contentBoundingVolume,this._boundingVolume)}},boundingSphere:{get:function(){return this._boundingVolume.boundingSphere}},extras:{get:function(){return this._header.extras}},color:{get:function(){return C(this._color)||(this._color=new xy),xy.clone(this._color)},set:function(e){this._color=xy.clone(e,this._color),this._colorDirty=!0}},contentAvailable:{get:function(){return this.contentReady&&!this.hasEmptyContent&&!this.hasTilesetContent&&!this.hasImplicitContent||C(this._expiredContent)&&!this.contentFailed}},contentReady:{get:function(){return this._contentState===t_e.READY}},contentUnloaded:{get:function(){return this._contentState===t_e.UNLOADED}},contentExpired:{get:function(){return this._contentState===t_e.EXPIRED}},contentFailed:{get:function(){return this._contentState===t_e.FAILED}},contentReadyToProcessPromise:{get:function(){if(C(this._contentReadyToProcessPromise))return this._contentReadyToProcessPromise.promise}},contentReadyPromise:{get:function(){if(C(this._contentReadyPromise))return this._contentReadyPromise.promise}},commandsLength:{get:function(){return this._commandsLength}}});const Bye=new K;function Nye(e,t){const n=e._tileset,i=t.camera,o=e.boundingSphere,r=o.radius,s=K.multiplyByScalar(i.directionWC,e._centerZDepth,Bye),a=K.add(i.positionWC,s,Bye),c=K.subtract(a,o.center,Bye),l=K.magnitude(c),u=l>r;if(u){const t=K.normalize(c,Bye),n=K.multiplyByScalar(t,r,Bye),s=K.add(o.center,n,Bye),a=K.subtract(s,i.positionWC,Bye),l=K.normalize(a,Bye);e._foveatedFactor=1-Math.abs(K.dot(i.directionWC,l))}else e._foveatedFactor=0;const h=e.refine===wne.REPLACE,d=n._skipLevelOfDetail;if(h&&!d||!n.foveatedScreenSpaceError||1===n.foveatedConeSize||e._priorityProgressiveResolution&&h&&d||n._pass===ige.PRELOAD_FLIGHT||n._pass===ige.PRELOAD)return!1;const f=1-Math.cos(.5*i.frustum.fov),p=n.foveatedConeSize*f;if(e._foveatedFactor<=p)return!1;const m=f-p,_=z.clamp((e._foveatedFactor-p)/m,0,1),g=n.foveatedInterpolationCallback(n.foveatedMinimumScreenSpaceErrorRelaxation,n.maximumScreenSpaceError,_),y=0===e._screenSpaceError&&C(e.parent)?.5*e.parent._screenSpaceError:e._screenSpaceError;return n.maximumScreenSpaceError-g<=y}const Fye=new Ea;function zye(e,t){if(e.progressiveResolutionHeightFraction<=0||e.progressiveResolutionHeightFraction>.5)return!1;let n=t._screenSpaceErrorProgressiveResolution>e._maximumScreenSpaceError;t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1;const i=t.parent,o=e._maximumScreenSpaceError,r=t._screenSpaceErrorProgressiveResolution<=o,s=C(i)&&i._screenSpaceErrorProgressiveResolution>o;return r&&s&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!0,n=!0),n}function kye(e,t){const n=t.parent,i=C(n)&&(!e._skipLevelOfDetail||0===t._screenSpaceError||n.hasTilesetContent||n.hasImplicitContent),o=i?n._screenSpaceError:t._screenSpaceError;return e.root._screenSpaceError-o}function Uye(e){if(C(e.expireDuration)){const t=Ea.now(Fye);Ea.addSeconds(t,e.expireDuration,t),C(e.expireDate)?Ea.lessThan(e.expireDate,t)&&Ea.clone(t,e.expireDate):e.expireDate=Ea.clone(t)}}function Vye(e){return function(){return e._priority}}function Hye(e){let t=e._content;const n=e._tileset;if(!C(t)){const i=z8(e._header,"3DTILES_multiple_contents")?e._header.extensions["3DTILES_multiple_contents"]:e._header;t=new fge(n,e,e._contentResource.clone(),i),e._content=t}const i=t.requestInnerContents();return i>0?i:(e._contentState=t_e.LOADING,e._contentReadyToProcessPromise=yn(),e._contentReadyPromise=yn(),t.contentsFetchedPromise.then((function(){if(e._contentState===t_e.LOADING){if(!e.isDestroyed())return e._contentState=t_e.PROCESSING,e._contentReadyToProcessPromise.resolve(t),t.readyPromise.then((function(t){e.isDestroyed()?Gye(e,n,"Tile was unloaded while content was processing"):(e._selectedFrame=0,e.lastStyleTime=0,Ea.now(e._loadTimestamp),e._contentState=t_e.READY,e._contentReadyPromise.resolve(t))}));Gye(e,n,"Tile was unloaded while content was loading")}})).catch((function(t){Gye(e,n,t)})),0)}function Gye(e,t,n){e._contentState===t_e.PROCESSING&&--t.statistics.numberOfTilesProcessing,e._contentState=t_e.FAILED,e._contentReadyPromise.reject(n),e._contentReadyToProcessPromise.reject(n)}function Wye(e){const t=e._contentResource.clone(),n=e.contentExpired;n&&t.setQueryParameters({expired:e.expireDate.toString()});const i=new jn({throttle:!0,throttleByServer:!0,type:Wn.TILES3D,priorityFunction:Vye(e),serverKey:e._serverKey});e._request=i,t.request=i;const o=t.fetchArrayBuffer();if(!C(o))return 1;const r=e._contentState,s=e._tileset;return e._contentState=t_e.LOADING,e._contentReadyToProcessPromise=yn(),e._contentReadyPromise=yn(),++s.statistics.numberOfPendingRequests,o.then((function(t){if(e.isDestroyed())return void qye(e,s);const i=jye(e,t);return n&&(e.expireDate=void 0),e._content=i,e._contentState=t_e.PROCESSING,e._contentReadyToProcessPromise.resolve(i),--s.statistics.numberOfPendingRequests,i.readyPromise.then((function(t){e.isDestroyed()?qye(e,s):(Uye(e),e._selectedFrame=0,e.lastStyleTime=0,Ea.now(e._loadTimestamp),e._contentState=t_e.READY,e._contentReadyPromise.resolve(t))}))})).catch((function(t){if(i.state===Hn.CANCELLED)return e._contentState=r,--s.statistics.numberOfPendingRequests,void++s.statistics.numberOfAttemptedRequests;qye(e,s,t)})),0}function qye(e,t,n){e._contentState===t_e.PROCESSING?--t.statistics.numberOfTilesProcessing:--t.statistics.numberOfPendingRequests,e._contentState=t_e.FAILED,e._contentReadyPromise.reject(n),e._contentReadyToProcessPromise.reject(n)}function jye(e,t){const n=hge(t),i=e._tileset;let o;i._disableSkipLevelOfDetail=i._disableSkipLevelOfDetail||n.contentType===i_e.GEOMETRY||n.contentType===i_e.VECTOR,n.contentType!==i_e.IMPLICIT_SUBTREE&&n.contentType!==i_e.IMPLICIT_SUBTREE_JSON||(e.hasImplicitContent=!0),n.contentType===i_e.EXTERNAL_TILESET&&(e.hasTilesetContent=!0);const r=$me[n.contentType];o=C(n.binaryPayload)?r(i,e,e._contentResource,n.binaryPayload.buffer,0):r(i,e,e._contentResource,n.jsonPayload);const s=C(e._header.contents)?e._header.contents[0]:e._header.content;if(e.hasImplicitContentMetadata){const t=e.implicitSubtree,n=e.implicitCoordinates;o.metadata=t.getContentMetadataView(n,0)}else e.hasImplicitContent||(o.metadata=age(i,s));const a=cge(i,s);return C(a)&&(o.group=new oJ({metadata:a})),o}Mye.prototype.getScreenSpaceError=function(e,t,n){const i=this._tileset,o=R(n,1),r=C(this.parent)?this.parent.geometricError:i._geometricError,s=t?r:this.geometricError;if(0===s)return 0;const a=e.camera;let c=a.frustum;const l=e.context,u=l.drawingBufferWidth,h=l.drawingBufferHeight*o;let d;if(e.mode===ij.SCENE2D||c instanceof jC){C(c._offCenterFrustum)&&(c=c._offCenterFrustum);const e=Math.max(c.top-c.bottom,c.right-c.left)/Math.max(u,h);d=s/e}else{const e=Math.max(this._distanceToCamera,z.EPSILON7),t=a.frustum.sseDenominator;if(d=s*h/(e*t),i.dynamicScreenSpaceError){const t=i._dynamicScreenSpaceErrorComputedDensity,n=i.dynamicScreenSpaceErrorFactor,o=z.fog(e,t)*n;d-=o}}return d/=e.pixelRatio,d},Mye.prototype.updateVisibility=function(e){const t=this.parent,n=this._tileset,i=C(t)?t.computedTransform:n.modelMatrix,o=C(t)?t._visibilityPlaneMask:CT.MASK_INDETERMINATE;this.updateTransform(i),this._distanceToCamera=this.distanceToTile(e),this._centerZDepth=this.distanceToTileCenter(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._screenSpaceErrorProgressiveResolution=this.getScreenSpaceError(e,!1,n.progressiveResolutionHeightFraction),this._visibilityPlaneMask=this.visibility(e,o),this._visible=this._visibilityPlaneMask!==CT.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._priorityReverseScreenSpaceError=kye(n,this),this._priorityProgressiveResolution=zye(n,this),this.priorityDeferred=Nye(this,e)},Mye.prototype.updateExpiration=function(){if(C(this.expireDate)&&this.contentReady&&!this.hasEmptyContent&&!this.hasMultipleContents){const e=Ea.now(Fye);Ea.lessThan(this.expireDate,e)&&(this._contentState=t_e.EXPIRED,this._expiredContent=this._content)}},Mye.prototype.requestContent=function(){return this.hasEmptyContent?0:this.hasMultipleContents?Hye(this):Wye(this)},Mye.prototype.cancelRequests=function(){this.hasMultipleContents?this._content.cancelRequests():this._request.cancel()},Mye.prototype.unloadContent=function(){this.hasEmptyContent||this.hasTilesetContent||this.hasImplicitContent||(this._content=this._content&&this._content.destroy(),this._contentState=t_e.UNLOADED,this._contentReadyToProcessPromise=void 0,this._contentReadyPromise=void 0,this.lastStyleTime=0,this.clippingPlanesDirty=0===this._clippingPlanesState,this._clippingPlanesState=0,this._debugColorizeTiles=!1,this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy())};const Yye=new nn;function Kye(e,t){if(t.mode!==ij.SCENE3D&&!C(e._boundingVolume2D)){const n=e._boundingVolume.boundingSphere,i=nn.projectTo2D(n,t.mapProjection,Yye);e._boundingVolume2D=new Cye(i.center,i.radius)}return t.mode!==ij.SCENE3D?e._boundingVolume2D:e._boundingVolume}function Xye(e,t){if(t.mode!==ij.SCENE3D&&!C(e._contentBoundingVolume2D)){const n=e._contentBoundingVolume.boundingSphere,i=nn.projectTo2D(n,t.mapProjection,Yye);e._contentBoundingVolume2D=new Cye(i.center,i.radius)}return t.mode!==ij.SCENE3D?e._contentBoundingVolume2D:e._contentBoundingVolume}Mye.prototype.visibility=function(e,t){const n=e.cullingVolume,i=Kye(this,e),o=this._tileset,r=o.clippingPlanes;if(C(r)&&r.enabled){const e=r.computeIntersectionWithBoundingVolume(i,o.clippingPlanesOriginMatrix);if(this._isClipped=e!==Ae.INSIDE,e===Ae.OUTSIDE)return CT.MASK_OUTSIDE}return n.computeVisibilityWithPlaneMask(i,t)},Mye.prototype.contentVisibility=function(e){if(!C(this._contentBoundingVolume))return Ae.INSIDE;if(this._visibilityPlaneMask===CT.MASK_INSIDE)return Ae.INSIDE;const t=e.cullingVolume,n=Xye(this,e),i=this._tileset,o=i.clippingPlanes;if(C(o)&&o.enabled){const e=o.computeIntersectionWithBoundingVolume(n,i.clippingPlanesOriginMatrix);if(this._isClipped=e!==Ae.INSIDE,e===Ae.OUTSIDE)return Ae.OUTSIDE}return t.computeVisibility(n)},Mye.prototype.distanceToTile=function(e){const t=Kye(this,e);return t.distanceToCamera(e)};const Qye=new K;Mye.prototype.distanceToTileCenter=function(e){const t=Kye(this,e),n=t.boundingVolume,i=K.subtract(n.center,e.camera.positionWC,Qye);return K.dot(e.camera.directionWC,i)},Mye.prototype.insideViewerRequestVolume=function(e){const t=this._viewerRequestVolume;return!C(t)||0===t.distanceToCamera(e)};const Jye=new ke,Zye=new K,$ye=new ke,eve=new K,tve=new _t,nve=new $u,ive=new ft;function ove(e,t,n){let i=K.fromElements(e[0],e[1],e[2],eve),o=ke.fromArray(e,3,$ye);i=ft.multiplyByPoint(t,i,i);const r=ft.getMatrix3(t,Jye);return o=ke.multiply(r,o,o),C(n)?(n.update(i,o),n):new Lye(i,o)}function rve(e,t,n,i){const o=_t.unpack(e,0,tve),r=e[4],s=e[5],a=$u.fromRectangle(o,r,s,ge.WGS84,nve);let c=a.center,l=a.halfAxes;t=ft.multiplyTransformation(t,ft.inverseTransformation(n,ive),ive),c=ft.multiplyByPoint(t,c,c);const u=ft.getMatrix3(t,Jye);return l=ke.multiply(u,l,l),C(i)&&i instanceof Lye?(i.update(c,l),i):new Lye(c,l)}function sve(e,t,n,i){if(!ft.equalsEpsilon(t,n,z.EPSILON8))return rve(e,t,n,i);if(C(i))return i;const o=_t.unpack(e,0,tve);return new kge({rectangle:o,minimumHeight:e[4],maximumHeight:e[5]})}function ave(e,t,n){let i=K.fromElements(e[0],e[1],e[2],eve),o=e[3];i=ft.multiplyByPoint(t,i,i);const r=ft.getScale(t,Zye),s=K.maximumComponent(r);return o*=s,C(n)?(n.update(i,o),n):new Cye(i,o)}function cve(e,t,n,i){if(!i.isRender)return;const o=C(e._header.content)&&C(e._header.content.boundingVolume),r=e.hasEmptyContent||e.hasTilesetContent||e.hasImplicitContent,s=t.debugShowBoundingVolume||t.debugShowContentBoundingVolume&&!o;if(s){let t;t=e._finalResolution?r?xy.DARKGRAY:xy.WHITE:xy.YELLOW,C(e._debugBoundingVolume)||(e._debugBoundingVolume=e._boundingVolume.createDebugVolume(t)),e._debugBoundingVolume.update(n);const i=e._debugBoundingVolume.getGeometryInstanceAttributes("outline");i.color=Iy.toValue(t,i.color)}else!s&&C(e._debugBoundingVolume)&&(e._debugBoundingVolume=e._debugBoundingVolume.destroy());t.debugShowContentBoundingVolume&&o?(C(e._debugContentBoundingVolume)||(e._debugContentBoundingVolume=e._contentBoundingVolume.createDebugVolume(xy.BLUE)),e._debugContentBoundingVolume.update(n)):!t.debugShowContentBoundingVolume&&C(e._debugContentBoundingVolume)&&(e._debugContentBoundingVolume=e._debugContentBoundingVolume.destroy()),t.debugShowViewerRequestVolume&&C(e._viewerRequestVolume)?(C(e._debugViewerRequestVolume)||(e._debugViewerRequestVolume=e._viewerRequestVolume.createDebugVolume(xy.YELLOW)),e._debugViewerRequestVolume.update(n)):!t.debugShowViewerRequestVolume&&C(e._debugViewerRequestVolume)&&(e._debugViewerRequestVolume=e._debugViewerRequestVolume.destroy());const a=t.debugColorizeTiles&&!e._debugColorizeTiles||C(t._heatmap.tilePropertyName),c=!t.debugColorizeTiles&&e._debugColorizeTiles;a?(t._heatmap.colorize(e,n),e._debugColorizeTiles=!0,e.color=e._debugColor):c&&(e._debugColorizeTiles=!1,e.color=xy.WHITE),e._colorDirty&&(e._colorDirty=!1,e._content.applyDebugSettings(!0,e._color)),c&&t.makeStyleDirty()}function lve(e,t,n){const i=e._content,o=e._expiredContent;if(!e.hasMultipleContents&&C(o)){if(!e.contentReady)return void o.update(t,n);e._expiredContent.destroy(),e._expiredContent=void 0}i.update(t,n)}function uve(e,t){const n=t.clippingPlanes;let i=0;C(n)&&e._isClipped&&n.enabled&&(i=n.clippingPlanesState),i!==e._clippingPlanesState&&(e._clippingPlanesState=i,e.clippingPlanesDirty=!0)}Mye.prototype.createBoundingVolume=function(e,t,n){if(!C(e))throw new Je("boundingVolume must be defined");if(z8(e,"3DTILES_bounding_volume_S2"))return new wye(e.extensions["3DTILES_bounding_volume_S2"]);if(C(e.box))return ove(e.box,t,n);if(C(e.region))return sve(e.region,t,this._initialTransform,n);if(C(e.sphere))return ave(e.sphere,t,n);throw new Je("boundingVolume must contain a sphere, region, or box")},Mye.prototype.updateTransform=function(e){e=R(e,ft.IDENTITY);const t=ft.multiply(e,this.transform,ive),n=!ft.equals(t,this.computedTransform);if(!n)return;ft.clone(t,this.computedTransform);const i=this._header,o=this._header.content;this._boundingVolume=this.createBoundingVolume(i.boundingVolume,this.computedTransform,this._boundingVolume),C(this._contentBoundingVolume)&&(this._contentBoundingVolume=this.createBoundingVolume(o.boundingVolume,this.computedTransform,this._contentBoundingVolume)),C(this._viewerRequestVolume)&&(this._viewerRequestVolume=this.createBoundingVolume(i.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)),this.updateGeometricErrorScale(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy()},Mye.prototype.updateGeometricErrorScale=function(){const e=ft.getScale(this.computedTransform,Zye),t=K.maximumComponent(e);this.geometricError=this._geometricError*t},Mye.prototype.update=function(e,t,n){const i=t.commandList.length;uve(this,e),cve(this,e,t,n),lve(this,e,t);const o=t.commandList.length,r=o-i;this._commandsLength=r;for(let s=0;s<r;++s){const e=t.commandList[i+s],n=e.pass===HU.TRANSLUCENT;e.depthForTranslucentClassification=n}this.clippingPlanesDirty=!1};const hve=[];function dve(e,t,n){const i=e*Math.pow(10,t),o=parseInt(i);return o*Math.pow(10,n)}function fve(e,t,n){return Math.max(z.normalize(e,t,n)-z.EPSILON7,0)}Mye.prototype.process=function(e,t){const n=t.commandList;t.commandList=hve,this._content.update(e,t),hve.length=0,t.commandList=n},Mye.prototype.updatePriority=function(){const e=this.tileset,t=e.preferLeaves,n=e._minimumPriority,i=e._maximumPriority,o=4,r=1,s=0,a=o,c=s+a,l=o,u=c+l,h=r,d=Math.pow(10,u),f=u+h,p=r,m=Math.pow(10,f),_=f+p,g=Math.pow(10,_);let y=fve(this._depth,n.depth,i.depth);y=t?1-y:y;const v=!e._skipLevelOfDetail&&this.refine===wne.REPLACE,b=v?fve(this._priorityHolder._distanceToCamera,n.distance,i.distance):fve(this._priorityReverseScreenSpaceError,n.reverseScreenSpaceError,i.reverseScreenSpaceError),A=dve(b,a,s),w=this._priorityProgressiveResolution?0:d,T=fve(this._priorityHolder._foveatedFactor,n.foveatedFactor,i.foveatedFactor),C=dve(T,l,c),E=this.priorityDeferred?m:0,x=e._pass===ige.PRELOAD_FLIGHT?0:g;this._priority=y+A+w+C+E+x},Mye.prototype.isDestroyed=function(){return!1},Mye.prototype.destroy=function(){return this._content=this._content&&this._content.destroy(),this._expiredContent=this._expiredContent&&!this._expiredContent.isDestroyed()&&this._expiredContent.destroy(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy(),Qh(this)};var pve=Mye;function mve(e){e=R(e,R.EMPTY_OBJECT);const t=e.id,n=e.group,i=e.class;D.typeOf.object("options.group",n),D.typeOf.object("options.class",i);const o=C(n.properties)?n.properties:{};this._class=i,this._properties=o,this._id=t,this._extras=n.extras,this._extensions=n.extensions}Object.defineProperties(mve.prototype,{class:{get:function(){return this._class}},id:{get:function(){return this._id}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),mve.prototype.hasProperty=function(e){return q8.hasProperty(e,this._properties,this._class)},mve.prototype.hasPropertyBySemantic=function(e){return q8.hasPropertyBySemantic(e,this._properties,this._class)},mve.prototype.getPropertyIds=function(e){return q8.getPropertyIds(this._properties,this._class,e)},mve.prototype.getProperty=function(e){return q8.getProperty(e,this._properties,this._class)},mve.prototype.setProperty=function(e,t){return q8.setProperty(e,t,this._properties,this._class)},mve.prototype.getPropertyBySemantic=function(e){return q8.getPropertyBySemantic(e,this._properties,this._class)},mve.prototype.setPropertyBySemantic=function(e,t){return q8.setPropertyBySemantic(e,t,this._properties,this._class)};var _ve=mve;function gve(e){e=R(e,R.EMPTY_OBJECT);const t=e.tileset,n=e.class;D.typeOf.object("options.tileset",t),D.typeOf.object("options.class",n);const i=C(t.properties)?t.properties:{};this._class=n,this._properties=i,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(gve.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),gve.prototype.hasProperty=function(e){return q8.hasProperty(e,this._properties,this._class)},gve.prototype.hasPropertyBySemantic=function(e){return q8.hasPropertyBySemantic(e,this._properties,this._class)},gve.prototype.getPropertyIds=function(e){return q8.getPropertyIds(this._properties,this._class,e)},gve.prototype.getProperty=function(e){return q8.getProperty(e,this._properties,this._class)},gve.prototype.setProperty=function(e,t){return q8.setProperty(e,t,this._properties,this._class)},gve.prototype.getPropertyBySemantic=function(e){return q8.getPropertyBySemantic(e,this._properties,this._class)},gve.prototype.setPropertyBySemantic=function(e,t){return q8.setPropertyBySemantic(e,t,this._properties,this._class)};var yve=gve;function vve(e){e=R(e,R.EMPTY_OBJECT);const t=e.metadataJson,n=e.schema;D.typeOf.object("options.metadataJson",t),D.typeOf.object("options.schema",n);const i=R(t.metadata,t.tileset);let o;C(i)&&(o=new yve({tileset:i,class:n.classes[i.class]}));let r=[];const s=[],a=t.groups;if(Array.isArray(a)){const e=a.length;for(let t=0;t<e;t++){const e=a[t];s.push(new _ve({group:e,class:n.classes[e.class]}))}}else if(C(a)){r=Object.keys(a).sort();const e=r.length;for(let t=0;t<e;t++){const e=r[t];if(a.hasOwnProperty(e)){const t=a[e];s.push(new _ve({id:e,group:a[e],class:n.classes[t.class]}))}}}this._schema=n,this._groups=s,this._groupIds=r,this._tileset=o,this._statistics=t.statistics,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(vve.prototype,{schema:{get:function(){return this._schema}},groups:{get:function(){return this._groups}},groupIds:{get:function(){return this._groupIds}},tileset:{get:function(){return this._tileset}},statistics:{get:function(){return this._statistics}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});var bve=vve;const Ave={},wve=new K;Ave.checkChildrenWithinParent=function(e){D.typeOf.object("tile",e);const t=e.children,n=t.length,i=e.boundingVolume;if(i instanceof Lye||i instanceof kge){const o=i._orientedBoundingBox;e._optimChildrenWithinParent=r_e.USE_OPTIMIZATION;for(let i=0;i<n;++i){const n=t[i],r=n.boundingVolume;if(!(r instanceof Lye||r instanceof kge)){e._optimChildrenWithinParent=r_e.SKIP_OPTIMIZATION;break}const s=r._orientedBoundingBox,a=K.subtract(s.center,o.center,wve),c=K.magnitude(a);K.divideByScalar(a,c,a);const l=Math.abs(o.halfAxes[0]*a.x)+Math.abs(o.halfAxes[1]*a.y)+Math.abs(o.halfAxes[2]*a.z)+Math.abs(o.halfAxes[3]*a.x)+Math.abs(o.halfAxes[4]*a.y)+Math.abs(o.halfAxes[5]*a.z)+Math.abs(o.halfAxes[6]*a.x)+Math.abs(o.halfAxes[7]*a.y)+Math.abs(o.halfAxes[8]*a.z),u=Math.abs(s.halfAxes[0]*a.x)+Math.abs(s.halfAxes[1]*a.y)+Math.abs(s.halfAxes[2]*a.z)+Math.abs(s.halfAxes[3]*a.x)+Math.abs(s.halfAxes[4]*a.y)+Math.abs(s.halfAxes[5]*a.z)+Math.abs(s.halfAxes[6]*a.x)+Math.abs(s.halfAxes[7]*a.y)+Math.abs(s.halfAxes[8]*a.z);if(l<=u+c){e._optimChildrenWithinParent=r_e.SKIP_OPTIMIZATION;break}}}return e._optimChildrenWithinParent===r_e.USE_OPTIMIZATION};var Tve=Ave;function Cve(){this._list=new nC,this._sentinel=this._list.add(),this._trimTiles=!1}Cve.prototype.reset=function(){this._list.splice(this._list.tail,this._sentinel)},Cve.prototype.touch=function(e){const t=e.cacheNode;C(t)&&this._list.splice(this._sentinel,t)},Cve.prototype.add=function(e){C(e.cacheNode)||(e.cacheNode=this._list.add(e))},Cve.prototype.unloadTile=function(e,t,n){const i=t.cacheNode;C(i)&&(this._list.remove(i),t.cacheNode=void 0,n(e,t))},Cve.prototype.unloadTiles=function(e,t){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,o=1024*e.maximumMemoryUsage*1024,r=this._sentinel;let s=i.head;while(s!==r&&(e.totalMemoryUsageInBytes>o||n)){const n=s.item;s=s.next,this.unloadTile(e,n,t)}},Cve.prototype.trim=function(){this._trimTiles=!0};var Eve=Cve;function xve(e){this.tilePropertyName=e,this._minimum=Number.MAX_VALUE,this._maximum=-Number.MAX_VALUE,this._previousMinimum=Number.MAX_VALUE,this._previousMaximum=-Number.MAX_VALUE,this._referenceMinimum={},this._referenceMaximum={}}function Sve(e,t){let n;return n="_loadTimestamp"===t?Ea.toDate(e).getTime():e,n}function Ive(e,t){const n=e.tilePropertyName;if(C(n)){const i=Sve(t[n],n);return C(i)?(e._maximum=Math.max(i,e._maximum),e._minimum=Math.min(i,e._minimum),i):(e.tilePropertyName=void 0,i)}}xve.prototype.setReferenceMinimumMaximum=function(e,t,n){this._referenceMinimum[n]=Sve(e,n),this._referenceMaximum[n]=Sve(t,n)};const Ove=[new xy(.1,.1,.1,1),new xy(.153,.278,.878,1),new xy(.827,.231,.49,1),new xy(.827,.188,.22,1),new xy(1,.592,.259,1),new xy(1,.843,0,1)];xve.prototype.colorize=function(e,t){const n=this.tilePropertyName;if(!C(n)||!e.contentAvailable||e._selectedFrame!==t.frameNumber)return;const i=Ive(this,e),o=this._previousMinimum,r=this._previousMaximum;if(o===Number.MAX_VALUE||r===-Number.MAX_VALUE)return;const s=r-o+z.EPSILON7,a=z.clamp(i-o,0,s),c=a/s,l=Ove.length-1,u=c*l,h=Math.floor(u),d=Math.ceil(u),f=u-h,p=Ove[h],m=Ove[d],_=xy.clone(xy.WHITE);_.red=z.lerp(p.red,m.red,f),_.green=z.lerp(p.green,m.green,f),_.blue=z.lerp(p.blue,m.blue,f),e._debugColor=_},xve.prototype.resetMinimumMaximum=function(){const e=this.tilePropertyName;if(C(e)){const t=this._referenceMinimum[e],n=this._referenceMaximum[e],i=C(t)&&C(n);this._previousMinimum=i?t:this._minimum,this._previousMaximum=i?n:this._maximum,this._minimum=Number.MAX_VALUE,this._maximum=-Number.MAX_VALUE}};var Dve=xve;function Pve(){this.selected=0,this.visited=0,this.numberOfCommands=0,this.numberOfAttemptedRequests=0,this.numberOfPendingRequests=0,this.numberOfTilesProcessing=0,this.numberOfTilesWithContentReady=0,this.numberOfTilesTotal=0,this.numberOfLoadedTilesTotal=0,this.numberOfFeaturesSelected=0,this.numberOfFeaturesLoaded=0,this.numberOfPointsSelected=0,this.numberOfPointsLoaded=0,this.numberOfTrianglesSelected=0,this.numberOfTilesStyled=0,this.numberOfFeaturesStyled=0,this.numberOfTilesCulledWithChildrenUnion=0,this.geometryByteLength=0,this.texturesByteLength=0,this.batchTableByteLength=0}function Rve(e,t,n,i){const o=t.innerContents,r=t.pointsLength,s=t.trianglesLength,a=t.featuresLength,c=t.geometryByteLength,l=t.texturesByteLength,u=t.batchTableByteLength;if(i?(e.numberOfFeaturesLoaded+=n?-a:a,e.numberOfPointsLoaded+=n?-r:r,e.geometryByteLength+=n?-c:c,e.texturesByteLength+=n?-l:l,e.batchTableByteLength+=n?-u:u):(e.numberOfFeaturesSelected+=n?-a:a,e.numberOfPointsSelected+=n?-r:r,e.numberOfTrianglesSelected+=n?-s:s),C(o)){const t=o.length;for(let r=0;r<t;++r)Rve(e,o[r],n,i)}}Pve.prototype.clear=function(){this.selected=0,this.visited=0,this.numberOfCommands=0,this.numberOfAttemptedRequests=0,this.numberOfFeaturesSelected=0,this.numberOfPointsSelected=0,this.numberOfTrianglesSelected=0,this.numberOfTilesStyled=0,this.numberOfFeaturesStyled=0,this.numberOfTilesCulledWithChildrenUnion=0},Pve.prototype.incrementSelectionCounts=function(e){Rve(this,e,!1,!1)},Pve.prototype.incrementLoadCounts=function(e){Rve(this,e,!1,!0)},Pve.prototype.decrementLoadCounts=function(e){Rve(this,e,!0,!0)},Pve.clone=function(e,t){t.selected=e.selected,t.visited=e.visited,t.numberOfCommands=e.numberOfCommands,t.selected=e.selected,t.numberOfAttemptedRequests=e.numberOfAttemptedRequests,t.numberOfPendingRequests=e.numberOfPendingRequests,t.numberOfTilesProcessing=e.numberOfTilesProcessing,t.numberOfTilesWithContentReady=e.numberOfTilesWithContentReady,t.numberOfTilesTotal=e.numberOfTilesTotal,t.numberOfFeaturesSelected=e.numberOfFeaturesSelected,t.numberOfFeaturesLoaded=e.numberOfFeaturesLoaded,t.numberOfPointsSelected=e.numberOfPointsSelected,t.numberOfPointsLoaded=e.numberOfPointsLoaded,t.numberOfTrianglesSelected=e.numberOfTrianglesSelected,t.numberOfTilesStyled=e.numberOfTilesStyled,t.numberOfFeaturesStyled=e.numberOfFeaturesStyled,t.numberOfTilesCulledWithChildrenUnion=e.numberOfTilesCulledWithChildrenUnion,t.geometryByteLength=e.geometryByteLength,t.texturesByteLength=e.texturesByteLength,t.batchTableByteLength=e.batchTableByteLength};var Lve=Pve;function Mve(){this._style=void 0,this._styleDirty=!1,this._lastStyleTime=0}Object.defineProperties(Mve.prototype,{style:{get:function(){return this._style},set:function(e){e!==this._style&&(this._style=e,this._styleDirty=!0)}}}),Mve.prototype.makeDirty=function(){this._styleDirty=!0},Mve.prototype.resetDirty=function(){this._styleDirty=!1},Mve.prototype.applyStyle=function(e){if(!e.ready)return;if(C(this._style)&&!this._style.ready)return;const t=this._styleDirty;t&&++this._lastStyleTime;const n=this._lastStyleTime,i=e._statistics,o=t?e._selectedTiles:e._selectedTilesToStyle,r=o.length;for(let s=0;s<r;++s){const e=o[s];if(e.lastStyleTime!==n){const t=e.content;e.lastStyleTime=n,t.applyStyle(this._style),i.numberOfFeaturesStyled+=t.featuresLength,++i.numberOfTilesStyled}}};var Bve=Mve;function Nve(e,t,n){const i=z8(t,"3DTILES_implicit_tiling")?t.extensions["3DTILES_implicit_tiling"]:t.implicitTiling;D.typeOf.object("implicitTiling",i),this.baseResource=e,this.geometricError=t.geometricError,this.metadataSchema=n;const o=t.boundingVolume;if(!C(o.box)&&!C(o.region)&&!z8(o,"3DTILES_bounding_volume_S2"))throw new Je("Only box, region and 3DTILES_bounding_volume_S2 are supported for implicit tiling");this.boundingVolume=o,this.refine=t.refine,this.subtreeUriTemplate=new Vi({url:i.subtrees.uri}),this.contentUriTemplates=[],this.contentHeaders=[];const r=Fve(t);for(let s=0;s<r.length;s++){const e=r[s];this.contentHeaders.push(pn(e,!0));const t=new Vi({url:e.uri});this.contentUriTemplates.push(t)}this.contentCount=this.contentHeaders.length,this.tileHeader=zve(t),this.subdivisionScheme=G8[i.subdivisionScheme],this.branchingFactor=G8.getBranchingFactor(this.subdivisionScheme),this.subtreeLevels=i.subtreeLevels,C(i.availableLevels)?this.availableLevels=i.availableLevels:this.availableLevels=i.maximumLevel+1}function Fve(e){if(z8(e,"3DTILES_multiple_contents")){const t=e.extensions["3DTILES_multiple_contents"];return C(t.contents)?t.contents:t.content}return C(e.contents)?e.contents:C(e.content)?[e.content]:[]}function zve(e){const t=pn(e,!0);return C(t.extensions)&&(delete t.extensions["3DTILES_implicit_tiling"],delete t.extensions["3DTILES_multiple_contents"],0===Object.keys(t.extensions).length&&delete t.extensions),delete t.implicitTiling,delete t.contents,delete t.content,t}function kve(e){if(D.typeOf.string("options.subdivisionScheme",e.subdivisionScheme),D.typeOf.number("options.subtreeLevels",e.subtreeLevels),D.typeOf.number("options.level",e.level),D.typeOf.number("options.x",e.x),D.typeOf.number("options.y",e.y),e.subdivisionScheme===G8.OCTREE&&D.typeOf.number("options.z",e.z),e.level<0)throw new x("level must be non-negative");if(e.x<0)throw new x("x must be non-negative");if(e.y<0)throw new x("y must be non-negative");if(e.subdivisionScheme===G8.OCTREE&&e.z<0)throw new x("z must be non-negative");const t=1<<e.level;if(e.x>=t)throw new x("x is out of range");if(e.y>=t)throw new x("y is out of range");if(e.subdivisionScheme===G8.OCTREE&&e.z>=t)throw new x("z is out of range");this.subdivisionScheme=e.subdivisionScheme,this.subtreeLevels=e.subtreeLevels,this.level=e.level,this.x=e.x,this.y=e.y,this.z=void 0,e.subdivisionScheme===G8.OCTREE&&(this.z=e.z)}function Uve(e,t){if(e.subdivisionScheme!==t.subdivisionScheme)throw new x("coordinates must have same subdivisionScheme");if(e.subtreeLevels!==t.subtreeLevels)throw new x("coordinates must have same subtreeLevels")}Object.defineProperties(kve.prototype,{childIndex:{get:function(){let e=0;return e|=1&this.x,e|=(1&this.y)<<1,this.subdivisionScheme===G8.OCTREE&&(e|=(1&this.z)<<2),e}},mortonIndex:{get:function(){return this.subdivisionScheme===G8.OCTREE?PO.encode3D(this.x,this.y,this.z):PO.encode2D(this.x,this.y)}},tileIndex:{get:function(){const e=this.subdivisionScheme===G8.OCTREE?((1<<3*this.level)-1)/7:((1<<2*this.level)-1)/3,t=this.mortonIndex;return e+t}}}),kve.prototype.getDescendantCoordinates=function(e){D.typeOf.object("offsetCoordinates",e),Uve(this,e);const t=this.level+e.level,n=(this.x<<e.level)+e.x,i=(this.y<<e.level)+e.y;if(this.subdivisionScheme===G8.OCTREE){const o=(this.z<<e.level)+e.z;return new kve({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:n,y:i,z:o})}return new kve({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:n,y:i})},kve.prototype.getAncestorCoordinates=function(e){if(D.typeOf.number("offsetLevels",e),e<0)throw new x("offsetLevels must be non-negative");if(e>this.level)throw new x("ancestor cannot be above the tileset root");const t=1<<e,n=this.level-e,i=Math.floor(this.x/t),o=Math.floor(this.y/t);if(this.subdivisionScheme===G8.OCTREE){const e=Math.floor(this.z/t);return new kve({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:n,x:i,y:o,z:e})}return new kve({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:n,x:i,y:o})},kve.prototype.getOffsetCoordinates=function(e){if(D.typeOf.object("descendantCoordinates",e),!this.isEqual(e)&&!this.isAncestor(e))throw new x("this is not an ancestor of descendant");Uve(this,e);const t=e.level-this.level,n=1<<t,i=e.x%n,o=e.y%n;if(this.subdivisionScheme===G8.OCTREE){const r=e.z%n;return new kve({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:i,y:o,z:r})}return new kve({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:i,y:o})},kve.prototype.getChildCoordinates=function(e){D.typeOf.number("childIndex",e);const t=G8.getBranchingFactor(this.subdivisionScheme);if(e<0||t<=e)throw new x(`childIndex must be at least 0 and less than ${t}`);const n=this.level+1,i=2*this.x+e%2,o=2*this.y+Math.floor(e/2)%2;if(this.subdivisionScheme===G8.OCTREE){const t=2*this.z+Math.floor(e/4)%2;return new kve({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:n,x:i,y:o,z:t})}return new kve({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:n,x:i,y:o})},kve.prototype.getSubtreeCoordinates=function(){return this.getAncestorCoordinates(this.level%this.subtreeLevels)},kve.prototype.getParentSubtreeCoordinates=function(){return this.getAncestorCoordinates(this.level%this.subtreeLevels+this.subtreeLevels)},kve.prototype.isAncestor=function(e){D.typeOf.object("descendantCoordinates",e),Uve(this,e);const t=e.level-this.level;if(t<=0)return!1;const n=e.x>>t,i=e.y>>t,o=this.x===n,r=this.y===i;if(this.subdivisionScheme===G8.OCTREE){const n=e.z>>t,i=this.z===n;return o&&r&&i}return o&&r},kve.prototype.isEqual=function(e){return D.typeOf.object("otherCoordinates",e),this.subdivisionScheme===e.subdivisionScheme&&this.subtreeLevels===e.subtreeLevels&&this.level===e.level&&this.x===e.x&&this.y===e.y&&(this.subdivisionScheme!==G8.OCTREE||this.z===e.z)},kve.prototype.isImplicitTilesetRoot=function(){return 0===this.level},kve.prototype.isSubtreeRoot=function(){return this.level%this.subtreeLevels===0},kve.prototype.isBottomOfSubtree=function(){return this.level%this.subtreeLevels===this.subtreeLevels-1},kve.prototype.getTemplateValues=function(){const e={level:this.level,x:this.x,y:this.y};return this.subdivisionScheme===G8.OCTREE&&(e.z=this.z),e};const Vve=[0,0,0];function Hve(e){e=R(e,R.EMPTY_OBJECT),D.defined("options.url",e.url),this._url=void 0,this._basePath=void 0,this._root=void 0,this._resource=void 0,this._asset=void 0,this._properties=void 0,this._geometricError=void 0,this._extensionsUsed=void 0,this._extensions=void 0,this._gltfUpAxis=void 0,this._cache=new Eve,this._processingQueue=[],this._selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._loadTimestamp=void 0,this._timeSinceLoad=0,this._updatedVisibilityFrame=0,this._updatedModelMatrixFrame=0,this._modelMatrixChanged=!1,this._previousModelMatrix=void 0,this._extras=void 0,this._credits=void 0,this._showCreditsOnScreen=R(e.showCreditsOnScreen,!1),this._cullWithChildrenBounds=R(e.cullWithChildrenBounds,!0),this._allTilesAdditive=!0,this._hasMixedContent=!1,this._stencilClearCommand=void 0,this._backfaceCommands=new CO,this._maximumScreenSpaceError=R(e.maximumScreenSpaceError,16),this._maximumMemoryUsage=R(e.maximumMemoryUsage,512),this._styleEngine=new Bve,this._modelMatrix=C(e.modelMatrix)?ft.clone(e.modelMatrix):ft.clone(ft.IDENTITY),this._statistics=new Lve,this._statisticsLast=new Lve,this._statisticsPerPass=new Array(ige.NUMBER_OF_PASSES);for(let s=0;s<ige.NUMBER_OF_PASSES;++s)this._statisticsPerPass[s]=new Lve;this._requestedTilesInFlight=[],this._maximumPriority={foveatedFactor:-Number.MAX_VALUE,depth:-Number.MAX_VALUE,distance:-Number.MAX_VALUE,reverseScreenSpaceError:-Number.MAX_VALUE},this._minimumPriority={foveatedFactor:Number.MAX_VALUE,depth:Number.MAX_VALUE,distance:Number.MAX_VALUE,reverseScreenSpaceError:Number.MAX_VALUE},this._heatmap=new Dve(e.debugHeatmapTilePropertyName),this.cullRequestsWhileMoving=R(e.cullRequestsWhileMoving,!0),this._cullRequestsWhileMoving=!1,this.cullRequestsWhileMovingMultiplier=R(e.cullRequestsWhileMovingMultiplier,60),this.progressiveResolutionHeightFraction=z.clamp(R(e.progressiveResolutionHeightFraction,.3),0,.5),this.preferLeaves=R(e.preferLeaves,!1),this._tilesLoaded=!1,this._initialTilesLoaded=!1,this._tileDebugLabels=void 0,this._readyPromise=yn(),this._classificationType=e.classificationType,this._ellipsoid=R(e.ellipsoid,ge.WGS84),this._initialClippingPlanesOriginMatrix=ft.IDENTITY,this._clippingPlanesOriginMatrix=void 0,this._clippingPlanesOriginMatrixDirty=!0,this._vectorClassificationOnly=R(e.vectorClassificationOnly,!1),this._vectorKeepDecodedPositions=R(e.vectorKeepDecodedPositions,!1),this.preloadWhenHidden=R(e.preloadWhenHidden,!1),this.preloadFlightDestinations=R(e.preloadFlightDestinations,!0),this._pass=void 0,this.dynamicScreenSpaceError=R(e.dynamicScreenSpaceError,!1),this.foveatedScreenSpaceError=R(e.foveatedScreenSpaceError,!0),this._foveatedConeSize=R(e.foveatedConeSize,.1),this._foveatedMinimumScreenSpaceErrorRelaxation=R(e.foveatedMinimumScreenSpaceErrorRelaxation,0),this.foveatedInterpolationCallback=R(e.foveatedInterpolationCallback,z.lerp),this.foveatedTimeDelay=R(e.foveatedTimeDelay,.2),this.dynamicScreenSpaceErrorDensity=.00278,this.dynamicScreenSpaceErrorFactor=4,this.dynamicScreenSpaceErrorHeightFalloff=.25,this._dynamicScreenSpaceErrorComputedDensity=0,this.shadows=R(e.shadows,rj.ENABLED),this.show=R(e.show,!0),this.colorBlendMode=NJ.HIGHLIGHT,this.colorBlendAmount=.5,this._pointCloudShading=new Mie(e.pointCloudShading),this._pointCloudEyeDomeLighting=new Rie,this.loadProgress=new $n,this.allTilesLoaded=new $n,this.initialTilesLoaded=new $n,this.tileLoad=new $n,this.tileUnload=new $n,this.tileFailed=new $n,this.tileVisible=new $n,this.skipLevelOfDetail=R(e.skipLevelOfDetail,!1),this._skipLevelOfDetail=this.skipLevelOfDetail,this._disableSkipLevelOfDetail=!1,this.baseScreenSpaceError=R(e.baseScreenSpaceError,1024),this.skipScreenSpaceErrorFactor=R(e.skipScreenSpaceErrorFactor,16),this.skipLevels=R(e.skipLevels,1),this.immediatelyLoadDesiredLevelOfDetail=R(e.immediatelyLoadDesiredLevelOfDetail,!1),this.loadSiblings=R(e.loadSiblings,!1),this._clippingPlanes=void 0,this.clippingPlanes=e.clippingPlanes;const t=C(e.imageBasedLightingFactor)||C(e.luminanceAtZenith)||C(e.sphericalHarmonicCoefficients)||C(e.specularEnvironmentMaps);C(e.imageBasedLighting)?(this._imageBasedLighting=e.imageBasedLighting,this._shouldDestroyImageBasedLighting=!1):t?(UF("ImageBasedLightingConstructor","Individual image-based lighting parameters were deprecated in Cesium 1.92. They will be removed in version 1.94. Use options.imageBasedLighting instead."),this._imageBasedLighting=new ZQ({imageBasedLightingFactor:e.imageBasedLightingFactor,luminanceAtZenith:e.luminanceAtZenith,sphericalHarmonicCoefficients:e.sphericalHarmonicCoefficients,specularEnvironmentMaps:e.specularEnvironmentMaps}),this._shouldDestroyImageBasedLighting=!0):(this._imageBasedLighting=new ZQ,this._shouldDestroyImageBasedLighting=!0),this.lightColor=e.lightColor,this.backFaceCulling=R(e.backFaceCulling,!0),this.showOutline=R(e.showOutline,!0),this.splitDirection=R(e.splitDirection,T4.NONE),this.debugFreezeFrame=R(e.debugFreezeFrame,!1),this.debugColorizeTiles=R(e.debugColorizeTiles,!1),this.debugWireframe=R(e.debugWireframe,!1),this.debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this.debugShowContentBoundingVolume=R(e.debugShowContentBoundingVolume,!1),this.debugShowViewerRequestVolume=R(e.debugShowViewerRequestVolume,!1),this._tileDebugLabels=void 0,this.debugPickedTileLabelOnly=!1,this.debugPickedTile=void 0,this.debugPickPosition=void 0,this.debugShowGeometricError=R(e.debugShowGeometricError,!1),this.debugShowRenderingStatistics=R(e.debugShowRenderingStatistics,!1),this.debugShowMemoryUsage=R(e.debugShowMemoryUsage,!1),this.debugShowUrl=R(e.debugShowUrl,!1),this.examineVectorLinesFunction=void 0,this._metadataExtension=void 0,this._customShader=e.customShader,this.enableModelExperimental=R(e.enableModelExperimental,MC.enableModelExperimental);let n=R(e.featureIdLabel,"featureId_0");"number"===typeof n&&(n=`featureId_${n}`),this._featureIdLabel=n;let i=R(e.instanceFeatureIdLabel,"instanceFeatureId_0");"number"===typeof i&&(i=`instanceFeatureId_${i}`),this._instanceFeatureIdLabel=i,this._schemaLoader=void 0;const o=this;let r;Promise.resolve(e.url).then((function(e){let t;return r=Vi.createIfNeeded(e),o._resource=r,o._credits=r.credits,"json"===r.extension?t=r.getBaseUri(!0):r.isDataUri&&(t=""),o._url=r.url,o._basePath=t,Hve.loadJson(r)})).then((function(e){return Wve(o,e)})).then((function(e){o._root=o.loadTileset(r,e);const t=C(e.asset.gltfUpAxis)?iJ.fromName(e.asset.gltfUpAxis):iJ.Y,n=e.asset;o._asset=n,o._properties=e.properties,o._geometricError=e.geometricError,o._extensionsUsed=e.extensionsUsed,o._extensions=e.extensions,o._gltfUpAxis=t,o._extras=e.extras;const i=n.extras;if(C(i)&&C(i.cesium)&&C(i.cesium.credits)){const e=i.cesium.credits;let t=o._credits;C(t)||(t=[],o._credits=t);for(let n=0;n<e.length;++n){const i=e[n];t.push(new Tr(i.html,o._showCreditsOnScreen))}}const s=o._root.createBoundingVolume(e.root.boundingVolume,ft.IDENTITY),a=s.boundingSphere.center,c=o._ellipsoid.cartesianToCartographic(a);C(c)&&c.height>bo._defaultMinTerrainHeight&&(o._initialClippingPlanesOriginMatrix=Kl.eastNorthUpToFixedFrame(a)),o._clippingPlanesOriginMatrix=ft.clone(o._initialClippingPlanesOriginMatrix),o._readyPromise.resolve(o)})).catch((function(e){o._readyPromise.reject(e)}))}function Gve(e,t,n,i){const o=C(n.implicitTiling)||z8(n,"3DTILES_implicit_tiling");if(o){const o=e.schema,r=new Nve(t,n,o),s=new kve({subdivisionScheme:r.subdivisionScheme,subtreeLevels:r.subtreeLevels,level:0,x:0,y:0,z:0}),a=r.subtreeUriTemplate.getDerivedResource({templateValues:s.getTemplateValues()}).url,c=!0,l=pn(n,c);l.contents=[{uri:a}],delete l.content,delete l.extensions;const u=new pve(e,t,l,i);return u.implicitTileset=r,u.implicitCoordinates=s,u}return new pve(e,t,n,i)}function Wve(e,t){const n=z8(t,"3DTILES_metadata")?t.extensions["3DTILES_metadata"]:t;let i;if(C(n.schemaUri)){const t=e._resource.getDerivedResource({url:n.schemaUri});i=Ree.loadSchema({resource:t})}else{if(!C(n.schema))return Promise.resolve(t);i=Ree.loadSchema({schema:n.schema})}return e._schemaLoader=i,i.promise.then((function(i){return e._metadataExtension=new bve({schema:i.schema,metadataJson:n}),t}))}kve.fromMortonIndex=function(e,t,n,i){let o;return e===G8.OCTREE?(o=PO.decode3D(i,Vve),new kve({subdivisionScheme:e,subtreeLevels:t,level:n,x:o[0],y:o[1],z:o[2]})):(o=PO.decode2D(i,Vve),new kve({subdivisionScheme:e,subtreeLevels:t,level:n,x:o[0],y:o[1]}))},kve.fromTileIndex=function(e,t,n){let i,o,r;return e===G8.OCTREE?(i=Math.floor(z.log2(7*n+1)/3),o=((1<<3*i)-1)/7,r=n-o):(i=Math.floor(z.log2(3*n+1)/2),o=((1<<2*i)-1)/3,r=n-o),kve.fromMortonIndex(e,t,i,r)},Object.defineProperties(Hve.prototype,{isCesium3DTileset:{get:function(){return!0}},asset:{get:function(){if(!this.ready)throw new x("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._asset}},extensions:{get:function(){if(!this.ready)throw new x("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._extensions}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){_3.setOwner(e,this,"_clippingPlanes")}},properties:{get:function(){if(!this.ready)throw new x("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._properties}},ready:{get:function(){return C(this._root)}},readyPromise:{get:function(){return this._readyPromise.promise}},tilesLoaded:{get:function(){return this._tilesLoaded}},resource:{get:function(){return this._resource}},basePath:{get:function(){return UF("Cesium3DTileset.basePath","Cesium3DTileset.basePath has been deprecated. All tiles are relative to the url of the tileset JSON file that contains them. Use the url property instead."),this._basePath}},style:{get:function(){return this._styleEngine.style},set:function(e){this._styleEngine.style=e}},customShader:{get:function(){return this._customShader},set:function(e){this._customShader=e}},metadataExtension:{get:function(){return this._metadataExtension}},metadata:{get:function(){if(C(this._metadataExtension))return this._metadataExtension.tileset}},schema:{get:function(){if(C(this._metadataExtension))return this._metadataExtension.schema}},maximumScreenSpaceError:{get:function(){return this._maximumScreenSpaceError},set:function(e){D.typeOf.number.greaterThanOrEquals("maximumScreenSpaceError",e,0),this._maximumScreenSpaceError=e}},maximumMemoryUsage:{get:function(){return this._maximumMemoryUsage},set:function(e){D.typeOf.number.greaterThanOrEquals("value",e,0),this._maximumMemoryUsage=e}},pointCloudShading:{get:function(){return this._pointCloudShading},set:function(e){D.defined("pointCloudShading",e),this._pointCloudShading=e}},root:{get:function(){if(!this.ready)throw new x("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._root}},boundingSphere:{get:function(){if(!this.ready)throw new x("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._root.updateTransform(this._modelMatrix),this._root.boundingSphere}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix=ft.clone(e,this._modelMatrix)}},timeSinceLoad:{get:function(){return this._timeSinceLoad}},totalMemoryUsageInBytes:{get:function(){const e=this._statistics;return e.texturesByteLength+e.geometryByteLength+e.batchTableByteLength}},clippingPlanesOriginMatrix:{get:function(){return C(this._clippingPlanesOriginMatrix)?(this._clippingPlanesOriginMatrixDirty&&(ft.multiply(this.root.computedTransform,this._initialClippingPlanesOriginMatrix,this._clippingPlanesOriginMatrix),this._clippingPlanesOriginMatrixDirty=!1),this._clippingPlanesOriginMatrix):ft.IDENTITY}},styleEngine:{get:function(){return this._styleEngine}},statistics:{get:function(){return this._statistics}},classificationType:{get:function(){return this._classificationType}},ellipsoid:{get:function(){return this._ellipsoid}},foveatedConeSize:{get:function(){return this._foveatedConeSize},set:function(e){D.typeOf.number.greaterThanOrEquals("foveatedConeSize",e,0),D.typeOf.number.lessThanOrEquals("foveatedConeSize",e,1),this._foveatedConeSize=e}},foveatedMinimumScreenSpaceErrorRelaxation:{get:function(){return this._foveatedMinimumScreenSpaceErrorRelaxation},set:function(e){D.typeOf.number.greaterThanOrEquals("foveatedMinimumScreenSpaceErrorRelaxation",e,0),D.typeOf.number.lessThanOrEquals("foveatedMinimumScreenSpaceErrorRelaxation",e,this.maximumScreenSpaceError),this._foveatedMinimumScreenSpaceErrorRelaxation=e}},extras:{get:function(){if(!this.ready)throw new x("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._extras}},imageBasedLighting:{get:function(){return this._imageBasedLighting},set:function(e){D.typeOf.object("imageBasedLighting",this._imageBasedLighting),e!==this._imageBasedLighting&&(this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=e,this._shouldDestroyImageBasedLighting=!1)}},imageBasedLightingFactor:{get:function(){return this._imageBasedLighting.imageBasedLightingFactor},set:function(e){this._imageBasedLighting.imageBasedLightingFactor=e}},luminanceAtZenith:{get:function(){return this._imageBasedLighting.luminanceAtZenith},set:function(e){this._imageBasedLighting.luminanceAtZenith=e}},sphericalHarmonicCoefficients:{get:function(){return this._imageBasedLighting.sphericalHarmonicCoefficients},set:function(e){this._imageBasedLighting.sphericalHarmonicCoefficients=e}},specularEnvironmentMaps:{get:function(){return this._imageBasedLighting.specularEnvironmentMaps},set:function(e){this._imageBasedLighting.specularEnvironmentMaps=e}},vectorClassificationOnly:{get:function(){return this._vectorClassificationOnly}},vectorKeepDecodedPositions:{get:function(){return this._vectorKeepDecodedPositions}},showCreditsOnScreen:{get:function(){return this._showCreditsOnScreen},set:function(e){this._showCreditsOnScreen=e}},featureIdLabel:{get:function(){return this._featureIdLabel},set:function(e){"number"===typeof e&&(e=`featureId_${e}`),D.typeOf.string("value",e),this._featureIdLabel=e}},instanceFeatureIdLabel:{get:function(){return this._instanceFeatureIdLabel},set:function(e){"number"===typeof e&&(e=`instanceFeatureId_${e}`),D.typeOf.string("value",e),this._instanceFeatureIdLabel=e}}}),Hve.loadJson=function(e){const t=Vi.createIfNeeded(e);return t.fetchJson()},Hve.prototype.makeStyleDirty=function(){this._styleEngine.makeDirty()},Hve.prototype.loadTileset=function(e,t,n){const i=t.asset;if(!C(i))throw new Je("Tileset must have an asset property.");if("0.0"!==i.version&&"1.0"!==i.version&&"1.1"!==i.version)throw new Je("The tileset must be 3D Tiles version 0.0, 1.0, or 1.1");C(t.extensionsRequired)&&Hve.checkSupportedExtensions(t.extensionsRequired);const o=this._statistics,r=i.tilesetVersion;C(r)&&(this._basePath+=`?v=${r}`,e=e.clone(),e.setQueryParameters({v:r}));const s=Gve(this,e,t.root,n);C(n)&&(n.children.push(s),s._depth=n._depth+1);const a=[];a.push(s);while(a.length>0){const t=a.pop();++o.numberOfTilesTotal,this._allTilesAdditive=this._allTilesAdditive&&t.refine===wne.ADD;const n=t._header.children;if(C(n)){const i=n.length;for(let o=0;o<i;++o){const i=n[o],r=Gve(this,e,i,t);t.children.push(r),r._depth=t._depth+1,a.push(r)}}this._cullWithChildrenBounds&&Tve.checkChildrenWithinParent(t)}return s};const qve=new K,jve=new se,Yve=new ft,Kve=new K,Xve=new K,Qve=new K;function Jve(e,t){let n,i,o,r,s;const a=t.camera,c=e._root,l=c.contentBoundingVolume;if(l instanceof kge)n=K.normalize(a.positionWC,qve),i=a.directionWC,o=a.positionCartographic.height,r=l.minimumHeight,s=l.maximumHeight;else{const e=ft.inverseTransformation(c.computedTransform,Yve),u=t.mapProjection.ellipsoid,h=l.boundingVolume,d=ft.multiplyByPoint(e,h.center,Kve);if(K.magnitude(d)>u.minimumRadius){const e=se.fromCartesian(d,u,jve);n=K.normalize(a.positionWC,qve),i=a.directionWC,o=a.positionCartographic.height,r=0,s=2*e.height}else{const t=ft.multiplyByPoint(e,a.positionWC,Xve);if(n=K.UNIT_Z,i=ft.multiplyByPointAsVector(e,a.directionWC,Qve),i=K.normalize(i,i),o=t.z,l instanceof Lye){const e=c._header.boundingVolume.box[11];r=d.z-e,s=d.z+e}else if(l instanceof Cye){const e=h.radius;r=d.z-e,s=d.z+e}}}const u=e.dynamicScreenSpaceErrorHeightFalloff,h=r+(s-r)*u,d=s,f=z.clamp((o-h)/(d-h),0,1),p=Math.abs(K.dot(i,n));let m=1-p;m*=1-f;let _=e.dynamicScreenSpaceErrorDensity;_*=m,e._dynamicScreenSpaceErrorComputedDensity=_}function Zve(e,t){if(t.hasEmptyContent)return;const n=e._statistics,i=t.contentExpired,o=t.requestContent();o>0?n.numberOfAttemptedRequests+=o:(i&&(t.hasTilesetContent||t.hasImplicitContent?mbe(e,t):(n.decrementLoadCounts(t.content),--n.numberOfTilesWithContentReady)),e._requestedTilesInFlight.push(t),t.contentReadyToProcessPromise.then(nbe(e,t)),t.contentReadyPromise.then(obe(e,t)).catch(ibe(e,t)))}function $ve(e,t){return e._priority-t._priority}function ebe(e,t){const n=e._requestedTilesInFlight;let i=0;const o=n.length;for(let r=0;r<o;++r){const e=n[r],o=t.frameNumber-e._touchedFrame>=1;e._contentState===t_e.LOADING?o?(e.cancelRequests(),++i):i>0&&(n[r-i]=e):++i}n.length-=i}function tbe(e,t){const n=e._requestedTiles,i=n.length;n.sort($ve);for(let o=0;o<i;++o)Zve(e,n[o])}function nbe(e,t){return function(){e._processingQueue.push(t),++e._statistics.numberOfTilesProcessing}}function ibe(e,t){return function(n){const i=t._contentResource.url,o=C(n.message)?n.message:n.toString();e.tileFailed.numberOfListeners>0?e.tileFailed.raiseEvent({url:i,message:o}):(console.log(`A 3D tile failed to load: ${i}`),console.log(`Error: ${o}`))}}function obe(e,t){return function(){--e._statistics.numberOfTilesProcessing,t.hasTilesetContent||t.hasImplicitContent||(e._statistics.incrementLoadCounts(t.content),++e._statistics.numberOfTilesWithContentReady,++e._statistics.numberOfLoadedTilesTotal,e._cache.add(t)),e.tileLoad.raiseEvent(t)}}function rbe(e){const t=e._processingQueue,n=t.length;let i=0;for(let o=0;o<n;++o){const e=t[o];e._contentState===t_e.PROCESSING?i>0&&(t[o-i]=e):++i}t.length-=i}function sbe(e,t){rbe(e);const n=e._processingQueue,i=n.length;for(let o=0;o<i;++o)n[o].process(e,t)}Hve.prototype.postPassesUpdate=function(e){this.ready&&(ebe(this,e),ybe(this,e),this._cache.unloadTiles(this,_be),this._styleEngine.resetDirty())},Hve.prototype.prePassesUpdate=function(e){if(!this.ready)return;sbe(this,e);const t=this._clippingPlanes;this._clippingPlanesOriginMatrixDirty=!0,C(t)&&t.enabled&&t.update(e),C(this._loadTimestamp)||(this._loadTimestamp=Ea.clone(e.time)),this._timeSinceLoad=Math.max(1e3*Ea.secondsDifference(e.time,this._loadTimestamp),0),this._skipLevelOfDetail=this.skipLevelOfDetail&&!C(this._classificationType)&&!this._disableSkipLevelOfDetail&&!this._allTilesAdditive,this.dynamicScreenSpaceError&&Jve(this,e),e.newFrame&&this._cache.reset()};const abe=new K,cbe={maximumFractionDigits:3};function lbe(e){const t=e/1048576;return t<1?t.toLocaleString(void 0,cbe):Math.round(t).toLocaleString()}function ube(e){const t=e.boundingVolume.boundingVolume,n=t.halfAxes,i=t.radius;let o=K.clone(t.center,abe);if(C(n))o.x+=.75*(n[0]+n[3]+n[6]),o.y+=.75*(n[1]+n[4]+n[7]),o.z+=.75*(n[2]+n[5]+n[8]);else if(C(i)){let e=K.normalize(t.center,abe);e=K.multiplyByScalar(e,.75*i,abe),o=K.add(e,t.center,abe)}return o}function hbe(e,t,n){let i="",o=0;if(t.debugShowGeometricError&&(i+=`\nGeometric error: ${e.geometricError}`,o++),t.debugShowRenderingStatistics){i+=`\nCommands: ${e.commandsLength}`,o++;const t=e.content.pointsLength;t>0&&(i+=`\nPoints: ${e.content.pointsLength}`,o++);const n=e.content.trianglesLength;n>0&&(i+=`\nTriangles: ${e.content.trianglesLength}`,o++),i+=`\nFeatures: ${e.content.featuresLength}`,o++}if(t.debugShowMemoryUsage&&(i+=`\nTexture Memory: ${lbe(e.content.texturesByteLength)}`,i+=`\nGeometry Memory: ${lbe(e.content.geometryByteLength)}`,o+=2),t.debugShowUrl)if(e.hasMultipleContents){i+="\nUrls:";const t=e.content.innerContentUrls;for(let e=0;e<t.length;e++)i+=`\n- ${t[e]}`;o+=t.length}else i+=`\nUrl: ${e._header.content.uri}`,o++;const r={text:i.substring(1),position:n,font:19-o+"px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY};return t._tileDebugLabels.add(r)}function dbe(e,t){let n,i;const o=e._selectedTiles,r=o.length,s=e._emptyTiles,a=s.length;if(e._tileDebugLabels.removeAll(),e.debugPickedTileLabelOnly){if(C(e.debugPickedTile)){const t=C(e.debugPickPosition)?e.debugPickPosition:ube(e.debugPickedTile),n=hbe(e.debugPickedTile,e,t);n.pixelOffset=new ro(15,-15)}}else{for(n=0;n<r;++n)i=o[n],hbe(i,e,ube(i));for(n=0;n<a;++n)i=s[n],(i.hasTilesetContent||i.hasImplicitContent)&&hbe(i,e,ube(i))}e._tileDebugLabels.update(t)}function fbe(e,t,n){e._styleEngine.applyStyle(e);const i=n.isRender,o=e._statistics,r=t.commandList,s=r.length,a=e._selectedTiles,c=a.length,l=e._emptyTiles,u=l.length,h=e.tileVisible;let d,f;const p=e._skipLevelOfDetail&&e._hasMixedContent&&t.context.stencilBuffer&&c>0;e._backfaceCommands.length=0,p&&(C(e._stencilClearCommand)||(e._stencilClearCommand=new tJ({stencil:0,pass:HU.CESIUM_3D_TILE,renderState:yV.fromCache({stencilMask:FY.SKIP_LOD_MASK})})),r.push(e._stencilClearCommand));const m=r.length;for(d=0;d<c;++d)f=a[d],i&&h.raiseEvent(f),f.update(e,t,n),o.incrementSelectionCounts(f.content),++o.selected;for(d=0;d<u;++d)f=l[d],f.update(e,t,n);let _=r.length-m;if(e._backfaceCommands.trim(),p){const t=e._backfaceCommands.values,n=t.length;for(r.length+=n,d=_-1;d>=0;--d)r[m+n+d]=r[m+d];for(d=0;d<n;++d)r[m+d]=t[d]}_=r.length-s,o.numberOfCommands=_,i&&e.pointCloudShading.attenuation&&e.pointCloudShading.eyeDomeLighting&&_>0&&e._pointCloudEyeDomeLighting.update(t,s,e.pointCloudShading,e.boundingSphere),i&&(e.debugShowGeometricError||e.debugShowRenderingStatistics||e.debugShowMemoryUsage||e.debugShowUrl?(C(e._tileDebugLabels)||(e._tileDebugLabels=new mae),dbe(e,t)):e._tileDebugLabels=e._tileDebugLabels&&e._tileDebugLabels.destroy())}const pbe=[];function mbe(e,t){const n=t,i=pbe;i.push(t);while(i.length>0){t=i.pop();const o=t.children,r=o.length;for(let e=0;e<r;++e)i.push(o[e]);t!==n&&(gbe(e,t),--e._statistics.numberOfTilesTotal)}n.children=[]}function _be(e,t){e.tileUnload.raiseEvent(t),e._statistics.decrementLoadCounts(t.content),--e._statistics.numberOfTilesWithContentReady,t.unloadContent()}function gbe(e,t){e._cache.unloadTile(e,t,_be),t.destroy()}function ybe(e,t){const n=e._statistics,i=e._statisticsLast,o=n.numberOfPendingRequests,r=n.numberOfTilesProcessing,s=i.numberOfPendingRequests,a=i.numberOfTilesProcessing;Lve.clone(n,i);const c=o!==s||r!==a;c&&t.afterRender.push((function(){e.loadProgress.raiseEvent(o,r)})),e._tilesLoaded=0===n.numberOfPendingRequests&&0===n.numberOfTilesProcessing&&0===n.numberOfAttemptedRequests,c&&e._tilesLoaded&&(t.afterRender.push((function(){e.allTilesLoaded.raiseEvent()})),e._initialTilesLoaded||(e._initialTilesLoaded=!0,t.afterRender.push((function(){e.initialTilesLoaded.raiseEvent()}))))}function vbe(e){e._heatmap.resetMinimumMaximum(),e._minimumPriority.depth=Number.MAX_VALUE,e._maximumPriority.depth=-Number.MAX_VALUE,e._minimumPriority.foveatedFactor=Number.MAX_VALUE,e._maximumPriority.foveatedFactor=-Number.MAX_VALUE,e._minimumPriority.distance=Number.MAX_VALUE,e._maximumPriority.distance=-Number.MAX_VALUE,e._minimumPriority.reverseScreenSpaceError=Number.MAX_VALUE,e._maximumPriority.reverseScreenSpaceError=-Number.MAX_VALUE}function bbe(e,t){t.frameNumber===e._updatedModelMatrixFrame&&C(e._previousModelMatrix)||(e._updatedModelMatrixFrame=t.frameNumber,e._modelMatrixChanged=!ft.equals(e.modelMatrix,e._previousModelMatrix),e._modelMatrixChanged&&(e._previousModelMatrix=ft.clone(e.modelMatrix,e._previousModelMatrix)))}function Abe(e,t,n,i){if(t.mode===ij.MORPHING)return!1;if(!e.ready)return!1;const o=e._statistics;o.clear();const r=i.isRender;++e._updatedVisibilityFrame,vbe(e),bbe(e,t),e._cullRequestsWhileMoving=e.cullRequestsWhileMoving&&!e._modelMatrixChanged;const s=i.traversal.selectTiles(e,t);if(i.requestTiles&&tbe(e),fbe(e,t,i),Lve.clone(o,n),r){const n=e._credits;if(C(n)&&0!==o.selected){const i=n.length;for(let o=0;o<i;++o){const i=n[o];i.showOnScreen=e._showCreditsOnScreen,t.creditDisplay.addCredit(i)}}}return s}Hve.prototype.trimLoadedTiles=function(){this._cache.trim()},Hve.prototype.update=function(e){this.updateForPass(e,e.tilesetPassState)},Hve.prototype.updateForPass=function(e,t){D.typeOf.object("frameState",e),D.typeOf.object("tilesetPassState",t);const n=t.pass;if(n===ige.PRELOAD&&(!this.preloadWhenHidden||this.show)||n===ige.PRELOAD_FLIGHT&&(!this.preloadFlightDestinations||!this.show&&!this.preloadWhenHidden)||n===ige.REQUEST_RENDER_MODE_DEFER_CHECK&&(!this._cullRequestsWhileMoving&&this.foveatedTimeDelay<=0||!this.show))return;const i=e.commandList,o=e.camera,r=e.cullingVolume;t.ready=!1;const s=ige.getPassOptions(n),a=s.ignoreCommands,c=R(t.commandList,i),l=c.length;e.commandList=c,e.camera=R(t.camera,o),e.cullingVolume=R(t.cullingVolume,r);const u=this._statisticsPerPass[n];(this.show||a)&&(this._pass=n,t.ready=Abe(this,e,u,s)),a&&(c.length=l),e.commandList=i,e.camera=o,e.cullingVolume=r},Hve.prototype.hasExtension=function(e){return!!C(this._extensionsUsed)&&this._extensionsUsed.indexOf(e)>-1},Hve.prototype.isDestroyed=function(){return!1},Hve.prototype.destroy=function(){if(this._tileDebugLabels=this._tileDebugLabels&&this._tileDebugLabels.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),C(this._schemaLoader)&&Ree.unload(this._schemaLoader),C(this._root)){const e=pbe;e.push(this._root);while(e.length>0){const t=e.pop();t.destroy();const n=t.children,i=n.length;for(let o=0;o<i;++o)e.push(n[o])}}return this._root=void 0,this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=void 0,Qh(this)},Hve.supportedExtensions={"3DTILES_metadata":!0,"3DTILES_implicit_tiling":!0,"3DTILES_content_gltf":!0,"3DTILES_multiple_contents":!0,"3DTILES_bounding_volume_S2":!0,"3DTILES_batch_table_hierarchy":!0,"3DTILES_draco_point_compression":!0},Hve.checkSupportedExtensions=function(e){for(let t=0;t<e.length;t++)if(!Hve.supportedExtensions[e[t]])throw new Je(`Unsupported 3D Tiles Extension: ${e[t]}`)};var wbe=Hve;const Tbe=new ft;function Cbe(e,t){if(!C(e))throw new x("scene is required.");if(!C(t))throw new x("entityCollection is required.");t.collectionChanged.addEventListener(Cbe.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._tilesetHash={},this._entitiesToVisualize=new ff,this._onCollectionChanged(t,t.values,[],[])}function Ebe(e,t,n,i){const o=n[t.id];C(o)&&(i.removeAndDestroy(o.tilesetPrimitive),delete n[t.id])}function xbe(e,t,n){e.readyPromise.catch((function(e){console.error(e),n[t.id].loadFail=!0}))}Cbe.prototype.update=function(e){if(!C(e))throw new x("time is required.");const t=this._entitiesToVisualize.values,n=this._tilesetHash,i=this._primitives;for(let o=0,r=t.length;o<r;o++){const r=t[o],s=r._tileset;let a,c=n[r.id];const l=r.isShowing&&r.isAvailable(e)&&Bz.getValueOrDefault(s._show,e,!0);let u;if(l&&(u=r.computeModelMatrix(e,Tbe),a=Vi.createIfNeeded(Bz.getValueOrUndefined(s._uri,e))),!l){C(c)&&(c.tilesetPrimitive.show=!1);continue}let h=C(c)?c.tilesetPrimitive:void 0;C(h)&&a.url===c.url||(C(h)&&(i.removeAndDestroy(h),delete n[r.id]),h=new wbe({url:a}),h.id=r,i.add(h),c={tilesetPrimitive:h,url:a.url,loadFail:!1},n[r.id]=c,xbe(h,r,n)),h.show=!0,C(u)&&(h.modelMatrix=u),h.maximumScreenSpaceError=Bz.getValueOrDefault(s.maximumScreenSpaceError,e,h.maximumScreenSpaceError)}return!0},Cbe.prototype.isDestroyed=function(){return!1},Cbe.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Cbe.prototype._onCollectionChanged,this);const e=this._entitiesToVisualize.values,t=this._tilesetHash,n=this._primitives;for(let i=e.length-1;i>-1;i--)Ebe(this,e[i],t,n);return Qh(this)},Cbe.prototype.getBoundingSphere=function(e,t){if(!C(e))throw new x("entity is required.");if(!C(t))throw new x("result is required.");const n=this._tilesetHash[e.id];if(!C(n)||n.loadFail)return Lz.FAILED;const i=n.tilesetPrimitive;return C(i)&&i.show?i.ready?(nn.clone(i.boundingSphere,t),Lz.DONE):Lz.PENDING:Lz.FAILED},Cbe.prototype._onCollectionChanged=function(e,t,n,i){let o,r;const s=this._entitiesToVisualize,a=this._tilesetHash,c=this._primitives;for(o=t.length-1;o>-1;o--)r=t[o],C(r._tileset)&&s.set(r.id,r);for(o=i.length-1;o>-1;o--)r=i[o],C(r._tileset)?s.set(r.id,r):(Ebe(this,r,a,c),s.remove(r.id));for(o=n.length-1;o>-1;o--)r=n[o],Ebe(this,r,a,c),s.remove(r.id)};var Sbe=Cbe;const Ibe=xy.WHITE,Obe=xy.BLACK,Dbe=new ro(2,2);function Pbe(e){e=R(e,R.EMPTY_OBJECT),this._definitionChanged=new $n,this._evenColor=void 0,this._evenColorSubscription=void 0,this._oddColor=void 0,this._oddColorSubscription=void 0,this._repeat=void 0,this._repeatSubscription=void 0,this.evenColor=e.evenColor,this.oddColor=e.oddColor,this.repeat=e.repeat}Object.defineProperties(Pbe.prototype,{isConstant:{get:function(){return Bz.isConstant(this._evenColor)&&Bz.isConstant(this._oddColor)&&Bz.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},evenColor:Tz("evenColor"),oddColor:Tz("oddColor"),repeat:Tz("repeat")}),Pbe.prototype.getType=function(e){return"Checkerboard"},Pbe.prototype.getValue=function(e,t){return C(t)||(t={}),t.lightColor=Bz.getValueOrClonedDefault(this._evenColor,e,Ibe,t.lightColor),t.darkColor=Bz.getValueOrClonedDefault(this._oddColor,e,Obe,t.darkColor),t.repeat=Bz.getValueOrDefault(this._repeat,e,Dbe),t},Pbe.prototype.equals=function(e){return this===e||e instanceof Pbe&&Bz.equals(this._evenColor,e._evenColor)&&Bz.equals(this._oddColor,e._oddColor)&&Bz.equals(this._repeat,e._repeat)};var Rbe=Pbe;const Lbe={id:void 0};function Mbe(e){if(e._firing)e._refire=!0;else if(0===e._suspendCount){const t=e._addedEntities,n=e._removedEntities,i=e._changedEntities;if(0!==i.length||0!==t.length||0!==n.length){e._firing=!0;do{e._refire=!1;const o=t.values.slice(0),r=n.values.slice(0),s=i.values.slice(0);t.removeAll(),n.removeAll(),i.removeAll(),e._collectionChanged.raiseEvent(e,o,r,s)}while(e._refire);e._firing=!1}}}function Bbe(e){this._owner=e,this._entities=new ff,this._addedEntities=new ff,this._removedEntities=new ff,this._changedEntities=new ff,this._suspendCount=0,this._collectionChanged=new $n,this._id=wk(),this._show=!0,this._firing=!1,this._refire=!1}Bbe.prototype.suspendEvents=function(){this._suspendCount++},Bbe.prototype.resumeEvents=function(){if(0===this._suspendCount)throw new x("resumeEvents can not be called before suspendEvents.");this._suspendCount--,Mbe(this)},Bbe.collectionChangedEventCallback=void 0,Object.defineProperties(Bbe.prototype,{collectionChanged:{get:function(){return this._collectionChanged}},id:{get:function(){return this._id}},values:{get:function(){return this._entities.values}},show:{get:function(){return this._show},set:function(e){if(!C(e))throw new x("value is required.");if(e===this._show)return;let t;this.suspendEvents();const n=[],i=this._entities.values,o=i.length;for(t=0;t<o;t++)n.push(i[t].isShowing);for(this._show=e,t=0;t<o;t++){const e=n[t],o=i[t];e!==o.isShowing&&o.definitionChanged.raiseEvent(o,"isShowing",o.isShowing,e)}this.resumeEvents()}},owner:{get:function(){return this._owner}}}),Bbe.prototype.computeAvailability=function(){let e=fO.MAXIMUM_VALUE,t=fO.MINIMUM_VALUE;const n=this._entities.values;for(let i=0,o=n.length;i<o;i++){const o=n[i],r=o.availability;if(C(r)){const n=r.start,i=r.stop;Ea.lessThan(n,e)&&!n.equals(fO.MINIMUM_VALUE)&&(e=n),Ea.greaterThan(i,t)&&!i.equals(fO.MAXIMUM_VALUE)&&(t=i)}}return fO.MAXIMUM_VALUE.equals(e)&&(e=fO.MINIMUM_VALUE),fO.MINIMUM_VALUE.equals(t)&&(t=fO.MAXIMUM_VALUE),new cO({start:e,stop:t})},Bbe.prototype.add=function(e){if(!C(e))throw new x("entity is required.");e instanceof iQ||(e=new iQ(e));const t=e.id,n=this._entities;if(n.contains(t))throw new Je(`An entity with id ${t} already exists in this collection.`);return e.entityCollection=this,n.set(t,e),this._removedEntities.remove(t)||this._addedEntities.set(t,e),e.definitionChanged.addEventListener(Bbe.prototype._onEntityDefinitionChanged,this),Mbe(this),e},Bbe.prototype.remove=function(e){return!!C(e)&&this.removeById(e.id)},Bbe.prototype.contains=function(e){if(!C(e))throw new x("entity is required");return this._entities.get(e.id)===e},Bbe.prototype.removeById=function(e){if(!C(e))return!1;const t=this._entities,n=t.get(e);return!!this._entities.remove(e)&&(this._addedEntities.remove(e)||(this._removedEntities.set(e,n),this._changedEntities.remove(e)),this._entities.remove(e),n.definitionChanged.removeEventListener(Bbe.prototype._onEntityDefinitionChanged,this),Mbe(this),!0)},Bbe.prototype.removeAll=function(){const e=this._entities,t=e.length,n=e.values,i=this._addedEntities,o=this._removedEntities;for(let r=0;r<t;r++){const e=n[r],t=e.id,s=i.get(t);C(s)||(e.definitionChanged.removeEventListener(Bbe.prototype._onEntityDefinitionChanged,this),o.set(t,e))}e.removeAll(),i.removeAll(),this._changedEntities.removeAll(),Mbe(this)},Bbe.prototype.getById=function(e){if(!C(e))throw new x("id is required.");return this._entities.get(e)},Bbe.prototype.getOrCreateEntity=function(e){if(!C(e))throw new x("id is required.");let t=this._entities.get(e);return C(t)||(Lbe.id=e,t=new iQ(Lbe),this.add(t)),t},Bbe.prototype._onEntityDefinitionChanged=function(e){const t=e.id;this._addedEntities.contains(t)||this._changedEntities.set(t,e),Mbe(this)};var Nbe=Bbe;const Fbe={id:void 0},zbe=new Array(2);function kbe(e){const t=e.propertyNames,n=t.length;for(let i=0;i<n;i++)e[t[i]]=void 0;e._name=void 0,e._availability=void 0}function Ube(e,t,n,i){zbe[0]=n,zbe[1]=i.id,t[JSON.stringify(zbe)]=i.definitionChanged.addEventListener(Gbe.prototype._onDefinitionChanged,e)}function Vbe(e,t,n,i){zbe[0]=n,zbe[1]=i.id;const o=JSON.stringify(zbe);t[o](),t[o]=void 0}function Hbe(e){if(e._shouldRecomposite=!0,0!==e._suspendCount)return;const t=e._collections,n=t.length,i=e._collectionsCopy,o=i.length;let r,s,a,c,l;const u=e._composite,h=new Nbe(e),d=e._eventHash;let f;for(r=0;r<o;r++)for(l=i[r],l.collectionChanged.removeEventListener(Gbe.prototype._onCollectionChanged,e),a=l.values,f=l.id,c=a.length-1;c>-1;c--)s=a[c],Vbe(e,d,f,s);for(r=n-1;r>=0;r--)for(l=t[r],l.collectionChanged.addEventListener(Gbe.prototype._onCollectionChanged,e),a=l.values,f=l.id,c=a.length-1;c>-1;c--){s=a[c],Ube(e,d,f,s);let t=h.getById(s.id);C(t)||(t=u.getById(s.id),C(t)?kbe(t):(Fbe.id=s.id,t=new iQ(Fbe)),h.add(t)),t.merge(s)}e._collectionsCopy=t.slice(0),u.suspendEvents(),u.removeAll();const p=h.values;for(r=0;r<p.length;r++)u.add(p[r]);u.resumeEvents()}function Gbe(e,t){this._owner=t,this._composite=new Nbe(this),this._suspendCount=0,this._collections=C(e)?e.slice():[],this._collectionsCopy=[],this._id=wk(),this._eventHash={},Hbe(this),this._shouldRecomposite=!1}function Wbe(e,t){if(!C(t))throw new x("collection is required.");const n=e.indexOf(t);if(-1===n)throw new x("collection is not in this composite.");return n}function qbe(e,t,n){const i=e._collections;if(t=z.clamp(t,0,i.length-1),n=z.clamp(n,0,i.length-1),t===n)return;const o=i[t];i[t]=i[n],i[n]=o,Hbe(e)}Object.defineProperties(Gbe.prototype,{collectionChanged:{get:function(){return this._composite._collectionChanged}},id:{get:function(){return this._id}},values:{get:function(){return this._composite.values}},owner:{get:function(){return this._owner}}}),Gbe.prototype.addCollection=function(e,t){const n=C(t);if(!C(e))throw new x("collection is required.");if(n){if(t<0)throw new x("index must be greater than or equal to zero.");if(t>this._collections.length)throw new x("index must be less than or equal to the number of collections.")}n?this._collections.splice(t,0,e):(t=this._collections.length,this._collections.push(e)),Hbe(this)},Gbe.prototype.removeCollection=function(e){const t=this._collections.indexOf(e);return-1!==t&&(this._collections.splice(t,1),Hbe(this),!0)},Gbe.prototype.removeAllCollections=function(){this._collections.length=0,Hbe(this)},Gbe.prototype.containsCollection=function(e){return-1!==this._collections.indexOf(e)},Gbe.prototype.contains=function(e){return this._composite.contains(e)},Gbe.prototype.indexOfCollection=function(e){return this._collections.indexOf(e)},Gbe.prototype.getCollection=function(e){if(!C(e))throw new x("index is required.","index");return this._collections[e]},Gbe.prototype.getCollectionsLength=function(){return this._collections.length},Gbe.prototype.raiseCollection=function(e){const t=Wbe(this._collections,e);qbe(this,t,t+1)},Gbe.prototype.lowerCollection=function(e){const t=Wbe(this._collections,e);qbe(this,t,t-1)},Gbe.prototype.raiseCollectionToTop=function(e){const t=Wbe(this._collections,e);t!==this._collections.length-1&&(this._collections.splice(t,1),this._collections.push(e),Hbe(this))},Gbe.prototype.lowerCollectionToBottom=function(e){const t=Wbe(this._collections,e);0!==t&&(this._collections.splice(t,1),this._collections.splice(0,0,e),Hbe(this))},Gbe.prototype.suspendEvents=function(){this._suspendCount++,this._composite.suspendEvents()},Gbe.prototype.resumeEvents=function(){if(0===this._suspendCount)throw new x("resumeEvents can not be called before suspendEvents.");this._suspendCount--,this._shouldRecomposite&&0===this._suspendCount&&(Hbe(this),this._shouldRecomposite=!1),this._composite.resumeEvents()},Gbe.prototype.computeAvailability=function(){return this._composite.computeAvailability()},Gbe.prototype.getById=function(e){return this._composite.getById(e)},Gbe.prototype._onCollectionChanged=function(e,t,n){const i=this._collectionsCopy,o=i.length,r=this._composite;let s,a,c,l;r.suspendEvents();const u=n.length,h=this._eventHash,d=e.id;for(s=0;s<u;s++){const e=n[s];Vbe(this,h,d,e);const t=e.id;for(a=o-1;a>=0;a--)c=i[a].getById(t),C(c)&&(C(l)||(l=r.getById(t),kbe(l)),l.merge(c));C(l)||r.removeById(t),l=void 0}const f=t.length;for(s=0;s<f;s++){const e=t[s];Ube(this,h,d,e);const n=e.id;for(a=o-1;a>=0;a--)c=i[a].getById(n),C(c)&&(C(l)||(l=r.getById(n),C(l)?kbe(l):(Fbe.id=n,l=new iQ(Fbe),r.add(l))),l.merge(c));l=void 0}r.resumeEvents()},Gbe.prototype._onDefinitionChanged=function(e,t,n,i){const o=this._collections,r=this._composite,s=o.length,a=e.id,c=r.getById(a);let l=c[t];const u=!C(l);let h=!0;for(let d=s-1;d>=0;d--){const n=o[d].getById(e.id);if(C(n)){const e=n[t];if(C(e)){if(h){if(h=!1,!C(e.merge)||!C(e.clone)){l=e;break}l=e.clone(l)}l.merge(e)}}}u&&-1===c.propertyNames.indexOf(t)&&c.addProperty(t),c[t]=l};function jbe(e,t,n,i){function o(){n.raiseEvent(e)}const r=[];t.removeAll();const s=i.length;for(let a=0;a<s;a++){const e=i.get(a);C(e.data)&&-1===r.indexOf(e.data)&&t.add(e.data.definitionChanged,o)}}function Ybe(){this._eventHelper=new RC,this._definitionChanged=new $n,this._intervals=new NN,this._intervals.changedEvent.addEventListener(Ybe.prototype._intervalsChanged,this)}Object.defineProperties(Ybe.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}}),Ybe.prototype.getValue=function(e,t){if(!C(e))throw new x("time is required");const n=this._intervals.findDataForIntervalContainingDate(e);if(C(n))return n.getValue(e,t)},Ybe.prototype.equals=function(e){return this===e||e instanceof Ybe&&this._intervals.equals(e._intervals,Bz.equals)},Ybe.prototype._intervalsChanged=function(){jbe(this,this._eventHelper,this._definitionChanged,this._intervals),this._definitionChanged.raiseEvent(this)};var Kbe=Ybe;function Xbe(){this._definitionChanged=new $n,this._composite=new Kbe,this._composite.definitionChanged.addEventListener(Xbe.prototype._raiseDefinitionChanged,this)}Object.defineProperties(Xbe.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite._intervals}}}),Xbe.prototype.getType=function(e){if(!C(e))throw new x("time is required");const t=this._composite._intervals.findDataForIntervalContainingDate(e);if(C(t))return t.getType(e)},Xbe.prototype.getValue=function(e,t){if(!C(e))throw new x("time is required");const n=this._composite._intervals.findDataForIntervalContainingDate(e);if(C(n))return n.getValue(e,t)},Xbe.prototype.equals=function(e){return this===e||e instanceof Xbe&&this._composite.equals(e._composite,Bz.equals)},Xbe.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};var Qbe=Xbe;function Jbe(e){this._referenceFrame=R(e,vL.FIXED),this._definitionChanged=new $n,this._composite=new Kbe,this._composite.definitionChanged.addEventListener(Jbe.prototype._raiseDefinitionChanged,this)}Object.defineProperties(Jbe.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite.intervals}},referenceFrame:{get:function(){return this._referenceFrame},set:function(e){this._referenceFrame=e}}}),Jbe.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,vL.FIXED,t)},Jbe.prototype.getValueInReferenceFrame=function(e,t,n){if(!C(e))throw new x("time is required.");if(!C(t))throw new x("referenceFrame is required.");const i=this._composite._intervals.findDataForIntervalContainingDate(e);if(C(i))return i.getValueInReferenceFrame(e,t,n)},Jbe.prototype.equals=function(e){return this===e||e instanceof Jbe&&this._referenceFrame===e._referenceFrame&&this._composite.equals(e._composite,Bz.equals)},Jbe.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};var Zbe=Jbe;const $be=new vz(0);function eAe(e){fQ.call(this,e),this._zIndex=0,this._terrainOffsetProperty=void 0}C(Object.create)&&(eAe.prototype=Object.create(fQ.prototype),eAe.prototype.constructor=eAe),Object.defineProperties(eAe.prototype,{zIndex:{get:function(){return this._zIndex}},terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),eAe.prototype._isOnTerrain=function(e,t){return this._fillEnabled&&!C(t.height)&&!C(t.extrudedHeight)&&mK.isSupported(this._scene)},eAe.prototype._getIsClosed=function(e){const t=e.height,n=e.extrudedHeight;return 0===t||C(n)&&n!==t},eAe.prototype._computeCenter=x.throwInstantiationError,eAe.prototype._onEntityPropertyChanged=function(e,t,n,i){if(fQ.prototype._onEntityPropertyChanged.call(this,e,t,n,i),-1===this._observedPropertyNames.indexOf(t))return;const o=this._entity[this._geometryPropertyName];if(!C(o))return;C(o.zIndex)&&(C(o.height)||C(o.extrudedHeight))&&CA(CA.geometryZIndex),this._zIndex=R(o.zIndex,$be),C(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);const r=o.heightReference,s=o.extrudedHeightReference;if(C(r)||C(s)){const e=new mQ(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new vQ(this._scene,e,r,s)}},eAe.prototype.destroy=function(){C(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0),fQ.prototype.destroy.call(this)},eAe.getGeometryHeight=function(e,t){if(D.defined("heightReference",t),C(e))return t!==Sz.CLAMP_TO_GROUND?e:0;t!==Sz.NONE&&CA(CA.geometryHeightReference)},eAe.getGeometryExtrudedHeight=function(e,t){if(D.defined("extrudedHeightReference",t),C(e))return t!==Sz.CLAMP_TO_GROUND?e:eAe.CLAMP_TO_GROUND;t!==Sz.NONE&&CA(CA.geometryExtrudedHeightReference)},eAe.CLAMP_TO_GROUND="clamp",eAe.computeGeometryOffsetAttribute=function(e,t,n,i){C(e)&&C(t)||(t=Sz.NONE),C(n)&&C(i)||(i=Sz.NONE);let o=0;return t!==Sz.NONE&&o++,i===Sz.RELATIVE_TO_GROUND&&o++,2===o?Wf.ALL:1===o?Wf.TOP:void 0};var tAe=eAe;const nAe=new xy,iAe=K.ZERO,oAe=new K,rAe=new _t;function sAe(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.cornerType=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.offsetAttribute=void 0}function aAe(e,t){tAe.call(this,{entity:e,scene:t,geometryOptions:new sAe(e),geometryPropertyName:"corridor",observedPropertyNames:["availability","corridor"]}),this._onEntityPropertyChanged(e,"corridor",e.corridor,void 0)}function cAe(e,t,n){vK.call(this,e,t,n)}C(Object.create)&&(aAe.prototype=Object.create(tAe.prototype),aAe.prototype.constructor=aAe),aAe.prototype.createFillGeometryInstance=function(e){if(D.defined("time",e),!this._fillEnabled)throw new x("This instance does not represent a filled geometry.");const t=this._entity,n=t.isAvailable(e),i={show:new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:jT.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};if(this._materialProperty instanceof BU){let t;C(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(t=this._materialProperty.color.getValue(e,nAe)),C(t)||(t=xy.WHITE),i.color=Iy.fromColor(t)}return C(this._options.offsetAttribute)&&(i.offset=JO.fromCartesian3(Bz.getValueOrDefault(this._terrainOffsetProperty,e,iAe,oAe))),new Sm({id:t,geometry:new cT(this._options),attributes:i})},aAe.prototype.createOutlineGeometryInstance=function(e){if(D.defined("time",e),!this._outlineEnabled)throw new x("This instance does not represent an outlined geometry.");const t=this._entity,n=t.isAvailable(e),i=Bz.getValueOrDefault(this._outlineColorProperty,e,xy.BLACK,nAe),o={show:new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Iy.fromColor(i),distanceDisplayCondition:jT.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0};return C(this._options.offsetAttribute)&&(o.offset=JO.fromCartesian3(Bz.getValueOrDefault(this._terrainOffsetProperty,e,iAe,oAe))),new Sm({id:t,geometry:new yT(this._options),attributes:o})},aAe.prototype._computeCenter=function(e,t){const n=Bz.getValueOrUndefined(this._entity.corridor.positions,e);if(C(n)&&0!==n.length)return K.clone(n[Math.floor(n.length/2)],t)},aAe.prototype._isHidden=function(e,t){return!C(t.positions)||!C(t.width)||fQ.prototype._isHidden.call(this,e,t)},aAe.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!Bz.isConstant(t.height)||!Bz.isConstant(t.extrudedHeight)||!Bz.isConstant(t.granularity)||!Bz.isConstant(t.width)||!Bz.isConstant(t.outlineWidth)||!Bz.isConstant(t.cornerType)||!Bz.isConstant(t.zIndex)||this._onTerrain&&!Bz.isConstant(this._materialProperty)&&!(this._materialProperty instanceof BU)},aAe.prototype._setStaticOptions=function(e,t){let n=Bz.getValueOrUndefined(t.height,fO.MINIMUM_VALUE);const i=Bz.getValueOrDefault(t.heightReference,fO.MINIMUM_VALUE,Sz.NONE);let o=Bz.getValueOrUndefined(t.extrudedHeight,fO.MINIMUM_VALUE);const r=Bz.getValueOrDefault(t.extrudedHeightReference,fO.MINIMUM_VALUE,Sz.NONE);C(o)&&!C(n)&&(n=0);const s=this._options;s.vertexFormat=this._materialProperty instanceof BU?LU.VERTEX_FORMAT:SU.MaterialSupport.TEXTURED.vertexFormat,s.positions=t.positions.getValue(fO.MINIMUM_VALUE,s.positions),s.width=t.width.getValue(fO.MINIMUM_VALUE),s.granularity=Bz.getValueOrUndefined(t.granularity,fO.MINIMUM_VALUE),s.cornerType=Bz.getValueOrUndefined(t.cornerType,fO.MINIMUM_VALUE),s.offsetAttribute=tAe.computeGeometryOffsetAttribute(n,i,o,r),s.height=tAe.getGeometryHeight(n,i),o=tAe.getGeometryExtrudedHeight(o,r),o===tAe.CLAMP_TO_GROUND&&(o=bo.getMinimumMaximumHeights(cT.computeRectangle(s,rAe)).minimumTerrainHeight),s.extrudedHeight=o},aAe.DynamicGeometryUpdater=cAe,C(Object.create)&&(cAe.prototype=Object.create(vK.prototype),cAe.prototype.constructor=cAe),cAe.prototype._isHidden=function(e,t,n){const i=this._options;return!C(i.positions)||!C(i.width)||vK.prototype._isHidden.call(this,e,t,n)},cAe.prototype._setOptions=function(e,t,n){const i=this._options;let o=Bz.getValueOrUndefined(t.height,n);const r=Bz.getValueOrDefault(t.heightReference,n,Sz.NONE);let s=Bz.getValueOrUndefined(t.extrudedHeight,n);const a=Bz.getValueOrDefault(t.extrudedHeightReference,n,Sz.NONE);C(s)&&!C(o)&&(o=0),i.positions=Bz.getValueOrUndefined(t.positions,n),i.width=Bz.getValueOrUndefined(t.width,n),i.granularity=Bz.getValueOrUndefined(t.granularity,n),i.cornerType=Bz.getValueOrUndefined(t.cornerType,n),i.offsetAttribute=tAe.computeGeometryOffsetAttribute(o,r,s,a),i.height=tAe.getGeometryHeight(o,r),s=tAe.getGeometryExtrudedHeight(s,a),s===tAe.CLAMP_TO_GROUND&&(s=bo.getMinimumMaximumHeights(cT.computeRectangle(i,rAe)).minimumTerrainHeight),i.extrudedHeight=s};var lAe=aAe;function uAe(){x.throwInstantiationError()}Object.defineProperties(uAe.prototype,{name:{get:x.throwInstantiationError},clock:{get:x.throwInstantiationError},entities:{get:x.throwInstantiationError},isLoading:{get:x.throwInstantiationError},changedEvent:{get:x.throwInstantiationError},errorEvent:{get:x.throwInstantiationError},loadingEvent:{get:x.throwInstantiationError},show:{get:x.throwInstantiationError},clustering:{get:x.throwInstantiationError}}),uAe.prototype.update=function(e){x.throwInstantiationError()},uAe.setLoading=function(e,t){e._isLoading!==t&&(t?e._entityCollection.suspendEvents():e._entityCollection.resumeEvents(),e._isLoading=t,e._loading.raiseEvent(e,t))};var hAe=uAe;function dAe(e,t){if(e=R(e,R.EMPTY_OBJECT),C(e.disableDepthTestDistance)&&e.disableDepthTestDistance<0)throw new x("disableDepthTestDistance must be greater than or equal to 0.0.");let n=e.translucencyByDistance,i=e.scaleByDistance,o=e.distanceDisplayCondition;if(C(n)){if(n.far<=n.near)throw new x("translucencyByDistance.far must be greater than translucencyByDistance.near.");n=LO.clone(n)}if(C(i)){if(i.far<=i.near)throw new x("scaleByDistance.far must be greater than scaleByDistance.near.");i=LO.clone(i)}if(C(o)){if(o.far<=o.near)throw new x("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");o=WT.clone(o)}this._show=R(e.show,!0),this._position=K.clone(R(e.position,K.ZERO)),this._actualPosition=K.clone(this._position),this._color=xy.clone(R(e.color,xy.WHITE)),this._outlineColor=xy.clone(R(e.outlineColor,xy.TRANSPARENT)),this._outlineWidth=R(e.outlineWidth,0),this._pixelSize=R(e.pixelSize,10),this._scaleByDistance=i,this._translucencyByDistance=n,this._distanceDisplayCondition=o,this._disableDepthTestDistance=R(e.disableDepthTestDistance,0),this._id=e.id,this._collection=R(e.collection,t),this._clusterShow=!0,this._pickId=void 0,this._pointPrimitiveCollection=t,this._dirty=!1,this._index=-1}const fAe=dAe.SHOW_INDEX=0,pAe=dAe.POSITION_INDEX=1,mAe=dAe.COLOR_INDEX=2,_Ae=dAe.OUTLINE_COLOR_INDEX=3,gAe=dAe.OUTLINE_WIDTH_INDEX=4,yAe=dAe.PIXEL_SIZE_INDEX=5,vAe=dAe.SCALE_BY_DISTANCE_INDEX=6,bAe=dAe.TRANSLUCENCY_BY_DISTANCE_INDEX=7,AAe=dAe.DISTANCE_DISPLAY_CONDITION_INDEX=8,wAe=dAe.DISABLE_DEPTH_DISTANCE_INDEX=9;function TAe(e,t){const n=e._pointPrimitiveCollection;C(n)&&(n._updatePointPrimitive(e,t),e._dirty=!0)}dAe.NUMBER_OF_PROPERTIES=10,Object.defineProperties(dAe.prototype,{show:{get:function(){return this._show},set:function(e){if(!C(e))throw new x("value is required.");this._show!==e&&(this._show=e,TAe(this,fAe))}},position:{get:function(){return this._position},set:function(e){if(!C(e))throw new x("value is required.");const t=this._position;K.equals(t,e)||(K.clone(e,t),K.clone(e,this._actualPosition),TAe(this,pAe))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){if(C(e)&&e.far<=e.near)throw new x("far distance must be greater than near distance.");const t=this._scaleByDistance;LO.equals(t,e)||(this._scaleByDistance=LO.clone(e,t),TAe(this,vAe))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){if(C(e)&&e.far<=e.near)throw new x("far distance must be greater than near distance.");const t=this._translucencyByDistance;LO.equals(t,e)||(this._translucencyByDistance=LO.clone(e,t),TAe(this,bAe))}},pixelSize:{get:function(){return this._pixelSize},set:function(e){if(!C(e))throw new x("value is required.");this._pixelSize!==e&&(this._pixelSize=e,TAe(this,yAe))}},color:{get:function(){return this._color},set:function(e){if(!C(e))throw new x("value is required.");const t=this._color;xy.equals(t,e)||(xy.clone(e,t),TAe(this,mAe))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){if(!C(e))throw new x("value is required.");const t=this._outlineColor;xy.equals(t,e)||(xy.clone(e,t),TAe(this,_Ae))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){if(!C(e))throw new x("value is required.");this._outlineWidth!==e&&(this._outlineWidth=e,TAe(this,gAe))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(C(e)&&e.far<=e.near)throw new x("far must be greater than near");WT.equals(this._distanceDisplayCondition,e)||(this._distanceDisplayCondition=WT.clone(e,this._distanceDisplayCondition),TAe(this,AAe))}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){if(this._disableDepthTestDistance!==e){if(!C(e)||e<0)throw new x("disableDepthTestDistance must be greater than or equal to 0.0.");this._disableDepthTestDistance=e,TAe(this,wAe)}}},id:{get:function(){return this._id},set:function(e){this._id=e,C(this._pickId)&&(this._pickId.object.id=e)}},pickId:{get:function(){return this._pickId}},clusterShow:{get:function(){return this._clusterShow},set:function(e){this._clusterShow!==e&&(this._clusterShow=e,TAe(this,fAe))}}}),dAe.prototype.getPickId=function(e){return C(this._pickId)||(this._pickId=e.createPickId({primitive:this,collection:this._collection,id:this._id})),this._pickId},dAe.prototype._getActualPosition=function(){return this._actualPosition},dAe.prototype._setActualPosition=function(e){K.clone(e,this._actualPosition),TAe(this,pAe)};const CAe=new Xe;dAe._computeActualPosition=function(e,t,n){return t.mode===ij.SCENE3D?e:(ft.multiplyByPoint(n,e,CAe),Aoe.computeActualWgs84Position(t,CAe))};const EAe=new Xe;dAe._computeScreenSpacePosition=function(e,t,n,i){const o=ft.multiplyByVector(e,Xe.fromElements(t.x,t.y,t.z,1,EAe),EAe),r=Aoe.wgs84ToWindowCoordinates(n,o,i);return r},dAe.prototype.computeScreenSpacePosition=function(e,t){const n=this._pointPrimitiveCollection;if(C(t)||(t=new ro),!C(n))throw new x("PointPrimitive must be in a collection.");if(!C(e))throw new x("scene is required.");const i=n.modelMatrix,o=dAe._computeScreenSpacePosition(i,this._actualPosition,e,t);if(C(o))return o.y=e.canvas.clientHeight-o.y,o},dAe.getScreenSpaceBoundingBox=function(e,t,n){const i=e.pixelSize,o=.5*i,r=t.x-o,s=t.y-o,a=i,c=i;return C(n)||(n=new bf),n.x=r,n.y=s,n.width=a,n.height=c,n},dAe.prototype.equals=function(e){return this===e||C(e)&&this._id===e._id&&K.equals(this._position,e._position)&&xy.equals(this._color,e._color)&&this._pixelSize===e._pixelSize&&this._outlineWidth===e._outlineWidth&&this._show===e._show&&xy.equals(this._outlineColor,e._outlineColor)&&LO.equals(this._scaleByDistance,e._scaleByDistance)&&LO.equals(this._translucencyByDistance,e._translucencyByDistance)&&WT.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance},dAe.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._pointPrimitiveCollection=void 0};var xAe=dAe,SAe="varying vec4 v_color;\nvarying vec4 v_outlineColor;\nvarying float v_innerPercent;\nvarying float v_pixelDistance;\nvarying vec4 v_pickColor;\n\nvoid main()\n{\n    // The distance in UV space from this fragment to the center of the point, at most 0.5.\n    float distanceToCenter = length(gl_PointCoord - vec2(0.5));\n    // The max distance stops one pixel shy of the edge to leave space for anti-aliasing.\n    float maxDistance = max(0.0, 0.5 - v_pixelDistance);\n    float wholeAlpha = 1.0 - smoothstep(maxDistance, 0.5, distanceToCenter);\n    float innerAlpha = 1.0 - smoothstep(maxDistance * v_innerPercent, 0.5 * v_innerPercent, distanceToCenter);\n\n    vec4 color = mix(v_outlineColor, v_color, innerAlpha);\n    color.a *= wholeAlpha;\n\n// Fully transparent parts of the billboard are not pickable.\n#if !defined(OPAQUE) && !defined(TRANSLUCENT)\n    if (color.a < 0.005)   // matches 0/255 and 1/255\n    {\n        discard;\n    }\n#else\n// The billboard is rendered twice. The opaque pass discards translucent fragments\n// and the translucent pass discards opaque fragments.\n#ifdef OPAQUE\n    if (color.a < 0.995)   // matches < 254/255\n    {\n        discard;\n    }\n#else\n    if (color.a >= 0.995)  // matches 254/255 and 255/255\n    {\n        discard;\n    }\n#endif\n#endif\n\n    gl_FragColor = czm_gammaCorrect(color);\n    czm_writeLogDepth();\n}\n",IAe='uniform float u_maxTotalPointSize;\n\nattribute vec4 positionHighAndSize;\nattribute vec4 positionLowAndOutline;\nattribute vec4 compressedAttribute0;                       // color, outlineColor, pick color\nattribute vec4 compressedAttribute1;                       // show, translucency by distance, some free space\nattribute vec4 scaleByDistance;                            // near, nearScale, far, farScale\nattribute vec3 distanceDisplayConditionAndDisableDepth;    // near, far, disableDepthTestDistance\n\nvarying vec4 v_color;\nvarying vec4 v_outlineColor;\nvarying float v_innerPercent;\nvarying float v_pixelDistance;\nvarying vec4 v_pickColor;\n\nconst float SHIFT_LEFT8 = 256.0;\nconst float SHIFT_RIGHT8 = 1.0 / 256.0;\n\nvoid main()\n{\n    // Modifying this shader may also require modifications to PointPrimitive._computeScreenSpacePosition\n\n    // unpack attributes\n    vec3 positionHigh = positionHighAndSize.xyz;\n    vec3 positionLow = positionLowAndOutline.xyz;\n    float outlineWidthBothSides = 2.0 * positionLowAndOutline.w;\n    float totalSize = positionHighAndSize.w + outlineWidthBothSides;\n    float outlinePercent = outlineWidthBothSides / totalSize;\n    // Scale in response to browser-zoom.\n    totalSize *= czm_pixelRatio;\n    // Add padding for anti-aliasing on both sides.\n    totalSize += 3.0;\n\n    float temp = compressedAttribute1.x * SHIFT_RIGHT8;\n    float show = floor(temp);\n\n#ifdef EYE_DISTANCE_TRANSLUCENCY\n    vec4 translucencyByDistance;\n    translucencyByDistance.x = compressedAttribute1.z;\n    translucencyByDistance.z = compressedAttribute1.w;\n\n    translucencyByDistance.y = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\n\n    temp = compressedAttribute1.y * SHIFT_RIGHT8;\n    translucencyByDistance.w = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\n#endif\n\n    ///////////////////////////////////////////////////////////////////////////\n\n    vec4 color;\n    vec4 outlineColor;\n    vec4 pickColor;\n\n    // compressedAttribute0.z => pickColor.rgb\n\n    temp = compressedAttribute0.z * SHIFT_RIGHT8;\n    pickColor.b = (temp - floor(temp)) * SHIFT_LEFT8;\n    temp = floor(temp) * SHIFT_RIGHT8;\n    pickColor.g = (temp - floor(temp)) * SHIFT_LEFT8;\n    pickColor.r = floor(temp);\n\n    // compressedAttribute0.x => color.rgb\n\n    temp = compressedAttribute0.x * SHIFT_RIGHT8;\n    color.b = (temp - floor(temp)) * SHIFT_LEFT8;\n    temp = floor(temp) * SHIFT_RIGHT8;\n    color.g = (temp - floor(temp)) * SHIFT_LEFT8;\n    color.r = floor(temp);\n\n    // compressedAttribute0.y => outlineColor.rgb\n\n    temp = compressedAttribute0.y * SHIFT_RIGHT8;\n    outlineColor.b = (temp - floor(temp)) * SHIFT_LEFT8;\n    temp = floor(temp) * SHIFT_RIGHT8;\n    outlineColor.g = (temp - floor(temp)) * SHIFT_LEFT8;\n    outlineColor.r = floor(temp);\n\n    // compressedAttribute0.w => color.a, outlineColor.a, pickColor.a\n\n    temp = compressedAttribute0.w * SHIFT_RIGHT8;\n    pickColor.a = (temp - floor(temp)) * SHIFT_LEFT8;\n    pickColor = pickColor / 255.0;\n\n    temp = floor(temp) * SHIFT_RIGHT8;\n    outlineColor.a = (temp - floor(temp)) * SHIFT_LEFT8;\n    outlineColor /= 255.0;\n    color.a = floor(temp);\n    color /= 255.0;\n\n    ///////////////////////////////////////////////////////////////////////////\n\n    vec4 p = czm_translateRelativeToEye(positionHigh, positionLow);\n    vec4 positionEC = czm_modelViewRelativeToEye * p;\n\n    ///////////////////////////////////////////////////////////////////////////\n\n#if defined(EYE_DISTANCE_SCALING) || defined(EYE_DISTANCE_TRANSLUCENCY) || defined(DISTANCE_DISPLAY_CONDITION) || defined(DISABLE_DEPTH_DISTANCE)\n    float lengthSq;\n    if (czm_sceneMode == czm_sceneMode2D)\n    {\n        // 2D camera distance is a special case\n        // treat all billboards as flattened to the z=0.0 plane\n        lengthSq = czm_eyeHeight2D.y;\n    }\n    else\n    {\n        lengthSq = dot(positionEC.xyz, positionEC.xyz);\n    }\n#endif\n\n#ifdef EYE_DISTANCE_SCALING\n    totalSize *= czm_nearFarScalar(scaleByDistance, lengthSq);\n#endif\n    // Clamp to max point size.\n    totalSize = min(totalSize, u_maxTotalPointSize);\n    // If size is too small, push vertex behind near plane for clipping.\n    // Note that context.minimumAliasedPointSize "will be at most 1.0".\n    if (totalSize < 1.0)\n    {\n        positionEC.xyz = vec3(0.0);\n        totalSize = 1.0;\n    }\n\n    float translucency = 1.0;\n#ifdef EYE_DISTANCE_TRANSLUCENCY\n    translucency = czm_nearFarScalar(translucencyByDistance, lengthSq);\n    // push vertex behind near plane for clipping\n    if (translucency < 0.004)\n    {\n        positionEC.xyz = vec3(0.0);\n    }\n#endif\n\n#ifdef DISTANCE_DISPLAY_CONDITION\n    float nearSq = distanceDisplayConditionAndDisableDepth.x;\n    float farSq = distanceDisplayConditionAndDisableDepth.y;\n    if (lengthSq < nearSq || lengthSq > farSq) {\n        // push vertex behind camera to force it to be clipped\n        positionEC.xyz = vec3(0.0, 0.0, 1.0);\n    }\n#endif\n\n    gl_Position = czm_projection * positionEC;\n    czm_vertexLogDepth();\n\n#ifdef DISABLE_DEPTH_DISTANCE\n    float disableDepthTestDistance = distanceDisplayConditionAndDisableDepth.z;\n    if (disableDepthTestDistance == 0.0 && czm_minimumDisableDepthTestDistance != 0.0)\n    {\n        disableDepthTestDistance = czm_minimumDisableDepthTestDistance;\n    }\n\n    if (disableDepthTestDistance != 0.0)\n    {\n        // Don\'t try to "multiply both sides" by w.  Greater/less-than comparisons won\'t work for negative values of w.\n        float zclip = gl_Position.z / gl_Position.w;\n        bool clipped = (zclip < -1.0 || zclip > 1.0);\n        if (!clipped && (disableDepthTestDistance < 0.0 || (lengthSq > 0.0 && lengthSq < disableDepthTestDistance)))\n        {\n            // Position z on the near plane.\n            gl_Position.z = -gl_Position.w;\n#ifdef LOG_DEPTH\n            czm_vertexLogDepth(vec4(czm_currentFrustum.x));\n#endif\n        }\n    }\n#endif\n\n    v_color = color;\n    v_color.a *= translucency * show;\n    v_outlineColor = outlineColor;\n    v_outlineColor.a *= translucency * show;\n\n    v_innerPercent = 1.0 - outlinePercent;\n    v_pixelDistance = 2.0 / totalSize;\n    gl_PointSize = totalSize * show;\n    gl_Position *= show;\n\n    v_pickColor = pickColor;\n}\n';const OAe=xAe.SHOW_INDEX,DAe=xAe.POSITION_INDEX,PAe=xAe.COLOR_INDEX,RAe=xAe.OUTLINE_COLOR_INDEX,LAe=xAe.OUTLINE_WIDTH_INDEX,MAe=xAe.PIXEL_SIZE_INDEX,BAe=xAe.SCALE_BY_DISTANCE_INDEX,NAe=xAe.TRANSLUCENCY_BY_DISTANCE_INDEX,FAe=xAe.DISTANCE_DISPLAY_CONDITION_INDEX,zAe=xAe.DISABLE_DEPTH_DISTANCE_INDEX,kAe=xAe.NUMBER_OF_PROPERTIES,UAe={positionHighAndSize:0,positionLowAndOutline:1,compressedAttribute0:2,compressedAttribute1:3,scaleByDistance:4,distanceDisplayConditionAndDisableDepth:5};function VAe(e){e=R(e,R.EMPTY_OBJECT),this._sp=void 0,this._spTranslucent=void 0,this._rsOpaque=void 0,this._rsTranslucent=void 0,this._vaf=void 0,this._pointPrimitives=[],this._pointPrimitivesToUpdate=[],this._pointPrimitivesToUpdateIndex=0,this._pointPrimitivesRemoved=!1,this._createVertexArray=!1,this._shaderScaleByDistance=!1,this._compiledShaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._compiledShaderTranslucencyByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDisableDepthDistance=!1,this._compiledShaderDisableDepthDistance=!1,this._propertiesChanged=new Uint32Array(kAe),this._maxPixelSize=1,this._baseVolume=new nn,this._baseVolumeWC=new nn,this._baseVolume2D=new nn,this._boundingVolume=new nn,this._boundingVolumeDirty=!1,this._colorCommands=[],this.show=R(e.show,!0),this.modelMatrix=ft.clone(R(e.modelMatrix,ft.IDENTITY)),this._modelMatrix=ft.clone(ft.IDENTITY),this.debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this.blendOption=R(e.blendOption,Koe.OPAQUE_AND_TRANSLUCENT),this._blendOption=void 0,this._mode=ij.SCENE3D,this._maxTotalPointSize=1,this._buffersUsage=[lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW,lq.STATIC_DRAW];const t=this;this._uniforms={u_maxTotalPointSize:function(){return t._maxTotalPointSize}}}function HAe(e){const t=e.length;for(let n=0;n<t;++n)e[n]&&e[n]._destroy()}function GAe(e){if(e._pointPrimitivesRemoved){e._pointPrimitivesRemoved=!1;const t=[],n=e._pointPrimitives,i=n.length;for(let e=0,o=0;e<i;++e){const i=n[e];i&&(i._index=o++,t.push(i))}e._pointPrimitives=t}}function WAe(e,t,n){return new $ie(e,[{index:UAe.positionHighAndSize,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[DAe]},{index:UAe.positionLowAndShow,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[DAe]},{index:UAe.compressedAttribute0,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[PAe]},{index:UAe.compressedAttribute1,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[NAe]},{index:UAe.scaleByDistance,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:n[BAe]},{index:UAe.distanceDisplayConditionAndDisableDepth,componentsPerAttribute:3,componentDatatype:ih.FLOAT,usage:n[FAe]}],t)}Object.defineProperties(VAe.prototype,{length:{get:function(){return GAe(this),this._pointPrimitives.length}}}),VAe.prototype.add=function(e){const t=new xAe(e,this);return t._index=this._pointPrimitives.length,this._pointPrimitives.push(t),this._createVertexArray=!0,t},VAe.prototype.remove=function(e){return!!this.contains(e)&&(this._pointPrimitives[e._index]=null,this._pointPrimitivesRemoved=!0,this._createVertexArray=!0,e._destroy(),!0)},VAe.prototype.removeAll=function(){HAe(this._pointPrimitives),this._pointPrimitives=[],this._pointPrimitivesToUpdate=[],this._pointPrimitivesToUpdateIndex=0,this._pointPrimitivesRemoved=!1,this._createVertexArray=!0},VAe.prototype._updatePointPrimitive=function(e,t){e._dirty||(this._pointPrimitivesToUpdate[this._pointPrimitivesToUpdateIndex++]=e),++this._propertiesChanged[t]},VAe.prototype.contains=function(e){return C(e)&&e._pointPrimitiveCollection===this},VAe.prototype.get=function(e){if(!C(e))throw new x("index is required.");return GAe(this),this._pointPrimitives[e]},VAe.prototype.computeNewBuffersUsage=function(){const e=this._buffersUsage;let t=!1;const n=this._propertiesChanged;for(let i=0;i<kAe;++i){const o=0===n[i]?lq.STATIC_DRAW:lq.STREAM_DRAW;t=t||e[i]!==o,e[i]=o}return t};const qAe=new Nm;function jAe(e,t,n,i){const o=i._index,r=i._getActualPosition();e._mode===ij.SCENE3D&&(nn.expand(e._baseVolume,r,e._baseVolume),e._boundingVolumeDirty=!0),Nm.fromCartesian(r,qAe);const s=i.pixelSize,a=i.outlineWidth;e._maxPixelSize=Math.max(e._maxPixelSize,s+a);const c=n[UAe.positionHighAndSize],l=qAe.high;c(o,l.x,l.y,l.z,s);const u=n[UAe.positionLowAndOutline],h=qAe.low;u(o,h.x,h.y,h.z,a)}const YAe=65536,KAe=256;function XAe(e,t,n,i){const o=i._index,r=i.color,s=i.getPickId(t).color,a=i.outlineColor;let c=xy.floatToByte(r.red),l=xy.floatToByte(r.green),u=xy.floatToByte(r.blue);const h=c*YAe+l*KAe+u;c=xy.floatToByte(a.red),l=xy.floatToByte(a.green),u=xy.floatToByte(a.blue);const d=c*YAe+l*KAe+u;c=xy.floatToByte(s.red),l=xy.floatToByte(s.green),u=xy.floatToByte(s.blue);const f=c*YAe+l*KAe+u,p=xy.floatToByte(r.alpha)*YAe+xy.floatToByte(a.alpha)*KAe+xy.floatToByte(s.alpha),m=n[UAe.compressedAttribute0];m(o,h,d,f,p)}function QAe(e,t,n,i){const o=i._index;let r=0,s=1,a=1,c=1;const l=i.translucencyByDistance;C(l)&&(r=l.near,s=l.nearValue,a=l.far,c=l.farValue,1===s&&1===c||(e._shaderTranslucencyByDistance=!0));let u=i.show&&i.clusterShow;0===i.color.alpha&&0===i.outlineColor.alpha&&(u=!1),s=z.clamp(s,0,1),s=1===s?255:255*s|0;const h=(u?1:0)*KAe+s;c=z.clamp(c,0,1),c=1===c?255:255*c|0;const d=c,f=n[UAe.compressedAttribute1];f(o,h,d,r,a)}function JAe(e,t,n,i){const o=i._index,r=n[UAe.scaleByDistance];let s=0,a=1,c=1,l=1;const u=i.scaleByDistance;C(u)&&(s=u.near,a=u.nearValue,c=u.far,l=u.farValue,1===a&&1===l||(e._shaderScaleByDistance=!0)),r(o,s,a,c,l)}function ZAe(e,t,n,i){const o=i._index,r=n[UAe.distanceDisplayConditionAndDisableDepth];let s=0,a=Number.MAX_VALUE;const c=i.distanceDisplayCondition;C(c)&&(s=c.near,a=c.far,s*=s,a*=a,e._shaderDistanceDisplayCondition=!0);let l=i.disableDepthTestDistance;l*=l,l>0&&(e._shaderDisableDepthDistance=!0,l===Number.POSITIVE_INFINITY&&(l=-1)),r(o,s,a,l)}function $Ae(e,t,n,i){jAe(e,t,n,i),XAe(e,t,n,i),QAe(e,t,n,i),JAe(e,t,n,i),ZAe(e,t,n,i)}function ewe(e,t,n,i,o,r){let s;i.mode===ij.SCENE3D?(s=e._baseVolume,e._boundingVolumeDirty=!0):s=e._baseVolume2D;const a=[];for(let c=0;c<n;++c){const e=t[c],n=e.position,l=xAe._computeActualPosition(n,i,o);C(l)&&(e._setActualPosition(l),r?a.push(l):nn.expand(s,l,s))}r&&nn.fromPoints(a,s)}function twe(e,t){const n=t.mode,i=e._pointPrimitives,o=e._pointPrimitivesToUpdate,r=e._modelMatrix;e._createVertexArray||e._mode!==n||n!==ij.SCENE3D&&!ft.equals(r,e.modelMatrix)?(e._mode=n,ft.clone(e.modelMatrix,r),e._createVertexArray=!0,n!==ij.SCENE3D&&n!==ij.SCENE2D&&n!==ij.COLUMBUS_VIEW||ewe(e,i,i.length,t,r,!0)):n===ij.MORPHING?ewe(e,i,i.length,t,r,!0):n!==ij.SCENE2D&&n!==ij.COLUMBUS_VIEW||ewe(e,o,e._pointPrimitivesToUpdateIndex,t,r,!1)}function nwe(e,t,n){const i=t.camera.getPixelSize(n,t.context.drawingBufferWidth,t.context.drawingBufferHeight),o=i*e._maxPixelSize;n.radius+=o}const iwe=[];VAe.prototype.update=function(e){if(GAe(this),!this.show)return;this._maxTotalPointSize=Ck.maximumAliasedPointSize,twe(this,e);const t=this._pointPrimitives,n=t.length,i=this._pointPrimitivesToUpdate,o=this._pointPrimitivesToUpdateIndex,r=this._propertiesChanged,s=this._createVertexArray;let a;const c=e.context,l=e.passes,u=l.pick;if(s||!u&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(let e=0;e<kAe;++e)r[e]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),n>0){this._vaf=WAe(c,n,this._buffersUsage),a=this._vaf.writers;for(let e=0;e<n;++e){const t=this._pointPrimitives[e];t._dirty=!1,$Ae(this,c,a,t)}this._vaf.commit()}this._pointPrimitivesToUpdateIndex=0}else if(o>0){const e=iwe;e.length=0,(r[DAe]||r[LAe]||r[MAe])&&e.push(jAe),(r[PAe]||r[RAe])&&e.push(XAe),(r[OAe]||r[NAe])&&e.push(QAe),r[BAe]&&e.push(JAe),(r[FAe]||r[zAe])&&e.push(ZAe);const t=e.length;if(a=this._vaf.writers,o/n>.1){for(let n=0;n<o;++n){const o=i[n];o._dirty=!1;for(let n=0;n<t;++n)e[n](this,c,a,o)}this._vaf.commit()}else{for(let n=0;n<o;++n){const o=i[n];o._dirty=!1;for(let n=0;n<t;++n)e[n](this,c,a,o);this._vaf.subCommit(o._index,1)}this._vaf.endSubCommits()}this._pointPrimitivesToUpdateIndex=0}if(o>1.5*n&&(i.length=n),!C(this._vaf)||!C(this._vaf.va))return;let h;this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,nn.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));let d=ft.IDENTITY;e.mode===ij.SCENE3D?(d=this.modelMatrix,h=nn.clone(this._baseVolumeWC,this._boundingVolume)):h=nn.clone(this._baseVolume2D,this._boundingVolume),nwe(this,e,h);const f=this._blendOption!==this.blendOption;let p,m,_,g,y,v;this._blendOption=this.blendOption,f&&(this._blendOption===Koe.OPAQUE||this._blendOption===Koe.OPAQUE_AND_TRANSLUCENT?this._rsOpaque=yV.fromCache({depthTest:{enabled:!0,func:th.LEQUAL},depthMask:!0}):this._rsOpaque=void 0,this._blendOption===Koe.TRANSLUCENT||this._blendOption===Koe.OPAQUE_AND_TRANSLUCENT?this._rsTranslucent=yV.fromCache({depthTest:{enabled:!0,func:th.LEQUAL},depthMask:!1,blending:_k.ALPHA_BLEND}):this._rsTranslucent=void 0),this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||0!==e.minimumDisableDepthTestDistance,(f||this._shaderScaleByDistance&&!this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance&&!this._compiledShaderTranslucencyByDistance||this._shaderDistanceDisplayCondition&&!this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance)&&(p=new tq({sources:[IAe]}),this._shaderScaleByDistance&&p.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&p.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderDistanceDisplayCondition&&p.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&p.defines.push("DISABLE_DEPTH_DISTANCE"),this._blendOption===Koe.OPAQUE_AND_TRANSLUCENT&&(m=new tq({defines:["OPAQUE"],sources:[SAe]}),this._sp=fH.replaceCache({context:c,shaderProgram:this._sp,vertexShaderSource:p,fragmentShaderSource:m,attributeLocations:UAe}),m=new tq({defines:["TRANSLUCENT"],sources:[SAe]}),this._spTranslucent=fH.replaceCache({context:c,shaderProgram:this._spTranslucent,vertexShaderSource:p,fragmentShaderSource:m,attributeLocations:UAe})),this._blendOption===Koe.OPAQUE&&(m=new tq({sources:[SAe]}),this._sp=fH.replaceCache({context:c,shaderProgram:this._sp,vertexShaderSource:p,fragmentShaderSource:m,attributeLocations:UAe})),this._blendOption===Koe.TRANSLUCENT&&(m=new tq({sources:[SAe]}),this._spTranslucent=fH.replaceCache({context:c,shaderProgram:this._spTranslucent,vertexShaderSource:p,fragmentShaderSource:m,attributeLocations:UAe})),this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance);const b=e.commandList;if(l.render||u){const e=this._colorCommands,t=this._blendOption===Koe.OPAQUE,n=this._blendOption===Koe.OPAQUE_AND_TRANSLUCENT;_=this._vaf.va,g=_.length,e.length=g;const i=n?2*g:g;for(v=0;v<i;++v){const i=t||n&&v%2===0;y=e[v],C(y)||(y=e[v]=new UU),y.primitiveType=xf.POINTS,y.pass=i||!n?HU.OPAQUE:HU.TRANSLUCENT,y.owner=this;const o=n?Math.floor(v/2):v;y.boundingVolume=h,y.modelMatrix=d,y.shaderProgram=i?this._sp:this._spTranslucent,y.uniformMap=this._uniforms,y.vertexArray=_[o].va,y.renderState=i?this._rsOpaque:this._rsTranslucent,y.debugShowBoundingVolume=this.debugShowBoundingVolume,y.pickId="v_pickColor",b.push(y)}}},VAe.prototype.isDestroyed=function(){return!1},VAe.prototype.destroy=function(){return this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),HAe(this._pointPrimitives),Qh(this)};var owe=VAe;function rwe(e,t,n,i,o,r){if(o-i<=n)return;const s=i+o>>1;swe(e,t,s,i,o,r%2),rwe(e,t,n,i,s-1,r+1),rwe(e,t,n,s+1,o,r+1)}function swe(e,t,n,i,o,r){while(o>i){if(o-i>600){const s=o-i+1,a=n-i+1,c=Math.log(s),l=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*l*(s-l)/s)*(a-s/2<0?-1:1),h=Math.max(i,Math.floor(n-a*l/s+u)),d=Math.min(o,Math.floor(n+(s-a)*l/s+u));swe(e,t,n,h,d,r)}const s=t[2*n+r];let a=i,c=o;awe(e,t,i,n),t[2*o+r]>s&&awe(e,t,i,o);while(a<c){awe(e,t,a,c),a++,c--;while(t[2*a+r]<s)a++;while(t[2*c+r]>s)c--}t[2*i+r]===s?awe(e,t,i,c):(c++,awe(e,t,c,o)),c<=n&&(i=c+1),n<=c&&(o=c-1)}}function awe(e,t,n,i){cwe(e,n,i),cwe(t,2*n,2*i),cwe(t,2*n+1,2*i+1)}function cwe(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function lwe(e,t,n,i,o,r,s){const a=[0,e.length-1,0],c=[];let l,u;while(a.length){const h=a.pop(),d=a.pop(),f=a.pop();if(d-f<=s){for(let s=f;s<=d;s++)l=t[2*s],u=t[2*s+1],l>=n&&l<=o&&u>=i&&u<=r&&c.push(e[s]);continue}const p=Math.floor((f+d)/2);l=t[2*p],u=t[2*p+1],l>=n&&l<=o&&u>=i&&u<=r&&c.push(e[p]);const m=(h+1)%2;(0===h?n<=l:i<=u)&&(a.push(f),a.push(p-1),a.push(m)),(0===h?o>=l:r>=u)&&(a.push(p+1),a.push(d),a.push(m))}return c}function uwe(e,t,n,i,o,r){const s=[0,e.length-1,0],a=[],c=o*o;while(s.length){const l=s.pop(),u=s.pop(),h=s.pop();if(u-h<=r){for(let o=h;o<=u;o++)hwe(t[2*o],t[2*o+1],n,i)<=c&&a.push(e[o]);continue}const d=Math.floor((h+u)/2),f=t[2*d],p=t[2*d+1];hwe(f,p,n,i)<=c&&a.push(e[d]);const m=(l+1)%2;(0===l?n-o<=f:i-o<=p)&&(s.push(h),s.push(d-1),s.push(m)),(0===l?n+o>=f:i+o>=p)&&(s.push(d+1),s.push(u),s.push(m))}return a}function hwe(e,t,n,i){const o=e-n,r=t-i;return o*o+r*r}const dwe=e=>e[0],fwe=e=>e[1];class pwe{constructor(e,t=dwe,n=fwe,i=64,o=Float64Array){this.nodeSize=i,this.points=e;const r=e.length<65536?Uint16Array:Uint32Array,s=this.ids=new r(e.length),a=this.coords=new o(2*e.length);for(let c=0;c<e.length;c++)s[c]=c,a[2*c]=t(e[c]),a[2*c+1]=n(e[c]);rwe(s,a,i,0,s.length-1,0)}range(e,t,n,i){return lwe(this.ids,this.coords,e,t,n,i,this.nodeSize)}within(e,t,n){return uwe(this.ids,this.coords,e,t,n,this.nodeSize)}}function mwe(e){e=R(e,R.EMPTY_OBJECT),this._enabled=R(e.enabled,!1),this._pixelRange=R(e.pixelRange,80),this._minimumClusterSize=R(e.minimumClusterSize,2),this._clusterBillboards=R(e.clusterBillboards,!0),this._clusterLabels=R(e.clusterLabels,!0),this._clusterPoints=R(e.clusterPoints,!0),this._labelCollection=void 0,this._billboardCollection=void 0,this._pointCollection=void 0,this._clusterBillboardCollection=void 0,this._clusterLabelCollection=void 0,this._clusterPointCollection=void 0,this._collectionIndicesByEntity={},this._unusedLabelIndices=[],this._unusedBillboardIndices=[],this._unusedPointIndices=[],this._previousClusters=[],this._previousHeight=void 0,this._enabledDirty=!1,this._clusterDirty=!1,this._cluster=void 0,this._removeEventListener=void 0,this._clusterEvent=new $n,this.show=R(e.show,!0)}function _we(e){return e.coord.x}function gwe(e){return e.coord.y}function ywe(e,t){e.x-=t,e.y-=t,e.width+=2*t,e.height+=2*t}const vwe=new bf;function bwe(e,t,n,i,o){if(C(e._labelCollection)&&i._clusterLabels?o=Kse.getScreenSpaceBoundingBox(e,t,o):C(e._billboardCollection)&&i._clusterBillboards?o=joe.getScreenSpaceBoundingBox(e,t,o):C(e._pointPrimitiveCollection)&&i._clusterPoints&&(o=xAe.getScreenSpaceBoundingBox(e,t,o)),ywe(o,n),i._clusterLabels&&!C(e._labelCollection)&&C(e.id)&&Twe(i,e.id.id)&&C(e.id._label)){const r=i._collectionIndicesByEntity[e.id.id].labelIndex,s=i._labelCollection.get(r),a=Kse.getScreenSpaceBoundingBox(s,t,vwe);ywe(a,n),o=bf.union(o,a,o)}return o}function Awe(e,t){if(e.clusterShow=!0,!C(e._labelCollection)&&C(e.id)&&Twe(t,e.id.id)&&C(e.id._label)){const n=t._collectionIndicesByEntity[e.id.id].labelIndex,i=t._labelCollection.get(n);i.clusterShow=!0}}function wwe(e,t,n,i){const o={billboard:i._clusterBillboardCollection.add(),label:i._clusterLabelCollection.add(),point:i._clusterPointCollection.add()};o.billboard.show=!1,o.point.show=!1,o.label.show=!0,o.label.text=t.toLocaleString(),o.label.id=n,o.billboard.position=o.label.position=o.point.position=e,i._clusterEvent.raiseEvent(n,o)}function Twe(e,t){return C(e)&&C(e._collectionIndicesByEntity[t])&&C(e._collectionIndicesByEntity[t].labelIndex)}function Cwe(e,t,n,i,o){if(!C(e))return;const r=e.length;for(let s=0;s<r;++s){const r=e.get(s);if(r.clusterShow=!1,!r.show||o._scene.mode===ij.SCENE3D&&!i.isPointVisible(r.position))continue;const a=o._clusterLabels&&C(r._labelCollection),c=o._clusterBillboards&&C(r.id._billboard),l=o._clusterPoints&&C(r.id._point);if(a&&(l||c))continue;const u=r.computeScreenSpacePosition(n);C(u)&&t.push({index:s,collection:e,clustered:!1,coord:u})}}const Ewe=new bf,xwe=new bf,Swe=new bf;function Iwe(e){return function(t){if(C(t)&&t<.05||!e.enabled)return;const n=e._scene,i=e._labelCollection,o=e._billboardCollection,r=e._pointCollection;if(!C(i)&&!C(o)&&!C(r)||!e._clusterBillboards&&!e._clusterLabels&&!e._clusterPoints)return;let s=e._clusterLabelCollection,a=e._clusterBillboardCollection,c=e._clusterPointCollection;C(s)?s.removeAll():s=e._clusterLabelCollection=new mae({scene:n}),C(a)?a.removeAll():a=e._clusterBillboardCollection=new fse({scene:n}),C(c)?c.removeAll():c=e._clusterPointCollection=new owe;const l=e._pixelRange,u=e._minimumClusterSize,h=e._previousClusters,d=[],f=e._previousHeight,p=n.camera.positionCartographic.height,m=n.mapProjection.ellipsoid,_=n.camera.positionWC,g=new jr(m,_),y=[];let v,b,A,w,T,E,x,S,I,O,D,P;e._clusterLabels&&Cwe(i,y,n,g,e),e._clusterBillboards&&Cwe(o,y,n,g,e),e._clusterPoints&&Cwe(r,y,n,g,e);const R=new pwe(y,_we,gwe,64,Int32Array);if(p<f)for(A=h.length,v=0;v<A;++v){const t=h[v];if(!g.isPointVisible(t.position))continue;const i=joe._computeScreenSpacePosition(ft.IDENTITY,t.position,K.ZERO,ro.ZERO,n);if(!C(i))continue;const o=1-p/f;let r=t.width=t.width*o,s=t.height=t.height*o;r=Math.max(r,t.minimumWidth),s=Math.max(s,t.minimumHeight);const a=i.x-.5*r,c=i.y-.5*s,l=i.x+r,m=i.y+s;for(T=R.range(a,c,l,m),E=T.length,O=0,I=[],b=0;b<E;++b)x=T[b],S=y[x],S.clustered||(++O,D=S.collection,P=S.index,I.push(D.get(P).id));if(O>=u)for(wwe(t.position,O,I,e),d.push(t),b=0;b<E;++b)y[T[b]].clustered=!0}for(A=y.length,v=0;v<A;++v){const t=y[v];if(t.clustered)continue;t.clustered=!0,D=t.collection,P=t.index;const n=D.get(P);w=bwe(n,t.coord,l,e,Ewe);const i=bf.clone(w,xwe);T=R.range(w.x,w.y,w.x+w.width,w.y+w.height),E=T.length;const o=K.clone(n.position);for(O=1,I=[n.id],b=0;b<E;++b)if(x=T[b],S=y[x],!S.clustered){const t=S.collection.get(S.index),n=bwe(t,S.coord,l,e,Swe);K.add(t.position,o,o),bf.union(i,n,i),++O,I.push(t.id)}if(O>=u){const t=K.multiplyByScalar(o,1/O,o);for(wwe(t,O,I,e),d.push({position:t,width:i.width,height:i.height,minimumWidth:w.width,minimumHeight:w.height}),b=0;b<E;++b)y[T[b]].clustered=!0}else Awe(n,e)}0===s.length&&(s.destroy(),e._clusterLabelCollection=void 0),0===a.length&&(a.destroy(),e._clusterBillboardCollection=void 0),0===c.length&&(c.destroy(),e._clusterPointCollection=void 0),e._previousClusters=d,e._previousHeight=p}}function Owe(e,t,n,i){return function(o){let r=this[e];C(this._collectionIndicesByEntity)||(this._collectionIndicesByEntity={});let s,a,c=this._collectionIndicesByEntity[o.id];if(C(c)||(c=this._collectionIndicesByEntity[o.id]={billboardIndex:void 0,labelIndex:void 0,pointIndex:void 0}),C(r)&&C(c[i]))return r.get(c[i]);C(r)||(r=this[e]=new t({scene:this._scene}));const l=this[n];l.length>0?(s=l.pop(),a=r.get(s)):(a=r.add(),s=r.length-1),c[i]=s;const u=this;return Promise.resolve().then((function(){u._clusterDirty=!0})),a}}function Dwe(e,t){const n=e._collectionIndicesByEntity[t];C(n.billboardIndex)||C(n.labelIndex)||C(n.pointIndex)||delete e._collectionIndicesByEntity[t]}function Pwe(e){if(!C(e))return;const t=e.length;for(let n=0;n<t;++n)e.get(n).clusterShow=!0}function Rwe(e){e.enabled||(C(e._clusterLabelCollection)&&e._clusterLabelCollection.destroy(),C(e._clusterBillboardCollection)&&e._clusterBillboardCollection.destroy(),C(e._clusterPointCollection)&&e._clusterPointCollection.destroy(),e._clusterLabelCollection=void 0,e._clusterBillboardCollection=void 0,e._clusterPointCollection=void 0,Pwe(e._labelCollection),Pwe(e._billboardCollection),Pwe(e._pointCollection))}mwe.prototype._initialize=function(e){this._scene=e;const t=Iwe(this);this._cluster=t,this._removeEventListener=e.camera.changed.addEventListener(t)},Object.defineProperties(mwe.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this._enabledDirty=e!==this._enabled,this._enabled=e}},pixelRange:{get:function(){return this._pixelRange},set:function(e){this._clusterDirty=this._clusterDirty||e!==this._pixelRange,this._pixelRange=e}},minimumClusterSize:{get:function(){return this._minimumClusterSize},set:function(e){this._clusterDirty=this._clusterDirty||e!==this._minimumClusterSize,this._minimumClusterSize=e}},clusterEvent:{get:function(){return this._clusterEvent}},clusterBillboards:{get:function(){return this._clusterBillboards},set:function(e){this._clusterDirty=this._clusterDirty||e!==this._clusterBillboards,this._clusterBillboards=e}},clusterLabels:{get:function(){return this._clusterLabels},set:function(e){this._clusterDirty=this._clusterDirty||e!==this._clusterLabels,this._clusterLabels=e}},clusterPoints:{get:function(){return this._clusterPoints},set:function(e){this._clusterDirty=this._clusterDirty||e!==this._clusterPoints,this._clusterPoints=e}}}),mwe.prototype.getLabel=Owe("_labelCollection",mae,"_unusedLabelIndices","labelIndex"),mwe.prototype.removeLabel=function(e){const t=this._collectionIndicesByEntity&&this._collectionIndicesByEntity[e.id];if(!C(this._labelCollection)||!C(t)||!C(t.labelIndex))return;const n=t.labelIndex;t.labelIndex=void 0,Dwe(this,e.id);const i=this._labelCollection.get(n);i.show=!1,i.text="",i.id=void 0,this._unusedLabelIndices.push(n),this._clusterDirty=!0},mwe.prototype.getBillboard=Owe("_billboardCollection",fse,"_unusedBillboardIndices","billboardIndex"),mwe.prototype.removeBillboard=function(e){const t=this._collectionIndicesByEntity&&this._collectionIndicesByEntity[e.id];if(!C(this._billboardCollection)||!C(t)||!C(t.billboardIndex))return;const n=t.billboardIndex;t.billboardIndex=void 0,Dwe(this,e.id);const i=this._billboardCollection.get(n);i.id=void 0,i.show=!1,i.image=void 0,this._unusedBillboardIndices.push(n),this._clusterDirty=!0},mwe.prototype.getPoint=Owe("_pointCollection",owe,"_unusedPointIndices","pointIndex"),mwe.prototype.removePoint=function(e){const t=this._collectionIndicesByEntity&&this._collectionIndicesByEntity[e.id];if(!C(this._pointCollection)||!C(t)||!C(t.pointIndex))return;const n=t.pointIndex;t.pointIndex=void 0,Dwe(this,e.id);const i=this._pointCollection.get(n);i.show=!1,i.id=void 0,this._unusedPointIndices.push(n),this._clusterDirty=!0},mwe.prototype.update=function(e){if(!this.show)return;let t;C(this._labelCollection)&&this._labelCollection.length>0&&0===this._labelCollection.get(0)._glyphs.length&&(t=e.commandList,e.commandList=[],this._labelCollection.update(e),e.commandList=t),C(this._billboardCollection)&&this._billboardCollection.length>0&&!C(this._billboardCollection.get(0).width)&&(t=e.commandList,e.commandList=[],this._billboardCollection.update(e),e.commandList=t),this._enabledDirty&&(this._enabledDirty=!1,Rwe(this),this._clusterDirty=!0),this._clusterDirty&&(this._clusterDirty=!1,this._cluster()),C(this._clusterLabelCollection)&&this._clusterLabelCollection.update(e),C(this._clusterBillboardCollection)&&this._clusterBillboardCollection.update(e),C(this._clusterPointCollection)&&this._clusterPointCollection.update(e),C(this._labelCollection)&&this._labelCollection.update(e),C(this._billboardCollection)&&this._billboardCollection.update(e),C(this._pointCollection)&&this._pointCollection.update(e)},mwe.prototype.destroy=function(){this._labelCollection=this._labelCollection&&this._labelCollection.destroy(),this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),this._pointCollection=this._pointCollection&&this._pointCollection.destroy(),this._clusterLabelCollection=this._clusterLabelCollection&&this._clusterLabelCollection.destroy(),this._clusterBillboardCollection=this._clusterBillboardCollection&&this._clusterBillboardCollection.destroy(),this._clusterPointCollection=this._clusterPointCollection&&this._clusterPointCollection.destroy(),C(this._removeEventListener)&&(this._removeEventListener(),this._removeEventListener=void 0),this._labelCollection=void 0,this._billboardCollection=void 0,this._pointCollection=void 0,this._clusterBillboardCollection=void 0,this._clusterLabelCollection=void 0,this._clusterPointCollection=void 0,this._collectionIndicesByEntity=void 0,this._unusedLabelIndices=[],this._unusedBillboardIndices=[],this._unusedPointIndices=[],this._previousClusters=[],this._previousHeight=void 0,this._enabledDirty=!1,this._pixelRangeDirty=!1,this._minimumClusterSizeDirty=!1};var Lwe=mwe;function Mwe(e){this._name=e,this._clock=void 0,this._changed=new $n,this._error=new $n,this._isLoading=!1,this._loading=new $n,this._entityCollection=new Nbe(this),this._entityCluster=new Lwe}Object.defineProperties(Mwe.prototype,{name:{get:function(){return this._name},set:function(e){this._name!==e&&(this._name=e,this._changed.raiseEvent(this))}},clock:{get:function(){return this._clock},set:function(e){this._clock!==e&&(this._clock=e,this._changed.raiseEvent(this))}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading},set:function(e){hAe.setLoading(this,e)}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(e){this._entityCollection.show=e}},clustering:{get:function(){return this._entityCluster},set:function(e){if(!C(e))throw new x("value must be defined.");this._entityCluster=e}}}),Mwe.prototype.update=function(e){return!0};var Bwe=Mwe;const Nwe=K.ZERO,Fwe=new K,zwe=new K,kwe=new xy;function Uwe(e){this.id=e,this.vertexFormat=void 0,this.length=void 0,this.topRadius=void 0,this.bottomRadius=void 0,this.slices=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function Vwe(e,t){fQ.call(this,{entity:e,scene:t,geometryOptions:new Uwe(e),geometryPropertyName:"cylinder",observedPropertyNames:["availability","position","orientation","cylinder"]}),this._onEntityPropertyChanged(e,"cylinder",e.cylinder,void 0)}function Hwe(e,t,n){vK.call(this,e,t,n)}C(Object.create)&&(Vwe.prototype=Object.create(fQ.prototype),Vwe.prototype.constructor=Vwe),Object.defineProperties(Vwe.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),Vwe.prototype.createFillGeometryInstance=function(e){if(D.defined("time",e),!this._fillEnabled)throw new x("This instance does not represent a filled geometry.");const t=this._entity,n=t.isAvailable(e),i=new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),r=jT.fromDistanceDisplayCondition(o),s={show:i,distanceDisplayCondition:r,color:void 0,offset:void 0};if(this._materialProperty instanceof BU){let t;C(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(t=this._materialProperty.color.getValue(e,kwe)),C(t)||(t=xy.WHITE),s.color=Iy.fromColor(t)}return C(this._options.offsetAttribute)&&(s.offset=JO.fromCartesian3(Bz.getValueOrDefault(this._terrainOffsetProperty,e,Nwe,Fwe))),new Sm({id:t,geometry:new FT(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:s})},Vwe.prototype.createOutlineGeometryInstance=function(e){if(D.defined("time",e),!this._outlineEnabled)throw new x("This instance does not represent an outlined geometry.");const t=this._entity,n=t.isAvailable(e),i=Bz.getValueOrDefault(this._outlineColorProperty,e,xy.BLACK,kwe),o=this._distanceDisplayConditionProperty.getValue(e),r={show:new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Iy.fromColor(i),distanceDisplayCondition:jT.fromDistanceDisplayCondition(o),offset:void 0};return C(this._options.offsetAttribute)&&(r.offset=JO.fromCartesian3(Bz.getValueOrDefault(this._terrainOffsetProperty,e,Nwe,Fwe))),new Sm({id:t,geometry:new VT(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:r})},Vwe.prototype._computeCenter=function(e,t){return Bz.getValueOrUndefined(this._entity.position,e,t)},Vwe.prototype._isHidden=function(e,t){return!C(e.position)||!C(t.length)||!C(t.topRadius)||!C(t.bottomRadius)||fQ.prototype._isHidden.call(this,e,t)},Vwe.prototype._isDynamic=function(e,t){return!e.position.isConstant||!Bz.isConstant(e.orientation)||!t.length.isConstant||!t.topRadius.isConstant||!t.bottomRadius.isConstant||!Bz.isConstant(t.slices)||!Bz.isConstant(t.outlineWidth)||!Bz.isConstant(t.numberOfVerticalLines)},Vwe.prototype._setStaticOptions=function(e,t){const n=Bz.getValueOrDefault(t.heightReference,fO.MINIMUM_VALUE,Sz.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof BU?LU.VERTEX_FORMAT:SU.MaterialSupport.TEXTURED.vertexFormat,i.length=t.length.getValue(fO.MINIMUM_VALUE),i.topRadius=t.topRadius.getValue(fO.MINIMUM_VALUE),i.bottomRadius=t.bottomRadius.getValue(fO.MINIMUM_VALUE),i.slices=Bz.getValueOrUndefined(t.slices,fO.MINIMUM_VALUE),i.numberOfVerticalLines=Bz.getValueOrUndefined(t.numberOfVerticalLines,fO.MINIMUM_VALUE),i.offsetAttribute=n!==Sz.NONE?Wf.ALL:void 0},Vwe.prototype._onEntityPropertyChanged=AQ,Vwe.DynamicGeometryUpdater=Hwe,C(Object.create)&&(Hwe.prototype=Object.create(vK.prototype),Hwe.prototype.constructor=Hwe),Hwe.prototype._isHidden=function(e,t,n){const i=this._options,o=Bz.getValueOrUndefined(e.position,n,zwe);return!C(o)||!C(i.length)||!C(i.topRadius)||!C(i.bottomRadius)||vK.prototype._isHidden.call(this,e,t,n)},Hwe.prototype._setOptions=function(e,t,n){const i=Bz.getValueOrDefault(t.heightReference,n,Sz.NONE),o=this._options;o.length=Bz.getValueOrUndefined(t.length,n),o.topRadius=Bz.getValueOrUndefined(t.topRadius,n),o.bottomRadius=Bz.getValueOrUndefined(t.bottomRadius,n),o.slices=Bz.getValueOrUndefined(t.slices,n),o.numberOfVerticalLines=Bz.getValueOrUndefined(t.numberOfVerticalLines,n),o.offsetAttribute=i!==Sz.NONE?Wf.ALL:void 0};var Gwe=Vwe;function Wwe(){this._definitionChanged=new $n,this._startTime=void 0,this._stopTime=void 0,this._currentTime=void 0,this._clockRange=void 0,this._clockStep=void 0,this._multiplier=void 0}Object.defineProperties(Wwe.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},startTime:cX("startTime"),stopTime:cX("stopTime"),currentTime:cX("currentTime"),clockRange:cX("clockRange"),clockStep:cX("clockStep"),multiplier:cX("multiplier")}),Wwe.prototype.clone=function(e){return C(e)||(e=new Wwe),e.startTime=this.startTime,e.stopTime=this.stopTime,e.currentTime=this.currentTime,e.clockRange=this.clockRange,e.clockStep=this.clockStep,e.multiplier=this.multiplier,e},Wwe.prototype.equals=function(e){return this===e||C(e)&&Ea.equals(this.startTime,e.startTime)&&Ea.equals(this.stopTime,e.stopTime)&&Ea.equals(this.currentTime,e.currentTime)&&this.clockRange===e.clockRange&&this.clockStep===e.clockStep&&this.multiplier===e.multiplier},Wwe.prototype.merge=function(e){if(!C(e))throw new x("source is required.");this.startTime=R(this.startTime,e.startTime),this.stopTime=R(this.stopTime,e.stopTime),this.currentTime=R(this.currentTime,e.currentTime),this.clockRange=R(this.clockRange,e.clockRange),this.clockStep=R(this.clockStep,e.clockStep),this.multiplier=R(this.multiplier,e.multiplier)},Wwe.prototype.getValue=function(e){return C(e)||(e=new _y),e.startTime=R(this.startTime,e.startTime),e.stopTime=R(this.stopTime,e.stopTime),e.currentTime=R(this.currentTime,e.currentTime),e.clockRange=R(this.clockRange,e.clockRange),e.multiplier=R(this.multiplier,e.multiplier),e.clockStep=R(this.clockStep,e.clockStep),e};var qwe=Wwe;const jwe=xy.WHITE,Ywe=.1,Kwe=new ro(8,8),Xwe=new ro(0,0),Qwe=new ro(1,1);function Jwe(e){e=R(e,R.EMPTY_OBJECT),this._definitionChanged=new $n,this._color=void 0,this._colorSubscription=void 0,this._cellAlpha=void 0,this._cellAlphaSubscription=void 0,this._lineCount=void 0,this._lineCountSubscription=void 0,this._lineThickness=void 0,this._lineThicknessSubscription=void 0,this._lineOffset=void 0,this._lineOffsetSubscription=void 0,this.color=e.color,this.cellAlpha=e.cellAlpha,this.lineCount=e.lineCount,this.lineThickness=e.lineThickness,this.lineOffset=e.lineOffset}Object.defineProperties(Jwe.prototype,{isConstant:{get:function(){return Bz.isConstant(this._color)&&Bz.isConstant(this._cellAlpha)&&Bz.isConstant(this._lineCount)&&Bz.isConstant(this._lineThickness)&&Bz.isConstant(this._lineOffset)}},definitionChanged:{get:function(){return this._definitionChanged}},color:Tz("color"),cellAlpha:Tz("cellAlpha"),lineCount:Tz("lineCount"),lineThickness:Tz("lineThickness"),lineOffset:Tz("lineOffset")}),Jwe.prototype.getType=function(e){return"Grid"},Jwe.prototype.getValue=function(e,t){return C(t)||(t={}),t.color=Bz.getValueOrClonedDefault(this._color,e,jwe,t.color),t.cellAlpha=Bz.getValueOrDefault(this._cellAlpha,e,Ywe),t.lineCount=Bz.getValueOrClonedDefault(this._lineCount,e,Kwe,t.lineCount),t.lineThickness=Bz.getValueOrClonedDefault(this._lineThickness,e,Qwe,t.lineThickness),t.lineOffset=Bz.getValueOrClonedDefault(this._lineOffset,e,Xwe,t.lineOffset),t},Jwe.prototype.equals=function(e){return this===e||e instanceof Jwe&&Bz.equals(this._color,e._color)&&Bz.equals(this._cellAlpha,e._cellAlpha)&&Bz.equals(this._lineCount,e._lineCount)&&Bz.equals(this._lineThickness,e._lineThickness)&&Bz.equals(this._lineOffset,e._lineOffset)};var Zwe=Jwe;function $we(e){this._definitionChanged=new $n,this._color=void 0,this._colorSubscription=void 0,this.color=e}Object.defineProperties($we.prototype,{isConstant:{get:function(){return Bz.isConstant(this._color)}},definitionChanged:{get:function(){return this._definitionChanged}},color:Tz("color")}),$we.prototype.getType=function(e){return"PolylineArrow"},$we.prototype.getValue=function(e,t){return C(t)||(t={}),t.color=Bz.getValueOrClonedDefault(this._color,e,xy.WHITE,t.color),t},$we.prototype.equals=function(e){return this===e||e instanceof $we&&Bz.equals(this._color,e._color)};var eTe=$we;const tTe=xy.WHITE,nTe=xy.TRANSPARENT,iTe=16,oTe=255;function rTe(e){e=R(e,R.EMPTY_OBJECT),this._definitionChanged=new $n,this._color=void 0,this._colorSubscription=void 0,this._gapColor=void 0,this._gapColorSubscription=void 0,this._dashLength=void 0,this._dashLengthSubscription=void 0,this._dashPattern=void 0,this._dashPatternSubscription=void 0,this.color=e.color,this.gapColor=e.gapColor,this.dashLength=e.dashLength,this.dashPattern=e.dashPattern}Object.defineProperties(rTe.prototype,{isConstant:{get:function(){return Bz.isConstant(this._color)&&Bz.isConstant(this._gapColor)&&Bz.isConstant(this._dashLength)&&Bz.isConstant(this._dashPattern)}},definitionChanged:{get:function(){return this._definitionChanged}},color:Tz("color"),gapColor:Tz("gapColor"),dashLength:Tz("dashLength"),dashPattern:Tz("dashPattern")}),rTe.prototype.getType=function(e){return"PolylineDash"},rTe.prototype.getValue=function(e,t){return C(t)||(t={}),t.color=Bz.getValueOrClonedDefault(this._color,e,tTe,t.color),t.gapColor=Bz.getValueOrClonedDefault(this._gapColor,e,nTe,t.gapColor),t.dashLength=Bz.getValueOrDefault(this._dashLength,e,iTe,t.dashLength),t.dashPattern=Bz.getValueOrDefault(this._dashPattern,e,oTe,t.dashPattern),t},rTe.prototype.equals=function(e){return this===e||e instanceof rTe&&Bz.equals(this._color,e._color)&&Bz.equals(this._gapColor,e._gapColor)&&Bz.equals(this._dashLength,e._dashLength)&&Bz.equals(this._dashPattern,e._dashPattern)};var sTe=rTe;const aTe=xy.WHITE,cTe=.25,lTe=1;function uTe(e){e=R(e,R.EMPTY_OBJECT),this._definitionChanged=new $n,this._color=void 0,this._colorSubscription=void 0,this._glowPower=void 0,this._glowPowerSubscription=void 0,this._taperPower=void 0,this._taperPowerSubscription=void 0,this.color=e.color,this.glowPower=e.glowPower,this.taperPower=e.taperPower}Object.defineProperties(uTe.prototype,{isConstant:{get:function(){return Bz.isConstant(this._color)&&Bz.isConstant(this._glow)}},definitionChanged:{get:function(){return this._definitionChanged}},color:Tz("color"),glowPower:Tz("glowPower"),taperPower:Tz("taperPower")}),uTe.prototype.getType=function(e){return"PolylineGlow"},uTe.prototype.getValue=function(e,t){return C(t)||(t={}),t.color=Bz.getValueOrClonedDefault(this._color,e,aTe,t.color),t.glowPower=Bz.getValueOrDefault(this._glowPower,e,cTe,t.glowPower),t.taperPower=Bz.getValueOrDefault(this._taperPower,e,lTe,t.taperPower),t},uTe.prototype.equals=function(e){return this===e||e instanceof uTe&&Bz.equals(this._color,e._color)&&Bz.equals(this._glowPower,e._glowPower)&&Bz.equals(this._taperPower,e._taperPower)};var hTe=uTe;const dTe=xy.WHITE,fTe=xy.BLACK,pTe=1;function mTe(e){e=R(e,R.EMPTY_OBJECT),this._definitionChanged=new $n,this._color=void 0,this._colorSubscription=void 0,this._outlineColor=void 0,this._outlineColorSubscription=void 0,this._outlineWidth=void 0,this._outlineWidthSubscription=void 0,this.color=e.color,this.outlineColor=e.outlineColor,this.outlineWidth=e.outlineWidth}Object.defineProperties(mTe.prototype,{isConstant:{get:function(){return Bz.isConstant(this._color)&&Bz.isConstant(this._outlineColor)&&Bz.isConstant(this._outlineWidth)}},definitionChanged:{get:function(){return this._definitionChanged}},color:Tz("color"),outlineColor:Tz("outlineColor"),outlineWidth:Tz("outlineWidth")}),mTe.prototype.getType=function(e){return"PolylineOutline"},mTe.prototype.getValue=function(e,t){return C(t)||(t={}),t.color=Bz.getValueOrClonedDefault(this._color,e,dTe,t.color),t.outlineColor=Bz.getValueOrClonedDefault(this._outlineColor,e,fTe,t.outlineColor),t.outlineWidth=Bz.getValueOrDefault(this._outlineWidth,e,pTe),t},mTe.prototype.equals=function(e){return this===e||e instanceof mTe&&Bz.equals(this._color,e._color)&&Bz.equals(this._outlineColor,e._outlineColor)&&Bz.equals(this._outlineWidth,e._outlineWidth)};var _Te=mTe;function gTe(e,t){this._value=void 0,this._definitionChanged=new $n,this._eventHelper=new RC,this._referenceFrame=R(t,vL.FIXED),this.setValue(e)}Object.defineProperties(gTe.prototype,{isConstant:{get:function(){const e=this._value;if(!C(e))return!0;const t=e.length;for(let n=0;n<t;n++)if(!Bz.isConstant(e[n]))return!1;return!0}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}}}),gTe.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,vL.FIXED,t)},gTe.prototype.getValueInReferenceFrame=function(e,t,n){if(!C(e))throw new x("time is required.");if(!C(t))throw new x("referenceFrame is required.");const i=this._value;if(!C(i))return;const o=i.length;C(n)||(n=new Array(o));let r=0,s=0;while(r<o){const o=i[r],a=o.getValueInReferenceFrame(e,t,n[r]);C(a)&&(n[s]=a,s++),r++}return n.length=s,n},gTe.prototype.setValue=function(e){const t=this._eventHelper;if(t.removeAll(),C(e)){this._value=e.slice();const n=e.length;for(let i=0;i<n;i++){const n=e[i];C(n)&&t.add(n.definitionChanged,gTe.prototype._raiseDefinitionChanged,this)}}else this._value=void 0;this._definitionChanged.raiseEvent(this)},gTe.prototype.equals=function(e){return this===e||e instanceof gTe&&this._referenceFrame===e._referenceFrame&&Bz.arrayEquals(this._value,e._value)},gTe.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};var yTe=gTe;function vTe(e){this._value=void 0,this._definitionChanged=new $n,this._eventHelper=new RC,this.setValue(e)}Object.defineProperties(vTe.prototype,{isConstant:{get:function(){const e=this._value;if(!C(e))return!0;const t=e.length;for(let n=0;n<t;n++)if(!Bz.isConstant(e[n]))return!1;return!0}},definitionChanged:{get:function(){return this._definitionChanged}}}),vTe.prototype.getValue=function(e,t){if(!C(e))throw new x("time is required.");const n=this._value;if(!C(n))return;const i=n.length;C(t)||(t=new Array(i));let o=0,r=0;while(o<i){const n=this._value[o],i=n.getValue(e,t[o]);C(i)&&(t[r]=i,r++),o++}return t.length=r,t},vTe.prototype.setValue=function(e){const t=this._eventHelper;if(t.removeAll(),C(e)){this._value=e.slice();const n=e.length;for(let i=0;i<n;i++){const n=e[i];C(n)&&t.add(n.definitionChanged,vTe.prototype._raiseDefinitionChanged,this)}}else this._value=void 0;this._definitionChanged.raiseEvent(this)},vTe.prototype.equals=function(e){return this===e||e instanceof vTe&&Bz.arrayEquals(this._value,e._value)},vTe.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};var bTe=vTe;function ATe(e){let t=e._targetProperty;if(!C(t)){let n=e._targetEntity;if(!C(n)){if(n=e._targetCollection.getById(e._targetId),!C(n))return void(e._targetEntity=e._targetProperty=void 0);n.definitionChanged.addEventListener(wTe.prototype._onTargetEntityDefinitionChanged,e),e._targetEntity=n}const i=e._targetPropertyNames;t=e._targetEntity;for(let e=0,o=i.length;e<o&&C(t);++e)t=t[i[e]];e._targetProperty=t}return t}function wTe(e,t,n){if(!C(e))throw new x("targetCollection is required.");if(!C(t)||""===t)throw new x("targetId is required.");if(!C(n)||0===n.length)throw new x("targetPropertyNames is required.");for(let i=0;i<n.length;i++){const e=n[i];if(!C(e)||""===e)throw new x("reference contains invalid properties.")}this._targetCollection=e,this._targetId=t,this._targetPropertyNames=n,this._targetProperty=void 0,this._targetEntity=void 0,this._definitionChanged=new $n,e.collectionChanged.addEventListener(wTe.prototype._onCollectionChanged,this)}Object.defineProperties(wTe.prototype,{isConstant:{get:function(){return Bz.isConstant(ATe(this))}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){const e=ATe(this);return C(e)?e.referenceFrame:void 0}},targetId:{get:function(){return this._targetId}},targetCollection:{get:function(){return this._targetCollection}},targetPropertyNames:{get:function(){return this._targetPropertyNames}},resolvedProperty:{get:function(){return ATe(this)}}}),wTe.fromString=function(e,t){if(!C(e))throw new x("targetCollection is required.");if(!C(t))throw new x("referenceString is required.");let n;const i=[];let o=!0,r=!1,s="";for(let a=0;a<t.length;++a){const e=t.charAt(a);r?(s+=e,r=!1):"\\"===e?r=!0:o&&"#"===e?(n=s,o=!1,s=""):o||"."!==e?s+=e:(i.push(s),s="")}return i.push(s),new wTe(e,n,i)},wTe.prototype.getValue=function(e,t){const n=ATe(this);return C(n)?n.getValue(e,t):void 0},wTe.prototype.getValueInReferenceFrame=function(e,t,n){const i=ATe(this);return C(i)?i.getValueInReferenceFrame(e,t,n):void 0},wTe.prototype.getType=function(e){const t=ATe(this);return C(t)?t.getType(e):void 0},wTe.prototype.equals=function(e){if(this===e)return!0;const t=this._targetPropertyNames,n=e._targetPropertyNames;if(this._targetCollection!==e._targetCollection||this._targetId!==e._targetId||t.length!==n.length)return!1;const i=this._targetPropertyNames.length;for(let o=0;o<i;o++)if(t[o]!==n[o])return!1;return!0},wTe.prototype._onTargetEntityDefinitionChanged=function(e,t,n,i){C(this._targetProperty)&&this._targetPropertyNames[0]===t&&(this._targetProperty=void 0,this._definitionChanged.raiseEvent(this))},wTe.prototype._onCollectionChanged=function(e,t,n){let i=this._targetEntity;C(i)&&-1!==n.indexOf(i)?(i.definitionChanged.removeEventListener(wTe.prototype._onTargetEntityDefinitionChanged,this),this._targetEntity=this._targetProperty=void 0):C(i)||(i=ATe(this),C(i)&&this._definitionChanged.raiseEvent(this))};var TTe=wTe;const CTe={packedLength:1,pack:function(e,t,n){if(!C(e))throw new x("value is required");if(!C(t))throw new x("array is required");return n=R(n,0),t[n]=e,t},unpack:function(e,t,n){if(!C(e))throw new x("array is required");return t=R(t,0),e[t]},convertPackedArrayForInterpolation:function(e,t,n,i){if(!C(e))throw new x("packedArray is required");let o;C(i)||(i=[]),t=R(t,0),n=R(n,e.length);for(let r=0,s=n-t+1;r<s;r++){const n=e[t+r];0===r||Math.abs(o-n)<Math.PI?i[r]=n:i[r]=n-z.TWO_PI,o=n}},unpackInterpolationResult:function(e,t,n,i,o){if(!C(e))throw new x("array is required");if(!C(t))throw new x("sourceArray is required");return o=e[0],o<0?o+z.TWO_PI:o}};var ETe=CTe;const xTe={packedLength:1,pack:function(e,t,n){n=R(n,0),t[n]=e},unpack:function(e,t,n){return t=R(t,0),e[t]}};function STe(e,t,n){let i;const o=e.length,r=n.length,s=o+r;if(e.length=s,o!==t){let n=o-1;for(i=s-1;i>=t;i--)e[i]=e[n--]}for(i=0;i<r;i++)e[t++]=n[i]}function ITe(e,t){return e instanceof Ea?e:"string"===typeof e?Ea.fromIso8601(e):Ea.addSeconds(t,e,new Ea)}const OTe=[],DTe=[];function PTe(e,t,n,i,o){let r,s,a,c,l,u,h=0;while(h<i.length){l=ITe(i[h],e),a=qs(t,l,Ea.compare);let d=0,f=0;if(a<0){a=~a,c=a*o,s=void 0,u=t[a];while(h<i.length){if(l=ITe(i[h],e),C(s)&&Ea.compare(s,l)>=0||C(u)&&Ea.compare(l,u)>=0)break;for(OTe[d++]=l,h+=1,r=0;r<o;r++)DTe[f++]=i[h],h+=1;s=l}d>0&&(DTe.length=f,STe(n,c,DTe),OTe.length=d,STe(t,a,OTe))}else{for(r=0;r<o;r++)h++,n[a*o+r]=i[h];h++}}}function RTe(e,t){D.defined("type",e);let n=e;n===Number&&(n=xTe);let i,o=n.packedLength,r=R(n.packedInterpolationLength,o),s=0;if(C(t)){const e=t.length;i=new Array(e);for(let n=0;n<e;n++){let e=t[n];e===Number&&(e=xTe);const s=e.packedLength;o+=s,r+=R(e.packedInterpolationLength,s),i[n]=e}s=e}this._type=e,this._innerType=n,this._interpolationDegree=1,this._interpolationAlgorithm=wO,this._numberOfPoints=0,this._times=[],this._values=[],this._xTable=[],this._yTable=[],this._packedLength=o,this._packedInterpolationLength=r,this._updateTableLength=!0,this._interpolationResult=new Array(r),this._definitionChanged=new $n,this._derivativeTypes=t,this._innerDerivativeTypes=i,this._inputOrder=s,this._forwardExtrapolationType=NC.NONE,this._forwardExtrapolationDuration=0,this._backwardExtrapolationType=NC.NONE,this._backwardExtrapolationDuration=0}function LTe(e,t,n){const i=e._packedLength;e._times.splice(t,n),e._values.splice(t*i,n*i),e._updateTableLength=!0,e._definitionChanged.raiseEvent(e)}Object.defineProperties(RTe.prototype,{isConstant:{get:function(){return 0===this._values.length}},definitionChanged:{get:function(){return this._definitionChanged}},type:{get:function(){return this._type}},derivativeTypes:{get:function(){return this._derivativeTypes}},interpolationDegree:{get:function(){return this._interpolationDegree}},interpolationAlgorithm:{get:function(){return this._interpolationAlgorithm}},forwardExtrapolationType:{get:function(){return this._forwardExtrapolationType},set:function(e){this._forwardExtrapolationType!==e&&(this._forwardExtrapolationType=e,this._definitionChanged.raiseEvent(this))}},forwardExtrapolationDuration:{get:function(){return this._forwardExtrapolationDuration},set:function(e){this._forwardExtrapolationDuration!==e&&(this._forwardExtrapolationDuration=e,this._definitionChanged.raiseEvent(this))}},backwardExtrapolationType:{get:function(){return this._backwardExtrapolationType},set:function(e){this._backwardExtrapolationType!==e&&(this._backwardExtrapolationType=e,this._definitionChanged.raiseEvent(this))}},backwardExtrapolationDuration:{get:function(){return this._backwardExtrapolationDuration},set:function(e){this._backwardExtrapolationDuration!==e&&(this._backwardExtrapolationDuration=e,this._definitionChanged.raiseEvent(this))}}}),RTe.prototype.getValue=function(e,t){D.defined("time",e);const n=this._times,i=n.length;if(0===i)return;let o;const r=this._innerType,s=this._values;let a=qs(n,e,Ea.compare);if(a<0){if(a=~a,0===a){const i=n[a];if(o=this._backwardExtrapolationDuration,this._backwardExtrapolationType===NC.NONE||0!==o&&Ea.secondsDifference(i,e)>o)return;if(this._backwardExtrapolationType===NC.HOLD)return r.unpack(s,0,t)}if(a>=i){a=i-1;const c=n[a];if(o=this._forwardExtrapolationDuration,this._forwardExtrapolationType===NC.NONE||0!==o&&Ea.secondsDifference(e,c)>o)return;if(this._forwardExtrapolationType===NC.HOLD)return a=i-1,r.unpack(s,a*r.packedLength,t)}const c=this._xTable,l=this._yTable,u=this._interpolationAlgorithm,h=this._packedInterpolationLength,d=this._inputOrder;if(this._updateTableLength){this._updateTableLength=!1;const e=Math.min(u.getRequiredDataPoints(this._interpolationDegree,d),i);e!==this._numberOfPoints&&(this._numberOfPoints=e,c.length=e,l.length=e*h)}const f=this._numberOfPoints-1;if(f<1)return;let p=0,m=i-1;const _=m-p+1;if(_>=f+1){let e=a-(f/2|0)-1;e<p&&(e=p);let t=e+f;t>m&&(t=m,e=t-f,e<p&&(e=p)),p=e,m=t}const g=m-p+1;for(let e=0;e<g;++e)c[e]=Ea.secondsDifference(n[p+e],n[m]);if(C(r.convertPackedArrayForInterpolation))r.convertPackedArrayForInterpolation(s,p,m,l);else{let e=0;const t=this._packedLength;let n=p*t;const i=(m+1)*t;while(n<i)l[e]=s[n],n++,e++}const y=Ea.secondsDifference(e,n[m]);let v;if(0!==d&&C(u.interpolate)){const e=Math.floor(h/(d+1));v=u.interpolate(y,c,l,e,d,d,this._interpolationResult)}else v=u.interpolateOrderZero(y,c,l,h,this._interpolationResult);return C(r.unpackInterpolationResult)?r.unpackInterpolationResult(v,s,p,m,t):r.unpack(v,0,t)}return r.unpack(s,a*this._packedLength,t)},RTe.prototype.setInterpolationOptions=function(e){if(!C(e))return;let t=!1;const n=e.interpolationAlgorithm,i=e.interpolationDegree;C(n)&&this._interpolationAlgorithm!==n&&(this._interpolationAlgorithm=n,t=!0),C(i)&&this._interpolationDegree!==i&&(this._interpolationDegree=i,t=!0),t&&(this._updateTableLength=!0,this._definitionChanged.raiseEvent(this))},RTe.prototype.addSample=function(e,t,n){const i=this._innerDerivativeTypes,o=C(i);D.defined("time",e),D.defined("value",t),o&&D.defined("derivatives",n);const r=this._innerType,s=[];if(s.push(e),r.pack(t,s,s.length),o){const e=i.length;for(let t=0;t<e;t++)i[t].pack(n[t],s,s.length)}PTe(void 0,this._times,this._values,s,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)},RTe.prototype.addSamples=function(e,t,n){const i=this._innerDerivativeTypes,o=C(i);if(D.defined("times",e),D.defined("values",t),e.length!==t.length)throw new x("times and values must be the same length.");if(o&&(!C(n)||n.length!==e.length))throw new x("times and derivativeValues must be the same length.");const r=this._innerType,s=e.length,a=[];for(let c=0;c<s;c++)if(a.push(e[c]),r.pack(t[c],a,a.length),o){const e=n[c],t=i.length;for(let n=0;n<t;n++)i[n].pack(e[n],a,a.length)}PTe(void 0,this._times,this._values,a,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)},RTe.prototype.addSamplesPackedArray=function(e,t){D.defined("packedSamples",e),PTe(t,this._times,this._values,e,this._packedLength),this._updateTableLength=!0,this._definitionChanged.raiseEvent(this)},RTe.prototype.removeSample=function(e){D.defined("time",e);const t=qs(this._times,e,Ea.compare);return!(t<0)&&(LTe(this,t,1),!0)},RTe.prototype.removeSamples=function(e){D.defined("timeInterval",e);const t=this._times;let n=qs(t,e.start,Ea.compare);n<0?n=~n:e.isStartIncluded||++n;let i=qs(t,e.stop,Ea.compare);i<0?i=~i:e.isStopIncluded&&++i,LTe(this,n,i-n)},RTe.prototype.equals=function(e){if(this===e)return!0;if(!C(e))return!1;if(this._type!==e._type||this._interpolationDegree!==e._interpolationDegree||this._interpolationAlgorithm!==e._interpolationAlgorithm)return!1;const t=this._derivativeTypes,n=C(t),i=e._derivativeTypes,o=C(i);if(n!==o)return!1;let r,s;if(n){if(s=t.length,s!==i.length)return!1;for(r=0;r<s;r++)if(t[r]!==i[r])return!1}const a=this._times,c=e._times;if(s=a.length,s!==c.length)return!1;for(r=0;r<s;r++)if(!Ea.equals(a[r],c[r]))return!1;const l=this._values,u=e._values;for(s=l.length,r=0;r<s;r++)if(l[r]!==u[r])return!1;return!0},RTe._mergeNewSamples=PTe;var MTe=RTe;function BTe(e,t){let n;if(t=R(t,0),t>0){n=new Array(t);for(let e=0;e<t;e++)n[e]=K}this._numberOfDerivatives=t,this._property=new MTe(K,n),this._definitionChanged=new $n,this._referenceFrame=R(e,vL.FIXED),this._property._definitionChanged.addEventListener((function(){this._definitionChanged.raiseEvent(this)}),this)}Object.defineProperties(BTe.prototype,{isConstant:{get:function(){return this._property.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}},interpolationDegree:{get:function(){return this._property.interpolationDegree}},interpolationAlgorithm:{get:function(){return this._property.interpolationAlgorithm}},numberOfDerivatives:{get:function(){return this._numberOfDerivatives}},forwardExtrapolationType:{get:function(){return this._property.forwardExtrapolationType},set:function(e){this._property.forwardExtrapolationType=e}},forwardExtrapolationDuration:{get:function(){return this._property.forwardExtrapolationDuration},set:function(e){this._property.forwardExtrapolationDuration=e}},backwardExtrapolationType:{get:function(){return this._property.backwardExtrapolationType},set:function(e){this._property.backwardExtrapolationType=e}},backwardExtrapolationDuration:{get:function(){return this._property.backwardExtrapolationDuration},set:function(e){this._property.backwardExtrapolationDuration=e}}}),BTe.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,vL.FIXED,t)},BTe.prototype.getValueInReferenceFrame=function(e,t,n){if(D.defined("time",e),D.defined("referenceFrame",t),n=this._property.getValue(e,n),C(n))return tX.convertToReferenceFrame(e,n,this._referenceFrame,t,n)},BTe.prototype.setInterpolationOptions=function(e){this._property.setInterpolationOptions(e)},BTe.prototype.addSample=function(e,t,n){const i=this._numberOfDerivatives;if(i>0&&(!C(n)||n.length!==i))throw new x("derivatives length must be equal to the number of derivatives.");this._property.addSample(e,t,n)},BTe.prototype.addSamples=function(e,t,n){this._property.addSamples(e,t,n)},BTe.prototype.addSamplesPackedArray=function(e,t){this._property.addSamplesPackedArray(e,t)},BTe.prototype.removeSample=function(e){return this._property.removeSample(e)},BTe.prototype.removeSamples=function(e){this._property.removeSamples(e)},BTe.prototype.equals=function(e){return this===e||e instanceof BTe&&Bz.equals(this._property,e._property)&&this._referenceFrame===e._referenceFrame};var NTe=BTe;const FTe={HORIZONTAL:0,VERTICAL:1};var zTe=Object.freeze(FTe);const kTe=zTe.HORIZONTAL,UTe=xy.WHITE,VTe=xy.BLACK,HTe=0,GTe=1;function WTe(e){e=R(e,R.EMPTY_OBJECT),this._definitionChanged=new $n,this._orientation=void 0,this._orientationSubscription=void 0,this._evenColor=void 0,this._evenColorSubscription=void 0,this._oddColor=void 0,this._oddColorSubscription=void 0,this._offset=void 0,this._offsetSubscription=void 0,this._repeat=void 0,this._repeatSubscription=void 0,this.orientation=e.orientation,this.evenColor=e.evenColor,this.oddColor=e.oddColor,this.offset=e.offset,this.repeat=e.repeat}Object.defineProperties(WTe.prototype,{isConstant:{get:function(){return Bz.isConstant(this._orientation)&&Bz.isConstant(this._evenColor)&&Bz.isConstant(this._oddColor)&&Bz.isConstant(this._offset)&&Bz.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},orientation:Tz("orientation"),evenColor:Tz("evenColor"),oddColor:Tz("oddColor"),offset:Tz("offset"),repeat:Tz("repeat")}),WTe.prototype.getType=function(e){return"Stripe"},WTe.prototype.getValue=function(e,t){return C(t)||(t={}),t.horizontal=Bz.getValueOrDefault(this._orientation,e,kTe)===zTe.HORIZONTAL,t.evenColor=Bz.getValueOrClonedDefault(this._evenColor,e,UTe,t.evenColor),t.oddColor=Bz.getValueOrClonedDefault(this._oddColor,e,VTe,t.oddColor),t.offset=Bz.getValueOrDefault(this._offset,e,HTe),t.repeat=Bz.getValueOrDefault(this._repeat,e,GTe),t},WTe.prototype.equals=function(e){return this===e||e instanceof WTe&&Bz.equals(this._orientation,e._orientation)&&Bz.equals(this._evenColor,e._evenColor)&&Bz.equals(this._oddColor,e._oddColor)&&Bz.equals(this._offset,e._offset)&&Bz.equals(this._repeat,e._repeat)};var qTe=WTe;function jTe(e){this._definitionChanged=new $n,this._intervals=new NN,this._intervals.changedEvent.addEventListener(jTe.prototype._intervalsChanged,this),this._referenceFrame=R(e,vL.FIXED)}Object.defineProperties(jTe.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}},referenceFrame:{get:function(){return this._referenceFrame}}}),jTe.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,vL.FIXED,t)},jTe.prototype.getValueInReferenceFrame=function(e,t,n){if(!C(e))throw new x("time is required.");if(!C(t))throw new x("referenceFrame is required.");const i=this._intervals.findDataForIntervalContainingDate(e);if(C(i))return tX.convertToReferenceFrame(e,i,this._referenceFrame,t,n)},jTe.prototype.equals=function(e){return this===e||e instanceof jTe&&this._intervals.equals(e._intervals,Bz.equals)&&this._referenceFrame===e._referenceFrame},jTe.prototype._intervalsChanged=function(){this._definitionChanged.raiseEvent(this)};var YTe=jTe;function KTe(){this._definitionChanged=new $n,this._intervals=new NN,this._intervals.changedEvent.addEventListener(KTe.prototype._intervalsChanged,this)}Object.defineProperties(KTe.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}}),KTe.prototype.getValue=function(e,t){if(!C(e))throw new x("time is required");const n=this._intervals.findDataForIntervalContainingDate(e);return C(n)&&"function"===typeof n.clone?n.clone(t):n},KTe.prototype.equals=function(e){return this===e||e instanceof KTe&&this._intervals.equals(e._intervals,Bz.equals)},KTe.prototype._intervalsChanged=function(){this._definitionChanged.raiseEvent(this)};var XTe=KTe;function QTe(e,t){this._position=void 0,this._subscription=void 0,this._definitionChanged=new $n,this._normalize=R(t,!0),this.position=e}Object.defineProperties(QTe.prototype,{isConstant:{get:function(){return Bz.isConstant(this._position)}},definitionChanged:{get:function(){return this._definitionChanged}},position:{get:function(){return this._position},set:function(e){const t=this._position;t!==e&&(C(t)&&this._subscription(),this._position=e,C(e)&&(this._subscription=e._definitionChanged.addEventListener((function(){this._definitionChanged.raiseEvent(this)}),this)),this._definitionChanged.raiseEvent(this))}},normalize:{get:function(){return this._normalize},set:function(e){this._normalize!==e&&(this._normalize=e,this._definitionChanged.raiseEvent(this))}}});const JTe=new K,ZTe=new K,$Te=new Ea,eCe=1/60;QTe.prototype.getValue=function(e,t){return this._getValue(e,t)},QTe.prototype._getValue=function(e,t,n){if(!C(e))throw new x("time is required");C(t)||(t=new K);const i=this._position;if(Bz.isConstant(i))return this._normalize?void 0:K.clone(K.ZERO,t);let o=i.getValue(e,JTe),r=i.getValue(Ea.addSeconds(e,eCe,$Te),ZTe);if(!C(o))return;if(!C(r)&&(r=o,o=i.getValue(Ea.addSeconds(e,-eCe,$Te),ZTe),!C(o)))return;if(K.equals(o,r))return this._normalize?void 0:K.clone(K.ZERO,t);C(n)&&o.clone(n);const s=K.subtract(r,o,t);return this._normalize?K.normalize(s,t):K.divideByScalar(s,eCe,t)},QTe.prototype.equals=function(e){return this===e||e instanceof QTe&&Bz.equals(this._position,e._position)};var tCe=QTe;function nCe(e,t){this._velocityVectorProperty=new tCe(e,!0),this._subscription=void 0,this._ellipsoid=void 0,this._definitionChanged=new $n,this.ellipsoid=R(t,ge.WGS84);const n=this;this._velocityVectorProperty.definitionChanged.addEventListener((function(){n._definitionChanged.raiseEvent(n)}))}Object.defineProperties(nCe.prototype,{isConstant:{get:function(){return Bz.isConstant(this._velocityVectorProperty)}},definitionChanged:{get:function(){return this._definitionChanged}},position:{get:function(){return this._velocityVectorProperty.position},set:function(e){this._velocityVectorProperty.position=e}},ellipsoid:{get:function(){return this._ellipsoid},set:function(e){const t=this._ellipsoid;t!==e&&(this._ellipsoid=e,this._definitionChanged.raiseEvent(this))}}});const iCe=new K,oCe=new K,rCe=new ke;nCe.prototype.getValue=function(e,t){const n=this._velocityVectorProperty._getValue(e,oCe,iCe);if(C(n))return Kl.rotationMatrixFromPositionVelocity(iCe,n,this._ellipsoid,rCe),il.fromRotationMatrix(rCe,t)},nCe.prototype.equals=function(e){return this===e||e instanceof nCe&&Bz.equals(this._velocityVectorProperty,e._velocityVectorProperty)&&(this._ellipsoid===e._ellipsoid||this._ellipsoid.equals(e._ellipsoid))};var sCe=nCe;function aCe(){}let cCe;function lCe(e,t){return"#"===t[0]&&(t=cCe+t),TTe.fromString(e,t)}function uCe(e,t,n){if(C(n.reference))return lCe(t,n.reference);if(C(n.velocityReference)){const i=lCe(t,n.velocityReference);switch(e){case K:case aCe:return new tCe(i,e===aCe);case il:return new sCe(i)}}throw new Je(`${JSON.stringify(n)} is not valid CZML.`)}function hCe(e,t){return new mQ((function(n,i){return t(e.getValue(n,i))}),e.isConstant)}aCe.packedLength=K.packedLength,aCe.unpack=K.unpack,aCe.pack=K.pack;const dCe=new K,fCe=new wN,pCe=new se,mCe=new cO,_Ce=new il;function gCe(e){let t=e.rgbaf;if(C(t))return t;const n=e.rgba;if(!C(n))return;const i=n.length;if(i===xy.packedLength)return[xy.byteToFloat(n[0]),xy.byteToFloat(n[1]),xy.byteToFloat(n[2]),xy.byteToFloat(n[3])];t=new Array(i);for(let o=0;o<i;o+=5)t[o]=n[o],t[o+1]=xy.byteToFloat(n[o+1]),t[o+2]=xy.byteToFloat(n[o+2]),t[o+3]=xy.byteToFloat(n[o+3]),t[o+4]=xy.byteToFloat(n[o+4]);return t}function yCe(e,t){const n=R(e.uri,e);return C(t)?t.getDerivedResource({url:n}):Vi.createIfNeeded(n)}function vCe(e){let t=e.wsen;if(C(t))return t;const n=e.wsenDegrees;if(!C(n))return;const i=n.length;if(i===_t.packedLength)return[z.toRadians(n[0]),z.toRadians(n[1]),z.toRadians(n[2]),z.toRadians(n[3])];t=new Array(i);for(let o=0;o<i;o+=5)t[o]=n[o],t[o+1]=z.toRadians(n[o+1]),t[o+2]=z.toRadians(n[o+2]),t[o+3]=z.toRadians(n[o+3]),t[o+4]=z.toRadians(n[o+4]);return t}function bCe(e){const t=e.length;if(fCe.magnitude=1,2===t)return fCe.clock=e[0],fCe.cone=e[1],K.fromSpherical(fCe,dCe),[dCe.x,dCe.y,dCe.z];const n=new Array(t/3*4);for(let i=0,o=0;i<t;i+=3,o+=4)n[o]=e[i],fCe.clock=e[i+1],fCe.cone=e[i+2],K.fromSpherical(fCe,dCe),n[o+1]=dCe.x,n[o+2]=dCe.y,n[o+3]=dCe.z;return n}function ACe(e){const t=e.length;if(3===t)return fCe.clock=e[0],fCe.cone=e[1],fCe.magnitude=e[2],K.fromSpherical(fCe,dCe),[dCe.x,dCe.y,dCe.z];const n=new Array(t);for(let i=0;i<t;i+=4)n[i]=e[i],fCe.clock=e[i+1],fCe.cone=e[i+2],fCe.magnitude=e[i+3],K.fromSpherical(fCe,dCe),n[i+1]=dCe.x,n[i+2]=dCe.y,n[i+3]=dCe.z;return n}function wCe(e){const t=e.length;if(3===t)return pCe.longitude=e[0],pCe.latitude=e[1],pCe.height=e[2],ge.WGS84.cartographicToCartesian(pCe,dCe),[dCe.x,dCe.y,dCe.z];const n=new Array(t);for(let i=0;i<t;i+=4)n[i]=e[i],pCe.longitude=e[i+1],pCe.latitude=e[i+2],pCe.height=e[i+3],ge.WGS84.cartographicToCartesian(pCe,dCe),n[i+1]=dCe.x,n[i+2]=dCe.y,n[i+3]=dCe.z;return n}function TCe(e){const t=e.length;if(3===t)return pCe.longitude=z.toRadians(e[0]),pCe.latitude=z.toRadians(e[1]),pCe.height=e[2],ge.WGS84.cartographicToCartesian(pCe,dCe),[dCe.x,dCe.y,dCe.z];const n=new Array(t);for(let i=0;i<t;i+=4)n[i]=e[i],pCe.longitude=z.toRadians(e[i+1]),pCe.latitude=z.toRadians(e[i+2]),pCe.height=e[i+3],ge.WGS84.cartographicToCartesian(pCe,dCe),n[i+1]=dCe.x,n[i+2]=dCe.y,n[i+3]=dCe.z;return n}function CCe(e){const t=e.cartesian;if(C(t))return t;const n=e.cartesianVelocity;if(C(n))return n;const i=e.unitCartesian;if(C(i))return i;const o=e.unitSpherical;if(C(o))return bCe(o);const r=e.spherical;if(C(r))return ACe(r);const s=e.cartographicRadians;if(C(s))return wCe(s);const a=e.cartographicDegrees;if(C(a))return TCe(a);throw new Je(`${JSON.stringify(e)} is not a valid CZML interval.`)}function ECe(e,t){K.unpack(e,t,dCe),K.normalize(dCe,dCe),K.pack(dCe,e,t)}function xCe(e){const t=CCe(e);if(3===t.length)return ECe(t,0),t;for(let n=1;n<t.length;n+=4)ECe(t,n);return t}function SCe(e,t){il.unpack(e,t,_Ce),il.normalize(_Ce,_Ce),il.pack(_Ce,e,t)}function ICe(e){const t=e.unitQuaternion;if(C(t)){if(4===t.length)return SCe(t,0),t;for(let e=1;e<t.length;e+=5)SCe(t,e)}return t}function OCe(e){return"boolean"===typeof e?Boolean:"number"===typeof e?Number:"string"===typeof e?String:e.hasOwnProperty("array")?Array:e.hasOwnProperty("boolean")?Boolean:e.hasOwnProperty("boundingRectangle")?bf:e.hasOwnProperty("cartesian2")?ro:e.hasOwnProperty("cartesian")||e.hasOwnProperty("spherical")||e.hasOwnProperty("cartographicRadians")||e.hasOwnProperty("cartographicDegrees")?K:e.hasOwnProperty("unitCartesian")||e.hasOwnProperty("unitSpherical")?aCe:e.hasOwnProperty("rgba")||e.hasOwnProperty("rgbaf")?xy:e.hasOwnProperty("arcType")?hf:e.hasOwnProperty("classificationType")?rq:e.hasOwnProperty("colorBlendMode")?y3:e.hasOwnProperty("cornerType")?Hb:e.hasOwnProperty("heightReference")?Sz:e.hasOwnProperty("horizontalOrigin")?Oz:e.hasOwnProperty("date")?Ea:e.hasOwnProperty("labelStyle")?Ise:e.hasOwnProperty("number")?Number:e.hasOwnProperty("nearFarScalar")?LO:e.hasOwnProperty("distanceDisplayCondition")?WT:e.hasOwnProperty("object")||e.hasOwnProperty("value")?Object:e.hasOwnProperty("unitQuaternion")?il:e.hasOwnProperty("shadowMode")?rj:e.hasOwnProperty("string")?String:e.hasOwnProperty("stripeOrientation")?zTe:e.hasOwnProperty("wsen")||e.hasOwnProperty("wsenDegrees")?_t:e.hasOwnProperty("uri")?cn:e.hasOwnProperty("verticalOrigin")?Pz:Object}function DCe(e,t,n){switch(e){case hf:return hf[R(t.arcType,t)];case Array:return t.array;case Boolean:return R(t["boolean"],t);case bf:return t.boundingRectangle;case ro:return t.cartesian2;case K:return CCe(t);case aCe:return xCe(t);case xy:return gCe(t);case rq:return rq[R(t.classificationType,t)];case y3:return y3[R(t.colorBlendMode,t)];case Hb:return Hb[R(t.cornerType,t)];case Sz:return Sz[R(t.heightReference,t)];case Oz:return Oz[R(t.horizontalOrigin,t)];case Image:return yCe(t,n);case Ea:return Ea.fromIso8601(R(t.date,t));case Ise:return Ise[R(t.labelStyle,t)];case Number:return R(t.number,t);case LO:return t.nearFarScalar;case WT:return t.distanceDisplayCondition;case Object:return R(R(t.object,t.value),t);case il:return ICe(t);case ETe:return R(t.number,t);case rj:return rj[R(R(t.shadowMode,t.shadows),t)];case String:return R(t.string,t);case zTe:return zTe[R(t.stripeOrientation,t)];case _t:return vCe(t);case cn:return yCe(t,n);case Pz:return Pz[R(t.verticalOrigin,t)];default:throw new Je(e)}}const PCe={HERMITE:_I,LAGRANGE:bO,LINEAR:wO};function RCe(e,t){const n=e.interpolationAlgorithm,i=e.interpolationDegree;(C(n)||C(i))&&t.setInterpolationOptions({interpolationAlgorithm:PCe[n],interpolationDegree:i});const o=e.forwardExtrapolationType;C(o)&&(t.forwardExtrapolationType=NC[o]);const r=e.forwardExtrapolationDuration;C(r)&&(t.forwardExtrapolationDuration=r);const s=e.backwardExtrapolationType;C(s)&&(t.backwardExtrapolationType=NC[s]);const a=e.backwardExtrapolationDuration;C(a)&&(t.backwardExtrapolationDuration=a)}const LCe={iso8601:void 0};function MCe(e){if(C(e))return LCe.iso8601=e,cO.fromIso8601(LCe)}function BCe(e){const t=fO.MAXIMUM_INTERVAL.clone();return t.data=e,t}function NCe(e){const t=new Kbe;return t.intervals.addInterval(BCe(e)),t}function FCe(e){const t=new Zbe(e.referenceFrame);return t.intervals.addInterval(BCe(e)),t}function zCe(e,t,n,i,o,r,s){let a,c,l,u=MCe(i.interval);C(o)&&(u=C(u)?cO.intersect(u,o,mCe):o);const h=!C(i.reference)&&!C(i.velocityReference),d=C(u)&&!u.equals(fO.MAXIMUM_INTERVAL);if(!0===i.delete)return d?kCe(t[n],u):void(t[n]=void 0);let f=!1;if(h){if(c=DCe(e,i,r),!C(c))return;a=R(e.packedLength,1),l=R(c.length,1),f=!C(i.array)&&"string"!==typeof c&&l>a&&e!==Object}const p="function"===typeof e.unpack&&e!==ETe;if(!f&&!d)return void(t[n]=h?new vz(p?e.unpack(c,0):c):uCe(e,s,i));let m,_=t[n];const g=i.epoch;if(C(g)&&(m=Ea.fromIso8601(g)),f&&!d)return _ instanceof MTe||(t[n]=_=new MTe(e)),_.addSamplesPackedArray(c,m),void RCe(i,_);let y;if(!f&&d)return u=u.clone(),u.data=h?p?e.unpack(c,0):c:uCe(e,s,i),C(_)||(t[n]=_=h?new XTe:new Kbe),void(h&&_ instanceof XTe?_.intervals.addInterval(u):_ instanceof Kbe?(h&&(u.data=new vz(u.data)),_.intervals.addInterval(u)):(t[n]=_=NCe(_),h&&(u.data=new vz(u.data)),_.intervals.addInterval(u)));C(_)||(t[n]=_=new Kbe),_ instanceof Kbe||(t[n]=_=NCe(_));const v=_.intervals;y=v.findInterval(u),C(y)&&y.data instanceof MTe||(y=u.clone(),y.data=new MTe(e),v.addInterval(y)),y.data.addSamplesPackedArray(c,m),RCe(i,y.data)}function kCe(e,t){if(e instanceof MTe)e.removeSamples(t);else if(e instanceof XTe)e.intervals.removeInterval(t);else if(e instanceof Kbe){const n=e.intervals;for(let e=0;e<n.length;++e){const i=cO.intersect(n.get(e),t,mCe);i.isEmpty||kCe(i.data,t)}n.removeInterval(t)}else;}function UCe(e,t,n,i,o,r,s){if(C(i))if(Array.isArray(i))for(let a=0,c=i.length;a<c;++a)zCe(e,t,n,i[a],o,r,s);else zCe(e,t,n,i,o,r,s)}function VCe(e,t,n,i,o,r){let s=MCe(n.interval);C(i)&&(s=C(s)?cO.intersect(s,i,mCe):i);const a=C(n.cartesianVelocity)?1:0,c=K.packedLength*(a+1);let l,u;const h=!C(n.reference),d=C(s)&&!s.equals(fO.MAXIMUM_INTERVAL);if(!0===n.delete)return d?HCe(e[t],s):void(e[t]=void 0);let f,p=!1;if(h&&(C(n.referenceFrame)&&(f=vL[n.referenceFrame]),f=R(f,vL.FIXED),l=CCe(n),u=R(l.length,1),p=u>c),!p&&!d)return void(e[t]=h?new iX(K.unpack(l),f):lCe(r,n.reference));let m,_=e[t];const g=n.epoch;if(C(g)&&(m=Ea.fromIso8601(g)),p&&!d)return _ instanceof NTe&&(!C(f)||_.referenceFrame===f)||(e[t]=_=new NTe(f,a)),_.addSamplesPackedArray(l,m),void RCe(n,_);let y;if(!p&&d)return s=s.clone(),s.data=h?K.unpack(l):lCe(r,n.reference),C(_)||(_=h?new YTe(f):new Zbe(f),e[t]=_),void(h&&_ instanceof YTe&&C(f)&&_.referenceFrame===f?_.intervals.addInterval(s):_ instanceof Zbe?(h&&(s.data=new iX(s.data,f)),_.intervals.addInterval(s)):(e[t]=_=FCe(_),h&&(s.data=new iX(s.data,f)),_.intervals.addInterval(s)));C(_)?_ instanceof Zbe||(e[t]=_=FCe(_)):e[t]=_=new Zbe(f);const v=_.intervals;y=v.findInterval(s),C(y)&&y.data instanceof NTe&&(!C(f)||y.data.referenceFrame===f)||(y=s.clone(),y.data=new NTe(f,a),v.addInterval(y)),y.data.addSamplesPackedArray(l,m),RCe(n,y.data)}function HCe(e,t){if(e instanceof NTe)e.removeSamples(t);else if(e instanceof YTe)e.intervals.removeInterval(t);else if(e instanceof Zbe){const n=e.intervals;for(let e=0;e<n.length;++e){const i=cO.intersect(n.get(e),t,mCe);i.isEmpty||HCe(i.data,t)}n.removeInterval(t)}else;}function GCe(e,t,n,i,o,r){if(C(n))if(Array.isArray(n))for(let s=0,a=n.length;s<a;++s)VCe(e,t,n[s],i,o,r);else VCe(e,t,n,i,o,r)}function WCe(e,t,n,i){C(n.references)?$Ce(e,t,n.references,n.interval,i,bTe,Kbe):(C(n.cartesian2)?n.array=ro.unpackArray(n.cartesian2):C(n.cartesian)&&(n.array=ro.unpackArray(n.cartesian)),C(n.array)&&UCe(Array,e,t,n,void 0,void 0,i))}function qCe(e,t,n,i,o,r){let s=MCe(n.interval);C(i)&&(s=C(s)?cO.intersect(s,i,mCe):i);let a,c,l,u=e[t];if(C(s)){u instanceof Qbe||(u=new Qbe,e[t]=u);const n=u.intervals;c=n.findInterval({start:s.start,stop:s.stop}),C(c)?a=c.data:(c=s.clone(),n.addInterval(c))}else a=u;C(n.solidColor)?(a instanceof BU||(a=new BU),l=n.solidColor,UCe(xy,a,"color",l.color,void 0,void 0,r)):C(n.grid)?(a instanceof Zwe||(a=new Zwe),l=n.grid,UCe(xy,a,"color",l.color,void 0,o,r),UCe(Number,a,"cellAlpha",l.cellAlpha,void 0,o,r),UCe(ro,a,"lineCount",l.lineCount,void 0,o,r),UCe(ro,a,"lineThickness",l.lineThickness,void 0,o,r),UCe(ro,a,"lineOffset",l.lineOffset,void 0,o,r)):C(n.image)?(a instanceof YK||(a=new YK),l=n.image,UCe(Image,a,"image",l.image,void 0,o,r),UCe(ro,a,"repeat",l.repeat,void 0,o,r),UCe(xy,a,"color",l.color,void 0,o,r),UCe(Boolean,a,"transparent",l.transparent,void 0,o,r)):C(n.stripe)?(a instanceof qTe||(a=new qTe),l=n.stripe,UCe(zTe,a,"orientation",l.orientation,void 0,o,r),UCe(xy,a,"evenColor",l.evenColor,void 0,o,r),UCe(xy,a,"oddColor",l.oddColor,void 0,o,r),UCe(Number,a,"offset",l.offset,void 0,o,r),UCe(Number,a,"repeat",l.repeat,void 0,o,r)):C(n.polylineOutline)?(a instanceof _Te||(a=new _Te),l=n.polylineOutline,UCe(xy,a,"color",l.color,void 0,o,r),UCe(xy,a,"outlineColor",l.outlineColor,void 0,o,r),UCe(Number,a,"outlineWidth",l.outlineWidth,void 0,o,r)):C(n.polylineGlow)?(a instanceof hTe||(a=new hTe),l=n.polylineGlow,UCe(xy,a,"color",l.color,void 0,o,r),UCe(Number,a,"glowPower",l.glowPower,void 0,o,r),UCe(Number,a,"taperPower",l.taperPower,void 0,o,r)):C(n.polylineArrow)?(a instanceof eTe||(a=new eTe),l=n.polylineArrow,UCe(xy,a,"color",l.color,void 0,void 0,r)):C(n.polylineDash)?(a instanceof sTe||(a=new sTe),l=n.polylineDash,UCe(xy,a,"color",l.color,void 0,void 0,r),UCe(xy,a,"gapColor",l.gapColor,void 0,void 0,r),UCe(Number,a,"dashLength",l.dashLength,void 0,o,r),UCe(Number,a,"dashPattern",l.dashPattern,void 0,o,r)):C(n.checkerboard)&&(a instanceof Rbe||(a=new Rbe),l=n.checkerboard,UCe(xy,a,"evenColor",l.evenColor,void 0,o,r),UCe(xy,a,"oddColor",l.oddColor,void 0,o,r),UCe(ro,a,"repeat",l.repeat,void 0,o,r)),C(c)?c.data=a:e[t]=a}function jCe(e,t,n,i,o,r){if(C(n))if(Array.isArray(n))for(let s=0,a=n.length;s<a;++s)qCe(e,t,n[s],i,o,r);else qCe(e,t,n,i,o,r)}function YCe(e,t,n,i){const o=t.name;C(o)&&(e.name=t.name)}function KCe(e,t,n,i){const o=t.description;C(o)&&UCe(String,e,"description",o,void 0,i,n)}function XCe(e,t,n,i){const o=t.position;C(o)&&GCe(e,"position",o,void 0,i,n)}function QCe(e,t,n,i){const o=t.viewFrom;C(o)&&UCe(K,e,"viewFrom",o,void 0,i,n)}function JCe(e,t,n,i){const o=t.orientation;C(o)&&UCe(il,e,"orientation",o,void 0,i,n)}function ZCe(e,t,n,i){const o=t.properties;if(C(o)){C(e.properties)||(e.properties=new TX);for(const t in o)if(o.hasOwnProperty(t)){e.properties.hasProperty(t)||e.properties.addProperty(t);const r=o[t];if(Array.isArray(r))for(let o=0,s=r.length;o<s;++o)zCe(OCe(r[o]),e.properties,t,r[o],void 0,i,n);else zCe(OCe(r),e.properties,t,r,void 0,i,n)}}}function $Ce(e,t,n,i,o,r,s){const a=n.map((function(e){return lCe(o,e)}));if(C(i)){i=MCe(i);let n=e[t];if(!(n instanceof s)){const i=new s;i.intervals.addInterval(BCe(n)),e[t]=n=i}i.data=new r(a),n.intervals.addInterval(i)}else e[t]=new r(a)}function eEe(e,t,n,i){const o=n.references;C(o)?$Ce(e,t,o,n.interval,i,bTe,Kbe):UCe(Array,e,t,n,void 0,void 0,i)}function tEe(e,t,n,i){if(C(n))if(Array.isArray(n))for(let o=0,r=n.length;o<r;++o)eEe(e,t,n[o],i);else eEe(e,t,n,i)}function nEe(e,t,n,i){const o=n.references;C(o)?$Ce(e,t,o,n.interval,i,yTe,Zbe):(C(n.cartesian)?n.array=K.unpackArray(n.cartesian):C(n.cartographicRadians)?n.array=K.fromRadiansArrayHeights(n.cartographicRadians):C(n.cartographicDegrees)&&(n.array=K.fromDegreesArrayHeights(n.cartographicDegrees)),C(n.array)&&UCe(Array,e,t,n,void 0,void 0,i))}function iEe(e,t,n,i){if(C(n))if(Array.isArray(n))for(let o=0,r=n.length;o<r;++o)nEe(e,t,n[o],i);else nEe(e,t,n,i)}function oEe(e){return K.unpackArray(e)}function rEe(e){return K.fromRadiansArrayHeights(e)}function sEe(e){return K.fromDegreesArrayHeights(e)}function aEe(e,t,n,i){const o=n.references;if(C(o)){const r=o.map((function(e){const t={};return $Ce(t,"positions",e,n.interval,i,yTe,Zbe),t.positions}));e[t]=new yTe(r)}else C(n.cartesian)?n.array=n.cartesian.map(oEe):C(n.cartographicRadians)?n.array=n.cartographicRadians.map(rEe):C(n.cartographicDegrees)&&(n.array=n.cartographicDegrees.map(sEe)),C(n.array)&&UCe(Array,e,t,n,void 0,void 0,i)}function cEe(e,t,n,i){if(C(n))if(Array.isArray(n))for(let o=0,r=n.length;o<r;++o)aEe(e,t,n[o],i);else aEe(e,t,n,i)}function lEe(e,t,n,i){if(C(n))if(Array.isArray(n))for(let o=0,r=n.length;o<r;o++)WCe(e,t,n[o],i);else WCe(e,t,n,i)}function uEe(e,t,n,i){const o=t.availability;if(!C(o))return;let r;if(Array.isArray(o))for(let s=0,a=o.length;s<a;++s)C(r)||(r=new NN),r.addInterval(MCe(o[s]));else r=new NN,r.addInterval(MCe(o));e.availability=r}function hEe(e,t,n,i,o){C(t)&&UCe(aCe,e,"alignedAxis",t,n,i,o)}function dEe(e,t,n,i){const o=t.billboard;if(!C(o))return;const r=MCe(o.interval);let s=e.billboard;C(s)||(e.billboard=s=new Ez),UCe(Boolean,s,"show",o.show,r,i,n),UCe(Image,s,"image",o.image,r,i,n),UCe(Number,s,"scale",o.scale,r,i,n),UCe(ro,s,"pixelOffset",o.pixelOffset,r,i,n),UCe(K,s,"eyeOffset",o.eyeOffset,r,i,n),UCe(Oz,s,"horizontalOrigin",o.horizontalOrigin,r,i,n),UCe(Pz,s,"verticalOrigin",o.verticalOrigin,r,i,n),UCe(Sz,s,"heightReference",o.heightReference,r,i,n),UCe(xy,s,"color",o.color,r,i,n),UCe(ETe,s,"rotation",o.rotation,r,i,n),hEe(s,o.alignedAxis,r,i,n),UCe(Boolean,s,"sizeInMeters",o.sizeInMeters,r,i,n),UCe(Number,s,"width",o.width,r,i,n),UCe(Number,s,"height",o.height,r,i,n),UCe(LO,s,"scaleByDistance",o.scaleByDistance,r,i,n),UCe(LO,s,"translucencyByDistance",o.translucencyByDistance,r,i,n),UCe(LO,s,"pixelOffsetScaleByDistance",o.pixelOffsetScaleByDistance,r,i,n),UCe(bf,s,"imageSubRegion",o.imageSubRegion,r,i,n),UCe(WT,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),UCe(Number,s,"disableDepthTestDistance",o.disableDepthTestDistance,r,i,n)}function fEe(e,t,n,i){const o=t.box;if(!C(o))return;const r=MCe(o.interval);let s=e.box;C(s)||(e.box=s=new ZK),UCe(Boolean,s,"show",o.show,r,i,n),UCe(K,s,"dimensions",o.dimensions,r,i,n),UCe(Sz,s,"heightReference",o.heightReference,r,i,n),UCe(Boolean,s,"fill",o.fill,r,i,n),jCe(s,"material",o.material,r,i,n),UCe(Boolean,s,"outline",o.outline,r,i,n),UCe(xy,s,"outlineColor",o.outlineColor,r,i,n),UCe(Number,s,"outlineWidth",o.outlineWidth,r,i,n),UCe(rj,s,"shadows",o.shadows,r,i,n),UCe(WT,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n)}function pEe(e,t,n,i){const o=t.corridor;if(!C(o))return;const r=MCe(o.interval);let s=e.corridor;C(s)||(e.corridor=s=new rX),UCe(Boolean,s,"show",o.show,r,i,n),iEe(s,"positions",o.positions,n),UCe(Number,s,"width",o.width,r,i,n),UCe(Number,s,"height",o.height,r,i,n),UCe(Sz,s,"heightReference",o.heightReference,r,i,n),UCe(Number,s,"extrudedHeight",o.extrudedHeight,r,i,n),UCe(Sz,s,"extrudedHeightReference",o.extrudedHeightReference,r,i,n),UCe(Hb,s,"cornerType",o.cornerType,r,i,n),UCe(Number,s,"granularity",o.granularity,r,i,n),UCe(Boolean,s,"fill",o.fill,r,i,n),jCe(s,"material",o.material,r,i,n),UCe(Boolean,s,"outline",o.outline,r,i,n),UCe(xy,s,"outlineColor",o.outlineColor,r,i,n),UCe(Number,s,"outlineWidth",o.outlineWidth,r,i,n),UCe(rj,s,"shadows",o.shadows,r,i,n),UCe(WT,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),UCe(rq,s,"classificationType",o.classificationType,r,i,n),UCe(Number,s,"zIndex",o.zIndex,r,i,n)}function mEe(e,t,n,i){const o=t.cylinder;if(!C(o))return;const r=MCe(o.interval);let s=e.cylinder;C(s)||(e.cylinder=s=new uX),UCe(Boolean,s,"show",o.show,r,i,n),UCe(Number,s,"length",o.length,r,i,n),UCe(Number,s,"topRadius",o.topRadius,r,i,n),UCe(Number,s,"bottomRadius",o.bottomRadius,r,i,n),UCe(Sz,s,"heightReference",o.heightReference,r,i,n),UCe(Boolean,s,"fill",o.fill,r,i,n),jCe(s,"material",o.material,r,i,n),UCe(Boolean,s,"outline",o.outline,r,i,n),UCe(xy,s,"outlineColor",o.outlineColor,r,i,n),UCe(Number,s,"outlineWidth",o.outlineWidth,r,i,n),UCe(Number,s,"numberOfVerticalLines",o.numberOfVerticalLines,r,i,n),UCe(Number,s,"slices",o.slices,r,i,n),UCe(rj,s,"shadows",o.shadows,r,i,n),UCe(WT,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n)}function _Ee(e,t){const n=e.version;if(C(n)&&"string"===typeof n){const e=n.split(".");if(2===e.length){if("1"!==e[0])throw new Je("Cesium only supports CZML version 1.");t._version=n}}if(!C(t._version))throw new Je("CZML version information invalid.  It is expected to be a property on the document object in the <Major>.<Minor> version format.");const i=t._documentPacket;C(e.name)&&(i.name=e.name);const o=e.clock;if(C(o)){const e=i.clock;C(e)?(e.interval=R(o.interval,e.interval),e.currentTime=R(o.currentTime,e.currentTime),e.range=R(o.range,e.range),e.step=R(o.step,e.step),e.multiplier=R(o.multiplier,e.multiplier)):i.clock={interval:o.interval,currentTime:o.currentTime,range:o.range,step:o.step,multiplier:o.multiplier}}}function gEe(e,t,n,i){const o=t.ellipse;if(!C(o))return;const r=MCe(o.interval);let s=e.ellipse;C(s)||(e.ellipse=s=new dX),UCe(Boolean,s,"show",o.show,r,i,n),UCe(Number,s,"semiMajorAxis",o.semiMajorAxis,r,i,n),UCe(Number,s,"semiMinorAxis",o.semiMinorAxis,r,i,n),UCe(Number,s,"height",o.height,r,i,n),UCe(Sz,s,"heightReference",o.heightReference,r,i,n),UCe(Number,s,"extrudedHeight",o.extrudedHeight,r,i,n),UCe(Sz,s,"extrudedHeightReference",o.extrudedHeightReference,r,i,n),UCe(ETe,s,"rotation",o.rotation,r,i,n),UCe(ETe,s,"stRotation",o.stRotation,r,i,n),UCe(Number,s,"granularity",o.granularity,r,i,n),UCe(Boolean,s,"fill",o.fill,r,i,n),jCe(s,"material",o.material,r,i,n),UCe(Boolean,s,"outline",o.outline,r,i,n),UCe(xy,s,"outlineColor",o.outlineColor,r,i,n),UCe(Number,s,"outlineWidth",o.outlineWidth,r,i,n),UCe(Number,s,"numberOfVerticalLines",o.numberOfVerticalLines,r,i,n),UCe(rj,s,"shadows",o.shadows,r,i,n),UCe(WT,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),UCe(rq,s,"classificationType",o.classificationType,r,i,n),UCe(Number,s,"zIndex",o.zIndex,r,i,n)}function yEe(e,t,n,i){const o=t.ellipsoid;if(!C(o))return;const r=MCe(o.interval);let s=e.ellipsoid;C(s)||(e.ellipsoid=s=new pX),UCe(Boolean,s,"show",o.show,r,i,n),UCe(K,s,"radii",o.radii,r,i,n),UCe(K,s,"innerRadii",o.innerRadii,r,i,n),UCe(Number,s,"minimumClock",o.minimumClock,r,i,n),UCe(Number,s,"maximumClock",o.maximumClock,r,i,n),UCe(Number,s,"minimumCone",o.minimumCone,r,i,n),UCe(Number,s,"maximumCone",o.maximumCone,r,i,n),UCe(Sz,s,"heightReference",o.heightReference,r,i,n),UCe(Boolean,s,"fill",o.fill,r,i,n),jCe(s,"material",o.material,r,i,n),UCe(Boolean,s,"outline",o.outline,r,i,n),UCe(xy,s,"outlineColor",o.outlineColor,r,i,n),UCe(Number,s,"outlineWidth",o.outlineWidth,r,i,n),UCe(Number,s,"stackPartitions",o.stackPartitions,r,i,n),UCe(Number,s,"slicePartitions",o.slicePartitions,r,i,n),UCe(Number,s,"subdivisions",o.subdivisions,r,i,n),UCe(rj,s,"shadows",o.shadows,r,i,n),UCe(WT,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n)}function vEe(e,t,n,i){const o=t.label;if(!C(o))return;const r=MCe(o.interval);let s=e.label;C(s)||(e.label=s=new _X),UCe(Boolean,s,"show",o.show,r,i,n),UCe(String,s,"text",o.text,r,i,n),UCe(String,s,"font",o.font,r,i,n),UCe(Ise,s,"style",o.style,r,i,n),UCe(Number,s,"scale",o.scale,r,i,n),UCe(Boolean,s,"showBackground",o.showBackground,r,i,n),UCe(xy,s,"backgroundColor",o.backgroundColor,r,i,n),UCe(ro,s,"backgroundPadding",o.backgroundPadding,r,i,n),UCe(ro,s,"pixelOffset",o.pixelOffset,r,i,n),UCe(K,s,"eyeOffset",o.eyeOffset,r,i,n),UCe(Oz,s,"horizontalOrigin",o.horizontalOrigin,r,i,n),UCe(Pz,s,"verticalOrigin",o.verticalOrigin,r,i,n),UCe(Sz,s,"heightReference",o.heightReference,r,i,n),UCe(xy,s,"fillColor",o.fillColor,r,i,n),UCe(xy,s,"outlineColor",o.outlineColor,r,i,n),UCe(Number,s,"outlineWidth",o.outlineWidth,r,i,n),UCe(LO,s,"translucencyByDistance",o.translucencyByDistance,r,i,n),UCe(LO,s,"pixelOffsetScaleByDistance",o.pixelOffsetScaleByDistance,r,i,n),UCe(LO,s,"scaleByDistance",o.scaleByDistance,r,i,n),UCe(WT,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),UCe(Number,s,"disableDepthTestDistance",o.disableDepthTestDistance,r,i,n)}function bEe(e,t,n,i){const o=t.model;if(!C(o))return;const r=MCe(o.interval);let s,a,c=e.model;C(c)||(e.model=c=new IX),UCe(Boolean,c,"show",o.show,r,i,n),UCe(cn,c,"uri",o.gltf,r,i,n),UCe(Number,c,"scale",o.scale,r,i,n),UCe(Number,c,"minimumPixelSize",o.minimumPixelSize,r,i,n),UCe(Number,c,"maximumScale",o.maximumScale,r,i,n),UCe(Boolean,c,"incrementallyLoadTextures",o.incrementallyLoadTextures,r,i,n),UCe(Boolean,c,"runAnimations",o.runAnimations,r,i,n),UCe(Boolean,c,"clampAnimations",o.clampAnimations,r,i,n),UCe(rj,c,"shadows",o.shadows,r,i,n),UCe(Sz,c,"heightReference",o.heightReference,r,i,n),UCe(xy,c,"silhouetteColor",o.silhouetteColor,r,i,n),UCe(Number,c,"silhouetteSize",o.silhouetteSize,r,i,n),UCe(xy,c,"color",o.color,r,i,n),UCe(y3,c,"colorBlendMode",o.colorBlendMode,r,i,n),UCe(Number,c,"colorBlendAmount",o.colorBlendAmount,r,i,n),UCe(WT,c,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n);const l=o.nodeTransformations;if(C(l))if(Array.isArray(l))for(s=0,a=l.length;s<a;++s)AEe(c,l[s],r,i,n);else AEe(c,l,r,i,n);const u=o.articulations;if(C(u))if(Array.isArray(u))for(s=0,a=u.length;s<a;++s)wEe(c,u[s],r,i,n);else wEe(c,u,r,i,n)}function AEe(e,t,n,i,o){let r=MCe(t.interval);C(n)&&(r=C(r)?cO.intersect(r,n,mCe):n);let s=e.nodeTransformations;const a=Object.keys(t);for(let c=0,l=a.length;c<l;++c){const n=a[c];if("interval"===n)continue;const l=t[n];if(!C(l))continue;C(s)||(e.nodeTransformations=s=new TX),s.hasProperty(n)||s.addProperty(n);let u=s[n];C(u)||(s[n]=u=new vX),UCe(K,u,"translation",l.translation,r,i,o),UCe(il,u,"rotation",l.rotation,r,i,o),UCe(K,u,"scale",l.scale,r,i,o)}}function wEe(e,t,n,i,o){let r=MCe(t.interval);C(n)&&(r=C(r)?cO.intersect(r,n,mCe):n);let s=e.articulations;const a=Object.keys(t);for(let c=0,l=a.length;c<l;++c){const n=a[c];if("interval"===n)continue;const l=t[n];C(l)&&(C(s)||(e.articulations=s=new TX),s.hasProperty(n)||s.addProperty(n),UCe(Number,s,n,l,r,i,o))}}function TEe(e,t,n,i){const o=t.path;if(!C(o))return;const r=MCe(o.interval);let s=e.path;C(s)||(e.path=s=new RX),UCe(Boolean,s,"show",o.show,r,i,n),UCe(Number,s,"leadTime",o.leadTime,r,i,n),UCe(Number,s,"trailTime",o.trailTime,r,i,n),UCe(Number,s,"width",o.width,r,i,n),UCe(Number,s,"resolution",o.resolution,r,i,n),jCe(s,"material",o.material,r,i,n),UCe(WT,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n)}function CEe(e,t,n,i){const o=t.point;if(!C(o))return;const r=MCe(o.interval);let s=e.point;C(s)||(e.point=s=new NX),UCe(Boolean,s,"show",o.show,r,i,n),UCe(Number,s,"pixelSize",o.pixelSize,r,i,n),UCe(Sz,s,"heightReference",o.heightReference,r,i,n),UCe(xy,s,"color",o.color,r,i,n),UCe(xy,s,"outlineColor",o.outlineColor,r,i,n),UCe(Number,s,"outlineWidth",o.outlineWidth,r,i,n),UCe(LO,s,"scaleByDistance",o.scaleByDistance,r,i,n),UCe(LO,s,"translucencyByDistance",o.translucencyByDistance,r,i,n),UCe(WT,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),UCe(Number,s,"disableDepthTestDistance",o.disableDepthTestDistance,r,i,n)}function EEe(e){this.polygon=e,this._definitionChanged=new $n}function xEe(e,t,n,i){const o=t.polygon;if(!C(o))return;const r=MCe(o.interval);let s=e.polygon;C(s)||(e.polygon=s=new kX),UCe(Boolean,s,"show",o.show,r,i,n),iEe(s,"_positions",o.positions,n),cEe(s,"_holes",o.holes,n),(C(s._positions)||C(s._holes))&&(s.hierarchy=new EEe(s)),UCe(Number,s,"height",o.height,r,i,n),UCe(Sz,s,"heightReference",o.heightReference,r,i,n),UCe(Number,s,"extrudedHeight",o.extrudedHeight,r,i,n),UCe(Sz,s,"extrudedHeightReference",o.extrudedHeightReference,r,i,n),UCe(ETe,s,"stRotation",o.stRotation,r,i,n),UCe(Number,s,"granularity",o.granularity,r,i,n),UCe(Boolean,s,"fill",o.fill,r,i,n),jCe(s,"material",o.material,r,i,n),UCe(Boolean,s,"outline",o.outline,r,i,n),UCe(xy,s,"outlineColor",o.outlineColor,r,i,n),UCe(Number,s,"outlineWidth",o.outlineWidth,r,i,n),UCe(Boolean,s,"perPositionHeight",o.perPositionHeight,r,i,n),UCe(Boolean,s,"closeTop",o.closeTop,r,i,n),UCe(Boolean,s,"closeBottom",o.closeBottom,r,i,n),UCe(hf,s,"arcType",o.arcType,r,i,n),UCe(rj,s,"shadows",o.shadows,r,i,n),UCe(WT,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),UCe(rq,s,"classificationType",o.classificationType,r,i,n),UCe(Number,s,"zIndex",o.zIndex,r,i,n)}function SEe(e){return e?hf.GEODESIC:hf.NONE}function IEe(e,t,n,i){const o=t.polyline;if(!C(o))return;const r=MCe(o.interval);let s=e.polyline;if(C(s)||(e.polyline=s=new VX),UCe(Boolean,s,"show",o.show,r,i,n),iEe(s,"positions",o.positions,n),UCe(Number,s,"width",o.width,r,i,n),UCe(Number,s,"granularity",o.granularity,r,i,n),jCe(s,"material",o.material,r,i,n),jCe(s,"depthFailMaterial",o.depthFailMaterial,r,i,n),UCe(hf,s,"arcType",o.arcType,r,i,n),UCe(Boolean,s,"clampToGround",o.clampToGround,r,i,n),UCe(rj,s,"shadows",o.shadows,r,i,n),UCe(WT,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),UCe(rq,s,"classificationType",o.classificationType,r,i,n),UCe(Number,s,"zIndex",o.zIndex,r,i,n),C(o.followSurface)&&!C(o.arcType)){const e={};UCe(Boolean,e,"followSurface",o.followSurface,r,i,n),s.arcType=hCe(e.followSurface,SEe)}}function OEe(e,t,n,i){const o=t.polylineVolume;if(!C(o))return;const r=MCe(o.interval);let s=e.polylineVolume;C(s)||(e.polylineVolume=s=new GX),iEe(s,"positions",o.positions,n),lEe(s,"shape",o.shape,n),UCe(Boolean,s,"show",o.show,r,i,n),UCe(Hb,s,"cornerType",o.cornerType,r,i,n),UCe(Boolean,s,"fill",o.fill,r,i,n),jCe(s,"material",o.material,r,i,n),UCe(Boolean,s,"outline",o.outline,r,i,n),UCe(xy,s,"outlineColor",o.outlineColor,r,i,n),UCe(Number,s,"outlineWidth",o.outlineWidth,r,i,n),UCe(Number,s,"granularity",o.granularity,r,i,n),UCe(rj,s,"shadows",o.shadows,r,i,n),UCe(WT,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n)}function DEe(e,t,n,i){const o=t.rectangle;if(!C(o))return;const r=MCe(o.interval);let s=e.rectangle;C(s)||(e.rectangle=s=new qX),UCe(Boolean,s,"show",o.show,r,i,n),UCe(_t,s,"coordinates",o.coordinates,r,i,n),UCe(Number,s,"height",o.height,r,i,n),UCe(Sz,s,"heightReference",o.heightReference,r,i,n),UCe(Number,s,"extrudedHeight",o.extrudedHeight,r,i,n),UCe(Sz,s,"extrudedHeightReference",o.extrudedHeightReference,r,i,n),UCe(ETe,s,"rotation",o.rotation,r,i,n),UCe(ETe,s,"stRotation",o.stRotation,r,i,n),UCe(Number,s,"granularity",o.granularity,r,i,n),UCe(Boolean,s,"fill",o.fill,r,i,n),jCe(s,"material",o.material,r,i,n),UCe(Boolean,s,"outline",o.outline,r,i,n),UCe(xy,s,"outlineColor",o.outlineColor,r,i,n),UCe(Number,s,"outlineWidth",o.outlineWidth,r,i,n),UCe(rj,s,"shadows",o.shadows,r,i,n),UCe(WT,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n),UCe(rq,s,"classificationType",o.classificationType,r,i,n),UCe(Number,s,"zIndex",o.zIndex,r,i,n)}function PEe(e,t,n,i){const o=t.tileset;if(!C(o))return;const r=MCe(o.interval);let s=e.tileset;C(s)||(e.tileset=s=new DX),UCe(Boolean,s,"show",o.show,r,i,n),UCe(cn,s,"uri",o.uri,r,i,n),UCe(Number,s,"maximumScreenSpaceError",o.maximumScreenSpaceError,r,i,n)}function REe(e,t,n,i){const o=t.wall;if(!C(o))return;const r=MCe(o.interval);let s=e.wall;C(s)||(e.wall=s=new YX),UCe(Boolean,s,"show",o.show,r,i,n),iEe(s,"positions",o.positions,n),tEe(s,"minimumHeights",o.minimumHeights,n),tEe(s,"maximumHeights",o.maximumHeights,n),UCe(Number,s,"granularity",o.granularity,r,i,n),UCe(Boolean,s,"fill",o.fill,r,i,n),jCe(s,"material",o.material,r,i,n),UCe(Boolean,s,"outline",o.outline,r,i,n),UCe(xy,s,"outlineColor",o.outlineColor,r,i,n),UCe(Number,s,"outlineWidth",o.outlineWidth,r,i,n),UCe(rj,s,"shadows",o.shadows,r,i,n),UCe(WT,s,"distanceDisplayCondition",o.distanceDisplayCondition,r,i,n)}function LEe(e,t,n,i,o){let r=e.id;if(C(r)||(r=wk()),cCe=r,!C(o._version)&&"document"!==r)throw new Je("The first CZML packet is required to be the document object.");if(!0===e["delete"])t.removeById(r);else if("document"===r)_Ee(e,o);else{const o=t.getOrCreateEntity(r),s=e.parent;C(s)&&(o.parent=t.getOrCreateEntity(s));for(let r=n.length-1;r>-1;r--)n[r](o,e,t,i)}cCe=void 0}function MEe(e){let t;const n=e._documentPacket.clock;if(!C(n)){if(!C(e._clock)){const n=e._entityCollection.computeAvailability();if(!n.start.equals(fO.MINIMUM_VALUE)){const i=n.start,o=n.stop,r=Ea.secondsDifference(o,i),s=Math.round(r/120);return t=new qwe,t.startTime=Ea.clone(i),t.stopTime=Ea.clone(o),t.clockRange=uy.LOOP_STOP,t.multiplier=s,t.currentTime=Ea.clone(i),t.clockStep=dy.SYSTEM_CLOCK_MULTIPLIER,e._clock=t,!0}}return!1}C(e._clock)?t=e._clock.clone():(t=new qwe,t.startTime=fO.MINIMUM_VALUE.clone(),t.stopTime=fO.MAXIMUM_VALUE.clone(),t.currentTime=fO.MINIMUM_VALUE.clone(),t.clockRange=uy.LOOP_STOP,t.clockStep=dy.SYSTEM_CLOCK_MULTIPLIER,t.multiplier=1);const i=MCe(n.interval);return C(i)&&(t.startTime=i.start,t.stopTime=i.stop),C(n.currentTime)&&(t.currentTime=Ea.fromIso8601(n.currentTime)),C(n.range)&&(t.clockRange=R(uy[n.range],uy.LOOP_STOP)),C(n.step)&&(t.clockStep=R(dy[n.step],dy.SYSTEM_CLOCK_MULTIPLIER)),C(n.multiplier)&&(t.multiplier=n.multiplier),!t.equals(e._clock)&&(e._clock=t.clone(e._clock),!0)}function BEe(e,t,n,i){if(!C(t))throw new x("czml is required.");n=R(n,R.EMPTY_OBJECT);let o=t,r=n.sourceUri,s=n.credit;if("string"===typeof s&&(s=new Tr(s)),e._credit=s,"string"===typeof t||t instanceof Vi){t=Vi.createIfNeeded(t),o=t.fetchJson(),r=R(r,t.clone());const n=e._resourceCredits,i=t.credits;if(C(i)){const e=i.length;for(let t=0;t<e;t++)n.push(i[t])}}return r=Vi.createIfNeeded(r),hAe.setLoading(e,!0),Promise.resolve(o).then((function(t){return NEe(e,t,r,i)})).catch((function(t){return hAe.setLoading(e,!1),e._error.raiseEvent(e,t),console.log(t),Promise.reject(t)}))}function NEe(e,t,n,i){hAe.setLoading(e,!0);const o=e._entityCollection;i&&(e._version=void 0,e._documentPacket=new FEe,o.removeAll()),zEe._processCzml(t,o,n,void 0,e);let r=MEe(e);const s=e._documentPacket;return C(s.name)&&e._name!==s.name?(e._name=s.name,r=!0):!C(e._name)&&C(n)&&(e._name=HF(n.getUrlComponent()),r=!0),hAe.setLoading(e,!1),r&&e._changed.raiseEvent(e),e}function FEe(){this.name=void 0,this.clock=void 0}function zEe(e){this._name=e,this._changed=new $n,this._error=new $n,this._isLoading=!1,this._loading=new $n,this._clock=void 0,this._documentPacket=new FEe,this._version=void 0,this._entityCollection=new Nbe(this),this._entityCluster=new Lwe,this._credit=void 0,this._resourceCredits=[]}Object.defineProperties(EEe.prototype,{isConstant:{get:function(){const e=this.polygon._positions,t=this.polygon._holes;return(!C(e)||e.isConstant)&&(!C(t)||t.isConstant)}},definitionChanged:{get:function(){return this._definitionChanged}}}),EEe.prototype.getValue=function(e,t){let n,i;return C(this.polygon._positions)&&(n=this.polygon._positions.getValue(e)),C(this.polygon._holes)&&(i=this.polygon._holes.getValue(e),C(i)&&(i=i.map((function(e){return new sP(e)})))),C(t)?(t.positions=n,t.holes=i,t):new sP(n,i)},EEe.prototype.equals=function(e){return this===e||e instanceof EEe&&Bz.equals(this.polygon._positions,e.polygon._positions)&&Bz.equals(this.polygon._holes,e.polygon._holes)},zEe.load=function(e,t){return(new zEe).load(e,t)},Object.defineProperties(zEe.prototype,{name:{get:function(){return this._name}},clock:{get:function(){return this._clock}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(e){this._entityCollection.show=e}},clustering:{get:function(){return this._entityCluster},set:function(e){if(!C(e))throw new x("value must be defined.");this._entityCluster=e}},credit:{get:function(){return this._credit}}}),zEe.updaters=[dEe,fEe,pEe,mEe,gEe,yEe,vEe,bEe,YCe,KCe,TEe,CEe,xEe,IEe,OEe,ZCe,DEe,XCe,PEe,QCe,REe,JCe,uEe],zEe.prototype.process=function(e,t){return BEe(this,e,t,!1)},zEe.prototype.load=function(e,t){return BEe(this,e,t,!0)},zEe.prototype.update=function(e){return!0},zEe.processPacketData=UCe,zEe.processPositionPacketData=GCe,zEe.processMaterialPacketData=jCe,zEe._processCzml=function(e,t,n,i,o){if(i=R(i,zEe.updaters),Array.isArray(e))for(let r=0,s=e.length;r<s;++r)LEe(e[r],t,i,n,o);else LEe(e,t,i,n,o)};function kEe(){this._dataSources=[],this._dataSourceAdded=new $n,this._dataSourceRemoved=new $n,this._dataSourceMoved=new $n}function UEe(e,t){if(!C(t))throw new x("dataSource is required.");const n=e.indexOf(t);if(-1===n)throw new x("dataSource is not in this collection.");return n}function VEe(e,t,n){const i=e._dataSources,o=i.length-1;if(t=z.clamp(t,0,o),n=z.clamp(n,0,o),t===n)return;const r=i[t];i[t]=i[n],i[n]=r,e.dataSourceMoved.raiseEvent(r,n,t)}Object.defineProperties(kEe.prototype,{length:{get:function(){return this._dataSources.length}},dataSourceAdded:{get:function(){return this._dataSourceAdded}},dataSourceRemoved:{get:function(){return this._dataSourceRemoved}},dataSourceMoved:{get:function(){return this._dataSourceMoved}}}),kEe.prototype.add=function(e){if(!C(e))throw new x("dataSource is required.");const t=this,n=this._dataSources;return Promise.resolve(e).then((function(e){return n===t._dataSources&&(t._dataSources.push(e),t._dataSourceAdded.raiseEvent(t,e)),e}))},kEe.prototype.remove=function(e,t){t=R(t,!1);const n=this._dataSources.indexOf(e);return-1!==n&&(this._dataSources.splice(n,1),this._dataSourceRemoved.raiseEvent(this,e),t&&"function"===typeof e.destroy&&e.destroy(),!0)},kEe.prototype.removeAll=function(e){e=R(e,!1);const t=this._dataSources;for(let n=0,i=t.length;n<i;++n){const i=t[n];this._dataSourceRemoved.raiseEvent(this,i),e&&"function"===typeof i.destroy&&i.destroy()}this._dataSources=[]},kEe.prototype.contains=function(e){return-1!==this.indexOf(e)},kEe.prototype.indexOf=function(e){return this._dataSources.indexOf(e)},kEe.prototype.get=function(e){if(!C(e))throw new x("index is required.");return this._dataSources[e]},kEe.prototype.getByName=function(e){if(!C(e))throw new x("name is required.");return this._dataSources.filter((function(t){return t.name===e}))},kEe.prototype.raise=function(e){const t=UEe(this._dataSources,e);VEe(this,t,t+1)},kEe.prototype.lower=function(e){const t=UEe(this._dataSources,e);VEe(this,t,t-1)},kEe.prototype.raiseToTop=function(e){const t=UEe(this._dataSources,e);t!==this._dataSources.length-1&&(this._dataSources.splice(t,1),this._dataSources.push(e),this.dataSourceMoved.raiseEvent(e,this._dataSources.length-1,t))},kEe.prototype.lowerToBottom=function(e){const t=UEe(this._dataSources,e);0!==t&&(this._dataSources.splice(t,1),this._dataSources.splice(0,0,e),this.dataSourceMoved.raiseEvent(e,0,t))},kEe.prototype.isDestroyed=function(){return!1},kEe.prototype.destroy=function(){return this.removeAll(!0),Qh(this)};var HEe=kEe;function GEe(e){e=R(e,R.EMPTY_OBJECT),this._primitives=[],this._guid=wk(),this._zIndex=void 0,this.show=R(e.show,!0),this.destroyPrimitives=R(e.destroyPrimitives,!0)}function WEe(e,t){if(!e.contains(t))throw new x("primitive is not in this collection.");return e._primitives.indexOf(t)}Object.defineProperties(GEe.prototype,{length:{get:function(){return this._primitives.length}}}),GEe.prototype.add=function(e,t){const n=C(t);if(!C(e))throw new x("primitive is required.");if(n){if(t<0)throw new x("index must be greater than or equal to zero.");if(t>this._primitives.length)throw new x("index must be less than or equal to the number of primitives.")}const i=e._external=e._external||{},o=i._composites=i._composites||{};return o[this._guid]={collection:this},n?this._primitives.splice(t,0,e):this._primitives.push(e),e},GEe.prototype.remove=function(e){if(this.contains(e)){const t=this._primitives.indexOf(e);if(-1!==t)return this._primitives.splice(t,1),delete e._external._composites[this._guid],this.destroyPrimitives&&e.destroy(),!0}return!1},GEe.prototype.removeAndDestroy=function(e){const t=this.remove(e);return t&&!this.destroyPrimitives&&e.destroy(),t},GEe.prototype.removeAll=function(){const e=this._primitives,t=e.length;for(let n=0;n<t;++n)delete e[n]._external._composites[this._guid],this.destroyPrimitives&&e[n].destroy();this._primitives=[]},GEe.prototype.contains=function(e){return!!(C(e)&&e._external&&e._external._composites&&e._external._composites[this._guid])},GEe.prototype.raise=function(e){if(C(e)){const t=WEe(this,e),n=this._primitives;if(t!==n.length-1){const e=n[t];n[t]=n[t+1],n[t+1]=e}}},GEe.prototype.raiseToTop=function(e){if(C(e)){const t=WEe(this,e),n=this._primitives;t!==n.length-1&&(n.splice(t,1),n.push(e))}},GEe.prototype.lower=function(e){if(C(e)){const t=WEe(this,e),n=this._primitives;if(0!==t){const e=n[t];n[t]=n[t-1],n[t-1]=e}}},GEe.prototype.lowerToBottom=function(e){if(C(e)){const t=WEe(this,e),n=this._primitives;0!==t&&(n.splice(t,1),n.unshift(e))}},GEe.prototype.get=function(e){if(!C(e))throw new x("index is required.");return this._primitives[e]},GEe.prototype.update=function(e){if(!this.show)return;const t=this._primitives;for(let n=0;n<t.length;++n)t[n].update(e)},GEe.prototype.prePassesUpdate=function(e){const t=this._primitives;for(let n=0;n<t.length;++n){const i=t[n];C(i.prePassesUpdate)&&i.prePassesUpdate(e)}},GEe.prototype.updateForPass=function(e,t){const n=this._primitives;for(let i=0;i<n.length;++i){const o=n[i];C(o.updateForPass)&&o.updateForPass(e,t)}},GEe.prototype.postPassesUpdate=function(e){const t=this._primitives;for(let n=0;n<t.length;++n){const i=t[n];C(i.postPassesUpdate)&&i.postPassesUpdate(e)}},GEe.prototype.isDestroyed=function(){return!1},GEe.prototype.destroy=function(){return this.removeAll(),Qh(this)};var qEe=GEe;function jEe(){this._length=0,this._collections={},this._collectionsArray=[],this.show=!0}Object.defineProperties(jEe.prototype,{length:{get:function(){return this._length}}}),jEe.prototype.add=function(e,t){D.defined("primitive",e),C(t)&&D.typeOf.number("zIndex",t),t=R(t,0);let n=this._collections[t];if(!C(n)){n=new qEe({destroyPrimitives:!1}),n._zIndex=t,this._collections[t]=n;const e=this._collectionsArray;let i=0;while(i<e.length&&e[i]._zIndex<t)i++;e.splice(i,0,n)}return n.add(e),this._length++,e._zIndex=t,e},jEe.prototype.set=function(e,t){return D.defined("primitive",e),D.typeOf.number("zIndex",t),t===e._zIndex||(this.remove(e,!0),this.add(e,t)),e},jEe.prototype.remove=function(e,t){if(this.contains(e)){const n=e._zIndex,i=this._collections[n];let o;return o=t?i.remove(e):i.removeAndDestroy(e),o&&this._length--,0===i.length&&(this._collectionsArray.splice(this._collectionsArray.indexOf(i),1),this._collections[n]=void 0,i.destroy()),o}return!1},jEe.prototype.removeAll=function(){const e=this._collectionsArray;for(let t=0;t<e.length;t++){const n=e[t];n.destroyPrimitives=!0,n.destroy()}this._collections={},this._collectionsArray=[],this._length=0},jEe.prototype.contains=function(e){if(!C(e))return!1;const t=this._collections[e._zIndex];return C(t)&&t.contains(e)},jEe.prototype.update=function(e){if(!this.show)return;const t=this._collectionsArray;for(let n=0;n<t.length;n++)t[n].update(e)},jEe.prototype.isDestroyed=function(){return!1},jEe.prototype.destroy=function(){return this.removeAll(),Qh(this)};var YEe=jEe;function KEe(e,t){this._primitives=e,this._orderedGroundPrimitives=t,this._dynamicUpdaters=new ff}KEe.prototype.add=function(e,t){this._dynamicUpdaters.set(t.id,t.createDynamicUpdater(this._primitives,this._orderedGroundPrimitives))},KEe.prototype.remove=function(e){const t=e.id,n=this._dynamicUpdaters.get(t);C(n)&&(this._dynamicUpdaters.remove(t),n.destroy())},KEe.prototype.update=function(e){const t=this._dynamicUpdaters.values;for(let n=0,i=t.length;n<i;n++)t[n].update(e);return!0},KEe.prototype.removeAllPrimitives=function(){const e=this._dynamicUpdaters.values;for(let t=0,n=e.length;t<n;t++)e[t].destroy();this._dynamicUpdaters.removeAll()},KEe.prototype.getBoundingSphere=function(e,t){return e=this._dynamicUpdaters.get(e.id),C(e)&&C(e.getBoundingSphere)?e.getBoundingSphere(t):Lz.FAILED};var XEe=KEe;const QEe=new xy,JEe=K.ZERO,ZEe=new K,$Ee=new _t;function exe(e){this.id=e,this.vertexFormat=void 0,this.center=void 0,this.semiMajorAxis=void 0,this.semiMinorAxis=void 0,this.rotation=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function txe(e,t){tAe.call(this,{entity:e,scene:t,geometryOptions:new exe(e),geometryPropertyName:"ellipse",observedPropertyNames:["availability","position","ellipse"]}),this._onEntityPropertyChanged(e,"ellipse",e.ellipse,void 0)}function nxe(e,t,n){vK.call(this,e,t,n)}C(Object.create)&&(txe.prototype=Object.create(tAe.prototype),txe.prototype.constructor=txe),txe.prototype.createFillGeometryInstance=function(e){if(D.defined("time",e),!this._fillEnabled)throw new x("This instance does not represent a filled geometry.");const t=this._entity,n=t.isAvailable(e),i={show:new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:jT.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};if(this._materialProperty instanceof BU){let t;C(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(t=this._materialProperty.color.getValue(e,QEe)),C(t)||(t=xy.WHITE),i.color=Iy.fromColor(t)}return C(this._options.offsetAttribute)&&(i.offset=JO.fromCartesian3(Bz.getValueOrDefault(this._terrainOffsetProperty,e,JEe,ZEe))),new Sm({id:t,geometry:new qg(this._options),attributes:i})},txe.prototype.createOutlineGeometryInstance=function(e){if(D.defined("time",e),!this._outlineEnabled)throw new x("This instance does not represent an outlined geometry.");const t=this._entity,n=t.isAvailable(e),i=Bz.getValueOrDefault(this._outlineColorProperty,e,xy.BLACK,QEe),o=this._distanceDisplayConditionProperty.getValue(e),r={show:new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Iy.fromColor(i),distanceDisplayCondition:jT.fromDistanceDisplayCondition(o),offset:void 0};return C(this._options.offsetAttribute)&&(r.offset=JO.fromCartesian3(Bz.getValueOrDefault(this._terrainOffsetProperty,e,JEe,ZEe))),new Sm({id:t,geometry:new ry(this._options),attributes:r})},txe.prototype._computeCenter=function(e,t){return Bz.getValueOrUndefined(this._entity.position,e,t)},txe.prototype._isHidden=function(e,t){const n=e.position;return!C(n)||!C(t.semiMajorAxis)||!C(t.semiMinorAxis)||fQ.prototype._isHidden.call(this,e,t)},txe.prototype._isDynamic=function(e,t){return!e.position.isConstant||!t.semiMajorAxis.isConstant||!t.semiMinorAxis.isConstant||!Bz.isConstant(t.rotation)||!Bz.isConstant(t.height)||!Bz.isConstant(t.extrudedHeight)||!Bz.isConstant(t.granularity)||!Bz.isConstant(t.stRotation)||!Bz.isConstant(t.outlineWidth)||!Bz.isConstant(t.numberOfVerticalLines)||!Bz.isConstant(t.zIndex)||this._onTerrain&&!Bz.isConstant(this._materialProperty)&&!(this._materialProperty instanceof BU)},txe.prototype._setStaticOptions=function(e,t){let n=Bz.getValueOrUndefined(t.height,fO.MINIMUM_VALUE);const i=Bz.getValueOrDefault(t.heightReference,fO.MINIMUM_VALUE,Sz.NONE);let o=Bz.getValueOrUndefined(t.extrudedHeight,fO.MINIMUM_VALUE);const r=Bz.getValueOrDefault(t.extrudedHeightReference,fO.MINIMUM_VALUE,Sz.NONE);C(o)&&!C(n)&&(n=0);const s=this._options;s.vertexFormat=this._materialProperty instanceof BU?LU.VERTEX_FORMAT:SU.MaterialSupport.TEXTURED.vertexFormat,s.center=e.position.getValue(fO.MINIMUM_VALUE,s.center),s.semiMajorAxis=t.semiMajorAxis.getValue(fO.MINIMUM_VALUE,s.semiMajorAxis),s.semiMinorAxis=t.semiMinorAxis.getValue(fO.MINIMUM_VALUE,s.semiMinorAxis),s.rotation=Bz.getValueOrUndefined(t.rotation,fO.MINIMUM_VALUE),s.granularity=Bz.getValueOrUndefined(t.granularity,fO.MINIMUM_VALUE),s.stRotation=Bz.getValueOrUndefined(t.stRotation,fO.MINIMUM_VALUE),s.numberOfVerticalLines=Bz.getValueOrUndefined(t.numberOfVerticalLines,fO.MINIMUM_VALUE),s.offsetAttribute=tAe.computeGeometryOffsetAttribute(n,i,o,r),s.height=tAe.getGeometryHeight(n,i),o=tAe.getGeometryExtrudedHeight(o,r),o===tAe.CLAMP_TO_GROUND&&(o=bo.getMinimumMaximumHeights(qg.computeRectangle(s,$Ee)).minimumTerrainHeight),s.extrudedHeight=o},txe.DynamicGeometryUpdater=nxe,C(Object.create)&&(nxe.prototype=Object.create(vK.prototype),nxe.prototype.constructor=nxe),nxe.prototype._isHidden=function(e,t,n){const i=this._options;return!C(i.center)||!C(i.semiMajorAxis)||!C(i.semiMinorAxis)||vK.prototype._isHidden.call(this,e,t,n)},nxe.prototype._setOptions=function(e,t,n){const i=this._options;let o=Bz.getValueOrUndefined(t.height,n);const r=Bz.getValueOrDefault(t.heightReference,n,Sz.NONE);let s=Bz.getValueOrUndefined(t.extrudedHeight,n);const a=Bz.getValueOrDefault(t.extrudedHeightReference,n,Sz.NONE);C(s)&&!C(o)&&(o=0),i.center=Bz.getValueOrUndefined(e.position,n,i.center),i.semiMajorAxis=Bz.getValueOrUndefined(t.semiMajorAxis,n),i.semiMinorAxis=Bz.getValueOrUndefined(t.semiMinorAxis,n),i.rotation=Bz.getValueOrUndefined(t.rotation,n),i.granularity=Bz.getValueOrUndefined(t.granularity,n),i.stRotation=Bz.getValueOrUndefined(t.stRotation,n),i.numberOfVerticalLines=Bz.getValueOrUndefined(t.numberOfVerticalLines,n),i.offsetAttribute=tAe.computeGeometryOffsetAttribute(o,r,s,a),i.height=tAe.getGeometryHeight(o,r),s=tAe.getGeometryExtrudedHeight(s,a),s===tAe.CLAMP_TO_GROUND&&(s=bo.getMinimumMaximumHeights(qg.computeRectangle(i,$Ee)).minimumTerrainHeight),i.extrudedHeight=s};var ixe=txe;const oxe=new BU(xy.WHITE),rxe=K.ZERO,sxe=new K,axe=new K,cxe=new K,lxe=new xy,uxe=new K(1,1,1);function hxe(e){this.id=e,this.vertexFormat=void 0,this.radii=void 0,this.innerRadii=void 0,this.minimumClock=void 0,this.maximumClock=void 0,this.minimumCone=void 0,this.maximumCone=void 0,this.stackPartitions=void 0,this.slicePartitions=void 0,this.subdivisions=void 0,this.offsetAttribute=void 0}function dxe(e,t){fQ.call(this,{entity:e,scene:t,geometryOptions:new hxe(e),geometryPropertyName:"ellipsoid",observedPropertyNames:["availability","position","orientation","ellipsoid"]}),this._onEntityPropertyChanged(e,"ellipsoid",e.ellipsoid,void 0)}function fxe(e,t,n){vK.call(this,e,t,n),this._scene=e._scene,this._modelMatrix=new ft,this._attributes=void 0,this._outlineAttributes=void 0,this._lastSceneMode=void 0,this._lastShow=void 0,this._lastOutlineShow=void 0,this._lastOutlineWidth=void 0,this._lastOutlineColor=void 0,this._lastOffset=new K,this._material={}}C(Object.create)&&(dxe.prototype=Object.create(fQ.prototype),dxe.prototype.constructor=dxe),Object.defineProperties(dxe.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),dxe.prototype.createFillGeometryInstance=function(e,t,n){D.defined("time",e);const i=this._entity,o=i.isAvailable(e);let r;const s=new FM(o&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),a=this._distanceDisplayConditionProperty.getValue(e),c=jT.fromDistanceDisplayCondition(a),l={show:s,distanceDisplayCondition:c,color:void 0,offset:void 0};if(this._materialProperty instanceof BU){let t;C(this._materialProperty.color)&&(this._materialProperty.color.isConstant||o)&&(t=this._materialProperty.color.getValue(e,lxe)),C(t)||(t=xy.WHITE),r=Iy.fromColor(t),l.color=r}return C(this._options.offsetAttribute)&&(l.offset=JO.fromCartesian3(Bz.getValueOrDefault(this._terrainOffsetProperty,e,rxe,sxe))),new Sm({id:i,geometry:new bC(this._options),modelMatrix:t?void 0:i.computeModelMatrixForHeightReference(e,i.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,n),attributes:l})},dxe.prototype.createOutlineGeometryInstance=function(e,t,n){D.defined("time",e);const i=this._entity,o=i.isAvailable(e),r=Bz.getValueOrDefault(this._outlineColorProperty,e,xy.BLACK,lxe),s=this._distanceDisplayConditionProperty.getValue(e),a={show:new FM(o&&i.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Iy.fromColor(r),distanceDisplayCondition:jT.fromDistanceDisplayCondition(s),offset:void 0};return C(this._options.offsetAttribute)&&(a.offset=JO.fromCartesian3(Bz.getValueOrDefault(this._terrainOffsetProperty,e,rxe,sxe))),new Sm({id:i,geometry:new IC(this._options),modelMatrix:t?void 0:i.computeModelMatrixForHeightReference(e,i.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,n),attributes:a})},dxe.prototype._computeCenter=function(e,t){return Bz.getValueOrUndefined(this._entity.position,e,t)},dxe.prototype._isHidden=function(e,t){return!C(e.position)||!C(t.radii)||fQ.prototype._isHidden.call(this,e,t)},dxe.prototype._isDynamic=function(e,t){return!e.position.isConstant||!Bz.isConstant(e.orientation)||!t.radii.isConstant||!Bz.isConstant(t.innerRadii)||!Bz.isConstant(t.stackPartitions)||!Bz.isConstant(t.slicePartitions)||!Bz.isConstant(t.outlineWidth)||!Bz.isConstant(t.minimumClock)||!Bz.isConstant(t.maximumClock)||!Bz.isConstant(t.minimumCone)||!Bz.isConstant(t.maximumCone)||!Bz.isConstant(t.subdivisions)},dxe.prototype._setStaticOptions=function(e,t){const n=Bz.getValueOrDefault(t.heightReference,fO.MINIMUM_VALUE,Sz.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof BU?LU.VERTEX_FORMAT:SU.MaterialSupport.TEXTURED.vertexFormat,i.radii=t.radii.getValue(fO.MINIMUM_VALUE,i.radii),i.innerRadii=Bz.getValueOrUndefined(t.innerRadii,i.radii),i.minimumClock=Bz.getValueOrUndefined(t.minimumClock,fO.MINIMUM_VALUE),i.maximumClock=Bz.getValueOrUndefined(t.maximumClock,fO.MINIMUM_VALUE),i.minimumCone=Bz.getValueOrUndefined(t.minimumCone,fO.MINIMUM_VALUE),i.maximumCone=Bz.getValueOrUndefined(t.maximumCone,fO.MINIMUM_VALUE),i.stackPartitions=Bz.getValueOrUndefined(t.stackPartitions,fO.MINIMUM_VALUE),i.slicePartitions=Bz.getValueOrUndefined(t.slicePartitions,fO.MINIMUM_VALUE),i.subdivisions=Bz.getValueOrUndefined(t.subdivisions,fO.MINIMUM_VALUE),i.offsetAttribute=n!==Sz.NONE?Wf.ALL:void 0},dxe.prototype._onEntityPropertyChanged=AQ,dxe.DynamicGeometryUpdater=fxe,C(Object.create)&&(fxe.prototype=Object.create(vK.prototype),fxe.prototype.constructor=fxe),fxe.prototype.update=function(e){D.defined("time",e);const t=this._entity,n=t.ellipsoid;if(!t.isShowing||!t.isAvailable(e)||!Bz.getValueOrDefault(n.show,e,!0))return C(this._primitive)&&(this._primitive.show=!1),void(C(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1));const i=Bz.getValueOrUndefined(n.radii,e,axe);let o=C(i)?t.computeModelMatrixForHeightReference(e,n.heightReference,.5*i.z,this._scene.mapProjection.ellipsoid,this._modelMatrix):void 0;if(!C(o)||!C(i))return C(this._primitive)&&(this._primitive.show=!1),void(C(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1));const r=Bz.getValueOrDefault(n.fill,e,!0),s=Bz.getValueOrDefault(n.outline,e,!1),a=Bz.getValueOrClonedDefault(n.outlineColor,e,xy.BLACK,lxe),c=gK.getValue(e,R(n.material,oxe),this._material),l=Bz.getValueOrUndefined(n.innerRadii,e,cxe),u=Bz.getValueOrUndefined(n.minimumClock,e),h=Bz.getValueOrUndefined(n.maximumClock,e),d=Bz.getValueOrUndefined(n.minimumCone,e),f=Bz.getValueOrUndefined(n.maximumCone,e),p=Bz.getValueOrUndefined(n.stackPartitions,e),m=Bz.getValueOrUndefined(n.slicePartitions,e),_=Bz.getValueOrUndefined(n.subdivisions,e),g=Bz.getValueOrDefault(n.outlineWidth,e,1),y=Bz.getValueOrDefault(n.heightReference,e,Sz.NONE),v=y!==Sz.NONE?Wf.ALL:void 0,b=this._scene.mode,A=b===ij.SCENE3D&&y===Sz.NONE,w=this._options,T=this._geometryUpdater.shadowsProperty.getValue(e),E=this._geometryUpdater.distanceDisplayConditionProperty,x=E.getValue(e),S=Bz.getValueOrDefault(this._geometryUpdater.terrainOffsetProperty,e,rxe,sxe),I=!A||this._lastSceneMode!==b||!C(this._primitive)||w.stackPartitions!==p||w.slicePartitions!==m||C(l)&&!K.equals(w.innerRadii!==l)||w.minimumClock!==u||w.maximumClock!==h||w.minimumCone!==d||w.maximumCone!==f||w.subdivisions!==_||this._lastOutlineWidth!==g||w.offsetAttribute!==v;if(I){const t=this._primitives;if(t.removeAndDestroy(this._primitive),t.removeAndDestroy(this._outlinePrimitive),this._primitive=void 0,this._outlinePrimitive=void 0,this._lastSceneMode=b,this._lastOutlineWidth=g,w.stackPartitions=p,w.slicePartitions=m,w.subdivisions=_,w.offsetAttribute=v,w.radii=K.clone(A?uxe:i,w.radii),C(l))if(A){const e=K.magnitude(i);w.innerRadii=K.fromElements(l.x/e,l.y/e,l.z/e,w.innerRadii)}else w.innerRadii=K.clone(l,w.innerRadii);else w.innerRadii=void 0;w.minimumClock=u,w.maximumClock=h,w.minimumCone=d,w.maximumCone=f;const n=new SU({material:c,translucent:c.isTranslucent(),closed:!0});w.vertexFormat=n.vertexFormat;const o=this._geometryUpdater.createFillGeometryInstance(e,A,this._modelMatrix);this._primitive=t.add(new tY({geometryInstances:o,appearance:n,asynchronous:!1,shadows:T}));const y=this._geometryUpdater.createOutlineGeometryInstance(e,A,this._modelMatrix);this._outlinePrimitive=t.add(new tY({geometryInstances:y,appearance:new LU({flat:!0,translucent:255!==y.attributes.color.value[3],renderState:{lineWidth:this._geometryUpdater._scene.clampLineWidth(g)}}),asynchronous:!1,shadows:T})),this._lastShow=r,this._lastOutlineShow=s,this._lastOutlineColor=xy.clone(a,this._lastOutlineColor),this._lastDistanceDisplayCondition=x,this._lastOffset=K.clone(S,this._lastOffset)}else if(this._primitive.ready){const e=this._primitive,n=this._outlinePrimitive;e.show=!0,n.show=!0,e.appearance.material=c;let i=this._attributes;C(i)||(i=e.getGeometryInstanceAttributes(t),this._attributes=i),r!==this._lastShow&&(i.show=FM.toValue(r,i.show),this._lastShow=r);let o=this._outlineAttributes;C(o)||(o=n.getGeometryInstanceAttributes(t),this._outlineAttributes=o),s!==this._lastOutlineShow&&(o.show=FM.toValue(s,o.show),this._lastOutlineShow=s),xy.equals(a,this._lastOutlineColor)||(o.color=Iy.toValue(a,o.color),xy.clone(a,this._lastOutlineColor)),WT.equals(x,this._lastDistanceDisplayCondition)||(i.distanceDisplayCondition=jT.toValue(x,i.distanceDisplayCondition),o.distanceDisplayCondition=jT.toValue(x,o.distanceDisplayCondition),WT.clone(x,this._lastDistanceDisplayCondition)),K.equals(S,this._lastOffset)||(i.offset=JO.toValue(S,i.offset),o.offset=JO.toValue(S,i.offset),K.clone(S,this._lastOffset))}A&&(i.x=Math.max(i.x,.001),i.y=Math.max(i.y,.001),i.z=Math.max(i.z,.001),o=ft.multiplyByScale(o,i,o),this._primitive.modelMatrix=o,this._outlinePrimitive.modelMatrix=o)};var pxe=dxe;const mxe=new K,_xe=new xy;function gxe(e){this.id=e,this.vertexFormat=void 0,this.plane=void 0,this.dimensions=void 0}function yxe(e,t){fQ.call(this,{entity:e,scene:t,geometryOptions:new gxe(e),geometryPropertyName:"plane",observedPropertyNames:["availability","position","orientation","plane"]}),this._onEntityPropertyChanged(e,"plane",e.plane,void 0)}function vxe(e,t,n){vK.call(this,e,t,n)}C(Object.create)&&(yxe.prototype=Object.create(fQ.prototype),yxe.prototype.constructor=yxe),yxe.prototype.createFillGeometryInstance=function(e){if(D.defined("time",e),!this._fillEnabled)throw new x("This instance does not represent a filled geometry.");const t=this._entity,n=t.isAvailable(e);let i,o;const r=new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),s=this._distanceDisplayConditionProperty.getValue(e),a=jT.fromDistanceDisplayCondition(s);if(this._materialProperty instanceof BU){let t;C(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(t=this._materialProperty.color.getValue(e,_xe)),C(t)||(t=xy.WHITE),o=Iy.fromColor(t),i={show:r,distanceDisplayCondition:a,color:o}}else i={show:r,distanceDisplayCondition:a};const c=t.plane,l=this._options;let u=t.computeModelMatrix(e);const h=Bz.getValueOrDefault(c.plane,e,l.plane),d=Bz.getValueOrUndefined(c.dimensions,e,l.dimensions);return l.plane=h,l.dimensions=d,u=Sxe(h,d,u,u),new Sm({id:t,geometry:new vD(this._options),modelMatrix:u,attributes:i})},yxe.prototype.createOutlineGeometryInstance=function(e){if(D.defined("time",e),!this._outlineEnabled)throw new x("This instance does not represent an outlined geometry.");const t=this._entity,n=t.isAvailable(e),i=Bz.getValueOrDefault(this._outlineColorProperty,e,xy.BLACK,_xe),o=this._distanceDisplayConditionProperty.getValue(e),r=t.plane,s=this._options;let a=t.computeModelMatrix(e);const c=Bz.getValueOrDefault(r.plane,e,s.plane),l=Bz.getValueOrUndefined(r.dimensions,e,s.dimensions);return s.plane=c,s.dimensions=l,a=Sxe(c,l,a,a),new Sm({id:t,geometry:new TD,modelMatrix:a,attributes:{show:new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Iy.fromColor(i),distanceDisplayCondition:jT.fromDistanceDisplayCondition(o)}})},yxe.prototype._isHidden=function(e,t){return!C(t.plane)||!C(t.dimensions)||!C(e.position)||fQ.prototype._isHidden.call(this,e,t)},yxe.prototype._getIsClosed=function(e){return!1},yxe.prototype._isDynamic=function(e,t){return!e.position.isConstant||!Bz.isConstant(e.orientation)||!t.plane.isConstant||!t.dimensions.isConstant||!Bz.isConstant(t.outlineWidth)},yxe.prototype._setStaticOptions=function(e,t){const n=this._materialProperty instanceof BU,i=this._options;i.vertexFormat=n?LU.VERTEX_FORMAT:SU.MaterialSupport.TEXTURED.vertexFormat,i.plane=t.plane.getValue(fO.MINIMUM_VALUE,i.plane),i.dimensions=t.dimensions.getValue(fO.MINIMUM_VALUE,i.dimensions)},yxe.DynamicGeometryUpdater=vxe,C(Object.create)&&(vxe.prototype=Object.create(vK.prototype),vxe.prototype.constructor=vxe),vxe.prototype._isHidden=function(e,t,n){const i=this._options,o=Bz.getValueOrUndefined(e.position,n,mxe);return!C(o)||!C(i.plane)||!C(i.dimensions)||vK.prototype._isHidden.call(this,e,t,n)},vxe.prototype._setOptions=function(e,t,n){const i=this._options;i.plane=Bz.getValueOrDefault(t.plane,n,i.plane),i.dimensions=Bz.getValueOrUndefined(t.dimensions,n,i.dimensions)};const bxe=new K,Axe=new K,wxe=new K,Txe=new K,Cxe=new ke,Exe=new ke,xxe=new ft;function Sxe(e,t,n,i){const o=e.normal,r=e.distance,s=K.multiplyByScalar(o,-r,wxe);let a=K.clone(K.UNIT_Z,Axe);z.equalsEpsilon(Math.abs(K.dot(a,o)),1,z.EPSILON8)&&(a=K.clone(K.UNIT_Y,a));const c=K.cross(a,o,bxe);a=K.cross(o,c,a),K.normalize(c,c),K.normalize(a,a);const l=Cxe;ke.setColumn(l,0,c,l),ke.setColumn(l,1,a,l),ke.setColumn(l,2,o,l);const u=K.fromElements(t.x,t.y,1,Txe),h=ke.multiplyByScale(l,u,Exe),d=ft.fromRotationTranslation(h,s,xxe);return ft.multiplyTransformation(n,d,i)}yxe.createPrimitiveMatrix=Sxe;var Ixe=yxe;const Oxe="Entity polygons cannot have both height and perPositionHeight.  height will be ignored",Dxe="heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored",Pxe=new xy,Rxe=K.ZERO,Lxe=new K,Mxe=new _t,Bxe=[],Nxe=new ro;function Fxe(e){this.id=e,this.vertexFormat=void 0,this.polygonHierarchy=void 0,this.perPositionHeight=void 0,this.closeTop=void 0,this.closeBottom=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.offsetAttribute=void 0,this.arcType=void 0}function zxe(e,t){tAe.call(this,{entity:e,scene:t,geometryOptions:new Fxe(e),geometryPropertyName:"polygon",observedPropertyNames:["availability","polygon"]}),this._onEntityPropertyChanged(e,"polygon",e.polygon,void 0)}function kxe(e,t,n){vK.call(this,e,t,n)}C(Object.create)&&(zxe.prototype=Object.create(tAe.prototype),zxe.prototype.constructor=zxe),zxe.prototype.createFillGeometryInstance=function(e){if(D.defined("time",e),!this._fillEnabled)throw new x("This instance does not represent a filled geometry.");const t=this._entity,n=t.isAvailable(e),i=this._options,o={show:new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:jT.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};if(this._materialProperty instanceof BU){let t;C(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(t=this._materialProperty.color.getValue(e,Pxe)),C(t)||(t=xy.WHITE),o.color=Iy.fromColor(t)}let r;return C(i.offsetAttribute)&&(o.offset=JO.fromCartesian3(Bz.getValueOrDefault(this._terrainOffsetProperty,e,Rxe,Lxe))),r=i.perPositionHeight&&!C(i.extrudedHeight)?new Nb(i):new oP(i),new Sm({id:t,geometry:r,attributes:o})},zxe.prototype.createOutlineGeometryInstance=function(e){if(D.defined("time",e),!this._outlineEnabled)throw new x("This instance does not represent an outlined geometry.");const t=this._entity,n=t.isAvailable(e),i=this._options,o=Bz.getValueOrDefault(this._outlineColorProperty,e,xy.BLACK,Pxe),r=this._distanceDisplayConditionProperty.getValue(e),s={show:new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Iy.fromColor(o),distanceDisplayCondition:jT.fromDistanceDisplayCondition(r),offset:void 0};let a;return C(i.offsetAttribute)&&(s.offset=JO.fromCartesian3(Bz.getValueOrDefault(this._terrainOffsetProperty,e,Rxe,Lxe))),a=i.perPositionHeight&&!C(i.extrudedHeight)?new Ub(i):new pP(i),new Sm({id:t,geometry:a,attributes:s})},zxe.prototype._computeCenter=function(e,t){const n=Bz.getValueOrUndefined(this._entity.polygon.hierarchy,e);if(!C(n))return;const i=n.positions;if(0===i.length)return;const o=this._scene.mapProjection.ellipsoid,r=tu.fromPoints(i,o),s=r.projectPointsOntoPlane(i,Bxe),a=s.length;let c=0,l=a-1,u=new ro;for(let d=0;d<a;l=d++){const e=s[d],t=s[l],n=e.x*t.y-t.x*e.y;let i=ro.add(e,t,Nxe);i=ro.multiplyByScalar(i,n,i),u=ro.add(u,i,u),c+=n}const h=1/(3*c);return u=ro.multiplyByScalar(u,h,u),r.projectPointOntoEllipsoid(u,t)},zxe.prototype._isHidden=function(e,t){return!C(t.hierarchy)||fQ.prototype._isHidden.call(this,e,t)},zxe.prototype._isOnTerrain=function(e,t){const n=tAe.prototype._isOnTerrain.call(this,e,t),i=t.perPositionHeight,o=C(i)&&(!i.isConstant||i.getValue(fO.MINIMUM_VALUE));return n&&!o},zxe.prototype._isDynamic=function(e,t){return!t.hierarchy.isConstant||!Bz.isConstant(t.height)||!Bz.isConstant(t.extrudedHeight)||!Bz.isConstant(t.granularity)||!Bz.isConstant(t.stRotation)||!Bz.isConstant(t.outlineWidth)||!Bz.isConstant(t.perPositionHeight)||!Bz.isConstant(t.closeTop)||!Bz.isConstant(t.closeBottom)||!Bz.isConstant(t.zIndex)||!Bz.isConstant(t.arcType)||this._onTerrain&&!Bz.isConstant(this._materialProperty)&&!(this._materialProperty instanceof BU)},zxe.prototype._setStaticOptions=function(e,t){const n=this._materialProperty instanceof BU,i=this._options;i.vertexFormat=n?LU.VERTEX_FORMAT:SU.MaterialSupport.TEXTURED.vertexFormat;const o=t.hierarchy.getValue(fO.MINIMUM_VALUE);let r=Bz.getValueOrUndefined(t.height,fO.MINIMUM_VALUE);const s=Bz.getValueOrDefault(t.heightReference,fO.MINIMUM_VALUE,Sz.NONE);let a=Bz.getValueOrUndefined(t.extrudedHeight,fO.MINIMUM_VALUE);const c=Bz.getValueOrDefault(t.extrudedHeightReference,fO.MINIMUM_VALUE,Sz.NONE),l=Bz.getValueOrDefault(t.perPositionHeight,fO.MINIMUM_VALUE,!1);let u;r=tAe.getGeometryHeight(r,s),l?(C(r)&&(r=void 0,CA(Oxe)),s!==Sz.NONE&&l&&(r=void 0,CA(Dxe))):(C(a)&&!C(r)&&(r=0),u=tAe.computeGeometryOffsetAttribute(r,s,a,c)),i.polygonHierarchy=o,i.granularity=Bz.getValueOrUndefined(t.granularity,fO.MINIMUM_VALUE),i.stRotation=Bz.getValueOrUndefined(t.stRotation,fO.MINIMUM_VALUE),i.perPositionHeight=l,i.closeTop=Bz.getValueOrDefault(t.closeTop,fO.MINIMUM_VALUE,!0),i.closeBottom=Bz.getValueOrDefault(t.closeBottom,fO.MINIMUM_VALUE,!0),i.offsetAttribute=u,i.height=r,i.arcType=Bz.getValueOrDefault(t.arcType,fO.MINIMUM_VALUE,hf.GEODESIC),a=tAe.getGeometryExtrudedHeight(a,c),a===tAe.CLAMP_TO_GROUND&&(a=bo.getMinimumMaximumHeights(oP.computeRectangle(i,Mxe)).minimumTerrainHeight),i.extrudedHeight=a},zxe.prototype._getIsClosed=function(e){const t=e.height,n=e.extrudedHeight,i=C(n)&&n!==t;return!e.perPositionHeight&&(!i&&0===t||i&&e.closeTop&&e.closeBottom)},zxe.DynamicGeometryUpdater=kxe,C(Object.create)&&(kxe.prototype=Object.create(vK.prototype),kxe.prototype.constructor=kxe),kxe.prototype._isHidden=function(e,t,n){return!C(this._options.polygonHierarchy)||vK.prototype._isHidden.call(this,e,t,n)},kxe.prototype._setOptions=function(e,t,n){const i=this._options;i.polygonHierarchy=Bz.getValueOrUndefined(t.hierarchy,n);let o=Bz.getValueOrUndefined(t.height,n);const r=Bz.getValueOrDefault(t.heightReference,n,Sz.NONE),s=Bz.getValueOrDefault(t.extrudedHeightReference,n,Sz.NONE);let a=Bz.getValueOrUndefined(t.extrudedHeight,n);const c=Bz.getValueOrUndefined(t.perPositionHeight,n);let l;o=tAe.getGeometryHeight(o,s),c?(C(o)&&(o=void 0,CA(Oxe)),r!==Sz.NONE&&c&&(o=void 0,CA(Dxe))):(C(a)&&!C(o)&&(o=0),l=tAe.computeGeometryOffsetAttribute(o,r,a,s)),i.granularity=Bz.getValueOrUndefined(t.granularity,n),i.stRotation=Bz.getValueOrUndefined(t.stRotation,n),i.perPositionHeight=Bz.getValueOrUndefined(t.perPositionHeight,n),i.closeTop=Bz.getValueOrDefault(t.closeTop,n,!0),i.closeBottom=Bz.getValueOrDefault(t.closeBottom,n,!0),i.offsetAttribute=l,i.height=o,i.arcType=Bz.getValueOrDefault(t.arcType,n,hf.GEODESIC),a=tAe.getGeometryExtrudedHeight(a,s),a===tAe.CLAMP_TO_GROUND&&(a=bo.getMinimumMaximumHeights(oP.computeRectangle(i,Mxe)).minimumTerrainHeight),i.extrudedHeight=a};var Uxe=zxe;const Vxe=new xy;function Hxe(e){this.id=e,this.vertexFormat=void 0,this.polylinePositions=void 0,this.shapePositions=void 0,this.cornerType=void 0,this.granularity=void 0}function Gxe(e,t){fQ.call(this,{entity:e,scene:t,geometryOptions:new Hxe(e),geometryPropertyName:"polylineVolume",observedPropertyNames:["availability","polylineVolume"]}),this._onEntityPropertyChanged(e,"polylineVolume",e.polylineVolume,void 0)}function Wxe(e,t,n){vK.call(this,e,t,n)}C(Object.create)&&(Gxe.prototype=Object.create(fQ.prototype),Gxe.prototype.constructor=Gxe),Gxe.prototype.createFillGeometryInstance=function(e){if(D.defined("time",e),!this._fillEnabled)throw new x("This instance does not represent a filled geometry.");const t=this._entity,n=t.isAvailable(e);let i,o;const r=new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),s=this._distanceDisplayConditionProperty.getValue(e),a=jT.fromDistanceDisplayCondition(s);if(this._materialProperty instanceof BU){let t;C(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(t=this._materialProperty.color.getValue(e,Vxe)),C(t)||(t=xy.WHITE),o=Iy.fromColor(t),i={show:r,distanceDisplayCondition:a,color:o}}else i={show:r,distanceDisplayCondition:a};return new Sm({id:t,geometry:new RP(this._options),attributes:i})},Gxe.prototype.createOutlineGeometryInstance=function(e){if(D.defined("time",e),!this._outlineEnabled)throw new x("This instance does not represent an outlined geometry.");const t=this._entity,n=t.isAvailable(e),i=Bz.getValueOrDefault(this._outlineColorProperty,e,xy.BLACK,Vxe),o=this._distanceDisplayConditionProperty.getValue(e);return new Sm({id:t,geometry:new zP(this._options),attributes:{show:new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Iy.fromColor(i),distanceDisplayCondition:jT.fromDistanceDisplayCondition(o)}})},Gxe.prototype._isHidden=function(e,t){return!C(t.positions)||!C(t.shape)||fQ.prototype._isHidden.call(this,e,t)},Gxe.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!t.shape.isConstant||!Bz.isConstant(t.granularity)||!Bz.isConstant(t.outlineWidth)||!Bz.isConstant(t.cornerType)},Gxe.prototype._setStaticOptions=function(e,t){const n=t.granularity,i=t.cornerType,o=this._options,r=this._materialProperty instanceof BU;o.vertexFormat=r?LU.VERTEX_FORMAT:SU.MaterialSupport.TEXTURED.vertexFormat,o.polylinePositions=t.positions.getValue(fO.MINIMUM_VALUE,o.polylinePositions),o.shapePositions=t.shape.getValue(fO.MINIMUM_VALUE,o.shape),o.granularity=C(n)?n.getValue(fO.MINIMUM_VALUE):void 0,o.cornerType=C(i)?i.getValue(fO.MINIMUM_VALUE):void 0},Gxe.DynamicGeometryUpdater=Wxe,C(Object.create)&&(Wxe.prototype=Object.create(vK.prototype),Wxe.prototype.constructor=Wxe),Wxe.prototype._isHidden=function(e,t,n){const i=this._options;return!C(i.polylinePositions)||!C(i.shapePositions)||vK.prototype._isHidden.call(this,e,t,n)},Wxe.prototype._setOptions=function(e,t,n){const i=this._options;i.polylinePositions=Bz.getValueOrUndefined(t.positions,n,i.polylinePositions),i.shapePositions=Bz.getValueOrUndefined(t.shape,n),i.granularity=Bz.getValueOrUndefined(t.granularity,n),i.cornerType=Bz.getValueOrUndefined(t.cornerType,n)};var qxe=Gxe;const jxe=new xy,Yxe=K.ZERO,Kxe=new K,Xxe=new _t,Qxe=new _t,Jxe=new se;function Zxe(e){this.id=e,this.vertexFormat=void 0,this.rectangle=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.rotation=void 0,this.offsetAttribute=void 0}function $xe(e,t){tAe.call(this,{entity:e,scene:t,geometryOptions:new Zxe(e),geometryPropertyName:"rectangle",observedPropertyNames:["availability","rectangle"]}),this._onEntityPropertyChanged(e,"rectangle",e.rectangle,void 0)}function eSe(e,t,n){vK.call(this,e,t,n)}C(Object.create)&&($xe.prototype=Object.create(tAe.prototype),$xe.prototype.constructor=$xe),$xe.prototype.createFillGeometryInstance=function(e){if(D.defined("time",e),!this._fillEnabled)throw new x("This instance does not represent a filled geometry.");const t=this._entity,n=t.isAvailable(e),i={show:new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:jT.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};if(this._materialProperty instanceof BU){let t;C(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(t=this._materialProperty.color.getValue(e,jxe)),C(t)||(t=xy.WHITE),i.color=Iy.fromColor(t)}return C(this._options.offsetAttribute)&&(i.offset=JO.fromCartesian3(Bz.getValueOrDefault(this._terrainOffsetProperty,e,Yxe,Kxe))),new Sm({id:t,geometry:new rL(this._options),attributes:i})},$xe.prototype.createOutlineGeometryInstance=function(e){if(D.defined("time",e),!this._outlineEnabled)throw new x("This instance does not represent an outlined geometry.");const t=this._entity,n=t.isAvailable(e),i=Bz.getValueOrDefault(this._outlineColorProperty,e,xy.BLACK,jxe),o=this._distanceDisplayConditionProperty.getValue(e),r={show:new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Iy.fromColor(i),distanceDisplayCondition:jT.fromDistanceDisplayCondition(o),offset:void 0};return C(this._options.offsetAttribute)&&(r.offset=JO.fromCartesian3(Bz.getValueOrDefault(this._terrainOffsetProperty,e,Yxe,Kxe))),new Sm({id:t,geometry:new gL(this._options),attributes:r})},$xe.prototype._computeCenter=function(e,t){const n=Bz.getValueOrUndefined(this._entity.rectangle.coordinates,e,Qxe);if(!C(n))return;const i=_t.center(n,Jxe);return se.toCartesian(i,ge.WGS84,t)},$xe.prototype._isHidden=function(e,t){return!C(t.coordinates)||fQ.prototype._isHidden.call(this,e,t)},$xe.prototype._isDynamic=function(e,t){return!t.coordinates.isConstant||!Bz.isConstant(t.height)||!Bz.isConstant(t.extrudedHeight)||!Bz.isConstant(t.granularity)||!Bz.isConstant(t.stRotation)||!Bz.isConstant(t.rotation)||!Bz.isConstant(t.outlineWidth)||!Bz.isConstant(t.zIndex)||this._onTerrain&&!Bz.isConstant(this._materialProperty)&&!(this._materialProperty instanceof BU)},$xe.prototype._setStaticOptions=function(e,t){const n=this._materialProperty instanceof BU;let i=Bz.getValueOrUndefined(t.height,fO.MINIMUM_VALUE);const o=Bz.getValueOrDefault(t.heightReference,fO.MINIMUM_VALUE,Sz.NONE);let r=Bz.getValueOrUndefined(t.extrudedHeight,fO.MINIMUM_VALUE);const s=Bz.getValueOrDefault(t.extrudedHeightReference,fO.MINIMUM_VALUE,Sz.NONE);C(r)&&!C(i)&&(i=0);const a=this._options;a.vertexFormat=n?LU.VERTEX_FORMAT:SU.MaterialSupport.TEXTURED.vertexFormat,a.rectangle=t.coordinates.getValue(fO.MINIMUM_VALUE,a.rectangle),a.granularity=Bz.getValueOrUndefined(t.granularity,fO.MINIMUM_VALUE),a.stRotation=Bz.getValueOrUndefined(t.stRotation,fO.MINIMUM_VALUE),a.rotation=Bz.getValueOrUndefined(t.rotation,fO.MINIMUM_VALUE),a.offsetAttribute=tAe.computeGeometryOffsetAttribute(i,o,r,s),a.height=tAe.getGeometryHeight(i,o),r=tAe.getGeometryExtrudedHeight(r,s),r===tAe.CLAMP_TO_GROUND&&(r=bo.getMinimumMaximumHeights(rL.computeRectangle(a,Xxe)).minimumTerrainHeight),a.extrudedHeight=r},$xe.DynamicGeometryUpdater=eSe,C(Object.create)&&(eSe.prototype=Object.create(vK.prototype),eSe.prototype.constructor=eSe),eSe.prototype._isHidden=function(e,t,n){return!C(this._options.rectangle)||vK.prototype._isHidden.call(this,e,t,n)},eSe.prototype._setOptions=function(e,t,n){const i=this._options;let o=Bz.getValueOrUndefined(t.height,n);const r=Bz.getValueOrDefault(t.heightReference,n,Sz.NONE);let s=Bz.getValueOrUndefined(t.extrudedHeight,n);const a=Bz.getValueOrDefault(t.extrudedHeightReference,n,Sz.NONE);C(s)&&!C(o)&&(o=0),i.rectangle=Bz.getValueOrUndefined(t.coordinates,n,i.rectangle),i.granularity=Bz.getValueOrUndefined(t.granularity,n),i.stRotation=Bz.getValueOrUndefined(t.stRotation,n),i.rotation=Bz.getValueOrUndefined(t.rotation,n),i.offsetAttribute=tAe.computeGeometryOffsetAttribute(o,r,s,a),i.height=tAe.getGeometryHeight(o,r),s=tAe.getGeometryExtrudedHeight(s,a),s===tAe.CLAMP_TO_GROUND&&(s=bo.getMinimumMaximumHeights(rL.computeRectangle(i,Xxe)).minimumTerrainHeight),i.extrudedHeight=s};var tSe=$xe;const nSe=new xy,iSe=new WT,oSe=new WT,rSe=K.ZERO,sSe=new K;function aSe(e,t,n,i,o,r,s){let a;this.translucent=t,this.appearanceType=n,this.depthFailAppearanceType=i,this.depthFailMaterialProperty=o,this.depthFailMaterial=void 0,this.closed=r,this.shadows=s,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new ff,this.updaters=new ff,this.updatersWithAttributes=new ff,this.attributes=new ff,this.subscriptions=new ff,this.showsUpdated=new ff,this.itemsToRemove=[],this.invalidated=!1,C(o)&&(a=o.definitionChanged.addEventListener(aSe.prototype.onMaterialChanged,this)),this.removeMaterialSubscription=a}function cSe(e,t,n,i,o){this._solidItems=[],this._translucentItems=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=n,this._closed=i,this._shadows=o}function lSe(e,t){const n=e.length;for(let i=n-1;i>=0;i--){const n=e[i];if(n.remove(t))return 0===n.updaters.length&&(e.splice(i,1),n.destroy()),!0}return!1}function uSe(e,t,n){let i=!1;const o=t.length;for(let r=0;r<o;++r){const o=t[r],s=o.itemsToRemove,a=s.length;if(a>0)for(r=0;r<a;r++){const t=s[r];o.remove(t),e.add(n,t),i=!0}}return i}function hSe(e,t,n,i){let o,r=t.length;for(o=r-1;o>=0;o--){const i=t[o];if(i.invalidated){t.splice(o,1);const r=i.updaters.values,s=r.length;for(let t=0;t<s;t++)e.add(n,r[t]);i.destroy()}}for(r=t.length,o=0;o<r;++o)i=t[o].update(n)&&i;return i}function dSe(e,t,n){const i=e.length;for(let o=0;o<i;o++){const i=e[o];if(i.contains(t))return i.getBoundingSphere(t,n)}return Lz.FAILED}function fSe(e){const t=e.length;for(let n=0;n<t;n++)e[n].destroy();e.length=0}aSe.prototype.onMaterialChanged=function(){this.invalidated=!0},aSe.prototype.isMaterial=function(e){const t=this.depthFailMaterialProperty,n=e.depthFailMaterialProperty;return n===t||!!C(t)&&t.equals(n)},aSe.prototype.add=function(e,t){const n=e.id;if(this.createPrimitive=!0,this.geometry.set(n,t),this.updaters.set(n,e),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&Bz.isConstant(e.distanceDisplayConditionProperty)&&Bz.isConstant(e.terrainOffsetProperty)){const t=this;this.subscriptions.set(n,e.entity.definitionChanged.addEventListener((function(n,i,o,r){"isShowing"===i&&t.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(n,e)},aSe.prototype.remove=function(e){const t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);const e=this.subscriptions.get(t);return C(e)&&(e(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},aSe.prototype.update=function(e){let t=!0,n=0,i=this.primitive;const o=this.primitives;let r;if(this.createPrimitive){const n=this.geometry.values,r=n.length;if(r>0){let r;C(i)&&(C(this.oldPrimitive)?o.remove(i):this.oldPrimitive=i),C(this.depthFailAppearanceType)&&(C(this.depthFailMaterialProperty)&&(this.depthFailMaterial=gK.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial)),r=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed})),i=new tY({show:!1,asynchronous:!0,geometryInstances:n.slice(),appearance:new this.appearanceType({translucent:this.translucent,closed:this.closed}),depthFailAppearance:r,shadows:this.shadows}),o.add(i),t=!1}else{C(i)&&(o.remove(i),i=void 0);const e=this.oldPrimitive;C(e)&&(o.remove(e),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(C(i)&&i.ready){i.show=!0,C(this.oldPrimitive)&&(o.remove(this.oldPrimitive),this.oldPrimitive=void 0),!C(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof BU||(this.depthFailMaterial=gK.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);const t=this.updatersWithAttributes.values,s=t.length,a=this.waitingOnCreate;for(r=0;r<s;r++){const o=t[r],s=this.geometry.get(o.id);let c=this.attributes.get(s.id.id);if(C(c)||(c=i.getGeometryInstanceAttributes(s.id),this.attributes.set(s.id.id,c)),!o.fillMaterialProperty.isConstant||a){const t=o.fillMaterialProperty.color,i=Bz.getValueOrDefault(t,e,xy.WHITE,nSe);xy.equals(c._lastColor,i)||(c._lastColor=xy.clone(i,c._lastColor),c.color=Iy.toValue(i,c.color),(this.translucent&&255===c.color[3]||!this.translucent&&255!==c.color[3])&&(this.itemsToRemove[n++]=o))}if(C(this.depthFailAppearanceType)&&o.depthFailMaterialProperty instanceof BU&&(!o.depthFailMaterialProperty.isConstant||a)){const t=o.depthFailMaterialProperty.color,n=Bz.getValueOrDefault(t,e,xy.WHITE,nSe);xy.equals(c._lastDepthFailColor,n)||(c._lastDepthFailColor=xy.clone(n,c._lastDepthFailColor),c.depthFailColor=Iy.toValue(n,c.depthFailColor))}const l=o.entity.isShowing&&(o.hasConstantFill||o.isFilled(e)),u=1===c.show[0];l!==u&&(c.show=FM.toValue(l,c.show));const h=o.distanceDisplayConditionProperty;if(!Bz.isConstant(h)){const t=Bz.getValueOrDefault(h,e,oSe,iSe);WT.equals(t,c._lastDistanceDisplayCondition)||(c._lastDistanceDisplayCondition=WT.clone(t,c._lastDistanceDisplayCondition),c.distanceDisplayCondition=jT.toValue(t,c.distanceDisplayCondition))}const d=o.terrainOffsetProperty;if(!Bz.isConstant(d)){const t=Bz.getValueOrDefault(d,e,rSe,sSe);K.equals(t,c._lastOffset)||(c._lastOffset=K.clone(t,c._lastOffset),c.offset=JO.toValue(t,c.offset))}}this.updateShows(i),this.waitingOnCreate=!1}else C(i)&&!i.ready&&(t=!1);return this.itemsToRemove.length=n,t},aSe.prototype.updateShows=function(e){const t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){const n=t[i],o=this.geometry.get(n.id);let r=this.attributes.get(o.id.id);C(r)||(r=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,r));const s=n.entity.isShowing,a=1===r.show[0];s!==a&&(r.show=FM.toValue(s,r.show),o.attributes.show.value[0]=r.show[0])}this.showsUpdated.removeAll()},aSe.prototype.contains=function(e){return this.updaters.contains(e.id)},aSe.prototype.getBoundingSphere=function(e,t){const n=this.primitive;if(!n.ready)return Lz.PENDING;const i=n.getGeometryInstanceAttributes(e.entity);return!C(i)||!C(i.boundingSphere)||C(i.show)&&0===i.show[0]?Lz.FAILED:(i.boundingSphere.clone(t),Lz.DONE)},aSe.prototype.destroy=function(){const e=this.primitive,t=this.primitives;C(e)&&t.remove(e);const n=this.oldPrimitive;C(n)&&t.remove(n),C(this.removeMaterialSubscription)&&this.removeMaterialSubscription()},cSe.prototype.add=function(e,t){let n,i;const o=t.createFillGeometryInstance(e);255===o.attributes.color.value[3]?(n=this._solidItems,i=!1):(n=this._translucentItems,i=!0);const r=n.length;for(let a=0;a<r;a++){const e=n[a];if(e.isMaterial(t))return void e.add(t,o)}const s=new aSe(this._primitives,i,this._appearanceType,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);s.add(t,o),n.push(s)},cSe.prototype.remove=function(e){lSe(this._solidItems,e)||lSe(this._translucentItems,e)},cSe.prototype.update=function(e){let t=hSe(this,this._solidItems,e,!0);t=hSe(this,this._translucentItems,e,t)&&t;const n=uSe(this,this._solidItems,e),i=uSe(this,this._translucentItems,e);return(n||i)&&(t=hSe(this,this._solidItems,e,t)&&t,t=hSe(this,this._translucentItems,e,t)&&t),t},cSe.prototype.getBoundingSphere=function(e,t){const n=dSe(this._solidItems,e,t);return n===Lz.FAILED?dSe(this._translucentItems,e,t):n},cSe.prototype.removeAllPrimitives=function(){fSe(this._solidItems),fSe(this._translucentItems)};var pSe=cSe;const mSe=new WT,_Se=new WT,gSe=K.ZERO,ySe=new K;function vSe(e,t,n,i,o,r,s){this.primitives=e,this.appearanceType=t,this.materialProperty=n,this.depthFailAppearanceType=i,this.depthFailMaterialProperty=o,this.closed=r,this.shadows=s,this.updaters=new ff,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new ff,this.material=void 0,this.depthFailMaterial=void 0,this.updatersWithAttributes=new ff,this.attributes=new ff,this.invalidated=!1,this.removeMaterialSubscription=n.definitionChanged.addEventListener(vSe.prototype.onMaterialChanged,this),this.subscriptions=new ff,this.showsUpdated=new ff}vSe.prototype.onMaterialChanged=function(){this.invalidated=!0},vSe.prototype.isMaterial=function(e){const t=this.materialProperty,n=e.fillMaterialProperty,i=this.depthFailMaterialProperty,o=e.depthFailMaterialProperty;if(n===t&&o===i)return!0;let r=C(t)&&t.equals(n);return r=(!C(i)&&!C(o)||C(i)&&i.equals(o))&&r,r},vSe.prototype.add=function(e,t){const n=t.id;if(this.updaters.set(n,t),this.geometry.set(n,t.createFillGeometryInstance(e)),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&Bz.isConstant(t.distanceDisplayConditionProperty)&&Bz.isConstant(t.terrainOffsetProperty)){const e=this;this.subscriptions.set(n,t.entity.definitionChanged.addEventListener((function(n,i,o,r){"isShowing"===i&&e.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(n,t);this.createPrimitive=!0},vSe.prototype.remove=function(e){const t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);const e=this.subscriptions.get(t);return C(e)&&(e(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};const bSe=new xy;function ASe(e,t,n,i,o){this._items=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=n,this._closed=i,this._shadows=o}vSe.prototype.update=function(e){let t=!0,n=this.primitive;const i=this.primitives,o=this.geometry.values;let r;if(this.createPrimitive){const r=o.length;if(r>0){let r;C(n)&&(C(this.oldPrimitive)?i.remove(n):this.oldPrimitive=n),this.material=gK.getValue(e,this.materialProperty,this.material),C(this.depthFailMaterialProperty)&&(this.depthFailMaterial=gK.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),r=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.depthFailMaterial.isTranslucent(),closed:this.closed})),n=new tY({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new this.appearanceType({material:this.material,translucent:this.material.isTranslucent(),closed:this.closed}),depthFailAppearance:r,shadows:this.shadows}),i.add(n),t=!1}else{C(n)&&(i.remove(n),n=void 0);const e=this.oldPrimitive;C(e)&&(i.remove(e),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=n,this.createPrimitive=!1}else if(C(n)&&n.ready){n.show=!0,C(this.oldPrimitive)&&(i.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=gK.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material,!C(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof BU||(this.depthFailMaterial=gK.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);const t=this.updatersWithAttributes.values,o=t.length;for(r=0;r<o;r++){const i=t[r],o=i.entity,s=this.geometry.get(i.id);let a=this.attributes.get(s.id.id);if(C(a)||(a=n.getGeometryInstanceAttributes(s.id),this.attributes.set(s.id.id,a)),C(this.depthFailAppearanceType)&&this.depthFailMaterialProperty instanceof BU&&!i.depthFailMaterialProperty.isConstant){const t=i.depthFailMaterialProperty.color,n=Bz.getValueOrDefault(t,e,xy.WHITE,bSe);xy.equals(a._lastDepthFailColor,n)||(a._lastDepthFailColor=xy.clone(n,a._lastDepthFailColor),a.depthFailColor=Iy.toValue(n,a.depthFailColor))}const c=o.isShowing&&(i.hasConstantFill||i.isFilled(e)),l=1===a.show[0];c!==l&&(a.show=FM.toValue(c,a.show));const u=i.distanceDisplayConditionProperty;if(!Bz.isConstant(u)){const t=Bz.getValueOrDefault(u,e,_Se,mSe);WT.equals(t,a._lastDistanceDisplayCondition)||(a._lastDistanceDisplayCondition=WT.clone(t,a._lastDistanceDisplayCondition),a.distanceDisplayCondition=jT.toValue(t,a.distanceDisplayCondition))}const h=i.terrainOffsetProperty;if(!Bz.isConstant(h)){const t=Bz.getValueOrDefault(h,e,gSe,ySe);K.equals(t,a._lastOffset)||(a._lastOffset=K.clone(t,a._lastOffset),a.offset=JO.toValue(t,a.offset))}}this.updateShows(n)}else C(n)&&!n.ready&&(t=!1);return t},vSe.prototype.updateShows=function(e){const t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){const n=t[i],o=n.entity,r=this.geometry.get(n.id);let s=this.attributes.get(r.id.id);C(s)||(s=e.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,s));const a=o.isShowing,c=1===s.show[0];a!==c&&(s.show=FM.toValue(a,s.show),r.attributes.show.value[0]=s.show[0])}this.showsUpdated.removeAll()},vSe.prototype.contains=function(e){return this.updaters.contains(e.id)},vSe.prototype.getBoundingSphere=function(e,t){const n=this.primitive;if(!n.ready)return Lz.PENDING;const i=n.getGeometryInstanceAttributes(e.entity);return!C(i)||!C(i.boundingSphere)||C(i.show)&&0===i.show[0]?Lz.FAILED:(i.boundingSphere.clone(t),Lz.DONE)},vSe.prototype.destroy=function(){const e=this.primitive,t=this.primitives;C(e)&&t.remove(e);const n=this.oldPrimitive;C(n)&&t.remove(n),this.removeMaterialSubscription()},ASe.prototype.add=function(e,t){const n=this._items,i=n.length;for(let r=0;r<i;r++){const i=n[r];if(i.isMaterial(t))return void i.add(e,t)}const o=new vSe(this._primitives,this._appearanceType,t.fillMaterialProperty,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);o.add(e,t),n.push(o)},ASe.prototype.remove=function(e){const t=this._items,n=t.length;for(let i=n-1;i>=0;i--){const n=t[i];if(n.remove(e)){0===n.updaters.length&&(t.splice(i,1),n.destroy());break}}},ASe.prototype.update=function(e){let t;const n=this._items,i=n.length;for(t=i-1;t>=0;t--){const i=n[t];if(i.invalidated){n.splice(t,1);const o=i.updaters.values,r=o.length;for(let t=0;t<r;t++)this.add(e,o[t]);i.destroy()}}let o=!0;for(t=0;t<n.length;t++)o=n[t].update(e)&&o;return o},ASe.prototype.getBoundingSphere=function(e,t){const n=this._items,i=n.length;for(let o=0;o<i;o++){const i=n[o];if(i.contains(e))return i.getBoundingSphere(e,t)}return Lz.FAILED},ASe.prototype.removeAllPrimitives=function(){const e=this._items,t=e.length;for(let n=0;n<t;n++)e[n].destroy();this._items.length=0};var wSe=ASe;const TSe=new xy,CSe=new WT,ESe=new WT;function xSe(e,t,n,i){this.primitives=e,this.zIndex=i,this.classificationType=t,this.color=n,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new ff,this.updaters=new ff,this.updatersWithAttributes=new ff,this.attributes=new ff,this.subscriptions=new ff,this.showsUpdated=new ff,this.itemsToRemove=[],this.isDirty=!1,this.rectangleCollisionCheck=new fR}function SSe(e,t){this._batches=[],this._primitives=e,this._classificationType=t}xSe.prototype.overlapping=function(e){return this.rectangleCollisionCheck.collides(e)},xSe.prototype.add=function(e,t){const n=e.id;if(this.createPrimitive=!0,this.geometry.set(n,t),this.updaters.set(n,e),this.rectangleCollisionCheck.insert(n,t.geometry.rectangle),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&Bz.isConstant(e.distanceDisplayConditionProperty)){const t=this;this.subscriptions.set(n,e.entity.definitionChanged.addEventListener((function(n,i,o,r){"isShowing"===i&&t.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(n,e)},xSe.prototype.remove=function(e){const t=e.id,n=this.geometry.get(t);if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.rectangleCollisionCheck.remove(t,n.geometry.rectangle),this.updatersWithAttributes.remove(t);const e=this.subscriptions.get(t);return C(e)&&(e(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},xSe.prototype.update=function(e){let t=!0;const n=0;let i=this.primitive;const o=this.primitives;let r;if(this.createPrimitive){const e=this.geometry.values,n=e.length;if(n>0)C(i)&&(C(this.oldPrimitive)?o.remove(i):this.oldPrimitive=i),i=new mK({show:!1,asynchronous:!0,geometryInstances:e.slice(),classificationType:this.classificationType}),o.add(i,this.zIndex),t=!1;else{C(i)&&(o.remove(i),i=void 0);const e=this.oldPrimitive;C(e)&&(o.remove(e),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(C(i)&&i.ready){i.show=!0,C(this.oldPrimitive)&&(o.remove(this.oldPrimitive),this.oldPrimitive=void 0);const t=this.updatersWithAttributes.values,n=t.length,s=this.waitingOnCreate;for(r=0;r<n;r++){const n=t[r],o=this.geometry.get(n.id);let a=this.attributes.get(o.id.id);if(C(a)||(a=i.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,a)),!n.fillMaterialProperty.isConstant||s){const t=n.fillMaterialProperty.color,i=Bz.getValueOrDefault(t,e,xy.WHITE,TSe);xy.equals(a._lastColor,i)||(a._lastColor=xy.clone(i,a._lastColor),a.color=Iy.toValue(i,a.color))}const c=n.entity.isShowing&&(n.hasConstantFill||n.isFilled(e)),l=1===a.show[0];c!==l&&(a.show=FM.toValue(c,a.show));const u=n.distanceDisplayConditionProperty;if(!Bz.isConstant(u)){const t=Bz.getValueOrDefault(u,e,ESe,CSe);WT.equals(t,a._lastDistanceDisplayCondition)||(a._lastDistanceDisplayCondition=WT.clone(t,a._lastDistanceDisplayCondition),a.distanceDisplayCondition=jT.toValue(t,a.distanceDisplayCondition))}}this.updateShows(i),this.waitingOnCreate=!1}else C(i)&&!i.ready&&(t=!1);return this.itemsToRemove.length=n,t},xSe.prototype.updateShows=function(e){const t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){const n=t[i],o=this.geometry.get(n.id);let r=this.attributes.get(o.id.id);C(r)||(r=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,r));const s=n.entity.isShowing,a=1===r.show[0];s!==a&&(r.show=FM.toValue(s,r.show),o.attributes.show.value[0]=r.show[0])}this.showsUpdated.removeAll()},xSe.prototype.contains=function(e){return this.updaters.contains(e.id)},xSe.prototype.getBoundingSphere=function(e,t){const n=this.primitive;if(!n.ready)return Lz.PENDING;const i=n.getBoundingSphere(e.entity);return C(i)?(i.clone(t),Lz.DONE):Lz.FAILED},xSe.prototype.removeAllPrimitives=function(){const e=this.primitives,t=this.primitive;C(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());const n=this.oldPrimitive;C(n)&&(e.remove(n),this.oldPrimitive=void 0)},SSe.prototype.add=function(e,t){const n=t.createFillGeometryInstance(e),i=this._batches,o=Bz.getValueOrDefault(t.zIndex,0);let r;const s=i.length;for(let a=0;a<s;++a){const e=i[a];if(e.zIndex===o&&!e.overlapping(n.geometry.rectangle)){r=e;break}}return C(r)||(r=new xSe(this._primitives,this._classificationType,n.attributes.color.value,o),i.push(r)),r.add(t,n),r},SSe.prototype.remove=function(e){const t=this._batches,n=t.length;for(let i=0;i<n;++i)if(t[i].remove(e))return},SSe.prototype.update=function(e){let t,n,i=!0;const o=this._batches,r=o.length;for(t=0;t<r;++t)i=o[t].update(e)&&i;for(t=0;t<r;++t){const i=o[t],r=i.itemsToRemove,s=r.length;for(let t=0;t<s;t++){n=r[t],i.remove(n);const o=this.add(e,n);i.isDirty=!0,o.isDirty=!0}}for(t=r-1;t>=0;--t){const n=o[t];n.isDirty&&(i=o[t].update(e)&&i,n.isDirty=!1),0===n.geometry.length&&o.splice(t,1)}return i},SSe.prototype.getBoundingSphere=function(e,t){const n=this._batches,i=n.length;for(let o=0;o<i;++o){const i=n[o];if(i.contains(e))return i.getBoundingSphere(e,t)}return Lz.FAILED},SSe.prototype.removeAllPrimitives=function(){const e=this._batches,t=e.length;for(let n=0;n<t;++n)e[n].removeAllPrimitives()};var ISe=SSe;const OSe=new WT,DSe=new WT;function PSe(e,t,n,i,o,r){this.primitives=e,this.classificationType=t,this.appearanceType=n,this.materialProperty=i,this.updaters=new ff,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new ff,this.material=void 0,this.updatersWithAttributes=new ff,this.attributes=new ff,this.invalidated=!1,this.removeMaterialSubscription=i.definitionChanged.addEventListener(PSe.prototype.onMaterialChanged,this),this.subscriptions=new ff,this.showsUpdated=new ff,this.usingSphericalTextureCoordinates=o,this.zIndex=r,this.rectangleCollisionCheck=new fR}function RSe(e,t,n){this._items=[],this._primitives=e,this._classificationType=t,this._appearanceType=n}PSe.prototype.onMaterialChanged=function(){this.invalidated=!0},PSe.prototype.overlapping=function(e){return this.rectangleCollisionCheck.collides(e)},PSe.prototype.isMaterial=function(e){const t=this.materialProperty,n=e.fillMaterialProperty;return n===t||n instanceof BU&&t instanceof BU||C(t)&&t.equals(n)},PSe.prototype.add=function(e,t,n){const i=t.id;if(this.updaters.set(i,t),this.geometry.set(i,n),this.rectangleCollisionCheck.insert(i,n.geometry.rectangle),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&Bz.isConstant(t.distanceDisplayConditionProperty)){const e=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener((function(n,i,o,r){"isShowing"===i&&e.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(i,t);this.createPrimitive=!0},PSe.prototype.remove=function(e){const t=e.id,n=this.geometry.get(t);if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.rectangleCollisionCheck.remove(t,n.geometry.rectangle),this.updatersWithAttributes.remove(t);const e=this.subscriptions.get(t);return C(e)&&(e(),this.subscriptions.remove(t)),!0}return!1},PSe.prototype.update=function(e){let t=!0,n=this.primitive;const i=this.primitives,o=this.geometry.values;let r;if(this.createPrimitive){const r=o.length;if(r>0)C(n)&&(C(this.oldPrimitive)?i.remove(n):this.oldPrimitive=n),this.material=gK.getValue(e,this.materialProperty,this.material),n=new mK({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new this.appearanceType({material:this.material}),classificationType:this.classificationType}),i.add(n,this.zIndex),t=!1;else{C(n)&&(i.remove(n),n=void 0);const e=this.oldPrimitive;C(e)&&(i.remove(e),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=n,this.createPrimitive=!1}else if(C(n)&&n.ready){n.show=!0,C(this.oldPrimitive)&&(i.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=gK.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material;const t=this.updatersWithAttributes.values,o=t.length;for(r=0;r<o;r++){const i=t[r],o=i.entity,s=this.geometry.get(i.id);let a=this.attributes.get(s.id.id);C(a)||(a=n.getGeometryInstanceAttributes(s.id),this.attributes.set(s.id.id,a));const c=o.isShowing&&(i.hasConstantFill||i.isFilled(e)),l=1===a.show[0];c!==l&&(a.show=FM.toValue(c,a.show));const u=i.distanceDisplayConditionProperty;if(!Bz.isConstant(u)){const t=Bz.getValueOrDefault(u,e,DSe,OSe);WT.equals(t,a._lastDistanceDisplayCondition)||(a._lastDistanceDisplayCondition=WT.clone(t,a._lastDistanceDisplayCondition),a.distanceDisplayCondition=jT.toValue(t,a.distanceDisplayCondition))}}this.updateShows(n)}else C(n)&&!n.ready&&(t=!1);return t},PSe.prototype.updateShows=function(e){const t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){const n=t[i],o=n.entity,r=this.geometry.get(n.id);let s=this.attributes.get(r.id.id);C(s)||(s=e.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,s));const a=o.isShowing,c=1===s.show[0];a!==c&&(s.show=FM.toValue(a,s.show),r.attributes.show.value[0]=s.show[0])}this.showsUpdated.removeAll()},PSe.prototype.contains=function(e){return this.updaters.contains(e.id)},PSe.prototype.getBoundingSphere=function(e,t){const n=this.primitive;if(!n.ready)return Lz.PENDING;const i=n.getGeometryInstanceAttributes(e.entity);return!C(i)||!C(i.boundingSphere)||C(i.show)&&0===i.show[0]?Lz.FAILED:(i.boundingSphere.clone(t),Lz.DONE)},PSe.prototype.destroy=function(){const e=this.primitive,t=this.primitives;C(e)&&t.remove(e);const n=this.oldPrimitive;C(n)&&t.remove(n),this.removeMaterialSubscription()},RSe.prototype.add=function(e,t){const n=this._items,i=n.length,o=t.createFillGeometryInstance(e),r=PY.shouldUseSphericalCoordinates(o.geometry.rectangle),s=Bz.getValueOrDefault(t.zIndex,0);for(let c=0;c<i;++c){const i=n[c];if(i.isMaterial(t)&&i.usingSphericalTextureCoordinates===r&&i.zIndex===s&&!i.overlapping(o.geometry.rectangle))return void i.add(e,t,o)}const a=new PSe(this._primitives,this._classificationType,this._appearanceType,t.fillMaterialProperty,r,s);a.add(e,t,o),n.push(a)},RSe.prototype.remove=function(e){const t=this._items,n=t.length;for(let i=n-1;i>=0;i--){const n=t[i];if(n.remove(e)){0===n.updaters.length&&(t.splice(i,1),n.destroy());break}}},RSe.prototype.update=function(e){let t;const n=this._items,i=n.length;for(t=i-1;t>=0;t--){const i=n[t];if(i.invalidated){n.splice(t,1);const o=i.updaters.values,r=o.length;for(let t=0;t<r;t++)this.add(e,o[t]);i.destroy()}}let o=!0;for(t=0;t<n.length;t++)o=n[t].update(e)&&o;return o},RSe.prototype.getBoundingSphere=function(e,t){const n=this._items,i=n.length;for(let o=0;o<i;o++){const i=n[o];if(i.contains(e))return i.getBoundingSphere(e,t)}return Lz.FAILED},RSe.prototype.removeAllPrimitives=function(){const e=this._items,t=e.length;for(let n=0;n<t;n++)e[n].destroy();this._items.length=0};var LSe=RSe;const MSe=new xy,BSe=new WT,NSe=new WT,FSe=K.ZERO,zSe=new K;function kSe(e,t,n,i){this.translucent=t,this.width=n,this.shadows=i,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new ff,this.updaters=new ff,this.updatersWithAttributes=new ff,this.attributes=new ff,this.itemsToRemove=[],this.subscriptions=new ff,this.showsUpdated=new ff}function USe(e,t,n){this._primitives=e,this._scene=t,this._shadows=n,this._solidBatches=new ff,this._translucentBatches=new ff}kSe.prototype.add=function(e,t){const n=e.id;if(this.createPrimitive=!0,this.geometry.set(n,t),this.updaters.set(n,e),e.hasConstantOutline&&e.outlineColorProperty.isConstant&&Bz.isConstant(e.distanceDisplayConditionProperty)&&Bz.isConstant(e.terrainOffsetProperty)){const t=this;this.subscriptions.set(n,e.entity.definitionChanged.addEventListener((function(n,i,o,r){"isShowing"===i&&t.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(n,e)},kSe.prototype.remove=function(e){const t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);const e=this.subscriptions.get(t);return C(e)&&(e(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},kSe.prototype.update=function(e){let t=!0,n=0,i=this.primitive;const o=this.primitives;let r;if(this.createPrimitive){const e=this.geometry.values,n=e.length;if(n>0)C(i)&&(C(this.oldPrimitive)?o.remove(i):this.oldPrimitive=i),i=new tY({show:!1,asynchronous:!0,geometryInstances:e.slice(),appearance:new LU({flat:!0,translucent:this.translucent,renderState:{lineWidth:this.width}}),shadows:this.shadows}),o.add(i),t=!1;else{C(i)&&(o.remove(i),i=void 0);const e=this.oldPrimitive;C(e)&&(o.remove(e),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(C(i)&&i.ready){i.show=!0,C(this.oldPrimitive)&&(o.remove(this.oldPrimitive),this.oldPrimitive=void 0);const t=this.updatersWithAttributes.values,s=t.length,a=this.waitingOnCreate;for(r=0;r<s;r++){const o=t[r],s=this.geometry.get(o.id);let c=this.attributes.get(s.id.id);if(C(c)||(c=i.getGeometryInstanceAttributes(s.id),this.attributes.set(s.id.id,c)),!o.outlineColorProperty.isConstant||a){const t=o.outlineColorProperty,i=Bz.getValueOrDefault(t,e,xy.WHITE,MSe);xy.equals(c._lastColor,i)||(c._lastColor=xy.clone(i,c._lastColor),c.color=Iy.toValue(i,c.color),(this.translucent&&255===c.color[3]||!this.translucent&&255!==c.color[3])&&(this.itemsToRemove[n++]=o))}const l=o.entity.isShowing&&(o.hasConstantOutline||o.isOutlineVisible(e)),u=1===c.show[0];l!==u&&(c.show=FM.toValue(l,c.show));const h=o.distanceDisplayConditionProperty;if(!Bz.isConstant(h)){const t=Bz.getValueOrDefault(h,e,NSe,BSe);WT.equals(t,c._lastDistanceDisplayCondition)||(c._lastDistanceDisplayCondition=WT.clone(t,c._lastDistanceDisplayCondition),c.distanceDisplayCondition=jT.toValue(t,c.distanceDisplayCondition))}const d=o.terrainOffsetProperty;if(!Bz.isConstant(d)){const t=Bz.getValueOrDefault(d,e,FSe,zSe);K.equals(t,c._lastOffset)||(c._lastOffset=K.clone(t,c._lastOffset),c.offset=JO.toValue(t,c.offset))}}this.updateShows(i),this.waitingOnCreate=!1}else C(i)&&!i.ready&&(t=!1);return this.itemsToRemove.length=n,t},kSe.prototype.updateShows=function(e){const t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){const n=t[i],o=this.geometry.get(n.id);let r=this.attributes.get(o.id.id);C(r)||(r=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,r));const s=n.entity.isShowing,a=1===r.show[0];s!==a&&(r.show=FM.toValue(s,r.show),o.attributes.show.value[0]=r.show[0])}this.showsUpdated.removeAll()},kSe.prototype.contains=function(e){return this.updaters.contains(e.id)},kSe.prototype.getBoundingSphere=function(e,t){const n=this.primitive;if(!n.ready)return Lz.PENDING;const i=n.getGeometryInstanceAttributes(e.entity);return!C(i)||!C(i.boundingSphere)||C(i.show)&&0===i.show[0]?Lz.FAILED:(i.boundingSphere.clone(t),Lz.DONE)},kSe.prototype.removeAllPrimitives=function(){const e=this.primitives,t=this.primitive;C(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());const n=this.oldPrimitive;C(n)&&(e.remove(n),this.oldPrimitive=void 0)},USe.prototype.add=function(e,t){const n=t.createOutlineGeometryInstance(e),i=this._scene.clampLineWidth(t.outlineWidth);let o,r;255===n.attributes.color.value[3]?(o=this._solidBatches,r=o.get(i),C(r)||(r=new kSe(this._primitives,!1,i,this._shadows),o.set(i,r)),r.add(t,n)):(o=this._translucentBatches,r=o.get(i),C(r)||(r=new kSe(this._primitives,!0,i,this._shadows),o.set(i,r)),r.add(t,n))},USe.prototype.remove=function(e){let t;const n=this._solidBatches.values,i=n.length;for(t=0;t<i;t++)if(n[t].remove(e))return;const o=this._translucentBatches.values,r=o.length;for(t=0;t<r;t++)if(o[t].remove(e))return},USe.prototype.update=function(e){let t,n,i,o;const r=this._solidBatches.values,s=r.length,a=this._translucentBatches.values,c=a.length;let l,u=!0,h=!1;do{for(h=!1,n=0;n<s;n++){o=r[n],u=o.update(e),l=o.itemsToRemove;const s=l.length;if(s>0)for(h=!0,t=0;t<s;t++)i=l[t],o.remove(i),this.add(e,i)}for(n=0;n<c;n++){o=a[n],u=o.update(e),l=o.itemsToRemove;const r=l.length;if(r>0)for(h=!0,t=0;t<r;t++)i=l[t],o.remove(i),this.add(e,i)}}while(h);return u},USe.prototype.getBoundingSphere=function(e,t){let n;const i=this._solidBatches.values,o=i.length;for(n=0;n<o;n++){const o=i[n];if(o.contains(e))return o.getBoundingSphere(e,t)}const r=this._translucentBatches.values,s=r.length;for(n=0;n<s;n++){const i=r[n];if(i.contains(e))return i.getBoundingSphere(e,t)}return Lz.FAILED},USe.prototype.removeAllPrimitives=function(){let e;const t=this._solidBatches.values,n=t.length;for(e=0;e<n;e++)t[e].removeAllPrimitives();const i=this._translucentBatches.values,o=i.length;for(e=0;e<o;e++)i[e].removeAllPrimitives()};var VSe=USe;const HSe=new xy;function GSe(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.minimumHeights=void 0,this.maximumHeights=void 0,this.granularity=void 0}function WSe(e,t){fQ.call(this,{entity:e,scene:t,geometryOptions:new GSe(e),geometryPropertyName:"wall",observedPropertyNames:["availability","wall"]}),this._onEntityPropertyChanged(e,"wall",e.wall,void 0)}function qSe(e,t,n){vK.call(this,e,t,n)}C(Object.create)&&(WSe.prototype=Object.create(fQ.prototype),WSe.prototype.constructor=WSe),WSe.prototype.createFillGeometryInstance=function(e){if(D.defined("time",e),!this._fillEnabled)throw new x("This instance does not represent a filled geometry.");const t=this._entity,n=t.isAvailable(e);let i,o;const r=new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),s=this._distanceDisplayConditionProperty.getValue(e),a=jT.fromDistanceDisplayCondition(s);if(this._materialProperty instanceof BU){let t;C(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(t=this._materialProperty.color.getValue(e,HSe)),C(t)||(t=xy.WHITE),o=Iy.fromColor(t),i={show:r,distanceDisplayCondition:a,color:o}}else i={show:r,distanceDisplayCondition:a};return new Sm({id:t,geometry:new _F(this._options),attributes:i})},WSe.prototype.createOutlineGeometryInstance=function(e){if(D.defined("time",e),!this._outlineEnabled)throw new x("This instance does not represent an outlined geometry.");const t=this._entity,n=t.isAvailable(e),i=Bz.getValueOrDefault(this._outlineColorProperty,e,xy.BLACK,HSe),o=this._distanceDisplayConditionProperty.getValue(e);return new Sm({id:t,geometry:new wF(this._options),attributes:{show:new FM(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Iy.fromColor(i),distanceDisplayCondition:jT.fromDistanceDisplayCondition(o)}})},WSe.prototype._isHidden=function(e,t){return!C(t.positions)||fQ.prototype._isHidden.call(this,e,t)},WSe.prototype._getIsClosed=function(e){return!1},WSe.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!Bz.isConstant(t.minimumHeights)||!Bz.isConstant(t.maximumHeights)||!Bz.isConstant(t.outlineWidth)||!Bz.isConstant(t.granularity)},WSe.prototype._setStaticOptions=function(e,t){const n=t.minimumHeights,i=t.maximumHeights,o=t.granularity,r=this._materialProperty instanceof BU,s=this._options;s.vertexFormat=r?LU.VERTEX_FORMAT:SU.MaterialSupport.TEXTURED.vertexFormat,s.positions=t.positions.getValue(fO.MINIMUM_VALUE,s.positions),s.minimumHeights=C(n)?n.getValue(fO.MINIMUM_VALUE,s.minimumHeights):void 0,s.maximumHeights=C(i)?i.getValue(fO.MINIMUM_VALUE,s.maximumHeights):void 0,s.granularity=C(o)?o.getValue(fO.MINIMUM_VALUE):void 0},WSe.DynamicGeometryUpdater=qSe,C(Object.create)&&(qSe.prototype=Object.create(vK.prototype),qSe.prototype.constructor=qSe),qSe.prototype._isHidden=function(e,t,n){return!C(this._options.positions)||vK.prototype._isHidden.call(this,e,t,n)},qSe.prototype._setOptions=function(e,t,n){const i=this._options;i.positions=Bz.getValueOrUndefined(t.positions,n,i.positions),i.minimumHeights=Bz.getValueOrUndefined(t.minimumHeights,n,i.minimumHeights),i.maximumHeights=Bz.getValueOrUndefined(t.maximumHeights,n,i.maximumHeights),i.granularity=Bz.getValueOrUndefined(t.granularity,n)};var jSe=WSe;const YSe=[],KSe=[OQ,Gwe,lAe,ixe,pxe,Ixe,Uxe,qxe,tSe,jSe];function XSe(e,t){this.entity=e,this.scene=t;const n=new Array(KSe.length),i=new $n;function o(e){i.raiseEvent(e)}const r=new RC;for(let s=0;s<n.length;s++){const i=new KSe[s](e,t);r.add(i.geometryChanged,o),n[s]=i}this.updaters=n,this.geometryChanged=i,this.eventHelper=r,this._removeEntitySubscription=e.definitionChanged.addEventListener(XSe.prototype._onEntityPropertyChanged,this)}function QSe(e,t,n,i){D.defined("scene",e),D.defined("entityCollection",t),n=R(n,e.primitives),i=R(i,e.groundPrimitives),this._scene=e,this._primitives=n,this._groundPrimitives=i,this._entityCollection=void 0,this._addedObjects=new ff,this._removedObjects=new ff,this._changedObjects=new ff;const o=rj.NUMBER_OF_SHADOW_MODES;this._outlineBatches=new Array(2*o),this._closedColorBatches=new Array(2*o),this._closedMaterialBatches=new Array(2*o),this._openColorBatches=new Array(2*o),this._openMaterialBatches=new Array(2*o);const r=iQ.supportsMaterialsforEntitiesOnTerrain(e);let s;for(this._supportsMaterialsforEntitiesOnTerrain=r,s=0;s<o;++s)this._outlineBatches[s]=new VSe(n,e,s,!1),this._outlineBatches[o+s]=new VSe(n,e,s,!0),this._closedColorBatches[s]=new pSe(n,LU,void 0,!0,s,!0),this._closedColorBatches[o+s]=new pSe(n,LU,void 0,!0,s,!1),this._closedMaterialBatches[s]=new wSe(n,SU,void 0,!0,s,!0),this._closedMaterialBatches[o+s]=new wSe(n,SU,void 0,!0,s,!1),this._openColorBatches[s]=new pSe(n,LU,void 0,!1,s,!0),this._openColorBatches[o+s]=new pSe(n,LU,void 0,!1,s,!1),this._openMaterialBatches[s]=new wSe(n,SU,void 0,!1,s,!0),this._openMaterialBatches[o+s]=new wSe(n,SU,void 0,!1,s,!1);const a=rq.NUMBER_OF_CLASSIFICATION_TYPES,c=new Array(a),l=[];if(r)for(s=0;s<a;++s)l.push(new LSe(i,s,SU)),c[s]=new ISe(i,s);else for(s=0;s<a;++s)c[s]=new ISe(i,s);this._groundColorBatches=c,this._groundMaterialBatches=l,this._dynamicBatch=new XEe(n,i),this._batches=this._outlineBatches.concat(this._closedColorBatches,this._closedMaterialBatches,this._openColorBatches,this._openMaterialBatches,this._groundColorBatches,this._groundMaterialBatches,this._dynamicBatch),this._subscriptions=new ff,this._updaterSets=new ff,this._entityCollection=t,t.collectionChanged.addEventListener(QSe.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,YSe)}XSe.prototype._onEntityPropertyChanged=function(e,t,n,i){const o=this.updaters;for(let r=0;r<o.length;r++)o[r]._onEntityPropertyChanged(e,t,n,i)},XSe.prototype.forEach=function(e){const t=this.updaters;for(let n=0;n<t.length;n++)e(t[n])},XSe.prototype.destroy=function(){this.eventHelper.removeAll();const e=this.updaters;for(let t=0;t<e.length;t++)e[t].destroy();this._removeEntitySubscription(),Qh(this)},QSe.prototype.update=function(e){D.defined("time",e);const t=this._addedObjects,n=t.values,i=this._removedObjects,o=i.values,r=this._changedObjects,s=r.values;let a,c,l,u;const h=this;for(a=s.length-1;a>-1;a--)c=s[a],l=c.id,u=this._updaterSets.get(l),u.entity===c?u.forEach((function(t){h._removeUpdater(t),h._insertUpdaterIntoBatch(e,t)})):(o.push(c),n.push(c));for(a=o.length-1;a>-1;a--)c=o[a],l=c.id,u=this._updaterSets.get(l),u.forEach(this._removeUpdater.bind(this)),u.destroy(),this._updaterSets.remove(l),this._subscriptions.get(l)(),this._subscriptions.remove(l);for(a=n.length-1;a>-1;a--)c=n[a],l=c.id,u=new XSe(c,this._scene),this._updaterSets.set(l,u),u.forEach((function(t){h._insertUpdaterIntoBatch(e,t)})),this._subscriptions.set(l,u.geometryChanged.addEventListener(QSe._onGeometryChanged,this));t.removeAll(),i.removeAll(),r.removeAll();let d=!0;const f=this._batches,p=f.length;for(a=0;a<p;a++)d=f[a].update(e)&&d;return d};const JSe=[],ZSe=new nn;QSe.prototype.getBoundingSphere=function(e,t){D.defined("entity",e),D.defined("result",t);const n=JSe,i=ZSe;let o=0,r=Lz.DONE;const s=this._batches,a=s.length,c=e.id,l=this._updaterSets.get(c).updaters;for(let u=0;u<l.length;u++){const e=l[u];for(let t=0;t<a;t++){if(r=s[t].getBoundingSphere(e,i),r===Lz.PENDING)return Lz.PENDING;r===Lz.DONE&&(n[o]=nn.clone(i,n[o]),o++)}}return 0===o?Lz.FAILED:(n.length=o,nn.fromBoundingSpheres(n,t),Lz.DONE)},QSe.prototype.isDestroyed=function(){return!1},QSe.prototype.destroy=function(){let e;this._entityCollection.collectionChanged.removeEventListener(QSe.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();const t=this._batches;let n=t.length;for(e=0;e<n;e++)t[e].removeAllPrimitives();const i=this._subscriptions.values;for(n=i.length,e=0;e<n;e++)i[e]();this._subscriptions.removeAll();const o=this._updaterSets.values;for(n=o.length,e=0;e<n;e++)o[e].destroy();return this._updaterSets.removeAll(),Qh(this)},QSe.prototype._removeUpdater=function(e){const t=this._batches,n=t.length;for(let i=0;i<n;i++)t[i].remove(e)},QSe.prototype._insertUpdaterIntoBatch=function(e,t){if(t.isDynamic)return void this._dynamicBatch.add(e,t);let n;(t.outlineEnabled||t.fillEnabled)&&(n=t.shadowsProperty.getValue(e));const i=rj.NUMBER_OF_SHADOW_MODES;if(t.outlineEnabled&&(C(t.terrainOffsetProperty)?this._outlineBatches[i+n].add(e,t):this._outlineBatches[n].add(e,t)),t.fillEnabled)if(t.onTerrain){const n=t.classificationTypeProperty.getValue(e);t.fillMaterialProperty instanceof BU?this._groundColorBatches[n].add(e,t):this._groundMaterialBatches[n].add(e,t)}else t.isClosed?t.fillMaterialProperty instanceof BU?C(t.terrainOffsetProperty)?this._closedColorBatches[i+n].add(e,t):this._closedColorBatches[n].add(e,t):C(t.terrainOffsetProperty)?this._closedMaterialBatches[i+n].add(e,t):this._closedMaterialBatches[n].add(e,t):t.fillMaterialProperty instanceof BU?C(t.terrainOffsetProperty)?this._openColorBatches[i+n].add(e,t):this._openColorBatches[n].add(e,t):C(t.terrainOffsetProperty)?this._openMaterialBatches[i+n].add(e,t):this._openMaterialBatches[n].add(e,t)},QSe._onGeometryChanged=function(e){const t=this._removedObjects,n=this._changedObjects,i=e.entity,o=i.id;C(t.get(o))||C(n.get(o))||n.set(o,i)},QSe.prototype._onCollectionChanged=function(e,t,n){const i=this._addedObjects,o=this._removedObjects,r=this._changedObjects;let s,a,c;for(s=n.length-1;s>-1;s--)c=n[s],a=c.id,i.remove(a)||(o.set(a,c),r.remove(a));for(s=t.length-1;s>-1;s--)c=t[s],a=c.id,o.remove(a)?r.set(a,c):i.set(a,c)};var $Se=QSe;const eIe=1,tIe="30px sans-serif",nIe=Ise.FILL,iIe=xy.WHITE,oIe=xy.BLACK,rIe=1,sIe=!1,aIe=new xy(.165,.165,.165,.8),cIe=new ro(7,5),lIe=ro.ZERO,uIe=K.ZERO,hIe=Sz.NONE,dIe=Oz.CENTER,fIe=Pz.CENTER,pIe=new K,mIe=new xy,_Ie=new xy,gIe=new xy,yIe=new ro,vIe=new K,bIe=new ro,AIe=new LO,wIe=new LO,TIe=new LO,CIe=new WT;function EIe(e){this.entity=e,this.label=void 0,this.index=void 0}function xIe(e,t){if(!C(e))throw new x("entityCluster is required.");if(!C(t))throw new x("entityCollection is required.");t.collectionChanged.addEventListener(xIe.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new ff,this._onCollectionChanged(t,t.values,[],[])}function SIe(e,t,n){C(e)&&(e.label=void 0,n.removeLabel(t))}xIe.prototype.update=function(e){if(!C(e))throw new x("time is required.");const t=this._items.values,n=this._cluster;for(let i=0,o=t.length;i<o;i++){const o=t[i],r=o.entity,s=r._label;let a,c,l=o.label,u=r.isShowing&&r.isAvailable(e)&&Bz.getValueOrDefault(s._show,e,!0);if(u&&(c=Bz.getValueOrUndefined(r._position,e,pIe),a=Bz.getValueOrUndefined(s._text,e),u=C(c)&&C(a)),!u){SIe(o,r,n);continue}Bz.isConstant(r._position)||(n._clusterDirty=!0);let h=!1;const d=Bz.getValueOrDefault(s._heightReference,e,hIe);C(l)||(l=n.getLabel(r),l.id=r,o.label=l,h=K.equals(l.position,c)&&l.heightReference===d),l.show=!0,l.position=c,l.text=a,l.scale=Bz.getValueOrDefault(s._scale,e,eIe),l.font=Bz.getValueOrDefault(s._font,e,tIe),l.style=Bz.getValueOrDefault(s._style,e,nIe),l.fillColor=Bz.getValueOrDefault(s._fillColor,e,iIe,mIe),l.outlineColor=Bz.getValueOrDefault(s._outlineColor,e,oIe,_Ie),l.outlineWidth=Bz.getValueOrDefault(s._outlineWidth,e,rIe),l.showBackground=Bz.getValueOrDefault(s._showBackground,e,sIe),l.backgroundColor=Bz.getValueOrDefault(s._backgroundColor,e,aIe,gIe),l.backgroundPadding=Bz.getValueOrDefault(s._backgroundPadding,e,cIe,yIe),l.pixelOffset=Bz.getValueOrDefault(s._pixelOffset,e,lIe,bIe),l.eyeOffset=Bz.getValueOrDefault(s._eyeOffset,e,uIe,vIe),l.heightReference=d,l.horizontalOrigin=Bz.getValueOrDefault(s._horizontalOrigin,e,dIe),l.verticalOrigin=Bz.getValueOrDefault(s._verticalOrigin,e,fIe),l.translucencyByDistance=Bz.getValueOrUndefined(s._translucencyByDistance,e,AIe),l.pixelOffsetScaleByDistance=Bz.getValueOrUndefined(s._pixelOffsetScaleByDistance,e,wIe),l.scaleByDistance=Bz.getValueOrUndefined(s._scaleByDistance,e,TIe),l.distanceDisplayCondition=Bz.getValueOrUndefined(s._distanceDisplayCondition,e,CIe),l.disableDepthTestDistance=Bz.getValueOrUndefined(s._disableDepthTestDistance,e),h&&l._updateClamping()}return!0},xIe.prototype.getBoundingSphere=function(e,t){if(!C(e))throw new x("entity is required.");if(!C(t))throw new x("result is required.");const n=this._items.get(e.id);if(!C(n)||!C(n.label))return Lz.FAILED;const i=n.label;return t.center=K.clone(R(i._clampedPosition,i.position),t.center),t.radius=0,Lz.DONE},xIe.prototype.isDestroyed=function(){return!1},xIe.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(xIe.prototype._onCollectionChanged,this);const e=this._entityCollection.values;for(let t=0;t<e.length;t++)this._cluster.removeLabel(e[t]);return Qh(this)},xIe.prototype._onCollectionChanged=function(e,t,n,i){let o,r;const s=this._items,a=this._cluster;for(o=t.length-1;o>-1;o--)r=t[o],C(r._label)&&C(r._position)&&s.set(r.id,new EIe(r));for(o=i.length-1;o>-1;o--)r=i[o],C(r._label)&&C(r._position)?s.contains(r.id)||s.set(r.id,new EIe(r)):(SIe(s.get(r.id),r,a),s.remove(r.id));for(o=n.length-1;o>-1;o--)r=n[o],SIe(s.get(r.id),r,a),s.remove(r.id)};var IIe=xIe;const OIe=1,DIe=0,PIe=!0,RIe=!0,LIe=rj.ENABLED,MIe=Sz.NONE,BIe=xy.RED,NIe=0,FIe=xy.WHITE,zIe=y3.HIGHLIGHT,kIe=.5,UIe=new ro(1,1),VIe=new ft,HIe=new ft;function GIe(e,t){if(!C(e))throw new x("scene is required.");if(!C(t))throw new x("entityCollection is required.");t.collectionChanged.addEventListener(GIe.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._modelHash={},this._entitiesToVisualize=new ff,this._onCollectionChanged(t,t.values,[],[])}function WIe(e,t,n,i){const o=n[t.id];C(o)&&(i.removeAndDestroy(o.modelPrimitive),delete n[t.id])}function qIe(e,t){const n=t[e.id];C(n)&&(n.nodeTransformationsScratch={},n.articulationsScratch={})}function jIe(e,t,n){e.readyPromise.catch((function(e){console.error(e),n[t.id].loadFail=!0}))}GIe.prototype.update=function(e){if(!C(e))throw new x("time is required.");const t=this._entitiesToVisualize.values,n=this._modelHash,i=this._primitives;for(let o=0,r=t.length;o<r;o++){const r=t[o],s=r._model;let a,c,l=n[r.id],u=r.isShowing&&r.isAvailable(e)&&Bz.getValueOrDefault(s._show,e,!0);if(u&&(c=r.computeModelMatrix(e,VIe),a=Vi.createIfNeeded(Bz.getValueOrUndefined(s._uri,e)),u=C(c)&&C(a)),!u){C(l)&&(l.modelPrimitive.show=!1);continue}let h=C(l)?l.modelPrimitive:void 0;if(C(h)&&a.url===l.url||(C(h)&&(i.removeAndDestroy(h),delete n[r.id]),h=l8.fromGltf({url:a,incrementallyLoadTextures:Bz.getValueOrDefault(s._incrementallyLoadTextures,e,PIe),scene:this._scene}),h.id=r,i.add(h),l={modelPrimitive:h,url:a.url,animationsRunning:!1,nodeTransformationsScratch:{},articulationsScratch:{},loadFail:!1},n[r.id]=l,jIe(h,r,n)),h.show=!0,h.scale=Bz.getValueOrDefault(s._scale,e,OIe),h.minimumPixelSize=Bz.getValueOrDefault(s._minimumPixelSize,e,DIe),h.maximumScale=Bz.getValueOrUndefined(s._maximumScale,e),h.modelMatrix=ft.clone(c,h.modelMatrix),h.shadows=Bz.getValueOrDefault(s._shadows,e,LIe),h.heightReference=Bz.getValueOrDefault(s._heightReference,e,MIe),h.distanceDisplayCondition=Bz.getValueOrUndefined(s._distanceDisplayCondition,e),h.silhouetteColor=Bz.getValueOrDefault(s._silhouetteColor,e,BIe,h._silhouetteColor),h.silhouetteSize=Bz.getValueOrDefault(s._silhouetteSize,e,NIe),h.color=Bz.getValueOrDefault(s._color,e,FIe,h._color),h.colorBlendMode=Bz.getValueOrDefault(s._colorBlendMode,e,zIe),h.colorBlendAmount=Bz.getValueOrDefault(s._colorBlendAmount,e,kIe),h.clippingPlanes=Bz.getValueOrUndefined(s._clippingPlanes,e),h.clampAnimations=Bz.getValueOrDefault(s._clampAnimations,e,RIe),h.imageBasedLighting.imageBasedLightingFactor=Bz.getValueOrDefault(s._imageBasedLightingFactor,e,UIe),h.lightColor=Bz.getValueOrUndefined(s._lightColor,e),h.ready){const t=Bz.getValueOrDefault(s._runAnimations,e,!0);l.animationsRunning!==t&&(t?h.activeAnimations.addAll({loop:Y3.REPEAT}):h.activeAnimations.removeAll(),l.animationsRunning=t);const n=Bz.getValueOrUndefined(s._nodeTransformations,e,l.nodeTransformationsScratch);if(C(n)){const e=Object.keys(n);for(let t=0,i=e.length;t<i;++t){const i=e[t],o=n[i];if(!C(o))continue;const r=h.getNode(i);if(!C(r))continue;const s=ft.fromTranslationRotationScale(o,HIe);r.matrix=ft.multiply(r.originalMatrix,s,s)}}let i=!1;const o=Bz.getValueOrUndefined(s._articulations,e,l.articulationsScratch);if(C(o)){const e=Object.keys(o);for(let t=0,n=e.length;t<n;++t){const n=e[t],r=o[n];C(r)&&(i=!0,h.setArticulationStage(n,r))}}i&&h.applyArticulations()}}return!0},GIe.prototype.isDestroyed=function(){return!1},GIe.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(GIe.prototype._onCollectionChanged,this);const e=this._entitiesToVisualize.values,t=this._modelHash,n=this._primitives;for(let i=e.length-1;i>-1;i--)WIe(this,e[i],t,n);return Qh(this)},GIe.prototype.getBoundingSphere=function(e,t){if(!C(e))throw new x("entity is required.");if(!C(t))throw new x("result is required.");const n=this._modelHash[e.id];if(!C(n)||n.loadFail)return Lz.FAILED;const i=n.modelPrimitive;if(!C(i)||!i.show)return Lz.FAILED;if(!i.ready)return Lz.PENDING;if(i.heightReference===Sz.NONE)nn.transform(i.boundingSphere,i.modelMatrix,t);else{if(!C(i._clampedModelMatrix))return Lz.PENDING;nn.transform(i.boundingSphere,i._clampedModelMatrix,t)}return Lz.DONE},GIe.prototype._onCollectionChanged=function(e,t,n,i){let o,r;const s=this._entitiesToVisualize,a=this._modelHash,c=this._primitives;for(o=t.length-1;o>-1;o--)r=t[o],C(r._model)&&C(r._position)&&s.set(r.id,r);for(o=i.length-1;o>-1;o--)r=i[o],C(r._model)&&C(r._position)?(qIe(r,a),s.set(r.id,r)):(WIe(this,r,a,c),s.remove(r.id));for(o=n.length-1;o>-1;o--)r=n[o],WIe(this,r,a,c),s.remove(r.id)};var YIe=GIe;function KIe(e){this._definitionChanged=new $n,this._value=void 0,this._removeSubscription=void 0,this.setValue(e)}Object.defineProperties(KIe.prototype,{isConstant:{get:function(){return Bz.isConstant(this._value)}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return C(this._value)?this._value.referenceFrame:vL.FIXED}}}),KIe.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,vL.FIXED,t)},KIe.prototype.setValue=function(e){this._value!==e&&(this._value=e,C(this._removeSubscription)&&(this._removeSubscription(),this._removeSubscription=void 0),C(e)&&(this._removeSubscription=e.definitionChanged.addEventListener(this._raiseDefinitionChanged,this)),this._definitionChanged.raiseEvent(this))},KIe.prototype.getValueInReferenceFrame=function(e,t,n){if(!C(e))throw new x("time is required.");if(!C(t))throw new x("referenceFrame is required.");if(C(this._value))return n=this._value.getValueInReferenceFrame(e,t,n),C(n)?ge.WGS84.scaleToGeodeticSurface(n,n):void 0},KIe.prototype.equals=function(e){return this===e||e instanceof KIe&&this._value===e._value},KIe.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};var XIe=KIe;const QIe=60,JIe=1,ZIe=new cO,$Ie=new cO,eOe=new cO;function tOe(e){this.entity=e,this.polyline=void 0,this.index=void 0,this.updater=void 0}function nOe(e,t,n,i,o,r,s,a,c){let l,u=a;l=e.getValueInReferenceFrame(t,r,c[u]),C(l)&&(c[u++]=l);let h=!C(o)||Ea.lessThanOrEquals(o,t)||Ea.greaterThanOrEquals(o,n),d=0;const f=i.length;let p=i[d];const m=n;let _,g,y,v=!1;while(d<f){if(!h&&Ea.greaterThanOrEquals(p,o)&&(l=e.getValueInReferenceFrame(o,r,c[u]),C(l)&&(c[u++]=l),h=!0),Ea.greaterThan(p,t)&&Ea.lessThan(p,m)&&!p.equals(o)&&(l=e.getValueInReferenceFrame(p,r,c[u]),C(l)&&(c[u++]=l)),d<f-1){if(s>0&&!v){const e=i[d+1],t=Ea.secondsDifference(e,p);v=t>s,v&&(_=Math.ceil(t/s),g=0,y=t/Math.max(_,2),_=Math.max(_-1,1))}if(v&&g<_){p=Ea.addSeconds(p,y,new Ea),g++;continue}}v=!1,d++,p=i[d]}return l=e.getValueInReferenceFrame(n,r,c[u]),C(l)&&(c[u++]=l),u}function iOe(e,t,n,i,o,r,s,a){let c,l=0,u=s,h=t;const d=Math.max(r,60);let f=!C(i)||Ea.lessThanOrEquals(i,t)||Ea.greaterThanOrEquals(i,n);while(Ea.lessThan(h,n))!f&&Ea.greaterThanOrEquals(h,i)&&(f=!0,c=e.getValueInReferenceFrame(i,o,a[u]),C(c)&&(a[u]=c,u++)),c=e.getValueInReferenceFrame(h,o,a[u]),C(c)&&(a[u]=c,u++),l++,h=Ea.addSeconds(t,d*l,new Ea);return c=e.getValueInReferenceFrame(n,o,a[u]),C(c)&&(a[u]=c,u++),u}function oOe(e,t,n,i,o,r,s,a){eOe.start=t,eOe.stop=n;let c=s;const l=e.intervals;for(let u=0;u<l.length;u++){const t=l.get(u);if(!cO.intersect(t,eOe,ZIe).isEmpty){let n=t.start;t.isStartIncluded||(n=t.isStopIncluded?t.stop:Ea.addSeconds(t.start,Ea.secondsDifference(t.stop,t.start)/2,new Ea));const i=e.getValueInReferenceFrame(n,o,a[c]);C(i)&&(a[c]=i,c++)}}return c}function rOe(e,t,n,i,o,r,s,a){const c=e.getValueInReferenceFrame(t,o,a[s]);return C(c)&&(a[s++]=c),s}function sOe(e,t,n,i,o,r,s,a){$Ie.start=t,$Ie.stop=n;let c=s;const l=e.intervals;for(let u=0;u<l.length;u++){const e=l.get(u);if(!cO.intersect(e,$Ie,ZIe).isEmpty){const s=e.start,l=e.stop;let u=t;Ea.greaterThan(s,u)&&(u=s);let h=n;Ea.lessThan(l,h)&&(h=l),c=aOe(e.data,u,h,i,o,r,c,a)}}return c}function aOe(e,t,n,i,o,r,s,a){while(e instanceof TTe)e=e.resolvedProperty;if(e instanceof NTe){const c=e._property._times;s=nOe(e,t,n,c,i,o,r,s,a)}else s=e instanceof Zbe?sOe(e,t,n,i,o,r,s,a):e instanceof YTe?oOe(e,t,n,i,o,r,s,a):e instanceof iX||e instanceof XIe&&Bz.isConstant(e)?rOe(e,t,n,i,o,r,s,a):iOe(e,t,n,i,o,r,s,a);return s}function cOe(e,t,n,i,o,r,s){C(s)||(s=[]);const a=aOe(e,t,n,i,o,r,0,s);return s.length=a,s}const lOe=new ke;function uOe(e,t){this._unusedIndexes=[],this._polylineCollection=new bce,this._scene=e,this._referenceFrame=t,e.primitives.add(this._polylineCollection)}function hOe(e,t){if(!C(e))throw new x("scene is required.");if(!C(t))throw new x("entityCollection is required.");t.collectionChanged.addEventListener(hOe.prototype._onCollectionChanged,this),this._scene=e,this._updaters={},this._entityCollection=t,this._items=new ff,this._onCollectionChanged(t,t.values,[],[])}uOe.prototype.update=function(e){if(this._referenceFrame===vL.INERTIAL){let t=Kl.computeIcrfToFixedMatrix(e,lOe);C(t)||(t=Kl.computeTemeToPseudoFixedMatrix(e,lOe)),ft.fromRotationTranslation(t,K.ZERO,this._polylineCollection.modelMatrix)}},uOe.prototype.updateObject=function(e,t){const n=t.entity,i=n._path,o=n._position;let r,s;const a=i._show;let c=t.polyline,l=n.isShowing&&n.isAvailable(e)&&(!C(a)||a.getValue(e));if(l){const t=Bz.getValueOrUndefined(i._leadTime,e),o=Bz.getValueOrUndefined(i._trailTime,e),a=n._availability,c=C(a),u=C(t),h=C(o);if(l=c||u&&h,l){if(h&&(r=Ea.addSeconds(e,-o,new Ea)),u&&(s=Ea.addSeconds(e,t,new Ea)),c){const e=a.start,t=a.stop;h&&!Ea.greaterThan(e,r)||(r=e),u&&!Ea.lessThan(t,s)||(s=t)}l=Ea.lessThan(r,s)}}if(!l)return void(C(c)&&(this._unusedIndexes.push(t.index),t.polyline=void 0,c.show=!1,t.index=void 0));if(!C(c)){const e=this._unusedIndexes,i=e.length;if(i>0){const n=e.pop();c=this._polylineCollection.get(n),t.index=n}else t.index=this._polylineCollection.length,c=this._polylineCollection.add();c.id=n,t.polyline=c}const u=Bz.getValueOrDefault(i._resolution,e,QIe);c.show=!0,c.positions=cOe(o,r,s,e,this._referenceFrame,u,c.positions.slice()),c.material=gK.getValue(e,i._material,c.material),c.width=Bz.getValueOrDefault(i._width,e,JIe),c.distanceDisplayCondition=Bz.getValueOrUndefined(i._distanceDisplayCondition,e,c.distanceDisplayCondition)},uOe.prototype.removeObject=function(e){const t=e.polyline;C(t)&&(this._unusedIndexes.push(e.index),e.polyline=void 0,t.show=!1,t.id=void 0,e.index=void 0)},uOe.prototype.destroy=function(){return this._scene.primitives.remove(this._polylineCollection),Qh(this)},hOe.prototype.update=function(e){if(!C(e))throw new x("time is required.");const t=this._updaters;for(const i in t)t.hasOwnProperty(i)&&t[i].update(e);const n=this._items.values;if(0===n.length&&C(this._updaters)&&Object.keys(this._updaters).length>0){for(const e in t)t.hasOwnProperty(e)&&t[e].destroy();this._updaters={}}for(let i=0,o=n.length;i<o;i++){const t=n[i],o=t.entity,r=o._position,s=t.updater;let a=vL.FIXED;this._scene.mode===ij.SCENE3D&&(a=r.referenceFrame);let c=this._updaters[a];s===c&&C(c)?c.updateObject(e,t):(C(s)&&s.removeObject(t),C(c)||(c=new uOe(this._scene,a),c.update(e),this._updaters[a]=c),t.updater=c,C(c)&&c.updateObject(e,t))}return!0},hOe.prototype.isDestroyed=function(){return!1},hOe.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(hOe.prototype._onCollectionChanged,this);const e=this._updaters;for(const t in e)e.hasOwnProperty(t)&&e[t].destroy();return Qh(this)},hOe.prototype._onCollectionChanged=function(e,t,n,i){let o,r,s;const a=this._items;for(o=t.length-1;o>-1;o--)r=t[o],C(r._path)&&C(r._position)&&a.set(r.id,new tOe(r));for(o=i.length-1;o>-1;o--)r=i[o],C(r._path)&&C(r._position)?a.contains(r.id)||a.set(r.id,new tOe(r)):(s=a.get(r.id),C(s)&&(C(s.updater)&&s.updater.removeObject(s),a.remove(r.id)));for(o=n.length-1;o>-1;o--)r=n[o],s=a.get(r.id),C(s)&&(C(s.updater)&&s.updater.removeObject(s),a.remove(r.id))},hOe._subSample=cOe;var dOe=hOe;const fOe=xy.WHITE,pOe=xy.BLACK,mOe=0,_Oe=1,gOe=0,yOe=new xy,vOe=new K,bOe=new xy,AOe=new LO,wOe=new LO,TOe=new WT;function COe(e){this.entity=e,this.pointPrimitive=void 0,this.billboard=void 0,this.color=void 0,this.outlineColor=void 0,this.pixelSize=void 0,this.outlineWidth=void 0}function EOe(e,t){if(!C(e))throw new x("entityCluster is required.");if(!C(t))throw new x("entityCollection is required.");t.collectionChanged.addEventListener(EOe.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new ff,this._onCollectionChanged(t,t.values,[],[])}function xOe(e,t,n){if(C(e)){const i=e.pointPrimitive;if(C(i))return e.pointPrimitive=void 0,void n.removePoint(t);const o=e.billboard;C(o)&&(e.billboard=void 0,n.removeBillboard(t))}}EOe.prototype.update=function(e){if(!C(e))throw new x("time is required.");const t=this._items.values,n=this._cluster;for(let i=0,o=t.length;i<o;i++){const o=t[i],r=o.entity,s=r._point;let a=o.pointPrimitive,c=o.billboard;const l=Bz.getValueOrDefault(s._heightReference,e,Sz.NONE);let u,h=r.isShowing&&r.isAvailable(e)&&Bz.getValueOrDefault(s._show,e,!0);if(h&&(u=Bz.getValueOrUndefined(r._position,e,vOe),h=C(u)),!h){xOe(o,r,n);continue}Bz.isConstant(r._position)||(n._clusterDirty=!0);let d=!1,f=!1;if(l===Sz.NONE||C(c)?l!==Sz.NONE||C(a)||(C(c)&&(xOe(o,r,n),c=void 0),a=n.getPoint(r),a.id=r,o.pointPrimitive=a):(C(a)&&(xOe(o,r,n),a=void 0),c=n.getBillboard(r),c.id=r,c.image=void 0,o.billboard=c,d=!0,f=K.equals(c.position,u)&&c.heightReference===l),C(a))a.show=!0,a.position=u,a.scaleByDistance=Bz.getValueOrUndefined(s._scaleByDistance,e,AOe),a.translucencyByDistance=Bz.getValueOrUndefined(s._translucencyByDistance,e,wOe),a.color=Bz.getValueOrDefault(s._color,e,fOe,yOe),a.outlineColor=Bz.getValueOrDefault(s._outlineColor,e,pOe,bOe),a.outlineWidth=Bz.getValueOrDefault(s._outlineWidth,e,mOe),a.pixelSize=Bz.getValueOrDefault(s._pixelSize,e,_Oe),a.distanceDisplayCondition=Bz.getValueOrUndefined(s._distanceDisplayCondition,e,TOe),a.disableDepthTestDistance=Bz.getValueOrDefault(s._disableDepthTestDistance,e,gOe);else if(C(c)){c.show=!0,c.position=u,c.scaleByDistance=Bz.getValueOrUndefined(s._scaleByDistance,e,AOe),c.translucencyByDistance=Bz.getValueOrUndefined(s._translucencyByDistance,e,wOe),c.distanceDisplayCondition=Bz.getValueOrUndefined(s._distanceDisplayCondition,e,TOe),c.disableDepthTestDistance=Bz.getValueOrDefault(s._disableDepthTestDistance,e,gOe),c.heightReference=l;const t=Bz.getValueOrDefault(s._color,e,fOe,yOe),n=Bz.getValueOrDefault(s._outlineColor,e,pOe,bOe),i=Math.round(Bz.getValueOrDefault(s._outlineWidth,e,mOe));let r=Math.max(1,Math.round(Bz.getValueOrDefault(s._pixelSize,e,_Oe)));if(i>0?(c.scale=1,d=d||i!==o.outlineWidth||r!==o.pixelSize||!xy.equals(t,o.color)||!xy.equals(n,o.outlineColor)):(c.scale=r/50,r=50,d=d||i!==o.outlineWidth||!xy.equals(t,o.color)||!xy.equals(n,o.outlineColor)),d){o.color=xy.clone(t,o.color),o.outlineColor=xy.clone(n,o.outlineColor),o.pixelSize=r,o.outlineWidth=i;const e=t.alpha,s=t.toCssColorString(),a=n.toCssColorString(),l=JSON.stringify([s,r,a,i]);c.setImage(l,mse(e,s,a,i,r))}f&&c._updateClamping()}}return!0},EOe.prototype.getBoundingSphere=function(e,t){if(!C(e))throw new x("entity is required.");if(!C(t))throw new x("result is required.");const n=this._items.get(e.id);if(!C(n)||!C(n.pointPrimitive)&&!C(n.billboard))return Lz.FAILED;if(C(n.pointPrimitive))t.center=K.clone(n.pointPrimitive.position,t.center);else{const e=n.billboard;if(!C(e._clampedPosition))return Lz.PENDING;t.center=K.clone(e._clampedPosition,t.center)}return t.radius=0,Lz.DONE},EOe.prototype.isDestroyed=function(){return!1},EOe.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(EOe.prototype._onCollectionChanged,this);const e=this._entityCollection.values;for(let t=0;t<e.length;t++)this._cluster.removePoint(e[t]);return Qh(this)},EOe.prototype._onCollectionChanged=function(e,t,n,i){let o,r;const s=this._items,a=this._cluster;for(o=t.length-1;o>-1;o--)r=t[o],C(r._point)&&C(r._position)&&s.set(r.id,new COe(r));for(o=i.length-1;o>-1;o--)r=i[o],C(r._point)&&C(r._position)?s.contains(r.id)||s.set(r.id,new COe(r)):(xOe(s.get(r.id),r,a),s.remove(r.id));for(o=n.length-1;o>-1;o--)r=n[o],xOe(s.get(r.id),r,a),s.remove(r.id)};var SOe=EOe;const IOe=new vz(0),OOe={},DOe=new xy,POe=new BU(xy.WHITE),ROe=new vz(!0),LOe=new vz(rj.DISABLED),MOe=new vz(new WT),BOe=new vz(rq.BOTH);function NOe(){this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function FOe(){this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function zOe(e,t){if(!C(e))throw new x("entity is required");if(!C(t))throw new x("scene is required");this._entity=e,this._scene=t,this._entitySubscription=e.definitionChanged.addEventListener(zOe.prototype._onEntityPropertyChanged,this),this._fillEnabled=!1,this._dynamic=!1,this._geometryChanged=new $n,this._showProperty=void 0,this._materialProperty=void 0,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._depthFailMaterialProperty=void 0,this._geometryOptions=new NOe,this._groundGeometryOptions=new FOe,this._id=`polyline-${e.id}`,this._clampToGround=!1,this._supportsPolylinesOnTerrain=iQ.supportsPolylinesOnTerrain(t),this._zIndex=0,this._onEntityPropertyChanged(e,"polyline",e.polyline,void 0)}Object.defineProperties(zOe.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!C(this._entity.availability)&&Bz.isConstant(this._showProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},depthFailMaterialProperty:{get:function(){return this._depthFailMaterialProperty}},outlineEnabled:{value:!1},hasConstantOutline:{value:!0},outlineColorProperty:{value:void 0},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{value:!1},geometryChanged:{get:function(){return this._geometryChanged}},arcType:{get:function(){return this._arcType}},clampToGround:{get:function(){return this._clampToGround&&this._supportsPolylinesOnTerrain}},zIndex:{get:function(){return this._zIndex}}}),zOe.prototype.isOutlineVisible=function(e){return!1},zOe.prototype.isFilled=function(e){const t=this._entity,n=this._fillEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e);return R(n,!1)},zOe.prototype.createFillGeometryInstance=function(e){if(!C(e))throw new x("time is required.");if(!this._fillEnabled)throw new x("This instance does not represent a filled geometry.");const t=this._entity,n=t.isAvailable(e),i=new FM(n&&t.isShowing&&this._showProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),r=jT.fromDistanceDisplayCondition(o),s={show:i,distanceDisplayCondition:r};let a;return this._materialProperty instanceof BU&&(C(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(a=this._materialProperty.color.getValue(e,DOe)),C(a)||(a=xy.WHITE),s.color=Iy.fromColor(a)),this.clampToGround?new Sm({id:t,geometry:new cI(this._groundGeometryOptions),attributes:s}):(C(this._depthFailMaterialProperty)&&this._depthFailMaterialProperty instanceof BU&&(C(this._depthFailMaterialProperty.color)&&(this._depthFailMaterialProperty.color.isConstant||n)&&(a=this._depthFailMaterialProperty.color.getValue(e,DOe)),C(a)||(a=xy.WHITE),s.depthFailColor=Iy.fromColor(a)),new Sm({id:t,geometry:new EP(this._geometryOptions),attributes:s}))},zOe.prototype.createOutlineGeometryInstance=function(e){throw new x("This instance does not represent an outlined geometry.")},zOe.prototype.isDestroyed=function(){return!1},zOe.prototype.destroy=function(){this._entitySubscription(),Qh(this)},zOe.prototype._onEntityPropertyChanged=function(e,t,n,i){if("availability"!==t&&"polyline"!==t)return;const o=this._entity.polyline;if(!C(o))return void(this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this)));const r=o.positions,s=o.show;if(C(s)&&s.isConstant&&!s.getValue(fO.MINIMUM_VALUE)||!C(r))return void(this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this)));const a=o.zIndex,c=R(o.material,POe),l=c instanceof BU;this._materialProperty=c,this._depthFailMaterialProperty=o.depthFailMaterial,this._showProperty=R(s,ROe),this._shadowsProperty=R(o.shadows,LOe),this._distanceDisplayConditionProperty=R(o.distanceDisplayCondition,MOe),this._classificationTypeProperty=R(o.classificationType,BOe),this._fillEnabled=!0,this._zIndex=R(a,IOe);const u=o.width,h=o.arcType,d=o.clampToGround,f=o.granularity;if(r.isConstant&&Bz.isConstant(u)&&Bz.isConstant(h)&&Bz.isConstant(f)&&Bz.isConstant(d)&&Bz.isConstant(a)){const e=this._geometryOptions,t=r.getValue(fO.MINIMUM_VALUE,e.positions);if(!C(t)||t.length<2)return void(this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this)));let n;n=l&&(!C(this._depthFailMaterialProperty)||this._depthFailMaterialProperty instanceof BU)?OK.VERTEX_FORMAT:BK.VERTEX_FORMAT,e.vertexFormat=n,e.positions=t,e.width=C(u)?u.getValue(fO.MINIMUM_VALUE):void 0,e.arcType=C(h)?h.getValue(fO.MINIMUM_VALUE):void 0,e.granularity=C(f)?f.getValue(fO.MINIMUM_VALUE):void 0;const i=this._groundGeometryOptions;i.positions=t,i.width=e.width,i.arcType=e.arcType,i.granularity=e.granularity,this._clampToGround=!!C(d)&&d.getValue(fO.MINIMUM_VALUE),!this._clampToGround&&C(a)&&CA("Entity polylines must have clampToGround: true when using zIndex.  zIndex will be ignored."),this._dynamic=!1,this._geometryChanged.raiseEvent(this)}else this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this))},zOe.prototype.createDynamicUpdater=function(e,t){if(D.defined("primitives",e),D.defined("groundPrimitives",t),!this._dynamic)throw new x("This instance does not represent dynamic geometry.");return new UOe(e,t,this)};const kOe={positions:void 0,granularity:void 0,height:void 0,ellipsoid:void 0};function UOe(e,t,n){this._line=void 0,this._primitives=e,this._groundPrimitives=t,this._groundPolylinePrimitive=void 0,this._material=void 0,this._geometryUpdater=n,this._positions=[]}function VOe(e){if(C(e._line))return e._line;const t=e._geometryUpdater._scene.id;let n=OOe[t];const i=e._primitives;!C(n)||n.isDestroyed()?(n=new bce,OOe[t]=n,i.add(n)):i.contains(n)||i.add(n);const o=n.add();return o.id=e._geometryUpdater._entity,e._line=o,o}UOe.prototype.update=function(e){const t=this._geometryUpdater,n=t._entity,i=n.polyline,o=i.positions;let r=Bz.getValueOrUndefined(o,e,this._positions);t._clampToGround=Bz.getValueOrDefault(i._clampToGround,e,!1),t._groundGeometryOptions.positions=r,t._groundGeometryOptions.width=Bz.getValueOrDefault(i._width,e,1),t._groundGeometryOptions.arcType=Bz.getValueOrDefault(i._arcType,e,hf.GEODESIC),t._groundGeometryOptions.granularity=Bz.getValueOrDefault(i._granularity,e,9999);const s=this._groundPrimitives;if(C(this._groundPolylinePrimitive)&&(s.remove(this._groundPolylinePrimitive),this._groundPolylinePrimitive=void 0),t.clampToGround){if(!n.isShowing||!n.isAvailable(e)||!Bz.getValueOrDefault(i._show,e,!0))return;if(!C(r)||r.length<2)return;const o=t.fillMaterialProperty;let a;if(o instanceof BU)a=new OK;else{const t=gK.getValue(e,o,this._material);a=new BK({material:t,translucent:t.isTranslucent()}),this._material=t}return this._groundPolylinePrimitive=s.add(new HK({geometryInstances:t.createFillGeometryInstance(e),appearance:a,classificationType:t.classificationTypeProperty.getValue(e),asynchronous:!1}),Bz.getValueOrUndefined(t.zIndex,e)),void(C(this._line)&&(this._line.show=!1))}const a=VOe(this);if(!n.isShowing||!n.isAvailable(e)||!Bz.getValueOrDefault(i._show,e,!0))return void(a.show=!1);if(!C(r)||r.length<2)return void(a.show=!1);let c=hf.GEODESIC;c=Bz.getValueOrDefault(i._arcType,e,c);const l=t._scene.globe;c!==hf.NONE&&C(l)&&(kOe.ellipsoid=l.ellipsoid,kOe.positions=r,kOe.granularity=Bz.getValueOrUndefined(i._granularity,e),kOe.height=AA.extractHeights(r,l.ellipsoid),r=c===hf.GEODESIC?AA.generateCartesianArc(kOe):AA.generateCartesianRhumbArc(kOe)),a.show=!0,a.positions=r.slice(),a.material=gK.getValue(e,t.fillMaterialProperty,a.material),a.width=Bz.getValueOrDefault(i._width,e,1),a.distanceDisplayCondition=Bz.getValueOrUndefined(i._distanceDisplayCondition,e,a.distanceDisplayCondition)},UOe.prototype.getBoundingSphere=function(e){if(D.defined("result",e),this._geometryUpdater.clampToGround){const t=this._groundPolylinePrimitive;if(C(t)&&t.show&&t.ready){const n=t.getGeometryInstanceAttributes(this._geometryUpdater._entity);if(C(n)&&C(n.boundingSphere))return nn.clone(n.boundingSphere,e),Lz.DONE}return C(t)&&!t.ready?Lz.PENDING:Lz.DONE}{const t=VOe(this);if(t.show&&t.positions.length>0)return nn.fromPoints(t.positions,e),Lz.DONE}return Lz.FAILED},UOe.prototype.isDestroyed=function(){return!1},UOe.prototype.destroy=function(){const e=this._geometryUpdater,t=e._scene.id,n=OOe[t];C(n)&&(n.remove(this._line),0===n.length&&(this._primitives.removeAndDestroy(n),delete OOe[t])),C(this._groundPolylinePrimitive)&&this._groundPrimitives.remove(this._groundPolylinePrimitive),Qh(this)};var HOe=zOe;const GOe=new xy,WOe=new WT,qOe=new WT;function jOe(e,t,n,i,o){let r;r=n instanceof BU?OK:BK,this.orderedGroundPrimitives=e,this.classificationType=t,this.appearanceType=r,this.materialProperty=n,this.updaters=new ff,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new ff,this.material=void 0,this.updatersWithAttributes=new ff,this.attributes=new ff,this.invalidated=!1,this.removeMaterialSubscription=n.definitionChanged.addEventListener(jOe.prototype.onMaterialChanged,this),this.subscriptions=new ff,this.showsUpdated=new ff,this.zIndex=i,this._asynchronous=o}function YOe(e,t,n){this._items=[],this._orderedGroundPrimitives=e,this._classificationType=t,this._asynchronous=R(n,!0)}jOe.prototype.onMaterialChanged=function(){this.invalidated=!0},jOe.prototype.isMaterial=function(e){const t=this.materialProperty,n=e.fillMaterialProperty;return n===t||n instanceof BU&&t instanceof BU||C(t)&&t.equals(n)},jOe.prototype.add=function(e,t,n){const i=t.id;if(this.updaters.set(i,t),this.geometry.set(i,n),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&Bz.isConstant(t.distanceDisplayConditionProperty)){const e=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener((function(n,i,o,r){"isShowing"===i&&e.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(i,t);this.createPrimitive=!0},jOe.prototype.remove=function(e){const t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);const e=this.subscriptions.get(t);return C(e)&&(e(),this.subscriptions.remove(t)),!0}return!1},jOe.prototype.update=function(e){let t=!0,n=this.primitive;const i=this.orderedGroundPrimitives,o=this.geometry.values;let r;if(this.createPrimitive){const r=o.length;if(r>0)C(n)&&(C(this.oldPrimitive)?i.remove(n):this.oldPrimitive=n),n=new HK({show:!1,asynchronous:this._asynchronous,geometryInstances:o.slice(),appearance:new this.appearanceType,classificationType:this.classificationType}),this.appearanceType===BK&&(this.material=gK.getValue(e,this.materialProperty,this.material),n.appearance.material=this.material),i.add(n,this.zIndex),t=!1;else{C(n)&&(i.remove(n),n=void 0);const e=this.oldPrimitive;C(e)&&(i.remove(e),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=n,this.createPrimitive=!1}else if(C(n)&&n.ready){n.show=!0,C(this.oldPrimitive)&&(i.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.appearanceType===BK&&(this.material=gK.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material);const t=this.updatersWithAttributes.values,o=t.length;for(r=0;r<o;r++){const i=t[r],o=i.entity,s=this.geometry.get(i.id);let a=this.attributes.get(s.id.id);if(C(a)||(a=n.getGeometryInstanceAttributes(s.id),this.attributes.set(s.id.id,a)),!i.fillMaterialProperty.isConstant){const t=i.fillMaterialProperty.color,n=Bz.getValueOrDefault(t,e,xy.WHITE,GOe);xy.equals(a._lastColor,n)||(a._lastColor=xy.clone(n,a._lastColor),a.color=Iy.toValue(n,a.color))}const c=o.isShowing&&(i.hasConstantFill||i.isFilled(e)),l=1===a.show[0];c!==l&&(a.show=FM.toValue(c,a.show));const u=i.distanceDisplayConditionProperty;if(!Bz.isConstant(u)){const t=Bz.getValueOrDefault(u,e,qOe,WOe);WT.equals(t,a._lastDistanceDisplayCondition)||(a._lastDistanceDisplayCondition=WT.clone(t,a._lastDistanceDisplayCondition),a.distanceDisplayCondition=jT.toValue(t,a.distanceDisplayCondition))}}this.updateShows(n)}else C(n)&&!n.ready&&(t=!1);return t},jOe.prototype.updateShows=function(e){const t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){const n=t[i],o=n.entity,r=this.geometry.get(n.id);let s=this.attributes.get(r.id.id);C(s)||(s=e.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,s));const a=o.isShowing,c=1===s.show[0];a!==c&&(s.show=FM.toValue(a,s.show),r.attributes.show.value[0]=s.show[0])}this.showsUpdated.removeAll()},jOe.prototype.contains=function(e){return this.updaters.contains(e.id)},jOe.prototype.getBoundingSphere=function(e,t){const n=this.primitive;if(!n.ready)return Lz.PENDING;const i=n.getGeometryInstanceAttributes(e.entity);return!C(i)||!C(i.boundingSphere)||C(i.show)&&0===i.show[0]?Lz.FAILED:(i.boundingSphere.clone(t),Lz.DONE)},jOe.prototype.destroy=function(){const e=this.primitive,t=this.orderedGroundPrimitives;C(e)&&t.remove(e);const n=this.oldPrimitive;C(n)&&t.remove(n),this.removeMaterialSubscription()},YOe.prototype.add=function(e,t){const n=this._items,i=n.length,o=t.createFillGeometryInstance(e),r=Bz.getValueOrDefault(t.zIndex,0);for(let a=0;a<i;++a){const i=n[a];if(i.isMaterial(t)&&i.zIndex===r)return void i.add(e,t,o)}const s=new jOe(this._orderedGroundPrimitives,this._classificationType,t.fillMaterialProperty,r,this._asynchronous);s.add(e,t,o),n.push(s)},YOe.prototype.remove=function(e){const t=this._items,n=t.length;for(let i=n-1;i>=0;i--){const n=t[i];if(n.remove(e)){0===n.updaters.length&&(t.splice(i,1),n.destroy());break}}},YOe.prototype.update=function(e){let t;const n=this._items,i=n.length;for(t=i-1;t>=0;t--){const i=n[t];if(i.invalidated){n.splice(t,1);const o=i.updaters.values,r=o.length;for(let t=0;t<r;t++)this.add(e,o[t]);i.destroy()}}let o=!0;for(t=0;t<n.length;t++)o=n[t].update(e)&&o;return o},YOe.prototype.getBoundingSphere=function(e,t){const n=this._items,i=n.length;for(let o=0;o<i;o++){const i=n[o];if(i.contains(e))return i.getBoundingSphere(e,t)}return Lz.FAILED},YOe.prototype.removeAllPrimitives=function(){const e=this._items,t=e.length;for(let n=0;n<t;n++)e[n].destroy();this._items.length=0};var KOe=YOe;const XOe=[];function QOe(e,t){const n=e._batches,i=n.length;for(let o=0;o<i;o++)n[o].remove(t)}function JOe(e,t,n){if(n.isDynamic)return void e._dynamicBatch.add(t,n);if(n.clampToGround&&n.fillEnabled){const i=n.classificationTypeProperty.getValue(t);return void e._groundBatches[i].add(t,n)}let i;n.fillEnabled&&(i=n.shadowsProperty.getValue(t));let o,r=0;C(n.depthFailMaterialProperty)&&(r=n.depthFailMaterialProperty instanceof BU?1:2),C(i)&&(o=i+r*rj.NUMBER_OF_SHADOW_MODES),n.fillEnabled&&(n.fillMaterialProperty instanceof BU?e._colorBatches[o].add(t,n):e._materialBatches[o].add(t,n))}function ZOe(e,t,n,i){let o;D.defined("scene",e),D.defined("entityCollection",t),i=R(i,e.groundPrimitives),n=R(n,e.primitives),this._scene=e,this._primitives=n,this._entityCollection=void 0,this._addedObjects=new ff,this._removedObjects=new ff,this._changedObjects=new ff;const r=rj.NUMBER_OF_SHADOW_MODES;for(this._colorBatches=new Array(3*r),this._materialBatches=new Array(3*r),o=0;o<r;++o)this._colorBatches[o]=new pSe(n,OK,void 0,!1,o),this._materialBatches[o]=new wSe(n,BK,void 0,!1,o),this._colorBatches[o+r]=new pSe(n,OK,OK,!1,o),this._materialBatches[o+r]=new wSe(n,BK,OK,!1,o),this._colorBatches[o+2*r]=new pSe(n,OK,BK,!1,o),this._materialBatches[o+2*r]=new wSe(n,BK,BK,!1,o);this._dynamicBatch=new XEe(n,i);const s=rq.NUMBER_OF_CLASSIFICATION_TYPES;for(this._groundBatches=new Array(s),o=0;o<s;++o)this._groundBatches[o]=new KOe(i,o);this._batches=this._colorBatches.concat(this._materialBatches,this._dynamicBatch,this._groundBatches),this._subscriptions=new ff,this._updaters=new ff,this._entityCollection=t,t.collectionChanged.addEventListener(ZOe.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,XOe)}ZOe.prototype.update=function(e){D.defined("time",e);const t=this._addedObjects,n=t.values,i=this._removedObjects,o=i.values,r=this._changedObjects,s=r.values;let a,c,l,u;for(a=s.length-1;a>-1;a--)c=s[a],l=c.id,u=this._updaters.get(l),u.entity===c?(QOe(this,u),JOe(this,e,u)):(o.push(c),n.push(c));for(a=o.length-1;a>-1;a--)c=o[a],l=c.id,u=this._updaters.get(l),QOe(this,u),u.destroy(),this._updaters.remove(l),this._subscriptions.get(l)(),this._subscriptions.remove(l);for(a=n.length-1;a>-1;a--)c=n[a],l=c.id,u=new HOe(c,this._scene),this._updaters.set(l,u),JOe(this,e,u),this._subscriptions.set(l,u.geometryChanged.addEventListener(ZOe._onGeometryChanged,this));t.removeAll(),i.removeAll(),r.removeAll();let h=!0;const d=this._batches,f=d.length;for(a=0;a<f;a++)h=d[a].update(e)&&h;return h};const $Oe=[],eDe=new nn;ZOe.prototype.getBoundingSphere=function(e,t){D.defined("entity",e),D.defined("result",t);const n=$Oe,i=eDe;let o=0,r=Lz.DONE;const s=this._batches,a=s.length,c=this._updaters.get(e.id);for(let l=0;l<a;l++){if(r=s[l].getBoundingSphere(c,i),r===Lz.PENDING)return Lz.PENDING;r===Lz.DONE&&(n[o]=nn.clone(i,n[o]),o++)}return 0===o?Lz.FAILED:(n.length=o,nn.fromBoundingSpheres(n,t),Lz.DONE)},ZOe.prototype.isDestroyed=function(){return!1},ZOe.prototype.destroy=function(){let e;this._entityCollection.collectionChanged.removeEventListener(ZOe.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();const t=this._batches;let n=t.length;for(e=0;e<n;e++)t[e].removeAllPrimitives();const i=this._subscriptions.values;for(n=i.length,e=0;e<n;e++)i[e]();return this._subscriptions.removeAll(),Qh(this)},ZOe._onGeometryChanged=function(e){const t=this._removedObjects,n=this._changedObjects,i=e.entity,o=i.id;C(t.get(o))||C(n.get(o))||n.set(o,i)},ZOe.prototype._onCollectionChanged=function(e,t,n){const i=this._addedObjects,o=this._removedObjects,r=this._changedObjects;let s,a,c;for(s=n.length-1;s>-1;s--)c=n[s],a=c.id,i.remove(a)||(o.set(a,c),r.remove(a));for(s=t.length-1;s>-1;s--)c=t[s],a=c.id,o.remove(a)?r.set(a,c):i.set(a,c)};var tDe=ZOe;function nDe(e){D.typeOf.object("options",e),D.typeOf.object("options.scene",e.scene),D.typeOf.object("options.dataSourceCollection",e.dataSourceCollection),mK.initializeTerrainHeights(),HK.initializeTerrainHeights();const t=e.scene,n=e.dataSourceCollection;this._eventHelper=new RC,this._eventHelper.add(n.dataSourceAdded,this._onDataSourceAdded,this),this._eventHelper.add(n.dataSourceRemoved,this._onDataSourceRemoved,this),this._eventHelper.add(n.dataSourceMoved,this._onDataSourceMoved,this),this._eventHelper.add(t.postRender,this._postRender,this),this._dataSourceCollection=n,this._scene=t,this._visualizersCallback=R(e.visualizersCallback,nDe.defaultVisualizersCallback);let i=!1;const o=new qEe,r=new qEe;n.length>0&&(t.primitives.add(o),t.groundPrimitives.add(r),i=!0),this._primitives=o,this._groundPrimitives=r;for(let l=0,u=n.length;l<u;l++)this._onDataSourceAdded(n,n.get(l));const s=new Bwe;let a,c;if(this._onDataSourceAdded(void 0,s),this._defaultDataSource=s,!i){const e=this,i=function(){t.primitives.add(o),t.groundPrimitives.add(r),a(),c(),e._removeDefaultDataSourceListener=void 0,e._removeDataSourceCollectionListener=void 0};a=s.entities.collectionChanged.addEventListener(i),c=n.dataSourceAdded.addEventListener(i)}this._removeDefaultDataSourceListener=a,this._removeDataSourceCollectionListener=c,this._ready=!1}nDe.defaultVisualizersCallback=function(e,t,n){const i=n.entities;return[new ok(t,i),new $Se(e,i,n._primitives,n._groundPrimitives),new IIe(t,i),new YIe(e,i),new Sbe(e,i),new SOe(t,i),new dOe(e,i),new tDe(e,i,n._primitives,n._groundPrimitives)]},Object.defineProperties(nDe.prototype,{scene:{get:function(){return this._scene}},dataSources:{get:function(){return this._dataSourceCollection}},defaultDataSource:{get:function(){return this._defaultDataSource}},ready:{get:function(){return this._ready}}}),nDe.prototype.isDestroyed=function(){return!1},nDe.prototype.destroy=function(){this._eventHelper.removeAll();const e=this._dataSourceCollection;for(let t=0,n=e.length;t<n;++t)this._onDataSourceRemoved(this._dataSourceCollection,e.get(t));return this._onDataSourceRemoved(void 0,this._defaultDataSource),C(this._removeDefaultDataSourceListener)?(this._removeDefaultDataSourceListener(),this._removeDataSourceCollectionListener()):(this._scene.primitives.remove(this._primitives),this._scene.groundPrimitives.remove(this._groundPrimitives)),Qh(this)},nDe.prototype.update=function(e){if(D.defined("time",e),!bo.initialized)return this._ready=!1,!1;let t,n,i,o,r=!0;const s=this._dataSourceCollection,a=s.length;for(t=0;t<a;t++){const a=s.get(t);for(C(a.update)&&(r=a.update(e)&&r),i=a._visualizers,o=i.length,n=0;n<o;n++)r=i[n].update(e)&&r}for(i=this._defaultDataSource._visualizers,o=i.length,n=0;n<o;n++)r=i[n].update(e)&&r;return this._ready=r,r},nDe.prototype._postRender=function(){const e=this._scene.frameState,t=this._dataSourceCollection,n=t.length;for(let i=0;i<n;i++){const n=t.get(i),o=n.credit;C(o)&&e.creditDisplay.addCredit(o);const r=n._resourceCredits;if(C(r)){const t=r.length;for(let n=0;n<t;n++)e.creditDisplay.addCredit(r[n])}}};const iDe=[],oDe=new nn;nDe.prototype.getBoundingSphere=function(e,t,n){if(D.defined("entity",e),D.typeOf.bool("allowPartial",t),D.defined("result",n),!this._ready)return Lz.PENDING;let i,o,r=this._defaultDataSource;if(!r.entities.contains(e)){r=void 0;const t=this._dataSourceCollection;for(o=t.length,i=0;i<o;i++){const n=t.get(i);if(n.entities.contains(e)){r=n;break}}}if(!C(r))return Lz.FAILED;const s=iDe,a=oDe;let c=0,l=Lz.DONE;const u=r._visualizers,h=u.length;for(i=0;i<h;i++){const n=u[i];if(C(n.getBoundingSphere)){if(l=u[i].getBoundingSphere(e,a),!t&&l===Lz.PENDING)return Lz.PENDING;l===Lz.DONE&&(s[c]=nn.clone(a,s[c]),c++)}}return 0===c?Lz.FAILED:(s.length=c,nn.fromBoundingSpheres(s,n),Lz.DONE)},nDe.prototype._onDataSourceAdded=function(e,t){const n=this._scene,i=this._primitives,o=this._groundPrimitives,r=i.add(new qEe),s=o.add(new YEe);t._primitives=r,t._groundPrimitives=s;const a=t.clustering;a._initialize(n),r.add(a),t._visualizers=this._visualizersCallback(n,a,t)},nDe.prototype._onDataSourceRemoved=function(e,t){const n=this._primitives,i=this._groundPrimitives,o=t._primitives,r=t._groundPrimitives,s=t.clustering;o.remove(s);const a=t._visualizers,c=a.length;for(let l=0;l<c;l++)a[l].destroy();n.remove(o),i.remove(r),t._visualizers=void 0},nDe.prototype._onDataSourceMoved=function(e,t,n){const i=this._primitives,o=this._groundPrimitives,r=e._primitives,s=e._groundPrimitives;t===n+1?(i.raise(r),o.raise(s)):t===n-1?(i.lower(r),o.lower(s)):0===t?(i.lowerToBottom(r),o.lowerToBottom(s),i.raise(r),o.raise(s)):(i.raiseToTop(r),o.raiseToTop(s))};var rDe=nDe;const sDe=new ke,aDe=new ke,cDe=new ke,lDe=new ft,uDe=new K,hDe=new K,dDe=new K,fDe=new K,pDe=new K,mDe=new K,_De=new Ea,gDe=1.25;function yDe(e,t,n,i,o,r,s){const a=e.scene.mode;let c=o.getValue(r,e._lastCartesian);if(C(c)){let n,l,u,h,d,f,p=!1,m=!1;if(a===ij.SCENE3D){Ea.addSeconds(r,.001,_De);let e=o.getValue(_De,uDe);if(C(e)||(Ea.addSeconds(r,-.001,_De),e=o.getValue(_De,uDe),m=!0),C(e)){let t,i=Kl.computeFixedToIcrfMatrix(r,sDe),o=Kl.computeFixedToIcrfMatrix(_De,aDe);C(i)&&C(o)?t=ke.transpose(i,cDe):(t=Kl.computeTemeToPseudoFixedMatrix(r,cDe),i=ke.transpose(t,sDe),o=Kl.computeTemeToPseudoFixedMatrix(_De,aDe),ke.transpose(o,o));const a=ke.multiplyByVector(i,c,pDe),h=ke.multiplyByVector(o,e,mDe);K.subtract(a,h,fDe);const d=1e3*K.magnitude(fDe),f=z.GRAVITATIONALPARAMETER,_=-f/(d*d-2*f/K.magnitude(a));_<0||_>gDe*s.maximumRadius?(n=hDe,K.normalize(c,n),K.negate(n,n),u=K.clone(K.UNIT_Z,dDe),l=K.cross(u,n,uDe),K.magnitude(l)>z.EPSILON7&&(K.normalize(n,n),K.normalize(l,l),u=K.cross(n,l,dDe),K.normalize(u,u),p=!0)):K.equalsEpsilon(c,e,z.EPSILON7)||(u=hDe,K.normalize(a,u),K.normalize(h,h),l=K.cross(u,h,dDe),m&&(l=K.multiplyByScalar(l,-1,l)),K.equalsEpsilon(l,K.ZERO,z.EPSILON7)||(n=K.cross(l,u,uDe),ke.multiplyByVector(t,n,n),ke.multiplyByVector(t,l,l),ke.multiplyByVector(t,u,u),K.normalize(n,n),K.normalize(l,l),K.normalize(u,u),p=!0))}}C(e.boundingSphere)&&(c=e.boundingSphere.center),i&&(h=K.clone(t.position,fDe),d=K.clone(t.direction,pDe),f=K.clone(t.up,mDe));const _=lDe;p?(_[0]=n.x,_[1]=n.y,_[2]=n.z,_[3]=0,_[4]=l.x,_[5]=l.y,_[6]=l.z,_[7]=0,_[8]=u.x,_[9]=u.y,_[10]=u.z,_[11]=0,_[12]=c.x,_[13]=c.y,_[14]=c.z,_[15]=0):Kl.eastNorthUpToFixedFrame(c,s,_),t._setTransform(_),i&&(K.clone(h,t.position),K.clone(d,t.direction),K.clone(f,t.up),K.cross(d,f,t.right))}if(n){const n=a===ij.SCENE2D||K.equals(e._offset3D,K.ZERO)?void 0:e._offset3D;t.lookAtTransform(t.transform,n)}}function vDe(e,t,n){D.defined("entity",e),D.defined("scene",t),this.entity=e,this.scene=t,this.ellipsoid=R(n,ge.WGS84),this.boundingSphere=void 0,this._lastEntity=void 0,this._mode=void 0,this._lastCartesian=new K,this._defaultOffset3D=void 0,this._offset3D=new K}Object.defineProperties(vDe,{defaultOffset3D:{get:function(){return this._defaultOffset3D},set:function(e){this._defaultOffset3D=K.clone(e,new K)}}}),vDe.defaultOffset3D=new K(-14e3,3500,3500);const bDe=new uI,ADe=new K;vDe.prototype.update=function(e,t){D.defined("time",e);const n=this.scene,i=this.ellipsoid,o=n.mode;if(o===ij.MORPHING)return;const r=this.entity,s=r.position;if(!C(s))return;const a=r!==this._lastEntity,c=o!==this._mode,l=n.camera;let u=a||c,h=!0;if(a){const n=r.viewFrom,o=C(n);if(!o&&C(t)){bDe.pitch=-z.PI_OVER_FOUR,bDe.range=0;const n=s.getValue(e,ADe);if(C(n)){const e=2-1/Math.max(1,K.magnitude(n)/i.maximumRadius);bDe.pitch*=e}l.viewBoundingSphere(t,bDe),this.boundingSphere=t,u=!1,h=!1}else o&&C(n.getValue(e,this._offset3D))||K.clone(vDe._defaultOffset3D,this._offset3D)}else c||this._mode===ij.SCENE2D||K.clone(l.position,this._offset3D);this._lastEntity=r,this._mode=o,yDe(this,l,u,h,s,e,i)};var wDe=vDe;function TDe(e){return e}function CDe(e){if(null==e)return TDe;var t,n,i=e.scale[0],o=e.scale[1],r=e.translate[0],s=e.translate[1];return function(e,a){a||(t=n=0);var c=2,l=e.length,u=new Array(l);u[0]=(t+=e[0])*i+r,u[1]=(n+=e[1])*o+s;while(c<l)u[c]=e[c],++c;return u}}function EDe(e){var t,n=CDe(e.transform),i=1/0,o=i,r=-i,s=-i;function a(e){e=n(e),e[0]<i&&(i=e[0]),e[0]>r&&(r=e[0]),e[1]<o&&(o=e[1]),e[1]>s&&(s=e[1])}function c(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(c);break;case"Point":a(e.coordinates);break;case"MultiPoint":e.coordinates.forEach(a);break}}for(t in e.arcs.forEach((function(e){var t,a=-1,c=e.length;while(++a<c)t=n(e[a],a),t[0]<i&&(i=t[0]),t[0]>r&&(r=t[0]),t[1]<o&&(o=t[1]),t[1]>s&&(s=t[1])})),e.objects)c(e.objects[t]);return[i,o,r,s]}function xDe(e,t){var n,i=e.length,o=i-t;while(o<--i)n=e[o],e[o++]=e[i],e[i]=n}function SDe(e,t){return"string"===typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return IDe(e,t)}))}:IDe(e,t)}function IDe(e,t){var n=t.id,i=t.bbox,o=null==t.properties?{}:t.properties,r=ODe(e,t);return null==n&&null==i?{type:"Feature",properties:o,geometry:r}:null==i?{type:"Feature",id:n,properties:o,geometry:r}:{type:"Feature",id:n,bbox:i,properties:o,geometry:r}}function ODe(e,t){var n=CDe(e.transform),i=e.arcs;function o(e,t){t.length&&t.pop();for(var o=i[e<0?~e:e],r=0,s=o.length;r<s;++r)t.push(n(o[r],r));e<0&&xDe(t,s)}function r(e){return n(e)}function s(e){for(var t=[],n=0,i=e.length;n<i;++n)o(e[n],t);return t.length<2&&t.push(t[0]),t}function a(e){var t=s(e);while(t.length<4)t.push(t[0]);return t}function c(e){return e.map(a)}function l(e){var t,n=e.type;switch(n){case"GeometryCollection":return{type:n,geometries:e.geometries.map(l)};case"Point":t=r(e.coordinates);break;case"MultiPoint":t=e.coordinates.map(r);break;case"LineString":t=s(e.arcs);break;case"MultiLineString":t=e.arcs.map(s);break;case"Polygon":t=c(e.arcs);break;case"MultiPolygon":t=e.arcs.map(c);break;default:return null}return{type:n,coordinates:t}}return l(t)}function DDe(e,t){var n={},i={},o={},r=[],s=-1;function a(t){var n,i=e.arcs[t<0?~t:t],o=i[0];return e.transform?(n=[0,0],i.forEach((function(e){n[0]+=e[0],n[1]+=e[1]}))):n=i[i.length-1],t<0?[n,o]:[o,n]}function c(e,t){for(var i in e){var o=e[i];delete t[o.start],delete o.start,delete o.end,o.forEach((function(e){n[e<0?~e:e]=1})),r.push(o)}}return t.forEach((function(n,i){var o,r=e.arcs[n<0?~n:n];r.length<3&&!r[1][0]&&!r[1][1]&&(o=t[++s],t[s]=n,t[i]=o)})),t.forEach((function(e){var t,n,r=a(e),s=r[0],c=r[1];if(t=o[s])if(delete o[t.end],t.push(e),t.end=c,n=i[c]){delete i[n.start];var l=n===t?t:t.concat(n);i[l.start=t.start]=o[l.end=n.end]=l}else i[t.start]=o[t.end]=t;else if(t=i[c])if(delete i[t.start],t.unshift(e),t.start=s,n=o[s]){delete o[n.end];var u=n===t?t:n.concat(t);i[u.start=n.start]=o[u.end=t.end]=u}else i[t.start]=o[t.end]=t;else t=[e],i[t.start=s]=o[t.end=c]=t})),c(o,i),c(i,o),t.forEach((function(e){n[e<0?~e:e]||r.push([e])})),r}function PDe(e){return ODe(e,RDe.apply(this,arguments))}function RDe(e,t,n){var i,o,r;if(arguments.length>1)i=LDe(e,t,n);else for(o=0,i=new Array(r=e.arcs.length);o<r;++o)i[o]=o;return{type:"MultiLineString",arcs:DDe(e,i)}}function LDe(e,t,n){var i,o=[],r=[];function s(e){var t=e<0?~e:e;(r[t]||(r[t]=[])).push({i:e,g:i})}function a(e){e.forEach(s)}function c(e){e.forEach(a)}function l(e){e.forEach(c)}function u(e){switch(i=e,e.type){case"GeometryCollection":e.geometries.forEach(u);break;case"LineString":a(e.arcs);break;case"MultiLineString":case"Polygon":c(e.arcs);break;case"MultiPolygon":l(e.arcs);break}}return u(t),r.forEach(null==n?function(e){o.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&o.push(e[0].i)}),o}function MDe(e){var t,n=-1,i=e.length,o=e[i-1],r=0;while(++n<i)t=o,o=e[n],r+=t[0]*o[1]-t[1]*o[0];return Math.abs(r)}function BDe(e){return ODe(e,NDe.apply(this,arguments))}function NDe(e,t){var n={},i=[],o=[];function r(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(r);break;case"Polygon":s(e.arcs);break;case"MultiPolygon":e.arcs.forEach(s);break}}function s(e){e.forEach((function(t){t.forEach((function(t){(n[t=t<0?~t:t]||(n[t]=[])).push(e)}))})),i.push(e)}function a(t){return MDe(ODe(e,{type:"Polygon",arcs:[t]}).coordinates[0])}return t.forEach(r),i.forEach((function(e){if(!e._){var t=[],i=[e];e._=1,o.push(t);while(e=i.pop())t.push(e),e.forEach((function(e){e.forEach((function(e){n[e<0?~e:e].forEach((function(e){e._||(e._=1,i.push(e))}))}))}))}})),i.forEach((function(e){delete e._})),{type:"MultiPolygon",arcs:o.map((function(t){var i,o=[];if(t.forEach((function(e){e.forEach((function(e){e.forEach((function(e){n[e<0?~e:e].length<2&&o.push(e)}))}))})),o=DDe(e,o),(i=o.length)>1)for(var r,s,c=1,l=a(o[0]);c<i;++c)(r=a(o[c]))>l&&(s=o[0],o[0]=o[c],o[c]=s,l=r);return o})).filter((function(e){return e.length>0}))}}function FDe(e,t){var n=0,i=e.length;while(n<i){var o=n+i>>>1;e[o]<t?n=o+1:i=o}return n}function zDe(e){var t={},n=e.map((function(){return[]}));function i(e,n){e.forEach((function(e){e<0&&(e=~e);var i=t[e];i?i.push(n):t[e]=[n]}))}function o(e,t){e.forEach((function(e){i(e,t)}))}function r(e,t){"GeometryCollection"===e.type?e.geometries.forEach((function(e){r(e,t)})):e.type in s&&s[e.type](e.arcs,t)}var s={LineString:i,MultiLineString:o,Polygon:o,MultiPolygon:function(e,t){e.forEach((function(e){o(e,t)}))}};for(var a in e.forEach(r),t)for(var c=t[a],l=c.length,u=0;u<l;++u)for(var h=u+1;h<l;++h){var d,f=c[u],p=c[h];(d=n[f])[a=FDe(d,p)]!==p&&d.splice(a,0,p),(d=n[p])[a=FDe(d,f)]!==f&&d.splice(a,0,f)}return n}function kDe(e){if(null==e)return TDe;var t,n,i=e.scale[0],o=e.scale[1],r=e.translate[0],s=e.translate[1];return function(e,a){a||(t=n=0);var c=2,l=e.length,u=new Array(l),h=Math.round((e[0]-r)/i),d=Math.round((e[1]-s)/o);u[0]=h-t,t=h,u[1]=d-n,n=d;while(c<l)u[c]=e[c],++c;return u}}function UDe(e,t){if(e.transform)throw new Error("already quantized");if(t&&t.scale)a=e.bbox;else{if(!((n=Math.floor(t))>=2))throw new Error("n must be ≥2");a=e.bbox||EDe(e);var n,i=a[0],o=a[1],r=a[2],s=a[3];t={scale:[r-i?(r-i)/(n-1):1,s-o?(s-o)/(n-1):1],translate:[i,o]}}var a,c,l=kDe(t),u=e.objects,h={};function d(e){return l(e)}function f(e){var t;switch(e.type){case"GeometryCollection":t={type:"GeometryCollection",geometries:e.geometries.map(f)};break;case"Point":t={type:"Point",coordinates:d(e.coordinates)};break;case"MultiPoint":t={type:"MultiPoint",coordinates:e.coordinates.map(d)};break;default:return e}return null!=e.id&&(t.id=e.id),null!=e.bbox&&(t.bbox=e.bbox),null!=e.properties&&(t.properties=e.properties),t}function p(e){var t,n=0,i=1,o=e.length,r=new Array(o);r[0]=l(e[0],0);while(++n<o)((t=l(e[n],n))[0]||t[1])&&(r[i++]=t);return 1===i&&(r[i++]=[0,0]),r.length=i,r}for(c in u)h[c]=f(u[c]);return{type:"Topology",bbox:a,transform:t,objects:h,arcs:e.arcs.map(p)}}var VDe=Object.freeze({__proto__:null,bbox:EDe,feature:SDe,mesh:PDe,meshArcs:RDe,merge:BDe,mergeArcs:NDe,neighbors:zDe,quantize:UDe,transform:CDe,untransform:kDe});function HDe(e){return K.fromDegrees(e[0],e[1],e[2])}const GDe={"urn:ogc:def:crs:OGC:1.3:CRS84":HDe,"EPSG:4326":HDe,"urn:ogc:def:crs:EPSG::4326":HDe},WDe={},qDe={};let jDe,YDe=48,KDe=xy.ROYALBLUE,XDe=xy.YELLOW,QDe=2,JDe=xy.fromBytes(255,255,0,100),ZDe=!1;const $De={small:24,medium:48,large:64},ePe=["title","description","marker-size","marker-symbol","marker-color","stroke","stroke-opacity","stroke-width","fill","fill-opacity"];function tPe(e,t){let n="";for(const i in e)if(e.hasOwnProperty(i)){if(i===t||-1!==ePe.indexOf(i))continue;const o=e[i];C(o)&&(n+="object"===typeof o?`<tr><th>${i}</th><td>${tPe(o)}</td></tr>`:`<tr><th>${i}</th><td>${o}</td></tr>`)}return n.length>0&&(n=`<table class="cesium-infoBox-defaultTable"><tbody>${n}</tbody></table>`),n}function nPe(e,t,n){let i;return function(o,r){return C(i)||(i=e(t,n)),i}}function iPe(e,t){return new mQ(nPe(tPe,e,t),!0)}function oPe(e,t,n){let i=e.id;if(C(i)&&"Feature"===e.type){let e=2,n=i;while(C(t.getById(n)))n=`${i}_${e}`,e++;i=n}else i=wk();const o=t.getOrCreateEntity(i),r=e.properties;if(C(r)){let e;o.properties=r;const t=r.title;if(C(t))o.name=t,e="title";else{let t=Number.MAX_VALUE;for(const n in r)if(r.hasOwnProperty(n)&&r[n]){const i=n.toLowerCase();if(t>1&&"title"===i){t=1,e=n;break}t>2&&"name"===i?(t=2,e=n):t>3&&/title/i.test(n)?(t=3,e=n):t>4&&/name/i.test(n)&&(t=4,e=n)}C(e)&&(o.name=r[e])}const i=r.description;null!==i&&(o.description=C(i)?new vz(i):n(r,e))}return o}function rPe(e,t){const n=new Array(e.length);for(let i=0;i<e.length;i++)n[i]=t(e[i]);return n}const sPe={Feature:cPe,FeatureCollection:lPe,GeometryCollection:uPe,LineString:mPe,MultiLineString:_Pe,MultiPoint:fPe,MultiPolygon:vPe,Point:dPe,Polygon:yPe,Topology:bPe},aPe={GeometryCollection:uPe,LineString:mPe,MultiLineString:_Pe,MultiPoint:fPe,MultiPolygon:vPe,Point:dPe,Polygon:yPe,Topology:bPe};function cPe(e,t,n,i,o){if(null===t.geometry)return void oPe(t,e._entityCollection,o.describe);if(!C(t.geometry))throw new Je("feature.geometry is required.");const r=t.geometry.type,s=aPe[r];if(!C(s))throw new Je(`Unknown geometry type: ${r}`);s(e,t,t.geometry,i,o)}function lPe(e,t,n,i,o){const r=t.features;for(let s=0,a=r.length;s<a;s++)cPe(e,r[s],void 0,i,o)}function uPe(e,t,n,i,o){const r=n.geometries;for(let s=0,a=r.length;s<a;s++){const n=r[s],a=n.type,c=aPe[a];if(!C(c))throw new Je(`Unknown geometry type: ${a}`);c(e,t,n,i,o)}}function hPe(e,t,n,i,o){let r=o.markerSymbol,s=o.markerColor,a=o.markerSize;const c=t.properties;if(C(c)){const e=c["marker-color"];C(e)&&(s=xy.fromCssColorString(e)),a=R($De[c["marker-size"]],a);const t=c["marker-symbol"];C(t)&&(r=t)}let l;l=C(r)?1===r.length?e._pinBuilder.fromText(r.toUpperCase(),s,a):e._pinBuilder.fromMakiIconId(r,s,a):e._pinBuilder.fromColor(s,a);const u=new Ez;u.verticalOrigin=new vz(Pz.BOTTOM),2===i.length&&o.clampToGround&&(u.heightReference=Sz.CLAMP_TO_GROUND);const h=oPe(t,e._entityCollection,o.describe);h.billboard=u,h.position=new iX(n(i));const d=Promise.resolve(l).then((function(e){u.image=new vz(e)})).catch((function(){u.image=new vz(e._pinBuilder.fromColor(s,a))}));e._promises.push(d)}function dPe(e,t,n,i,o){hPe(e,t,i,n.coordinates,o)}function fPe(e,t,n,i,o){const r=n.coordinates;for(let s=0;s<r.length;s++)hPe(e,t,i,r[s],o)}function pPe(e,t,n,i,o){let r=o.strokeMaterialProperty,s=o.strokeWidthProperty;const a=t.properties;if(C(a)){const e=a["stroke-width"];let t;C(e)&&(s=new vz(e));const n=a.stroke;C(n)&&(t=xy.fromCssColorString(n));const i=a["stroke-opacity"];C(i)&&1!==i&&(C(t)||(t=r.color.getValue().clone()),t.alpha=i),C(t)&&(r=new BU(t))}const c=oPe(t,e._entityCollection,o.describe),l=new VX;c.polyline=l,l.clampToGround=o.clampToGround,l.material=r,l.width=s,l.positions=new vz(rPe(i,n)),l.arcType=hf.RHUMB}function mPe(e,t,n,i,o){pPe(e,t,i,n.coordinates,o)}function _Pe(e,t,n,i,o){const r=n.coordinates;for(let s=0;s<r.length;s++)pPe(e,t,i,r[s],o)}function gPe(e,t,n,i,o){if(0===i.length||0===i[0].length)return;let r=o.strokeMaterialProperty.color,s=o.fillMaterialProperty,a=o.strokeWidthProperty;const c=t.properties;if(C(c)){const e=c["stroke-width"];let t;C(e)&&(a=new vz(e));const n=c.stroke;C(n)&&(t=xy.fromCssColorString(n));let i,o=c["stroke-opacity"];C(o)&&1!==o&&(C(t)||(t=r.getValue().clone()),t.alpha=o),C(t)&&(r=new vz(t));const l=c.fill,u=s.color.getValue();C(l)&&(i=xy.fromCssColorString(l),i.alpha=u.alpha),o=c["fill-opacity"],C(o)&&o!==u.alpha&&(C(i)||(i=u.clone()),i.alpha=o),C(i)&&(s=new BU(i))}const l=new kX;l.outline=new vz(!0),l.outlineColor=r,l.outlineWidth=a,l.material=s,l.arcType=hf.RHUMB;const u=[];for(let f=1,p=i.length;f<p;f++)u.push(new sP(rPe(i[f],n)));const h=i[0];l.hierarchy=new vz(new sP(rPe(h,n),u)),h[0].length>2?l.perPositionHeight=new vz(!0):o.clampToGround||(l.height=0);const d=oPe(t,e._entityCollection,o.describe);d.polygon=l}function yPe(e,t,n,i,o){gPe(e,t,i,n.coordinates,o)}function vPe(e,t,n,i,o){const r=n.coordinates;for(let s=0;s<r.length;s++)gPe(e,t,i,r[s],o)}function bPe(e,t,n,i,o){for(const r in n.objects)if(n.objects.hasOwnProperty(r)){const t=VDe.feature(n,n.objects[r]),s=sPe[t.type];s(e,t,t,i,o)}}function APe(e){this._name=e,this._changed=new $n,this._error=new $n,this._isLoading=!1,this._loading=new $n,this._entityCollection=new Nbe(this),this._promises=[],this._pinBuilder=new lD,this._entityCluster=new Lwe,this._credit=void 0,this._resourceCredits=[]}function wPe(e,t,n,i){let o;C(i)&&(o=HF(i)),C(o)&&e._name!==o&&(e._name=o,e._changed.raiseEvent(e));const r=sPe[t.type];if(!C(r))throw new Je(`Unsupported GeoJSON object type: ${t.type}`);const s=t.crs;let a=null!==s?HDe:null;if(C(s)){if(!C(s.properties))throw new Je("crs.properties is undefined.");const e=s.properties;if("name"===s.type){if(a=GDe[e.name],!C(a))throw new Je(`Unknown crs name: ${e.name}`)}else if("link"===s.type){let t=WDe[e.href];if(C(t)||(t=qDe[e.type]),!C(t))throw new Je(`Unable to resolve crs link: ${JSON.stringify(e)}`);a=t(e)}else{if("EPSG"!==s.type)throw new Je(`Unknown crs type: ${s.type}`);if(a=GDe[`EPSG:${e.code}`],!C(a))throw new Je(`Unknown crs EPSG code: ${e.code}`)}}return Promise.resolve(a).then((function(i){return e._entityCollection.removeAll(),null!==i&&r(e,t,t,i,n),Promise.all(e._promises).then((function(){return e._promises.length=0,hAe.setLoading(e,!1),e}))}))}APe.load=function(e,t){return(new APe).load(e,t)},Object.defineProperties(APe,{markerSize:{get:function(){return YDe},set:function(e){YDe=e}},markerSymbol:{get:function(){return jDe},set:function(e){jDe=e}},markerColor:{get:function(){return KDe},set:function(e){KDe=e}},stroke:{get:function(){return XDe},set:function(e){XDe=e}},strokeWidth:{get:function(){return QDe},set:function(e){QDe=e}},fill:{get:function(){return JDe},set:function(e){JDe=e}},clampToGround:{get:function(){return ZDe},set:function(e){ZDe=e}},crsNames:{get:function(){return GDe}},crsLinkHrefs:{get:function(){return WDe}},crsLinkTypes:{get:function(){return qDe}}}),Object.defineProperties(APe.prototype,{name:{get:function(){return this._name},set:function(e){this._name!==e&&(this._name=e,this._changed.raiseEvent(this))}},clock:{value:void 0,writable:!1},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(e){this._entityCollection.show=e}},clustering:{get:function(){return this._entityCluster},set:function(e){if(!C(e))throw new x("value must be defined.");this._entityCluster=e}},credit:{get:function(){return this._credit}}}),APe.prototype.load=function(e,t){if(!C(e))throw new x("data is required.");hAe.setLoading(this,!0),t=R(t,R.EMPTY_OBJECT);let n=t.credit;"string"===typeof n&&(n=new Tr(n)),this._credit=n;let i=e,o=t.sourceUri;if("string"===typeof e||e instanceof Vi){e=Vi.createIfNeeded(e),i=e.fetchJson(),o=R(o,e.getUrlComponent());const t=this._resourceCredits,n=e.credits;if(C(n)){const e=n.length;for(let i=0;i<e;i++)t.push(n[i])}}t={describe:R(t.describe,iPe),markerSize:R(t.markerSize,YDe),markerSymbol:R(t.markerSymbol,jDe),markerColor:R(t.markerColor,KDe),strokeWidthProperty:new vz(R(t.strokeWidth,QDe)),strokeMaterialProperty:new BU(R(t.stroke,XDe)),fillMaterialProperty:new BU(R(t.fill,JDe)),clampToGround:R(t.clampToGround,ZDe)};const r=this;return Promise.resolve(i).then((function(e){return wPe(r,e,t,o)})).catch((function(e){return hAe.setLoading(r,!1),r._error.raiseEvent(r,e),console.log(e),Promise.reject(e)}))},APe.prototype.update=function(e){return!0};var TPe=APe;function CPe(e,t){for(var n in t)t.hasOwnProperty(n)&&void 0===e[n]&&(e[n]=t[n]);return e}function EPe(e,t,n){var i;return e.length>t&&(null==n?(n="&hellip;",i=3):i=n.length,e=e.substring(0,t-i)+n),e}function xPe(e,t){if(Array.prototype.indexOf)return e.indexOf(t);for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function SPe(e,t){for(var n=e.length-1;n>=0;n--)!0===t(e[n])&&e.splice(n,1)}function IPe(e,t){if(!t.global)throw new Error("`splitRegex` must have the 'g' flag set");var n,i=[],o=0;while(n=t.exec(e))i.push(e.substring(o,n.index)),i.push(n[0]),o=n.index+n[0].length;return i.push(e.substring(o)),i}function OPe(e){throw new Error("Unhandled case for value: '".concat(e,"'"))}var DPe=function(){function e(e){void 0===e&&(e={}),this.tagName="",this.attrs={},this.innerHTML="",this.whitespaceRegex=/\s+/,this.tagName=e.tagName||"",this.attrs=e.attrs||{},this.innerHTML=e.innerHtml||e.innerHTML||""}return e.prototype.setTagName=function(e){return this.tagName=e,this},e.prototype.getTagName=function(){return this.tagName||""},e.prototype.setAttr=function(e,t){var n=this.getAttrs();return n[e]=t,this},e.prototype.getAttr=function(e){return this.getAttrs()[e]},e.prototype.setAttrs=function(e){return Object.assign(this.getAttrs(),e),this},e.prototype.getAttrs=function(){return this.attrs||(this.attrs={})},e.prototype.setClass=function(e){return this.setAttr("class",e)},e.prototype.addClass=function(e){var t,n=this.getClass(),i=this.whitespaceRegex,o=n?n.split(i):[],r=e.split(i);while(t=r.shift())-1===xPe(o,t)&&o.push(t);return this.getAttrs()["class"]=o.join(" "),this},e.prototype.removeClass=function(e){var t,n=this.getClass(),i=this.whitespaceRegex,o=n?n.split(i):[],r=e.split(i);while(o.length&&(t=r.shift())){var s=xPe(o,t);-1!==s&&o.splice(s,1)}return this.getAttrs()["class"]=o.join(" "),this},e.prototype.getClass=function(){return this.getAttrs()["class"]||""},e.prototype.hasClass=function(e){return-1!==(" "+this.getClass()+" ").indexOf(" "+e+" ")},e.prototype.setInnerHTML=function(e){return this.innerHTML=e,this},e.prototype.setInnerHtml=function(e){return this.setInnerHTML(e)},e.prototype.getInnerHTML=function(){return this.innerHTML||""},e.prototype.getInnerHtml=function(){return this.getInnerHTML()},e.prototype.toAnchorString=function(){var e=this.getTagName(),t=this.buildAttrsStr();return t=t?" "+t:"",["<",e,t,">",this.getInnerHtml(),"</",e,">"].join("")},e.prototype.buildAttrsStr=function(){if(!this.attrs)return"";var e=this.getAttrs(),t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+'="'+e[n]+'"');return t.join(" ")},e}();function PPe(e,t,n){var i,o;null==n?(n="&hellip;",o=3,i=8):(o=n.length,i=n.length);var r=function(e){var t={},n=e,i=n.match(/^([a-z]+):\/\//i);return i&&(t.scheme=i[1],n=n.substr(i[0].length)),i=n.match(/^(.*?)(?=(\?|#|\/|$))/i),i&&(t.host=i[1],n=n.substr(i[0].length)),i=n.match(/^\/(.*?)(?=(\?|#|$))/i),i&&(t.path=i[1],n=n.substr(i[0].length)),i=n.match(/^\?(.*?)(?=(#|$))/i),i&&(t.query=i[1],n=n.substr(i[0].length)),i=n.match(/^#(.*?)$/i),i&&(t.fragment=i[1]),t},s=function(e){var t="";return e.scheme&&e.host&&(t+=e.scheme+"://"),e.host&&(t+=e.host),e.path&&(t+="/"+e.path),e.query&&(t+="?"+e.query),e.fragment&&(t+="#"+e.fragment),t},a=function(e,t){var i=t/2,o=Math.ceil(i),r=-1*Math.floor(i),s="";return r<0&&(s=e.substr(r)),e.substr(0,o)+n+s};if(e.length<=t)return e;var c=t-o,l=r(e);if(l.query){var u=l.query.match(/^(.*?)(?=(\?|\#))(.*?)$/i);u&&(l.query=l.query.substr(0,u[1].length),e=s(l))}if(e.length<=t)return e;if(l.host&&(l.host=l.host.replace(/^www\./,""),e=s(l)),e.length<=t)return e;var h="";if(l.host&&(h+=l.host),h.length>=c)return l.host.length==t?(l.host.substr(0,t-o)+n).substr(0,c+i):a(h,c).substr(0,c+i);var d="";if(l.path&&(d+="/"+l.path),l.query&&(d+="?"+l.query),d){if((h+d).length>=c){if((h+d).length==t)return(h+d).substr(0,t);var f=c-h.length;return(h+a(d,f)).substr(0,c+i)}h+=d}if(l.fragment){var p="#"+l.fragment;if((h+p).length>=c){if((h+p).length==t)return(h+p).substr(0,t);var m=c-h.length;return(h+a(p,m)).substr(0,c+i)}h+=p}if(l.scheme&&l.host){var _=l.scheme+"://";if((h+_).length<c)return(_+h).substr(0,t)}if(h.length<=t)return h;var g="";return c>0&&(g=h.substr(-1*Math.floor(c/2))),(h.substr(0,Math.ceil(c/2))+n+g).substr(0,c+i)}function RPe(e,t,n){if(e.length<=t)return e;var i,o;null==n?(n="&hellip;",i=8,o=3):(i=n.length,o=n.length);var r=t-o,s="";return r>0&&(s=e.substr(-1*Math.floor(r/2))),(e.substr(0,Math.ceil(r/2))+n+s).substr(0,r+i)}function LPe(e,t,n){return EPe(e,t,n)}var MPe=function(){function e(e){void 0===e&&(e={}),this.newWindow=!1,this.truncate={},this.className="",this.newWindow=e.newWindow||!1,this.truncate=e.truncate||{},this.className=e.className||""}return e.prototype.build=function(e){return new DPe({tagName:"a",attrs:this.createAttrs(e),innerHtml:this.processAnchorText(e.getAnchorText())})},e.prototype.createAttrs=function(e){var t={href:e.getAnchorHref()},n=this.createCssClass(e);return n&&(t["class"]=n),this.newWindow&&(t["target"]="_blank",t["rel"]="noopener noreferrer"),this.truncate&&this.truncate.length&&this.truncate.length<e.getAnchorText().length&&(t["title"]=e.getAnchorHref()),t},e.prototype.createCssClass=function(e){var t=this.className;if(t){for(var n=[t],i=e.getCssClassSuffixes(),o=0,r=i.length;o<r;o++)n.push(t+"-"+i[o]);return n.join(" ")}return""},e.prototype.processAnchorText=function(e){return e=this.doTruncate(e),e},e.prototype.doTruncate=function(e){var t=this.truncate;if(!t||!t.length)return e;var n=t.length,i=t.location;return"smart"===i?PPe(e,n):"middle"===i?RPe(e,n):LPe(e,n)},e}(),BPe=function(){function e(e){this.__jsduckDummyDocProp=null,this.matchedText="",this.offset=0,this.tagBuilder=e.tagBuilder,this.matchedText=e.matchedText,this.offset=e.offset}return e.prototype.getMatchedText=function(){return this.matchedText},e.prototype.setOffset=function(e){this.offset=e},e.prototype.getOffset=function(){return this.offset},e.prototype.getCssClassSuffixes=function(){return[this.getType()]},e.prototype.buildTag=function(){return this.tagBuilder.build(this)},e}(),NPe=function(e,t){return NPe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},NPe(e,t)};function FPe(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}NPe(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var zPe=function(){return zPe=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},zPe.apply(this,arguments)},kPe=function(e){function t(t){var n=e.call(this,t)||this;return n.email="",n.email=t.email,n}return FPe(t,e),t.prototype.getType=function(){return"email"},t.prototype.getEmail=function(){return this.email},t.prototype.getAnchorHref=function(){return"mailto:"+this.email},t.prototype.getAnchorText=function(){return this.email},t}(BPe),UPe=function(e){function t(t){var n=e.call(this,t)||this;return n.serviceName="",n.hashtag="",n.serviceName=t.serviceName,n.hashtag=t.hashtag,n}return FPe(t,e),t.prototype.getType=function(){return"hashtag"},t.prototype.getServiceName=function(){return this.serviceName},t.prototype.getHashtag=function(){return this.hashtag},t.prototype.getAnchorHref=function(){var e=this.serviceName,t=this.hashtag;switch(e){case"twitter":return"https://twitter.com/hashtag/"+t;case"facebook":return"https://www.facebook.com/hashtag/"+t;case"instagram":return"https://instagram.com/explore/tags/"+t;case"tiktok":return"https://www.tiktok.com/tag/"+t;default:throw new Error("Unknown service name to point hashtag to: "+e)}},t.prototype.getAnchorText=function(){return"#"+this.hashtag},t}(BPe),VPe=function(e){function t(t){var n=e.call(this,t)||this;return n.serviceName="twitter",n.mention="",n.mention=t.mention,n.serviceName=t.serviceName,n}return FPe(t,e),t.prototype.getType=function(){return"mention"},t.prototype.getMention=function(){return this.mention},t.prototype.getServiceName=function(){return this.serviceName},t.prototype.getAnchorHref=function(){switch(this.serviceName){case"twitter":return"https://twitter.com/"+this.mention;case"instagram":return"https://instagram.com/"+this.mention;case"soundcloud":return"https://soundcloud.com/"+this.mention;case"tiktok":return"https://www.tiktok.com/@"+this.mention;default:throw new Error("Unknown service name to point mention to: "+this.serviceName)}},t.prototype.getAnchorText=function(){return"@"+this.mention},t.prototype.getCssClassSuffixes=function(){var t=e.prototype.getCssClassSuffixes.call(this),n=this.getServiceName();return n&&t.push(n),t},t}(BPe),HPe=function(e){function t(t){var n=e.call(this,t)||this;return n.number="",n.plusSign=!1,n.number=t.number,n.plusSign=t.plusSign,n}return FPe(t,e),t.prototype.getType=function(){return"phone"},t.prototype.getPhoneNumber=function(){return this.number},t.prototype.getNumber=function(){return this.getPhoneNumber()},t.prototype.getAnchorHref=function(){return"tel:"+(this.plusSign?"+":"")+this.number},t.prototype.getAnchorText=function(){return this.matchedText},t}(BPe),GPe=function(e){function t(t){var n=e.call(this,t)||this;return n.url="",n.urlMatchType="scheme",n.protocolUrlMatch=!1,n.protocolRelativeMatch=!1,n.stripPrefix={scheme:!0,www:!0},n.stripTrailingSlash=!0,n.decodePercentEncoding=!0,n.schemePrefixRegex=/^(https?:\/\/)?/i,n.wwwPrefixRegex=/^(https?:\/\/)?(www\.)?/i,n.protocolRelativeRegex=/^\/\//,n.protocolPrepended=!1,n.urlMatchType=t.urlMatchType,n.url=t.url,n.protocolUrlMatch=t.protocolUrlMatch,n.protocolRelativeMatch=t.protocolRelativeMatch,n.stripPrefix=t.stripPrefix,n.stripTrailingSlash=t.stripTrailingSlash,n.decodePercentEncoding=t.decodePercentEncoding,n}return FPe(t,e),t.prototype.getType=function(){return"url"},t.prototype.getUrlMatchType=function(){return this.urlMatchType},t.prototype.getUrl=function(){var e=this.url;return this.protocolRelativeMatch||this.protocolUrlMatch||this.protocolPrepended||(e=this.url="http://"+e,this.protocolPrepended=!0),e},t.prototype.getAnchorHref=function(){var e=this.getUrl();return e.replace(/&amp;/g,"&")},t.prototype.getAnchorText=function(){var e=this.getMatchedText();return this.protocolRelativeMatch&&(e=this.stripProtocolRelativePrefix(e)),this.stripPrefix.scheme&&(e=this.stripSchemePrefix(e)),this.stripPrefix.www&&(e=this.stripWwwPrefix(e)),this.stripTrailingSlash&&(e=this.removeTrailingSlash(e)),this.decodePercentEncoding&&(e=this.removePercentEncoding(e)),e},t.prototype.stripSchemePrefix=function(e){return e.replace(this.schemePrefixRegex,"")},t.prototype.stripWwwPrefix=function(e){return e.replace(this.wwwPrefixRegex,"$1")},t.prototype.stripProtocolRelativePrefix=function(e){return e.replace(this.protocolRelativeRegex,"")},t.prototype.removeTrailingSlash=function(e){return"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1)),e},t.prototype.removePercentEncoding=function(e){var t=e.replace(/%22/gi,"&quot;").replace(/%26/gi,"&amp;").replace(/%27/gi,"&#39;").replace(/%3C/gi,"&lt;").replace(/%3E/gi,"&gt;");try{return decodeURIComponent(t)}catch(n){return t}},t}(BPe),WPe=function(){function e(e){this.__jsduckDummyDocProp=null,this.tagBuilder=e.tagBuilder}return e}(),qPe=/[A-Za-z]/,jPe=/[\d]/,YPe=/[\D]/,KPe=/\s/,XPe=/['"]/,QPe=/[\x00-\x1F\x7F]/,JPe=/A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC/.source,ZPe=/\u2700-\u27bf\udde6-\uddff\ud800-\udbff\udc00-\udfff\ufe0e\ufe0f\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0\ud83c\udffb-\udfff\u200d\u3299\u3297\u303d\u3030\u24c2\ud83c\udd70-\udd71\udd7e-\udd7f\udd8e\udd91-\udd9a\udde6-\uddff\ude01-\ude02\ude1a\ude2f\ude32-\ude3a\ude50-\ude51\u203c\u2049\u25aa-\u25ab\u25b6\u25c0\u25fb-\u25fe\u00a9\u00ae\u2122\u2139\udc04\u2600-\u26FF\u2b05\u2b06\u2b07\u2b1b\u2b1c\u2b50\u2b55\u231a\u231b\u2328\u23cf\u23e9-\u23f3\u23f8-\u23fa\udccf\u2935\u2934\u2190-\u21ff/.source,$Pe=/\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D4-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF5\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F/.source,eRe=JPe+ZPe+$Pe,tRe=/0-9\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19/.source,nRe=eRe+tRe,iRe=eRe+tRe,oRe="(?:["+tRe+"]{1,3}\\.){3}["+tRe+"]{1,3}",rRe="["+iRe+"](?:["+iRe+"\\-]{0,61}["+iRe+"])?",sRe=function(e){return"(?=("+rRe+"))\\"+e},aRe=function(e){return"(?:"+sRe(e)+"(?:\\."+sRe(e+1)+"){0,126}|"+oRe+")"},cRe=new RegExp("[".concat(iRe,"]")),lRe=/(?:xn--vermgensberatung-pwb|xn--vermgensberater-ctb|xn--clchc0ea0b2g2a9gcd|xn--w4r85el8fhu5dnra|northwesternmutual|travelersinsurance|vermögensberatung|xn--3oq18vl8pn36a|xn--5su34j936bgsg|xn--bck1b9a5dre4c|xn--mgbah1a3hjkrd|xn--mgbai9azgqp6j|xn--mgberp4a5d4ar|xn--xkc2dl3a5ee0h|vermögensberater|xn--fzys8d69uvgm|xn--mgba7c0bbn0a|xn--mgbcpq6gpa1a|xn--xkc2al3hye2a|americanexpress|kerryproperties|sandvikcoromant|xn--i1b6b1a6a2e|xn--kcrx77d1x4a|xn--lgbbat1ad8j|xn--mgba3a4f16a|xn--mgbaakc7dvf|xn--mgbc0a9azcg|xn--nqv7fs00ema|afamilycompany|americanfamily|bananarepublic|cancerresearch|cookingchannel|kerrylogistics|weatherchannel|xn--54b7fta0cc|xn--6qq986b3xl|xn--80aqecdr1a|xn--b4w605ferd|xn--fiq228c5hs|xn--h2breg3eve|xn--jlq480n2rg|xn--jlq61u9w7b|xn--mgba3a3ejt|xn--mgbaam7a8h|xn--mgbayh7gpa|xn--mgbbh1a71e|xn--mgbca7dzdo|xn--mgbi4ecexp|xn--mgbx4cd0ab|xn--rvc1e0am3e|international|lifeinsurance|travelchannel|wolterskluwer|xn--cckwcxetd|xn--eckvdtc9d|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--h2brj9c8c|xn--tiq49xqyj|xn--yfro4i67o|xn--ygbi2ammx|construction|lplfinancial|scholarships|versicherung|xn--3e0b707e|xn--45br5cyl|xn--4dbrk0ce|xn--80adxhks|xn--80asehdb|xn--8y0a063a|xn--gckr3f0f|xn--mgb9awbf|xn--mgbab2bd|xn--mgbgu82a|xn--mgbpl2fh|xn--mgbt3dhd|xn--mk1bu44c|xn--ngbc5azd|xn--ngbe9e0a|xn--ogbpf8fl|xn--qcka1pmc|accountants|barclaycard|blackfriday|blockbuster|bridgestone|calvinklein|contractors|creditunion|engineering|enterprises|foodnetwork|investments|kerryhotels|lamborghini|motorcycles|olayangroup|photography|playstation|productions|progressive|redumbrella|williamhill|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--3bst00m|xn--3ds443g|xn--3hcrj9c|xn--42c2d9a|xn--45brj9c|xn--55qw42g|xn--6frz82g|xn--80ao21a|xn--9krt00a|xn--cck2b3b|xn--czr694b|xn--d1acj3b|xn--efvy88h|xn--fct429k|xn--fjq720a|xn--flw351e|xn--g2xx48c|xn--gecrj9c|xn--gk3at1e|xn--h2brj9c|xn--hxt814e|xn--imr513n|xn--j6w193g|xn--jvr189m|xn--kprw13d|xn--kpry57d|xn--mgbbh1a|xn--mgbtx2b|xn--mix891f|xn--nyqy26a|xn--otu796d|xn--pgbs0dh|xn--q9jyb4c|xn--rhqv96g|xn--rovu88b|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--vuq861b|xn--w4rs40l|xn--xhq521b|xn--zfr164b|சிங்கப்பூர்|accountant|apartments|associates|basketball|bnpparibas|boehringer|capitalone|consulting|creditcard|cuisinella|eurovision|extraspace|foundation|healthcare|immobilien|industries|management|mitsubishi|nextdirect|properties|protection|prudential|realestate|republican|restaurant|schaeffler|swiftcover|tatamotors|technology|university|vlaanderen|volkswagen|xn--30rr7y|xn--3pxu8k|xn--45q11c|xn--4gbrim|xn--55qx5d|xn--5tzm5g|xn--80aswg|xn--90a3ac|xn--9dbq2a|xn--9et52u|xn--c2br7g|xn--cg4bki|xn--czrs0t|xn--czru2d|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--io0a7i|xn--kput3i|xn--mxtq1m|xn--o3cw4h|xn--pssy2u|xn--q7ce6a|xn--unup4y|xn--wgbh1c|xn--wgbl6a|xn--y9a3aq|accenture|alfaromeo|allfinanz|amsterdam|analytics|aquarelle|barcelona|bloomberg|christmas|community|directory|education|equipment|fairwinds|financial|firestone|fresenius|frontdoor|furniture|goldpoint|hisamitsu|homedepot|homegoods|homesense|institute|insurance|kuokgroup|lancaster|landrover|lifestyle|marketing|marshalls|melbourne|microsoft|panasonic|passagens|pramerica|richardli|scjohnson|shangrila|solutions|statebank|statefarm|stockholm|travelers|vacations|xn--90ais|xn--c1avg|xn--d1alf|xn--e1a4c|xn--fhbei|xn--j1aef|xn--j1amh|xn--l1acc|xn--ngbrx|xn--nqv7f|xn--p1acf|xn--qxa6a|xn--tckwe|xn--vhquv|yodobashi|موريتانيا|abudhabi|airforce|allstate|attorney|barclays|barefoot|bargains|baseball|boutique|bradesco|broadway|brussels|budapest|builders|business|capetown|catering|catholic|cipriani|cityeats|cleaning|clinique|clothing|commbank|computer|delivery|deloitte|democrat|diamonds|discount|discover|download|engineer|ericsson|etisalat|exchange|feedback|fidelity|firmdale|football|frontier|goodyear|grainger|graphics|guardian|hdfcbank|helsinki|holdings|hospital|infiniti|ipiranga|istanbul|jpmorgan|lighting|lundbeck|marriott|maserati|mckinsey|memorial|merckmsd|mortgage|observer|partners|pharmacy|pictures|plumbing|property|redstone|reliance|saarland|samsclub|security|services|shopping|showtime|softbank|software|stcgroup|supplies|training|vanguard|ventures|verisign|woodside|xn--90ae|xn--node|xn--p1ai|xn--qxam|yokohama|السعودية|abogado|academy|agakhan|alibaba|android|athleta|auction|audible|auspost|avianca|banamex|bauhaus|bentley|bestbuy|booking|brother|bugatti|capital|caravan|careers|channel|charity|chintai|citadel|clubmed|college|cologne|comcast|company|compare|contact|cooking|corsica|country|coupons|courses|cricket|cruises|dentist|digital|domains|exposed|express|farmers|fashion|ferrari|ferrero|finance|fishing|fitness|flights|florist|flowers|forsale|frogans|fujitsu|gallery|genting|godaddy|grocery|guitars|hamburg|hangout|hitachi|holiday|hosting|hoteles|hotmail|hyundai|ismaili|jewelry|juniper|kitchen|komatsu|lacaixa|lanxess|lasalle|latrobe|leclerc|limited|lincoln|markets|monster|netbank|netflix|network|neustar|okinawa|oldnavy|organic|origins|philips|pioneer|politie|realtor|recipes|rentals|reviews|rexroth|samsung|sandvik|schmidt|schwarz|science|shiksha|singles|staples|storage|support|surgery|systems|temasek|theater|theatre|tickets|tiffany|toshiba|trading|walmart|wanggou|watches|weather|website|wedding|whoswho|windows|winners|xfinity|yamaxun|youtube|zuerich|католик|اتصالات|البحرين|الجزائر|العليان|پاکستان|كاثوليك|இந்தியா|abarth|abbott|abbvie|africa|agency|airbus|airtel|alipay|alsace|alstom|amazon|anquan|aramco|author|bayern|beauty|berlin|bharti|bostik|boston|broker|camera|career|casino|center|chanel|chrome|church|circle|claims|clinic|coffee|comsec|condos|coupon|credit|cruise|dating|datsun|dealer|degree|dental|design|direct|doctor|dunlop|dupont|durban|emerck|energy|estate|events|expert|family|flickr|futbol|gallup|garden|george|giving|global|google|gratis|health|hermes|hiphop|hockey|hotels|hughes|imamat|insure|intuit|jaguar|joburg|juegos|kaufen|kinder|kindle|kosher|lancia|latino|lawyer|lefrak|living|locker|london|luxury|madrid|maison|makeup|market|mattel|mobile|monash|mormon|moscow|museum|mutual|nagoya|natura|nissan|nissay|norton|nowruz|office|olayan|online|oracle|orange|otsuka|pfizer|photos|physio|pictet|quebec|racing|realty|reisen|repair|report|review|rocher|rogers|ryukyu|safety|sakura|sanofi|school|schule|search|secure|select|shouji|soccer|social|stream|studio|supply|suzuki|swatch|sydney|taipei|taobao|target|tattoo|tennis|tienda|tjmaxx|tkmaxx|toyota|travel|unicom|viajes|viking|villas|virgin|vision|voting|voyage|vuelos|walter|webcam|xihuan|yachts|yandex|zappos|москва|онлайн|ابوظبي|ارامكو|الاردن|المغرب|امارات|فلسطين|مليسيا|भारतम्|இலங்கை|ファッション|actor|adult|aetna|amfam|amica|apple|archi|audio|autos|azure|baidu|beats|bible|bingo|black|boats|bosch|build|canon|cards|chase|cheap|cisco|citic|click|cloud|coach|codes|crown|cymru|dabur|dance|deals|delta|drive|dubai|earth|edeka|email|epson|faith|fedex|final|forex|forum|gallo|games|gifts|gives|glade|glass|globo|gmail|green|gripe|group|gucci|guide|homes|honda|horse|house|hyatt|ikano|irish|jetzt|koeln|kyoto|lamer|lease|legal|lexus|lilly|linde|lipsy|lixil|loans|locus|lotte|lotto|macys|mango|media|miami|money|movie|nexus|nikon|ninja|nokia|nowtv|omega|osaka|paris|parts|party|phone|photo|pizza|place|poker|praxi|press|prime|promo|quest|radio|rehab|reise|ricoh|rocks|rodeo|rugby|salon|sener|seven|sharp|shell|shoes|skype|sling|smart|smile|solar|space|sport|stada|store|study|style|sucks|swiss|tatar|tires|tirol|tmall|today|tokyo|tools|toray|total|tours|trade|trust|tunes|tushu|ubank|vegas|video|vodka|volvo|wales|watch|weber|weibo|works|world|xerox|yahoo|ישראל|ایران|بازار|بھارت|سودان|سورية|همراه|भारोत|संगठन|বাংলা|భారత్|ഭാരതം|嘉里大酒店|aarp|able|adac|aero|akdn|ally|amex|arab|army|arpa|arte|asda|asia|audi|auto|baby|band|bank|bbva|beer|best|bike|bing|blog|blue|bofa|bond|book|buzz|cafe|call|camp|care|cars|casa|case|cash|cbre|cern|chat|citi|city|club|cool|coop|cyou|data|date|dclk|deal|dell|desi|diet|dish|docs|duck|dvag|erni|fage|fail|fans|farm|fast|fiat|fido|film|fire|fish|flir|food|ford|free|fund|game|gbiz|gent|ggee|gift|gmbh|gold|golf|goog|guge|guru|hair|haus|hdfc|help|here|hgtv|host|hsbc|icbc|ieee|imdb|immo|info|itau|java|jeep|jobs|jprs|kddi|kiwi|kpmg|kred|land|lego|lgbt|lidl|life|like|limo|link|live|loan|loft|love|ltda|luxe|maif|meet|meme|menu|mini|mint|mobi|moda|moto|name|navy|news|next|nico|nike|ollo|open|page|pars|pccw|pics|ping|pink|play|plus|pohl|porn|post|prod|prof|qpon|raid|read|reit|rent|rest|rich|rmit|room|rsvp|ruhr|safe|sale|sarl|save|saxo|scot|seat|seek|sexy|shaw|shia|shop|show|silk|sina|site|skin|sncf|sohu|song|sony|spot|star|surf|talk|taxi|team|tech|teva|tiaa|tips|town|toys|tube|vana|visa|viva|vivo|vote|voto|wang|weir|wien|wiki|wine|work|xbox|yoga|zara|zero|zone|дети|сайт|بارت|بيتك|ڀارت|تونس|شبكة|عراق|عمان|موقع|भारत|ভারত|ভাৰত|ਭਾਰਤ|ભારત|ଭାରତ|ಭಾರತ|ලංකා|アマゾン|グーグル|クラウド|ポイント|大众汽车|组织机构|電訊盈科|香格里拉|aaa|abb|abc|aco|ads|aeg|afl|aig|anz|aol|app|art|aws|axa|bar|bbc|bbt|bcg|bcn|bet|bid|bio|biz|bms|bmw|bom|boo|bot|box|buy|bzh|cab|cal|cam|car|cat|cba|cbn|cbs|ceo|cfa|cfd|com|cpa|crs|csc|dad|day|dds|dev|dhl|diy|dnp|dog|dot|dtv|dvr|eat|eco|edu|esq|eus|fan|fit|fly|foo|fox|frl|ftr|fun|fyi|gal|gap|gay|gdn|gea|gle|gmo|gmx|goo|gop|got|gov|hbo|hiv|hkt|hot|how|ibm|ice|icu|ifm|inc|ing|ink|int|ist|itv|jcb|jio|jll|jmp|jnj|jot|joy|kfh|kia|kim|kpn|krd|lat|law|lds|llc|llp|lol|lpl|ltd|man|map|mba|med|men|mil|mit|mlb|mls|mma|moe|moi|mom|mov|msd|mtn|mtr|nab|nba|nec|net|new|nfl|ngo|nhk|now|nra|nrw|ntt|nyc|obi|off|one|ong|onl|ooo|org|ott|ovh|pay|pet|phd|pid|pin|pnc|pro|pru|pub|pwc|qvc|red|ren|ril|rio|rip|run|rwe|sap|sas|sbi|sbs|sca|scb|ses|sew|sex|sfr|ski|sky|soy|spa|srl|stc|tab|tax|tci|tdk|tel|thd|tjx|top|trv|tui|tvs|ubs|uno|uol|ups|vet|vig|vin|vip|wed|win|wme|wow|wtc|wtf|xin|xxx|xyz|you|yun|zip|бел|ком|қаз|мкд|мон|орг|рус|срб|укр|հայ|קום|عرب|قطر|كوم|مصر|कॉम|नेट|คอม|ไทย|ລາວ|ストア|セール|みんな|中文网|亚马逊|天主教|我爱你|新加坡|淡马锡|诺基亚|飞利浦|ac|ad|ae|af|ag|ai|al|am|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw|ελ|ευ|бг|ею|рф|გე|닷넷|닷컴|삼성|한국|コム|世界|中信|中国|中國|企业|佛山|信息|健康|八卦|公司|公益|台湾|台灣|商城|商店|商标|嘉里|在线|大拿|娱乐|家電|广东|微博|慈善|手机|招聘|政务|政府|新闻|时尚|書籍|机构|游戏|澳門|点看|移动|网址|网店|网站|网络|联通|谷歌|购物|通販|集团|食品|餐厅|香港)/,uRe=new RegExp("[".concat(iRe,"!#$%&'*+/=?^_`{|}~-]")),hRe=new RegExp("^".concat(lRe.source,"$")),dRe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.localPartCharRegex=uRe,t.strictTldRegex=hRe,t}return FPe(t,e),t.prototype.parseMatches=function(e){var t=this.tagBuilder,n=this.localPartCharRegex,i=this.strictTldRegex,o=[],r=e.length,s=new fRe,a={m:"a",a:"i",i:"l",l:"t",t:"o",o:":"},c=0,l=0,u=s;while(c<r){var h=e.charAt(c);switch(l){case 0:d(h);break;case 1:f(e.charAt(c-1),h);break;case 2:p(h);break;case 3:m(h);break;case 4:_(h);break;case 5:g(h);break;case 6:y(h);break;case 7:v(h);break;default:OPe(l)}c++}return w(),o;function d(e){"m"===e?b(1):n.test(e)&&b()}function f(e,t){":"===e?n.test(t)?(l=2,u=new fRe(zPe(zPe({},u),{hasMailtoPrefix:!0}))):A():a[e]===t||(n.test(t)?l=2:"."===t?l=3:"@"===t?l=4:A())}function p(e){"."===e?l=3:"@"===e?l=4:n.test(e)||A()}function m(e){"."===e||"@"===e?A():n.test(e)?l=2:A()}function _(e){cRe.test(e)?l=5:A()}function g(e){"."===e?l=7:"-"===e?l=6:cRe.test(e)||w()}function y(e){"-"===e||"."===e?w():cRe.test(e)?l=5:w()}function v(e){"."===e||"-"===e?w():cRe.test(e)?(l=5,u=new fRe(zPe(zPe({},u),{hasDomainDot:!0}))):w()}function b(e){void 0===e&&(e=2),l=e,u=new fRe({idx:c})}function A(){l=0,u=s}function w(){if(u.hasDomainDot){var n=e.slice(u.idx,c);/[-.]$/.test(n)&&(n=n.slice(0,-1));var r=u.hasMailtoPrefix?n.slice("mailto:".length):n;s(r)&&o.push(new kPe({tagBuilder:t,matchedText:n,offset:u.idx,email:r}))}function s(e){var t=e.split(".").pop()||"",n=t.toLowerCase(),o=i.test(n);return o}A()}},t}(WPe),fRe=function(){function e(e){void 0===e&&(e={}),this.idx=void 0!==e.idx?e.idx:-1,this.hasMailtoPrefix=!!e.hasMailtoPrefix,this.hasDomainDot=!!e.hasDomainDot}return e}(),pRe=function(){function e(){}return e.isValid=function(e,t){return!(t&&!this.isValidUriScheme(t)||this.urlMatchDoesNotHaveProtocolOrDot(e,t)||this.urlMatchDoesNotHaveAtLeastOneWordChar(e,t)&&!this.isValidIpAddress(e)||this.containsMultipleDots(e))},e.isValidIpAddress=function(e){var t=new RegExp(this.hasFullProtocolRegex.source+this.ipRegex.source),n=e.match(t);return null!==n},e.containsMultipleDots=function(e){var t=e;return this.hasFullProtocolRegex.test(e)&&(t=e.split("://")[1]),t.split("/")[0].indexOf("..")>-1},e.isValidUriScheme=function(e){var t=e.match(this.uriSchemeRegex),n=t&&t[0].toLowerCase();return"javascript:"!==n&&"vbscript:"!==n},e.urlMatchDoesNotHaveProtocolOrDot=function(e,t){return!!e&&(!t||!this.hasFullProtocolRegex.test(t))&&-1===e.indexOf(".")},e.urlMatchDoesNotHaveAtLeastOneWordChar=function(e,t){return!(!e||!t)&&(!this.hasFullProtocolRegex.test(t)&&!this.hasWordCharAfterProtocolRegex.test(e))},e.hasFullProtocolRegex=/^[A-Za-z][-.+A-Za-z0-9]*:\/\//,e.uriSchemeRegex=/^[A-Za-z][-.+A-Za-z0-9]*:/,e.hasWordCharAfterProtocolRegex=new RegExp(":[^\\s]*?["+JPe+"]"),e.ipRegex=/[0-9][0-9]?[0-9]?\.[0-9][0-9]?[0-9]?\.[0-9][0-9]?[0-9]?\.[0-9][0-9]?[0-9]?(:[0-9]*)?\/?$/,e}(),mRe=function(){var e=/(?:[A-Za-z][-.+A-Za-z0-9]{0,63}:(?![A-Za-z][-.+A-Za-z0-9]{0,63}:\/\/)(?!\d+\/?)(?:\/\/)?)/,t=/(?:www\.)/,n=new RegExp("[/?#](?:["+iRe+"\\-+&@#/%=~_()|'$*\\[\\]{}?!:,.;^✓]*["+iRe+"\\-+&@#/%=~_()|'$*\\[\\]{}✓])?");return new RegExp(["(?:","(",e.source,aRe(2),")","|","(","(//)?",t.source,aRe(6),")","|","(","(//)?",aRe(10)+"\\.",lRe.source,"(?![-"+nRe+"])",")",")","(?::[0-9]+)?","(?:"+n.source+")?"].join(""),"gi")}(),_Re=new RegExp("["+iRe+"]"),gRe=function(e){function t(t){var n=e.call(this,t)||this;return n.stripPrefix={scheme:!0,www:!0},n.stripTrailingSlash=!0,n.decodePercentEncoding=!0,n.matcherRegex=mRe,n.wordCharRegExp=_Re,n.stripPrefix=t.stripPrefix,n.stripTrailingSlash=t.stripTrailingSlash,n.decodePercentEncoding=t.decodePercentEncoding,n}return FPe(t,e),t.prototype.parseMatches=function(e){var t,n=this.matcherRegex,i=this.stripPrefix,o=this.stripTrailingSlash,r=this.decodePercentEncoding,s=this.tagBuilder,a=[],c=function(){var n=t[0],c=t[1],u=t[4],h=t[5],d=t[9],f=t.index,p=h||d,m=e.charAt(f-1);if(!pRe.isValid(n,c))return"continue";if(f>0&&"@"===m)return"continue";if(f>0&&p&&l.wordCharRegExp.test(m))return"continue";if(/\?$/.test(n)&&(n=n.substr(0,n.length-1)),l.matchHasUnbalancedClosingParen(n))n=n.substr(0,n.length-1);else{var _=l.matchHasInvalidCharAfterTld(n,c);_>-1&&(n=n.substr(0,_))}var g=["http://","https://"].find((function(e){return!!c&&-1!==c.indexOf(e)}));if(g){var y=n.indexOf(g);n=n.substr(y),c=c.substr(y),f+=y}var v=c?"scheme":u?"www":"tld",b=!!c;a.push(new GPe({tagBuilder:s,matchedText:n,offset:f,urlMatchType:v,url:n,protocolUrlMatch:b,protocolRelativeMatch:!!p,stripPrefix:i,stripTrailingSlash:o,decodePercentEncoding:r}))},l=this;while(null!==(t=n.exec(e)))c();return a},t.prototype.matchHasUnbalancedClosingParen=function(e){var t,n=e.charAt(e.length-1);if(")"===n)t="(";else if("]"===n)t="[";else{if("}"!==n)return!1;t="{"}for(var i=0,o=0,r=e.length-1;o<r;o++){var s=e.charAt(o);s===t?i++:s===n&&(i=Math.max(i-1,0))}return 0===i},t.prototype.matchHasInvalidCharAfterTld=function(e,t){if(!e)return-1;var n=0;t&&(n=e.indexOf(":"),e=e.slice(n));var i=new RegExp("^((.?//)?[-."+iRe+"]*[-"+iRe+"]\\.[-"+iRe+"]+)"),o=i.exec(e);return null===o?-1:(n+=o[1].length,e=e.slice(o[1].length),/^[^-.A-Za-z0-9:\/?#]/.test(e)?n:-1)},t}(WPe),yRe=new RegExp("#[_".concat(iRe,"]{1,139}(?![_").concat(iRe,"])"),"g"),vRe=new RegExp("[^"+iRe+"]"),bRe=function(e){function t(t){var n=e.call(this,t)||this;return n.serviceName="twitter",n.matcherRegex=yRe,n.nonWordCharRegex=vRe,n.serviceName=t.serviceName,n}return FPe(t,e),t.prototype.parseMatches=function(e){var t,n=this.matcherRegex,i=this.nonWordCharRegex,o=this.serviceName,r=this.tagBuilder,s=[];while(null!==(t=n.exec(e))){var a=t.index,c=e.charAt(a-1);if(0===a||i.test(c)){var l=t[0],u=t[0].slice(1);s.push(new UPe({tagBuilder:r,matchedText:l,offset:a,serviceName:o,hashtag:u}))}}return s},t}(WPe),ARe=/(?:(?:(?:(\+)?\d{1,3}[-\040.]?)?\(?\d{3}\)?[-\040.]?\d{3}[-\040.]?\d{4})|(?:(\+)(?:9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7|1)[-\040.]?(?:\d[-\040.]?){6,12}\d+))([,;]+[0-9]+#?)*/,wRe=/(0([1-9]{1}-?[1-9]\d{3}|[1-9]{2}-?\d{3}|[1-9]{2}\d{1}-?\d{2}|[1-9]{2}\d{2}-?\d{1})-?\d{4}|0[789]0-?\d{4}-?\d{4}|050-?\d{4}-?\d{4})/,TRe=new RegExp("".concat(ARe.source,"|").concat(wRe.source),"g"),CRe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.matcherRegex=TRe,t}return FPe(t,e),t.prototype.parseMatches=function(e){var t,n=this.matcherRegex,i=this.tagBuilder,o=[];while(null!==(t=n.exec(e))){var r=t[0],s=r.replace(/[^0-9,;#]/g,""),a=!(!t[1]&&!t[2]),c=0==t.index?"":e.substr(t.index-1,1),l=e.substr(t.index+r.length,1),u=!c.match(/\d/)&&!l.match(/\d/);this.testMatch(t[3])&&this.testMatch(r)&&u&&o.push(new HPe({tagBuilder:i,matchedText:r,offset:t.index,number:s,plusSign:a}))}return o},t.prototype.testMatch=function(e){return YPe.test(e)},t}(WPe),ERe=new RegExp("@[_".concat(iRe,"]{1,50}(?![_").concat(iRe,"])"),"g"),xRe=new RegExp("@[_.".concat(iRe,"]{1,30}(?![_").concat(iRe,"])"),"g"),SRe=new RegExp("@[-_.".concat(iRe,"]{1,50}(?![-_").concat(iRe,"])"),"g"),IRe=new RegExp("@[_.".concat(iRe,"]{1,23}[_").concat(iRe,"](?![_").concat(iRe,"])"),"g"),ORe=new RegExp("[^"+iRe+"]"),DRe=function(e){function t(t){var n=e.call(this,t)||this;return n.serviceName="twitter",n.matcherRegexes={twitter:ERe,instagram:xRe,soundcloud:SRe,tiktok:IRe},n.nonWordCharRegex=ORe,n.serviceName=t.serviceName,n}return FPe(t,e),t.prototype.parseMatches=function(e){var t,n=this.serviceName,i=this.matcherRegexes[this.serviceName],o=this.nonWordCharRegex,r=this.tagBuilder,s=[];if(!i)return s;while(null!==(t=i.exec(e))){var a=t.index,c=e.charAt(a-1);if(0===a||o.test(c)){var l=t[0].replace(/\.+$/g,""),u=l.slice(1);s.push(new VPe({tagBuilder:r,matchedText:l,offset:a,serviceName:n,mention:u}))}}return s},t}(WPe);function PRe(e,t){var n=t.onOpenTag,i=t.onCloseTag,o=t.onText,r=t.onComment,s=t.onDoctype,a=new RRe,c=0,l=e.length,u=0,h=0,d=a;while(c<l){var f=e.charAt(c);switch(u){case 0:p(f);break;case 1:m(f);break;case 2:g(f);break;case 3:_(f);break;case 4:y(f);break;case 5:v(f);break;case 6:b(f);break;case 7:A(f);break;case 8:w(f);break;case 9:T(f);break;case 10:C(f);break;case 11:E(f);break;case 12:x(f);break;case 13:S();break;case 14:I(f);break;case 15:O(f);break;case 16:D(f);break;case 17:P(f);break;case 18:R(f);break;case 19:L(f);break;case 20:M(f);break;default:OPe(u)}c++}function p(e){"<"===e&&N()}function m(e){"!"===e?u=13:"/"===e?(u=2,d=new RRe(zPe(zPe({},d),{isClosing:!0}))):"<"===e?N():qPe.test(e)?(u=3,d=new RRe(zPe(zPe({},d),{isOpening:!0}))):(u=0,d=a)}function _(e){KPe.test(e)?(d=new RRe(zPe(zPe({},d),{name:k()})),u=4):"<"===e?N():"/"===e?(d=new RRe(zPe(zPe({},d),{name:k()})),u=12):">"===e?(d=new RRe(zPe(zPe({},d),{name:k()})),F()):qPe.test(e)||jPe.test(e)||":"===e||B()}function g(e){">"===e?B():qPe.test(e)?u=3:B()}function y(e){KPe.test(e)||("/"===e?u=12:">"===e?F():"<"===e?N():"="===e||XPe.test(e)||QPe.test(e)?B():u=5)}function v(e){KPe.test(e)?u=6:"/"===e?u=12:"="===e?u=7:">"===e?F():"<"===e?N():XPe.test(e)&&B()}function b(e){KPe.test(e)||("/"===e?u=12:"="===e?u=7:">"===e?F():"<"===e?N():XPe.test(e)?B():u=5)}function A(e){KPe.test(e)||('"'===e?u=8:"'"===e?u=9:/[>=`]/.test(e)?B():"<"===e?N():u=10)}function w(e){'"'===e&&(u=11)}function T(e){"'"===e&&(u=11)}function C(e){KPe.test(e)?u=4:">"===e?F():"<"===e&&N()}function E(e){KPe.test(e)?u=4:"/"===e?u=12:">"===e?F():"<"===e?N():(u=4,U())}function x(e){">"===e?(d=new RRe(zPe(zPe({},d),{isClosing:!0})),F()):u=4}function S(t){"--"===e.substr(c,2)?(c+=2,d=new RRe(zPe(zPe({},d),{type:"comment"})),u=14):"DOCTYPE"===e.substr(c,7).toUpperCase()?(c+=7,d=new RRe(zPe(zPe({},d),{type:"doctype"})),u=20):B()}function I(e){"-"===e?u=15:">"===e?B():u=16}function O(e){"-"===e?u=18:">"===e?B():u=16}function D(e){"-"===e&&(u=17)}function P(e){u="-"===e?18:16}function R(e){">"===e?F():"!"===e?u=19:"-"===e||(u=16)}function L(e){"-"===e?u=17:">"===e?F():u=16}function M(e){">"===e?F():"<"===e&&N()}function B(){u=0,d=a}function N(){u=1,d=new RRe({idx:c})}function F(){var t=e.slice(h,d.idx);t&&o(t,h),"comment"===d.type?r(d.idx):"doctype"===d.type?s(d.idx):(d.isOpening&&n(d.name,d.idx),d.isClosing&&i(d.name,d.idx)),B(),h=c+1}function z(){var t=e.slice(h,c);o(t,h),h=c+1}function k(){var t=d.idx+(d.isClosing?2:1);return e.slice(t,c).toLowerCase()}function U(){c--}h<c&&z()}var RRe=function(){function e(e){void 0===e&&(e={}),this.idx=void 0!==e.idx?e.idx:-1,this.type=e.type||"tag",this.name=e.name||"",this.isOpening=!!e.isOpening,this.isClosing=!!e.isClosing}return e}(),LRe=function(){function e(t){void 0===t&&(t={}),this.version=e.version,this.urls={},this.email=!0,this.phone=!0,this.hashtag=!1,this.mention=!1,this.newWindow=!0,this.stripPrefix={scheme:!0,www:!0},this.stripTrailingSlash=!0,this.decodePercentEncoding=!0,this.truncate={length:0,location:"end"},this.className="",this.replaceFn=null,this.context=void 0,this.sanitizeHtml=!1,this.matchers=null,this.tagBuilder=null,this.urls=this.normalizeUrlsCfg(t.urls),this.email="boolean"===typeof t.email?t.email:this.email,this.phone="boolean"===typeof t.phone?t.phone:this.phone,this.hashtag=t.hashtag||this.hashtag,this.mention=t.mention||this.mention,this.newWindow="boolean"===typeof t.newWindow?t.newWindow:this.newWindow,this.stripPrefix=this.normalizeStripPrefixCfg(t.stripPrefix),this.stripTrailingSlash="boolean"===typeof t.stripTrailingSlash?t.stripTrailingSlash:this.stripTrailingSlash,this.decodePercentEncoding="boolean"===typeof t.decodePercentEncoding?t.decodePercentEncoding:this.decodePercentEncoding,this.sanitizeHtml=t.sanitizeHtml||!1;var n=this.mention;if(!1!==n&&-1===["twitter","instagram","soundcloud","tiktok"].indexOf(n))throw new Error("invalid `mention` cfg '".concat(n,"' - see docs"));var i=this.hashtag;if(!1!==i&&-1===["twitter","facebook","instagram","tiktok"].indexOf(i))throw new Error("invalid `hashtag` cfg '".concat(i,"' - see docs"));this.truncate=this.normalizeTruncateCfg(t.truncate),this.className=t.className||this.className,this.replaceFn=t.replaceFn||this.replaceFn,this.context=t.context||this}return e.link=function(t,n){var i=new e(n);return i.link(t)},e.parse=function(t,n){var i=new e(n);return i.parse(t)},e.prototype.normalizeUrlsCfg=function(e){return null==e&&(e=!0),"boolean"===typeof e?{schemeMatches:e,wwwMatches:e,tldMatches:e}:{schemeMatches:"boolean"!==typeof e.schemeMatches||e.schemeMatches,wwwMatches:"boolean"!==typeof e.wwwMatches||e.wwwMatches,tldMatches:"boolean"!==typeof e.tldMatches||e.tldMatches}},e.prototype.normalizeStripPrefixCfg=function(e){return null==e&&(e=!0),"boolean"===typeof e?{scheme:e,www:e}:{scheme:"boolean"!==typeof e.scheme||e.scheme,www:"boolean"!==typeof e.www||e.www}},e.prototype.normalizeTruncateCfg=function(e){return"number"===typeof e?{length:e,location:"end"}:CPe(e||{},{length:Number.POSITIVE_INFINITY,location:"end"})},e.prototype.parse=function(e){var t=this,n=["a","style","script"],i=0,o=[];return PRe(e,{onOpenTag:function(e){n.indexOf(e)>=0&&i++},onText:function(e,n){if(0===i){var r=/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;|&quot;|&#34;|&#39;)/gi,s=IPe(e,r),a=n;s.forEach((function(e,n){if(n%2===0){var i=t.parseText(e,a);o.push.apply(o,i)}a+=e.length}))}},onCloseTag:function(e){n.indexOf(e)>=0&&(i=Math.max(i-1,0))},onComment:function(e){},onDoctype:function(e){}}),o=this.compactMatches(o),o=this.removeUnwantedMatches(o),o},e.prototype.compactMatches=function(e){e.sort((function(e,t){return e.getOffset()-t.getOffset()}));var t=0;while(t<e.length-1){var n=e[t],i=n.getOffset(),o=n.getMatchedText().length,r=i+o;if(t+1<e.length){if(e[t+1].getOffset()===i){var s=e[t+1].getMatchedText().length>o?t:t+1;e.splice(s,1);continue}if(e[t+1].getOffset()<r){e.splice(t+1,1);continue}}t++}return e},e.prototype.removeUnwantedMatches=function(e){return this.hashtag||SPe(e,(function(e){return"hashtag"===e.getType()})),this.email||SPe(e,(function(e){return"email"===e.getType()})),this.phone||SPe(e,(function(e){return"phone"===e.getType()})),this.mention||SPe(e,(function(e){return"mention"===e.getType()})),this.urls.schemeMatches||SPe(e,(function(e){return"url"===e.getType()&&"scheme"===e.getUrlMatchType()})),this.urls.wwwMatches||SPe(e,(function(e){return"url"===e.getType()&&"www"===e.getUrlMatchType()})),this.urls.tldMatches||SPe(e,(function(e){return"url"===e.getType()&&"tld"===e.getUrlMatchType()})),e},e.prototype.parseText=function(e,t){void 0===t&&(t=0),t=t||0;for(var n=this.getMatchers(),i=[],o=0,r=n.length;o<r;o++){for(var s=n[o].parseMatches(e),a=0,c=s.length;a<c;a++)s[a].setOffset(t+s[a].getOffset());i.push.apply(i,s)}return i},e.prototype.link=function(e){if(!e)return"";this.sanitizeHtml&&(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"));for(var t=this.parse(e),n=[],i=0,o=0,r=t.length;o<r;o++){var s=t[o];n.push(e.substring(i,s.getOffset())),n.push(this.createMatchReturnVal(s)),i=s.getOffset()+s.getMatchedText().length}return n.push(e.substring(i)),n.join("")},e.prototype.createMatchReturnVal=function(e){var t;if(this.replaceFn&&(t=this.replaceFn.call(this.context,e)),"string"===typeof t)return t;if(!1===t)return e.getMatchedText();if(t instanceof DPe)return t.toAnchorString();var n=e.buildTag();return n.toAnchorString()},e.prototype.getMatchers=function(){if(this.matchers)return this.matchers;var e=this.getTagBuilder(),t=[new bRe({tagBuilder:e,serviceName:this.hashtag}),new dRe({tagBuilder:e}),new CRe({tagBuilder:e}),new DRe({tagBuilder:e,serviceName:this.mention}),new gRe({tagBuilder:e,stripPrefix:this.stripPrefix,stripTrailingSlash:this.stripTrailingSlash,decodePercentEncoding:this.decodePercentEncoding})];return this.matchers=t},e.prototype.getTagBuilder=function(){var e=this.tagBuilder;return e||(e=this.tagBuilder=new MPe({newWindow:this.newWindow,truncate:this.truncate,className:this.className})),e},e.version="3.15.0",e.AnchorTagBuilder=MPe,e.HtmlTag=DPe,e.matcher={Email:dRe,Hashtag:bRe,Matcher:WPe,Mention:DRe,Phone:CRe,Url:gRe},e.match={Email:kPe,Hashtag:UPe,Match:BPe,Mention:VPe,Phone:HPe,Url:GPe},e}();let MRe;"undefined"!==typeof DOMParser&&(MRe=new DOMParser);const BRe=new LRe({stripPrefix:!1,email:!1,replaceFn:function(e,t){if(!t.protocolUrlMatch)return!1}}),NRe=32,FRe=2414016,zRe=1,kRe=16093e3,URe=.1,VRe=[null,void 0,"http://www.topografix.com/GPX/1/1"],HRe={gpx:VRe};function GRe(e){const t=yn(),n=new FileReader;return n.addEventListener("load",(function(){t.resolve(n.result)})),n.addEventListener("error",(function(){t.reject(n.error)})),n.readAsText(e),t.promise}function WRe(e,t){let n=YRe(e,"id");n=C(n)?n:wk();const i=t.getOrCreateEntity(n);return i}function qRe(e){const t=jRe(e,"lon"),n=jRe(e,"lat"),i=QRe(e,"ele",HRe.gpx);return K.fromDegrees(t,n,i)}function jRe(e,t){if(!C(e))return;const n=e.getAttribute(t);if(null!==n){const e=parseFloat(n);return isNaN(e)?void 0:e}}function YRe(e,t){if(!C(e))return;const n=e.getAttribute(t);return null!==n?n:void 0}function KRe(e,t,n){if(!C(e))return;const i=e.childNodes,o=i.length;for(let r=0;r<o;r++){const e=i[r];if(e.localName===t&&-1!==n.indexOf(e.namespaceURI))return e}}function XRe(e,t,n){if(!C(e))return;const i=[],o=e.getElementsByTagName(t),r=o.length;for(let s=0;s<r;s++){const e=o[s];e.localName===t&&-1!==n.indexOf(e.namespaceURI)&&i.push(e)}return i}function QRe(e,t,n){const i=KRe(e,t,n);if(C(i)){const e=parseFloat(i.textContent);return isNaN(e)?void 0:e}}function JRe(e,t,n){const i=KRe(e,t,n);if(C(i))return i.textContent.trim()}function ZRe(e){const t=new Ez;return t.width=NRe,t.height=NRe,t.scaleByDistance=new LO(FRe,zRe,kRe,URe),t.pixelOffsetScaleByDistance=new LO(FRe,zRe,kRe,URe),t.verticalOrigin=new vz(Pz.BOTTOM),t.image=e,t}function $Re(){const e=new _X;return e.translucencyByDistance=new LO(3e6,1,5e6,0),e.pixelOffset=new ro(17,0),e.horizontalOrigin=Oz.LEFT,e.font="16px sans-serif",e.style=Ise.FILL_AND_OUTLINE,e}function eLe(e){const t=new VX;return t.width=4,t.material=new _Te,t.material.color=C(e)?e:xy.RED,t.material.outlineWidth=2,t.material.outlineColor=xy.BLACK,t}const tLe={time:{text:"Time",tag:"time"},comment:{text:"Comment",tag:"cmt"},description:{text:"Description",tag:"desc"},source:{text:"Source",tag:"src"},number:{text:"GPS track/route number",tag:"number"},type:{text:"Type",tag:"type"}};let nLe;function iLe(e,t){let n,i="";const o=Object.keys(tLe),r=o.length;for(n=0;n<r;n++){const t=o[n],r=tLe[t];r.value=R(JRe(e,r.tag,HRe.gpx),""),C(r.value)&&""!==r.value&&(i=`${i}<p>${r.text}: ${r.value}</p>`)}if(!C(i)||""===i)return;i=BRe.link(i),nLe.innerHTML=i;const s=nLe.querySelectorAll("a");for(n=0;n<s.length;n++)s[n].setAttribute("target","_blank");const a=xy.WHITE,c=xy.BLACK;let l='<div class="cesium-infoBox-description-lighter" style="';return l+="overflow:auto;",l+="word-wrap:break-word;",l+=`background-color:${a.toCssColorString()};`,l+=`color:${c.toCssColorString()};`,l+='">',l+=`${nLe.innerHTML}</div>`,nLe.innerHTML="",l}function oLe(e,t,n,i){const o=qRe(t),r=WRe(t,n);r.position=o;const s=C(i.waypointImage)?i.waypointImage:e._pinBuilder.fromMakiIconId("marker",xy.RED,NRe);r.billboard=ZRe(s);const a=JRe(t,"name",HRe.gpx);r.name=a,r.label=$Re(),r.label.text=a,r.description=iLe(t,r),i.clampToGround&&(r.billboard.heightReference=Sz.CLAMP_TO_GROUND,r.label.heightReference=Sz.CLAMP_TO_GROUND)}function rLe(e,t,n,i){const o=WRe(t,n);o.description=iLe(t,o);const r=XRe(t,"rtept",HRe.gpx),s=new Array(r.length);for(let a=0;a<r.length;a++)oLe(e,r[a],n,i),s[a]=qRe(r[a]);o.polyline=eLe(i.routeColor),i.clampToGround&&(o.polyline.clampToGround=!0),o.polyline.positions=s}function sLe(e,t,n,i){const o=WRe(t,n);o.description=iLe(t,o);const r=XRe(t,"trkseg",HRe.gpx);let s,a=[],c=[],l=!0;const u=new NTe;for(let h=0;h<r.length;h++)s=aLe(r[h]),a=a.concat(s.positions),s.times.length>0?(c=c.concat(s.times),u.addSamples(c,a),l=l&&!0):l=!1;if(l){const t=C(i.waypointImage)?i.waypointImage:e._pinBuilder.fromMakiIconId("marker",xy.RED,NRe);o.billboard=ZRe(t),o.position=u,i.clampToGround&&(o.billboard.heightReference=Sz.CLAMP_TO_GROUND),o.availability=new NN,o.availability.addInterval(new cO({start:c[0],stop:c[c.length-1]}))}o.polyline=eLe(i.trackColor),o.polyline.positions=a,i.clampToGround&&(o.polyline.clampToGround=!0)}function aLe(e){const t={positions:[],times:[]},n=XRe(e,"trkpt",HRe.gpx);let i;for(let o=0;o<n.length;o++){const e=qRe(n[o]);t.positions.push(e),i=JRe(n[o],"time",HRe.gpx),C(i)&&t.times.push(Ea.fromIso8601(i))}return t}function cLe(e){const t=KRe(e,"metadata",HRe.gpx);if(C(t)){const e={name:JRe(t,"name",HRe.gpx),desc:JRe(t,"desc",HRe.gpx),author:lLe(t),copyright:dLe(t),link:hLe(t),time:JRe(t,"time",HRe.gpx),keywords:JRe(t,"keywords",HRe.gpx),bounds:fLe(t)};if(C(e.name)||C(e.desc)||C(e.author)||C(e.copyright)||C(e.link)||C(e.time)||C(e.keywords)||C(e.bounds))return e}}function lLe(e){const t=KRe(e,"author",HRe.gpx);if(C(t)){const e={name:JRe(t,"name",HRe.gpx),email:uLe(t),link:hLe(t)};if(C(e.name)||C(e.email)||C(e.link))return e}}function uLe(e){const t=KRe(e,"email",HRe.gpx);if(C(t)){const e=JRe(t,"id",HRe.gpx),n=JRe(t,"domain",HRe.gpx);return`${e}@${n}`}}function hLe(e){const t=KRe(e,"link",HRe.gpx);if(C(t)){const e={href:YRe(t,"href"),text:JRe(t,"text",HRe.gpx),mimeType:JRe(t,"type",HRe.gpx)};if(C(e.href)||C(e.text)||C(e.mimeType))return e}}function dLe(e){const t=KRe(e,"copyright",HRe.gpx);if(C(t)){const e={author:YRe(t,"author"),year:JRe(t,"year",HRe.gpx),license:JRe(t,"license",HRe.gpx)};if(C(e.author)||C(e.year)||C(e.license))return e}}function fLe(e){const t=KRe(e,"bounds",HRe.gpx);if(C(t)){const e={minLat:QRe(t,"minlat",HRe.gpx),maxLat:QRe(t,"maxlat",HRe.gpx),minLon:QRe(t,"minlon",HRe.gpx),maxLon:QRe(t,"maxlon",HRe.gpx)};if(C(e.minLat)||C(e.maxLat)||C(e.minLon)||C(e.maxLon))return e}}"undefined"!==typeof document&&(nLe=document.createElement("div"));const pLe={wpt:oLe,rte:rLe,trk:sLe};function mLe(e,t,n,i){const o=Object.keys(pLe),r=o.length;for(let s=0;s<r;s++){const r=o[s],a=pLe[r],c=t.childNodes,l=c.length;for(let t=0;t<l;t++){const o=c[t];o.localName===r&&-1!==HRe.gpx.indexOf(o.namespaceURI)&&a(e,o,n,i)}}}function _Le(e,t,n){const i=e._entityCollection;i.removeAll();const o=t.documentElement,r=YRe(o,"version"),s=YRe(o,"creator");let a;const c=cLe(o);let l;C(c)&&(a=c.name),"gpx"===o.localName?mLe(e,o,i,n):console.log(`GPX - Unsupported node: ${o.localName}`);const u=i.computeAvailability();let h=u.start,d=u.stop;const f=Ea.equals(h,fO.MINIMUM_VALUE),p=Ea.equals(d,fO.MAXIMUM_VALUE);if(!f||!p){let e;f&&(e=new Date,e.setHours(0,0,0,0),h=Ea.fromDate(e)),p&&(e=new Date,e.setHours(24,0,0,0),d=Ea.fromDate(e)),l=new qwe,l.startTime=h,l.stopTime=d,l.currentTime=Ea.clone(h),l.clockRange=uy.LOOP_STOP,l.clockStep=dy.SYSTEM_CLOCK_MULTIPLIER,l.multiplier=Math.round(Math.min(Math.max(Ea.secondsDifference(d,h)/60,1),31556900))}let m=!1;return e._name!==a&&(e._name=a,m=!0),e._creator!==s&&(e._creator=s,m=!0),gLe(e._metadata,c)&&(e._metadata=c,m=!0),e._version!==r&&(e._version=r,m=!0),l!==e._clock&&(m=!0,e._clock=l),m&&e._changed.raiseEvent(e),hAe.setLoading(e,!1),e}function gLe(e,t){return!(!C(e)&&!C(t))&&(!C(e)||!C(t)||(e.name!==t.name||e.dec!==t.desc||e.src!==t.src||e.author!==t.author||e.copyright!==t.copyright||e.link!==t.link||e.time!==t.time||e.bounds!==t.bounds))}function yLe(e,t,n,i){i=R(i,R.EMPTY_OBJECT);let o=n;if("string"===typeof n||n instanceof Vi){n=Vi.createIfNeeded(n),o=n.fetchBlob();const t=e._resourceCredits,i=n.credits;if(C(i)){const e=i.length;for(let n=0;n<e;n++)t.push(i[n])}}return Promise.resolve(o).then((function(t){return t instanceof Blob?GRe(t).then((function(t){let n,o;try{n=MRe.parseFromString(t,"application/xml")}catch(r){o=r.toString()}if(C(o)||n.body||"parsererror"===n.documentElement.tagName){let e=C(o)?o:n.documentElement.firstChild.nodeValue;throw e||(e=n.body.innerText),new Je(e)}return _Le(e,n,i)})):_Le(e,t,i)})).catch((function(t){return e._error.raiseEvent(e,t),console.log(t),Promise.reject(t)}))}function vLe(){this._changed=new $n,this._error=new $n,this._loading=new $n,this._clock=void 0,this._entityCollection=new Nbe,this._entityCluster=new Lwe,this._name=void 0,this._version=void 0,this._creator=void 0,this._metadata=void 0,this._isLoading=!1,this._pinBuilder=new lD}vLe.load=function(e,t){return(new vLe).load(e,t)},Object.defineProperties(vLe.prototype,{name:{get:function(){return this._name}},version:{get:function(){return this._version}},creator:{get:function(){return this._creator}},metadata:{get:function(){return this._metadata}},clock:{get:function(){return this._clock}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(e){this._entityCollection.show=e}},clustering:{get:function(){return this._entityCluster},set:function(e){if(!C(e))throw new x("value must be defined.");this._entityCluster=e}}}),vLe.prototype.update=function(e){return!0},vLe.prototype.load=function(e,t){if(!C(e))throw new x("data is required.");t=R(t,R.EMPTY_OBJECT),hAe.setLoading(this,!0);const n=this._name,i=this;return yLe(this,this._entityCollection,e,t).then((function(){let e;const t=i._entityCollection.computeAvailability();let o=t.start,r=t.stop;const s=Ea.equals(o,fO.MINIMUM_VALUE),a=Ea.equals(r,fO.MAXIMUM_VALUE);if(!s||!a){let t;s&&(t=new Date,t.setHours(0,0,0,0),o=Ea.fromDate(t)),a&&(t=new Date,t.setHours(24,0,0,0),r=Ea.fromDate(t)),e=new qwe,e.startTime=o,e.stopTime=r,e.currentTime=Ea.clone(o),e.clockRange=uy.LOOP_STOP,e.clockStep=dy.SYSTEM_CLOCK_MULTIPLIER,e.multiplier=Math.round(Math.min(Math.max(Ea.secondsDifference(r,o)/60,1),31556900))}let c=!1;return e!==i._clock&&(i._clock=e,c=!0),n!==i._name&&(c=!0),c&&i._changed.raiseEvent(i),hAe.setLoading(i,!1),i})).catch((function(e){return hAe.setLoading(i,!1),i._error.raiseEvent(i,e),console.log(e),Promise.reject(e)}))};const bLe=15,ALe=30,wLe=19,TLe=29,CLe=256,ELe=CLe+1+TLe,xLe=2*ELe+1,SLe=256,ILe=7,OLe=16,DLe=17,PLe=18,RLe=16,LLe=-1,MLe=1,BLe=2,NLe=0,FLe=0,zLe=1,kLe=3,ULe=4,VLe=0,HLe=1,GLe=2,WLe=-2,qLe=-3,jLe=-5;function YLe(e){return KLe(e.map((([e,t])=>new Array(e).fill(t,0,e))))}function KLe(e){return e.reduce(((e,t)=>e.concat(Array.isArray(t)?KLe(t):t)),[])}const XLe=[0,1,2,3].concat(...YLe([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function QLe(){const e=this;function t(t){const n=e.dyn_tree,i=e.stat_desc.static_tree,o=e.stat_desc.extra_bits,r=e.stat_desc.extra_base,s=e.stat_desc.max_length;let a,c,l,u,h,d,f=0;for(u=0;u<=bLe;u++)t.bl_count[u]=0;for(n[2*t.heap[t.heap_max]+1]=0,a=t.heap_max+1;a<xLe;a++)c=t.heap[a],u=n[2*n[2*c+1]+1]+1,u>s&&(u=s,f++),n[2*c+1]=u,c>e.max_code||(t.bl_count[u]++,h=0,c>=r&&(h=o[c-r]),d=n[2*c],t.opt_len+=d*(u+h),i&&(t.static_len+=d*(i[2*c+1]+h)));if(0!==f){do{u=s-1;while(0===t.bl_count[u])u--;t.bl_count[u]--,t.bl_count[u+1]+=2,t.bl_count[s]--,f-=2}while(f>0);for(u=s;0!==u;u--){c=t.bl_count[u];while(0!==c)l=t.heap[--a],l>e.max_code||(n[2*l+1]!=u&&(t.opt_len+=(u-n[2*l+1])*n[2*l],n[2*l+1]=u),c--)}}}function n(e,t){let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function i(e,t,i){const o=[];let r,s,a,c=0;for(r=1;r<=bLe;r++)o[r]=c=c+i[r-1]<<1;for(s=0;s<=t;s++)a=e[2*s+1],0!==a&&(e[2*s]=n(o[a]++,a))}e.build_tree=function(n){const o=e.dyn_tree,r=e.stat_desc.static_tree,s=e.stat_desc.elems;let a,c,l,u=-1;for(n.heap_len=0,n.heap_max=xLe,a=0;a<s;a++)0!==o[2*a]?(n.heap[++n.heap_len]=u=a,n.depth[a]=0):o[2*a+1]=0;while(n.heap_len<2)l=n.heap[++n.heap_len]=u<2?++u:0,o[2*l]=1,n.depth[l]=0,n.opt_len--,r&&(n.static_len-=r[2*l+1]);for(e.max_code=u,a=Math.floor(n.heap_len/2);a>=1;a--)n.pqdownheap(o,a);l=s;do{a=n.heap[1],n.heap[1]=n.heap[n.heap_len--],n.pqdownheap(o,1),c=n.heap[1],n.heap[--n.heap_max]=a,n.heap[--n.heap_max]=c,o[2*l]=o[2*a]+o[2*c],n.depth[l]=Math.max(n.depth[a],n.depth[c])+1,o[2*a+1]=o[2*c+1]=l,n.heap[1]=l++,n.pqdownheap(o,1)}while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],t(n),i(o,e.max_code,n.bl_count)}}function JLe(e,t,n,i,o){const r=this;r.static_tree=e,r.extra_bits=t,r.extra_base=n,r.elems=i,r.max_length=o}QLe._length_code=[0,1,2,3,4,5,6,7].concat(...YLe([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]])),QLe.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],QLe.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],QLe.d_code=function(e){return e<256?XLe[e]:XLe[256+(e>>>7)]},QLe.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],QLe.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],QLe.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],QLe.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];const ZLe=[12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227],$Le=YLe([[144,8],[112,9],[24,7],[8,8]]);JLe.static_ltree=KLe(ZLe.map(((e,t)=>[e,$Le[t]])));const eMe=[0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23],tMe=YLe([[30,5]]);JLe.static_dtree=KLe(eMe.map(((e,t)=>[e,tMe[t]]))),JLe.static_l_desc=new JLe(JLe.static_ltree,QLe.extra_lbits,CLe+1,ELe,bLe),JLe.static_d_desc=new JLe(JLe.static_dtree,QLe.extra_dbits,0,ALe,bLe),JLe.static_bl_desc=new JLe(null,QLe.extra_blbits,0,wLe,ILe);const nMe=9,iMe=8;function oMe(e,t,n,i,o){const r=this;r.good_length=e,r.max_lazy=t,r.nice_length=n,r.max_chain=i,r.func=o}const rMe=0,sMe=1,aMe=2,cMe=[new oMe(0,0,0,0,rMe),new oMe(4,4,8,4,sMe),new oMe(4,5,16,8,sMe),new oMe(4,6,32,32,sMe),new oMe(4,4,16,16,aMe),new oMe(8,16,32,32,aMe),new oMe(8,16,128,128,aMe),new oMe(8,32,128,256,aMe),new oMe(32,128,258,1024,aMe),new oMe(32,258,258,4096,aMe)],lMe=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],uMe=0,hMe=1,dMe=2,fMe=3,pMe=32,mMe=42,_Me=113,gMe=666,yMe=8,vMe=0,bMe=1,AMe=2,wMe=3,TMe=258,CMe=TMe+wMe+1;function EMe(e,t,n,i){const o=e[2*t],r=e[2*n];return o<r||o==r&&i[t]<=i[n]}function xMe(){const e=this;let t,n,i,o,r,s,a,c,l,u,h,d,f,p,m,_,g,y,v,b,A,w,T,C,E,x,S,I,O,D,P,R,L;const M=new QLe,B=new QLe,N=new QLe;let F,z,k,U,V,H;function G(){l=2*r,h[f-1]=0;for(let e=0;e<f-1;e++)h[e]=0;x=cMe[S].max_lazy,O=cMe[S].good_length,D=cMe[S].nice_length,E=cMe[S].max_chain,A=0,g=0,T=0,y=C=wMe-1,b=0,d=0}function W(){let t;for(t=0;t<ELe;t++)P[2*t]=0;for(t=0;t<ALe;t++)R[2*t]=0;for(t=0;t<wLe;t++)L[2*t]=0;P[2*SLe]=1,e.opt_len=e.static_len=0,z=k=0}function q(){M.dyn_tree=P,M.stat_desc=JLe.static_l_desc,B.dyn_tree=R,B.stat_desc=JLe.static_d_desc,N.dyn_tree=L,N.stat_desc=JLe.static_bl_desc,V=0,H=0,U=8,W()}function j(e,t){let n,i=-1,o=e[1],r=0,s=7,a=4;0===o&&(s=138,a=3),e[2*(t+1)+1]=65535;for(let c=0;c<=t;c++)n=o,o=e[2*(c+1)+1],++r<s&&n==o||(r<a?L[2*n]+=r:0!==n?(n!=i&&L[2*n]++,L[2*OLe]++):r<=10?L[2*DLe]++:L[2*PLe]++,r=0,i=n,0===o?(s=138,a=3):n==o?(s=6,a=3):(s=7,a=4))}function Y(){let t;for(j(P,M.max_code),j(R,B.max_code),N.build_tree(e),t=wLe-1;t>=3;t--)if(0!==L[2*QLe.bl_order[t]+1])break;return e.opt_len+=3*(t+1)+5+5+4,t}function K(t){e.pending_buf[e.pending++]=t}function X(e){K(255&e),K(e>>>8&255)}function Q(e){K(e>>8&255),K(255&e)}function J(e,t){let n;const i=t;H>RLe-i?(n=e,V|=n<<H&65535,X(V),V=n>>>RLe-H,H+=i-RLe):(V|=e<<H&65535,H+=i)}function Z(e,t){const n=2*e;J(65535&t[n],65535&t[n+1])}function $(e,t){let n,i,o=-1,r=e[1],s=0,a=7,c=4;for(0===r&&(a=138,c=3),n=0;n<=t;n++)if(i=r,r=e[2*(n+1)+1],!(++s<a&&i==r)){if(s<c)do{Z(i,L)}while(0!==--s);else 0!==i?(i!=o&&(Z(i,L),s--),Z(OLe,L),J(s-3,2)):s<=10?(Z(DLe,L),J(s-3,3)):(Z(PLe,L),J(s-11,7));s=0,o=i,0===r?(a=138,c=3):i==r?(a=6,c=3):(a=7,c=4)}}function ee(e,t,n){let i;for(J(e-257,5),J(t-1,5),J(n-4,4),i=0;i<n;i++)J(L[2*QLe.bl_order[i]+1],3);$(P,e-1),$(R,t-1)}function te(){16==H?(X(V),V=0,H=0):H>=8&&(K(255&V),V>>>=8,H-=8)}function ne(){J(bMe<<1,3),Z(SLe,JLe.static_ltree),te(),1+U+10-H<9&&(J(bMe<<1,3),Z(SLe,JLe.static_ltree),te()),U=7}function ie(t,n){let i,o,r;if(e.dist_buf[z]=t,e.lc_buf[z]=255&n,z++,0===t?P[2*n]++:(k++,t--,P[2*(QLe._length_code[n]+CLe+1)]++,R[2*QLe.d_code(t)]++),0===(8191&z)&&S>2){for(i=8*z,o=A-g,r=0;r<ALe;r++)i+=R[2*r]*(5+QLe.extra_dbits[r]);if(i>>>=3,k<Math.floor(z/2)&&i<Math.floor(o/2))return!0}return z==F-1}function oe(t,n){let i,o,r,s,a=0;if(0!==z)do{i=e.dist_buf[a],o=e.lc_buf[a],a++,0===i?Z(o,t):(r=QLe._length_code[o],Z(r+CLe+1,t),s=QLe.extra_lbits[r],0!==s&&(o-=QLe.base_length[r],J(o,s)),i--,r=QLe.d_code(i),Z(r,n),s=QLe.extra_dbits[r],0!==s&&(i-=QLe.base_dist[r],J(i,s)))}while(a<z);Z(SLe,t),U=t[2*SLe+1]}function re(){H>8?X(V):H>0&&K(255&V),V=0,H=0}function se(t,n,i){re(),U=8,i&&(X(n),X(~n)),e.pending_buf.set(c.subarray(t,t+n),e.pending),e.pending+=n}function ae(e,t,n){J((vMe<<1)+(n?1:0),3),se(e,t,!0)}function ce(t,n,i){let o,r,s=0;S>0?(M.build_tree(e),B.build_tree(e),s=Y(),o=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=o&&(o=r)):o=r=n+5,n+4<=o&&-1!=t?ae(t,n,i):r==o?(J((bMe<<1)+(i?1:0),3),oe(JLe.static_ltree,JLe.static_dtree)):(J((AMe<<1)+(i?1:0),3),ee(M.max_code+1,B.max_code+1,s+1),oe(P,R)),W(),i&&re()}function le(e){ce(g>=0?g:-1,A-g,e),g=A,t.flush_pending()}function ue(){let e,n,i,o;do{if(o=l-T-A,0===o&&0===A&&0===T)o=r;else if(-1==o)o--;else if(A>=r+r-CMe){c.set(c.subarray(r,r+r),0),w-=r,A-=r,g-=r,e=f,i=e;do{n=65535&h[--i],h[i]=n>=r?n-r:0}while(0!==--e);e=r,i=e;do{n=65535&u[--i],u[i]=n>=r?n-r:0}while(0!==--e);o+=r}if(0===t.avail_in)return;e=t.read_buf(c,A+T,o),T+=e,T>=wMe&&(d=255&c[A],d=(d<<_^255&c[A+1])&m)}while(T<CMe&&0!==t.avail_in)}function he(e){let n,o=65535;o>i-5&&(o=i-5);while(1){if(T<=1){if(ue(),0===T&&e==FLe)return uMe;if(0===T)break}if(A+=T,T=0,n=g+o,(0===A||A>=n)&&(T=A-n,A=n,le(!1),0===t.avail_out))return uMe;if(A-g>=r-CMe&&(le(!1),0===t.avail_out))return uMe}return le(e==ULe),0===t.avail_out?e==ULe?dMe:uMe:e==ULe?fMe:hMe}function de(e){let t,n,i=E,o=A,s=C;const l=A>r-CMe?A-(r-CMe):0;let h=D;const d=a,f=A+TMe;let p=c[o+s-1],m=c[o+s];C>=O&&(i>>=2),h>T&&(h=T);do{if(t=e,c[t+s]==m&&c[t+s-1]==p&&c[t]==c[o]&&c[++t]==c[o+1]){o+=2,t++;do{}while(c[++o]==c[++t]&&c[++o]==c[++t]&&c[++o]==c[++t]&&c[++o]==c[++t]&&c[++o]==c[++t]&&c[++o]==c[++t]&&c[++o]==c[++t]&&c[++o]==c[++t]&&o<f);if(n=TMe-(f-o),o=f-TMe,n>s){if(w=e,s=n,n>=h)break;p=c[o+s-1],m=c[o+s]}}}while((e=65535&u[e&d])>l&&0!==--i);return s<=T?s:T}function fe(e){let n,i=0;while(1){if(T<CMe){if(ue(),T<CMe&&e==FLe)return uMe;if(0===T)break}if(T>=wMe&&(d=(d<<_^255&c[A+(wMe-1)])&m,i=65535&h[d],u[A&a]=h[d],h[d]=A),0!==i&&(A-i&65535)<=r-CMe&&I!=BLe&&(y=de(i)),y>=wMe)if(n=ie(A-w,y-wMe),T-=y,y<=x&&T>=wMe){y--;do{A++,d=(d<<_^255&c[A+(wMe-1)])&m,i=65535&h[d],u[A&a]=h[d],h[d]=A}while(0!==--y);A++}else A+=y,y=0,d=255&c[A],d=(d<<_^255&c[A+1])&m;else n=ie(0,255&c[A]),T--,A++;if(n&&(le(!1),0===t.avail_out))return uMe}return le(e==ULe),0===t.avail_out?e==ULe?dMe:uMe:e==ULe?fMe:hMe}function pe(e){let n,i,o=0;while(1){if(T<CMe){if(ue(),T<CMe&&e==FLe)return uMe;if(0===T)break}if(T>=wMe&&(d=(d<<_^255&c[A+(wMe-1)])&m,o=65535&h[d],u[A&a]=h[d],h[d]=A),C=y,v=w,y=wMe-1,0!==o&&C<x&&(A-o&65535)<=r-CMe&&(I!=BLe&&(y=de(o)),y<=5&&(I==MLe||y==wMe&&A-w>4096)&&(y=wMe-1)),C>=wMe&&y<=C){i=A+T-wMe,n=ie(A-1-v,C-wMe),T-=C-1,C-=2;do{++A<=i&&(d=(d<<_^255&c[A+(wMe-1)])&m,o=65535&h[d],u[A&a]=h[d],h[d]=A)}while(0!==--C);if(b=0,y=wMe-1,A++,n&&(le(!1),0===t.avail_out))return uMe}else if(0!==b){if(n=ie(0,255&c[A-1]),n&&le(!1),A++,T--,0===t.avail_out)return uMe}else b=1,A++,T--}return 0!==b&&(n=ie(0,255&c[A-1]),b=0),le(e==ULe),0===t.avail_out?e==ULe?dMe:uMe:e==ULe?fMe:hMe}function me(t){return t.total_in=t.total_out=0,t.msg=null,e.pending=0,e.pending_out=0,n=_Me,o=FLe,q(),G(),VLe}e.depth=[],e.bl_count=[],e.heap=[],P=[],R=[],L=[],e.pqdownheap=function(t,n){const i=e.heap,o=i[n];let r=n<<1;while(r<=e.heap_len){if(r<e.heap_len&&EMe(t,i[r+1],i[r],e.depth)&&r++,EMe(t,o,i[r],e.depth))break;i[n]=i[r],n=r,r<<=1}i[n]=o},e.deflateInit=function(t,n,o,l,d,g){return l||(l=yMe),d||(d=iMe),g||(g=NLe),t.msg=null,n==LLe&&(n=6),d<1||d>nMe||l!=yMe||o<9||o>15||n<0||n>9||g<0||g>BLe?WLe:(t.dstate=e,s=o,r=1<<s,a=r-1,p=d+7,f=1<<p,m=f-1,_=Math.floor((p+wMe-1)/wMe),c=new Uint8Array(2*r),u=[],h=[],F=1<<d+6,e.pending_buf=new Uint8Array(4*F),i=4*F,e.dist_buf=new Uint16Array(F),e.lc_buf=new Uint8Array(F),S=n,I=g,me(t))},e.deflateEnd=function(){return n!=mMe&&n!=_Me&&n!=gMe?WLe:(e.lc_buf=null,e.dist_buf=null,e.pending_buf=null,h=null,u=null,c=null,e.dstate=null,n==_Me?qLe:VLe)},e.deflateParams=function(e,t,n){let i=VLe;return t==LLe&&(t=6),t<0||t>9||n<0||n>BLe?WLe:(cMe[S].func!=cMe[t].func&&0!==e.total_in&&(i=e.deflate(zLe)),S!=t&&(S=t,x=cMe[S].max_lazy,O=cMe[S].good_length,D=cMe[S].nice_length,E=cMe[S].max_chain),I=n,i)},e.deflateSetDictionary=function(e,t,i){let o,s=i,l=0;if(!t||n!=mMe)return WLe;if(s<wMe)return VLe;for(s>r-CMe&&(s=r-CMe,l=i-s),c.set(t.subarray(l,l+s),0),A=s,g=s,d=255&c[0],d=(d<<_^255&c[1])&m,o=0;o<=s-wMe;o++)d=(d<<_^255&c[o+(wMe-1)])&m,u[o&a]=h[d],h[d]=o;return VLe},e.deflate=function(i,r){let a,c,l,u,d;if(r>ULe||r<0)return WLe;if(!i.next_out||!i.next_in&&0!==i.avail_in||n==gMe&&r!=ULe)return i.msg=lMe[GLe-WLe],WLe;if(0===i.avail_out)return i.msg=lMe[GLe-jLe],jLe;if(t=i,u=o,o=r,n==mMe&&(c=yMe+(s-8<<4)<<8,l=(S-1&255)>>1,l>3&&(l=3),c|=l<<6,0!==A&&(c|=pMe),c+=31-c%31,n=_Me,Q(c)),0!==e.pending){if(t.flush_pending(),0===t.avail_out)return o=-1,VLe}else if(0===t.avail_in&&r<=u&&r!=ULe)return t.msg=lMe[GLe-jLe],jLe;if(n==gMe&&0!==t.avail_in)return i.msg=lMe[GLe-jLe],jLe;if(0!==t.avail_in||0!==T||r!=FLe&&n!=gMe){switch(d=-1,cMe[S].func){case rMe:d=he(r);break;case sMe:d=fe(r);break;case aMe:d=pe(r);break}if(d!=dMe&&d!=fMe||(n=gMe),d==uMe||d==dMe)return 0===t.avail_out&&(o=-1),VLe;if(d==hMe){if(r==zLe)ne();else if(ae(0,0,!1),r==kLe)for(a=0;a<f;a++)h[a]=0;if(t.flush_pending(),0===t.avail_out)return o=-1,VLe}}return r!=ULe?VLe:HLe}}function SMe(){const e=this;e.next_in_index=0,e.next_out_index=0,e.avail_in=0,e.total_in=0,e.avail_out=0,e.total_out=0}function IMe(e){const t=this,n=new SMe,i=OMe(e&&e.chunkSize?e.chunkSize:65536),o=FLe,r=new Uint8Array(i);let s=e?e.level:LLe;"undefined"==typeof s&&(s=LLe),n.deflateInit(s),n.next_out=r,t.append=function(e,t){let s,a,c=0,l=0,u=0;const h=[];if(e.length){n.next_in_index=0,n.next_in=e,n.avail_in=e.length;do{if(n.next_out_index=0,n.avail_out=i,s=n.deflate(o),s!=VLe)throw new Error("deflating: "+n.msg);n.next_out_index&&(n.next_out_index==i?h.push(new Uint8Array(r)):h.push(r.slice(0,n.next_out_index))),u+=n.next_out_index,t&&n.next_in_index>0&&n.next_in_index!=c&&(t(n.next_in_index),c=n.next_in_index)}while(n.avail_in>0||0===n.avail_out);return h.length>1?(a=new Uint8Array(u),h.forEach((function(e){a.set(e,l),l+=e.length}))):a=h[0]||new Uint8Array(0),a}},t.flush=function(){let e,t,o=0,s=0;const a=[];do{if(n.next_out_index=0,n.avail_out=i,e=n.deflate(ULe),e!=HLe&&e!=VLe)throw new Error("deflating: "+n.msg);i-n.avail_out>0&&a.push(r.slice(0,n.next_out_index)),s+=n.next_out_index}while(n.avail_in>0||0===n.avail_out);return n.deflateEnd(),t=new Uint8Array(s),a.forEach((function(e){t.set(e,o),o+=e.length})),t}}function OMe(e){return e+5*(Math.floor(e/16383)+1)}SMe.prototype={deflateInit:function(e,t){const n=this;return n.dstate=new xMe,t||(t=bLe),n.dstate.deflateInit(n,e,t)},deflate:function(e){const t=this;return t.dstate?t.dstate.deflate(t,e):WLe},deflateEnd:function(){const e=this;if(!e.dstate)return WLe;const t=e.dstate.deflateEnd();return e.dstate=null,t},deflateParams:function(e,t){const n=this;return n.dstate?n.dstate.deflateParams(n,e,t):WLe},deflateSetDictionary:function(e,t){const n=this;return n.dstate?n.dstate.deflateSetDictionary(n,e,t):WLe},read_buf:function(e,t,n){const i=this;let o=i.avail_in;return o>n&&(o=n),0===o?0:(i.avail_in-=o,e.set(i.next_in.subarray(i.next_in_index,i.next_in_index+o),t),i.next_in_index+=o,i.total_in+=o,o)},flush_pending:function(){const e=this;let t=e.dstate.pending;t>e.avail_out&&(t=e.avail_out),0!==t&&(e.next_out.set(e.dstate.pending_buf.subarray(e.dstate.pending_out,e.dstate.pending_out+t),e.next_out_index),e.next_out_index+=t,e.dstate.pending_out+=t,e.total_out+=t,e.avail_out-=t,e.dstate.pending-=t,0===e.dstate.pending&&(e.dstate.pending_out=0))}};const DMe=15,PMe=0,RMe=1,LMe=2,MMe=-2,BMe=-3,NMe=-4,FMe=-5,zMe=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],kMe=1440,UMe=0,VMe=4,HMe=9,GMe=5,WMe=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],qMe=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],jMe=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],YMe=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],KMe=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],XMe=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],QMe=15;function JMe(){const e=this;let t,n,i,o,r,s;function a(e,t,n,a,c,l,u,h,d,f,p){let m,_,g,y,v,b,A,w,T,C,E,x,S,I,O;C=0,v=n;do{i[e[t+C]]++,C++,v--}while(0!==v);if(i[0]==n)return u[0]=-1,h[0]=0,PMe;for(w=h[0],b=1;b<=QMe;b++)if(0!==i[b])break;for(A=b,w<b&&(w=b),v=QMe;0!==v;v--)if(0!==i[v])break;for(g=v,w>v&&(w=v),h[0]=w,I=1<<b;b<v;b++,I<<=1)if((I-=i[b])<0)return BMe;if((I-=i[v])<0)return BMe;i[v]+=I,s[1]=b=0,C=1,S=2;while(0!==--v)s[S]=b+=i[C],S++,C++;v=0,C=0;do{0!==(b=e[t+C])&&(p[s[b]++]=v),C++}while(++v<n);for(n=s[g],s[0]=v=0,C=0,y=-1,x=-w,r[0]=0,E=0,O=0;A<=g;A++){m=i[A];while(0!==m--){while(A>x+w){if(y++,x+=w,O=g-x,O=O>w?w:O,(_=1<<(b=A-x))>m+1&&(_-=m+1,S=A,b<O))while(++b<O){if((_<<=1)<=i[++S])break;_-=i[S]}if(O=1<<b,f[0]+O>kMe)return BMe;r[y]=E=f[0],f[0]+=O,0!==y?(s[y]=v,o[0]=b,o[1]=w,b=v>>>x-w,o[2]=E-r[y-1]-b,d.set(o,3*(r[y-1]+b))):u[0]=E}for(o[1]=A-x,C>=n?o[0]=192:p[C]<a?(o[0]=p[C]<256?0:96,o[2]=p[C++]):(o[0]=l[p[C]-a]+16+64,o[2]=c[p[C++]-a]),_=1<<A-x,b=v>>>x;b<O;b+=_)d.set(o,3*(E+b));for(b=1<<A-1;0!==(v&b);b>>>=1)v^=b;v^=b,T=(1<<x)-1;while((v&T)!=s[y])y--,x-=w,T=(1<<x)-1}}return 0!==I&&1!=g?FMe:PMe}function c(e){let a;for(t||(t=[],n=[],i=new Int32Array(QMe+1),o=[],r=new Int32Array(QMe),s=new Int32Array(QMe+1)),n.length<e&&(n=[]),a=0;a<e;a++)n[a]=0;for(a=0;a<QMe+1;a++)i[a]=0;for(a=0;a<3;a++)o[a]=0;r.set(i.subarray(0,QMe),0),s.set(i.subarray(0,QMe+1),0)}e.inflate_trees_bits=function(e,i,o,r,s){let l;return c(19),t[0]=0,l=a(e,0,19,19,null,null,o,i,r,t,n),l==BMe?s.msg="oversubscribed dynamic bit lengths tree":l!=FMe&&0!==i[0]||(s.msg="incomplete dynamic bit lengths tree",l=BMe),l},e.inflate_trees_dynamic=function(e,i,o,r,s,l,u,h,d){let f;return c(288),t[0]=0,f=a(o,0,e,257,jMe,YMe,l,r,h,t,n),f!=PMe||0===r[0]?(f==BMe?d.msg="oversubscribed literal/length tree":f!=NMe&&(d.msg="incomplete literal/length tree",f=BMe),f):(c(288),f=a(o,e,i,0,KMe,XMe,u,s,h,t,n),f!=PMe||0===s[0]&&e>257?(f==BMe?d.msg="oversubscribed distance tree":f==FMe?(d.msg="incomplete distance tree",f=BMe):f!=NMe&&(d.msg="empty distance tree with lengths",f=BMe),f):PMe)}}JMe.inflate_trees_fixed=function(e,t,n,i){return e[0]=HMe,t[0]=GMe,n[0]=WMe,i[0]=qMe,PMe};const ZMe=0,$Me=1,eBe=2,tBe=3,nBe=4,iBe=5,oBe=6,rBe=7,sBe=8,aBe=9;function cBe(){const e=this;let t,n,i,o,r=0,s=0,a=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0;function m(e,t,n,i,o,r,s,a){let c,l,u,h,d,f,p,m,_,g,y,v,b,A,w,T;p=a.next_in_index,m=a.avail_in,d=s.bitb,f=s.bitk,_=s.write,g=_<s.read?s.read-_-1:s.end-_,y=zMe[e],v=zMe[t];do{while(f<20)m--,d|=(255&a.read_byte(p++))<<f,f+=8;if(c=d&y,l=n,u=i,T=3*(u+c),0!==(h=l[T]))do{if(d>>=l[T+1],f-=l[T+1],0!==(16&h)){h&=15,b=l[T+2]+(d&zMe[h]),d>>=h,f-=h;while(f<15)m--,d|=(255&a.read_byte(p++))<<f,f+=8;c=d&v,l=o,u=r,T=3*(u+c),h=l[T];do{if(d>>=l[T+1],f-=l[T+1],0!==(16&h)){h&=15;while(f<h)m--,d|=(255&a.read_byte(p++))<<f,f+=8;if(A=l[T+2]+(d&zMe[h]),d>>=h,f-=h,g-=b,_>=A)w=_-A,_-w>0&&2>_-w?(s.win[_++]=s.win[w++],s.win[_++]=s.win[w++],b-=2):(s.win.set(s.win.subarray(w,w+2),_),_+=2,w+=2,b-=2);else{w=_-A;do{w+=s.end}while(w<0);if(h=s.end-w,b>h){if(b-=h,_-w>0&&h>_-w)do{s.win[_++]=s.win[w++]}while(0!==--h);else s.win.set(s.win.subarray(w,w+h),_),_+=h,w+=h,h=0;w=0}}if(_-w>0&&b>_-w)do{s.win[_++]=s.win[w++]}while(0!==--b);else s.win.set(s.win.subarray(w,w+b),_),_+=b,w+=b,b=0;break}if(0!==(64&h))return a.msg="invalid distance code",b=a.avail_in-m,b=f>>3<b?f>>3:b,m+=b,p-=b,f-=b<<3,s.bitb=d,s.bitk=f,a.avail_in=m,a.total_in+=p-a.next_in_index,a.next_in_index=p,s.write=_,BMe;c+=l[T+2],c+=d&zMe[h],T=3*(u+c),h=l[T]}while(1);break}if(0!==(64&h))return 0!==(32&h)?(b=a.avail_in-m,b=f>>3<b?f>>3:b,m+=b,p-=b,f-=b<<3,s.bitb=d,s.bitk=f,a.avail_in=m,a.total_in+=p-a.next_in_index,a.next_in_index=p,s.write=_,RMe):(a.msg="invalid literal/length code",b=a.avail_in-m,b=f>>3<b?f>>3:b,m+=b,p-=b,f-=b<<3,s.bitb=d,s.bitk=f,a.avail_in=m,a.total_in+=p-a.next_in_index,a.next_in_index=p,s.write=_,BMe);if(c+=l[T+2],c+=d&zMe[h],T=3*(u+c),0===(h=l[T])){d>>=l[T+1],f-=l[T+1],s.win[_++]=l[T+2],g--;break}}while(1);else d>>=l[T+1],f-=l[T+1],s.win[_++]=l[T+2],g--}while(g>=258&&m>=10);return b=a.avail_in-m,b=f>>3<b?f>>3:b,m+=b,p-=b,f-=b<<3,s.bitb=d,s.bitk=f,a.avail_in=m,a.total_in+=p-a.next_in_index,a.next_in_index=p,s.write=_,PMe}e.init=function(e,r,s,a,c,l){t=ZMe,h=e,d=r,i=s,f=a,o=c,p=l,n=null},e.proc=function(e,_,g){let y,v,b,A,w,T,C,E=0,x=0,S=0;S=_.next_in_index,A=_.avail_in,E=e.bitb,x=e.bitk,w=e.write,T=w<e.read?e.read-w-1:e.end-w;while(1)switch(t){case ZMe:if(T>=258&&A>=10&&(e.bitb=E,e.bitk=x,_.avail_in=A,_.total_in+=S-_.next_in_index,_.next_in_index=S,e.write=w,g=m(h,d,i,f,o,p,e,_),S=_.next_in_index,A=_.avail_in,E=e.bitb,x=e.bitk,w=e.write,T=w<e.read?e.read-w-1:e.end-w,g!=PMe)){t=g==RMe?rBe:aBe;break}a=h,n=i,s=f,t=$Me;case $Me:y=a;while(x<y){if(0===A)return e.bitb=E,e.bitk=x,_.avail_in=A,_.total_in+=S-_.next_in_index,_.next_in_index=S,e.write=w,e.inflate_flush(_,g);g=PMe,A--,E|=(255&_.read_byte(S++))<<x,x+=8}if(v=3*(s+(E&zMe[y])),E>>>=n[v+1],x-=n[v+1],b=n[v],0===b){c=n[v+2],t=oBe;break}if(0!==(16&b)){l=15&b,r=n[v+2],t=eBe;break}if(0===(64&b)){a=b,s=v/3+n[v+2];break}if(0!==(32&b)){t=rBe;break}return t=aBe,_.msg="invalid literal/length code",g=BMe,e.bitb=E,e.bitk=x,_.avail_in=A,_.total_in+=S-_.next_in_index,_.next_in_index=S,e.write=w,e.inflate_flush(_,g);case eBe:y=l;while(x<y){if(0===A)return e.bitb=E,e.bitk=x,_.avail_in=A,_.total_in+=S-_.next_in_index,_.next_in_index=S,e.write=w,e.inflate_flush(_,g);g=PMe,A--,E|=(255&_.read_byte(S++))<<x,x+=8}r+=E&zMe[y],E>>=y,x-=y,a=d,n=o,s=p,t=tBe;case tBe:y=a;while(x<y){if(0===A)return e.bitb=E,e.bitk=x,_.avail_in=A,_.total_in+=S-_.next_in_index,_.next_in_index=S,e.write=w,e.inflate_flush(_,g);g=PMe,A--,E|=(255&_.read_byte(S++))<<x,x+=8}if(v=3*(s+(E&zMe[y])),E>>=n[v+1],x-=n[v+1],b=n[v],0!==(16&b)){l=15&b,u=n[v+2],t=nBe;break}if(0===(64&b)){a=b,s=v/3+n[v+2];break}return t=aBe,_.msg="invalid distance code",g=BMe,e.bitb=E,e.bitk=x,_.avail_in=A,_.total_in+=S-_.next_in_index,_.next_in_index=S,e.write=w,e.inflate_flush(_,g);case nBe:y=l;while(x<y){if(0===A)return e.bitb=E,e.bitk=x,_.avail_in=A,_.total_in+=S-_.next_in_index,_.next_in_index=S,e.write=w,e.inflate_flush(_,g);g=PMe,A--,E|=(255&_.read_byte(S++))<<x,x+=8}u+=E&zMe[y],E>>=y,x-=y,t=iBe;case iBe:C=w-u;while(C<0)C+=e.end;while(0!==r){if(0===T&&(w==e.end&&0!==e.read&&(w=0,T=w<e.read?e.read-w-1:e.end-w),0===T&&(e.write=w,g=e.inflate_flush(_,g),w=e.write,T=w<e.read?e.read-w-1:e.end-w,w==e.end&&0!==e.read&&(w=0,T=w<e.read?e.read-w-1:e.end-w),0===T)))return e.bitb=E,e.bitk=x,_.avail_in=A,_.total_in+=S-_.next_in_index,_.next_in_index=S,e.write=w,e.inflate_flush(_,g);e.win[w++]=e.win[C++],T--,C==e.end&&(C=0),r--}t=ZMe;break;case oBe:if(0===T&&(w==e.end&&0!==e.read&&(w=0,T=w<e.read?e.read-w-1:e.end-w),0===T&&(e.write=w,g=e.inflate_flush(_,g),w=e.write,T=w<e.read?e.read-w-1:e.end-w,w==e.end&&0!==e.read&&(w=0,T=w<e.read?e.read-w-1:e.end-w),0===T)))return e.bitb=E,e.bitk=x,_.avail_in=A,_.total_in+=S-_.next_in_index,_.next_in_index=S,e.write=w,e.inflate_flush(_,g);g=PMe,e.win[w++]=c,T--,t=ZMe;break;case rBe:if(x>7&&(x-=8,A++,S--),e.write=w,g=e.inflate_flush(_,g),w=e.write,T=w<e.read?e.read-w-1:e.end-w,e.read!=e.write)return e.bitb=E,e.bitk=x,_.avail_in=A,_.total_in+=S-_.next_in_index,_.next_in_index=S,e.write=w,e.inflate_flush(_,g);t=sBe;case sBe:return g=RMe,e.bitb=E,e.bitk=x,_.avail_in=A,_.total_in+=S-_.next_in_index,_.next_in_index=S,e.write=w,e.inflate_flush(_,g);case aBe:return g=BMe,e.bitb=E,e.bitk=x,_.avail_in=A,_.total_in+=S-_.next_in_index,_.next_in_index=S,e.write=w,e.inflate_flush(_,g);default:return g=MMe,e.bitb=E,e.bitk=x,_.avail_in=A,_.total_in+=S-_.next_in_index,_.next_in_index=S,e.write=w,e.inflate_flush(_,g)}},e.free=function(){}}const lBe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],uBe=0,hBe=1,dBe=2,fBe=3,pBe=4,mBe=5,_Be=6,gBe=7,yBe=8,vBe=9;function bBe(e,t){const n=this;let i,o=uBe,r=0,s=0,a=0;const c=[0],l=[0],u=new cBe;let h=0,d=new Int32Array(3*kMe);const f=0,p=new JMe;n.bitk=0,n.bitb=0,n.win=new Uint8Array(t),n.end=t,n.read=0,n.write=0,n.reset=function(e,t){t&&(t[0]=f),o==_Be&&u.free(e),o=uBe,n.bitk=0,n.bitb=0,n.read=n.write=0},n.reset(e,null),n.inflate_flush=function(e,t){let i,o,r;return o=e.next_out_index,r=n.read,i=(r<=n.write?n.write:n.end)-r,i>e.avail_out&&(i=e.avail_out),0!==i&&t==FMe&&(t=PMe),e.avail_out-=i,e.total_out+=i,e.next_out.set(n.win.subarray(r,r+i),o),o+=i,r+=i,r==n.end&&(r=0,n.write==n.end&&(n.write=0),i=n.write-r,i>e.avail_out&&(i=e.avail_out),0!==i&&t==FMe&&(t=PMe),e.avail_out-=i,e.total_out+=i,e.next_out.set(n.win.subarray(r,r+i),o),o+=i,r+=i),e.next_out_index=o,n.read=r,t},n.proc=function(e,t){let f,m,_,g,y,v,b,A;g=e.next_in_index,y=e.avail_in,m=n.bitb,_=n.bitk,v=n.write,b=v<n.read?n.read-v-1:n.end-v;while(1){let w,T,C,E,x,S,I,O;switch(o){case uBe:while(_<3){if(0===y)return n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);t=PMe,y--,m|=(255&e.read_byte(g++))<<_,_+=8}switch(f=7&m,h=1&f,f>>>1){case 0:m>>>=3,_-=3,f=7&_,m>>>=f,_-=f,o=hBe;break;case 1:w=[],T=[],C=[[]],E=[[]],JMe.inflate_trees_fixed(w,T,C,E),u.init(w[0],T[0],C[0],0,E[0],0),m>>>=3,_-=3,o=_Be;break;case 2:m>>>=3,_-=3,o=fBe;break;case 3:return m>>>=3,_-=3,o=vBe,e.msg="invalid block type",t=BMe,n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t)}break;case hBe:while(_<32){if(0===y)return n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);t=PMe,y--,m|=(255&e.read_byte(g++))<<_,_+=8}if((~m>>>16&65535)!=(65535&m))return o=vBe,e.msg="invalid stored block lengths",t=BMe,n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);r=65535&m,m=_=0,o=0!==r?dBe:0!==h?gBe:uBe;break;case dBe:if(0===y)return n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);if(0===b&&(v==n.end&&0!==n.read&&(v=0,b=v<n.read?n.read-v-1:n.end-v),0===b&&(n.write=v,t=n.inflate_flush(e,t),v=n.write,b=v<n.read?n.read-v-1:n.end-v,v==n.end&&0!==n.read&&(v=0,b=v<n.read?n.read-v-1:n.end-v),0===b)))return n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);if(t=PMe,f=r,f>y&&(f=y),f>b&&(f=b),n.win.set(e.read_buf(g,f),v),g+=f,y-=f,v+=f,b-=f,0!==(r-=f))break;o=0!==h?gBe:uBe;break;case fBe:while(_<14){if(0===y)return n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);t=PMe,y--,m|=(255&e.read_byte(g++))<<_,_+=8}if(s=f=16383&m,(31&f)>29||(f>>5&31)>29)return o=vBe,e.msg="too many length or distance symbols",t=BMe,n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);if(f=258+(31&f)+(f>>5&31),!i||i.length<f)i=[];else for(A=0;A<f;A++)i[A]=0;m>>>=14,_-=14,a=0,o=pBe;case pBe:while(a<4+(s>>>10)){while(_<3){if(0===y)return n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);t=PMe,y--,m|=(255&e.read_byte(g++))<<_,_+=8}i[lBe[a++]]=7&m,m>>>=3,_-=3}while(a<19)i[lBe[a++]]=0;if(c[0]=7,f=p.inflate_trees_bits(i,c,l,d,e),f!=PMe)return t=f,t==BMe&&(i=null,o=vBe),n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);a=0,o=mBe;case mBe:while(1){if(f=s,a>=258+(31&f)+(f>>5&31))break;let r,u;f=c[0];while(_<f){if(0===y)return n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);t=PMe,y--,m|=(255&e.read_byte(g++))<<_,_+=8}if(f=d[3*(l[0]+(m&zMe[f]))+1],u=d[3*(l[0]+(m&zMe[f]))+2],u<16)m>>>=f,_-=f,i[a++]=u;else{A=18==u?7:u-14,r=18==u?11:3;while(_<f+A){if(0===y)return n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);t=PMe,y--,m|=(255&e.read_byte(g++))<<_,_+=8}if(m>>>=f,_-=f,r+=m&zMe[A],m>>>=A,_-=A,A=a,f=s,A+r>258+(31&f)+(f>>5&31)||16==u&&A<1)return i=null,o=vBe,e.msg="invalid bit length repeat",t=BMe,n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);u=16==u?i[A-1]:0;do{i[A++]=u}while(0!==--r);a=A}}if(l[0]=-1,x=[],S=[],I=[],O=[],x[0]=9,S[0]=6,f=s,f=p.inflate_trees_dynamic(257+(31&f),1+(f>>5&31),i,x,S,I,O,d,e),f!=PMe)return f==BMe&&(i=null,o=vBe),t=f,n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);u.init(x[0],S[0],d,I[0],d,O[0]),o=_Be;case _Be:if(n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,(t=u.proc(n,e,t))!=RMe)return n.inflate_flush(e,t);if(t=PMe,u.free(e),g=e.next_in_index,y=e.avail_in,m=n.bitb,_=n.bitk,v=n.write,b=v<n.read?n.read-v-1:n.end-v,0===h){o=uBe;break}o=gBe;case gBe:if(n.write=v,t=n.inflate_flush(e,t),v=n.write,b=v<n.read?n.read-v-1:n.end-v,n.read!=n.write)return n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);o=yBe;case yBe:return t=RMe,n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);case vBe:return t=BMe,n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t);default:return t=MMe,n.bitb=m,n.bitk=_,e.avail_in=y,e.total_in+=g-e.next_in_index,e.next_in_index=g,n.write=v,n.inflate_flush(e,t)}}},n.free=function(e){n.reset(e,null),n.win=null,d=null},n.set_dictionary=function(e,t,i){n.win.set(e.subarray(t,t+i),0),n.read=n.write=i},n.sync_point=function(){return o==hBe?1:0}}const ABe=32,wBe=8,TBe=0,CBe=1,EBe=2,xBe=3,SBe=4,IBe=5,OBe=6,DBe=7,PBe=12,RBe=13,LBe=[0,0,255,255];function MBe(){const e=this;function t(e){return e&&e.istate?(e.total_in=e.total_out=0,e.msg=null,e.istate.mode=DBe,e.istate.blocks.reset(e,null),PMe):MMe}e.mode=0,e.method=0,e.was=[0],e.need=0,e.marker=0,e.wbits=0,e.inflateEnd=function(t){return e.blocks&&e.blocks.free(t),e.blocks=null,PMe},e.inflateInit=function(n,i){return n.msg=null,e.blocks=null,i<8||i>15?(e.inflateEnd(n),MMe):(e.wbits=i,n.istate.blocks=new bBe(n,1<<i),t(n),PMe)},e.inflate=function(e,t){let n,i;if(!e||!e.istate||!e.next_in)return MMe;const o=e.istate;t=t==VMe?FMe:PMe,n=FMe;while(1)switch(o.mode){case TBe:if(0===e.avail_in)return n;if(n=t,e.avail_in--,e.total_in++,(15&(o.method=e.read_byte(e.next_in_index++)))!=wBe){o.mode=RBe,e.msg="unknown compression method",o.marker=5;break}if(8+(o.method>>4)>o.wbits){o.mode=RBe,e.msg="invalid win size",o.marker=5;break}o.mode=CBe;case CBe:if(0===e.avail_in)return n;if(n=t,e.avail_in--,e.total_in++,i=255&e.read_byte(e.next_in_index++),((o.method<<8)+i)%31!==0){o.mode=RBe,e.msg="incorrect header check",o.marker=5;break}if(0===(i&ABe)){o.mode=DBe;break}o.mode=EBe;case EBe:if(0===e.avail_in)return n;n=t,e.avail_in--,e.total_in++,o.need=(255&e.read_byte(e.next_in_index++))<<24&4278190080,o.mode=xBe;case xBe:if(0===e.avail_in)return n;n=t,e.avail_in--,e.total_in++,o.need+=(255&e.read_byte(e.next_in_index++))<<16&16711680,o.mode=SBe;case SBe:if(0===e.avail_in)return n;n=t,e.avail_in--,e.total_in++,o.need+=(255&e.read_byte(e.next_in_index++))<<8&65280,o.mode=IBe;case IBe:return 0===e.avail_in?n:(n=t,e.avail_in--,e.total_in++,o.need+=255&e.read_byte(e.next_in_index++),o.mode=OBe,LMe);case OBe:return o.mode=RBe,e.msg="need dictionary",o.marker=0,MMe;case DBe:if(n=o.blocks.proc(e,n),n==BMe){o.mode=RBe,o.marker=0;break}if(n==PMe&&(n=t),n!=RMe)return n;n=t,o.blocks.reset(e,o.was),o.mode=PBe;case PBe:return e.avail_in=0,RMe;case RBe:return BMe;default:return MMe}},e.inflateSetDictionary=function(e,t,n){let i=0,o=n;if(!e||!e.istate||e.istate.mode!=OBe)return MMe;const r=e.istate;return o>=1<<r.wbits&&(o=(1<<r.wbits)-1,i=n-o),r.blocks.set_dictionary(t,i,o),r.mode=DBe,PMe},e.inflateSync=function(e){let n,i,o,r,s;if(!e||!e.istate)return MMe;const a=e.istate;if(a.mode!=RBe&&(a.mode=RBe,a.marker=0),0===(n=e.avail_in))return FMe;i=e.next_in_index,o=a.marker;while(0!==n&&o<4)e.read_byte(i)==LBe[o]?o++:o=0!==e.read_byte(i)?0:4-o,i++,n--;return e.total_in+=i-e.next_in_index,e.next_in_index=i,e.avail_in=n,a.marker=o,4!=o?BMe:(r=e.total_in,s=e.total_out,t(e),e.total_in=r,e.total_out=s,a.mode=DBe,PMe)},e.inflateSyncPoint=function(e){return e&&e.istate&&e.istate.blocks?e.istate.blocks.sync_point():MMe}}function BBe(){}function NBe(e){const t=this,n=new BBe,i=e&&e.chunkSize?Math.floor(2*e.chunkSize):131072,o=UMe,r=new Uint8Array(i);let s=!1;n.inflateInit(),n.next_out=r,t.append=function(e,t){const a=[];let c,l,u=0,h=0,d=0;if(0!==e.length){n.next_in_index=0,n.next_in=e,n.avail_in=e.length;do{if(n.next_out_index=0,n.avail_out=i,0!==n.avail_in||s||(n.next_in_index=0,s=!0),c=n.inflate(o),s&&c===FMe){if(0!==n.avail_in)throw new Error("inflating: bad input")}else if(c!==PMe&&c!==RMe)throw new Error("inflating: "+n.msg);if((s||c===RMe)&&n.avail_in===e.length)throw new Error("inflating: bad input");n.next_out_index&&(n.next_out_index===i?a.push(new Uint8Array(r)):a.push(r.slice(0,n.next_out_index))),d+=n.next_out_index,t&&n.next_in_index>0&&n.next_in_index!=u&&(t(n.next_in_index),u=n.next_in_index)}while(n.avail_in>0||0===n.avail_out);return a.length>1?(l=new Uint8Array(d),a.forEach((function(e){l.set(e,h),h+=e.length}))):l=a[0]||new Uint8Array(0),l}},t.flush=function(){n.inflateEnd()}}BBe.prototype={inflateInit:function(e){const t=this;return t.istate=new MBe,e||(e=DMe),t.istate.inflateInit(t,e)},inflate:function(e){const t=this;return t.istate?t.istate.inflate(t,e):MMe},inflateEnd:function(){const e=this;if(!e.istate)return MMe;const t=e.istate.inflateEnd(e);return e.istate=null,t},inflateSync:function(){const e=this;return e.istate?e.istate.inflateSync(e):MMe},inflateSetDictionary:function(e,t){const n=this;return n.istate?n.istate.inflateSetDictionary(n,e,t):MMe},read_byte:function(e){const t=this;return t.next_in[e]},read_buf:function(e,t){const n=this;return n.next_in.subarray(e,e+t)}};const FBe={chunkSize:524288,maxWorkers:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||2,terminateWorkerTimeout:5e3,useWebWorkers:!0,workerScripts:void 0},zBe=Object.assign({},FBe);function kBe(){return zBe}function UBe(e){if(void 0!==e.baseURL&&(zBe.baseURL=e.baseURL),void 0!==e.chunkSize&&(zBe.chunkSize=e.chunkSize),void 0!==e.maxWorkers&&(zBe.maxWorkers=e.maxWorkers),void 0!==e.terminateWorkerTimeout&&(zBe.terminateWorkerTimeout=e.terminateWorkerTimeout),void 0!==e.useWebWorkers&&(zBe.useWebWorkers=e.useWebWorkers),void 0!==e.Deflate&&(zBe.Deflate=e.Deflate),void 0!==e.Inflate&&(zBe.Inflate=e.Inflate),void 0!==e.workerScripts){if(e.workerScripts.deflate){if(!Array.isArray(e.workerScripts.deflate))throw new Error("workerScripts.deflate must be an array");zBe.workerScripts||(zBe.workerScripts={}),zBe.workerScripts.deflate=e.workerScripts.deflate}if(e.workerScripts.inflate){if(!Array.isArray(e.workerScripts.inflate))throw new Error("workerScripts.inflate must be an array");zBe.workerScripts||(zBe.workerScripts={}),zBe.workerScripts.inflate=e.workerScripts.inflate}}}function VBe(){return"application/octet-stream"}const HBe=[];for(let ko=0;ko<256;ko++){let e=ko;for(let t=0;t<8;t++)1&e?e=e>>>1^3988292384:e>>>=1;HBe[ko]=e}class GBe{constructor(e){this.crc=e||-1}append(e){let t=0|this.crc;for(let n=0,i=0|e.length;n<i;n++)t=t>>>8^HBe[255&(t^e[n])];this.crc=t}get(){return~this.crc}}function WBe(e){if("undefined"==typeof TextEncoder){e=unescape(encodeURIComponent(e));const t=new Uint8Array(e.length);for(let n=0;n<t.length;n++)t[n]=e.charCodeAt(n);return t}return(new TextEncoder).encode(e)}const qBe={concat(e,t){if(0===e.length||0===t.length)return e.concat(t);const n=e[e.length-1],i=qBe.getPartial(n);return 32===i?e.concat(t):qBe._shiftRight(t,i,0|n,e.slice(0,e.length-1))},bitLength(e){const t=e.length;if(0===t)return 0;const n=e[t-1];return 32*(t-1)+qBe.getPartial(n)},clamp(e,t){if(32*e.length<t)return e;e=e.slice(0,Math.ceil(t/32));const n=e.length;return t&=31,n>0&&t&&(e[n-1]=qBe.partial(t,e[n-1]&2147483648>>t-1,1)),e},partial(e,t,n){return 32===e?t:(n?0|t:t<<32-e)+1099511627776*e},getPartial(e){return Math.round(e/1099511627776)||32},_shiftRight(e,t,n,i){for(void 0===i&&(i=[]);t>=32;t-=32)i.push(n),n=0;if(0===t)return i.concat(e);for(let s=0;s<e.length;s++)i.push(n|e[s]>>>t),n=e[s]<<32-t;const o=e.length?e[e.length-1]:0,r=qBe.getPartial(o);return i.push(qBe.partial(t+r&31,t+r>32?n:i.pop(),1)),i}},jBe={bytes:{fromBits(e){const t=qBe.bitLength(e),n=t/8,i=new Uint8Array(n);let o;for(let r=0;r<n;r++)0===(3&r)&&(o=e[r/4]),i[r]=o>>>24,o<<=8;return i},toBits(e){const t=[];let n,i=0;for(n=0;n<e.length;n++)i=i<<8|e[n],3===(3&n)&&(t.push(i),i=0);return 3&n&&t.push(qBe.partial(8*(3&n),i)),t}}},YBe={sha1:function(e){e?(this._h=e._h.slice(0),this._buffer=e._buffer.slice(0),this._length=e._length):this.reset()}};YBe.sha1.prototype={blockSize:512,reset:function(){const e=this;return e._h=this._init.slice(0),e._buffer=[],e._length=0,e},update:function(e){const t=this;"string"===typeof e&&(e=jBe.utf8String.toBits(e));const n=t._buffer=qBe.concat(t._buffer,e),i=t._length,o=t._length=i+qBe.bitLength(e);if(o>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");const r=new Uint32Array(n);let s=0;for(let a=t.blockSize+i-(t.blockSize+i&t.blockSize-1);a<=o;a+=t.blockSize)t._block(r.subarray(16*s,16*(s+1))),s+=1;return n.splice(0,16*s),t},finalize:function(){const e=this;let t=e._buffer;const n=e._h;t=qBe.concat(t,[qBe.partial(1,1)]);for(let i=t.length+2;15&i;i++)t.push(0);t.push(Math.floor(e._length/4294967296)),t.push(0|e._length);while(t.length)e._block(t.splice(0,16));return e.reset(),n},_init:[1732584193,4023233417,2562383102,271733878,3285377520],_key:[1518500249,1859775393,2400959708,3395469782],_f:function(e,t,n,i){return e<=19?t&n|~t&i:e<=39?t^n^i:e<=59?t&n|t&i|n&i:e<=79?t^n^i:void 0},_S:function(e,t){return t<<e|t>>>32-e},_block:function(e){const t=this,n=t._h,i=Array(80);for(let l=0;l<16;l++)i[l]=e[l];let o=n[0],r=n[1],s=n[2],a=n[3],c=n[4];for(let l=0;l<=79;l++){l>=16&&(i[l]=t._S(1,i[l-3]^i[l-8]^i[l-14]^i[l-16]));const e=t._S(5,o)+t._f(l,r,s,a)+c+i[l]+t._key[Math.floor(l/20)]|0;c=a,a=s,s=t._S(30,r),r=o,o=e}n[0]=n[0]+o|0,n[1]=n[1]+r|0,n[2]=n[2]+s|0,n[3]=n[3]+a|0,n[4]=n[4]+c|0}};const KBe={aes:class{constructor(e){const t=this;t._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],t._tables[0][0][0]||t._precompute();const n=t._tables[0][4],i=t._tables[1],o=e.length;let r,s,a,c=1;if(4!==o&&6!==o&&8!==o)throw new Error("invalid aes key size");for(t._key=[s=e.slice(0),a=[]],r=o;r<4*o+28;r++){let e=s[r-1];(r%o===0||8===o&&r%o===4)&&(e=n[e>>>24]<<24^n[e>>16&255]<<16^n[e>>8&255]<<8^n[255&e],r%o===0&&(e=e<<8^e>>>24^c<<24,c=c<<1^283*(c>>7))),s[r]=s[r-o]^e}for(let l=0;r;l++,r--){const e=s[3&l?r:r-4];a[l]=r<=4||l<4?e:i[0][n[e>>>24]]^i[1][n[e>>16&255]]^i[2][n[e>>8&255]]^i[3][n[255&e]]}}encrypt(e){return this._crypt(e,0)}decrypt(e){return this._crypt(e,1)}_precompute(){const e=this._tables[0],t=this._tables[1],n=e[4],i=t[4],o=[],r=[];let s,a,c,l;for(let u=0;u<256;u++)r[(o[u]=u<<1^283*(u>>7))^u]=u;for(let u=s=0;!n[u];u^=a||1,s=r[s]||1){let r=s^s<<1^s<<2^s<<3^s<<4;r=r>>8^255&r^99,n[u]=r,i[r]=u,l=o[c=o[a=o[u]]];let h=16843009*l^65537*c^257*a^16843008*u,d=257*o[r]^16843008*r;for(let n=0;n<4;n++)e[n][u]=d=d<<24^d>>>8,t[n][r]=h=h<<24^h>>>8}for(let u=0;u<5;u++)e[u]=e[u].slice(0),t[u]=t[u].slice(0)}_crypt(e,t){if(4!==e.length)throw new Error("invalid aes block size");const n=this._key[t],i=n.length/4-2,o=[0,0,0,0],r=this._tables[t],s=r[0],a=r[1],c=r[2],l=r[3],u=r[4];let h,d,f,p=e[0]^n[0],m=e[t?3:1]^n[1],_=e[2]^n[2],g=e[t?1:3]^n[3],y=4;for(let v=0;v<i;v++)h=s[p>>>24]^a[m>>16&255]^c[_>>8&255]^l[255&g]^n[y],d=s[m>>>24]^a[_>>16&255]^c[g>>8&255]^l[255&p]^n[y+1],f=s[_>>>24]^a[g>>16&255]^c[p>>8&255]^l[255&m]^n[y+2],g=s[g>>>24]^a[p>>16&255]^c[m>>8&255]^l[255&_]^n[y+3],y+=4,p=h,m=d,_=f;for(let v=0;v<4;v++)o[t?3&-v:v]=u[p>>>24]<<24^u[m>>16&255]<<16^u[_>>8&255]<<8^u[255&g]^n[y++],h=p,p=m,m=_,_=g,g=h;return o}}},XBe={getRandomValues(e){const t=new Uint32Array(e.buffer),n=e=>{let t=987654321;const n=4294967295;return function(){t=36969*(65535&t)+(t>>16)&n,e=18e3*(65535&e)+(e>>16)&n;const i=((t<<16)+e&n)/4294967296+.5;return i*(Math.random()>.5?1:-1)}};for(let i,o=0;o<e.length;o+=4){let e=n(4294967296*(i||Math.random()));i=987654071*e(),t[o/4]=4294967296*e()|0}return e}},QBe={ctrGladman:class{constructor(e,t){this._prf=e,this._initIv=t,this._iv=t}reset(){this._iv=this._initIv}update(e){return this.calculate(this._prf,e,this._iv)}incWord(e){if(255===(e>>24&255)){let t=e>>16&255,n=e>>8&255,i=255&e;255===t?(t=0,255===n?(n=0,255===i?i=0:++i):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=i}else e+=1<<24;return e}incCounter(e){0===(e[0]=this.incWord(e[0]))&&(e[1]=this.incWord(e[1]))}calculate(e,t,n){let i;if(!(i=t.length))return[];const o=qBe.bitLength(t);for(let r=0;r<i;r+=4){this.incCounter(n);const i=e.encrypt(n);t[r]^=i[0],t[r+1]^=i[1],t[r+2]^=i[2],t[r+3]^=i[3]}return qBe.clamp(t,o)}}},JBe={importKey(e){return new JBe.hmacSha1(jBe.bytes.toBits(e))},pbkdf2(e,t,n,i){if(n=n||1e4,i<0||n<0)throw new Error("invalid params to pbkdf2");const o=1+(i>>5)<<2;let r,s,a,c,l;const u=new ArrayBuffer(o);let h=new DataView(u),d=0;const f=qBe;for(t=jBe.bytes.toBits(t),l=1;d<(o||1);l++){for(r=s=e.encrypt(f.concat(t,[l])),a=1;a<n;a++)for(s=e.encrypt(s),c=0;c<s.length;c++)r[c]^=s[c];for(a=0;d<(o||1)&&a<r.length;a++)h.setInt32(d,r[a]),d+=4}return u.slice(0,i/8)},hmacSha1:class{constructor(e){const t=this,n=t._hash=YBe.sha1,i=[[],[]],o=n.prototype.blockSize/32;t._baseHash=[new n,new n],e.length>o&&(e=n.hash(e));for(let r=0;r<o;r++)i[0][r]=909522486^e[r],i[1][r]=1549556828^e[r];t._baseHash[0].update(i[0]),t._baseHash[1].update(i[1]),t._resultHash=new n(t._baseHash[0])}reset(){const e=this;e._resultHash=new e._hash(e._baseHash[0]),e._updated=!1}update(e){const t=this;t._updated=!0,t._resultHash.update(e)}digest(){const e=this,t=e._resultHash.finalize(),n=new e._hash(e._baseHash[1]).update(t).finalize();return e.reset(),n}encrypt(e){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(e),this.digest(e)}}},ZBe="Invalid pasword",$Be=16,eNe="raw",tNe={name:"PBKDF2"},nNe={name:"HMAC"},iNe="SHA-1",oNe=Object.assign({hash:nNe},tNe),rNe=Object.assign({iterations:1e3,hash:{name:iNe}},tNe),sNe=["deriveBits"],aNe=[8,12,16],cNe=[16,24,32],lNe=10,uNe=[0,0,0,0],hNe="undefined"!=typeof crypto,dNe=hNe&&"undefined"!=typeof crypto.subtle,fNe=jBe.bytes,pNe=KBe.aes,mNe=QBe.ctrGladman,_Ne=JBe.hmacSha1;class gNe{constructor(e,t,n){Object.assign(this,{password:e,signed:t,strength:n-1,pendingInput:new Uint8Array(0)})}async append(e){const t=this;if(t.password){const n=INe(e,0,aNe[t.strength]+2);await bNe(t,n,t.password),t.password=null,t.aesCtrGladman=new mNe(new pNe(t.keys.key),Array.from(uNe)),t.hmac=new _Ne(t.keys.authentication),e=INe(e,aNe[t.strength]+2)}const n=new Uint8Array(e.length-lNe-(e.length-lNe)%$Be);return vNe(t,e,n,0,lNe,!0)}flush(){const e=this,t=e.pendingInput,n=INe(t,0,t.length-lNe),i=INe(t,t.length-lNe);let o=new Uint8Array(0);if(n.length){const t=fNe.toBits(n);e.hmac.update(t);const i=e.aesCtrGladman.update(t);o=fNe.fromBits(i)}let r=!0;if(e.signed){const t=INe(fNe.fromBits(e.hmac.digest()),0,lNe);for(let e=0;e<lNe;e++)t[e]!=i[e]&&(r=!1)}return{valid:r,data:o}}}class yNe{constructor(e,t){Object.assign(this,{password:e,strength:t-1,pendingInput:new Uint8Array(0)})}async append(e){const t=this;let n=new Uint8Array(0);t.password&&(n=await ANe(t,t.password),t.password=null,t.aesCtrGladman=new mNe(new pNe(t.keys.key),Array.from(uNe)),t.hmac=new _Ne(t.keys.authentication));const i=new Uint8Array(n.length+e.length-e.length%$Be);return i.set(n,0),vNe(t,e,i,n.length,0)}flush(){const e=this;let t=new Uint8Array(0);if(e.pendingInput.length){const n=e.aesCtrGladman.update(fNe.toBits(e.pendingInput));e.hmac.update(n),t=fNe.fromBits(n)}const n=INe(fNe.fromBits(e.hmac.digest()),0,lNe);return{data:xNe(t,n),signature:n}}}function vNe(e,t,n,i,o,r){const s=t.length-o;let a;for(e.pendingInput.length&&(t=xNe(e.pendingInput,t),n=SNe(n,s-s%$Be)),a=0;a<=s-$Be;a+=$Be){const o=fNe.toBits(INe(t,a,a+$Be));r&&e.hmac.update(o);const s=e.aesCtrGladman.update(o);r||e.hmac.update(s),n.set(fNe.fromBits(s),a+i)}return e.pendingInput=INe(t,a),n}async function bNe(e,t,n){await wNe(e,n,INe(t,0,aNe[e.strength]));const i=INe(t,aNe[e.strength]),o=e.keys.passwordVerification;if(o[0]!=i[0]||o[1]!=i[1])throw new Error(ZBe)}async function ANe(e,t){const n=TNe(new Uint8Array(aNe[e.strength]));return await wNe(e,t,n),xNe(n,e.keys.passwordVerification)}async function wNe(e,t,n){const i=WBe(t),o=await CNe(eNe,i,oNe,!1,sNe),r=await ENe(Object.assign({salt:n},rNe),o,8*(2*cNe[e.strength]+2)),s=new Uint8Array(r);e.keys={key:fNe.toBits(INe(s,0,cNe[e.strength])),authentication:fNe.toBits(INe(s,cNe[e.strength],2*cNe[e.strength])),passwordVerification:INe(s,2*cNe[e.strength])}}function TNe(e){return hNe&&"function"==typeof crypto.getRandomValues?crypto.getRandomValues(e):XBe.getRandomValues(e)}async function CNe(e,t,n,i,o){return hNe&&dNe&&"function"==typeof crypto.subtle.importKey?crypto.subtle.importKey(e,t,n,i,o):JBe.importKey(t)}async function ENe(e,t,n){return hNe&&dNe&&"function"==typeof crypto.subtle.deriveBits?await crypto.subtle.deriveBits(e,t,n):JBe.pbkdf2(t,e.salt,rNe.iterations,n)}function xNe(e,t){let n=e;return e.length+t.length&&(n=new Uint8Array(e.length+t.length),n.set(e,0),n.set(t,e.length)),n}function SNe(e,t){if(t&&t>e.length){const n=e;e=new Uint8Array(t),e.set(n,0)}return e}function INe(e,t,n){return e.subarray(t,n)}const ONe=12;class DNe{constructor(e,t){const n=this;Object.assign(n,{password:e,passwordVerification:t}),MNe(n,e)}append(e){const t=this;if(t.password){const n=RNe(t,e.subarray(0,ONe));if(t.password=null,n[ONe-1]!=t.passwordVerification)throw new Error(ZBe);e=e.subarray(ONe)}return RNe(t,e)}flush(){return{valid:!0,data:new Uint8Array(0)}}}class PNe{constructor(e,t){const n=this;Object.assign(n,{password:e,passwordVerification:t}),MNe(n,e)}append(e){const t=this;let n,i;if(t.password){t.password=null;const o=crypto.getRandomValues(new Uint8Array(ONe));o[ONe-1]=t.passwordVerification,n=new Uint8Array(e.length+o.length),n.set(LNe(t,o),0),i=ONe}else n=new Uint8Array(e.length),i=0;return n.set(LNe(t,e),i),n}flush(){return{data:new Uint8Array(0)}}}function RNe(e,t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=NNe(e)^t[i],BNe(e,n[i]);return n}function LNe(e,t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=NNe(e)^t[i],BNe(e,t[i]);return n}function MNe(e,t){e.keys=[305419896,591751049,878082192],e.crcKey0=new GBe(e.keys[0]),e.crcKey2=new GBe(e.keys[2]);for(let n=0;n<t.length;n++)BNe(e,t.charCodeAt(n))}function BNe(e,t){e.crcKey0.append([t]),e.keys[0]=~e.crcKey0.get(),e.keys[1]=zNe(e.keys[1]+FNe(e.keys[0])),e.keys[1]=zNe(Math.imul(e.keys[1],134775813)+1),e.crcKey2.append([e.keys[1]>>>24]),e.keys[2]=~e.crcKey2.get()}function NNe(e){const t=2|e.keys[2];return FNe(Math.imul(t,1^t)>>>8)}function FNe(e){return 255&e}function zNe(e){return 4294967295&e}const kNe="deflate",UNe="inflate",VNe="Invalid signature";class HNe{constructor(e,{signature:t,password:n,signed:i,compressed:o,zipCrypto:r,passwordVerification:s,encryptionStrength:a},{chunkSize:c}){const l=Boolean(n);Object.assign(this,{signature:t,encrypted:l,signed:i,compressed:o,inflate:o&&new e({chunkSize:c}),crc32:i&&new GBe,zipCrypto:r,decrypt:l&&r?new DNe(n,s):new gNe(n,i,a)})}async append(e){const t=this;return t.encrypted&&e.length&&(e=await t.decrypt.append(e)),t.compressed&&e.length&&(e=await t.inflate.append(e)),(!t.encrypted||t.zipCrypto)&&t.signed&&e.length&&t.crc32.append(e),e}async flush(){const e=this;let t,n=new Uint8Array(0);if(e.encrypted){const t=e.decrypt.flush();if(!t.valid)throw new Error(VNe);n=t.data}if((!e.encrypted||e.zipCrypto)&&e.signed){const n=new DataView(new Uint8Array(4).buffer);if(t=e.crc32.get(),n.setUint32(0,t),e.signature!=n.getUint32(0,!1))throw new Error(VNe)}return e.compressed&&(n=await e.inflate.append(n)||new Uint8Array(0),await e.inflate.flush()),{data:n,signature:t}}}class GNe{constructor(e,{encrypted:t,signed:n,compressed:i,level:o,zipCrypto:r,password:s,passwordVerification:a,encryptionStrength:c},{chunkSize:l}){Object.assign(this,{encrypted:t,signed:n,compressed:i,deflate:i&&new e({level:o||5,chunkSize:l}),crc32:n&&new GBe,zipCrypto:r,encrypt:t&&r?new PNe(s,a):new yNe(s,c)})}async append(e){const t=this;let n=e;return t.compressed&&e.length&&(n=await t.deflate.append(e)),t.encrypted&&n.length&&(n=await t.encrypt.append(n)),(!t.encrypted||t.zipCrypto)&&t.signed&&e.length&&t.crc32.append(e),n}async flush(){const e=this;let t,n=new Uint8Array(0);if(e.compressed&&(n=await e.deflate.flush()||new Uint8Array(0)),e.encrypted){n=await e.encrypt.append(n);const i=e.encrypt.flush();t=i.signature;const o=new Uint8Array(n.length+i.data.length);o.set(n,0),o.set(i.data,n.length),n=o}return e.encrypted&&!e.zipCrypto||!e.signed||(t=e.crc32.get()),{data:n,signature:t}}}function WNe(e,t,n){return t.codecType.startsWith(kNe)?new GNe(e,t,n):t.codecType.startsWith(UNe)?new HNe(e,t,n):void 0}const qNe="init",jNe="append",YNe="flush",KNe="message";let XNe=!0;var QNe=(e,t,n,i,o,r,s)=>(Object.assign(e,{busy:!0,codecConstructor:t,options:Object.assign({},n),scripts:s,terminate(){e.worker&&!e.busy&&(e.worker.terminate(),e.interface=null)},onTaskFinished(){e.busy=!1,o(e)}}),r?ZNe(e,i):JNe(e,i));function JNe(e,t){const n=WNe(e.codecConstructor,e.options,t);return{async append(t){try{return await n.append(t)}catch(i){throw e.onTaskFinished(),i}},async flush(){try{return await n.flush()}finally{e.onTaskFinished()}},abort(){e.onTaskFinished()}}}function ZNe(e,t){let n;const i={type:"module"};if(!e.interface){if(XNe)try{e.worker=o({},t.baseURL)}catch(c){XNe=!1,e.worker=o(i,t.baseURL)}else e.worker=o(i,t.baseURL);e.worker.addEventListener(KNe,a,!1),e.interface={append(e){return r({type:jNe,data:e})},flush(){return r({type:YNe})},abort(){e.onTaskFinished()}}}return e.interface;function o(t,n){let i,o;i=e.scripts[0],"function"==typeof i&&(i=i());try{o=new URL(i,n)}catch(c){o=i}return new Worker(o,t)}async function r(i){if(!n){const n=e.options,i=e.scripts.slice(1);await s({scripts:i,type:qNe,options:n,config:{chunkSize:t.chunkSize}})}return s(i)}function s(t){const i=e.worker,o=new Promise(((e,t)=>n={resolve:e,reject:t}));try{if(t.data)try{t.data=t.data.buffer,i.postMessage(t,[t.data])}catch(c){i.postMessage(t)}else i.postMessage(t)}catch(c){n.reject(c),n=null,e.onTaskFinished()}return o}function a(t){const i=t.data;if(n){const t=i.error,o=i.type;if(t){const i=new Error(t.message);i.stack=t.stack,n.reject(i),n=null,e.onTaskFinished()}else if(o==qNe||o==YNe||o==jNe){const t=i.data;o==YNe?(n.resolve({data:new Uint8Array(t),signature:i.signature}),n=null,e.onTaskFinished()):n.resolve(t&&new Uint8Array(t))}}}}let $Ne=[],eFe=[];function tFe(e,t,n){const i=!t.compressed&&!t.signed&&!t.encrypted,o=!i&&(t.useWebWorkers||void 0===t.useWebWorkers&&n.useWebWorkers),r=o&&n.workerScripts?n.workerScripts[t.codecType]:[];if($Ne.length<n.maxWorkers){const i={};return $Ne.push(i),QNe(i,e,t,n,s,o,r)}{const i=$Ne.find((e=>!e.busy));return i?(nFe(i),QNe(i,e,t,n,s,o,r)):new Promise((n=>eFe.push({resolve:n,codecConstructor:e,options:t,webWorker:o,scripts:r})))}function s(e){if(eFe.length){const[{resolve:t,codecConstructor:i,options:o,webWorker:r,scripts:a}]=eFe.splice(0,1);t(QNe(e,i,o,n,s,r,a))}else e.worker?(nFe(e),Number.isFinite(n.terminateWorkerTimeout)&&n.terminateWorkerTimeout>=0&&(e.terminateTimeout=setTimeout((()=>{$Ne=$Ne.filter((t=>t!=e)),e.terminate()}),n.terminateWorkerTimeout))):$Ne=$Ne.filter((t=>t!=e))}}function nFe(e){e.terminateTimeout&&(clearTimeout(e.terminateTimeout),e.terminateTimeout=null)}function iFe(){$Ne.forEach((e=>{nFe(e),e.terminate()}))}const oFe=64,rFe="Abort error";async function sFe(e,t,n,i,o,r,s){const a=Math.max(r.chunkSize,oFe);return c();async function c(r=0,l=0){const u=s.signal;if(r<o){aFe(u,e);const d=await t.readUint8Array(r+i,Math.min(a,o-r)),f=d.length;aFe(u,e);const p=await e.append(d);if(aFe(u,e),l+=await cFe(n,p),s.onprogress)try{s.onprogress(r+f,o)}catch(h){}return c(r+a,l)}{const t=await e.flush();return l+=await cFe(n,t.data),{signature:t.signature,length:l}}}}function aFe(e,t){if(e&&e.aborted)throw t.abort(),new Error(rFe)}async function cFe(e,t){return t.length&&await e.writeUint8Array(t),t.length}const lFe="HTTP error ",uFe="HTTP Range not supported",hFe="text/plain",dFe="Content-Length",fFe="Content-Range",pFe="Accept-Ranges",mFe="Range",_Fe="HEAD",gFe="GET",yFe="bytes";class vFe{constructor(){this.size=0}init(){this.initialized=!0}}class bFe extends vFe{}class AFe extends vFe{writeUint8Array(e){this.size+=e.length}}class wFe extends bFe{constructor(e){super(),this.blobReader=new xFe(new Blob([e],{type:hFe}))}async init(){super.init(),this.blobReader.init(),this.size=this.blobReader.size}async readUint8Array(e,t){return this.blobReader.readUint8Array(e,t)}}class TFe extends AFe{constructor(e){super(),this.encoding=e,this.blob=new Blob([],{type:hFe})}async writeUint8Array(e){super.writeUint8Array(e),this.blob=new Blob([this.blob,e.buffer],{type:hFe})}getData(){if(this.blob.text)return this.blob.text();{const e=new FileReader;return new Promise(((t,n)=>{e.onload=e=>t(e.target.result),e.onerror=()=>n(e.error),e.readAsText(this.blob,this.encoding)}))}}}class CFe extends bFe{constructor(e){super(),this.dataURI=e;let t=e.length;while("="==e.charAt(t-1))t--;this.dataStart=e.indexOf(",")+1,this.size=Math.floor(.75*(t-this.dataStart))}async readUint8Array(e,t){const n=new Uint8Array(t),i=4*Math.floor(e/3),o=atob(this.dataURI.substring(i+this.dataStart,4*Math.ceil((e+t)/3)+this.dataStart)),r=e-3*Math.floor(i/4);for(let s=r;s<r+t;s++)n[s-r]=o.charCodeAt(s);return n}}class EFe extends AFe{constructor(e){super(),this.data="data:"+(e||"")+";base64,",this.pending=[]}async writeUint8Array(e){super.writeUint8Array(e);let t=0,n=this.pending;const i=this.pending.length;for(this.pending="",t=0;t<3*Math.floor((i+e.length)/3)-i;t++)n+=String.fromCharCode(e[t]);for(;t<e.length;t++)this.pending+=String.fromCharCode(e[t]);n.length>2?this.data+=btoa(n):this.pending=n}getData(){return this.data+btoa(this.pending)}}class xFe extends bFe{constructor(e){super(),this.blob=e,this.size=e.size}async readUint8Array(e,t){if(this.blob.arrayBuffer)return new Uint8Array(await this.blob.slice(e,e+t).arrayBuffer());{const n=new FileReader;return new Promise(((i,o)=>{n.onload=e=>i(new Uint8Array(e.target.result)),n.onerror=()=>o(n.error),n.readAsArrayBuffer(this.blob.slice(e,e+t))}))}}}class SFe extends AFe{constructor(e){super(),this.contentType=e,this.arrayBuffers=[]}async writeUint8Array(e){super.writeUint8Array(e),this.arrayBuffers.push(e.buffer)}getData(){return this.blob||(this.blob=new Blob(this.arrayBuffers,{type:this.contentType})),this.blob}}class IFe extends AFe{constructor(e){super(),this.writableStream=e,this.writer=e.getWriter()}async writeUint8Array(e){return await this.writer.ready,this.writer.write(e)}async getData(){return await this.writer.ready,await this.writer.close(),this.writableStream}}class OFe extends bFe{constructor(e,t){super(),this.url=e,this.preventHeadRequest=t.preventHeadRequest,this.useRangeHeader=t.useRangeHeader,this.forceRangeRequests=t.forceRangeRequests,this.options=Object.assign({},t),delete this.options.preventHeadRequest,delete this.options.useRangeHeader,delete this.options.forceRangeRequests,delete this.options.useXHR}async init(){super.init(),await PFe(this,kFe,BFe)}async readUint8Array(e,t){return RFe(this,e,t,kFe,BFe)}}class DFe extends bFe{constructor(e,t){super(),this.url=e,this.preventHeadRequest=t.preventHeadRequest,this.useRangeHeader=t.useRangeHeader,this.forceRangeRequests=t.forceRangeRequests,this.options=t}async init(){super.init(),await PFe(this,UFe,NFe)}async readUint8Array(e,t){return RFe(this,e,t,UFe,NFe)}}async function PFe(e,t,n){if(qFe(e.url)&&(e.useRangeHeader||e.forceRangeRequests)){const i=await t(gFe,e,LFe(e));if(!e.forceRangeRequests&&i.headers.get(pFe)!=yFe)throw new Error(uFe);{let o;const r=i.headers.get(fFe);if(r){const e=r.trim().split(/\s*\/\s*/);if(e.length){const t=e[1];t&&"*"!=t&&(o=Number(t))}}void 0===o?await zFe(e,t,n):e.size=o}}else await zFe(e,t,n)}async function RFe(e,t,n,i,o){if(e.useRangeHeader||e.forceRangeRequests){const o=await i(gFe,e,LFe(e,t,n));if(206!=o.status)throw new Error(uFe);return new Uint8Array(await o.arrayBuffer())}return e.data||await o(e,e.options),new Uint8Array(e.data.subarray(t,t+n))}function LFe(e,t=0,n=1){return Object.assign({},MFe(e),{[mFe]:yFe+"="+t+"-"+(t+n-1)})}function MFe(e){let t=e.options.headers;if(t)return Symbol.iterator in t?Object.fromEntries(t):t}async function BFe(e){await FFe(e,kFe)}async function NFe(e){await FFe(e,UFe)}async function FFe(e,t){const n=await t(gFe,e,MFe(e));e.data=new Uint8Array(await n.arrayBuffer()),e.size||(e.size=e.data.length)}async function zFe(e,t,n){if(e.preventHeadRequest)await n(e,e.options);else{const i=await t(_Fe,e,MFe(e)),o=i.headers.get(dFe);o?e.size=Number(o):await n(e,e.options)}}async function kFe(e,{options:t,url:n},i){const o=await fetch(n,Object.assign({},t,{method:e,headers:i}));if(o.status<400)return o;throw new Error(lFe+(o.statusText||o.status))}function UFe(e,{url:t},n){return new Promise(((i,o)=>{const r=new XMLHttpRequest;if(r.addEventListener("load",(()=>{if(r.status<400){const e=[];r.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((t=>{const n=t.trim().split(/\s*:\s*/);n[0]=n[0].trim().replace(/^[a-z]|-[a-z]/g,(e=>e.toUpperCase())),e.push(n)})),i({status:r.status,arrayBuffer:()=>r.response,headers:new Map(e)})}else o(new Error(lFe+(r.statusText||r.status)))}),!1),r.addEventListener("error",(e=>o(e.detail.error)),!1),r.open(e,t),n)for(const e of Object.entries(n))r.setRequestHeader(e[0],e[1]);r.responseType="arraybuffer",r.send()}))}class VFe extends bFe{constructor(e,t={}){super(),this.url=e,t.useXHR?this.reader=new DFe(e,t):this.reader=new OFe(e,t)}set size(e){}get size(){return this.reader.size}async init(){super.init(),await this.reader.init()}async readUint8Array(e,t){return this.reader.readUint8Array(e,t)}}class HFe extends VFe{constructor(e,t={}){t.useRangeHeader=!0,super(e,t)}}class GFe extends bFe{constructor(e){super(),this.array=e,this.size=e.length}async readUint8Array(e,t){return this.array.slice(e,e+t)}}class WFe extends AFe{constructor(){super(),this.array=new Uint8Array(0)}async writeUint8Array(e){super.writeUint8Array(e);const t=this.array;this.array=new Uint8Array(t.length+e.length),this.array.set(t),this.array.set(e,t.length)}getData(){return this.array}}function qFe(e){if("undefined"!=typeof document){const t=document.createElement("a");return t.href=e,"http:"==t.protocol||"https:"==t.protocol}return/^https?:\/\//i.test(e)}const jFe=4294967295,YFe=65535,KFe=8,XFe=0,QFe=99,JFe=67324752,ZFe=134695760,$Fe=33639248,eze=101010256,tze=101075792,nze=117853008,ize=22,oze=20,rze=56,sze=ize+oze+rze,aze=1,cze=1,lze=39169,uze=10,hze=1,dze=21589,fze=28789,pze=25461,mze=1,_ze=6,gze=8,yze=2048,vze=16,bze=20,Aze=45,wze=51,Tze="/",Cze=new Date(2107,11,31),Eze=new Date(1980,0,1),xze="\0☺☻♥♦♣♠•◘○◙♂♀♪♫☼►◄↕‼¶§▬↨↑↓→←∟↔▲▼ !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~⌂ÇüéâäàåçêëèïîìÄÅÉæÆôöòûùÿÖÜ¢£¥₧ƒáíóúñÑªº¿⌐¬½¼¡«»░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀αßΓπΣσµτΦΘΩδ∞φε∩≡±≥≤⌠⌡÷≈°∙·√ⁿ²■ ".split("");var Sze=e=>{let t="";for(let n=0;n<e.length;n++)t+=xze[e[n]];return t};async function Ize(e,t){if(t&&"cp437"==t.trim().toLowerCase())return Sze(e);if("undefined"==typeof TextDecoder){const t=new FileReader;return new Promise(((n,i)=>{t.onload=e=>n(e.target.result),t.onerror=()=>i(t.error),t.readAsText(new Blob([e]))}))}return new TextDecoder(t).decode(e)}const Oze=["filename","rawFilename","directory","encrypted","compressedSize","uncompressedSize","lastModDate","rawLastModDate","comment","rawComment","signature","extraField","rawExtraField","bitFlag","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","filenameUTF8","commentUTF8","offset","zip64","compressionMethod","extraFieldNTFS","lastAccessDate","creationDate","extraFieldExtendedTimestamp","version","versionMadeBy","msDosCompatible","internalFileAttribute","externalFileAttribute"];class Dze{constructor(e){Oze.forEach((t=>this[t]=e[t]))}}const Pze="File format is not recognized",Rze="End of central directory not found",Lze="End of Zip64 central directory not found",Mze="End of Zip64 central directory locator not found",Bze="Central directory header not found",Nze="Local file header not found",Fze="Zip64 extra field not found",zze="File contains encrypted entry",kze="Encryption method not supported",Uze="Compression method not supported",Vze="utf-8",Hze="cp437",Gze=["uncompressedSize","compressedSize","offset"];class Wze{constructor(e,t={}){Object.assign(this,{reader:e,options:t,config:kBe()})}async getEntries(e={}){const t=this,n=t.reader;if(n.initialized||await n.init(),n.size<ize)throw new Error(Pze);const i=await $ze(n,eze,n.size,ize,16*YFe);if(!i)throw new Error(Rze);const o=cke(i);let r=rke(o,12),s=rke(o,16),a=oke(o,8),c=0;if(s==jFe||r==jFe||a==YFe){const e=await lke(n,i.offset-oze,oze),t=cke(e);if(rke(t,0)!=nze)throw new Error(Lze);s=ske(t,8);let o=await lke(n,s,rze),l=cke(o);const u=i.offset-oze-rze;if(rke(l,0)!=tze&&s!=u){const e=s;s=u,c=s-e,o=await lke(n,s,rze),l=cke(o)}if(rke(l,0)!=tze)throw new Error(Mze);a=ske(l,32),r=ske(l,40),s-=r}if(s<0||s>=n.size)throw new Error(Pze);let l=0,u=await lke(n,s,r),h=cke(u);if(r){const e=i.offset-r;if(rke(h,l)!=$Fe&&s!=e){const t=s;s=e,c=s-t,u=await lke(n,s,r),h=cke(u)}}if(s<0||s>=n.size)throw new Error(Pze);const d=[];for(let p=0;p<a;p++){const i=new qze(n,t.config,t.options);if(rke(h,l)!=$Fe)throw new Error(Bze);jze(i,h,l+6);const o=Boolean(i.bitFlag.languageEncodingFlag),r=l+46,s=r+i.filenameLength,m=s+i.extraFieldLength,_=oke(h,l+4),g=0==(0&_);Object.assign(i,{versionMadeBy:_,msDosCompatible:g,compressedSize:0,uncompressedSize:0,commentLength:oke(h,l+32),directory:g&&(ike(h,l+38)&vze)==vze,offset:rke(h,l+42)+c,internalFileAttribute:rke(h,l+34),externalFileAttribute:rke(h,l+38),rawFilename:u.subarray(r,s),filenameUTF8:o,commentUTF8:o,rawExtraField:u.subarray(s,m)});const y=m+i.commentLength;i.rawComment=u.subarray(m,y);const v=eke(t,e,"filenameEncoding"),b=eke(t,e,"commentEncoding"),[A,w]=await Promise.all([Ize(i.rawFilename,i.filenameUTF8?Vze:v||Hze),Ize(i.rawComment,i.commentUTF8?Vze:b||Hze)]);i.filename=A,i.comment=w,!i.directory&&i.filename.endsWith(Tze)&&(i.directory=!0),await Yze(i,i,h,l+6);const T=new Dze(i);if(T.getData=(e,t)=>i.getData(e,T,t),d.push(T),l=y,e.onprogress)try{e.onprogress(p+1,a,new Dze(i))}catch(f){}}return d}async close(){}}class qze{constructor(e,t,n){Object.assign(this,{reader:e,config:t,options:n})}async getData(e,t,n={}){const i=this,{reader:o,offset:r,extraFieldAES:s,compressionMethod:a,config:c,bitFlag:l,signature:u,rawLastModDate:h,compressedSize:d}=i,f=i.localDirectory={};o.initialized||await o.init();let p=await lke(o,r,30);const m=cke(p);let _=eke(i,n,"password");if(_=_&&_.length&&_,s&&s.originalCompressionMethod!=QFe)throw new Error(Uze);if(a!=XFe&&a!=KFe)throw new Error(Uze);if(rke(m,0)!=JFe)throw new Error(Nze);jze(f,m,4),p=await lke(o,r,30+f.filenameLength+f.extraFieldLength),f.rawExtraField=p.subarray(30+f.filenameLength),await Yze(i,f,m,4),t.lastAccessDate=f.lastAccessDate,t.creationDate=f.creationDate;const g=i.encrypted&&f.encrypted,y=g&&!s;if(g){if(!y&&void 0===s.strength)throw new Error(kze);if(!_)throw new Error(zze)}const v=await tFe(c.Inflate,{codecType:UNe,password:_,zipCrypto:y,encryptionStrength:s&&s.strength,signed:eke(i,n,"checkSignature"),passwordVerification:y&&(l.dataDescriptor?h>>>8&255:u>>>24&255),signature:u,compressed:0!=a,encrypted:g,useWebWorkers:eke(i,n,"useWebWorkers")},c);e.initialized||await e.init();const b=eke(i,n,"signal"),A=r+30+f.filenameLength+f.extraFieldLength;return await sFe(v,o,e,A,d,c,{onprogress:n.onprogress,signal:b}),e.getData()}}function jze(e,t,n){const i=e.rawBitFlag=oke(t,n+2),o=(i&mze)==mze,r=rke(t,n+6);Object.assign(e,{encrypted:o,version:oke(t,n),bitFlag:{level:(i&_ze)>>1,dataDescriptor:(i&gze)==gze,languageEncodingFlag:(i&yze)==yze},rawLastModDate:r,lastModDate:tke(r),filenameLength:oke(t,n+22),extraFieldLength:oke(t,n+24)})}async function Yze(e,t,n,i){const o=t.rawExtraField,r=t.extraField=new Map,s=cke(new Uint8Array(o));let a=0;try{while(a<o.length){const e=oke(s,a),t=oke(s,a+2);r.set(e,{type:e,data:o.slice(a+4,a+4+t)}),a+=4+t}}catch(m){}const c=oke(n,i+4);t.signature=rke(n,i+10),t.uncompressedSize=rke(n,i+18),t.compressedSize=rke(n,i+14);const l=r.get(cze);l&&(Kze(l,t),t.extraFieldZip64=l);const u=r.get(fze);u&&(await Xze(u,"filename","rawFilename",t,e),t.extraFieldUnicodePath=u);const h=r.get(pze);h&&(await Xze(h,"comment","rawComment",t,e),t.extraFieldUnicodeComment=h);const d=r.get(lze);d?(Qze(d,t,c),t.extraFieldAES=d):t.compressionMethod=c;const f=r.get(uze);f&&(Jze(f,t),t.extraFieldNTFS=f);const p=r.get(dze);p&&(Zze(p,t),t.extraFieldExtendedTimestamp=p)}function Kze(e,t){t.zip64=!0;const n=cke(e.data);e.values=[];for(let o=0;o<Math.floor(e.data.length/8);o++)e.values.push(ske(n,0+8*o));const i=Gze.filter((e=>t[e]==jFe));for(let o=0;o<i.length;o++)e[i[o]]=e.values[o];Gze.forEach((n=>{if(t[n]==jFe){if(void 0===e[n])throw new Error(Fze);t[n]=e[n]}}))}async function Xze(e,t,n,i,o){const r=cke(e.data);e.version=ike(r,0),e.signature=rke(r,1);const s=new GBe;s.append(o[n]);const a=cke(new Uint8Array(4));a.setUint32(0,s.get(),!0),e[t]=await Ize(e.data.subarray(5)),e.valid=!o.bitFlag.languageEncodingFlag&&e.signature==rke(a,0),e.valid&&(i[t]=e[t],i[t+"UTF8"]=!0)}function Qze(e,t,n){const i=cke(e.data);e.vendorVersion=ike(i,0),e.vendorId=ike(i,2);const o=ike(i,4);e.strength=o,e.originalCompressionMethod=n,t.compressionMethod=e.compressionMethod=oke(i,5)}function Jze(e,t){const n=cke(e.data);let i,o=4;try{while(o<e.data.length&&!i){const t=oke(n,o),r=oke(n,o+2);t==hze&&(i=e.data.slice(o+4,o+4+r)),o+=4+r}}catch(r){}try{if(i&&24==i.length){const n=cke(i),o=n.getBigUint64(0,!0),r=n.getBigUint64(8,!0),s=n.getBigUint64(16,!0);Object.assign(e,{rawLastModDate:o,rawLastAccessDate:r,rawCreationDate:s});const a=nke(o),c=nke(r),l=nke(s),u={lastModDate:a,lastAccessDate:c,creationDate:l};Object.assign(e,u),Object.assign(t,u)}}catch(r){}}function Zze(e,t){const n=cke(e.data),i=ike(n,0),o=[],r=[];1==(1&i)&&(o.push("lastModDate"),r.push("rawLastModDate")),2==(2&i)&&(o.push("lastAccessDate"),r.push("rawLastAccessDate")),4==(4&i)&&(o.push("creationDate"),r.push("rawCreationDate"));let s=1;o.forEach(((i,o)=>{if(e.data.length>=s+4){const a=rke(n,s);t[i]=e[i]=new Date(1e3*a);const c=r[o];e[c]=a}s+=4}))}async function $ze(e,t,n,i,o){const r=new Uint8Array(4),s=cke(r);ake(s,0,t);const a=i+o;return await c(i)||await c(Math.min(a,n));async function c(t){const o=n-t,s=await lke(e,o,t);for(let e=s.length-i;e>=0;e--)if(s[e]==r[0]&&s[e+1]==r[1]&&s[e+2]==r[2]&&s[e+3]==r[3])return{offset:o+e,buffer:s.slice(e,e+i).buffer}}}function eke(e,t,n){return void 0===t[n]?e.options[n]:t[n]}function tke(e){const t=(4294901760&e)>>16,n=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&n)>>11,(2016&n)>>5,2*(31&n),0)}catch(i){}}function nke(e){return new Date(Number(e/BigInt(1e4)-BigInt(116444736e5)))}function ike(e,t){return e.getUint8(t)}function oke(e,t){return e.getUint16(t,!0)}function rke(e,t){return e.getUint32(t,!0)}function ske(e,t){return Number(e.getBigUint64(t,!0))}function ake(e,t,n){e.setUint32(t,n,!0)}function cke(e){return new DataView(e.buffer)}function lke(e,t,n){return e.readUint8Array(t,n)}const uke="File already exists",hke="Zip file comment exceeds 64KB",dke="File entry comment exceeds 64KB",fke="File entry name exceeds 64KB",pke="Version exceeds 65535",mke="The strength must equal 1, 2, or 3",_ke="Extra field type exceeds 65535",gke="Extra field data exceeds 64KB",yke="Zip64 is not supported",vke=new Uint8Array([7,0,2,0,65,69,3,0,0]),bke=24;let Ake=0;class wke{constructor(e,t={}){Object.assign(this,{writer:e,options:t,config:kBe(),files:new Map,offset:e.size,pendingCompressedSize:0,pendingEntries:[]})}async add(e="",t,n={}){const i=this;if(!(Ake<i.config.maxWorkers))return new Promise(((o,r)=>i.pendingEntries.push({name:e,reader:t,options:n,resolve:o,reject:r})));Ake++;try{return await Tke(i,e,t,n)}finally{Ake--;const e=i.pendingEntries.shift();e&&i.add(e.name,e.reader,e.options).then(e.resolve).catch(e.reject)}}async close(e=new Uint8Array(0),t={}){return await xke(this,e,t),this.writer.getData()}}async function Tke(e,t,n,i){if(t=t.trim(),i.directory&&!t.endsWith(Tze)?t+=Tze:i.directory=t.endsWith(Tze),e.files.has(t))throw new Error(uke);const o=WBe(t);if(o.length>YFe)throw new Error(fke);const r=i.comment||"",s=WBe(r);if(s.length>YFe)throw new Error(dke);const a=e.options.version||i.version||0;if(a>YFe)throw new Error(pke);const c=e.options.versionMadeBy||i.versionMadeBy||20;if(c>YFe)throw new Error(pke);const l=Dke(e,i,"lastModDate")||new Date,u=Dke(e,i,"lastAccessDate"),h=Dke(e,i,"creationDate"),d=Dke(e,i,"password"),f=Dke(e,i,"encryptionStrength")||3,p=Dke(e,i,"zipCrypto");if(void 0!==d&&void 0!==f&&(f<1||f>3))throw new Error(mke);let m=new Uint8Array(0);const _=i.extraField;if(_){let e=0,t=0;_.forEach((t=>e+=4+t.length)),m=new Uint8Array(e),_.forEach(((e,n)=>{if(n>YFe)throw new Error(_ke);if(e.length>YFe)throw new Error(gke);Nke(m,new Uint16Array([n]),t),Nke(m,new Uint16Array([e.length]),t+2),Nke(m,e,t+4),t+=4+e.length}))}let g=Dke(e,i,"extendedTimestamp");void 0===g&&(g=!0);let y=0,v=Dke(e,i,"keepOrder");void 0===v&&(v=!0);let b=0,A=Dke(e,i,"msDosCompatible");void 0===A&&(A=!0);const w=Dke(e,i,"internalFileAttribute")||0,T=Dke(e,i,"externalFileAttribute")||0;n&&(n.initialized||await n.init(),b=n.size,y=Pke(b));let C=i.zip64||e.options.zip64||!1;if(e.offset+e.pendingCompressedSize>=jFe||b>=jFe||y>=jFe){if(!1===i.zip64||!1===e.options.zip64||!v)throw new Error(yke);C=!0}e.pendingCompressedSize+=y,await Promise.resolve();const E=Dke(e,i,"level"),x=Dke(e,i,"useWebWorkers"),S=Dke(e,i,"bufferedWrite");let I=Dke(e,i,"dataDescriptor"),O=Dke(e,i,"dataDescriptorSignature");const D=Dke(e,i,"signal");void 0===I&&(I=!0),I&&void 0===O&&(O=!0);const P=await Cke(e,t,n,Object.assign({},i,{rawFilename:o,rawComment:s,version:a,versionMadeBy:c,lastModDate:l,lastAccessDate:u,creationDate:h,rawExtraField:m,zip64:C,password:d,level:E,useWebWorkers:x,encryptionStrength:f,extendedTimestamp:g,zipCrypto:p,bufferedWrite:S,keepOrder:v,dataDescriptor:I,dataDescriptorSignature:O,signal:D,msDosCompatible:A,internalFileAttribute:w,externalFileAttribute:T}));return y&&(e.pendingCompressedSize-=y),Object.assign(P,{name:t,comment:r,extraField:_}),new Dze(P)}async function Cke(e,t,n,i){const o=e.files,r=e.writer,s=Array.from(o.values()).pop();let a,c,l,u={};o.set(t,u);try{let h,d,f;if(i.keepOrder&&(h=s&&s.lock),u.lock=f=new Promise((e=>l=e)),i.bufferedWrite||e.lockWrite||!i.dataDescriptor?(d=new SFe,d.init(),a=!0):(e.lockWrite=new Promise((e=>c=e)),r.initialized||await r.init(),d=r),u=await Eke(n,d,e.config,i),u.lock=f,o.set(t,u),u.filename=t,a){let t=0;const n=d.getData();let s;await Promise.all([e.lockWrite,h]);do{s=Array.from(o.values()).find((e=>e.writingBufferedData)),s&&await s.lock}while(s&&s.lock);if(u.writingBufferedData=!0,!i.dataDescriptor){const e=26,o=await Ske(n,0,e),s=new DataView(o);u.encrypted&&!i.zipCrypto||Mke(s,14,u.signature),u.zip64?(Mke(s,18,jFe),Mke(s,22,jFe)):(Mke(s,18,u.compressedSize),Mke(s,22,u.uncompressedSize)),await r.writeUint8Array(new Uint8Array(o)),t=e}await Ike(r,n,t),delete u.writingBufferedData}if(u.offset=e.offset,u.zip64){const e=Fke(u.rawExtraFieldZip64);Bke(e,20,BigInt(u.offset))}else if(u.offset>=jFe)throw new Error(yke);return e.offset+=u.length,u}catch(h){throw(a&&u.writingBufferedData||!a&&u.dataWritten)&&(h.corruptedEntry=e.hasCorruptedEntries=!0,u.uncompressedSize&&(e.offset+=u.uncompressedSize)),o.delete(t),h}finally{l(),c&&c()}}async function Eke(e,t,n,i){const{rawFilename:o,lastAccessDate:r,creationDate:s,password:a,level:c,zip64:l,zipCrypto:u,dataDescriptor:h,dataDescriptorSignature:d,directory:f,version:p,versionMadeBy:m,rawComment:_,rawExtraField:g,useWebWorkers:y,onprogress:v,signal:b,encryptionStrength:A,extendedTimestamp:w,msDosCompatible:T,internalFileAttribute:C,externalFileAttribute:E}=i,x=Boolean(a&&a.length),S=0!==c&&!f;let I,O,D;if(x&&!u){I=new Uint8Array(vke.length+2);const e=Fke(I);Lke(e,0,lze),Nke(I,vke,2),Rke(e,8,A)}else I=new Uint8Array(0);if(w){D=new Uint8Array(9+(r?4:0)+(s?4:0));const e=Fke(D);Lke(e,0,dze),Lke(e,2,D.length-4);const t=1+(r?2:0)+(s?4:0);Rke(e,4,t),Mke(e,5,Math.floor(i.lastModDate.getTime()/1e3)),r&&Mke(e,9,Math.floor(r.getTime()/1e3)),s&&Mke(e,13,Math.floor(s.getTime()/1e3));try{O=new Uint8Array(36);const e=Fke(O),t=Oke(i.lastModDate);Lke(e,0,uze),Lke(e,2,32),Lke(e,8,hze),Lke(e,10,24),Bke(e,12,t),Bke(e,20,Oke(r)||t),Bke(e,28,Oke(s)||t)}catch(Q){O=new Uint8Array(0)}}else O=D=new Uint8Array(0);const P={version:p||bze,versionMadeBy:m,zip64:l,directory:Boolean(f),filenameUTF8:!0,rawFilename:o,commentUTF8:!0,rawComment:_,rawExtraFieldZip64:l?new Uint8Array(bke+4):new Uint8Array(0),rawExtraFieldExtendedTimestamp:D,rawExtraFieldNTFS:O,rawExtraFieldAES:I,rawExtraField:g,extendedTimestamp:w,msDosCompatible:T,internalFileAttribute:C,externalFileAttribute:E};let R=P.uncompressedSize=0,L=yze;h&&(L|=gze);let M=XFe;S&&(M=KFe),l&&(P.version=P.version>Aze?P.version:Aze),x&&(L|=mze,u||(P.version=P.version>wze?P.version:wze,M=QFe,S&&(P.rawExtraFieldAES[9]=KFe))),P.compressionMethod=M;const B=P.headerArray=new Uint8Array(26),N=Fke(B);Lke(N,0,P.version),Lke(N,2,L),Lke(N,4,M);const F=new Uint32Array(1),z=Fke(F);let k;k=i.lastModDate<Eze?Eze:i.lastModDate>Cze?Cze:i.lastModDate,Lke(z,0,(k.getHours()<<6|k.getMinutes())<<5|k.getSeconds()/2),Lke(z,2,(k.getFullYear()-1980<<4|k.getMonth()+1)<<5|k.getDate());const U=F[0];Mke(N,6,U),Lke(N,22,o.length);const V=I.length+D.length+O.length+P.rawExtraField.length;Lke(N,24,V);const H=new Uint8Array(30+o.length+V),G=Fke(H);let W;Mke(G,0,JFe),Nke(H,B,4),Nke(H,o,30),Nke(H,I,30+o.length),Nke(H,D,30+o.length+I.length),Nke(H,O,30+o.length+I.length+D.length),Nke(H,P.rawExtraField,30+o.length+I.length+D.length+O.length);let q=0;if(e){R=P.uncompressedSize=e.size;const i=await tFe(n.Deflate,{codecType:kNe,level:c,password:a,encryptionStrength:A,zipCrypto:x&&u,passwordVerification:x&&u&&U>>8&255,signed:!0,compressed:S,encrypted:x,useWebWorkers:y},n);await t.writeUint8Array(H),P.dataWritten=!0,W=await sFe(i,e,t,0,R,n,{onprogress:v,signal:b}),q=W.length}else await t.writeUint8Array(H),P.dataWritten=!0;let j,Y=new Uint8Array(0),K=0;if(h&&(Y=new Uint8Array(l?d?24:20:d?16:12),j=Fke(Y),d&&(K=4,Mke(j,0,ZFe))),e){const e=W.signature;if(x&&!u||void 0===e||(Mke(N,10,e),P.signature=e,h&&Mke(j,K,e)),l){const e=Fke(P.rawExtraFieldZip64);Lke(e,0,cze),Lke(e,2,bke),Mke(N,14,jFe),Bke(e,12,BigInt(q)),Mke(N,18,jFe),Bke(e,4,BigInt(R)),h&&(Bke(j,K+4,BigInt(q)),Bke(j,K+12,BigInt(R)))}else Mke(N,14,q),Mke(N,18,R),h&&(Mke(j,K+4,q),Mke(j,K+8,R))}h&&await t.writeUint8Array(Y);const X=H.length+q+Y.length;return Object.assign(P,{compressedSize:q,lastModDate:k,rawLastModDate:U,creationDate:s,lastAccessDate:r,encrypted:x,length:X}),P}async function xke(e,t,n){const i=e.writer,o=e.files;let r=0,s=0,a=e.offset,c=o.size;for(const[,f]of o)s+=46+f.rawFilename.length+f.rawComment.length+f.rawExtraFieldZip64.length+f.rawExtraFieldAES.length+f.rawExtraFieldExtendedTimestamp.length+f.rawExtraFieldNTFS.length+f.rawExtraField.length;let l=n.zip64||e.options.zip64||!1;if(a>=jFe||s>=jFe||c>=YFe){if(!1===n.zip64||!1===e.options.zip64)throw new Error(yke);l=!0}const u=new Uint8Array(s+(l?sze:ize)),h=Fke(u);if(t&&t.length){if(!(t.length<=YFe))throw new Error(hke);Lke(h,r+20,t.length)}for(const[f,p]of Array.from(o.values()).entries()){const{rawFilename:e,rawExtraFieldZip64:t,rawExtraFieldAES:i,rawExtraField:s,rawComment:a,versionMadeBy:c,headerArray:l,directory:m,zip64:_,msDosCompatible:g,internalFileAttribute:y,externalFileAttribute:v}=p;let b,A;if(p.extendedTimestamp){A=p.rawExtraFieldNTFS,b=new Uint8Array(9);const e=Fke(b);Lke(e,0,dze),Lke(e,2,b.length-4),Rke(e,4,1),Mke(e,5,Math.floor(p.lastModDate.getTime()/1e3))}else A=b=new Uint8Array(0);const w=t.length+i.length+b.length+A.length+s.length;if(Mke(h,r,$Fe),Lke(h,r+4,c),Nke(u,l,r+6),Lke(h,r+30,w),Lke(h,r+32,a.length),Mke(h,r+34,y),v?Mke(h,r+38,v):m&&g&&Rke(h,r+38,vze),Mke(h,r+42,_?jFe:p.offset),Nke(u,e,r+46),Nke(u,t,r+46+e.length),Nke(u,i,r+46+e.length+t.length),Nke(u,b,r+46+e.length+t.length+i.length),Nke(u,A,r+46+e.length+t.length+i.length+b.length),Nke(u,s,r+46+e.length+t.length+i.length+b.length+A.length),Nke(u,a,r+46+e.length+w),r+=46+e.length+w+a.length,n.onprogress)try{n.onprogress(f+1,o.size,new Dze(p))}catch(d){}}l&&(Mke(h,r,tze),Bke(h,r+4,BigInt(44)),Lke(h,r+12,45),Lke(h,r+14,45),Bke(h,r+24,BigInt(c)),Bke(h,r+32,BigInt(c)),Bke(h,r+40,BigInt(s)),Bke(h,r+48,BigInt(a)),Mke(h,r+56,nze),Bke(h,r+64,BigInt(a)+BigInt(s)),Mke(h,r+72,aze),c=YFe,a=jFe,s=jFe,r+=76),Mke(h,r,eze),Lke(h,r+8,c),Lke(h,r+10,c),Mke(h,r+12,s),Mke(h,r+16,a),await i.writeUint8Array(u),t&&t.length&&await i.writeUint8Array(t)}function Ske(e,t,n){if(e.arrayBuffer)return t||n?e.slice(t,n).arrayBuffer():e.arrayBuffer();{const i=new FileReader;return new Promise(((o,r)=>{i.onload=e=>o(e.target.result),i.onerror=()=>r(i.error),i.readAsArrayBuffer(t||n?e.slice(t,n):e)}))}}async function Ike(e,t,n=0){const i=536870912;async function o(){if(n<t.size){const r=await Ske(t,n,n+i);await e.writeUint8Array(new Uint8Array(r)),n+=i,await o()}}await o()}function Oke(e){if(e)return(BigInt(e.getTime())+BigInt(116444736e5))*BigInt(1e4)}function Dke(e,t,n){return void 0===t[n]?e.options[n]:t[n]}function Pke(e){return e+5*(Math.floor(e/16383)+1)}function Rke(e,t,n){e.setUint8(t,n)}function Lke(e,t,n){e.setUint16(t,n,!0)}function Mke(e,t,n){e.setUint32(t,n,!0)}function Bke(e,t,n){e.setBigUint64(t,n,!0)}function Nke(e,t,n){e.set(t,n)}function Fke(e){return new DataView(e.buffer)}UBe({Deflate:IMe,Inflate:NBe});var zke=Object.freeze({__proto__:null,configure:UBe,getMimeType:VBe,terminateWorkers:iFe,ERR_ABORT:rFe,Reader:bFe,Writer:AFe,TextReader:wFe,TextWriter:TFe,Data64URIReader:CFe,Data64URIWriter:EFe,BlobReader:xFe,BlobWriter:SFe,Uint8ArrayReader:GFe,Uint8ArrayWriter:WFe,HttpReader:VFe,HttpRangeReader:HFe,WritableStreamWriter:IFe,ERR_HTTP_RANGE:uFe,ZipReader:Wze,ERR_BAD_FORMAT:Pze,ERR_EOCDR_NOT_FOUND:Rze,ERR_EOCDR_ZIP64_NOT_FOUND:Lze,ERR_EOCDR_LOCATOR_ZIP64_NOT_FOUND:Mze,ERR_CENTRAL_DIRECTORY_NOT_FOUND:Bze,ERR_LOCAL_FILE_HEADER_NOT_FOUND:Nze,ERR_EXTRAFIELD_ZIP64_NOT_FOUND:Fze,ERR_ENCRYPTED:zze,ERR_UNSUPPORTED_ENCRYPTION:kze,ERR_UNSUPPORTED_COMPRESSION:Uze,ERR_INVALID_SIGNATURE:VNe,ERR_INVALID_PASSWORD:ZBe,ZipWriter:wke,ERR_DUPLICATED_NAME:uke,ERR_INVALID_COMMENT:hke,ERR_INVALID_ENTRY_NAME:fke,ERR_INVALID_ENTRY_COMMENT:dke,ERR_INVALID_VERSION:pke,ERR_INVALID_EXTRAFIELD_TYPE:_ke,ERR_INVALID_EXTRAFIELD_DATA:gke,ERR_INVALID_ENCRYPTION_STRENGTH:mke,ERR_UNSUPPORTED_FORMAT:yke});function kke(e){if("string"===typeof e){const t=document.getElementById(e);if(null===t)throw new x(`Element with id "${e}" does not exist in the document.`);e=t}return e}var Uke=kke;function Vke(e,t){this.position=e,this.headingPitchRoll=t}var Hke=Vke;function Gke(e,t){this.position=e,this.headingPitchRange=t}var Wke=Gke;function qke(e,t){this.id=t,this.name=e,this.playlistIndex=0,this.playlist=[],this.tourStart=new $n,this.tourEnd=new $n,this.entryStart=new $n,this.entryEnd=new $n,this._activeEntries=[]}function jke(e){for(let t=e.pop();void 0!==t;t=e.pop())t.stop()}function Yke(e,t,n){const i=this.playlist[this.playlistIndex];if(i){const o=Kke.bind(this,e,t,n);if(this._activeEntries.push(i),this.entryStart.raiseEvent(i),i.blocking)i.play(o,e.scene.camera,t);else{const r=this;i.play((function(){r.entryEnd.raiseEvent(i);const e=r._activeEntries.indexOf(i);e>=0&&r._activeEntries.splice(e,1)})),o(e,t,n)}}else C(n)&&n(!1)}function Kke(e,t,n,i){const o=this.playlist[this.playlistIndex];if(this.entryEnd.raiseEvent(o,i),i)n(i);else{const i=this._activeEntries.indexOf(o);i>=0&&this._activeEntries.splice(i,1),this.playlistIndex++,Yke.call(this,e,t,n)}}qke.prototype.addPlaylistEntry=function(e){this.playlist.push(e)},qke.prototype.play=function(e,t){this.tourStart.raiseEvent();const n=this;Yke.call(this,e,t,(function(e){n.playlistIndex=0,e||jke(n._activeEntries),n.tourEnd.raiseEvent(e)}))},qke.prototype.stop=function(){jke(this._activeEntries)};var Xke=qke;function Qke(e,t,n){this.type="KmlTourFlyTo",this.blocking=!0,this.activeCamera=null,this.activeCallback=null,this.duration=e,this.view=n,this.flyToMode=t}Qke.prototype.play=function(e,t,n){if(this.activeCamera=t,C(e)&&null!==e){const t=this;this.activeCallback=function(n){delete t.activeCallback,delete t.activeCamera,e(!C(n)&&n)}}const i=this.getCameraOptions(n);if(this.view.headingPitchRoll)t.flyTo(i);else if(this.view.headingPitchRange){const e=new nn(this.view.position);t.flyToBoundingSphere(e,i)}},Qke.prototype.stop=function(){C(this.activeCamera)&&this.activeCamera.cancelFlight(),C(this.activeCallback)&&this.activeCallback(!0)},Qke.prototype.getCameraOptions=function(e){let t={duration:this.duration};return C(this.activeCallback)&&(t.complete=this.activeCallback),"smooth"===this.flyToMode&&(t.easingFunction=rC.LINEAR_NONE),this.view.headingPitchRoll?(t.destination=this.view.position,t.orientation=this.view.headingPitchRoll):this.view.headingPitchRange&&(t.offset=this.view.headingPitchRange),C(e)&&(t=_n(t,e)),t};var Jke=Qke;function Zke(e){this.type="KmlTourWait",this.blocking=!0,this.duration=e,this.timeout=null}Zke.prototype.play=function(e){const t=this;this.activeCallback=e,this.timeout=setTimeout((function(){delete t.activeCallback,e(!1)}),1e3*this.duration)},Zke.prototype.stop=function(){clearTimeout(this.timeout),C(this.activeCallback)&&this.activeCallback(!0)};var $ke=Zke;const eUe={avi:"video/x-msvideo",bmp:"image/bmp",bz2:"application/x-bzip2",chm:"application/vnd.ms-htmlhelp",css:"text/css",csv:"text/csv",doc:"application/msword",dvi:"application/x-dvi",eps:"application/postscript",flv:"video/x-flv",gif:"image/gif",gz:"application/x-gzip",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",jnlp:"application/x-java-jnlp-file",jpeg:"image/jpeg",jpg:"image/jpeg",m3u:"audio/x-mpegurl",m4v:"video/mp4",mathml:"application/mathml+xml",mid:"audio/midi",midi:"audio/midi",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mp4v:"video/mp4",mpeg:"video/mpeg",mpg:"video/mpeg",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",ogg:"application/ogg",pdf:"application/pdf",png:"image/png",pps:"application/vnd.ms-powerpoint",ppt:"application/vnd.ms-powerpoint",ps:"application/postscript",qt:"video/quicktime",rdf:"application/rdf+xml",rss:"application/rss+xml",rtf:"application/rtf",svg:"image/svg+xml",swf:"application/x-shockwave-flash",text:"text/plain",tif:"image/tiff",tiff:"image/tiff",txt:"text/plain",wav:"audio/x-wav",wma:"audio/x-ms-wma",wmv:"video/x-ms-wmv",xml:"application/xml",zip:"application/zip",detectFromFilename:function(e){let t=e.toLowerCase();return t=wn(t),eUe[t]}};let tUe;"undefined"!==typeof DOMParser&&(tUe=new DOMParser);const nUe=new LRe({stripPrefix:!1,email:!1,replaceFn:function(e){if(!e.protocolUrlMatch)return!1}}),iUe=32,oUe=2414016,rUe=1,sUe=16093e3,aUe=.1,cUe=[null,void 0,"http://www.opengis.net/kml/2.2","http://earth.google.com/kml/2.2","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.0"],lUe=["http://www.google.com/kml/ext/2.2"],uUe=["http://www.w3.org/2005/Atom"],hUe={kml:cUe,gx:lUe,atom:uUe,kmlgx:cUe.concat(lUe)},dUe={Document:pVe,Folder:mVe,Placemark:_Ve,NetworkLink:MVe,GroundOverlay:EVe,PhotoOverlay:xVe,ScreenOverlay:CVe,Tour:yVe};function fUe(e){this._dataSource=e,this._deferred=yn(),this._stack=[],this._promises=[],this._timeoutSet=!1,this._used=!1,this._started=0,this._timeThreshold=1e3}function pUe(e){const t=e.slice(0,Math.min(4,e.size)),n=yn(),i=new FileReader;return i.addEventListener("load",(function(){n.resolve(1347093252===new DataView(i.result).getUint32(0,!1))})),i.addEventListener("error",(function(){n.reject(i.error)})),i.readAsArrayBuffer(t),n.promise}function mUe(e){const t=yn(),n=new FileReader;return n.addEventListener("load",(function(){t.resolve(n.result)})),n.addEventListener("error",(function(){t.reject(n.error)})),n.readAsText(e),t.promise}function _Ue(e){const t={xsi:"http://www.w3.org/2001/XMLSchema-instance"};let n,i,o,r;for(const s in t)t.hasOwnProperty(s)&&(o=RegExp(`[< ]${s}:`),r=`xmlns:${s}=`,o.test(e)&&-1===e.indexOf(r)&&(C(n)||(n=e.substr(0,e.indexOf("<kml")+4),i=e.substr(n.length)),n+=` ${r}"${t[s]}"`));return C(n)&&(e=n+i),e}function gUe(e){let t=e.indexOf("xmlns:");const n=e.indexOf(">",t);let i,o,r;while(-1!==t&&t<n)i=e.slice(t,e.indexOf('"',t)),o=t,t=e.indexOf(i,t+1),-1!==t?(r=e.indexOf('"',e.indexOf('"',t)+1),e=e.slice(0,t-1)+e.slice(r+1,e.length),t=e.indexOf("xmlns:",o-1)):t=e.indexOf("xmlns:",o+1);return e}function yUe(e,t){return Promise.resolve(e.getData(new zke.TextWriter)).then((function(e){e=_Ue(e),e=gUe(e),t.kml=tUe.parseFromString(e,"application/xml")}))}function vUe(e,t){const n=R(eUe.detectFromFilename(e.filename),"application/octet-stream");return Promise.resolve(e.getData(new zke.Data64URIWriter(n))).then((function(n){t[e.filename]=n}))}function bUe(e,t,n,i){const o=i.keys,r=new cn("."),s=e.querySelectorAll(t);for(let a=0;a<s.length;a++){const e=s[a],c=e.getAttribute(n),l=new cn(c),u=l.absoluteTo(r).toString(),h=o.indexOf(u);if(-1!==h){const r=o[h];e.setAttribute(n,i[r]),"a"===t&&null===e.getAttribute("download")&&e.setAttribute("download",r)}}}function AUe(e,t,n,i){const o=e.querySelectorAll(t);for(let r=0;r<o.length;r++){const e=o[r],t=e.getAttribute(n),s=MUe(t,i);e.setAttribute(n,s.url)}}function wUe(e,t,n){let i=SUe(e,"id");i=C(i)&&0!==i.length?i:wk(),C(n)&&(i=n+i);let o=t.getById(i);return C(o)&&(i=wk(),C(n)&&(i=n+i)),o=t.add(new iQ({id:i})),C(o.kml)||(o.addProperty("kml"),o.kml=new GVe),o}function TUe(e,t){return"absolute"===e||"relativeToGround"===e||"relativeToSeaFloor"===t}function CUe(e,t){if(!C(e))return K.fromDegrees(0,0,0,t);const n=e.match(/[^\s,\n]+/g);if(!C(n))return K.fromDegrees(0,0,0,t);let i=parseFloat(n[0]),o=parseFloat(n[1]),r=parseFloat(n[2]);return i=isNaN(i)?0:i,o=isNaN(o)?0:o,r=isNaN(r)?0:r,K.fromDegrees(i,o,r,t)}function EUe(e,t){if(!C(e))return;const n=e.textContent.match(/[^\s\n]+/g);if(!C(n))return;const i=n.length,o=new Array(i);let r=0;for(let s=0;s<i;s++)o[r++]=CUe(n[s],t);return o}function xUe(e,t){if(!C(e))return;const n=e.getAttribute(t);if(null!==n){const e=parseFloat(n);return isNaN(e)?void 0:e}}function SUe(e,t){if(!C(e))return;const n=e.getAttribute(t);return null!==n?n:void 0}function IUe(e,t,n){if(!C(e))return;const i=e.childNodes,o=i.length;for(let r=0;r<o;r++){const e=i[r];if(e.localName===t&&-1!==n.indexOf(e.namespaceURI))return e}}function OUe(e,t,n){if(!C(e))return;const i=[],o=e.getElementsByTagNameNS("*",t),r=o.length;for(let s=0;s<r;s++){const e=o[s];e.localName===t&&-1!==n.indexOf(e.namespaceURI)&&i.push(e)}return i}function DUe(e,t,n){if(!C(e))return[];const i=[],o=e.childNodes,r=o.length;for(let s=0;s<r;s++){const e=o[s];e.localName===t&&-1!==n.indexOf(e.namespaceURI)&&i.push(e)}return i}function PUe(e,t,n){const i=IUe(e,t,n);if(C(i)){const e=parseFloat(i.textContent);return isNaN(e)?void 0:e}}function RUe(e,t,n){const i=IUe(e,t,n);if(C(i))return i.textContent.trim()}function LUe(e,t,n){const i=IUe(e,t,n);if(C(i)){const e=i.textContent.trim();return"1"===e||/^true$/i.test(e)}}function MUe(e,t,n){if(!C(e))return;let i;if(C(n)){e=e.replace(/\\/g,"/");let o=n[e];if(C(o))i=new Vi({url:o});else{const r=new cn(t.getUrlComponent()),s=new cn(e);o=n[s.absoluteTo(r)],C(o)&&(i=new Vi({url:o}))}}return C(i)||(i=t.getDerivedResource({url:e})),i}Object.defineProperties(fUe.prototype,{dataSource:{get:function(){return this._dataSource}}}),fUe.prototype.addNodes=function(e,t){this._stack.push({nodes:e,index:0,processingData:t}),this._used=!0},fUe.prototype.addPromise=function(e){this._promises.push(e)},fUe.prototype.wait=function(){const e=this._deferred;return this._used||e.resolve(),Promise.all([e.promise,Promise.all(this._promises)])},fUe.prototype.process=function(){const e=1===this._stack.length;return e&&(this._started=kVe._getTimestamp()),this._process(e)},fUe.prototype._giveUpTime=function(){if(this._timeoutSet)return;this._timeoutSet=!0,this._timeThreshold=50;const e=this;setTimeout((function(){e._timeoutSet=!1,e._started=kVe._getTimestamp(),e._process(!0)}),0)},fUe.prototype._nextNode=function(){const e=this._stack,t=e[e.length-1],n=t.index,i=t.nodes;if(n!==i.length)return++t.index,i[n]},fUe.prototype._pop=function(){const e=this._stack;return e.pop(),0!==e.length||(this._deferred.resolve(),!1)},fUe.prototype._process=function(e){const t=this.dataSource,n=this._stack[this._stack.length-1].processingData;let i=this._nextNode();while(C(i)){const e=dUe[i.localName];if(C(e)&&(-1!==hUe.kml.indexOf(i.namespaceURI)||-1!==hUe.gx.indexOf(i.namespaceURI))&&(e(t,i,n,this),this._timeoutSet||kVe._getTimestamp()>this._started+this._timeThreshold))return void this._giveUpTime();i=this._nextNode()}this._pop()&&e&&this._process(!0)};const BUe={maximumRed:void 0,red:void 0,maximumGreen:void 0,green:void 0,maximumBlue:void 0,blue:void 0};function NUe(e,t){if(!C(e)||/^\s*$/gm.test(e))return;"#"===e[0]&&(e=e.substring(1));const n=parseInt(e.substring(0,2),16)/255,i=parseInt(e.substring(2,4),16)/255,o=parseInt(e.substring(4,6),16)/255,r=parseInt(e.substring(6,8),16)/255;return t?(r>0?(BUe.maximumRed=r,BUe.red=void 0):(BUe.maximumRed=void 0,BUe.red=0),o>0?(BUe.maximumGreen=o,BUe.green=void 0):(BUe.maximumGreen=void 0,BUe.green=0),i>0?(BUe.maximumBlue=i,BUe.blue=void 0):(BUe.maximumBlue=void 0,BUe.blue=0),BUe.alpha=n,xy.fromRandom(BUe)):new xy(r,o,i,n)}function FUe(e,t,n){const i=RUe(e,t,n);if(C(i))return NUe(i,"random"===RUe(e,"colorMode",n))}function zUe(e){const t=IUe(e,"TimeStamp",hUe.kmlgx),n=RUe(t,"when",hUe.kmlgx);if(!C(t)||!C(n)||0===n.length)return;const i=Ea.fromIso8601(n),o=new NN;return o.addInterval(new cO({start:i,stop:fO.MAXIMUM_VALUE})),o}function kUe(e){const t=IUe(e,"TimeSpan",hUe.kmlgx);if(!C(t))return;let n;const i=IUe(t,"begin",hUe.kmlgx);let o=C(i)?Ea.fromIso8601(i.textContent):void 0;const r=IUe(t,"end",hUe.kmlgx);let s=C(r)?Ea.fromIso8601(r.textContent):void 0;if(C(o)&&C(s)){if(Ea.lessThan(s,o)){const e=o;o=s,s=e}n=new NN,n.addInterval(new cO({start:o,stop:s}))}else C(o)?(n=new NN,n.addInterval(new cO({start:o,stop:fO.MAXIMUM_VALUE}))):C(s)&&(n=new NN,n.addInterval(new cO({start:fO.MINIMUM_VALUE,stop:s})));return n}function UUe(){const e=new Ez;return e.width=iUe,e.height=iUe,e.scaleByDistance=new LO(oUe,rUe,sUe,aUe),e.pixelOffsetScaleByDistance=new LO(oUe,rUe,sUe,aUe),e}function VUe(){const e=new kX;return e.outline=!0,e.outlineColor=xy.WHITE,e}function HUe(){const e=new _X;return e.translucencyByDistance=new LO(3e6,1,5e6,0),e.pixelOffset=new ro(17,0),e.horizontalOrigin=Oz.LEFT,e.font="16px sans-serif",e.style=Ise.FILL_AND_OUTLINE,e}function GUe(e,t,n,i,o){let r=RUe(e,"href",hUe.kml);if(!C(r)||0===r.length)return;if(0===r.indexOf("root://icons/palette-")){const t=r.charAt(21);let n=R(PUe(e,"x",hUe.gx),0),i=R(PUe(e,"y",hUe.gx),0);n=Math.min(n/32,7),i=7-Math.min(i/32,7);const o=8*i+n;r=`https://maps.google.com/mapfiles/kml/pal${t}/icon${o}.png`}const s=MUe(r,n,i);if(o){const n=RUe(e,"refreshMode",hUe.kml),i=RUe(e,"viewRefreshMode",hUe.kml);"onInterval"===n||"onExpire"===n?CA(`kml-refreshMode-${n}`,`KML - Unsupported Icon refreshMode: ${n}`):"onStop"!==i&&"onRegion"!==i||CA(`kml-refreshMode-${i}`,`KML - Unsupported Icon viewRefreshMode: ${i}`);const o=R(RUe(e,"viewBoundScale",hUe.kml),1),r="onStop"===i?"BBOX=[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]":"",a=R(RUe(e,"viewFormat",hUe.kml),r),c=RUe(e,"httpQuery",hUe.kml);C(a)&&s.setQueryParameters(Un(IVe(a))),C(c)&&s.setQueryParameters(Un(IVe(c)));const l=t._ellipsoid;return LVe(s,t._camera,t._canvas,o,t._lastCameraView.bbox,l),s}return s}function WUe(e,t,n,i,o){let r=PUe(t,"scale",hUe.kml);const s=PUe(t,"heading",hUe.kml),a=FUe(t,"color",hUe.kml),c=IUe(t,"Icon",hUe.kml);let l=GUe(c,e,i,o,!1);C(c)&&!C(l)&&(l=!1);const u=PUe(c,"x",hUe.gx),h=PUe(c,"y",hUe.gx),d=PUe(c,"w",hUe.gx),f=PUe(c,"h",hUe.gx),p=IUe(t,"hotSpot",hUe.kml),m=xUe(p,"x"),_=xUe(p,"y"),g=SUe(p,"xunits"),y=SUe(p,"yunits");let v,b,A=n.billboard;C(A)||(A=UUe(),n.billboard=A),A.image=l,A.scale=r,A.color=a,(C(u)||C(h)||C(d)||C(f))&&(A.imageSubRegion=new bf(u,h,d,f)),C(s)&&0!==s&&(A.rotation=z.toRadians(-s),A.alignedAxis=K.UNIT_Z),r=R(r,1),C(m)&&("pixels"===g?v=-m*r:"insetPixels"===g?v=(m-iUe)*r:"fraction"===g&&(v=-m*iUe*r),v+=.5*iUe*r),C(_)&&("pixels"===y?b=_*r:"insetPixels"===y?b=(-_+iUe)*r:"fraction"===y&&(b=_*iUe*r),b-=.5*iUe*r),(C(v)||C(b))&&(A.pixelOffset=new ro(v,b))}function qUe(e,t,n,i,o){for(let r=0,s=t.childNodes.length;r<s;r++){const s=t.childNodes.item(r);if("IconStyle"===s.localName)WUe(e,s,n,i,o);else if("LabelStyle"===s.localName){let e=n.label;C(e)||(e=HUe(),n.label=e),e.scale=R(PUe(s,"scale",hUe.kml),e.scale),e.fillColor=R(FUe(s,"color",hUe.kml),e.fillColor),e.text=n.name}else if("LineStyle"===s.localName){let e=n.polyline;C(e)||(e=new VX,n.polyline=e),e.width=PUe(s,"width",hUe.kml),e.material=FUe(s,"color",hUe.kml),C(FUe(s,"outerColor",hUe.gx))&&CA("kml-gx:outerColor","KML - gx:outerColor is not supported in a LineStyle"),C(PUe(s,"outerWidth",hUe.gx))&&CA("kml-gx:outerWidth","KML - gx:outerWidth is not supported in a LineStyle"),C(PUe(s,"physicalWidth",hUe.gx))&&CA("kml-gx:physicalWidth","KML - gx:physicalWidth is not supported in a LineStyle"),C(LUe(s,"labelVisibility",hUe.gx))&&CA("kml-gx:labelVisibility","KML - gx:labelVisibility is not supported in a LineStyle")}else if("PolyStyle"===s.localName){let e=n.polygon;C(e)||(e=VUe(),n.polygon=e),e.material=R(FUe(s,"color",hUe.kml),e.material),e.fill=R(LUe(s,"fill",hUe.kml),e.fill),e.outline=R(LUe(s,"outline",hUe.kml),e.outline)}else if("BalloonStyle"===s.localName){const e=R(NUe(RUe(s,"bgColor",hUe.kml)),xy.WHITE),t=R(NUe(RUe(s,"textColor",hUe.kml)),xy.BLACK),i=RUe(s,"text",hUe.kml);n.addProperty("balloonStyle"),n.balloonStyle={bgColor:e,textColor:t,text:i}}else if("ListStyle"===s.localName){const e=RUe(s,"listItemType",hUe.kml);"radioFolder"!==e&&"checkOffOnly"!==e||CA(`kml-listStyle-${e}`,`KML - Unsupported ListStyle with listItemType: ${e}`)}}}function jUe(e,t,n,i,o){const r=new iQ;let s,a=-1;const c=t.childNodes,l=c.length;for(let h=0;h<l;h++){const e=c[h];"Style"!==e.localName&&"StyleMap"!==e.localName||(a=h)}if(-1!==a){const t=c[a];if("Style"===t.localName)qUe(e,t,r,i,o);else{const a=DUe(t,"Pair",hUe.kml);for(let t=0;t<a.length;t++){const c=a[t],l=RUe(c,"key",hUe.kml);if("normal"===l){const t=RUe(c,"styleUrl",hUe.kml);if(C(t))s=n.getById(t),C(s)||(s=n.getById(`#${t}`)),C(s)&&r.merge(s);else{const t=IUe(c,"Style",hUe.kml);qUe(e,t,r,i,o)}}else CA(`kml-styleMap-${l}`,`KML - Unsupported StyleMap key: ${l}`)}}}const u=RUe(t,"styleUrl",hUe.kml);if(C(u)){let e=u;if("#"!==u[0]&&-1!==u.indexOf("#")){const t=u.split("#"),n=t[0],o=i.getDerivedResource({url:n});e=`${o.getUrlComponent()}#${t[1]}`}s=n.getById(e),C(s)||(s=n.getById(`#${e}`)),C(s)&&r.merge(s)}return r}function YUe(e,t,n){return t.fetchXML().then((function(i){return KUe(e,i,n,t,!0)}))}function KUe(e,t,n,i,o,r){let s,a,c,l;const u=OUe(t,"Style",hUe.kml);if(C(u)){const t=u.length;for(s=0;s<t;s++)l=u[s],a=SUe(l,"id"),C(a)&&(a=`#${a}`,o&&C(i)&&(a=i.getUrlComponent()+a),C(n.getById(a))||(c=new iQ({id:a}),n.add(c),qUe(e,l,c,i,r)))}const h=OUe(t,"StyleMap",hUe.kml);if(C(h)){const t=h.length;for(s=0;s<t;s++){const t=h[s];if(a=SUe(t,"id"),C(a)){const s=DUe(t,"Pair",hUe.kml);for(let t=0;t<s.length;t++){const u=s[t],h=RUe(u,"key",hUe.kml);if("normal"===h){if(a=`#${a}`,o&&C(i)&&(a=i.getUrlComponent()+a),!C(n.getById(a))){c=n.getOrCreateEntity(a);let t=RUe(u,"styleUrl",hUe.kml);if(C(t)){"#"!==t[0]&&(t=`#${t}`),o&&C(i)&&(t=i.getUrlComponent()+t);const e=n.getById(t);C(e)&&c.merge(e)}else l=IUe(u,"Style",hUe.kml),qUe(e,l,c,i,r)}}else CA(`kml-styleMap-${h}`,`KML - Unsupported StyleMap key: ${h}`)}}}}const d=[],f=t.getElementsByTagName("styleUrl"),p=f.length;for(s=0;s<p;s++){const t=f[s].textContent;if("#"!==t[0]){const o=t.split("#");if(2===o.length){const t=o[0],r=i.getDerivedResource({url:t});d.push(YUe(e,r,n))}}}return d}function XUe(e,t,n){const i=new TTe(e,t.id,["position"]),o=new XIe(t.position);t.polyline=C(n.polyline)?n.polyline.clone():new VX,t.polyline.positions=new yTe([i,o])}function QUe(e,t){return!C(e)&&!C(t)||"clampToGround"===e?Sz.CLAMP_TO_GROUND:"relativeToGround"===e?Sz.RELATIVE_TO_GROUND:"absolute"===e?Sz.NONE:"clampToSeaFloor"===t?(CA("kml-gx:altitudeMode-clampToSeaFloor","KML - <gx:altitudeMode>:clampToSeaFloor is currently not supported, using <kml:altitudeMode>:clampToGround."),Sz.CLAMP_TO_GROUND):"relativeToSeaFloor"===t?(CA("kml-gx:altitudeMode-relativeToSeaFloor","KML - <gx:altitudeMode>:relativeToSeaFloor is currently not supported, using <kml:altitudeMode>:relativeToGround."),Sz.RELATIVE_TO_GROUND):(C(e)?CA("kml-altitudeMode-unknown",`KML - Unknown <kml:altitudeMode>:${e}, using <kml:altitudeMode>:CLAMP_TO_GROUND.`):CA("kml-gx:altitudeMode-unknown",`KML - Unknown <gx:altitudeMode>:${t}, using <kml:altitudeMode>:CLAMP_TO_GROUND.`),Sz.CLAMP_TO_GROUND)}function JUe(e,t,n){return"relativeToSeaFloor"===n||"absolute"===t||"relativeToGround"===t?e:((C(t)&&"clampToGround"!==t||C(n)&&"clampToSeaFloor"!==n)&&CA("kml-altitudeMode-unknown",`KML - Unknown altitudeMode: ${R(t,n)}`),new XIe(e))}function ZUe(e,t,n,i){if(!C(e))return;if("relativeToSeaFloor"===n||"absolute"===t||"relativeToGround"===t)return e;(C(t)&&"clampToGround"!==t||C(n)&&"clampToSeaFloor"!==n)&&CA("kml-altitudeMode-unknown",`KML - Unknown altitudeMode: ${R(t,n)}`);const o=e.length;for(let r=0;r<o;r++){const t=e[r];i.scaleToGeodeticSurface(t,t)}return e}function $Ue(e,t,n,i){let o=t.label;C(o)||(o=C(n.label)?n.label.clone():HUe(),t.label=o),o.text=t.name;let r=t.billboard;C(r)||(r=C(n.billboard)?n.billboard.clone():UUe(),t.billboard=r),C(r.image)?r.image.getValue()||(r.image=void 0):r.image=e._pinBuilder.fromColor(xy.YELLOW,64);let s=1;C(r.scale)&&(s=r.scale.getValue(),0!==s?o.pixelOffset=new ro(16*s+1,0):(o.pixelOffset=void 0,o.horizontalOrigin=void 0)),C(i)&&e._clampToGround&&(r.heightReference=i,o.heightReference=i)}function eVe(e,t){let n=e.path;C(n)||(n=new RX,n.leadTime=0,e.path=n);const i=t.polyline;C(i)&&(n.material=i.material,n.width=i.width)}function tVe(e,t,n,i,o){const r=RUe(n,"coordinates",hUe.kml),s=RUe(n,"altitudeMode",hUe.kml),a=RUe(n,"altitudeMode",hUe.gx),c=LUe(n,"extrude",hUe.kml),l=e._ellipsoid,u=CUe(r,l);return i.position=u,$Ue(e,i,o,QUe(s,a)),c&&TUe(s,a)&&XUe(t,i,o),!0}function nVe(e,t,n,i,o){const r=IUe(n,"coordinates",hUe.kml),s=RUe(n,"altitudeMode",hUe.kml),a=RUe(n,"altitudeMode",hUe.gx),c=LUe(n,"extrude",hUe.kml),l=LUe(n,"tessellate",hUe.kml),u=TUe(s,a),h=PUe(n,"drawOrder",hUe.gx),d=e._ellipsoid,f=EUe(r,d);let p=o.polyline;if(u&&c){const e=new YX;i.wall=e,e.positions=f;const t=o.polygon;C(t)&&(e.fill=t.fill,e.material=t.material),e.outline=!0,C(p)?(e.outlineColor=C(p.material)?p.material.color:xy.WHITE,e.outlineWidth=p.width):C(t)&&(e.outlineColor=C(t.material)?t.material.color:xy.WHITE)}else if(e._clampToGround&&!u&&l){const e=new VX;e.clampToGround=!0,i.polyline=e,e.positions=f,C(p)?(e.material=C(p.material)?p.material.color.getValue(fO.MINIMUM_VALUE):xy.WHITE,e.width=R(p.width,1)):(e.material=xy.WHITE,e.width=1),e.zIndex=h}else C(h)&&CA("kml-gx:drawOrder","KML - gx:drawOrder is not supported in LineStrings when clampToGround is false"),e._clampToGround&&!l&&CA("kml-line-tesselate","Ignoring clampToGround for KML lines without the tessellate flag."),p=C(p)?p.clone():new VX,i.polyline=p,p.positions=ZUe(f,s,a,d),l&&!u||(p.arcType=hf.NONE);return!0}function iVe(e,t,n,i,o){const r=IUe(n,"outerBoundaryIs",hUe.kml);let s=IUe(r,"LinearRing",hUe.kml),a=IUe(s,"coordinates",hUe.kml);const c=e._ellipsoid;let l=EUe(a,c);const u=LUe(n,"extrude",hUe.kml),h=RUe(n,"altitudeMode",hUe.kml),d=RUe(n,"altitudeMode",hUe.gx),f=TUe(h,d),p=C(o.polygon)?o.polygon.clone():VUe(),m=o.polyline;if(C(m)&&(p.outlineColor=C(m.material)?m.material.color:xy.WHITE,p.outlineWidth=m.width),i.polygon=p,f?(p.perPositionHeight=!0,p.extrudedHeight=u?0:void 0):e._clampToGround||(p.height=0),C(l)){const e=new sP(l),t=DUe(n,"innerBoundaryIs",hUe.kml);for(let n=0;n<t.length;n++){s=DUe(t[n],"LinearRing",hUe.kml);for(let t=0;t<s.length;t++)a=IUe(s[t],"coordinates",hUe.kml),l=EUe(a,c),C(l)&&e.holes.push(new sP(l))}p.hierarchy=e}return!0}function oVe(e,t,n,i,o){const r=RUe(n,"altitudeMode",hUe.kml),s=RUe(n,"altitudeMode",hUe.gx),a=DUe(n,"coord",hUe.gx),c=DUe(n,"angles",hUe.gx),l=DUe(n,"when",hUe.kml),u=LUe(n,"extrude",hUe.kml),h=TUe(r,s),d=e._ellipsoid;c.length>0&&CA("kml-gx:angles","KML - gx:angles are not supported in gx:Tracks");const f=Math.min(a.length,l.length),p=[],m=[];for(let g=0;g<f;g++){const e=CUe(a[g].textContent,d);p.push(e),m.push(Ea.fromIso8601(l[g].textContent))}const _=new NTe;return _.addSamples(m,p),i.position=_,$Ue(e,i,o,QUe(r,s)),eVe(i,o),i.availability=new NN,l.length>0&&i.availability.addInterval(new cO({start:m[0],stop:m[m.length-1]})),h&&u&&XUe(t,i,o),!0}function rVe(e,t,n,i,o,r,s,a,c){const l=e[0],u=e[e.length-1],h=new NTe;h.addSamples(e,t),n.intervals.addInterval(new cO({start:l,stop:u,isStartIncluded:c,isStopIncluded:c,data:JUe(h,s,a)})),i.addInterval(new cO({start:l,stop:u,isStartIncluded:c,isStopIncluded:c})),o.intervals.addInterval(new cO({start:l,stop:u,isStartIncluded:c,isStopIncluded:c,data:r}))}function sVe(e,t,n,i,o){const r=LUe(n,"interpolate",hUe.gx),s=DUe(n,"Track",hUe.gx);let a,c,l,u=!1;const h=new XTe,d=new NN,f=new Zbe,p=e._ellipsoid;for(let m=0,_=s.length;m<_;m++){const e=s[m],t=DUe(e,"when",hUe.kml),n=DUe(e,"coord",hUe.gx),i=RUe(e,"altitudeMode",hUe.kml),o=RUe(e,"altitudeMode",hUe.gx),_=TUe(i,o),g=LUe(e,"extrude",hUe.kml),y=Math.min(n.length,t.length),v=[];a=[];for(let r=0;r<y;r++){const e=CUe(n[r].textContent,p);v.push(e),a.push(Ea.fromIso8601(t[r].textContent))}r&&(C(c)&&rVe([c,a[0]],[l,v[0]],f,d,h,!1,"absolute",void 0,!1),c=a[y-1],l=v[v.length-1]),rVe(a,v,f,d,h,_&&g,i,o,!0),u=u||_&&g}return i.availability=d,i.position=f,$Ue(e,i,o),eVe(i,o),u&&(XUe(t,i,o),i.polyline.show=h),!0}const aVe={Point:tVe,LineString:nVe,LinearRing:nVe,Polygon:iVe,Track:oVe,MultiTrack:sVe,MultiGeometry:cVe,Model:lVe};function cVe(e,t,n,i,o,r){const s=n.childNodes;let a=!1;for(let c=0,l=s.length;c<l;c++){const n=s.item(c),l=aVe[n.localName];if(C(l)){const s=wUe(n,t,r);s.parent=i,s.name=i.name,s.availability=i.availability,s.description=i.description,s.kml=i.kml,l(e,t,n,s,o)&&(a=!0)}}return a}function lVe(e,t,n,i,o){return CA("kml-unsupportedGeometry",`KML - Unsupported geometry: ${n.localName}`),!1}function uVe(e,t){const n=IUe(e,"ExtendedData",hUe.kml);if(!C(n))return;C(IUe(n,"SchemaData",hUe.kml))&&CA("kml-schemaData","KML - SchemaData is unsupported"),C(SUe(n,"xmlns:prefix"))&&CA("kml-extendedData","KML - ExtendedData with xmlns:prefix is unsupported");const i={},o=DUe(n,"Data",hUe.kml);if(C(o)){const e=o.length;for(let t=0;t<e;t++){const e=o[t],n=SUe(e,"name");C(n)&&(i[n]={displayName:RUe(e,"displayName",hUe.kml),value:RUe(e,"value",hUe.kml)})}}t.kml.extendedData=i}let hVe;function dVe(e,t,n,i,o){let r,s,a;const c=t.kml,l=c.extendedData,u=RUe(e,"description",hUe.kml),h=R(t.balloonStyle,n.balloonStyle);let d,f=xy.WHITE,p=xy.BLACK,m=u;if(C(h)&&(f=R(h.bgColor,xy.WHITE),p=R(h.textColor,xy.BLACK),m=R(h.text,u)),C(m)){if(m=m.replace("$[name]",R(t.name,"")),m=m.replace("$[description]",R(u,"")),m=m.replace("$[address]",R(c.address,"")),m=m.replace("$[Snippet]",R(c.snippet,"")),m=m.replace("$[id]",t.id),m=m.replace("$[geDirections]",""),C(l)){const e=m.match(/\$\[.+?\]/g);if(null!==e)for(r=0;r<e.length;r++){const t=e[r];let n=t.substr(2,t.length-3);const i=/\/displayName$/.test(n);n=n.replace(/\/displayName$/,""),d=l[n],C(d)&&(d=i?d.displayName:d.value),C(d)&&(m=m.replace(t,R(d,"")))}}}else if(C(l)&&(a=Object.keys(l),a.length>0)){for(m='<table class="cesium-infoBox-defaultTable cesium-infoBox-defaultTable-lighter"><tbody>',r=0;r<a.length;r++)s=a[r],d=l[s],m+=`<tr><th>${R(d.displayName,s)}</th><td>${R(d.value,"")}</td></tr>`;m+="</tbody></table>"}if(!C(m))return;m=nUe.link(m),hVe.innerHTML=m;const _=hVe.querySelectorAll("a");for(r=0;r<_.length;r++)_[r].setAttribute("target","_blank");C(i)&&i.keys.length>1&&(bUe(hVe,"a","href",i),bUe(hVe,"link","href",i),bUe(hVe,"area","href",i),bUe(hVe,"img","src",i),bUe(hVe,"iframe","src",i),bUe(hVe,"video","src",i),bUe(hVe,"audio","src",i),bUe(hVe,"source","src",i),bUe(hVe,"track","src",i),bUe(hVe,"input","src",i),bUe(hVe,"embed","src",i),bUe(hVe,"script","src",i),bUe(hVe,"video","poster",i)),AUe(hVe,"a","href",o),AUe(hVe,"link","href",o),AUe(hVe,"area","href",o),AUe(hVe,"img","src",o),AUe(hVe,"iframe","src",o),AUe(hVe,"video","src",o),AUe(hVe,"audio","src",o),AUe(hVe,"source","src",o),AUe(hVe,"track","src",o),AUe(hVe,"input","src",o),AUe(hVe,"embed","src",o),AUe(hVe,"script","src",o),AUe(hVe,"video","poster",o);let g='<div class="cesium-infoBox-description-lighter" style="';g+="overflow:auto;",g+="word-wrap:break-word;",g+=`background-color:${f.toCssColorString()};`,g+=`color:${p.toCssColorString()};`,g+='">',g+=`${hVe.innerHTML}</div>`,hVe.innerHTML="",t.description=g}function fVe(e,t,n){const i=n.entityCollection,o=n.parentEntity,r=n.sourceResource,s=n.uriResolver,a=wUe(t,i,n.context),c=a.kml,l=jUe(e,t,n.styleCollection,r,s),u=RUe(t,"name",hUe.kml);a.name=u,a.parent=o;let h=kUe(t);function d(e){return!e||e.show&&d(e.parent)}C(h)||(h=zUe(t)),a.availability=h,UVe(a);const f=LUe(t,"visibility",hUe.kml);a.show=d(o)&&R(f,!0);const p=IUe(t,"author",hUe.atom),m=c.author;m.name=RUe(p,"name",hUe.atom),m.uri=RUe(p,"uri",hUe.atom),m.email=RUe(p,"email",hUe.atom);const _=IUe(t,"link",hUe.atom),g=c.link;g.href=SUe(_,"href"),g.hreflang=SUe(_,"hreflang"),g.rel=SUe(_,"rel"),g.type=SUe(_,"type"),g.title=SUe(_,"title"),g.length=SUe(_,"length"),c.address=RUe(t,"address",hUe.kml),c.phoneNumber=RUe(t,"phoneNumber",hUe.kml),c.snippet=RUe(t,"Snippet",hUe.kml),uVe(t,a),dVe(t,a,l,s,r);const y=e._ellipsoid;return TVe(t,a,y),wVe(t,a,y),C(IUe(t,"Region",hUe.kml))&&CA("kml-region","KML - Placemark Regions are unsupported"),{entity:a,styleEntity:l}}function pVe(e,t,n,i){i.addNodes(t.childNodes,n),i.process()}function mVe(e,t,n,i){const o=fVe(e,t,n),r=pn(n);r.parentEntity=o.entity,pVe(e,t,r,i)}function _Ve(e,t,n,i){const o=fVe(e,t,n),r=o.entity,s=o.styleEntity;let a=!1;const c=t.childNodes;for(let l=0,u=c.length;l<u&&!a;l++){const t=c.item(l),i=aVe[t.localName];C(i)&&(i(e,n.entityCollection,t,r,s,r.id),a=!0)}a||(r.merge(s),$Ue(e,r,s))}"undefined"!==typeof document&&(hVe=document.createElement("div"));const gVe={FlyTo:AVe,Wait:bVe,SoundCue:vVe,AnimatedUpdate:vVe,TourControl:vVe};function yVe(e,t,n,i){const o=RUe(t,"name",hUe.kml),r=SUe(t,"id"),s=new Xke(o,r),a=IUe(t,"Playlist",hUe.gx);if(a){const t=e._ellipsoid,n=a.childNodes;for(let e=0;e<n.length;e++){const i=n[e];if(i.localName){const e=gVe[i.localName];e?e(s,i,t):console.log(`Unknown KML Tour playlist entry type ${i.localName}`)}}}e._kmlTours.push(s)}function vVe(e,t){CA(`KML Tour unsupported node ${t.localName}`)}function bVe(e,t){const n=PUe(t,"duration",hUe.gx);e.addPlaylistEntry(new $ke(n))}function AVe(e,t,n){const i=PUe(t,"duration",hUe.gx),o=RUe(t,"flyToMode",hUe.gx),r={kml:{}};TVe(t,r,n),wVe(t,r,n);const s=r.kml.lookAt||r.kml.camera,a=new Jke(i,o,s);e.addPlaylistEntry(a)}function wVe(e,t,n){const i=IUe(e,"Camera",hUe.kml);if(C(i)){const e=R(PUe(i,"longitude",hUe.kml),0),o=R(PUe(i,"latitude",hUe.kml),0),r=R(PUe(i,"altitude",hUe.kml),0),s=R(PUe(i,"heading",hUe.kml),0),a=R(PUe(i,"tilt",hUe.kml),0),c=R(PUe(i,"roll",hUe.kml),0),l=K.fromDegrees(e,o,r,n),u=Ma.fromDegrees(s,a-90,c);t.kml.camera=new Hke(l,u)}}function TVe(e,t,n){const i=IUe(e,"LookAt",hUe.kml);if(C(i)){const e=R(PUe(i,"longitude",hUe.kml),0),o=R(PUe(i,"latitude",hUe.kml),0),r=R(PUe(i,"altitude",hUe.kml),0);let s=PUe(i,"heading",hUe.kml),a=PUe(i,"tilt",hUe.kml);const c=R(PUe(i,"range",hUe.kml),0);a=z.toRadians(R(a,0)),s=z.toRadians(R(s,0));const l=new uI(s,a-z.PI_OVER_TWO,c),u=K.fromDegrees(e,o,r,n);t.kml.lookAt=new Wke(u,l)}}function CVe(e,t,n,i){const o=n.screenOverlayContainer;if(!C(o))return;const r=n.sourceResource,s=n.uriResolver,a=IUe(t,"Icon",hUe.kml),c=GUe(a,e,r,s,!1);if(!C(c))return;const l=document.createElement("img");e._screenOverlays.push(l),l.src=c.url,l.onload=function(){const e=["position: absolute"],n=IUe(t,"screenXY",hUe.kml),i=IUe(t,"overlayXY",hUe.kml),o=IUe(t,"size",hUe.kml);let r,s,a,c,u,h;C(o)&&(r=xUe(o,"x"),s=xUe(o,"y"),a=SUe(o,"xunits"),c=SUe(o,"yunits"),C(r)&&-1!==r&&0!==r&&("fraction"===a?u=`width: ${Math.floor(100*r)}%`:"pixels"===a&&(u=`width: ${r}px`),e.push(u)),C(s)&&-1!==s&&0!==s&&("fraction"===c?h=`height: ${Math.floor(100*s)}%`:"pixels"===c&&(h=`height: ${s}px`),e.push(h))),l.style=e.join(";");let d=0,f=l.height;C(i)&&(r=xUe(i,"x"),s=xUe(i,"y"),a=SUe(i,"xunits"),c=SUe(i,"yunits"),C(r)&&("fraction"===a?d=r*l.width:("pixels"===a||"insetPixels"===a)&&(d=r)),C(s)&&("fraction"===c?f=s*l.height:("pixels"===c||"insetPixels"===c)&&(f=s))),C(n)&&(r=xUe(n,"x"),s=xUe(n,"y"),a=SUe(n,"xunits"),c=SUe(n,"yunits"),C(r)&&("fraction"===a?u=`left: calc(${Math.floor(100*r)}% - ${d}px)`:"pixels"===a?u=`left: ${r-d}px`:"insetPixels"===a&&(u=`right: ${r-d}px`),e.push(u)),C(s)&&("fraction"===c?h=`bottom: calc(${Math.floor(100*s)}% - ${f}px)`:"pixels"===c?h=`bottom: ${s-f}px`:"insetPixels"===c&&(h=`top: ${s-f}px`),e.push(h))),l.style=e.join(";")},o.appendChild(l)}function EVe(e,t,n,i){const o=fVe(e,t,n),r=o.entity;let s,a=!1;const c=e._ellipsoid,l=EUe(IUe(t,"LatLonQuad",hUe.gx),c),u=PUe(t,"drawOrder",hUe.kml);if(C(l))s=VUe(),s.hierarchy=new sP(l),s.zIndex=u,r.polygon=s,a=!0;else{s=new qX,s.zIndex=u,r.rectangle=s;const e=IUe(t,"LatLonBox",hUe.kml);if(C(e)){let t=PUe(e,"west",hUe.kml),n=PUe(e,"south",hUe.kml),i=PUe(e,"east",hUe.kml),o=PUe(e,"north",hUe.kml);C(t)&&(t=z.negativePiToPi(z.toRadians(t))),C(n)&&(n=z.clampToLatitudeRange(z.toRadians(n))),C(i)&&(i=z.negativePiToPi(z.toRadians(i))),C(o)&&(o=z.clampToLatitudeRange(z.toRadians(o))),s.coordinates=new _t(t,n,i,o);const r=PUe(e,"rotation",hUe.kml);if(C(r)){const e=z.toRadians(r);s.rotation=e,s.stRotation=e}}}const h=IUe(t,"Icon",hUe.kml),d=GUe(h,e,n.sourceResource,n.uriResolver,!0);if(C(d)){a&&CA("kml-gx:LatLonQuad","KML - gx:LatLonQuad Icon does not support texture projection.");const e=PUe(h,"x",hUe.gx),n=PUe(h,"y",hUe.gx),i=PUe(h,"w",hUe.gx),o=PUe(h,"h",hUe.gx);(C(e)||C(n)||C(i)||C(o))&&CA("kml-groundOverlay-xywh","KML - gx:x, gx:y, gx:w, gx:h aren't supported for GroundOverlays"),s.material=d,s.material.color=FUe(t,"color",hUe.kml),s.material.transparent=!0}else s.material=FUe(t,"color",hUe.kml);let f=RUe(t,"altitudeMode",hUe.kml);C(f)?"absolute"===f?(s.height=PUe(t,"altitude",hUe.kml),s.zIndex=void 0):"clampToGround"!==f&&CA("kml-altitudeMode-unknown",`KML - Unknown altitudeMode: ${f}`):(f=RUe(t,"altitudeMode",hUe.gx),"relativeToSeaFloor"===f?(CA("kml-altitudeMode-relativeToSeaFloor","KML - altitudeMode relativeToSeaFloor is currently not supported, treating as absolute."),s.height=PUe(t,"altitude",hUe.kml),s.zIndex=void 0):"clampToSeaFloor"===f?CA("kml-altitudeMode-clampToSeaFloor","KML - altitudeMode clampToSeaFloor is currently not supported, treating as clampToGround."):C(f)&&CA("kml-altitudeMode-unknown",`KML - Unknown altitudeMode: ${f}`))}function xVe(e,t,n,i){e._unsupportedNode.raiseEvent(e,n.parentEntity,t,n.entityCollection,n.styleCollection,n.sourceResource,n.uriResolver),CA(`kml-unsupportedFeature-${t.nodeName}`,`KML - Unsupported feature: ${t.nodeName}`)}const SVe={INTERVAL:0,EXPIRE:1,STOP:2};function IVe(e){if(!C(e)||0===e.length)return"";const t=e[0];return"&"!==t&&"?"!==t||(e=e.substring(1)),e}const OVe=new _t,DVe=new se,PVe=new ro,RVe=new K;function LVe(e,t,n,i,o,r){function s(e){return e<-z.PI_OVER_TWO?-z.PI_OVER_TWO:e>z.PI_OVER_TWO?z.PI_OVER_TWO:e}function a(e){return e>z.PI?e-z.TWO_PI:e<-z.PI?e+z.TWO_PI:e}let c=zn(e.queryParameters);if(c=c.replace(/%5B/g,"[").replace(/%5D/g,"]"),C(t)&&t._mode!==ij.MORPHING){let e,l;if(o=R(o,OVe),C(n)&&(PVe.x=.5*n.clientWidth,PVe.y=.5*n.clientHeight,e=t.pickEllipsoid(PVe,r,RVe)),C(e)?l=r.cartesianToCartographic(e,DVe):(l=_t.center(o,DVe),e=r.cartographicToCartesian(l)),C(i)&&!z.equalsEpsilon(i,1,z.EPSILON9)){const e=o.width*i*.5,t=o.height*i*.5;o=new _t(a(l.longitude-e),s(l.latitude-t),a(l.longitude+e),s(l.latitude+t))}c=c.replace("[bboxWest]",z.toDegrees(o.west).toString()),c=c.replace("[bboxSouth]",z.toDegrees(o.south).toString()),c=c.replace("[bboxEast]",z.toDegrees(o.east).toString()),c=c.replace("[bboxNorth]",z.toDegrees(o.north).toString());const u=z.toDegrees(l.longitude).toString(),h=z.toDegrees(l.latitude).toString();c=c.replace("[lookatLon]",u),c=c.replace("[lookatLat]",h),c=c.replace("[lookatTilt]",z.toDegrees(t.pitch).toString()),c=c.replace("[lookatHeading]",z.toDegrees(t.heading).toString()),c=c.replace("[lookatRange]",K.distance(t.positionWC,e)),c=c.replace("[lookatTerrainLon]",u),c=c.replace("[lookatTerrainLat]",h),c=c.replace("[lookatTerrainAlt]",l.height.toString()),r.cartesianToCartographic(t.positionWC,DVe),c=c.replace("[cameraLon]",z.toDegrees(DVe.longitude).toString()),c=c.replace("[cameraLat]",z.toDegrees(DVe.latitude).toString()),c=c.replace("[cameraAlt]",z.toDegrees(DVe.height).toString());const d=t.frustum,f=d.aspectRatio;let p="",m="";if(C(f)){const e=z.toDegrees(d.fov);f>1?(p=e,m=e/f):(m=e,p=e*f)}c=c.replace("[horizFov]",p.toString()),c=c.replace("[vertFov]",m.toString())}else c=c.replace("[bboxWest]","-180"),c=c.replace("[bboxSouth]","-90"),c=c.replace("[bboxEast]","180"),c=c.replace("[bboxNorth]","90"),c=c.replace("[lookatLon]",""),c=c.replace("[lookatLat]",""),c=c.replace("[lookatRange]",""),c=c.replace("[lookatTilt]",""),c=c.replace("[lookatHeading]",""),c=c.replace("[lookatTerrainLon]",""),c=c.replace("[lookatTerrainLat]",""),c=c.replace("[lookatTerrainAlt]",""),c=c.replace("[cameraLon]",""),c=c.replace("[cameraLat]",""),c=c.replace("[cameraAlt]",""),c=c.replace("[horizFov]",""),c=c.replace("[vertFov]","");C(n)?(c=c.replace("[horizPixels]",n.clientWidth),c=c.replace("[vertPixels]",n.clientHeight)):(c=c.replace("[horizPixels]",""),c=c.replace("[vertPixels]","")),c=c.replace("[terrainEnabled]","1"),c=c.replace("[clientVersion]","1"),c=c.replace("[kmlVersion]","2.2"),c=c.replace("[clientName]","Cesium"),c=c.replace("[language]","English"),e.setQueryParameters(Un(c))}function MVe(e,t,n,i){const o=fVe(e,t,n),r=o.entity,s=n.sourceResource,a=n.uriResolver;let c=IUe(t,"Link",hUe.kml);if(C(c)||(c=IUe(t,"Url",hUe.kml)),C(c)){let t,o,l=RUe(c,"href",hUe.kml);if(C(l)){let u=l;if(l=MUe(l,s,n.uriResolver),/^data:/.test(l.getUrlComponent()))/\.kmz/i.test(s.getUrlComponent())||(u=s.getDerivedResource({url:u}));else{u=l.clone(),t=RUe(c,"viewRefreshMode",hUe.kml),o=R(RUe(c,"viewBoundScale",hUe.kml),1);const n="onStop"===t?"BBOX=[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]":"",i=R(RUe(c,"viewFormat",hUe.kml),n),r=RUe(c,"httpQuery",hUe.kml);C(i)&&l.setQueryParameters(Un(IVe(i))),C(r)&&l.setQueryParameters(Un(IVe(r)));const s=e._ellipsoid;LVe(l,e._camera,e._canvas,o,e._lastCameraView.bbox,s)}const h={sourceUri:u,uriResolver:a,context:r.id,screenOverlayContainer:n.screenOverlayContainer},d=new Nbe,f=zVe(e,d,l,h).then((function(n){const i=e._entityCollection,s=d.values;i.suspendEvents();for(let e=0;e<s.length;e++){const t=s[e];C(t.parent)||(t.parent=r,UVe(t)),i.add(t)}i.resumeEvents();const a=RUe(c,"refreshMode",hUe.kml);let u=R(PUe(c,"refreshInterval",hUe.kml),0);if("onInterval"===a&&u>0||"onExpire"===a||"onStop"===t){const t=IUe(n,"NetworkLinkControl",hUe.kml),i=C(t),s=Ea.now(),d={id:wk(),href:l,cookie:{},lastUpdated:s,updating:!1,entity:r,viewBoundScale:o,needsUpdate:!1,cameraUpdateTime:s};let f=0;if(i&&(d.cookie=Un(R(RUe(t,"cookie",hUe.kml),"")),f=R(PUe(t,"minRefreshPeriod",hUe.kml),0)),"onInterval"===a)i&&(u=Math.max(f,u)),d.refreshMode=SVe.INTERVAL,d.time=u;else if("onExpire"===a){let e;if(i&&(e=RUe(t,"expires",hUe.kml)),C(e))try{const t=Ea.fromIso8601(e),n=Ea.secondsDifference(t,s);n>0&&n<f&&Ea.addSeconds(s,f,t),d.refreshMode=SVe.EXPIRE,d.time=t}catch(h){CA("kml-refreshMode-onInterval-onExpire","KML - NetworkLinkControl expires is not a valid date")}else CA("kml-refreshMode-onExpire","KML - refreshMode of onExpire requires the NetworkLinkControl to have an expires element")}else e._camera?(d.refreshMode=SVe.STOP,d.time=R(PUe(c,"viewRefreshTime",hUe.kml),0)):CA("kml-refrehMode-onStop-noCamera","A NetworkLink with viewRefreshMode=onStop requires a camera be passed in when creating the KmlDataSource");C(d.refreshMode)&&e._networkLinks.set(d.id,d)}else"onRegion"===t&&CA("kml-refrehMode-onRegion","KML - Unsupported viewRefreshMode: onRegion")})).catch((function(t){CA(`An error occured during loading ${l.url}`),e._error.raiseEvent(e,t)}));i.addPromise(f)}}}function BVe(e,t,n,i){const o=dUe[t.localName];return C(o)?o(e,t,n,i):xVe(e,t,n,i)}function NVe(e,t,n,i,o,r,s){t.removeAll();const a=n.documentElement,c="Document"===a.localName?a:IUe(a,"Document",hUe.kml);let l=RUe(c,"name",hUe.kml);C(l)||(l=HF(i.getUrlComponent())),C(e._name)||(e._name=l);const u=new kVe._DeferredLoading(e),h=new Nbe(e);return Promise.all(KUe(e,n,h,i,!1,o)).then((function(){let a=n.documentElement;if("kml"===a.localName){const e=a.childNodes;for(let t=0;t<e.length;t++){const n=e[t];if(C(dUe[n.localName])){a=n;break}}}const c={parentEntity:void 0,entityCollection:t,styleCollection:h,sourceResource:i,uriResolver:o,context:s,screenOverlayContainer:r};return t.suspendEvents(),BVe(e,a,c,u),t.resumeEvents(),u.wait().then((function(){return n.documentElement}))}))}function FVe(e,t,n,i,o){const r=Zi("ThirdParty/Workers/z-worker-pako.js");zke.configure({workerScripts:{deflate:[r,"./pako_deflate.min.js"],inflate:[r,"./pako_inflate.min.js"]}});const s=new zke.ZipReader(new zke.BlobReader(n));return Promise.resolve(s.getEntries()).then((function(n){const r=[],a={};let c;for(let e=0;e<n.length;e++){const t=n[e];t.directory||(/\.kml$/i.test(t.filename)?C(c)&&/\//i.test(t.filename)?r.push(vUe(t,a)):(C(c)&&r.push(vUe(c,a)),c=t):r.push(vUe(t,a)))}return C(c)&&r.push(yUe(c,a)),Promise.all(r).then((function(){if(s.close(),!C(a.kml))throw new Je("KMZ file does not contain a KML document.");return a.keys=Object.keys(a),NVe(e,t,a.kml,i,a,o)}))}))}function zVe(e,t,n,i){i=R(i,R.EMPTY_OBJECT);let o=i.sourceUri;const r=i.uriResolver,s=i.context;let a=i.screenOverlayContainer,c=n;if("string"===typeof n||n instanceof Vi){n=Vi.createIfNeeded(n),c=n.fetchBlob(),o=R(o,n.clone());const t=e._resourceCredits,i=n.credits;if(C(i)){const e=i.length;for(let n=0;n<e;n++)t.push(i[n])}}else o=R(o,Vi.DEFAULT.clone());return o=Vi.createIfNeeded(o),C(a)&&(a=Uke(a)),Promise.resolve(c).then((function(n){return n instanceof Blob?pUe(n).then((function(i){return i?FVe(e,t,n,o,a):mUe(n).then((function(n){let i,c;n=_Ue(n),n=gUe(n);try{i=tUe.parseFromString(n,"application/xml")}catch(l){c=l.toString()}if(C(c)||i.body||"parsererror"===i.documentElement.tagName){let e=C(c)?c:i.documentElement.firstChild.nodeValue;throw e||(e=i.body.innerText),new Je(e)}return NVe(e,t,i,o,r,a,s)}))})):NVe(e,t,n,o,r,a,s)})).catch((function(t){return e._error.raiseEvent(e,t),console.log(t),Promise.reject(t)}))}function kVe(e){e=R(e,R.EMPTY_OBJECT);const t=e.camera,n=e.canvas;if(!C(t))throw new x("options.camera is required.");if(!C(n))throw new x("options.canvas is required.");this._changed=new $n,this._error=new $n,this._loading=new $n,this._refresh=new $n,this._unsupportedNode=new $n,this._clock=void 0,this._entityCollection=new Nbe(this),this._name=void 0,this._isLoading=!1,this._pinBuilder=new lD,this._networkLinks=new ff,this._entityCluster=new Lwe,this._canvas=n,this._camera=t,this._lastCameraView={position:C(t)?K.clone(t.positionWC):void 0,direction:C(t)?K.clone(t.directionWC):void 0,up:C(t)?K.clone(t.upWC):void 0,bbox:C(t)?t.computeViewRectangle():_t.clone(_t.MAX_VALUE)},this._ellipsoid=R(e.ellipsoid,ge.WGS84);let i=e.credit;"string"===typeof i&&(i=new Tr(i)),this._credit=i,this._resourceCredits=[],this._kmlTours=[],this._screenOverlays=[]}function UVe(e){const t=e.parent;if(C(t)){const n=t.availability;if(C(n)){const t=e.availability;C(t)?t.intersect(n):e.availability=n}}}function VVe(e,t,n,i,o){return function(r){if(!i.contains(t.id))return;let s=!1;const a=IUe(r,"NetworkLinkControl",hUe.kml),c=C(a);let l=0;if(c){if(C(IUe(a,"Update",hUe.kml)))return CA("kml-networkLinkControl-update","KML - NetworkLinkControl updates aren't supported."),t.updating=!1,void i.remove(t.id);t.cookie=Un(R(RUe(a,"cookie",hUe.kml),"")),l=R(PUe(a,"minRefreshPeriod",hUe.kml),0)}const u=Ea.now(),h=t.refreshMode;if(h===SVe.INTERVAL)C(a)&&(t.time=Math.max(l,t.time));else if(h===SVe.EXPIRE){let e;if(C(a)&&(e=RUe(a,"expires",hUe.kml)),C(e))try{const n=Ea.fromIso8601(e),i=Ea.secondsDifference(n,u);i>0&&i<l&&Ea.addSeconds(u,l,n),t.time=n}catch(T){CA("kml-networkLinkControl-expires","KML - NetworkLinkControl expires is not a valid date"),s=!0}else CA("kml-refreshMode-onExpire","KML - refreshMode of onExpire requires the NetworkLinkControl to have an expires element"),s=!0}const d=t.entity,f=e._entityCollection,p=n.values;function m(e){f.remove(e);const t=e._children,n=t.length;for(let i=0;i<n;++i)m(t[i])}f.suspendEvents();const _=f.values.slice();let g;for(g=0;g<_.length;++g){const e=_[g];e.parent===d&&(e.parent=void 0,m(e))}for(f.resumeEvents(),f.suspendEvents(),g=0;g<p.length;g++){const e=p[g];C(e.parent)||(e.parent=d,UVe(e)),f.add(e)}f.resumeEvents(),s?i.remove(t.id):t.lastUpdated=u;const y=f.computeAvailability(),v=y.start,b=y.stop,A=Ea.equals(v,fO.MINIMUM_VALUE),w=Ea.equals(b,fO.MAXIMUM_VALUE);if(!A||!w){const t=e._clock;t.startTime===v&&t.stopTime===b||(t.startTime=v,t.stopTime=b,e._changed.raiseEvent(e))}t.updating=!1,t.needsUpdate=!1,e._refresh.raiseEvent(e,o.getUrlComponent(!0))}}kVe.load=function(e,t){t=R(t,R.EMPTY_OBJECT);const n=new kVe(t);return n.load(e,t)},Object.defineProperties(kVe.prototype,{name:{get:function(){return this._name},set:function(e){this._name!==e&&(this._name=e,this._changed.raiseEvent(this))}},clock:{get:function(){return this._clock}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},refreshEvent:{get:function(){return this._refresh}},unsupportedNodeEvent:{get:function(){return this._unsupportedNode}},show:{get:function(){return this._entityCollection.show},set:function(e){this._entityCollection.show=e}},clustering:{get:function(){return this._entityCluster},set:function(e){if(!C(e))throw new x("value must be defined.");this._entityCluster=e}},credit:{get:function(){return this._credit}},kmlTours:{get:function(){return this._kmlTours}}}),kVe.prototype.load=function(e,t){if(!C(e))throw new x("data is required.");t=R(t,R.EMPTY_OBJECT),hAe.setLoading(this,!0);const n=this._name;this._name=void 0,this._clampToGround=R(t.clampToGround,!1);const i=this;return zVe(this,this._entityCollection,e,t).then((function(){let e;const t=i._entityCollection.computeAvailability();let o=t.start,r=t.stop;const s=Ea.equals(o,fO.MINIMUM_VALUE),a=Ea.equals(r,fO.MAXIMUM_VALUE);if(!s||!a){let t;s&&(t=new Date,t.setHours(0,0,0,0),o=Ea.fromDate(t)),a&&(t=new Date,t.setHours(24,0,0,0),r=Ea.fromDate(t)),e=new qwe,e.startTime=o,e.stopTime=r,e.currentTime=Ea.clone(o),e.clockRange=uy.LOOP_STOP,e.clockStep=dy.SYSTEM_CLOCK_MULTIPLIER,e.multiplier=Math.round(Math.min(Math.max(Ea.secondsDifference(r,o)/60,1),31556900))}let c=!1;return e!==i._clock&&(i._clock=e,c=!0),n!==i._name&&(c=!0),c&&i._changed.raiseEvent(i),hAe.setLoading(i,!1),i})).catch((function(e){return hAe.setLoading(i,!1),i._error.raiseEvent(i,e),console.log(e),Promise.reject(e)}))},kVe.prototype.destroy=function(){while(this._screenOverlays.length>0){const e=this._screenOverlays.pop();e.remove()}};const HVe=new ff;function GVe(){this.author={name:void 0,uri:void 0,email:void 0},this.link={href:void 0,hreflang:void 0,rel:void 0,type:void 0,title:void 0,length:void 0},this.address=void 0,this.phoneNumber=void 0,this.snippet=void 0,this.extendedData=void 0}kVe.prototype.update=function(e){const t=this._networkLinks;if(0===t.length)return!0;const n=Ea.now(),i=this;function o(e){const t=e._children,n=t.length;for(let i=0;i<n;++i){const e=t[i];HVe.set(e.id,e),o(e)}}HVe.removeAll();let r=!1;const s=this._lastCameraView,a=this._camera;!C(a)||a.positionWC.equalsEpsilon(s.position,z.EPSILON7)&&a.directionWC.equalsEpsilon(s.direction,z.EPSILON7)&&a.upWC.equalsEpsilon(s.up,z.EPSILON7)||(s.position=K.clone(a.positionWC),s.direction=K.clone(a.directionWC),s.up=K.clone(a.upWC),s.bbox=a.computeViewRectangle(),r=!0);const c=new ff;let l=!1;return t.values.forEach((function(e){const t=e.entity;if(!HVe.contains(t.id)){if(!e.updating){let a=!1;if(e.refreshMode===SVe.INTERVAL?Ea.secondsDifference(n,e.lastUpdated)>e.time&&(a=!0):e.refreshMode===SVe.EXPIRE?Ea.greaterThan(n,e.time)&&(a=!0):e.refreshMode===SVe.STOP&&(r&&(e.needsUpdate=!0,e.cameraUpdateTime=n),e.needsUpdate&&Ea.secondsDifference(n,e.cameraUpdateTime)>=e.time&&(a=!0)),a){o(t),e.updating=!0;const n=new Nbe,r=e.href.clone();r.setQueryParameters(e.cookie);const a=R(i._ellipsoid,ge.WGS84);LVe(r,i._camera,i._canvas,e.viewBoundScale,s.bbox,a),zVe(i,n,r,{context:t.id}).then(VVe(i,e,n,c,r)).catch((function(t){const n=`NetworkLink ${e.href} refresh failed: ${t}`;console.log(n),i._error.raiseEvent(i,n)})),l=!0}}c.set(e.id,e)}})),l&&(this._networkLinks=c,this._changed.raiseEvent(this)),!0},kVe._DeferredLoading=fUe,kVe._getTimestamp=py;function WVe(){x.throwInstantiationError()}WVe.prototype.update=x.throwInstantiationError,WVe.prototype.getBoundingSphere=x.throwInstantiationError,WVe.prototype.isDestroyed=x.throwInstantiationError,WVe.prototype.destroy=x.throwInstantiationError;const qVe=32,jVe="http://www.opengis.net/kml/2.2",YVe="http://www.google.com/kml/ext/2.2",KVe="http://www.w3.org/2000/xmlns/";function XVe(e){this._files={},this._promises=[],this._count=0,this._modelCallback=e}const QVe=/^data:image\/([^,;]+)/;function JVe(e,t){return function(n){e._files[t]=n}}function ZVe(e){this._time=e}function $Ve(){this._ids={},this._styles={},this._count=0}function eHe(){this._ids={}}function tHe(e){e=R(e,R.EMPTY_OBJECT);const t=e.entities,n=R(e.kmz,!1);if(!C(t))throw new x("entities is required.");const i=tHe._createState(e),o=t.values.filter((function(e){return!C(e.parent)})),r=i.kmlDoc,s=r.documentElement;s.setAttributeNS(KVe,"xmlns:gx",YVe);const a=r.createElement("Document");s.appendChild(a),oHe(i,a,o),i.styleCache.save(a);const c=i.externalFileHandler;return c.promise.then((function(){const e=new XMLSerializer,t=e.serializeToString(i.kmlDoc);return n?nHe(t,c.files):{kml:t,externalFiles:c.files}}))}function nHe(e,t){const n=Zi("ThirdParty/Workers/z-worker-pako.js");zke.configure({workerScripts:{deflate:[n,"./pako_deflate.min.js"],inflate:[n,"./pako_inflate.min.js"]}});const i=new zke.BlobWriter,o=new zke.ZipWriter(i);return o.add("doc.kml",new zke.TextReader(e)).then((function(){const e=Object.keys(t);return iHe(o,e,t,0)})).then((function(){return o.close()})).then((function(e){return{kmz:e}}))}function iHe(e,t,n,i){if(t.length===i)return;const o=t[i];return e.add(o,new zke.BlobReader(n[o])).then((function(){return iHe(e,t,n,i+1)}))}function oHe(e,t,n){const i=e.kmlDoc,o=e.styleCache,r=e.valueGetter,s=e.idManager,a=n.length;let c,l,u;for(let h=0;h<a;++h){const a=n[h];let d;c=[],l=[],u=[],cHe(e,a,l,u),dHe(e,a.polyline,l,u),_He(e,a.rectangle,l,u,c),_He(e,a.polygon,l,u,c),vHe(e,a,a.model,l,u);const f=a.availability;C(f)&&(d=i.createElement("TimeSpan"),Ea.equals(f.start,fO.MINIMUM_VALUE)||d.appendChild(THe(i,"begin",Ea.toIso8601(f.start))),Ea.equals(f.stop,fO.MAXIMUM_VALUE)||d.appendChild(THe(i,"end",Ea.toIso8601(f.stop))));for(let e=0;e<c.length;++e){const n=c[e];n.setAttribute("id",s.get(a.id)),n.appendChild(THe(i,"name",a.name)),n.appendChild(THe(i,"visibility",a.show)),n.appendChild(THe(i,"description",a.description)),C(d)&&n.appendChild(d),t.appendChild(n)}const p=l.length;if(p>0){const e=i.createElement("Placemark");e.setAttribute("id",s.get(a.id));let n=a.name;const c=a.label;if(C(c)){const e=i.createElement("LabelStyle"),t=r.get(c.text);n=C(t)&&t.length>0?t:n;const o=r.getColor(c.fillColor);C(o)&&(e.appendChild(THe(i,"color",o)),e.appendChild(THe(i,"colorMode","normal")));const s=r.get(c.scale);C(s)&&e.appendChild(THe(i,"scale",s)),u.push(e)}e.appendChild(THe(i,"name",n)),e.appendChild(THe(i,"visibility",a.show)),e.appendChild(THe(i,"description",a.description)),C(d)&&e.appendChild(d),t.appendChild(e);const h=u.length;if(h>0){const t=i.createElement("Style");for(let e=0;e<h;++e)t.appendChild(u[e]);e.appendChild(THe(i,"styleUrl",o.get(t)))}if(1===l.length)e.appendChild(l[0]);else if(l.length>1){const t=i.createElement("MultiGeometry");for(let e=0;e<p;++e)t.appendChild(l[e]);e.appendChild(t)}}const m=a._children;if(m.length>0){const n=i.createElement("Folder");n.setAttribute("id",s.get(a.id)),n.appendChild(THe(i,"name",a.name)),n.appendChild(THe(i,"visibility",a.show)),n.appendChild(THe(i,"description",a.description)),t.appendChild(n),oHe(e,n,m)}}}XVe.prototype.texture=function(e){const t=this;let n;if("string"===typeof e||e instanceof Vi){if(e=Vi.createIfNeeded(e),!e.isDataUri)return e.url;const i=e.url.match(QVe);n="texture_"+ ++this._count,C(i)&&(n+=`.${i[1]}`);const o=e.fetchBlob().then((function(e){t._files[n]=e}));return this._promises.push(o),n}if(e instanceof HTMLCanvasElement){const i=yn();return this._promises.push(i.promise),n=`texture_${++this._count}.png`,e.toBlob((function(e){t._files[n]=e,i.resolve()})),n}return""},XVe.prototype.model=function(e,t){const n=this._modelCallback;if(!C(n))throw new Je("Encountered a model entity while exporting to KML, but no model callback was supplied.");const i={},o=n(e,t,i);for(const r in i)if(i.hasOwnProperty(r)){const e=Promise.resolve(i[r]);this._promises.push(e),e.then(JVe(this,r))}return o},Object.defineProperties(XVe.prototype,{promise:{get:function(){return Promise.all(this._promises)}},files:{get:function(){return this._files}}}),ZVe.prototype.get=function(e,t,n){let i;return C(e)&&(i=C(e.getValue)?e.getValue(this._time,n):e),R(i,t)},ZVe.prototype.getColor=function(e,t){const n=this.get(e,t);if(C(n))return CHe(n)},ZVe.prototype.getMaterialType=function(e){if(C(e))return e.getType(this._time)},$Ve.prototype.get=function(e){const t=this._ids,n=e.innerHTML;if(C(t[n]))return t[n];let i="style-"+ ++this._count;return e.setAttribute("id",i),i=`#${i}`,t[n]=i,this._styles[n]=e,i},$Ve.prototype.save=function(e){const t=this._styles,n=e.childNodes[0];for(const i in t)t.hasOwnProperty(i)&&e.insertBefore(t[i],n)},eHe.prototype.get=function(e){if(!C(e))return this.get(wk());const t=this._ids;return C(t[e])?`${e.toString()}-${++t[e]}`:(t[e]=0,e)},tHe._createState=function(e){const t=e.entities,n=new $Ve,i=t.computeAvailability(),o=C(e.time)?e.time:i.start;let r=R(e.defaultAvailability,i);const s=R(e.sampleDuration,60);r.start===fO.MINIMUM_VALUE?r.stop===fO.MAXIMUM_VALUE?r=new cO:Ea.addSeconds(r.stop,-10*s,r.start):r.stop===fO.MAXIMUM_VALUE&&Ea.addSeconds(r.start,10*s,r.stop);const a=new XVe(e.modelCallback),c=document.implementation.createDocument(jVe,"kml");return{kmlDoc:c,ellipsoid:R(e.ellipsoid,ge.WGS84),idManager:new eHe,styleCache:n,externalFileHandler:a,time:o,valueGetter:new ZVe(o),sampleDuration:s,defaultAvailability:new NN([r])}};const rHe=new K,sHe=new se,aHe=new Ea;function cHe(e,t,n,i){const o=e.kmlDoc,r=e.ellipsoid,s=e.valueGetter,a=R(t.billboard,t.point);if(!C(a)&&!C(t.path))return;const c=t.position;if(!c.isConstant)return void lHe(e,t,a,n,i);s.get(c,void 0,rHe);const l=THe(o,"coordinates",wHe(rHe,r)),u=o.createElement("Point"),h=o.createElement("altitudeMode");h.appendChild(AHe(e,a.heightReference)),u.appendChild(h),u.appendChild(l),n.push(u);const d=a instanceof Ez?hHe(e,a):uHe(e,a);i.push(d)}function lHe(e,t,n,i,o){const r=e.kmlDoc,s=e.ellipsoid,a=e.valueGetter;let c;const l=t.position;let u=!0;l instanceof Zbe?(c=l.intervals,u=!1):c=R(t.availability,e.defaultAvailability);const h=n instanceof IX;let d,f,p;const m=[];for(d=0;d<c.length;++d){const t=c.get(d);let i=u?l:t.data;const o=r.createElement("altitudeMode");i instanceof XIe?(i=i._value,o.appendChild(AHe(e,Sz.CLAMP_TO_GROUND))):C(n)?o.appendChild(AHe(e,n.heightReference)):o.appendChild(AHe(e,Sz.NONE));const _=[],g=[];if(i.isConstant){a.get(i,void 0,rHe);const e=THe(r,"coordinates",wHe(rHe,s));_.push(Ea.toIso8601(t.start)),g.push(e),_.push(Ea.toIso8601(t.stop)),g.push(e)}else if(i instanceof NTe)for(p=i._property._times,f=0;f<p.length;++f)_.push(Ea.toIso8601(p[f])),i.getValueInReferenceFrame(p[f],vL.FIXED,rHe),g.push(wHe(rHe,s));else if(i instanceof MTe){p=i._times;const e=i._values;for(f=0;f<p.length;++f)_.push(Ea.toIso8601(p[f])),K.fromArray(e,3*f,rHe),g.push(wHe(rHe,s))}else{const n=e.sampleDuration;t.start.clone(aHe),t.isStartIncluded||Ea.addSeconds(aHe,n,aHe);const o=t.stop;while(Ea.lessThan(aHe,o))i.getValue(aHe,rHe),_.push(Ea.toIso8601(aHe)),g.push(wHe(rHe,s)),Ea.addSeconds(aHe,n,aHe);t.isStopIncluded&&Ea.equals(aHe,o)&&(i.getValue(aHe,rHe),_.push(Ea.toIso8601(aHe)),g.push(wHe(rHe,s)))}const y=r.createElementNS(YVe,"Track");y.appendChild(o);for(let e=0;e<_.length;++e){const t=THe(r,"when",_[e]),n=THe(r,"coord",g[e],YVe);y.appendChild(t),y.appendChild(n)}h&&y.appendChild(yHe(e,n)),m.push(y)}if(1===m.length)i.push(m[0]);else if(m.length>1){const e=r.createElementNS(YVe,"MultiTrack");for(d=0;d<m.length;++d)e.appendChild(m[d]);i.push(e)}if(C(n)&&!h){const t=n instanceof Ez?hHe(e,n):uHe(e,n);o.push(t)}const _=t.path;if(C(_)){const t=a.get(_.width),n=_.material;if(C(n)||C(t)){const i=r.createElement("LineStyle");C(t)&&i.appendChild(THe(r,"width",t)),bHe(e,n,i),o.push(i)}}}function uHe(e,t){const n=e.kmlDoc,i=e.valueGetter,o=n.createElement("IconStyle"),r=i.getColor(t.color);C(r)&&(o.appendChild(THe(n,"color",r)),o.appendChild(THe(n,"colorMode","normal")));const s=i.get(t.pixelSize);return C(s)&&o.appendChild(THe(n,"scale",s/qVe)),o}function hHe(e,t){const n=e.kmlDoc,i=e.valueGetter,o=e.externalFileHandler,r=n.createElement("IconStyle");let s=i.get(t.image);if(C(s)){s=o.texture(s);const e=n.createElement("Icon");e.appendChild(THe(n,"href",s));const a=i.get(t.imageSubRegion);C(a)&&(e.appendChild(THe(n,"x",a.x,YVe)),e.appendChild(THe(n,"y",a.y,YVe)),e.appendChild(THe(n,"w",a.width,YVe)),e.appendChild(THe(n,"h",a.height,YVe))),r.appendChild(e)}const a=i.getColor(t.color);C(a)&&(r.appendChild(THe(n,"color",a)),r.appendChild(THe(n,"colorMode","normal")));let c=i.get(t.scale);C(c)&&r.appendChild(THe(n,"scale",c));const l=i.get(t.pixelOffset);if(C(l)){c=R(c,1),ro.divideByScalar(l,c,l);const e=i.get(t.width,qVe),o=i.get(t.height,qVe),s=i.get(t.horizontalOrigin,Oz.CENTER);s===Oz.CENTER?l.x-=.5*e:s===Oz.RIGHT&&(l.x-=e);const a=i.get(t.verticalOrigin,Pz.CENTER);a===Pz.TOP?l.y+=o:a===Pz.CENTER&&(l.y+=.5*o);const u=n.createElement("hotSpot");u.setAttribute("x",-l.x),u.setAttribute("y",l.y),u.setAttribute("xunits","pixels"),u.setAttribute("yunits","pixels"),r.appendChild(u)}let u=i.get(t.rotation);const h=i.get(t.alignedAxis);return C(u)&&K.equals(K.UNIT_Z,h)&&(u=z.toDegrees(-u),0===u&&(u=360),r.appendChild(THe(n,"heading",u))),r}function dHe(e,t,n,i){const o=e.kmlDoc,r=e.ellipsoid,s=e.valueGetter;if(!C(t))return;const a=o.createElement("LineString"),c=o.createElement("altitudeMode"),l=s.get(t.clampToGround,!1);let u;l?(a.appendChild(THe(o,"tessellate",!0)),u=o.createTextNode("clampToGround")):u=o.createTextNode("absolute"),c.appendChild(u),a.appendChild(c);const h=t.positions,d=s.get(h),f=THe(o,"coordinates",wHe(d,r));a.appendChild(f);const p=s.get(t.zIndex);l&&C(p)&&a.appendChild(THe(o,"drawOrder",p,YVe)),n.push(a);const m=o.createElement("LineStyle"),_=s.get(t.width);C(_)&&m.appendChild(THe(o,"width",_)),bHe(e,t.material,m),i.push(m)}function fHe(e,t,n){const i=e.kmlDoc,o=e.valueGetter;let r=o.get(t.height,0);n>0&&(r=n);const s=t.coordinates,a=o.get(s),c=[],l=[_t.northeast,_t.southeast,_t.southwest,_t.northwest];for(let f=0;f<4;++f)l[f](a,sHe),c.push(`${z.toDegrees(sHe.longitude)},${z.toDegrees(sHe.latitude)},${r}`);const u=THe(i,"coordinates",c.join(" ")),h=i.createElement("outerBoundaryIs"),d=i.createElement("LinearRing");return d.appendChild(u),h.appendChild(d),[h]}function pHe(e,t,n,i){const o=e.kmlDoc,r=e.ellipsoid,s=[],a=t.length;for(let u=0;u<a;++u)se.fromCartesian(t[u],r,sHe),s.push(`${z.toDegrees(sHe.longitude)},${z.toDegrees(sHe.latitude)},${i?sHe.height:n}`);const c=THe(o,"coordinates",s.join(" ")),l=o.createElement("LinearRing");return l.appendChild(c),l}function mHe(e,t,n){const i=e.kmlDoc,o=e.valueGetter;let r=o.get(t.height,0);const s=o.get(t.perPositionHeight,!1);!s&&n>0&&(r=n);const a=[],c=t.hierarchy,l=o.get(c),u=Array.isArray(l)?l:l.positions,h=i.createElement("outerBoundaryIs");h.appendChild(pHe(e,u,r,s)),a.push(h);const d=l.holes;if(C(d)){const t=d.length;for(let n=0;n<t;++n){const t=i.createElement("innerBoundaryIs");t.appendChild(pHe(e,d[n].positions,r,s)),a.push(t)}}return a}function _He(e,t,n,i,o){const r=e.kmlDoc,s=e.valueGetter;if(!C(t))return;const a=t instanceof qX;if(a&&"Image"===s.getMaterialType(t.material))return void gHe(e,t,o);const c=r.createElement("Polygon"),l=s.get(t.extrudedHeight,0);l>0&&c.appendChild(THe(r,"extrude",!0));const u=a?fHe(e,t,l):mHe(e,t,l),h=u.length;for(let _=0;_<h;++_)c.appendChild(u[_]);const d=r.createElement("altitudeMode");d.appendChild(AHe(e,t.heightReference)),c.appendChild(d),n.push(c);const f=r.createElement("PolyStyle"),p=s.get(t.fill,!1);p&&f.appendChild(THe(r,"fill",p)),bHe(e,t.material,f);const m=s.get(t.outline,!1);if(m){f.appendChild(THe(r,"outline",m));const e=r.createElement("LineStyle"),n=s.get(t.outlineWidth,1);e.appendChild(THe(r,"width",n));const o=s.getColor(t.outlineColor,xy.BLACK);e.appendChild(THe(r,"color",o)),e.appendChild(THe(r,"colorMode","normal")),i.push(e)}i.push(f)}function gHe(e,t,n){const i=e.kmlDoc,o=e.valueGetter,r=e.externalFileHandler,s=i.createElement("GroundOverlay"),a=i.createElement("altitudeMode");a.appendChild(AHe(e,t.heightReference)),s.appendChild(a);const c=o.get(t.height);C(c)&&s.appendChild(THe(i,"altitude",c));const l=o.get(t.coordinates),u=i.createElement("LatLonBox");u.appendChild(THe(i,"north",z.toDegrees(l.north))),u.appendChild(THe(i,"south",z.toDegrees(l.south))),u.appendChild(THe(i,"east",z.toDegrees(l.east))),u.appendChild(THe(i,"west",z.toDegrees(l.west))),s.appendChild(u);const h=o.get(t.material),d=r.texture(h.image),f=i.createElement("Icon");f.appendChild(THe(i,"href",d)),s.appendChild(f);const p=h.color;C(p)&&s.appendChild(THe(i,"color",CHe(h.color))),n.push(s)}function yHe(e,t){const n=e.kmlDoc,i=e.valueGetter,o=e.externalFileHandler,r=n.createElement("Model"),s=i.get(t.scale);if(C(s)){const e=n.createElement("scale");e.appendChild(THe(n,"x",s)),e.appendChild(THe(n,"y",s)),e.appendChild(THe(n,"z",s)),r.appendChild(e)}const a=n.createElement("Link"),c=o.model(t,e.time);return a.appendChild(THe(n,"href",c)),r.appendChild(a),r}function vHe(e,t,n,i,o){const r=e.kmlDoc,s=e.ellipsoid,a=e.valueGetter;if(!C(n))return;const c=t.position;if(!c.isConstant)return void lHe(e,t,n,i,o);const l=yHe(e,n),u=r.createElement("altitudeMode");u.appendChild(AHe(e,n.heightReference)),l.appendChild(u),a.get(c,void 0,rHe),se.fromCartesian(rHe,s,sHe);const h=r.createElement("Location");h.appendChild(THe(r,"longitude",z.toDegrees(sHe.longitude))),h.appendChild(THe(r,"latitude",z.toDegrees(sHe.latitude))),h.appendChild(THe(r,"altitude",sHe.height)),l.appendChild(h),i.push(l)}function bHe(e,t,n){const i=e.kmlDoc,o=e.valueGetter;if(!C(t))return;const r=o.get(t);if(!C(r))return;let s;const a=o.getMaterialType(t);let c,l;switch(a){case"Image":s=CHe(xy.WHITE);break;case"Color":case"Grid":case"PolylineGlow":case"PolylineArrow":case"PolylineDash":s=CHe(r.color);break;case"PolylineOutline":s=CHe(r.color),c=CHe(r.outlineColor),l=r.outlineWidth,n.appendChild(THe(i,"outerColor",c,YVe)),n.appendChild(THe(i,"outerWidth",l,YVe));break;case"Stripe":s=CHe(r.oddColor);break}C(s)&&(n.appendChild(THe(i,"color",s)),n.appendChild(THe(i,"colorMode","normal")))}function AHe(e,t){const n=e.kmlDoc,i=e.valueGetter,o=i.get(t,Sz.NONE);let r;switch(o){case Sz.NONE:r=n.createTextNode("absolute");break;case Sz.CLAMP_TO_GROUND:r=n.createTextNode("clampToGround");break;case Sz.RELATIVE_TO_GROUND:r=n.createTextNode("relativeToGround");break}return r}function wHe(e,t){Array.isArray(e)||(e=[e]);const n=e.length,i=[];for(let o=0;o<n;++o)se.fromCartesian(e[o],t,sHe),i.push(`${z.toDegrees(sHe.longitude)},${z.toDegrees(sHe.latitude)},${sHe.height}`);return i.join(" ")}function THe(e,t,n,i){n=R(n,""),"boolean"===typeof n&&(n=n?"1":"0");const o=C(i)?e.createElementNS(i,t):e.createElement(t),r="string"===n&&-1!==n.indexOf("<")?e.createCDATASection(n):e.createTextNode(n);return o.appendChild(r),o}function CHe(e){let t="";const n=e.toBytes();for(let i=3;i>=0;--i)t+=n[i]<16?`0${n[i].toString(16)}`:n[i].toString(16);return t}var EHe="attribute vec4 position;\nattribute vec2 textureCoordinates;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main() \n{\n    gl_Position = position;\n    v_textureCoordinates = textureCoordinates;\n}\n";function xHe(e){this._context=e}let SHe;const IHe=new UU({primitiveType:xf.TRIANGLES}),OHe=new tJ({color:new xy(0,0,0,0)});function DHe(e,t){return new mie({context:e,colorTextures:[t],destroyAttachments:!1})}function PHe(e,t){return fH.fromCache({context:e,vertexShaderSource:EHe,fragmentShaderSource:t,attributeLocations:{position:0,textureCoordinates:1}})}function RHe(e,t){return C(SHe)&&SHe.viewport.width===e&&SHe.viewport.height===t||(SHe=yV.fromCache({viewport:new bf(0,0,e,t)})),SHe}xHe.prototype.execute=function(e){if(D.defined("computeCommand",e),C(e.preExecute)&&e.preExecute(e),!C(e.fragmentShaderSource)&&!C(e.shaderProgram))throw new x("computeCommand.fragmentShaderSource or computeCommand.shaderProgram is required.");D.defined("computeCommand.outputTexture",e.outputTexture);const t=e.outputTexture,n=t.width,i=t.height,o=this._context,r=C(e.vertexArray)?e.vertexArray:o.getViewportQuadVertexArray(),s=C(e.shaderProgram)?e.shaderProgram:PHe(o,e.fragmentShaderSource),a=DHe(o,t),c=RHe(n,i),l=e.uniformMap,u=OHe;u.framebuffer=a,u.renderState=c,u.execute(o);const h=IHe;h.vertexArray=r,h.renderState=c,h.shaderProgram=s,h.uniformMap=l,h.framebuffer=a,h.execute(o),a.destroy(),e.persists||(s.destroy(),C(e.vertexArray)&&r.destroy()),C(e.postExecute)&&e.postExecute(t)},xHe.prototype.isDestroyed=function(){return!1},xHe.prototype.destroy=function(){return Qh(this)};var LHe=xHe;function MHe(e){this.context=e,this.framebuffer=void 0,this.blendingEnabled=void 0,this.scissorTest=void 0,this.viewport=void 0}var BHe=MHe;function NHe(e){this._context=e,this._shaders={},this._numberOfShaders=0,this._shadersToRelease={}}function FHe(e,t){const n=t.derivedKeywords,i=n.length;for(let o=0;o<i;++o){const i=n[o]+t.keyword,r=e._shaders[i];FHe(e,r)}delete e._shaders[t.keyword],t.shaderProgram.finalDestroy()}Object.defineProperties(NHe.prototype,{numberOfShaders:{get:function(){return this._numberOfShaders}}}),NHe.prototype.replaceShaderProgram=function(e){return C(e.shaderProgram)&&e.shaderProgram.destroy(),this.getShaderProgram(e)},NHe.prototype.getShaderProgram=function(e){let t=e.vertexShaderSource,n=e.fragmentShaderSource;const i=e.attributeLocations;"string"===typeof t&&(t=new tq({sources:[t]})),"string"===typeof n&&(n=new tq({sources:[n]}));const o=t.createCombinedVertexShader(this._context),r=n.createCombinedFragmentShader(this._context),s=o+r+JSON.stringify(i);let a;if(C(this._shaders[s]))a=this._shaders[s],delete this._shadersToRelease[s];else{const e=this._context,c=new fH({gl:e._gl,logShaderCompilation:e.logShaderCompilation,debugShaders:e.debugShaders,vertexShaderSource:t,vertexShaderText:o,fragmentShaderSource:n,fragmentShaderText:r,attributeLocations:i});a={cache:this,shaderProgram:c,keyword:s,derivedKeywords:[],count:0},c._cachedShader=a,this._shaders[s]=a,++this._numberOfShaders}return++a.count,a.shaderProgram},NHe.prototype.replaceDerivedShaderProgram=function(e,t,n){const i=e._cachedShader,o=t+i.keyword,r=this._shaders[o];if(C(r)){FHe(this,r);const e=i.derivedKeywords.indexOf(t);e>-1&&i.derivedKeywords.splice(e,1)}return this.createDerivedShaderProgram(e,t,n)},NHe.prototype.getDerivedShaderProgram=function(e,t){const n=e._cachedShader,i=t+n.keyword,o=this._shaders[i];if(C(o))return o.shaderProgram},NHe.prototype.createDerivedShaderProgram=function(e,t,n){const i=e._cachedShader,o=t+i.keyword;let r=n.vertexShaderSource,s=n.fragmentShaderSource;const a=n.attributeLocations;"string"===typeof r&&(r=new tq({sources:[r]})),"string"===typeof s&&(s=new tq({sources:[s]}));const c=this._context,l=r.createCombinedVertexShader(c),u=s.createCombinedFragmentShader(c),h=new fH({gl:c._gl,logShaderCompilation:c.logShaderCompilation,debugShaders:c.debugShaders,vertexShaderSource:r,vertexShaderText:l,fragmentShaderSource:s,fragmentShaderText:u,attributeLocations:a}),d={cache:this,shaderProgram:h,keyword:o,derivedKeywords:[],count:0};return i.derivedKeywords.push(t),h._cachedShader=d,this._shaders[o]=d,h},NHe.prototype.destroyReleasedShaderPrograms=function(){const e=this._shadersToRelease;for(const t in e)if(e.hasOwnProperty(t)){const n=e[t];FHe(this,n),--this._numberOfShaders}this._shadersToRelease={}},NHe.prototype.releaseShaderProgram=function(e){if(C(e)){const t=e._cachedShader;t&&0===--t.count&&(this._shadersToRelease[t.keyword]=t)}},NHe.prototype.isDestroyed=function(){return!1},NHe.prototype.destroy=function(){const e=this._shaders;for(const t in e)e.hasOwnProperty(t)&&e[t].shaderProgram.finalDestroy();return Qh(this)};var zHe=NHe;function kHe(){this._textures={},this._numberOfTextures=0,this._texturesToRelease={}}Object.defineProperties(kHe.prototype,{numberOfTextures:{get:function(){return this._numberOfTextures}}}),kHe.prototype.getTexture=function(e){const t=this._textures[e];if(C(t))return delete this._texturesToRelease[e],++t.count,t.texture},kHe.prototype.addTexture=function(e,t){const n={texture:t,count:1};t.finalDestroy=t.destroy;const i=this;t.destroy=function(){0===--n.count&&(i._texturesToRelease[e]=n)},this._textures[e]=n,++this._numberOfTextures},kHe.prototype.destroyReleasedTextures=function(){const e=this._texturesToRelease;for(const t in e)if(e.hasOwnProperty(t)){const n=e[t];delete this._textures[t],n.texture.finalDestroy(),--this._numberOfTextures}this._texturesToRelease={}},kHe.prototype.isDestroyed=function(){return!1},kHe.prototype.destroy=function(){const e=this._textures;for(const t in e)e.hasOwnProperty(t)&&e[t].texture.finalDestroy();return Qh(this)};var UHe=kHe;function VHe(e){e=R(e,R.EMPTY_OBJECT),this.color=xy.clone(R(e.color,xy.WHITE)),this.intensity=R(e.intensity,2)}var HHe=VHe;function GHe(){this.globeDepthTexture=void 0,this.gamma=void 0,this._viewport=new bf,this._viewportCartesian4=new Xe,this._viewportDirty=!1,this._viewportOrthographicMatrix=ft.clone(ft.IDENTITY),this._viewportTransformation=ft.clone(ft.IDENTITY),this._model=ft.clone(ft.IDENTITY),this._view=ft.clone(ft.IDENTITY),this._inverseView=ft.clone(ft.IDENTITY),this._projection=ft.clone(ft.IDENTITY),this._infiniteProjection=ft.clone(ft.IDENTITY),this._entireFrustum=new ro,this._currentFrustum=new ro,this._frustumPlanes=new Xe,this._farDepthFromNearPlusOne=void 0,this._log2FarDepthFromNearPlusOne=void 0,this._oneOverLog2FarDepthFromNearPlusOne=void 0,this._frameState=void 0,this._temeToPseudoFixed=ke.clone(ft.IDENTITY),this._view3DDirty=!0,this._view3D=new ft,this._inverseView3DDirty=!0,this._inverseView3D=new ft,this._inverseModelDirty=!0,this._inverseModel=new ft,this._inverseTransposeModelDirty=!0,this._inverseTransposeModel=new ke,this._viewRotation=new ke,this._inverseViewRotation=new ke,this._viewRotation3D=new ke,this._inverseViewRotation3D=new ke,this._inverseProjectionDirty=!0,this._inverseProjection=new ft,this._modelViewDirty=!0,this._modelView=new ft,this._modelView3DDirty=!0,this._modelView3D=new ft,this._modelViewRelativeToEyeDirty=!0,this._modelViewRelativeToEye=new ft,this._inverseModelViewDirty=!0,this._inverseModelView=new ft,this._inverseModelView3DDirty=!0,this._inverseModelView3D=new ft,this._viewProjectionDirty=!0,this._viewProjection=new ft,this._inverseViewProjectionDirty=!0,this._inverseViewProjection=new ft,this._modelViewProjectionDirty=!0,this._modelViewProjection=new ft,this._inverseModelViewProjectionDirty=!0,this._inverseModelViewProjection=new ft,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewProjectionRelativeToEye=new ft,this._modelViewInfiniteProjectionDirty=!0,this._modelViewInfiniteProjection=new ft,this._normalDirty=!0,this._normal=new ke,this._normal3DDirty=!0,this._normal3D=new ke,this._inverseNormalDirty=!0,this._inverseNormal=new ke,this._inverseNormal3DDirty=!0,this._inverseNormal3D=new ke,this._encodedCameraPositionMCDirty=!0,this._encodedCameraPositionMC=new Nm,this._cameraPosition=new K,this._sunPositionWC=new K,this._sunPositionColumbusView=new K,this._sunDirectionWC=new K,this._sunDirectionEC=new K,this._moonDirectionEC=new K,this._lightDirectionWC=new K,this._lightDirectionEC=new K,this._lightColor=new K,this._lightColorHdr=new K,this._pass=void 0,this._mode=void 0,this._mapProjection=void 0,this._ellipsoid=void 0,this._cameraDirection=new K,this._cameraRight=new K,this._cameraUp=new K,this._frustum2DWidth=0,this._eyeHeight=0,this._eyeHeight2D=new ro,this._pixelRatio=1,this._orthographicIn3D=!1,this._backgroundColor=new xy,this._brdfLut=void 0,this._environmentMap=void 0,this._sphericalHarmonicCoefficients=void 0,this._specularEnvironmentMaps=void 0,this._specularEnvironmentMapsDimensions=new ro,this._specularEnvironmentMapsMaximumLOD=void 0,this._fogDensity=void 0,this._invertClassificationColor=void 0,this._splitPosition=0,this._pixelSizePerMeter=void 0,this._geometricToleranceOverMeter=void 0,this._minimumDisableDepthTestDistance=void 0}function WHe(e,t){ft.clone(t,e._view),ft.getMatrix3(t,e._viewRotation),e._view3DDirty=!0,e._inverseView3DDirty=!0,e._modelViewDirty=!0,e._modelView3DDirty=!0,e._modelViewRelativeToEyeDirty=!0,e._inverseModelViewDirty=!0,e._inverseModelView3DDirty=!0,e._viewProjectionDirty=!0,e._inverseViewProjectionDirty=!0,e._modelViewProjectionDirty=!0,e._modelViewProjectionRelativeToEyeDirty=!0,e._modelViewInfiniteProjectionDirty=!0,e._normalDirty=!0,e._inverseNormalDirty=!0,e._normal3DDirty=!0,e._inverseNormal3DDirty=!0}function qHe(e,t){ft.clone(t,e._inverseView),ft.getMatrix3(t,e._inverseViewRotation)}function jHe(e,t){ft.clone(t,e._projection),e._inverseProjectionDirty=!0,e._viewProjectionDirty=!0,e._inverseViewProjectionDirty=!0,e._modelViewProjectionDirty=!0,e._modelViewProjectionRelativeToEyeDirty=!0}function YHe(e,t){ft.clone(t,e._infiniteProjection),e._modelViewInfiniteProjectionDirty=!0}function KHe(e,t){K.clone(t.positionWC,e._cameraPosition),K.clone(t.directionWC,e._cameraDirection),K.clone(t.rightWC,e._cameraRight),K.clone(t.upWC,e._cameraUp);const n=t.positionCartographic;C(n)?e._eyeHeight=n.height:e._eyeHeight=-e._ellipsoid.maximumRadius,e._encodedCameraPositionMCDirty=!0}Object.defineProperties(GHe.prototype,{frameState:{get:function(){return this._frameState}},viewport:{get:function(){return this._viewport},set:function(e){if(!bf.equals(e,this._viewport)){bf.clone(e,this._viewport);const t=this._viewport,n=this._viewportCartesian4;n.x=t.x,n.y=t.y,n.z=t.width,n.w=t.height,this._viewportDirty=!0}}},viewportCartesian4:{get:function(){return this._viewportCartesian4}},viewportOrthographic:{get:function(){return eGe(this),this._viewportOrthographicMatrix}},viewportTransformation:{get:function(){return eGe(this),this._viewportTransformation}},model:{get:function(){return this._model},set:function(e){ft.clone(e,this._model),this._modelView3DDirty=!0,this._inverseModelView3DDirty=!0,this._inverseModelDirty=!0,this._inverseTransposeModelDirty=!0,this._modelViewDirty=!0,this._inverseModelViewDirty=!0,this._modelViewRelativeToEyeDirty=!0,this._inverseModelViewDirty=!0,this._modelViewProjectionDirty=!0,this._inverseModelViewProjectionDirty=!0,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewInfiniteProjectionDirty=!0,this._normalDirty=!0,this._inverseNormalDirty=!0,this._normal3DDirty=!0,this._inverseNormal3DDirty=!0,this._encodedCameraPositionMCDirty=!0}},inverseModel:{get:function(){return this._inverseModelDirty&&(this._inverseModelDirty=!1,ft.inverse(this._model,this._inverseModel)),this._inverseModel}},inverseTransposeModel:{get:function(){const e=this._inverseTransposeModel;return this._inverseTransposeModelDirty&&(this._inverseTransposeModelDirty=!1,ft.getMatrix3(this.inverseModel,e),ke.transpose(e,e)),e}},view:{get:function(){return this._view}},view3D:{get:function(){return SGe(this),this._view3D}},viewRotation:{get:function(){return SGe(this),this._viewRotation}},viewRotation3D:{get:function(){return SGe(this),this._viewRotation3D}},inverseView:{get:function(){return this._inverseView}},inverseView3D:{get:function(){return IGe(this),this._inverseView3D}},inverseViewRotation:{get:function(){return this._inverseViewRotation}},inverseViewRotation3D:{get:function(){return IGe(this),this._inverseViewRotation3D}},projection:{get:function(){return this._projection}},inverseProjection:{get:function(){return tGe(this),this._inverseProjection}},infiniteProjection:{get:function(){return this._infiniteProjection}},modelView:{get:function(){return nGe(this),this._modelView}},modelView3D:{get:function(){return iGe(this),this._modelView3D}},modelViewRelativeToEye:{get:function(){return lGe(this),this._modelViewRelativeToEye}},inverseModelView:{get:function(){return oGe(this),this._inverseModelView}},inverseModelView3D:{get:function(){return rGe(this),this._inverseModelView3D}},viewProjection:{get:function(){return sGe(this),this._viewProjection}},inverseViewProjection:{get:function(){return aGe(this),this._inverseViewProjection}},modelViewProjection:{get:function(){return cGe(this),this._modelViewProjection}},inverseModelViewProjection:{get:function(){return uGe(this),this._inverseModelViewProjection}},modelViewProjectionRelativeToEye:{get:function(){return hGe(this),this._modelViewProjectionRelativeToEye}},modelViewInfiniteProjection:{get:function(){return dGe(this),this._modelViewInfiniteProjection}},normal:{get:function(){return fGe(this),this._normal}},normal3D:{get:function(){return pGe(this),this._normal3D}},inverseNormal:{get:function(){return mGe(this),this._inverseNormal}},inverseNormal3D:{get:function(){return _Ge(this),this._inverseNormal3D}},entireFrustum:{get:function(){return this._entireFrustum}},currentFrustum:{get:function(){return this._currentFrustum}},frustumPlanes:{get:function(){return this._frustumPlanes}},farDepthFromNearPlusOne:{get:function(){return this._farDepthFromNearPlusOne}},log2FarDepthFromNearPlusOne:{get:function(){return this._log2FarDepthFromNearPlusOne}},oneOverLog2FarDepthFromNearPlusOne:{get:function(){return this._oneOverLog2FarDepthFromNearPlusOne}},eyeHeight:{get:function(){return this._eyeHeight}},eyeHeight2D:{get:function(){return this._eyeHeight2D}},sunPositionWC:{get:function(){return this._sunPositionWC}},sunPositionColumbusView:{get:function(){return this._sunPositionColumbusView}},sunDirectionWC:{get:function(){return this._sunDirectionWC}},sunDirectionEC:{get:function(){return this._sunDirectionEC}},moonDirectionEC:{get:function(){return this._moonDirectionEC}},lightDirectionWC:{get:function(){return this._lightDirectionWC}},lightDirectionEC:{get:function(){return this._lightDirectionEC}},lightColor:{get:function(){return this._lightColor}},lightColorHdr:{get:function(){return this._lightColorHdr}},encodedCameraPositionMCHigh:{get:function(){return yGe(this),this._encodedCameraPositionMC.high}},encodedCameraPositionMCLow:{get:function(){return yGe(this),this._encodedCameraPositionMC.low}},temeToPseudoFixedMatrix:{get:function(){return this._temeToPseudoFixed}},pixelRatio:{get:function(){return this._pixelRatio}},fogDensity:{get:function(){return this._fogDensity}},geometricToleranceOverMeter:{get:function(){return this._geometricToleranceOverMeter}},pass:{get:function(){return this._pass}},backgroundColor:{get:function(){return this._backgroundColor}},brdfLut:{get:function(){return this._brdfLut}},environmentMap:{get:function(){return this._environmentMap}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps}},specularEnvironmentMapsDimensions:{get:function(){return this._specularEnvironmentMapsDimensions}},specularEnvironmentMapsMaximumLOD:{get:function(){return this._specularEnvironmentMapsMaximumLOD}},imagerySplitPosition:{get:function(){return UF("UniformState.imagerySplitPosition","czm_imagerySplitPosition has been deprecated in Cesium 1.92. It will be removed in Cesium 1.94. Use czm_splitPosition instead."),this._splitPosition}},splitPosition:{get:function(){return this._splitPosition}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance}},invertClassificationColor:{get:function(){return this._invertClassificationColor}},orthographicIn3D:{get:function(){return this._orthographicIn3D}},ellipsoid:{get:function(){return R(this._ellipsoid,ge.WGS84)}}});let XHe=new ke;const QHe=new se;function JHe(e,t){C(Kl.computeIcrfToFixedMatrix(t.time,XHe))||(XHe=Kl.computeTemeToPseudoFixedMatrix(t.time,XHe));let n=cN.computeSunPositionInEarthInertialFrame(t.time,e._sunPositionWC);ke.multiplyByVector(XHe,n,n),K.normalize(n,e._sunDirectionWC),n=ke.multiplyByVector(e.viewRotation3D,n,e._sunDirectionEC),K.normalize(n,n),n=cN.computeMoonPositionInEarthInertialFrame(t.time,e._moonDirectionEC),ke.multiplyByVector(XHe,n,n),ke.multiplyByVector(e.viewRotation3D,n,n),K.normalize(n,n);const i=t.mapProjection,o=i.ellipsoid,r=o.cartesianToCartographic(e._sunPositionWC,QHe);i.project(r,e._sunPositionColumbusView)}GHe.prototype.updateCamera=function(e){WHe(this,e.viewMatrix),qHe(this,e.inverseViewMatrix),KHe(this,e),this._entireFrustum.x=e.frustum.near,this._entireFrustum.y=e.frustum.far,this.updateFrustum(e.frustum),this._orthographicIn3D=this._mode!==ij.SCENE2D&&e.frustum instanceof jC},GHe.prototype.updateFrustum=function(e){jHe(this,e.projectionMatrix),C(e.infiniteProjectionMatrix)&&YHe(this,e.infiniteProjectionMatrix),this._currentFrustum.x=e.near,this._currentFrustum.y=e.far,this._farDepthFromNearPlusOne=e.far-e.near+1,this._log2FarDepthFromNearPlusOne=z.log2(this._farDepthFromNearPlusOne),this._oneOverLog2FarDepthFromNearPlusOne=1/this._log2FarDepthFromNearPlusOne,C(e._offCenterFrustum)&&(e=e._offCenterFrustum),this._frustumPlanes.x=e.top,this._frustumPlanes.y=e.bottom,this._frustumPlanes.z=e.left,this._frustumPlanes.w=e.right},GHe.prototype.updatePass=function(e){this._pass=e};const ZHe=[],$He=new HHe;function eGe(e){if(e._viewportDirty){const t=e._viewport;ft.computeOrthographicOffCenter(t.x,t.x+t.width,t.y,t.y+t.height,0,1,e._viewportOrthographicMatrix),ft.computeViewportTransformation(t,0,1,e._viewportTransformation),e._viewportDirty=!1}}function tGe(e){e._inverseProjectionDirty&&(e._inverseProjectionDirty=!1,e._mode===ij.SCENE2D||e._mode===ij.MORPHING||e._orthographicIn3D?ft.clone(ft.ZERO,e._inverseProjection):ft.inverse(e._projection,e._inverseProjection))}function nGe(e){e._modelViewDirty&&(e._modelViewDirty=!1,ft.multiplyTransformation(e._view,e._model,e._modelView))}function iGe(e){e._modelView3DDirty&&(e._modelView3DDirty=!1,ft.multiplyTransformation(e.view3D,e._model,e._modelView3D))}function oGe(e){e._inverseModelViewDirty&&(e._inverseModelViewDirty=!1,ft.inverse(e.modelView,e._inverseModelView))}function rGe(e){e._inverseModelView3DDirty&&(e._inverseModelView3DDirty=!1,ft.inverse(e.modelView3D,e._inverseModelView3D))}function sGe(e){e._viewProjectionDirty&&(e._viewProjectionDirty=!1,ft.multiply(e._projection,e._view,e._viewProjection))}function aGe(e){e._inverseViewProjectionDirty&&(e._inverseViewProjectionDirty=!1,ft.inverse(e.viewProjection,e._inverseViewProjection))}function cGe(e){e._modelViewProjectionDirty&&(e._modelViewProjectionDirty=!1,ft.multiply(e._projection,e.modelView,e._modelViewProjection))}function lGe(e){if(e._modelViewRelativeToEyeDirty){e._modelViewRelativeToEyeDirty=!1;const t=e.modelView,n=e._modelViewRelativeToEye;n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=0,n[13]=0,n[14]=0,n[15]=t[15]}}function uGe(e){e._inverseModelViewProjectionDirty&&(e._inverseModelViewProjectionDirty=!1,ft.inverse(e.modelViewProjection,e._inverseModelViewProjection))}function hGe(e){e._modelViewProjectionRelativeToEyeDirty&&(e._modelViewProjectionRelativeToEyeDirty=!1,ft.multiply(e._projection,e.modelViewRelativeToEye,e._modelViewProjectionRelativeToEye))}function dGe(e){e._modelViewInfiniteProjectionDirty&&(e._modelViewInfiniteProjectionDirty=!1,ft.multiply(e._infiniteProjection,e.modelView,e._modelViewInfiniteProjection))}function fGe(e){if(e._normalDirty){e._normalDirty=!1;const t=e._normal;ft.getMatrix3(e.inverseModelView,t),ke.getRotation(t,t),ke.transpose(t,t)}}function pGe(e){if(e._normal3DDirty){e._normal3DDirty=!1;const t=e._normal3D;ft.getMatrix3(e.inverseModelView3D,t),ke.getRotation(t,t),ke.transpose(t,t)}}function mGe(e){e._inverseNormalDirty&&(e._inverseNormalDirty=!1,ft.getMatrix3(e.inverseModelView,e._inverseNormal),ke.getRotation(e._inverseNormal,e._inverseNormal))}function _Ge(e){e._inverseNormal3DDirty&&(e._inverseNormal3DDirty=!1,ft.getMatrix3(e.inverseModelView3D,e._inverseNormal3D),ke.getRotation(e._inverseNormal3D,e._inverseNormal3D))}GHe.prototype.update=function(e){this._mode=e.mode,this._mapProjection=e.mapProjection,this._ellipsoid=e.mapProjection.ellipsoid,this._pixelRatio=e.pixelRatio;const t=e.camera;this.updateCamera(t),e.mode===ij.SCENE2D?(this._frustum2DWidth=t.frustum.right-t.frustum.left,this._eyeHeight2D.x=.5*this._frustum2DWidth,this._eyeHeight2D.y=this._eyeHeight2D.x*this._eyeHeight2D.x):(this._frustum2DWidth=0,this._eyeHeight2D.x=0,this._eyeHeight2D.y=0),JHe(this,e);const n=R(e.light,$He);n instanceof HHe?(this._lightDirectionWC=K.clone(this._sunDirectionWC,this._lightDirectionWC),this._lightDirectionEC=K.clone(this._sunDirectionEC,this._lightDirectionEC)):(this._lightDirectionWC=K.normalize(K.negate(n.direction,this._lightDirectionWC),this._lightDirectionWC),this._lightDirectionEC=ke.multiplyByVector(this.viewRotation3D,this._lightDirectionWC,this._lightDirectionEC));const i=n.color;let o=K.fromElements(i.red,i.green,i.blue,this._lightColorHdr);o=K.multiplyByScalar(o,n.intensity,o);const r=K.maximumComponent(o);r>1?K.divideByScalar(o,r,this._lightColor):K.clone(o,this._lightColor);const s=e.brdfLutGenerator,a=C(s)?s.colorTexture:void 0;this._brdfLut=a,this._environmentMap=R(e.environmentMap,e.context.defaultCubeMap),this._sphericalHarmonicCoefficients=R(e.sphericalHarmonicCoefficients,ZHe),this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._specularEnvironmentMapsMaximumLOD=e.specularEnvironmentMapsMaximumLOD,C(this._specularEnvironmentMaps)&&ro.clone(this._specularEnvironmentMaps.dimensions,this._specularEnvironmentMapsDimensions),this._fogDensity=e.fog.density,this._invertClassificationColor=e.invertClassificationColor,this._frameState=e,this._temeToPseudoFixed=Kl.computeTemeToPseudoFixedMatrix(e.time,this._temeToPseudoFixed),this._splitPosition=e.splitPosition*e.context.drawingBufferWidth;const c=t.frustum.fov,l=this._viewport;let u;u=C(c)?l.height>l.width?2*Math.tan(.5*c)/l.height:2*Math.tan(.5*c)/l.width:1/Math.max(l.width,l.height),this._geometricToleranceOverMeter=u*e.maximumScreenSpaceError,xy.clone(e.backgroundColor,this._backgroundColor),this._minimumDisableDepthTestDistance=e.minimumDisableDepthTestDistance,this._minimumDisableDepthTestDistance*=this._minimumDisableDepthTestDistance,this._minimumDisableDepthTestDistance===Number.POSITIVE_INFINITY&&(this._minimumDisableDepthTestDistance=-1)};const gGe=new K;function yGe(e){e._encodedCameraPositionMCDirty&&(e._encodedCameraPositionMCDirty=!1,ft.multiplyByPoint(e.inverseModel,e._cameraPosition,gGe),Nm.fromCartesian(gGe,e._encodedCameraPositionMC))}const vGe=new K,bGe=new K,AGe=new K,wGe=new K,TGe=new se,CGe=new K,EGe=new ft;function xGe(e,t,n,i,o,r,s,a){const c=vGe;c.x=e.y,c.y=e.z,c.z=e.x;const l=bGe;l.x=n.y,l.y=n.z,l.z=n.x;const u=AGe;u.x=i.y,u.y=i.z,u.z=i.x;const h=wGe;h.x=t.y,h.y=t.z,h.z=t.x,r===ij.SCENE2D&&(c.z=.5*o);const d=s.unproject(c,TGe);d.longitude=z.clamp(d.longitude,-Math.PI,Math.PI),d.latitude=z.clamp(d.latitude,-z.PI_OVER_TWO,z.PI_OVER_TWO);const f=s.ellipsoid,p=f.cartographicToCartesian(d,CGe),m=Kl.eastNorthUpToFixedFrame(p,f,EGe);return ft.multiplyByPointAsVector(m,l,l),ft.multiplyByPointAsVector(m,u,u),ft.multiplyByPointAsVector(m,h,h),C(a)||(a=new ft),a[0]=l.x,a[1]=u.x,a[2]=-h.x,a[3]=0,a[4]=l.y,a[5]=u.y,a[6]=-h.y,a[7]=0,a[8]=l.z,a[9]=u.z,a[10]=-h.z,a[11]=0,a[12]=-K.dot(l,p),a[13]=-K.dot(u,p),a[14]=K.dot(h,p),a[15]=1,a}function SGe(e){e._view3DDirty&&(e._mode===ij.SCENE3D?ft.clone(e._view,e._view3D):xGe(e._cameraPosition,e._cameraDirection,e._cameraRight,e._cameraUp,e._frustum2DWidth,e._mode,e._mapProjection,e._view3D),ft.getMatrix3(e._view3D,e._viewRotation3D),e._view3DDirty=!1)}function IGe(e){e._inverseView3DDirty&&(ft.inverseTransformation(e.view3D,e._inverseView3D),ft.getMatrix3(e._inverseView3D,e._inverseViewRotation3D),e._inverseView3DDirty=!1)}var OGe=GHe;function DGe(e,t){let n="WebGL Error:  ";switch(t){case e.INVALID_ENUM:n+="INVALID_ENUM";break;case e.INVALID_VALUE:n+="INVALID_VALUE";break;case e.INVALID_OPERATION:n+="INVALID_OPERATION";break;case e.OUT_OF_MEMORY:n+="OUT_OF_MEMORY";break;case e.CONTEXT_LOST_WEBGL:n+="CONTEXT_LOST_WEBGL lost";break;default:n+=`Unknown (${t})`}return n}function PGe(e,t,n,i){let o=`${DGe(e,i)}: ${t.name}(`;for(let r=0;r<n.length;++r)0!==r&&(o+=", "),o+=n[r];return o+=");",o}function RGe(e,t,n){const i=e.getError();if(i!==e.NO_ERROR)throw new Je(PGe(e,t,n,i))}function LGe(e,t,n){return{get:function(){const i=e[t];return n(e,`get: ${t}`,i),e[t]},set:function(i){e[t]=i,n(e,`set: ${t}`,i)}}}function MGe(e,t){if(!C(t))return e;function n(n){return function(){const i=n.apply(e,arguments);return t(e,n,arguments),i}}const i={};for(const o in e){const r=e[o];r instanceof Function?i[o]=n(r):Object.defineProperty(i,o,LGe(e,o,t))}return i}function BGe(e,t){const n=t.length;for(let i=0;i<n;++i){const n=e.getExtension(t[i]);if(n)return n}}function NGe(e,t){if("undefined"===typeof WebGLRenderingContext)throw new Je("The browser does not support WebGL.  Visit http://get.webgl.org.");D.defined("canvas",e),this._canvas=e,t=pn(t,!0),t=R(t,{}),t.allowTextureFilterAnisotropic=R(t.allowTextureFilterAnisotropic,!0);const n=R(t.webgl,{});n.alpha=R(n.alpha,!1),n.stencil=R(n.stencil,!0);const i=R(t.requestWebgl2,!1)&&"undefined"!==typeof WebGL2RenderingContext;let o,r=!1;const s=t.getWebGLStub;if(C(s))o=s(e,n);else if(i&&(o=e.getContext("webgl2",n)||e.getContext("experimental-webgl2",n)||void 0,C(o)&&(r=!0)),C(o)||(o=e.getContext("webgl",n)||e.getContext("experimental-webgl",n)||void 0),!C(o))throw new Je("The browser supports WebGL, but initialization failed.");this._originalGLContext=o,this._gl=o,this._webgl2=r,this._id=wk(),this.validateFramebuffer=!1,this.validateShaderProgram=!1,this.logShaderCompilation=!1,this._throwOnWebGLError=!1,this._shaderCache=new zHe(this),this._textureCache=new UHe;const a=o;this._stencilBits=a.getParameter(a.STENCIL_BITS),Ck._maximumCombinedTextureImageUnits=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),Ck._maximumCubeMapSize=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),Ck._maximumFragmentUniformVectors=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),Ck._maximumTextureImageUnits=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),Ck._maximumRenderbufferSize=a.getParameter(a.MAX_RENDERBUFFER_SIZE),Ck._maximumTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),Ck._maximumVaryingVectors=a.getParameter(a.MAX_VARYING_VECTORS),Ck._maximumVertexAttributes=a.getParameter(a.MAX_VERTEX_ATTRIBS),Ck._maximumVertexTextureImageUnits=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Ck._maximumVertexUniformVectors=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),Ck._maximumSamples=this._webgl2?a.getParameter(a.MAX_SAMPLES):0;const c=a.getParameter(a.ALIASED_LINE_WIDTH_RANGE);Ck._minimumAliasedLineWidth=c[0],Ck._maximumAliasedLineWidth=c[1];const l=a.getParameter(a.ALIASED_POINT_SIZE_RANGE);Ck._minimumAliasedPointSize=l[0],Ck._maximumAliasedPointSize=l[1];const u=a.getParameter(a.MAX_VIEWPORT_DIMS);Ck._maximumViewportWidth=u[0],Ck._maximumViewportHeight=u[1];const h=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT);Ck._highpFloatSupported=0!==h.precision;const d=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_INT);Ck._highpIntSupported=0!==d.rangeMax,this._antialias=a.getContextAttributes().antialias,this._standardDerivatives=!!BGe(a,["OES_standard_derivatives"]),this._blendMinmax=!!BGe(a,["EXT_blend_minmax"]),this._elementIndexUint=!!BGe(a,["OES_element_index_uint"]),this._depthTexture=!!BGe(a,["WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),this._fragDepth=!!BGe(a,["EXT_frag_depth"]),this._debugShaders=BGe(a,["WEBGL_debug_shaders"]),this._textureFloat=!!BGe(a,["OES_texture_float"]),this._textureHalfFloat=!!BGe(a,["OES_texture_half_float"]),this._textureFloatLinear=!!BGe(a,["OES_texture_float_linear"]),this._textureHalfFloatLinear=!!BGe(a,["OES_texture_half_float_linear"]),this._colorBufferFloat=!!BGe(a,["EXT_color_buffer_float","WEBGL_color_buffer_float"]),this._floatBlend=!!BGe(a,["EXT_float_blend"]),this._colorBufferHalfFloat=!!BGe(a,["EXT_color_buffer_half_float"]),this._s3tc=!!BGe(a,["WEBGL_compressed_texture_s3tc","MOZ_WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"]),this._pvrtc=!!BGe(a,["WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"]),this._astc=!!BGe(a,["WEBGL_compressed_texture_astc"]),this._etc=!!BGe(a,["WEBG_compressed_texture_etc"]),this._etc1=!!BGe(a,["WEBGL_compressed_texture_etc1"]),this._bc7=!!BGe(a,["EXT_texture_compression_bptc"]),XF.setKTX2SupportedFormats(this._s3tc,this._pvrtc,this._astc,this._etc,this._etc1,this._bc7);const f=t.allowTextureFilterAnisotropic?BGe(a,["EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"]):void 0;let p,m,_,g,y,v,b,A,w,T;if(this._textureFilterAnisotropic=f,Ck._maximumTextureFilterAnisotropy=C(f)?a.getParameter(f.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,r){const e=this;p=function(){return e._gl.createVertexArray()},m=function(t){e._gl.bindVertexArray(t)},_=function(t){e._gl.deleteVertexArray(t)},g=function(e,t,n,i,o){a.drawElementsInstanced(e,t,n,i,o)},y=function(e,t,n,i){a.drawArraysInstanced(e,t,n,i)},v=function(e,t){a.vertexAttribDivisor(e,t)},b=function(e){a.drawBuffers(e)}}else A=BGe(a,["OES_vertex_array_object"]),C(A)&&(p=function(){return A.createVertexArrayOES()},m=function(e){A.bindVertexArrayOES(e)},_=function(e){A.deleteVertexArrayOES(e)}),w=BGe(a,["ANGLE_instanced_arrays"]),C(w)&&(g=function(e,t,n,i,o){w.drawElementsInstancedANGLE(e,t,n,i,o)},y=function(e,t,n,i){w.drawArraysInstancedANGLE(e,t,n,i)},v=function(e,t){w.vertexAttribDivisorANGLE(e,t)}),T=BGe(a,["WEBGL_draw_buffers"]),C(T)&&(b=function(e){T.drawBuffersWEBGL(e)});this.glCreateVertexArray=p,this.glBindVertexArray=m,this.glDeleteVertexArray=_,this.glDrawElementsInstanced=g,this.glDrawArraysInstanced=y,this.glVertexAttribDivisor=v,this.glDrawBuffers=b,this._vertexArrayObject=!!A,this._instancedArrays=!!w,this._drawBuffers=!!T,Ck._maximumDrawBuffers=this.drawBuffers?a.getParameter(th.MAX_DRAW_BUFFERS):1,Ck._maximumColorAttachments=this.drawBuffers?a.getParameter(th.MAX_COLOR_ATTACHMENTS):1,this._clearColor=new xy(0,0,0,0),this._clearDepth=1,this._clearStencil=0;const E=new OGe,x=new BHe(this),S=yV.fromCache();this._defaultPassState=x,this._defaultRenderState=S,this._defaultTexture=void 0,this._defaultEmissiveTexture=void 0,this._defaultNormalTexture=void 0,this._defaultCubeMap=void 0,this._us=E,this._currentRenderState=S,this._currentPassState=x,this._currentFramebuffer=void 0,this._maxFrameTextureUnitIndex=0,this._vertexAttribDivisors=[],this._previousDrawInstanced=!1;for(let C=0;C<Ck._maximumVertexAttributes;C++)this._vertexAttribDivisors.push(0);this._pickObjects={},this._nextPickColor=new Uint32Array(1),this.options=t,this.cache={},yV.apply(a,S,x)}const FGe={};function zGe(e){if(e.validateFramebuffer){const t=e._gl,n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(n!==t.FRAMEBUFFER_COMPLETE){let e;switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:e="Framebuffer is not complete.  Incomplete attachment: at least one attachment point with a renderbuffer or texture attached has its attached object no longer in existence or has an attached image with a width or height of zero, or the color attachment point has a non-color-renderable image attached, or the depth attachment point has a non-depth-renderable image attached, or the stencil attachment point has a non-stencil-renderable image attached.  Color-renderable formats include GL_RGBA4, GL_RGB5_A1, and GL_RGB565. GL_DEPTH_COMPONENT16 is the only depth-renderable format. GL_STENCIL_INDEX8 is the only stencil-renderable format.";break;case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:e="Framebuffer is not complete.  Incomplete dimensions: not all attached images have the same width and height.";break;case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:e="Framebuffer is not complete.  Missing attachment: no images are attached to the framebuffer.";break;case t.FRAMEBUFFER_UNSUPPORTED:e="Framebuffer is not complete.  Unsupported: the combination of internal formats of the attached images violates an implementation-dependent set of restrictions.";break}throw new x(e)}}}function kGe(e,t,n,i){const o=e._currentRenderState,r=e._currentPassState;e._currentRenderState=t,e._currentPassState=n,yV.partialApply(e._gl,o,t,r,n,i)}let UGe;function VGe(e,t){if(t!==e._currentFramebuffer){e._currentFramebuffer=t;let n=UGe;if(C(t))t._bind(),zGe(e),n=t._getActiveColorAttachments();else{const t=e._gl;t.bindFramebuffer(t.FRAMEBUFFER,null)}e.drawBuffers&&e.glDrawBuffers(n)}}Object.defineProperties(NGe.prototype,{id:{get:function(){return this._id}},webgl2:{get:function(){return this._webgl2}},canvas:{get:function(){return this._canvas}},shaderCache:{get:function(){return this._shaderCache}},textureCache:{get:function(){return this._textureCache}},uniformState:{get:function(){return this._us}},stencilBits:{get:function(){return this._stencilBits}},stencilBuffer:{get:function(){return this._stencilBits>=8}},antialias:{get:function(){return this._antialias}},msaa:{get:function(){return this._webgl2}},standardDerivatives:{get:function(){return this._standardDerivatives||this._webgl2}},floatBlend:{get:function(){return this._floatBlend}},blendMinmax:{get:function(){return this._blendMinmax||this._webgl2}},elementIndexUint:{get:function(){return this._elementIndexUint||this._webgl2}},depthTexture:{get:function(){return this._depthTexture||this._webgl2}},floatingPointTexture:{get:function(){return this._webgl2||this._textureFloat}},halfFloatingPointTexture:{get:function(){return this._webgl2||this._textureHalfFloat}},textureFloatLinear:{get:function(){return this._textureFloatLinear}},textureHalfFloatLinear:{get:function(){return this._webgl2&&this._textureFloatLinear||!this._webgl2&&this._textureHalfFloatLinear}},textureFilterAnisotropic:{get:function(){return!!this._textureFilterAnisotropic}},s3tc:{get:function(){return this._s3tc}},pvrtc:{get:function(){return this._pvrtc}},astc:{get:function(){return this._astc}},etc:{get:function(){return this._etc}},etc1:{get:function(){return this._etc1}},bc7:{get:function(){return this._bc7}},supportsBasis:{get:function(){return this._s3tc||this._pvrtc||this._astc||this._etc||this._etc1||this._bc7}},vertexArrayObject:{get:function(){return this._vertexArrayObject||this._webgl2}},fragmentDepth:{get:function(){return this._fragDepth||this._webgl2}},instancedArrays:{get:function(){return this._instancedArrays||this._webgl2}},colorBufferFloat:{get:function(){return this._colorBufferFloat}},colorBufferHalfFloat:{get:function(){return this._webgl2&&this._colorBufferFloat||!this._webgl2&&this._colorBufferHalfFloat}},drawBuffers:{get:function(){return this._drawBuffers||this._webgl2}},debugShaders:{get:function(){return this._debugShaders}},throwOnWebGLError:{get:function(){return this._throwOnWebGLError},set:function(e){this._throwOnWebGLError=e,this._gl=MGe(this._originalGLContext,e?RGe:void 0)}},defaultTexture:{get:function(){return void 0===this._defaultTexture&&(this._defaultTexture=new Uk({context:this,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1})),this._defaultTexture}},defaultEmissiveTexture:{get:function(){return void 0===this._defaultEmissiveTexture&&(this._defaultEmissiveTexture=new Uk({context:this,pixelFormat:fD.RGB,source:{width:1,height:1,arrayBufferView:new Uint8Array([0,0,0])},flipY:!1})),this._defaultEmissiveTexture}},defaultNormalTexture:{get:function(){return void 0===this._defaultNormalTexture&&(this._defaultNormalTexture=new Uk({context:this,pixelFormat:fD.RGB,source:{width:1,height:1,arrayBufferView:new Uint8Array([128,128,255])},flipY:!1})),this._defaultNormalTexture}},defaultCubeMap:{get:function(){if(void 0===this._defaultCubeMap){const e={width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])};this._defaultCubeMap=new zk({context:this,source:{positiveX:e,negativeX:e,positiveY:e,negativeY:e,positiveZ:e,negativeZ:e},flipY:!1})}return this._defaultCubeMap}},drawingBufferHeight:{get:function(){return this._gl.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._gl.drawingBufferWidth}},defaultFramebuffer:{get:function(){return FGe}}}),"undefined"!==typeof WebGLRenderingContext&&(UGe=[th.BACK]);const HGe=new tJ;function GGe(e,t,n,i,o){if(C(t)&&o.depthTest&&o.depthTest.enabled&&!t.hasDepthAttachment)throw new x("The depth test can not be enabled (drawCommand.renderState.depthTest.enabled) because the framebuffer (drawCommand.framebuffer) does not have a depth or depth-stencil renderbuffer.");VGe(e,t),kGe(e,o,n,!1),i._bind(),e._maxFrameTextureUnitIndex=Math.max(e._maxFrameTextureUnitIndex,i.maximumTextureUnitIndex)}function WGe(e,t,n,i){const o=t._primitiveType,r=t._vertexArray;let s=t._offset,a=t._count;const c=t.instanceCount;if(!xf.validate(o))throw new x("drawCommand.primitiveType is required and must be valid.");if(D.defined("drawCommand.vertexArray",r),D.typeOf.number.greaterThanOrEquals("drawCommand.offset",s,0),C(a)&&D.typeOf.number.greaterThanOrEquals("drawCommand.count",a,0),D.typeOf.number.greaterThanOrEquals("drawCommand.instanceCount",c,0),c>0&&!e.instancedArrays)throw new x("Instanced arrays extension is not supported");e._us.model=R(t._modelMatrix,ft.IDENTITY),n._setUniforms(i,e._us,e.validateShaderProgram),r._bind();const l=r.indexBuffer;C(l)?(s*=l.bytesPerIndex,a=R(a,l.numberOfIndices),0===c?e._gl.drawElements(o,a,l.indexDatatype,s):e.glDrawElementsInstanced(o,a,l.indexDatatype,s,c)):(a=R(a,r.numberOfVertices),0===c?e._gl.drawArrays(o,s,a):e.glDrawArraysInstanced(o,s,a,c)),r._unBind()}NGe.prototype.clear=function(e,t){e=R(e,HGe),t=R(t,this._defaultPassState);const n=this._gl;let i=0;const o=e.color,r=e.depth,s=e.stencil;C(o)&&(xy.equals(this._clearColor,o)||(xy.clone(o,this._clearColor),n.clearColor(o.red,o.green,o.blue,o.alpha)),i|=n.COLOR_BUFFER_BIT),C(r)&&(r!==this._clearDepth&&(this._clearDepth=r,n.clearDepth(r)),i|=n.DEPTH_BUFFER_BIT),C(s)&&(s!==this._clearStencil&&(this._clearStencil=s,n.clearStencil(s)),i|=n.STENCIL_BUFFER_BIT);const a=R(e.renderState,this._defaultRenderState);kGe(this,a,t,!0);const c=R(e.framebuffer,t.framebuffer);VGe(this,c),n.clear(i)},NGe.prototype.draw=function(e,t,n,i){D.defined("drawCommand",e),D.defined("drawCommand.shaderProgram",e._shaderProgram),t=R(t,this._defaultPassState);const o=R(e._framebuffer,t.framebuffer),r=R(e._renderState,this._defaultRenderState);n=R(n,e._shaderProgram),i=R(i,e._uniformMap),GGe(this,o,t,n,r),WGe(this,e,n,i)},NGe.prototype.endFrame=function(){const e=this._gl;e.useProgram(null),this._currentFramebuffer=void 0,e.bindFramebuffer(e.FRAMEBUFFER,null);const t=UGe;this.drawBuffers&&this.glDrawBuffers(t);const n=this._maxFrameTextureUnitIndex;this._maxFrameTextureUnitIndex=0;for(let i=0;i<n;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null)},NGe.prototype.readPixels=function(e){const t=this._gl;e=R(e,R.EMPTY_OBJECT);const n=Math.max(R(e.x,0),0),i=Math.max(R(e.y,0),0),o=R(e.width,t.drawingBufferWidth),r=R(e.height,t.drawingBufferHeight),s=e.framebuffer;D.typeOf.number.greaterThan("readState.width",o,0),D.typeOf.number.greaterThan("readState.height",r,0);let a=hD.UNSIGNED_BYTE;C(s)&&s.numberOfColorAttachments>0&&(a=s.getColorTexture(0).pixelDatatype);const c=fD.createTypedArray(fD.RGBA,a,o,r);return VGe(this,s),t.readPixels(n,i,o,r,fD.RGBA,hD.toWebGLConstant(a,this),c),c};const qGe={position:0,textureCoordinates:1};function jGe(e,t,n){this._pickObjects=e,this.key=t,this.color=n}NGe.prototype.getViewportQuadVertexArray=function(){let e=this.cache.viewportQuad_vertexArray;if(!C(e)){const t=new zf({attributes:{position:new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:[-1,-1,1,-1,1,1,-1,1]}),textureCoordinates:new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:2,values:[0,0,1,0,1,1,0,1]})},indices:new Uint16Array([0,1,2,0,2,3]),primitiveType:xf.TRIANGLES});e=bq.fromGeometry({context:this,geometry:t,attributeLocations:qGe,bufferUsage:lq.STATIC_DRAW,interleave:!0}),this.cache.viewportQuad_vertexArray=e}return e},NGe.prototype.createViewportQuadCommand=function(e,t){return t=R(t,R.EMPTY_OBJECT),new UU({vertexArray:this.getViewportQuadVertexArray(),primitiveType:xf.TRIANGLES,renderState:t.renderState,shaderProgram:fH.fromCache({context:this,vertexShaderSource:EHe,fragmentShaderSource:e,attributeLocations:qGe}),uniformMap:t.uniformMap,owner:t.owner,framebuffer:t.framebuffer,pass:t.pass})},NGe.prototype.getObjectByPickColor=function(e){return D.defined("pickColor",e),this._pickObjects[e.toRgba()]},Object.defineProperties(jGe.prototype,{object:{get:function(){return this._pickObjects[this.key]},set:function(e){this._pickObjects[this.key]=e}}}),jGe.prototype.destroy=function(){delete this._pickObjects[this.key]},NGe.prototype.createPickId=function(e){D.defined("object",e),++this._nextPickColor[0];const t=this._nextPickColor[0];if(0===t)throw new Je("Out of unique Pick IDs.");return this._pickObjects[t]=e,new jGe(this._pickObjects,t,xy.fromRgba(t))},NGe.prototype.isDestroyed=function(){return!1},NGe.prototype.destroy=function(){const e=this.cache;for(const t in e)if(e.hasOwnProperty(t)){const n=e[t];C(n.destroy)&&n.destroy()}return this._shaderCache=this._shaderCache.destroy(),this._textureCache=this._textureCache.destroy(),this._defaultTexture=this._defaultTexture&&this._defaultTexture.destroy(),this._defaultEmissiveTexture=this._defaultEmissiveTexture&&this._defaultEmissiveTexture.destroy(),this._defaultNormalTexture=this._defaultNormalTexture&&this._defaultNormalTexture.destroy(),this._defaultCubeMap=this._defaultCubeMap&&this._defaultCubeMap.destroy(),Qh(this)};var YGe=NGe;function KGe(e,t,n){if(D.defined("context",e),!C(t)||!C(t.positiveX)||!C(t.negativeX)||!C(t.positiveY)||!C(t.negativeY)||!C(t.positiveZ)||!C(t.negativeZ))throw new x("urls is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");const i={flipY:!0,skipColorSpaceConversion:n,preferImageBitmap:!0},o=[Vi.createIfNeeded(t.positiveX).fetchImage(i),Vi.createIfNeeded(t.negativeX).fetchImage(i),Vi.createIfNeeded(t.positiveY).fetchImage(i),Vi.createIfNeeded(t.negativeY).fetchImage(i),Vi.createIfNeeded(t.positiveZ).fetchImage(i),Vi.createIfNeeded(t.negativeZ).fetchImage(i)];return Promise.all(o).then((function(t){return new zk({context:e,source:{positiveX:t[0],negativeX:t[1],positiveY:t[2],negativeY:t[3],positiveZ:t[4],negativeZ:t[5]}})}))}var XGe=KGe;function QGe(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.missingImageUrl))throw new x("options.missingImageUrl is required.");if(!C(e.pixelsToCheck))throw new x("options.pixelsToCheck is required.");this._pixelsToCheck=e.pixelsToCheck,this._missingImagePixels=void 0,this._missingImageByteLength=void 0,this._isReady=!1;const t=Vi.createIfNeeded(e.missingImageUrl),n=this;function i(t){C(t.blob)&&(n._missingImageByteLength=t.blob.size);let i=En(t);if(e.disableCheckIfAllPixelsAreTransparent){let n=!0;const o=t.width,r=e.pixelsToCheck;for(let e=0,t=r.length;n&&e<t;++e){const t=r[e],s=4*t.x+t.y*o,a=i[s+3];a>0&&(n=!1)}n&&(i=void 0)}n._missingImagePixels=i,n._isReady=!0}function o(){n._missingImagePixels=void 0,n._isReady=!0}t.fetchImage({preferBlob:!0,preferImageBitmap:!0,flipY:!0}).then(i).catch(o)}QGe.prototype.isReady=function(){return this._isReady},QGe.prototype.shouldDiscardImage=function(e){if(!this._isReady)throw new x("shouldDiscardImage must not be called before the discard policy is ready.");const t=this._pixelsToCheck,n=this._missingImagePixels;if(!C(n))return!1;if(C(e.blob)&&e.blob.size!==this._missingImageByteLength)return!1;const i=En(e),o=e.width;for(let r=0,s=t.length;r<s;++r){const e=t[r],s=4*e.x+e.y*o;for(let t=0;t<4;++t){const e=s+t;if(i[e]!==n[e])return!1}}return!0};var JGe=QGe;function ZGe(){this.name=void 0,this.description=void 0,this.position=void 0,this.data=void 0,this.imageryLayer=void 0}ZGe.prototype.configureNameFromProperties=function(e){let t,n=10;for(const i in e)if(e.hasOwnProperty(i)&&e[i]){const e=i.toLowerCase();n>1&&"name"===e?(n=1,t=i):n>2&&"title"===e?(n=2,t=i):n>3&&/name/i.test(i)?(n=3,t=i):n>4&&/title/i.test(i)&&(n=4,t=i)}C(t)&&(this.name=e[t])},ZGe.prototype.configureDescriptionFromProperties=function(e){function t(e){let n='<table class="cesium-infoBox-defaultTable">';for(const i in e)if(e.hasOwnProperty(i)){const o=e[i];C(o)&&(n+="object"===typeof o?`<tr><td>${i}</td><td>${t(o)}</td></tr>`:`<tr><td>${i}</td><td>${o}</td></tr>`)}return n+="</table>",n}this.description=t(e)};var $Ge=ZGe;function eWe(){this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0,x.throwInstantiationError()}Object.defineProperties(eWe.prototype,{ready:{get:x.throwInstantiationError},readyPromise:{get:x.throwInstantiationError},rectangle:{get:x.throwInstantiationError},tileWidth:{get:x.throwInstantiationError},tileHeight:{get:x.throwInstantiationError},maximumLevel:{get:x.throwInstantiationError},minimumLevel:{get:x.throwInstantiationError},tilingScheme:{get:x.throwInstantiationError},tileDiscardPolicy:{get:x.throwInstantiationError},errorEvent:{get:x.throwInstantiationError},credit:{get:x.throwInstantiationError},proxy:{get:x.throwInstantiationError},hasAlphaChannel:{get:x.throwInstantiationError}}),eWe.prototype.getTileCredits=function(e,t,n){x.throwInstantiationError()},eWe.prototype.requestImage=function(e,t,n,i){x.throwInstantiationError()},eWe.prototype.pickFeatures=function(e,t,n,i,o){x.throwInstantiationError()};const tWe=/\.ktx2$/i;eWe.loadImage=function(e,t){D.defined("url",t);const n=Vi.createIfNeeded(t);return tWe.test(n.url)?XF(n):C(e)&&C(e.tileDiscardPolicy)?n.fetchImage({preferBlob:!0,preferImageBitmap:!0,flipY:!0}):n.fetchImage({preferImageBitmap:!0,flipY:!0})};var nWe=eWe;function iWe(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.url))throw new x("options.url is required.");this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0;const t=Vi.createIfNeeded(e.url);t.appendForwardSlash(),C(e.token)&&t.setQueryParameters({token:e.token}),this._resource=t,this._tileDiscardPolicy=e.tileDiscardPolicy,this._tileWidth=R(e.tileWidth,256),this._tileHeight=R(e.tileHeight,256),this._maximumLevel=e.maximumLevel,this._tilingScheme=R(e.tilingScheme,new ao({ellipsoid:e.ellipsoid})),this._useTiles=R(e.usePreCachedTilesIfAvailable,!0),this._rectangle=R(e.rectangle,this._tilingScheme.rectangle),this._layers=e.layers;let n=e.credit;"string"===typeof n&&(n=new Tr(n)),this._credit=n,this.enablePickFeatures=R(e.enablePickFeatures,!0),this._errorEvent=new $n,this._ready=!1,this._readyPromise=yn();const i=this;let o;function r(t){const n=t.tileInfo;if(C(n)){if(i._tileWidth=n.rows,i._tileHeight=n.cols,102100===n.spatialReference.wkid||102113===n.spatialReference.wkid)i._tilingScheme=new nf({ellipsoid:e.ellipsoid});else{if(4326!==t.tileInfo.spatialReference.wkid){const e=`Tile spatial reference WKID ${t.tileInfo.spatialReference.wkid} is not supported.`;return o=ef.handleError(o,i,i._errorEvent,e,void 0,void 0,void 0,a),void(o.retry||i._readyPromise.reject(new Je(e)))}i._tilingScheme=new ao({ellipsoid:e.ellipsoid})}if(i._maximumLevel=t.tileInfo.lods.length-1,C(t.fullExtent)){if(C(t.fullExtent.spatialReference)&&C(t.fullExtent.spatialReference.wkid))if(102100===t.fullExtent.spatialReference.wkid||102113===t.fullExtent.spatialReference.wkid){const e=new Vh,n=t.fullExtent,o=e.unproject(new K(Math.max(n.xmin,-i._tilingScheme.ellipsoid.maximumRadius*Math.PI),Math.max(n.ymin,-i._tilingScheme.ellipsoid.maximumRadius*Math.PI),0)),r=e.unproject(new K(Math.min(n.xmax,i._tilingScheme.ellipsoid.maximumRadius*Math.PI),Math.min(n.ymax,i._tilingScheme.ellipsoid.maximumRadius*Math.PI),0));i._rectangle=new _t(o.longitude,o.latitude,r.longitude,r.latitude)}else{if(4326!==t.fullExtent.spatialReference.wkid){const e=`fullExtent.spatialReference WKID ${t.fullExtent.spatialReference.wkid} is not supported.`;return o=ef.handleError(o,i,i._errorEvent,e,void 0,void 0,void 0,a),void(o.retry||i._readyPromise.reject(new Je(e)))}i._rectangle=_t.fromDegrees(t.fullExtent.xmin,t.fullExtent.ymin,t.fullExtent.xmax,t.fullExtent.ymax)}}else i._rectangle=i._tilingScheme.rectangle;C(i._tileDiscardPolicy)||(i._tileDiscardPolicy=new JGe({missingImageUrl:oWe(i,0,0,i._maximumLevel).url,pixelsToCheck:[new ro(0,0),new ro(200,20),new ro(20,200),new ro(80,110),new ro(160,130)],disableCheckIfAllPixelsAreTransparent:!0})),i._useTiles=!0}else i._useTiles=!1;C(t.copyrightText)&&t.copyrightText.length>0&&(i._credit=new Tr(t.copyrightText)),i._ready=!0,i._readyPromise.resolve(!0),ef.handleSuccess(o)}function s(e){const t=`An error occurred while accessing ${i._resource.url}.`;o=ef.handleError(o,i,i._errorEvent,t,void 0,void 0,void 0,a),i._readyPromise.reject(new Je(t))}function a(){const e=i._resource.getDerivedResource({queryParameters:{f:"json"}});e.fetchJsonp().then((function(e){r(e)})).catch((function(e){s(e)}))}this._useTiles?a():(this._ready=!0,this._readyPromise.resolve(!0))}function oWe(e,t,n,i,o){let r;if(e._useTiles)r=e._resource.getDerivedResource({url:`tile/${i}/${n}/${t}`,request:o});else{const s=e._tilingScheme.tileXYToNativeRectangle(t,n,i),a=`${s.west},${s.south},${s.east},${s.north}`,c={bbox:a,size:`${e._tileWidth},${e._tileHeight}`,format:"png32",transparent:!0,f:"image"};e._tilingScheme.projection instanceof ve?(c.bboxSR=4326,c.imageSR=4326):(c.bboxSR=3857,c.imageSR=3857),e.layers&&(c.layers=`show:${e.layers}`),r=e._resource.getDerivedResource({url:"export",request:o,queryParameters:c})}return r}Object.defineProperties(iWe.prototype,{url:{get:function(){return this._resource._url}},token:{get:function(){return this._resource.queryParameters.token}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){if(!this._ready)throw new x("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new x("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new x("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new x("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new x("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new x("rectangle must not be called before the imagery provider is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new x("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}}),iWe.prototype.getTileCredits=function(e,t,n){},iWe.prototype.requestImage=function(e,t,n,i){if(!this._ready)throw new x("requestImage must not be called before the imagery provider is ready.");return nWe.loadImage(this,oWe(this,e,t,n,i))},iWe.prototype.pickFeatures=function(e,t,n,i,o){if(!this._ready)throw new x("pickFeatures must not be called before the imagery provider is ready.");if(!this.enablePickFeatures)return;const r=this._tilingScheme.tileXYToNativeRectangle(e,t,n);let s,a,c;if(this._tilingScheme.projection instanceof ve)s=z.toDegrees(i),a=z.toDegrees(o),c="4326";else{const e=this._tilingScheme.projection.project(new se(i,o,0));s=e.x,a=e.y,c="3857"}let l="visible";C(this._layers)&&(l+=`:${this._layers}`);const u={f:"json",tolerance:2,geometryType:"esriGeometryPoint",geometry:`${s},${a}`,mapExtent:`${r.west},${r.south},${r.east},${r.north}`,imageDisplay:`${this._tileWidth},${this._tileHeight},96`,sr:c,layers:l},h=this._resource.getDerivedResource({url:"identify",queryParameters:u});return h.fetchJson().then((function(e){const t=[],n=e.results;if(!C(n))return t;for(let i=0;i<n.length;++i){const e=n[i],o=new $Ge;if(o.data=e,o.name=e.value,o.properties=e.attributes,o.configureDescriptionFromProperties(e.attributes),"esriGeometryPoint"===e.geometryType&&e.geometry){const t=e.geometry.spatialReference&&e.geometry.spatialReference.wkid?e.geometry.spatialReference.wkid:4326;if(4326===t||4283===t)o.position=se.fromDegrees(e.geometry.x,e.geometry.y,e.geometry.z);else if(102100===t||900913===t||3857===t){const t=new Vh;o.position=t.unproject(new K(e.geometry.x,e.geometry.y,e.geometry.z))}}t.push(o)}return t}))};var rWe=iWe;function sWe(){this._uniformMap=void 0,this._command=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._ready=!1,this._name="czm_autoexposure",this._logDepthChanged=void 0,this._useLogDepth=void 0,this._framebuffers=void 0,this._previousLuminance=new Tie,this._commands=void 0,this._clearCommand=void 0,this._minMaxLuminance=new ro,this.enabled=!0,this._enabled=!0,this.minimumLuminance=.1,this.maximumLuminance=10}function aWe(e){const t=e._framebuffers;if(!C(t))return;const n=t.length;for(let i=0;i<n;++i)t[i].destroy();e._framebuffers=void 0,e._previousLuminance.destroy(),e._previousLuminance=void 0}function cWe(e,t){aWe(e);let n=e._width,i=e._height;const o=t.halfFloatingPointTexture?hD.HALF_FLOAT:hD.FLOAT,r=Math.ceil(Math.log(Math.max(n,i))/Math.log(3)),s=new Array(r);for(let c=0;c<r;++c)n=Math.max(Math.ceil(n/3),1),i=Math.max(Math.ceil(i/3),1),s[c]=new Tie,s[c].update(t,n,i,1,o);const a=s[r-1].getColorTexture(0);e._previousLuminance.update(t,a.width,a.height,1,o),e._framebuffers=s}function lWe(e){const t=e._commands;if(!C(t))return;const n=t.length;for(let i=0;i<n;++i)t[i].shaderProgram.destroy();e._commands=void 0}function uWe(e,t){let n;if(0===t)n={colorTexture:function(){return e._colorTexture},colorTextureDimensions:function(){return e._colorTexture.dimensions}};else{const i=e._framebuffers[t-1].getColorTexture(0);n={colorTexture:function(){return i},colorTextureDimensions:function(){return i.dimensions}}}return n.minMaxLuminance=function(){return e._minMaxLuminance},n.previousLuminance=function(){return e._previousLuminance.getColorTexture(0)},n}function hWe(e,t){let n="uniform sampler2D colorTexture; \nvarying vec2 v_textureCoordinates; \nfloat sampleTexture(vec2 offset) { \n";return n+=0===e?"    vec4 color = texture2D(colorTexture, v_textureCoordinates + offset); \n    return czm_luminance(color.rgb); \n":"    return texture2D(colorTexture, v_textureCoordinates + offset).r; \n",n+="}\n\n",n+="uniform vec2 colorTextureDimensions; \nuniform vec2 minMaxLuminance; \nuniform sampler2D previousLuminance; \nvoid main() { \n    float color = 0.0; \n    float xStep = 1.0 / colorTextureDimensions.x; \n    float yStep = 1.0 / colorTextureDimensions.y; \n    int count = 0; \n    for (int i = 0; i < 3; ++i) { \n        for (int j = 0; j < 3; ++j) { \n            vec2 offset; \n            offset.x = -xStep + float(i) * xStep; \n            offset.y = -yStep + float(j) * yStep; \n            if (offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0) { \n                continue; \n            } \n            color += sampleTexture(offset); \n            ++count; \n        } \n    } \n    if (count > 0) { \n        color /= float(count); \n    } \n",e===t-1&&(n+="    float previous = texture2D(previousLuminance, vec2(0.5)).r; \n    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n    color = previous + (color - previous) / (60.0 * 1.5); \n    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n"),n+="    gl_FragColor = vec4(color); \n} \n",n}function dWe(e,t){lWe(e);const n=e._framebuffers,i=n.length,o=new Array(i);for(let r=0;r<i;++r)o[r]=t.createViewportQuadCommand(hWe(r,i),{framebuffer:n[r].framebuffer,uniformMap:uWe(e,r)});e._commands=o}Object.defineProperties(sWe.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},outputTexture:{get:function(){const e=this._framebuffers;if(C(e))return e[e.length-1].getColorTexture(0)}}}),sWe.prototype.clear=function(e){const t=this._framebuffers;if(!C(t))return;let n=this._clearCommand;C(n)||(n=this._clearCommand=new tJ({color:new xy(0,0,0,0),framebuffer:void 0}));const i=t.length;for(let o=0;o<i;++o)t[o].clear(e,n)},sWe.prototype.update=function(e){const t=e.drawingBufferWidth,n=e.drawingBufferHeight;t===this._width&&n===this._height||(this._width=t,this._height=n,cWe(this,e),dWe(this,e),this._ready||(this._ready=!0)),this._minMaxLuminance.x=this.minimumLuminance,this._minMaxLuminance.y=this.maximumLuminance;const i=this._framebuffers,o=i[i.length-1];i[i.length-1]=this._previousLuminance,this._commands[this._commands.length-1].framebuffer=this._previousLuminance.framebuffer,this._previousLuminance=o},sWe.prototype.execute=function(e,t){this._colorTexture=t;const n=this._commands;if(!C(n))return;const i=n.length;for(let o=0;o<i;++o)n[o].execute(e)},sWe.prototype.isDestroyed=function(){return!1},sWe.prototype.destroy=function(){return aWe(this),lWe(this),Qh(this)};var fWe=sWe;const pWe={AERIAL:"Aerial",AERIAL_WITH_LABELS:"AerialWithLabels",AERIAL_WITH_LABELS_ON_DEMAND:"AerialWithLabelsOnDemand",ROAD:"Road",ROAD_ON_DEMAND:"RoadOnDemand",CANVAS_DARK:"CanvasDark",CANVAS_LIGHT:"CanvasLight",CANVAS_GRAY:"CanvasGray",ORDNANCE_SURVEY:"OrdnanceSurvey",COLLINS_BART:"CollinsBart"};var mWe=Object.freeze(pWe);function _We(e){}let gWe;_We.prototype.isReady=function(){return!0},_We.prototype.shouldDiscardImage=function(e){return _We.EMPTY_IMAGE===e},Object.defineProperties(_We,{EMPTY_IMAGE:{get:function(){return C(gWe)||(gWe=new Image,gWe.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="),gWe}}});var yWe=_We;function vWe(e){e=R(e,R.EMPTY_OBJECT);const t=e.key;if(!C(e.url))throw new x("options.url is required.");if(!C(t))throw new x("options.key is required.");this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=1,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0,this._key=t,this._resource=Vi.createIfNeeded(e.url),this._resource.appendForwardSlash(),this._tileProtocol=e.tileProtocol,this._mapStyle=R(e.mapStyle,mWe.AERIAL),this._culture=R(e.culture,""),this._tileDiscardPolicy=e.tileDiscardPolicy,C(this._tileDiscardPolicy)||(this._tileDiscardPolicy=new yWe),this._proxy=e.proxy,this._credit=new Tr(`<a href="http://www.bing.com"><img src="${vWe.logoUrl}" title="Bing Imagery"/></a>`),this._tilingScheme=new nf({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,ellipsoid:e.ellipsoid}),this._tileWidth=void 0,this._tileHeight=void 0,this._maximumLevel=void 0,this._imageUrlTemplate=void 0,this._imageUrlSubdomains=void 0,this._errorEvent=new $n,this._ready=!1,this._readyPromise=yn();let n=this._tileProtocol;if(C(n))n.length>0&&":"===n[n.length-1]&&(n=n.substr(0,n.length-1));else{const e=document.location.protocol;n="http:"===e?"http":"https"}const i=this._resource.getDerivedResource({url:`REST/v1/Imagery/Metadata/${this._mapStyle}`,queryParameters:{incl:"ImageryProviders",key:this._key,uriScheme:n}}),o=this;let r;function s(e){if(1!==e.resourceSets.length)return void a();const t=e.resourceSets[0].resources[0];o._tileWidth=t.imageWidth,o._tileHeight=t.imageHeight,o._maximumLevel=t.zoomMax-1,o._imageUrlSubdomains=t.imageUrlSubdomains,o._imageUrlTemplate=t.imageUrl;let n=o._attributionList=t.imageryProviders;n||(n=o._attributionList=[]);for(let i=0,o=n.length;i<o;++i){const e=n[i];if(e.credit instanceof Tr)break;e.credit=new Tr(e.attribution);const t=e.coverageAreas;for(let n=0,i=e.coverageAreas.length;n<i;++n){const e=t[n],i=e.bbox;e.bbox=new _t(z.toRadians(i[1]),z.toRadians(i[0]),z.toRadians(i[3]),z.toRadians(i[2]))}}o._ready=!0,o._readyPromise.resolve(!0),ef.handleSuccess(r)}function a(e){const t=`An error occurred while accessing ${i.url}.`;r=ef.handleError(r,o,o._errorEvent,t,void 0,void 0,void 0,l),o._readyPromise.reject(new Je(t))}const c=i.url;function l(){const e=i.fetchJsonp("jsonp");vWe._metadataCache[c]=e,e.then(s).catch(a)}const u=vWe._metadataCache[c];C(u)?u.then(s).catch(a):l()}Object.defineProperties(vWe.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},key:{get:function(){return this._key}},mapStyle:{get:function(){return this._mapStyle}},culture:{get:function(){return this._culture}},tileWidth:{get:function(){if(!this._ready)throw new x("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new x("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new x("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new x("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new x("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new x("rectangle must not be called before the imagery provider is ready.");return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new x("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!1}}});const bWe=new _t;function AWe(e,t,n,i,o){const r=e._imageUrlTemplate,s=e._imageUrlSubdomains,a=(t+n+i)%s.length;return e._resource.getDerivedResource({url:r,request:o,templateValues:{quadkey:vWe.tileXYToQuadKey(t,n,i),subdomain:s[a],culture:e._culture},queryParameters:{n:"z"}})}vWe.prototype.getTileCredits=function(e,t,n){if(!this._ready)throw new x("getTileCredits must not be called before the imagery provider is ready.");const i=this._tilingScheme.tileXYToRectangle(e,t,n,bWe),o=TWe(this._attributionList,n,i);return o},vWe.prototype.requestImage=function(e,t,n,i){if(!this._ready)throw new x("requestImage must not be called before the imagery provider is ready.");const o=nWe.loadImage(this,AWe(this,e,t,n,i));if(C(o))return o.catch((function(e){return C(e.blob)&&0===e.blob.size?yWe.EMPTY_IMAGE:Promise.reject(e)}))},vWe.prototype.pickFeatures=function(e,t,n,i,o){},vWe.tileXYToQuadKey=function(e,t,n){let i="";for(let o=n;o>=0;--o){const n=1<<o;let r=0;0!==(e&n)&&(r|=1),0!==(t&n)&&(r|=2),i+=r}return i},vWe.quadKeyToTileXY=function(e){let t=0,n=0;const i=e.length-1;for(let o=i;o>=0;--o){const r=1<<o,s=+e[i-o];0!==(1&s)&&(t|=r),0!==(2&s)&&(n|=r)}return{x:t,y:n,level:i}},vWe._logoUrl=void 0,Object.defineProperties(vWe,{logoUrl:{get:function(){return C(vWe._logoUrl)||(vWe._logoUrl=Zi("Assets/Images/bing_maps_credit.png")),vWe._logoUrl},set:function(e){D.defined("value",e),vWe._logoUrl=e}}});const wWe=new _t;function TWe(e,t,n){++t;const i=[];for(let o=0,r=e.length;o<r;++o){const r=e[o],s=r.coverageAreas;let a=!1;for(let e=0,i=r.coverageAreas.length;!a&&e<i;++e){const i=s[e];if(t>=i.zoomMin&&t<=i.zoomMax){const e=_t.intersection(n,i.bbox,wWe);C(e)&&(a=!0)}}a&&i.push(r.credit)}return i}vWe._metadataCache={};var CWe=vWe;const EWe=new K(1,1,1);function xWe(e){e=R(e,EWe),D.defined("dimensions",e),D.typeOf.number.greaterThanOrEquals("dimensions.x",e.x,0),D.typeOf.number.greaterThanOrEquals("dimensions.y",e.y,0),D.typeOf.number.greaterThanOrEquals("dimensions.z",e.z,0),this._dimensions=K.clone(e)}Object.defineProperties(xWe.prototype,{dimensions:{get:function(){return this._dimensions},set:function(e){D.defined("value",e),D.typeOf.number.greaterThanOrEquals("value.x",e.x,0),D.typeOf.number.greaterThanOrEquals("value.y",e.y,0),D.typeOf.number.greaterThanOrEquals("value.z",e.z,0),K.clone(e,this._dimensions)}}});const SWe=new K;xWe.prototype.emit=function(e){const t=this._dimensions,n=K.multiplyByScalar(t,.5,SWe),i=z.randomBetween(-n.x,n.x),o=z.randomBetween(-n.y,n.y),r=z.randomBetween(-n.z,n.z);e.position=K.fromElements(i,o,r,e.position),e.velocity=K.normalize(e.position,e.velocity)};var IWe="varying vec2 v_textureCoordinates;\nconst float M_PI = 3.141592653589793;\n\nfloat vdcRadicalInverse(int i)\n{\n    float r;\n    float base = 2.0;\n    float value = 0.0;\n    float invBase = 1.0 / base;\n    float invBi = invBase;\n    for (int x = 0; x < 100; x++)\n    {\n        if (i <= 0)\n        {\n            break;\n        }\n        r = mod(float(i), base);\n        value += r * invBi;\n        invBi *= invBase;\n        i = int(float(i) * invBase);\n    }\n    return value;\n}\n\nvec2 hammersley2D(int i, int N)\n{\n    return vec2(float(i) / float(N), vdcRadicalInverse(i));\n}\n\nvec3 importanceSampleGGX(vec2 xi, float roughness, vec3 N)\n{\n    float a = roughness * roughness;\n    float phi = 2.0 * M_PI * xi.x;\n    float cosTheta = sqrt((1.0 - xi.y) / (1.0 + (a * a - 1.0) * xi.y));\n    float sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n    vec3 H = vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\n    vec3 upVector = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n    vec3 tangentX = normalize(cross(upVector, N));\n    vec3 tangentY = cross(N, tangentX);\n    return tangentX * H.x + tangentY * H.y + N * H.z;\n}\n\nfloat G1_Smith(float NdotV, float k)\n{\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\n\nfloat G_Smith(float roughness, float NdotV, float NdotL)\n{\n    float k = roughness * roughness / 2.0;\n    return G1_Smith(NdotV, k) * G1_Smith(NdotL, k);\n}\n\nvec2 integrateBrdf(float roughness, float NdotV)\n{\n    vec3 V = vec3(sqrt(1.0 - NdotV * NdotV), 0.0, NdotV);\n    float A = 0.0;\n    float B = 0.0;\n    const int NumSamples = 1024;\n    for (int i = 0; i < NumSamples; i++)\n    {\n        vec2 xi = hammersley2D(i, NumSamples);\n        vec3 H = importanceSampleGGX(xi, roughness, vec3(0.0, 0.0, 1.0));\n        vec3 L = 2.0 * dot(V, H) * H - V;\n        float NdotL = clamp(L.z, 0.0, 1.0);\n        float NdotH = clamp(H.z, 0.0, 1.0);\n        float VdotH = clamp(dot(V, H), 0.0, 1.0);\n        if (NdotL > 0.0)\n        {\n            float G = G_Smith(roughness, NdotV, NdotL);\n            float G_Vis = G * VdotH / (NdotH * NdotV);\n            float Fc = pow(1.0 - VdotH, 5.0);\n            A += (1.0 - Fc) * G_Vis;\n            B += Fc * G_Vis;\n        }\n    }\n    return vec2(A, B) / float(NumSamples);\n}\n\nvoid main()\n{\n    gl_FragColor = vec4(integrateBrdf(v_textureCoordinates.y, v_textureCoordinates.x), 0.0, 1.0);\n}\n";function OWe(){this._colorTexture=void 0,this._drawCommand=void 0}function DWe(e,t,n){const i=t.createViewportQuadCommand(IWe,{framebuffer:n,renderState:yV.fromCache({viewport:new bf(0,0,256,256)})});e._drawCommand=i}Object.defineProperties(OWe.prototype,{colorTexture:{get:function(){return this._colorTexture}}}),OWe.prototype.update=function(e){if(!C(this._colorTexture)){const t=e.context,n=new Uk({context:t,width:256,height:256,pixelFormat:fD.RGBA,pixelDatatype:hD.UNSIGNED_BYTE,sampler:Nk.NEAREST});this._colorTexture=n;const i=new mie({context:t,colorTextures:[n],destroyAttachments:!1});DWe(this,t,i),this._drawCommand.execute(t),i.destroy(),this._drawCommand.shaderProgram=this._drawCommand.shaderProgram&&this._drawCommand.shaderProgram.destroy()}},OWe.prototype.isDestroyed=function(){return!1},OWe.prototype.destroy=function(){return this._colorTexture=this._colorTexture&&this._colorTexture.destroy(),Qh(this)};var PWe=OWe;const RWe={};function LWe(e,t,n){let i,o,r;if(e instanceof nE){const s=Math.tan(.5*e.fovy);return i=e.near,o=e.near*s,r=e.aspectRatio*o,Math.max(t*i/r,n*i/o)}return e instanceof $C?(i=e.near,o=e.top,r=e.right,Math.max(t*i/r,n*i/o)):Math.max(t,n)}const MWe=new K,BWe=new K;function NWe(e,t,n,i){if(C(i)&&n(.5)>i){const i=n(0),o=n(1),r=n(.5),s=r-i,a=r-o;return function(r){const c=n(r);if(r<=.5){const t=(c-i)/s;return z.lerp(e,-z.PI_OVER_TWO,t)}const l=(c-o)/a;return z.lerp(-z.PI_OVER_TWO,t,1-l)}}return function(n){return z.lerp(e,t,n)}}function FWe(e,t,n,i,o){let r=o;const s=Math.max(n,i);if(!C(r)){const n=e.position,i=t,o=e.up,s=e.right,a=e.frustum,c=K.subtract(n,i,MWe),l=K.magnitude(K.multiplyByScalar(o,K.dot(c,o),BWe)),u=K.magnitude(K.multiplyByScalar(s,K.dot(c,s),BWe));r=Math.min(.2*LWe(a,l,u),1e9)}if(s<r){const e=8,t=1e6,o=-Math.pow((r-n)*t,1/e),s=Math.pow((r-i)*t,1/e);return function(n){const i=n*(s-o)+o;return-Math.pow(i,e)/t+r}}return function(e){return z.lerp(n,i,e)}}function zWe(e,t){return z.equalsEpsilon(e,z.TWO_PI,z.EPSILON11)&&(e=0),t>e+Math.PI?e+=z.TWO_PI:t<e-Math.PI&&(e-=z.TWO_PI),e}const kWe=new K;function UWe(e,t,n,i,o,r,s,a){const c=e.camera,l=K.clone(c.position,kWe),u=c.pitch,h=zWe(c.heading,i),d=zWe(c.roll,r),f=FWe(c,n,l.z,n.z,s),p=NWe(u,o,f,a);function m(e){const o=e.time/t;c.setView({orientation:{heading:z.lerp(h,i,o),pitch:p(o),roll:z.lerp(d,r,o)}}),ro.lerp(l,n,o,c.position),c.position.z=f(o)}return m}function VWe(e,t){e.longitude<t.longitude?e.longitude+=z.TWO_PI:t.longitude+=z.TWO_PI}function HWe(e,t){const n=e.longitude-t.longitude;n<-z.PI?e.longitude+=z.TWO_PI:n>z.PI&&(t.longitude+=z.TWO_PI)}const GWe=new se,WWe=new se;function qWe(e,t,n,i,o,r,s,a,c,l){const u=e.camera,h=e.mapProjection,d=h.ellipsoid,f=se.clone(u.positionCartographic,GWe),p=u.pitch,m=zWe(u.heading,i),_=zWe(u.roll,r),g=d.cartesianToCartographic(n,WWe);f.longitude=z.zeroToTwoPi(f.longitude),g.longitude=z.zeroToTwoPi(g.longitude);let y=!1;if(C(a)){const e=z.zeroToTwoPi(a),t=Math.min(f.longitude,g.longitude),n=Math.max(f.longitude,g.longitude),i=e>=t&&e<=n;if(C(c)){const e=Math.abs(f.longitude-g.longitude),t=z.TWO_PI-e,n=i?e:t,o=i?t:e;n<o*c&&!i&&(y=!0)}else i||(y=!0)}y?VWe(f,g):HWe(f,g);const v=FWe(u,n,f.height,g.height,s),b=NWe(p,o,v,l);function A(){const e=f.longitude,n=g.longitude,o=f.latitude,s=g.latitude;return function(a){const c=a.time/t,l=K.fromRadians(z.lerp(e,n,c),z.lerp(o,s,c),v(c),d);u.setView({destination:l,orientation:{heading:z.lerp(m,i,c),pitch:b(c),roll:z.lerp(_,r,c)}})}}return A()}function jWe(e,t,n,i,o,r,s){const a=e.camera,c=K.clone(a.position,kWe),l=zWe(a.heading,i),u=a.frustum.right-a.frustum.left,h=FWe(a,n,u,n.z,s);function d(e){const o=e.time/t;a.setView({orientation:{heading:z.lerp(l,i,o)}}),ro.lerp(c,n,o,a.position);const r=h(o),s=a.frustum,u=s.top/s.right,d=.5*(r-(s.right-s.left));s.right+=d,s.left-=d,s.top=u*s.right,s.bottom=-s.top}return d}const YWe=new se,KWe=new K;function XWe(e,t){return{startObject:{},stopObject:{},duration:0,complete:e,cancel:t}}function QWe(e,t){function n(){"function"===typeof t&&t(),e.enableInputs=!0}return n}RWe.createTween=function(e,t){t=R(t,R.EMPTY_OBJECT);let n=t.destination;if(!C(e))throw new x("scene is required.");if(!C(n))throw new x("destination is required.");const i=e.mode;if(i===ij.MORPHING)return XWe();const o=R(t.convert,!0),r=e.mapProjection,s=r.ellipsoid,a=t.maximumHeight,c=t.flyOverLongitude,l=t.flyOverLongitudeWeight,u=t.pitchAdjustHeight;let h=t.easingFunction;o&&i!==ij.SCENE3D&&(s.cartesianToCartographic(n,YWe),n=r.project(YWe,KWe));const d=e.camera,f=t.endTransform;C(f)&&d._setTransform(f);let p=t.duration;C(p)||(p=Math.ceil(K.distance(d.position,n)/1e6)+2,p=Math.min(p,3));const m=R(t.heading,0),_=R(t.pitch,-z.PI_OVER_TWO),g=R(t.roll,0),y=e.screenSpaceCameraController;y.enableInputs=!1;const v=QWe(y,t.complete),b=QWe(y,t.cancel),A=d.frustum;let w=e.mode===ij.SCENE2D;if(w=w&&ro.equalsEpsilon(d.position,n,z.EPSILON6),w=w&&z.equalsEpsilon(Math.max(A.right-A.left,A.top-A.bottom),n.z,z.EPSILON6),w=w||e.mode!==ij.SCENE2D&&K.equalsEpsilon(n,d.position,z.EPSILON10),w=w&&z.equalsEpsilon(z.negativePiToPi(m),z.negativePiToPi(d.heading),z.EPSILON10)&&z.equalsEpsilon(z.negativePiToPi(_),z.negativePiToPi(d.pitch),z.EPSILON10)&&z.equalsEpsilon(z.negativePiToPi(g),z.negativePiToPi(d.roll),z.EPSILON10),w)return XWe(v,b);const T=new Array(4);if(T[ij.SCENE2D]=jWe,T[ij.SCENE3D]=qWe,T[ij.COLUMBUS_VIEW]=UWe,p<=0){const t=function(){const t=T[i](e,1,n,m,_,g,a,c,l,u);t({time:1}),"function"===typeof v&&v()};return XWe(t,b)}const E=T[i](e,p,n,m,_,g,a,c,l,u);if(!C(h)){const e=d.positionCartographic.height,t=i===ij.SCENE3D?s.cartesianToCartographic(n).height:n.z;h=e>t&&e>11500?rC.CUBIC_OUT:rC.QUINTIC_IN_OUT}return{duration:p,easingFunction:h,startObject:{time:0},stopObject:{time:p},update:E,complete:v,cancel:b}};var JWe=RWe;const ZWe={ROTATE:0,INFINITE_SCROLL:1};var $We=Object.freeze(ZWe);function eqe(e){if(!C(e))throw new x("scene is required.");this._scene=e,this._transform=ft.clone(ft.IDENTITY),this._invTransform=ft.clone(ft.IDENTITY),this._actualTransform=ft.clone(ft.IDENTITY),this._actualInvTransform=ft.clone(ft.IDENTITY),this._transformChanged=!1,this.position=new K,this._position=new K,this._positionWC=new K,this._positionCartographic=new se,this._oldPositionWC=void 0,this.positionWCDeltaMagnitude=0,this.positionWCDeltaMagnitudeLastFrame=0,this.timeSinceMoved=0,this._lastMovedTimestamp=0,this.direction=new K,this._direction=new K,this._directionWC=new K,this.up=new K,this._up=new K,this._upWC=new K,this.right=new K,this._right=new K,this._rightWC=new K,this.frustum=new nE,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=z.toRadians(60),this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumZoomFactor=1.5,this._moveStart=new $n,this._moveEnd=new $n,this._changed=new $n,this._changedPosition=void 0,this._changedDirection=void 0,this._changedFrustum=void 0,this._changedHeading=void 0,this.percentageChanged=.5,this._viewMatrix=new ft,this._invViewMatrix=new ft,tqe(this),this._mode=ij.SCENE3D,this._modeChanged=!0;const t=e.mapProjection;this._projection=t,this._maxCoord=t.project(new se(Math.PI,z.PI_OVER_TWO)),this._max2Dfrustum=void 0,Tje(this,eqe.DEFAULT_VIEW_RECTANGLE,this.position,!0);let n=K.magnitude(this.position);n+=n*eqe.DEFAULT_VIEW_FACTOR,K.normalize(this.position,this.position),K.multiplyByScalar(this.position,n,this.position)}function tqe(e){ft.computeView(e._position,e._direction,e._up,e._right,e._viewMatrix),ft.multiply(e._viewMatrix,e._actualInvTransform,e._viewMatrix),ft.inverseTransformation(e._viewMatrix,e._invViewMatrix)}function nqe(e){if(C(e._oldPositionWC)){e.positionWCDeltaMagnitudeLastFrame=e.positionWCDeltaMagnitude;const t=K.subtract(e.positionWC,e._oldPositionWC,e._oldPositionWC);e.positionWCDeltaMagnitude=K.magnitude(t),e._oldPositionWC=K.clone(e.positionWC,e._oldPositionWC),e.positionWCDeltaMagnitude>0?(e.timeSinceMoved=0,e._lastMovedTimestamp=py()):e.timeSinceMoved=Math.max(py()-e._lastMovedTimestamp,0)/1e3}else e._oldPositionWC=K.clone(e.positionWC,e._oldPositionWC)}function iqe(e){Kl.basisTo2D(e._projection,e._transform,e._actualTransform)}eqe.TRANSFORM_2D=new ft(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),eqe.TRANSFORM_2D_INVERSE=ft.inverseTransformation(eqe.TRANSFORM_2D,new ft),eqe.DEFAULT_VIEW_RECTANGLE=_t.fromDegrees(-95,-20,-70,90),eqe.DEFAULT_VIEW_FACTOR=.5,eqe.DEFAULT_OFFSET=new uI(0,-z.PI_OVER_FOUR,0),eqe.prototype.canPreloadFlight=function(){return C(this._currentFlight)&&this._mode!==ij.SCENE2D},eqe.prototype._updateCameraChanged=function(){const e=this;if(nqe(e),0===e._changed.numberOfListeners)return;const t=e.percentageChanged,n=e.heading;C(e._changedHeading)||(e._changedHeading=n);let i=Math.abs(e._changedHeading-n)%z.TWO_PI;i=i>z.PI?z.TWO_PI-i:i;const o=i/Math.PI;if(o>t&&(e._changed.raiseEvent(o),e._changedHeading=n),e._mode===ij.SCENE2D){if(!C(e._changedFrustum))return e._changedPosition=K.clone(e.position,e._changedPosition),void(e._changedFrustum=e.frustum.clone());const n=e.position,i=e._changedPosition,o=e.frustum,r=e._changedFrustum,s=n.x+o.left,a=n.x+o.right,c=i.x+r.left,l=i.x+r.right,u=n.y+o.bottom,h=n.y+o.top,d=i.y+r.bottom,f=i.y+r.top,p=Math.max(s,c),m=Math.min(a,l),_=Math.max(u,d),g=Math.min(h,f);let y;if(p>=m||_>=h)y=1;else{let e=r;s<c&&a>l&&u<d&&h>f&&(e=o),y=1-(m-p)*(g-_)/((e.right-e.left)*(e.top-e.bottom))}return void(y>t&&(e._changed.raiseEvent(y),e._changedPosition=K.clone(e.position,e._changedPosition),e._changedFrustum=e.frustum.clone(e._changedFrustum)))}if(!C(e._changedDirection))return e._changedPosition=K.clone(e.positionWC,e._changedPosition),void(e._changedDirection=K.clone(e.directionWC,e._changedDirection));const r=z.acosClamped(K.dot(e.directionWC,e._changedDirection));let s;s=C(e.frustum.fovy)?r/(.5*e.frustum.fovy):r;const a=K.distance(e.positionWC,e._changedPosition),c=a/e.positionCartographic.height;(s>t||c>t)&&(e._changed.raiseEvent(Math.max(s,c)),e._changedPosition=K.clone(e.positionWC,e._changedPosition),e._changedDirection=K.clone(e.directionWC,e._changedDirection))};const oqe=new se,rqe=new K,sqe=new K,aqe=new Xe,cqe=new Xe,lqe=new Xe,uqe=new Xe,hqe=new Xe;function dqe(e){const t=e._projection,n=t.ellipsoid,i=ft.getColumn(e._transform,3,aqe),o=n.cartesianToCartographic(i,oqe),r=t.project(o,rqe),s=cqe;s.x=r.z,s.y=r.x,s.z=r.y,s.w=1;const a=Xe.clone(Xe.UNIT_X,hqe),c=Xe.add(ft.getColumn(e._transform,0,sqe),i,sqe);n.cartesianToCartographic(c,o),t.project(o,r);const l=lqe;l.x=r.z,l.y=r.x,l.z=r.y,l.w=0,K.subtract(l,s,l),l.x=0;const u=uqe;if(K.magnitudeSquared(l)>z.EPSILON10)K.cross(a,l,u);else{const a=Xe.add(ft.getColumn(e._transform,1,sqe),i,sqe);n.cartesianToCartographic(a,o),t.project(o,r),u.x=r.z,u.y=r.x,u.z=r.y,u.w=0,K.subtract(u,s,u),u.x=0,K.magnitudeSquared(u)<z.EPSILON10&&(Xe.clone(Xe.UNIT_Y,l),Xe.clone(Xe.UNIT_Z,u))}K.cross(u,a,l),K.normalize(l,l),K.cross(a,l,u),K.normalize(u,u),ft.setColumn(e._actualTransform,0,l,e._actualTransform),ft.setColumn(e._actualTransform,1,u,e._actualTransform),ft.setColumn(e._actualTransform,2,a,e._actualTransform),ft.setColumn(e._actualTransform,3,s,e._actualTransform)}const fqe=new K;function pqe(e){const t=e._mode;let n=!1,i=0;t===ij.SCENE2D&&(i=e.frustum.right-e.frustum.left,n=i!==e._positionCartographic.height);let o=e._position;const r=!K.equals(o,e.position)||n;r&&(o=K.clone(e.position,e._position));let s=e._direction;const a=!K.equals(s,e.direction);a&&(K.normalize(e.direction,e.direction),s=K.clone(e.direction,e._direction));let c=e._up;const l=!K.equals(c,e.up);l&&(K.normalize(e.up,e.up),c=K.clone(e.up,e._up));let u=e._right;const h=!K.equals(u,e.right);h&&(K.normalize(e.right,e.right),u=K.clone(e.right,e._right));const d=e._transformChanged||e._modeChanged;e._transformChanged=!1,d&&(ft.inverseTransformation(e._transform,e._invTransform),e._mode===ij.COLUMBUS_VIEW||e._mode===ij.SCENE2D?ft.equals(ft.IDENTITY,e._transform)?ft.clone(eqe.TRANSFORM_2D,e._actualTransform):e._mode===ij.COLUMBUS_VIEW?iqe(e):dqe(e):ft.clone(e._transform,e._actualTransform),ft.inverseTransformation(e._actualTransform,e._actualInvTransform),e._modeChanged=!1);const f=e._actualTransform;if(r||d)if(e._positionWC=ft.multiplyByPoint(f,o,e._positionWC),t===ij.SCENE3D||t===ij.MORPHING)e._positionCartographic=e._projection.ellipsoid.cartesianToCartographic(e._positionWC,e._positionCartographic);else{const n=fqe;n.x=e._positionWC.y,n.y=e._positionWC.z,n.z=e._positionWC.x,t===ij.SCENE2D&&(n.z=i),e._projection.unproject(n,e._positionCartographic)}if(a||l||h){const t=K.dot(s,K.cross(c,u,fqe));if(Math.abs(1-t)>z.EPSILON2){const t=1/K.magnitudeSquared(c),n=K.dot(c,s)*t,i=K.multiplyByScalar(s,n,fqe);c=K.normalize(K.subtract(c,i,e._up),e._up),K.clone(c,e.up),u=K.cross(s,c,e._right),K.clone(u,e.right)}}(a||d)&&(e._directionWC=ft.multiplyByPointAsVector(f,s,e._directionWC),K.normalize(e._directionWC,e._directionWC)),(l||d)&&(e._upWC=ft.multiplyByPointAsVector(f,c,e._upWC),K.normalize(e._upWC,e._upWC)),(h||d)&&(e._rightWC=ft.multiplyByPointAsVector(f,u,e._rightWC),K.normalize(e._rightWC,e._rightWC)),(r||a||l||h||d)&&tqe(e)}function mqe(e,t){let n;return n=z.equalsEpsilon(Math.abs(e.z),1,z.EPSILON3)?Math.atan2(t.y,t.x)-z.PI_OVER_TWO:Math.atan2(e.y,e.x)-z.PI_OVER_TWO,z.TWO_PI-z.zeroToTwoPi(n)}function _qe(e){return z.PI_OVER_TWO-z.acosClamped(e.z)}function gqe(e,t,n){let i=0;return z.equalsEpsilon(Math.abs(e.z),1,z.EPSILON3)||(i=Math.atan2(-n.z,t.z),i=z.zeroToTwoPi(i+z.TWO_PI)),i}const yqe=new ft,vqe=new ft;Object.defineProperties(eqe.prototype,{transform:{get:function(){return this._transform}},inverseTransform:{get:function(){return pqe(this),this._invTransform}},viewMatrix:{get:function(){return pqe(this),this._viewMatrix}},inverseViewMatrix:{get:function(){return pqe(this),this._invViewMatrix}},positionCartographic:{get:function(){return pqe(this),this._positionCartographic}},positionWC:{get:function(){return pqe(this),this._positionWC}},directionWC:{get:function(){return pqe(this),this._directionWC}},upWC:{get:function(){return pqe(this),this._upWC}},rightWC:{get:function(){return pqe(this),this._rightWC}},heading:{get:function(){if(this._mode!==ij.MORPHING){const e=this._projection.ellipsoid,t=ft.clone(this._transform,yqe),n=Kl.eastNorthUpToFixedFrame(this.positionWC,e,vqe);this._setTransform(n);const i=mqe(this.direction,this.up);return this._setTransform(t),i}}},pitch:{get:function(){if(this._mode!==ij.MORPHING){const e=this._projection.ellipsoid,t=ft.clone(this._transform,yqe),n=Kl.eastNorthUpToFixedFrame(this.positionWC,e,vqe);this._setTransform(n);const i=_qe(this.direction);return this._setTransform(t),i}}},roll:{get:function(){if(this._mode!==ij.MORPHING){const e=this._projection.ellipsoid,t=ft.clone(this._transform,yqe),n=Kl.eastNorthUpToFixedFrame(this.positionWC,e,vqe);this._setTransform(n);const i=gqe(this.direction,this.up,this.right);return this._setTransform(t),i}}},moveStart:{get:function(){return this._moveStart}},moveEnd:{get:function(){return this._moveEnd}},changed:{get:function(){return this._changed}}}),eqe.prototype.update=function(e){if(!C(e))throw new x("mode is required.");if(e===ij.SCENE2D&&!(this.frustum instanceof GC))throw new x("An OrthographicOffCenterFrustum is required in 2D.");if((e===ij.SCENE3D||e===ij.COLUMBUS_VIEW)&&!(this.frustum instanceof nE)&&!(this.frustum instanceof jC))throw new x("A PerspectiveFrustum or OrthographicFrustum is required in 3D and Columbus view");let t=!1;if(e!==this._mode&&(this._mode=e,this._modeChanged=e!==ij.MORPHING,t=this._mode===ij.SCENE2D),t){const e=this._max2Dfrustum=this.frustum.clone();if(!(e instanceof GC))throw new x("The camera frustum is expected to be orthographic for 2D camera control.");const t=2,n=e.top/e.right;e.right=this._maxCoord.x*t,e.left=-e.right,e.top=n*e.right,e.bottom=-e.top}this._mode===ij.SCENE2D&&Wqe(this,this.position)};const bqe=new K,Aqe=new K,wqe=new K;eqe.prototype._setTransform=function(e){const t=K.clone(this.positionWC,bqe),n=K.clone(this.upWC,Aqe),i=K.clone(this.directionWC,wqe);ft.clone(e,this._transform),this._transformChanged=!0,pqe(this);const o=this._actualInvTransform;ft.multiplyByPoint(o,t,this.position),ft.multiplyByPointAsVector(o,i,this.direction),ft.multiplyByPointAsVector(o,n,this.up),K.cross(this.direction,this.up,this.right),pqe(this)};const Tqe=new ro,Cqe=new os,Eqe=new K,xqe=new K;function Sqe(e){if(!ft.equals(ft.IDENTITY,e.transform))return K.magnitude(e.position);const t=e._scene,n=t.globe,i=Tqe;let o,r,s;if(i.x=t.drawingBufferWidth/2,i.y=t.drawingBufferHeight/2,C(n)){const r=e.getPickRay(i,Cqe);o=n.pickWorldCoordinates(r,t,!0,Eqe)}if(t.pickPositionSupported&&(r=t.pickPositionWorldCoordinates(i,xqe)),C(o)||C(r)){const t=C(r)?K.distance(r,e.positionWC):Number.POSITIVE_INFINITY,n=C(o)?K.distance(o,e.positionWC):Number.POSITIVE_INFINITY;s=Math.min(t,n)}else s=Math.max(e.positionCartographic.height,0);return s}eqe.prototype._adjustOrthographicFrustum=function(e){this.frustum instanceof jC&&(!e&&this._positionCartographic.height<15e4||(this.frustum.width=Sqe(this)))};const Iqe=new K,Oqe=new ft,Dqe=new ft,Pqe=new il,Rqe=new ke,Lqe=new se;function Mqe(e,t,n){const i=ft.clone(e.transform,Oqe),o=Kl.eastNorthUpToFixedFrame(t,e._projection.ellipsoid,Dqe);e._setTransform(o),K.clone(K.ZERO,e.position),n.heading=n.heading-z.PI_OVER_TWO;const r=il.fromHeadingPitchRoll(n,Pqe),s=ke.fromQuaternion(r,Rqe);ke.getColumn(s,0,e.direction),ke.getColumn(s,2,e.up),K.cross(e.direction,e.up,e.right),e._setTransform(i),e._adjustOrthographicFrustum(!0)}function Bqe(e,t,n,i){const o=ft.clone(e.transform,Oqe);if(e._setTransform(ft.IDENTITY),!K.equals(t,e.positionWC)){if(i){const n=e._projection,i=n.ellipsoid.cartesianToCartographic(t,Lqe);t=n.project(i,Iqe)}K.clone(t,e.position)}n.heading=n.heading-z.PI_OVER_TWO;const r=il.fromHeadingPitchRoll(n,Pqe),s=ke.fromQuaternion(r,Rqe);ke.getColumn(s,0,e.direction),ke.getColumn(s,2,e.up),K.cross(e.direction,e.up,e.right),e._setTransform(o),e._adjustOrthographicFrustum(!0)}function Nqe(e,t,n,i){const o=ft.clone(e.transform,Oqe);if(e._setTransform(ft.IDENTITY),!K.equals(t,e.positionWC)){if(i){const n=e._projection,i=n.ellipsoid.cartesianToCartographic(t,Lqe);t=n.project(i,Iqe)}ro.clone(t,e.position);const n=.5*-t.z,o=-n,r=e.frustum;if(o>n){const e=r.top/r.right;r.right=o,r.left=n,r.top=r.right*e,r.bottom=-r.top}}if(e._scene.mapMode2D===$We.ROTATE){n.heading=n.heading-z.PI_OVER_TWO,n.pitch=-z.PI_OVER_TWO,n.roll=0;const t=il.fromHeadingPitchRoll(n,Pqe),i=ke.fromQuaternion(t,Rqe);ke.getColumn(i,2,e.up),K.cross(e.direction,e.up,e.right)}e._setTransform(o)}const Fqe=new K,zqe=new K,kqe=new K;function Uqe(e,t,n,i){const o=K.clone(n.direction,Fqe),r=K.clone(n.up,zqe);if(e._scene.mode===ij.SCENE3D){const n=e._projection.ellipsoid,i=Kl.eastNorthUpToFixedFrame(t,n,yqe),s=ft.inverseTransformation(i,vqe);ft.multiplyByPointAsVector(s,o,o),ft.multiplyByPointAsVector(s,r,r)}const s=K.cross(o,r,kqe);return i.heading=mqe(o,r),i.pitch=_qe(o),i.roll=gqe(o,r,s),i}const Vqe={destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0,endTransform:void 0},Hqe=new Ma;eqe.prototype.setView=function(e){e=R(e,R.EMPTY_OBJECT);let t=R(e.orientation,R.EMPTY_OBJECT);const n=this._mode;if(n===ij.MORPHING)return;C(e.endTransform)&&this._setTransform(e.endTransform);let i=R(e.convert,!0),o=R(e.destination,K.clone(this.positionWC,Iqe));C(o)&&C(o.west)&&(o=this.getRectangleCameraCoordinates(o,Iqe),i=!1),C(t.direction)&&(t=Uqe(this,o,t,Vqe.orientation)),Hqe.heading=R(t.heading,0),Hqe.pitch=R(t.pitch,-z.PI_OVER_TWO),Hqe.roll=R(t.roll,0),n===ij.SCENE3D?Mqe(this,o,Hqe):n===ij.SCENE2D?Nqe(this,o,Hqe,i):Bqe(this,o,Hqe,i)};const Gqe=new K;function Wqe(e,t){const n=e._scene.mapMode2D===$We.ROTATE,i=e._maxCoord.x,o=e._maxCoord.y;let r,s;n?(s=i,r=-s):(s=t.x-2*i,r=t.x+2*i),t.x>i&&(t.x=s),t.x<-i&&(t.x=r),t.y>o&&(t.y=o),t.y<-o&&(t.y=-o)}eqe.prototype.flyHome=function(e){const t=this._mode;if(t===ij.MORPHING&&this._scene.completeMorph(),t===ij.SCENE2D)this.flyTo({destination:eqe.DEFAULT_VIEW_RECTANGLE,duration:e,endTransform:ft.IDENTITY});else if(t===ij.SCENE3D){const t=this.getRectangleCameraCoordinates(eqe.DEFAULT_VIEW_RECTANGLE);let n=K.magnitude(t);n+=n*eqe.DEFAULT_VIEW_FACTOR,K.normalize(t,t),K.multiplyByScalar(t,n,t),this.flyTo({destination:t,duration:e,endTransform:ft.IDENTITY})}else if(t===ij.COLUMBUS_VIEW){const t=this._projection.ellipsoid.maximumRadius;let n=new K(0,-1,1);n=K.multiplyByScalar(K.normalize(n,n),5*t,n),this.flyTo({destination:n,duration:e,orientation:{heading:0,pitch:-Math.acos(K.normalize(n,Gqe).z),roll:0},endTransform:ft.IDENTITY,convert:!1})}},eqe.prototype.worldToCameraCoordinates=function(e,t){if(!C(e))throw new x("cartesian is required.");return C(t)||(t=new Xe),pqe(this),ft.multiplyByVector(this._actualInvTransform,e,t)},eqe.prototype.worldToCameraCoordinatesPoint=function(e,t){if(!C(e))throw new x("cartesian is required.");return C(t)||(t=new K),pqe(this),ft.multiplyByPoint(this._actualInvTransform,e,t)},eqe.prototype.worldToCameraCoordinatesVector=function(e,t){if(!C(e))throw new x("cartesian is required.");return C(t)||(t=new K),pqe(this),ft.multiplyByPointAsVector(this._actualInvTransform,e,t)},eqe.prototype.cameraToWorldCoordinates=function(e,t){if(!C(e))throw new x("cartesian is required.");return C(t)||(t=new Xe),pqe(this),ft.multiplyByVector(this._actualTransform,e,t)},eqe.prototype.cameraToWorldCoordinatesPoint=function(e,t){if(!C(e))throw new x("cartesian is required.");return C(t)||(t=new K),pqe(this),ft.multiplyByPoint(this._actualTransform,e,t)},eqe.prototype.cameraToWorldCoordinatesVector=function(e,t){if(!C(e))throw new x("cartesian is required.");return C(t)||(t=new K),pqe(this),ft.multiplyByPointAsVector(this._actualTransform,e,t)};const qqe=new K;eqe.prototype.move=function(e,t){if(!C(e))throw new x("direction is required.");const n=this.position;K.multiplyByScalar(e,t,qqe),K.add(n,qqe,n),this._mode===ij.SCENE2D&&Wqe(this,n),this._adjustOrthographicFrustum(!0)},eqe.prototype.moveForward=function(e){e=R(e,this.defaultMoveAmount),this._mode===ij.SCENE2D?nje(this,e):this.move(this.direction,e)},eqe.prototype.moveBackward=function(e){e=R(e,this.defaultMoveAmount),this._mode===ij.SCENE2D?nje(this,-e):this.move(this.direction,-e)},eqe.prototype.moveUp=function(e){e=R(e,this.defaultMoveAmount),this.move(this.up,e)},eqe.prototype.moveDown=function(e){e=R(e,this.defaultMoveAmount),this.move(this.up,-e)},eqe.prototype.moveRight=function(e){e=R(e,this.defaultMoveAmount),this.move(this.right,e)},eqe.prototype.moveLeft=function(e){e=R(e,this.defaultMoveAmount),this.move(this.right,-e)},eqe.prototype.lookLeft=function(e){e=R(e,this.defaultLookAmount),this._mode!==ij.SCENE2D&&this.look(this.up,-e)},eqe.prototype.lookRight=function(e){e=R(e,this.defaultLookAmount),this._mode!==ij.SCENE2D&&this.look(this.up,e)},eqe.prototype.lookUp=function(e){e=R(e,this.defaultLookAmount),this._mode!==ij.SCENE2D&&this.look(this.right,-e)},eqe.prototype.lookDown=function(e){e=R(e,this.defaultLookAmount),this._mode!==ij.SCENE2D&&this.look(this.right,e)};const jqe=new il,Yqe=new ke;eqe.prototype.look=function(e,t){if(!C(e))throw new x("axis is required.");const n=R(t,this.defaultLookAmount),i=il.fromAxisAngle(e,-n,jqe),o=ke.fromQuaternion(i,Yqe),r=this.direction,s=this.up,a=this.right;ke.multiplyByVector(o,r,r),ke.multiplyByVector(o,s,s),ke.multiplyByVector(o,a,a)},eqe.prototype.twistLeft=function(e){e=R(e,this.defaultLookAmount),this.look(this.direction,e)},eqe.prototype.twistRight=function(e){e=R(e,this.defaultLookAmount),this.look(this.direction,-e)};const Kqe=new il,Xqe=new ke;eqe.prototype.rotate=function(e,t){if(!C(e))throw new x("axis is required.");const n=R(t,this.defaultRotateAmount),i=il.fromAxisAngle(e,-n,Kqe),o=ke.fromQuaternion(i,Xqe);ke.multiplyByVector(o,this.position,this.position),ke.multiplyByVector(o,this.direction,this.direction),ke.multiplyByVector(o,this.up,this.up),K.cross(this.direction,this.up,this.right),K.cross(this.right,this.direction,this.up),this._adjustOrthographicFrustum(!1)},eqe.prototype.rotateDown=function(e){e=R(e,this.defaultRotateAmount),eje(this,e)},eqe.prototype.rotateUp=function(e){e=R(e,this.defaultRotateAmount),eje(this,-e)};const Qqe=new K,Jqe=new K,Zqe=new K,$qe=new K;function eje(e,t){const n=e.position;if(C(e.constrainedAxis)&&!K.equalsEpsilon(e.position,K.ZERO,z.EPSILON2)){const i=K.normalize(n,Qqe),o=K.equalsEpsilon(i,e.constrainedAxis,z.EPSILON2),r=K.equalsEpsilon(i,K.negate(e.constrainedAxis,$qe),z.EPSILON2);if(o||r)(o&&t<0||r&&t>0)&&e.rotate(e.right,t);else{const n=K.normalize(e.constrainedAxis,Jqe);let o=K.dot(i,n),r=z.acosClamped(o);t>0&&t>r&&(t=r-z.EPSILON4),o=K.dot(i,K.negate(n,$qe)),r=z.acosClamped(o),t<0&&-t>r&&(t=-r+z.EPSILON4);const s=K.cross(n,i,Zqe);e.rotate(s,t)}}else e.rotate(e.right,t)}function tje(e,t){C(e.constrainedAxis)?e.rotate(e.constrainedAxis,t):e.rotate(e.up,t)}function nje(e,t){const n=e.frustum;if(!(n instanceof GC)||!C(n.left)||!C(n.right)||!C(n.bottom)||!C(n.top))throw new x("The camera frustum is expected to be orthographic for 2D camera control.");let i;if(t*=.5,Math.abs(n.top)+Math.abs(n.bottom)>Math.abs(n.left)+Math.abs(n.right)){let o=n.top-t,r=n.bottom+t,s=e._maxCoord.y;e._scene.mapMode2D===$We.ROTATE&&(s*=e.maximumZoomFactor),r>s&&(r=s,o=-s),o<=r&&(o=1,r=-1),i=n.right/n.top,n.top=o,n.bottom=r,n.right=n.top*i,n.left=-n.right}else{let o=n.right-t,r=n.left+t,s=e._maxCoord.x;e._scene.mapMode2D===$We.ROTATE&&(s*=e.maximumZoomFactor),o>s&&(o=s,r=-s),o<=r&&(o=1,r=-1),i=n.top/n.right,n.right=o,n.left=r,n.top=n.right*i,n.bottom=-n.top}}function ije(e,t){e.move(e.direction,t)}eqe.prototype.rotateRight=function(e){e=R(e,this.defaultRotateAmount),tje(this,-e)},eqe.prototype.rotateLeft=function(e){e=R(e,this.defaultRotateAmount),tje(this,e)},eqe.prototype.zoomIn=function(e){e=R(e,this.defaultZoomAmount),this._mode===ij.SCENE2D?nje(this,e):ije(this,e)},eqe.prototype.zoomOut=function(e){e=R(e,this.defaultZoomAmount),this._mode===ij.SCENE2D?nje(this,-e):ije(this,-e)},eqe.prototype.getMagnitude=function(){return this._mode===ij.SCENE3D?K.magnitude(this.position):this._mode===ij.COLUMBUS_VIEW?Math.abs(this.position.z):this._mode===ij.SCENE2D?Math.max(this.frustum.right-this.frustum.left,this.frustum.top-this.frustum.bottom):void 0};const oje=new ft;eqe.prototype.lookAt=function(e,t){if(!C(e))throw new x("target is required");if(!C(t))throw new x("offset is required");if(this._mode===ij.MORPHING)throw new x("lookAt is not supported while morphing.");const n=Kl.eastNorthUpToFixedFrame(e,ge.WGS84,oje);this.lookAtTransform(n,t)};const rje=new K,sje=new il,aje=new il,cje=new ke;function lje(e,t,n){t=z.clamp(t,-z.PI_OVER_TWO,z.PI_OVER_TWO),e=z.zeroToTwoPi(e)-z.PI_OVER_TWO;const i=il.fromAxisAngle(K.UNIT_Y,-t,sje),o=il.fromAxisAngle(K.UNIT_Z,-e,aje),r=il.multiply(o,i,o),s=ke.fromQuaternion(r,cje),a=K.clone(K.UNIT_X,rje);return ke.multiplyByVector(s,a,a),K.negate(a,a),K.multiplyByScalar(a,n,a),a}eqe.prototype.lookAtTransform=function(e,t){if(!C(e))throw new x("transform is required");if(this._mode===ij.MORPHING)throw new x("lookAtTransform is not supported while morphing.");if(this._setTransform(e),!C(t))return;let n;if(n=C(t.heading)?lje(t.heading,t.pitch,t.range):t,this._mode===ij.SCENE2D){ro.clone(ro.ZERO,this.position),K.negate(n,this.up),this.up.z=0,K.magnitudeSquared(this.up)<z.EPSILON10&&K.clone(K.UNIT_Y,this.up),K.normalize(this.up,this.up),this._setTransform(ft.IDENTITY),K.negate(K.UNIT_Z,this.direction),K.cross(this.direction,this.up,this.right),K.normalize(this.right,this.right);const t=this.frustum,i=t.top/t.right;return t.right=.5*K.magnitude(n),t.left=-t.right,t.top=i*t.right,t.bottom=-t.top,void this._setTransform(e)}K.clone(n,this.position),K.negate(this.position,this.direction),K.normalize(this.direction,this.direction),K.cross(this.direction,K.UNIT_Z,this.right),K.magnitudeSquared(this.right)<z.EPSILON10&&K.clone(K.UNIT_X,this.right),K.normalize(this.right,this.right),K.cross(this.right,this.direction,this.up),K.normalize(this.up,this.up),this._adjustOrthographicFrustum(!0)};const uje=new se,hje=new se,dje=new K,fje=new K,pje=new K,mje=new K,_je=new K,gje=new K,yje=new K,vje=new K,bje={direction:new K,right:new K,up:new K};let Aje;function wje(e,t,n,i){const o=Math.abs(K.dot(t,n));return o/i-K.dot(e,n)}function Tje(e,t,n,i){const o=e._projection.ellipsoid,r=i?e:bje,s=t.north,a=t.south;let c=t.east;const l=t.west;l>c&&(c+=z.TWO_PI);const u=.5*(l+c);let h;if(a<-z.PI_OVER_TWO+z.RADIANS_PER_DEGREE&&s>z.PI_OVER_TWO-z.RADIANS_PER_DEGREE)h=0;else{const e=uje;e.longitude=u,e.latitude=s,e.height=0;const t=hje;t.longitude=u,t.latitude=a,t.height=0;let n=Aje;C(n)&&n.ellipsoid===o||(Aje=n=new Jb(void 0,void 0,o)),n.setEndPoints(e,t),h=n.interpolateUsingFraction(.5,uje).latitude}const d=uje;d.longitude=u,d.latitude=h,d.height=0;const f=o.cartographicToCartesian(d,yje),p=uje;p.longitude=c,p.latitude=s;const m=o.cartographicToCartesian(p,dje);p.longitude=l;const _=o.cartographicToCartesian(p,pje);p.longitude=u;const g=o.cartographicToCartesian(p,_je);p.latitude=a;const y=o.cartographicToCartesian(p,gje);p.longitude=c;const v=o.cartographicToCartesian(p,mje);p.longitude=l;const b=o.cartographicToCartesian(p,fje);K.subtract(_,f,_),K.subtract(v,f,v),K.subtract(m,f,m),K.subtract(b,f,b),K.subtract(g,f,g),K.subtract(y,f,y);const A=o.geodeticSurfaceNormal(f,r.direction);K.negate(A,A);const w=K.cross(A,K.UNIT_Z,r.right);K.normalize(w,w);const T=K.cross(w,A,r.up);let E;if(e.frustum instanceof jC){const t=Math.max(K.distance(m,_),K.distance(v,b)),n=Math.max(K.distance(m,v),K.distance(_,b));let i,o;const r=e.frustum._offCenterFrustum.right/e.frustum._offCenterFrustum.top,s=n*r;t>s?(i=t,o=i/r):(o=n,i=s),E=Math.max(i,o)}else{const t=Math.tan(.5*e.frustum.fovy),n=e.frustum.aspectRatio*t;if(E=Math.max(wje(A,T,_,t),wje(A,T,v,t),wje(A,T,m,t),wje(A,T,b,t),wje(A,T,g,t),wje(A,T,y,t),wje(A,w,_,n),wje(A,w,v,n),wje(A,w,m,n),wje(A,w,b,n),wje(A,w,g,n),wje(A,w,y,n)),a<0&&s>0){const e=uje;e.longitude=l,e.latitude=0,e.height=0;let i=o.cartographicToCartesian(e,vje);K.subtract(i,f,i),E=Math.max(E,wje(A,T,i,t),wje(A,w,i,n)),e.longitude=c,i=o.cartographicToCartesian(e,vje),K.subtract(i,f,i),E=Math.max(E,wje(A,T,i,t),wje(A,w,i,n))}}return K.add(f,K.multiplyByScalar(A,-E,vje),n)}const Cje=new se,Eje=new K,xje=new K;function Sje(e,t,n){const i=e._projection;t.west>t.east&&(t=_t.MAX_VALUE);const o=e._actualTransform,r=e._actualInvTransform,s=Cje;s.longitude=t.east,s.latitude=t.north;const a=i.project(s,Eje);ft.multiplyByPoint(o,a,a),ft.multiplyByPoint(r,a,a),s.longitude=t.west,s.latitude=t.south;const c=i.project(s,xje);if(ft.multiplyByPoint(o,c,c),ft.multiplyByPoint(r,c,c),n.x=.5*(a.x-c.x)+c.x,n.y=.5*(a.y-c.y)+c.y,C(e.frustum.fovy)){const t=Math.tan(.5*e.frustum.fovy),i=e.frustum.aspectRatio*t;n.z=.5*Math.max((a.x-c.x)/i,(a.y-c.y)/t)}else{const e=a.x-c.x,t=a.y-c.y;n.z=Math.max(e,t)}return n}const Ije=new se,Oje=new K,Dje=new K;function Pje(e,t,n){const i=e._projection;let o=t.east;t.west>t.east&&(e._scene.mapMode2D===$We.INFINITE_SCROLL?o+=z.TWO_PI:(t=_t.MAX_VALUE,o=t.east));let r=Ije;r.longitude=o,r.latitude=t.north;const s=i.project(r,Oje);r.longitude=t.west,r.latitude=t.south;const a=i.project(r,Dje),c=.5*Math.abs(s.x-a.x);let l,u,h=.5*Math.abs(s.y-a.y);const d=e.frustum.right/e.frustum.top,f=h*d;return c>f?(l=c,u=l/d):(u=h,l=f),h=Math.max(2*l,2*u),n.x=.5*(s.x-a.x)+a.x,n.y=.5*(s.y-a.y)+a.y,r=i.unproject(n,r),r.height=h,n=i.project(r,n),n}eqe.prototype.getRectangleCameraCoordinates=function(e,t){if(!C(e))throw new x("rectangle is required");const n=this._mode;return C(t)||(t=new K),n===ij.SCENE3D?Tje(this,e,t):n===ij.COLUMBUS_VIEW?Sje(this,e,t):n===ij.SCENE2D?Pje(this,e,t):void 0};const Rje=new os;function Lje(e,t,n,i){n=R(n,ge.WGS84);const o=e.getPickRay(t,Rje),r=Ns.rayEllipsoid(o,n);if(!r)return;const s=r.start>0?r.start:r.stop;return os.getPoint(o,s,i)}const Mje=new os;function Bje(e,t,n,i){const o=e.getPickRay(t,Mje);let r=o.origin;r=K.fromElements(r.y,r.z,0,r);const s=n.unproject(r);if(!(s.latitude<-z.PI_OVER_TWO||s.latitude>z.PI_OVER_TWO))return n.ellipsoid.cartographicToCartesian(s,i)}const Nje=new os;function Fje(e,t,n,i){const o=e.getPickRay(t,Nje),r=-o.origin.x/o.direction.x;os.getPoint(o,r,i);const s=n.unproject(new K(i.y,i.z,0));if(!(s.latitude<-z.PI_OVER_TWO||s.latitude>z.PI_OVER_TWO||s.longitude<-Math.PI||s.longitude>Math.PI))return n.ellipsoid.cartographicToCartesian(s,i)}eqe.prototype.pickEllipsoid=function(e,t,n){if(!C(e))throw new x("windowPosition is required.");const i=this._scene.canvas;if(0!==i.clientWidth&&0!==i.clientHeight){if(C(n)||(n=new K),t=R(t,ge.WGS84),this._mode===ij.SCENE3D)n=Lje(this,e,t,n);else if(this._mode===ij.SCENE2D)n=Bje(this,e,this._projection,n);else{if(this._mode!==ij.COLUMBUS_VIEW)return;n=Fje(this,e,this._projection,n)}return n}};const zje=new K,kje=new K,Uje=new K;function Vje(e,t,n){const i=e._scene.canvas,o=i.clientWidth,r=i.clientHeight,s=Math.tan(.5*e.frustum.fovy),a=e.frustum.aspectRatio*s,c=e.frustum.near,l=2/o*t.x-1,u=2/r*(r-t.y)-1,h=e.positionWC;K.clone(h,n.origin);const d=K.multiplyByScalar(e.directionWC,c,zje);K.add(h,d,d);const f=K.multiplyByScalar(e.rightWC,l*c*a,kje),p=K.multiplyByScalar(e.upWC,u*c*s,Uje),m=K.add(d,f,n.direction);return K.add(m,p,m),K.subtract(m,h,m),K.normalize(m,m),n}const Hje=new K;function Gje(e,t,n){const i=e._scene.canvas,o=i.clientWidth,r=i.clientHeight;let s=e.frustum;C(s._offCenterFrustum)&&(s=s._offCenterFrustum);let a=2/o*t.x-1;a*=.5*(s.right-s.left);let c=2/r*(r-t.y)-1;c*=.5*(s.top-s.bottom);const l=n.origin;return K.clone(e.position,l),K.multiplyByScalar(e.right,a,Hje),K.add(Hje,l,l),K.multiplyByScalar(e.up,c,Hje),K.add(Hje,l,l),K.clone(e.directionWC,n.direction),e._mode!==ij.COLUMBUS_VIEW&&e._mode!==ij.SCENE2D||K.fromElements(n.origin.z,n.origin.x,n.origin.y,n.origin),n}eqe.prototype.getPickRay=function(e,t){if(!C(e))throw new x("windowPosition is required.");C(t)||(t=new os);const n=this._scene.canvas;if(n.clientWidth<=0||n.clientHeight<=0)return;const i=this.frustum;return C(i.aspectRatio)&&C(i.fov)&&C(i.near)?Vje(this,e,t):Gje(this,e,t)};const Wje=new K,qje=new K;eqe.prototype.distanceToBoundingSphere=function(e){if(!C(e))throw new x("boundingSphere is required.");const t=K.subtract(this.positionWC,e.center,Wje),n=K.multiplyByScalar(this.directionWC,K.dot(t,this.directionWC),qje);return Math.max(0,K.magnitude(n)-e.radius)};const jje=new ro;function Yje(e,t,n,i,o,r){const s=K.clone(t);function a(n){const i=K.lerp(t,s,n.time,new K);e.worldToCameraCoordinatesPoint(i,e.position)}return n.y>i?s.y-=n.y-i:n.y<-i&&(s.y+=-i-n.y),n.z>o?s.z-=n.z-o:n.z<-o&&(s.z+=-o-n.z),{easingFunction:rC.EXPONENTIAL_OUT,startObject:{time:0},stopObject:{time:1},duration:r,update:a}}eqe.prototype.getPixelSize=function(e,t,n){if(!C(e))throw new x("boundingSphere is required.");if(!C(t))throw new x("drawingBufferWidth is required.");if(!C(n))throw new x("drawingBufferHeight is required.");const i=this.distanceToBoundingSphere(e),o=this.frustum.getPixelDimensions(t,n,i,this._scene.pixelRatio,jje);return Math.max(o.x,o.y)};const Kje=new K,Xje=new K,Qje=new K,Jje=new K;function Zje(e,t){let n=e.position;const i=e.direction,o=e.worldToCameraCoordinatesVector(K.UNIT_X,Kje),r=-K.dot(o,n)/K.dot(o,i),s=K.add(n,K.multiplyByScalar(i,r,Xje),Xje);e.cameraToWorldCoordinatesPoint(s,s),n=e.cameraToWorldCoordinatesPoint(e.position,Qje);const a=Math.tan(.5*e.frustum.fovy),c=e.frustum.aspectRatio*a,l=K.magnitude(K.subtract(n,s,Jje)),u=c*l,h=a*l,d=e._maxCoord.x,f=e._maxCoord.y,p=Math.max(u-d,d),m=Math.max(h-f,f);if(n.z<-p||n.z>p||n.y<-m||n.y>m){const i=s.y<-p||s.y>p,o=s.z<-m||s.z>m;if(i||o)return Yje(e,n,s,p,m,t)}}eqe.prototype.createCorrectPositionTween=function(e){if(!C(e))throw new x("duration is required.");if(this._mode===ij.COLUMBUS_VIEW)return Zje(this,e)};const $je=new K,eYe={destination:void 0,heading:void 0,pitch:void 0,roll:void 0,duration:void 0,complete:void 0,cancel:void 0,endTransform:void 0,maximumHeight:void 0,easingFunction:void 0};function tYe(e,t){const n=e.frustum,i=Math.tan(.5*n.fovy),o=n.aspectRatio*i;return Math.max(t/o,t/i)}function nYe(e,t){let n,i,o=e.frustum;C(o._offCenterFrustum)&&(o=o._offCenterFrustum);const r=o.right/o.top,s=t*r;return t>s?(n=t,i=n/r):(i=t,n=s),1.5*Math.max(n,i)}eqe.prototype.cancelFlight=function(){C(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=void 0)},eqe.prototype.completeFlight=function(){if(C(this._currentFlight)){this._currentFlight.cancelTween();const e={destination:void 0,orientation:{heading:void 0,pitch:void 0,roll:void 0}};e.destination=eYe.destination,e.orientation.heading=eYe.heading,e.orientation.pitch=eYe.pitch,e.orientation.roll=eYe.roll,this.setView(e),C(this._currentFlight.complete)&&this._currentFlight.complete(),this._currentFlight=void 0}},eqe.prototype.flyTo=function(e){e=R(e,R.EMPTY_OBJECT);let t=e.destination;if(!C(t))throw new x("destination is required.");const n=this._mode;if(n===ij.MORPHING)return;this.cancelFlight();let i=R(e.orientation,R.EMPTY_OBJECT);if(C(i.direction)&&(i=Uqe(this,t,i,Vqe.orientation)),C(e.duration)&&e.duration<=0){const t=Vqe;return t.destination=e.destination,t.orientation.heading=i.heading,t.orientation.pitch=i.pitch,t.orientation.roll=i.roll,t.convert=e.convert,t.endTransform=e.endTransform,this.setView(t),void("function"===typeof e.complete&&e.complete())}const o=C(t.west);o&&(t=this.getRectangleCameraCoordinates(t,$je));const r=this;let s;eYe.destination=t,eYe.heading=i.heading,eYe.pitch=i.pitch,eYe.roll=i.roll,eYe.duration=e.duration,eYe.complete=function(){s===r._currentFlight&&(r._currentFlight=void 0),C(e.complete)&&e.complete()},eYe.cancel=e.cancel,eYe.endTransform=e.endTransform,eYe.convert=!o&&e.convert,eYe.maximumHeight=e.maximumHeight,eYe.pitchAdjustHeight=e.pitchAdjustHeight,eYe.flyOverLongitude=e.flyOverLongitude,eYe.flyOverLongitudeWeight=e.flyOverLongitudeWeight,eYe.easingFunction=e.easingFunction;const a=this._scene,c=JWe.createTween(a,eYe);if(0===c.duration)return void("function"===typeof c.complete&&c.complete());s=a.tweens.add(c),this._currentFlight=s;let l=this._scene.preloadFlightCamera;this._mode!==ij.SCENE2D&&(C(l)||(l=eqe.clone(this)),l.setView({destination:t,orientation:i}),this._scene.preloadFlightCullingVolume=l.frustum.computeCullingVolume(l.positionWC,l.directionWC,l.upWC))};const iYe=100;function oYe(e,t,n){n=uI.clone(C(n)?n:eqe.DEFAULT_OFFSET);const i=e._scene.screenSpaceCameraController.minimumZoomDistance,o=e._scene.screenSpaceCameraController.maximumZoomDistance,r=n.range;if(!C(r)||0===r){const r=t.radius;0===r?n.range=iYe:e.frustum instanceof jC||e._mode===ij.SCENE2D?n.range=nYe(e,r):n.range=tYe(e,r),n.range=z.clamp(n.range,i,o)}return n}eqe.prototype.viewBoundingSphere=function(e,t){if(!C(e))throw new x("boundingSphere is required.");if(this._mode===ij.MORPHING)throw new x("viewBoundingSphere is not supported while morphing.");t=oYe(this,e,t),this.lookAt(e.center,t)};const rYe=new ft,sYe=new K,aYe=new K,cYe=new K,lYe=new K,uYe=new Xe,hYe=new il,dYe=new ke;eqe.prototype.flyToBoundingSphere=function(e,t){if(!C(e))throw new x("boundingSphere is required.");t=R(t,R.EMPTY_OBJECT);const n=this._mode===ij.SCENE2D||this._mode===ij.COLUMBUS_VIEW;this._setTransform(ft.IDENTITY);const i=oYe(this,e,t.offset);let o;o=n?K.multiplyByScalar(K.UNIT_Z,i.range,sYe):lje(i.heading,i.pitch,i.range);const r=Kl.eastNorthUpToFixedFrame(e.center,ge.WGS84,rYe);let s,a;if(ft.multiplyByPoint(r,o,o),!n){if(s=K.subtract(e.center,o,aYe),K.normalize(s,s),a=ft.multiplyByPointAsVector(r,K.UNIT_Z,cYe),1-Math.abs(K.dot(s,a))<z.EPSILON6){const e=il.fromAxisAngle(s,i.heading,hYe),t=ke.fromQuaternion(e,dYe);K.fromCartesian4(ft.getColumn(r,1,uYe),a),ke.multiplyByVector(t,a,a)}const t=K.cross(s,a,lYe);K.cross(t,s,a),K.normalize(a,a)}this.flyTo({destination:o,orientation:{direction:s,up:a},duration:t.duration,complete:t.complete,cancel:t.cancel,endTransform:t.endTransform,maximumHeight:t.maximumHeight,easingFunction:t.easingFunction,flyOverLongitude:t.flyOverLongitude,flyOverLongitudeWeight:t.flyOverLongitudeWeight,pitchAdjustHeight:t.pitchAdjustHeight})};const fYe=new K,pYe=new K,mYe=new K,_Ye=new K,gYe=[new K,new K,new K,new K];function yYe(e,t){const n=t.radii,i=e.positionWC,o=K.multiplyComponents(t.oneOverRadii,i,fYe),r=K.magnitude(o),s=K.normalize(o,pYe);let a,c;K.equalsEpsilon(s,K.UNIT_Z,z.EPSILON10)?(a=new K(0,1,0),c=new K(0,0,1)):(a=K.normalize(K.cross(K.UNIT_Z,s,mYe),mYe),c=K.normalize(K.cross(s,a,_Ye),_Ye));const l=Math.sqrt(K.magnitudeSquared(o)-1),u=K.multiplyByScalar(s,1/r,fYe),h=l/r,d=K.multiplyByScalar(a,h,pYe),f=K.multiplyByScalar(c,h,mYe),p=K.add(u,f,gYe[0]);K.subtract(p,d,p),K.multiplyComponents(n,p,p);const m=K.subtract(u,f,gYe[1]);K.subtract(m,d,m),K.multiplyComponents(n,m,m);const _=K.subtract(u,f,gYe[2]);K.add(_,d,_),K.multiplyComponents(n,_,_);const g=K.add(u,f,gYe[3]);return K.add(g,d,g),K.multiplyComponents(n,g,g),gYe}const vYe=new ro,bYe=new K,AYe=[new se,new se,new se,new se];function wYe(e,t,n,i,o,r){vYe.x=e,vYe.y=t;const s=i.pickEllipsoid(vYe,o,bYe);return C(s)?(AYe[n]=o.cartesianToCartographic(s,AYe[n]),1):(AYe[n]=o.cartesianToCartographic(r[n],AYe[n]),0)}eqe.prototype.computeViewRectangle=function(e,t){e=R(e,ge.WGS84);const n=this.frustum.computeCullingVolume(this.positionWC,this.directionWC,this.upWC),i=new nn(K.ZERO,e.maximumRadius),o=n.computeVisibility(i);if(o===Ae.OUTSIDE)return;const r=this._scene.canvas,s=r.clientWidth,a=r.clientHeight;let c=0;const l=yYe(this,e);if(c+=wYe(0,0,0,this,e,l),c+=wYe(0,a,1,this,e,l),c+=wYe(s,a,2,this,e,l),c+=wYe(s,0,3,this,e,l),c<2)return _t.MAX_VALUE;t=_t.fromCartographicArray(AYe,t);let u=0,h=AYe[3].longitude;for(let d=0;d<4;++d){const e=AYe[d].longitude,t=Math.abs(e-h);t>z.PI?u+=z.TWO_PI-t:u+=t,h=e}return z.equalsEpsilon(Math.abs(u),z.TWO_PI,z.EPSILON9)&&(t.west=-z.PI,t.east=z.PI,AYe[0].latitude>=0?t.north=z.PI_OVER_TWO:t.south=-z.PI_OVER_TWO),t},eqe.prototype.switchToPerspectiveFrustum=function(){if(this._mode===ij.SCENE2D||this.frustum instanceof nE)return;const e=this._scene;this.frustum=new nE,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=z.toRadians(60)},eqe.prototype.switchToOrthographicFrustum=function(){if(this._mode===ij.SCENE2D||this.frustum instanceof jC)return;const e=Sqe(this),t=this._scene;this.frustum=new jC,this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.width=e},eqe.clone=function(e,t){return C(t)||(t=new eqe(e._scene)),K.clone(e.position,t.position),K.clone(e.direction,t.direction),K.clone(e.up,t.up),K.clone(e.right,t.right),ft.clone(e._transform,t.transform),t._transformChanged=!0,t.frustum=e.frustum.clone(),t};var TYe=eqe;const CYe={LEFT_DRAG:0,RIGHT_DRAG:1,MIDDLE_DRAG:2,WHEEL:3,PINCH:4};var EYe=Object.freeze(CYe);function xYe(e,t){let n=e;return C(t)&&(n+=`+${t}`),n}function SYe(e,t){ro.clone(e.distance.startPosition,t.distance.startPosition),ro.clone(e.distance.endPosition,t.distance.endPosition),ro.clone(e.angleAndHeight.startPosition,t.angleAndHeight.startPosition),ro.clone(e.angleAndHeight.endPosition,t.angleAndHeight.endPosition)}function IYe(e,t,n){const i=xYe(EYe.PINCH,t),o=e._update,r=e._isDown,s=e._eventStartPosition,a=e._pressTime,c=e._releaseTime;o[i]=!0,r[i]=!1,s[i]=new ro;let l=e._movement[i];C(l)||(l=e._movement[i]={}),l.distance={startPosition:new ro,endPosition:new ro},l.angleAndHeight={startPosition:new ro,endPosition:new ro},l.prevAngle=0,e._eventHandler.setInputAction((function(t){e._buttonsDown++,r[i]=!0,a[i]=new Date,ro.lerp(t.position1,t.position2,.5,s[i])}),JL.PINCH_START,t),e._eventHandler.setInputAction((function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),r[i]=!1,c[i]=new Date}),JL.PINCH_END,t),e._eventHandler.setInputAction((function(e){if(r[i]){o[i]?(SYe(e,l),o[i]=!1,l.prevAngle=l.angleAndHeight.startPosition.x):(ro.clone(e.distance.endPosition,l.distance.endPosition),ro.clone(e.angleAndHeight.endPosition,l.angleAndHeight.endPosition));let t=l.angleAndHeight.endPosition.x;const r=l.prevAngle,s=2*Math.PI;while(t>=r+Math.PI)t-=s;while(t<r-Math.PI)t+=s;l.angleAndHeight.endPosition.x=-t*n.clientWidth/12,l.angleAndHeight.startPosition.x=-r*n.clientWidth/12}}),JL.PINCH_MOVE,t)}function OYe(e,t){const n=xYe(EYe.WHEEL,t),i=e._update;i[n]=!0;let o=e._movement[n];C(o)||(o=e._movement[n]={}),o.startPosition=new ro,o.endPosition=new ro,e._eventHandler.setInputAction((function(e){const t=15*z.toRadians(e);i[n]?(ro.clone(ro.ZERO,o.startPosition),o.endPosition.x=0,o.endPosition.y=t,i[n]=!1):o.endPosition.y=o.endPosition.y+t}),JL.WHEEL,t)}function DYe(e,t,n){const i=xYe(n,t),o=e._isDown,r=e._eventStartPosition,s=e._pressTime,a=e._releaseTime;o[i]=!1,r[i]=new ro;let c,l,u=e._lastMovement[i];C(u)||(u=e._lastMovement[i]={startPosition:new ro,endPosition:new ro,valid:!1}),n===EYe.LEFT_DRAG?(c=JL.LEFT_DOWN,l=JL.LEFT_UP):n===EYe.RIGHT_DRAG?(c=JL.RIGHT_DOWN,l=JL.RIGHT_UP):n===EYe.MIDDLE_DRAG&&(c=JL.MIDDLE_DOWN,l=JL.MIDDLE_UP),e._eventHandler.setInputAction((function(t){e._buttonsDown++,u.valid=!1,o[i]=!0,s[i]=new Date,ro.clone(t.position,r[i])}),c,t),e._eventHandler.setInputAction((function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),o[i]=!1,a[i]=new Date}),l,t)}function PYe(e,t){ro.clone(e.startPosition,t.startPosition),ro.clone(e.endPosition,t.endPosition)}function RYe(e,t){const n=e._update,i=e._movement,o=e._lastMovement,r=e._isDown;for(const s in EYe)if(EYe.hasOwnProperty(s)){const i=EYe[s];if(C(i)){const o=xYe(i,t);n[o]=!0,C(e._lastMovement[o])||(e._lastMovement[o]={startPosition:new ro,endPosition:new ro,valid:!1}),C(e._movement[o])||(e._movement[o]={startPosition:new ro,endPosition:new ro})}}e._eventHandler.setInputAction((function(s){for(const e in EYe)if(EYe.hasOwnProperty(e)){const a=EYe[e];if(C(a)){const e=xYe(a,t);r[e]&&(n[e]?(PYe(i[e],o[e]),o[e].valid=!0,PYe(s,i[e]),n[e]=!1):ro.clone(s.endPosition,i[e].endPosition))}}ro.clone(s.endPosition,e._currentMousePosition)}),JL.MOUSE_MOVE,t)}function LYe(e){if(!C(e))throw new x("canvas is required.");this._eventHandler=new BM(e),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new ro,OYe(this,void 0),IYe(this,void 0,e),DYe(this,void 0,EYe.LEFT_DRAG),DYe(this,void 0,EYe.RIGHT_DRAG),DYe(this,void 0,EYe.MIDDLE_DRAG),RYe(this,void 0);for(const t in yO)if(yO.hasOwnProperty(t)){const n=yO[t];C(n)&&(OYe(this,n),IYe(this,n,e),DYe(this,n,EYe.LEFT_DRAG),DYe(this,n,EYe.RIGHT_DRAG),DYe(this,n,EYe.MIDDLE_DRAG),RYe(this,n))}}Object.defineProperties(LYe.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){const e=!this._update[xYe(EYe.WHEEL)]||!this._update[xYe(EYe.WHEEL,yO.SHIFT)]||!this._update[xYe(EYe.WHEEL,yO.CTRL)]||!this._update[xYe(EYe.WHEEL,yO.ALT)];return this._buttonsDown>0||e}}}),LYe.prototype.isMoving=function(e,t){if(!C(e))throw new x("type is required.");const n=xYe(e,t);return!this._update[n]},LYe.prototype.getMovement=function(e,t){if(!C(e))throw new x("type is required.");const n=xYe(e,t),i=this._movement[n];return i},LYe.prototype.getLastMovement=function(e,t){if(!C(e))throw new x("type is required.");const n=xYe(e,t),i=this._lastMovement[n];if(i.valid)return i},LYe.prototype.isButtonDown=function(e,t){if(!C(e))throw new x("type is required.");const n=xYe(e,t);return this._isDown[n]},LYe.prototype.getStartMousePosition=function(e,t){if(!C(e))throw new x("type is required.");if(e===EYe.WHEEL)return this._currentMousePosition;const n=xYe(e,t);return this._eventStartPosition[n]},LYe.prototype.getButtonPressTime=function(e,t){if(!C(e))throw new x("type is required.");const n=xYe(e,t);return this._pressTime[n]},LYe.prototype.getButtonReleaseTime=function(e,t){if(!C(e))throw new x("type is required.");const n=xYe(e,t);return this._releaseTime[n]},LYe.prototype.reset=function(){for(const e in this._update)this._update.hasOwnProperty(e)&&(this._update[e]=!0)},LYe.prototype.isDestroyed=function(){return!1},LYe.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),Qh(this)};var MYe=LYe;function BYe(){this.featurePropertiesDirty=!1}Object.defineProperties(BYe.prototype,{featuresLength:{get:function(){x.throwInstantiationError()}},pointsLength:{get:function(){x.throwInstantiationError()}},trianglesLength:{get:function(){x.throwInstantiationError()}},geometryByteLength:{get:function(){x.throwInstantiationError()}},texturesByteLength:{get:function(){x.throwInstantiationError()}},batchTableByteLength:{get:function(){x.throwInstantiationError()}},innerContents:{get:function(){x.throwInstantiationError()}},readyPromise:{get:function(){x.throwInstantiationError()}},tileset:{get:function(){x.throwInstantiationError()}},tile:{get:function(){x.throwInstantiationError()}},url:{get:function(){x.throwInstantiationError()}},batchTable:{get:function(){x.throwInstantiationError()}},metadata:{get:function(){x.throwInstantiationError()},set:function(e){x.throwInstantiationError()}},group:{get:function(){x.throwInstantiationError()},set:function(e){x.throwInstantiationError()}}}),BYe.prototype.hasProperty=function(e,t){x.throwInstantiationError()},BYe.prototype.getFeature=function(e){x.throwInstantiationError()},BYe.prototype.applyDebugSettings=function(e,t){x.throwInstantiationError()},BYe.prototype.applyStyle=function(e){x.throwInstantiationError()},BYe.prototype.update=function(e,t){x.throwInstantiationError()},BYe.prototype.isDestroyed=function(){x.throwInstantiationError()},BYe.prototype.destroy=function(){x.throwInstantiationError()};function NYe(e){D.typeOf.object("options",e),D.typeOf.number("options.pass",e.pass),this.pass=e.pass,this.commandList=e.commandList,this.camera=e.camera,this.cullingVolume=e.cullingVolume,this.ready=!1}var FYe=NYe;function zYe(e,t){this._conditionsExpression=pn(e,!0),this._conditions=e.conditions,this._runtimeConditions=void 0,UYe(this,t)}function kYe(e,t){this.condition=e,this.expression=t}function UYe(e,t){const n=[],i=e._conditions;if(!C(i))return;const o=i.length;for(let r=0;r<o;++r){const e=i[r],o=String(e[0]),s=String(e[1]);n.push(new kYe(new e2(o,t),new e2(s,t)))}e._runtimeConditions=n}Object.defineProperties(zYe.prototype,{conditionsExpression:{get:function(){return this._conditionsExpression}}}),zYe.prototype.evaluate=function(e,t){const n=this._runtimeConditions;if(!C(n))return;const i=n.length;for(let o=0;o<i;++o){const i=n[o];if(i.condition.evaluate(e))return i.expression.evaluate(e,t)}},zYe.prototype.evaluateColor=function(e,t){const n=this._runtimeConditions;if(!C(n))return;const i=n.length;for(let o=0;o<i;++o){const i=n[o];if(i.condition.evaluate(e))return i.expression.evaluateColor(e,t)}},zYe.prototype.getShaderFunction=function(e,t,n,i){const o=this._runtimeConditions;if(!C(o)||0===o.length)return;let r="";const s=o.length;for(let a=0;a<s;++a){const e=o[a],i=e.condition.getShaderExpression(t,n),s=e.expression.getShaderExpression(t,n);r+=`    ${0===a?"if":"else if"} (${i})\n    {\n        return ${s};\n    }\n`}return r=`${i} ${e}\n{\n${r}    return ${i}(1.0);\n}\n`,r},zYe.prototype.getVariables=function(){let e=[];const t=this._runtimeConditions;if(!C(t)||0===t.length)return e;const n=t.length;for(let i=0;i<n;++i){const n=t[i];e.push.apply(e,n.condition.getVariables()),e.push.apply(e,n.expression.getVariables())}return e=e.filter((function(e,t,n){return n.indexOf(e)===t})),e};var VYe=zYe;function HYe(e){let t;if(this._style={},this._ready=!1,this._show=void 0,this._color=void 0,this._pointSize=void 0,this._pointOutlineColor=void 0,this._pointOutlineWidth=void 0,this._labelColor=void 0,this._labelOutlineColor=void 0,this._labelOutlineWidth=void 0,this._font=void 0,this._labelStyle=void 0,this._labelText=void 0,this._backgroundColor=void 0,this._backgroundPadding=void 0,this._backgroundEnabled=void 0,this._scaleByDistance=void 0,this._translucencyByDistance=void 0,this._distanceDisplayCondition=void 0,this._heightOffset=void 0,this._anchorLineEnabled=void 0,this._anchorLineColor=void 0,this._image=void 0,this._disableDepthTestDistance=void 0,this._horizontalOrigin=void 0,this._verticalOrigin=void 0,this._labelHorizontalOrigin=void 0,this._labelVerticalOrigin=void 0,this._meta=void 0,this._colorShaderFunction=void 0,this._showShaderFunction=void 0,this._pointSizeShaderFunction=void 0,this._colorShaderFunctionReady=!1,this._showShaderFunctionReady=!1,this._pointSizeShaderFunctionReady=!1,this._colorShaderTranslucent=!1,"string"===typeof e||e instanceof Vi){const n=Vi.createIfNeeded(e);t=n.fetchJson(e)}else t=Promise.resolve(e);const n=this;this._readyPromise=t.then((function(e){return GYe(n,e),n}))}function GYe(e,t){t=R(pn(t,!0),e._style),e._style=t,e.show=t.show,e.color=t.color,e.pointSize=t.pointSize,e.pointOutlineColor=t.pointOutlineColor,e.pointOutlineWidth=t.pointOutlineWidth,e.labelColor=t.labelColor,e.labelOutlineColor=t.labelOutlineColor,e.labelOutlineWidth=t.labelOutlineWidth,e.labelStyle=t.labelStyle,e.font=t.font,e.labelText=t.labelText,e.backgroundColor=t.backgroundColor,e.backgroundPadding=t.backgroundPadding,e.backgroundEnabled=t.backgroundEnabled,e.scaleByDistance=t.scaleByDistance,e.translucencyByDistance=t.translucencyByDistance,e.distanceDisplayCondition=t.distanceDisplayCondition,e.heightOffset=t.heightOffset,e.anchorLineEnabled=t.anchorLineEnabled,e.anchorLineColor=t.anchorLineColor,e.image=t.image,e.disableDepthTestDistance=t.disableDepthTestDistance,e.horizontalOrigin=t.horizontalOrigin,e.verticalOrigin=t.verticalOrigin,e.labelHorizontalOrigin=t.labelHorizontalOrigin,e.labelVerticalOrigin=t.labelVerticalOrigin;const n={};if(C(t.meta)){const e=t.defines,i=R(t.meta,R.EMPTY_OBJECT);for(const t in i)i.hasOwnProperty(t)&&(n[t]=new e2(i[t],e))}e._meta=n,e._ready=!0}function WYe(e,t){const n=R(e._style,R.EMPTY_OBJECT).defines;if(C(t))return"boolean"===typeof t||"number"===typeof t?new e2(String(t)):"string"===typeof t?new e2(t,n):C(t.conditions)?new VYe(t,n):t}function qYe(e){if(C(e))return C(e.expression)?e.expression:C(e.conditionsExpression)?pn(e.conditionsExpression,!0):e}Object.defineProperties(HYe.prototype,{style:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._style}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},show:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._show},set:function(e){this._show=WYe(this,e),this._style.show=qYe(this._show),this._showShaderFunctionReady=!1}},color:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._color},set:function(e){this._color=WYe(this,e),this._style.color=qYe(this._color),this._colorShaderFunctionReady=!1}},pointSize:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._pointSize},set:function(e){this._pointSize=WYe(this,e),this._style.pointSize=qYe(this._pointSize),this._pointSizeShaderFunctionReady=!1}},pointOutlineColor:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._pointOutlineColor},set:function(e){this._pointOutlineColor=WYe(this,e),this._style.pointOutlineColor=qYe(this._pointOutlineColor)}},pointOutlineWidth:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._pointOutlineWidth},set:function(e){this._pointOutlineWidth=WYe(this,e),this._style.pointOutlineWidth=qYe(this._pointOutlineWidth)}},labelColor:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelColor},set:function(e){this._labelColor=WYe(this,e),this._style.labelColor=qYe(this._labelColor)}},labelOutlineColor:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelOutlineColor},set:function(e){this._labelOutlineColor=WYe(this,e),this._style.labelOutlineColor=qYe(this._labelOutlineColor)}},labelOutlineWidth:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelOutlineWidth},set:function(e){this._labelOutlineWidth=WYe(this,e),this._style.labelOutlineWidth=qYe(this._labelOutlineWidth)}},font:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._font},set:function(e){this._font=WYe(this,e),this._style.font=qYe(this._font)}},labelStyle:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelStyle},set:function(e){this._labelStyle=WYe(this,e),this._style.labelStyle=qYe(this._labelStyle)}},labelText:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelText},set:function(e){this._labelText=WYe(this,e),this._style.labelText=qYe(this._labelText)}},backgroundColor:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._backgroundColor},set:function(e){this._backgroundColor=WYe(this,e),this._style.backgroundColor=qYe(this._backgroundColor)}},backgroundPadding:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._backgroundPadding},set:function(e){this._backgroundPadding=WYe(this,e),this._style.backgroundPadding=qYe(this._backgroundPadding)}},backgroundEnabled:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._backgroundEnabled},set:function(e){this._backgroundEnabled=WYe(this,e),this._style.backgroundEnabled=qYe(this._backgroundEnabled)}},scaleByDistance:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._scaleByDistance},set:function(e){this._scaleByDistance=WYe(this,e),this._style.scaleByDistance=qYe(this._scaleByDistance)}},translucencyByDistance:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._translucencyByDistance},set:function(e){this._translucencyByDistance=WYe(this,e),this._style.translucencyByDistance=qYe(this._translucencyByDistance)}},distanceDisplayCondition:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._distanceDisplayCondition},set:function(e){this._distanceDisplayCondition=WYe(this,e),this._style.distanceDisplayCondition=qYe(this._distanceDisplayCondition)}},heightOffset:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._heightOffset},set:function(e){this._heightOffset=WYe(this,e),this._style.heightOffset=qYe(this._heightOffset)}},anchorLineEnabled:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._anchorLineEnabled},set:function(e){this._anchorLineEnabled=WYe(this,e),this._style.anchorLineEnabled=qYe(this._anchorLineEnabled)}},anchorLineColor:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._anchorLineColor},set:function(e){this._anchorLineColor=WYe(this,e),this._style.anchorLineColor=qYe(this._anchorLineColor)}},image:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._image},set:function(e){this._image=WYe(this,e),this._style.image=qYe(this._image)}},disableDepthTestDistance:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._disableDepthTestDistance},set:function(e){this._disableDepthTestDistance=WYe(this,e),this._style.disableDepthTestDistance=qYe(this._disableDepthTestDistance)}},horizontalOrigin:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._horizontalOrigin},set:function(e){this._horizontalOrigin=WYe(this,e),this._style.horizontalOrigin=qYe(this._horizontalOrigin)}},verticalOrigin:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._verticalOrigin},set:function(e){this._verticalOrigin=WYe(this,e),this._style.verticalOrigin=qYe(this._verticalOrigin)}},labelHorizontalOrigin:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelHorizontalOrigin},set:function(e){this._labelHorizontalOrigin=WYe(this,e),this._style.labelHorizontalOrigin=qYe(this._labelHorizontalOrigin)}},labelVerticalOrigin:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelVerticalOrigin},set:function(e){this._labelVerticalOrigin=WYe(this,e),this._style.labelVerticalOrigin=qYe(this._labelVerticalOrigin)}},meta:{get:function(){if(!this._ready)throw new x("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._meta},set:function(e){this._meta=e}}}),HYe.prototype.getColorShaderFunction=function(e,t,n){return this._colorShaderFunctionReady?(n.translucent=this._colorShaderTranslucent,this._colorShaderFunction):(this._colorShaderFunctionReady=!0,C(this.color)&&C(this.color.getShaderFunction)?this._colorShaderFunction=this.color.getShaderFunction(e,t,n,"vec4"):this._colorShaderFunction=void 0,this._colorShaderTranslucent=n.translucent,this._colorShaderFunction)},HYe.prototype.getShowShaderFunction=function(e,t,n){return this._showShaderFunctionReady||(this._showShaderFunctionReady=!0,C(this.show)&&C(this.show.getShaderFunction)?this._showShaderFunction=this.show.getShaderFunction(e,t,n,"bool"):this._showShaderFunction=void 0),this._showShaderFunction},HYe.prototype.getPointSizeShaderFunction=function(e,t,n){return this._pointSizeShaderFunctionReady||(this._pointSizeShaderFunctionReady=!0,C(this.pointSize)&&C(this.pointSize.getShaderFunction)?this._pointSizeShaderFunction=this.pointSize.getShaderFunction(e,t,n,"float"):this._pointSizeShaderFunction=void 0),this._pointSizeShaderFunction},HYe.prototype.getVariables=function(){let e=[];return C(this.color)&&C(this.color.getVariables)&&e.push.apply(e,this.color.getVariables()),C(this.show)&&C(this.show.getVariables)&&e.push.apply(e,this.show.getVariables()),C(this.pointSize)&&C(this.pointSize.getVariables)&&e.push.apply(e,this.pointSize.getVariables()),e=e.filter((function(e,t,n){return n.indexOf(e)===t})),e};var jYe=HYe;function YYe(e){e=R(e,1),D.typeOf.number.greaterThan("radius",e,0),this._radius=R(e,1)}Object.defineProperties(YYe.prototype,{radius:{get:function(){return this._radius},set:function(e){D.typeOf.number.greaterThan("value",e,0),this._radius=e}}}),YYe.prototype.emit=function(e){const t=z.randomBetween(0,z.TWO_PI),n=z.randomBetween(0,this._radius),i=n*Math.cos(t),o=n*Math.sin(t),r=0;e.position=K.fromElements(i,o,r,e.position),e.velocity=K.clone(K.UNIT_Z,e.velocity)};var KYe=YYe;const XYe={CUMULUS:0,validate:function(e){return e===XYe.CUMULUS}};var QYe=Object.freeze(XYe),JYe="uniform sampler2D u_noiseTexture;\nuniform vec3 u_noiseTextureDimensions;\nuniform float u_noiseDetail;\nvarying vec2 v_offset;\nvarying vec3 v_maximumSize;\nvarying vec4 v_color;\nvarying float v_slice;\nvarying float v_brightness;\n\nfloat wrap(float value, float rangeLength) {\n    if(value < 0.0) {\n        float absValue = abs(value);\n        float modValue = mod(absValue, rangeLength);\n        return mod(rangeLength - modValue, rangeLength);\n    }\n    return mod(value, rangeLength);\n}\n\nvec3 wrapVec(vec3 value, float rangeLength) {\n    return vec3(wrap(value.x, rangeLength),\n                wrap(value.y, rangeLength),\n                wrap(value.z, rangeLength));\n}\n\nfloat textureSliceWidth = u_noiseTextureDimensions.x;\nfloat noiseTextureRows = u_noiseTextureDimensions.y;\nfloat inverseNoiseTextureRows = u_noiseTextureDimensions.z;\n\nfloat textureSliceWidthSquared = textureSliceWidth * textureSliceWidth;\nvec2 inverseNoiseTextureDimensions = vec2(noiseTextureRows / textureSliceWidthSquared,\n                                          inverseNoiseTextureRows / textureSliceWidth);\n\nvec2 voxelToUV(vec3 voxelIndex) {\n    vec3 wrappedIndex = wrapVec(voxelIndex, textureSliceWidth);\n    float column = mod(wrappedIndex.z, textureSliceWidth * inverseNoiseTextureRows);\n    float row = floor(wrappedIndex.z / textureSliceWidth * noiseTextureRows);\n\n    float xPixelCoord = wrappedIndex.x + column * textureSliceWidth;\n    float yPixelCoord = wrappedIndex.y + row * textureSliceWidth;\n    return vec2(xPixelCoord, yPixelCoord) * inverseNoiseTextureDimensions;\n}\n\n// Interpolate a voxel with its neighbor (along the positive X-axis)\nvec4 lerpSamplesX(vec3 voxelIndex, float x) {\n    vec2 uv0 = voxelToUV(voxelIndex);\n    vec2 uv1 = voxelToUV(voxelIndex + vec3(1.0, 0.0, 0.0));\n    vec4 sample0 = texture2D(u_noiseTexture, uv0);\n    vec4 sample1 = texture2D(u_noiseTexture, uv1);\n    return mix(sample0, sample1, x);\n}\n\nvec4 sampleNoiseTexture(vec3 position) {\n    vec3 recenteredPos = position + vec3(textureSliceWidth / 2.0);\n    vec3 lerpValue = fract(recenteredPos);\n    vec3 voxelIndex = floor(recenteredPos);\n\n    vec4 xLerp00 = lerpSamplesX(voxelIndex, lerpValue.x);\n    vec4 xLerp01 = lerpSamplesX(voxelIndex + vec3(0.0, 0.0, 1.0), lerpValue.x);\n    vec4 xLerp10 = lerpSamplesX(voxelIndex + vec3(0.0, 1.0, 0.0), lerpValue.x);\n    vec4 xLerp11 = lerpSamplesX(voxelIndex + vec3(0.0, 1.0, 1.0), lerpValue.x);\n\n    vec4 yLerp0 = mix(xLerp00, xLerp10, lerpValue.y);\n    vec4 yLerp1 = mix(xLerp01, xLerp11, lerpValue.y);\n    return mix(yLerp0, yLerp1, lerpValue.z);\n}\n\n// Intersection with a unit sphere with radius 0.5 at center (0, 0, 0).\nbool intersectSphere(vec3 origin, vec3 dir, float slice,\n                     out vec3 point, out vec3 normal) {\n    float A = dot(dir, dir);\n    float B = dot(origin, dir);\n    float C = dot(origin, origin) - 0.25;\n    float discriminant = (B * B) - (A * C);\n    if(discriminant < 0.0) {\n        return false;\n    }\n    float root = sqrt(discriminant);\n    float t = (-B - root) / A;\n    if(t < 0.0) {\n        t = (-B + root) / A;\n    }\n    point = origin + t * dir;\n\n    if(slice >= 0.0) {\n        point.z = (slice / 2.0) - 0.5;\n        if(length(point) > 0.5) {\n            return false;\n        }\n    }\n\n    normal = normalize(point);\n    point -= czm_epsilon2 * normal;\n    return true;\n}\n\n// Transforms the ray origin and direction into unit sphere space,\n// then transforms the result back into the ellipsoid's space.\nbool intersectEllipsoid(vec3 origin, vec3 dir, vec3 center, vec3 scale, float slice,\n                        out vec3 point, out vec3 normal) {\n    if(scale.x <= 0.01 || scale.y < 0.01 || scale.z < 0.01) {\n        return false;\n    }\n\n    vec3 o = (origin - center) / scale;\n    vec3 d = dir / scale;\n    vec3 p, n;\n    bool intersected = intersectSphere(o, d, slice, p, n);\n    if(intersected) {\n        point = (p * scale) + center;\n        normal = n;\n    }\n    return intersected;\n}\n\n// Assume that if phase shift is being called for octave i,\n// the frequency is of i - 1. This saves us from doing extra\n// division / multiplication operations.\nvec2 phaseShift2D(vec2 p, vec2 freq) {\n    return (czm_pi / 2.0) * sin(freq.yx * p.yx);\n}\n\nvec2 phaseShift3D(vec3 p, vec2 freq) {\n    return phaseShift2D(p.xy, freq) + czm_pi * vec2(sin(freq.x * p.z));\n}\n\n// The cloud texture function derived from Gardner's 1985 paper,\n// \"Visual Simulation of Clouds.\"\n// https://www.cs.drexel.edu/~david/Classes/Papers/p297-gardner.pdf\nconst float T0    = 0.6;  // contrast of the texture pattern\nconst float k     = 0.1;  // computed to produce a maximum value of 1\nconst float C0    = 0.8;  // coefficient\nconst float FX0   = 0.6;  // frequency X\nconst float FY0   = 0.6;  // frequency Y\nconst int octaves = 5;\n\nfloat T(vec3 point) {\n    vec2 sum = vec2(0.0);\n    float Ci = C0;\n    vec2 FXY = vec2(FX0, FY0);\n    vec2 PXY = vec2(0.0);\n    for(int i = 1; i <= octaves; i++) {\n        PXY = phaseShift3D(point, FXY);\n        Ci *= 0.707;\n        FXY *= 2.0;\n        vec2 sinTerm = sin(FXY * point.xy + PXY);\n        sum += Ci * sinTerm + vec2(T0);\n    }\n    return k * sum.x * sum.y;\n}\n\nconst float a = 0.5;  // fraction of surface reflection due to ambient or scattered light,\nconst float t = 0.4;  // fraction of texture shading\nconst float s = 0.25; // fraction of specular reflection\n\nfloat I(float Id, float Is, float It) {\n    return (1.0 - a) * ((1.0 - t) * ((1.0 - s) * Id + s * Is) + t * It) + a;\n}\n\nconst vec3 lightDir = normalize(vec3(0.2, -1.0, 0.7));\n\nvec4 drawCloud(vec3 rayOrigin, vec3 rayDir, vec3 cloudCenter, vec3 cloudScale, float cloudSlice,\n               float brightness) {\n    vec3 cloudPoint, cloudNormal;\n    if(!intersectEllipsoid(rayOrigin, rayDir, cloudCenter, cloudScale, cloudSlice,\n                            cloudPoint, cloudNormal)) {\n        return vec4(0.0);\n    }\n\n    float Id = clamp(dot(cloudNormal, -lightDir), 0.0, 1.0);  // diffuse reflection\n    float Is = max(pow(dot(-lightDir, -rayDir), 2.0), 0.0);   // specular reflection\n    float It = T(cloudPoint);                                 // texture function\n    float intensity = I(Id, Is, It);\n    vec3 color = vec3(intensity * clamp(brightness, 0.1, 1.0));\n\n    vec4 noise = sampleNoiseTexture(u_noiseDetail * cloudPoint);\n    float W = noise.x;\n    float W2 = noise.y;\n    float W3 = noise.z;\n\n    // The dot product between the cloud's normal and the ray's direction is greatest\n    // in the center of the ellipsoid's surface. It decreases towards the edge.\n    // Thus, it is used to blur the areas leading to the edges of the ellipsoid,\n    // so that no harsh lines appear.\n\n    // The first (and biggest) layer of worley noise is then subtracted from this.\n    // The final result is scaled up so that the base cloud is not too translucent.\n    float ndDot = clamp(dot(cloudNormal, -rayDir), 0.0, 1.0);\n    float TR = pow(ndDot, 3.0) - W; // translucency\n    TR *= 1.3;\n\n    // Subtracting the second and third layers of worley noise is more complicated.\n    // If these layers of noise were simply subtracted from the current translucency,\n    // the shape derived from the first layer of noise would be completely deleted.\n    // The erosion of this noise should thus be constricted to the edges of the cloud.\n    // However, because the edges of the ellipsoid were already blurred away, mapping\n    // the noise to (1.0 - ndDot) will have no impact on most of the cloud's appearance.\n    // The value of (0.5 - ndDot) provides the best compromise.\n    float minusDot = 0.5 - ndDot;\n\n    // Even with the previous calculation, subtracting the second layer of wnoise\n    // erode too much of the cloud. The addition of it, however, will detailed\n    // volume to the cloud. As long as the noise is only added and not subtracted,\n    // the results are aesthetically pleasing.\n\n    // The minusDot product is mapped in a way that it is larger at the edges of\n    // the ellipsoid, so a subtraction and min operation are used instead of\n    // an addition and max one.\n    TR -= min(minusDot * W2, 0.0);\n\n    // The third level of worley noise is subtracted from the result, with some\n    // modifications. First, a scalar is added to minusDot so that the noise\n    // starts affecting the shape farther away from the center of the ellipsoid's\n    // surface. Then, it is scaled down so its impact is not too intense.\n    TR -= 0.8 * (minusDot + 0.25) * W3;\n\n    // The texture function's shading does not correlate with the shape of the cloud\n    // produced by the layers of noise, so an extra shading scalar is calculated.\n    // The darkest areas of the cloud are assigned to be where the noise erodes\n    // the cloud the most. This is then interpolated based on the translucency\n    // and the diffuse shading term of that point in the cloud.\n    float shading = mix(1.0 - 0.8 * W * W, 1.0, Id * TR);\n\n    // To avoid values that are too dark, this scalar is increased by a small amount\n    // and clamped so it never goes to zero.\n    shading = clamp(shading + 0.2, 0.3, 1.0);\n\n    // Finally, the contrast of the cloud's color is increased.\n    vec3 finalColor = mix(vec3(0.5), shading * color, 1.15);\n    return vec4(finalColor, clamp(TR, 0.0, 1.0)) * v_color;\n}\n\nvoid main() {\n#ifdef DEBUG_BILLBOARDS\n    gl_FragColor = vec4(0.0, 0.5, 0.5, 1.0);\n#endif\n    // To avoid calculations with high values,\n    // we raycast from an arbitrarily smaller space.\n    vec2 coordinate = v_maximumSize.xy * v_offset;\n\n    vec3 ellipsoidScale = 0.82 * v_maximumSize;\n    vec3 ellipsoidCenter = vec3(0.0);\n\n    float zOffset = max(ellipsoidScale.z - 10.0, 0.0);\n    vec3 eye = vec3(0, 0, -10.0 - zOffset);\n    vec3 rayDir = normalize(vec3(coordinate, 1.0) - eye);\n    vec3 rayOrigin = eye;\n#ifdef DEBUG_ELLIPSOIDS\n    vec3 point, normal;\n    if(intersectEllipsoid(rayOrigin, rayDir, ellipsoidCenter, ellipsoidScale, v_slice,\n                          point, normal)) {\n        gl_FragColor = v_brightness * v_color;\n    }\n#else\n#ifndef DEBUG_BILLBOARDS\n    vec4 cloud = drawCloud(rayOrigin, rayDir,\n                           ellipsoidCenter, ellipsoidScale, v_slice, v_brightness);\n    if(cloud.w < 0.01) {\n        discard;\n    }\n    gl_FragColor = cloud;\n#endif\n#endif\n}\n",ZYe="#ifdef INSTANCED\nattribute vec2 direction;\n#endif\nattribute vec4 positionHighAndScaleX;\nattribute vec4 positionLowAndScaleY;\nattribute vec4 packedAttribute0;\nattribute vec4 packedAttribute1;\nattribute vec4 color;\n\nvarying vec2 v_offset;\nvarying vec3 v_maximumSize;\nvarying vec4 v_color;\nvarying float v_slice;\nvarying float v_brightness;\n\nvoid main() {\n    // Unpack attributes.\n    vec3 positionHigh = positionHighAndScaleX.xyz;\n    vec3 positionLow = positionLowAndScaleY.xyz;\n    vec2 scale = vec2(positionHighAndScaleX.w, positionLowAndScaleY.w);\n\n    float show = packedAttribute0.x;\n    float brightness = packedAttribute0.y;\n    vec2 coordinates = packedAttribute0.wz;\n    vec3 maximumSize = packedAttribute1.xyz;\n    float slice = packedAttribute1.w;\n\n#ifdef INSTANCED\n    vec2 dir = direction;\n#else\n    vec2 dir = coordinates;\n#endif\n\n    vec2 offset = dir - vec2(0.5, 0.5);\n    vec2 scaledOffset = scale * offset;\n    vec4 p = czm_translateRelativeToEye(positionHigh, positionLow);\n    vec4 positionEC = czm_modelViewRelativeToEye * p;\n    positionEC.xy += scaledOffset;\n    \n    positionEC.xyz *= show;\n    gl_Position = czm_projection * positionEC;\n\n    v_offset = offset;\n    v_maximumSize = maximumSize;\n    v_color = color;\n    v_slice = slice;\n    v_brightness = brightness;\n}\n",$Ye="uniform vec3 u_noiseTextureDimensions;\nuniform float u_noiseDetail;\nuniform vec3 u_noiseOffset;\nvarying vec2 v_position;\n\nfloat textureSliceWidth = u_noiseTextureDimensions.x;\nfloat inverseNoiseTextureRows = u_noiseTextureDimensions.z;\n\nfloat wrap(float value, float rangeLength) {\n    if(value < 0.0) {\n        float absValue = abs(value);\n        float modValue = mod(absValue, rangeLength);\n        return mod(rangeLength - modValue, rangeLength);\n    }\n    return mod(value, rangeLength);\n}\n\nvec3 wrapVec(vec3 value, float rangeLength) {\n    return vec3(wrap(value.x, rangeLength),\n                wrap(value.y, rangeLength),\n                wrap(value.z, rangeLength));\n}\n\nvec3 random3(vec3 p) {\n    float dot1 = dot(p, vec3(127.1, 311.7, 932.8));\n    float dot2 = dot(p, vec3(269.5, 183.3, 421.4));\n    return fract(vec3(sin(dot1 - dot2), cos(dot1 * dot2), dot1 * dot2));\n}\n\n// Frequency corresponds to cell size.\n// The higher the frequency, the smaller the cell size.\nvec3 getWorleyCellPoint(vec3 centerCell, vec3 offset, float freq) {\n    vec3 cell = centerCell + offset;\n    cell = wrapVec(cell, textureSliceWidth / u_noiseDetail);\n    cell += floor(u_noiseOffset / u_noiseDetail);\n    vec3 p = offset + random3(cell);\n    return p;\n}\n\nfloat worleyNoise(vec3 p, float freq) {\n    vec3 centerCell = floor(p * freq);\n    vec3 pointInCell = fract(p * freq);\n    float shortestDistance = 1000.0;\n\n    for(float z = -1.0; z <= 1.0; z++) {\n        for(float y = -1.0; y <= 1.0; y++) {\n            for(float x = -1.0; x <= 1.0; x++) {\n                vec3 offset = vec3(x, y, z);\n                vec3 point = getWorleyCellPoint(centerCell, offset, freq);\n\n                float distance = length(pointInCell - point);\n                if(distance < shortestDistance) {\n                    shortestDistance = distance;\n                }\n            }\n        }\n    }\n\n    return shortestDistance;\n}\n\nconst float MAX_FBM_ITERATIONS = 10.0;\n\nfloat worleyFBMNoise(vec3 p, float octaves, float scale) {\n    float noise = 0.0;\n    float freq = 1.0;\n    float persistence = 0.625;\n    for(float i = 0.0; i < MAX_FBM_ITERATIONS; i++) {\n        if(i >= octaves) {\n            break;\n        }\n\n        noise += worleyNoise(p * scale, freq * scale) * persistence;\n        persistence *= 0.5;\n        freq *= 2.0;\n    }\n    return noise;\n}\n\nvoid main() {\n    float x = mod(v_position.x, textureSliceWidth);\n    float y = mod(v_position.y, textureSliceWidth);\n    float sliceRow = floor(v_position.y / textureSliceWidth);\n    float z = floor(v_position.x / textureSliceWidth) + sliceRow * inverseNoiseTextureRows * textureSliceWidth;\n\n    vec3 position = vec3(x, y, z);\n    position /= u_noiseDetail;\n    float worley0 = clamp(worleyFBMNoise(position, 3.0, 1.0), 0.0, 1.0);\n    float worley1 = clamp(worleyFBMNoise(position, 3.0, 2.0), 0.0, 1.0);\n    float worley2 = clamp(worleyFBMNoise(position, 3.0, 3.0), 0.0, 1.0);\n    gl_FragColor = vec4(worley0, worley1, worley2, 1.0);\n}\n",eKe="uniform vec3 u_noiseTextureDimensions;\nattribute vec2 position;\n\nvarying vec2 v_position;\n\nvoid main()\n{\n    gl_Position = vec4(position, 0.1, 1.0);\n\n    float textureSliceWidth = u_noiseTextureDimensions.x;\n    float noiseTextureRows = u_noiseTextureDimensions.y;\n    float inverseNoiseTextureRows = u_noiseTextureDimensions.z;\n    vec2 transformedPos = (position * 0.5) + vec2(0.5);\n    transformedPos *= textureSliceWidth;\n    transformedPos.x *= textureSliceWidth * inverseNoiseTextureRows;\n    transformedPos.y *= noiseTextureRows;\n    v_position = transformedPos;\n}\n";function tKe(e,t){if(e=R(e,R.EMPTY_OBJECT),this._show=R(e.show,!0),this._position=K.clone(R(e.position,K.ZERO)),!C(e.scale)&&C(e.maximumSize))this._maximumSize=K.clone(e.maximumSize),this._scale=new ro(this._maximumSize.x,this._maximumSize.y);else{this._scale=ro.clone(R(e.scale,new ro(20,12)));const t=new K(this._scale.x,this._scale.y,Math.min(this._scale.x,this._scale.y)/1.5);this._maximumSize=K.clone(R(e.maximumSize,t))}this._slice=R(e.slice,-1),this._color=xy.clone(R(e.color,xy.WHITE)),this._brightness=R(e.brightness,1),this._cloudCollection=t,this._index=-1}const nKe=tKe.SHOW_INDEX=0,iKe=tKe.POSITION_INDEX=1,oKe=tKe.SCALE_INDEX=2,rKe=tKe.MAXIMUM_SIZE_INDEX=3,sKe=tKe.SLICE_INDEX=4,aKe=tKe.BRIGHTNESS_INDEX=5,cKe=tKe.COLOR_INDEX=6;function lKe(e,t){const n=e._cloudCollection;C(n)&&(n._updateCloud(e,t),e._dirty=!0)}tKe.NUMBER_OF_PROPERTIES=7,Object.defineProperties(tKe.prototype,{show:{get:function(){return this._show},set:function(e){D.typeOf.bool("value",e),this._show!==e&&(this._show=e,lKe(this,nKe))}},position:{get:function(){return this._position},set:function(e){D.typeOf.object("value",e);const t=this._position;K.equals(t,e)||(K.clone(e,t),lKe(this,iKe))}},scale:{get:function(){return this._scale},set:function(e){D.typeOf.object("value",e);const t=this._scale;ro.equals(t,e)||(ro.clone(e,t),lKe(this,oKe))}},maximumSize:{get:function(){return this._maximumSize},set:function(e){D.typeOf.object("value",e);const t=this._maximumSize;K.equals(t,e)||(K.clone(e,t),lKe(this,rKe))}},color:{get:function(){return this._color},set:function(e){D.typeOf.object("value",e);const t=this._color;xy.equals(t,e)||(xy.clone(e,t),lKe(this,cKe))}},slice:{get:function(){return this._slice},set:function(e){D.typeOf.number("value",e);const t=this._slice;t!==e&&(this._slice=e,lKe(this,sKe))}},brightness:{get:function(){return this._brightness},set:function(e){D.typeOf.number("value",e);const t=this._brightness;t!==e&&(this._brightness=e,lKe(this,aKe))}}}),tKe.prototype._destroy=function(){this._cloudCollection=void 0};var uKe=tKe;let hKe;const dKe=new K,fKe={positionHighAndScaleX:0,positionLowAndScaleY:1,packedAttribute0:2,packedAttribute1:3,color:4},pKe={direction:0,positionHighAndScaleX:1,positionLowAndScaleY:2,packedAttribute0:3,packedAttribute1:4,color:5},mKe=uKe.SHOW_INDEX,_Ke=uKe.POSITION_INDEX,gKe=uKe.SCALE_INDEX,yKe=uKe.MAXIMUM_SIZE_INDEX,vKe=uKe.SLICE_INDEX,bKe=uKe.BRIGHTNESS_INDEX,AKe=uKe.NUMBER_OF_PROPERTIES,wKe=uKe.COLOR_INDEX;function TKe(e){e=R(e,R.EMPTY_OBJECT),this._clouds=[],this._cloudsToUpdate=[],this._cloudsToUpdateIndex=0,this._cloudsRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(AKe),this._noiseTexture=void 0,this._textureSliceWidth=128,this._noiseTextureRows=4,this.noiseDetail=R(e.noiseDetail,16),this.noiseOffset=K.clone(R(e.noiseOffset,K.ZERO)),this._loading=!1,this._ready=!1;const t=this;this._uniforms={u_noiseTexture:function(){return t._noiseTexture},u_noiseTextureDimensions:CKe(t),u_noiseDetail:function(){return t.noiseDetail}},this._vaNoise=void 0,this._spNoise=void 0,this._spCreated=!1,this._sp=void 0,this._rs=void 0,this.show=R(e.show,!0),this._colorCommands=[],this.debugBillboards=R(e.debugBillboards,!1),this._compiledDebugBillboards=!1,this.debugEllipsoids=R(e.debugEllipsoids,!1),this._compiledDebugEllipsoids=!1}function CKe(e){return function(){return dKe.x=e._textureSliceWidth,dKe.y=e._noiseTextureRows,dKe.z=1/e._noiseTextureRows,dKe}}function EKe(e){const t=e.length;for(let n=0;n<t;++n)e[n]&&e[n]._destroy()}function xKe(e){if(e._cloudsRemoved){e._cloudsRemoved=!1;const t=[],n=e._clouds,i=n.length;for(let e=0,o=0;e<i;++e){const i=n[e];C(i)&&(n._index=o++,t.push(i))}e._clouds=t}}Object.defineProperties(TKe.prototype,{length:{get:function(){return xKe(this),this._clouds.length}}}),TKe.prototype.add=function(e){e=R(e,R.EMPTY_OBJECT);const t=R(e.cloudType,QYe.CUMULUS);if(!QYe.validate(t))throw new x("invalid cloud type");let n;return t===QYe.CUMULUS&&(n=new uKe(e,this),n._index=this._clouds.length,this._clouds.push(n),this._createVertexArray=!0),n},TKe.prototype.remove=function(e){return!!this.contains(e)&&(this._clouds[e._index]=void 0,this._cloudsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0)},TKe.prototype.removeAll=function(){EKe(this._clouds),this._clouds=[],this._cloudsToUpdate=[],this._cloudsToUpdateIndex=0,this._cloudsRemoved=!1,this._createVertexArray=!0},TKe.prototype._updateCloud=function(e,t){e._dirty||(this._cloudsToUpdate[this._cloudsToUpdateIndex++]=e),++this._propertiesChanged[t]},TKe.prototype.contains=function(e){return C(e)&&e._cloudCollection===this},TKe.prototype.get=function(e){return D.typeOf.number("index",e),xKe(this),this._clouds[e]};const SKe=new Float32Array([-1,-1,1,-1,1,1,-1,1]),IKe=new Uint16Array([0,1,2,0,2,3]);function OKe(e){const t=hq.createVertexBuffer({context:e,typedArray:SKe,usage:lq.STATIC_DRAW}),n=hq.createIndexBuffer({context:e,typedArray:IKe,usage:lq.STATIC_DRAW,indexDatatype:fd.UNSIGNED_SHORT}),i=[{index:0,vertexBuffer:t,componentsPerAttribute:2,componentDatatype:ih.FLOAT}];return new bq({context:e,attributes:i,indexBuffer:n})}let DKe;function PKe(e){const t=16384;let n=e.cache.cloudCollection_indexBufferBatched;if(C(n))return n;const i=6*t-6,o=new Uint16Array(i);for(let r=0,s=0;r<i;r+=6,s+=4)o[r]=s,o[r+1]=s+1,o[r+2]=s+2,o[r+3]=s,o[r+4]=s+2,o[r+5]=s+3;return n=hq.createIndexBuffer({context:e,typedArray:o,usage:lq.STATIC_DRAW,indexDatatype:fd.UNSIGNED_SHORT}),n.vertexArrayDestroyable=!1,e.cache.cloudCollection_indexBufferBatched=n,n}function RKe(e){let t=e.cache.cloudCollection_indexBufferInstanced;return C(t)||(t=hq.createIndexBuffer({context:e,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:lq.STATIC_DRAW,indexDatatype:fd.UNSIGNED_SHORT}),t.vertexArrayDestroyable=!1,e.cache.cloudCollection_indexBufferInstanced=t),t}function LKe(e){let t=e.cache.cloudCollection_vertexBufferInstanced;return C(t)||(t=hq.createVertexBuffer({context:e,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:lq.STATIC_DRAW}),t.vertexArrayDestroyable=!1,e.cache.cloudCollection_vertexBufferInstanced=t),t}function MKe(e,t,n){const i=[{index:hKe.positionHighAndScaleX,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:lq.STATIC_DRAW},{index:hKe.positionLowAndScaleY,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:lq.STATIC_DRAW},{index:hKe.packedAttribute0,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:lq.STATIC_DRAW},{index:hKe.packedAttribute1,componentsPerAttribute:4,componentDatatype:ih.FLOAT,usage:lq.STATIC_DRAW},{index:hKe.color,componentsPerAttribute:4,componentDatatype:ih.UNSIGNED_BYTE,normalize:!0,usage:lq.STATIC_DRAW}];n&&i.push({index:hKe.direction,componentsPerAttribute:2,componentDatatype:ih.FLOAT,vertexBuffer:LKe(e)});const o=n?t:4*t;return new $ie(e,i,o,n)}const BKe=new Nm;function NKe(e,t,n,i){let o;const r=n[hKe.positionHighAndScaleX],s=n[hKe.positionLowAndScaleY],a=i.position;Nm.fromCartesian(a,BKe);const c=i.scale,l=BKe.high,u=BKe.low;e._instanced?(o=i._index,r(o,l.x,l.y,l.z,c.x),s(o,u.x,u.y,u.z,c.y)):(o=4*i._index,r(o+0,l.x,l.y,l.z,c.x),r(o+1,l.x,l.y,l.z,c.x),r(o+2,l.x,l.y,l.z,c.x),r(o+3,l.x,l.y,l.z,c.x),s(o+0,u.x,u.y,u.z,c.y),s(o+1,u.x,u.y,u.z,c.y),s(o+2,u.x,u.y,u.z,c.y),s(o+3,u.x,u.y,u.z,c.y))}function FKe(e,t,n,i){let o;const r=n[hKe.packedAttribute0],s=i.show,a=i.brightness;e._instanced?(o=i._index,r(o,s,a,0,0)):(o=4*i._index,r(o+0,s,a,0,0),r(o+1,s,a,1,0),r(o+2,s,a,1,1),r(o+3,s,a,0,1))}function zKe(e,t,n,i){let o;const r=n[hKe.packedAttribute1],s=i.maximumSize,a=i.slice;e._instanced?(o=i._index,r(o,s.x,s.y,s.z,a)):(o=4*i._index,r(o+0,s.x,s.y,s.z,a),r(o+1,s.x,s.y,s.z,a),r(o+2,s.x,s.y,s.z,a),r(o+3,s.x,s.y,s.z,a))}function kKe(e,t,n,i){let o;const r=n[hKe.color],s=i.color,a=xy.floatToByte(s.red),c=xy.floatToByte(s.green),l=xy.floatToByte(s.blue),u=xy.floatToByte(s.alpha);e._instanced?(o=i._index,r(o,a,c,l,u)):(o=4*i._index,r(o+0,a,c,l,u),r(o+1,a,c,l,u),r(o+2,a,c,l,u),r(o+3,a,c,l,u))}function UKe(e,t,n,i){NKe(e,t,n,i),FKe(e,t,n,i),zKe(e,t,n,i),kKe(e,t,n,i)}function VKe(e,t,n,i){const o=e,r=o._textureSliceWidth,s=o._noiseTextureRows;if(r/s<1||r%s!==0)throw new x("noiseTextureRows must evenly divide textureSliceWidth");const a=t.context;o._vaNoise=OKe(a),o._spNoise=fH.fromCache({context:a,vertexShaderSource:n,fragmentShaderSource:i,attributeLocations:{position:0}});const c=o.noiseDetail,l=o.noiseOffset;o._noiseTexture=new Uk({context:a,width:r*r/s,height:r*s,pixelDatatype:hD.UNSIGNED_BYTE,pixelFormat:fD.RGBA,sampler:new Nk({wrapS:Mk.REPEAT,wrapT:Mk.REPEAT,minificationFilter:Rk.NEAREST,magnificationFilter:Dk.NEAREST})});const u=new PQ({vertexArray:o._vaNoise,shaderProgram:o._spNoise,outputTexture:o._noiseTexture,uniformMap:{u_noiseTextureDimensions:CKe(o),u_noiseDetail:function(){return c},u_noiseOffset:function(){return l}},persists:!1,owner:e,postExecute:function(e){o._ready=!0,o._loading=!1}});t.commandList.push(u),o._loading=!0}function HKe(e,t){const n=e,i=t.context;n._createVertexArray=!1,n._vaf=n._vaf&&n._vaf.destroy();const o=e._clouds,r=o.length;if(r>0){n._vaf=MKe(i,r,n._instanced);const s=n._vaf.writers;let a;for(a=0;a<r;++a){const n=o[a];UKe(e,t,s,n)}n._vaf.commit(DKe(i))}}const GKe=[];function WKe(e,t){const n=t.context,i=e,o=i._clouds,r=o.length,s=i._cloudsToUpdate,a=i._cloudsToUpdateIndex,c=i._propertiesChanged,l=GKe;l.length=0,(c[_Ke]||c[gKe])&&l.push(NKe),(c[mKe]||c[bKe])&&l.push(FKe),(c[yKe]||c[vKe])&&l.push(zKe),c[wKe]&&l.push(kKe);const u=l.length,h=i._vaf.writers;let d,f,p;if(a/r>.1){for(d=0;d<a;++d)for(f=s[d],f._dirty=!1,p=0;p<u;++p)l[p](e,t,h,f);i._vaf.commit(DKe(n))}else{for(d=0;d<a;++d){for(f=s[d],f._dirty=!1,p=0;p<u;++p)l[p](e,t,h,f);i._instanced?i._vaf.subCommit(f._index,1):i._vaf.subCommit(4*f._index,4)}i._vaf.endSubCommits()}i._cloudsToUpdateIndex=0}function qKe(e,t,n,i){const o=t.context,r=e,s=new tq({defines:[],sources:[n]});r._instanced&&s.defines.push("INSTANCED");const a=new tq({defines:[],sources:[i]});r.debugBillboards&&a.defines.push("DEBUG_BILLBOARDS"),r.debugEllipsoids&&a.defines.push("DEBUG_ELLIPSOIDS"),r._sp=fH.replaceCache({context:o,shaderProgram:r._sp,vertexShaderSource:s,fragmentShaderSource:a,attributeLocations:hKe}),r._rs=yV.fromCache({depthTest:{enabled:!0,func:th.LESS},depthMask:!1,blending:_k.ALPHA_BLEND}),r._spCreated=!0,r._compiledDebugBillboards=r.debugBillboards,r._compiledDebugEllipsoids=r.debugEllipsoids}function jKe(e,t){const n=e,i=t.passes,o=n._uniforms,r=t.commandList;if(i.render){const t=n._colorCommands,i=n._vaf.va,s=i.length;t.length=s;for(let a=0;a<s;a++){let s=t[a];C(s)||(s=t[a]=new UU),s.pass=HU.TRANSLUCENT,s.owner=e,s.uniformMap=o,s.count=i[a].indicesCount,s.vertexArray=i[a].va,s.shaderProgram=n._sp,s.renderState=n._rs,n._instanced&&(s.count=6,s.instanceCount=n._clouds.length),r.push(s)}}}TKe.prototype.update=function(e){if(xKe(this),!this.show)return;const t=this.debugBillboards||this.debugEllipsoids;this._ready=!!t||C(this._noiseTexture),this._ready||this._loading||t||VKe(this,e,eKe,$Ye),this._instanced=e.context.instancedArrays,hKe=this._instanced?pKe:fKe,DKe=this._instanced?RKe:PKe;const n=this._clouds,i=n.length,o=this._cloudsToUpdate,r=this._cloudsToUpdateIndex;this._createVertexArray?HKe(this,e):r>0&&WKe(this,e),r>1.5*i&&(o.length=i),!C(this._vaf)||!C(this._vaf.va)||!this._ready&!t||(this._spCreated&&this.debugBillboards===this._compiledDebugBillboards&&this.debugEllipsoids===this._compiledDebugEllipsoids||qKe(this,e,ZYe,JYe),jKe(this,e))},TKe.prototype.isDestroyed=function(){return!1},TKe.prototype.destroy=function(){return this._noiseTexture=this._noiseTexture&&this._noiseTexture.destroy(),this._sp=this._sp&&this._sp.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),EKe(this._clouds),Qh(this)};const YKe=z.toRadians(30);function KKe(e){this._angle=R(e,YKe)}Object.defineProperties(KKe.prototype,{angle:{get:function(){return this._angle},set:function(e){D.typeOf.number("value",e),this._angle=e}}}),KKe.prototype.emit=function(e){const t=Math.tan(this._angle),n=z.randomBetween(0,z.TWO_PI),i=z.randomBetween(0,t),o=i*Math.cos(n),r=i*Math.sin(n),s=1;e.velocity=K.fromElements(o,r,s,e.velocity),K.normalize(e.velocity,e.velocity),e.position=K.clone(K.ZERO,e.position)};const XKe=576,QKe=100,JKe="#ffffff",ZKe="#48b";function $Ke(e,t){this.credit=e,this.count=R(t,1)}function eXe(e,t){const n=e.length;for(let i=0;i<n;i++){const n=e[i];if(Tr.equals(n,t))return!0}return!1}function tXe(e){const t=e._previousCesiumCredit,n=e._currentCesiumCredit;Tr.equals(n,t)||(C(t)&&e._cesiumCreditContainer.removeChild(t.element),C(n)&&e._cesiumCreditContainer.appendChild(n.element),e._previousCesiumCredit=n)}const nXe="cesium-credit-delimiter";function iXe(e){const t=document.createElement("span");return t.textContent=e,t.className=nXe,t}function oXe(e,t){if(C(t)){const n=document.createElement(t);n._creditId=e._creditId,n.appendChild(e),e=n}return e}function rXe(e,t,n,i){const o=e.childNodes;let r=-1;t.sort((function(e,t){return t.count-e.count}));for(let s=0;s<t.length;++s){const a=t[s].credit;if(C(a)){if(r=s,C(n)&&(r*=2,s>0)){const t=r-1;if(o.length<=t)e.appendChild(iXe(n));else{const i=o[t];i.className!==nXe&&e.replaceChild(iXe(n),i)}}const t=a.element;if(o.length<=r)e.appendChild(oXe(t,i));else{const n=o[r];n._creditId!==a._id&&e.replaceChild(oXe(t,i),n)}}}++r;while(r<o.length)e.removeChild(o[r])}function sXe(e){const t=e._lightboxCredits,n=e.viewport.clientWidth,i=e.viewport.clientHeight;n!==e._lastViewportWidth&&(n<XKe?(t.className="cesium-credit-lightbox cesium-credit-lightbox-mobile",t.style.marginTop="0"):(t.className="cesium-credit-lightbox cesium-credit-lightbox-expanded",t.style.marginTop=`${Math.floor(.5*(i-t.clientHeight))}px`),e._lastViewportWidth=n),n>=XKe&&i!==e._lastViewportHeight&&(t.style.marginTop=`${Math.floor(.5*(i-t.clientHeight))}px`,e._lastViewportHeight=i)}function aXe(e,t){let n=`${e} {`;for(const i in t)t.hasOwnProperty(i)&&(n+=`${i}: ${t[i]}; `);return n+=" }\n",n}function cXe(){let e="";e+=aXe(".cesium-credit-lightbox-overlay",{display:"none","z-index":"1",position:"absolute",top:"0",left:"0",width:"100%",height:"100%","background-color":"rgba(80, 80, 80, 0.8)"}),e+=aXe(".cesium-credit-lightbox",{"background-color":"#303336",color:JKe,position:"relative","min-height":`${QKe}px`,margin:"auto"}),e+=aXe(".cesium-credit-lightbox > ul > li a, .cesium-credit-lightbox > ul > li a:visited",{color:JKe}),e+=aXe(".cesium-credit-lightbox > ul > li a:hover",{color:ZKe}),e+=aXe(".cesium-credit-lightbox.cesium-credit-lightbox-expanded",{border:"1px solid #444","border-radius":"5px","max-width":"370px"}),e+=aXe(".cesium-credit-lightbox.cesium-credit-lightbox-mobile",{height:"100%",width:"100%"}),e+=aXe(".cesium-credit-lightbox-title",{padding:"20px 20px 0 20px"}),e+=aXe(".cesium-credit-lightbox-close",{"font-size":"18pt",cursor:"pointer",position:"absolute",top:"0",right:"6px",color:JKe}),e+=aXe(".cesium-credit-lightbox-close:hover",{color:ZKe}),e+=aXe(".cesium-credit-lightbox > ul",{margin:"0",padding:"12px 20px 12px 40px","font-size":"13px"}),e+=aXe(".cesium-credit-lightbox > ul > li",{"padding-bottom":"6px"}),e+=aXe(".cesium-credit-lightbox > ul > li *",{padding:"0",margin:"0"}),e+=aXe(".cesium-credit-expand-link",{"padding-left":"5px",cursor:"pointer","text-decoration":"underline",color:JKe}),e+=aXe(".cesium-credit-expand-link:hover",{color:ZKe}),e+=aXe(".cesium-credit-text",{color:JKe}),e+=aXe(".cesium-credit-textContainer *, .cesium-credit-logoContainer *",{display:"inline"});const t=document.head,n=document.createElement("style");n.innerHTML=e,t.insertBefore(n,t.firstChild)}function lXe(e,t,n){D.defined("container",e);const i=this;n=R(n,document.body);const o=document.createElement("div");o.className="cesium-credit-lightbox-overlay",n.appendChild(o);const r=document.createElement("div");function s(e){r.contains(e.target)||i.hideLightbox()}r.className="cesium-credit-lightbox",o.appendChild(r),o.addEventListener("click",s,!1);const a=document.createElement("div");a.className="cesium-credit-lightbox-title",a.textContent="Data provided by:",r.appendChild(a);const c=document.createElement("a");c.onclick=this.hideLightbox.bind(this),c.innerHTML="&times;",c.className="cesium-credit-lightbox-close",r.appendChild(c);const l=document.createElement("ul");r.appendChild(l);const u=document.createElement("div");u.className="cesium-credit-logoContainer",u.style.display="inline",e.appendChild(u);const h=document.createElement("div");h.className="cesium-credit-textContainer",h.style.display="inline",e.appendChild(h);const d=document.createElement("a");d.className="cesium-credit-expand-link",d.onclick=this.showLightbox.bind(this),d.textContent="Data attribution",e.appendChild(d),cXe();const f=Tr.clone(lXe.cesiumCredit);this._delimiter=R(t," • "),this._screenContainer=h,this._cesiumCreditContainer=u,this._lastViewportHeight=void 0,this._lastViewportWidth=void 0,this._lightboxCredits=r,this._creditList=l,this._lightbox=o,this._hideLightbox=s,this._expandLink=d,this._expanded=!1,this._defaultCredits=[],this._cesiumCredit=f,this._previousCesiumCredit=void 0,this._currentCesiumCredit=f,this._creditDisplayElementPool=[],this._creditDisplayElementIndex=0,this._currentFrameCredits={screenCredits:new ff,lightboxCredits:new ff},this._defaultCredit=void 0,this.viewport=n,this.container=e}function uXe(e,t,n,i){i=R(i,1);let o=t.get(n.id);if(C(o))o.count<Number.MAX_VALUE&&(o.count+=i);else{const r=e._creditDisplayElementPool,s=e._creditDisplayElementPoolIndex;s<r.length?(o=r[s],o.credit=n,o.count=i):(o=new $Ke(n,i),r.push(o)),++e._creditDisplayElementPoolIndex,t.set(n.id,o)}}let hXe;function dXe(){if(!C(hXe)){let e=Zi("Assets/Images/ion-credit.png");if(0!==e.indexOf("http://")&&0!==e.indexOf("https://")&&0!==e.indexOf("data:")){const t=new cn(e);e=t.path()}hXe=new Tr(`<a href="https://cesium.com/" target="_blank"><img src="${e}" title="Cesium ion"/></a>`,!0)}return lXe._cesiumCreditInitialized||(lXe._cesiumCredit=hXe,lXe._cesiumCreditInitialized=!0),hXe}lXe.prototype.addCredit=function(e){if(D.defined("credit",e),e._isIon)return C(this._defaultCredit)||(this._defaultCredit=Tr.clone(dXe())),void(this._currentCesiumCredit=this._defaultCredit);let t;t=e.showOnScreen?this._currentFrameCredits.screenCredits:this._currentFrameCredits.lightboxCredits,uXe(this,t,e)},lXe.prototype.addDefaultCredit=function(e){D.defined("credit",e);const t=this._defaultCredits;eXe(t,e)||t.push(e)},lXe.prototype.removeDefaultCredit=function(e){D.defined("credit",e);const t=this._defaultCredits,n=t.indexOf(e);-1!==n&&t.splice(n,1)},lXe.prototype.showLightbox=function(){this._lightbox.style.display="block",this._expanded=!0},lXe.prototype.hideLightbox=function(){this._lightbox.style.display="none",this._expanded=!1},lXe.prototype.update=function(){this._expanded&&sXe(this)},lXe.prototype.beginFrame=function(){const e=this._currentFrameCredits;this._creditDisplayElementPoolIndex=0;const t=e.screenCredits;t.removeAll();const n=this._defaultCredits;for(let i=0;i<n.length;++i){const e=n[i];uXe(this,t,e,Number.MAX_VALUE)}e.lightboxCredits.removeAll(),Tr.equals(lXe.cesiumCredit,this._cesiumCredit)||(this._cesiumCredit=Tr.clone(lXe.cesiumCredit)),this._currentCesiumCredit=this._cesiumCredit},lXe.prototype.endFrame=function(){const e=this._currentFrameCredits.screenCredits.values;rXe(this._screenContainer,e,this._delimiter,void 0);const t=this._currentFrameCredits.lightboxCredits.values;this._expandLink.style.display=t.length>0?"inline":"none",rXe(this._creditList,t,void 0,"li"),tXe(this)},lXe.prototype.destroy=function(){return this._lightbox.removeEventListener("click",this._hideLightbox,!1),this.container.removeChild(this._cesiumCreditContainer),this.container.removeChild(this._screenContainer),this.container.removeChild(this._expandLink),this.viewport.removeChild(this._lightbox),Qh(this)},lXe.prototype.isDestroyed=function(){return!1},lXe._cesiumCredit=void 0,lXe._cesiumCreditInitialized=!1,Object.defineProperties(lXe,{cesiumCredit:{get:function(){return dXe(),lXe._cesiumCredit},set:function(e){lXe._cesiumCredit=e,lXe._cesiumCreditInitialized=!0}}}),lXe.CreditDisplayElement=$Ke;var fXe=lXe;function pXe(e){e=R(e,R.EMPTY_OBJECT);const t=e.attributeName;let n=e.perInstanceAttribute;if(!C(t))throw new x("options.attributeName is required.");C(n)||(n=!1);let i=R(e.glslDatatype,"vec3");const o=`v_${t}`;let r;if("normal"===t||"tangent"===t||"bitangent"===t)r=`vec4 getColor() { return vec4((${o} + vec3(1.0)) * 0.5, 1.0); }\n`;else switch("st"===t&&(i="vec2"),i){case"float":r=`vec4 getColor() { return vec4(vec3(${o}), 1.0); }\n`;break;case"vec2":r=`vec4 getColor() { return vec4(${o}, 0.0, 1.0); }\n`;break;case"vec3":r=`vec4 getColor() { return vec4(${o}, 1.0); }\n`;break;case"vec4":r=`vec4 getColor() { return ${o}; }\n`;break;default:throw new x("options.glslDatatype must be float, vec2, vec3, or vec4.")}const s=`attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute float batchId;\n${n?"":`attribute ${i} ${t};\n`}varying ${i} ${o};\nvoid main()\n{\nvec4 p = czm_translateRelativeToEye(position3DHigh, position3DLow);\n${n?`${o} = czm_batchTable_${t}(batchId);\n`:`${o} = ${t};\n`}gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}`,a=`varying ${i} ${o};\n${r}\nvoid main()\n{\ngl_FragColor = getColor();\n}`;this.material=void 0,this.translucent=R(e.translucent,!1),this._vertexShaderSource=R(e.vertexShaderSource,s),this._fragmentShaderSource=R(e.fragmentShaderSource,a),this._renderState=bk.getDefaultRenderState(!1,!1,e.renderState),this._closed=R(e.closed,!1),this._attributeName=t,this._glslDatatype=i}Object.defineProperties(pXe.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},attributeName:{get:function(){return this._attributeName}},glslDatatype:{get:function(){return this._glslDatatype}}}),pXe.prototype.getFragmentShaderSource=bk.prototype.getFragmentShaderSource,pXe.prototype.isTranslucent=bk.prototype.isTranslucent,pXe.prototype.getRenderState=bk.prototype.getRenderState;function mXe(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.camera))throw new x("options.camera is required.");this._camera=e.camera,this._frustumSplits=e.frustumSplits,this._color=R(e.color,xy.CYAN),this._updateOnChange=R(e.updateOnChange,!0),this.show=R(e.show,!0),this.id=e.id,this._id=void 0,this._outlinePrimitives=[],this._planesPrimitives=[]}const _Xe=new K,gXe=new ke,yXe=new il,vXe=new nE,bXe=new $C,AXe=new jC,wXe=new GC,TXe=new xy,CXe=[1,1e5];mXe.prototype.update=function(e){if(!this.show)return;const t=this._planesPrimitives,n=this._outlinePrimitives;let i,o;if(this._updateOnChange){for(o=t.length,i=0;i<o;++i)n[i]=n[i]&&n[i].destroy(),t[i]=t[i]&&t[i].destroy();t.length=0,n.length=0}if(0===t.length){const e=this._camera,o=e.frustum;let r,s;r=o instanceof nE?vXe:o instanceof $C?bXe:o instanceof jC?AXe:wXe,r=o.clone(r);let a=this._frustumSplits;!C(a)||a.length<=1?(a=CXe,a[0]=this._camera.frustum.near,a[1]=this._camera.frustum.far,s=1):s=a.length-1;const c=e.positionWC,l=e.directionWC,u=e.upWC;let h=e.rightWC;h=K.negate(h,_Xe);const d=gXe;ke.setColumn(d,0,h,d),ke.setColumn(d,1,u,d),ke.setColumn(d,2,l,d);const f=il.fromRotationMatrix(d,yXe);for(t.length=n.length=s,i=0;i<s;++i)r.near=a[i],r.far=a[i+1],t[i]=new tY({geometryInstances:new Sm({geometry:new CE({origin:c,orientation:f,frustum:r,_drawNearPlane:0===i}),attributes:{color:Iy.fromColor(xy.fromAlpha(this._color,.1,TXe))},id:this.id,pickPrimitive:this}),appearance:new LU({translucent:!0,flat:!0}),asynchronous:!1}),n[i]=new tY({geometryInstances:new Sm({geometry:new RE({origin:c,orientation:f,frustum:r,_drawNearPlane:0===i}),attributes:{color:Iy.fromColor(this._color)},id:this.id,pickPrimitive:this}),appearance:new LU({translucent:!1,flat:!0}),asynchronous:!1})}for(o=t.length,i=0;i<o;++i)n[i].update(e),t[i].update(e)},mXe.prototype.isDestroyed=function(){return!1},mXe.prototype.destroy=function(){const e=this._planesPrimitives.length;for(let t=0;t<e;++t)this._outlinePrimitives[t]=this._outlinePrimitives[t]&&this._outlinePrimitives[t].destroy(),this._planesPrimitives[t]=this._planesPrimitives[t]&&this._planesPrimitives[t].destroy();return Qh(this)};var EXe=mXe;function xXe(){this._cachedShowFrustumsShaders={}}function SXe(e){const t={},n=e.vertexAttributes;for(const i in n)n.hasOwnProperty(i)&&(t[i]=n[i].index);return t}function IXe(e,t){const n=e.context,i=t,o=i.fragmentShaderSource.clone(),r=[];o.sources=o.sources.map((function(e){e=tq.replaceMain(e,"czm_Debug_main");const t=/gl_FragData\[(\d+)\]/g;let n;while(null!==(n=t.exec(e)))-1===r.indexOf(n[1])&&r.push(n[1]);return e}));const s=r.length;let a,c="";if(c+="uniform vec3 debugShowCommandsColor;\n",c+="uniform vec3 debugShowFrustumsColor;\n",c+="void main() \n{ \n    czm_Debug_main(); \n",s>0)for(a=0;a<s;++a)c+=`    gl_FragData[${r[a]}].rgb *= debugShowCommandsColor;\n`,c+=`    gl_FragData[${r[a]}].rgb *= debugShowFrustumsColor;\n`;else c+="    gl_FragColor.rgb *= debugShowCommandsColor;\n",c+="    gl_FragColor.rgb *= debugShowFrustumsColor;\n";c+="}",o.sources.push(c);const l=SXe(i);return fH.fromCache({context:n,vertexShaderSource:i.vertexShaderSource,fragmentShaderSource:o,attributeLocations:l})}const OXe=new xy;function DXe(e,t){let n;return n=C(t.uniformMap)?t.uniformMap:{},C(n.debugShowCommandsColor)||C(n.debugShowFrustumsColor)||(n.debugShowCommandsColor=function(){return e.debugShowCommands?(C(t._debugColor)||(t._debugColor=xy.fromRandom()),t._debugColor):xy.WHITE},n.debugShowFrustumsColor=function(){return e.debugShowFrustums?(OXe.red=1&t.debugOverlappingFrustums?1:0,OXe.green=2&t.debugOverlappingFrustums?1:0,OXe.blue=4&t.debugOverlappingFrustums?1:0,OXe.alpha=1,OXe):xy.WHITE}),n}const PXe=new UU;xXe.prototype.executeDebugShowFrustumsCommand=function(e,t,n){const i=t.shaderProgram.id;let o=this._cachedShowFrustumsShaders[i];C(o)||(o=IXe(e,t.shaderProgram),this._cachedShowFrustumsShaders[i]=o);const r=UU.shallowClone(t,PXe);r.shaderProgram=o,r.uniformMap=DXe(e,t),r.execute(e.context,n)};var RXe=xXe;function LXe(e){e=R(e,R.EMPTY_OBJECT),this.length=R(e.length,1e7),this._length=void 0,this.width=R(e.width,2),this._width=void 0,this.show=R(e.show,!0),this.modelMatrix=ft.clone(R(e.modelMatrix,ft.IDENTITY)),this._modelMatrix=new ft,this.id=e.id,this._id=void 0,this._primitive=void 0}LXe.prototype.update=function(e){if(this.show){if(!C(this._primitive)||!ft.equals(this._modelMatrix,this.modelMatrix)||this._length!==this.length||this._width!==this.width||this._id!==this.id){this._modelMatrix=ft.clone(this.modelMatrix,this._modelMatrix),this._length=this.length,this._width=this.width,this._id=this.id,C(this._primitive)&&this._primitive.destroy(),0===this.modelMatrix[12]&&0===this.modelMatrix[13]&&0===this.modelMatrix[14]&&(this.modelMatrix[14]=.01);const e=new Sm({geometry:new EP({positions:[K.ZERO,K.UNIT_X],width:this.width,vertexFormat:OK.VERTEX_FORMAT,colors:[xy.RED,xy.RED],arcType:hf.NONE}),modelMatrix:ft.multiplyByUniformScale(this.modelMatrix,this.length,new ft),id:this.id,pickPrimitive:this}),t=new Sm({geometry:new EP({positions:[K.ZERO,K.UNIT_Y],width:this.width,vertexFormat:OK.VERTEX_FORMAT,colors:[xy.GREEN,xy.GREEN],arcType:hf.NONE}),modelMatrix:ft.multiplyByUniformScale(this.modelMatrix,this.length,new ft),id:this.id,pickPrimitive:this}),n=new Sm({geometry:new EP({positions:[K.ZERO,K.UNIT_Z],width:this.width,vertexFormat:OK.VERTEX_FORMAT,colors:[xy.BLUE,xy.BLUE],arcType:hf.NONE}),modelMatrix:ft.multiplyByUniformScale(this.modelMatrix,this.length,new ft),id:this.id,pickPrimitive:this});this._primitive=new tY({geometryInstances:[e,t,n],appearance:new OK,asynchronous:!1})}this._primitive.update(e)}},LXe.prototype.isDestroyed=function(){return!1},LXe.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Qh(this)};var MXe=LXe,BXe="varying vec4 positionEC;\n\nvoid main()\n{\n    vec3 position;\n    vec3 direction;\n    if (czm_orthographicIn3D == 1.0)\n    {\n        vec2 uv = (gl_FragCoord.xy -  czm_viewport.xy) / czm_viewport.zw;\n        vec2 minPlane = vec2(czm_frustumPlanes.z, czm_frustumPlanes.y); // left, bottom\n        vec2 maxPlane = vec2(czm_frustumPlanes.w, czm_frustumPlanes.x); // right, top\n        position = vec3(mix(minPlane, maxPlane, uv), 0.0);\n        direction = vec3(0.0, 0.0, -1.0);\n    } \n    else \n    {\n        position = vec3(0.0);\n        direction = normalize(positionEC.xyz);\n    }\n\n    czm_ray ray = czm_ray(position, direction);\n\n    vec3 ellipsoid_center = czm_view[3].xyz;\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\n    if (!czm_isEmpty(intersection))\n    {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n    }\n    else\n    {\n        discard;\n    }\n\n    czm_writeLogDepth();\n}\n",NXe="attribute vec4 position;\n\nvarying vec4 positionEC;\n\nvoid main()\n{\n    positionEC = czm_modelView * position;\n    gl_Position = czm_projection * positionEC;\n\n    czm_vertexLogDepth();\n}\n";function FXe(e){this._rs=void 0,this._sp=void 0,this._va=void 0,this._command=void 0,this._mode=void 0,this._useLogDepth=!1,this._ellipsoidOffset=R(e,0)}const zXe=Oc.supportsTypedArrays()?new Float32Array(12):[],kXe=new K,UXe=new K,VXe=new K,HXe=new K,GXe=new K;function WXe(e,t){const n=e.radii,i=t.camera;let o,r,s;if(i.frustum instanceof jC)o=K.ZERO,r=i.rightWC,s=i.upWC;else{const t=i.positionWC,n=K.multiplyComponents(e.oneOverRadii,t,kXe),a=K.normalize(n,UXe),c=K.normalize(K.cross(K.UNIT_Z,n,VXe),VXe),l=K.normalize(K.cross(a,c,HXe),HXe),u=K.magnitude(n),h=Math.sqrt(u*u-1);o=K.multiplyByScalar(a,1/u,kXe);const d=h/u;r=K.multiplyByScalar(c,d,UXe),s=K.multiplyByScalar(l,d,VXe)}const a=K.add(o,s,GXe);K.subtract(a,r,a),K.multiplyComponents(n,a,a),K.pack(a,zXe,0);const c=K.subtract(o,s,GXe);K.subtract(c,r,c),K.multiplyComponents(n,c,c),K.pack(c,zXe,3);const l=K.add(o,s,GXe);K.add(l,r,l),K.multiplyComponents(n,l,l),K.pack(l,zXe,6);const u=K.subtract(o,s,GXe);return K.add(u,r,u),K.multiplyComponents(n,u,u),K.pack(u,zXe,9),zXe}FXe.prototype.update=function(e){if(this._mode=e.mode,e.mode!==ij.SCENE3D)return;const t=e.context,n=e.mapProjection.ellipsoid.radii,i=new ge(n.x+this._ellipsoidOffset,n.y+this._ellipsoidOffset,n.z+this._ellipsoidOffset),o=e.useLogDepth;if(C(this._command)||(this._rs=yV.fromCache({cull:{enabled:!0},depthTest:{enabled:!0},colorMask:{red:!1,green:!1,blue:!1,alpha:!1}}),this._command=new UU({renderState:this._rs,boundingVolume:new nn(K.ZERO,i.maximumRadius),pass:HU.OPAQUE,owner:this})),!C(this._sp)||this._useLogDepth!==o){this._useLogDepth=o;const e=new tq({sources:[NXe]}),n=new tq({sources:[BXe]});if(o){const t="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n";n.sources.push(t),n.defines.push("LOG_DEPTH"),e.defines.push("LOG_DEPTH")}this._sp=fH.replaceCache({shaderProgram:this._sp,context:t,vertexShaderSource:e,fragmentShaderSource:n,attributeLocations:{position:0}}),this._command.shaderProgram=this._sp}const r=WXe(i,e);if(C(this._va))this._va.getAttribute(0).vertexBuffer.copyFromArrayView(r);else{const e=new zf({attributes:{position:new Uf({componentDatatype:ih.FLOAT,componentsPerAttribute:3,values:r})},indices:[0,1,2,2,1,3],primitiveType:xf.TRIANGLES});this._va=bq.fromGeometry({context:t,geometry:e,attributeLocations:{position:0},bufferUsage:lq.DYNAMIC_DRAW}),this._command.vertexArray=this._va}},FXe.prototype.execute=function(e,t){this._mode===ij.SCENE3D&&this._command.execute(e,t)},FXe.prototype.isDestroyed=function(){return!1},FXe.prototype.destroy=function(){this._sp=this._sp&&this._sp.destroy(),this._va=this._va&&this._va.destroy()};var qXe=FXe;function jXe(){}const YXe=/\bgl_FragDepthEXT\b/,KXe=/\bdiscard\b/;function XXe(e,t){let n=e.shaderCache.getDerivedShaderProgram(t,"depthOnly");if(!C(n)){const i=t._attributeLocations;let o,r=t.fragmentShaderSource,s=!1;const a=r.sources;let c=a.length;for(o=0;o<c;++o)if(YXe.test(a[o])||KXe.test(a[o])){s=!0;break}let l=!1;const u=r.defines;for(c=u.length,o=0;o<c;++o)if("LOG_DEPTH"===u[o]){l=!0;break}let h;s||l?!s&&l&&(h="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\nvoid main() \n{ \n    gl_FragColor = vec4(1.0); \n    czm_writeLogDepth(); \n} \n",r=new tq({defines:["LOG_DEPTH"],sources:[h]})):(h="void main() \n{ \n    gl_FragColor = vec4(1.0); \n} \n",r=new tq({sources:[h]})),n=e.shaderCache.createDerivedShaderProgram(t,"depthOnly",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:r,attributeLocations:i})}return n}function QXe(e,t){const n=e._depthOnlyRenderStateCache;let i=n[t.id];if(!C(i)){const e=yV.getState(t);e.depthMask=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1},i=yV.fromCache(e),n[t.id]=i}return i}jXe.createDepthOnlyDerivedCommand=function(e,t,n,i){let o,r;return C(i)||(i={}),C(i.depthOnlyCommand)&&(o=i.depthOnlyCommand.shaderProgram,r=i.depthOnlyCommand.renderState),i.depthOnlyCommand=UU.shallowClone(t,i.depthOnlyCommand),C(o)&&i.shaderProgramId===t.shaderProgram.id?(i.depthOnlyCommand.shaderProgram=o,i.depthOnlyCommand.renderState=r):(i.depthOnlyCommand.shaderProgram=XXe(n,t.shaderProgram),i.depthOnlyCommand.renderState=QXe(e,t.renderState),i.shaderProgramId=t.shaderProgram.id),i};const JXe=/\s+czm_writeLogDepth\(/,ZXe=/\s+czm_vertexLogDepth\(/,$Xe=/\s*#extension\s+GL_EXT_frag_depth\s*:\s*enable/;function eQe(e,t){let n=e.shaderCache.getDerivedShaderProgram(t,"logDepth");if(!C(n)){const i=t._attributeLocations,o=t.vertexShaderSource.clone(),r=t.fragmentShaderSource.clone();let s,a;o.defines=C(o.defines)?o.defines.slice(0):[],o.defines.push("LOG_DEPTH"),r.defines=C(r.defines)?r.defines.slice(0):[],r.defines.push("LOG_DEPTH");let c=!1,l=o.sources,u=l.length;for(s=0;s<u;++s)if(ZXe.test(l[s])){c=!0;break}if(!c){for(s=0;s<u;++s)l[s]=tq.replaceMain(l[s],"czm_log_depth_main");a="\n\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_vertexLogDepth(); \n} \n",l.push(a)}for(l=r.sources,u=l.length,c=!1,s=0;s<u;++s)JXe.test(l[s])&&(c=!0);-1!==r.defines.indexOf("LOG_DEPTH_WRITE")&&(c=!0);let h=!0;for(s=0;s<u;++s)$Xe.test(l[s])&&(h=!1);let d="";if(h&&(d+="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n"),!c){for(s=0;s<u;s++)l[s]=tq.replaceMain(l[s],"czm_log_depth_main");d+="\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_writeLogDepth(); \n} \n"}l.push(d),n=e.shaderCache.createDerivedShaderProgram(t,"logDepth",{vertexShaderSource:o,fragmentShaderSource:r,attributeLocations:i})}return n}function tQe(e,t,n){let i=e.shaderCache.getDerivedShaderProgram(t,"pick");if(!C(i)){const o=t._attributeLocations;let r=t.fragmentShaderSource;const s=r.sources,a=s.length,c=`void main() \n{ \n    czm_non_pick_main(); \n    if (gl_FragColor.a == 0.0) { \n        discard; \n    } \n    gl_FragColor = ${n}; \n} \n`,l=new Array(a+1);for(let e=0;e<a;++e)l[e]=tq.replaceMain(s[e],"czm_non_pick_main");l[a]=c,r=new tq({sources:l,defines:r.defines}),i=e.shaderCache.createDerivedShaderProgram(t,"pick",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:r,attributeLocations:o})}return i}function nQe(e,t){const n=e.picking.pickRenderStateCache;let i=n[t.id];if(!C(i)){const e=yV.getState(t);e.blending.enabled=!1,e.depthMask=!0,i=yV.fromCache(e),n[t.id]=i}return i}function iQe(e,t){let n=e.shaderCache.getDerivedShaderProgram(t,"HDR");if(!C(n)){const i=t._attributeLocations,o=t.vertexShaderSource.clone(),r=t.fragmentShaderSource.clone();o.defines=C(o.defines)?o.defines.slice(0):[],o.defines.push("HDR"),r.defines=C(r.defines)?r.defines.slice(0):[],r.defines.push("HDR"),n=e.shaderCache.createDerivedShaderProgram(t,"HDR",{vertexShaderSource:o,fragmentShaderSource:r,attributeLocations:i})}return n}jXe.createLogDepthCommand=function(e,t,n){let i;return C(n)||(n={}),C(n.command)&&(i=n.command.shaderProgram),n.command=UU.shallowClone(e,n.command),C(i)&&n.shaderProgramId===e.shaderProgram.id?n.command.shaderProgram=i:(n.command.shaderProgram=eQe(t,e.shaderProgram),n.shaderProgramId=e.shaderProgram.id),n},jXe.createPickDerivedCommand=function(e,t,n,i){let o,r;return C(i)||(i={}),C(i.pickCommand)&&(o=i.pickCommand.shaderProgram,r=i.pickCommand.renderState),i.pickCommand=UU.shallowClone(t,i.pickCommand),C(o)&&i.shaderProgramId===t.shaderProgram.id?(i.pickCommand.shaderProgram=o,i.pickCommand.renderState=r):(i.pickCommand.shaderProgram=tQe(n,t.shaderProgram,t.pickId),i.pickCommand.renderState=nQe(e,t.renderState),i.shaderProgramId=t.shaderProgram.id),i},jXe.createHdrCommand=function(e,t,n){let i;return C(n)||(n={}),C(n.command)&&(i=n.command.shaderProgram),n.command=UU.shallowClone(e,n.command),C(i)&&n.shaderProgramId===e.shaderProgram.id?n.command.shaderProgram=i:(n.command.shaderProgram=iQe(t,e.shaderProgram),n.shaderProgramId=e.shaderProgram.id),n};var oQe=jXe;function rQe(e){if(!C(e))throw new x("scene is required.");this._scene=e,this._lastAlpha=void 0,this._lastBeta=void 0,this._lastGamma=void 0,this._alpha=void 0,this._beta=void 0,this._gamma=void 0;const t=this;function n(e){const n=e.alpha;if(!C(n))return t._alpha=void 0,t._beta=void 0,void(t._gamma=void 0);t._alpha=z.toRadians(n),t._beta=z.toRadians(e.beta),t._gamma=z.toRadians(e.gamma)}window.addEventListener("deviceorientation",n,!1),this._removeListener=function(){window.removeEventListener("deviceorientation",n,!1)}}const sQe=new il,aQe=new il,cQe=new ke;function lQe(e,t,n,i){const o=e.direction,r=e.right,s=e.up,a=il.fromAxisAngle(o,n,aQe),c=il.fromAxisAngle(r,i,sQe),l=il.multiply(c,a,c),u=il.fromAxisAngle(s,t,aQe);il.multiply(u,l,l);const h=ke.fromQuaternion(l,cQe);ke.multiplyByVector(h,r,r),ke.multiplyByVector(h,s,s),ke.multiplyByVector(h,o,o)}rQe.prototype.update=function(){if(!C(this._alpha))return;C(this._lastAlpha)||(this._lastAlpha=this._alpha,this._lastBeta=this._beta,this._lastGamma=this._gamma);const e=this._lastAlpha-this._alpha,t=this._lastBeta-this._beta,n=this._lastGamma-this._gamma;lQe(this._scene.camera,-e,t,n),this._lastAlpha=this._alpha,this._lastBeta=this._beta,this._lastGamma=this._gamma},rQe.prototype.isDestroyed=function(){return!1},rQe.prototype.destroy=function(){return this._removeListener(),Qh(this)};var uQe=rQe;var hQe="#ifdef WRITE_DEPTH\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n#endif\n\nuniform vec3 u_radii;\nuniform vec3 u_oneOverEllipsoidRadiiSquared;\n\nvarying vec3 v_positionEC;\n\nvec4 computeEllipsoidColor(czm_ray ray, float intersection, float side)\n{\n    vec3 positionEC = czm_pointAlongRay(ray, intersection);\n    vec3 positionMC = (czm_inverseModelView * vec4(positionEC, 1.0)).xyz;\n    vec3 geodeticNormal = normalize(czm_geodeticSurfaceNormal(positionMC, vec3(0.0), u_oneOverEllipsoidRadiiSquared));\n    vec3 sphericalNormal = normalize(positionMC / u_radii);\n    vec3 normalMC = geodeticNormal * side;              // normalized surface normal (always facing the viewer) in model coordinates\n    vec3 normalEC = normalize(czm_normal * normalMC);   // normalized surface normal in eye coordiantes\n\n    vec2 st = czm_ellipsoidWgs84TextureCoordinates(sphericalNormal);\n    vec3 positionToEyeEC = -positionEC;\n\n    czm_materialInput materialInput;\n    materialInput.s = st.s;\n    materialInput.st = st;\n    materialInput.str = (positionMC + u_radii) / u_radii;\n    materialInput.normalEC = normalEC;\n    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(positionMC, normalEC);\n    materialInput.positionToEyeEC = positionToEyeEC;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef ONLY_SUN_LIGHTING\n    return czm_private_phong(normalize(positionToEyeEC), material, czm_sunDirectionEC);\n#else\n    return czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n\nvoid main()\n{\n    // PERFORMANCE_TODO: When dynamic branching is available, compute ratio of maximum and minimum radii\n    // in the vertex shader. Only when it is larger than some constant, march along the ray.\n    // Otherwise perform one intersection test which will be the common case.\n\n    // Test if the ray intersects a sphere with the ellipsoid's maximum radius.\n    // For very oblate ellipsoids, using the ellipsoid's radii for an intersection test\n    // may cause false negatives. This will discard fragments before marching the ray forward.\n    float maxRadius = max(u_radii.x, max(u_radii.y, u_radii.z)) * 1.5;\n    vec3 direction = normalize(v_positionEC);\n    vec3 ellipsoidCenter = czm_modelView[3].xyz;\n\n    float t1 = -1.0;\n    float t2 = -1.0;\n\n    float b = -2.0 * dot(direction, ellipsoidCenter);\n    float c = dot(ellipsoidCenter, ellipsoidCenter) - maxRadius * maxRadius;\n\n    float discriminant = b * b - 4.0 * c;\n    if (discriminant >= 0.0) {\n        t1 = (-b - sqrt(discriminant)) * 0.5;\n        t2 = (-b + sqrt(discriminant)) * 0.5;\n    }\n\n    if (t1 < 0.0 && t2 < 0.0) {\n        discard;\n    }\n\n    float t = min(t1, t2);\n    if (t < 0.0) {\n        t = 0.0;\n    }\n\n    // March ray forward to intersection with larger sphere and find\n    czm_ray ray = czm_ray(t * direction, direction);\n\n    vec3 ellipsoid_inverseRadii = vec3(1.0 / u_radii.x, 1.0 / u_radii.y, 1.0 / u_radii.z);\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoidCenter, ellipsoid_inverseRadii);\n\n    if (czm_isEmpty(intersection))\n    {\n        discard;\n    }\n\n    // If the viewer is outside, compute outsideFaceColor, with normals facing outward.\n    vec4 outsideFaceColor = (intersection.start != 0.0) ? computeEllipsoidColor(ray, intersection.start, 1.0) : vec4(0.0);\n\n    // If the viewer either is inside or can see inside, compute insideFaceColor, with normals facing inward.\n    vec4 insideFaceColor = (outsideFaceColor.a < 1.0) ? computeEllipsoidColor(ray, intersection.stop, -1.0) : vec4(0.0);\n\n    gl_FragColor = mix(insideFaceColor, outsideFaceColor, outsideFaceColor.a);\n    gl_FragColor.a = 1.0 - (1.0 - insideFaceColor.a) * (1.0 - outsideFaceColor.a);\n\n#ifdef WRITE_DEPTH\n#ifdef GL_EXT_frag_depth\n    t = (intersection.start != 0.0) ? intersection.start : intersection.stop;\n    vec3 positionEC = czm_pointAlongRay(ray, t);\n    vec4 positionCC = czm_projection * vec4(positionEC, 1.0);\n#ifdef LOG_DEPTH\n    czm_writeLogDepth(1.0 + positionCC.w);\n#else\n    float z = positionCC.z / positionCC.w;\n\n    float n = czm_depthRange.near;\n    float f = czm_depthRange.far;\n\n    gl_FragDepthEXT = (z * (f - n) + f + n) * 0.5;\n#endif\n#endif\n#endif\n}\n",dQe="attribute vec3 position;\n\nuniform vec3 u_radii;\n\nvarying vec3 v_positionEC;\n\nvoid main()\n{\n    // In the vertex data, the cube goes from (-1.0, -1.0, -1.0) to (1.0, 1.0, 1.0) in model coordinates.\n    // Scale to consider the radii.  We could also do this once on the CPU when using the BoxGeometry,\n    // but doing it here allows us to change the radii without rewriting the vertex data, and\n    // allows all ellipsoids to reuse the same vertex data.\n    vec4 p = vec4(u_radii * position, 1.0);\n\n    v_positionEC = (czm_modelView * p).xyz;     // position in eye coordinates\n    gl_Position = czm_modelViewProjection * p;  // position in clip coordinates\n\n    // With multi-frustum, when the ellipsoid primitive is positioned on the intersection of two frustums\n    // and close to terrain, the terrain (writes depth) in the closest frustum can overwrite part of the\n    // ellipsoid (does not write depth) that was rendered in the farther frustum.\n    //\n    // Here, we clamp the depth in the vertex shader to avoid being overwritten; however, this creates\n    // artifacts since some fragments can be alpha blended twice.  This is solved by only rendering\n    // the ellipsoid in the closest frustum to the viewer.\n    gl_Position.z = clamp(gl_Position.z, czm_depthRange.near, czm_depthRange.far);\n\n    czm_vertexLogDepth();\n}\n";const fQe={position:0};function pQe(e){e=R(e,R.EMPTY_OBJECT),this.center=K.clone(R(e.center,K.ZERO)),this._center=new K,this.radii=K.clone(e.radii),this._radii=new K,this._oneOverEllipsoidRadiiSquared=new K,this._boundingSphere=new nn,this.modelMatrix=ft.clone(R(e.modelMatrix,ft.IDENTITY)),this._modelMatrix=new ft,this._computedModelMatrix=new ft,this.show=R(e.show,!0),this.material=R(e.material,EU.fromType(EU.ColorType)),this._material=void 0,this._translucent=void 0,this.id=e.id,this._id=void 0,this.debugShowBoundingVolume=R(e.debugShowBoundingVolume,!1),this.onlySunLighting=R(e.onlySunLighting,!1),this._onlySunLighting=!1,this._depthTestEnabled=R(e.depthTestEnabled,!0),this._useLogDepth=!1,this._sp=void 0,this._rs=void 0,this._va=void 0,this._pickSP=void 0,this._pickId=void 0,this._colorCommand=new UU({owner:R(e._owner,this)}),this._pickCommand=new UU({owner:R(e._owner,this),pickOnly:!0});const t=this;this._uniforms={u_radii:function(){return t.radii},u_oneOverEllipsoidRadiiSquared:function(){return t._oneOverEllipsoidRadiiSquared}},this._pickUniforms={czm_pickColor:function(){return t._pickId.color}}}function mQe(e){let t=e.cache.ellipsoidPrimitive_vertexArray;if(C(t))return t;const n=ep.createGeometry(ep.fromDimensions({dimensions:new K(2,2,2),vertexFormat:jf.POSITION_ONLY}));return t=bq.fromGeometry({context:e,geometry:n,attributeLocations:fQe,bufferUsage:lq.STATIC_DRAW,interleave:!0}),e.cache.ellipsoidPrimitive_vertexArray=t,t}const _Qe="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n";pQe.prototype.update=function(e){if(!this.show||e.mode!==ij.SCENE3D||!C(this.center)||!C(this.radii))return;if(!C(this.material))throw new x("this.material must be defined.");const t=e.context,n=this.material.isTranslucent(),i=this._translucent!==n;C(this._rs)&&!i||(this._translucent=n,this._rs=yV.fromCache({cull:{enabled:!0,face:yk.FRONT},depthTest:{enabled:this._depthTestEnabled},depthMask:!n&&t.fragmentDepth,blending:n?_k.ALPHA_BLEND:void 0})),C(this._va)||(this._va=mQe(t));let o=!1;const r=this.radii;if(!K.equals(this._radii,r)){K.clone(r,this._radii);const e=this._oneOverEllipsoidRadiiSquared;e.x=1/(r.x*r.x),e.y=1/(r.y*r.y),e.z=1/(r.z*r.z),o=!0}ft.equals(this.modelMatrix,this._modelMatrix)&&K.equals(this.center,this._center)||(ft.clone(this.modelMatrix,this._modelMatrix),K.clone(this.center,this._center),ft.multiplyByTranslation(this.modelMatrix,this.center,this._computedModelMatrix),o=!0),o&&(K.clone(K.ZERO,this._boundingSphere.center),this._boundingSphere.radius=K.maximumComponent(r),nn.transform(this._boundingSphere,this._computedModelMatrix,this._boundingSphere));const s=this._material!==this.material;this._material=this.material,this._material.update(t);const a=this.onlySunLighting!==this._onlySunLighting;this._onlySunLighting=this.onlySunLighting;const c=e.useLogDepth,l=this._useLogDepth!==c;this._useLogDepth=c;const u=this._colorCommand;let h,d;(s||a||i||l)&&(h=new tq({sources:[dQe]}),d=new tq({sources:[this.material.shaderSource,hQe]}),this.onlySunLighting&&d.defines.push("ONLY_SUN_LIGHTING"),!n&&t.fragmentDepth&&d.defines.push("WRITE_DEPTH"),this._useLogDepth&&(h.defines.push("LOG_DEPTH"),d.defines.push("LOG_DEPTH"),d.sources.push(_Qe)),this._sp=fH.replaceCache({context:t,shaderProgram:this._sp,vertexShaderSource:h,fragmentShaderSource:d,attributeLocations:fQe}),u.vertexArray=this._va,u.renderState=this._rs,u.shaderProgram=this._sp,u.uniformMap=_n(this._uniforms,this.material._uniforms),u.executeInClosestFrustum=n);const f=e.commandList,p=e.passes;if(p.render&&(u.boundingVolume=this._boundingSphere,u.debugShowBoundingVolume=this.debugShowBoundingVolume,u.modelMatrix=this._computedModelMatrix,u.pass=n?HU.TRANSLUCENT:HU.OPAQUE,f.push(u)),p.pick){const e=this._pickCommand;C(this._pickId)&&this._id===this.id||(this._id=this.id,this._pickId=this._pickId&&this._pickId.destroy(),this._pickId=t.createPickId({primitive:this,id:this.id})),(s||a||!C(this._pickSP)||l)&&(h=new tq({sources:[dQe]}),d=new tq({sources:[this.material.shaderSource,hQe],pickColorQualifier:"uniform"}),this.onlySunLighting&&d.defines.push("ONLY_SUN_LIGHTING"),!n&&t.fragmentDepth&&d.defines.push("WRITE_DEPTH"),this._useLogDepth&&(h.defines.push("LOG_DEPTH"),d.defines.push("LOG_DEPTH"),d.sources.push(_Qe)),this._pickSP=fH.replaceCache({context:t,shaderProgram:this._pickSP,vertexShaderSource:h,fragmentShaderSource:d,attributeLocations:fQe}),e.vertexArray=this._va,e.renderState=this._rs,e.shaderProgram=this._pickSP,e.uniformMap=_n(_n(this._uniforms,this._pickUniforms),this.material._uniforms),e.executeInClosestFrustum=n),e.boundingVolume=this._boundingSphere,e.modelMatrix=this._computedModelMatrix,e.pass=n?HU.TRANSLUCENT:HU.OPAQUE,f.push(e)}},pQe.prototype.isDestroyed=function(){return!1},pQe.prototype.destroy=function(){return this._sp=this._sp&&this._sp.destroy(),this._pickSP=this._pickSP&&this._pickSP.destroy(),this._pickId=this._pickId&&this._pickId.destroy(),Qh(this)};var gQe=pQe,yQe="varying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    czm_materialInput materialInput;\n\n    vec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    materialInput.s = v_st.s;\n    materialInput.st = v_st;\n    materialInput.str = vec3(v_st, 0.0);\n\n    // Convert tangent space material normal to eye space\n    materialInput.normalEC = normalEC;\n    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\n\n    // Convert view vector to world space\n    vec3 positionToEyeEC = -v_positionEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n",vQe="attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionMC = position3DHigh + position3DLow;           // position in model coordinates\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;     // position in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n";function bQe(e){e=R(e,R.EMPTY_OBJECT);const t=R(e.translucent,!0),n=R(e.aboveGround,!1);this.material=C(e.material)?e.material:EU.fromType(EU.ColorType),this.translucent=R(e.translucent,!0),this._vertexShaderSource=R(e.vertexShaderSource,vQe),this._fragmentShaderSource=R(e.fragmentShaderSource,yQe),this._renderState=bk.getDefaultRenderState(t,!n,e.renderState),this._closed=!1,this._flat=R(e.flat,!1),this._faceForward=R(e.faceForward,n),this._aboveGround=n}Object.defineProperties(bQe.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return bQe.VERTEX_FORMAT}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}},aboveGround:{get:function(){return this._aboveGround}}}),bQe.VERTEX_FORMAT=jf.POSITION_AND_ST,bQe.prototype.getFragmentShaderSource=bk.prototype.getFragmentShaderSource,bQe.prototype.isTranslucent=bk.prototype.isTranslucent,bQe.prototype.getRenderState=bk.prototype.getRenderState;function AQe(){this.enabled=!0,this.renderable=!0,this.density=2e-4,this.screenSpaceErrorFactor=2,this.minimumBrightness=.03}const wQe=[359.393,800.749,1275.6501,2151.1192,3141.7763,4777.5198,6281.2493,12364.307,15900.765,49889.0549,78026.8259,99260.7344,120036.3873,151011.0158,156091.1953,203849.3112,274866.9803,319916.3149,493552.0528,628733.5874],TQe=[2e-5,2e-4,1e-4,7e-5,5e-5,4e-5,3e-5,19e-6,1e-5,85e-7,62e-7,58e-7,53e-7,52e-7,51e-7,42e-7,4e-6,34e-7,26e-7,22e-7];for(let ko=0;ko<TQe.length;++ko)TQe[ko]*=1e6;const CQe=TQe[1],EQe=TQe[TQe.length-1];for(let ko=0;ko<TQe.length;++ko)TQe[ko]=(TQe[ko]-EQe)/(CQe-EQe);let xQe=0;function SQe(e){const t=wQe,n=t.length;if(e<t[0])return xQe=0,xQe;if(e>t[n-1])return xQe=n-2,xQe;if(e>=t[xQe]){if(xQe+1<n&&e<t[xQe+1])return xQe;if(xQe+2<n&&e<t[xQe+2])return++xQe,xQe}else if(xQe-1>=0&&e>=t[xQe-1])return--xQe,xQe;let i;for(i=0;i<n-2;++i)if(e>=t[i]&&e<t[i+1])break;return xQe=i,xQe}const IQe=new K;AQe.prototype.update=function(e){const t=e.fog.enabled=this.enabled;if(!t)return;e.fog.renderable=this.renderable;const n=e.camera,i=n.positionCartographic;if(!C(i)||i.height>8e5||e.mode!==ij.SCENE3D)return void(e.fog.enabled=!1);const o=i.height,r=SQe(o),s=z.clamp((o-wQe[r])/(wQe[r+1]-wQe[r]),0,1);let a=z.lerp(TQe[r],TQe[r+1],s);const c=1e6*this.density,l=c/CQe*EQe;a=a*(c-l)*1e-6;const u=K.normalize(n.positionWC,IQe),h=Math.abs(K.dot(n.directionWC,u));a*=1-h,e.fog.density=a,e.fog.sse=this.screenSpaceErrorFactor,e.fog.minimumBrightness=this.minimumBrightness};var OQe=AQe;function DQe(e){if(!C(e)||!C(e.scene))throw new x("options.scene is required.");this._scene=e.scene,this.samplingWindow=R(e.samplingWindow,DQe.defaultSettings.samplingWindow),this.quietPeriod=R(e.quietPeriod,DQe.defaultSettings.quietPeriod),this.warmupPeriod=R(e.warmupPeriod,DQe.defaultSettings.warmupPeriod),this.minimumFrameRateDuringWarmup=R(e.minimumFrameRateDuringWarmup,DQe.defaultSettings.minimumFrameRateDuringWarmup),this.minimumFrameRateAfterWarmup=R(e.minimumFrameRateAfterWarmup,DQe.defaultSettings.minimumFrameRateAfterWarmup),this._lowFrameRate=new $n,this._nominalFrameRate=new $n,this._frameTimes=[],this._needsQuietPeriod=!0,this._quietPeriodEndTime=0,this._warmupPeriodEndTime=0,this._frameRateIsLow=!1,this._lastFramesPerSecond=void 0,this._pauseCount=0;const t=this;this._preUpdateRemoveListener=this._scene.preUpdate.addEventListener((function(e,n){PQe(t,n)})),this._hiddenPropertyName=void 0!==document.hidden?"hidden":void 0!==document.mozHidden?"mozHidden":void 0!==document.msHidden?"msHidden":void 0!==document.webkitHidden?"webkitHidden":void 0;const n=void 0!==document.hidden?"visibilitychange":void 0!==document.mozHidden?"mozvisibilitychange":void 0!==document.msHidden?"msvisibilitychange":void 0!==document.webkitHidden?"webkitvisibilitychange":void 0;function i(){RQe(t)}this._visibilityChangeRemoveListener=void 0,C(n)&&(document.addEventListener(n,i,!1),this._visibilityChangeRemoveListener=function(){document.removeEventListener(n,i,!1)})}function PQe(e,t){if(e._pauseCount>0)return;const n=py();if(e._needsQuietPeriod)e._needsQuietPeriod=!1,e._frameTimes.length=0,e._quietPeriodEndTime=n+e.quietPeriod/ta.SECONDS_PER_MILLISECOND,e._warmupPeriodEndTime=e._quietPeriodEndTime+(e.warmupPeriod+e.samplingWindow)/ta.SECONDS_PER_MILLISECOND;else if(n>=e._quietPeriodEndTime){e._frameTimes.push(n);const t=n-e.samplingWindow/ta.SECONDS_PER_MILLISECOND;if(e._frameTimes.length>=2&&e._frameTimes[0]<=t){while(e._frameTimes.length>=2&&e._frameTimes[1]<t)e._frameTimes.shift();const i=(n-e._frameTimes[0])/(e._frameTimes.length-1);e._lastFramesPerSecond=1e3/i;const o=1e3/(n>e._warmupPeriodEndTime?e.minimumFrameRateAfterWarmup:e.minimumFrameRateDuringWarmup);i>o?e._frameRateIsLow||(e._frameRateIsLow=!0,e._needsQuietPeriod=!0,e.lowFrameRate.raiseEvent(e.scene,e._lastFramesPerSecond)):e._frameRateIsLow&&(e._frameRateIsLow=!1,e._needsQuietPeriod=!0,e.nominalFrameRate.raiseEvent(e.scene,e._lastFramesPerSecond))}}}function RQe(e){document[e._hiddenPropertyName]?e.pause():e.unpause()}DQe.defaultSettings={samplingWindow:5,quietPeriod:2,warmupPeriod:5,minimumFrameRateDuringWarmup:4,minimumFrameRateAfterWarmup:8},DQe.fromScene=function(e){if(!C(e))throw new x("scene is required.");return C(e._frameRateMonitor)&&!e._frameRateMonitor.isDestroyed()||(e._frameRateMonitor=new DQe({scene:e})),e._frameRateMonitor},Object.defineProperties(DQe.prototype,{scene:{get:function(){return this._scene}},lowFrameRate:{get:function(){return this._lowFrameRate}},nominalFrameRate:{get:function(){return this._nominalFrameRate}},lastFramesPerSecond:{get:function(){return this._lastFramesPerSecond}}}),DQe.prototype.pause=function(){++this._pauseCount,1===this._pauseCount&&(this._frameTimes.length=0,this._lastFramesPerSecond=void 0)},DQe.prototype.unpause=function(){--this._pauseCount,this._pauseCount<=0&&(this._pauseCount=0,this._needsQuietPeriod=!0)},DQe.prototype.isDestroyed=function(){return!1},DQe.prototype.destroy=function(){return this._preUpdateRemoveListener(),C(this._visibilityChangeRemoveListener)&&this._visibilityChangeRemoveListener(),Qh(this)};var LQe=DQe;function MQe(e,t,n){this.context=e,this.commandList=[],this.shadowMaps=[],this.brdfLutGenerator=void 0,this.environmentMap=void 0,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this.specularEnvironmentMapsMaximumLOD=void 0,this.mode=ij.SCENE3D,this.morphTime=ij.getMorphTime(ij.SCENE3D),this.frameNumber=0,this.newFrame=!1,this.time=void 0,this.jobScheduler=n,this.mapProjection=void 0,this.camera=void 0,this.cameraUnderground=!1,this.globeTranslucencyState=void 0,this.cullingVolume=void 0,this.occluder=void 0,this.maximumScreenSpaceError=void 0,this.pixelRatio=1,this.passes={render:!1,pick:!1,depth:!1,postProcess:!1,offscreen:!1},this.creditDisplay=t,this.afterRender=[],this.scene3DOnly=!1,this.fog={enabled:!1,density:void 0,sse:void 0,minimumBrightness:void 0},this.terrainExaggeration=1,this.terrainExaggerationRelativeHeight=0,this.shadowState={shadowsEnabled:!0,shadowMaps:[],lightShadowMaps:[],nearPlane:1,farPlane:5e3,closestObjectSize:1e3,lastDirtyTime:0,outOfView:!0},this.splitPosition=0,this.frustumSplits=[],this.backgroundColor=void 0,this.light=void 0,this.minimumDisableDepthTestDistance=void 0,this.invertClassification=!1,this.invertClassificationColor=void 0,this.useLogDepth=!1,this.tilesetPassState=void 0,this.minimumTerrainHeight=0}var BQe=MQe;function NQe(e,t){this.near=R(e,0),this.far=R(t,0);const n=HU.NUMBER_OF_PASSES,i=new Array(n),o=new Array(n);for(let r=0;r<n;++r)i[r]=[],o[r]=0;this.commands=i,this.indices=o}var FQe=NQe;function zQe(e,t,n){if(!C(e))throw new x("type is required.");if(this.type=e,!C(t))if("json"===e)t="application/json";else if("xml"===e)t="text/xml";else if("html"===e)t="text/html";else{if("text"!==e)throw new x('format is required when type is not "json", "xml", "html", or "text".');t="text/plain"}if(this.format=t,!C(n))if("json"===e)n=kQe;else if("xml"===e)n=WQe;else if("html"===e)n=tJe;else{if("text"!==e)throw new x('callback is required when type is not "json", "xml", "html", or "text".');n=tJe}this.callback=n}function kQe(e){const t=[],n=e.features;for(let i=0;i<n.length;++i){const e=n[i],o=new $Ge;if(o.data=e,o.properties=e.properties,o.configureNameFromProperties(e.properties),o.configureDescriptionFromProperties(e.properties),C(e.geometry)&&"Point"===e.geometry.type){const t=e.geometry.coordinates[0],n=e.geometry.coordinates[1];o.position=se.fromDegrees(t,n)}t.push(o)}return t}const UQe="http://www.mapinfo.com/mxp",VQe="http://www.esri.com/wms",HQe="http://www.opengis.net/wfs",GQe="http://www.opengis.net/gml";function WQe(e){const t=e.documentElement;if("MultiFeatureCollection"===t.localName&&t.namespaceURI===UQe)return qQe(e);if("FeatureInfoResponse"===t.localName&&t.namespaceURI===VQe)return jQe(e);if("FeatureCollection"===t.localName&&t.namespaceURI===HQe)return YQe(e);if("ServiceExceptionReport"===t.localName)throw new Je((new XMLSerializer).serializeToString(t));return"msGMLOutput"===t.localName?KQe(e):JQe(e)}function qQe(e){const t=[],n=e.documentElement,i=n.getElementsByTagNameNS(UQe,"Feature");for(let o=0;o<i.length;++o){const e=i[o],n={},r=e.getElementsByTagNameNS(UQe,"Val");for(let t=0;t<r.length;++t){const e=r[t];if(e.hasAttribute("ref")){const t=e.getAttribute("ref"),i=e.textContent.trim();n[t]=i}}const s=new $Ge;s.data=e,s.properties=n,s.configureNameFromProperties(n),s.configureDescriptionFromProperties(n),t.push(s)}return t}function jQe(e){const t=e.documentElement,n=[];let i;const o=t.getElementsByTagNameNS("*","FIELDS");if(o.length>0)for(let r=0;r<o.length;++r){const e=o[r];i={};const t=e.attributes;for(let n=0;n<t.length;++n){const e=t[n];i[e.name]=e.value}n.push(QQe(e,i))}else{const e=t.getElementsByTagNameNS("*","FeatureInfo");for(let t=0;t<e.length;++t){const o=e[t];i={};const r=o.childNodes;for(let e=0;e<r.length;++e){const t=r[e];t.nodeType===Node.ELEMENT_NODE&&(i[t.localName]=t.textContent)}n.push(QQe(o,i))}}return n}function YQe(e){const t=[],n=e.documentElement,i=n.getElementsByTagNameNS(GQe,"featureMember");for(let o=0;o<i.length;++o){const e=i[o],n={};XQe(e,n),t.push(QQe(e,n))}return t}function KQe(e){const t=[];let n;const i=e.documentElement.childNodes;for(let r=0;r<i.length;r++)if(i[r].nodeType===Node.ELEMENT_NODE){n=i[r];break}if(!C(n))throw new Je("Unable to find first child of the feature info xml document");const o=n.childNodes;for(let r=0;r<o.length;++r){const e=o[r];if(e.nodeType===Node.ELEMENT_NODE){const n={};XQe(e,n),t.push(QQe(e,n))}}return t}function XQe(e,t){let n=!0;for(let i=0;i<e.childNodes.length;++i){const o=e.childNodes[i];o.nodeType===Node.ELEMENT_NODE&&(n=!1),"Point"!==o.localName&&"LineString"!==o.localName&&"Polygon"!==o.localName&&"boundedBy"!==o.localName&&(o.hasChildNodes()&&XQe(o,t)&&(t[o.localName]=o.textContent))}return n}function QQe(e,t){const n=new $Ge;return n.data=e,n.properties=t,n.configureNameFromProperties(t),n.configureDescriptionFromProperties(t),n}function JQe(e){const t=(new XMLSerializer).serializeToString(e),n=document.createElement("div"),i=document.createElement("pre");i.textContent=t,n.appendChild(i);const o=new $Ge;return o.data=e,o.description=n.innerHTML,[o]}const ZQe=/<body>\s*<\/body>/im,$Qe=/<ServiceExceptionReport([\s\S]*)<\/ServiceExceptionReport>/im,eJe=/<title>([\s\S]*)<\/title>/im;function tJe(e){if(ZQe.test(e))return;if($Qe.test(e))return;let t;const n=eJe.exec(e);n&&n.length>1&&(t=n[1]);const i=new $Ge;return i.name=t,i.description=e,i.data=e,[i]}var nJe=zQe,iJe="uniform vec4 u_initialColor;\n\n#if TEXTURE_UNITS > 0\nuniform sampler2D u_dayTextures[TEXTURE_UNITS];\nuniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\nuniform bool u_dayTextureUseWebMercatorT[TEXTURE_UNITS];\n\n#ifdef APPLY_ALPHA\nuniform float u_dayTextureAlpha[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_DAY_NIGHT_ALPHA\nuniform float u_dayTextureNightAlpha[TEXTURE_UNITS];\nuniform float u_dayTextureDayAlpha[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_SPLIT\nuniform float u_dayTextureSplit[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_BRIGHTNESS\nuniform float u_dayTextureBrightness[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_CONTRAST\nuniform float u_dayTextureContrast[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_HUE\nuniform float u_dayTextureHue[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_SATURATION\nuniform float u_dayTextureSaturation[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_GAMMA\nuniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_IMAGERY_CUTOUT\nuniform vec4 u_dayTextureCutoutRectangles[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_COLOR_TO_ALPHA\nuniform vec4 u_colorsToAlpha[TEXTURE_UNITS];\n#endif\n\nuniform vec4 u_dayTextureTexCoordsRectangle[TEXTURE_UNITS];\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\nuniform sampler2D u_waterMask;\nuniform vec4 u_waterMaskTranslationAndScale;\nuniform float u_zoomedOutOceanSpecularIntensity;\n#endif\n\n#ifdef SHOW_OCEAN_WAVES\nuniform sampler2D u_oceanNormalMap;\n#endif\n\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\nuniform vec2 u_lightingFadeDistance;\n#endif\n\n#ifdef TILE_LIMIT_RECTANGLE\nuniform vec4 u_cartographicLimitRectangle;\n#endif\n\n#ifdef GROUND_ATMOSPHERE\nuniform vec2 u_nightFadeDistance;\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\nuniform highp sampler2D u_clippingPlanes;\nuniform mat4 u_clippingPlanesMatrix;\nuniform vec4 u_clippingPlanesEdgeStyle;\n#endif\n\n#if defined(FOG) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\nuniform float u_minimumBrightness;\n#endif\n\n#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift; // Hue, saturation, brightness\n#endif\n\n#ifdef HIGHLIGHT_FILL_TILE\nuniform vec4 u_fillHighlightColor;\n#endif\n\n#ifdef TRANSLUCENT\nuniform vec4 u_frontFaceAlphaByDistance;\nuniform vec4 u_backFaceAlphaByDistance;\nuniform vec4 u_translucencyRectangle;\n#endif\n\n#ifdef UNDERGROUND_COLOR\nuniform vec4 u_undergroundColor;\nuniform vec4 u_undergroundColorAlphaByDistance;\n#endif\n\n#ifdef ENABLE_VERTEX_LIGHTING\nuniform float u_lambertDiffuseMultiplier;\n#endif\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n\n#ifdef APPLY_MATERIAL\nvarying float v_height;\nvarying float v_slope;\nvarying float v_aspect;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nvarying float v_distance;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying vec3 v_fogRayleighColor;\nvarying vec3 v_fogMieColor;\n#endif\n\n#ifdef GROUND_ATMOSPHERE\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\n#endif\n\n#if defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nfloat interpolateByDistance(vec4 nearFarScalar, float distance)\n{\n    float startDistance = nearFarScalar.x;\n    float startValue = nearFarScalar.y;\n    float endDistance = nearFarScalar.z;\n    float endValue = nearFarScalar.w;\n    float t = clamp((distance - startDistance) / (endDistance - startDistance), 0.0, 1.0);\n    return mix(startValue, endValue, t);\n}\n#endif\n\n#if defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT) || defined(APPLY_MATERIAL)\nvec4 alphaBlend(vec4 sourceColor, vec4 destinationColor)\n{\n    return sourceColor * vec4(sourceColor.aaa, 1.0) + destinationColor * (1.0 - sourceColor.a);\n}\n#endif\n\n#ifdef TRANSLUCENT\nbool inTranslucencyRectangle()\n{\n    return\n        v_textureCoordinates.x > u_translucencyRectangle.x &&\n        v_textureCoordinates.x < u_translucencyRectangle.z &&\n        v_textureCoordinates.y > u_translucencyRectangle.y &&\n        v_textureCoordinates.y < u_translucencyRectangle.w;\n}\n#endif\n\nvec4 sampleAndBlend(\n    vec4 previousColor,\n    sampler2D textureToSample,\n    vec2 tileTextureCoordinates,\n    vec4 textureCoordinateRectangle,\n    vec4 textureCoordinateTranslationAndScale,\n    float textureAlpha,\n    float textureNightAlpha,\n    float textureDayAlpha,\n    float textureBrightness,\n    float textureContrast,\n    float textureHue,\n    float textureSaturation,\n    float textureOneOverGamma,\n    float split,\n    vec4 colorToAlpha,\n    float nightBlend)\n{\n    // This crazy step stuff sets the alpha to 0.0 if this following condition is true:\n    //    tileTextureCoordinates.s < textureCoordinateRectangle.s ||\n    //    tileTextureCoordinates.s > textureCoordinateRectangle.p ||\n    //    tileTextureCoordinates.t < textureCoordinateRectangle.t ||\n    //    tileTextureCoordinates.t > textureCoordinateRectangle.q\n    // In other words, the alpha is zero if the fragment is outside the rectangle\n    // covered by this texture.  Would an actual 'if' yield better performance?\n    vec2 alphaMultiplier = step(textureCoordinateRectangle.st, tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n\n    alphaMultiplier = step(vec2(0.0), textureCoordinateRectangle.pq - tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n\n#if defined(APPLY_DAY_NIGHT_ALPHA) && defined(ENABLE_DAYNIGHT_SHADING)\n    textureAlpha *= mix(textureDayAlpha, textureNightAlpha, nightBlend);\n#endif\n\n    vec2 translation = textureCoordinateTranslationAndScale.xy;\n    vec2 scale = textureCoordinateTranslationAndScale.zw;\n    vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\n    vec4 value = texture2D(textureToSample, textureCoordinates);\n    vec3 color = value.rgb;\n    float alpha = value.a;\n\n#ifdef APPLY_COLOR_TO_ALPHA\n    vec3 colorDiff = abs(color.rgb - colorToAlpha.rgb);\n    colorDiff.r = max(max(colorDiff.r, colorDiff.g), colorDiff.b);\n    alpha = czm_branchFreeTernary(colorDiff.r < colorToAlpha.a, 0.0, alpha);\n#endif\n\n#if !defined(APPLY_GAMMA)\n    vec4 tempColor = czm_gammaCorrect(vec4(color, alpha));\n    color = tempColor.rgb;\n    alpha = tempColor.a;\n#else\n    color = pow(color, vec3(textureOneOverGamma));\n#endif\n\n#ifdef APPLY_SPLIT\n    float splitPosition = czm_splitPosition;\n    // Split to the left\n    if (split < 0.0 && gl_FragCoord.x > splitPosition) {\n       alpha = 0.0;\n    }\n    // Split to the right\n    else if (split > 0.0 && gl_FragCoord.x < splitPosition) {\n       alpha = 0.0;\n    }\n#endif\n\n#ifdef APPLY_BRIGHTNESS\n    color = mix(vec3(0.0), color, textureBrightness);\n#endif\n\n#ifdef APPLY_CONTRAST\n    color = mix(vec3(0.5), color, textureContrast);\n#endif\n\n#ifdef APPLY_HUE\n    color = czm_hue(color, textureHue);\n#endif\n\n#ifdef APPLY_SATURATION\n    color = czm_saturation(color, textureSaturation);\n#endif\n\n    float sourceAlpha = alpha * textureAlpha;\n    float outAlpha = mix(previousColor.a, 1.0, sourceAlpha);\n    outAlpha += sign(outAlpha) - 1.0;\n\n    vec3 outColor = mix(previousColor.rgb * previousColor.a, color, sourceAlpha) / outAlpha;\n\n    // When rendering imagery for a tile in multiple passes,\n    // some GPU/WebGL implementation combinations will not blend fragments in\n    // additional passes correctly if their computation includes an unmasked\n    // divide-by-zero operation,\n    // even if it's not in the output or if the output has alpha zero.\n    //\n    // For example, without sanitization for outAlpha,\n    // this renders without artifacts:\n    //   if (outAlpha == 0.0) { outColor = vec3(0.0); }\n    //\n    // but using czm_branchFreeTernary will cause portions of the tile that are\n    // alpha-zero in the additional pass to render as black instead of blending\n    // with the previous pass:\n    //   outColor = czm_branchFreeTernary(outAlpha == 0.0, vec3(0.0), outColor);\n    //\n    // So instead, sanitize against divide-by-zero,\n    // store this state on the sign of outAlpha, and correct on return.\n\n    return vec4(outColor, max(outAlpha, 0.0));\n}\n\nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n    return rgb;\n}\n\nvec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates, float nightBlend);\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float specularMapValue, float fade);\n\n#ifdef GROUND_ATMOSPHERE\nvec3 computeGroundAtmosphereColor(vec3 fogColor, vec4 finalColor, vec3 atmosphereLightDirection, float cameraDist);\n#endif\n\nconst float fExposure = 2.0;\n\nvoid main()\n{\n#ifdef TILE_LIMIT_RECTANGLE\n    if (v_textureCoordinates.x < u_cartographicLimitRectangle.x || u_cartographicLimitRectangle.z < v_textureCoordinates.x ||\n        v_textureCoordinates.y < u_cartographicLimitRectangle.y || u_cartographicLimitRectangle.w < v_textureCoordinates.y)\n        {\n            discard;\n        }\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\n    float clipDistance = clip(gl_FragCoord, u_clippingPlanes, u_clippingPlanesMatrix);\n#endif\n\n#if defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(HDR)\n    vec3 normalMC = czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));   // normalized surface normal in model coordinates\n    vec3 normalEC = czm_normal3D * normalMC;                                         // normalized surface normal in eye coordiantes\n#endif\n\n#if defined(APPLY_DAY_NIGHT_ALPHA) && defined(ENABLE_DAYNIGHT_SHADING)\n    float nightBlend = 1.0 - clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0, 0.0, 1.0);\n#else\n    float nightBlend = 0.0;\n#endif\n\n    // The clamp below works around an apparent bug in Chrome Canary v23.0.1241.0\n    // where the fragment shader sees textures coordinates < 0.0 and > 1.0 for the\n    // fragments on the edges of tiles even though the vertex shader is outputting\n    // coordinates strictly in the 0-1 range.\n    vec4 color = computeDayColor(u_initialColor, clamp(v_textureCoordinates, 0.0, 1.0), nightBlend);\n\n#ifdef SHOW_TILE_BOUNDARIES\n    if (v_textureCoordinates.x < (1.0/256.0) || v_textureCoordinates.x > (255.0/256.0) ||\n        v_textureCoordinates.y < (1.0/256.0) || v_textureCoordinates.y > (255.0/256.0))\n    {\n        color = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n#endif\n\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\n    float cameraDist;\n    if (czm_sceneMode == czm_sceneMode2D)\n    {\n        cameraDist = max(czm_frustumPlanes.x - czm_frustumPlanes.y, czm_frustumPlanes.w - czm_frustumPlanes.z) * 0.5;\n    }\n    else if (czm_sceneMode == czm_sceneModeColumbusView)\n    {\n        cameraDist = -czm_view[3].z;\n    }\n    else\n    {\n        cameraDist = length(czm_view[3]);\n    }\n    float fadeOutDist = u_lightingFadeDistance.x;\n    float fadeInDist = u_lightingFadeDistance.y;\n    if (czm_sceneMode != czm_sceneMode3D) {\n        vec3 radii = czm_ellipsoidRadii;\n        float maxRadii = max(radii.x, max(radii.y, radii.z));\n        fadeOutDist -= maxRadii;\n        fadeInDist -= maxRadii;\n    }\n    float fade = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n#else\n    float fade = 0.0;\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\n    vec2 waterMaskTranslation = u_waterMaskTranslationAndScale.xy;\n    vec2 waterMaskScale = u_waterMaskTranslationAndScale.zw;\n    vec2 waterMaskTextureCoordinates = v_textureCoordinates.xy * waterMaskScale + waterMaskTranslation;\n    waterMaskTextureCoordinates.y = 1.0 - waterMaskTextureCoordinates.y;\n\n    float mask = texture2D(u_waterMask, waterMaskTextureCoordinates).r;\n\n    if (mask > 0.0)\n    {\n        mat3 enuToEye = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalEC);\n\n        vec2 ellipsoidTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC);\n        vec2 ellipsoidFlippedTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC.zyx);\n\n        vec2 textureCoordinates = mix(ellipsoidTextureCoordinates, ellipsoidFlippedTextureCoordinates, czm_morphTime * smoothstep(0.9, 0.95, normalMC.z));\n\n        color = computeWaterColor(v_positionEC, textureCoordinates, enuToEye, color, mask, fade);\n    }\n#endif\n\n#ifdef APPLY_MATERIAL\n    czm_materialInput materialInput;\n    materialInput.st = v_textureCoordinates.st;\n    materialInput.normalEC = normalize(v_normalEC);\n    materialInput.positionToEyeEC = -v_positionEC;\n    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalize(v_normalEC));     \n    materialInput.slope = v_slope;\n    materialInput.height = v_height;\n    materialInput.aspect = v_aspect;\n    czm_material material = czm_getMaterial(materialInput);\n    vec4 materialColor = vec4(material.diffuse, material.alpha);\n    color = alphaBlend(materialColor, color);\n#endif\n\n#ifdef ENABLE_VERTEX_LIGHTING\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalize(v_normalEC)) * u_lambertDiffuseMultiplier + 0.3, 0.0, 1.0);\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#elif defined(ENABLE_DAYNIGHT_SHADING)\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0 + 0.3, 0.0, 1.0);\n    diffuseIntensity = mix(1.0, diffuseIntensity, fade);\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#else\n    vec4 finalColor = color;\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\n    vec4 clippingPlanesEdgeColor = vec4(1.0);\n    clippingPlanesEdgeColor.rgb = u_clippingPlanesEdgeStyle.rgb;\n    float clippingPlanesEdgeWidth = u_clippingPlanesEdgeStyle.a;\n\n    if (clipDistance < clippingPlanesEdgeWidth)\n    {\n        finalColor = clippingPlanesEdgeColor;\n    }\n#endif\n\n#ifdef HIGHLIGHT_FILL_TILE\n    finalColor = vec4(mix(finalColor.rgb, u_fillHighlightColor.rgb, u_fillHighlightColor.a), finalColor.a);\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\n    vec3 fogColor = colorCorrect(v_fogMieColor) + finalColor.rgb * colorCorrect(v_fogRayleighColor);\n#ifndef HDR\n    fogColor = vec3(1.0) - exp(-fExposure * fogColor);\n#endif\n#endif\n\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN)\n    vec3 atmosphereLightDirection = czm_sunDirectionWC;\n#else\n    vec3 atmosphereLightDirection = czm_lightDirectionWC;\n#endif\n\n#ifdef FOG\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\n    float darken = clamp(dot(normalize(czm_viewerPositionWC), atmosphereLightDirection), u_minimumBrightness, 1.0);\n    fogColor *= darken;\n#endif\n\n#ifdef HDR\n    const float modifier = 0.15;\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor, modifier), finalColor.a);\n#else\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor), finalColor.a);\n#endif\n#endif\n\n#ifdef GROUND_ATMOSPHERE\n    if (!czm_backFacing())\n    {\n        vec3 groundAtmosphereColor = computeGroundAtmosphereColor(fogColor, finalColor, atmosphereLightDirection, cameraDist);\n        finalColor = vec4(mix(finalColor.rgb, groundAtmosphereColor, fade), finalColor.a);\n    }\n#endif\n\n#ifdef UNDERGROUND_COLOR\n    if (czm_backFacing())\n    {\n        float distanceFromEllipsoid = max(czm_eyeHeight, 0.0);\n        float distance = max(v_distance - distanceFromEllipsoid, 0.0);\n        float blendAmount = interpolateByDistance(u_undergroundColorAlphaByDistance, distance);\n        vec4 undergroundColor = vec4(u_undergroundColor.rgb, u_undergroundColor.a * blendAmount);\n        finalColor = alphaBlend(undergroundColor, finalColor);\n    }\n#endif\n\n#ifdef TRANSLUCENT\n    if (inTranslucencyRectangle())\n    {\n      vec4 alphaByDistance = gl_FrontFacing ? u_frontFaceAlphaByDistance : u_backFaceAlphaByDistance;\n      finalColor.a *= interpolateByDistance(alphaByDistance, v_distance);\n    }\n#endif\n\n    gl_FragColor = finalColor;\n}\n\n#ifdef GROUND_ATMOSPHERE\nvec3 computeGroundAtmosphereColor(vec3 fogColor, vec4 finalColor, vec3 atmosphereLightDirection, float cameraDist)\n{\n#if defined(PER_FRAGMENT_GROUND_ATMOSPHERE) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_DAYNIGHT_SHADING) || defined(ENABLE_VERTEX_LIGHTING))\n    float mpp = czm_metersPerPixel(vec4(0.0, 0.0, -czm_currentFrustum.x, 1.0), 1.0);\n    vec2 xy = gl_FragCoord.xy / czm_viewport.zw * 2.0 - vec2(1.0);\n    xy *= czm_viewport.zw * mpp * 0.5;\n\n    vec3 direction = normalize(vec3(xy, -czm_currentFrustum.x));\n    czm_ray ray = czm_ray(vec3(0.0), direction);\n\n    vec3 ellipsoid_center = czm_view[3].xyz;\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\n\n    vec3 ellipsoidPosition = czm_pointAlongRay(ray, intersection.start);\n    ellipsoidPosition = (czm_inverseView * vec4(ellipsoidPosition, 1.0)).xyz;\n    AtmosphereColor atmosColor = computeGroundAtmosphereFromSpace(ellipsoidPosition, true, atmosphereLightDirection);\n\n    vec3 groundAtmosphereColor = colorCorrect(atmosColor.mie) + finalColor.rgb * colorCorrect(atmosColor.rayleigh);\n#ifndef HDR\n    groundAtmosphereColor = vec3(1.0) - exp(-fExposure * groundAtmosphereColor);\n#endif\n\n    float fadeInDist = u_nightFadeDistance.x;\n    float fadeOutDist = u_nightFadeDistance.y;\n\n    float sunlitAtmosphereIntensity = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n\n#ifdef HDR\n    // Some tweaking to make HDR look better\n    sunlitAtmosphereIntensity = max(sunlitAtmosphereIntensity * sunlitAtmosphereIntensity, 0.03);\n#endif\n\n    groundAtmosphereColor = mix(groundAtmosphereColor, fogColor, sunlitAtmosphereIntensity);\n#else\n    vec3 groundAtmosphereColor = fogColor;\n#endif\n\n#ifdef HDR\n    // Some tweaking to make HDR look better\n    groundAtmosphereColor = czm_saturation(groundAtmosphereColor, 1.6);\n#endif\n\n    return groundAtmosphereColor;\n}\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\n\nfloat waveFade(float edge0, float edge1, float x)\n{\n    float y = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return pow(1.0 - y, 5.0);\n}\n\nfloat linearFade(float edge0, float edge1, float x)\n{\n    return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\n\n// Based on water rendering by Jonas Wagner:\n// http://29a.ch/2012/7/19/webgl-terrain-rendering-water-fog\n\n// low altitude wave settings\nconst float oceanFrequencyLowAltitude = 825000.0;\nconst float oceanAnimationSpeedLowAltitude = 0.004;\nconst float oceanOneOverAmplitudeLowAltitude = 1.0 / 2.0;\nconst float oceanSpecularIntensity = 0.5;\n\n// high altitude wave settings\nconst float oceanFrequencyHighAltitude = 125000.0;\nconst float oceanAnimationSpeedHighAltitude = 0.008;\nconst float oceanOneOverAmplitudeHighAltitude = 1.0 / 2.0;\n\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float maskValue, float fade)\n{\n    vec3 positionToEyeEC = -positionEyeCoordinates;\n    float positionToEyeECLength = length(positionToEyeEC);\n\n    // The double normalize below works around a bug in Firefox on Android devices.\n    vec3 normalizedPositionToEyeEC = normalize(normalize(positionToEyeEC));\n\n    // Fade out the waves as the camera moves far from the surface.\n    float waveIntensity = waveFade(70000.0, 1000000.0, positionToEyeECLength);\n\n#ifdef SHOW_OCEAN_WAVES\n    // high altitude waves\n    float time = czm_frameNumber * oceanAnimationSpeedHighAltitude;\n    vec4 noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyHighAltitude, time, 0.0);\n    vec3 normalTangentSpaceHighAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeHighAltitude);\n\n    // low altitude waves\n    time = czm_frameNumber * oceanAnimationSpeedLowAltitude;\n    noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyLowAltitude, time, 0.0);\n    vec3 normalTangentSpaceLowAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeLowAltitude);\n\n    // blend the 2 wave layers based on distance to surface\n    float highAltitudeFade = linearFade(0.0, 60000.0, positionToEyeECLength);\n    float lowAltitudeFade = 1.0 - linearFade(20000.0, 60000.0, positionToEyeECLength);\n    vec3 normalTangentSpace =\n        (highAltitudeFade * normalTangentSpaceHighAltitude) +\n        (lowAltitudeFade * normalTangentSpaceLowAltitude);\n    normalTangentSpace = normalize(normalTangentSpace);\n\n    // fade out the normal perturbation as we move farther from the water surface\n    normalTangentSpace.xy *= waveIntensity;\n    normalTangentSpace = normalize(normalTangentSpace);\n#else\n    vec3 normalTangentSpace = vec3(0.0, 0.0, 1.0);\n#endif\n\n    vec3 normalEC = enuToEye * normalTangentSpace;\n\n    const vec3 waveHighlightColor = vec3(0.3, 0.45, 0.6);\n\n    // Use diffuse light to highlight the waves\n    float diffuseIntensity = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * maskValue;\n    vec3 diffuseHighlight = waveHighlightColor * diffuseIntensity * (1.0 - fade);\n\n#ifdef SHOW_OCEAN_WAVES\n    // Where diffuse light is low or non-existent, use wave highlights based solely on\n    // the wave bumpiness and no particular light direction.\n    float tsPerturbationRatio = normalTangentSpace.z;\n    vec3 nonDiffuseHighlight = mix(waveHighlightColor * 5.0 * (1.0 - tsPerturbationRatio), vec3(0.0), diffuseIntensity);\n#else\n    vec3 nonDiffuseHighlight = vec3(0.0);\n#endif\n\n    // Add specular highlights in 3D, and in all modes when zoomed in.\n    float specularIntensity = czm_getSpecular(czm_lightDirectionEC, normalizedPositionToEyeEC, normalEC, 10.0);\n    float surfaceReflectance = mix(0.0, mix(u_zoomedOutOceanSpecularIntensity, oceanSpecularIntensity, waveIntensity), maskValue);\n    float specular = specularIntensity * surfaceReflectance;\n\n#ifdef HDR\n    specular *= 1.4;\n\n    float e = 0.2;\n    float d = 3.3;\n    float c = 1.7;\n\n    vec3 color = imageryColor.rgb + (c * (vec3(e) + imageryColor.rgb * d) * (diffuseHighlight + nonDiffuseHighlight + specular));\n#else\n    vec3 color = imageryColor.rgb + diffuseHighlight + nonDiffuseHighlight + specular;\n#endif\n\n    return vec4(color, imageryColor.a);\n}\n\n#endif // #ifdef SHOW_REFLECTIVE_OCEAN\n",oJe="#ifdef QUANTIZATION_BITS12\nattribute vec4 compressed0;\nattribute float compressed1;\n#else\nattribute vec4 position3DAndHeight;\nattribute vec4 textureCoordAndEncodedNormals;\n#endif\n\n#ifdef GEODETIC_SURFACE_NORMALS\nattribute vec3 geodeticSurfaceNormal;\n#endif\n\n#ifdef EXAGGERATION\nuniform vec2 u_terrainExaggerationAndRelativeHeight;\n#endif\n\nuniform vec3 u_center3D;\nuniform mat4 u_modifiedModelView;\nuniform mat4 u_modifiedModelViewProjection;\nuniform vec4 u_tileRectangle;\n\n// Uniforms for 2D Mercator projection\nuniform vec2 u_southAndNorthLatitude;\nuniform vec2 u_southMercatorYAndOneOverHeight;\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\n\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n\n#ifdef APPLY_MATERIAL\nvarying float v_slope;\nvarying float v_aspect;\nvarying float v_height;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nvarying float v_distance;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying vec3 v_fogMieColor;\nvarying vec3 v_fogRayleighColor;\n#endif\n\n// These functions are generated at runtime.\nvec4 getPosition(vec3 position, float height, vec2 textureCoordinates);\nfloat get2DYPositionFraction(vec2 textureCoordinates);\n\nvec4 getPosition3DMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    return u_modifiedModelViewProjection * vec4(position, 1.0);\n}\n\nfloat get2DMercatorYPositionFraction(vec2 textureCoordinates)\n{\n    // The width of a tile at level 11, in radians and assuming a single root tile, is\n    //   2.0 * czm_pi / pow(2.0, 11.0)\n    // We want to just linearly interpolate the 2D position from the texture coordinates\n    // when we're at this level or higher.  The constant below is the expression\n    // above evaluated and then rounded up at the 4th significant digit.\n    const float maxTileWidth = 0.003068;\n    float positionFraction = textureCoordinates.y;\n    float southLatitude = u_southAndNorthLatitude.x;\n    float northLatitude = u_southAndNorthLatitude.y;\n    if (northLatitude - southLatitude > maxTileWidth)\n    {\n        float southMercatorY = u_southMercatorYAndOneOverHeight.x;\n        float oneOverMercatorHeight = u_southMercatorYAndOneOverHeight.y;\n\n        float currentLatitude = mix(southLatitude, northLatitude, textureCoordinates.y);\n        currentLatitude = clamp(currentLatitude, -czm_webMercatorMaxLatitude, czm_webMercatorMaxLatitude);\n        positionFraction = czm_latitudeToWebMercatorFraction(currentLatitude, southMercatorY, oneOverMercatorHeight);\n    }\n    return positionFraction;\n}\n\nfloat get2DGeographicYPositionFraction(vec2 textureCoordinates)\n{\n    return textureCoordinates.y;\n}\n\nvec4 getPositionPlanarEarth(vec3 position, float height, vec2 textureCoordinates)\n{\n    float yPositionFraction = get2DYPositionFraction(textureCoordinates);\n    vec4 rtcPosition2D = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\n    return u_modifiedModelViewProjection * rtcPosition2D;\n}\n\nvec4 getPosition2DMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    return getPositionPlanarEarth(position, 0.0, textureCoordinates);\n}\n\nvec4 getPositionColumbusViewMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    return getPositionPlanarEarth(position, height, textureCoordinates);\n}\n\nvec4 getPositionMorphingMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    // We do not do RTC while morphing, so there is potential for jitter.\n    // This is unlikely to be noticeable, though.\n    vec3 position3DWC = position + u_center3D;\n    float yPositionFraction = get2DYPositionFraction(textureCoordinates);\n    vec4 position2DWC = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\n    vec4 morphPosition = czm_columbusViewMorph(position2DWC, vec4(position3DWC, 1.0), czm_morphTime);\n    return czm_modelViewProjection * morphPosition;\n}\n\n#ifdef QUANTIZATION_BITS12\nuniform vec2 u_minMaxHeight;\nuniform mat4 u_scaleAndBias;\n#endif\n\nvoid main()\n{\n#ifdef QUANTIZATION_BITS12\n    vec2 xy = czm_decompressTextureCoordinates(compressed0.x);\n    vec2 zh = czm_decompressTextureCoordinates(compressed0.y);\n    vec3 position = vec3(xy, zh.x);\n    float height = zh.y;\n    vec2 textureCoordinates = czm_decompressTextureCoordinates(compressed0.z);\n\n    height = height * (u_minMaxHeight.y - u_minMaxHeight.x) + u_minMaxHeight.x;\n    position = (u_scaleAndBias * vec4(position, 1.0)).xyz;\n\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\n    float encodedNormal = compressed1;\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\n    float encodedNormal = 0.0;\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = compressed0.w;\n#else\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = 0.0;\n#endif\n\n#else\n    // A single float per element\n    vec3 position = position3DAndHeight.xyz;\n    float height = position3DAndHeight.w;\n    vec2 textureCoordinates = textureCoordAndEncodedNormals.xy;\n\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = textureCoordAndEncodedNormals.z;\n    float encodedNormal = textureCoordAndEncodedNormals.w;\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = textureCoordAndEncodedNormals.z;\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = textureCoordAndEncodedNormals.z;\n    float encodedNormal = 0.0;\n#else\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = 0.0;\n#endif\n\n#endif\n\n    vec3 position3DWC = position + u_center3D;\n\n#ifdef GEODETIC_SURFACE_NORMALS\n    vec3 ellipsoidNormal = geodeticSurfaceNormal;\n#else\n    vec3 ellipsoidNormal = normalize(position3DWC);\n#endif\n\n#if defined(EXAGGERATION) && defined(GEODETIC_SURFACE_NORMALS)\n    float exaggeration = u_terrainExaggerationAndRelativeHeight.x;\n    float relativeHeight = u_terrainExaggerationAndRelativeHeight.y;\n    float newHeight = (height - relativeHeight) * exaggeration + relativeHeight;\n\n    // stop from going through center of earth\n    float minRadius = min(min(czm_ellipsoidRadii.x, czm_ellipsoidRadii.y), czm_ellipsoidRadii.z);\n    newHeight = max(newHeight, -minRadius);\n\n    vec3 offset = ellipsoidNormal * (newHeight - height);\n    position += offset;\n    position3DWC += offset;\n    height = newHeight;\n#endif\n\n    gl_Position = getPosition(position, height, textureCoordinates);\n\n    v_textureCoordinates = vec3(textureCoordinates, webMercatorT);\n\n#if defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\n    v_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\n    v_positionMC = position3DWC;  // position in model coordinates\n    vec3 normalMC = czm_octDecode(encodedNormal);\n\n#if defined(EXAGGERATION) && defined(GEODETIC_SURFACE_NORMALS)\n    vec3 projection = dot(normalMC, ellipsoidNormal) * ellipsoidNormal;\n    vec3 rejection = normalMC - projection;\n    normalMC = normalize(projection + rejection * exaggeration);\n#endif\n\n    v_normalMC = normalMC;\n    v_normalEC = czm_normal3D * v_normalMC;\n#elif defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(GENERATE_POSITION) || defined(HDR)\n    v_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\n    v_positionMC = position3DWC;  // position in model coordinates\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\n    AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(position3DWC, false, vec3(0.0));\n    v_fogMieColor = atmosFogColor.mie;\n    v_fogRayleighColor = atmosFogColor.rayleigh;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\n    v_distance = length((czm_modelView3D * vec4(position3DWC, 1.0)).xyz);\n#endif\n\n#ifdef APPLY_MATERIAL\n    float northPoleZ = czm_ellipsoidRadii.z;\n    vec3 northPolePositionMC = vec3(0.0, 0.0, northPoleZ);\n    vec3 vectorEastMC = normalize(cross(northPolePositionMC - v_positionMC, ellipsoidNormal));\n    float dotProd = abs(dot(ellipsoidNormal, v_normalMC));\n    v_slope = acos(dotProd);\n    vec3 normalRejected = ellipsoidNormal * dotProd;\n    vec3 normalProjected = v_normalMC - normalRejected;\n    vec3 aspectVector = normalize(normalProjected);\n    v_aspect = acos(dot(aspectVector, vectorEastMC));\n    float determ = dot(cross(vectorEastMC, aspectVector), ellipsoidNormal);\n    v_aspect = czm_branchFreeTernary(determ < 0.0, 2.0 * czm_pi - v_aspect, v_aspect);\n    v_height = height;\n#endif\n}\n",rJe="/*!\n * Atmosphere code:\n *\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * * Neither the name of the project nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Modifications made by Analytical Graphics, Inc.\n */\n\n // Atmosphere:\n //   Code:  http://sponeil.net/\n //   GPU Gems 2 Article:  https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\n\nconst float Kr = 0.0025;\nconst float Km = 0.0015;\nconst float ESun = 15.0;\n\nconst float fKrESun = Kr * ESun;\nconst float fKmESun = Km * ESun;\nconst float fKr4PI = Kr * 4.0 * czm_pi;\nconst float fKm4PI = Km * 4.0 * czm_pi;\n\n// Original: vec3(1.0 / pow(0.650, 4.0), 1.0 / pow(0.570, 4.0), 1.0 / pow(0.475, 4.0));\nconst vec3 v3InvWavelength = vec3(5.60204474633241, 9.473284437923038, 19.64380261047721);\n\nconst float fScaleDepth = 0.25;\n\nstruct AtmosphereColor\n{\n    vec3 mie;\n    vec3 rayleigh;\n};\n\nconst int nSamples = 2;\nconst float fSamples = 2.0;\n\nfloat scale(float fCos)\n{\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nAtmosphereColor computeGroundAtmosphereFromSpace(vec3 v3Pos, bool dynamicLighting, vec3 lightDirectionWC)\n{\n    float fInnerRadius = czm_ellipsoidRadii.x;\n    float fOuterRadius = czm_ellipsoidRadii.x * 1.025;\n    float fOuterRadius2 = fOuterRadius * fOuterRadius;\n\n    float fScale = 1.0 / (fOuterRadius - fInnerRadius);\n    float fScaleOverScaleDepth = fScale / fScaleDepth;\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 v3Ray = v3Pos - czm_viewerPositionWC;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n\n    float fCameraHeight = length(czm_viewerPositionWC);\n    float fCameraHeight2 = fCameraHeight * fCameraHeight;\n\n    // This next line is an ANGLE workaround. It is equivalent to B = 2.0 * dot(czm_viewerPositionWC, v3Ray),\n    // which is what it should be, but there are problems at the poles.\n    float B = 2.0 * length(czm_viewerPositionWC) * dot(normalize(czm_viewerPositionWC), v3Ray);\n    float C = fCameraHeight2 - fOuterRadius2;\n    float fDet = max(0.0, B*B - 4.0 * C);\n    float fNear = 0.5 * (-B - sqrt(fDet));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start = czm_viewerPositionWC + v3Ray * fNear;\n    fFar -= fNear;\n    float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\n\n    // The light angle based on the scene's light source would be:\n    //    dot(lightDirectionWC, v3Pos) / length(v3Pos);\n    // When we want the atmosphere to be uniform over the globe so it is set to 1.0.\n\n    float fLightAngle = czm_branchFreeTernary(dynamicLighting, dot(lightDirectionWC, v3Pos) / length(v3Pos), 1.0);\n    float fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\n    float fCameraScale = scale(fCameraAngle);\n    float fLightScale = scale(fLightAngle);\n    float fCameraOffset = fDepth*fCameraScale;\n    float fTemp = (fLightScale + fCameraScale);\n\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0);\n    vec3 v3Attenuate = vec3(0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n        float fHeight = length(v3SamplePoint);\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n        float fScatter = fDepth*fTemp - fCameraOffset;\n        v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n        v3SamplePoint += v3SampleRay;\n    }\n\n    AtmosphereColor color;\n    color.mie = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\n    color.rayleigh = v3Attenuate; // Calculate the attenuation factor for the ground\n\n    return color;\n}\n\n";function sJe(e,t,n,i,o){this.numberOfDayTextures=e,this.flags=t,this.material=n,this.shaderProgram=i,this.clippingShaderState=o}function aJe(){this.baseVertexShaderSource=void 0,this.baseFragmentShaderSource=void 0,this._shadersByTexturesFlags=[],this.material=void 0}function cJe(e){const t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPosition3DMode(position, height, textureCoordinates); }",n="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionColumbusViewMode(position, height, textureCoordinates); }",i="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionMorphingMode(position, height, textureCoordinates); }";let o;switch(e){case ij.SCENE3D:o=t;break;case ij.SCENE2D:case ij.COLUMBUS_VIEW:o=n;break;case ij.MORPHING:o=i;break}return o}function lJe(e){const t="float get2DYPositionFraction(vec2 textureCoordinates) { return get2DGeographicYPositionFraction(textureCoordinates); }",n="float get2DYPositionFraction(vec2 textureCoordinates) { return get2DMercatorYPositionFraction(textureCoordinates); }";return e?n:t}aJe.prototype.getShaderProgram=function(e){const t=e.frameState,n=e.surfaceTile,i=e.numberOfDayTextures,o=e.applyBrightness,r=e.applyContrast,s=e.applyHue,a=e.applySaturation,c=e.applyGamma,l=e.applyAlpha,u=e.applyDayNightAlpha,h=e.applySplit,d=e.showReflectiveOcean,f=e.showOceanWaves,p=e.enableLighting,m=e.dynamicAtmosphereLighting,_=e.dynamicAtmosphereLightingFromSun,g=e.showGroundAtmosphere,y=e.perFragmentGroundAtmosphere,v=e.hasVertexNormals,b=e.useWebMercatorProjection,A=e.enableFog,w=e.enableClippingPlanes,T=e.clippingPlanes,E=e.clippedByBoundaries,x=e.hasImageryLayerCutout,S=e.colorCorrect,I=e.highlightFillTile,O=e.colorToAlpha,D=e.hasGeodeticSurfaceNormals,P=e.hasExaggeration,R=e.showUndergroundColor,L=e.translucent;let M=0,B="";const N=n.renderedMesh,F=N.encoding,z=F.quantization;z===Sh.BITS12&&(M=1,B="QUANTIZATION_BITS12");let k=0,U="";E&&(k=1,U="TILE_LIMIT_RECTANGLE");let V=0,H="";x&&(V=1,H="APPLY_IMAGERY_CUTOUT");const G=t.mode,W=G|o<<2|r<<3|s<<4|a<<5|c<<6|l<<7|d<<8|f<<9|p<<10|m<<11|_<<12|g<<13|y<<14|v<<15|b<<16|A<<17|M<<18|h<<19|w<<20|k<<21|V<<22|S<<23|I<<24|O<<25|D<<26|P<<27|R<<28|L<<29|u<<30;let q=0;C(T)&&T.length>0&&(q=w?T.clippingPlanesState:0);let j=n.surfaceShader;if(C(j)&&j.numberOfDayTextures===i&&j.flags===W&&j.material===this.material&&j.clippingShaderState===q)return j.shaderProgram;let Y=this._shadersByTexturesFlags[i];if(C(Y)||(Y=this._shadersByTexturesFlags[i]=[]),j=Y[W],!C(j)||j.material!==this.material||j.clippingShaderState!==q){const e=this.baseVertexShaderSource.clone(),n=this.baseFragmentShaderSource.clone();0!==q&&n.sources.unshift(L3(T,t.context)),e.defines.push(B),n.defines.push(`TEXTURE_UNITS ${i}`,U,H),o&&n.defines.push("APPLY_BRIGHTNESS"),r&&n.defines.push("APPLY_CONTRAST"),s&&n.defines.push("APPLY_HUE"),a&&n.defines.push("APPLY_SATURATION"),c&&n.defines.push("APPLY_GAMMA"),l&&n.defines.push("APPLY_ALPHA"),u&&n.defines.push("APPLY_DAY_NIGHT_ALPHA"),d&&(n.defines.push("SHOW_REFLECTIVE_OCEAN"),e.defines.push("SHOW_REFLECTIVE_OCEAN")),f&&n.defines.push("SHOW_OCEAN_WAVES"),O&&n.defines.push("APPLY_COLOR_TO_ALPHA"),R&&(e.defines.push("UNDERGROUND_COLOR"),n.defines.push("UNDERGROUND_COLOR")),L&&(e.defines.push("TRANSLUCENT"),n.defines.push("TRANSLUCENT")),p&&(v?(e.defines.push("ENABLE_VERTEX_LIGHTING"),n.defines.push("ENABLE_VERTEX_LIGHTING")):(e.defines.push("ENABLE_DAYNIGHT_SHADING"),n.defines.push("ENABLE_DAYNIGHT_SHADING"))),m&&(n.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING"),_&&n.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN")),g&&(e.defines.push("GROUND_ATMOSPHERE"),n.defines.push("GROUND_ATMOSPHERE"),y&&n.defines.push("PER_FRAGMENT_GROUND_ATMOSPHERE")),e.defines.push("INCLUDE_WEB_MERCATOR_Y"),n.defines.push("INCLUDE_WEB_MERCATOR_Y"),A&&(e.defines.push("FOG"),n.defines.push("FOG")),h&&n.defines.push("APPLY_SPLIT"),w&&n.defines.push("ENABLE_CLIPPING_PLANES"),S&&n.defines.push("COLOR_CORRECT"),I&&n.defines.push("HIGHLIGHT_FILL_TILE"),D&&e.defines.push("GEODETIC_SURFACE_NORMALS"),P&&e.defines.push("EXAGGERATION");let C="    vec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates, float nightBlend)\n    {\n        vec4 color = initialColor;\n";x&&(C+="        vec4 cutoutAndColorResult;\n        bool texelUnclipped;\n");for(let t=0;t<i;++t)C+=x?`        cutoutAndColorResult = u_dayTextureCutoutRectangles[${t}];\n        texelUnclipped = v_textureCoordinates.x < cutoutAndColorResult.x || cutoutAndColorResult.z < v_textureCoordinates.x || v_textureCoordinates.y < cutoutAndColorResult.y || cutoutAndColorResult.w < v_textureCoordinates.y;\n        cutoutAndColorResult = sampleAndBlend(\n`:"        color = sampleAndBlend(\n",C+=`            color,\n            u_dayTextures[${t}],\n            u_dayTextureUseWebMercatorT[${t}] ? textureCoordinates.xz : textureCoordinates.xy,\n            u_dayTextureTexCoordsRectangle[${t}],\n            u_dayTextureTranslationAndScale[${t}],\n            ${l?`u_dayTextureAlpha[${t}]`:"1.0"},\n            ${u?`u_dayTextureNightAlpha[${t}]`:"1.0"},\n${u?`u_dayTextureDayAlpha[${t}]`:"1.0"},\n${o?`u_dayTextureBrightness[${t}]`:"0.0"},\n            ${r?`u_dayTextureContrast[${t}]`:"0.0"},\n            ${s?`u_dayTextureHue[${t}]`:"0.0"},\n            ${a?`u_dayTextureSaturation[${t}]`:"0.0"},\n            ${c?`u_dayTextureOneOverGamma[${t}]`:"0.0"},\n            ${h?`u_dayTextureSplit[${t}]`:"0.0"},\n            ${O?`u_colorsToAlpha[${t}]`:"vec4(0.0)"},\n        nightBlend        );\n`,x&&(C+="        color = czm_branchFreeTernary(texelUnclipped, cutoutAndColorResult, color);\n");C+="        return color;\n    }",n.sources.push(C),e.sources.push(cJe(G)),e.sources.push(lJe(b));const E=fH.fromCache({context:t.context,vertexShaderSource:e,fragmentShaderSource:n,attributeLocations:F.getAttributeLocations()});j=Y[W]=new sJe(i,W,this.material,E,q)}return n.surfaceShader=j,j.shaderProgram},aJe.prototype.destroy=function(){let e,t;const n=this._shadersByTexturesFlags;for(const i in n)if(n.hasOwnProperty(i)){const o=n[i];if(!C(o))continue;for(e in o)o.hasOwnProperty(e)&&(t=o[e],C(t)&&t.shaderProgram.destroy())}return Qh(this)};var uJe=aJe;const hJe={UNLOADED:0,TRANSITIONING:1,RECEIVED:2,TEXTURE_LOADED:3,READY:4,FAILED:5,INVALID:6,PLACEHOLDER:7};var dJe=Object.freeze(hJe);const fJe={START:0,LOADING:1,DONE:2,FAILED:3};var pJe=Object.freeze(fJe);const mJe={FAILED:0,UNLOADED:1,RECEIVING:2,RECEIVED:3,TRANSFORMING:4,TRANSFORMED:5,READY:6};var _Je=Object.freeze(mJe);function gJe(){this.imagery=[],this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new Xe(0,0,1,1),this.terrainData=void 0,this.vertexArray=void 0,this.tileBoundingRegion=void 0,this.occludeePointInScaledSpace=new K,this.boundingVolumeSourceTile=void 0,this.boundingVolumeIsFromMesh=!1,this.terrainState=_Je.UNLOADED,this.mesh=void 0,this.fill=void 0,this.pickBoundingSphere=new nn,this.surfaceShader=void 0,this.isClipped=!0,this.clippedByBoundaries=!1}Object.defineProperties(gJe.prototype,{eligibleForUnloading:{get:function(){const e=this.terrainState,t=e===_Je.RECEIVING||e===_Je.TRANSFORMING;let n=!t;const i=this.imagery;for(let o=0,r=i.length;n&&o<r;++o){const e=i[o];n=!C(e.loadingImagery)||e.loadingImagery.state!==dJe.TRANSITIONING}return n}},renderedMesh:{get:function(){return C(this.vertexArray)?this.mesh:C(this.fill)?this.fill.mesh:void 0}}});const yJe=new se;function vJe(e,t,n,i,o,r){let s=e.getExaggeratedPosition(i,o,r);if(C(t)&&t!==ij.SCENE3D){const e=n.ellipsoid,t=e.cartesianToCartographic(s,yJe);s=n.project(t,r),s=K.fromElements(s.z,s.x,s.y,r)}return s}const bJe=new K,AJe=new K,wJe=new K;function TJe(e,t,n,i){const o=e.renderedMesh,r=o.vertices,s=o.encoding,a=r.length/s.stride;let c=kh.clone(s);c.hasGeodeticSurfaceNormals=t,c=kh.clone(c);const l=c.stride,u=new Float32Array(a*l);t?s.addGeodeticSurfaceNormals(r,u,n):s.removeGeodeticSurfaceNormals(r,u),o.vertices=u,o.stride=l;const h=o!==e.mesh;h?(gJe._freeVertexArray(e.fill.vertexArray),e.fill.vertexArray=gJe._createVertexArrayForMesh(i.context,o)):(gJe._freeVertexArray(e.vertexArray),e.vertexArray=gJe._createVertexArrayForMesh(i.context,o)),gJe._freeVertexArray(e.wireframeVertexArray),e.wireframeVertexArray=void 0}function CJe(e,t,n){let i=t.getTileDataAvailable(e.x,e.y,e.level);if(!C(i)&&C(e.parent)){const t=e.parent,n=t.data;C(n)&&C(n.terrainData)&&(i=n.terrainData.isChildAvailable(t.x,t.y,e.x,e.y))}!1===i&&(e.data.terrainState=_Je.FAILED);for(let o=0,r=n.length;o<r;++o){const i=n.get(o);i.show&&i._createTileImagerySkeletons(e,t)}}function EJe(e,t,n,i,o,r){const s=e.data,a=e.parent;if(s.terrainState===_Je.FAILED&&void 0!==a){const e=void 0!==a.data&&void 0!==a.data.terrainData&&!1!==a.data.terrainData.canUpsample;e||gJe.processStateMachine(a,t,n,i,o,r,!0)}if(s.terrainState===_Je.FAILED&&xJe(s,e,t,n,e.x,e.y,e.level),s.terrainState===_Je.UNLOADED&&SJe(s,n,e.x,e.y,e.level),s.terrainState===_Je.RECEIVED&&OJe(s,t,n,e.x,e.y,e.level),s.terrainState===_Je.TRANSFORMED&&(DJe(s,t.context,n,e.x,e.y,e.level,r),s.updateExaggeration(e,t,o)),s.terrainState>=_Je.RECEIVED&&void 0===s.waterMaskTexture&&n.hasWaterMask){const n=s.terrainData;if(void 0!==n.waterMask)RJe(t.context,s);else{const t=s._findAncestorTileWithTerrainData(e);C(t)&&C(t.data.waterMaskTexture)&&(s.waterMaskTexture=t.data.waterMaskTexture,++s.waterMaskTexture.referenceCount,s._computeWaterMaskTranslationAndScale(e,t,s.waterMaskTranslationAndScale))}}}function xJe(e,t,n,i,o,r,s){const a=t.parent;if(!a)return void(t.state=pJe.FAILED);const c=a.data.terrainData,l=a.x,u=a.y,h=a.level;if(!C(c))return;const d=c.upsample(i.tilingScheme,l,u,h,o,r,s);C(d)&&(e.terrainState=_Je.RECEIVING,Promise.resolve(d).then((function(t){e.terrainData=t,e.terrainState=_Je.RECEIVED})).catch((function(){e.terrainState=_Je.FAILED})))}function SJe(e,t,n,i,o){function r(t){e.terrainData=t,e.terrainState=_Je.RECEIVED,e.request=void 0}function s(r){if(e.request.state===Hn.CANCELLED)return e.terrainData=void 0,e.terrainState=_Je.UNLOADED,void(e.request=void 0);e.terrainState=_Je.FAILED,e.request=void 0;const s=`Failed to obtain terrain tile X: ${n} Y: ${i} Level: ${o}. Error message: "${r}"`;t._requestError=ef.handleError(t._requestError,t,t.errorEvent,s,n,i,o,a)}function a(){const a=new jn({throttle:!1,throttleByServer:!0,type:Wn.TERRAIN});e.request=a;const c=t.requestTileGeometry(n,i,o,a);C(c)?(e.terrainState=_Je.RECEIVING,Promise.resolve(c).then((function(e){r(e)})).catch((function(e){s(e)}))):(e.terrainState=_Je.UNLOADED,e.request=void 0)}a()}gJe.prototype.pick=function(e,t,n,i,o){const r=this.renderedMesh;if(!C(r))return;const s=r.vertices,a=r.indices,c=r.encoding,l=a.length;let u=Number.MAX_VALUE;for(let h=0;h<l;h+=3){const o=a[h],r=a[h+1],l=a[h+2],d=vJe(c,t,n,s,o,bJe),f=vJe(c,t,n,s,r,AJe),p=vJe(c,t,n,s,l,wJe),m=Ns.rayTriangleParametric(e,d,f,p,i);C(m)&&m<u&&m>=0&&(u=m)}return u!==Number.MAX_VALUE?os.getPoint(e,u,o):void 0},gJe.prototype.freeResources=function(){C(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0),this.terrainData=void 0,this.terrainState=_Je.UNLOADED,this.mesh=void 0,this.fill=this.fill&&this.fill.destroy();const e=this.imagery;for(let t=0,n=e.length;t<n;++t)e[t].freeResources();this.imagery.length=0,this.freeVertexArray()},gJe.prototype.freeVertexArray=function(){gJe._freeVertexArray(this.vertexArray),this.vertexArray=void 0,gJe._freeVertexArray(this.wireframeVertexArray),this.wireframeVertexArray=void 0},gJe.initialize=function(e,t,n){let i=e.data;C(i)||(i=e.data=new gJe),e.state===pJe.START&&(CJe(e,t,n),e.state=pJe.LOADING)},gJe.processStateMachine=function(e,t,n,i,o,r,s){gJe.initialize(e,n,i);const a=e.data;if(e.state===pJe.LOADING&&EJe(e,t,n,i,o,r),s)return;const c=e.renderable;e.renderable=C(a.vertexArray);const l=a.terrainState===_Je.READY;e.upsampledFromParent=C(a.terrainData)&&a.terrainData.wasCreatedByUpsampling();const u=a.processImagery(e,n,t);if(l&&u){const t=e._loadedCallbacks,n={};for(const i in t)t.hasOwnProperty(i)&&(t[i](e)||(n[i]=t[i]));e._loadedCallbacks=n,e.state=pJe.DONE}c&&(e.renderable=!0)},gJe.prototype.processImagery=function(e,t,n,i){const o=e.data;let r=e.upsampledFromParent,s=!1,a=!0;const c=o.imagery;let l,u;for(l=0,u=c.length;l<u;++l){const o=c[l];if(!C(o.loadingImagery)){r=!1;continue}if(o.loadingImagery.state===dJe.PLACEHOLDER){const n=o.loadingImagery.imageryLayer;if(n.imageryProvider.ready){o.freeResources(),c.splice(l,1),n._createTileImagerySkeletons(e,t,l),--l,u=c.length;continue}r=!1}const h=o.processStateMachine(e,n,i);a=a&&h,s=s||h||C(o.readyImagery),r=r&&C(o.loadingImagery)&&(o.loadingImagery.state===dJe.FAILED||o.loadingImagery.state===dJe.INVALID)}return e.upsampledFromParent=r,e.renderable=e.renderable&&(s||a),a},gJe.prototype.addGeodeticSurfaceNormals=function(e,t){TJe(this,!0,e,t)},gJe.prototype.removeGeodeticSurfaceNormals=function(e){TJe(this,!1,void 0,e)},gJe.prototype.updateExaggeration=function(e,t,n){const i=this,o=i.renderedMesh;if(void 0===o)return;const r=t.terrainExaggeration,s=t.terrainExaggerationRelativeHeight,a=1!==r,c=o.encoding,l=c.exaggeration!==r,u=c.exaggerationRelativeHeight!==s;if(l||u){if(l)if(a&&!c.hasGeodeticSurfaceNormals){const n=e.tilingScheme.ellipsoid;i.addGeodeticSurfaceNormals(n,t)}else!a&&c.hasGeodeticSurfaceNormals&&i.removeGeodeticSurfaceNormals(t);if(c.exaggeration=r,c.exaggerationRelativeHeight=s,void 0!==n){n._tileToUpdateHeights.push(e);const t=e.customData,i=t.length;for(let e=0;e<i;e++){const n=t[e];n.level=-1}}}};const IJe={tilingScheme:void 0,x:0,y:0,level:0,exaggeration:1,exaggerationRelativeHeight:0,throttle:!0};function OJe(e,t,n,i,o,r){const s=n.tilingScheme,a=IJe;a.tilingScheme=s,a.x=i,a.y=o,a.level=r,a.exaggeration=t.terrainExaggeration,a.exaggerationRelativeHeight=t.terrainExaggerationRelativeHeight,a.throttle=!0;const c=e.terrainData,l=c.createMesh(a);C(l)&&(e.terrainState=_Je.TRANSFORMING,Promise.resolve(l).then((function(t){e.mesh=t,e.terrainState=_Je.TRANSFORMED})).catch((function(){e.terrainState=_Je.FAILED})))}function DJe(e,t,n,i,o,r,s){e.vertexArray=gJe._createVertexArrayForMesh(t,e.mesh),e.terrainState=_Je.READY,e.fill=e.fill&&e.fill.destroy(s)}function PJe(e){let t=e.cache.tile_waterMaskData;if(!C(t)){const n=Uk.create({context:e,pixelFormat:fD.LUMINANCE,pixelDatatype:hD.UNSIGNED_BYTE,source:{arrayBufferView:new Uint8Array([255]),width:1,height:1}});n.referenceCount=1;const i=new Nk({wrapS:Mk.CLAMP_TO_EDGE,wrapT:Mk.CLAMP_TO_EDGE,minificationFilter:Rk.LINEAR,magnificationFilter:Dk.LINEAR});t={allWaterTexture:n,sampler:i,destroy:function(){this.allWaterTexture.destroy()}},e.cache.tile_waterMaskData=t}return t}function RJe(e,t){const n=t.terrainData.waterMask,i=PJe(e);let o;const r=n.length;if(1===r){if(0===n[0])return;o=i.allWaterTexture}else{const t=Math.sqrt(r);o=Uk.create({context:e,pixelFormat:fD.LUMINANCE,pixelDatatype:hD.UNSIGNED_BYTE,source:{width:t,height:t,arrayBufferView:n},sampler:i.sampler,flipY:!1}),o.referenceCount=0}++o.referenceCount,t.waterMaskTexture=o,Xe.fromElements(0,0,1,1,t.waterMaskTranslationAndScale)}gJe._createVertexArrayForMesh=function(e,t){const n=t.vertices,i=hq.createVertexBuffer({context:e,typedArray:n,usage:lq.STATIC_DRAW}),o=t.encoding.getAttributes(i),r=t.indices.indexBuffers||{};let s=r[e.id];if(!C(s)||s.isDestroyed()){const n=t.indices;s=hq.createIndexBuffer({context:e,typedArray:n,usage:lq.STATIC_DRAW,indexDatatype:fd.fromSizeInBytes(n.BYTES_PER_ELEMENT)}),s.vertexArrayDestroyable=!1,s.referenceCount=1,r[e.id]=s,t.indices.indexBuffers=r}else++s.referenceCount;return new bq({context:e,attributes:o,indexBuffer:s})},gJe._freeVertexArray=function(e){if(C(e)){const t=e.indexBuffer;e.isDestroyed()||e.destroy(),C(t)&&!t.isDestroyed()&&C(t.referenceCount)&&(--t.referenceCount,0===t.referenceCount&&t.destroy())}},gJe.prototype._findAncestorTileWithTerrainData=function(e){let t=e.parent;while(C(t)&&(!C(t.data)||!C(t.data.terrainData)||t.data.terrainData.wasCreatedByUpsampling()))t=t.parent;return t},gJe.prototype._computeWaterMaskTranslationAndScale=function(e,t,n){const i=t.rectangle,o=e.rectangle,r=o.width,s=o.height,a=r/i.width,c=s/i.height;return n.x=a*(o.west-i.west)/r,n.y=c*(o.south-i.south)/s,n.z=a,n.w=c,n};var LJe=gJe,MJe="uniform sampler2D u_texture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    gl_FragColor = texture2D(u_texture, v_textureCoordinates);\n}\n",BJe="attribute vec4 position;\nattribute float webMercatorT;\n\nuniform vec2 u_textureDimensions;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    v_textureCoordinates = vec2(position.x, webMercatorT);\n    gl_Position = czm_viewportOrthographic * (position * vec4(u_textureDimensions, 1.0, 1.0));\n}\n";function NJe(e,t,n,i,o){if(this.imageryLayer=e,this.x=t,this.y=n,this.level=i,this.request=void 0,0!==i){const o=t/2|0,r=n/2|0,s=i-1;this.parent=e.getImageryFromCache(o,r,s)}if(this.state=dJe.UNLOADED,this.imageUrl=void 0,this.image=void 0,this.texture=void 0,this.textureWebMercator=void 0,this.credits=void 0,this.referenceCount=0,!C(o)&&e.imageryProvider.ready){const r=e.imageryProvider.tilingScheme;o=r.tileXYToRectangle(t,n,i)}this.rectangle=o}NJe.createPlaceholder=function(e){const t=new NJe(e,0,0,0);return t.addReference(),t.state=dJe.PLACEHOLDER,t},NJe.prototype.addReference=function(){++this.referenceCount},NJe.prototype.releaseReference=function(){return--this.referenceCount,0===this.referenceCount?(this.imageryLayer.removeImageryFromCache(this),C(this.parent)&&this.parent.releaseReference(),C(this.image)&&C(this.image.destroy)&&this.image.destroy(),C(this.texture)&&this.texture.destroy(),C(this.textureWebMercator)&&this.texture!==this.textureWebMercator&&this.textureWebMercator.destroy(),Qh(this),0):this.referenceCount},NJe.prototype.processStateMachine=function(e,t,n){this.state!==dJe.UNLOADED||n||(this.state=dJe.TRANSITIONING,this.imageryLayer._requestImagery(this)),this.state===dJe.RECEIVED&&(this.state=dJe.TRANSITIONING,this.imageryLayer._createTexture(e.context,this));const i=this.state===dJe.READY&&t&&!this.texture;(this.state===dJe.TEXTURE_LOADED||i)&&(this.state=dJe.TRANSITIONING,this.imageryLayer._reprojectTexture(e,this,t))};var FJe=NJe;function zJe(e,t,n){this.readyImagery=void 0,this.loadingImagery=e,this.textureCoordinateRectangle=t,this.textureTranslationAndScale=void 0,this.useWebMercatorT=n}zJe.prototype.freeResources=function(){C(this.readyImagery)&&this.readyImagery.releaseReference(),C(this.loadingImagery)&&this.loadingImagery.releaseReference()},zJe.prototype.processStateMachine=function(e,t,n){const i=this.loadingImagery,o=i.imageryLayer;if(i.processStateMachine(t,!this.useWebMercatorT,n),i.state===dJe.READY)return C(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=this.loadingImagery,this.loadingImagery=void 0,this.textureTranslationAndScale=o._calculateTextureTranslationAndScale(e,this),!0;let r,s=i.parent;while(C(s)&&(s.state!==dJe.READY||!this.useWebMercatorT&&!C(s.texture)))s.state!==dJe.FAILED&&s.state!==dJe.INVALID&&(r=r||s),s=s.parent;return this.readyImagery!==s&&(C(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=s,C(s)&&(s.addReference(),this.textureTranslationAndScale=o._calculateTextureTranslationAndScale(e,this))),(i.state===dJe.FAILED||i.state===dJe.INVALID)&&(!C(r)||(r.processStateMachine(t,!this.useWebMercatorT,n),!1))};var kJe=zJe;function UJe(e,t){this._imageryProvider=e,t=R(t,R.EMPTY_OBJECT),this.alpha=R(t.alpha,R(e.defaultAlpha,1)),this.nightAlpha=R(t.nightAlpha,R(e.defaultNightAlpha,1)),this.dayAlpha=R(t.dayAlpha,R(e.defaultDayAlpha,1)),this.brightness=R(t.brightness,R(e.defaultBrightness,UJe.DEFAULT_BRIGHTNESS)),this.contrast=R(t.contrast,R(e.defaultContrast,UJe.DEFAULT_CONTRAST)),this.hue=R(t.hue,R(e.defaultHue,UJe.DEFAULT_HUE)),this.saturation=R(t.saturation,R(e.defaultSaturation,UJe.DEFAULT_SATURATION)),this.gamma=R(t.gamma,R(e.defaultGamma,UJe.DEFAULT_GAMMA)),this.splitDirection=R(t.splitDirection,R(e.defaultSplit,UJe.DEFAULT_SPLIT)),this.minificationFilter=R(t.minificationFilter,R(e.defaultMinificationFilter,UJe.DEFAULT_MINIFICATION_FILTER)),this.magnificationFilter=R(t.magnificationFilter,R(e.defaultMagnificationFilter,UJe.DEFAULT_MAGNIFICATION_FILTER)),this.show=R(t.show,!0),this._minimumTerrainLevel=t.minimumTerrainLevel,this._maximumTerrainLevel=t.maximumTerrainLevel,this._rectangle=R(t.rectangle,_t.MAX_VALUE),this._maximumAnisotropy=t.maximumAnisotropy,this._imageryCache={},this._skeletonPlaceholder=new kJe(FJe.createPlaceholder(this)),this._show=!0,this._layerIndex=-1,this._isBaseLayer=!1,this._requestImageError=void 0,this._reprojectComputeCommands=[],this.cutoutRectangle=t.cutoutRectangle,this.colorToAlpha=t.colorToAlpha,this.colorToAlphaThreshold=R(t.colorToAlphaThreshold,UJe.DEFAULT_APPLY_COLOR_TO_ALPHA_THRESHOLD)}Object.defineProperties(UJe.prototype,{imageryProvider:{get:function(){return this._imageryProvider}},rectangle:{get:function(){return this._rectangle}}}),UJe.DEFAULT_BRIGHTNESS=1,UJe.DEFAULT_CONTRAST=1,UJe.DEFAULT_HUE=0,UJe.DEFAULT_SATURATION=1,UJe.DEFAULT_GAMMA=1,UJe.DEFAULT_SPLIT=T4.NONE,UJe.DEFAULT_MINIFICATION_FILTER=Rk.LINEAR,UJe.DEFAULT_MAGNIFICATION_FILTER=Dk.LINEAR,UJe.DEFAULT_APPLY_COLOR_TO_ALPHA_THRESHOLD=.004,UJe.prototype.isBaseLayer=function(){return this._isBaseLayer},UJe.prototype.isDestroyed=function(){return!1},UJe.prototype.destroy=function(){return Qh(this)};const VJe=new _t,HJe=new _t,GJe=new _t,WJe=new _t;function qJe(e,t,n){return`${e}:${t}:${n}`}function jJe(e,t,n){return JSON.stringify([e,t,n])}UJe.prototype.getViewableRectangle=function(){const e=this._imageryProvider,t=this._rectangle;return e.readyPromise.then((function(){return _t.intersection(e.rectangle,t)}))},UJe.prototype._createTileImagerySkeletons=function(e,t,n){const i=e.data;if(C(this._minimumTerrainLevel)&&e.level<this._minimumTerrainLevel)return!1;if(C(this._maximumTerrainLevel)&&e.level>this._maximumTerrainLevel)return!1;const o=this._imageryProvider;if(C(n)||(n=i.imagery.length),!o.ready)return this._skeletonPlaceholder.loadingImagery.addReference(),i.imagery.splice(n,0,this._skeletonPlaceholder),!0;const r=o.tilingScheme.projection instanceof Vh&&e.rectangle.north<Vh.MaximumLatitude&&e.rectangle.south>-Vh.MaximumLatitude,s=_t.intersection(o.rectangle,this._rectangle,VJe);let a=_t.intersection(e.rectangle,s,HJe);if(!C(a)){if(!this.isBaseLayer())return!1;const t=s,n=e.rectangle;a=HJe,n.south>=t.north?a.north=a.south=t.north:n.north<=t.south?a.north=a.south=t.south:(a.south=Math.max(n.south,t.south),a.north=Math.min(n.north,t.north)),n.west>=t.east?a.west=a.east=t.east:n.east<=t.west?a.west=a.east=t.west:(a.west=Math.max(n.west,t.west),a.east=Math.min(n.east,t.east))}let c=0;a.south>0?c=a.south:a.north<0&&(c=a.north);const l=1,u=l*t.getLevelMaximumGeometricError(e.level);let h=QJe(this,u,c);h=Math.max(0,h);const d=o.maximumLevel;if(h>d&&(h=d),C(o.minimumLevel)){const e=o.minimumLevel;h<e&&(h=e)}const f=o.tilingScheme,p=f.positionToTileXY(_t.northwest(a),h),m=f.positionToTileXY(_t.southeast(a),h);let _=e.rectangle.width/512,g=e.rectangle.height/512;const y=f.tileXYToRectangle(p.x,p.y,h);Math.abs(y.south-e.rectangle.north)<g&&p.y<m.y&&++p.y,Math.abs(y.east-e.rectangle.west)<_&&p.x<m.x&&++p.x;const v=f.tileXYToRectangle(m.x,m.y,h);Math.abs(v.north-e.rectangle.south)<g&&m.y>p.y&&--m.y,Math.abs(v.west-e.rectangle.east)<_&&m.x>p.x&&--m.x;const b=_t.clone(e.rectangle,WJe);let A,w,T=f.tileXYToRectangle(p.x,p.y,h),E=_t.intersection(T,s,GJe);r?(f.rectangleToNativeRectangle(b,b),f.rectangleToNativeRectangle(T,T),f.rectangleToNativeRectangle(E,E),f.rectangleToNativeRectangle(s,s),A=f.tileXYToNativeRectangle.bind(f),_=b.width/512,g=b.height/512):A=f.tileXYToRectangle.bind(f);let x,S=0,I=1;!this.isBaseLayer()&&Math.abs(E.west-b.west)>=_&&(S=Math.min(1,(E.west-b.west)/b.width)),!this.isBaseLayer()&&Math.abs(E.north-b.north)>=g&&(I=Math.max(0,(E.north-b.south)/b.height));const O=I;for(let D=p.x;D<=m.x;D++)if(w=S,T=A(D,p.y,h),E=_t.simpleIntersection(T,s,GJe),C(E)){S=Math.min(1,(E.east-b.west)/b.width),D===m.x&&(this.isBaseLayer()||Math.abs(E.east-b.east)<_)&&(S=1),I=O;for(let e=p.y;e<=m.y;e++){if(x=I,T=A(D,e,h),E=_t.simpleIntersection(T,s,GJe),!C(E))continue;I=Math.max(0,(E.south-b.south)/b.height),e===m.y&&(this.isBaseLayer()||Math.abs(E.south-b.south)<g)&&(I=0);const t=new Xe(w,I,S,x),o=this.getImageryFromCache(D,e,h);i.imagery.splice(n,0,new kJe(o,t,r)),++n}}return!0},UJe.prototype._calculateTextureTranslationAndScale=function(e,t){let n=t.readyImagery.rectangle,i=e.rectangle;if(t.useWebMercatorT){const e=t.readyImagery.imageryLayer.imageryProvider.tilingScheme;n=e.rectangleToNativeRectangle(n,VJe),i=e.rectangleToNativeRectangle(i,WJe)}const o=i.width,r=i.height,s=o/n.width,a=r/n.height;return new Xe(s*(i.west-n.west)/o,a*(i.south-n.south)/r,s,a)},UJe.prototype._requestImagery=function(e){const t=this._imageryProvider,n=this;function i(t){if(!C(t))return o();e.image=t,e.state=dJe.RECEIVED,e.request=void 0,ef.handleSuccess(n._requestImageError)}function o(i){if(e.request.state===Hn.CANCELLED)return e.state=dJe.UNLOADED,void(e.request=void 0);e.state=dJe.FAILED,e.request=void 0;const o=`Failed to obtain image tile X: ${e.x} Y: ${e.y} Level: ${e.level}.`;n._requestImageError=ef.handleError(n._requestImageError,t,t.errorEvent,o,e.x,e.y,e.level,r,i)}function r(){const n=new jn({throttle:!1,throttleByServer:!0,type:Wn.IMAGERY});e.request=n,e.state=dJe.TRANSITIONING;const r=t.requestImage(e.x,e.y,e.level,n);if(!C(r))return e.state=dJe.UNLOADED,void(e.request=void 0);C(t.getTileCredits)&&(e.credits=t.getTileCredits(e.x,e.y,e.level)),r.then((function(e){i(e)})).catch((function(e){o(e)}))}r()},UJe.prototype._createTextureWebGL=function(e,t){const n=new Nk({minificationFilter:this.minificationFilter,magnificationFilter:this.magnificationFilter}),i=t.image;return C(i.internalFormat)?new Uk({context:e,pixelFormat:i.internalFormat,width:i.width,height:i.height,source:{arrayBufferView:i.bufferView},sampler:n}):new Uk({context:e,source:i,pixelFormat:this._imageryProvider.hasAlphaChannel?fD.RGBA:fD.RGB,sampler:n})},UJe.prototype._createTexture=function(e,t){const n=this._imageryProvider,i=t.image;if(C(n.tileDiscardPolicy)){const e=n.tileDiscardPolicy;if(C(e)){if(!e.isReady())return void(t.state=dJe.RECEIVED);if(e.shouldDiscardImage(i))return void(t.state=dJe.INVALID)}}if(this.minificationFilter!==Rk.NEAREST&&this.minificationFilter!==Rk.LINEAR)throw new x("ImageryLayer minification filter must be NEAREST or LINEAR");const o=this._createTextureWebGL(e,t);n.tilingScheme.projection instanceof Vh?t.textureWebMercator=o:t.texture=o,t.image=void 0,t.state=dJe.TEXTURE_LOADED},UJe.prototype._finalizeReprojectTexture=function(e,t){let n=this.minificationFilter;const i=this.magnificationFilter,o=n===Rk.LINEAR&&i===Dk.LINEAR;if(o&&!fD.isCompressedFormat(t.pixelFormat)&&z.isPowerOfTwo(t.width)&&z.isPowerOfTwo(t.height)){n=Rk.LINEAR_MIPMAP_LINEAR;const o=Ck.maximumTextureFilterAnisotropy,r=Math.min(o,R(this._maximumAnisotropy,o)),s=qJe(n,i,r);let a=e.cache.imageryLayerMipmapSamplers;C(a)||(a={},e.cache.imageryLayerMipmapSamplers=a);let c=a[s];C(c)||(c=a[s]=new Nk({wrapS:Mk.CLAMP_TO_EDGE,wrapT:Mk.CLAMP_TO_EDGE,minificationFilter:n,magnificationFilter:i,maximumAnisotropy:r})),t.generateMipmap(Ik.NICEST),t.sampler=c}else{const o=qJe(n,i,0);let r=e.cache.imageryLayerNonMipmapSamplers;C(r)||(r={},e.cache.imageryLayerNonMipmapSamplers=r);let s=r[o];C(s)||(s=r[o]=new Nk({wrapS:Mk.CLAMP_TO_EDGE,wrapT:Mk.CLAMP_TO_EDGE,minificationFilter:n,magnificationFilter:i})),t.sampler=s}},UJe.prototype._reprojectTexture=function(e,t,n){const i=t.textureWebMercator||t.texture,o=t.rectangle,r=e.context;if(n=R(n,!0),n&&!(this._imageryProvider.tilingScheme.projection instanceof ve)&&o.width/i.width>1e-5){const e=this;t.addReference();const n=new PQ({persists:!0,owner:this,preExecute:function(e){XJe(e,r,i,t.rectangle)},postExecute:function(n){t.texture=n,e._finalizeReprojectTexture(r,n),t.state=dJe.READY,t.releaseReference()},canceled:function(){t.state=dJe.TEXTURE_LOADED,t.releaseReference()}});this._reprojectComputeCommands.push(n)}else n&&(t.texture=i),this._finalizeReprojectTexture(r,i),t.state=dJe.READY},UJe.prototype.queueReprojectionCommands=function(e){const t=this._reprojectComputeCommands,n=t.length;for(let i=0;i<n;++i)e.commandList.push(t[i]);t.length=0},UJe.prototype.cancelReprojections=function(){this._reprojectComputeCommands.forEach((function(e){C(e.canceled)&&e.canceled()})),this._reprojectComputeCommands.length=0},UJe.prototype.getImageryFromCache=function(e,t,n,i){const o=jJe(e,t,n);let r=this._imageryCache[o];return C(r)||(r=new FJe(this,e,t,n,i),this._imageryCache[o]=r),r.addReference(),r},UJe.prototype.removeImageryFromCache=function(e){const t=jJe(e.x,e.y,e.level);delete this._imageryCache[t]};const YJe={u_textureDimensions:function(){return this.textureDimensions},u_texture:function(){return this.texture},textureDimensions:new ro,texture:void 0},KJe=Oc.supportsTypedArrays()?new Float32Array(128):void 0;function XJe(e,t,n,i){let o=t.cache.imageryLayer_reproject;if(!C(o)){o=t.cache.imageryLayer_reproject={vertexArray:void 0,shaderProgram:void 0,sampler:void 0,destroy:function(){C(this.framebuffer)&&this.framebuffer.destroy(),C(this.vertexArray)&&this.vertexArray.destroy(),C(this.shaderProgram)&&this.shaderProgram.destroy()}};const e=new Float32Array(256);let n=0;for(let t=0;t<64;++t){const i=t/63;e[n++]=0,e[n++]=i,e[n++]=1,e[n++]=i}const i={position:0,webMercatorT:1},r=Ad.getRegularGridIndices(2,64),s=hq.createIndexBuffer({context:t,typedArray:r,usage:lq.STATIC_DRAW,indexDatatype:fd.UNSIGNED_SHORT});o.vertexArray=new bq({context:t,attributes:[{index:i.position,vertexBuffer:hq.createVertexBuffer({context:t,typedArray:e,usage:lq.STATIC_DRAW}),componentsPerAttribute:2},{index:i.webMercatorT,vertexBuffer:hq.createVertexBuffer({context:t,sizeInBytes:512,usage:lq.STREAM_DRAW}),componentsPerAttribute:1}],indexBuffer:s});const a=new tq({sources:[BJe]});o.shaderProgram=fH.fromCache({context:t,vertexShaderSource:a,fragmentShaderSource:MJe,attributeLocations:i}),o.sampler=new Nk({wrapS:Mk.CLAMP_TO_EDGE,wrapT:Mk.CLAMP_TO_EDGE,minificationFilter:Rk.LINEAR,magnificationFilter:Dk.LINEAR})}n.sampler=o.sampler;const r=n.width,s=n.height;YJe.textureDimensions.x=r,YJe.textureDimensions.y=s,YJe.texture=n;let a=Math.sin(i.south);const c=.5*Math.log((1+a)/(1-a));a=Math.sin(i.north);const l=.5*Math.log((1+a)/(1-a)),u=1/(l-c),h=new Uk({context:t,width:r,height:s,pixelFormat:n.pixelFormat,pixelDatatype:n.pixelDatatype,preMultiplyAlpha:n.preMultiplyAlpha});z.isPowerOfTwo(r)&&z.isPowerOfTwo(s)&&h.generateMipmap(Ik.NICEST);const d=i.south,f=i.north,p=KJe;let m=0;for(let _=0;_<64;++_){const e=_/63,t=z.lerp(d,f,e);a=Math.sin(t);const n=.5*Math.log((1+a)/(1-a)),i=(n-c)*u;p[m++]=i,p[m++]=i}o.vertexArray.getAttribute(1).vertexBuffer.copyFromArrayView(p),e.shaderProgram=o.shaderProgram,e.outputTexture=h,e.uniformMap=YJe,e.vertexArray=o.vertexArray}function QJe(e,t,n){const i=e._imageryProvider,o=i.tilingScheme,r=o.ellipsoid,s=e._imageryProvider.tilingScheme.projection instanceof ve?1:Math.cos(n),a=o.rectangle,c=r.maximumRadius*a.width*s/(i.tileWidth*o.getNumberOfXTilesAtLevel(0)),l=c/t,u=Math.log(l)/Math.log(2),h=Math.round(u);return 0|h}var JJe=UJe;const ZJe={NONE:0,CULLED:1,RENDERED:2,REFINED:3,RENDERED_AND_KICKED:6,REFINED_AND_KICKED:7,CULLED_BUT_NEEDED:9,wasKicked:function(e){return e>=ZJe.RENDERED_AND_KICKED},originalResult:function(e){return 3&e},kick:function(e){return 4|e}};var $Je=ZJe;function eZe(e){this.tile=e,this.frameLastUpdated=void 0,this.westMeshes=[],this.westTiles=[],this.southMeshes=[],this.southTiles=[],this.eastMeshes=[],this.eastTiles=[],this.northMeshes=[],this.northTiles=[],this.southwestMesh=void 0,this.southwestTile=void 0,this.southeastMesh=void 0,this.southeastTile=void 0,this.northwestMesh=void 0,this.northwestTile=void 0,this.northeastMesh=void 0,this.northeastTile=void 0,this.changedThisFrame=!0,this.visitedFrame=void 0,this.enqueuedFrame=void 0,this.mesh=void 0,this.vertexArray=void 0,this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new Xe}eZe.prototype.update=function(e,t,n){this.changedThisFrame&&(wZe(e,t,this.tile,n),this.changedThisFrame=!1)},eZe.prototype.destroy=function(e){this._destroyVertexArray(e),C(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0)},eZe.prototype._destroyVertexArray=function(e){C(this.vertexArray)&&(C(e)?e.push(this.vertexArray):LJe._freeVertexArray(this.vertexArray),this.vertexArray=void 0)};const tZe=new Jv;function nZe(e,t,n,i,o,r,s,a,c){if(void 0===i)return;let l=i;while(l&&(l._lastSelectionResultFrame!==o||$Je.wasKicked(l._lastSelectionResult)||$Je.originalResult(l._lastSelectionResult)===$Je.CULLED)){if(s)return;const e=l.parent;if(r>=CN.NORTHWEST&&void 0!==e)switch(r){case CN.NORTHWEST:l=l===e.northwestChild?e:void 0;break;case CN.NORTHEAST:l=l===e.northeastChild?e:void 0;break;case CN.SOUTHWEST:l=l===e.southwestChild?e:void 0;break;case CN.SOUTHEAST:l=l===e.southeastChild?e:void 0;break}else l=e}if(void 0!==l)if(l._lastSelectionResult!==$Je.RENDERED){if($Je.originalResult(i._lastSelectionResult)!==$Je.CULLED)switch(r){case CN.WEST:nZe(e,t,n,i.northwestChild,o,r,!0,a,c),nZe(e,t,n,i.southwestChild,o,r,!0,a,c);break;case CN.EAST:nZe(e,t,n,i.southeastChild,o,r,!0,a,c),nZe(e,t,n,i.northeastChild,o,r,!0,a,c);break;case CN.SOUTH:nZe(e,t,n,i.southwestChild,o,r,!0,a,c),nZe(e,t,n,i.southeastChild,o,r,!0,a,c);break;case CN.NORTH:nZe(e,t,n,i.northeastChild,o,r,!0,a,c),nZe(e,t,n,i.northwestChild,o,r,!0,a,c);break;case CN.NORTHWEST:nZe(e,t,n,i.northwestChild,o,r,!0,a,c);break;case CN.NORTHEAST:nZe(e,t,n,i.northeastChild,o,r,!0,a,c);break;case CN.SOUTHWEST:nZe(e,t,n,i.southwestChild,o,r,!0,a,c);break;case CN.SOUTHEAST:nZe(e,t,n,i.southeastChild,o,r,!0,a,c);break;default:throw new x("Invalid edge")}}else{if(C(l.data.vertexArray))return;iZe(e,t,n,l,r,o,a,c)}}function iZe(e,t,n,i,o,r,s,a){const c=i.data;if(void 0===c.fill)c.fill=new eZe(i);else if(c.fill.visitedFrame===r)return;c.fill.enqueuedFrame!==r&&(c.fill.enqueuedFrame=r,c.fill.changedThisFrame=!1,s.enqueue(i)),oZe(e,t,n,i,o,a)}function oZe(e,t,n,i,o,r){const s=i.data.fill;let a;const c=n.data.fill;let l,u,h,d,f,p;switch(C(c)?(c.visitedFrame=t.frameNumber,c.changedThisFrame&&(wZe(e,t,n,r),c.changedThisFrame=!1),a=n.data.fill.mesh):a=n.data.mesh,o){case CN.WEST:l=s.westMeshes,u=s.westTiles;break;case CN.SOUTH:l=s.southMeshes,u=s.southTiles;break;case CN.EAST:l=s.eastMeshes,u=s.eastTiles;break;case CN.NORTH:l=s.northMeshes,u=s.northTiles;break;case CN.NORTHWEST:return s.changedThisFrame=s.changedThisFrame||s.northwestMesh!==a,s.northwestMesh=a,void(s.northwestTile=n);case CN.NORTHEAST:return s.changedThisFrame=s.changedThisFrame||s.northeastMesh!==a,s.northeastMesh=a,void(s.northeastTile=n);case CN.SOUTHWEST:return s.changedThisFrame=s.changedThisFrame||s.southwestMesh!==a,s.southwestMesh=a,void(s.southwestTile=n);case CN.SOUTHEAST:return s.changedThisFrame=s.changedThisFrame||s.southeastMesh!==a,s.southeastMesh=a,void(s.southeastTile=n)}if(n.level<=i.level)return s.changedThisFrame=s.changedThisFrame||l[0]!==a||1!==l.length,l[0]=a,u[0]=n,l.length=1,void(u.length=1);const m=n.rectangle;let _;const g=i.rectangle;switch(o){case CN.WEST:for(_=(g.north-g.south)*z.EPSILON5,h=0;h<u.length;++h)if(f=u[h],p=f.rectangle,z.greaterThan(m.north,p.south,_))break;for(d=h;d<u.length;++d)if(f=u[d],p=f.rectangle,z.greaterThanOrEquals(m.south,p.north,_))break;break;case CN.SOUTH:for(_=(g.east-g.west)*z.EPSILON5,h=0;h<u.length;++h)if(f=u[h],p=f.rectangle,z.lessThan(m.west,p.east,_))break;for(d=h;d<u.length;++d)if(f=u[d],p=f.rectangle,z.lessThanOrEquals(m.east,p.west,_))break;break;case CN.EAST:for(_=(g.north-g.south)*z.EPSILON5,h=0;h<u.length;++h)if(f=u[h],p=f.rectangle,z.lessThan(m.south,p.north,_))break;for(d=h;d<u.length;++d)if(f=u[d],p=f.rectangle,z.lessThanOrEquals(m.north,p.south,_))break;break;case CN.NORTH:for(_=(g.east-g.west)*z.EPSILON5,h=0;h<u.length;++h)if(f=u[h],p=f.rectangle,z.greaterThan(m.east,p.west,_))break;for(d=h;d<u.length;++d)if(f=u[d],p=f.rectangle,z.greaterThanOrEquals(m.west,p.east,_))break;break}d-h===1?(s.changedThisFrame=s.changedThisFrame||l[h]!==a,l[h]=a,u[h]=n):(s.changedThisFrame=!0,l.splice(h,d-h,a),u.splice(h,d-h,n))}eZe.updateFillTiles=function(e,t,n,i){const o=e._quadtree,r=o._levelZeroTiles,s=o._lastSelectionFrameNumber,a=tZe;a.clear();for(let l=0;l<t.length;++l){const e=t[l];C(e.data.vertexArray)&&a.enqueue(t[l])}let c=a.dequeue();while(void 0!==c){const t=c.findTileToWest(r),o=c.findTileToSouth(r),l=c.findTileToEast(r),u=c.findTileToNorth(r);nZe(e,n,c,t,s,CN.EAST,!1,a,i),nZe(e,n,c,o,s,CN.NORTH,!1,a,i),nZe(e,n,c,l,s,CN.WEST,!1,a,i),nZe(e,n,c,u,s,CN.SOUTH,!1,a,i);const h=t.findTileToNorth(r),d=t.findTileToSouth(r),f=l.findTileToNorth(r),p=l.findTileToSouth(r);nZe(e,n,c,h,s,CN.SOUTHEAST,!1,a,i),nZe(e,n,c,f,s,CN.SOUTHWEST,!1,a,i),nZe(e,n,c,d,s,CN.NORTHEAST,!1,a,i),nZe(e,n,c,p,s,CN.NORTHWEST,!1,a,i),c=a.dequeue()}};const rZe=new se,sZe=new se,aZe=new K,cZe=new K,lZe=new ro,uZe=new ro,hZe=new ro;function dZe(){this.height=0,this.encodedNormal=new ro}function fZe(e,t,n,i,o,r,s,a,c){if(C(o))return o;let l;if(C(r)&&C(s))l=.5*(r.height+s.height);else if(C(r))l=r.height;else if(C(s))l=s.height;else if(C(a))l=a.height;else{const t=e.tile.data,n=t.tileBoundingRegion;let i=0,o=0;C(n)&&(i=n.minimumHeight,o=n.maximumHeight),l=.5*(i+o)}return PZe(e,t,n,i,l,c),c}const pZe={minimumHeight:0,maximumHeight:0},mZe=new K,_Ze=new dZe,gZe=new dZe,yZe=new dZe,vZe=new dZe,bZe="undefined"!==typeof Uint8Array?new Uint8Array(81):void 0,AZe={tilingScheme:void 0,x:0,y:0,level:0,exaggeration:1,exaggerationRelativeHeight:0};function wZe(e,t,n,i){LJe.initialize(n,e.terrainProvider,e._imageryLayers);const o=n.data,r=o.fill,s=n.rectangle,a=t.terrainExaggeration,c=t.terrainExaggerationRelativeHeight,l=1!==a,u=n.tilingScheme.ellipsoid;let h=RZe(r,u,0,1,r.northwestTile,r.northwestMesh,r.northTiles,r.northMeshes,r.westTiles,r.westMeshes,yZe),d=RZe(r,u,0,0,r.southwestTile,r.southwestMesh,r.westTiles,r.westMeshes,r.southTiles,r.southMeshes,_Ze),f=RZe(r,u,1,0,r.southeastTile,r.southeastMesh,r.southTiles,r.southMeshes,r.eastTiles,r.eastMeshes,gZe),p=RZe(r,u,1,1,r.northeastTile,r.northeastMesh,r.eastTiles,r.eastMeshes,r.northTiles,r.northMeshes,vZe);h=fZe(r,u,0,1,h,d,p,f,yZe),d=fZe(r,u,0,0,d,h,f,p,_Ze),f=fZe(r,u,1,1,f,d,p,h,gZe),p=fZe(r,u,1,1,p,f,h,d,vZe);const m=d.height,_=f.height,g=h.height,y=p.height;let v=Math.min(m,_,g,y),b=Math.max(m,_,g,y);const A=.5*(v+b);let w,T;const E=e.getLevelMaximumGeometricError(n.level),x=u.maximumRadius-E;let S=4*Math.acos(x/u.maximumRadius);if(S*=1.5,s.width>S&&b-v<=E){const e=new Pd({width:9,height:9,buffer:bZe,structure:{heightOffset:b}}),t=AZe;t.tilingScheme=n.tilingScheme,t.x=n.x,t.y=n.y,t.level=n.level,t.exaggeration=a,t.exaggerationRelativeHeight=c,r.mesh=e._createMeshSync(t)}else{const t=l,i=_t.center(s,sZe);i.height=A;const o=u.cartographicToCartesian(i,mZe),m=new kh(o,void 0,void 0,void 0,void 0,!0,!0,t,a,c);let _,g=5;for(_=r.westMeshes,w=0,T=_.length;w<T;++w)g+=_[w].eastIndicesNorthToSouth.length;for(_=r.southMeshes,w=0,T=_.length;w<T;++w)g+=_[w].northIndicesWestToEast.length;for(_=r.eastMeshes,w=0,T=_.length;w<T;++w)g+=_[w].westIndicesSouthToNorth.length;for(_=r.northMeshes,w=0,T=_.length;w<T;++w)g+=_[w].southIndicesEastToWest.length;const y=pZe;y.minimumHeight=v,y.maximumHeight=b;const C=m.stride;let E=new Float32Array(g*C),x=0;const S=x;x=TZe(u,s,m,E,x,0,1,h.height,h.encodedNormal,1,y),x=MZe(r,u,m,E,x,r.westTiles,r.westMeshes,CN.EAST,y);const I=x;x=TZe(u,s,m,E,x,0,0,d.height,d.encodedNormal,0,y),x=MZe(r,u,m,E,x,r.southTiles,r.southMeshes,CN.NORTH,y);const O=x;x=TZe(u,s,m,E,x,1,0,f.height,f.encodedNormal,0,y),x=MZe(r,u,m,E,x,r.eastTiles,r.eastMeshes,CN.WEST,y);const D=x;x=TZe(u,s,m,E,x,1,1,p.height,p.encodedNormal,1,y),x=MZe(r,u,m,E,x,r.northTiles,r.northMeshes,CN.SOUTH,y),v=y.minimumHeight,b=y.maximumHeight;const P=$u.fromRectangle(s,v,b,n.tilingScheme.ellipsoid),R=Vh.geodeticLatitudeToMercatorAngle(s.south),L=1/(Vh.geodeticLatitudeToMercatorAngle(s.north)-R),M=(Vh.geodeticLatitudeToMercatorAngle(i.latitude)-R)*L,B=u.geodeticSurfaceNormalCartographic(rZe,cZe),N=wh.octEncode(B,lZe),F=x;m.encode(E,x*C,P.center,ro.fromElements(.5,.5,hZe),A,N,M,B),++x;const z=x,k=z<256?1:2,U=3*(z-1),V=U*k,H=(E.length-z*C)*Float32Array.BYTES_PER_ELEMENT;let G;if(H>=V){const e=z*C*Float32Array.BYTES_PER_ELEMENT;G=z<256?new Uint8Array(E.buffer,e,U):new Uint16Array(E.buffer,e,U)}else G=z<256?new Uint8Array(U):new Uint16Array(U);E=new Float32Array(E.buffer,0,z*C);let W=0;for(w=0;w<z-2;++w)G[W++]=F,G[W++]=w,G[W++]=w+1;G[W++]=F,G[W++]=w,G[W++]=0;const q=[];for(w=I;w>=S;--w)q.push(w);const j=[];for(w=O;w>=I;--w)j.push(w);const Y=[];for(w=D;w>=O;--w)Y.push(w);const K=[];for(K.push(0),w=F-1;w>=D;--w)K.push(w);r.mesh=new hd(m.center,E,G,U,z,v,b,nn.fromOrientedBoundingBox(P),UZe(e,P.center,s,v,b),m.stride,P,m,q,j,Y,K)}const I=t.context;r._destroyVertexArray(i),r.vertexArray=LJe._createVertexArrayForMesh(I,r.mesh),o.processImagery(n,e.terrainProvider,t,!0);const O=r.waterMaskTexture;if(r.waterMaskTexture=void 0,e.terrainProvider.hasWaterMask){const e=o._findAncestorTileWithTerrainData(n);C(e)&&C(e.data.waterMaskTexture)&&(r.waterMaskTexture=e.data.waterMaskTexture,++r.waterMaskTexture.referenceCount,o._computeWaterMaskTranslationAndScale(n,e,r.waterMaskTranslationAndScale))}C(O)&&(--O.referenceCount,0===O.referenceCount&&O.destroy())}function TZe(e,t,n,i,o,r,s,a,c,l,u){const h=rZe;h.longitude=z.lerp(t.west,t.east,r),h.latitude=z.lerp(t.south,t.north,s),h.height=a;const d=e.cartographicToCartesian(h,aZe);let f;n.hasGeodeticSurfaceNormals&&(f=e.geodeticSurfaceNormal(d,cZe));const p=uZe;return p.x=r,p.y=s,n.encode(i,o*n.stride,d,p,a,c,l,f),u.minimumHeight=Math.min(u.minimumHeight,a),u.maximumHeight=Math.max(u.maximumHeight,a),o+1}const CZe=new _t;function EZe(e,t,n,i){let o=e.rectangle;const r=t.rectangle;0===t.x&&1===n.x&&e.x===e.tilingScheme.getNumberOfXTilesAtLevel(e.level)-1?(o=_t.clone(e.rectangle,CZe),o.west-=z.TWO_PI,o.east-=z.TWO_PI):0===e.x&&0===n.x&&t.x===t.tilingScheme.getNumberOfXTilesAtLevel(t.level)-1&&(o=_t.clone(e.rectangle,CZe),o.west+=z.TWO_PI,o.east+=z.TWO_PI);const s=o.east-o.west,a=(r.west-o.west)/s,c=(r.east-o.west)/s,l=o.north-o.south,u=(r.south-o.south)/l,h=(r.north-o.south)/l;let d=(n.x-a)/(c-a),f=(n.y-u)/(h-u);return Math.abs(d)<Math.EPSILON5?d=0:Math.abs(d-1)<Math.EPSILON5&&(d=1),Math.abs(f)<Math.EPSILON5?f=0:Math.abs(f-1)<Math.EPSILON5&&(f=1),i.x=d,i.y=f,i}const xZe=new ro;function SZe(e,t,n,i,o){const r=e.encoding,s=e.vertices;if(o.height=r.decodeHeight(s,t),r.hasVertexNormals)r.getOctEncodedNormal(s,t,o.encodedNormal);else{const e=o.encodedNormal;e.x=0,e.y=0}}const IZe=new ro,OZe=new K;function DZe(e,t,n,i,o,r,s,a,c,l){const u=i.encoding,h=i.vertices,d=EZe(t,n,u.decodeTextureCoordinates(h,o,hZe),hZe),f=EZe(t,n,u.decodeTextureCoordinates(h,r,uZe),uZe);let p;p=c?(s-d.x)/(f.x-d.x):(a-d.y)/(f.y-d.y);const m=u.decodeHeight(h,o),_=u.decodeHeight(h,r),g=n.rectangle;let y;if(rZe.longitude=z.lerp(g.west,g.east,s),rZe.latitude=z.lerp(g.south,g.north,a),l.height=rZe.height=z.lerp(m,_,p),u.hasVertexNormals){const e=u.getOctEncodedNormal(h,o,xZe),t=u.getOctEncodedNormal(h,r,IZe),n=wh.octDecode(e.x,e.y,aZe),i=wh.octDecode(t.x,t.y,OZe);y=K.lerp(n,i,p,aZe),K.normalize(y,y),wh.octEncode(y,l.encodedNormal)}else y=e.geodeticSurfaceNormalCartographic(rZe,aZe),wh.octEncode(y,l.encodedNormal)}function PZe(e,t,n,i,o,r){r.height=o;const s=t.geodeticSurfaceNormalCartographic(rZe,aZe);wh.octEncode(s,r.encodedNormal)}function RZe(e,t,n,i,o,r,s,a,c,l,u){const h=zZe(e,t,a,s,!1,n,i,u)||zZe(e,t,l,c,!0,n,i,u);if(h)return u;let d,f;return FZe(o,r)?(d=0===n?0===i?r.eastIndicesNorthToSouth[0]:r.southIndicesEastToWest[0]:0===i?r.northIndicesWestToEast[0]:r.westIndicesSouthToNorth[0],SZe(r,d,n,i,u),u):(f=0===n?0===i?LZe(e.westMeshes,e.westTiles,CN.EAST,e.southMeshes,e.southTiles,CN.NORTH,n,i):LZe(e.northMeshes,e.northTiles,CN.SOUTH,e.westMeshes,e.westTiles,CN.EAST,n,i):0===i?LZe(e.southMeshes,e.southTiles,CN.NORTH,e.eastMeshes,e.eastTiles,CN.WEST,n,i):LZe(e.eastMeshes,e.eastTiles,CN.WEST,e.northMeshes,e.northTiles,CN.SOUTH,n,i),C(f)?(PZe(e,t,n,i,f,u),u):void 0)}function LZe(e,t,n,i,o,r,s,a){const c=NZe(e,t,!1,n,s,a),l=NZe(i,o,!0,r,s,a);return C(c)&&C(l)?.5*(c+l):C(c)?c:l}function MZe(e,t,n,i,o,r,s,a,c){for(let l=0;l<r.length;++l)o=BZe(e,t,n,i,o,r[l],s[l],a,c);return o}function BZe(e,t,n,i,o,r,s,a,c){let l=r.rectangle;a===CN.EAST&&0===e.tile.x?(l=_t.clone(r.rectangle,CZe),l.west-=z.TWO_PI,l.east-=z.TWO_PI):a===CN.WEST&&0===r.x&&(l=_t.clone(r.rectangle,CZe),l.west+=z.TWO_PI,l.east+=z.TWO_PI);const u=e.tile.rectangle;let h,d,f,p;switch(o>0&&(n.decodeTextureCoordinates(i,o-1,hZe),h=hZe.x,d=hZe.y),a){case CN.WEST:f=s.westIndicesSouthToNorth,p=!1;break;case CN.NORTH:f=s.northIndicesWestToEast,p=!0;break;case CN.EAST:f=s.eastIndicesNorthToSouth,p=!1;break;case CN.SOUTH:f=s.southIndicesEastToWest,p=!0;break}const m=r,_=e.tile,g=s.encoding,y=s.vertices,v=n.stride;let b,A;g.hasWebMercatorT&&(b=Vh.geodeticLatitudeToMercatorAngle(u.south),A=1/(Vh.geodeticLatitudeToMercatorAngle(u.north)-b));for(let w=0;w<f.length;++w){const e=f[w],r=g.decodeTextureCoordinates(y,e,hZe);EZe(m,_,r,r);const s=r.x,a=r.y,l=p?s:a;if(l<0||l>1)continue;if(Math.abs(s-h)<z.EPSILON5&&Math.abs(a-d)<z.EPSILON5)continue;const T=Math.abs(s)<z.EPSILON5||Math.abs(s-1)<z.EPSILON5,C=Math.abs(a)<z.EPSILON5||Math.abs(a-1)<z.EPSILON5;if(T&&C)continue;const E=g.decodePosition(y,e,aZe),x=g.decodeHeight(y,e);let S;g.hasVertexNormals?S=g.getOctEncodedNormal(y,e,lZe):(S=lZe,S.x=0,S.y=0);let I,O=a;if(g.hasWebMercatorT){const e=z.lerp(u.south,u.north,a);O=(Vh.geodeticLatitudeToMercatorAngle(e)-b)*A}n.hasGeodeticSurfaceNormals&&(I=t.geodeticSurfaceNormal(E,cZe)),n.encode(i,o*v,E,r,x,S,O,I),c.minimumHeight=Math.min(c.minimumHeight,x),c.maximumHeight=Math.max(c.maximumHeight,x),++o}return o}function NZe(e,t,n,i,o,r){let s,a,c;n?(s=0,a=e.length,c=1):(s=e.length-1,a=-1,c=-1);for(let l=s;l!==a;l+=c){const o=e[l],r=t[l];if(!FZe(r,o))continue;let s;switch(i){case CN.WEST:s=o.westIndicesSouthToNorth;break;case CN.SOUTH:s=o.southIndicesEastToWest;break;case CN.EAST:s=o.eastIndicesNorthToSouth;break;case CN.NORTH:s=o.northIndicesWestToEast;break}const a=s[n?0:s.length-1];if(C(a))return o.encoding.decodeHeight(o.vertices,a)}}function FZe(e,t){return C(t)&&(!C(e.data.fill)||!e.data.fill.changedThisFrame)}function zZe(e,t,n,i,o,r,s,a){let c,l,u,h,d;const f=i[o?0:n.length-1],p=n[o?0:n.length-1];if(FZe(f,p)&&(0===r?0===s?(c=o?p.northIndicesWestToEast:p.eastIndicesNorthToSouth,l=o,u=o):(c=o?p.eastIndicesNorthToSouth:p.southIndicesEastToWest,l=!o,u=!1):0===s?(c=o?p.westIndicesSouthToNorth:p.northIndicesWestToEast,l=!o,u=!0):(c=o?p.southIndicesEastToWest:p.westIndicesSouthToNorth,l=o,u=!o),c.length>0)){h=o?0:c.length-1,d=c[h],p.encoding.decodeTextureCoordinates(p.vertices,d,hZe);const n=EZe(f,e.tile,hZe,hZe);if(n.x===r&&n.y===s)return SZe(p,d,r,s,a),!0;if(h=qs(c,l?r:s,(function(t,n){p.encoding.decodeTextureCoordinates(p.vertices,t,hZe);const i=EZe(f,e.tile,hZe,hZe);return u?l?i.x-r:i.y-s:l?r-i.x:s-i.y})),!(h<0))return SZe(p,c[h],r,s,a),!0;if(h=~h,h>0&&h<c.length)return DZe(t,f,e.tile,p,c[h-1],c[h],r,s,l,a),!0}return!1}const kZe=[new K,new K,new K,new K];function UZe(e,t,n,i,o,r){const s=e.quadtree._occluders.ellipsoid,a=s.ellipsoid,c=kZe;return K.fromRadians(n.west,n.south,o,a,c[0]),K.fromRadians(n.east,n.south,o,a,c[1]),K.fromRadians(n.west,n.north,o,a,c[2]),K.fromRadians(n.east,n.north,o,a,c[3]),s.computeHorizonCullingPointPossiblyUnderEllipsoid(t,c,i,r)}var VZe=eZe;function HZe(e){if(!C(e))throw new x("options is required.");if(!C(e.terrainProvider))throw new x("options.terrainProvider is required.");if(!C(e.imageryLayers))throw new x("options.imageryLayers is required.");if(!C(e.surfaceShaderSet))throw new x("options.surfaceShaderSet is required.");this.lightingFadeOutDistance=65e5,this.lightingFadeInDistance=9e6,this.hasWaterMask=!1,this.oceanNormalMap=void 0,this.zoomedOutOceanSpecularIntensity=.5,this.enableLighting=!1,this.dynamicAtmosphereLighting=!1,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!1,this.shadows=rj.RECEIVE_ONLY,this.fillHighlightColor=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this.undergroundColor=void 0,this.undergroundColorAlphaByDistance=void 0,this.lambertDiffuseMultiplier=0,this.materialUniformMap=void 0,this._materialUniformMap=void 0,this._quadtree=void 0,this._terrainProvider=e.terrainProvider,this._imageryLayers=e.imageryLayers,this._surfaceShaderSet=e.surfaceShaderSet,this._renderState=void 0,this._blendRenderState=void 0,this._disableCullingRenderState=void 0,this._disableCullingBlendRenderState=void 0,this._errorEvent=new $n,this._imageryLayers.layerAdded.addEventListener(HZe.prototype._onLayerAdded,this),this._imageryLayers.layerRemoved.addEventListener(HZe.prototype._onLayerRemoved,this),this._imageryLayers.layerMoved.addEventListener(HZe.prototype._onLayerMoved,this),this._imageryLayers.layerShownOrHidden.addEventListener(HZe.prototype._onLayerShownOrHidden,this),this._imageryLayersUpdatedEvent=new $n,this._layerOrderChanged=!1,this._tilesToRenderByTextureCount=[],this._drawCommands=[],this._uniformMaps=[],this._usedDrawCommands=0,this._vertexArraysToDestroy=[],this._debug={wireframe:!1,boundingSphereTile:void 0},this._baseColor=void 0,this._firstPassInitialColor=void 0,this.baseColor=new xy(0,0,.5,1),this._clippingPlanes=void 0,this.cartographicLimitRectangle=_t.clone(_t.MAX_VALUE),this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1,this._oldTerrainExaggeration=void 0,this._oldTerrainExaggerationRelativeHeight=void 0}function GZe(e,t){let n=e.loadingImagery;C(n)||(n=e.readyImagery);let i=t.loadingImagery;return C(i)||(i=t.readyImagery),n.imageryLayer._layerIndex-i.imageryLayer._layerIndex}function WZe(e,t){const n=t.creditDisplay;e._terrainProvider.ready&&C(e._terrainProvider.credit)&&n.addCredit(e._terrainProvider.credit);const i=e._imageryLayers;for(let o=0,r=i.length;o<r;++o){const e=i.get(o).imageryProvider;e.ready&&C(e.credit)&&n.addCredit(e.credit)}}function qZe(e,t){const n=t.globeTranslucencyState;if(n.translucent){const i=e.renderState.blending.enabled;n.pushDerivedCommands(e,i,t)}else t.commandList.push(e)}Object.defineProperties(HZe.prototype,{baseColor:{get:function(){return this._baseColor},set:function(e){if(!C(e))throw new x("value is required.");this._baseColor=e,this._firstPassInitialColor=Xe.fromColor(e,this._firstPassInitialColor)}},quadtree:{get:function(){return this._quadtree},set:function(e){if(!C(e))throw new x("value is required.");this._quadtree=e}},ready:{get:function(){return this._terrainProvider.ready&&(0===this._imageryLayers.length||this._imageryLayers.get(0).imageryProvider.ready)}},tilingScheme:{get:function(){return this._terrainProvider.tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},imageryLayersUpdatedEvent:{get:function(){return this._imageryLayersUpdatedEvent}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){if(this._terrainProvider!==e){if(!C(e))throw new x("terrainProvider is required.");this._terrainProvider=e,C(this._quadtree)&&this._quadtree.invalidateAllTiles()}}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){_3.setOwner(e,this,"_clippingPlanes")}}}),HZe.prototype.update=function(e){this._imageryLayers._update()},HZe.prototype.initialize=function(e){this._imageryLayers.queueReprojectionCommands(e),this._layerOrderChanged&&(this._layerOrderChanged=!1,this._quadtree.forEachLoadedTile((function(e){e.data.imagery.sort(GZe)}))),WZe(this,e);const t=this._vertexArraysToDestroy,n=t.length;for(let i=0;i<n;++i)LJe._freeVertexArray(t[i]);t.length=0},HZe.prototype.beginUpdate=function(e){const t=this._tilesToRenderByTextureCount;for(let i=0,o=t.length;i<o;++i){const e=t[i];C(e)&&(e.length=0)}const n=this._clippingPlanes;C(n)&&n.enabled&&n.update(e),this._usedDrawCommands=0,this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1},HZe.prototype.endUpdate=function(e){if(!C(this._renderState)){this._renderState=yV.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:aq.LESS}}),this._blendRenderState=yV.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:aq.LESS_OR_EQUAL},blending:_k.ALPHA_BLEND});let e=pn(this._renderState,!0);e.cull.enabled=!1,this._disableCullingRenderState=yV.fromCache(e),e=pn(this._blendRenderState,!0),e.cull.enabled=!1,this._disableCullingBlendRenderState=yV.fromCache(e)}this._hasFillTilesThisFrame&&this._hasLoadedTilesThisFrame&&VZe.updateFillTiles(this,this._quadtree._tilesToRender,e,this._vertexArraysToDestroy);const t=this.quadtree,n=e.terrainExaggeration,i=e.terrainExaggerationRelativeHeight,o=this._oldTerrainExaggeration!==n||this._oldTerrainExaggerationRelativeHeight!==i;this._oldTerrainExaggeration=n,this._oldTerrainExaggerationRelativeHeight=i,o&&t.forEachLoadedTile((function(n){const i=n.data;i.updateExaggeration(n,e,t)}));const r=this._tilesToRenderByTextureCount;for(let s=0,a=r.length;s<a;++s){const t=r[s];if(C(t))for(let n=0,i=t.length;n<i;++n){const i=t[n],o=i.data.tileBoundingRegion;x$e(this,i,e),e.minimumTerrainHeight=Math.min(e.minimumTerrainHeight,o.minimumHeight)}}},HZe.prototype.updateForPick=function(e){const t=this._drawCommands;for(let n=0,i=this._usedDrawCommands;n<i;++n)qZe(t[n],e)},HZe.prototype.cancelReprojections=function(){this._imageryLayers.cancelReprojections()},HZe.prototype.getLevelMaximumGeometricError=function(e){return this._terrainProvider.getLevelMaximumGeometricError(e)},HZe.prototype.loadTile=function(e,t){let n,i=t.data,o=!0;C(i)&&(o=i.boundingVolumeSourceTile!==t||t._lastSelectionResult===$Je.CULLED_BUT_NEEDED,n=i.terrainState),LJe.processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this.quadtree,this._vertexArraysToDestroy,o),i=t.data,o&&n!==t.data.terrainState&&this.computeTileVisibility(t,e,this.quadtree.occluders)!==BO.NONE&&i.boundingVolumeSourceTile===t&&(o=!1,LJe.processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this.quadtree,this._vertexArraysToDestroy,o))};const jZe=new nn,YZe=new _t,KZe=new _t,XZe=new se;function QZe(e,t){if(t.west<t.east)return t;const n=_t.clone(t,KZe),i=_t.center(e,XZe);return i.longitude>0?n.east=z.PI:n.west=-z.PI,n}function JZe(e,t){if(t.cameraUnderground)return!0;if(t.globeTranslucencyState.translucent)return!0;if(e.backFaceCulling)return!1;const n=e._clippingPlanes;return!(!C(n)||!n.enabled)||!_t.equals(e.cartographicLimitRectangle,_t.MAX_VALUE)}HZe.prototype.computeTileVisibility=function(e,t,n){const i=this.computeDistanceToTile(e,t);e._distance=i;const o=JZe(this,t);if(t.fog.enabled&&!o&&z.fog(i,t.fog.density)>=1)return BO.NONE;const r=e.data,s=r.tileBoundingRegion;if(void 0===r.boundingVolumeSourceTile)return BO.PARTIAL;const a=t.cullingVolume;let c=s.boundingVolume;C(c)||(c=s.boundingSphere),r.clippedByBoundaries=!1;const l=QZe(e.rectangle,this.cartographicLimitRectangle),u=_t.simpleIntersection(l,e.rectangle,YZe);if(!C(u))return BO.NONE;if(_t.equals(u,e.rectangle)||(r.clippedByBoundaries=!0),t.mode!==ij.SCENE3D&&(c=jZe,nn.fromRectangleWithHeights2D(e.rectangle,t.mapProjection,s.minimumHeight,s.maximumHeight,c),K.fromElements(c.center.z,c.center.x,c.center.y,c.center),t.mode===ij.MORPHING&&C(r.renderedMesh)&&(c=nn.union(s.boundingSphere,c,c))),!C(c))return BO.PARTIAL;const h=this._clippingPlanes;if(C(h)&&h.enabled){const t=h.computeIntersectionWithBoundingVolume(c);if(e.isClipped=t!==Ae.INSIDE,t===Ae.OUTSIDE)return BO.NONE}let d;const f=a.computeVisibility(c);if(f===Ae.OUTSIDE?d=BO.NONE:f===Ae.INTERSECTING?d=BO.PARTIAL:f===Ae.INSIDE&&(d=BO.FULL),d===BO.NONE)return d;const p=t.mode===ij.SCENE3D&&t.camera.frustum instanceof jC;if(t.mode===ij.SCENE3D&&!p&&C(n)&&!o){const e=r.occludeePointInScaledSpace;return C(e)?n.ellipsoid.isScaledSpacePointVisiblePossiblyUnderEllipsoid(e,s.minimumHeight)?d:BO.NONE:d}return d},HZe.prototype.canRefine=function(e){if(C(e.data.terrainData))return!0;const t=this.terrainProvider.getTileDataAvailable(2*e.x,2*e.y,e.level+1);return void 0!==t};const ZZe=[],$Ze=[];HZe.prototype.canRenderWithoutLosingDetail=function(e,t){const n=e.data,i=ZZe;i.length=this._imageryLayers.length;let o,r,s,a=!1,c=!1;for(C(n)&&(a=n.terrainState===_Je.READY,c=!0,o=n.imagery),r=0,s=i.length;r<s;++r)i[r]=c;if(C(o))for(r=0,s=o.length;r<s;++r){const e=o[r],t=e.loadingImagery,n=!C(t)||t.state===dJe.FAILED||t.state===dJe.INVALID,s=(e.loadingImagery||e.readyImagery).imageryLayer._layerIndex;i[s]=n&&i[s]}const l=this.quadtree._lastSelectionFrameNumber,u=$Ze;u.length=0,u.push(e.southwestChild,e.southeastChild,e.northwestChild,e.northeastChild);while(u.length>0){const e=u.pop(),t=e._lastSelectionResultFrame===l?e._lastSelectionResult:$Je.NONE;if(t===$Je.RENDERED){const t=e.data;if(!C(t))continue;if(!a&&e.data.terrainState===_Je.READY)return!1;const n=e.data.imagery;for(r=0,s=n.length;r<s;++r){const e=n[r],t=e.loadingImagery,o=!C(t)||t.state===dJe.FAILED||t.state===dJe.INVALID,s=(e.loadingImagery||e.readyImagery).imageryLayer._layerIndex;if(o&&!i[s])return!1}}else t===$Je.REFINED&&u.push(e.southwestChild,e.southeastChild,e.northwestChild,e.northeastChild)}return!0};const e$e=new K;HZe.prototype.computeTileLoadPriority=function(e,t){const n=e.data;if(void 0===n)return 0;const i=n.tileBoundingRegion.boundingVolume;if(void 0===i)return 0;const o=t.camera.positionWC,r=t.camera.directionWC,s=K.subtract(i.center,o,e$e),a=K.magnitude(s);return a<z.EPSILON5?0:(K.divideByScalar(s,a,s),(1-K.dot(s,r))*e._distance)};const t$e=new ft,n$e=new ft,i$e=new Xe,o$e=new Xe,r$e=new Xe,s$e=new K,a$e=new K,c$e=new K,l$e=new K;HZe.prototype.showTileThisFrame=function(e,t){let n=0;const i=e.data.imagery;for(let a=0,c=i.length;a<c;++a){const e=i[a];C(e.readyImagery)&&0!==e.readyImagery.imageryLayer.alpha&&++n}let o=this._tilesToRenderByTextureCount[n];C(o)||(o=[],this._tilesToRenderByTextureCount[n]=o),o.push(e);const r=e.data;C(r.vertexArray)?this._hasLoadedTilesThisFrame=!0:this._hasFillTilesThisFrame=!0;const s=this._debug;++s.tilesRendered,s.texturesRendered+=n};const u$e=[new K,new K,new K,new K];function h$e(e,t,n,i,o,r){const s=e.quadtree._occluders.ellipsoid,a=s.ellipsoid,c=u$e;return K.fromRadians(n.west,n.south,o,a,c[0]),K.fromRadians(n.east,n.south,o,a,c[1]),K.fromRadians(n.west,n.north,o,a,c[2]),K.fromRadians(n.east,n.north,o,a,c[3]),s.computeHorizonCullingPointPossiblyUnderEllipsoid(t,c,i,r)}function d$e(e,t,n){let i=e.data;void 0===i&&(i=e.data=new LJe);const o=e.tilingScheme.ellipsoid;void 0===i.tileBoundingRegion&&(i.tileBoundingRegion=new kge({computeBoundingVolumes:!1,rectangle:e.rectangle,ellipsoid:o,minimumHeight:0,maximumHeight:0}));const r=i.tileBoundingRegion,s=r.minimumHeight,a=r.maximumHeight;let c=!1,l=e;const u=i.mesh,h=i.terrainData;if(void 0!==u&&void 0!==u.minimumHeight&&void 0!==u.maximumHeight)r.minimumHeight=u.minimumHeight,r.maximumHeight=u.maximumHeight,c=!0;else if(void 0!==h&&void 0!==h._minimumHeight&&void 0!==h._maximumHeight)r.minimumHeight=h._minimumHeight,r.maximumHeight=h._maximumHeight;else{r.minimumHeight=Number.NaN,r.maximumHeight=Number.NaN;let t=e.parent;while(void 0!==t){const e=t.data;if(void 0!==e){const t=e.mesh,n=e.terrainData;if(void 0!==t&&void 0!==t.minimumHeight&&void 0!==t.maximumHeight){r.minimumHeight=t.minimumHeight,r.maximumHeight=t.maximumHeight;break}if(void 0!==n&&void 0!==n._minimumHeight&&void 0!==n._maximumHeight){r.minimumHeight=n._minimumHeight,r.maximumHeight=n._maximumHeight;break}}t=t.parent}l=t}if(void 0!==l){const h=n.terrainExaggeration,d=n.terrainExaggerationRelativeHeight,f=1!==h;if(f&&(c=!1,r.minimumHeight=Eh.getHeight(r.minimumHeight,h,d),r.maximumHeight=Eh.getHeight(r.maximumHeight,h,d)),c)i.boundingVolumeIsFromMesh||(r._orientedBoundingBox=$u.clone(u.orientedBoundingBox,r._orientedBoundingBox),r._boundingSphere=nn.clone(u.boundingSphere3D,r._boundingSphere),i.occludeePointInScaledSpace=K.clone(u.occludeePointInScaledSpace,i.occludeePointInScaledSpace),C(i.occludeePointInScaledSpace)||(i.occludeePointInScaledSpace=h$e(t,r._orientedBoundingBox.center,e.rectangle,r.minimumHeight,r.maximumHeight,i.occludeePointInScaledSpace)));else{const n=void 0===r._orientedBoundingBox||void 0===r._boundingSphere,c=r.minimumHeight!==s||r.maximumHeight!==a;(c||n)&&(r.computeBoundingVolumes(o),i.occludeePointInScaledSpace=h$e(t,r._orientedBoundingBox.center,e.rectangle,r.minimumHeight,r.maximumHeight,i.occludeePointInScaledSpace))}i.boundingVolumeSourceTile=l,i.boundingVolumeIsFromMesh=c}else i.boundingVolumeSourceTile=void 0,i.boundingVolumeIsFromMesh=!1}function f$e(e,t,n){return function(i){let o,r,s=-1;const a=i.data.imagery,c=a.length;let l;for(l=0;l<c;++l)if(o=a[l],r=R(o.readyImagery,o.loadingImagery),r.imageryLayer===t){s=l;break}if(-1!==s){const c=s+e;if(o=a[c],r=C(o)?R(o.readyImagery,o.loadingImagery):void 0,!C(r)||r.imageryLayer!==t)return!t._createTileImagerySkeletons(i,n,c);for(l=s;l<c;++l)a[l].freeResources();a.splice(s,e)}return!0}}HZe.prototype.computeDistanceToTile=function(e,t){d$e(e,this,t);const n=e.data,i=n.boundingVolumeSourceTile;if(void 0===i)return 9999999999;const o=n.tileBoundingRegion,r=o.minimumHeight,s=o.maximumHeight;if(n.boundingVolumeSourceTile!==e){const e=t.camera.positionCartographic.height,n=Math.abs(e-r),i=Math.abs(e-s);n>i?(o.minimumHeight=r,o.maximumHeight=r):(o.minimumHeight=s,o.maximumHeight=s)}const a=o.distanceToCamera(t);return o.minimumHeight=r,o.maximumHeight=s,a},HZe.prototype.isDestroyed=function(){return!1},HZe.prototype.destroy=function(){return this._tileProvider=this._tileProvider&&this._tileProvider.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),Qh(this)},HZe.prototype._onLayerAdded=function(e,t){if(e.show){const t=this._terrainProvider,n=this,i=e.imageryProvider,o=this._imageryLayersUpdatedEvent;i._reload=function(){e._imageryCache={},n._quadtree.forEachLoadedTile((function(n){if(C(n._loadedCallbacks[e._layerIndex]))return;let i;const o=n.data.imagery,r=o.length;let s=-1,a=0;for(i=0;i<r;++i){const t=o[i],n=R(t.readyImagery,t.loadingImagery);if(n.imageryLayer===e)-1===s&&(s=i),++a;else if(-1!==s)break}if(-1===s)return;const c=s+a;e._createTileImagerySkeletons(n,t,c)&&(n._loadedCallbacks[e._layerIndex]=f$e(a,e,t),n.state=pJe.LOADING)}))},this._quadtree.forEachLoadedTile((function(i){e._createTileImagerySkeletons(i,t)&&(i.state=pJe.LOADING,0===i.level||i._lastSelectionResultFrame===n.quadtree._lastSelectionFrameNumber&&i._lastSelectionResult===$Je.RENDERED||(i.renderable=!1))})),this._layerOrderChanged=!0,o.raiseEvent()}},HZe.prototype._onLayerRemoved=function(e,t){this._quadtree.forEachLoadedTile((function(t){const n=t.data.imagery;let i=-1,o=0;for(let r=0,s=n.length;r<s;++r){const t=n[r];let s=t.loadingImagery;if(C(s)||(s=t.readyImagery),s.imageryLayer===e)-1===i&&(i=r),t.freeResources(),++o;else if(-1!==i)break}-1!==i&&n.splice(i,o)})),C(e.imageryProvider)&&(e.imageryProvider._reload=void 0),this._imageryLayersUpdatedEvent.raiseEvent()},HZe.prototype._onLayerMoved=function(e,t,n){this._layerOrderChanged=!0,this._imageryLayersUpdatedEvent.raiseEvent()},HZe.prototype._onLayerShownOrHidden=function(e,t,n){n?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)};const p$e=new ft,m$e=new ft;function _$e(e,t){const n={u_initialColor:function(){return this.properties.initialColor},u_fillHighlightColor:function(){return this.properties.fillHighlightColor},u_zoomedOutOceanSpecularIntensity:function(){return this.properties.zoomedOutOceanSpecularIntensity},u_oceanNormalMap:function(){return this.properties.oceanNormalMap},u_lightingFadeDistance:function(){return this.properties.lightingFadeDistance},u_nightFadeDistance:function(){return this.properties.nightFadeDistance},u_center3D:function(){return this.properties.center3D},u_terrainExaggerationAndRelativeHeight:function(){return this.properties.terrainExaggerationAndRelativeHeight},u_tileRectangle:function(){return this.properties.tileRectangle},u_modifiedModelView:function(){const t=e.context.uniformState.view,n=ft.multiplyByPoint(t,this.properties.rtc,a$e);return ft.setTranslation(t,n,t$e),t$e},u_modifiedModelViewProjection:function(){const t=e.context.uniformState.view,n=e.context.uniformState.projection,i=ft.multiplyByPoint(t,this.properties.rtc,a$e);return ft.setTranslation(t,i,n$e),ft.multiply(n,n$e,n$e),n$e},u_dayTextures:function(){return this.properties.dayTextures},u_dayTextureTranslationAndScale:function(){return this.properties.dayTextureTranslationAndScale},u_dayTextureTexCoordsRectangle:function(){return this.properties.dayTextureTexCoordsRectangle},u_dayTextureUseWebMercatorT:function(){return this.properties.dayTextureUseWebMercatorT},u_dayTextureAlpha:function(){return this.properties.dayTextureAlpha},u_dayTextureNightAlpha:function(){return this.properties.dayTextureNightAlpha},u_dayTextureDayAlpha:function(){return this.properties.dayTextureDayAlpha},u_dayTextureBrightness:function(){return this.properties.dayTextureBrightness},u_dayTextureContrast:function(){return this.properties.dayTextureContrast},u_dayTextureHue:function(){return this.properties.dayTextureHue},u_dayTextureSaturation:function(){return this.properties.dayTextureSaturation},u_dayTextureOneOverGamma:function(){return this.properties.dayTextureOneOverGamma},u_dayIntensity:function(){return this.properties.dayIntensity},u_southAndNorthLatitude:function(){return this.properties.southAndNorthLatitude},u_southMercatorYAndOneOverHeight:function(){return this.properties.southMercatorYAndOneOverHeight},u_waterMask:function(){return this.properties.waterMask},u_waterMaskTranslationAndScale:function(){return this.properties.waterMaskTranslationAndScale},u_minMaxHeight:function(){return this.properties.minMaxHeight},u_scaleAndBias:function(){return this.properties.scaleAndBias},u_dayTextureSplit:function(){return this.properties.dayTextureSplit},u_dayTextureCutoutRectangles:function(){return this.properties.dayTextureCutoutRectangles},u_clippingPlanes:function(){const n=t._clippingPlanes;return C(n)&&C(n.texture)?n.texture:e.context.defaultTexture},u_cartographicLimitRectangle:function(){return this.properties.localizedCartographicLimitRectangle},u_clippingPlanesMatrix:function(){const n=t._clippingPlanes,i=C(n)?ft.multiply(e.context.uniformState.view,n.modelMatrix,p$e):ft.IDENTITY;return ft.inverseTranspose(i,m$e)},u_clippingPlanesEdgeStyle:function(){const e=this.properties.clippingPlanesEdgeColor;return e.alpha=this.properties.clippingPlanesEdgeWidth,e},u_minimumBrightness:function(){return e.fog.minimumBrightness},u_hsbShift:function(){return this.properties.hsbShift},u_colorsToAlpha:function(){return this.properties.colorsToAlpha},u_frontFaceAlphaByDistance:function(){return this.properties.frontFaceAlphaByDistance},u_backFaceAlphaByDistance:function(){return this.properties.backFaceAlphaByDistance},u_translucencyRectangle:function(){return this.properties.localizedTranslucencyRectangle},u_undergroundColor:function(){return this.properties.undergroundColor},u_undergroundColorAlphaByDistance:function(){return this.properties.undergroundColorAlphaByDistance},u_lambertDiffuseMultiplier:function(){return this.properties.lambertDiffuseMultiplier},properties:{initialColor:new Xe(0,0,.5,1),fillHighlightColor:new xy(0,0,0,0),zoomedOutOceanSpecularIntensity:.5,oceanNormalMap:void 0,lightingFadeDistance:new ro(65e5,9e6),nightFadeDistance:new ro(1e7,4e7),hsbShift:new K,center3D:void 0,rtc:new K,modifiedModelView:new ft,tileRectangle:new Xe,terrainExaggerationAndRelativeHeight:new ro(1,0),dayTextures:[],dayTextureTranslationAndScale:[],dayTextureTexCoordsRectangle:[],dayTextureUseWebMercatorT:[],dayTextureAlpha:[],dayTextureNightAlpha:[],dayTextureDayAlpha:[],dayTextureBrightness:[],dayTextureContrast:[],dayTextureHue:[],dayTextureSaturation:[],dayTextureOneOverGamma:[],dayTextureSplit:[],dayTextureCutoutRectangles:[],dayIntensity:0,colorsToAlpha:[],southAndNorthLatitude:new ro,southMercatorYAndOneOverHeight:new ro,waterMask:void 0,waterMaskTranslationAndScale:new Xe,minMaxHeight:new ro,scaleAndBias:new ft,clippingPlanesEdgeColor:xy.clone(xy.WHITE),clippingPlanesEdgeWidth:0,localizedCartographicLimitRectangle:new Xe,frontFaceAlphaByDistance:new Xe,backFaceAlphaByDistance:new Xe,localizedTranslucencyRectangle:new Xe,undergroundColor:xy.clone(xy.TRANSPARENT),undergroundColorAlphaByDistance:new Xe,lambertDiffuseMultiplier:0}};return C(t.materialUniformMap)?_n(n,t.materialUniformMap):n}function g$e(e,t,n){const i=n.data;let o,r;if(C(i.vertexArray)?(o=i.mesh,r=i.vertexArray):C(i.fill)&&C(i.fill.vertexArray)&&(o=i.fill.mesh,r=i.fill.vertexArray),C(o)&&C(r)){if(C(i.wireframeVertexArray)){if(i.wireframeVertexArray.mesh===o)return;i.wireframeVertexArray.destroy(),i.wireframeVertexArray=void 0}i.wireframeVertexArray=y$e(e,r,o),i.wireframeVertexArray.mesh=o}}function y$e(e,t,n){const i=n.indices,o={indices:i,primitiveType:xf.TRIANGLES};fg.toWireframe(o);const r=o.indices,s=hq.createIndexBuffer({context:e,typedArray:r,usage:lq.STATIC_DRAW,indexDatatype:fd.fromSizeInBytes(r.BYTES_PER_ELEMENT)});return new bq({context:e,attributes:t._attributes,indexBuffer:s})}let v$e,b$e,A$e;(function(){const e=new Sm({geometry:sp.fromDimensions({dimensions:new K(2,2,2)})}),t=new Sm({geometry:new bN({radius:1})});let n,i,o=new ft;function r(e){return new tY({geometryInstances:e,appearance:new LU({translucent:!1,flat:!0}),asynchronous:!1})}v$e=function(t,s){return t===n||(A$e(),n=t,o=ft.fromRotationTranslation(t.halfAxes,t.center,o),e.modelMatrix=o,e.attributes.color=Iy.fromColor(s),i=r(e)),i},b$e=function(e,s){return e===n||(A$e(),n=e,o=ft.fromTranslation(e.center,o),o=ft.multiplyByUniformScale(o,e.radius,o),t.modelMatrix=o,t.attributes.color=Iy.fromColor(s),i=r(t)),i},A$e=function(){C(i)&&(i.destroy(),i=void 0,n=void 0)}})();const w$e=new Xe(0,0,0,0),T$e={frameState:void 0,surfaceTile:void 0,numberOfDayTextures:void 0,applyBrightness:void 0,applyContrast:void 0,applyHue:void 0,applySaturation:void 0,applyGamma:void 0,applyAlpha:void 0,applyDayNightAlpha:void 0,applySplit:void 0,showReflectiveOcean:void 0,showOceanWaves:void 0,enableLighting:void 0,dynamicAtmosphereLighting:void 0,dynamicAtmosphereLightingFromSun:void 0,showGroundAtmosphere:void 0,perFragmentGroundAtmosphere:void 0,hasVertexNormals:void 0,useWebMercatorProjection:void 0,enableFog:void 0,enableClippingPlanes:void 0,clippingPlanes:void 0,clippedByBoundaries:void 0,hasImageryLayerCutout:void 0,colorCorrect:void 0,colorToAlpha:void 0,hasGeodeticSurfaceNormals:void 0,hasExaggeration:void 0},C$e=xy.TRANSPARENT,E$e=new LO;function x$e(e,t,n){const i=t.data;C(i.vertexArray)||(void 0===i.fill&&(i.fill=new VZe(t)),i.fill.update(e,n));const o=n.creditDisplay,r=i.terrainData;if(C(r)&&C(r.credits)){const e=r.credits;for(let t=0,n=e.length;t<n;++t)o.addCredit(e[t])}let s=Ck.maximumTextureImageUnits,a=i.waterMaskTexture,c=i.waterMaskTranslationAndScale;!C(a)&&C(i.fill)&&(a=i.fill.waterMaskTexture,c=i.fill.waterMaskTranslationAndScale);const l=n.cameraUnderground,u=n.globeTranslucencyState,h=u.translucent,d=u.frontFaceAlphaByDistance,f=u.backFaceAlphaByDistance,p=u.rectangle,m=R(e.undergroundColor,C$e),_=R(e.undergroundColorAlphaByDistance,E$e),g=JZe(e,n)&&n.mode===ij.SCENE3D&&m.alpha>0&&(_.nearValue>0||_.farValue>0),y=e.lambertDiffuseMultiplier,v=e.hasWaterMask&&C(a),b=e.oceanNormalMap,A=v&&C(b),w=e.terrainProvider.ready&&e.terrainProvider.hasVertexNormals,T=n.fog.enabled&&n.fog.renderable&&!l,E=e.showGroundAtmosphere&&n.mode===ij.SCENE3D,S=rj.castShadows(e.shadows)&&!h,I=rj.receiveShadows(e.shadows)&&!h,O=e.hueShift,D=e.saturationShift,P=e.brightnessShift;let L=!(z.equalsEpsilon(O,0,z.EPSILON7)&&z.equalsEpsilon(D,0,z.EPSILON7)&&z.equalsEpsilon(P,0,z.EPSILON7)),M=!1;if(E){const t=K.magnitude(n.camera.positionWC),i=e.nightFadeOutDistance;M=t>i}v&&--s,A&&--s,C(n.shadowState)&&n.shadowState.shadowsEnabled&&--s,C(e.clippingPlanes)&&e.clippingPlanes.enabled&&--s,s-=u.numberOfTextureUniforms;const B=i.renderedMesh;let N=B.center;const F=B.encoding,k=i.tileBoundingRegion,U=n.terrainExaggeration,V=n.terrainExaggerationRelativeHeight,H=1!==U,G=F.hasGeodeticSurfaceNormals,W=i$e;let q=0,j=0,Y=0,X=0,Q=!1;if(n.mode!==ij.SCENE3D){const e=n.mapProjection,i=e.project(_t.southwest(t.rectangle),c$e),o=e.project(_t.northeast(t.rectangle),l$e);if(W.x=i.x,W.y=i.y,W.z=o.x,W.w=o.y,n.mode!==ij.MORPHING&&(N=s$e,N.x=0,N.y=.5*(W.z+W.x),N.z=.5*(W.w+W.y),W.x-=N.y,W.y-=N.z,W.z-=N.y,W.w-=N.z),n.mode===ij.SCENE2D&&F.quantization===Sh.BITS12){const e=1/(Math.pow(2,12)-1)*.5,t=(W.z-W.x)*e,n=(W.w-W.y)*e;W.x-=t,W.y-=n,W.z+=t,W.w+=n}e instanceof Vh&&(q=t.rectangle.south,j=t.rectangle.north,Y=Vh.geodeticLatitudeToMercatorAngle(q),X=1/(Vh.geodeticLatitudeToMercatorAngle(j)-Y),Q=!0)}const J=T$e;J.frameState=n,J.surfaceTile=i,J.showReflectiveOcean=v,J.showOceanWaves=A,J.enableLighting=e.enableLighting,J.dynamicAtmosphereLighting=e.dynamicAtmosphereLighting,J.dynamicAtmosphereLightingFromSun=e.dynamicAtmosphereLightingFromSun,J.showGroundAtmosphere=E,J.perFragmentGroundAtmosphere=M,J.hasVertexNormals=w,J.useWebMercatorProjection=Q,J.clippedByBoundaries=i.clippedByBoundaries,J.hasGeodeticSurfaceNormals=G,J.hasExaggeration=H;const Z=i.imagery;let $=0;const ee=Z.length,te=e.showSkirts&&!l&&!h,ne=e.backFaceCulling&&!l&&!h,ie=ne?e._renderState:e._disableCullingRenderState,oe=ne?e._blendRenderState:e._disableCullingBlendRenderState;let re=ie,se=e._firstPassInitialColor;const ae=n.context;C(e._debug.boundingSphereTile)||A$e();const ce=e._materialUniformMap!==e.materialUniformMap;if(ce){e._materialUniformMap=e.materialUniformMap;const t=e._drawCommands.length;for(let i=0;i<t;++i)e._uniformMaps[i]=_$e(n,e)}do{let r,v,A=0;if(e._drawCommands.length<=e._usedDrawCommands?(r=new UU,r.owner=t,r.cull=!1,r.boundingVolume=new nn,r.orientedBoundingBox=void 0,v=_$e(n,e),e._drawCommands.push(r),e._uniformMaps.push(v)):(r=e._drawCommands[e._usedDrawCommands],v=e._uniformMaps[e._usedDrawCommands]),r.owner=t,++e._usedDrawCommands,t===e._debug.boundingSphereTile){const e=k.boundingVolume,t=k.boundingSphere;C(e)?v$e(e,xy.RED).update(n):C(t)&&b$e(t,xy.RED).update(n)}const w=v.properties;Xe.clone(se,w.initialColor),w.oceanNormalMap=b,w.lightingFadeDistance.x=e.lightingFadeOutDistance,w.lightingFadeDistance.y=e.lightingFadeInDistance,w.nightFadeDistance.x=e.nightFadeOutDistance,w.nightFadeDistance.y=e.nightFadeInDistance,w.zoomedOutOceanSpecularIntensity=e.zoomedOutOceanSpecularIntensity;const R=l?f:d,M=l?d:f;C(R)&&(Xe.fromElements(R.near,R.nearValue,R.far,R.farValue,w.frontFaceAlphaByDistance),Xe.fromElements(M.near,M.nearValue,M.far,M.farValue,w.backFaceAlphaByDistance)),Xe.fromElements(_.near,_.nearValue,_.far,_.farValue,w.undergroundColorAlphaByDistance),xy.clone(m,w.undergroundColor),w.lambertDiffuseMultiplier=y;const H=!C(i.vertexArray)&&C(e.fillHighlightColor)&&e.fillHighlightColor.alpha>0;H&&xy.clone(e.fillHighlightColor,w.fillHighlightColor),w.terrainExaggerationAndRelativeHeight.x=U,w.terrainExaggerationAndRelativeHeight.y=V,w.center3D=B.center,K.clone(N,w.rtc),Xe.clone(W,w.tileRectangle),w.southAndNorthLatitude.x=q,w.southAndNorthLatitude.y=j,w.southMercatorYAndOneOverHeight.x=Y,w.southMercatorYAndOneOverHeight.y=X;const G=o$e,Q=QZe(t.rectangle,e.cartographicLimitRectangle),ne=r$e,ie=QZe(t.rectangle,p);K.fromElements(O,D,P,w.hsbShift);const ce=t.rectangle,le=1/ce.width,ue=1/ce.height;G.x=(Q.west-ce.west)*le,G.y=(Q.south-ce.south)*ue,G.z=(Q.east-ce.west)*le,G.w=(Q.north-ce.south)*ue,Xe.clone(G,w.localizedCartographicLimitRectangle),ne.x=(ie.west-ce.west)*le,ne.y=(ie.south-ce.south)*ue,ne.z=(ie.east-ce.west)*le,ne.w=(ie.north-ce.south)*ue,Xe.clone(ne,w.localizedTranslucencyRectangle);const he=T&&z.fog(t._distance,n.fog.density)>z.EPSILON3;L=L&&(he||E);let de=!1,fe=!1,pe=!1,me=!1,_e=!1,ge=!1,ye=!1,ve=!1,be=!1,Ae=!1;while(A<s&&$<ee){const e=Z[$],n=e.readyImagery;if(++$,!C(n)||0===n.imageryLayer.alpha)continue;const i=e.useWebMercatorT?n.textureWebMercator:n.texture;if(!C(i))throw new x("readyImagery is not actually ready!");const r=n.imageryLayer;C(e.textureTranslationAndScale)||(e.textureTranslationAndScale=r._calculateTextureTranslationAndScale(t,e)),w.dayTextures[A]=i,w.dayTextureTranslationAndScale[A]=e.textureTranslationAndScale,w.dayTextureTexCoordsRectangle[A]=e.textureCoordinateRectangle,w.dayTextureUseWebMercatorT[A]=e.useWebMercatorT,w.dayTextureAlpha[A]=r.alpha,ge=ge||1!==w.dayTextureAlpha[A],w.dayTextureNightAlpha[A]=r.nightAlpha,ye=ye||1!==w.dayTextureNightAlpha[A],w.dayTextureDayAlpha[A]=r.dayAlpha,ye=ye||1!==w.dayTextureDayAlpha[A],w.dayTextureBrightness[A]=r.brightness,de=de||w.dayTextureBrightness[A]!==JJe.DEFAULT_BRIGHTNESS,w.dayTextureContrast[A]=r.contrast,fe=fe||w.dayTextureContrast[A]!==JJe.DEFAULT_CONTRAST,w.dayTextureHue[A]=r.hue,pe=pe||w.dayTextureHue[A]!==JJe.DEFAULT_HUE,w.dayTextureSaturation[A]=r.saturation,me=me||w.dayTextureSaturation[A]!==JJe.DEFAULT_SATURATION,w.dayTextureOneOverGamma[A]=1/r.gamma,_e=_e||w.dayTextureOneOverGamma[A]!==1/JJe.DEFAULT_GAMMA,w.dayTextureSplit[A]=r.splitDirection,ve=ve||0!==w.dayTextureSplit[A];let s=w.dayTextureCutoutRectangles[A];if(C(s)||(s=w.dayTextureCutoutRectangles[A]=new Xe),Xe.clone(Xe.ZERO,s),C(r.cutoutRectangle)){const e=QZe(ce,r.cutoutRectangle),t=_t.simpleIntersection(e,ce,YZe);be=C(t)||be,s.x=(e.west-ce.west)*le,s.y=(e.south-ce.south)*ue,s.z=(e.east-ce.west)*le,s.w=(e.north-ce.south)*ue}let a=w.colorsToAlpha[A];C(a)||(a=w.colorsToAlpha[A]=new Xe);const c=C(r.colorToAlpha)&&r.colorToAlphaThreshold>0;if(Ae=Ae||c,c){const e=r.colorToAlpha;a.x=e.red,a.y=e.green,a.z=e.blue,a.w=r.colorToAlphaThreshold}else a.w=-1;if(C(n.credits)){const e=n.credits;for(let t=0,n=e.length;t<n;++t)o.addCredit(e[t])}++A}w.dayTextures.length=A,w.waterMask=a,Xe.clone(c,w.waterMaskTranslationAndScale),w.minMaxHeight.x=F.minimumHeight,w.minMaxHeight.y=F.maximumHeight,ft.clone(F.matrix,w.scaleAndBias);const we=e._clippingPlanes,Te=C(we)&&we.enabled&&t.isClipped;Te&&(w.clippingPlanesEdgeColor=xy.clone(we.edgeColor,w.clippingPlanesEdgeColor),w.clippingPlanesEdgeWidth=we.edgeWidth),J.numberOfDayTextures=A,J.applyBrightness=de,J.applyContrast=fe,J.applyHue=pe,J.applySaturation=me,J.applyGamma=_e,J.applyAlpha=ge,J.applyDayNightAlpha=ye,J.applySplit=ve,J.enableFog=he,J.enableClippingPlanes=Te,J.clippingPlanes=we,J.hasImageryLayerCutout=be,J.colorCorrect=L,J.highlightFillTile=H,J.colorToAlpha=Ae,J.showUndergroundColor=g,J.translucent=h;let Ce=i.renderedMesh.indices.length;te||(Ce=i.renderedMesh.indexCountWithoutSkirts),r.shaderProgram=e._surfaceShaderSet.getShaderProgram(J),r.castShadows=S,r.receiveShadows=I,r.renderState=re,r.primitiveType=xf.TRIANGLES,r.vertexArray=i.vertexArray||i.fill.vertexArray,r.count=Ce,r.uniformMap=v,r.pass=HU.GLOBE,e._debug.wireframe&&(g$e(ae,e,t),C(i.wireframeVertexArray)&&(r.vertexArray=i.wireframeVertexArray,r.primitiveType=xf.LINES,r.count=2*Ce));let Ee=r.boundingVolume;const xe=r.orientedBoundingBox;n.mode!==ij.SCENE3D?(nn.fromRectangleWithHeights2D(t.rectangle,n.mapProjection,k.minimumHeight,k.maximumHeight,Ee),K.fromElements(Ee.center.z,Ee.center.x,Ee.center.y,Ee.center),n.mode===ij.MORPHING&&(Ee=nn.union(k.boundingSphere,Ee,Ee))):(r.boundingVolume=nn.clone(k.boundingSphere,Ee),r.orientedBoundingBox=$u.clone(k.boundingVolume,xe)),r.dirty=!0,h&&u.updateDerivedCommands(r,n),qZe(r,n),re=oe,se=w$e}while($<ee)}var S$e=HZe;function I$e(){this._enabled=!1,this._frontFaceAlpha=1,this._frontFaceAlphaByDistance=void 0,this._backFaceAlpha=1,this._backFaceAlphaByDistance=void 0,this._rectangle=_t.clone(_t.MAX_VALUE)}Object.defineProperties(I$e.prototype,{enabled:{get:function(){return this._enabled},set:function(e){D.typeOf.bool("enabled",e),this._enabled=e}},frontFaceAlpha:{get:function(){return this._frontFaceAlpha},set:function(e){D.typeOf.number.greaterThanOrEquals("frontFaceAlpha",e,0),D.typeOf.number.lessThanOrEquals("frontFaceAlpha",e,1),this._frontFaceAlpha=e}},frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance},set:function(e){if(C(e)&&e.far<e.near)throw new x("far distance must be greater than near distance.");this._frontFaceAlphaByDistance=LO.clone(e,this._frontFaceAlphaByDistance)}},backFaceAlpha:{get:function(){return this._backFaceAlpha},set:function(e){D.typeOf.number.greaterThanOrEquals("backFaceAlpha",e,0),D.typeOf.number.lessThanOrEquals("backFaceAlpha",e,1),this._backFaceAlpha=e}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance},set:function(e){if(C(e)&&e.far<e.near)throw new x("far distance must be greater than near distance.");this._backFaceAlphaByDistance=LO.clone(e,this._backFaceAlphaByDistance)}},rectangle:{get:function(){return this._rectangle},set:function(e){C(e)||(e=_t.clone(_t.MAX_VALUE)),_t.clone(e,this._rectangle)}}});var O$e=I$e;function D$e(){this._layers=[],this.layerAdded=new $n,this.layerRemoved=new $n,this.layerMoved=new $n,this.layerShownOrHidden=new $n}function P$e(e,t){if(!C(t))throw new x("layer is required.");const n=e.indexOf(t);if(-1===n)throw new x("layer is not in this collection.");return n}function R$e(e,t,n){const i=e._layers;if(t=z.clamp(t,0,i.length-1),n=z.clamp(n,0,i.length-1),t===n)return;const o=i[t];i[t]=i[n],i[n]=o,e._update(),e.layerMoved.raiseEvent(o,n,t)}Object.defineProperties(D$e.prototype,{length:{get:function(){return this._layers.length}}}),D$e.prototype.add=function(e,t){const n=C(t);if(!C(e))throw new x("layer is required.");if(n){if(t<0)throw new x("index must be greater than or equal to zero.");if(t>this._layers.length)throw new x("index must be less than or equal to the number of layers.")}n?this._layers.splice(t,0,e):(t=this._layers.length,this._layers.push(e)),this._update(),this.layerAdded.raiseEvent(e,t)},D$e.prototype.addImageryProvider=function(e,t){if(!C(e))throw new x("imageryProvider is required.");const n=new JJe(e);return this.add(n,t),n},D$e.prototype.remove=function(e,t){t=R(t,!0);const n=this._layers.indexOf(e);return-1!==n&&(this._layers.splice(n,1),this._update(),this.layerRemoved.raiseEvent(e,n),t&&e.destroy(),!0)},D$e.prototype.removeAll=function(e){e=R(e,!0);const t=this._layers;for(let n=0,i=t.length;n<i;n++){const i=t[n];this.layerRemoved.raiseEvent(i,n),e&&i.destroy()}this._layers=[]},D$e.prototype.contains=function(e){return-1!==this.indexOf(e)},D$e.prototype.indexOf=function(e){return this._layers.indexOf(e)},D$e.prototype.get=function(e){if(!C(e))throw new x("index is required.","index");return this._layers[e]},D$e.prototype.raise=function(e){const t=P$e(this._layers,e);R$e(this,t,t+1)},D$e.prototype.lower=function(e){const t=P$e(this._layers,e);R$e(this,t,t-1)},D$e.prototype.raiseToTop=function(e){const t=P$e(this._layers,e);t!==this._layers.length-1&&(this._layers.splice(t,1),this._layers.push(e),this._update(),this.layerMoved.raiseEvent(e,this._layers.length-1,t))},D$e.prototype.lowerToBottom=function(e){const t=P$e(this._layers,e);0!==t&&(this._layers.splice(t,1),this._layers.splice(0,0,e),this._update(),this.layerMoved.raiseEvent(e,0,t))};const L$e=new _t;function M$e(e,t,n,i){const o=e.globe._surface._tilesToRender;let r;for(let a=0;!C(r)&&a<o.length;++a){const e=o[a];_t.contains(e.rectangle,t)&&(r=e)}if(!C(r))return;const s=r.data.imagery;for(let a=s.length-1;a>=0;--a){const e=s[a],o=e.readyImagery;if(!C(o))continue;const c=o.imageryLayer.imageryProvider;if(n&&!C(c.pickFeatures))continue;if(!_t.contains(o.rectangle,t))continue;const l=L$e,u=1/1024;l.west=z.lerp(r.rectangle.west,r.rectangle.east,e.textureCoordinateRectangle.x-u),l.east=z.lerp(r.rectangle.west,r.rectangle.east,e.textureCoordinateRectangle.z+u),l.south=z.lerp(r.rectangle.south,r.rectangle.north,e.textureCoordinateRectangle.y-u),l.north=z.lerp(r.rectangle.south,r.rectangle.north,e.textureCoordinateRectangle.w+u),_t.contains(l,t)&&i(o)}}D$e.prototype.pickImageryLayers=function(e,t){const n=t.globe.pick(e,t);if(!C(n))return;const i=t.globe.ellipsoid.cartesianToCartographic(n),o=[];return M$e(t,i,!1,(function(e){o.push(e.imageryLayer)})),0!==o.length?o:void 0},D$e.prototype.pickImageryLayerFeatures=function(e,t){const n=t.globe.pick(e,t);if(!C(n))return;const i=t.globe.ellipsoid.cartesianToCartographic(n),o=[],r=[];return M$e(t,i,!0,(function(e){const t=e.imageryLayer.imageryProvider,n=t.pickFeatures(e.x,e.y,e.level,i.longitude,i.latitude);C(n)&&(o.push(n),r.push(e.imageryLayer))})),0!==o.length?Promise.all(o).then((function(e){const t=[];for(let n=0;n<e.length;++n){const o=e[n],s=r[n];if(C(o)&&o.length>0)for(let e=0;e<o.length;++e){const n=o[e];n.imageryLayer=s,C(n.position)||(n.position=i),t.push(n)}}return t})):void 0},D$e.prototype.queueReprojectionCommands=function(e){const t=this._layers;for(let n=0,i=t.length;n<i;++n)t[n].queueReprojectionCommands(e)},D$e.prototype.cancelReprojections=function(){const e=this._layers;for(let t=0,n=e.length;t<n;++t)e[t].cancelReprojections()},D$e.prototype.isDestroyed=function(){return!1},D$e.prototype.destroy=function(){return this.removeAll(!0),Qh(this)},D$e.prototype._update=function(){let e=!0;const t=this._layers;let n,i,o,r;for(o=0,r=t.length;o<r;++o)i=t[o],i._layerIndex=o,i.show?(i._isBaseLayer=e,e=!1):i._isBaseLayer=!1,i.show!==i._show&&(C(i._show)&&(C(n)||(n=[]),n.push(i)),i._show=i.show);if(C(n))for(o=0,r=n.length;o<r;++o)i=n[o],this.layerShownOrHidden.raiseEvent(i,i._layerIndex,i.show)};var B$e=D$e;function N$e(e){this._ellipsoid=new jr(e.ellipsoid,K.ZERO)}Object.defineProperties(N$e.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});var F$e=N$e;function z$e(e){if(!C(e))throw new x("options is required.");if(!C(e.x))throw new x("options.x is required.");if(!C(e.y))throw new x("options.y is required.");if(e.x<0||e.y<0)throw new x("options.x and options.y must be greater than or equal to zero.");if(!C(e.level))throw new x("options.level is required and must be greater than or equal to zero.");if(!C(e.tilingScheme))throw new x("options.tilingScheme is required.");this._tilingScheme=e.tilingScheme,this._x=e.x,this._y=e.y,this._level=e.level,this._parent=e.parent,this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level),this._southwestChild=void 0,this._southeastChild=void 0,this._northwestChild=void 0,this._northeastChild=void 0,this.replacementPrevious=void 0,this.replacementNext=void 0,this._distance=0,this._loadPriority=0,this._customData=[],this._frameUpdated=void 0,this._lastSelectionResult=$Je.NONE,this._lastSelectionResultFrame=void 0,this._loadedCallbacks={},this.state=pJe.START,this.renderable=!1,this.upsampledFromParent=!1,this.data=void 0}function k$e(e){C(e)&&e.freeResources()}z$e.createLevelZeroTiles=function(e){if(!C(e))throw new x("tilingScheme is required.");const t=e.getNumberOfXTilesAtLevel(0),n=e.getNumberOfYTilesAtLevel(0),i=new Array(t*n);let o=0;for(let r=0;r<n;++r)for(let n=0;n<t;++n)i[o++]=new z$e({tilingScheme:e,x:n,y:r,level:0});return i},z$e.prototype._updateCustomData=function(e,t,n){let i,o,r,s=this.customData;if(C(t)&&C(n)){for(s=s.filter((function(e){return-1===n.indexOf(e)})),this._customData=s,r=this._rectangle,i=0;i<t.length;++i)o=t[i],_t.contains(r,o.positionCartographic)&&s.push(o);this._frameUpdated=e}else{const e=this._parent;if(C(e)&&this._frameUpdated!==e._frameUpdated){s.length=0,r=this._rectangle;const t=e.customData;for(i=0;i<t.length;++i)o=t[i],_t.contains(r,o.positionCartographic)&&s.push(o);this._frameUpdated=e._frameUpdated}}},Object.defineProperties(z$e.prototype,{tilingScheme:{get:function(){return this._tilingScheme}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},level:{get:function(){return this._level}},parent:{get:function(){return this._parent}},rectangle:{get:function(){return this._rectangle}},children:{get:function(){return[this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}},southwestChild:{get:function(){return C(this._southwestChild)||(this._southwestChild=new z$e({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y+1,level:this.level+1,parent:this})),this._southwestChild}},southeastChild:{get:function(){return C(this._southeastChild)||(this._southeastChild=new z$e({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y+1,level:this.level+1,parent:this})),this._southeastChild}},northwestChild:{get:function(){return C(this._northwestChild)||(this._northwestChild=new z$e({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y,level:this.level+1,parent:this})),this._northwestChild}},northeastChild:{get:function(){return C(this._northeastChild)||(this._northeastChild=new z$e({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y,level:this.level+1,parent:this})),this._northeastChild}},customData:{get:function(){return this._customData}},needsLoading:{get:function(){return this.state<pJe.DONE}},eligibleForUnloading:{get:function(){let e=!0;return C(this.data)&&(e=this.data.eligibleForUnloading,C(e)||(e=!0)),e}}}),z$e.prototype.findLevelZeroTile=function(e,t,n){const i=this.tilingScheme.getNumberOfXTilesAtLevel(0);if(t<0?t+=i:t>=i&&(t-=i),!(n<0||n>=this.tilingScheme.getNumberOfYTilesAtLevel(0)))return e.filter((function(e){return e.x===t&&e.y===n}))[0]},z$e.prototype.findTileToWest=function(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x-1,this.y);if(t.southeastChild===this)return t.southwestChild;if(t.northeastChild===this)return t.northwestChild;const n=t.findTileToWest(e);return void 0!==n?t.southwestChild===this?n.southeastChild:n.northeastChild:void 0},z$e.prototype.findTileToEast=function(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x+1,this.y);if(t.southwestChild===this)return t.southeastChild;if(t.northwestChild===this)return t.northeastChild;const n=t.findTileToEast(e);return void 0!==n?t.southeastChild===this?n.southwestChild:n.northwestChild:void 0},z$e.prototype.findTileToSouth=function(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y+1);if(t.northwestChild===this)return t.southwestChild;if(t.northeastChild===this)return t.southeastChild;const n=t.findTileToSouth(e);return void 0!==n?t.southwestChild===this?n.northwestChild:n.northeastChild:void 0},z$e.prototype.findTileToNorth=function(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y-1);if(t.southwestChild===this)return t.northwestChild;if(t.southeastChild===this)return t.northeastChild;const n=t.findTileToNorth(e);return void 0!==n?t.northwestChild===this?n.southwestChild:n.southeastChild:void 0},z$e.prototype.freeResources=function(){this.state=pJe.START,this.renderable=!1,this.upsampledFromParent=!1,C(this.data)&&C(this.data.freeResources)&&this.data.freeResources(),k$e(this._southwestChild),this._southwestChild=void 0,k$e(this._southeastChild),this._southeastChild=void 0,k$e(this._northwestChild),this._northwestChild=void 0,k$e(this._northeastChild),this._northeastChild=void 0};var U$e=z$e;function V$e(){this.head=void 0,this.tail=void 0,this.count=0,this._lastBeforeStartOfFrame=void 0}function H$e(e,t){const n=t.replacementPrevious,i=t.replacementNext;t===e._lastBeforeStartOfFrame&&(e._lastBeforeStartOfFrame=i),t===e.head?e.head=i:n.replacementNext=i,t===e.tail?e.tail=n:i.replacementPrevious=n,t.replacementPrevious=void 0,t.replacementNext=void 0,--e.count}V$e.prototype.markStartOfRenderFrame=function(){this._lastBeforeStartOfFrame=this.head},V$e.prototype.trimTiles=function(e){let t=this.tail,n=!0;while(n&&C(this._lastBeforeStartOfFrame)&&this.count>e&&C(t)){n=t!==this._lastBeforeStartOfFrame;const e=t.replacementPrevious;t.eligibleForUnloading&&(t.freeResources(),H$e(this,t)),t=e}},V$e.prototype.markTileRendered=function(e){const t=this.head;if(t!==e){if(++this.count,!C(t))return e.replacementPrevious=void 0,e.replacementNext=void 0,this.head=e,void(this.tail=e);(C(e.replacementPrevious)||C(e.replacementNext))&&H$e(this,e),e.replacementPrevious=void 0,e.replacementNext=t,t.replacementPrevious=e,this.head=e}else e===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=e.replacementNext)};var G$e=V$e;function W$e(e){if(!C(e)||!C(e.tileProvider))throw new x("options.tileProvider is required.");if(C(e.tileProvider.quadtree))throw new x("A QuadtreeTileProvider can only be used with a single QuadtreePrimitive");this._tileProvider=e.tileProvider,this._tileProvider.quadtree=this,this._debug={enableDebugOutput:!1,maxDepth:0,maxDepthVisited:0,tilesVisited:0,tilesCulled:0,tilesRendered:0,tilesWaitingForChildren:0,lastMaxDepth:-1,lastMaxDepthVisited:-1,lastTilesVisited:-1,lastTilesCulled:-1,lastTilesRendered:-1,lastTilesWaitingForChildren:-1,suspendLodUpdate:!1};const t=this._tileProvider.tilingScheme,n=t.ellipsoid;this._tilesToRender=[],this._tileLoadQueueHigh=[],this._tileLoadQueueMedium=[],this._tileLoadQueueLow=[],this._tileReplacementQueue=new G$e,this._levelZeroTiles=void 0,this._loadQueueTimeSlice=5,this._tilesInvalidated=!1,this._addHeightCallbacks=[],this._removeHeightCallbacks=[],this._tileToUpdateHeights=[],this._lastTileIndex=0,this._updateHeightsTimeSlice=2,this._cameraPositionCartographic=void 0,this._cameraReferenceFrameOriginCartographic=void 0,this.maximumScreenSpaceError=R(e.maximumScreenSpaceError,2),this.tileCacheSize=R(e.tileCacheSize,100),this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this._occluders=new F$e({ellipsoid:n}),this._tileLoadProgressEvent=new $n,this._lastTileLoadQueueLength=0,this._lastSelectionFrameNumber=void 0}function q$e(e){const t=e._tileReplacementQueue;t.head=void 0,t.tail=void 0,t.count=0,j$e(e);const n=e._levelZeroTiles;if(C(n))for(let i=0;i<n.length;++i){const t=n[i],o=t.customData,r=o.length;for(let n=0;n<r;++n){const t=o[n];t.level=0,e._addHeightCallbacks.push(t)}n[i].freeResources()}e._levelZeroTiles=void 0,e._tileProvider.cancelReprojections()}function j$e(e){const t=e._debug;t.maxDepth=0,t.maxDepthVisited=0,t.tilesVisited=0,t.tilesCulled=0,t.tilesRendered=0,t.tilesWaitingForChildren=0,e._tileLoadQueueHigh.length=0,e._tileLoadQueueMedium.length=0,e._tileLoadQueueLow.length=0}function Y$e(e,t){const n=e._tileLoadQueueHigh.length+e._tileLoadQueueMedium.length+e._tileLoadQueueLow.length;(n!==e._lastTileLoadQueueLength||e._tilesInvalidated)&&(t.afterRender.push($n.prototype.raiseEvent.bind(e._tileLoadProgressEvent,n)),e._lastTileLoadQueueLength=n);const i=e._debug;i.enableDebugOutput&&!i.suspendLodUpdate&&(i.maxDepth=e._tilesToRender.reduce((function(e,t){return Math.max(e,t.level)}),-1),i.tilesRendered=e._tilesToRender.length,i.tilesVisited===i.lastTilesVisited&&i.tilesRendered===i.lastTilesRendered&&i.tilesCulled===i.lastTilesCulled&&i.maxDepth===i.lastMaxDepth&&i.tilesWaitingForChildren===i.lastTilesWaitingForChildren&&i.maxDepthVisited===i.lastMaxDepthVisited||(console.log(`Visited ${i.tilesVisited}, Rendered: ${i.tilesRendered}, Culled: ${i.tilesCulled}, Max Depth Rendered: ${i.maxDepth}, Max Depth Visited: ${i.maxDepthVisited}, Waiting for children: ${i.tilesWaitingForChildren}`),i.lastTilesVisited=i.tilesVisited,i.lastTilesRendered=i.tilesRendered,i.lastTilesCulled=i.tilesCulled,i.lastMaxDepth=i.maxDepth,i.lastTilesWaitingForChildren=i.tilesWaitingForChildren,i.lastMaxDepthVisited=i.maxDepthVisited))}let K$e;Object.defineProperties(W$e.prototype,{tileProvider:{get:function(){return this._tileProvider}},tileLoadProgressEvent:{get:function(){return this._tileLoadProgressEvent}},occluders:{get:function(){return this._occluders}}}),W$e.prototype.invalidateAllTiles=function(){this._tilesInvalidated=!0},W$e.prototype.forEachLoadedTile=function(e){let t=this._tileReplacementQueue.head;while(C(t))t.state!==pJe.START&&e(t),t=t.replacementNext},W$e.prototype.forEachRenderedTile=function(e){const t=this._tilesToRender;for(let n=0,i=t.length;n<i;++n)e(t[n])},W$e.prototype.updateHeight=function(e,t){const n=this,i={positionOnEllipsoidSurface:void 0,positionCartographic:e,level:-1,callback:t,removeFunc:function(){const e=n._addHeightCallbacks,t=e.length;for(let n=0;n<t;++n)if(e[n]===i){e.splice(n,1);break}n._removeHeightCallbacks.push(i)}};return n._addHeightCallbacks.push(i),i.removeFunc},W$e.prototype.update=function(e){C(this._tileProvider.update)&&this._tileProvider.update(e)},W$e.prototype.beginFrame=function(e){const t=e.passes;t.render&&(this._tilesInvalidated&&(q$e(this),this._tilesInvalidated=!1),this._tileProvider.initialize(e),j$e(this),this._debug.suspendLodUpdate||this._tileReplacementQueue.markStartOfRenderFrame())},W$e.prototype.render=function(e){const t=e.passes,n=this._tileProvider;t.render&&(n.beginUpdate(e),$$e(this,e),v0e(this,e),n.endUpdate(e)),t.pick&&this._tilesToRender.length>0&&n.updateForPick(e)},W$e.prototype.endFrame=function(e){const t=e.passes;t.render&&e.mode!==ij.MORPHING&&(h0e(this,e),y0e(this,e),Y$e(this,e))},W$e.prototype.isDestroyed=function(){return!1},W$e.prototype.destroy=function(){this._tileProvider=this._tileProvider&&this._tileProvider.destroy()};const X$e=new se;function Q$e(e,t){let n=_t.center(e.rectangle,X$e);const i=n.longitude-K$e.longitude,o=n.latitude-K$e.latitude;n=_t.center(t.rectangle,X$e);const r=n.longitude-K$e.longitude,s=n.latitude-K$e.latitude;return i*i+o*o-(r*r+s*s)}const J$e=new K;let Z$e=[];function $$e(e,t){const n=e._debug;if(n.suspendLodUpdate)return;const i=e._tilesToRender;let o;i.length=0;const r=e._tileProvider;if(!C(e._levelZeroTiles)){if(!r.ready)return;{const t=r.tilingScheme;e._levelZeroTiles=U$e.createLevelZeroTiles(t);const n=e._levelZeroTiles.length;if(Z$e.length<n)for(Z$e=new Array(n),o=0;o<n;++o)void 0===Z$e[o]&&(Z$e[o]=new t0e)}}let s;e._occluders.ellipsoid.cameraPosition=t.camera.positionWC;const a=e._levelZeroTiles,c=a.length>1?e._occluders:void 0;K$e=t.camera.positionCartographic,a.sort(Q$e);const l=e._addHeightCallbacks,u=e._removeHeightCallbacks,h=t.frameNumber;let d;if(l.length>0||u.length>0){for(o=0,d=a.length;o<d;++o)s=a[o],s._updateCustomData(h,l,u);l.length=0,u.length=0}const f=t.camera;e._cameraPositionCartographic=f.positionCartographic;const p=ft.getTranslation(f.transform,J$e);for(e._cameraReferenceFrameOriginCartographic=e.tileProvider.tilingScheme.ellipsoid.cartesianToCartographic(p,e._cameraReferenceFrameOriginCartographic),o=0,d=a.length;o<d;++o)s=a[o],e._tileReplacementQueue.markTileRendered(s),s.renderable?a0e(e,s,r,t,c,!1,Z$e[o]):(e0e(e,e._tileLoadQueueHigh,s,t),++n.tilesWaitingForChildren);e._lastSelectionFrameNumber=h}function e0e(e,t,n,i){n.needsLoading&&(void 0!==e.tileProvider.computeTileLoadPriority&&(n._loadPriority=e.tileProvider.computeTileLoadPriority(n,i)),t.push(n))}function t0e(){this.allAreRenderable=!0,this.anyWereRenderedLastFrame=!1,this.notYetRenderableCount=0}function n0e(){this.southwest=new t0e,this.southeast=new t0e,this.northwest=new t0e,this.northeast=new t0e}n0e.prototype.combine=function(e){const t=this.southwest,n=this.southeast,i=this.northwest,o=this.northeast;e.allAreRenderable=t.allAreRenderable&&n.allAreRenderable&&i.allAreRenderable&&o.allAreRenderable,e.anyWereRenderedLastFrame=t.anyWereRenderedLastFrame||n.anyWereRenderedLastFrame||i.anyWereRenderedLastFrame||o.anyWereRenderedLastFrame,e.notYetRenderableCount=t.notYetRenderableCount+n.notYetRenderableCount+i.notYetRenderableCount+o.notYetRenderableCount};const i0e=new Array(31);for(let ko=0;ko<i0e.length;++ko)i0e[ko]=new n0e;function o0e(e,t,n,i,o){const r=e._debug;++r.tilesVisited,e._tileReplacementQueue.markTileRendered(n),n._updateCustomData(t.frameNumber),n.level>r.maxDepthVisited&&(r.maxDepthVisited=n.level);const s=c0e(e,t,n)<e.maximumScreenSpaceError,a=n.southwestChild,c=n.southeastChild,l=n.northwestChild,u=n.northeastChild,h=e._lastSelectionFrameNumber,d=n._lastSelectionResultFrame===h?n._lastSelectionResult:$Je.NONE,f=e.tileProvider;if(s||i){const r=$Je.originalResult(d)===$Je.RENDERED,a=$Je.originalResult(d)===$Je.CULLED||d===$Je.NONE,c=n.state===pJe.DONE;let l=r||a||c;if(l||C(f.canRenderWithoutLosingDetail)&&(l=f.canRenderWithoutLosingDetail(n)),l)return s&&e0e(e,e._tileLoadQueueMedium,n,t),u0e(e,n),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=d===$Je.RENDERED,o.notYetRenderableCount=n.renderable?0:1,n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=$Je.RENDERED,void(o.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(n));i=!0,s&&e0e(e,e._tileLoadQueueHigh,n,t)}if(f.canRefine(n)){const s=a.upsampledFromParent&&c.upsampledFromParent&&l.upsampledFromParent&&u.upsampledFromParent;if(s)return u0e(e,n),e0e(e,e._tileLoadQueueMedium,n,t),e._tileReplacementQueue.markTileRendered(a),e._tileReplacementQueue.markTileRendered(c),e._tileReplacementQueue.markTileRendered(l),e._tileReplacementQueue.markTileRendered(u),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=d===$Je.RENDERED,o.notYetRenderableCount=n.renderable?0:1,n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=$Je.RENDERED,void(o.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(n));n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=$Je.REFINED;const h=e._tilesToRender.length,f=e._tileLoadQueueLow.length,p=e._tileLoadQueueMedium.length,m=e._tileLoadQueueHigh.length,_=e._tileToUpdateHeights.length;if(r0e(e,a,c,l,u,t,i,o),h!==e._tilesToRender.length){const i=o.allAreRenderable,s=o.anyWereRenderedLastFrame,a=o.notYetRenderableCount;let c=!1;if(!i&&!s){const i=e._tilesToRender;for(let e=h;e<i.length;++e){let t=i[e];while(void 0!==t&&t._lastSelectionResult!==$Je.KICKED&&t!==n)t._lastSelectionResult=$Je.kick(t._lastSelectionResult),t=t.parent}e._tilesToRender.length=h,e._tileToUpdateHeights.length=_,u0e(e,n),n._lastSelectionResult=$Je.RENDERED;const s=d===$Je.RENDERED;!s&&a>e.loadingDescendantLimit&&(e._tileLoadQueueLow.length=f,e._tileLoadQueueMedium.length=p,e._tileLoadQueueHigh.length=m,e0e(e,e._tileLoadQueueMedium,n,t),o.notYetRenderableCount=n.renderable?0:1,c=!0),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=s,s||e._tileToUpdateHeights.push(n),++r.tilesWaitingForChildren}e.preloadAncestors&&!c&&e0e(e,e._tileLoadQueueLow,n,t)}}else n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=$Je.RENDERED,u0e(e,n),e0e(e,e._tileLoadQueueHigh,n,t),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=d===$Je.RENDERED,o.notYetRenderableCount=n.renderable?0:1}function r0e(e,t,n,i,o,r,s,a){const c=r.camera.positionCartographic,l=e._tileProvider,u=e._occluders,h=i0e[t.level],d=h.southwest,f=h.southeast,p=h.northwest,m=h.northeast;c.longitude<t.rectangle.east?c.latitude<t.rectangle.north?(a0e(e,t,l,r,u,s,d),a0e(e,n,l,r,u,s,f),a0e(e,i,l,r,u,s,p),a0e(e,o,l,r,u,s,m)):(a0e(e,i,l,r,u,s,p),a0e(e,t,l,r,u,s,d),a0e(e,o,l,r,u,s,m),a0e(e,n,l,r,u,s,f)):c.latitude<t.rectangle.north?(a0e(e,n,l,r,u,s,f),a0e(e,t,l,r,u,s,d),a0e(e,o,l,r,u,s,m),a0e(e,i,l,r,u,s,p)):(a0e(e,o,l,r,u,s,m),a0e(e,i,l,r,u,s,p),a0e(e,n,l,r,u,s,f),a0e(e,t,l,r,u,s,d)),h.combine(a)}function s0e(e,t){const n=t.rectangle;return C(e._cameraPositionCartographic)&&_t.contains(n,e._cameraPositionCartographic)||C(e._cameraReferenceFrameOriginCartographic)&&_t.contains(n,e._cameraReferenceFrameOriginCartographic)}function a0e(e,t,n,i,o,r,s){if(n.computeTileVisibility(t,i,o)!==BO.NONE)return o0e(e,i,t,r,s);if(++e._debug.tilesCulled,e._tileReplacementQueue.markTileRendered(t),s.allAreRenderable=!0,s.anyWereRenderedLastFrame=!1,s.notYetRenderableCount=0,s0e(e,t)){C(t.data)&&C(t.data.vertexArray)||e0e(e,e._tileLoadQueueMedium,t,i);const n=e._lastSelectionFrameNumber,o=t._lastSelectionResultFrame===n?t._lastSelectionResult:$Je.NONE;o!==$Je.CULLED_BUT_NEEDED&&o!==$Je.RENDERED&&e._tileToUpdateHeights.push(t),t._lastSelectionResult=$Je.CULLED_BUT_NEEDED}else e.preloadSiblings||0===t.level?(e0e(e,e._tileLoadQueueLow,t,i),t._lastSelectionResult=$Je.CULLED):t._lastSelectionResult=$Je.CULLED;t._lastSelectionResultFrame=i.frameNumber}function c0e(e,t,n){if(t.mode===ij.SCENE2D||t.camera.frustum instanceof jC||t.camera.frustum instanceof GC)return l0e(e,t,n);const i=e._tileProvider.getLevelMaximumGeometricError(n.level),o=n._distance,r=t.context.drawingBufferHeight,s=t.camera.frustum.sseDenominator;let a=i*r/(o*s);return t.fog.enabled&&(a-=z.fog(o,t.fog.density)*t.fog.sse),a/=t.pixelRatio,a}function l0e(e,t,n){const i=t.camera;let o=i.frustum;C(o._offCenterFrustum)&&(o=o._offCenterFrustum);const r=t.context,s=r.drawingBufferWidth,a=r.drawingBufferHeight,c=e._tileProvider.getLevelMaximumGeometricError(n.level),l=Math.max(o.top-o.bottom,o.right-o.left)/Math.max(s,a);let u=c/l;return t.fog.enabled&&t.mode!==ij.SCENE2D&&(u-=z.fog(n._distance,t.fog.density)*t.fog.sse),u/=t.pixelRatio,u}function u0e(e,t){e._tilesToRender.push(t)}function h0e(e,t){const n=e._tileLoadQueueHigh,i=e._tileLoadQueueMedium,o=e._tileLoadQueueLow;if(0===n.length&&0===i.length&&0===o.length)return;e._tileReplacementQueue.trimTiles(e.tileCacheSize);const r=py()+e._loadQueueTimeSlice,s=e._tileProvider;let a=f0e(e,t,s,r,n,!1);a=f0e(e,t,s,r,i,a),f0e(e,t,s,r,o,a)}function d0e(e,t){return e._loadPriority-t._loadPriority}function f0e(e,t,n,i,o,r){void 0!==n.computeTileLoadPriority&&o.sort(d0e);for(let s=0,a=o.length;s<a&&(py()<i||!r);++s){const i=o[s];e._tileReplacementQueue.markTileRendered(i),n.loadTile(t,i),r=!0}return r}const p0e=new os,m0e=new se,_0e=new K,g0e=[];function y0e(e,t){if(!e.tileProvider.ready)return;const n=g0e;n.length=0;const i=e._tileToUpdateHeights,o=py(),r=e._updateHeightsTimeSlice,s=o+r,a=t.mode,c=t.mapProjection,l=e.tileProvider.tilingScheme.ellipsoid;let u;while(i.length>0){const t=i[0];if(!C(t.data)||!C(t.data.mesh)){const o=t._lastSelectionResultFrame===e._lastSelectionFrameNumber?t._lastSelectionResult:$Je.NONE;o!==$Je.RENDERED&&o!==$Je.CULLED_BUT_NEEDED||n.push(t),i.shift(),e._lastTileIndex=0;continue}const o=t.customData,r=o.length;let h=!1;for(u=e._lastTileIndex;u<r;++u){const e=o[u],n=t.data.terrainData,i=C(n)&&n.wasCreatedByUpsampling();if(t.level>e.level&&!i){if(C(e.positionOnEllipsoidSurface)||(e.positionOnEllipsoidSurface=K.fromRadians(e.positionCartographic.longitude,e.positionCartographic.latitude,0,l)),a===ij.SCENE3D){const n=l.geodeticSurfaceNormal(e.positionOnEllipsoidSurface,p0e.direction),i=l.getSurfaceNormalIntersectionWithZAxis(e.positionOnEllipsoidSurface,11500,p0e.origin);if(!C(i)){let i=0;C(t.data.tileBoundingRegion)&&(i=t.data.tileBoundingRegion.minimumHeight);const o=Math.min(i,-11500),r=K.multiplyByScalar(n,Math.abs(o)+1,_0e);K.subtract(e.positionOnEllipsoidSurface,r,p0e.origin)}}else se.clone(e.positionCartographic,m0e),m0e.height=-11500,c.project(m0e,_0e),K.fromElements(_0e.z,_0e.x,_0e.y,_0e),K.clone(_0e,p0e.origin),K.clone(K.UNIT_X,p0e.direction);const n=t.data.pick(p0e,a,c,!1,_0e);C(n)&&(e.callback(n),e.level=t.level)}if(py()>=s){h=!0;break}}if(h){e._lastTileIndex=u;break}e._lastTileIndex=0,i.shift()}for(u=0;u<n.length;u++)i.push(n[u])}function v0e(e,t){const n=e._tileProvider,i=e._tilesToRender;for(let o=0,r=i.length;o<r;++o){const e=i[o];n.showTileThisFrame(e,t)}}var b0e=W$e;function A0e(e){e=R(e,ge.WGS84);const t=new DC({ellipsoid:e}),n=new B$e;this._ellipsoid=e,this._imageryLayerCollection=n,this._surfaceShaderSet=new uJe,this._material=void 0,this._surface=new b0e({tileProvider:new S$e({terrainProvider:t,imageryLayers:n,surfaceShaderSet:this._surfaceShaderSet})}),this._terrainProvider=t,this._terrainProviderChanged=new $n,this._undergroundColor=xy.clone(xy.BLACK),this._undergroundColorAlphaByDistance=new LO(e.maximumRadius/1e3,0,e.maximumRadius/5,1),this._translucency=new O$e,w0e(this),this.show=!0,this._oceanNormalMapResourceDirty=!0,this._oceanNormalMapResource=new Vi({url:Zi("Assets/Textures/waterNormalsSmall.jpg")}),this.maximumScreenSpaceError=2,this.tileCacheSize=100,this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this.fillHighlightColor=void 0,this.enableLighting=!1,this.lambertDiffuseMultiplier=.9,this.dynamicAtmosphereLighting=!0,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!0,this.lightingFadeOutDistance=1e7,this.lightingFadeInDistance=2e7,this.nightFadeOutDistance=1e7,this.nightFadeInDistance=5e7,this.showWaterEffect=!0,this.depthTestAgainstTerrain=!1,this.shadows=rj.RECEIVE_ONLY,this.atmosphereHueShift=0,this.atmosphereSaturationShift=0,this.atmosphereBrightnessShift=0,this.terrainExaggeration=1,this.terrainExaggerationRelativeHeight=0,this.showSkirts=!0,this.backFaceCulling=!0,this._oceanNormalMap=void 0,this._zoomedOutOceanSpecularIntensity=void 0}function w0e(e){const t=[],n=C(e._material)&&(e._material.shaderSource.match(/slope/)||e._material.shaderSource.match("normalEC")),i=[rJe];!C(e._material)||n&&!e._terrainProvider.requestVertexNormals?e._surface._tileProvider.materialUniformMap=void 0:(i.push(e._material.shaderSource),t.push("APPLY_MATERIAL"),e._surface._tileProvider.materialUniformMap=e._material._uniforms),i.push(iJe),e._surfaceShaderSet.baseVertexShaderSource=new tq({sources:[rJe,oJe],defines:t}),e._surfaceShaderSet.baseFragmentShaderSource=new tq({sources:i,defines:t}),e._surfaceShaderSet.material=e._material}function T0e(e){return function(t,n){const i=nn.distanceSquaredTo(t.pickBoundingSphere,e),o=nn.distanceSquaredTo(n.pickBoundingSphere,e);return i-o}}Object.defineProperties(A0e.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},imageryLayers:{get:function(){return this._imageryLayerCollection}},imageryLayersUpdatedEvent:{get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},tilesLoaded:{get:function(){return!C(this._surface)||this._surface.tileProvider.ready&&0===this._surface._tileLoadQueueHigh.length&&0===this._surface._tileLoadQueueMedium.length&&0===this._surface._tileLoadQueueLow.length}},baseColor:{get:function(){return this._surface.tileProvider.baseColor},set:function(e){this._surface.tileProvider.baseColor=e}},clippingPlanes:{get:function(){return this._surface.tileProvider.clippingPlanes},set:function(e){this._surface.tileProvider.clippingPlanes=e}},cartographicLimitRectangle:{get:function(){return this._surface.tileProvider.cartographicLimitRectangle},set:function(e){C(e)||(e=_t.clone(_t.MAX_VALUE)),this._surface.tileProvider.cartographicLimitRectangle=e}},oceanNormalMapUrl:{get:function(){return this._oceanNormalMapResource.url},set:function(e){this._oceanNormalMapResource.url=e,this._oceanNormalMapResourceDirty=!0}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){e!==this._terrainProvider&&(this._terrainProvider=e,this._terrainProviderChanged.raiseEvent(e),C(this._material)&&w0e(this))}},terrainProviderChanged:{get:function(){return this._terrainProviderChanged}},tileLoadProgressEvent:{get:function(){return this._surface.tileLoadProgressEvent}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,w0e(this))}},undergroundColor:{get:function(){return this._undergroundColor},set:function(e){this._undergroundColor=xy.clone(e,this._undergroundColor)}},undergroundColorAlphaByDistance:{get:function(){return this._undergroundColorAlphaByDistance},set:function(e){if(C(e)&&e.far<e.near)throw new x("far distance must be greater than near distance.");this._undergroundColorAlphaByDistance=LO.clone(e,this._undergroundColorAlphaByDistance)}},translucency:{get:function(){return this._translucency}}});const C0e=[],E0e={start:0,stop:0};A0e.prototype.pickWorldCoordinates=function(e,t,n,i){if(!C(e))throw new x("ray is required");if(!C(t))throw new x("scene is required");n=R(n,!0);const o=t.mode,r=t.mapProjection,s=C0e;s.length=0;const a=this._surface._tilesToRender;let c,l,u,h=a.length;for(l=0;l<h;++l){c=a[l];const t=c.data;if(!C(t))continue;let n=t.pickBoundingSphere;if(o!==ij.SCENE3D)t.pickBoundingSphere=n=nn.fromRectangleWithHeights2D(c.rectangle,r,t.tileBoundingRegion.minimumHeight,t.tileBoundingRegion.maximumHeight,n),K.fromElements(n.center.z,n.center.x,n.center.y,n.center);else{if(!C(t.renderedMesh))continue;nn.clone(t.tileBoundingRegion.boundingSphere,n)}const i=Ns.raySphere(e,n,E0e);C(i)&&s.push(t)}for(s.sort(T0e(e.origin)),h=s.length,l=0;l<h;++l)if(u=s[l].pick(e,t.mode,t.mapProjection,n,i),C(u))break;return u};const x0e=new se;A0e.prototype.pick=function(e,t,n){if(n=this.pickWorldCoordinates(e,t,!0,n),C(n)&&t.mode!==ij.SCENE3D){n=K.fromElements(n.y,n.z,n.x,n);const e=t.mapProjection.unproject(n,x0e);n=t.globe.ellipsoid.cartographicToCartesian(e,n)}return n};const S0e=new K,I0e=new K,O0e=new se,D0e=new os;function P0e(e,t){return C(e)&&_t.contains(e.rectangle,t)?e:void 0}A0e.prototype.getHeight=function(e){if(!C(e))throw new x("cartographic is required");const t=this._surface._levelZeroTiles;if(!C(t))return;let n,i;const o=t.length;for(i=0;i<o;++i)if(n=t[i],_t.contains(n.rectangle,e))break;if(i>=o)return;let r=n;while(C(n))n=P0e(n._southwestChild,e)||P0e(n._southeastChild,e)||P0e(n._northwestChild,e)||n._northeastChild,C(n)&&C(n.data)&&C(n.data.renderedMesh)&&(r=n);if(n=r,!C(n)||!C(n.data)||!C(n.data.renderedMesh))return;const s=this._surface._tileProvider.tilingScheme.projection,a=this._surface._tileProvider.tilingScheme.ellipsoid,c=K.fromRadians(e.longitude,e.latitude,0,a,S0e),l=D0e,u=a.geodeticSurfaceNormal(c,l.direction),h=a.getSurfaceNormalIntersectionWithZAxis(c,11500,l.origin);if(!C(h)){let e;C(n.data.tileBoundingRegion)&&(e=n.data.tileBoundingRegion.minimumHeight);const t=Math.min(R(e,0),-11500),i=K.multiplyByScalar(u,Math.abs(t)+1,I0e);K.subtract(c,i,l.origin)}const d=n.data.pick(l,void 0,s,!1,I0e);return C(d)?a.cartesianToCartographic(d,O0e).height:void 0},A0e.prototype.update=function(e){this.show&&e.passes.render&&this._surface.update(e)},A0e.prototype.beginFrame=function(e){const t=this._surface,n=t.tileProvider,i=this.terrainProvider,o=this.showWaterEffect&&i.ready&&i.hasWaterMask;if(o&&this._oceanNormalMapResourceDirty){this._oceanNormalMapResourceDirty=!1;const t=this._oceanNormalMapResource,n=t.url;if(C(n)){const i=this;t.fetchImage().then((function(t){n===i._oceanNormalMapResource.url&&(i._oceanNormalMap=i._oceanNormalMap&&i._oceanNormalMap.destroy(),i._oceanNormalMap=new Uk({context:e.context,source:t}))}))}else this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy()}const r=e.passes,s=e.mode;r.render&&(this.showGroundAtmosphere?this._zoomedOutOceanSpecularIntensity=.4:this._zoomedOutOceanSpecularIntensity=.5,t.maximumScreenSpaceError=this.maximumScreenSpaceError,t.tileCacheSize=this.tileCacheSize,t.loadingDescendantLimit=this.loadingDescendantLimit,t.preloadAncestors=this.preloadAncestors,t.preloadSiblings=this.preloadSiblings,n.terrainProvider=this.terrainProvider,n.lightingFadeOutDistance=this.lightingFadeOutDistance,n.lightingFadeInDistance=this.lightingFadeInDistance,n.nightFadeOutDistance=this.nightFadeOutDistance,n.nightFadeInDistance=this.nightFadeInDistance,n.zoomedOutOceanSpecularIntensity=s===ij.SCENE3D?this._zoomedOutOceanSpecularIntensity:0,n.hasWaterMask=o,n.oceanNormalMap=this._oceanNormalMap,n.enableLighting=this.enableLighting,n.dynamicAtmosphereLighting=this.dynamicAtmosphereLighting,n.dynamicAtmosphereLightingFromSun=this.dynamicAtmosphereLightingFromSun,n.showGroundAtmosphere=this.showGroundAtmosphere,n.shadows=this.shadows,n.hueShift=this.atmosphereHueShift,n.saturationShift=this.atmosphereSaturationShift,n.brightnessShift=this.atmosphereBrightnessShift,n.fillHighlightColor=this.fillHighlightColor,n.showSkirts=this.showSkirts,n.backFaceCulling=this.backFaceCulling,n.undergroundColor=this._undergroundColor,n.undergroundColorAlphaByDistance=this._undergroundColorAlphaByDistance,n.lambertDiffuseMultiplier=this.lambertDiffuseMultiplier,t.beginFrame(e))},A0e.prototype.render=function(e){this.show&&(C(this._material)&&this._material.update(e.context),this._surface.render(e))},A0e.prototype.endFrame=function(e){this.show&&e.passes.render&&this._surface.endFrame(e)},A0e.prototype.isDestroyed=function(){return!1},A0e.prototype.destroy=function(){return this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._surface=this._surface&&this._surface.destroy(),this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy(),Qh(this)};var R0e=A0e,L0e="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n}\n",M0e="uniform highp sampler2D u_depthTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    gl_FragColor = czm_packDepth(texture2D(u_depthTexture, v_textureCoordinates).r);\n}\n";function B0e(){this._picking=!1,this._numSamples=1,this._tempCopyDepthTexture=void 0,this._pickColorFramebuffer=new Tie({depthStencil:!0,supportsDepthTexture:!0}),this._outputFramebuffer=new Tie({depthStencil:!0,supportsDepthTexture:!0}),this._copyDepthFramebuffer=new Tie,this._tempCopyDepthFramebuffer=new Tie,this._updateDepthFramebuffer=new Tie({createColorAttachments:!1,createDepthAttachments:!1,depthStencil:!0}),this._clearGlobeColorCommand=void 0,this._copyColorCommand=void 0,this._copyDepthCommand=void 0,this._tempCopyDepthCommand=void 0,this._updateDepthCommand=void 0,this._viewport=new bf,this._rs=void 0,this._rsBlend=void 0,this._rsUpdate=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHdr=void 0,this._clearGlobeDepth=void 0}function N0e(e){e._pickColorFramebuffer.destroy(),e._outputFramebuffer.destroy(),e._copyDepthFramebuffer.destroy(),e._tempCopyDepthFramebuffer.destroy(),e._updateDepthFramebuffer.destroy()}function F0e(e,t,n,i,o){e._viewport.width=n,e._viewport.height=i;const r=!bf.equals(e._viewport,o.viewport);let s=r!==e._useScissorTest;e._useScissorTest=r,bf.equals(e._scissorRectangle,o.viewport)||(e._scissorRectangle=bf.clone(o.viewport,e._scissorRectangle),s=!0),C(e._rs)&&bf.equals(e._viewport,e._rs.viewport)&&!s||(e._rs=yV.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}}),e._rsBlend=yV.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},blending:_k.ALPHA_BLEND}),e._rsUpdate=yV.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},stencilTest:{enabled:!0,frontFunction:LY.EQUAL,frontOperation:{fail:BY.KEEP,zFail:BY.KEEP,zPass:BY.KEEP},backFunction:LY.NEVER,reference:FY.CESIUM_3D_TILE_MASK,mask:FY.CESIUM_3D_TILE_MASK}})),C(e._copyDepthCommand)||(e._copyDepthCommand=t.createViewportQuadCommand(M0e,{uniformMap:{u_depthTexture:function(){return e.colorFramebufferManager.getDepthStencilTexture()}},owner:e})),e._copyDepthCommand.framebuffer=e._copyDepthFramebuffer.framebuffer,e._copyDepthCommand.renderState=e._rs,C(e._copyColorCommand)||(e._copyColorCommand=t.createViewportQuadCommand(L0e,{uniformMap:{colorTexture:function(){return e.colorFramebufferManager.getColorTexture()}},owner:e})),e._copyColorCommand.renderState=e._rs,C(e._tempCopyDepthCommand)||(e._tempCopyDepthCommand=t.createViewportQuadCommand(M0e,{uniformMap:{u_depthTexture:function(){return e._tempCopyDepthTexture}},owner:e})),e._tempCopyDepthCommand.framebuffer=e._tempCopyDepthFramebuffer.framebuffer,e._tempCopyDepthCommand.renderState=e._rs,C(e._updateDepthCommand)||(e._updateDepthCommand=t.createViewportQuadCommand(L0e,{uniformMap:{colorTexture:function(){return e._tempCopyDepthFramebuffer.getColorTexture()}},owner:e})),e._updateDepthCommand.framebuffer=e._updateDepthFramebuffer.framebuffer,e._updateDepthCommand.renderState=e._rsUpdate,C(e._clearGlobeColorCommand)||(e._clearGlobeColorCommand=new tJ({color:new xy(0,0,0,0),stencil:0,owner:e})),e._clearGlobeColorCommand.framebuffer=e.framebuffer}Object.defineProperties(B0e.prototype,{colorFramebufferManager:{get:function(){return this._picking?this._pickColorFramebuffer:this._outputFramebuffer}},framebuffer:{get:function(){return this.colorFramebufferManager.framebuffer}},depthStencilTexture:{get:function(){return this.colorFramebufferManager.getDepthStencilTexture()}},picking:{get:function(){return this._picking},set:function(e){this._picking=e}}}),B0e.prototype.update=function(e,t,n,i,o,r){const s=n.width,a=n.height,c=o?e.halfFloatingPointTexture?hD.HALF_FLOAT:hD.FLOAT:hD.UNSIGNED_BYTE;this._numSamples=i,this.picking?this._pickColorFramebuffer.update(e,s,a):this._outputFramebuffer.update(e,s,a,i,c),this._copyDepthFramebuffer.update(e,s,a),F0e(this,e,s,a,t),e.uniformState.globeDepthTexture=void 0,this._useHdr=o,this._clearGlobeDepth=r},B0e.prototype.prepareColorTextures=function(e,t){!this.picking&&this._numSamples>1&&this._outputFramebuffer.prepareTextures(e,t)},B0e.prototype.executeCopyDepth=function(e,t){C(this._copyDepthCommand)&&(this.prepareColorTextures(e),this._copyDepthCommand.execute(e,t),e.uniformState.globeDepthTexture=this._copyDepthFramebuffer.getColorTexture())},B0e.prototype.executeUpdateDepth=function(e,t,n,i){const o=C(i)?i:t.framebuffer.depthStencilTexture;if(n||o!==this.colorFramebufferManager.getDepthStencilTexture()){if(C(this._updateDepthCommand)){if(!C(this._updateDepthFramebuffer.framebuffer)||this._updateDepthFramebuffer.getDepthStencilTexture()!==o||this._updateDepthFramebuffer.getColorTexture()!==this._copyDepthFramebuffer.getColorTexture()){const n=this._copyDepthFramebuffer.getColorTexture().width,i=this._copyDepthFramebuffer.getColorTexture().height;this._tempCopyDepthFramebuffer.destroy(),this._tempCopyDepthFramebuffer.update(e,n,i);const r=this._copyDepthFramebuffer.getColorTexture();this._updateDepthFramebuffer.setColorTexture(r,0),this._updateDepthFramebuffer.setDepthStencilTexture(o),this._updateDepthFramebuffer.update(e,n,i),F0e(this,e,n,i,t)}this._tempCopyDepthTexture=o,this._tempCopyDepthCommand.execute(e,t),this._updateDepthCommand.execute(e,t)}}else C(this._copyDepthCommand)&&this._copyDepthCommand.execute(e,t)},B0e.prototype.executeCopyColor=function(e,t){C(this._copyColorCommand)&&this._copyColorCommand.execute(e,t)},B0e.prototype.clear=function(e,t,n){const i=this._clearGlobeColorCommand;C(i)&&(xy.clone(n,i.color),this.colorFramebufferManager.clear(e,i,t))},B0e.prototype.isDestroyed=function(){return!1},B0e.prototype.destroy=function(){return N0e(this),C(this._copyColorCommand)&&(this._copyColorCommand.shaderProgram=this._copyColorCommand.shaderProgram.destroy()),C(this._copyDepthCommand)&&(this._copyDepthCommand.shaderProgram=this._copyDepthCommand.shaderProgram.destroy()),C(this._tempCopyDepthCommand)&&(this._tempCopyDepthCommand.shaderProgram=this._tempCopyDepthCommand.shaderProgram.destroy()),C(this._updateDepthCommand)&&(this._updateDepthCommand.shaderProgram=this._updateDepthCommand.shaderProgram.destroy()),Qh(this)};var z0e=B0e;function k0e(){this._framebuffer=new Tie({depthStencil:!0,supportsDepthTexture:!0}),this._packedDepthFramebuffer=new Tie,this._renderState=void 0,this._packedDepthCommand=void 0,this._clearCommand=void 0,this._viewport=new bf,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHdr=void 0}function U0e(e){e._framebuffer.destroy(),e._packedDepthFramebuffer.destroy()}function V0e(e,t,n,i,o){const r=o?t.halfFloatingPointTexture?hD.HALF_FLOAT:hD.FLOAT:hD.UNSIGNED_BYTE;e._framebuffer.update(t,n,i,1,r),e._packedDepthFramebuffer.update(t,n,i)}function H0e(e,t,n,i,o){e._viewport.width=n,e._viewport.height=i;const r=!bf.equals(e._viewport,o.viewport);let s=r!==e._useScissorTest;e._useScissorTest=r,bf.equals(e._scissorRectangle,o.viewport)||(e._scissorRectangle=bf.clone(o.viewport,e._scissorRectangle),s=!0),C(e._renderState)&&bf.equals(e._viewport,e._renderState.viewport)&&!s||(e._renderState=yV.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}})),C(e._packedDepthCommand)||(e._packedDepthCommand=t.createViewportQuadCommand(M0e,{uniformMap:{u_depthTexture:function(){return e.depthStencilTexture}},owner:e})),C(e._clearCommand)||(e._clearCommand=new tJ({color:new xy(0,0,0,0),depth:1,stencil:0,owner:e})),e._packedDepthCommand.framebuffer=e._packedDepthFramebuffer.framebuffer,e._packedDepthCommand.renderState=e._renderState,e._clearCommand.framebuffer=e.classificationFramebuffer,e._clearCommand.renderState=e._renderState}Object.defineProperties(k0e.prototype,{classificationTexture:{get:function(){return this._framebuffer.getColorTexture()}},classificationFramebuffer:{get:function(){return this._framebuffer.framebuffer}},packedDepthFramebuffer:{get:function(){return this._packedDepthFramebuffer.framebuffer}},depthStencilTexture:{get:function(){return this._framebuffer.getDepthStencilTexture()}},depthStencilRenderbuffer:{get:function(){return this._framebuffer.getDepthStencilRenderbuffer()}},packedDepthTexture:{get:function(){return this._packedDepthFramebuffer.getColorTexture()}}}),k0e.prototype.updateAndClear=function(e,t,n,i){const o=t.width,r=t.height;V0e(this,n,o,r,e),H0e(this,n,o,r,i),this._useHdr=e},k0e.prototype.clearClassification=function(e,t){this._clearCommand.execute(e,t)},k0e.prototype.packDepth=function(e,t){return this._packedDepthCommand.execute(e,t),this.packedDepthTexture},k0e.prototype.isDestroyed=function(){return!1},k0e.prototype.destroy=function(){return U0e(this),Qh(this)};var G0e=k0e;const W0e={OPAQUE_FRONT_FACE:0,OPAQUE_BACK_FACE:1,DEPTH_ONLY_FRONT_FACE:2,DEPTH_ONLY_BACK_FACE:3,DEPTH_ONLY_FRONT_AND_BACK_FACE:4,TRANSLUCENT_FRONT_FACE:5,TRANSLUCENT_BACK_FACE:6,TRANSLUCENT_FRONT_FACE_MANUAL_DEPTH_TEST:7,TRANSLUCENT_BACK_FACE_MANUAL_DEPTH_TEST:8,PICK_FRONT_FACE:9,PICK_BACK_FACE:10,DERIVED_COMMANDS_MAXIMUM_LENGTH:11},q0e=W0e.DERIVED_COMMANDS_MAXIMUM_LENGTH,j0e=["opaqueFrontFaceCommand","opaqueBackFaceCommand","depthOnlyFrontFaceCommand","depthOnlyBackFaceCommand","depthOnlyFrontAndBackFaceCommand","translucentFrontFaceCommand","translucentBackFaceCommand","translucentFrontFaceManualDepthTestCommand","translucentBackFaceManualDepthTestCommand","pickFrontFaceCommand","pickBackFaceCommand"];function Y0e(){this._frontFaceAlphaByDistance=new LO(0,1,0,1),this._backFaceAlphaByDistance=new LO(0,1,0,1),this._frontFaceTranslucent=!1,this._backFaceTranslucent=!1,this._requiresManualDepthTest=!1,this._sunVisibleThroughGlobe=!1,this._environmentVisible=!1,this._useDepthPlane=!1,this._numberOfTextureUniforms=0,this._globeTranslucencyFramebuffer=void 0,this._rectangle=_t.clone(_t.MAX_VALUE),this._derivedCommandKey=0,this._derivedCommandsDirty=!1,this._derivedCommandPacks=void 0,this._derivedCommandTypes=new Array(q0e),this._derivedBlendCommandTypes=new Array(q0e),this._derivedPickCommandTypes=new Array(q0e),this._derivedCommandTypesToUpdate=new Array(q0e),this._derivedCommandsLength=0,this._derivedBlendCommandsLength=0,this._derivedPickCommandsLength=0,this._derivedCommandsToUpdateLength=0}function K0e(e,t,n,i){return e?C(n)?(LO.clone(n,i),i.nearValue*=t,i.farValue*=t,i):(i.nearValue=t,i.farValue=t,i):(i.nearValue=1,i.farValue=1,i)}function X0e(e,t,n){return e&&(n.baseColor.alpha<1||t.nearValue<1||t.farValue<1)}function Q0e(e,t){const n=e._frontFaceTranslucent,i=e._backFaceTranslucent;return n&&(t.cameraUnderground||i)}function J0e(e,t){return!t.cameraUnderground||e._frontFaceTranslucent}function Z0e(e,t){return!t.cameraUnderground&&!e._frontFaceTranslucent}function $0e(e,t,n){return e._frontFaceTranslucent&&!e._backFaceTranslucent&&!n.depthTestAgainstTerrain&&t.mode!==ij.SCENE2D&&t.context.depthTexture}function e1e(e){let t=0;return e._frontFaceTranslucent&&++t,e._requiresManualDepthTest&&++t,t}function t1e(e,t){let n;e._derivedCommandsLength=n1e(e,t,!1,!1,e._derivedCommandTypes),e._derivedBlendCommandsLength=n1e(e,t,!0,!1,e._derivedBlendCommandTypes),e._derivedPickCommandsLength=n1e(e,t,!1,!0,e._derivedPickCommandTypes);let i=0;for(n=0;n<e._derivedCommandsLength;++n)i|=1<<e._derivedCommandTypes[n];for(n=0;n<e._derivedBlendCommandsLength;++n)i|=1<<e._derivedBlendCommandTypes[n];for(n=0;n<e._derivedPickCommandsLength;++n)i|=1<<e._derivedPickCommandTypes[n];let o=0;for(n=0;n<q0e;++n)(i&1<<n)>0&&(e._derivedCommandTypesToUpdate[o++]=n);e._derivedCommandsToUpdateLength=o;const r=i!==e._derivedCommandKey;e._derivedCommandKey=i,e._derivedCommandsDirty=r,!C(e._derivedCommandPacks)&&e._frontFaceTranslucent&&(e._derivedCommandPacks=S1e())}function n1e(e,t,n,i,o){let r=0;const s=e._frontFaceTranslucent,a=e._backFaceTranslucent;if(!s)return r;const c=t.cameraUnderground,l=e._requiresManualDepthTest,u=i?W0e.PICK_FRONT_FACE:l?W0e.TRANSLUCENT_FRONT_FACE_MANUAL_DEPTH_TEST:W0e.TRANSLUCENT_FRONT_FACE,h=i?W0e.PICK_BACK_FACE:l?W0e.TRANSLUCENT_BACK_FACE_MANUAL_DEPTH_TEST:W0e.TRANSLUCENT_BACK_FACE;return t.mode===ij.SCENE2D?(o[r++]=W0e.DEPTH_ONLY_FRONT_FACE,o[r++]=u,r):(a?(n||(o[r++]=W0e.DEPTH_ONLY_FRONT_AND_BACK_FACE),c?(o[r++]=u,o[r++]=h):(o[r++]=h,o[r++]=u)):c?(n||(o[r++]=W0e.DEPTH_ONLY_BACK_FACE),o[r++]=W0e.OPAQUE_FRONT_FACE,o[r++]=h):(n||(o[r++]=W0e.DEPTH_ONLY_FRONT_FACE),o[r++]=W0e.OPAQUE_BACK_FACE,o[r++]=u),r)}function i1e(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function o1e(e,t){return e.indexOf(t)>-1}function r1e(e,t){i1e(e.defines,"TRANSLUCENT"),i1e(t.defines,"TRANSLUCENT")}function s1e(e,t){i1e(e.defines,"GROUND_ATMOSPHERE"),i1e(t.defines,"GROUND_ATMOSPHERE"),i1e(e.defines,"FOG"),i1e(t.defines,"FOG"),i1e(e.defines,"TRANSLUCENT"),i1e(t.defines,"TRANSLUCENT")}function a1e(e,t){if(o1e(t.defines,"TILE_LIMIT_RECTANGLE")||o1e(t.defines,"ENABLE_CLIPPING_PLANES"))return;const n="void main() \n{ \n    gl_FragColor = vec4(1.0); \n} \n";t.sources=[n]}function c1e(e,t){const n=t.sources,i=n.length;for(let r=0;r<i;++r)n[r]=tq.replaceMain(n[r],"czm_globe_translucency_main");const o="\n\nuniform sampler2D u_classificationTexture; \nvoid main() \n{ \n    vec2 st = gl_FragCoord.xy / czm_viewport.zw; \n#ifdef MANUAL_DEPTH_TEST \n    float logDepthOrDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, st)); \n    if (logDepthOrDepth != 0.0) \n    { \n        vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth); \n        float depthEC = eyeCoordinate.z / eyeCoordinate.w; \n        if (v_positionEC.z < depthEC) \n        { \n            discard; \n        } \n    } \n#endif \n    czm_globe_translucency_main(); \n    vec4 classificationColor = texture2D(u_classificationTexture, st); \n    if (classificationColor.a > 0.0) \n    { \n        // Reverse premultiplication process to get the correct composited result of the classification primitives \n        classificationColor.rgb /= classificationColor.a; \n    } \n    gl_FragColor = classificationColor * vec4(classificationColor.aaa, 1.0) + gl_FragColor * (1.0 - classificationColor.a); \n} \n";n.push(o)}function l1e(e,t){c1e(e,t),i1e(e.defines,"GROUND_ATMOSPHERE"),i1e(t.defines,"GROUND_ATMOSPHERE"),i1e(e.defines,"FOG"),i1e(t.defines,"FOG")}function u1e(e,t){c1e(e,t),e.defines.push("GENERATE_POSITION"),t.defines.push("MANUAL_DEPTH_TEST")}function h1e(e,t){l1e(e,t),e.defines.push("GENERATE_POSITION"),t.defines.push("MANUAL_DEPTH_TEST")}function d1e(e,t){const n="uniform sampler2D u_classificationTexture; \nvoid main() \n{ \n    vec2 st = gl_FragCoord.xy / czm_viewport.zw; \n    vec4 pickColor = texture2D(u_classificationTexture, st); \n    if (pickColor == vec4(0.0)) \n    { \n        discard; \n    } \n    gl_FragColor = pickColor; \n} \n";t.sources=[n]}function f1e(e,t,n,i,o,r){if(!C(o))return t;if(!i&&C(n))return n;let s=e.shaderCache.getDerivedShaderProgram(t,r);if(!C(s)){const n=t._attributeLocations,i=t.vertexShaderSource.clone(),a=t.fragmentShaderSource.clone();i.defines=C(i.defines)?i.defines.slice(0):[],a.defines=C(a.defines)?a.defines.slice(0):[],o(i,a),s=e.shaderCache.createDerivedShaderProgram(t,r,{vertexShaderSource:i,fragmentShaderSource:a,attributeLocations:n})}return s}function p1e(e){e.cull.face=yk.BACK,e.cull.enabled=!0}function m1e(e){e.cull.face=yk.FRONT,e.cull.enabled=!0}function _1e(e){e.cull.face=yk.BACK,e.cull.enabled=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function g1e(e){e.cull.face=yk.FRONT,e.cull.enabled=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function y1e(e){e.cull.enabled=!1,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function v1e(e){e.cull.face=yk.BACK,e.cull.enabled=!0,e.depthMask=!1,e.blending=_k.ALPHA_BLEND}function b1e(e){e.cull.face=yk.FRONT,e.cull.enabled=!0,e.depthMask=!1,e.blending=_k.ALPHA_BLEND}function A1e(e){e.cull.face=yk.BACK,e.cull.enabled=!0,e.blending.enabled=!1}function w1e(e){e.cull.face=yk.FRONT,e.cull.enabled=!0,e.blending.enabled=!1}function T1e(e,t,n,i,o){if(!C(i))return e;if(!n&&C(t))return t;let r=o[e.id];if(!C(r)){const t=yV.getState(e);i(t),r=yV.fromCache(t),o[e.id]=r}return r}function C1e(e){return{u_classificationTexture:function(){return e._globeTranslucencyFramebuffer.classificationTexture}}}function E1e(e,t,n,i,o){return C(o)?!i&&C(n)?n:_n(t,o(e),!1):t}function x1e(e){this.pass=e.pass,this.pickOnly=e.pickOnly,this.getShaderProgramFunction=e.getShaderProgramFunction,this.getRenderStateFunction=e.getRenderStateFunction,this.getUniformMapFunction=e.getUniformMapFunction,this.renderStateCache={}}function S1e(){return[new x1e({pass:HU.GLOBE,pickOnly:!1,getShaderProgramFunction:r1e,getRenderStateFunction:p1e,getUniformMapFunction:void 0}),new x1e({pass:HU.GLOBE,pickOnly:!1,getShaderProgramFunction:s1e,getRenderStateFunction:m1e,getUniformMapFunction:void 0}),new x1e({pass:HU.GLOBE,pickOnly:!1,getShaderProgramFunction:a1e,getRenderStateFunction:_1e,getUniformMapFunction:void 0}),new x1e({pass:HU.GLOBE,pickOnly:!1,getShaderProgramFunction:a1e,getRenderStateFunction:g1e,getUniformMapFunction:void 0}),new x1e({pass:HU.GLOBE,pickOnly:!1,getShaderProgramFunction:a1e,getRenderStateFunction:y1e,getUniformMapFunction:void 0}),new x1e({pass:HU.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:c1e,getRenderStateFunction:v1e,getUniformMapFunction:C1e}),new x1e({pass:HU.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:l1e,getRenderStateFunction:b1e,getUniformMapFunction:C1e}),new x1e({pass:HU.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:u1e,getRenderStateFunction:v1e,getUniformMapFunction:C1e}),new x1e({pass:HU.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:h1e,getRenderStateFunction:b1e,getUniformMapFunction:C1e}),new x1e({pass:HU.TRANSLUCENT,pickOnly:!0,getShaderProgramFunction:d1e,getRenderStateFunction:A1e,getUniformMapFunction:C1e}),new x1e({pass:HU.TRANSLUCENT,pickOnly:!0,getShaderProgramFunction:d1e,getRenderStateFunction:w1e,getUniformMapFunction:C1e})]}Object.defineProperties(Y0e.prototype,{frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance}},translucent:{get:function(){return this._frontFaceTranslucent}},sunVisibleThroughGlobe:{get:function(){return this._sunVisibleThroughGlobe}},environmentVisible:{get:function(){return this._environmentVisible}},useDepthPlane:{get:function(){return this._useDepthPlane}},numberOfTextureUniforms:{get:function(){return this._numberOfTextureUniforms}},rectangle:{get:function(){return this._rectangle}}}),Y0e.prototype.update=function(e){const t=e.globe;if(!C(t)||!t.show)return this._frontFaceTranslucent=!1,this._backFaceTranslucent=!1,this._sunVisibleThroughGlobe=!0,this._environmentVisible=!0,void(this._useDepthPlane=!1);this._frontFaceAlphaByDistance=K0e(t.translucency.enabled,t.translucency.frontFaceAlpha,t.translucency.frontFaceAlphaByDistance,this._frontFaceAlphaByDistance),this._backFaceAlphaByDistance=K0e(t.translucency.enabled,t.translucency.backFaceAlpha,t.translucency.backFaceAlphaByDistance,this._backFaceAlphaByDistance),this._frontFaceTranslucent=X0e(t.translucency.enabled,this._frontFaceAlphaByDistance,t),this._backFaceTranslucent=X0e(t.translucency.enabled,this._backFaceAlphaByDistance,t),this._requiresManualDepthTest=$0e(this,e,t),this._sunVisibleThroughGlobe=Q0e(this,e),this._environmentVisible=J0e(this,e),this._useDepthPlane=Z0e(this,e),this._numberOfTextureUniforms=e1e(this),this._rectangle=_t.clone(t.translucency.rectangle,this._rectangle),t1e(this,e)};const I1e=new Array(q0e),O1e=new Array(q0e);function D1e(e,t,n,i,o,r,s){let a=t.derivedCommands.globeTranslucency;const c=e._derivedCommandsDirty;if(t.dirty||!C(a)||c){t.dirty=!1,C(a)||(a={},t.derivedCommands.globeTranslucency=a);const c=s.frameNumber,l=R(a.uniformMapDirtyFrame,0),u=R(a.shaderProgramDirtyFrame,0),h=R(a.renderStateDirtyFrame,0),d=a.uniformMap!==t.uniformMap,f=a.shaderProgramId!==t.shaderProgram.id,p=a.renderStateId!==t.renderState.id;d&&(a.uniformMapDirtyFrame=c),f&&(a.shaderProgramDirtyFrame=c),p&&(a.renderStateDirtyFrame=c),a.uniformMap=t.uniformMap,a.shaderProgramId=t.shaderProgram.id,a.renderStateId=t.renderState.id;for(let m=0;m<n;++m){const n=r[m],_=i[m],g=o[m];let y,v,b,A=a[g];C(A)?(y=A.uniformMap,v=A.shaderProgram,b=A.renderState):(y=void 0,v=void 0,b=void 0),A=UU.shallowClone(t,A),a[g]=A;const w=R(A.derivedCommands.uniformMapDirtyFrame,0),T=R(A.derivedCommands.shaderProgramDirtyFrame,0),E=R(A.derivedCommands.renderStateDirtyFrame,0),x=d||w<l,S=f||T<u,I=p||E<h;x&&(A.derivedCommands.uniformMapDirtyFrame=c),S&&(A.derivedCommands.shaderProgramDirtyFrame=c),I&&(A.derivedCommands.renderStateDirtyFrame=c),A.derivedCommands.type=_,A.pass=n.pass,A.pickOnly=n.pickOnly,A.uniformMap=E1e(e,t.uniformMap,y,x,n.getUniformMapFunction),A.shaderProgram=f1e(s.context,t.shaderProgram,v,S,n.getShaderProgramFunction,g),A.renderState=T1e(t.renderState,b,I,n.getRenderStateFunction,n.renderStateCache)}}}function P1e(e,t,n,i,o,r,s){for(let a=0;a<t;++a){const t=e[a],c=t.derivedCommands.type;(!C(s)||s.indexOf(c)>-1)&&n(t,i,o,r)}}function R1e(e,t,n,i,o,r){for(let s=0;s<t;++s)n(e[s],i,o,r)}Y0e.prototype.updateDerivedCommands=function(e,t){const n=this._derivedCommandTypesToUpdate,i=this._derivedCommandsToUpdateLength;if(0!==i){for(let e=0;e<i;++e)O1e[e]=this._derivedCommandPacks[n[e]],I1e[e]=j0e[n[e]];D1e(this,e,i,n,I1e,O1e,t)}},Y0e.prototype.pushDerivedCommands=function(e,t,n){const i=n.passes.pick;if(i&&t)return;let o=this._derivedCommandTypes,r=this._derivedCommandsLength;if(i?(o=this._derivedPickCommandTypes,r=this._derivedPickCommandsLength):t&&(o=this._derivedBlendCommandTypes,r=this._derivedBlendCommandsLength),0===r)return void n.commandList.push(e);const s=e.derivedCommands.globeTranslucency;for(let a=0;a<r;++a){const e=j0e[o[a]];n.commandList.push(s[e])}};const L1e=[W0e.OPAQUE_FRONT_FACE,W0e.OPAQUE_BACK_FACE],M1e=[W0e.DEPTH_ONLY_FRONT_FACE,W0e.DEPTH_ONLY_BACK_FACE,W0e.DEPTH_ONLY_FRONT_AND_BACK_FACE];Y0e.prototype.executeGlobeCommands=function(e,t,n,i,o){const r=i.context,s=e.commands[HU.GLOBE],a=e.indices[HU.GLOBE];0!==a&&(this._globeTranslucencyFramebuffer=n,n.clearClassification(r,o),P1e(s,a,t,i,r,o,L1e))},Y0e.prototype.executeGlobeClassificationCommands=function(e,t,n,i,o){const r=i.context,s=e.commands[HU.GLOBE],a=e.indices[HU.GLOBE],c=e.commands[HU.TERRAIN_CLASSIFICATION],l=e.indices[HU.TERRAIN_CLASSIFICATION];if(0===a||0===l)return;const u=this._frontFaceTranslucent,h=this._backFaceTranslucent;if(u&&h||R1e(c,l,t,i,r,o),!u&&!h)return;this._globeTranslucencyFramebuffer=n;const d=r.uniformState.globeDepthTexture,f=o.framebuffer;if(o.framebuffer=n.classificationFramebuffer,P1e(s,a,t,i,r,o,M1e),r.depthTexture){const e=n.packDepth(r,o);r.uniformState.globeDepthTexture=e}R1e(c,l,t,i,r,o),r.uniformState.globeDepthTexture=d,o.framebuffer=f};var B1e=Y0e;function N1e(){this._image=new Image}function F1e(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.url)&&!C(e.metadata))throw new x("options.url or options.metadata is required.");let t;if(this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0,C(e.metadata))t=e.metadata;else{const n=Vi.createIfNeeded(e.url);t=new ox(n)}this._metadata=t,this._tileDiscardPolicy=e.tileDiscardPolicy,this._tilingScheme=new ao({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,rectangle:new _t(-z.PI,-z.PI,z.PI,z.PI),ellipsoid:e.ellipsoid});let n=e.credit;"string"===typeof n&&(n=new Tr(n)),this._credit=n,this._tileWidth=256,this._tileHeight=256,this._maximumLevel=23,C(this._tileDiscardPolicy)||(this._tileDiscardPolicy=new N1e),this._errorEvent=new $n,this._ready=!1;const i=this;let o;this._readyPromise=t.readyPromise.then((function(e){if(!t.imageryPresent){const e=new Je(`The server ${t.url} doesn't have imagery`);return o=ef.handleError(o,i,i._errorEvent,e.message,void 0,void 0,void 0,e),Promise.reject(e)}return ef.handleSuccess(o),i._ready=e,e})).catch((function(e){return o=ef.handleError(o,i,i._errorEvent,e.message,void 0,void 0,void 0,e),Promise.reject(e)}))}function z1e(e,t,n,i,o,r){const s=ox.tileXYToQuadKey(n,i,o);let a=t.imageryVersion;return a=C(a)&&a>0?a:1,e._metadata.resource.getDerivedResource({url:`flatfile?f1-0${s}-i.${a.toString()}`,request:r})}function k1e(e){const t="JFIF";if(e[6]===t.charCodeAt(0)&&e[7]===t.charCodeAt(1)&&e[8]===t.charCodeAt(2)&&e[9]===t.charCodeAt(3))return"image/jpeg";const n="PNG";return e[1]===n.charCodeAt(0)&&e[2]===n.charCodeAt(1)&&e[3]===n.charCodeAt(2)?"image/png":void 0}function U1e(e){const t=kE.Z.Reader.create(e),n=t.len,i={};while(t.pos<n){const e=t.uint32();let n;switch(e>>>3){case 1:i.imageType=t.uint32();break;case 2:i.imageData=t.bytes();break;case 3:i.alphaType=t.uint32();break;case 4:i.imageAlpha=t.bytes();break;case 5:if(n=i.copyrightIds,C(n)||(n=i.copyrightIds=[]),2===(7&e)){const e=t.uint32()+t.pos;while(t.pos<e)n.push(t.uint32())}else n.push(t.uint32());break;default:t.skipType(7&e);break}}const o=i.imageType;if(C(o))switch(o){case 0:i.imageType="image/jpeg";break;case 4:i.imageType="image/png";break;default:throw new Je("GoogleEarthEnterpriseImageryProvider: Unsupported image type.")}const r=i.alphaType;return C(r)&&0!==r&&(console.log("GoogleEarthEnterpriseImageryProvider: External alpha not supported."),delete i.alphaType,delete i.imageAlpha),i}N1e.prototype.isReady=function(){return!0},N1e.prototype.shouldDiscardImage=function(e){return e===this._image},Object.defineProperties(F1e.prototype,{url:{get:function(){return this._metadata.url}},proxy:{get:function(){return this._metadata.proxy}},tileWidth:{get:function(){if(!this._ready)throw new x("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new x("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new x("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new x("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new x("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new x("rectangle must not be called before the imagery provider is ready.");return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new x("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!1}}}),F1e.prototype.getTileCredits=function(e,t,n){if(!this._ready)throw new x("getTileCredits must not be called before the imagery provider is ready.");const i=this._metadata,o=i.getTileInformation(e,t,n);if(C(o)){const e=i.providers[o.imageryProvider];if(C(e))return[e]}},F1e.prototype.requestImage=function(e,t,n,i){if(!this._ready)throw new x("requestImage must not be called before the imagery provider is ready.");const o=this._tileDiscardPolicy._image,r=this._metadata,s=ox.tileXYToQuadKey(e,t,n),a=r.getTileInformation(e,t,n);if(!C(a)){if(r.isValid(s)){const o=new jn({throttle:i.throttle,throttleByServer:i.throttleByServer,type:i.type,priorityFunction:i.priorityFunction});return void r.populateSubtree(e,t,n,o)}return o}if(!a.hasImagery())return o;const c=z1e(this,a,e,t,n,i).fetchArrayBuffer();return C(c)?c.then((function(e){LF(r.key,e);let t,n=new Uint8Array(e);const i=r.protoImagery;if(C(i)&&i||(t=k1e(n)),!C(t)&&(!C(i)||i)){const e=U1e(n);t=e.imageType,n=e.imageData}return C(t)&&C(n)?jF({uint8Array:n,format:t,flipY:!0}):o})):void 0},F1e.prototype.pickFeatures=function(e,t,n,i,o){};function V1e(e){if(e=R(e,{}),!C(e.url))throw new x("options.url is required.");if(!C(e.channel))throw new x("options.channel is required.");this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=1.9,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0;const t=e.url,n=R(e.path,"/default_map"),i=Vi.createIfNeeded(t).getDerivedResource({url:"/"===n[0]?n.substring(1):n});i.appendForwardSlash(),this._resource=i,this._url=t,this._path=n,this._tileDiscardPolicy=e.tileDiscardPolicy,this._channel=e.channel,this._requestType="ImageryMaps",this._credit=new Tr(`<a href="http://www.google.com/enterprise/mapsearth/products/earthenterprise.html"><img src="${V1e.logoUrl}" title="Google Imagery"/></a>`),this._tilingScheme=void 0,this._version=void 0,this._tileWidth=256,this._tileHeight=256,this._maximumLevel=e.maximumLevel,this._errorEvent=new $n,this._ready=!1,this._readyPromise=yn();const o=i.getDerivedResource({url:"query",queryParameters:{request:"Json",vars:"geeServerDefs",is2d:"t"}}),r=this;let s;function a(t){let n,i,o;try{n=JSON.parse(t)}catch(a){n=JSON.parse(t.replace(/([\[\{,])[\n\r ]*([A-Za-z0-9]+)[\n\r ]*:/g,'$1"$2":'))}for(let e=0;e<n.layers.length;e++)if(n.layers[e].id===r._channel){i=n.layers[e];break}if(!C(i))throw o=`Could not find layer with channel (id) of ${r._channel}.`,s=ef.handleError(s,r,r._errorEvent,o,void 0,void 0,void 0,l),new Je(o);if(!C(i.version))throw o=`Could not find a version in channel (id) ${r._channel}.`,s=ef.handleError(s,r,r._errorEvent,o,void 0,void 0,void 0,l),new Je(o);if(r._version=i.version,C(n.projection)&&"flat"===n.projection)r._tilingScheme=new ao({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,rectangle:new _t(-Math.PI,-Math.PI,Math.PI,Math.PI),ellipsoid:e.ellipsoid});else{if(C(n.projection)&&"mercator"!==n.projection)throw o=`Unsupported projection ${n.projection}.`,s=ef.handleError(s,r,r._errorEvent,o,void 0,void 0,void 0,l),new Je(o);r._tilingScheme=new nf({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,ellipsoid:e.ellipsoid})}r._ready=!0,r._readyPromise.resolve(!0),ef.handleSuccess(s)}function c(e){const t=R(e.message,`An error occurred while accessing ${o.url}.`);s=ef.handleError(s,r,r._errorEvent,t,void 0,void 0,void 0,l),r._readyPromise.reject(new Je(t))}function l(){o.fetchText().then((function(e){a(e)})).catch((function(e){c(e)}))}l()}Object.defineProperties(V1e.prototype,{url:{get:function(){return this._url}},path:{get:function(){return this._path}},proxy:{get:function(){return this._resource.proxy}},channel:{get:function(){return this._channel}},tileWidth:{get:function(){if(!this._ready)throw new x("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new x("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new x("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new x("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new x("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},version:{get:function(){if(!this._ready)throw new x("version must not be called before the imagery provider is ready.");return this._version}},requestType:{get:function(){if(!this._ready)throw new x("requestType must not be called before the imagery provider is ready.");return this._requestType}},rectangle:{get:function(){if(!this._ready)throw new x("rectangle must not be called before the imagery provider is ready.");return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new x("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}}),V1e.prototype.getTileCredits=function(e,t,n){},V1e.prototype.requestImage=function(e,t,n,i){if(!this._ready)throw new x("requestImage must not be called before the imagery provider is ready.");const o=this._resource.getDerivedResource({url:"query",request:i,queryParameters:{request:this._requestType,channel:this._channel,version:this._version,x:e,y:t,z:n+1}});return nWe.loadImage(this,o)},V1e.prototype.pickFeatures=function(e,t,n,i,o){},V1e._logoUrl=void 0,Object.defineProperties(V1e,{logoUrl:{get:function(){return C(V1e._logoUrl)||(V1e._logoUrl=Zi("Assets/Images/google_earth_credit.png")),V1e._logoUrl},set:function(e){D.defined("value",e),V1e._logoUrl=e}}});var H1e=V1e;const G1e=new xy(1,1,1,.4),W1e=new xy(0,1,0,.05),q1e=new xy(0,.5,0,.2);function j1e(e){e=R(e,R.EMPTY_OBJECT),this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0,this._tilingScheme=C(e.tilingScheme)?e.tilingScheme:new ao({ellipsoid:e.ellipsoid}),this._cells=R(e.cells,8),this._color=R(e.color,G1e),this._glowColor=R(e.glowColor,W1e),this._glowWidth=R(e.glowWidth,6),this._backgroundColor=R(e.backgroundColor,q1e),this._errorEvent=new $n,this._tileWidth=R(e.tileWidth,256),this._tileHeight=R(e.tileHeight,256),this._canvasSize=R(e.canvasSize,256),this._canvas=this._createGridCanvas(),this._readyPromise=Promise.resolve(!0)}Object.defineProperties(j1e.prototype,{proxy:{get:function(){}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){}},minimumLevel:{get:function(){}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){}},hasAlphaChannel:{get:function(){return!0}}}),j1e.prototype._drawGrid=function(e){const t=0,n=this._canvasSize;for(let i=0;i<=this._cells;++i){const o=i/this._cells,r=1+o*(n-1);e.moveTo(r,t),e.lineTo(r,n),e.moveTo(t,r),e.lineTo(n,r)}e.stroke()},j1e.prototype._createGridCanvas=function(){const e=document.createElement("canvas");e.width=this._canvasSize,e.height=this._canvasSize;const t=0,n=this._canvasSize,i=e.getContext("2d"),o=this._backgroundColor.toCssColorString();i.fillStyle=o,i.fillRect(t,t,n,n);const r=this._glowColor.toCssColorString();i.strokeStyle=r,i.lineWidth=this._glowWidth,i.strokeRect(t,t,n,n),this._drawGrid(i),i.lineWidth=.5*this._glowWidth,i.strokeRect(t,t,n,n),this._drawGrid(i);const s=this._color.toCssColorString();return i.strokeStyle=s,i.lineWidth=2,i.strokeRect(t,t,n,n),i.lineWidth=1,this._drawGrid(i),e},j1e.prototype.getTileCredits=function(e,t,n){},j1e.prototype.requestImage=function(e,t,n,i){return this._canvas},j1e.prototype.pickFeatures=function(e,t,n,i,o){};const Y1e={};function K1e(){UF("ImagerySplitDirection","ImagerySplitDirection was deprecated in Cesium 1.92. It will be removed in 1.94. Use SplitDirection instead.")}Object.defineProperties(Y1e,{LEFT:{get:function(){return K1e(),T4.LEFT}},NONE:{get:function(){return K1e(),T4.NONE}},RIGHT:{get:function(){return K1e(),T4.RIGHT}}});Object.freeze(Y1e);function X1e(){this._numSamples=1,this.previousFramebuffer=void 0,this._previousFramebuffer=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this._fbo=new Tie({depthStencil:!0,createDepthAttachments:!1}),this._fboClassified=new Tie({depthStencil:!0,createDepthAttachments:!1}),this._rsUnclassified=void 0,this._rsClassified=void 0,this._unclassifiedCommand=void 0,this._classifiedCommand=void 0,this._translucentCommand=void 0,this._clearColorCommand=new tJ({color:new xy(0,0,0,0),owner:this}),this._clearCommand=new tJ({color:new xy(0,0,0,0),depth:1,stencil:0});const e=this;this._uniformMap={colorTexture:function(){return e._fbo.getColorTexture()},depthTexture:function(){return e._depthStencilTexture},classifiedTexture:function(){return e._fboClassified.getColorTexture()}}}Object.defineProperties(X1e.prototype,{unclassifiedCommand:{get:function(){return this._unclassifiedCommand}}}),X1e.isTranslucencySupported=function(e){return e.depthTexture&&e.fragmentDepth};const Q1e={depthMask:!1,stencilTest:{enabled:!0,frontFunction:LY.EQUAL,frontOperation:{fail:BY.KEEP,zFail:BY.KEEP,zPass:BY.KEEP},backFunction:LY.NEVER,reference:0,mask:FY.CLASSIFICATION_MASK},blending:_k.ALPHA_BLEND},J1e={depthMask:!1,stencilTest:{enabled:!0,frontFunction:LY.NOT_EQUAL,frontOperation:{fail:BY.KEEP,zFail:BY.KEEP,zPass:BY.KEEP},backFunction:LY.NEVER,reference:0,mask:FY.CLASSIFICATION_MASK},blending:_k.ALPHA_BLEND},Z1e={depthMask:!0,depthTest:{enabled:!0},stencilTest:FY.setCesium3DTileBit(),stencilMask:FY.CESIUM_3D_TILE_MASK,blending:_k.ALPHA_BLEND},$1e="#extension GL_EXT_frag_depth : enable\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform sampler2D classifiedTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    if (color.a == 0.0)\n    {\n        discard;\n    }\n    bool isClassified = all(equal(texture2D(classifiedTexture, v_textureCoordinates), vec4(0.0)));\n#ifdef UNCLASSIFIED\n    vec4 highlightColor = czm_invertClassificationColor;\n    if (isClassified)\n    {\n        discard;\n    }\n#else\n    vec4 highlightColor = vec4(1.0);\n    if (!isClassified)\n    {\n        discard;\n    }\n#endif\n    gl_FragColor = color * highlightColor;\n    gl_FragDepthEXT = texture2D(depthTexture, v_textureCoordinates).r;\n}\n",e2e="uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    if (color.a == 0.0)\n    {\n        discard;\n    }\n#ifdef UNCLASSIFIED\n    gl_FragColor = color * czm_invertClassificationColor;\n#else\n    gl_FragColor = color;\n#endif\n}\n";X1e.prototype.update=function(e,t,n){const i=this._fbo.getColorTexture(),o=this.previousFramebuffer!==this._previousFramebuffer;this._previousFramebuffer=this.previousFramebuffer;const r=this._numSamples!==t,s=e.drawingBufferWidth,a=e.drawingBufferHeight,c=!C(i)||i.width!==s||i.height!==a;if((c||o||r)&&(this._numSamples=t,this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy(),C(this._previousFramebuffer)||(this._depthStencilTexture=new Uk({context:e,width:s,height:a,pixelFormat:fD.DEPTH_STENCIL,pixelDatatype:hD.UNSIGNED_INT_24_8}),t>1&&(this._depthStencilRenderbuffer=new Aie({context:e,width:s,height:a,format:vie.DEPTH24_STENCIL8,numSamples:t})))),!C(this._fbo.framebuffer)||c||o||r){let i,o;this._fbo.destroy(),this._fboClassified.destroy(),C(this._previousFramebuffer)?(i=n.getDepthStencilTexture(),o=n.getDepthStencilRenderbuffer()):(i=this._depthStencilTexture,o=this._depthStencilRenderbuffer),this._fbo.setDepthStencilTexture(i),C(o)&&this._fbo.setDepthStencilRenderbuffer(o),this._fbo.update(e,s,a,t),C(this._previousFramebuffer)||(this._fboClassified.setDepthStencilTexture(i),this._fboClassified.update(e,s,a))}if(C(this._rsUnclassified)||(this._rsUnclassified=yV.fromCache(Q1e),this._rsClassified=yV.fromCache(J1e),this._rsDefault=yV.fromCache(Z1e)),!C(this._unclassifiedCommand)||o||r){C(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy());const t=C(this._previousFramebuffer)?e2e:$1e,n=new tq({defines:["UNCLASSIFIED"],sources:[t]}),i=new tq({sources:[t]});this._unclassifiedCommand=e.createViewportQuadCommand(n,{renderState:C(this._previousFramebuffer)?this._rsUnclassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),this._classifiedCommand=e.createViewportQuadCommand(i,{renderState:C(this._previousFramebuffer)?this._rsClassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),C(this._translucentCommand)&&(this._translucentCommand.shaderProgram=this._translucentCommand.shaderProgram&&this._translucentCommand.shaderProgram.destroy()),C(this._previousFramebuffer)||(this._translucentCommand=e.createViewportQuadCommand(L0e,{renderState:this._rsUnclassified,uniformMap:this._uniformMap,owner:this}))}},X1e.prototype.prepareTextures=function(e,t){this._fbo._numSamples>1&&this._fbo.prepareTextures(e,t)},X1e.prototype.clear=function(e,t){C(this._previousFramebuffer)?this._fbo.clear(e,this._clearColorCommand,t):(this._fbo.clear(e,this._clearCommand,t),this._fboClassified.clear(e,this._clearCommand,t))},X1e.prototype.executeClassified=function(e,t){if(!C(this._previousFramebuffer)){const n=t.framebuffer;this.prepareTextures(e,!0),t.framebuffer=this._fboClassified.framebuffer,this._translucentCommand.execute(e,t),t.framebuffer=n}this._classifiedCommand.execute(e,t)},X1e.prototype.executeUnclassified=function(e,t){this._unclassifiedCommand.execute(e,t)},X1e.prototype.isDestroyed=function(){return!1},X1e.prototype.destroy=function(){return this._fbo.destroy(),this._fboClassified.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy(),C(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy()),Qh(this)};var t2e=X1e;const n2e=/{[^}]+}/g,i2e={x:_2e,y:y2e,z:A2e,s:w2e,reverseX:g2e,reverseY:v2e,reverseZ:b2e,westDegrees:C2e,southDegrees:E2e,eastDegrees:x2e,northDegrees:S2e,westProjected:O2e,southProjected:D2e,eastProjected:P2e,northProjected:R2e,width:L2e,height:M2e},o2e=_n(i2e,{i:B2e,j:N2e,reverseI:F2e,reverseJ:z2e,longitudeDegrees:H2e,latitudeDegrees:G2e,longitudeProjected:W2e,latitudeProjected:q2e,format:K2e});function r2e(e){if(!C(e))throw new x("options is required.");if(!C(e.then)&&!C(e.url))throw new x("options is required.");this._errorEvent=new $n,this._resource=void 0,this._urlSchemeZeroPadding=void 0,this._pickFeaturesResource=void 0,this._tileWidth=void 0,this._tileHeight=void 0,this._maximumLevel=void 0,this._minimumLevel=void 0,this._tilingScheme=void 0,this._rectangle=void 0,this._tileDiscardPolicy=void 0,this._credit=void 0,this._hasAlphaChannel=void 0,this._readyPromise=void 0,this._tags=void 0,this._pickFeaturesTags=void 0,this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0,this.enablePickFeatures=!0,this.reinitialize(e)}Object.defineProperties(r2e.prototype,{url:{get:function(){return this._resource.url}},urlSchemeZeroPadding:{get:function(){return this._urlSchemeZeroPadding}},pickFeaturesUrl:{get:function(){return this._pickFeaturesResource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){if(!this.ready)throw new x("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this.ready)throw new x("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this.ready)throw new x("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this.ready)throw new x("minimumLevel must not be called before the imagery provider is ready.");return this._minimumLevel}},tilingScheme:{get:function(){if(!this.ready)throw new x("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this.ready)throw new x("rectangle must not be called before the imagery provider is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this.ready)throw new x("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return C(this._resource)}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){if(!this.ready)throw new x("credit must not be called before the imagery provider is ready.");return this._credit}},hasAlphaChannel:{get:function(){if(!this.ready)throw new x("hasAlphaChannel must not be called before the imagery provider is ready.");return this._hasAlphaChannel}}}),r2e.prototype.reinitialize=function(e){const t=this;t._readyPromise=Promise.resolve(e).then((function(e){if(!C(e))throw new x("options is required.");if(!C(e.url))throw new x("options.url is required.");const n=e.customTags,i=_n(i2e,n),o=_n(o2e,n),r=Vi.createIfNeeded(e.url),s=Vi.createIfNeeded(e.pickFeaturesUrl);t.enablePickFeatures=R(e.enablePickFeatures,t.enablePickFeatures),t._urlSchemeZeroPadding=R(e.urlSchemeZeroPadding,t.urlSchemeZeroPadding),t._tileDiscardPolicy=e.tileDiscardPolicy,t._getFeatureInfoFormats=e.getFeatureInfoFormats,t._subdomains=e.subdomains,Array.isArray(t._subdomains)?t._subdomains=t._subdomains.slice():C(t._subdomains)&&t._subdomains.length>0?t._subdomains=t._subdomains.split(""):t._subdomains=["a","b","c"],t._tileWidth=R(e.tileWidth,256),t._tileHeight=R(e.tileHeight,256),t._minimumLevel=R(e.minimumLevel,0),t._maximumLevel=e.maximumLevel,t._tilingScheme=R(e.tilingScheme,new nf({ellipsoid:e.ellipsoid})),t._rectangle=R(e.rectangle,t._tilingScheme.rectangle),t._rectangle=_t.intersection(t._rectangle,t._tilingScheme.rectangle),t._hasAlphaChannel=R(e.hasAlphaChannel,!0);let a=e.credit;return"string"===typeof a&&(a=new Tr(a)),t._credit=a,t._resource=r,t._tags=i,t._pickFeaturesResource=s,t._pickFeaturesTags=o,!0}))},r2e.prototype.getTileCredits=function(e,t,n){if(!this.ready)throw new x("getTileCredits must not be called before the imagery provider is ready.")},r2e.prototype.requestImage=function(e,t,n,i){if(!this.ready)throw new x("requestImage must not be called before the imagery provider is ready.");return nWe.loadImage(this,u2e(this,e,t,n,i))},r2e.prototype.pickFeatures=function(e,t,n,i,o){if(!this.ready)throw new x("pickFeatures must not be called before the imagery provider is ready.");if(!this.enablePickFeatures||!C(this._pickFeaturesResource)||0===this._getFeatureInfoFormats.length)return;let r=0;const s=this;function a(e,t){return e.callback(t)}function c(){if(r>=s._getFeatureInfoFormats.length)return Promise.resolve([]);const l=s._getFeatureInfoFormats[r],u=p2e(s,e,t,n,i,o,l.format);return++r,"json"===l.type?u.fetchJson().then(l.callback).catch(c):"xml"===l.type?u.fetchXML().then(l.callback).catch(c):"text"===l.type||"html"===l.type?u.fetchText().then(l.callback).catch(c):u.fetch({responseType:l.format}).then(a.bind(void 0,l)).catch(c)}return c()};let s2e=!1;const a2e=new _t;let c2e=!1;const l2e=new _t;function u2e(e,t,n,i,o){s2e=!1,c2e=!1;const r=e._resource,s=r.getUrlComponent(!0),a=e._tags,c={},l=s.match(n2e);return C(l)&&l.forEach((function(o){const r=o.substring(1,o.length-1);C(a[r])&&(c[r]=a[r](e,t,n,i))})),r.getDerivedResource({request:o,templateValues:c})}let h2e=!1;const d2e=new ro;let f2e=!1;function p2e(e,t,n,i,o,r,s){s2e=!1,c2e=!1,h2e=!1,f2e=!1;const a=e._pickFeaturesResource,c=a.getUrlComponent(!0),l=e._pickFeaturesTags,u={},h=c.match(n2e);return C(h)&&h.forEach((function(a){const c=a.substring(1,a.length-1);C(l[c])&&(u[c]=l[c](e,t,n,i,o,r,s))})),a.getDerivedResource({templateValues:u})}function m2e(e,t,n){if(e&&e.urlSchemeZeroPadding&&e.urlSchemeZeroPadding.hasOwnProperty(t)){const i=e.urlSchemeZeroPadding[t];if("string"===typeof i){const e=i.length;e>1&&(n=n.length>=e?n:new Array(e-n.toString().length+1).join("0")+n)}}return n}function _2e(e,t,n,i){return m2e(e,"{x}",t)}function g2e(e,t,n,i){const o=e.tilingScheme.getNumberOfXTilesAtLevel(i)-t-1;return m2e(e,"{reverseX}",o)}function y2e(e,t,n,i){return m2e(e,"{y}",n)}function v2e(e,t,n,i){const o=e.tilingScheme.getNumberOfYTilesAtLevel(i)-n-1;return m2e(e,"{reverseY}",o)}function b2e(e,t,n,i){const o=e.maximumLevel,r=C(o)&&i<o?o-i-1:i;return m2e(e,"{reverseZ}",r)}function A2e(e,t,n,i){return m2e(e,"{z}",i)}function w2e(e,t,n,i){const o=(t+n+i)%e._subdomains.length;return e._subdomains[o]}function T2e(e,t,n,i){s2e||(e.tilingScheme.tileXYToRectangle(t,n,i,a2e),a2e.west=z.toDegrees(a2e.west),a2e.south=z.toDegrees(a2e.south),a2e.east=z.toDegrees(a2e.east),a2e.north=z.toDegrees(a2e.north),s2e=!0)}function C2e(e,t,n,i){return T2e(e,t,n,i),a2e.west}function E2e(e,t,n,i){return T2e(e,t,n,i),a2e.south}function x2e(e,t,n,i){return T2e(e,t,n,i),a2e.east}function S2e(e,t,n,i){return T2e(e,t,n,i),a2e.north}function I2e(e,t,n,i){c2e||(e.tilingScheme.tileXYToNativeRectangle(t,n,i,l2e),c2e=!0)}function O2e(e,t,n,i){return I2e(e,t,n,i),l2e.west}function D2e(e,t,n,i){return I2e(e,t,n,i),l2e.south}function P2e(e,t,n,i){return I2e(e,t,n,i),l2e.east}function R2e(e,t,n,i){return I2e(e,t,n,i),l2e.north}function L2e(e,t,n,i){return e.tileWidth}function M2e(e,t,n,i){return e.tileHeight}function B2e(e,t,n,i,o,r,s){return V2e(e,t,n,i,o,r),d2e.x}function N2e(e,t,n,i,o,r,s){return V2e(e,t,n,i,o,r),d2e.y}function F2e(e,t,n,i,o,r,s){return V2e(e,t,n,i,o,r),e.tileWidth-d2e.x-1}function z2e(e,t,n,i,o,r,s){return V2e(e,t,n,i,o,r),e.tileHeight-d2e.y-1}const k2e=new _t,U2e=new K;function V2e(e,t,n,i,o,r,s){if(h2e)return;Y2e(e,t,n,i,o,r);const a=U2e,c=e.tilingScheme.tileXYToNativeRectangle(t,n,i,k2e);d2e.x=e.tileWidth*(a.x-c.west)/c.width|0,d2e.y=e.tileHeight*(c.north-a.y)/c.height|0,h2e=!0}function H2e(e,t,n,i,o,r,s){return z.toDegrees(o)}function G2e(e,t,n,i,o,r,s){return z.toDegrees(r)}function W2e(e,t,n,i,o,r,s){return Y2e(e,t,n,i,o,r),U2e.x}function q2e(e,t,n,i,o,r,s){return Y2e(e,t,n,i,o,r),U2e.y}const j2e=new se;function Y2e(e,t,n,i,o,r,s){if(!f2e){if(e.tilingScheme.projection instanceof ve)U2e.x=z.toDegrees(o),U2e.y=z.toDegrees(r);else{const t=j2e;t.longitude=o,t.latitude=r,e.tilingScheme.projection.project(t,U2e)}f2e=!0}}function K2e(e,t,n,i,o,r,s){return s}var X2e=r2e;function Q2e(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.url))throw new x("options.url is required.");const t=yn();let n;X2e.call(this,t.promise),this._tmsResource=void 0,this._xmlResource=void 0,this._options=e,this._deferred=t,this._metadataError=void 0,this._metadataSuccess=this._metadataSuccess.bind(this),this._metadataFailure=this._metadataFailure.bind(this),this._requestMetadata=this._requestMetadata.bind(this);const i=this;Promise.resolve(e.url).then((function(e){n=Vi.createIfNeeded(e),n.appendForwardSlash(),i._tmsResource=n,i._xmlResource=n.getDerivedResource({url:"tilemapresource.xml"}),i._requestMetadata()})).catch((function(e){t.reject(e)}))}function J2e(e,t){return e.west<t.rectangle.west&&(e.west=t.rectangle.west),e.east>t.rectangle.east&&(e.east=t.rectangle.east),e.south<t.rectangle.south&&(e.south=t.rectangle.south),e.north>t.rectangle.north&&(e.north=t.rectangle.north),e}function Z2e(e,t,n){const i=e.positionToTileXY(_t.southwest(t),n),o=e.positionToTileXY(_t.northeast(t),n),r=(Math.abs(o.x-i.x)+1)*(Math.abs(o.y-i.y)+1);return r>4?0:n}C(Object.create)&&(Q2e.prototype=Object.create(X2e.prototype),Q2e.prototype.constructor=Q2e),Q2e.prototype._requestMetadata=function(){this._xmlResource.fetchXML().then(this._metadataSuccess).catch(this._metadataFailure)},Q2e.prototype._metadataSuccess=function(e){const t=/tileformat/i,n=/tileset/i,i=/tilesets/i,o=/boundingbox/i;let r,s,a;const c=[],l=this._xmlResource;let u=this._metadataError;const h=this._deferred,d=this._requestMetadata,f=e.childNodes[0].childNodes;for(let C=0;C<f.length;C++)if(t.test(f.item(C).nodeName))r=f.item(C);else if(i.test(f.item(C).nodeName)){a=f.item(C);const e=f.item(C).childNodes;for(let t=0;t<e.length;t++)n.test(e.item(t).nodeName)&&c.push(e.item(t))}else o.test(f.item(C).nodeName)&&(s=f.item(C));let p;if(!C(a)||!C(s))return p=`Unable to find expected tilesets or bbox attributes in ${l.url}.`,u=ef.handleError(u,this,this.errorEvent,p,void 0,void 0,void 0,d),u.retry||h.reject(new Je(p)),void(this._metadataError=u);const m=this._options,_=R(m.fileExtension,r.getAttribute("extension")),g=R(m.tileWidth,parseInt(r.getAttribute("width"),10)),y=R(m.tileHeight,parseInt(r.getAttribute("height"),10));let v=R(m.minimumLevel,parseInt(c[0].getAttribute("order"),10));const b=R(m.maximumLevel,parseInt(c[c.length-1].getAttribute("order"),10)),A=a.getAttribute("profile");let w=m.tilingScheme;if(!C(w))if("geodetic"===A||"global-geodetic"===A)w=new ao({ellipsoid:m.ellipsoid});else{if("mercator"!==A&&"global-mercator"!==A)return p=`${l.url}specifies an unsupported profile attribute, ${A}.`,u=ef.handleError(u,this,this.errorEvent,p,void 0,void 0,void 0,d),u.retry||h.reject(new Je(p)),void(this._metadataError=u);w=new nf({ellipsoid:m.ellipsoid})}let T=_t.clone(m.rectangle);if(!C(T)){let e,t,n,i;const o=R(m.flipXY,!1);o?(n=new ro(parseFloat(s.getAttribute("miny")),parseFloat(s.getAttribute("minx"))),i=new ro(parseFloat(s.getAttribute("maxy")),parseFloat(s.getAttribute("maxx")))):(n=new ro(parseFloat(s.getAttribute("minx")),parseFloat(s.getAttribute("miny"))),i=new ro(parseFloat(s.getAttribute("maxx")),parseFloat(s.getAttribute("maxy"))));const r="geodetic"===A||"mercator"===A;if(w.projection instanceof ve||r)e=se.fromDegrees(n.x,n.y),t=se.fromDegrees(i.x,i.y);else{const o=w.projection;e=o.unproject(n),t=o.unproject(i)}T=new _t(e.longitude,e.latitude,t.longitude,t.latitude)}T=J2e(T,w),v=Z2e(w,T,v);const E=this._tmsResource.getDerivedResource({url:`{z}/{x}/{reverseY}.${_}`});h.resolve({url:E,tilingScheme:w,rectangle:T,tileWidth:g,tileHeight:y,minimumLevel:v,maximumLevel:b,tileDiscardPolicy:m.tileDiscardPolicy,credit:m.credit})},Q2e.prototype._metadataFailure=function(e){const t=this._options,n=R(t.fileExtension,"png"),i=R(t.tileWidth,256),o=R(t.tileHeight,256),r=t.maximumLevel,s=C(t.tilingScheme)?t.tilingScheme:new nf({ellipsoid:t.ellipsoid});let a=R(t.rectangle,s.rectangle);a=J2e(a,s);const c=Z2e(s,a,t.minimumLevel),l=this._tmsResource.getDerivedResource({url:`{z}/{x}/{reverseY}.${n}`});this._deferred.resolve({url:l,tilingScheme:s,rectangle:a,tileWidth:i,tileHeight:o,minimumLevel:c,maximumLevel:r,tileDiscardPolicy:t.tileDiscardPolicy,credit:t.credit})};var $2e=Q2e;const e3e=/\/$/,t3e=new Tr('&copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/">Improve this map</a></strong>');function n3e(e){e=R(e,R.EMPTY_OBJECT);const t=e.mapId;if(!C(t))throw new x("options.mapId is required.");const n=e.accessToken;if(!C(n))throw new x("options.accessToken is required.");this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0;const i=Vi.createIfNeeded(R(e.url,"https://{s}.tiles.mapbox.com/v4/"));this._mapId=t,this._accessToken=n;let o=R(e.format,"png");/\./.test(o)||(o=`.${o}`),this._format=o;let r,s=i.getUrlComponent();e3e.test(s)||(s+="/"),s+=`${t}/{z}/{x}/{y}${this._format}`,i.url=s,i.setQueryParameters({access_token:n}),C(e.credit)?(r=e.credit,"string"===typeof r&&(r=new Tr(r))):r=t3e,this._resource=i,this._imageryProvider=new X2e({url:i,credit:r,ellipsoid:e.ellipsoid,minimumLevel:e.minimumLevel,maximumLevel:e.maximumLevel,rectangle:e.rectangle})}Object.defineProperties(n3e.prototype,{url:{get:function(){return this._imageryProvider.url}},ready:{get:function(){return this._imageryProvider.ready}},readyPromise:{get:function(){return this._imageryProvider.readyPromise}},rectangle:{get:function(){return this._imageryProvider.rectangle}},tileWidth:{get:function(){return this._imageryProvider.tileWidth}},tileHeight:{get:function(){return this._imageryProvider.tileHeight}},maximumLevel:{get:function(){return this._imageryProvider.maximumLevel}},minimumLevel:{get:function(){return this._imageryProvider.minimumLevel}},tilingScheme:{get:function(){return this._imageryProvider.tilingScheme}},tileDiscardPolicy:{get:function(){return this._imageryProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._imageryProvider.errorEvent}},credit:{get:function(){return this._imageryProvider.credit}},proxy:{get:function(){return this._imageryProvider.proxy}},hasAlphaChannel:{get:function(){return this._imageryProvider.hasAlphaChannel}}}),n3e.prototype.getTileCredits=function(e,t,n){},n3e.prototype.requestImage=function(e,t,n,i){return this._imageryProvider.requestImage(e,t,n,i)},n3e.prototype.pickFeatures=function(e,t,n,i,o){return this._imageryProvider.pickFeatures(e,t,n,i,o)},n3e._defaultCredit=t3e;var i3e=n3e;function o3e(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.url))throw new x("options.url is required.");this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0;const t=Vi.createIfNeeded(e.url),n=R(e.rectangle,_t.MAX_VALUE),i=new ao({rectangle:n,numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,ellipsoid:e.ellipsoid});this._tilingScheme=i,this._resource=t,this._image=void 0,this._texture=void 0,this._tileWidth=0,this._tileHeight=0,this._errorEvent=new $n,this._ready=!1,this._readyPromise=yn();let o=e.credit;"string"===typeof o&&(o=new Tr(o)),this._credit=o;const r=this;let s;function a(e){r._image=e,r._tileWidth=e.width,r._tileHeight=e.height,r._ready=!0,r._readyPromise.resolve(!0),ef.handleSuccess(r._errorEvent)}function c(e){const n=`Failed to load image ${t.url}.`;s=ef.handleError(s,r,r._errorEvent,n,0,0,0,l,e),s.retry||r._readyPromise.reject(new Je(n))}function l(){nWe.loadImage(null,t).then(a).catch(c)}l()}Object.defineProperties(o3e.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){if(!this._ready)throw new x("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new x("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new x("maximumLevel must not be called before the imagery provider is ready.");return 0}},minimumLevel:{get:function(){if(!this._ready)throw new x("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new x("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new x("tileDiscardPolicy must not be called before the imagery provider is ready.")}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}}),o3e.prototype.getTileCredits=function(e,t,n){},o3e.prototype.requestImage=function(e,t,n,i){if(!this._ready)throw new x("requestImage must not be called before the imagery provider is ready.");if(C(this._image))return Promise.resolve(this._image)},o3e.prototype.pickFeatures=function(e,t,n,i,o){};var r3e=o3e;function s3e(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.object("options.clock",e.clock),D.typeOf.object("options.times",e.times),D.typeOf.func("options.requestImageFunction",e.requestImageFunction),D.typeOf.func("options.reloadFunction",e.reloadFunction),this._tileCache={},this._tilesRequestedForInterval=[];const t=this._clock=e.clock;this._times=e.times,this._requestImageFunction=e.requestImageFunction,this._reloadFunction=e.reloadFunction,this._currentIntervalIndex=-1,t.onTick.addEventListener(this._clockOnTick,this),this._clockOnTick(t)}function a3e(e,t,n){return`${e}-${t}-${n}`}function c3e(e){const t=e.split("-");if(3===t.length)return{x:Number(t[0]),y:Number(t[1]),level:Number(t[2])}}function l3e(e){const t=e._times;if(!C(t))return;const n=e._clock,i=n.currentTime,o=n.canAnimate&&n.shouldAnimate,r=n.multiplier;if(!o&&0!==r)return;let s,a=t.indexOf(i);if(a<0)return;const c=t.get(a);return r>0?(s=Ea.secondsDifference(c.stop,i),++a):(s=Ea.secondsDifference(c.start,i),--a),s/=r,a>=0&&s<=5?t.get(a):void 0}function u3e(e,t,n){const i=e._times.indexOf(n.start),o=e._tileCache;let r=o[i];C(r)||(r=o[i]={});const s=t.key;if(C(r[s]))return!0;const a=c3e(s),c=new jn({throttle:!1,throttleByServer:!0,type:Wn.IMAGERY,priorityFunction:t.priorityFunction}),l=e._requestImageFunction(a.x,a.y,a.level,c,n);return!!C(l)&&(r[s]={promise:l,request:c},!0)}Object.defineProperties(s3e.prototype,{clock:{get:function(){return this._clock},set:function(e){if(!C(e))throw new x("value is required.");this._clock!==e&&(this._clock=e,this._clockOnTick(e),this._reloadFunction())}},times:{get:function(){return this._times},set:function(e){if(!C(e))throw new x("value is required.");this._times!==e&&(this._times=e,this._clockOnTick(this._clock),this._reloadFunction())}},currentInterval:{get:function(){return this._times.get(this._currentIntervalIndex)}}}),s3e.prototype.getFromCache=function(e,t,n,i){const o=a3e(e,t,n);let r;const s=this._tileCache[this._currentIntervalIndex];if(C(s)&&C(s[o])){const e=s[o];r=e.promise.catch((function(t){throw i.state=e.request.state,t})),delete s[o]}return r},s3e.prototype.checkApproachingInterval=function(e,t,n,i){const o=a3e(e,t,n),r=this._tilesRequestedForInterval,s=l3e(this),a={key:o,priorityFunction:i.priorityFunction};C(s)&&u3e(this,a,s)||r.push(a),r.length>=512&&r.splice(0,256)},s3e.prototype._clockOnTick=function(e){const t=e.currentTime,n=this._times,i=n.indexOf(t),o=this._currentIntervalIndex;if(i!==o){const e=this._tileCache[o];for(const t in e)e.hasOwnProperty(t)&&e[t].request.cancel();return delete this._tileCache[o],this._tilesRequestedForInterval=[],this._currentIntervalIndex=i,void this._reloadFunction()}const r=l3e(this);if(C(r)){const e=this._tilesRequestedForInterval;let t=!0;while(t){if(0===e.length)break;const n=e.pop();t=u3e(this,n,r),t||e.push(n)}}};var h3e=s3e;const d3e=[3034,3035,3042,3043,3044],f3e=[4471,4559];function p3e(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.url))throw new x("options.url is required.");if(!C(e.layers))throw new x("options.layers is required.");if(C(e.times)&&!C(e.clock))throw new x("options.times was specified, so options.clock is required.");this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0,this._getFeatureInfoUrl=R(e.getFeatureInfoUrl,e.url);const t=Vi.createIfNeeded(e.url),n=Vi.createIfNeeded(this._getFeatureInfoUrl);t.setQueryParameters(p3e.DefaultParameters,!0),n.setQueryParameters(p3e.GetFeatureInfoDefaultParameters,!0),C(e.parameters)&&t.setQueryParameters(g3e(e.parameters)),C(e.getFeatureInfoParameters)&&n.setQueryParameters(g3e(e.getFeatureInfoParameters));const i=this;this._reload=void 0,C(e.times)&&(this._timeDynamicImagery=new h3e({clock:e.clock,times:e.times,requestImageFunction:function(e,t,n,o,r){return m3e(i,e,t,n,o,r)},reloadFunction:function(){C(i._reload)&&i._reload()}}));const o={};if(o.layers=e.layers,o.bbox="{westProjected},{southProjected},{eastProjected},{northProjected}",o.width="{width}",o.height="{height}",parseFloat(t.queryParameters.version)>=1.3){o.crs=R(e.crs,e.tilingScheme&&e.tilingScheme.projection instanceof Vh?"EPSG:3857":"CRS:84");const t=o.crs.split(":");if("EPSG"===t[0]&&2===t.length){const e=Number(t[1]);(e>=4e3&&e<5e3&&!f3e.includes(e)||d3e.includes(e))&&(o.bbox="{southProjected},{westProjected},{northProjected},{eastProjected}")}}else o.srs=R(e.srs,e.tilingScheme&&e.tilingScheme.projection instanceof Vh?"EPSG:3857":"EPSG:4326");t.setQueryParameters(o,!0),n.setQueryParameters(o,!0);const r={query_layers:e.layers,info_format:"{format}"};parseFloat(n.queryParameters.version)>=1.3?(r.i="{i}",r.j="{j}"):(r.x="{i}",r.y="{j}"),n.setQueryParameters(r,!0),this._resource=t,this._pickFeaturesResource=n,this._layers=e.layers,this._tileProvider=new X2e({url:t,pickFeaturesUrl:n,tilingScheme:R(e.tilingScheme,new ao({ellipsoid:e.ellipsoid})),rectangle:e.rectangle,tileWidth:e.tileWidth,tileHeight:e.tileHeight,minimumLevel:e.minimumLevel,maximumLevel:e.maximumLevel,subdomains:e.subdomains,tileDiscardPolicy:e.tileDiscardPolicy,credit:e.credit,getFeatureInfoFormats:R(e.getFeatureInfoFormats,p3e.DefaultGetFeatureInfoFormats),enablePickFeatures:e.enablePickFeatures})}function m3e(e,t,n,i,o,r){const s=C(r)?r.data:void 0,a=e._tileProvider;return C(s)&&a._resource.setQueryParameters(s),a.requestImage(t,n,i,o)}function _3e(e,t,n,i,o,r,s){const a=C(s)?s.data:void 0,c=e._tileProvider;return C(a)&&c._pickFeaturesResource.setQueryParameters(a),c.pickFeatures(t,n,i,o,r)}function g3e(e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n.toLowerCase()]=e[n]);return t}Object.defineProperties(p3e.prototype,{url:{get:function(){return this._resource._url}},proxy:{get:function(){return this._resource.proxy}},layers:{get:function(){return this._layers}},tileWidth:{get:function(){return this._tileProvider.tileWidth}},tileHeight:{get:function(){return this._tileProvider.tileHeight}},maximumLevel:{get:function(){return this._tileProvider.maximumLevel}},minimumLevel:{get:function(){return this._tileProvider.minimumLevel}},tilingScheme:{get:function(){return this._tileProvider.tilingScheme}},rectangle:{get:function(){return this._tileProvider.rectangle}},tileDiscardPolicy:{get:function(){return this._tileProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._tileProvider.errorEvent}},ready:{get:function(){return this._tileProvider.ready}},readyPromise:{get:function(){return this._tileProvider.readyPromise}},credit:{get:function(){return this._tileProvider.credit}},hasAlphaChannel:{get:function(){return this._tileProvider.hasAlphaChannel}},enablePickFeatures:{get:function(){return this._tileProvider.enablePickFeatures},set:function(e){this._tileProvider.enablePickFeatures=e}},clock:{get:function(){return this._timeDynamicImagery.clock},set:function(e){this._timeDynamicImagery.clock=e}},times:{get:function(){return this._timeDynamicImagery.times},set:function(e){this._timeDynamicImagery.times=e}},getFeatureInfoUrl:{get:function(){return this._getFeatureInfoUrl}}}),p3e.prototype.getTileCredits=function(e,t,n){return this._tileProvider.getTileCredits(e,t,n)},p3e.prototype.requestImage=function(e,t,n,i){let o;const r=this._timeDynamicImagery;let s;return C(r)&&(s=r.currentInterval,o=r.getFromCache(e,t,n,i)),C(o)||(o=m3e(this,e,t,n,i,s)),C(o)&&C(r)&&r.checkApproachingInterval(e,t,n,i),o},p3e.prototype.pickFeatures=function(e,t,n,i,o){const r=this._timeDynamicImagery,s=C(r)?r.currentInterval:void 0;return _3e(this,e,t,n,i,o,s)},p3e.DefaultParameters=Object.freeze({service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"}),p3e.GetFeatureInfoDefaultParameters=Object.freeze({service:"WMS",version:"1.1.1",request:"GetFeatureInfo"}),p3e.DefaultGetFeatureInfoFormats=Object.freeze([Object.freeze(new nJe("json","application/json")),Object.freeze(new nJe("xml","text/xml")),Object.freeze(new nJe("text","text/html"))]);var y3e=p3e;const v3e=Object.freeze({service:"WMTS",version:"1.0.0",request:"GetTile"});function b3e(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.url))throw new x("options.url is required.");if(!C(e.layer))throw new x("options.layer is required.");if(!C(e.style))throw new x("options.style is required.");if(!C(e.tileMatrixSetID))throw new x("options.tileMatrixSetID is required.");if(C(e.times)&&!C(e.clock))throw new x("options.times was specified, so options.clock is required.");this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0;const t=Vi.createIfNeeded(e.url),n=e.style,i=e.tileMatrixSetID,o=t.url,r=o.match(/{/g);if(!C(r)||1===r.length&&/{s}/.test(o))t.setQueryParameters(v3e),this._useKvp=!0;else{const e={style:n,Style:n,TileMatrixSet:i};t.setTemplateValues(e),this._useKvp=!1}this._resource=t,this._layer=e.layer,this._style=n,this._tileMatrixSetID=i,this._tileMatrixLabels=e.tileMatrixLabels,this._format=R(e.format,"image/jpeg"),this._tileDiscardPolicy=e.tileDiscardPolicy,this._tilingScheme=C(e.tilingScheme)?e.tilingScheme:new nf({ellipsoid:e.ellipsoid}),this._tileWidth=R(e.tileWidth,256),this._tileHeight=R(e.tileHeight,256),this._minimumLevel=R(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,this._rectangle=R(e.rectangle,this._tilingScheme.rectangle),this._dimensions=e.dimensions;const s=this;this._reload=void 0,C(e.times)&&(this._timeDynamicImagery=new h3e({clock:e.clock,times:e.times,requestImageFunction:function(e,t,n,i,o){return A3e(s,e,t,n,i,o)},reloadFunction:function(){C(s._reload)&&s._reload()}})),this._readyPromise=Promise.resolve(!0);const a=this._tilingScheme.positionToTileXY(_t.southwest(this._rectangle),this._minimumLevel),c=this._tilingScheme.positionToTileXY(_t.northeast(this._rectangle),this._minimumLevel),l=(Math.abs(c.x-a.x)+1)*(Math.abs(c.y-a.y)+1);if(l>4)throw new x(`The imagery provider's rectangle and minimumLevel indicate that there are ${l} tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.`);this._errorEvent=new $n;const u=e.credit;this._credit="string"===typeof u?new Tr(u):u,this._subdomains=e.subdomains,Array.isArray(this._subdomains)?this._subdomains=this._subdomains.slice():C(this._subdomains)&&this._subdomains.length>0?this._subdomains=this._subdomains.split(""):this._subdomains=["a","b","c"]}function A3e(e,t,n,i,o,r){const s=e._tileMatrixLabels,a=C(s)?s[i]:i.toString(),c=e._subdomains,l=e._dimensions,u=C(r)?r.data:void 0;let h,d;if(e._useKvp){let r={};r.tilematrix=a,r.layer=e._layer,r.style=e._style,r.tilerow=n,r.tilecol=t,r.tilematrixset=e._tileMatrixSetID,r.format=e._format,C(l)&&(r=_n(r,l)),C(u)&&(r=_n(r,u)),d={s:c[(t+n+i)%c.length]},h=e._resource.getDerivedResource({queryParameters:r,request:o}),h.setTemplateValues(d)}else d={TileMatrix:a,TileRow:n.toString(),TileCol:t.toString(),s:c[(t+n+i)%c.length]},h=e._resource.getDerivedResource({request:o}),h.setTemplateValues(d),C(l)&&h.setTemplateValues(l),C(u)&&h.setTemplateValues(u);return nWe.loadImage(e,h)}Object.defineProperties(b3e.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return this._minimumLevel}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},format:{get:function(){return this._format}},ready:{value:!0},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}},clock:{get:function(){return this._timeDynamicImagery.clock},set:function(e){this._timeDynamicImagery.clock=e}},times:{get:function(){return this._timeDynamicImagery.times},set:function(e){this._timeDynamicImagery.times=e}},dimensions:{get:function(){return this._dimensions},set:function(e){this._dimensions!==e&&(this._dimensions=e,C(this._reload)&&this._reload())}}}),b3e.prototype.getTileCredits=function(e,t,n){},b3e.prototype.requestImage=function(e,t,n,i){let o;const r=this._timeDynamicImagery;let s;return C(r)&&(s=r.currentInterval,o=r.getFromCache(e,t,n,i)),C(o)||(o=A3e(this,e,t,n,i,s)),C(o)&&C(r)&&r.checkApproachingInterval(e,t,n,i),o},b3e.prototype.pickFeatures=function(e,t,n,i,o){};var w3e=b3e;function T3e(e){return function(t){return new e(t)}}const C3e={ARCGIS_MAPSERVER:T3e(rWe),BING:T3e(CWe),GOOGLE_EARTH:T3e(H1e),MAPBOX:T3e(i3e),SINGLE_TILE:T3e(r3e),TMS:T3e($2e),URL_TEMPLATE:T3e(X2e),WMS:T3e(y3e),WMTS:T3e(w3e)};function E3e(e){e=R(e,R.EMPTY_OBJECT);const t=e.assetId;D.typeOf.number("options.assetId",t),this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0,this._ready=!1,this._tileCredits=void 0,this._errorEvent=new $n;const n=this,i=rO._createEndpointResource(t,e),o=e.assetId.toString()+e.accessToken+e.server;let r=E3e._endpointCache[o];C(r)||(r=i.fetchJson(),E3e._endpointCache[o]=r),this._readyPromise=r.then((function(e){if("IMAGERY"!==e.type)return Promise.reject(new Je(`Cesium ion asset ${t} is not an imagery asset.`));let o;const r=e.externalType;if(C(r)){const t=C3e[r];if(!C(t))return Promise.reject(new Je(`Unrecognized Cesium ion imagery type: ${r}`));o=t(e.options)}else o=new $2e({url:new rO(e,i)});return n._tileCredits=rO.getCreditsFromEndpoint(e,i),o.errorEvent.addEventListener((function(e){e.provider=n,n._errorEvent.raiseEvent(e)})),n._imageryProvider=o,o.readyPromise.then((function(){return n._ready=!0,!0}))}))}Object.defineProperties(E3e.prototype,{ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},rectangle:{get:function(){if(!this._ready)throw new x("tileHeight must not be called before the imagery provider is ready.");return this._imageryProvider.rectangle}},tileWidth:{get:function(){if(!this._ready)throw new x("tileWidth must not be called before the imagery provider is ready.");return this._imageryProvider.tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new x("tileHeight must not be called before the imagery provider is ready.");return this._imageryProvider.tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new x("maximumLevel must not be called before the imagery provider is ready.");return this._imageryProvider.maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new x("minimumLevel must not be called before the imagery provider is ready.");return this._imageryProvider.minimumLevel}},tilingScheme:{get:function(){if(!this._ready)throw new x("tilingScheme must not be called before the imagery provider is ready.");return this._imageryProvider.tilingScheme}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new x("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._imageryProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){if(!this._ready)throw new x("credit must not be called before the imagery provider is ready.");return this._imageryProvider.credit}},hasAlphaChannel:{get:function(){if(!this._ready)throw new x("hasAlphaChannel must not be called before the imagery provider is ready.");return this._imageryProvider.hasAlphaChannel},proxy:{get:function(){}}}}),E3e.prototype.getTileCredits=function(e,t,n){if(!this._ready)throw new x("getTileCredits must not be called before the imagery provider is ready.");const i=this._imageryProvider.getTileCredits(e,t,n);return C(i)?this._tileCredits.concat(i):this._tileCredits},E3e.prototype.requestImage=function(e,t,n,i){if(!this._ready)throw new x("requestImage must not be called before the imagery provider is ready.");return this._imageryProvider.requestImage(e,t,n,i)},E3e.prototype.pickFeatures=function(e,t,n,i,o){if(!this._ready)throw new x("pickFeatures must not be called before the imagery provider is ready.");return this._imageryProvider.pickFeatures(e,t,n,i,o)},E3e._endpointCache={};var x3e=E3e;const S3e={AERIAL:2,AERIAL_WITH_LABELS:3,ROAD:4};var I3e=Object.freeze(S3e);function O3e(e){this._total=e,this.usedThisFrame=0,this.stolenFromMeThisFrame=0,this.starvedThisFrame=!1,this.starvedLastFrame=!1}function D3e(e){if(C(e)&&e.length!==B3.NUMBER_OF_JOB_TYPES)throw new x("A budget must be specified for each job type; budgets.length should equal JobType.NUMBER_OF_JOB_TYPES.");const t=new Array(B3.NUMBER_OF_JOB_TYPES);t[B3.TEXTURE]=new O3e(C(e)?e[B3.TEXTURE]:10),t[B3.PROGRAM]=new O3e(C(e)?e[B3.PROGRAM]:10),t[B3.BUFFER]=new O3e(C(e)?e[B3.BUFFER]:30);const n=t.length;let i,o=0;for(i=0;i<n;++i)o+=t[i].total;const r=new Array(n);for(i=0;i<n;++i)r[i]=!1;this._totalBudget=o,this._totalUsedThisFrame=0,this._budgets=t,this._executedThisFrame=r}Object.defineProperties(O3e.prototype,{total:{get:function(){return this._total}}}),D3e.getTimestamp=py,Object.defineProperties(D3e.prototype,{totalBudget:{get:function(){return this._totalBudget}}}),D3e.prototype.disableThisFrame=function(){this._totalUsedThisFrame=this._totalBudget},D3e.prototype.resetBudgets=function(){const e=this._budgets,t=e.length;for(let n=0;n<t;++n){const t=e[n];t.starvedLastFrame=t.starvedThisFrame,t.starvedThisFrame=!1,t.usedThisFrame=0,t.stolenFromMeThisFrame=0}this._totalUsedThisFrame=0},D3e.prototype.execute=function(e,t){const n=this._budgets,i=n[t],o=this._executedThisFrame[t];if(this._totalUsedThisFrame>=this._totalBudget&&o)return i.starvedThisFrame=!0,!1;let r;if(i.usedThisFrame+i.stolenFromMeThisFrame>=i.total){const e=n.length;let t;for(t=0;t<e;++t)if(r=n[t],r.usedThisFrame+r.stolenFromMeThisFrame<r.total&&!r.starvedLastFrame)break;if(t===e&&o)return!1;o&&(i.starvedThisFrame=!0)}const s=D3e.getTimestamp();e.execute();const a=D3e.getTimestamp()-s;return this._totalUsedThisFrame+=a,r?r.stolenFromMeThisFrame+=a:i.usedThisFrame+=a,this._executedThisFrame[t]=!0,!0};var P3e=D3e;function R3e(){}Object.defineProperties(R3e.prototype,{color:{get:x.throwInstantiationError},intensity:{get:x.throwInstantiationError}});const L3e=/\/$/,M3e=new Tr('&copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/">Improve this map</a></strong>');function B3e(e){e=R(e,R.EMPTY_OBJECT);const t=e.styleId;if(!C(t))throw new x("options.styleId is required.");const n=e.accessToken;if(!C(n))throw new x("options.accessToken is required.");this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0;const i=Vi.createIfNeeded(R(e.url,"https://api.mapbox.com/styles/v1/"));this._styleId=t,this._accessToken=n;const o=R(e.tilesize,512);this._tilesize=o;const r=R(e.username,"mapbox");this._username=r;const s=C(e.scaleFactor)?"@2x":"";let a,c=i.getUrlComponent();L3e.test(c)||(c+="/"),c+=`${this._username}/${t}/tiles/${this._tilesize}/{z}/{x}/{y}${s}`,i.url=c,i.setQueryParameters({access_token:n}),C(e.credit)?(a=e.credit,"string"===typeof a&&(a=new Tr(a))):a=M3e,this._resource=i,this._imageryProvider=new X2e({url:i,credit:a,ellipsoid:e.ellipsoid,minimumLevel:e.minimumLevel,maximumLevel:e.maximumLevel,rectangle:e.rectangle})}Object.defineProperties(B3e.prototype,{url:{get:function(){return this._imageryProvider.url}},ready:{get:function(){return this._imageryProvider.ready}},readyPromise:{get:function(){return this._imageryProvider.readyPromise}},rectangle:{get:function(){return this._imageryProvider.rectangle}},tileWidth:{get:function(){return this._imageryProvider.tileWidth}},tileHeight:{get:function(){return this._imageryProvider.tileHeight}},maximumLevel:{get:function(){return this._imageryProvider.maximumLevel}},minimumLevel:{get:function(){return this._imageryProvider.minimumLevel}},tilingScheme:{get:function(){return this._imageryProvider.tilingScheme}},tileDiscardPolicy:{get:function(){return this._imageryProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._imageryProvider.errorEvent}},credit:{get:function(){return this._imageryProvider.credit}},proxy:{get:function(){return this._imageryProvider.proxy}},hasAlphaChannel:{get:function(){return this._imageryProvider.hasAlphaChannel}}}),B3e.prototype.getTileCredits=function(e,t,n){},B3e.prototype.requestImage=function(e,t,n,i){return this._imageryProvider.requestImage(e,t,n,i)},B3e.prototype.pickFeatures=function(e,t,n,i,o){return this._imageryProvider.pickFeatures(e,t,n,i,o)},B3e._defaultCredit=M3e;function N3e(e){e=R(e,R.EMPTY_OBJECT);let t=e.textureUrl;C(t)||(t=Zi("Assets/Textures/moonSmall.jpg")),this.show=R(e.show,!0),this.textureUrl=t,this._ellipsoid=R(e.ellipsoid,ge.MOON),this.onlySunLighting=R(e.onlySunLighting,!0),this._ellipsoidPrimitive=new gQe({radii:this.ellipsoid.radii,material:EU.fromType(EU.ImageType),depthTestEnabled:!1,_owner:this}),this._ellipsoidPrimitive.material.translucent=!1,this._axes=new YI}Object.defineProperties(N3e.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});const F3e=new ke,z3e=new ke,k3e=new K,U3e=[];N3e.prototype.update=function(e){if(!this.show)return;const t=this._ellipsoidPrimitive;t.material.uniforms.image=this.textureUrl,t.onlySunLighting=this.onlySunLighting;const n=e.time;C(Kl.computeIcrfToFixedMatrix(n,F3e))||Kl.computeTemeToPseudoFixedMatrix(n,F3e);const i=this._axes.evaluate(n,z3e);ke.transpose(i,i),ke.multiply(F3e,i,i);const o=cN.computeMoonPositionInEarthInertialFrame(n,k3e);ke.multiplyByVector(F3e,o,o),ft.fromRotationTranslation(i,o,t.modelMatrix);const r=e.commandList;return e.commandList=U3e,U3e.length=0,t.update(e),e.commandList=r,1===U3e.length?U3e[0]:void 0},N3e.prototype.isDestroyed=function(){return!1},N3e.prototype.destroy=function(){return this._ellipsoidPrimitive=this._ellipsoidPrimitive&&this._ellipsoidPrimitive.destroy(),Qh(this)};var V3e=N3e;function H3e(e){}H3e.prototype.isReady=function(){return!0},H3e.prototype.shouldDiscardImage=function(e){return!1};var G3e="#ifdef MRT\n#extension GL_EXT_draw_buffers : enable\n#endif\n\nuniform vec4 u_bgColor;\nuniform sampler2D u_depthTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    if (texture2D(u_depthTexture, v_textureCoordinates).r < 1.0)\n    {\n#ifdef MRT\n        gl_FragData[0] = u_bgColor;\n        gl_FragData[1] = vec4(u_bgColor.a);\n#else\n        gl_FragColor = u_bgColor;\n#endif\n        return;\n    }\n    \n    discard;\n}\n",W3e="/**\n * Compositing for Weighted Blended Order-Independent Transparency. See:\n * - http://jcgt.org/published/0002/02/09/\n * - http://casual-effects.blogspot.com/2014/03/weighted-blended-order-independent.html\n */\n\nuniform sampler2D u_opaque;\nuniform sampler2D u_accumulation;\nuniform sampler2D u_revealage;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    vec4 opaque = texture2D(u_opaque, v_textureCoordinates);\n    vec4 accum = texture2D(u_accumulation, v_textureCoordinates);\n    float r = texture2D(u_revealage, v_textureCoordinates).r;\n\n#ifdef MRT\n    vec4 transparent = vec4(accum.rgb / clamp(r, 1e-4, 5e4), accum.a);\n#else\n    vec4 transparent = vec4(accum.rgb / clamp(accum.a, 1e-4, 5e4), r);\n#endif\n\n    gl_FragColor = (1.0 - transparent.a) * transparent + transparent.a * opaque;\n\n    if (opaque != czm_backgroundColor)\n    {\n        gl_FragColor.a = 1.0;\n    }\n}\n";function q3e(e){this._numSamples=1,this._translucentMultipassSupport=!1,this._translucentMRTSupport=!1;const t=e.colorBufferFloat&&e.depthTexture;this._translucentMRTSupport=e.drawBuffers&&t,this._translucentMultipassSupport=!this._translucentMRTSupport&&t,this._opaqueFBO=void 0,this._opaqueTexture=void 0,this._depthStencilTexture=void 0,this._accumulationTexture=void 0,this._translucentFBO=new Tie({colorAttachmentsLength:this._translucentMRTSupport?2:1,createColorAttachments:!1,createDepthAttachments:!1,depth:!0}),this._alphaFBO=new Tie({createColorAttachments:!1,createDepthAttachments:!1,depth:!0}),this._adjustTranslucentFBO=new Tie({colorAttachmentsLength:this._translucentMRTSupport?2:1,createColorAttachments:!1}),this._adjustAlphaFBO=new Tie({createColorAttachments:!1}),this._opaqueClearCommand=new tJ({color:new xy(0,0,0,0),owner:this}),this._translucentMRTClearCommand=new tJ({color:new xy(0,0,0,1),owner:this}),this._translucentMultipassClearCommand=new tJ({color:new xy(0,0,0,0),owner:this}),this._alphaClearCommand=new tJ({color:new xy(1,1,1,1),owner:this}),this._translucentRenderStateCache={},this._alphaRenderStateCache={},this._compositeCommand=void 0,this._adjustTranslucentCommand=void 0,this._adjustAlphaCommand=void 0,this._viewport=new bf,this._rs=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHDR=!1}function j3e(e){e._accumulationTexture=e._accumulationTexture&&!e._accumulationTexture.isDestroyed()&&e._accumulationTexture.destroy(),e._revealageTexture=e._revealageTexture&&!e._revealageTexture.isDestroyed()&&e._revealageTexture.destroy()}function Y3e(e){e._translucentFBO.destroy(),e._alphaFBO.destroy(),e._adjustTranslucentFBO.destroy(),e._adjustAlphaFBO.destroy()}function K3e(e){j3e(e),Y3e(e)}function X3e(e,t,n,i){j3e(e),e._accumulationTexture=new Uk({context:t,width:n,height:i,pixelFormat:fD.RGBA,pixelDatatype:hD.FLOAT});const o=new Float32Array(n*i*4);e._revealageTexture=new Uk({context:t,pixelFormat:fD.RGBA,pixelDatatype:hD.FLOAT,source:{arrayBufferView:o,width:n,height:i},flipY:!1})}function Q3e(e,t){Y3e(e);const n=th.FRAMEBUFFER_COMPLETE;let i=!0;const o=e._accumulationTexture.width,r=e._accumulationTexture.height;if(e._translucentMRTSupport&&(e._translucentFBO.setColorTexture(e._accumulationTexture,0),e._translucentFBO.setColorTexture(e._revealageTexture,1),e._translucentFBO.setDepthStencilTexture(e._depthStencilTexture),e._translucentFBO.update(t,o,r),e._adjustTranslucentFBO.setColorTexture(e._accumulationTexture,0),e._adjustTranslucentFBO.setColorTexture(e._revealageTexture,1),e._adjustTranslucentFBO.update(t,o,r),e._translucentFBO.status===n&&e._adjustTranslucentFBO.status===n||(Y3e(e),e._translucentMRTSupport=!1)),!e._translucentMRTSupport){e._translucentFBO.setColorTexture(e._accumulationTexture),e._translucentFBO.setDepthStencilTexture(e._depthStencilTexture),e._translucentFBO.update(t,o,r),e._alphaFBO.setColorTexture(e._revealageTexture),e._alphaFBO.setDepthStencilTexture(e._depthStencilTexture),e._alphaFBO.update(t,o,r),e._adjustTranslucentFBO.setColorTexture(e._accumulationTexture),e._adjustTranslucentFBO.update(t,o,r),e._adjustAlphaFBO.setColorTexture(e._revealageTexture),e._adjustAlphaFBO.update(t,o,r);const s=e._translucentFBO.status===n,a=e._alphaFBO.status===n,c=e._adjustTranslucentFBO.status===n,l=e._adjustAlphaFBO.status===n;s&&a&&c&&l||(K3e(e),e._translucentMultipassSupport=!1,i=!1)}return i}q3e.prototype.update=function(e,t,n,i,o){if(!this.isSupported())return;this._opaqueFBO=n,this._opaqueTexture=n.getColorTexture(0),this._depthStencilTexture=n.getDepthStencilTexture();const r=this._opaqueTexture.width,s=this._opaqueTexture.height,a=this._accumulationTexture,c=!C(a)||a.width!==r||a.height!==s||i!==this._useHDR,l=this._numSamples!==o;if((c||l)&&(this._numSamples=o,X3e(this,e,r,s)),(!C(this._translucentFBO.framebuffer)||c||l)&&!Q3e(this,e))return;this._useHDR=i;const u=this;let h,d;C(this._compositeCommand)||(h=new tq({sources:[W3e]}),this._translucentMRTSupport&&h.defines.push("MRT"),d={u_opaque:function(){return u._opaqueTexture},u_accumulation:function(){return u._accumulationTexture},u_revealage:function(){return u._revealageTexture}},this._compositeCommand=e.createViewportQuadCommand(h,{uniformMap:d,owner:this})),C(this._adjustTranslucentCommand)||(this._translucentMRTSupport?(h=new tq({defines:["MRT"],sources:[G3e]}),d={u_bgColor:function(){return u._translucentMRTClearCommand.color},u_depthTexture:function(){return u._depthStencilTexture}},this._adjustTranslucentCommand=e.createViewportQuadCommand(h,{uniformMap:d,owner:this})):this._translucentMultipassSupport&&(h=new tq({sources:[G3e]}),d={u_bgColor:function(){return u._translucentMultipassClearCommand.color},u_depthTexture:function(){return u._depthStencilTexture}},this._adjustTranslucentCommand=e.createViewportQuadCommand(h,{uniformMap:d,owner:this}),d={u_bgColor:function(){return u._alphaClearCommand.color},u_depthTexture:function(){return u._depthStencilTexture}},this._adjustAlphaCommand=e.createViewportQuadCommand(h,{uniformMap:d,owner:this}))),this._viewport.width=r,this._viewport.height=s;const f=!bf.equals(this._viewport,t.viewport);let p=f!==this._useScissorTest;this._useScissorTest=f,bf.equals(this._scissorRectangle,t.viewport)||(this._scissorRectangle=bf.clone(t.viewport,this._scissorRectangle),p=!0),C(this._rs)&&bf.equals(this._viewport,this._rs.viewport)&&!p||(this._rs=yV.fromCache({viewport:this._viewport,scissorTest:{enabled:this._useScissorTest,rectangle:this._scissorRectangle}})),C(this._compositeCommand)&&(this._compositeCommand.renderState=this._rs),this._adjustTranslucentCommand&&(this._adjustTranslucentCommand.renderState=this._rs),C(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.renderState=this._rs)};const J3e={enabled:!0,color:new xy(0,0,0,0),equationRgb:dk.ADD,equationAlpha:dk.ADD,functionSourceRgb:pk.ONE,functionDestinationRgb:pk.ONE,functionSourceAlpha:pk.ZERO,functionDestinationAlpha:pk.ONE_MINUS_SOURCE_ALPHA},Z3e={enabled:!0,color:new xy(0,0,0,0),equationRgb:dk.ADD,equationAlpha:dk.ADD,functionSourceRgb:pk.ONE,functionDestinationRgb:pk.ONE,functionSourceAlpha:pk.ONE,functionDestinationAlpha:pk.ONE},$3e={enabled:!0,color:new xy(0,0,0,0),equationRgb:dk.ADD,equationAlpha:dk.ADD,functionSourceRgb:pk.ZERO,functionDestinationRgb:pk.ONE_MINUS_SOURCE_ALPHA,functionSourceAlpha:pk.ZERO,functionDestinationAlpha:pk.ONE_MINUS_SOURCE_ALPHA};function e4e(e,t,n,i){let o=n[i.id];if(!C(o)){const e=yV.getState(i);e.depthMask=!1,e.blending=t,o=yV.fromCache(e),n[i.id]=o}return o}function t4e(e,t,n){return e4e(t,J3e,e._translucentRenderStateCache,n)}function n4e(e,t,n){return e4e(t,Z3e,e._translucentRenderStateCache,n)}function i4e(e,t,n){return e4e(t,$3e,e._alphaRenderStateCache,n)}const o4e="    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai = czm_gl_FragColor.a;\n    float wzi = czm_alphaWeight(ai);\n    gl_FragData[0] = vec4(Ci * wzi, ai);\n    gl_FragData[1] = vec4(ai * wzi);\n",r4e="    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai = czm_gl_FragColor.a;\n    float wzi = czm_alphaWeight(ai);\n    gl_FragColor = vec4(Ci, ai) * wzi;\n",s4e="    float ai = czm_gl_FragColor.a;\n    gl_FragColor = vec4(ai);\n";function a4e(e,t,n,i){let o=e.shaderCache.getDerivedShaderProgram(t,n);if(!C(o)){const r=t._attributeLocations,s=t.fragmentShaderSource.clone();s.sources=s.sources.map((function(e){return e=tq.replaceMain(e,"czm_translucent_main"),e=e.replace(/gl_FragColor/g,"czm_gl_FragColor"),e=e.replace(/\bdiscard\b/g,"czm_discard = true"),e=e.replace(/czm_phong/g,"czm_translucentPhong"),e})),s.sources.splice(0,0,(-1!==i.indexOf("gl_FragData")?"#extension GL_EXT_draw_buffers : enable \n":"")+"vec4 czm_gl_FragColor;\nbool czm_discard = false;\n"),s.sources.push(`void main()\n{\n    czm_translucent_main();\n    if (czm_discard)\n    {\n        discard;\n    }\n${i}}\n`),o=e.shaderCache.createDerivedShaderProgram(t,n,{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:s,attributeLocations:r})}return o}function c4e(e,t){return a4e(e,t,"translucentMRT",o4e)}function l4e(e,t){return a4e(e,t,"translucentMultipass",r4e)}function u4e(e,t){return a4e(e,t,"alphaMultipass",s4e)}function h4e(e,t,n,i,o,r){let s,a,c;const l=t.context,u=t.frameState.useLogDepth,h=t._hdr,d=i.framebuffer,f=o.length,p=t.frameState.shadowState.lightShadowsEnabled;i.framebuffer=e._adjustTranslucentFBO.framebuffer,e._adjustTranslucentCommand.execute(l,i),i.framebuffer=e._adjustAlphaFBO.framebuffer,e._adjustAlphaCommand.execute(l,i);const m=e._opaqueFBO.framebuffer;for(i.framebuffer=e._translucentFBO.framebuffer,c=0;c<f;++c)s=o[c],s=u?s.derivedCommands.logDepth.command:s,s=h?s.derivedCommands.hdr.command:s,a=p&&s.receiveShadows?s.derivedCommands.oit.shadows.translucentCommand:s.derivedCommands.oit.translucentCommand,n(a,t,l,i,m);for(C(r)&&(s=r.unclassifiedCommand,a=p&&s.receiveShadows?s.derivedCommands.oit.shadows.translucentCommand:s.derivedCommands.oit.translucentCommand,n(a,t,l,i,m)),i.framebuffer=e._alphaFBO.framebuffer,c=0;c<f;++c)s=o[c],s=u?s.derivedCommands.logDepth.command:s,s=h?s.derivedCommands.hdr.command:s,a=p&&s.receiveShadows?s.derivedCommands.oit.shadows.alphaCommand:s.derivedCommands.oit.alphaCommand,n(a,t,l,i,m);C(r)&&(s=r.unclassifiedCommand,a=p&&s.receiveShadows?s.derivedCommands.oit.shadows.alphaCommand:s.derivedCommands.oit.alphaCommand,n(a,t,l,i,m)),i.framebuffer=d}function d4e(e,t,n,i,o,r){const s=t.context,a=t.frameState.useLogDepth,c=t._hdr,l=i.framebuffer,u=o.length,h=t.frameState.shadowState.lightShadowsEnabled;i.framebuffer=e._adjustTranslucentFBO.framebuffer,e._adjustTranslucentCommand.execute(s,i);const d=e._opaqueFBO.framebuffer;let f,p;i.framebuffer=e._translucentFBO.framebuffer;for(let m=0;m<u;++m)f=o[m],f=a?f.derivedCommands.logDepth.command:f,f=c?f.derivedCommands.hdr.command:f,p=h&&f.receiveShadows?f.derivedCommands.oit.shadows.translucentCommand:f.derivedCommands.oit.translucentCommand,n(p,t,s,i,d);C(r)&&(f=r.unclassifiedCommand,p=h&&f.receiveShadows?f.derivedCommands.oit.shadows.translucentCommand:f.derivedCommands.oit.translucentCommand,n(p,t,s,i,d)),i.framebuffer=l}q3e.prototype.createDerivedCommands=function(e,t,n){if(C(n)||(n={}),this._translucentMRTSupport){let i,o;C(n.translucentCommand)&&(i=n.translucentCommand.shaderProgram,o=n.translucentCommand.renderState),n.translucentCommand=UU.shallowClone(e,n.translucentCommand),C(i)&&n.shaderProgramId===e.shaderProgram.id?(n.translucentCommand.shaderProgram=i,n.translucentCommand.renderState=o):(n.translucentCommand.shaderProgram=c4e(t,e.shaderProgram),n.translucentCommand.renderState=t4e(this,t,e.renderState),n.shaderProgramId=e.shaderProgram.id)}else{let i,o,r,s;C(n.translucentCommand)&&(i=n.translucentCommand.shaderProgram,o=n.translucentCommand.renderState,r=n.alphaCommand.shaderProgram,s=n.alphaCommand.renderState),n.translucentCommand=UU.shallowClone(e,n.translucentCommand),n.alphaCommand=UU.shallowClone(e,n.alphaCommand),C(i)&&n.shaderProgramId===e.shaderProgram.id?(n.translucentCommand.shaderProgram=i,n.translucentCommand.renderState=o,n.alphaCommand.shaderProgram=r,n.alphaCommand.renderState=s):(n.translucentCommand.shaderProgram=l4e(t,e.shaderProgram),n.translucentCommand.renderState=n4e(this,t,e.renderState),n.alphaCommand.shaderProgram=u4e(t,e.shaderProgram),n.alphaCommand.renderState=i4e(this,t,e.renderState),n.shaderProgramId=e.shaderProgram.id)}return n},q3e.prototype.executeCommands=function(e,t,n,i,o){this._translucentMRTSupport?d4e(this,e,t,n,i,o):h4e(this,e,t,n,i,o)},q3e.prototype.execute=function(e,t){this._compositeCommand.execute(e,t)},q3e.prototype.clear=function(e,t,n){const i=t.framebuffer;t.framebuffer=this._opaqueFBO.framebuffer,xy.clone(n,this._opaqueClearCommand.color),this._opaqueClearCommand.execute(e,t),t.framebuffer=this._translucentFBO.framebuffer;const o=this._translucentMRTSupport?this._translucentMRTClearCommand:this._translucentMultipassClearCommand;o.execute(e,t),this._translucentMultipassSupport&&(t.framebuffer=this._alphaFBO.framebuffer,this._alphaClearCommand.execute(e,t)),t.framebuffer=i},q3e.prototype.isSupported=function(){return this._translucentMRTSupport||this._translucentMultipassSupport},q3e.prototype.isDestroyed=function(){return!1},q3e.prototype.destroy=function(){return K3e(this),C(this._compositeCommand)&&(this._compositeCommand.shaderProgram=this._compositeCommand.shaderProgram&&this._compositeCommand.shaderProgram.destroy()),C(this._adjustTranslucentCommand)&&(this._adjustTranslucentCommand.shaderProgram=this._adjustTranslucentCommand.shaderProgram&&this._adjustTranslucentCommand.shaderProgram.destroy()),C(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.shaderProgram=this._adjustAlphaCommand.shaderProgram&&this._adjustAlphaCommand.shaderProgram.destroy()),Qh(this)};var f4e=q3e;const p4e=new Tr("MapQuest, Open Street Map and contributors, CC-BY-SA");function m4e(e){e=R(e,R.EMPTY_OBJECT);const t=Vi.createIfNeeded(R(e.url,"https://a.tile.openstreetmap.org/"));t.appendForwardSlash(),t.url+=`{z}/{x}/{y}.${R(e.fileExtension,"png")}`;const n=new nf({ellipsoid:e.ellipsoid}),i=256,o=256,r=R(e.minimumLevel,0),s=e.maximumLevel,a=R(e.rectangle,n.rectangle),c=n.positionToTileXY(_t.southwest(a),r),l=n.positionToTileXY(_t.northeast(a),r),u=(Math.abs(l.x-c.x)+1)*(Math.abs(l.y-c.y)+1);if(u>4)throw new x(`The rectangle and minimumLevel indicate that there are ${u} tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.`);let h=R(e.credit,p4e);"string"===typeof h&&(h=new Tr(h)),X2e.call(this,{url:t,credit:h,tilingScheme:n,tileWidth:i,tileHeight:o,minimumLevel:r,maximumLevel:s,rectangle:a})}C(Object.create)&&(m4e.prototype=Object.create(X2e.prototype),m4e.prototype.constructor=m4e);var _4e=m4e;const g4e=new ro(1,1);function y4e(e){e=R(e,R.EMPTY_OBJECT),this.mass=R(e.mass,1),this.position=K.clone(R(e.position,K.ZERO)),this.velocity=K.clone(R(e.velocity,K.ZERO)),this.life=R(e.life,Number.MAX_VALUE),this.image=e.image,this.startColor=xy.clone(R(e.startColor,xy.WHITE)),this.endColor=xy.clone(R(e.endColor,xy.WHITE)),this.startScale=R(e.startScale,1),this.endScale=R(e.endScale,1),this.imageSize=ro.clone(R(e.imageSize,g4e)),this._age=0,this._normalizedAge=0,this._billboard=void 0}Object.defineProperties(y4e.prototype,{age:{get:function(){return this._age}},normalizedAge:{get:function(){return this._normalizedAge}}});const v4e=new K;y4e.prototype.update=function(e,t){return K.multiplyByScalar(this.velocity,e,v4e),K.add(this.position,v4e,this.position),C(t)&&t(this,e),this._age+=e,this.life===Number.MAX_VALUE?this._normalizedAge=0:this._normalizedAge=this._age/this.life,this._age<=this.life};var b4e=y4e;function A4e(e){e=R(e,R.EMPTY_OBJECT),this.time=R(e.time,0),this.minimum=R(e.minimum,0),this.maximum=R(e.maximum,50),this._complete=!1}Object.defineProperties(A4e.prototype,{complete:{get:function(){return this._complete}}});function w4e(e){throw new x("This type should not be instantiated directly.  Instead, use BoxEmitter, CircleEmitter, ConeEmitter or SphereEmitter.")}w4e.prototype.emit=function(e){x.throwInstantiationError()};const T4e=new ro(1,1);function C4e(e){e=R(e,R.EMPTY_OBJECT),this.show=R(e.show,!0),this.updateCallback=e.updateCallback,this.loop=R(e.loop,!0),this.image=R(e.image,void 0);let t=e.emitter;C(t)||(t=new KYe(.5)),this._emitter=t,this._bursts=e.bursts,this._modelMatrix=ft.clone(R(e.modelMatrix,ft.IDENTITY)),this._emitterModelMatrix=ft.clone(R(e.emitterModelMatrix,ft.IDENTITY)),this._matrixDirty=!0,this._combinedMatrix=new ft,this._startColor=xy.clone(R(e.color,R(e.startColor,xy.WHITE))),this._endColor=xy.clone(R(e.color,R(e.endColor,xy.WHITE))),this._startScale=R(e.scale,R(e.startScale,1)),this._endScale=R(e.scale,R(e.endScale,1)),this._emissionRate=R(e.emissionRate,5),this._minimumSpeed=R(e.speed,R(e.minimumSpeed,1)),this._maximumSpeed=R(e.speed,R(e.maximumSpeed,1)),this._minimumParticleLife=R(e.particleLife,R(e.minimumParticleLife,5)),this._maximumParticleLife=R(e.particleLife,R(e.maximumParticleLife,5)),this._minimumMass=R(e.mass,R(e.minimumMass,1)),this._maximumMass=R(e.mass,R(e.maximumMass,1)),this._minimumImageSize=ro.clone(R(e.imageSize,R(e.minimumImageSize,T4e))),this._maximumImageSize=ro.clone(R(e.imageSize,R(e.maximumImageSize,T4e))),this._sizeInMeters=R(e.sizeInMeters,!1),this._lifetime=R(e.lifetime,Number.MAX_VALUE),this._billboardCollection=void 0,this._particles=[],this._particlePool=[],this._previousTime=void 0,this._currentTime=0,this._carryOver=0,this._complete=new $n,this._isComplete=!1,this._updateParticlePool=!0,this._particleEstimate=0}function E4e(e){const t=e._emissionRate,n=e._maximumParticleLife;let i=0;const o=e._bursts;if(C(o)){const e=o.length;for(let t=0;t<e;++t)i+=o[t].maximum}const r=e._billboardCollection,s=e.image,a=Math.ceil(t*n+i),c=e._particles,l=e._particlePool,u=Math.max(a-c.length-l.length,0);for(let h=0;h<u;++h){const e=new b4e;e._billboard=r.add({image:s}),l.push(e)}e._particleEstimate=a}function x4e(e){let t=e._particlePool.pop();return C(t)||(t=new b4e),t}function S4e(e,t){e._particlePool.push(t)}function I4e(e){const t=e._particles,n=e._particlePool,i=e._billboardCollection,o=t.length,r=n.length,s=e._particleEstimate,a=r-Math.max(s-o-r,0);for(let c=a;c<r;++c){const e=n[c];i.remove(e._billboard)}n.length=a}function O4e(e){C(e._billboard)&&(e._billboard.show=!1)}function D4e(e,t){let n=t._billboard;C(n)||(n=t._billboard=e._billboardCollection.add({image:t.image})),n.width=t.imageSize.x,n.height=t.imageSize.y,n.position=t.position,n.sizeInMeters=e.sizeInMeters,n.show=!0;const i=z.lerp(t.startColor.red,t.endColor.red,t.normalizedAge),o=z.lerp(t.startColor.green,t.endColor.green,t.normalizedAge),r=z.lerp(t.startColor.blue,t.endColor.blue,t.normalizedAge),s=z.lerp(t.startColor.alpha,t.endColor.alpha,t.normalizedAge);n.color=new xy(i,o,r,s),n.scale=z.lerp(t.startScale,t.endScale,t.normalizedAge)}function P4e(e,t){t.startColor=xy.clone(e._startColor,t.startColor),t.endColor=xy.clone(e._endColor,t.endColor),t.startScale=e._startScale,t.endScale=e._endScale,t.image=e.image,t.life=z.randomBetween(e._minimumParticleLife,e._maximumParticleLife),t.mass=z.randomBetween(e._minimumMass,e._maximumMass),t.imageSize.x=z.randomBetween(e._minimumImageSize.x,e._maximumImageSize.x),t.imageSize.y=z.randomBetween(e._minimumImageSize.y,e._maximumImageSize.y),t._normalizedAge=0,t._age=0;const n=z.randomBetween(e._minimumSpeed,e._maximumSpeed);K.multiplyByScalar(t.velocity,n,t.velocity),e._particles.push(t)}function R4e(e,t){if(e._isComplete)return 0;t=z.mod(t,e._lifetime);const n=t*e._emissionRate;let i=Math.floor(n);if(e._carryOver+=n-i,e._carryOver>1&&(i++,e._carryOver-=1),C(e.bursts)){const t=e.bursts.length;for(let n=0;n<t;n++){const t=e.bursts[n],o=e._currentTime;C(t)&&!t._complete&&o>t.time&&(i+=z.randomBetween(t.minimum,t.maximum),t._complete=!0)}}return i}Object.defineProperties(C4e.prototype,{emitter:{get:function(){return this._emitter},set:function(e){D.defined("value",e),this._emitter=e}},bursts:{get:function(){return this._bursts},set:function(e){this._bursts=e,this._updateParticlePool=!0}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){D.defined("value",e),this._matrixDirty=this._matrixDirty||!ft.equals(this._modelMatrix,e),ft.clone(e,this._modelMatrix)}},emitterModelMatrix:{get:function(){return this._emitterModelMatrix},set:function(e){D.defined("value",e),this._matrixDirty=this._matrixDirty||!ft.equals(this._emitterModelMatrix,e),ft.clone(e,this._emitterModelMatrix)}},startColor:{get:function(){return this._startColor},set:function(e){D.defined("value",e),xy.clone(e,this._startColor)}},endColor:{get:function(){return this._endColor},set:function(e){D.defined("value",e),xy.clone(e,this._endColor)}},startScale:{get:function(){return this._startScale},set:function(e){D.typeOf.number.greaterThanOrEquals("value",e,0),this._startScale=e}},endScale:{get:function(){return this._endScale},set:function(e){D.typeOf.number.greaterThanOrEquals("value",e,0),this._endScale=e}},emissionRate:{get:function(){return this._emissionRate},set:function(e){D.typeOf.number.greaterThanOrEquals("value",e,0),this._emissionRate=e,this._updateParticlePool=!0}},minimumSpeed:{get:function(){return this._minimumSpeed},set:function(e){D.typeOf.number.greaterThanOrEquals("value",e,0),this._minimumSpeed=e}},maximumSpeed:{get:function(){return this._maximumSpeed},set:function(e){D.typeOf.number.greaterThanOrEquals("value",e,0),this._maximumSpeed=e}},minimumParticleLife:{get:function(){return this._minimumParticleLife},set:function(e){D.typeOf.number.greaterThanOrEquals("value",e,0),this._minimumParticleLife=e}},maximumParticleLife:{get:function(){return this._maximumParticleLife},set:function(e){D.typeOf.number.greaterThanOrEquals("value",e,0),this._maximumParticleLife=e,this._updateParticlePool=!0}},minimumMass:{get:function(){return this._minimumMass},set:function(e){D.typeOf.number.greaterThanOrEquals("value",e,0),this._minimumMass=e}},maximumMass:{get:function(){return this._maximumMass},set:function(e){D.typeOf.number.greaterThanOrEquals("value",e,0),this._maximumMass=e}},minimumImageSize:{get:function(){return this._minimumImageSize},set:function(e){D.typeOf.object("value",e),D.typeOf.number.greaterThanOrEquals("value.x",e.x,0),D.typeOf.number.greaterThanOrEquals("value.y",e.y,0),this._minimumImageSize=e}},maximumImageSize:{get:function(){return this._maximumImageSize},set:function(e){D.typeOf.object("value",e),D.typeOf.number.greaterThanOrEquals("value.x",e.x,0),D.typeOf.number.greaterThanOrEquals("value.y",e.y,0),this._maximumImageSize=e}},sizeInMeters:{get:function(){return this._sizeInMeters},set:function(e){D.typeOf.bool("value",e),this._sizeInMeters=e}},lifetime:{get:function(){return this._lifetime},set:function(e){D.typeOf.number.greaterThanOrEquals("value",e,0),this._lifetime=e}},complete:{get:function(){return this._complete}},isComplete:{get:function(){return this._isComplete}}});const L4e=new K;C4e.prototype.update=function(e){if(!this.show)return;C(this._billboardCollection)||(this._billboardCollection=new fse),this._updateParticlePool&&(E4e(this),this._updateParticlePool=!1);let t=0;this._previousTime&&(t=Ea.secondsDifference(e.time,this._previousTime)),t<0&&(t=0);const n=this._particles,i=this._emitter,o=this.updateCallback;let r,s,a=n.length;for(r=0;r<a;++r)s=n[r],s.update(t,o)?D4e(this,s):(O4e(s),S4e(this,s),n[r]=n[a-1],--r,--a);n.length=a;const c=R4e(this,t);if(c>0&&C(i)){this._matrixDirty&&(this._combinedMatrix=ft.multiply(this.modelMatrix,this.emitterModelMatrix,this._combinedMatrix),this._matrixDirty=!1);const e=this._combinedMatrix;for(r=0;r<c;r++)s=x4e(this),this._emitter.emit(s),K.add(s.position,s.velocity,L4e),ft.multiplyByPoint(e,L4e,L4e),s.position=ft.multiplyByPoint(e,s.position,s.position),K.subtract(L4e,s.position,s.velocity),K.normalize(s.velocity,s.velocity),P4e(this,s),D4e(this,s)}if(this._billboardCollection.update(e),this._previousTime=Ea.clone(e.time,this._previousTime),this._currentTime+=t,this._lifetime!==Number.MAX_VALUE&&this._currentTime>this._lifetime)if(this.loop){if(this._currentTime=z.mod(this._currentTime,this._lifetime),this.bursts){const e=this.bursts.length;for(r=0;r<e;r++)this.bursts[r]._complete=!1}}else this._isComplete=!0,this._complete.raiseEvent(this);e.frameNumber%120===0&&I4e(this)},C4e.prototype.isDestroyed=function(){return!1},C4e.prototype.destroy=function(){return this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),Qh(this)};function M4e(e){e=R(e,R.EMPTY_OBJECT);const t=Uke(e.container);if(!C(t))throw new x("container is required");this._container=t;const n=document.createElement("div");n.className="cesium-performanceDisplay";const i=document.createElement("div");i.className="cesium-performanceDisplay-fps",this._fpsText=document.createTextNode(""),i.appendChild(this._fpsText);const o=document.createElement("div");o.className="cesium-performanceDisplay-ms",this._msText=document.createTextNode(""),o.appendChild(this._msText),n.appendChild(o),n.appendChild(i),this._container.appendChild(n),this._lastFpsSampleTime=py(),this._lastMsSampleTime=py(),this._fpsFrameCount=0,this._msFrameCount=0,this._throttled=!1;const r=document.createElement("div");r.className="cesium-performanceDisplay-throttled",this._throttledText=document.createTextNode(""),r.appendChild(this._throttledText),n.appendChild(r)}Object.defineProperties(M4e.prototype,{throttled:{get:function(){return this._throttled},set:function(e){this._throttled!==e&&(this._throttledText.nodeValue=e?"(throttled)":"",this._throttled=e)}}}),M4e.prototype.update=function(e){const t=py(),n=R(e,!0);this._fpsFrameCount++;const i=t-this._lastFpsSampleTime;if(i>1e3){let e="N/A";n&&(e=1e3*this._fpsFrameCount/i|0),this._fpsText.nodeValue=`${e} FPS`,this._lastFpsSampleTime=t,this._fpsFrameCount=0}this._msFrameCount++;const o=t-this._lastMsSampleTime;if(o>200){let e="N/A";n&&(e=(o/this._msFrameCount).toFixed(2)),this._msText.nodeValue=`${e} MS`,this._lastMsSampleTime=t,this._msFrameCount=0}},M4e.prototype.destroy=function(){return Qh(this)};var B4e=M4e;function N4e(){this._framebuffer=new Tie,this._textureToCopy=void 0,this._copyDepthCommand=void 0}function F4e(e,t,n){const i=n.width,o=n.height;e._framebuffer.update(t,i,o)}function z4e(e,t,n){if(!C(e._copyDepthCommand)){const n="uniform highp sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    gl_FragColor = czm_packDepth(texture2D(u_texture, v_textureCoordinates).r);\n}\n";e._copyDepthCommand=t.createViewportQuadCommand(n,{renderState:yV.fromCache(),uniformMap:{u_texture:function(){return e._textureToCopy}},owner:e})}e._textureToCopy=n,e._copyDepthCommand.framebuffer=e.framebuffer}Object.defineProperties(N4e.prototype,{framebuffer:{get:function(){return this._framebuffer.framebuffer}}}),N4e.prototype.update=function(e,t){F4e(this,e,t),z4e(this,e,t)};const k4e=new Xe,U4e=new Xe(1,1/255,1/65025,1/16581375);N4e.prototype.getDepth=function(e,t,n){if(!C(this.framebuffer))return;const i=e.readPixels({x:t,y:n,width:1,height:1,framebuffer:this.framebuffer}),o=Xe.unpack(i,0,k4e);return Xe.divideByScalar(o,255,o),Xe.dot(o,U4e)},N4e.prototype.executeCopyDepth=function(e,t){this._copyDepthCommand.execute(e,t)},N4e.prototype.isDestroyed=function(){return!1},N4e.prototype.destroy=function(){return this._framebuffer.destroy(),C(this._copyDepthCommand)&&(this._copyDepthCommand.shaderProgram=C(this._copyDepthCommand.shaderProgram)&&this._copyDepthCommand.shaderProgram.destroy()),Qh(this)};var V4e=N4e;function H4e(){this._framebuffer=new Tie({color:!1,depthStencil:!0,supportsDepthTexture:!0}),this._passState=void 0}function G4e(e){e._framebuffer.destroy()}function W4e(e,t){const n=t.drawingBufferWidth,i=t.drawingBufferHeight;e._framebuffer.update(t,n,i);const o=new BHe(t);o.blendingEnabled=!1,o.scissorTest={enabled:!0,rectangle:new bf},o.viewport=new bf,e._passState=o}Object.defineProperties(H4e.prototype,{framebuffer:{get:function(){return this._framebuffer.framebuffer}}}),H4e.prototype.update=function(e,t,n){const i=n.width,o=n.height;this._framebuffer.isDirty(i,o)&&W4e(this,e);const r=this.framebuffer,s=this._passState;return s.framebuffer=r,s.viewport.width=i,s.viewport.height=o,s.scissorTest.rectangle.x=t.x,s.scissorTest.rectangle.y=o-t.y,s.scissorTest.rectangle.width=1,s.scissorTest.rectangle.height=1,s},H4e.prototype.isDestroyed=function(){return!1},H4e.prototype.destroy=function(){return G4e(this),Qh(this)};var q4e=H4e;function j4e(e){const t=new BHe(e);t.blendingEnabled=!1,t.scissorTest={enabled:!0,rectangle:new bf},t.viewport=new bf,this._context=e,this._fb=new Tie({depthStencil:!0}),this._passState=t,this._width=0,this._height=0}j4e.prototype.begin=function(e,t){const n=this._context,i=t.width,o=t.height;return bf.clone(e,this._passState.scissorTest.rectangle),this._width=i,this._height=o,this._fb.update(n,i,o),this._passState.framebuffer=this._fb.framebuffer,this._passState.viewport.width=i,this._passState.viewport.height=o,this._passState};const Y4e=new xy;j4e.prototype.end=function(e){const t=R(e.width,1),n=R(e.height,1),i=this._context,o=i.readPixels({x:e.x,y:e.y,width:t,height:n,framebuffer:this._fb.framebuffer}),r=Math.max(t,n),s=r*r,a=Math.floor(.5*t),c=Math.floor(.5*n);let l=0,u=0,h=0,d=-1;for(let f=0;f<s;++f){if(-a<=l&&l<=a&&-c<=u&&u<=c){const e=4*((c-u)*t+l+a);Y4e.red=xy.byteToFloat(o[e]),Y4e.green=xy.byteToFloat(o[e+1]),Y4e.blue=xy.byteToFloat(o[e+2]),Y4e.alpha=xy.byteToFloat(o[e+3]);const n=i.getObjectByPickColor(Y4e);if(C(n))return n}if(l===u||l<0&&-l===u||l>0&&l===1-u){const e=h;h=-d,d=e}l+=h,u+=d}},j4e.prototype.isDestroyed=function(){return!1},j4e.prototype.destroy=function(){return this._fb.destroy(),Qh(this)};var K4e=j4e;function X4e(){this._numSamples=1,this._colorFramebuffer=new Tie({depthStencil:!0,supportsDepthTexture:!0}),this._idFramebuffer=new Tie({depthStencil:!0,supportsDepthTexture:!0}),this._idClearColor=new xy(0,0,0,0),this._clearCommand=new tJ({color:new xy(0,0,0,0),depth:1,owner:this})}function Q4e(e){e._colorFramebuffer.destroy(),e._idFramebuffer.destroy()}Object.defineProperties(X4e.prototype,{framebuffer:{get:function(){return this._colorFramebuffer.framebuffer}},idFramebuffer:{get:function(){return this._idFramebuffer.framebuffer}},depthStencilTexture:{get:function(){return this._colorFramebuffer.getDepthStencilTexture()}}}),X4e.prototype.update=function(e,t,n,i){const o=t.width,r=t.height,s=n?e.halfFloatingPointTexture?hD.HALF_FLOAT:hD.FLOAT:hD.UNSIGNED_BYTE;this._numSamples=i,this._colorFramebuffer.update(e,o,r,i,s),this._idFramebuffer.update(e,o,r)},X4e.prototype.clear=function(e,t,n){xy.clone(n,this._clearCommand.color),xy.clone(this._idClearColor,this._clearCommand.color),this._colorFramebuffer.clear(e,this._clearCommand,t),this._idFramebuffer.clear(e,this._clearCommand,t)},X4e.prototype.getFramebuffer=function(){return this._colorFramebuffer.framebuffer},X4e.prototype.getIdFramebuffer=function(){return this._idFramebuffer.framebuffer},X4e.prototype.prepareColorTextures=function(e){this._numSamples>1&&this._colorFramebuffer.prepareTextures(e)},X4e.prototype.isDestroyed=function(){return!1},X4e.prototype.destroy=function(){return Q4e(this),Qh(this)};var J4e=X4e;function Z4e(){}Z4e.getShadowCastShaderKeyword=function(e,t,n,i){return`castShadow ${e} ${t} ${n} ${i}`},Z4e.createShadowCastVertexShader=function(e,t,n){const i=e.defines.slice(0),o=e.sources.slice(0);i.push("SHADOW_MAP"),n&&i.push("GENERATE_POSITION");const r=tq.findPositionVarying(e),s=C(r);if(t&&!s){const e=o.length;for(let n=0;n<e;++n)o[n]=tq.replaceMain(o[n],"czm_shadow_cast_main");const t="varying vec3 v_positionEC; \nvoid main() \n{ \n    czm_shadow_cast_main(); \n    v_positionEC = (czm_inverseProjection * gl_Position).xyz; \n}";o.push(t)}return new tq({defines:i,sources:o})},Z4e.createShadowCastFragmentShader=function(e,t,n,i){const o=e.defines.slice(0),r=e.sources.slice(0);o.push("SHADOW_MAP");let s=tq.findPositionVarying(e);const a=C(s);a||(s="v_positionEC");const c=r.length;for(let u=0;u<c;++u)r[u]=tq.replaceMain(r[u],"czm_shadow_cast_main");let l="";return t&&(a||(l+="varying vec3 v_positionEC; \n"),l+="uniform vec4 shadowMap_lightPositionEC; \n"),l+=i?"void main() \n{ \n":"void main() \n{ \n    czm_shadow_cast_main(); \n    if (gl_FragColor.a == 0.0) \n    { \n       discard; \n    } \n",l+=t?`    float distance = length(${s}); \n    if (distance >= shadowMap_lightPositionEC.w) \n    { \n        discard; \n    } \n    distance /= shadowMap_lightPositionEC.w; // radius \n    gl_FragColor = czm_packDepth(distance); \n`:n?"    gl_FragColor = vec4(1.0); \n":"    gl_FragColor = czm_packDepth(gl_FragCoord.z); \n",l+="} \n",r.push(l),new tq({defines:o,sources:r})},Z4e.getShadowReceiveShaderKeyword=function(e,t,n,i){const o=e._usesDepthTexture,r=e._polygonOffsetSupported,s=e._isPointLight,a=e._isSpotLight,c=e._numberOfCascades>1,l=e.debugCascadeColors,u=e.softShadows;return`receiveShadow ${o}${r}${s}${a}${c}${l}${u}${t}${n}${i}`},Z4e.createShadowReceiveVertexShader=function(e,t,n){const i=e.defines.slice(0),o=e.sources.slice(0);return i.push("SHADOW_MAP"),t&&(n?i.push("GENERATE_POSITION_AND_NORMAL"):i.push("GENERATE_POSITION")),new tq({defines:i,sources:o})},Z4e.createShadowReceiveFragmentShader=function(e,t,n,i,o){const r=tq.findNormalVarying(e),s=!i&&C(r)||i&&o,a=tq.findPositionVarying(e),c=C(a),l=t._usesDepthTexture,u=t._polygonOffsetSupported,h=t._isPointLight,d=t._isSpotLight,f=t._numberOfCascades>1,p=t.debugCascadeColors,m=t.softShadows,_=h?t._pointBias:i?t._terrainBias:t._primitiveBias,g=e.defines.slice(0),y=e.sources.slice(0),v=y.length;for(let w=0;w<v;++w)y[w]=tq.replaceMain(y[w],"czm_shadow_receive_main");h?g.push("USE_CUBE_MAP_SHADOW"):l&&g.push("USE_SHADOW_DEPTH_TEXTURE"),m&&!h&&g.push("USE_SOFT_SHADOWS"),f&&n&&i&&(s?g.push("ENABLE_VERTEX_LIGHTING"):g.push("ENABLE_DAYNIGHT_SHADING")),n&&_.normalShading&&s&&(g.push("USE_NORMAL_SHADING"),_.normalShadingSmooth>0&&g.push("USE_NORMAL_SHADING_SMOOTH"));let b,A="";return A+=h?"uniform samplerCube shadowMap_textureCube; \n":"uniform sampler2D shadowMap_texture; \n",b=c?`    return vec4(${a}, 1.0); \n`:"#ifndef LOG_DEPTH \n    return czm_windowToEyeCoordinates(gl_FragCoord); \n#else \n    return vec4(v_logPositionEC, 1.0); \n#endif \n",A+=`uniform mat4 shadowMap_matrix; \nuniform vec3 shadowMap_lightDirectionEC; \nuniform vec4 shadowMap_lightPositionEC; \nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \n#ifdef LOG_DEPTH \nvarying vec3 v_logPositionEC; \n#endif \nvec4 getPositionEC() \n{ \n${b}} \nvec3 getNormalEC() \n{ \n${s?`    return normalize(${r}); \n`:"    return vec3(1.0); \n"}} \nvoid applyNormalOffset(inout vec4 positionEC, vec3 normalEC, float nDotL) \n{ \n${_.normalOffset&&s?"    float normalOffset = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.x; \n    float normalOffsetScale = 1.0 - nDotL; \n    vec3 offset = normalOffset * normalOffsetScale * normalEC; \n    positionEC.xyz += offset; \n":""}} \n`,A+="void main() \n{ \n    czm_shadow_receive_main(); \n    vec4 positionEC = getPositionEC(); \n    vec3 normalEC = getNormalEC(); \n    float depth = -positionEC.z; \n",A+="    czm_shadowParameters shadowParameters; \n    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \n    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \n    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \n    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \n",i?A+="    shadowParameters.depthBias *= max(depth * 0.01, 1.0); \n":u||(A+="    shadowParameters.depthBias *= mix(1.0, 100.0, depth * 0.0015); \n"),A+=h?"    vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; \n    float distance = length(directionEC); \n    directionEC = normalize(directionEC); \n    float radius = shadowMap_lightPositionEC.w; \n    // Stop early if the fragment is beyond the point light radius \n    if (distance > radius) \n    { \n        return; \n    } \n    vec3 directionWC  = czm_inverseViewRotation * directionEC; \n    shadowParameters.depth = distance / radius; \n    shadowParameters.nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    shadowParameters.texCoords = directionWC; \n    float visibility = czm_shadowVisibility(shadowMap_textureCube, shadowParameters); \n":d?"    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); \n    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Spot light uses a perspective projection, so perform the perspective divide \n    shadowPosition /= shadowPosition.w; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n":f?"    float maxDepth = shadowMap_cascadeSplits[1].w; \n    // Stop early if the eye depth exceeds the last cascade \n    if (depth > maxDepth) \n    { \n        return; \n    } \n    // Get the cascade based on the eye-space depth \n    vec4 weights = czm_cascadeWeights(depth); \n    // Apply normal offset \n    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    // Transform position into the cascade \n    vec4 shadowPosition = czm_cascadeMatrix(weights) * positionEC; \n    // Get visibility \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n    // Fade out shadows that are far away \n    float shadowMapMaximumDistance = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.z; \n    float fade = max((depth - shadowMapMaximumDistance * 0.8) / (shadowMapMaximumDistance * 0.2), 0.0); \n    visibility = mix(visibility, 1.0, fade); \n"+(p?"    // Draw cascade colors for debugging \n    gl_FragColor *= czm_cascadeColor(weights); \n":""):"    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n",A+="    gl_FragColor.rgb *= visibility; \n} \n",y.push(A),new tq({defines:g,sources:y})};var $4e=Z4e;function e5e(e){e=R(e,R.EMPTY_OBJECT);const t=e.context;if(!C(t))throw new x("context is required.");if(!C(e.lightCamera))throw new x("lightCamera is required.");if(C(e.numberOfCascades)&&1!==e.numberOfCascades&&4!==e.numberOfCascades)throw new x("Only one or four cascades are supported.");this._enabled=R(e.enabled,!0),this._softShadows=R(e.softShadows,!1),this._normalOffset=R(e.normalOffset,!0),this.dirty=!0,this.fromLightSource=R(e.fromLightSource,!0),this.darkness=R(e.darkness,.3),this._darkness=this.darkness,this.fadingEnabled=R(e.fadingEnabled,!0),this.maximumDistance=R(e.maximumDistance,5e3),this._outOfView=!1,this._outOfViewPrevious=!1,this._needsUpdate=!0;let n,i=!0;(Oc.isInternetExplorer()||Oc.isEdge()||(Oc.isChrome()||Oc.isFirefox())&&Oc.isWindows()&&!t.depthTexture)&&(i=!1),this._polygonOffsetSupported=i,this._terrainBias={polygonOffset:i,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.5,normalShading:!0,normalShadingSmooth:.3,depthBias:1e-4},this._primitiveBias={polygonOffset:i,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.1,normalShading:!0,normalShadingSmooth:.05,depthBias:2e-5},this._pointBias={polygonOffset:!1,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:0,normalShading:!0,normalShadingSmooth:.1,depthBias:5e-4},this._depthAttachment=void 0,this._colorAttachment=void 0,this._shadowMapMatrix=new ft,this._shadowMapTexture=void 0,this._lightDirectionEC=new K,this._lightPositionEC=new Xe,this._distance=0,this._lightCamera=e.lightCamera,this._shadowMapCamera=new T5e,this._shadowMapCullingVolume=void 0,this._sceneCamera=void 0,this._boundingSphere=new nn,this._isPointLight=R(e.isPointLight,!1),this._pointLightRadius=R(e.pointLightRadius,100),this._cascadesEnabled=!this._isPointLight&&R(e.cascadesEnabled,!0),this._numberOfCascades=this._cascadesEnabled?R(e.numberOfCascades,4):0,this._fitNearFar=!0,this._maximumCascadeDistances=[25,150,700,Number.MAX_VALUE],this._textureSize=new ro,this._isSpotLight=!1,this._cascadesEnabled?this._shadowMapCamera.frustum=new GC:C(this._lightCamera.frustum.fov)&&(this._isSpotLight=!0),this._cascadeSplits=[new Xe,new Xe],this._cascadeMatrices=[new ft,new ft,new ft,new ft],this._cascadeDistances=new Xe,n=this._isPointLight?6:this._cascadesEnabled?this._numberOfCascades:1,this._passes=new Array(n);for(let o=0;o<n;++o)this._passes[o]=new t5e(t);this.debugShow=!1,this.debugFreezeFrame=!1,this._debugFreezeFrame=!1,this._debugCascadeColors=!1,this._debugLightFrustum=void 0,this._debugCameraFrustum=void 0,this._debugCascadeFrustums=new Array(this._numberOfCascades),this._debugShadowViewCommand=void 0,this._usesDepthTexture=t.depthTexture,this._isPointLight&&(this._usesDepthTexture=!1),this._primitiveRenderState=void 0,this._terrainRenderState=void 0,this._pointRenderState=void 0,i5e(this),this._clearCommand=new tJ({depth:1,color:new xy}),this._clearPassState=new BHe(t),this._size=R(e.size,2048),this.size=this._size}function t5e(e){this.camera=new T5e,this.passState=new BHe(e),this.framebuffer=void 0,this.textureOffsets=void 0,this.commandList=[],this.cullingVolume=void 0}function n5e(e,t){return yV.fromCache({cull:{enabled:!0,face:yk.BACK},depthTest:{enabled:!0},colorMask:{red:e,green:e,blue:e,alpha:e},depthMask:!0,polygonOffset:{enabled:t.polygonOffset,factor:t.polygonOffsetFactor,units:t.polygonOffsetUnits}})}function i5e(e){const t=!e._usesDepthTexture;e._primitiveRenderState=n5e(t,e._primitiveBias),e._terrainRenderState=n5e(t,e._terrainBias),e._pointRenderState=n5e(t,e._pointBias)}function o5e(e){const t=e._passes.length;for(let n=0;n<t;++n){const t=e._passes[n],i=t.framebuffer;C(i)&&!i.isDestroyed()&&i.destroy(),t.framebuffer=void 0}e._depthAttachment=e._depthAttachment&&e._depthAttachment.destroy(),e._colorAttachment=e._colorAttachment&&e._colorAttachment.destroy()}function r5e(e,t){const n=new Aie({context:t,width:e._textureSize.x,height:e._textureSize.y,format:vie.DEPTH_COMPONENT16}),i=new Uk({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:fD.RGBA,pixelDatatype:hD.UNSIGNED_BYTE,sampler:Nk.NEAREST}),o=new mie({context:t,depthRenderbuffer:n,colorTextures:[i],destroyAttachments:!1}),r=e._passes.length;for(let s=0;s<r;++s){const t=e._passes[s];t.framebuffer=o,t.passState.framebuffer=o}e._shadowMapTexture=i,e._depthAttachment=n,e._colorAttachment=i}function s5e(e,t){const n=new Uk({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:fD.DEPTH_STENCIL,pixelDatatype:hD.UNSIGNED_INT_24_8,sampler:Nk.NEAREST}),i=new mie({context:t,depthStencilTexture:n,destroyAttachments:!1}),o=e._passes.length;for(let r=0;r<o;++r){const t=e._passes[r];t.framebuffer=i,t.passState.framebuffer=i}e._shadowMapTexture=n,e._depthAttachment=n}function a5e(e,t){const n=new Aie({context:t,width:e._textureSize.x,height:e._textureSize.y,format:vie.DEPTH_COMPONENT16}),i=new zk({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:fD.RGBA,pixelDatatype:hD.UNSIGNED_BYTE,sampler:Nk.NEAREST}),o=[i.negativeX,i.negativeY,i.negativeZ,i.positiveX,i.positiveY,i.positiveZ];for(let r=0;r<6;++r){const i=new mie({context:t,depthRenderbuffer:n,colorTextures:[o[r]],destroyAttachments:!1}),s=e._passes[r];s.framebuffer=i,s.passState.framebuffer=i}e._shadowMapTexture=i,e._depthAttachment=n,e._colorAttachment=i}function c5e(e,t){e._isPointLight?a5e(e,t):e._usesDepthTexture?s5e(e,t):r5e(e,t)}function l5e(e,t){e._usesDepthTexture&&e._passes[0].framebuffer.status!==th.FRAMEBUFFER_COMPLETE&&(e._usesDepthTexture=!1,i5e(e),o5e(e),c5e(e,t))}function u5e(e,t){C(e._passes[0].framebuffer)&&e._shadowMapTexture.width===e._textureSize.x||(o5e(e),c5e(e,t),l5e(e,t),h5e(e,t))}function h5e(e,t,n){n=R(n,0),(e._isPointLight||0===n)&&(e._clearCommand.framebuffer=e._passes[n].framebuffer,e._clearCommand.execute(t,e._clearPassState))}function d5e(e,t){e._size=t;const n=e._passes,i=n.length,o=e._textureSize;if(e._isPointLight){t=Ck.maximumCubeMapSize>=t?t:Ck.maximumCubeMapSize,o.x=t,o.y=t;const e=new bf(0,0,t,t);n[0].passState.viewport=e,n[1].passState.viewport=e,n[2].passState.viewport=e,n[3].passState.viewport=e,n[4].passState.viewport=e,n[5].passState.viewport=e}else 1===i?(t=Ck.maximumTextureSize>=t?t:Ck.maximumTextureSize,o.x=t,o.y=t,n[0].passState.viewport=new bf(0,0,t,t)):4===i&&(t=Ck.maximumTextureSize>=2*t?t:Ck.maximumTextureSize/2,o.x=2*t,o.y=2*t,n[0].passState.viewport=new bf(0,0,t,t),n[1].passState.viewport=new bf(t,0,t,t),n[2].passState.viewport=new bf(0,t,t,t),n[3].passState.viewport=new bf(t,t,t,t));e._clearPassState.viewport=new bf(0,0,o.x,o.y);for(let r=0;r<i;++r){const e=n[r],t=e.passState.viewport,i=t.x/o.x,s=t.y/o.y,a=t.width/o.x,c=t.height/o.y;e.textureOffsets=new ft(a,0,0,i,0,c,0,s,0,0,1,0,0,0,0,1)}}e5e.MAXIMUM_DISTANCE=2e4,e5e.prototype.debugCreateRenderStates=function(){i5e(this)},Object.defineProperties(e5e.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this.dirty=this._enabled!==e,this._enabled=e}},normalOffset:{get:function(){return this._normalOffset},set:function(e){this.dirty=this._normalOffset!==e,this._normalOffset=e,this._terrainBias.normalOffset=e,this._primitiveBias.normalOffset=e,this._pointBias.normalOffset=e}},softShadows:{get:function(){return this._softShadows},set:function(e){this.dirty=this._softShadows!==e,this._softShadows=e}},size:{get:function(){return this._size},set:function(e){d5e(this,e)}},outOfView:{get:function(){return this._outOfView}},shadowMapCullingVolume:{get:function(){return this._shadowMapCullingVolume}},passes:{get:function(){return this._passes}},isPointLight:{get:function(){return this._isPointLight}},debugCascadeColors:{get:function(){return this._debugCascadeColors},set:function(e){this.dirty=this._debugCascadeColors!==e,this._debugCascadeColors=e}}});const f5e=new bf;function p5e(e,t){let n;n=e._isPointLight?"uniform samplerCube shadowMap_textureCube; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    vec2 uv = v_textureCoordinates; \n    vec3 dir; \n \n    if (uv.y < 0.5) \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = -1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = -1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else \n        { \n            dir.z = -1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 1.0; \n        } \n    } \n    else \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = 1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = 1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else \n        { \n            dir.z = 1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 3.0; \n        } \n    } \n \n    float shadow = czm_unpackDepth(textureCube(shadowMap_textureCube, dir)); \n    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n":`uniform sampler2D shadowMap_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n${e._usesDepthTexture?"    float shadow = texture2D(shadowMap_texture, v_textureCoordinates).r; \n":"    float shadow = czm_unpackDepth(texture2D(shadowMap_texture, v_textureCoordinates)); \n"}    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n`;const i=t.createViewportQuadCommand(n,{uniformMap:{shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture}}});return i.pass=HU.OVERLAY,i}function m5e(e,t){const n=t.context,i=t.context.drawingBufferWidth,o=t.context.drawingBufferHeight,r=.3*Math.min(i,o),s=f5e;s.x=i-r,s.y=0,s.width=r,s.height=r;let a=e._debugShadowViewCommand;C(a)||(a=p5e(e,n),e._debugShadowViewCommand=a),C(a.renderState)&&bf.equals(a.renderState.viewport,s)||(a.renderState=yV.fromCache({viewport:bf.clone(s)})),t.commandList.push(e._debugShadowViewCommand)}const _5e=new Array(8);_5e[0]=new Xe(-1,-1,-1,1),_5e[1]=new Xe(1,-1,-1,1),_5e[2]=new Xe(1,1,-1,1),_5e[3]=new Xe(-1,1,-1,1),_5e[4]=new Xe(-1,-1,1,1),_5e[5]=new Xe(1,-1,1,1),_5e[6]=new Xe(1,1,1,1),_5e[7]=new Xe(-1,1,1,1);const g5e=new ft,y5e=new Array(8);for(let ko=0;ko<8;++ko)y5e[ko]=new Xe;function v5e(e,t){const n=new Sm({geometry:new sp({minimum:new K(-.5,-.5,-.5),maximum:new K(.5,.5,.5)}),attributes:{color:Iy.fromColor(t)}}),i=new Sm({geometry:new bN({radius:.5}),attributes:{color:Iy.fromColor(t)}});return new tY({geometryInstances:[n,i],appearance:new LU({translucent:!1,flat:!0}),asynchronous:!1,modelMatrix:e})}const b5e=[xy.RED,xy.GREEN,xy.BLUE,xy.MAGENTA],A5e=new K;function w5e(e,t){m5e(e,t);const n=e.debugFreezeFrame&&!e._debugFreezeFrame;if(e._debugFreezeFrame=e.debugFreezeFrame,e.debugFreezeFrame&&(n&&(e._debugCameraFrustum=e._debugCameraFrustum&&e._debugCameraFrustum.destroy(),e._debugCameraFrustum=new EXe({camera:e._sceneCamera,color:xy.CYAN,updateOnChange:!1})),e._debugCameraFrustum.update(t)),e._cascadesEnabled){if(e.debugFreezeFrame){n&&(e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=new EXe({camera:e._shadowMapCamera,color:xy.YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t);for(let i=0;i<e._numberOfCascades;++i)n&&(e._debugCascadeFrustums[i]=e._debugCascadeFrustums[i]&&e._debugCascadeFrustums[i].destroy(),e._debugCascadeFrustums[i]=new EXe({camera:e._passes[i].camera,color:b5e[i],updateOnChange:!1})),e._debugCascadeFrustums[i].update(t)}}else if(e._isPointLight){if(!C(e._debugLightFrustum)||e._needsUpdate){const t=e._shadowMapCamera.positionWC,n=il.IDENTITY,i=2*e._pointLightRadius,o=K.fromElements(i,i,i,A5e),r=ft.fromTranslationQuaternionRotationScale(t,n,o,g5e);e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=v5e(r,xy.YELLOW)}e._debugLightFrustum.update(t)}else C(e._debugLightFrustum)&&!e._needsUpdate||(e._debugLightFrustum=new EXe({camera:e._shadowMapCamera,color:xy.YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t)}function T5e(){this.viewMatrix=new ft,this.inverseViewMatrix=new ft,this.frustum=void 0,this.positionCartographic=new se,this.positionWC=new K,this.directionWC=K.clone(K.UNIT_Z),this.upWC=K.clone(K.UNIT_Y),this.rightWC=K.clone(K.UNIT_X),this.viewProjectionMatrix=new ft}T5e.prototype.clone=function(e){ft.clone(e.viewMatrix,this.viewMatrix),ft.clone(e.inverseViewMatrix,this.inverseViewMatrix),this.frustum=e.frustum.clone(this.frustum),se.clone(e.positionCartographic,this.positionCartographic),K.clone(e.positionWC,this.positionWC),K.clone(e.directionWC,this.directionWC),K.clone(e.upWC,this.upWC),K.clone(e.rightWC,this.rightWC)};const C5e=new ft(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);T5e.prototype.getViewProjection=function(){const e=this.viewMatrix,t=this.frustum.projectionMatrix;return ft.multiply(t,e,this.viewProjectionMatrix),ft.multiply(C5e,this.viewProjectionMatrix,this.viewProjectionMatrix),this.viewProjectionMatrix};const E5e=new Array(5),x5e=new nE,S5e=new Array(4),I5e=new K,O5e=new K;function D5e(e,t){const n=e._shadowMapCamera,i=e._sceneCamera,o=i.frustum.near,r=i.frustum.far,s=e._numberOfCascades;let a;const c=r-o,l=r/o;let u=.9,h=!1;t.shadowState.closestObjectSize<200&&(h=!0,u=.9);const d=S5e,f=E5e;for(f[0]=o,f[s]=r,a=0;a<s;++a){const e=(a+1)/s,t=o*Math.pow(l,e),n=o+c*e,i=z.lerp(n,t,u);f[a+1]=i,d[a]=i-f[a]}if(h){for(a=0;a<s;++a)d[a]=Math.min(d[a],e._maximumCascadeDistances[a]);let t=f[0];for(a=0;a<s-1;++a)t+=d[a],f[a+1]=t}Xe.unpack(f,0,e._cascadeSplits[0]),Xe.unpack(f,1,e._cascadeSplits[1]),Xe.unpack(d,0,e._cascadeDistances);const p=n.frustum,m=p.left,_=p.right,g=p.bottom,y=p.top,v=p.near,b=p.far,A=n.positionWC,w=n.directionWC,T=n.upWC,C=i.frustum.clone(x5e),E=n.getViewProjection();for(a=0;a<s;++a){C.near=f[a],C.far=f[a+1];const t=ft.multiply(C.projectionMatrix,i.viewMatrix,g5e),o=ft.inverse(t,g5e),r=ft.multiply(E,o,g5e),s=K.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,I5e),c=K.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,O5e);for(let e=0;e<8;++e){const t=Xe.clone(_5e[e],y5e[e]);ft.multiplyByVector(r,t,t),K.divideByScalar(t,t.w,t),K.minimumByComponent(t,s,s),K.maximumByComponent(t,c,c)}s.x=Math.max(s.x,0),s.y=Math.max(s.y,0),s.z=0,c.x=Math.min(c.x,1),c.y=Math.min(c.y,1),c.z=Math.min(c.z,1);const l=e._passes[a],u=l.camera;u.clone(n);const h=u.frustum;h.left=m+s.x*(_-m),h.right=m+c.x*(_-m),h.bottom=g+s.y*(y-g),h.top=g+c.y*(y-g),h.near=v+s.z*(b-v),h.far=v+c.z*(b-v),l.cullingVolume=u.frustum.computeCullingVolume(A,w,T);const d=e._cascadeMatrices[a];ft.multiply(u.getViewProjection(),i.inverseViewMatrix,d),ft.multiply(l.textureOffsets,d,d)}}const P5e=new ft,R5e=new K,L5e=new K,M5e=new K;function B5e(e,t){const n=e._shadowMapCamera,i=e._sceneCamera,o=ft.multiply(i.frustum.projectionMatrix,i.viewMatrix,g5e),r=ft.inverse(o,g5e),s=n.directionWC;let a=i.directionWC;K.equalsEpsilon(s,a,z.EPSILON10)&&(a=i.upWC);const c=K.cross(s,a,R5e);a=K.cross(c,s,L5e),K.normalize(a,a),K.normalize(c,c);const l=K.fromElements(0,0,0,M5e);let u=ft.computeView(l,s,a,c,P5e);const h=ft.multiply(u,r,g5e),d=K.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,I5e),f=K.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,O5e);for(let b=0;b<8;++b){const e=Xe.clone(_5e[b],y5e[b]);ft.multiplyByVector(h,e,e),K.divideByScalar(e,e.w,e),K.minimumByComponent(e,d,d),K.maximumByComponent(e,f,f)}f.z+=1e3,d.z-=10;const p=M5e;p.x=-.5*(d.x+f.x),p.y=-.5*(d.y+f.y),p.z=-f.z;const m=ft.fromTranslation(p,g5e);u=ft.multiply(m,u,u);const _=.5*(f.x-d.x),g=.5*(f.y-d.y),y=f.z-d.z,v=n.frustum;v.left=-_,v.right=_,v.bottom=-g,v.top=g,v.near=.01,v.far=y,ft.clone(u,n.viewMatrix),ft.inverse(u,n.inverseViewMatrix),ft.getTranslation(n.inverseViewMatrix,n.positionWC),t.mapProjection.ellipsoid.cartesianToCartographic(n.positionWC,n.positionCartographic),K.clone(s,n.directionWC),K.clone(a,n.upWC),K.clone(c,n.rightWC)}const N5e=[new K(-1,0,0),new K(0,-1,0),new K(0,0,-1),new K(1,0,0),new K(0,1,0),new K(0,0,1)],F5e=[new K(0,-1,0),new K(0,0,-1),new K(0,-1,0),new K(0,-1,0),new K(0,0,1),new K(0,-1,0)],z5e=[new K(0,0,1),new K(1,0,0),new K(-1,0,0),new K(0,0,-1),new K(1,0,0),new K(1,0,0)];function k5e(e,t){const n=new nE;n.fov=z.PI_OVER_TWO,n.near=1,n.far=e._pointLightRadius,n.aspectRatio=1;for(let i=0;i<6;++i){const o=e._passes[i].camera;o.positionWC=e._shadowMapCamera.positionWC,o.positionCartographic=t.mapProjection.ellipsoid.cartesianToCartographic(o.positionWC,o.positionCartographic),o.directionWC=N5e[i],o.upWC=F5e[i],o.rightWC=z5e[i],ft.computeView(o.positionWC,o.directionWC,o.upWC,o.rightWC,o.viewMatrix),ft.inverse(o.viewMatrix,o.inverseViewMatrix),o.frustum=n}}const U5e=new K,V5e=new K,H5e=new nn,G5e=H5e.center;function W5e(e,t){const n=e._sceneCamera,i=e._shadowMapCamera,o=H5e;if(e._cascadesEnabled){if(n.frustum.near>=e.maximumDistance)return e._outOfView=!0,void(e._needsUpdate=!1);const o=t.mapProjection.ellipsoid.geodeticSurfaceNormal(n.positionWC,U5e),r=K.negate(i.directionWC,V5e),s=K.dot(o,r);if(e.fadingEnabled){const t=z.clamp(s/.1,0,1);e._darkness=z.lerp(1,e.darkness,t)}else e._darkness=e.darkness;if(s<0)return e._outOfView=!0,void(e._needsUpdate=!1);e._needsUpdate=!0,e._outOfView=!1}else if(e._isPointLight)o.center=i.positionWC,o.radius=e._pointLightRadius,e._outOfView=t.cullingVolume.computeVisibility(o)===Ae.OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(o),nn.clone(o,e._boundingSphere);else{const n=i.frustum.far/2,r=K.add(i.positionWC,K.multiplyByScalar(i.directionWC,n,G5e),G5e);o.center=r,o.radius=n,e._outOfView=t.cullingVolume.computeVisibility(o)===Ae.OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(o),nn.clone(o,e._boundingSphere)}}function q5e(e,t){const n=t.camera,i=e._lightCamera,o=e._sceneCamera,r=e._shadowMapCamera;e._cascadesEnabled?K.clone(i.directionWC,r.directionWC):e._isPointLight?K.clone(i.positionWC,r.positionWC):r.clone(i);const s=e._lightDirectionEC;let a,c;ft.multiplyByPointAsVector(n.viewMatrix,r.directionWC,s),K.normalize(s,s),K.negate(s,s),ft.multiplyByPoint(n.viewMatrix,r.positionWC,e._lightPositionEC),e._lightPositionEC.w=e._pointLightRadius,e._fitNearFar?(a=Math.min(t.shadowState.nearPlane,e.maximumDistance),c=Math.min(t.shadowState.farPlane,e.maximumDistance),c=Math.max(c,a+1)):(a=n.frustum.near,c=e.maximumDistance),e._sceneCamera=TYe.clone(n,o),n.frustum.clone(e._sceneCamera.frustum),e._sceneCamera.frustum.near=a,e._sceneCamera.frustum.far=c,e._distance=c-a,W5e(e,t),!e._outOfViewPrevious&&e._outOfView&&(e._needsUpdate=!0),e._outOfViewPrevious=e._outOfView}e5e.prototype.update=function(e){if(q5e(this,e),this._needsUpdate)if(u5e(this,e.context),this._isPointLight&&k5e(this,e),this._cascadesEnabled&&(B5e(this,e),this._numberOfCascades>1&&D5e(this,e)),this._isPointLight)this._shadowMapCullingVolume=CT.fromBoundingSphere(this._boundingSphere);else{const e=this._shadowMapCamera,t=e.positionWC,n=e.directionWC,i=e.upWC;this._shadowMapCullingVolume=e.frustum.computeCullingVolume(t,n,i),1===this._passes.length&&this._passes[0].camera.clone(e)}if(1===this._passes.length){const e=this._sceneCamera.inverseViewMatrix;ft.multiply(this._shadowMapCamera.getViewProjection(),e,this._shadowMapMatrix)}this.debugShow&&w5e(this,e)},e5e.prototype.updatePass=function(e,t){h5e(this,e,t)};const j5e=new ro;function Y5e(e,t,n){const i=e._isPointLight?e._pointBias:n?e._terrainBias:e._primitiveBias,o={shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture},shadowMap_matrix:function(){return e._shadowMapMatrix},shadowMap_cascadeSplits:function(){return e._cascadeSplits},shadowMap_cascadeMatrices:function(){return e._cascadeMatrices},shadowMap_lightDirectionEC:function(){return e._lightDirectionEC},shadowMap_lightPositionEC:function(){return e._lightPositionEC},shadowMap_cascadeDistances:function(){return e._cascadeDistances},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){const t=j5e;return t.x=1/e._textureSize.x,t.y=1/e._textureSize.y,Xe.fromElements(t.x,t.y,i.depthBias,i.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return Xe.fromElements(i.normalOffsetScale,e._distance,e.maximumDistance,e._darkness,this.combinedUniforms2)},combinedUniforms1:new Xe,combinedUniforms2:new Xe};return _n(t,o,!1)}function K5e(e,t,n,i,o,r){let s,a,c;if(C(r)&&(s=r.shaderProgram,a=r.renderState,c=r.uniformMap),r=UU.shallowClone(n,r),r.castShadows=!0,r.receiveShadows=!1,!C(s)||o!==n.shaderProgram.id||t){const t=n.shaderProgram,o=n.pass===HU.GLOBE,r=n.pass!==HU.TRANSLUCENT,l=e._isPointLight,u=e._usesDepthTexture,h=$4e.getShadowCastShaderKeyword(l,o,u,r);if(s=i.shaderCache.getDerivedShaderProgram(t,h),!C(s)){const e=t.vertexShaderSource,n=t.fragmentShaderSource,a=$4e.createShadowCastVertexShader(e,l,o),c=$4e.createShadowCastFragmentShader(n,l,u,r);s=i.shaderCache.createDerivedShaderProgram(t,h,{vertexShaderSource:a,fragmentShaderSource:c,attributeLocations:t._attributeLocations})}a=e._primitiveRenderState,l?a=e._pointRenderState:o&&(a=e._terrainRenderState);const d=n.renderState.cull.enabled;d||(a=pn(a,!1),a.cull=pn(a.cull,!1),a.cull.enabled=!1,a=yV.fromCache(a)),c=Y5e(e,n.uniformMap,o)}return r.shaderProgram=s,r.renderState=a,r.uniformMap=c,r}e5e.createReceiveDerivedCommand=function(e,t,n,i,o){C(o)||(o={});const r=e.length>0,s=t.shaderProgram,a=s.vertexShaderSource,c=s.fragmentShaderSource,l=t.pass===HU.GLOBE;let u=!1;if(l&&(u=t.owner.data.renderedMesh.encoding.hasVertexNormals),t.receiveShadows&&r){let r,h;C(o.receiveCommand)&&(r=o.receiveCommand.shaderProgram,h=o.receiveCommand.uniformMap),o.receiveCommand=UU.shallowClone(t,o.receiveCommand),o.castShadows=!1,o.receiveShadows=!0;const d=o.receiveShaderCastShadows!==t.castShadows,f=o.receiveShaderProgramId!==t.shaderProgram.id;if(!C(r)||f||n||d){const n=$4e.getShadowReceiveShaderKeyword(e[0],t.castShadows,l,u);if(r=i.shaderCache.getDerivedShaderProgram(s,n),!C(r)){const o=$4e.createShadowReceiveVertexShader(a,l,u),h=$4e.createShadowReceiveFragmentShader(c,e[0],t.castShadows,l,u);r=i.shaderCache.createDerivedShaderProgram(s,n,{vertexShaderSource:o,fragmentShaderSource:h,attributeLocations:s._attributeLocations})}h=Y5e(e[0],t.uniformMap,l)}o.receiveCommand.shaderProgram=r,o.receiveCommand.uniformMap=h,o.receiveShaderProgramId=t.shaderProgram.id,o.receiveShaderCastShadows=t.castShadows}return o},e5e.createCastDerivedCommand=function(e,t,n,i,o){if(C(o)||(o={}),t.castShadows){let r=o.castCommands;C(r)||(r=o.castCommands=[]);const s=o.castShaderProgramId,a=e.length;r.length=a;for(let o=0;o<a;++o)r[o]=K5e(e[o],n,t,i,s,r[o]);o.castShaderProgramId=t.shaderProgram.id}return o},e5e.prototype.isDestroyed=function(){return!1},e5e.prototype.destroy=function(){o5e(this),this._debugLightFrustum=this._debugLightFrustum&&this._debugLightFrustum.destroy(),this._debugCameraFrustum=this._debugCameraFrustum&&this._debugCameraFrustum.destroy(),this._debugShadowViewCommand=this._debugShadowViewCommand&&this._debugShadowViewCommand.shaderProgram&&this._debugShadowViewCommand.shaderProgram.destroy();for(let e=0;e<this._numberOfCascades;++e)this._debugCascadeFrustums[e]=this._debugCascadeFrustums[e]&&this._debugCascadeFrustums[e].destroy();return Qh(this)};var X5e=e5e,Q5e="uniform sampler2D u_opaqueDepthTexture;\nuniform sampler2D u_translucentDepthTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    float opaqueDepth = texture2D(u_opaqueDepthTexture, v_textureCoordinates).r;\n    float translucentDepth = texture2D(u_translucentDepthTexture, v_textureCoordinates).r;\n    translucentDepth = czm_branchFreeTernary(translucentDepth > opaqueDepth, 1.0, translucentDepth);\n    gl_FragColor = czm_packDepth(translucentDepth);\n}\n",J5e="uniform sampler2D colorTexture;\n\n#ifdef DEBUG_SHOW_DEPTH\nuniform sampler2D u_packedTranslucentDepth;\n#endif\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n#ifdef DEBUG_SHOW_DEPTH\n    if (v_textureCoordinates.x < 0.5)\n    {\n        gl_FragColor.rgb = vec3(czm_unpackDepth(texture2D(u_packedTranslucentDepth, v_textureCoordinates)));\n        gl_FragColor.a = 1.0;\n    }\n#else\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n\n#ifdef PICK\n    if (color == vec4(0.0))\n    {\n        discard;\n    }\n#else\n    // Reverse premultiplication process to get the correct composited result of the classification primitives\n    color.rgb /= color.a;\n#endif\n    gl_FragColor = color;\n#endif\n}\n";const Z5e=!1;function $5e(e){this._drawClassificationFBO=new Tie({createDepthAttachments:!1}),this._accumulationFBO=new Tie({createDepthAttachments:!1}),this._packFBO=new Tie,this._opaqueDepthStencilTexture=void 0,this._textureToComposite=void 0,this._translucentDepthStencilTexture=void 0,this._packDepthCommand=void 0,this._accumulateCommand=void 0,this._compositeCommand=void 0,this._copyCommand=void 0,this._clearColorCommand=new tJ({color:new xy(0,0,0,0),owner:this}),this._clearDepthStencilCommand=new tJ({depth:1,stencil:0,owner:this}),this._supported=e.depthTexture,this._viewport=new bf,this._rsDepth=void 0,this._rsAccumulate=void 0,this._rsComp=void 0,this._useScissorTest=void 0,this._scissorRectangle=void 0,this._hasTranslucentDepth=!1,this._frustumsDrawn=0}function e6e(e){e._textureToComposite=void 0,e._translucentDepthStencilTexture=e._translucentDepthStencilTexture&&!e._translucentDepthStencilTexture.isDestroyed()&&e._translucentDepthStencilTexture.destroy()}function t6e(e){e._drawClassificationFBO.destroy(),e._accumulationFBO.destroy(),e._packFBO.destroy()}function n6e(e,t,n,i){e6e(e),e._translucentDepthStencilTexture=new Uk({context:t,width:n,height:i,pixelFormat:fD.DEPTH_STENCIL,pixelDatatype:hD.UNSIGNED_INT_24_8,sampler:Nk.NEAREST})}function i6e(e,t,n,i){t6e(e),e._drawClassificationFBO.setDepthStencilTexture(e._translucentDepthStencilTexture),e._drawClassificationFBO.update(t,n,i),e._accumulationFBO.setDepthStencilTexture(e._translucentDepthStencilTexture),e._accumulationFBO.update(t,n,i),e._packFBO.update(t,n,i)}function o6e(e,t,n,i){if(!e.isSupported())return;e._opaqueDepthStencilTexture=i;const o=e._opaqueDepthStencilTexture.width,r=e._opaqueDepthStencilTexture.height;let s,a;if(e._drawClassificationFBO.isDirty(o,r)&&(n6e(e,t,o,r),i6e(e,t,o,r)),C(e._packDepthCommand)||(s=new tq({sources:[Q5e]}),a={u_opaqueDepthTexture:function(){return e._opaqueDepthStencilTexture},u_translucentDepthTexture:function(){return e._translucentDepthStencilTexture}},e._packDepthCommand=t.createViewportQuadCommand(s,{uniformMap:a,owner:e})),!C(e._compositeCommand)){s=new tq({sources:[J5e]}),a={colorTexture:function(){return e._textureToComposite}},Z5e&&(s.defines=["DEBUG_SHOW_DEPTH"],a.u_packedTranslucentDepth=function(){return e._packFBO.getColorTexture()}),e._compositeCommand=t.createViewportQuadCommand(s,{uniformMap:a,owner:e});const n=e._compositeCommand,i=n.shaderProgram,o=t.shaderCache.createDerivedShaderProgram(i,"pick",{vertexShaderSource:i.vertexShaderSource,fragmentShaderSource:new tq({sources:s.sources,defines:["PICK"]}),attributeLocations:i._attributeLocations}),r=UU.shallowClone(n);r.shaderProgram=o,n.derivedCommands.pick=r}C(e._copyCommand)||(s=new tq({sources:[J5e]}),a={colorTexture:function(){return e._drawClassificationFBO.getColorTexture()}},e._copyCommand=t.createViewportQuadCommand(s,{uniformMap:a,owner:e})),C(e._accumulateCommand)||(s=new tq({sources:[J5e]}),a={colorTexture:function(){return e._drawClassificationFBO.getColorTexture()}},e._accumulateCommand=t.createViewportQuadCommand(s,{uniformMap:a,owner:e})),e._viewport.width=o,e._viewport.height=r;const c=!bf.equals(e._viewport,n.viewport);let l=c!==e._useScissorTest;e._useScissorTest=c,bf.equals(e._scissorRectangle,n.viewport)||(e._scissorRectangle=bf.clone(n.viewport,e._scissorRectangle),l=!0),C(e._rsDepth)&&bf.equals(e._viewport,e._rsDepth.viewport)&&!l||(e._rsDepth=yV.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}})),C(e._packDepthCommand)&&(e._packDepthCommand.renderState=e._rsDepth),C(e._rsAccumulate)&&bf.equals(e._viewport,e._rsAccumulate.viewport)&&!l||(e._rsAccumulate=yV.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},stencilTest:{enabled:!0,frontFunction:LY.EQUAL,reference:FY.CESIUM_3D_TILE_MASK}})),C(e._accumulateCommand)&&(e._accumulateCommand.renderState=e._rsAccumulate),C(e._rsComp)&&bf.equals(e._viewport,e._rsComp.viewport)&&!l||(e._rsComp=yV.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},blending:_k.ALPHA_BLEND})),C(e._compositeCommand)&&(e._compositeCommand.renderState=e._rsComp,e._compositeCommand.derivedCommands.pick.renderState=e._rsComp)}function r6e(e,t,n){if(!e._hasTranslucentDepth)return;const i=n.framebuffer;n.framebuffer=e._drawClassificationFBO.framebuffer,e._clearColorCommand.execute(t._context,n),n.framebuffer=i,e._frustumsDrawn>1&&(n.framebuffer=e._accumulationFBO.framebuffer,e._clearColorCommand.execute(t._context,n)),e._hasTranslucentDepth=!1,e._frustumsDrawn=0}Object.defineProperties($5e.prototype,{hasTranslucentDepth:{get:function(){return this._hasTranslucentDepth}}}),$5e.prototype.executeTranslucentCommands=function(e,t,n,i,o){const r=i.length;let s,a;const c=e.frameState.useLogDepth,l=e.context,u=n.framebuffer;for(a=0;a<r;++a)if(s=i[a],s=c?s.derivedCommands.logDepth.command:s,s.depthForTranslucentClassification){this._hasTranslucentDepth=!0;break}if(this._hasTranslucentDepth){for(o6e(this,l,n,o),n.framebuffer=this._drawClassificationFBO.framebuffer,this._clearDepthStencilCommand.execute(l,n),a=0;a<r;++a){if(s=i[a],s=c?s.derivedCommands.logDepth.command:s,!s.depthForTranslucentClassification)continue;const o=s.derivedCommands.depth.depthOnlyCommand;t(o,e,l,n)}this._frustumsDrawn+=this._hasTranslucentDepth?1:0,this._hasTranslucentDepth&&(n.framebuffer=this._packFBO.framebuffer,this._packDepthCommand.execute(l,n)),n.framebuffer=u}},$5e.prototype.executeClassificationCommands=function(e,t,n,i){if(!this._hasTranslucentDepth)return;const o=e.context,r=o.uniformState,s=n.framebuffer;2===this._frustumsDrawn&&(n.framebuffer=this._accumulationFBO.framebuffer,this._copyCommand.execute(o,n)),n.framebuffer=this._drawClassificationFBO.framebuffer,this._frustumsDrawn>1&&this._clearColorCommand.execute(o,n),r.updatePass(HU.CESIUM_3D_TILE_CLASSIFICATION);const a=r.globeDepthTexture;r.globeDepthTexture=this._packFBO.getColorTexture();const c=i.commands[HU.CESIUM_3D_TILE_CLASSIFICATION],l=i.indices[HU.CESIUM_3D_TILE_CLASSIFICATION];for(let u=0;u<l;++u)t(c[u],e,o,n);r.globeDepthTexture=a,n.framebuffer=s,1!==this._frustumsDrawn&&(n.framebuffer=this._accumulationFBO.framebuffer,this._accumulateCommand.execute(o,n),n.framebuffer=s)},$5e.prototype.execute=function(e,t){if(!this._hasTranslucentDepth)return;1===this._frustumsDrawn?this._textureToComposite=this._drawClassificationFBO.getColorTexture():this._textureToComposite=this._accumulationFBO.getColorTexture();const n=e.frameState.passes.pick?this._compositeCommand.derivedCommands.pick:this._compositeCommand;n.execute(e.context,t),r6e(this,e,t)},$5e.prototype.isSupported=function(){return this._supported},$5e.prototype.isDestroyed=function(){return!1},$5e.prototype.destroy=function(){return e6e(this),t6e(this),C(this._compositeCommand)&&(this._compositeCommand.shaderProgram=this._compositeCommand.shaderProgram&&this._compositeCommand.shaderProgram.destroy()),C(this._packDepthCommand)&&(this._packDepthCommand.shaderProgram=this._packDepthCommand.shaderProgram&&this._packDepthCommand.shaderProgram.destroy()),Qh(this)};var s6e=$5e;function a6e(){this.command=void 0,this.near=void 0,this.far=void 0}function c6e(e,t,n){const i=e.context;let o,r;i.depthTexture&&(o=new z0e),e._useOIT&&i.depthTexture&&(r=new f4e(i));const s=new BHe(i);s.viewport=bf.clone(n),this.camera=t,this._cameraClone=TYe.clone(t),this._cameraStartFired=!1,this._cameraMovedTime=void 0,this.viewport=n,this.passState=s,this.pickFramebuffer=new K4e(i),this.pickDepthFramebuffer=new q4e,this.sceneFramebuffer=new J4e,this.globeDepth=o,this.globeTranslucencyFramebuffer=new G0e,this.oit=r,this.translucentTileClassification=new s6e(i),this.pickDepths=[],this.frustumCommandsList=[],this.debugFrustumStatistics=void 0,this._commandExtents=[]}const l6e=new K,u6e=new K;function h6e(e,t){const n=Math.max(Math.abs(e.x),Math.abs(t.x)),i=Math.max(Math.abs(e.y),Math.abs(t.y)),o=Math.max(Math.abs(e.z),Math.abs(t.z));return Math.max(Math.max(n,i),o)}function d6e(e,t,n){const i=1/Math.max(1,h6e(e.position,t.position));return K.multiplyByScalar(e.position,i,l6e),K.multiplyByScalar(t.position,i,u6e),K.equalsEpsilon(l6e,u6e,n)&&K.equalsEpsilon(e.direction,t.direction,n)&&K.equalsEpsilon(e.up,t.up,n)&&K.equalsEpsilon(e.right,t.right,n)&&ft.equalsEpsilon(e.transform,t.transform,n)&&e.frustum.equalsEpsilon(t.frustum,n)}function f6e(e,t,n,i){const o=t.frameState,r=o.camera,s=o.useLogDepth?t.logarithmicDepthFarToNearRatio:t.farToNearRatio,a=t.mode===ij.SCENE2D,c=t.nearToFarDistance2D;let l;i*=1+z.EPSILON2,n=Math.min(Math.max(n,r.frustum.near),r.frustum.far),i=Math.max(Math.min(i,r.frustum.far),n),a?(i=Math.min(i,r.position.z+t.nearToFarDistance2D),n=Math.min(n,i),l=Math.ceil(Math.max(1,i-n)/t.nearToFarDistance2D)):l=Math.ceil(Math.log(i/n)/Math.log(s));const u=e.frustumCommandsList;u.length=l;for(let h=0;h<l;++h){let e,t;a?(e=Math.min(i-c,n+h*c),t=Math.min(i,e+c)):(e=Math.max(n,Math.pow(s,h)*n),t=Math.min(i,s*e));let o=u[h];C(o)?(o.near=e,o.far=t):o=u[h]=new FQe(e,t)}}function p6e(e,t,n,i,o){t.debugShowFrustums&&(n.debugOverlappingFrustums=0);const r=e.frustumCommandsList,s=r.length;for(let a=0;a<s;++a){const e=r[a],s=e.near,c=e.far;if(i>c)continue;if(o<s)break;const l=n.pass,u=e.indices[l]++;if(e.commands[l][u]=n,t.debugShowFrustums&&(n.debugOverlappingFrustums|=1<<a),n.executeInClosestFrustum)break}if(t.debugShowFrustums){const t=e.debugFrustumStatistics.commandsInFrustums;t[n.debugOverlappingFrustums]=C(t[n.debugOverlappingFrustums])?t[n.debugOverlappingFrustums]+1:1,++e.debugFrustumStatistics.totalCommands}t.updateDerivedCommands(n)}c6e.prototype.checkForCameraUpdates=function(e){const t=this.camera,n=this._cameraClone;return d6e(t,n,z.EPSILON15)?(this._cameraStartFired&&py()-this._cameraMovedTime>e.cameraEventWaitTime&&(t.moveEnd.raiseEvent(),this._cameraStartFired=!1),!1):(this._cameraStartFired||(t.moveStart.raiseEvent(),this._cameraStartFired=!0),this._cameraMovedTime=py(),TYe.clone(t,n),!0)};const m6e=new CT,_6e=new Te;c6e.prototype.createPotentiallyVisibleSet=function(e){const t=e.frameState,n=t.camera,i=n.directionWC,o=n.positionWC,r=e._computeCommandList,s=e._overlayCommandList,a=t.commandList;e.debugShowFrustums&&(this.debugFrustumStatistics={totalCommands:0,commandsInFrustums:{}});const c=this.frustumCommandsList,l=c.length,u=HU.NUMBER_OF_PASSES;for(let C=0;C<l;++C)for(let e=0;e<u;++e)c[C].indices[e]=0;r.length=0,s.length=0;const h=this._commandExtents,d=h.length;let f=0,p=+Number.MAX_VALUE,m=-Number.MAX_VALUE;const _=t.shadowState.shadowsEnabled;let g=+Number.MAX_VALUE,y=-Number.MAX_VALUE,v=Number.MAX_VALUE;const b=t.mode===ij.SCENE3D?t.occluder:void 0;let A=t.cullingVolume;const w=m6e.planes;for(let C=0;C<5;++C)w[C]=A.planes[C];A=m6e;const T=a.length;for(let O=0;O<T;++O){const t=a[O],c=t.pass;if(c===HU.COMPUTE)r.push(t);else if(c===HU.OVERLAY)s.push(t);else{let r,s;const a=t.boundingVolume;if(C(a)){if(!e.isVisible(t,A,b))continue;const n=a.computePlaneDistances(o,i,_6e);if(r=n.start,s=n.stop,p=Math.min(p,r),m=Math.max(m,s),_&&t.receiveShadows&&r<X5e.MAXIMUM_DISTANCE&&!(c===HU.GLOBE&&r<-100&&s>100)){const e=s-r;c!==HU.GLOBE&&r<100&&(v=Math.min(v,e)),g=Math.min(g,r),y=Math.max(y,s)}}else t instanceof tJ?(r=n.frustum.near,s=n.frustum.far):(r=n.frustum.near,s=n.frustum.far,p=Math.min(p,r),m=Math.max(m,s));let l=h[f];C(l)||(l=h[f]=new a6e),l.command=t,l.near=r,l.far=s,f++}}let E,x;for(_&&(g=Math.min(Math.max(g,n.frustum.near),n.frustum.far),y=Math.max(Math.min(y,n.frustum.far),g)),_&&(t.shadowState.nearPlane=g,t.shadowState.farPlane=y,t.shadowState.closestObjectSize=v),f6e(this,e,p,m),E=0;E<f;E++)x=h[E],p6e(this,e,x.command,x.near,x.far);if(f<d)for(E=f;E<d;E++){if(x=h[E],!C(x.command))break;x.command=void 0}const S=c.length,I=t.frustumSplits;I.length=S+1;for(let C=0;C<S;++C)I[C]=c[C].near,C===S-1&&(I[C+1]=c[C].far)},c6e.prototype.destroy=function(){let e;this.pickFramebuffer=this.pickFramebuffer&&this.pickFramebuffer.destroy(),this.pickDepthFramebuffer=this.pickDepthFramebuffer&&this.pickDepthFramebuffer.destroy(),this.sceneFramebuffer=this.sceneFramebuffer&&this.sceneFramebuffer.destroy(),this.globeDepth=this.globeDepth&&this.globeDepth.destroy(),this.oit=this.oit&&this.oit.destroy(),this.translucentTileClassification=this.translucentTileClassification&&this.translucentTileClassification.destroy(),this.globeTranslucencyFramebuffer=this.globeTranslucencyFramebuffer&&this.globeTranslucencyFramebuffer.destroy();const t=this.pickDepths,n=t.length;for(e=0;e<n;++e)t[e].destroy()};var g6e=c6e;const y6e=.1,v6e=new FYe({pass:ige.MOST_DETAILED_PRELOAD}),b6e=new FYe({pass:ige.MOST_DETAILED_PICK}),A6e=new FYe({pass:ige.PICK});function w6e(e){this._mostDetailedRayPicks=[],this.pickRenderStateCache={},this._pickPositionCache={},this._pickPositionCacheDirty=!1;const t=new bf(0,0,1,1),n=new TYe(e);n.frustum=new jC({width:y6e,aspectRatio:1,near:.1}),this._pickOffscreenView=new g6e(e,n,t)}w6e.prototype.update=function(){this._pickPositionCacheDirty=!0},w6e.prototype.getPickDepth=function(e,t){const n=e.view.pickDepths;let i=n[t];return C(i)||(i=new V4e,n[t]=i),i};const T6e=new GC,C6e=new K,E6e=new K,x6e=new ro,S6e=new ft;function I6e(e,t,n,i,o){const r=e.camera;let s=r.frustum;C(s._offCenterFrustum)&&(s=s._offCenterFrustum);let a=2*(t.x-o.x)/o.width-1;a*=.5*(s.right-s.left);let c=2*(o.height-t.y-o.y)/o.height-1;c*=.5*(s.top-s.bottom);const l=ft.clone(r.transform,S6e);r._setTransform(ft.IDENTITY);const u=K.clone(r.position,C6e);K.multiplyByScalar(r.right,a,E6e),K.add(E6e,u,u),K.multiplyByScalar(r.up,c,E6e),K.add(E6e,u,u),r._setTransform(l),e.mode===ij.SCENE2D&&K.fromElements(u.z,u.x,u.y,u);const h=s.getPixelDimensions(o.width,o.height,1,1,x6e),d=T6e;return d.right=.5*h.x,d.left=-d.right,d.top=.5*h.y,d.bottom=-d.top,d.near=s.near,d.far=s.far,d.computeCullingVolume(u,r.directionWC,r.upWC)}const O6e=new $C,D6e=new ro;function P6e(e,t,n,i,o){const r=e.camera,s=r.frustum,a=s.near,c=Math.tan(.5*s.fovy),l=s.aspectRatio*c,u=2*(t.x-o.x)/o.width-1,h=2*(o.height-t.y-o.y)/o.height-1,d=u*a*l,f=h*a*c,p=s.getPixelDimensions(o.width,o.height,1,1,D6e),m=p.x*n*.5,_=p.y*i*.5,g=O6e;return g.top=f+_,g.bottom=f-_,g.right=d+m,g.left=d-m,g.near=a,g.far=s.far,g.computeCullingVolume(r.positionWC,r.directionWC,r.upWC)}function R6e(e,t,n,i,o){const r=e.camera.frustum;return r instanceof jC||r instanceof GC?I6e(e,t,n,i,o):P6e(e,t,n,i,o)}let L6e=3,M6e=3,B6e=new bf(0,0,L6e,M6e);const N6e=new ro,F6e=new xy(0,0,0,0);function z6e(e,t){const n=e.context,i=e.frameState,o=e.environmentState,r=e.defaultView;e.view=r;const s=r.viewport;s.x=0,s.y=0,s.width=n.drawingBufferWidth,s.height=n.drawingBufferHeight;let a=r.passState;a.viewport=bf.clone(s,a.viewport),e.clearPasses(i.passes),i.passes.pick=!0,i.passes.depth=!0,i.cullingVolume=R6e(e,t,1,1,s),i.tilesetPassState=A6e,e.updateEnvironment(),o.renderTranslucentDepthForPick=!0,a=r.pickDepthFramebuffer.update(n,t,s),e.updateAndExecuteCommands(a,F6e),e.resolveFramebuffers(a),n.endFrame()}w6e.prototype.pick=function(e,t,n,i){if(!C(t))throw new x("windowPosition is undefined.");L6e=R(n,3),M6e=R(i,L6e);const o=e.context,r=o.uniformState,s=e.frameState,a=e.defaultView;e.view=a;const c=a.viewport;c.x=0,c.y=0,c.width=o.drawingBufferWidth,c.height=o.drawingBufferHeight;let l=a.passState;l.viewport=bf.clone(c,l.viewport);const u=Aoe.transformWindowToDrawingBuffer(e,t,N6e);e.jobScheduler.disableThisFrame(),e.updateFrameState(),s.cullingVolume=R6e(e,u,L6e,M6e,c),s.invertClassification=!1,s.passes.pick=!0,s.tilesetPassState=A6e,r.update(s),e.updateEnvironment(),B6e.x=u.x-.5*(L6e-1),B6e.y=e.drawingBufferHeight-u.y-.5*(M6e-1),B6e.width=L6e,B6e.height=M6e,l=a.pickFramebuffer.begin(B6e,a.viewport),e.updateAndExecuteCommands(l,F6e),e.resolveFramebuffers(l);const h=a.pickFramebuffer.end(B6e);return o.endFrame(),h};const k6e=new nE,U6e=new $C,V6e=new jC,H6e=new GC;w6e.prototype.pickPositionWorldCoordinates=function(e,t,n){if(!e.useDepthPicking)return;if(!C(t))throw new x("windowPosition is undefined.");if(!e.context.depthTexture)throw new x("Picking from the depth buffer is not supported. Check pickPositionSupported.");const i=t.toString();if(this._pickPositionCacheDirty)this._pickPositionCache={},this._pickPositionCacheDirty=!1;else if(this._pickPositionCache.hasOwnProperty(i))return K.clone(this._pickPositionCache[i],n);const o=e.frameState,r=e.context,s=r.uniformState,a=e.defaultView;e.view=a;const c=Aoe.transformWindowToDrawingBuffer(e,t,N6e);e.pickTranslucentDepth?z6e(e,c):(e.updateFrameState(),s.update(o),e.updateEnvironment()),c.y=e.drawingBufferHeight-c.y;const l=e.camera;let u;u=C(l.frustum.fov)?l.frustum.clone(k6e):C(l.frustum.infiniteProjectionMatrix)?l.frustum.clone(U6e):C(l.frustum.width)?l.frustum.clone(V6e):l.frustum.clone(H6e);const h=a.frustumCommandsList,d=h.length;for(let f=0;f<d;++f){const t=this.getPickDepth(e,f),a=t.getDepth(r,c.x,c.y);if(C(a)&&(a>0&&a<1)){const t=h[f];let r;return e.mode===ij.SCENE2D?(r=l.position.z,l.position.z=r-t.near+1,u.far=Math.max(1,t.far-t.near),u.near=1,s.update(o),s.updateFrustum(u)):(u.near=t.near*(0!==f?e.opaqueFrustumNearOffset:1),u.far=t.far,s.updateFrustum(u)),n=Aoe.drawingBufferToWgs84Coordinates(e,c,a,n),e.mode===ij.SCENE2D&&(l.position.z=r,s.update(o)),this._pickPositionCache[i]=K.clone(n),n}}this._pickPositionCache[i]=void 0};const G6e=new se;function W6e(e,t){let n,i;const o=[],r=[],s=[],a=[];C(e)||(e=Number.MAX_VALUE);let c=t();while(C(c)){const n=c.object,l=c.position,u=c.exclude;if(C(l)&&!C(n)){o.push(c);break}if(!C(n)||!C(n.primitive))break;if(!u&&(o.push(c),0>=--e))break;const h=n.primitive;let d=!1;"function"===typeof h.getGeometryInstanceAttributes&&C(n.id)&&(i=h.getGeometryInstanceAttributes(n.id),C(i)&&C(i.show)&&(d=!0,i.show=FM.toValue(!1,i.show),s.push(i))),n instanceof hZ&&(d=!0,n.show=!1,a.push(n)),d||(h.show=!1,r.push(h)),c=t()}for(n=0;n<r.length;++n)r[n].show=!0;for(n=0;n<s.length;++n)i=s[n],i.show=FM.toValue(!0,i.show);for(n=0;n<a.length;++n)a[n].show=!0;return o}w6e.prototype.pickPosition=function(e,t,n){if(n=this.pickPositionWorldCoordinates(e,t,n),C(n)&&e.mode!==ij.SCENE3D){K.fromElements(n.y,n.z,n.x,n);const t=e.mapProjection,i=t.ellipsoid,o=t.unproject(n,G6e);i.cartographicToCartesian(o,n)}return n},w6e.prototype.drillPick=function(e,t,n,i,o){const r=this,s=function(){const n=r.pick(e,t,i,o);if(C(n))return{object:n,position:void 0,exclude:!1}},a=W6e(n,s);return a.map((function(e){return e.object}))};const q6e=new K,j6e=new K;function Y6e(e,t,n){this.ray=e,this.width=t,this.tilesets=n,this.ready=!1,this.deferred=yn(),this.promise=this.deferred.promise}function K6e(e,t,n,i){const o=t.direction,r=K.mostOrthogonalAxis(o,q6e),s=K.cross(o,r,q6e),a=K.cross(o,s,j6e);return i.position=t.origin,i.direction=o,i.up=a,i.right=s,i.frustum.width=R(n,y6e),i.frustum.computeCullingVolume(i.positionWC,i.directionWC,i.upWC)}function X6e(e,t,n){const i=t.frameState,o=n.ray,r=n.width,s=n.tilesets,a=e._pickOffscreenView.camera,c=K6e(e,o,r,a),l=v6e;l.camera=a,l.cullingVolume=c;let u=!0;const h=s.length;for(let d=0;d<h;++d){const e=s[d];e.show&&t.primitives.contains(e)&&(e.updateForPass(i,l),u=u&&l.ready)}return u&&n.deferred.resolve(),u}function Q6e(e,t,n){const i=e.length;for(let o=0;o<i;++o){const i=e.get(o);i.show&&(C(i.isCesium3DTileset)?C(t)&&-1!==t.indexOf(i)||n.push(i):i instanceof qEe&&Q6e(i,t,n))}}function J6e(e,t,n,i,o,r){const s=[];if(Q6e(t.primitives,i,s),0===s.length)return Promise.resolve(r());const a=new Y6e(n,o,s);return e._mostDetailedRayPicks.push(a),a.promise.then((function(){return r()}))}function Z6e(e,t){return!(!C(e)||!C(t)||0===t.length)&&(t.indexOf(e)>-1||t.indexOf(e.primitive)>-1||t.indexOf(e.id)>-1)}function $6e(e,t,n,i,o,r,s){const a=t.context,c=a.uniformState,l=t.frameState,u=e._pickOffscreenView;t.view=u,K6e(e,n,o,u.camera),B6e=bf.clone(u.viewport,B6e);const h=u.pickFramebuffer.begin(B6e,u.viewport);let d;t.jobScheduler.disableThisFrame(),t.updateFrameState(),l.invertClassification=!1,l.passes.pick=!0,l.passes.offscreen=!0,l.tilesetPassState=s?b6e:A6e,c.update(l),t.updateEnvironment(),t.updateAndExecuteCommands(h,F6e),t.resolveFramebuffers(h);const f=u.pickFramebuffer.end(B6e);if(t.context.depthTexture){const i=u.frustumCommandsList.length;for(let o=0;o<i;++o){const i=e.getPickDepth(t,o),r=i.getDepth(a,0,0);if(C(r)&&(r>0&&r<1)){const e=u.frustumCommandsList[o],i=e.near*(0!==o?t.opaqueFrustumNearOffset:1),s=e.far,a=i+r*(s-i);d=os.getPoint(n,a);break}}}if(t.view=t.defaultView,a.endFrame(),C(f)||C(d))return{object:f,position:d,exclude:!C(d)&&r||Z6e(f,i)}}function e8e(e,t,n,i,o,r,s,a){const c=function(){return $6e(e,t,n,o,r,s,a)};return W6e(i,c)}function t8e(e,t,n,i,o,r,s){const a=e8e(e,t,n,1,i,o,r,s);if(a.length>0)return a[0]}function n8e(e,t,n,i,o,r,s,a){return e8e(e,t,n,i,o,r,s,a)}function i8e(e,t){const n=yn();return t.then((function(t){const i=e.postRender.addEventListener((function(){n.resolve(t),i()}));e.requestRender()})).catch((function(e){n.reject(e)})),n.promise}w6e.prototype.updateMostDetailedRayPicks=function(e){const t=this._mostDetailedRayPicks;for(let n=0;n<t.length;++n)X6e(this,e,t[n])&&t.splice(n--,1)},w6e.prototype.pickFromRay=function(e,t,n,i){if(D.defined("ray",t),e.mode!==ij.SCENE3D)throw new x("Ray intersections are only supported in 3D mode.");return t8e(this,e,t,n,i,!1,!1)},w6e.prototype.drillPickFromRay=function(e,t,n,i,o){if(D.defined("ray",t),e.mode!==ij.SCENE3D)throw new x("Ray intersections are only supported in 3D mode.");return n8e(this,e,t,n,i,o,!1,!1)},w6e.prototype.pickFromRayMostDetailed=function(e,t,n,i){if(D.defined("ray",t),e.mode!==ij.SCENE3D)throw new x("Ray intersections are only supported in 3D mode.");const o=this;return t=os.clone(t),n=C(n)?n.slice():n,i8e(e,J6e(o,e,t,n,i,(function(){return t8e(o,e,t,n,i,!1,!0)})))},w6e.prototype.drillPickFromRayMostDetailed=function(e,t,n,i,o){if(D.defined("ray",t),e.mode!==ij.SCENE3D)throw new x("Ray intersections are only supported in 3D mode.");const r=this;return t=os.clone(t),i=C(i)?i.slice():i,i8e(e,J6e(r,e,t,i,o,(function(){return n8e(r,e,t,n,i,o,!1,!0)})))};const o8e=new K,r8e=new K,s8e=new os,a8e=new se;function c8e(e,t){const n=e.globe,i=C(n)?n.ellipsoid:e.mapProjection.ellipsoid,o=bo._defaultMaxTerrainHeight,r=i.geodeticSurfaceNormalCartographic(t,r8e),s=se.toCartesian(t,i,o8e),a=s8e;a.origin=s,a.direction=r;const c=new os;return os.getPoint(a,o,c.origin),K.negate(r,c.direction),c}function l8e(e,t){const n=e.globe,i=C(n)?n.ellipsoid:e.mapProjection.ellipsoid,o=se.fromCartesian(t,i,a8e);return c8e(e,o)}function u8e(e,t){const n=e.globe,i=C(n)?n.ellipsoid:e.mapProjection.ellipsoid,o=se.fromCartesian(t,i,a8e);return o.height}function h8e(e,t,n,i,o){const r=c8e(t,n);return J6e(e,t,r,i,o,(function(){const n=t8e(e,t,r,i,o,!0,!0);if(C(n))return u8e(t,n.position)}))}function d8e(e,t,n,i,o,r){const s=l8e(t,n);return J6e(e,t,s,i,o,(function(){const n=t8e(e,t,s,i,o,!0,!0);if(C(n))return K.clone(n.position,r)}))}w6e.prototype.sampleHeight=function(e,t,n,i){if(D.defined("position",t),e.mode!==ij.SCENE3D)throw new x("sampleHeight is only supported in 3D mode.");if(!e.sampleHeightSupported)throw new x("sampleHeight requires depth texture support. Check sampleHeightSupported.");const o=c8e(e,t),r=t8e(this,e,o,n,i,!0,!1);if(C(r))return u8e(e,r.position)},w6e.prototype.clampToHeight=function(e,t,n,i,o){if(D.defined("cartesian",t),e.mode!==ij.SCENE3D)throw new x("clampToHeight is only supported in 3D mode.");if(!e.clampToHeightSupported)throw new x("clampToHeight requires depth texture support. Check clampToHeightSupported.");const r=l8e(e,t),s=t8e(this,e,r,n,i,!0,!1);if(C(s))return K.clone(s.position,o)},w6e.prototype.sampleHeightMostDetailed=function(e,t,n,i){if(D.defined("positions",t),e.mode!==ij.SCENE3D)throw new x("sampleHeightMostDetailed is only supported in 3D mode.");if(!e.sampleHeightSupported)throw new x("sampleHeightMostDetailed requires depth texture support. Check sampleHeightSupported.");n=C(n)?n.slice():n;const o=t.length,r=new Array(o);for(let s=0;s<o;++s)r[s]=h8e(this,e,t[s],n,i);return i8e(e,Promise.all(r).then((function(e){const n=e.length;for(let i=0;i<n;++i)t[i].height=e[i];return t})))},w6e.prototype.clampToHeightMostDetailed=function(e,t,n,i){if(D.defined("cartesians",t),e.mode!==ij.SCENE3D)throw new x("clampToHeightMostDetailed is only supported in 3D mode.");if(!e.clampToHeightSupported)throw new x("clampToHeightMostDetailed requires depth texture support. Check clampToHeightSupported.");n=C(n)?n.slice():n;const o=t.length,r=new Array(o);for(let s=0;s<o;++s)r[s]=d8e(this,e,t[s],n,i,t[s]);return i8e(e,Promise.all(r).then((function(e){const n=e.length;for(let i=0;i<n;++i)t[i]=e[i];return t})))},w6e.prototype.destroy=function(){this._pickOffscreenView=this._pickOffscreenView&&this._pickOffscreenView.destroy()};var f8e=w6e;const p8e={NEAREST:0,LINEAR:1};var m8e=p8e;function _8e(e){e=R(e,R.EMPTY_OBJECT);const t=e.fragmentShader,n=R(e.textureScale,1),i=R(e.pixelFormat,fD.RGBA);if(D.typeOf.string("options.fragmentShader",t),D.typeOf.number.greaterThan("options.textureScale",n,0),D.typeOf.number.lessThanOrEquals("options.textureScale",n,1),!fD.isColorFormat(i))throw new x("options.pixelFormat must be a color format.");this._fragmentShader=t,this._uniforms=e.uniforms,this._textureScale=n,this._forcePowerOfTwo=R(e.forcePowerOfTwo,!1),this._sampleMode=R(e.sampleMode,m8e.NEAREST),this._pixelFormat=i,this._pixelDatatype=R(e.pixelDatatype,hD.UNSIGNED_BYTE),this._clearColor=R(e.clearColor,xy.BLACK),this._uniformMap=void 0,this._command=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._idTexture=void 0,this._actualUniforms={},this._dirtyUniforms=[],this._texturesToRelease=[],this._texturesToCreate=[],this._texturePromise=void 0;const o=new BHe;o.scissorTest={enabled:!0,rectangle:C(e.scissorRectangle)?bf.clone(e.scissorRectangle):new bf},this._passState=o,this._ready=!1;let r=e.name;C(r)||(r=wk()),this._name=r,this._logDepthChanged=void 0,this._useLogDepth=void 0,this._selectedIdTexture=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0,this._textureCache=void 0,this._index=void 0,this.enabled=!0,this._enabled=!0}Object.defineProperties(_8e.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},fragmentShader:{get:function(){return this._fragmentShader}},uniforms:{get:function(){return this._uniforms}},textureScale:{get:function(){return this._textureScale}},forcePowerOfTwo:{get:function(){return this._forcePowerOfTwo}},sampleMode:{get:function(){return this._sampleMode}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},clearColor:{get:function(){return this._clearColor}},scissorRectangle:{get:function(){return this._passState.scissorTest.rectangle}},outputTexture:{get:function(){if(C(this._textureCache)){const e=this._textureCache.getFramebuffer(this._name);if(C(e))return e.getColorTexture(0)}}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}});const g8e=/uniform\s+sampler2D\s+depthTexture/g;function y8e(e,t,n){const i=t[n];return("string"===typeof i||i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof HTMLVideoElement||i instanceof ImageData)&&e._dirtyUniforms.push(n),{get:function(){return t[n]},set:function(i){const o=t[n];t[n]=i;const r=e._actualUniforms,s=r[n];C(s)&&s!==o&&s instanceof Uk&&!C(e._textureCache.getStageByName(n))&&(e._texturesToRelease.push(s),delete r[n],delete r[`${n}Dimensions`]),o instanceof Uk&&e._texturesToRelease.push(o),"string"===typeof i||i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof HTMLVideoElement||i instanceof ImageData?e._dirtyUniforms.push(n):r[n]=i}}}function v8e(e,t){return function(){const n=e._actualUniforms[t];return"function"===typeof n?n():n}}function b8e(e,t){return function(){const n=e[t]();if(C(n))return n.dimensions}}function A8e(e){if(C(e._uniformMap))return;const t={},n={},i=e._uniforms,o=e._actualUniforms;for(const r in i)if(i.hasOwnProperty(r)){"function"!==typeof i[r]?(t[r]=v8e(e,r),n[r]=y8e(e,i,r)):(t[r]=i[r],n[r]=i[r]),o[r]=i[r];const s=t[r]();("string"===typeof s||s instanceof Uk||s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement)&&(t[`${r}Dimensions`]=b8e(t,r))}e._uniforms={},Object.defineProperties(e._uniforms,n),e._uniformMap=_n(t,{colorTexture:function(){return e._colorTexture},colorTextureDimensions:function(){return e._colorTexture.dimensions},depthTexture:function(){return e._depthTexture},depthTextureDimensions:function(){return e._depthTexture.dimensions},czm_idTexture:function(){return e._idTexture},czm_selectedIdTexture:function(){return e._selectedIdTexture},czm_selectedIdTextureStep:function(){return 1/e._selectedIdTexture.width}})}function w8e(e,t){if(C(e._command)&&!e._logDepthChanged&&!e._selectedDirty)return;let n=e._fragmentShader;if(C(e._selectedIdTexture)){const t=e._selectedIdTexture.width;n=n.replace(/varying\s+vec2\s+v_textureCoordinates;/g,""),n=`#define CZM_SELECTED_FEATURE \nuniform sampler2D czm_idTexture; \nuniform sampler2D czm_selectedIdTexture; \nuniform float czm_selectedIdTextureStep; \nvarying vec2 v_textureCoordinates; \nbool czm_selected(vec2 offset) \n{ \n    bool selected = false;\n    vec4 id = texture2D(czm_idTexture, v_textureCoordinates + offset); \n    for (int i = 0; i < ${t}; ++i) \n    { \n        vec4 selectedId = texture2D(czm_selectedIdTexture, vec2((float(i) + 0.5) * czm_selectedIdTextureStep, 0.5)); \n        if (all(equal(id, selectedId))) \n        { \n            return true; \n        } \n    } \n    return false; \n} \n\nbool czm_selected() \n{ \n    return czm_selected(vec2(0.0)); \n} \n\n${n}`}const i=new tq({defines:[e._useLogDepth?"LOG_DEPTH":""],sources:[n]});e._command=t.createViewportQuadCommand(i,{uniformMap:e._uniformMap,owner:e})}function T8e(e){const t=e._sampleMode;let n,i;t===m8e.LINEAR?(n=Rk.LINEAR,i=Dk.LINEAR):(n=Rk.NEAREST,i=Dk.NEAREST);const o=e._sampler;C(o)&&o.minificationFilter===n&&o.magnificationFilter===i||(e._sampler=new Nk({wrapS:Mk.CLAMP_TO_EDGE,wrapT:Mk.CLAMP_TO_EDGE,minificationFilter:n,magnificationFilter:i}))}function C8e(e,t){return function(n){e._texturesToCreate.push({name:t,source:n})}}function E8e(e,t){return function(){return e._textureCache.getOutputTexture(t)}}function x8e(e,t){let n,i,o;const r=e._texturesToRelease;let s=r.length;for(n=0;n<s;++n)i=r[n],i=i&&i.destroy();r.length=0;const a=e._texturesToCreate;for(s=a.length,n=0;n<s;++n){const i=a[n];o=i.name;const r=i.source;e._actualUniforms[o]=new Uk({context:t,source:r})}a.length=0;const c=e._dirtyUniforms;if(0===c.length&&!C(e._texturePromise))return void(e._ready=!0);if(0===c.length||C(e._texturePromise))return;s=c.length;const l=e._uniforms,u=[];for(n=0;n<s;++n){o=c[n];const t=l[o],i=e._textureCache.getStageByName(t);if(C(i))e._actualUniforms[o]=E8e(e,t);else if("string"===typeof t){const n=new Vi({url:t});u.push(n.fetchImage().then(C8e(e,o)))}else e._texturesToCreate.push({name:o,source:t})}c.length=0,u.length>0?(e._ready=!1,e._texturePromise=Promise.all(u).then((function(){e._ready=!0,e._texturePromise=void 0}))):e._ready=!0}function S8e(e){C(e._command)&&(e._command.shaderProgram=e._command.shaderProgram&&e._command.shaderProgram.destroy(),e._command=void 0),e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy();const t=e._textureCache;if(!C(t))return;const n=e._uniforms,i=e._actualUniforms;for(const o in i)i.hasOwnProperty(o)&&i[o]instanceof Uk&&(C(t.getStageByName(n[o]))||i[o].destroy(),e._dirtyUniforms.push(o))}function I8e(e){let t=C(e._selected)?e._selected.length:0;const n=C(e._parentSelected)?e._parentSelected:0;let i=e._selected!==e._selectedShadow||t!==e._selectedLength;if(i=i||e._parentSelected!==e._parentSelectedShadow||n!==e._parentSelectedLength,C(e._selected)&&C(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):C(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!i&&C(e._combinedSelected)){if(!C(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(let n=0;n<t;++n)if(e._combinedSelected[n]!==e._combinedSelectedShadow[n])return!0}return i}function O8e(e,t){if(!e._selectedDirty)return;e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy(),e._selectedIdTexture=void 0;const n=e._combinedSelected;if(!C(n))return;let i,o,r=0;const s=n.length;for(i=0;i<s;++i)o=n[i],C(o.pickIds)?r+=o.pickIds.length:C(o.pickId)&&++r;if(0===s||0===r){const n=new Uint8Array(4);return n[0]=255,n[1]=255,n[2]=255,n[3]=255,void(e._selectedIdTexture=new Uk({context:t,pixelFormat:fD.RGBA,pixelDatatype:hD.UNSIGNED_BYTE,source:{arrayBufferView:n,width:1,height:1},sampler:Nk.NEAREST}))}let a,c=0;const l=new Uint8Array(4*r);for(i=0;i<s;++i)if(o=n[i],C(o.pickIds)){const e=o.pickIds,t=e.length;for(let n=0;n<t;++n)a=e[n].color,l[c]=xy.floatToByte(a.red),l[c+1]=xy.floatToByte(a.green),l[c+2]=xy.floatToByte(a.blue),l[c+3]=xy.floatToByte(a.alpha),c+=4}else C(o.pickId)&&(a=o.pickId.color,l[c]=xy.floatToByte(a.red),l[c+1]=xy.floatToByte(a.green),l[c+2]=xy.floatToByte(a.blue),l[c+3]=xy.floatToByte(a.alpha),c+=4);e._selectedIdTexture=new Uk({context:t,pixelFormat:fD.RGBA,pixelDatatype:hD.UNSIGNED_BYTE,source:{arrayBufferView:l,width:r,height:1},sampler:Nk.NEAREST})}_8e.prototype._isSupported=function(e){return!g8e.test(this._fragmentShader)||e.depthTexture},_8e.prototype.update=function(e,t){if(this.enabled===this._enabled||this.enabled||S8e(this),this._enabled=this.enabled,!this._enabled)return;if(this._logDepthChanged=t!==this._useLogDepth,this._useLogDepth=t,this._selectedDirty=I8e(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=C(this._selected)?this._selected.length:0,this._parentSelectedLength=C(this._parentSelected)?this._parentSelected.length:0,O8e(this,e),A8e(this),x8e(this,e),w8e(this,e),T8e(this),this._selectedDirty=!1,!this._ready)return;const n=this._textureCache.getFramebuffer(this._name);if(this._command.framebuffer=n,!C(n))return;const i=n.getColorTexture(0);let o;i.width===e.drawingBufferWidth&&i.height===e.drawingBufferHeight||(o=this._renderState,C(o)&&i.width===o.viewport.width&&i.height===o.viewport.height||(this._renderState=yV.fromCache({viewport:new bf(0,0,i.width,i.height)}))),this._command.renderState=o},_8e.prototype.execute=function(e,t,n,i){if(!C(this._command)||!C(this._command.framebuffer)||!this._ready||!this._enabled)return;this._colorTexture=t,this._depthTexture=n,this._idTexture=i,Nk.equals(this._colorTexture.sampler,this._sampler)||(this._colorTexture.sampler=this._sampler);const o=this.scissorRectangle.width>0&&this.scissorRectangle.height>0?this._passState:void 0;C(o)&&(o.context=e),this._command.execute(e,o)},_8e.prototype.isDestroyed=function(){return!1},_8e.prototype.destroy=function(){return S8e(this),Qh(this)};var D8e=_8e,P8e="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n\n#ifdef AUTO_EXPOSURE\n    color /= texture2D(autoExposure, vec2(0.5)).r;\n#endif\n    color = czm_acesTonemapping(color);\n    color = czm_inverseGamma(color);\n\n    gl_FragColor = vec4(color, fragmentColor.a);\n}\n",R8e="uniform sampler2D randomTexture;\nuniform sampler2D depthTexture;\nuniform float intensity;\nuniform float bias;\nuniform float lengthCap;\nuniform float stepSize;\nuniform float frustumLength;\n\nvarying vec2 v_textureCoordinates;\n\nvec4 clipToEye(vec2 uv, float depth)\n{\n    vec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\n    vec4 posEC = czm_inverseProjection * vec4(xy, depth, 1.0);\n    posEC = posEC / posEC.w;\n    return posEC;\n}\n\n//Reconstruct Normal Without Edge Removation\nvec3 getNormalXEdge(vec3 posInCamera, float depthU, float depthD, float depthL, float depthR, vec2 pixelSize)\n{\n    vec4 posInCameraUp = clipToEye(v_textureCoordinates - vec2(0.0, pixelSize.y), depthU);\n    vec4 posInCameraDown = clipToEye(v_textureCoordinates + vec2(0.0, pixelSize.y), depthD);\n    vec4 posInCameraLeft = clipToEye(v_textureCoordinates - vec2(pixelSize.x, 0.0), depthL);\n    vec4 posInCameraRight = clipToEye(v_textureCoordinates + vec2(pixelSize.x, 0.0), depthR);\n\n    vec3 up = posInCamera.xyz - posInCameraUp.xyz;\n    vec3 down = posInCameraDown.xyz - posInCamera.xyz;\n    vec3 left = posInCamera.xyz - posInCameraLeft.xyz;\n    vec3 right = posInCameraRight.xyz - posInCamera.xyz;\n\n    vec3 DX = length(left) < length(right) ? left : right;\n    vec3 DY = length(up) < length(down) ? up : down;\n\n    return normalize(cross(DY, DX));\n}\n\nvoid main(void)\n{\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    vec4 posInCamera = clipToEye(v_textureCoordinates, depth);\n\n    if (posInCamera.z > frustumLength)\n    {\n        gl_FragColor = vec4(1.0);\n        return;\n    }\n\n    vec2 pixelSize = czm_pixelRatio / czm_viewport.zw;\n    float depthU = czm_readDepth(depthTexture, v_textureCoordinates - vec2(0.0, pixelSize.y));\n    float depthD = czm_readDepth(depthTexture, v_textureCoordinates + vec2(0.0, pixelSize.y));\n    float depthL = czm_readDepth(depthTexture, v_textureCoordinates - vec2(pixelSize.x, 0.0));\n    float depthR = czm_readDepth(depthTexture, v_textureCoordinates + vec2(pixelSize.x, 0.0));\n    vec3 normalInCamera = getNormalXEdge(posInCamera.xyz, depthU, depthD, depthL, depthR, pixelSize);\n\n    float ao = 0.0;\n    vec2 sampleDirection = vec2(1.0, 0.0);\n    float gapAngle = 90.0 * czm_radiansPerDegree;\n\n    // RandomNoise\n    float randomVal = texture2D(randomTexture, v_textureCoordinates).x;\n\n    //Loop for each direction\n    for (int i = 0; i < 4; i++)\n    {\n        float newGapAngle = gapAngle * (float(i) + randomVal);\n        float cosVal = cos(newGapAngle);\n        float sinVal = sin(newGapAngle);\n\n        //Rotate Sampling Direction\n        vec2 rotatedSampleDirection = vec2(cosVal * sampleDirection.x - sinVal * sampleDirection.y, sinVal * sampleDirection.x + cosVal * sampleDirection.y);\n        float localAO = 0.0;\n        float localStepSize = stepSize;\n\n        //Loop for each step\n        for (int j = 0; j < 6; j++)\n        {\n            vec2 newCoords = v_textureCoordinates + rotatedSampleDirection * localStepSize * pixelSize;\n\n            //Exception Handling\n            if(newCoords.x > 1.0 || newCoords.y > 1.0 || newCoords.x < 0.0 || newCoords.y < 0.0)\n            {\n                break;\n            }\n\n            float stepDepthInfo = czm_readDepth(depthTexture, newCoords);\n            vec4 stepPosInCamera = clipToEye(newCoords, stepDepthInfo);\n            vec3 diffVec = stepPosInCamera.xyz - posInCamera.xyz;\n            float len = length(diffVec);\n\n            if (len > lengthCap)\n            {\n                break;\n            }\n\n            float dotVal = clamp(dot(normalInCamera, normalize(diffVec)), 0.0, 1.0 );\n            float weight = len / lengthCap;\n            weight = 1.0 - weight * weight;\n\n            if (dotVal < bias)\n            {\n                dotVal = 0.0;\n            }\n\n            localAO = max(localAO, dotVal * weight);\n            localStepSize += stepSize;\n        }\n        ao += localAO;\n    }\n\n    ao /= 4.0;\n    ao = 1.0 - clamp(ao, 0.0, 1.0);\n    ao = pow(ao, intensity);\n    gl_FragColor = vec4(vec3(ao), 1.0);\n}\n",L8e="uniform sampler2D colorTexture;\nuniform sampler2D ambientOcclusionTexture;\nuniform bool ambientOcclusionOnly;\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 color = texture2D(colorTexture, v_textureCoordinates).rgb;\n    vec3 ao = texture2D(ambientOcclusionTexture, v_textureCoordinates).rgb;\n    gl_FragColor.rgb = ambientOcclusionOnly ? ao : ao * color;\n}\n",M8e="uniform sampler2D colorTexture;\nuniform float gradations;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\n#ifdef CZM_SELECTED_FEATURE\n    if (czm_selected()) {\n        gl_FragColor = vec4(rgb, 1.0);\n        return;\n    }\n#endif\n    float luminance = czm_luminance(rgb);\n    float darkness = luminance * gradations;\n    darkness = (darkness - fract(darkness)) / gradations;\n    gl_FragColor = vec4(vec3(darkness), 1.0);\n}\n",B8e="uniform sampler2D colorTexture;\nuniform sampler2D bloomTexture;\nuniform bool glowOnly;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n\n#ifdef CZM_SELECTED_FEATURE\n    if (czm_selected()) {\n        gl_FragColor = color;\n        return;\n    }\n#endif\n\n    vec4 bloom = texture2D(bloomTexture, v_textureCoordinates);\n    gl_FragColor = glowOnly ? bloom : bloom + color;\n}\n",N8e="uniform sampler2D colorTexture;\nuniform float brightness;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\n    vec3 target = vec3(0.0);\n    gl_FragColor = vec4(mix(target, rgb, brightness), 1.0);\n}\n",F8e="uniform sampler2D colorTexture;\nuniform float contrast;\nuniform float brightness;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 sceneColor = texture2D(colorTexture, v_textureCoordinates).xyz;\n    sceneColor = czm_RGBToHSB(sceneColor);\n    sceneColor.z += brightness;\n    sceneColor = czm_HSBToRGB(sceneColor);\n\n    float factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));\n    sceneColor = factor * (sceneColor - vec3(0.5)) + vec3(0.5);\n    gl_FragColor = vec4(sceneColor, 1.0);\n}\n",z8e="uniform sampler2D colorTexture;\nuniform sampler2D blurTexture;\nuniform sampler2D depthTexture;\nuniform float focalDistance;\n\nvarying vec2 v_textureCoordinates;\n\nvec4 toEye(vec2 uv, float depth)\n{\n   vec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\n   vec4 posInCamera = czm_inverseProjection * vec4(xy, depth, 1.0);\n   posInCamera = posInCamera / posInCamera.w;\n   return posInCamera;\n}\n\nfloat computeDepthBlur(float depth)\n{\n    float f;\n    if (depth < focalDistance)\n    {\n        f = (focalDistance - depth) / (focalDistance - czm_currentFrustum.x);\n    }\n    else\n    {\n        f = (depth - focalDistance) / (czm_currentFrustum.y - focalDistance);\n        f = pow(f, 0.1);\n    }\n    f *= f;\n    f = clamp(f, 0.0, 1.0);\n    return pow(f, 0.5);\n}\n\nvoid main(void)\n{\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    vec4 posInCamera = toEye(v_textureCoordinates, depth);\n    float d = computeDepthBlur(-posInCamera.z);\n    gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), texture2D(blurTexture, v_textureCoordinates), d);\n}\n",k8e="uniform sampler2D depthTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    gl_FragColor = vec4(vec3(depth), 1.0);\n}\n",U8e="uniform sampler2D depthTexture;\nuniform float length;\nuniform vec4 color;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    float directions[3];\n    directions[0] = -1.0;\n    directions[1] = 0.0;\n    directions[2] = 1.0;\n\n    float scalars[3];\n    scalars[0] = 3.0;\n    scalars[1] = 10.0;\n    scalars[2] = 3.0;\n\n    float padx = czm_pixelRatio / czm_viewport.z;\n    float pady = czm_pixelRatio / czm_viewport.w;\n\n#ifdef CZM_SELECTED_FEATURE\n    bool selected = false;\n    for (int i = 0; i < 3; ++i)\n    {\n        float dir = directions[i];\n        selected = selected || czm_selected(vec2(-padx, dir * pady));\n        selected = selected || czm_selected(vec2(padx, dir * pady));\n        selected = selected || czm_selected(vec2(dir * padx, -pady));\n        selected = selected || czm_selected(vec2(dir * padx, pady));\n        if (selected)\n        {\n            break;\n        }\n    }\n    if (!selected)\n    {\n        gl_FragColor = vec4(color.rgb, 0.0);\n        return;\n    }\n#endif\n\n    float horizEdge = 0.0;\n    float vertEdge = 0.0;\n\n    for (int i = 0; i < 3; ++i)\n    {\n        float dir = directions[i];\n        float scale = scalars[i];\n\n        horizEdge -= texture2D(depthTexture, v_textureCoordinates + vec2(-padx, dir * pady)).x * scale;\n        horizEdge += texture2D(depthTexture, v_textureCoordinates + vec2(padx, dir * pady)).x * scale;\n\n        vertEdge -= texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, -pady)).x * scale;\n        vertEdge += texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, pady)).x * scale;\n    }\n\n    float len = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\n    gl_FragColor = vec4(color.rgb, len > length ? color.a : 0.0);\n}\n",V8e="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\n// See slides 142 and 143:\n//     http://www.gdcvault.com/play/1012459/Uncharted_2__HDR_Lighting\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n\n#ifdef AUTO_EXPOSURE\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\n    color /= exposure;\n#endif\n\n\tconst float A = 0.22; // shoulder strength\n\tconst float B = 0.30; // linear strength\n\tconst float C = 0.10; // linear angle\n\tconst float D = 0.20; // toe strength\n\tconst float E = 0.01; // toe numerator\n\tconst float F = 0.30; // toe denominator\n\n\tconst float white = 11.2; // linear white point value\n\n\tvec3 c = ((color * (A * color + C * B) + D * E) / (color * ( A * color + B) + D * F)) - E / F;\n\tfloat w = ((white * (A * white + C * B) + D * E) / (white * ( A * white + B) + D * F)) - E / F;\n\n\tc = czm_inverseGamma(c / w);\n\tgl_FragColor = vec4(c, fragmentColor.a);\n}\n",H8e="varying vec2 v_textureCoordinates;\n\nuniform sampler2D colorTexture;\n\nconst float fxaaQualitySubpix = 0.5;\nconst float fxaaQualityEdgeThreshold = 0.125;\nconst float fxaaQualityEdgeThresholdMin = 0.0833;\n\nvoid main()\n{\n    vec2 fxaaQualityRcpFrame = vec2(1.0) / czm_viewport.zw;\n    vec4 color = FxaaPixelShader(\n        v_textureCoordinates,\n        colorTexture,\n        fxaaQualityRcpFrame,\n        fxaaQualitySubpix,\n        fxaaQualityEdgeThreshold,\n        fxaaQualityEdgeThresholdMin);\n    float alpha = texture2D(colorTexture, v_textureCoordinates).a;\n    gl_FragColor = vec4(color.rgb, alpha);\n}\n",G8e="#define SAMPLES 8\n\nuniform float delta;\nuniform float sigma;\nuniform float direction; // 0.0 for x direction, 1.0 for y direction\n\nuniform sampler2D colorTexture;\n\n#ifdef USE_STEP_SIZE\nuniform float stepSize;\n#else\nuniform vec2 step;\n#endif\n\nvarying vec2 v_textureCoordinates;\n\n//  Incremental Computation of the Gaussian:\n//  https://developer.nvidia.com/gpugems/GPUGems3/gpugems3_ch40.html\n\nvoid main()\n{\n    vec2 st = v_textureCoordinates;\n    vec2 dir = vec2(1.0 - direction, direction);\n\n#ifdef USE_STEP_SIZE\n    vec2 step = vec2(stepSize * (czm_pixelRatio / czm_viewport.zw));\n#else\n    vec2 step = step;\n#endif\n\n    vec3 g;\n    g.x = 1.0 / (sqrt(czm_twoPi) * sigma);\n    g.y = exp((-0.5 * delta * delta) / (sigma * sigma));\n    g.z = g.y * g.y;\n\n    vec4 result = texture2D(colorTexture, st) * g.x;\n    for (int i = 1; i < SAMPLES; ++i)\n    {\n        g.xy *= g.yz;\n\n        vec2 offset = float(i) * dir * step;\n        result += texture2D(colorTexture, st - offset) * g.x;\n        result += texture2D(colorTexture, st + offset) * g.x;\n    }\n\n    gl_FragColor = result;\n}\n",W8e="uniform sampler2D colorTexture;\nuniform sampler2D dirtTexture;\nuniform sampler2D starTexture;\nuniform vec2 dirtTextureDimensions;\nuniform float distortion;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform float dirtAmount;\nuniform float earthRadius;\nuniform float intensity;\n\nvarying vec2 v_textureCoordinates;\n\n// whether it is in space or not\n// 6500000.0 is empirical value\n#define DISTANCE_TO_SPACE 6500000.0\n\n// return ndc from world coordinate biased earthRadius\nvec4 getNDCFromWC(vec3 WC, float earthRadius)\n{\n    vec4 positionEC = czm_view * vec4(WC, 1.0);\n    positionEC = vec4(positionEC.x + earthRadius, positionEC.y, positionEC.z, 1.0);\n    vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\n    return czm_viewportOrthographic * vec4(positionWC.xy, -positionWC.z, 1.0);\n}\n\n// Check if current pixel is included Earth\n// if then mask it gradually\nfloat isInEarth(vec2 texcoord, vec2 sceneSize)\n{\n    vec2 NDC = texcoord * 2.0 - 1.0;\n    vec4 earthPosSC = getNDCFromWC(vec3(0.0), 0.0);\n    vec4 earthPosSCEdge = getNDCFromWC(vec3(0.0), earthRadius * 1.5);\n    NDC.xy -= earthPosSC.xy;\n\n    float X = abs(NDC.x) * sceneSize.x;\n    float Y = abs(NDC.y) * sceneSize.y;\n\n    return clamp(0.0, 1.0, max(sqrt(X * X + Y * Y) / max(abs(earthPosSCEdge.x * sceneSize.x), 1.0) - 0.8 , 0.0));\n}\n\n// For Chromatic effect\nvec4 textureDistorted(sampler2D tex, vec2 texcoord, vec2 direction, vec3 distortion, bool isSpace)\n{\n    vec2 sceneSize = czm_viewport.zw;\n    vec3 color;\n    if(isSpace)\n    {\n        color.r = isInEarth(texcoord + direction * distortion.r, sceneSize) * texture2D(tex, texcoord + direction * distortion.r).r;\n        color.g = isInEarth(texcoord + direction * distortion.g, sceneSize) * texture2D(tex, texcoord + direction * distortion.g).g;\n        color.b = isInEarth(texcoord + direction * distortion.b, sceneSize) * texture2D(tex, texcoord + direction * distortion.b).b;\n    }\n    else\n    {\n        color.r = texture2D(tex, texcoord + direction * distortion.r).r;\n        color.g = texture2D(tex, texcoord + direction * distortion.g).g;\n        color.b = texture2D(tex, texcoord + direction * distortion.b).b;\n    }\n    return vec4(clamp(color, 0.0, 1.0), 0.0);\n}\n\nvoid main(void)\n{\n    vec4 originalColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 rgb = originalColor.rgb;\n    bool isSpace = length(czm_viewerPositionWC.xyz) > DISTANCE_TO_SPACE;\n\n    // Sun position\n    vec4 sunPos = czm_morphTime == 1.0 ? vec4(czm_sunPositionWC, 1.0) : vec4(czm_sunPositionColumbusView.zxy, 1.0);\n    vec4 sunPositionEC = czm_view * sunPos;\n    vec4 sunPositionWC = czm_eyeToWindowCoordinates(sunPositionEC);\n    sunPos = czm_viewportOrthographic * vec4(sunPositionWC.xy, -sunPositionWC.z, 1.0);\n\n    // If sun is not in the screen space, use original color.\n    if(!isSpace || !((sunPos.x >= -1.1 && sunPos.x <= 1.1) && (sunPos.y >= -1.1 && sunPos.y <= 1.1)))\n    {\n        // Lens flare is disabled when not in space until #5932 is fixed.\n        //    https://github.com/CesiumGS/cesium/issues/5932\n        gl_FragColor = originalColor;\n        return;\n    }\n\n    vec2 texcoord = vec2(1.0) - v_textureCoordinates;\n    vec2 pixelSize = czm_pixelRatio / czm_viewport.zw;\n    vec2 invPixelSize = 1.0 / pixelSize;\n    vec3 distortionVec = pixelSize.x * vec3(-distortion, 0.0, distortion);\n\n    // ghost vector to image centre:\n    vec2 ghostVec = (vec2(0.5) - texcoord) * ghostDispersal;\n    vec3 direction = normalize(vec3(ghostVec, 0.0));\n\n    // sample ghosts:\n    vec4 result = vec4(0.0);\n    vec4 ghost = vec4(0.0);\n    for (int i = 0; i < 4; ++i)\n    {\n        vec2 offset = fract(texcoord + ghostVec * float(i));\n        // Only bright spots from the centre of the source image\n        ghost += textureDistorted(colorTexture, offset, direction.xy, distortionVec, isSpace);\n    }\n    result += ghost;\n\n    // sample halo\n    vec2 haloVec = normalize(ghostVec) * haloWidth;\n    float weightForHalo = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));\n    weightForHalo = pow(1.0 - weightForHalo, 5.0);\n\n    result += textureDistorted(colorTexture, texcoord + haloVec, direction.xy, distortionVec, isSpace) * weightForHalo * 1.5;\n\n    // dirt on lens\n    vec2 dirtTexCoords = (v_textureCoordinates * invPixelSize) / dirtTextureDimensions;\n    if (dirtTexCoords.x > 1.0)\n    {\n        dirtTexCoords.x = mod(floor(dirtTexCoords.x), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.x) :  fract(dirtTexCoords.x);\n    }\n    if (dirtTexCoords.y > 1.0)\n    {\n        dirtTexCoords.y = mod(floor(dirtTexCoords.y), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.y) :  fract(dirtTexCoords.y);\n    }\n    result += dirtAmount * texture2D(dirtTexture, dirtTexCoords);\n\n    // Rotating starburst texture's coordinate\n    // dot(czm_view[0].xyz, vec3(0.0, 0.0, 1.0)) + dot(czm_view[1].xyz, vec3(0.0, 1.0, 0.0))\n    float camrot = czm_view[0].z + czm_view[1].y;\n    float cosValue = cos(camrot);\n    float sinValue = sin(camrot);\n    mat3 rotation = mat3(\n        cosValue, -sinValue, 0.0,\n        sinValue, cosValue, 0.0,\n        0.0, 0.0, 1.0\n    );\n\n    vec3 st1 = vec3(v_textureCoordinates * 2.0 - vec2(1.0), 1.0);\n    vec3 st2 = vec3((rotation * st1).xy, 1.0);\n    vec3 st3 = st2 * 0.5 + vec3(0.5);\n    vec2 lensStarTexcoord = st3.xy;\n    float weightForLensFlare = length(vec3(sunPos.xy, 0.0));\n    float oneMinusWeightForLensFlare = max(1.0 - weightForLensFlare, 0.0);\n\n    if (!isSpace)\n    {\n        result *= oneMinusWeightForLensFlare * intensity * 0.2;\n    }\n    else\n    {\n        result *= oneMinusWeightForLensFlare * intensity;\n        result *= texture2D(starTexture, lensStarTexcoord) * pow(weightForLensFlare, 1.0) * max((1.0 - length(vec3(st1.xy, 0.0))), 0.0) * 2.0;\n    }\n\n    result += texture2D(colorTexture, v_textureCoordinates);\n\n    gl_FragColor = result;\n}\n",q8e="uniform sampler2D colorTexture;\nuniform vec3 white;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\n// See equation 4:\n//    http://www.cs.utah.edu/~reinhard/cdrom/tonemap.pdf\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\n    color /= exposure;\n#endif\n    color = (color * (1.0 + color / white)) / (1.0 + color);\n    color = czm_inverseGamma(color);\n    gl_FragColor = vec4(color, fragmentColor.a);\n}\n",j8e="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy ,vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main(void)\n{\n    float noiseValue = rand(v_textureCoordinates + sin(czm_frameNumber)) * 0.1;\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\n    vec3 green = vec3(0.0, 1.0, 0.0);\n    gl_FragColor = vec4((noiseValue + rgb) * green, 1.0);\n}\n",Y8e="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\n// See equation 3:\n//    http://www.cs.utah.edu/~reinhard/cdrom/tonemap.pdf\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\n    color /= exposure;\n#endif\n    color = color / (1.0 + color);\n    color = czm_inverseGamma(color);\n    gl_FragColor = vec4(color, fragmentColor.a);\n}\n",K8e="uniform sampler2D colorTexture;\nuniform sampler2D silhouetteTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec4 silhouetteColor = texture2D(silhouetteTexture, v_textureCoordinates);\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    gl_FragColor = mix(color, silhouetteColor, silhouetteColor.a);\n}\n",X8e="/**\n * @license\n * Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *  * Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n *  * Neither the name of NVIDIA CORPORATION nor the names of its\n *    contributors may be used to endorse or promote products derived\n *    from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n// NVIDIA GameWorks Graphics Samples GitHub link: https://github.com/NVIDIAGameWorks/GraphicsSamples\n// Original FXAA 3.11 shader link: https://github.com/NVIDIAGameWorks/GraphicsSamples/blob/master/samples/es3-kepler/FXAA/FXAA3_11.h\n\n// Steps used to integrate into Cesium:\n// * The following defines are set:\n//       #define FXAA_PC 1\n//       #define FXAA_WEBGL_1 1\n//       #define FXAA_GREEN_AS_LUMA 1\n//       #define FXAA_EARLY_EXIT 1\n//       #define FXAA_GLSL_120 1\n// * All other preprocessor directives besides the FXAA_QUALITY__P* directives were removed.\n// * Double underscores are invalid for preprocessor directives so replace them with a single underscore. Replace\n//   /FXAA_QUALITY__P(.*)/g with /FXAA_QUALITY__P$1/.\n// * There are no implicit conversions from ivec* to vec* so replace:\n//       #define FxaaInt2 ivec2\n//           with\n//       #define FxaaInt2 vec2\n// * The texture2DLod function is only available in vertex shaders so replace:\n//       #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n//       #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n//           with\n//       #define FxaaTexTop(t, p) texture2D(t, p)\n//       #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\n// * FXAA_QUALITY_PRESET is prepended in the javascript code. We may want to expose that setting in the future.\n// * The following parameters to FxaaPixelShader are unused and can be removed:\n//       fxaaConsolePosPos\n//       fxaaConsoleRcpFrameOpt\n//       fxaaConsoleRcpFrameOpt2\n//       fxaaConsole360RcpFrameOpt2\n//       fxaaConsoleEdgeSharpness\n//       fxaaConsoleEdgeThreshold\n//       fxaaConsoleEdgeThresholdMi\n//       fxaaConsole360ConstDir\n\n//\n// Choose the quality preset.\n// This needs to be compiled into the shader as it effects code.\n// Best option to include multiple presets is to\n// in each shader define the preset, then include this file.\n//\n// OPTIONS\n// -----------------------------------------------------------------------\n// 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n// 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n// 39       - no dither, very expensive\n//\n// NOTES\n// -----------------------------------------------------------------------\n// 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n// 13 = about same speed as FXAA 3.9 and better than 12\n// 23 = closest to FXAA 3.9 visually and performance wise\n//  _ = the lowest digit is directly related to performance\n// _  = the highest digit is directly related to style\n//\n//#define FXAA_QUALITY_PRESET 12\n\n\n#if (FXAA_QUALITY_PRESET == 10)\n    #define FXAA_QUALITY_PS 3\n    #define FXAA_QUALITY_P0 1.5\n    #define FXAA_QUALITY_P1 3.0\n    #define FXAA_QUALITY_P2 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 11)\n    #define FXAA_QUALITY_PS 4\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 3.0\n    #define FXAA_QUALITY_P3 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 12)\n    #define FXAA_QUALITY_PS 5\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 4.0\n    #define FXAA_QUALITY_P4 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 13)\n    #define FXAA_QUALITY_PS 6\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 4.0\n    #define FXAA_QUALITY_P5 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 14)\n    #define FXAA_QUALITY_PS 7\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 4.0\n    #define FXAA_QUALITY_P6 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 15)\n    #define FXAA_QUALITY_PS 8\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 4.0\n    #define FXAA_QUALITY_P7 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 20)\n    #define FXAA_QUALITY_PS 3\n    #define FXAA_QUALITY_P0 1.5\n    #define FXAA_QUALITY_P1 2.0\n    #define FXAA_QUALITY_P2 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 21)\n    #define FXAA_QUALITY_PS 4\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 22)\n    #define FXAA_QUALITY_PS 5\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 23)\n    #define FXAA_QUALITY_PS 6\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 24)\n    #define FXAA_QUALITY_PS 7\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 3.0\n    #define FXAA_QUALITY_P6 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 25)\n    #define FXAA_QUALITY_PS 8\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 4.0\n    #define FXAA_QUALITY_P7 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 26)\n    #define FXAA_QUALITY_PS 9\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 4.0\n    #define FXAA_QUALITY_P8 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 27)\n    #define FXAA_QUALITY_PS 10\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 4.0\n    #define FXAA_QUALITY_P9 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 28)\n    #define FXAA_QUALITY_PS 11\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 4.0\n    #define FXAA_QUALITY_P10 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 29)\n    #define FXAA_QUALITY_PS 12\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 2.0\n    #define FXAA_QUALITY_P10 4.0\n    #define FXAA_QUALITY_P11 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 39)\n    #define FXAA_QUALITY_PS 12\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.0\n    #define FXAA_QUALITY_P2 1.0\n    #define FXAA_QUALITY_P3 1.0\n    #define FXAA_QUALITY_P4 1.0\n    #define FXAA_QUALITY_P5 1.5\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 2.0\n    #define FXAA_QUALITY_P10 4.0\n    #define FXAA_QUALITY_P11 8.0\n#endif\n\n#define FxaaBool bool\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 vec2\n#define FxaaTex sampler2D\n\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTexTop(t, p) texture2D(t, p)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\n\nFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n\nFxaaFloat4 FxaaPixelShader(\n    //\n    // Use noperspective interpolation here (turn off perspective interpolation).\n    // {xy} = center of pixel\n    FxaaFloat2 pos,\n    //\n    // Input color texture.\n    // {rgb_} = color in linear or perceptual color space\n    // if (FXAA_GREEN_AS_LUMA == 0)\n    //     {___a} = luma in perceptual color space (not linear)\n    FxaaTex tex,\n    //\n    // Only used on FXAA Quality.\n    // This must be from a constant/uniform.\n    // {x_} = 1.0/screenWidthInPixels\n    // {_y} = 1.0/screenHeightInPixels\n    FxaaFloat2 fxaaQualityRcpFrame,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_SUBPIX define.\n    // It is here now to allow easier tuning.\n    // Choose the amount of sub-pixel aliasing removal.\n    // This can effect sharpness.\n    //   1.00 - upper limit (softer)\n    //   0.75 - default amount of filtering\n    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n    //   0.25 - almost off\n    //   0.00 - completely off\n    FxaaFloat fxaaQualitySubpix,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n    // It is here now to allow easier tuning.\n    // The minimum amount of local contrast required to apply algorithm.\n    //   0.333 - too little (faster)\n    //   0.250 - low quality\n    //   0.166 - default\n    //   0.125 - high quality\n    //   0.063 - overkill (slower)\n    FxaaFloat fxaaQualityEdgeThreshold,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n    // It is here now to allow easier tuning.\n    // Trims the algorithm from processing darks.\n    //   0.0833 - upper limit (default, the start of visible unfiltered edges)\n    //   0.0625 - high quality (faster)\n    //   0.0312 - visible limit (slower)\n    // Special notes when using FXAA_GREEN_AS_LUMA,\n    //   Likely want to set this to zero.\n    //   As colors that are mostly not-green\n    //   will appear very dark in the green channel!\n    //   Tune by looking at mostly non-green content,\n    //   then start at zero and increase until aliasing is a problem.\n    FxaaFloat fxaaQualityEdgeThresholdMin\n) {\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posM;\n    posM.x = pos.x;\n    posM.y = pos.y;\n    FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n    #define lumaM rgbyM.y\n    FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n/*--------------------------------------------------------------------------*/\n    FxaaFloat maxSM = max(lumaS, lumaM);\n    FxaaFloat minSM = min(lumaS, lumaM);\n    FxaaFloat maxESM = max(lumaE, maxSM);\n    FxaaFloat minESM = min(lumaE, minSM);\n    FxaaFloat maxWN = max(lumaN, lumaW);\n    FxaaFloat minWN = min(lumaN, lumaW);\n    FxaaFloat rangeMax = max(maxWN, maxESM);\n    FxaaFloat rangeMin = min(minWN, minESM);\n    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n    FxaaFloat range = rangeMax - rangeMin;\n    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n    FxaaBool earlyExit = range < rangeMaxClamped;\n/*--------------------------------------------------------------------------*/\n    if(earlyExit)\n        return rgbyM;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNS = lumaN + lumaS;\n    FxaaFloat lumaWE = lumaW + lumaE;\n    FxaaFloat subpixRcpRange = 1.0/range;\n    FxaaFloat subpixNSWE = lumaNS + lumaWE;\n    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNESE = lumaNE + lumaSE;\n    FxaaFloat lumaNWNE = lumaNW + lumaNE;\n    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNWSW = lumaNW + lumaSW;\n    FxaaFloat lumaSWSE = lumaSW + lumaSE;\n    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n    FxaaBool horzSpan = edgeHorz >= edgeVert;\n    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n/*--------------------------------------------------------------------------*/\n    if(!horzSpan) lumaN = lumaW;\n    if(!horzSpan) lumaS = lumaE;\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat gradientN = lumaN - lumaM;\n    FxaaFloat gradientS = lumaS - lumaM;\n    FxaaFloat lumaNN = lumaN + lumaM;\n    FxaaFloat lumaSS = lumaS + lumaM;\n    FxaaBool pairN = abs(gradientN) >= abs(gradientS);\n    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n    if(pairN) lengthSign = -lengthSign;\n    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posB;\n    posB.x = posM.x;\n    posB.y = posM.y;\n    FxaaFloat2 offNP;\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n    if(!horzSpan) posB.x += lengthSign * 0.5;\n    if( horzSpan) posB.y += lengthSign * 0.5;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posN;\n    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n    FxaaFloat2 posP;\n    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n    FxaaFloat subpixE = subpixC * subpixC;\n    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n/*--------------------------------------------------------------------------*/\n    if(!pairN) lumaNN = lumaSS;\n    FxaaFloat gradientScaled = gradient * 1.0/4.0;\n    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n    FxaaFloat subpixF = subpixD * subpixE;\n    FxaaBool lumaMLTZero = lumaMM < 0.0;\n/*--------------------------------------------------------------------------*/\n    lumaEndN -= lumaNN * 0.5;\n    lumaEndP -= lumaNN * 0.5;\n    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n    FxaaBool doneNP = (!doneN) || (!doneP);\n    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n/*--------------------------------------------------------------------------*/\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PS > 3)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITY_PS > 4)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n/*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITY_PS > 5)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n/*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITY_PS > 6)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n/*--------------------------------------------------------------------------*/\n                        #if (FXAA_QUALITY_PS > 7)\n                        if(doneNP) {\n                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                            doneN = abs(lumaEndN) >= gradientScaled;\n                            doneP = abs(lumaEndP) >= gradientScaled;\n                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n                            doneNP = (!doneN) || (!doneP);\n                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n/*--------------------------------------------------------------------------*/\n    #if (FXAA_QUALITY_PS > 8)\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PS > 9)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITY_PS > 10)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n/*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITY_PS > 11)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n/*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITY_PS > 12)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n/*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n/*--------------------------------------------------------------------------*/\n                }\n                #endif\n/*--------------------------------------------------------------------------*/\n            }\n            #endif\n/*--------------------------------------------------------------------------*/\n        }\n        #endif\n/*--------------------------------------------------------------------------*/\n    }\n    #endif\n/*--------------------------------------------------------------------------*/\n                        }\n                        #endif\n/*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n/*--------------------------------------------------------------------------*/\n                }\n                #endif\n/*--------------------------------------------------------------------------*/\n            }\n            #endif\n/*--------------------------------------------------------------------------*/\n        }\n        #endif\n/*--------------------------------------------------------------------------*/\n    }\n/*--------------------------------------------------------------------------*/\n    FxaaFloat dstN = posM.x - posN.x;\n    FxaaFloat dstP = posP.x - posM.x;\n    if(!horzSpan) dstN = posM.y - posN.y;\n    if(!horzSpan) dstP = posP.y - posM.y;\n/*--------------------------------------------------------------------------*/\n    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n    FxaaFloat spanLength = (dstP + dstN);\n    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n    FxaaFloat spanLengthRcp = 1.0/spanLength;\n/*--------------------------------------------------------------------------*/\n    FxaaBool directionN = dstN < dstP;\n    FxaaFloat dst = min(dstN, dstP);\n    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n    FxaaFloat subpixG = subpixF * subpixF;\n    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n    return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n}\n";function Q8e(e){e=R(e,R.EMPTY_OBJECT),D.defined("options.stages",e.stages),D.typeOf.number.greaterThan("options.stages.length",e.stages.length,0),this._stages=e.stages,this._inputPreviousStageTexture=R(e.inputPreviousStageTexture,!0);let t=e.name;C(t)||(t=wk()),this._name=t,this._uniforms=e.uniforms,this._textureCache=void 0,this._index=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0}function J8e(e){let t=C(e._selected)?e._selected.length:0;const n=C(e._parentSelected)?e._parentSelected:0;let i=e._selected!==e._selectedShadow||t!==e._selectedLength;if(i=i||e._parentSelected!==e._parentSelectedShadow||n!==e._parentSelectedLength,C(e._selected)&&C(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):C(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!i&&C(e._combinedSelected)){if(!C(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(let n=0;n<t;++n)if(e._combinedSelected[n]!==e._combinedSelectedShadow[n])return!0}return i}Object.defineProperties(Q8e.prototype,{ready:{get:function(){const e=this._stages,t=e.length;for(let n=0;n<t;++n)if(!e[n].ready)return!1;return!0}},name:{get:function(){return this._name}},enabled:{get:function(){return this._stages[0].enabled},set:function(e){const t=this._stages,n=t.length;for(let i=0;i<n;++i)t[i].enabled=e}},uniforms:{get:function(){return this._uniforms}},inputPreviousStageTexture:{get:function(){return this._inputPreviousStageTexture}},length:{get:function(){return this._stages.length}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}}),Q8e.prototype._isSupported=function(e){const t=this._stages,n=t.length;for(let i=0;i<n;++i)if(!t[i]._isSupported(e))return!1;return!0},Q8e.prototype.get=function(e){return D.typeOf.number.greaterThanOrEquals("index",e,0),D.typeOf.number.lessThan("index",e,this.length),this._stages[e]},Q8e.prototype.update=function(e,t){this._selectedDirty=J8e(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=C(this._selected)?this._selected.length:0,this._parentSelectedLength=C(this._parentSelected)?this._parentSelected.length:0;const n=this._stages,i=n.length;for(let o=0;o<i;++o){const i=n[o];this._selectedDirty&&(i.parentSelected=this._combinedSelected),i.update(e,t)}},Q8e.prototype.isDestroyed=function(){return!1},Q8e.prototype.destroy=function(){const e=this._stages,t=e.length;for(let n=0;n<t;++n)e[n].destroy();return Qh(this)};var Z8e=Q8e;const $8e={};function e9e(e){const t=1,n=2,i=1,o=`#define USE_STEP_SIZE\n${G8e}`,r=new D8e({name:`${e}_x_direction`,fragmentShader:o,uniforms:{delta:t,sigma:n,stepSize:i,direction:0},sampleMode:m8e.LINEAR}),s=new D8e({name:`${e}_y_direction`,fragmentShader:o,uniforms:{delta:t,sigma:n,stepSize:i,direction:1},sampleMode:m8e.LINEAR}),a={};return Object.defineProperties(a,{delta:{get:function(){return r.uniforms.delta},set:function(e){const t=r.uniforms,n=s.uniforms;t.delta=n.delta=e}},sigma:{get:function(){return r.uniforms.sigma},set:function(e){const t=r.uniforms,n=s.uniforms;t.sigma=n.sigma=e}},stepSize:{get:function(){return r.uniforms.stepSize},set:function(e){const t=r.uniforms,n=s.uniforms;t.stepSize=n.stepSize=e}}}),new Z8e({name:e,stages:[r,s],uniforms:a})}function t9e(e){if(!C(e))return $8e.createEdgeDetectionStage();const t=new Z8e({name:"czm_edge_detection_multiple",stages:e,inputPreviousStageTexture:!1}),n={};let i="",o="";for(let a=0;a<e.length;++a)i+=`uniform sampler2D edgeTexture${a}; \n`,o+=`        vec4 edge${a} = texture2D(edgeTexture${a}, v_textureCoordinates); \n        if (edge${a}.a > 0.0) \n        { \n            color = edge${a}; \n            break; \n        } \n`,n[`edgeTexture${a}`]=e[a].name;const r=`${i}varying vec2 v_textureCoordinates; \nvoid main() { \n    vec4 color = vec4(0.0); \n    for (int i = 0; i < ${e.length}; i++) \n    { \n${o}    } \n    gl_FragColor = color; \n} \n`,s=new D8e({name:"czm_edge_detection_combine",fragmentShader:r,uniforms:n});return new Z8e({name:"czm_edge_detection_composite",stages:[t,s]})}$8e.createBlurStage=function(){return e9e("czm_blur")},$8e.createDepthOfFieldStage=function(){const e=e9e("czm_depth_of_field_blur"),t=new D8e({name:"czm_depth_of_field_composite",fragmentShader:z8e,uniforms:{focalDistance:5,blurTexture:e.name}}),n={};return Object.defineProperties(n,{focalDistance:{get:function(){return t.uniforms.focalDistance},set:function(e){t.uniforms.focalDistance=e}},delta:{get:function(){return e.uniforms.delta},set:function(t){e.uniforms.delta=t}},sigma:{get:function(){return e.uniforms.sigma},set:function(t){e.uniforms.sigma=t}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(t){e.uniforms.stepSize=t}}}),new Z8e({name:"czm_depth_of_field",stages:[e,t],inputPreviousStageTexture:!1,uniforms:n})},$8e.isDepthOfFieldSupported=function(e){return e.context.depthTexture},$8e.createEdgeDetectionStage=function(){const e=wk();return new D8e({name:`czm_edge_detection_${e}`,fragmentShader:U8e,uniforms:{length:.25,color:xy.clone(xy.BLACK)}})},$8e.isEdgeDetectionSupported=function(e){return e.context.depthTexture},$8e.createSilhouetteStage=function(e){const t=t9e(e),n=new D8e({name:"czm_silhouette_color_edges",fragmentShader:K8e,uniforms:{silhouetteTexture:t.name}});return new Z8e({name:"czm_silhouette",stages:[t,n],inputPreviousStageTexture:!1,uniforms:t.uniforms})},$8e.isSilhouetteSupported=function(e){return e.context.depthTexture},$8e.createBloomStage=function(){const e=new D8e({name:"czm_bloom_contrast_bias",fragmentShader:F8e,uniforms:{contrast:128,brightness:-.3}}),t=e9e("czm_bloom_blur"),n=new Z8e({name:"czm_bloom_contrast_bias_blur",stages:[e,t]}),i=new D8e({name:"czm_bloom_generate_composite",fragmentShader:B8e,uniforms:{glowOnly:!1,bloomTexture:n.name}}),o={};return Object.defineProperties(o,{glowOnly:{get:function(){return i.uniforms.glowOnly},set:function(e){i.uniforms.glowOnly=e}},contrast:{get:function(){return e.uniforms.contrast},set:function(t){e.uniforms.contrast=t}},brightness:{get:function(){return e.uniforms.brightness},set:function(t){e.uniforms.brightness=t}},delta:{get:function(){return t.uniforms.delta},set:function(e){t.uniforms.delta=e}},sigma:{get:function(){return t.uniforms.sigma},set:function(e){t.uniforms.sigma=e}},stepSize:{get:function(){return t.uniforms.stepSize},set:function(e){t.uniforms.stepSize=e}}}),new Z8e({name:"czm_bloom",stages:[n,i],inputPreviousStageTexture:!1,uniforms:o})},$8e.createAmbientOcclusionStage=function(){const e=new D8e({name:"czm_ambient_occlusion_generate",fragmentShader:R8e,uniforms:{intensity:3,bias:.1,lengthCap:.26,stepSize:1.95,frustumLength:1e3,randomTexture:void 0}}),t=e9e("czm_ambient_occlusion_blur");t.uniforms.stepSize=.86;const n=new Z8e({name:"czm_ambient_occlusion_generate_blur",stages:[e,t]}),i=new D8e({name:"czm_ambient_occlusion_composite",fragmentShader:L8e,uniforms:{ambientOcclusionOnly:!1,ambientOcclusionTexture:n.name}}),o={};return Object.defineProperties(o,{intensity:{get:function(){return e.uniforms.intensity},set:function(t){e.uniforms.intensity=t}},bias:{get:function(){return e.uniforms.bias},set:function(t){e.uniforms.bias=t}},lengthCap:{get:function(){return e.uniforms.lengthCap},set:function(t){e.uniforms.lengthCap=t}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(t){e.uniforms.stepSize=t}},frustumLength:{get:function(){return e.uniforms.frustumLength},set:function(t){e.uniforms.frustumLength=t}},randomTexture:{get:function(){return e.uniforms.randomTexture},set:function(t){e.uniforms.randomTexture=t}},delta:{get:function(){return t.uniforms.delta},set:function(e){t.uniforms.delta=e}},sigma:{get:function(){return t.uniforms.sigma},set:function(e){t.uniforms.sigma=e}},blurStepSize:{get:function(){return t.uniforms.stepSize},set:function(e){t.uniforms.stepSize=e}},ambientOcclusionOnly:{get:function(){return i.uniforms.ambientOcclusionOnly},set:function(e){i.uniforms.ambientOcclusionOnly=e}}}),new Z8e({name:"czm_ambient_occlusion",stages:[n,i],inputPreviousStageTexture:!1,uniforms:o})},$8e.isAmbientOcclusionSupported=function(e){return e.context.depthTexture};const n9e=`#define FXAA_QUALITY_PRESET 39 \n${X8e}\n${H8e}`;$8e.createFXAAStage=function(){return new D8e({name:"czm_FXAA",fragmentShader:n9e,sampleMode:m8e.LINEAR})},$8e.createAcesTonemappingStage=function(e){let t=e?"#define AUTO_EXPOSURE\n":"";return t+=P8e,new D8e({name:"czm_aces",fragmentShader:t,uniforms:{autoExposure:void 0}})},$8e.createFilmicTonemappingStage=function(e){let t=e?"#define AUTO_EXPOSURE\n":"";return t+=V8e,new D8e({name:"czm_filmic",fragmentShader:t,uniforms:{autoExposure:void 0}})},$8e.createReinhardTonemappingStage=function(e){let t=e?"#define AUTO_EXPOSURE\n":"";return t+=Y8e,new D8e({name:"czm_reinhard",fragmentShader:t,uniforms:{autoExposure:void 0}})},$8e.createModifiedReinhardTonemappingStage=function(e){let t=e?"#define AUTO_EXPOSURE\n":"";return t+=q8e,new D8e({name:"czm_modified_reinhard",fragmentShader:t,uniforms:{white:xy.WHITE,autoExposure:void 0}})},$8e.createAutoExposureStage=function(){return new fWe},$8e.createBlackAndWhiteStage=function(){return new D8e({name:"czm_black_and_white",fragmentShader:M8e,uniforms:{gradations:5}})},$8e.createBrightnessStage=function(){return new D8e({name:"czm_brightness",fragmentShader:N8e,uniforms:{brightness:.5}})},$8e.createNightVisionStage=function(){return new D8e({name:"czm_night_vision",fragmentShader:j8e})},$8e.createDepthViewStage=function(){return new D8e({name:"czm_depth_view",fragmentShader:k8e})},$8e.createLensFlareStage=function(){return new D8e({name:"czm_lens_flare",fragmentShader:W8e,uniforms:{dirtTexture:Zi("Assets/Textures/LensFlare/DirtMask.jpg"),starTexture:Zi("Assets/Textures/LensFlare/StarBurst.jpg"),intensity:2,distortion:10,ghostDispersal:.4,haloWidth:.4,dirtAmount:.4,earthRadius:ge.WGS84.maximumRadius}})};var i9e=$8e;function o9e(e){this._collection=e,this._framebuffers=[],this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0,this._updateDependencies=!1}function r9e(e){while(C(e.length))e=e.get(e.length-1);return e.name}function s9e(e,t,n,i,o){if(!i.enabled||!i._isSupported(t))return o;const r=n[i.name]={};if(C(o)){const t=e.getStageByName(o);r[r9e(t)]=!0}const s=i.uniforms;if(C(s)){const t=Object.getOwnPropertyNames(s),n=t.length;for(let i=0;i<n;++i){const n=s[t[i]];if("string"===typeof n){const t=e.getStageByName(n);C(t)&&(r[r9e(t)]=!0)}}}return i.name}function a9e(e,t,n,i,o){if(C(i.enabled)&&!i.enabled||C(i._isSupported)&&!i._isSupported(t))return o;const r=o,s=!C(i.inputPreviousStageTexture)||i.inputPreviousStageTexture;let a=o;const c=i.length;for(let h=0;h<c;++h){const r=i.get(h);a=C(r.length)?a9e(e,t,n,r,o):s9e(e,t,n,r,o),s&&(o=a)}let l,u;if(s)for(l=1;l<c;++l)u=r9e(i.get(l)),C(n[u])||(n[u]={}),n[u][r]=!0;else for(l=1;l<c;++l){u=r9e(i.get(l));const e=n[u];for(let t=0;t<l;++t)e[r9e(i.get(t))]=!0}return a}function c9e(e,t){const n={};if(C(e.ambientOcclusion)){const i=e.ambientOcclusion,o=e.bloom,r=e._tonemapping,s=e.fxaa;let a=a9e(e,t,n,i,void 0);a=a9e(e,t,n,o,a),a=s9e(e,t,n,r,a),a=a9e(e,t,n,e,a),s9e(e,t,n,s,a)}else a9e(e,t,n,e,void 0);return n}function l9e(e,t,n){const i=e._collection,o=i.getStageByName(t),r=o._textureScale,s=o._forcePowerOfTwo,a=o._pixelFormat,c=o._pixelDatatype,l=o._clearColor;let u,h;const d=e._framebuffers,f=d.length;for(u=0;u<f;++u){if(h=d[u],r!==h.textureScale||s!==h.forcePowerOfTwo||a!==h.pixelFormat||c!==h.pixelDatatype||!xy.equals(l,h.clearColor))continue;const e=h.stages,t=e.length;let i=!1;for(let o=0;o<t;++o)if(n[e[o]]){i=!0;break}if(!i)break}return C(h)&&u<f?(h.stages.push(t),h):(h={textureScale:r,forcePowerOfTwo:s,pixelFormat:a,pixelDatatype:c,clearColor:l,stages:[t],buffer:new Tie({pixelFormat:a,pixelDatatype:c}),clear:void 0},d.push(h),h)}function u9e(e,t){const n=c9e(e._collection,t);for(const i in n)n.hasOwnProperty(i)&&(e._stageNameToFramebuffer[i]=l9e(e,i,n[i]))}function h9e(e){const t=e._framebuffers,n=t.length;for(let i=0;i<n;++i){const e=t[i];e.buffer.destroy()}}function d9e(e,t){const n=e._width,i=e._height,o=e._framebuffers,r=o.length;for(let s=0;s<r;++s){const e=o[s],r=e.textureScale;let a=Math.ceil(n*r),c=Math.ceil(i*r),l=Math.min(a,c);e.forcePowerOfTwo&&(z.isPowerOfTwo(l)||(l=z.nextPowerOfTwo(l)),a=l,c=l),e.buffer.update(t,a,c),e.clear=new tJ({color:e.clearColor,framebuffer:e.buffer.framebuffer})}}o9e.prototype.updateDependencies=function(){this._updateDependencies=!0},o9e.prototype.update=function(e){const t=this._collection,n=this._updateDependencies,i=C(t.ambientOcclusion)&&t.ambientOcclusion.enabled&&t.ambientOcclusion._isSupported(e),o=C(t.bloom)&&t.bloom.enabled&&t.bloom._isSupported(e),r=C(t._tonemapping)&&t._tonemapping.enabled&&t._tonemapping._isSupported(e),s=C(t.fxaa)&&t.fxaa.enabled&&t.fxaa._isSupported(e),a=!C(t._activeStages)||t._activeStages.length>0||i||o||r||s;if((n||!a&&this._framebuffers.length>0)&&(h9e(this),this._framebuffers.length=0,this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0),!n&&!a)return;0===this._framebuffers.length&&u9e(this,e);const c=e.drawingBufferWidth,l=e.drawingBufferHeight,u=this._width!==c||this._height!==l;(n||u)&&(this._width=c,this._height=l,this._updateDependencies=!1,h9e(this),d9e(this,e))},o9e.prototype.clear=function(e){const t=this._framebuffers;for(let n=0;n<t.length;++n)t[n].clear.execute(e)},o9e.prototype.getStageByName=function(e){return this._collection.getStageByName(e)},o9e.prototype.getOutputTexture=function(e){return this._collection.getOutputTexture(e)},o9e.prototype.getFramebuffer=function(e){const t=this._stageNameToFramebuffer[e];if(C(t))return t.buffer.framebuffer},o9e.prototype.isDestroyed=function(){return!1},o9e.prototype.destroy=function(){return h9e(this),Qh(this)};var f9e=o9e;const p9e={REINHARD:0,MODIFIED_REINHARD:1,FILMIC:2,ACES:3,validate:function(e){return e===p9e.REINHARD||e===p9e.MODIFIED_REINHARD||e===p9e.FILMIC||e===p9e.ACES}};var m9e=Object.freeze(p9e);const _9e=[];function g9e(){const e=i9e.createFXAAStage(),t=i9e.createAmbientOcclusionStage(),n=i9e.createBloomStage();this._autoExposureEnabled=!1,this._autoExposure=i9e.createAutoExposureStage(),this._tonemapping=void 0,this._tonemapper=void 0,this.tonemapper=m9e.ACES;const i=this._tonemapping;e.enabled=!1,t.enabled=!1,n.enabled=!1,i.enabled=!1;const o=new f9e(this),r={},s=_9e;s.push(e,t,n,i);while(s.length>0){const e=s.pop();r[e.name]=e,e._textureCache=o;const t=e.length;if(C(t))for(let n=0;n<t;++n)s.push(e.get(n))}this._stages=[],this._activeStages=[],this._previousActiveStages=[],this._randomTexture=void 0;const a=this;t.uniforms.randomTexture=function(){return a._randomTexture},this._ao=t,this._bloom=n,this._fxaa=e,this._aoEnabled=void 0,this._bloomEnabled=void 0,this._tonemappingEnabled=void 0,this._fxaaEnabled=void 0,this._activeStagesChanged=!1,this._stagesRemoved=!1,this._textureCacheDirty=!1,this._stageNames=r,this._textureCache=o}function y9e(e){if(!e._stagesRemoved)return;e._stagesRemoved=!1;const t=[],n=e._stages,i=n.length;for(let o=0,r=0;o<i;++o){const e=n[o];e&&(e._index=r++,t.push(e))}e._stages=t}function v9e(e){while(C(e.length))e=e.get(e.length-1);return e.outputTexture}function b9e(e,t,n,i,o){if(C(e.execute))return void e.execute(t,n,i,o);const r=e.length;let s;if(e.inputPreviousStageTexture)for(b9e(e.get(0),t,n,i,o),s=1;s<r;++s)b9e(e.get(s),t,v9e(e.get(s-1)),i,o);else for(s=0;s<r;++s)b9e(e.get(s),t,n,i,o)}Object.defineProperties(g9e.prototype,{ready:{get:function(){let e=!1;const t=this._stages,n=t.length;for(let a=n-1;a>=0;--a){const n=t[a];e=e||n.ready&&n.enabled}const i=this._fxaa,o=this._ao,r=this._bloom,s=this._tonemapping;return e=e||i.ready&&i.enabled,e=e||o.ready&&o.enabled,e=e||r.ready&&r.enabled,e=e||s.ready&&s.enabled,e}},fxaa:{get:function(){return this._fxaa}},ambientOcclusion:{get:function(){return this._ao}},bloom:{get:function(){return this._bloom}},length:{get:function(){return y9e(this),this._stages.length}},outputTexture:{get:function(){const e=this._fxaa;if(e.enabled&&e.ready)return this.getOutputTexture(e.name);const t=this._stages,n=t.length;for(let s=n-1;s>=0;--s){const e=t[s];if(C(e)&&e.ready&&e.enabled)return this.getOutputTexture(e.name)}const i=this._tonemapping;if(i.enabled&&i.ready)return this.getOutputTexture(i.name);const o=this._bloom;if(o.enabled&&o.ready)return this.getOutputTexture(o.name);const r=this._ao;return r.enabled&&r.ready?this.getOutputTexture(r.name):void 0}},hasSelected:{get:function(){const e=xF(this._stages);while(e.length>0){const t=e.pop();if(!C(t))continue;if(C(t.selected))return!0;const n=t.length;if(C(n))for(let i=0;i<n;++i)e.push(t.get(i))}return!1}},tonemapper:{get:function(){return this._tonemapper},set:function(e){if(this._tonemapper===e)return;if(!m9e.validate(e))throw new x("tonemapper was set to an invalid value.");C(this._tonemapping)&&(delete this._stageNames[this._tonemapping.name],this._tonemapping.destroy());const t=this._autoExposureEnabled;let n;switch(e){case m9e.REINHARD:n=i9e.createReinhardTonemappingStage(t);break;case m9e.MODIFIED_REINHARD:n=i9e.createModifiedReinhardTonemappingStage(t);break;case m9e.FILMIC:n=i9e.createFilmicTonemappingStage(t);break;default:n=i9e.createAcesTonemappingStage(t);break}if(t){const e=this._autoExposure;n.uniforms.autoExposure=function(){return e.outputTexture}}this._tonemapper=e,this._tonemapping=n,C(this._stageNames)&&(this._stageNames[n.name]=n,n._textureCache=this._textureCache),this._textureCacheDirty=!0}}}),g9e.prototype.add=function(e){D.typeOf.object("stage",e);const t=this._stageNames,n=_9e;n.push(e);while(n.length>0){const e=n.pop();if(C(t[e.name]))throw new x(`${e.name} has already been added to the collection or does not have a unique name.`);t[e.name]=e,e._textureCache=this._textureCache;const i=e.length;if(C(i))for(let t=0;t<i;++t)n.push(e.get(t))}const i=this._stages;return e._index=i.length,i.push(e),this._textureCacheDirty=!0,e},g9e.prototype.remove=function(e){if(!this.contains(e))return!1;const t=this._stageNames,n=_9e;n.push(e);while(n.length>0){const e=n.pop();delete t[e.name];const i=e.length;if(C(i))for(let t=0;t<i;++t)n.push(e.get(t))}return this._stages[e._index]=void 0,this._stagesRemoved=!0,this._textureCacheDirty=!0,e._index=void 0,e._textureCache=void 0,e.destroy(),!0},g9e.prototype.contains=function(e){return C(e)&&C(e._index)&&e._textureCache===this._textureCache},g9e.prototype.get=function(e){y9e(this);const t=this._stages,n=t.length;return D.typeOf.number.greaterThanOrEquals("stages length",n,0),D.typeOf.number.greaterThanOrEquals("index",e,0),D.typeOf.number.lessThan("index",e,n),t[e]},g9e.prototype.removeAll=function(){const e=this._stages,t=e.length;for(let n=0;n<t;++n)this.remove(e[n]);e.length=0},g9e.prototype.getStageByName=function(e){return this._stageNames[e]},g9e.prototype.update=function(e,t,n){y9e(this);const i=this._activeStages,o=this._activeStages=this._previousActiveStages;this._previousActiveStages=i;const r=this._stages;let s,a,c=o.length=r.length,l=0;for(s=0;s<c;++s)a=r[s],a.ready&&a.enabled&&a._isSupported(e)&&(o[l++]=a);o.length=l;let u=l!==i.length;if(!u)for(s=0;s<l;++s)if(o[s]!==i[s]){u=!0;break}const h=this._ao,d=this._bloom,f=this._autoExposure,p=this._tonemapping,m=this._fxaa;p.enabled=n;const _=h.enabled&&h._isSupported(e),g=d.enabled&&d._isSupported(e),y=p.enabled&&p._isSupported(e),v=m.enabled&&m._isSupported(e);if((u||this._textureCacheDirty||_!==this._aoEnabled||g!==this._bloomEnabled||y!==this._tonemappingEnabled||v!==this._fxaaEnabled)&&(this._textureCache.updateDependencies(),this._aoEnabled=_,this._bloomEnabled=g,this._tonemappingEnabled=y,this._fxaaEnabled=v,this._textureCacheDirty=!1),C(this._randomTexture)&&!_&&(this._randomTexture.destroy(),this._randomTexture=void 0),!C(this._randomTexture)&&_){c=196608;const t=new Uint8Array(c);for(s=0;s<c;s+=3)t[s]=Math.floor(255*Math.random());this._randomTexture=new Uk({context:e,pixelFormat:fD.RGB,pixelDatatype:hD.UNSIGNED_BYTE,source:{arrayBufferView:t,width:256,height:256},sampler:new Nk({wrapS:Mk.REPEAT,wrapT:Mk.REPEAT,minificationFilter:Rk.NEAREST,magnificationFilter:Dk.NEAREST})})}for(this._textureCache.update(e),m.update(e,t),h.update(e,t),d.update(e,t),p.update(e,t),this._autoExposureEnabled&&f.update(e,t),c=r.length,s=0;s<c;++s)r[s].update(e,t);for(l=0,s=0;s<c;++s)a=r[s],a.ready&&a.enabled&&a._isSupported(e)&&l++;u=l!==o.length,u&&this.update(e,t,n)},g9e.prototype.clear=function(e){this._textureCache.clear(e),this._autoExposureEnabled&&this._autoExposure.clear(e)},g9e.prototype.getOutputTexture=function(e){const t=this.getStageByName(e);if(C(t))return v9e(t)},g9e.prototype.execute=function(e,t,n,i){const o=this._activeStages,r=o.length,s=this._fxaa,a=this._ao,c=this._bloom,l=this._autoExposure,u=this._tonemapping,h=a.enabled&&a._isSupported(e),d=c.enabled&&c._isSupported(e),f=this._autoExposureEnabled,p=u.enabled&&u._isSupported(e),m=s.enabled&&s._isSupported(e);if(!m&&!h&&!d&&!p&&0===r)return;let _=t;h&&a.ready&&(b9e(a,e,_,n,i),_=v9e(a)),d&&c.ready&&(b9e(c,e,_,n,i),_=v9e(c)),f&&l.ready&&b9e(l,e,_,n,i),p&&u.ready&&(b9e(u,e,_,n,i),_=v9e(u));let g=_;if(r>0){b9e(o[0],e,_,n,i);for(let t=1;t<r;++t)b9e(o[t],e,v9e(o[t-1]),n,i);g=v9e(o[r-1])}m&&s.ready&&b9e(s,e,g,n,i)},g9e.prototype.copy=function(e,t){if(!C(this._copyColorCommand)){const t=this;this._copyColorCommand=e.createViewportQuadCommand(L0e,{uniformMap:{colorTexture:function(){return t.outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t,this._copyColorCommand.execute(e)},g9e.prototype.isDestroyed=function(){return!1},g9e.prototype.destroy=function(){return this._fxaa.destroy(),this._ao.destroy(),this._bloom.destroy(),this._autoExposure.destroy(),this._tonemapping.destroy(),this.removeAll(),this._textureCache=this._textureCache&&this._textureCache.destroy(),Qh(this)};var A9e=g9e;function w9e(){x.throwInstantiationError()}w9e.computeDefaultLevelZeroMaximumGeometricError=function(e){return 2*e.ellipsoid.maximumRadius*Math.PI*.25/(65*e.getNumberOfXTilesAtLevel(0))},Object.defineProperties(w9e.prototype,{quadtree:{get:x.throwInstantiationError,set:x.throwInstantiationError},ready:{get:x.throwInstantiationError},tilingScheme:{get:x.throwInstantiationError},errorEvent:{get:x.throwInstantiationError}}),w9e.prototype.update=x.throwInstantiationError,w9e.prototype.beginUpdate=x.throwInstantiationError,w9e.prototype.endUpdate=x.throwInstantiationError,w9e.prototype.getLevelMaximumGeometricError=x.throwInstantiationError,w9e.prototype.loadTile=x.throwInstantiationError,w9e.prototype.computeTileVisibility=x.throwInstantiationError,w9e.prototype.showTileThisFrame=x.throwInstantiationError,w9e.prototype.computeDistanceToTile=x.throwInstantiationError,w9e.prototype.isDestroyed=x.throwInstantiationError,w9e.prototype.destroy=x.throwInstantiationError;function T9e(e){D.typeOf.object("scene",e),this._scene=e,this._currentTweens=[],this._morphHandler=void 0,this._morphCancelled=!1,this._completeMorph=void 0,this._morphToOrthographic=!1}T9e.prototype.completeMorph=function(){C(this._completeMorph)&&this._completeMorph()},T9e.prototype.morphTo2D=function(e,t){C(this._completeMorph)&&this._completeMorph();const n=this._scene;this._previousMode=n.mode,this._morphToOrthographic=n.camera.frustum instanceof jC,this._previousMode!==ij.SCENE2D&&this._previousMode!==ij.MORPHING&&(this._scene.morphStart.raiseEvent(this,this._previousMode,ij.SCENE2D,!0),n._mode=ij.MORPHING,n.camera._setTransform(ft.IDENTITY),this._previousMode===ij.COLUMBUS_VIEW?g7e(this,e):E7e(this,e,t),0===e&&C(this._completeMorph)&&this._completeMorph())};const C9e=new K,E9e=new K,x9e=new K,S9e=new K,I9e=new K,O9e=new K,D9e=new K,P9e=new se,R9e=new ft,L9e=new nE,M9e=new jC,B9e={position:void 0,direction:void 0,up:void 0,position2D:void 0,direction2D:void 0,up2D:void 0,frustum:void 0};T9e.prototype.morphToColumbusView=function(e,t){C(this._completeMorph)&&this._completeMorph();const n=this._scene;if(this._previousMode=n.mode,this._previousMode===ij.COLUMBUS_VIEW||this._previousMode===ij.MORPHING)return;this._scene.morphStart.raiseEvent(this,this._previousMode,ij.COLUMBUS_VIEW,!0),n.camera._setTransform(ft.IDENTITY);let i=C9e;const o=E9e,r=x9e;if(e>0)i.x=0,i.y=-1,i.z=1,i=K.multiplyByScalar(K.normalize(i,i),5*t.maximumRadius,i),K.negate(K.normalize(i,o),o),K.cross(K.UNIT_X,o,r);else{const e=n.camera;if(this._previousMode===ij.SCENE2D)K.clone(e.position,i),i.z=e.frustum.right-e.frustum.left,K.negate(K.UNIT_Z,o),K.clone(K.UNIT_Y,r);else{K.clone(e.positionWC,i),K.clone(e.directionWC,o),K.clone(e.upWC,r);const s=t.scaleToGeodeticSurface(i,D9e),a=Kl.eastNorthUpToFixedFrame(s,t,R9e);ft.inverseTransformation(a,a),n.mapProjection.project(t.cartesianToCartographic(i,P9e),i),ft.multiplyByPointAsVector(a,o,o),ft.multiplyByPointAsVector(a,r,r)}}let s;this._morphToOrthographic?(s=M9e,s.width=n.camera.frustum.right-n.camera.frustum.left,s.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight):(s=L9e,s.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight,s.fov=z.toRadians(60));const a=B9e;a.position=i,a.direction=o,a.up=r,a.frustum=s;const c=R7e(a);z9e(this,c),this._previousMode===ij.SCENE2D?S7e(this,e,a,c):(a.position2D=ft.multiplyByPoint(TYe.TRANSFORM_2D,i,S9e),a.direction2D=ft.multiplyByPointAsVector(TYe.TRANSFORM_2D,o,I9e),a.up2D=ft.multiplyByPointAsVector(TYe.TRANSFORM_2D,r,O9e),n._mode=ij.MORPHING,I7e(this,e,a,c)),0===e&&C(this._completeMorph)&&this._completeMorph()};const N9e={position:new K,direction:new K,up:new K,frustum:void 0},F9e=new nE;function z9e(e,t){if(e._scene.completeMorphOnUserInput){e._morphHandler=new BM(e._scene.canvas);const n=function(){e._morphCancelled=!0,e._scene.camera.cancelFlight(),t(e)};e._completeMorph=n,e._morphHandler.setInputAction(n,JL.LEFT_DOWN),e._morphHandler.setInputAction(n,JL.MIDDLE_DOWN),e._morphHandler.setInputAction(n,JL.RIGHT_DOWN),e._morphHandler.setInputAction(n,JL.WHEEL)}}function k9e(e){const t=e._currentTweens;for(let n=0;n<t.length;++n)t[n].cancelTween();e._currentTweens.length=0,e._morphHandler=e._morphHandler&&e._morphHandler.destroy()}T9e.prototype.morphTo3D=function(e,t){C(this._completeMorph)&&this._completeMorph();const n=this._scene;if(this._previousMode=n.mode,this._previousMode!==ij.SCENE3D&&this._previousMode!==ij.MORPHING){if(this._scene.morphStart.raiseEvent(this,this._previousMode,ij.SCENE3D,!0),n._mode=ij.MORPHING,n.camera._setTransform(ft.IDENTITY),this._previousMode===ij.SCENE2D)o7e(this,e,t);else{let i,o;e>0?(i=N9e,K.fromDegrees(0,0,5*t.maximumRadius,t,i.position),K.negate(i.position,i.direction),K.normalize(i.direction,i.direction),K.clone(K.UNIT_Z,i.up)):i=G9e(this,t);const r=n.camera;r.frustum instanceof jC?o=r.frustum.clone():(o=F9e,o.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight,o.fov=z.toRadians(60)),i.frustum=o;const s=D7e(i);z9e(this,s),Q9e(this,e,i,s)}0===e&&C(this._completeMorph)&&this._completeMorph()}},T9e.prototype.isDestroyed=function(){return!1},T9e.prototype.destroy=function(){return k9e(this),Qh(this)};const U9e=new se,V9e=new K,H9e=new ft;function G9e(e,t){const n=e._scene,i=n.camera,o=N9e,r=o.position,s=o.direction,a=o.up,c=n.mapProjection.unproject(i.position,U9e);t.cartographicToCartesian(c,r);const l=t.scaleToGeodeticSurface(r,V9e),u=Kl.eastNorthUpToFixedFrame(l,t,H9e);return ft.multiplyByPointAsVector(u,i.direction,s),ft.multiplyByPointAsVector(u,i.up,a),o}const W9e=new K,q9e=new K,j9e=new K,Y9e=new K,K9e=new K,X9e=new K;function Q9e(e,t,n,i){t*=.5;const o=e._scene,r=o.camera,s=K.clone(r.position,W9e),a=K.clone(r.direction,q9e),c=K.clone(r.up,j9e),l=ft.multiplyByPoint(TYe.TRANSFORM_2D_INVERSE,n.position,Y9e),u=ft.multiplyByPointAsVector(TYe.TRANSFORM_2D_INVERSE,n.direction,K9e),h=ft.multiplyByPointAsVector(TYe.TRANSFORM_2D_INVERSE,n.up,X9e);function d(e){r7e(s,l,e.time,r.position),r7e(a,u,e.time,r.direction),r7e(c,h,e.time,r.up),K.cross(r.direction,r.up,r.right),K.normalize(r.right,r.right)}const f=o.tweens.add({duration:t,easingFunction:rC.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:d,complete:function(){O7e(e,o,0,1,t,i)}});e._currentTweens.push(f)}const J9e=new jC,Z9e=new K,$9e=new K,e7e=new K,t7e=new K,n7e=new K,i7e=new K;function o7e(e,t,n){t/=3;const i=e._scene,o=i.camera;let r,s;t>0?(r=N9e,K.fromDegrees(0,0,5*n.maximumRadius,n,r.position),K.negate(r.position,r.direction),K.normalize(r.direction,r.direction),K.clone(K.UNIT_Z,r.up)):(o.position.z=o.frustum.right-o.frustum.left,r=G9e(e,n)),e._morphToOrthographic?(s=J9e,s.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,s.width=o.frustum.right-o.frustum.left):(s=F9e,s.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,s.fov=z.toRadians(60)),r.frustum=s;const a=D7e(r);let c;z9e(e,a),c=e._morphToOrthographic?function(){Q9e(e,t,r,a)}:function(){x7e(e,t,r,(function(){Q9e(e,t,r,a)}))},t>0?(i._mode=ij.SCENE2D,o.flyTo({duration:t,destination:K.fromDegrees(0,0,5*n.maximumRadius,n,t7e),complete:function(){i._mode=ij.MORPHING,c()}})):c()}function r7e(e,t,n,i){return K.lerp(e,t,n,i)}function s7e(e,t,n,i,o){const r=e._scene,s=r.camera;if(s.frustum instanceof jC)return;const a=s.frustum.fov,c=.5*z.RADIANS_PER_DEGREE,l=n.position.z*Math.tan(.5*a);function u(e){s.frustum.fov=z.lerp(a,c,e.time);const t=l/Math.tan(.5*s.frustum.fov);i(s,t)}s.frustum.far=l/Math.tan(.5*c)+1e7;const h=r.tweens.add({duration:t,easingFunction:rC.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:u,complete:function(){s.frustum=n.frustum.clone(),o(e)}});e._currentTweens.push(h)}const a7e=new K,c7e=new K,l7e=new K,u7e=new K,h7e=new K,d7e=new K,f7e=new GC,p7e=new os,m7e=new K,_7e={position:void 0,direction:void 0,up:void 0,frustum:void 0};function g7e(e,t){t*=.5;const n=e._scene,i=n.camera,o=K.clone(i.position,a7e),r=K.clone(i.direction,c7e),s=K.clone(i.up,l7e),a=K.negate(K.UNIT_Z,h7e),c=K.clone(K.UNIT_Y,d7e),l=u7e;if(t>0)K.clone(K.ZERO,u7e),l.z=5*n.mapProjection.ellipsoid.maximumRadius;else{K.clone(o,u7e);const e=p7e;ft.multiplyByPoint(TYe.TRANSFORM_2D,o,e.origin),ft.multiplyByPointAsVector(TYe.TRANSFORM_2D,r,e.direction);const t=n.globe;if(C(t)){const i=t.pickWorldCoordinates(e,n,!0,m7e);C(i)&&(ft.multiplyByPoint(TYe.TRANSFORM_2D_INVERSE,i,l),l.z+=K.distance(o,l))}}const u=f7e;u.right=.5*l.z,u.left=-u.right,u.top=u.right*(n.drawingBufferHeight/n.drawingBufferWidth),u.bottom=-u.top;const h=_7e;h.position=l,h.direction=a,h.up=c,h.frustum=u;const d=P7e(h);function f(e){r7e(o,l,e.time,i.position),r7e(r,a,e.time,i.direction),r7e(s,c,e.time,i.up),K.cross(i.direction,i.up,i.right),K.normalize(i.right,i.right),i._adjustOrthographicFrustum(!0)}function p(e,t){e.position.z=t}z9e(e,d);const m=n.tweens.add({duration:t,easingFunction:rC.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:f,complete:function(){s7e(e,t,h,p,d)}});e._currentTweens.push(m)}const y7e=new se,v7e={position:new K,direction:new K,up:new K,position2D:new K,direction2D:new K,up2D:new K,frustum:new GC},b7e={position:new K,direction:new K,up:new K,frustum:void 0},A7e=new K,w7e=new os,T7e=new ft,C7e=new K;function E7e(e,t,n){t*=.5;const i=e._scene,o=i.camera,r=v7e;if(t>0)K.clone(K.ZERO,r.position),r.position.z=5*n.maximumRadius,K.negate(K.UNIT_Z,r.direction),K.clone(K.UNIT_Y,r.up);else{n.cartesianToCartographic(o.positionWC,y7e),i.mapProjection.project(y7e,r.position),K.negate(K.UNIT_Z,r.direction),K.clone(K.UNIT_Y,r.up);const e=w7e;K.clone(r.position2D,e.origin);const t=K.clone(o.directionWC,e.direction),s=n.scaleToGeodeticSurface(o.positionWC,C7e),a=Kl.eastNorthUpToFixedFrame(s,n,T7e);ft.inverseTransformation(a,a),ft.multiplyByPointAsVector(a,t,t),ft.multiplyByPointAsVector(TYe.TRANSFORM_2D,t,t);const c=i.globe;if(C(c)){const t=c.pickWorldCoordinates(e,i,!0,A7e);if(C(t)){const e=K.distance(r.position2D,t);t.x+=e,K.clone(t,r.position2D)}}}function s(e,t){e.position.x=t}ft.multiplyByPoint(TYe.TRANSFORM_2D,r.position,r.position2D),ft.multiplyByPointAsVector(TYe.TRANSFORM_2D,r.direction,r.direction2D),ft.multiplyByPointAsVector(TYe.TRANSFORM_2D,r.up,r.up2D);const a=r.frustum;a.right=.5*r.position.z,a.left=-a.right,a.top=a.right*(i.drawingBufferHeight/i.drawingBufferWidth),a.bottom=-a.top;const c=b7e;ft.multiplyByPoint(TYe.TRANSFORM_2D_INVERSE,r.position2D,c.position),K.clone(r.direction,c.direction),K.clone(r.up,c.up),c.frustum=a;const l=P7e(c);function u(){s7e(e,t,r,s,l)}z9e(e,l),I7e(e,t,r,u)}function x7e(e,t,n,i){const o=e._scene,r=o.camera,s=r.frustum.right-r.frustum.left;r.frustum=n.frustum.clone();const a=r.frustum.fov,c=.5*z.RADIANS_PER_DEGREE,l=s*Math.tan(.5*a);function u(e){r.frustum.fov=z.lerp(c,a,e.time),r.position.z=l/Math.tan(.5*r.frustum.fov)}r.frustum.far=l/Math.tan(.5*c)+1e7,r.frustum.fov=c;const h=o.tweens.add({duration:t,easingFunction:rC.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:u,complete:function(){i(e)}});e._currentTweens.push(h)}function S7e(e,t,n,i){t*=.5;const o=e._scene,r=o.camera,s=K.clone(n.position,t7e),a=K.clone(n.direction,n7e),c=K.clone(n.up,i7e);function l(){r.frustum=n.frustum.clone();const l=K.clone(r.position,Z9e),u=K.clone(r.direction,$9e),h=K.clone(r.up,e7e);function d(e){r7e(l,s,e.time,r.position),r7e(u,a,e.time,r.direction),r7e(h,c,e.time,r.up),K.cross(r.direction,r.up,r.right),K.normalize(r.right,r.right)}l.z=s.z;const f=o.tweens.add({duration:t,easingFunction:rC.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:d,complete:function(){i(e)}});e._currentTweens.push(f)}o._mode=ij.MORPHING,e._morphToOrthographic?l():x7e(e,0,n,l)}function I7e(e,t,n,i){const o=e._scene,r=o.camera,s=K.clone(r.position,Z9e),a=K.clone(r.direction,$9e),c=K.clone(r.up,e7e),l=K.clone(n.position2D,t7e),u=K.clone(n.direction2D,n7e),h=K.clone(n.up2D,i7e);function d(e){r7e(s,l,e.time,r.position),r7e(a,u,e.time,r.direction),r7e(c,h,e.time,r.up),K.cross(r.direction,r.up,r.right),K.normalize(r.right,r.right),r._adjustOrthographicFrustum(!0)}const f=o.tweens.add({duration:t,easingFunction:rC.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:d,complete:function(){O7e(e,o,1,0,t,i)}});e._currentTweens.push(f)}function O7e(e,t,n,i,o,r){const s={object:t,property:"morphTime",startValue:n,stopValue:i,duration:o,easingFunction:rC.QUARTIC_OUT};C(r)&&(s.complete=function(){r(e)});const a=t.tweens.addProperty(s);e._currentTweens.push(a)}function D7e(e){return function(t){const n=t._scene;n._mode=ij.SCENE3D,n.morphTime=ij.getMorphTime(ij.SCENE3D),k9e(t);const i=n.camera;(t._previousMode!==ij.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,K.clone(e.position,i.position),K.clone(e.direction,i.direction),K.clone(e.up,i.up),K.cross(i.direction,i.up,i.right),K.normalize(i.right,i.right),i.frustum=e.frustum.clone());const o=i.frustum;n.frameState.useLogDepth&&(o.near=.1,o.far=1e10);const r=C(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,ij.SCENE3D,r)}}function P7e(e){return function(t){const n=t._scene;n._mode=ij.SCENE2D,n.morphTime=ij.getMorphTime(ij.SCENE2D),k9e(t);const i=n.camera;K.clone(e.position,i.position),i.position.z=2*n.mapProjection.ellipsoid.maximumRadius,K.clone(e.direction,i.direction),K.clone(e.up,i.up),K.cross(i.direction,i.up,i.right),K.normalize(i.right,i.right),i.frustum=e.frustum.clone();const o=C(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,ij.SCENE2D,o)}}function R7e(e){return function(t){const n=t._scene;n._mode=ij.COLUMBUS_VIEW,n.morphTime=ij.getMorphTime(ij.COLUMBUS_VIEW),k9e(t);const i=n.camera;(t._previousModeMode!==ij.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,K.clone(e.position,i.position),K.clone(e.direction,i.direction),K.clone(e.up,i.up),K.cross(i.direction,i.up,i.right),K.normalize(i.right,i.right));const o=i.frustum;n.frameState.useLogDepth&&(o.near=.1,o.far=1e10);const r=C(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,ij.COLUMBUS_VIEW,r)}}var L7e=T9e;function M7e(e,t,n,i,o,r,s,a,c,l){this._tweens=e,this._tweenjs=t,this._startObject=pn(n),this._stopObject=pn(i),this._duration=o,this._delay=r,this._easingFunction=s,this._update=a,this._complete=c,this.cancel=l,this.needsStart=!0}function B7e(){this._tweens=[]}Object.defineProperties(M7e.prototype,{startObject:{get:function(){return this._startObject}},stopObject:{get:function(){return this._stopObject}},duration:{get:function(){return this._duration}},delay:{get:function(){return this._delay}},easingFunction:{get:function(){return this._easingFunction}},update:{get:function(){return this._update}},complete:{get:function(){return this._complete}},tweenjs:{get:function(){return this._tweenjs}}}),M7e.prototype.cancelTween=function(){this._tweens.remove(this)},Object.defineProperties(B7e.prototype,{length:{get:function(){return this._tweens.length}}}),B7e.prototype.add=function(e){if(e=R(e,R.EMPTY_OBJECT),!C(e.startObject)||!C(e.stopObject))throw new x("options.startObject and options.stopObject are required.");if(!C(e.duration)||e.duration<0)throw new x("options.duration is required and must be positive.");if(0===e.duration)return C(e.complete)&&e.complete(),new M7e(this);const t=e.duration/ta.SECONDS_PER_MILLISECOND,n=R(e.delay,0),i=n/ta.SECONDS_PER_MILLISECOND,o=R(e.easingFunction,rC.LINEAR_NONE),r=e.startObject,s=new iC.Tween(r);s.to(pn(e.stopObject),t),s.delay(i),s.easing(o),C(e.update)&&s.onUpdate((function(){e.update(r)})),s.onComplete(R(e.complete,null)),s.repeat(R(e._repeat,0));const a=new M7e(this,s,e.startObject,e.stopObject,e.duration,n,o,e.update,e.complete,e.cancel);return this._tweens.push(a),a},B7e.prototype.addProperty=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.object,n=e.property,i=e.startValue,o=e.stopValue;if(!C(t)||!C(e.property))throw new x("options.object and options.property are required.");if(!C(t[n]))throw new x("options.object must have the specified property.");if(!C(i)||!C(o))throw new x("options.startValue and options.stopValue are required.");function r(e){t[n]=e.value}return this.add({startObject:{value:i},stopObject:{value:o},duration:R(e.duration,3),delay:e.delay,easingFunction:e.easingFunction,update:r,complete:e.complete,cancel:e.cancel,_repeat:e._repeat})},B7e.prototype.addAlpha=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.material;if(!C(t))throw new x("options.material is required.");const n=[];for(const o in t.uniforms)t.uniforms.hasOwnProperty(o)&&C(t.uniforms[o])&&C(t.uniforms[o].alpha)&&n.push(o);if(0===n.length)throw new x("material has no properties with alpha components.");function i(e){const i=n.length;for(let o=0;o<i;++o)t.uniforms[n[o]].alpha=e.alpha}return this.add({startObject:{alpha:R(e.startValue,0)},stopObject:{alpha:R(e.stopValue,1)},duration:R(e.duration,3),delay:e.delay,easingFunction:e.easingFunction,update:i,complete:e.complete,cancel:e.cancel})},B7e.prototype.addOffsetIncrement=function(e){e=R(e,R.EMPTY_OBJECT);const t=e.material;if(!C(t))throw new x("material is required.");if(!C(t.uniforms.offset))throw new x("material.uniforms must have an offset property.");const n=t.uniforms;return this.addProperty({object:n,property:"offset",startValue:n.offset,stopValue:n.offset+1,duration:e.duration,delay:e.delay,easingFunction:e.easingFunction,update:e.update,cancel:e.cancel,_repeat:1/0})},B7e.prototype.remove=function(e){if(!C(e))return!1;const t=this._tweens.indexOf(e);return-1!==t&&(e.tweenjs.stop(),C(e.cancel)&&e.cancel(),this._tweens.splice(t,1),!0)},B7e.prototype.removeAll=function(){const e=this._tweens;for(let t=0;t<e.length;++t){const n=e[t];n.tweenjs.stop(),C(n.cancel)&&n.cancel()}e.length=0},B7e.prototype.contains=function(e){return C(e)&&-1!==this._tweens.indexOf(e)},B7e.prototype.get=function(e){if(!C(e))throw new x("index is required.");return this._tweens[e]},B7e.prototype.update=function(e){const t=this._tweens;let n=0;e=C(e)?e/ta.SECONDS_PER_MILLISECOND:py();while(n<t.length){const i=t[n],o=i.tweenjs;i.needsStart?(i.needsStart=!1,o.start(e)):o.update(e)?n++:(o.stop(),t.splice(n,1))}};var N7e=B7e;function F7e(e){if(!C(e))throw new x("scene is required.");this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=EYe.LEFT_DRAG,this.zoomEventTypes=[EYe.RIGHT_DRAG,EYe.WHEEL,EYe.PINCH],this.rotateEventTypes=EYe.LEFT_DRAG,this.tiltEventTypes=[EYe.MIDDLE_DRAG,EYe.PINCH,{eventType:EYe.LEFT_DRAG,modifier:yO.CTRL},{eventType:EYe.RIGHT_DRAG,modifier:yO.CTRL}],this.lookEventTypes={eventType:EYe.LEFT_DRAG,modifier:yO.SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=e,this._globe=void 0,this._ellipsoid=void 0,this._aggregator=new MYe(e.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._inertiaDisablers={_lastInertiaZoomMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement","_lastInertiaTiltMovement"],_lastInertiaTiltMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement"]},this._tweens=new N7e,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new ro(-1,-1),this._tiltCenter=new K,this._rotateMousePosition=new ro(-1,-1),this._rotateStartPosition=new K,this._strafeStartPosition=new K,this._strafeMousePosition=new ro,this._strafeEndMousePosition=new ro,this._zoomMouseStart=new ro(-1,-1),this._zoomWorldPosition=new K,this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._zoomingUnderground=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1,this._cameraUnderground=!1;const t=e.mapProjection;this._maxCoord=t.project(new se(Math.PI,z.PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3,this._minimumUndergroundPickDistance=2e3,this._maximumUndergroundPickDistance=1e4}function z7e(e,t){if(e<0)return 0;const n=25*(1-t);return Math.exp(-n*e)}function k7e(e){return ro.equalsEpsilon(e.startPosition,e.endPosition,z.EPSILON14)}const U7e=.4;function V7e(e,t,n,i,o,r,s){let a=r[s];C(a)||(a=r[s]={startPosition:new ro,endPosition:new ro,motion:new ro,inertiaEnabled:!0});const c=e.getButtonPressTime(t,n),l=e.getButtonReleaseTime(t,n),u=c&&l&&(l.getTime()-c.getTime())/1e3,h=new Date,d=l&&(h.getTime()-l.getTime())/1e3;if(c&&l&&u<U7e){const s=z7e(d,i),c=e.getLastMovement(t,n);if(!C(c)||k7e(c)||!a.inertiaEnabled)return;if(a.motion.x=.5*(c.endPosition.x-c.startPosition.x),a.motion.y=.5*(c.endPosition.y-c.startPosition.y),a.startPosition=ro.clone(c.startPosition,a.startPosition),a.endPosition=ro.multiplyByScalar(a.motion,s,a.endPosition),a.endPosition=ro.add(a.startPosition,a.endPosition,a.endPosition),isNaN(a.endPosition.x)||isNaN(a.endPosition.y)||ro.distance(a.startPosition,a.endPosition)<.5)return;if(!e.isButtonDown(t,n)){const i=e.getStartMousePosition(t,n);o(r,i,a)}}}function H7e(e,t){if(C(t)){let n=e[t];C(n)&&(n.inertiaEnabled=!0);const i=e._inertiaDisablers[t];if(C(i)){const t=i.length;for(let o=0;o<t;++o)n=e[i[o]],C(n)&&(n.inertiaEnabled=!1)}}}const G7e=[];function W7e(e,t,n,i,o,r){if(!C(n))return;const s=e._aggregator;Array.isArray(n)||(G7e[0]=n,n=G7e);const a=n.length;for(let c=0;c<a;++c){const a=n[c],l=C(a.eventType)?a.eventType:a,u=a.modifier,h=s.isMoving(l,u)&&s.getMovement(l,u),d=s.getStartMousePosition(l,u);e.enableInputs&&t&&(h?(i(e,d,h),H7e(e,r)):o<1&&V7e(s,l,u,o,i,e,r))}}const q7e=new os,j7e=new K,Y7e=new ro,K7e=new K,X7e=new ro,Q7e=new K,J7e=new K,Z7e=new K,$7e=new K,eet=new K,tet=new K,net=new K,iet=new K,oet=new K,ret=new K,set=new K,aet=new K,cet=new K,uet=new K,het=new K,det=new K,fet=new K,pet=new K,met={orientation:new Ma};function _et(e,t,n,i,o,r){let s=1;C(r)&&(s=z.clamp(Math.abs(r),.25,1));const a=n.endPosition.y-n.startPosition.y,c=a>0,l=c?e.minimumZoomDistance*s:0,u=e.maximumZoomDistance,h=o-l;let d=i*h;d=z.clamp(d,e._minimumZoomRate,e._maximumZoomRate);let f=a/e._scene.canvas.clientHeight;f=Math.min(f,e.maximumMovementRatio);let p=d*f;if(e.enableCollisionDetection||0===e.minimumZoomDistance||!C(e._globe)){if(p>0&&Math.abs(o-l)<1)return;if(p<0&&Math.abs(o-u)<1)return;o-p<l?p=o-l-1:o-p>u&&(p=o-u)}const m=e._scene,_=m.camera,g=m.mode,y=met.orientation;if(y.heading=_.heading,y.pitch=_.pitch,y.roll=_.roll,_.frustum instanceof jC)return void(Math.abs(p)>0&&(_.zoomIn(p),_._adjustOrthographicFrustum()));const v=ro.equals(t,e._zoomMouseStart);let b,A=e._zoomingOnVector,w=e._rotatingZoom;if(v||(e._zoomMouseStart=ro.clone(t,e._zoomMouseStart),C(e._globe)&&(g===ij.SCENE2D?(b=_.getPickRay(t,q7e).origin,b=K.fromElements(b.y,b.z,b.x)):b=Det(e,t,j7e)),C(b)?(e._useZoomWorldPosition=!0,e._zoomWorldPosition=K.clone(b,e._zoomWorldPosition)):e._useZoomWorldPosition=!1,A=e._zoomingOnVector=!1,w=e._rotatingZoom=!1,e._zoomingUnderground=e._cameraUnderground),!e._useZoomWorldPosition)return void _.zoomIn(p);let T=g===ij.COLUMBUS_VIEW;if(_.positionCartographic.height<2e6&&(w=!0),!v||w){if(g===ij.SCENE2D){const n=e._zoomWorldPosition,i=_.position;if(!K.equals(n,i)&&_.positionCartographic.height<2*e._maxCoord.x){const o=_.position.x,r=K.subtract(n,i,K7e);K.normalize(r,r);const s=K.distance(n,i)*p/(.5*_.getMagnitude());_.move(r,.5*s),(_.position.x<0&&o>0||_.position.x>0&&o<0)&&(b=_.getPickRay(t,q7e).origin,b=K.fromElements(b.y,b.z,b.x),e._zoomWorldPosition=K.clone(b,e._zoomWorldPosition))}}else if(g===ij.SCENE3D){const t=K.normalize(_.position,eet);if(e._cameraUnderground||e._zoomingUnderground||_.positionCartographic.height<3e3&&Math.abs(K.dot(_.direction,t))<.6)T=!0;else{const n=m.canvas,i=X7e;i.x=n.clientWidth/2,i.y=n.clientHeight/2;const o=Det(e,i,Q7e);if(C(o))if(_.positionCartographic.height<1e6){if(!(K.dot(_.direction,t)>=-.5)){const n=net;K.clone(_.position,n);const i=e._zoomWorldPosition;let o=tet;if(o=K.normalize(i,o),K.dot(o,t)<0)return;const r=het,s=ret;K.clone(_.direction,s),K.add(n,K.multiplyByScalar(s,1e3,det),r);const a=set,c=aet;K.subtract(i,n,a),K.normalize(a,c);const l=K.dot(t,c);if(l>=0)return void(e._zoomMouseStart.x=-1);const u=Math.acos(-l),h=K.magnitude(n),d=K.magnitude(i),f=h-p,m=K.magnitude(a),g=Math.asin(z.clamp(m/d*Math.sin(u),-1,1)),y=Math.asin(z.clamp(f/d*Math.sin(u),-1,1)),v=g-y+u,b=iet;K.normalize(n,b);let A=oet;A=K.cross(c,b,A),A=K.normalize(A,A),K.normalize(K.cross(b,A,det),s),K.multiplyByScalar(K.normalize(r,det),K.magnitude(r)-p,r),K.normalize(n,n),K.multiplyByScalar(n,f,n);const w=cet;K.multiplyByScalar(K.add(K.multiplyByScalar(b,Math.cos(v)-1,fet),K.multiplyByScalar(s,Math.sin(v),pet),det),f,w),K.add(n,w,n),K.normalize(r,b),K.normalize(K.cross(b,A,det),s);const T=uet;return K.multiplyByScalar(K.add(K.multiplyByScalar(b,Math.cos(v)-1,fet),K.multiplyByScalar(s,Math.sin(v),pet),det),K.magnitude(r),T),K.add(r,T,r),K.clone(n,_.position),K.normalize(K.subtract(r,n,det),_.direction),K.clone(_.direction,_.direction),K.cross(_.direction,_.up,_.right),K.cross(_.right,_.direction,_.up),void _.setView(met)}T=!0}else{const t=K.normalize(o,J7e),n=K.normalize(e._zoomWorldPosition,Z7e),i=K.dot(n,t);if(i>0&&i<1){const e=z.acosClamped(i),o=K.cross(n,t,$7e),r=Math.abs(e)>z.toRadians(20)?.75*_.positionCartographic.height:_.positionCartographic.height-p,s=p/r;_.rotate(o,e*s)}}else T=!0}}e._rotatingZoom=!T}if(!v&&T||A){let n;const i=Aoe.wgs84ToWindowCoordinates(m,e._zoomWorldPosition,Y7e);n=g!==ij.COLUMBUS_VIEW&&ro.equals(t,e._zoomMouseStart)&&C(i)?_.getPickRay(i,q7e):_.getPickRay(t,q7e);const o=n.direction;g!==ij.COLUMBUS_VIEW&&g!==ij.SCENE2D||K.fromElements(o.y,o.z,o.x,o),_.move(o,p),e._zoomingOnVector=!0}else _.zoomIn(p);e._cameraUnderground||_.setView(met)}const get=new os,yet=new os,vet=new K;function bet(e,t,n){const i=e._scene,o=i.camera;let r=o.getPickRay(n.startPosition,get).origin,s=o.getPickRay(n.endPosition,yet).origin;r=K.fromElements(r.y,r.z,r.x,r),s=K.fromElements(s.y,s.z,s.x,s);const a=K.subtract(r,s,vet),c=K.magnitude(a);c>0&&(K.normalize(a,a),o.move(a,c))}function Aet(e,t,n){C(n.distance)&&(n=n.distance);const i=e._scene,o=i.camera;_et(e,t,n,e._zoomFactor,o.getMagnitude())}const wet=new ro,Tet=new ro;function Cet(e,t,n){if(C(n.angleAndHeight))return void Eet(e,t,n.angleAndHeight);const i=e._scene,o=i.camera,r=i.canvas,s=r.clientWidth,a=r.clientHeight;let c=wet;c.x=2/s*n.startPosition.x-1,c.y=2/a*(a-n.startPosition.y)-1,c=ro.normalize(c,c);let l=Tet;l.x=2/s*n.endPosition.x-1,l.y=2/a*(a-n.endPosition.y)-1,l=ro.normalize(l,l);let u=z.acosClamped(c.x);c.y<0&&(u=z.TWO_PI-u);let h=z.acosClamped(l.x);l.y<0&&(h=z.TWO_PI-h);const d=h-u;o.twistRight(d)}function Eet(e,t,n){let i=e._rotateFactor*e._rotateRateRangeAdjustment;i>e._maximumRotateRate&&(i=e._maximumRotateRate),i<e._minimumRotateRate&&(i=e._minimumRotateRate);const o=e._scene,r=o.camera,s=o.canvas;let a=(n.endPosition.x-n.startPosition.x)/s.clientWidth;a=Math.min(a,e.maximumMovementRatio);const c=i*a*Math.PI*4;r.twistRight(c)}function xet(e){const t=e._scene.mapMode2D===$We.ROTATE;ft.equals(ft.IDENTITY,e._scene.camera.transform)?(W7e(e,e.enableTranslate,e.translateEventTypes,bet,e.inertiaTranslate,"_lastInertiaTranslateMovement"),W7e(e,e.enableZoom,e.zoomEventTypes,Aet,e.inertiaZoom,"_lastInertiaZoomMovement"),t&&W7e(e,e.enableRotate,e.tiltEventTypes,Cet,e.inertiaSpin,"_lastInertiaTiltMovement")):(W7e(e,e.enableZoom,e.zoomEventTypes,Aet,e.inertiaZoom,"_lastInertiaZoomMovement"),t&&W7e(e,e.enableRotate,e.translateEventTypes,Cet,e.inertiaSpin,"_lastInertiaSpinMovement"))}const Set=new os,Iet=new K,Oet=new K;function Det(e,t,n){const i=e._scene,o=e._globe,r=i.camera;if(!C(o))return;const s=!e._cameraUnderground;let a;i.pickPositionSupported&&(a=i.pickPositionWorldCoordinates(t,Iet));const c=r.getPickRay(t,Set),l=o.pickWorldCoordinates(c,i,s,Oet),u=C(a)?K.distance(a,r.positionWC):Number.POSITIVE_INFINITY,h=C(l)?K.distance(l,r.positionWC):Number.POSITIVE_INFINITY;return u<h?K.clone(a,n):K.clone(l,n)}const Pet=new se;function Ret(e){const t=e._ellipsoid,n=e._scene,i=n.camera,o=n.mode;let r=0;if(o===ij.SCENE3D){const e=t.cartesianToCartographic(i.position,Pet);C(e)&&(r=e.height)}else r=i.position.z;const s=R(e._scene.globeHeight,0),a=Math.abs(s-r);return a}const Let=new K;function Met(e,t){const n=t.origin,i=t.direction,o=Ret(e),r=K.normalize(n,Let);let s=Math.abs(K.dot(r,i));return s=2*Math.max(s,.5),o*s}function Bet(e,t,n,i){let o=K.distance(t.origin,n);const r=Ret(e),s=z.clamp(5*r,e._minimumUndergroundPickDistance,e._maximumUndergroundPickDistance);return o>s&&(o=Math.min(o,r/5),o=Math.max(o,100)),os.getPoint(t,o,i)}function Net(e,t,n,i){let o;return C(n)?(o=K.distance(t.origin,n),o>e._maximumUndergroundPickDistance&&(o=Ret(e))):o=Ret(e),os.getPoint(t,o,i)}const Fet=new ro;function zet(e,t){const n=t.endPosition,i=ro.subtract(t.endPosition,t.startPosition,Fet),o=e._strafeEndMousePosition;ro.add(o,i,o),t.endPosition=o,wtt(e,t,e._strafeStartPosition),t.endPosition=n}const ket=new os,Uet=new os,Vet=new K,Het=new K,Get=new K,Wet=new K,qet=new Gs(K.UNIT_X,0),jet=new ro,Yet=new ro;function Ket(e,t,n){if(K.equals(t,e._translateMousePosition)||(e._looking=!1),K.equals(t,e._strafeMousePosition)||(e._strafing=!1),e._looking)return void unt(e,t,n);if(e._strafing)return void zet(e,n);const i=e._scene,o=i.camera,r=e._cameraUnderground,s=ro.clone(n.startPosition,jet),a=ro.clone(n.endPosition,Yet);let c=o.getPickRay(s,ket);const l=K.clone(K.ZERO,Wet),u=K.UNIT_X;let h;if(o.position.z<e._minimumPickingTerrainHeight&&(h=Det(e,s,Vet),C(h)&&(l.x=h.x)),r||l.x>o.position.z&&C(h)){let i=h;return r&&(i=Net(e,c,h,Vet)),ro.clone(t,e._strafeMousePosition),ro.clone(t,e._strafeEndMousePosition),K.clone(i,e._strafeStartPosition),e._strafing=!0,void wtt(e,n,e._strafeStartPosition)}const d=Gs.fromPointNormal(l,u,qet);c=o.getPickRay(s,ket);const f=Ns.rayPlane(c,d,Vet),p=o.getPickRay(a,Uet),m=Ns.rayPlane(p,d,Het);if(!C(f)||!C(m))return e._looking=!0,unt(e,t,n),void ro.clone(t,e._translateMousePosition);const _=K.subtract(f,m,Get),g=_.x;_.x=_.y,_.y=_.z,_.z=g;const y=K.magnitude(_);y>z.EPSILON6&&(K.normalize(_,_),o.move(_,y))}const Xet=new ro,Qet=new os,Jet=new K,Zet=new K,$et=new ft,ett=new ft,ttt=new K,ntt=new Gs(K.UNIT_X,0),itt=new K,ott=new se,rtt=new ft,stt=new il,att=new ke,ctt=new K;function ltt(e,t,n){if(C(n.angleAndHeight)&&(n=n.angleAndHeight),ro.equals(t,e._tiltCenterMousePosition)||(e._tiltCVOffMap=!1,e._looking=!1),e._looking)return void unt(e,t,n);const i=e._scene,o=i.camera;e._tiltCVOffMap||!e.onMap()||Math.abs(o.position.z)>e._minimumPickingTerrainHeight?(e._tiltCVOffMap=!0,utt(e,t,n)):htt(e,t,n)}function utt(e,t,n){const i=e._scene,o=i.camera,r=i.canvas,s=Xet;s.x=r.clientWidth/2,s.y=r.clientHeight/2;const a=o.getPickRay(s,Qet),c=K.UNIT_X,l=a.origin,u=a.direction;let h;const d=K.dot(c,u);if(Math.abs(d)>z.EPSILON6&&(h=-K.dot(c,l)/d),!C(h)||h<=0)return e._looking=!0,unt(e,t,n),void ro.clone(t,e._tiltCenterMousePosition);const f=K.multiplyByScalar(u,h,Jet);K.add(l,f,f);const p=i.mapProjection,m=p.ellipsoid;K.fromElements(f.y,f.z,f.x,f);const _=p.unproject(f,ott);m.cartographicToCartesian(_,f);const g=Kl.eastNorthUpToFixedFrame(f,m,$et),y=e._globe,v=e._ellipsoid;e._globe=void 0,e._ellipsoid=ge.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;const b=ft.clone(o.transform,rtt);o._setTransform(g),Dtt(e,t,n,K.UNIT_Z),o._setTransform(b),e._globe=y,e._ellipsoid=v;const A=v.maximumRadius;e._rotateFactor=1/A,e._rotateRateRangeAdjustment=A}function htt(e,t,n){const i=e._scene,o=i.camera,r=e._cameraUnderground;let s,a;const c=K.UNIT_X;if(ro.equals(t,e._tiltCenterMousePosition))s=K.clone(e._tiltCenter,Jet);else{if(o.position.z<e._minimumPickingTerrainHeight&&(s=Det(e,t,Jet)),!C(s)){a=o.getPickRay(t,Qet);const i=a.origin,r=a.direction;let l;const u=K.dot(c,r);if(Math.abs(u)>z.EPSILON6&&(l=-K.dot(c,i)/u),!C(l)||l<=0)return e._looking=!0,unt(e,t,n),void ro.clone(t,e._tiltCenterMousePosition);s=K.multiplyByScalar(r,l,Jet),K.add(i,s,s)}r&&(C(a)||(a=o.getPickRay(t,Qet)),Bet(e,a,s,s)),ro.clone(t,e._tiltCenterMousePosition),K.clone(s,e._tiltCenter)}const l=i.canvas,u=Xet;u.x=l.clientWidth/2,u.y=e._tiltCenterMousePosition.y,a=o.getPickRay(u,Qet);const h=K.clone(K.ZERO,ttt);h.x=s.x;const d=Gs.fromPointNormal(h,c,ntt),f=Ns.rayPlane(a,d,Zet),p=o._projection,m=p.ellipsoid;K.fromElements(s.y,s.z,s.x,s);let _=p.unproject(s,ott);m.cartographicToCartesian(_,s);const g=Kl.eastNorthUpToFixedFrame(s,m,$et);let y;C(f)?(K.fromElements(f.y,f.z,f.x,f),_=p.unproject(f,ott),m.cartographicToCartesian(_,f),y=Kl.eastNorthUpToFixedFrame(f,m,ett)):y=g;const v=e._globe,b=e._ellipsoid;e._globe=void 0,e._ellipsoid=ge.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;let A=K.UNIT_Z;const w=ft.clone(o.transform,rtt);o._setTransform(g);const T=K.cross(K.UNIT_Z,K.normalize(o.position,itt),itt),E=K.dot(o.right,T);if(Dtt(e,t,n,A,!1,!0),o._setTransform(y),E<0){const i=n.startPosition.y-n.endPosition.y;(r&&i<0||!r&&i>0)&&(A=void 0);const s=o.constrainedAxis;o.constrainedAxis=void 0,Dtt(e,t,n,A,!0,!1),o.constrainedAxis=s}else Dtt(e,t,n,A,!0,!1);if(C(o.constrainedAxis)){const e=K.cross(o.direction,o.constrainedAxis,ctt);K.equalsEpsilon(e,K.ZERO,z.EPSILON6)||(K.dot(e,o.right)<0&&K.negate(e,e),K.cross(e,o.direction,o.up),K.cross(o.direction,o.up,o.right),K.normalize(o.up,o.up),K.normalize(o.right,o.right))}o._setTransform(w),e._globe=v,e._ellipsoid=b;const x=b.maximumRadius;e._rotateFactor=1/x,e._rotateRateRangeAdjustment=x;const S=K.clone(o.positionWC,itt);if(e.enableCollisionDetection&&pnt(e),!K.equals(o.positionWC,S)){o._setTransform(y),o.worldToCameraCoordinatesPoint(S,S);const e=K.magnitudeSquared(S);K.magnitudeSquared(o.position)>e&&(K.normalize(o.position,o.position),K.multiplyByScalar(o.position,Math.sqrt(e),o.position));const t=K.angleBetween(S,o.position),n=K.cross(S,o.position,S);K.normalize(n,n);const i=il.fromAxisAngle(n,t,stt),r=ke.fromQuaternion(i,att);ke.multiplyByVector(r,o.direction,o.direction),ke.multiplyByVector(r,o.up,o.up),K.cross(o.direction,o.up,o.right),K.cross(o.right,o.direction,o.up),o._setTransform(w)}}const dtt=new ro,ftt=new os,ptt=new K;function mtt(e,t,n){C(n.distance)&&(n=n.distance);const i=e._scene,o=i.camera,r=i.canvas,s=e._cameraUnderground;let a;s?a=t:(a=dtt,a.x=r.clientWidth/2,a.y=r.clientHeight/2);const c=o.getPickRay(a,ftt),l=c.origin,u=c.direction,h=o.position.z;let d,f;if(h<e._minimumPickingTerrainHeight&&(d=Det(e,a,ptt)),C(d)&&(f=K.distance(l,d)),s){const t=Met(e,c,h);f=C(f)?Math.min(f,t):t}if(!C(f)){const e=K.UNIT_X;f=-K.dot(e,l)/K.dot(e,u)}_et(e,t,n,e._zoomFactor,f)}function _tt(e){const t=e._scene,n=t.camera;if(ft.equals(ft.IDENTITY,n.transform)){const t=e._tweens;if(e._aggregator.anyButtonDown&&t.removeAll(),W7e(e,e.enableTilt,e.tiltEventTypes,ltt,e.inertiaSpin,"_lastInertiaTiltMovement"),W7e(e,e.enableTranslate,e.translateEventTypes,Ket,e.inertiaTranslate,"_lastInertiaTranslateMovement"),W7e(e,e.enableZoom,e.zoomEventTypes,mtt,e.inertiaZoom,"_lastInertiaZoomMovement"),W7e(e,e.enableLook,e.lookEventTypes,unt),!e._aggregator.anyButtonDown&&!t.contains(e._tween)){const i=n.createCorrectPositionTween(e.bounceAnimationTime);C(i)&&(e._tween=t.add(i))}t.update()}else W7e(e,e.enableRotate,e.rotateEventTypes,Dtt,e.inertiaSpin,"_lastInertiaSpinMovement"),W7e(e,e.enableZoom,e.zoomEventTypes,Htt,e.inertiaZoom,"_lastInertiaZoomMovement")}const gtt=new os,ytt=new Gs(K.UNIT_X,0),vtt=new K,btt=new K,Att=new K;function wtt(e,t,n){const i=e._scene,o=i.camera,r=o.getPickRay(t.endPosition,gtt);let s=K.clone(o.direction,btt);i.mode===ij.COLUMBUS_VIEW&&K.fromElements(s.z,s.x,s.y,s);const a=Gs.fromPointNormal(n,s,ytt),c=Ns.rayPlane(r,a,vtt);C(c)&&(s=K.subtract(n,c,s),i.mode===ij.COLUMBUS_VIEW&&K.fromElements(s.y,s.z,s.x,s),K.add(o.position,s,o.position))}const Ttt=new K,Ctt=new se,Ett=new K,xtt=new ge,Stt=new K,Itt=new K;function Ott(e,t,n){const i=e._scene,o=i.camera,r=e._cameraUnderground;let s,a,c=e._ellipsoid;if(!ft.equals(o.transform,ft.IDENTITY))return void Dtt(e,t,n);const l=c.geodeticSurfaceNormal(o.position,Stt);if(ro.equals(t,e._rotateMousePosition)){if(e._looking)unt(e,t,n,l);else if(e._rotating)Dtt(e,t,n);else if(e._strafing)zet(e,n);else{if(K.magnitude(o.position)<K.magnitude(e._rotateStartPosition))return;s=K.magnitude(e._rotateStartPosition),a=Ett,a.x=a.y=a.z=s,c=ge.fromCartesian3(a,xtt),ktt(e,t,n,c)}return}e._looking=!1,e._rotating=!1,e._strafing=!1;const u=c.cartesianToCartographic(o.positionWC,Ctt).height,h=e._globe;if(C(h)&&u<e._minimumPickingTerrainHeight){const i=Det(e,n.startPosition,Att);if(C(i)){let l=!1;const u=o.getPickRay(n.startPosition,Set);if(r)l=!0,Net(e,u,i,i);else{const e=c.geodeticSurfaceNormal(i,Itt),t=Math.abs(K.dot(u.direction,e))<.05;l=!!t||K.magnitude(o.position)<K.magnitude(i)}l?(ro.clone(t,e._strafeEndMousePosition),K.clone(i,e._strafeStartPosition),e._strafing=!0,wtt(e,n,e._strafeStartPosition)):(s=K.magnitude(i),a=Ett,a.x=a.y=a.z=s,c=ge.fromCartesian3(a,xtt),ktt(e,t,n,c),K.clone(i,e._rotateStartPosition))}else e._looking=!0,unt(e,t,n,l)}else C(o.pickEllipsoid(n.startPosition,e._ellipsoid,Ttt))?(ktt(e,t,n,e._ellipsoid),K.clone(Ttt,e._rotateStartPosition)):u>e._minimumTrackBallHeight?(e._rotating=!0,Dtt(e,t,n)):(e._looking=!0,unt(e,t,n,l));ro.clone(t,e._rotateMousePosition)}function Dtt(e,t,n,i,o,r){o=R(o,!1),r=R(r,!1);const s=e._scene,a=s.camera,c=s.canvas,l=a.constrainedAxis;C(i)&&(a.constrainedAxis=i);const u=K.magnitude(a.position);let h=e._rotateFactor*(u-e._rotateRateRangeAdjustment);h>e._maximumRotateRate&&(h=e._maximumRotateRate),h<e._minimumRotateRate&&(h=e._minimumRotateRate);let d=(n.startPosition.x-n.endPosition.x)/c.clientWidth,f=(n.startPosition.y-n.endPosition.y)/c.clientHeight;d=Math.min(d,e.maximumMovementRatio),f=Math.min(f,e.maximumMovementRatio);const p=h*d*Math.PI*2,m=h*f*Math.PI;o||a.rotateRight(p),r||a.rotateUp(m),a.constrainedAxis=l}const Ptt=Xe.clone(Xe.UNIT_W),Rtt=Xe.clone(Xe.UNIT_W),Ltt=new K,Mtt=new K,Btt=new K,Ntt=new K,Ftt=new ro,ztt=new ro;function ktt(e,t,n,i){const o=e._scene,r=o.camera,s=ro.clone(n.startPosition,Ftt),a=ro.clone(n.endPosition,ztt);let c=r.pickEllipsoid(s,i,Ptt),l=r.pickEllipsoid(a,i,Rtt);if(!C(c)||!C(l))return e._rotating=!0,void Dtt(e,t,n);if(c=r.worldToCameraCoordinates(c,c),l=r.worldToCameraCoordinates(l,l),C(r.constrainedAxis)){const e=r.constrainedAxis,t=K.mostOrthogonalAxis(e,Ltt);K.cross(t,e,t),K.normalize(t,t);const n=K.cross(e,t,Mtt),i=K.magnitude(c),o=K.dot(e,c),s=Math.acos(o/i),a=K.multiplyByScalar(e,o,Btt);K.subtract(c,a,a),K.normalize(a,a);const u=K.magnitude(l),h=K.dot(e,l),d=Math.acos(h/u),f=K.multiplyByScalar(e,h,Ntt);K.subtract(l,f,f),K.normalize(f,f);let p=Math.acos(K.dot(a,t));K.dot(a,n)<0&&(p=z.TWO_PI-p);let m=Math.acos(K.dot(f,t));K.dot(f,n)<0&&(m=z.TWO_PI-m);const _=p-m;let g;g=K.equalsEpsilon(e,r.position,z.EPSILON2)?r.right:K.cross(e,r.position,Ltt);const y=K.cross(e,g,Ltt),v=K.dot(y,K.subtract(c,e,Mtt)),b=K.dot(y,K.subtract(l,e,Mtt));let A;A=v>0&&b>0?d-s:v>0&&b<=0?K.dot(r.position,e)>0?-s-d:s+d:s-d,r.rotateRight(_),r.rotateUp(A)}else{K.normalize(c,c),K.normalize(l,l);const e=K.dot(c,l),t=K.cross(c,l,Ltt);if(e<1&&!K.equalsEpsilon(t,K.ZERO,z.EPSILON14)){const n=Math.acos(e);r.rotate(t,n)}}}const Utt=new K,Vtt=new se;function Htt(e,t,n){C(n.distance)&&(n=n.distance);const i=e._ellipsoid,o=e._scene,r=o.camera,s=o.canvas,a=e._cameraUnderground;let c;a?c=t:(c=dtt,c.x=s.clientWidth/2,c.y=s.clientHeight/2);const l=r.getPickRay(c,ftt);let u;const h=i.cartesianToCartographic(r.position,Vtt).height;let d;if(h<e._minimumPickingTerrainHeight&&(u=Det(e,c,ptt)),C(u)&&(d=K.distance(l.origin,u)),a){const t=Met(e,l,h);d=C(d)?Math.min(d,t):t}C(d)||(d=h);const f=K.normalize(r.position,Utt);_et(e,t,n,e._zoomFactor,d,K.dot(f,r.direction))}const Gtt=new ro,Wtt=new os,qtt=new K,jtt=new K,Ytt=new ft,Ktt=new ft,Xtt=new ft,Qtt=new il,Jtt=new ke,Ztt=new se,$tt=new K;function ent(e,t,n){const i=e._scene,o=i.camera;if(!ft.equals(o.transform,ft.IDENTITY))return;if(C(n.angleAndHeight)&&(n=n.angleAndHeight),ro.equals(t,e._tiltCenterMousePosition)||(e._tiltOnEllipsoid=!1,e._looking=!1),e._looking){const i=e._ellipsoid.geodeticSurfaceNormal(o.position,$tt);return void unt(e,t,n,i)}const r=e._ellipsoid,s=r.cartesianToCartographic(o.position,Ztt);e._tiltOnEllipsoid||s.height>e._minimumCollisionTerrainHeight?(e._tiltOnEllipsoid=!0,nnt(e,t,n)):int(e,t,n)}const tnt=new se;function nnt(e,t,n){const i=e._ellipsoid,o=e._scene,r=o.camera,s=.25*e.minimumZoomDistance,a=i.cartesianToCartographic(r.positionWC,tnt).height;if(a-s-1<z.EPSILON3&&n.endPosition.y-n.startPosition.y<0)return;const c=o.canvas,l=Gtt;l.x=c.clientWidth/2,l.y=c.clientHeight/2;const u=r.getPickRay(l,Wtt);let h;const d=Ns.rayEllipsoid(u,i);if(C(d))h=os.getPoint(u,d.start,qtt);else{if(!(a>e._minimumTrackBallHeight)){e._looking=!0;const i=e._ellipsoid.geodeticSurfaceNormal(r.position,$tt);return unt(e,t,n,i),void ro.clone(t,e._tiltCenterMousePosition)}{const e=Ns.grazingAltitudeLocation(u,i);if(!C(e))return;const t=i.cartesianToCartographic(e,Ztt);t.height=0,h=i.cartographicToCartesian(t,qtt)}}const f=Kl.eastNorthUpToFixedFrame(h,i,Ytt),p=e._globe,m=e._ellipsoid;e._globe=void 0,e._ellipsoid=ge.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;const _=ft.clone(r.transform,Xtt);r._setTransform(f),Dtt(e,t,n,K.UNIT_Z),r._setTransform(_),e._globe=p,e._ellipsoid=m;const g=m.maximumRadius;e._rotateFactor=1/g,e._rotateRateRangeAdjustment=g}function int(e,t,n){const i=e._ellipsoid,o=e._scene,r=o.camera,s=e._cameraUnderground;let a,c,l;if(ro.equals(t,e._tiltCenterMousePosition))a=K.clone(e._tiltCenter,qtt);else{if(a=Det(e,t,qtt),!C(a)){if(c=r.getPickRay(t,Wtt),l=Ns.rayEllipsoid(c,i),!C(l)){const o=i.cartesianToCartographic(r.position,Ztt);if(o.height<=e._minimumTrackBallHeight){e._looking=!0;const i=e._ellipsoid.geodeticSurfaceNormal(r.position,$tt);unt(e,t,n,i),ro.clone(t,e._tiltCenterMousePosition)}return}a=os.getPoint(c,l.start,qtt)}s&&(C(c)||(c=r.getPickRay(t,Wtt)),Bet(e,c,a,a)),ro.clone(t,e._tiltCenterMousePosition),K.clone(a,e._tiltCenter)}const u=o.canvas,h=Gtt;h.x=u.clientWidth/2,h.y=e._tiltCenterMousePosition.y,c=r.getPickRay(h,Wtt);const d=K.magnitude(a),f=K.fromElements(d,d,d,Ett),p=ge.fromCartesian3(f,xtt);if(l=Ns.rayEllipsoid(c,p),!C(l))return;const m=K.magnitude(c.origin)>d?l.start:l.stop,_=os.getPoint(c,m,jtt),g=Kl.eastNorthUpToFixedFrame(a,i,Ytt),y=Kl.eastNorthUpToFixedFrame(_,p,Ktt),v=e._globe,b=e._ellipsoid;e._globe=void 0,e._ellipsoid=ge.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;let A=K.UNIT_Z;const w=ft.clone(r.transform,Xtt);r._setTransform(y);const T=K.cross(_,r.positionWC,ctt),E=K.dot(r.rightWC,T);if(E<0){const i=n.startPosition.y-n.endPosition.y;(s&&i<0||!s&&i>0)&&(A=void 0);const o=r.constrainedAxis;r.constrainedAxis=void 0,Dtt(e,t,n,A,!0,!1),r.constrainedAxis=o}else Dtt(e,t,n,A,!0,!1);if(r._setTransform(g),Dtt(e,t,n,A,!1,!0),C(r.constrainedAxis)){const e=K.cross(r.direction,r.constrainedAxis,ctt);K.equalsEpsilon(e,K.ZERO,z.EPSILON6)||(K.dot(e,r.right)<0&&K.negate(e,e),K.cross(e,r.direction,r.up),K.cross(r.direction,r.up,r.right),K.normalize(r.up,r.up),K.normalize(r.right,r.right))}r._setTransform(w),e._globe=v,e._ellipsoid=b;const x=b.maximumRadius;e._rotateFactor=1/x,e._rotateRateRangeAdjustment=x;const S=K.clone(r.positionWC,ctt);if(e.enableCollisionDetection&&pnt(e),!K.equals(r.positionWC,S)){r._setTransform(y),r.worldToCameraCoordinatesPoint(S,S);const e=K.magnitudeSquared(S);K.magnitudeSquared(r.position)>e&&(K.normalize(r.position,r.position),K.multiplyByScalar(r.position,Math.sqrt(e),r.position));const t=K.angleBetween(S,r.position),n=K.cross(S,r.position,S);K.normalize(n,n);const i=il.fromAxisAngle(n,t,Qtt),o=ke.fromQuaternion(i,Jtt);ke.multiplyByVector(o,r.direction,r.direction),ke.multiplyByVector(o,r.up,r.up),K.cross(r.direction,r.up,r.right),K.cross(r.right,r.direction,r.up),r._setTransform(w)}}const ont=new ro,rnt=new ro,snt=new os,ant=new os,cnt=new K,lnt=new K;function unt(e,t,n,i){const o=e._scene,r=o.camera,s=ont;s.x=n.startPosition.x,s.y=0;const a=rnt;a.x=n.endPosition.x,a.y=0;let c,l,u=r.getPickRay(s,snt),h=r.getPickRay(a,ant),d=0;r.frustum instanceof jC?(c=u.origin,l=h.origin,K.add(r.direction,c,c),K.add(r.direction,l,l),K.subtract(c,r.position,c),K.subtract(l,r.position,l),K.normalize(c,c),K.normalize(l,l)):(c=u.direction,l=h.direction);let f=K.dot(c,l);f<1&&(d=Math.acos(f)),d=n.startPosition.x>n.endPosition.x?-d:d;const p=e._horizontalRotationAxis;if(C(i)?r.look(i,-d):C(p)?r.look(p,-d):r.lookLeft(d),s.x=0,s.y=n.startPosition.y,a.x=0,a.y=n.endPosition.y,u=r.getPickRay(s,snt),h=r.getPickRay(a,ant),d=0,r.frustum instanceof jC?(c=u.origin,l=h.origin,K.add(r.direction,c,c),K.add(r.direction,l,l),K.subtract(c,r.position,c),K.subtract(l,r.position,l),K.normalize(c,c),K.normalize(l,l)):(c=u.direction,l=h.direction),f=K.dot(c,l),f<1&&(d=Math.acos(f)),d=n.startPosition.y>n.endPosition.y?-d:d,i=R(i,p),C(i)){const e=r.direction,t=K.negate(i,cnt),n=K.equalsEpsilon(e,i,z.EPSILON2),o=K.equalsEpsilon(e,t,z.EPSILON2);if(n||o)(n&&d<0||o&&d>0)&&r.look(r.right,-d);else{f=K.dot(e,i);let n=z.acosClamped(f);d>0&&d>n&&(d=n-z.EPSILON4),f=K.dot(e,t),n=z.acosClamped(f),d<0&&-d>n&&(d=-n+z.EPSILON4);const o=K.cross(i,e,lnt);r.look(o,d)}}else r.lookUp(d)}function hnt(e){W7e(e,e.enableRotate,e.rotateEventTypes,Ott,e.inertiaSpin,"_lastInertiaSpinMovement"),W7e(e,e.enableZoom,e.zoomEventTypes,Htt,e.inertiaZoom,"_lastInertiaZoomMovement"),W7e(e,e.enableTilt,e.tiltEventTypes,ent,e.inertiaSpin,"_lastInertiaTiltMovement"),W7e(e,e.enableLook,e.lookEventTypes,unt)}const dnt=new ft,fnt=new se;function pnt(e){e._adjustedHeightForTerrain=!0;const t=e._scene,n=t.mode,i=t.globe;if(!C(i)||n===ij.SCENE2D||n===ij.MORPHING)return;const o=t.camera,r=i.ellipsoid,s=t.mapProjection;let a,c;ft.equals(o.transform,ft.IDENTITY)||(a=ft.clone(o.transform,dnt),c=K.magnitude(o.position),o._setTransform(ft.IDENTITY));const l=fnt;n===ij.SCENE3D?r.cartesianToCartographic(o.position,l):s.unproject(o.position,l);let u=!1;if(l.height<e._minimumCollisionTerrainHeight){const t=e._scene.globeHeight;if(C(t)){const i=t+e.minimumZoomDistance;l.height<i&&(l.height=i,n===ij.SCENE3D?r.cartographicToCartesian(l,o.position):s.project(l,o.position),u=!0)}}C(a)&&(o._setTransform(a),u&&(K.normalize(o.position,o.position),K.negate(o.position,o.direction),K.multiplyByScalar(o.position,Math.max(c,e.minimumZoomDistance),o.position),K.normalize(o.direction,o.direction),K.cross(o.direction,o.up,o.right),K.cross(o.right,o.direction,o.up)))}F7e.prototype.onMap=function(){const e=this._scene,t=e.mode,n=e.camera;return t!==ij.COLUMBUS_VIEW||Math.abs(n.position.x)-this._maxCoord.x<0&&Math.abs(n.position.y)-this._maxCoord.y<0};const mnt=new K,_nt=new K;F7e.prototype.update=function(){const e=this._scene,t=e.camera,n=e.globe,i=e.mode;ft.equals(t.transform,ft.IDENTITY)?(this._globe=n,this._ellipsoid=C(this._globe)?this._globe.ellipsoid:e.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=ge.UNIT_SPHERE);const o=C(this._globe)?this._globe.terrainExaggeration:1,r=C(this._globe)?this._globe.terrainExaggerationRelativeHeight:0;this._minimumCollisionTerrainHeight=Eh.getHeight(this.minimumCollisionTerrainHeight,o,r),this._minimumPickingTerrainHeight=Eh.getHeight(this.minimumPickingTerrainHeight,o,r),this._minimumTrackBallHeight=Eh.getHeight(this.minimumTrackBallHeight,o,r),this._cameraUnderground=e.cameraUnderground&&C(this._globe);const s=this._ellipsoid.maximumRadius;this._rotateFactor=1/s,this._rotateRateRangeAdjustment=s,this._adjustedHeightForTerrain=!1;const a=K.clone(t.positionWC,mnt),c=K.clone(t.directionWC,_nt);if(i===ij.SCENE2D?xet(this):i===ij.COLUMBUS_VIEW?(this._horizontalRotationAxis=K.UNIT_Z,_tt(this)):i===ij.SCENE3D&&(this._horizontalRotationAxis=void 0,hnt(this)),this.enableCollisionDetection&&!this._adjustedHeightForTerrain){const e=!K.equals(a,t.positionWC)||!K.equals(c,t.directionWC);e&&pnt(this)}this._aggregator.reset()},F7e.prototype.isDestroyed=function(){return!1},F7e.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),Qh(this)};var gnt=F7e,ynt="uniform sampler2D colorTexture;\nuniform sampler2D colorTexture2;\n\nuniform vec2 center;\nuniform float radius;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    vec4 color0 = texture2D(colorTexture, v_textureCoordinates);\n    vec4 color1 = texture2D(colorTexture2, v_textureCoordinates);\n\n    float x = length(gl_FragCoord.xy - center) / radius;\n    float t = smoothstep(0.5, 0.8, x);\n    gl_FragColor = mix(color0 + color1, color1, t);\n}\n",vnt='uniform sampler2D colorTexture;\n\nuniform float avgLuminance;\nuniform float threshold;\nuniform float offset;\n\nvarying vec2 v_textureCoordinates;\n\nfloat key(float avg)\n{\n    float guess = 1.5 - (1.5 / (avg * 0.1 + 1.0));\n    return max(0.0, guess) + 0.1;\n}\n\n// See section 9. "The bright-pass filter" of Realtime HDR Rendering\n// http://www.cg.tuwien.ac.at/research/publications/2007/Luksch_2007_RHR/Luksch_2007_RHR-RealtimeHDR%20.pdf\n\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec3 xyz = czm_RGBToXYZ(color.rgb);\n    float luminance = xyz.r;\n\n    float scaledLum = key(avgLuminance) * luminance / avgLuminance;\n    float brightLum = max(scaledLum - threshold, 0.0);\n    float brightness = brightLum / (offset + brightLum);\n\n    xyz.r = brightness;\n    gl_FragColor = vec4(czm_XYZToRGB(xyz), 1.0);\n}\n';function bnt(){this._sceneFramebuffer=new J4e;const e=.125,t=new Array(6);t[0]=new D8e({fragmentShader:L0e,textureScale:e,forcePowerOfTwo:!0,sampleMode:m8e.LINEAR});const n=t[1]=new D8e({fragmentShader:vnt,uniforms:{avgLuminance:.5,threshold:.25,offset:.1},textureScale:e,forcePowerOfTwo:!0}),i=this;this._delta=1,this._sigma=2,this._blurStep=new ro,t[2]=new D8e({fragmentShader:G8e,uniforms:{step:function(){return i._blurStep.x=i._blurStep.y=1/n.outputTexture.width,i._blurStep},delta:function(){return i._delta},sigma:function(){return i._sigma},direction:0},textureScale:e,forcePowerOfTwo:!0}),t[3]=new D8e({fragmentShader:G8e,uniforms:{step:function(){return i._blurStep.x=i._blurStep.y=1/n.outputTexture.width,i._blurStep},delta:function(){return i._delta},sigma:function(){return i._sigma},direction:1},textureScale:e,forcePowerOfTwo:!0}),t[4]=new D8e({fragmentShader:L0e,sampleMode:m8e.LINEAR}),this._uCenter=new ro,this._uRadius=void 0,t[5]=new D8e({fragmentShader:ynt,uniforms:{center:function(){return i._uCenter},radius:function(){return i._uRadius},colorTexture2:function(){return i._sceneFramebuffer.framebuffer.getColorTexture(0)}}}),this._stages=new Z8e({stages:t});const o=new f9e(this),r=t.length;for(let s=0;s<r;++s)t[s]._textureCache=o;this._textureCache=o,this.length=t.length}bnt.prototype.get=function(e){return this._stages.get(e)},bnt.prototype.getStageByName=function(e){const t=this._stages.length;for(let n=0;n<t;++n){const t=this._stages.get(n);if(t.name===e)return t}};const Ant=new Xe,wnt=new ro,Tnt=new ro,Cnt=new ft;function Ent(e,t,n){const i=t.uniformState,o=i.sunPositionWC,r=i.view,s=i.viewProjection,a=i.projection;let c=ft.computeViewportTransformation(n,0,1,Cnt);const l=ft.multiplyByPoint(r,o,Ant);let u=Kl.pointToGLWindowCoordinates(s,c,o,wnt);l.x+=z.SOLAR_RADIUS;const h=Kl.pointToGLWindowCoordinates(a,c,l,l),d=30*ro.magnitude(ro.subtract(h,u,h))*2,f=Tnt;f.x=d,f.y=d,e._uCenter=ro.clone(u,e._uCenter),e._uRadius=.15*Math.max(f.x,f.y);const p=t.drawingBufferWidth,m=t.drawingBufferHeight,_=e._stages,g=_.get(0),y=g.outputTexture.width,v=g.outputTexture.height,b=new bf;b.width=y,b.height=v,c=ft.computeViewportTransformation(b,0,1,Cnt),u=Kl.pointToGLWindowCoordinates(s,c,o,wnt),f.x*=y/p,f.y*=v/m;const A=g.scissorRectangle;A.x=Math.max(u.x-.5*f.x,0),A.y=Math.max(u.y-.5*f.y,0),A.width=Math.min(f.x,p),A.height=Math.min(f.y,m);for(let w=1;w<4;++w)bf.clone(A,_.get(w).scissorRectangle)}bnt.prototype.clear=function(e,t,n){this._sceneFramebuffer.clear(e,t,n),this._textureCache.clear(e)},bnt.prototype.update=function(e){const t=e.context,n=e.viewport,i=this._sceneFramebuffer;i.update(t,n);const o=i.framebuffer;return this._textureCache.update(t),this._stages.update(t,!1),Ent(this,t,n),o},bnt.prototype.execute=function(e){const t=this._sceneFramebuffer.framebuffer.getColorTexture(0),n=this._stages,i=n.length;n.get(0).execute(e,t);for(let o=1;o<i;++o)n.get(o).execute(e,n.get(o-1).outputTexture)},bnt.prototype.copy=function(e,t){if(!C(this._copyColorCommand)){const t=this;this._copyColorCommand=e.createViewportQuadCommand(L0e,{uniformMap:{colorTexture:function(){return t._stages.get(t._stages.length-1).outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t,this._copyColorCommand.execute(e)},bnt.prototype.isDestroyed=function(){return!1},bnt.prototype.destroy=function(){return this._textureCache.destroy(),this._stages.destroy(),Qh(this)};var xnt=bnt;const Snt=function(e){return function(){e.frameState.afterRender.push((function(){e.requestRender()}))}};function Int(e){e=R(e,R.EMPTY_OBJECT);const t=e.canvas;let n=e.creditContainer,i=e.creditViewport,o=pn(e.contextOptions);if(C(o)||(o={}),C(o.webgl)||(o.webgl={}),o.webgl.powerPreference=R(o.webgl.powerPreference,"high-performance"),!C(t))throw new x("options and options.canvas are required.");const r=C(n),s=new YGe(t,o);r||(n=document.createElement("div"),n.style.position="absolute",n.style.bottom="0",n.style["text-shadow"]="0 0 2px #000000",n.style.color="#ffffff",n.style["font-size"]="10px",n.style["padding-right"]="5px",t.parentNode.appendChild(n)),C(i)||(i=t.parentNode),this._id=wk(),this._jobScheduler=new P3e,this._frameState=new BQe(s,new fXe(n," • ",i),this._jobScheduler),this._frameState.scene3DOnly=R(e.scene3DOnly,!1),this._removeCreditContainer=!r,this._creditContainer=n,this._canvas=t,this._context=s,this._computeEngine=new LHe(s),this._globe=void 0,this._globeTranslucencyState=new B1e,this._primitives=new qEe,this._groundPrimitives=new qEe,this._globeHeight=void 0,this._cameraUnderground=!1,this._logDepthBuffer=s.fragmentDepth,this._logDepthBufferDirty=!0,this._tweens=new N7e,this._shaderFrameCount=0,this._sunPostProcess=void 0,this._computeCommandList=[],this._overlayCommandList=[],this._useOIT=R(e.orderIndependentTranslucency,!0),this._executeOITFunction=void 0,this._depthPlane=new qXe(e.depthPlaneEllipsoidOffset),this._clearColorCommand=new tJ({color:new xy,stencil:0,owner:this}),this._depthClearCommand=new tJ({depth:1,owner:this}),this._stencilClearCommand=new tJ({stencil:0}),this._classificationStencilClearCommand=new tJ({stencil:0,renderState:yV.fromCache({stencilMask:FY.CLASSIFICATION_MASK})}),this._depthOnlyRenderStateCache={},this._transitioner=new L7e(this),this._preUpdate=new $n,this._postUpdate=new $n,this._renderError=new $n,this._preRender=new $n,this._postRender=new $n,this._minimumDisableDepthTestDistance=0,this._debugInspector=new RXe,this._msaaSamples=R(e.msaaSamples,1),this.rethrowRenderErrors=!1,this.completeMorphOnUserInput=!0,this.morphStart=new $n,this.morphComplete=new $n,this.skyBox=void 0,this.skyAtmosphere=void 0,this.sun=void 0,this.sunBloom=!0,this._sunBloom=void 0,this.moon=void 0,this.backgroundColor=xy.clone(xy.BLACK),this._mode=ij.SCENE3D,this._mapProjection=C(e.mapProjection)?e.mapProjection:new ve,this.morphTime=1,this.farToNearRatio=1e3,this.logarithmicDepthFarToNearRatio=1e9,this.nearToFarDistance2D=175e4,this.debugCommandFilter=void 0,this.debugShowCommands=!1,this.debugShowFrustums=!1,this.debugShowFramesPerSecond=!1,this.debugShowDepthFrustum=1,this.debugShowFrustumPlanes=!1,this._debugShowFrustumPlanes=!1,this._debugFrustumPlanes=void 0,this.useDepthPicking=!0,this.pickTranslucentDepth=!1,this.cameraEventWaitTime=500,this.fog=new OQe,this._shadowMapCamera=new TYe(this),this.shadowMap=new X5e({context:s,lightCamera:this._shadowMapCamera,enabled:R(e.shadows,!1)}),this.invertClassification=!1,this.invertClassificationColor=xy.clone(xy.WHITE),this._actualInvertClassificationColor=xy.clone(this._invertClassificationColor),this._invertClassification=new t2e,this.focalLength=void 0,this.eyeSeparation=void 0,this.postProcessStages=new A9e,this._brdfLutGenerator=new PWe,this._performanceDisplay=void 0,this._debugVolume=void 0,this._screenSpaceCameraController=new gnt(this),this._cameraUnderground=!1,this._mapMode2D=R(e.mapMode2D,$We.INFINITE_SCROLL),this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1},this._useWebVR=!1,this._cameraVR=void 0,this._aspectRatioVR=void 0,this.requestRenderMode=R(e.requestRenderMode,!1),this._renderRequested=!0,this.maximumRenderTimeChange=R(e.maximumRenderTimeChange,0),this._lastRenderTime=void 0,this._frameRateMonitor=void 0,this._removeRequestListenerCallback=vi.requestCompletedEvent.addEventListener(Snt(this)),this._removeTaskProcessorListenerCallback=ad.taskCompletedEvent.addEventListener(Snt(this)),this._removeGlobeCallbacks=[];const a=new bf(0,0,s.drawingBufferWidth,s.drawingBufferHeight),c=new TYe(this);this._logDepthBuffer&&(c.frustum.near=.1,c.frustum.far=1e10),this.preloadFlightCamera=new TYe(this),this.preloadFlightCullingVolume=void 0,this._picking=new f8e(this),this._defaultView=new g6e(this,c,a),this._view=this._defaultView,this._hdr=void 0,this._hdrDirty=void 0,this.highDynamicRange=!1,this.gamma=2.2,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this._specularEnvironmentMapAtlas=void 0,this.light=new HHe,znt(this,0,Ea.now()),this.updateFrameState(),this.initializeFrame()}function Ont(e,t){for(let i=0;i<e._removeGlobeCallbacks.length;++i)e._removeGlobeCallbacks[i]();e._removeGlobeCallbacks.length=0;const n=[];C(t)&&(n.push(t.imageryLayersUpdatedEvent.addEventListener(Snt(e))),n.push(t.terrainProviderChanged.addEventListener(Snt(e)))),e._removeGlobeCallbacks=n}function Dnt(e,t,n){const i=e._frameState,o=e._context,r=e._view.oit,s=i.shadowState.lightShadowMaps,a=i.shadowState.lightShadowsEnabled;let c=t.derivedCommands;C(t.pickId)&&(c.picking=oQe.createPickDerivedCommand(e,t,o,c.picking)),t.pickOnly||(c.depth=oQe.createDepthOnlyDerivedCommand(e,t,o,c.depth)),c.originalCommand=t,e._hdr&&(c.hdr=oQe.createHdrCommand(t,o,c.hdr),t=c.hdr.command,c=t.derivedCommands),a&&t.receiveShadows&&(c.shadows=X5e.createReceiveDerivedCommand(s,t,n,o,c.shadows)),t.pass===HU.TRANSLUCENT&&C(r)&&r.isSupported()&&(a&&t.receiveShadows?(c.oit=C(c.oit)?c.oit:{},c.oit.shadows=r.createDerivedCommands(c.shadows.receiveCommand,o,c.oit.shadows)):c.oit=r.createDerivedCommands(t,o,c.oit))}Object.defineProperties(Int.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return Ck.maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return Ck.maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},specularEnvironmentMapsSupported:{get:function(){return JQ.isSupported(this._context)}},globe:{get:function(){return this._globe},set:function(e){this._globe=this._globe&&this._globe.destroy(),this._globe=e,Ont(this,e)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(e){this._view.camera=e}},view:{get:function(){return this._view},set:function(e){this._view=e}},defaultView:{get:function(){return this._defaultView}},picking:{get:function(){return this._picking}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},jobScheduler:{get:function(){return this._jobScheduler}},frameState:{get:function(){return this._frameState}},environmentState:{get:function(){return this._environmentState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if(C(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if(C(this.globe))return this.globe.terrainProvider},set:function(e){C(this.globe)&&(this.globe.terrainProvider=e)}},terrainProviderChanged:{get:function(){if(C(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(e){if(this.scene3DOnly&&e!==ij.SCENE3D)throw new x("Only SceneMode.SCENE3D is valid when scene3DOnly is true.");if(e===ij.SCENE2D)this.morphTo2D(0);else if(e===ij.SCENE3D)this.morphTo3D(0);else{if(e!==ij.COLUMBUS_VIEW)throw new x("value must be a valid SceneMode enumeration.");this.morphToColumbusView(0)}this._mode=e}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},useWebVR:{get:function(){return this._useWebVR},set:function(e){if(this.camera.frustum instanceof jC)throw new x("VR is unsupported with an orthographic projection.");this._useWebVR=e,this._useWebVR?(this._frameState.creditDisplay.container.style.visibility="hidden",this._cameraVR=new TYe(this),C(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new uQe(this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility="visible",this._cameraVR=void 0,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},splitPosition:{get:function(){return this._frameState.splitPosition},set:function(e){this._frameState.splitPosition=e}},imagerySplitPosition:{get:function(){return UF("Scene.imagerySplitPosition","Scene.imagerySplitPosition has been deprecated in Cesium 1.92. It will be removed in Cesium 1.94. Use splitPosition instead."),this._frameState.splitPosition},set:function(e){UF("Scene.imagerySplitPosition","Scene.imagerySplitPosition has been deprecated in Cesium 1.92. It will be removed in Cesium 1.94. Use splitPosition instead."),this._frameState.splitPosition=e}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(e){if(!C(e)||e<0)throw new x("minimumDisableDepthTestDistance must be greater than or equal to 0.0.");this._minimumDisableDepthTestDistance=e}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(e){e=this._context.fragmentDepth&&e,this._logDepthBuffer!==e&&(this._logDepthBuffer=e,this._logDepthBufferDirty=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(e){this._context.uniformState.gamma=e}},highDynamicRange:{get:function(){return this._hdr},set:function(e){const t=this._context,n=e&&t.depthTexture&&(t.colorBufferFloat||t.colorBufferHalfFloat);this._hdrDirty=n!==this._hdr,this._hdr=n}},highDynamicRangeSupported:{get:function(){const e=this._context;return e.depthTexture&&(e.colorBufferFloat||e.colorBufferHalfFloat)}},cameraUnderground:{get:function(){return this._cameraUnderground}},msaaSamples:{get:function(){return this._msaaSamples},set:function(e){e=Math.min(e,Ck.maximumSamples),this._msaaSamples=e}},msaaSupported:{get:function(){return this._context.msaa}},pixelRatio:{get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},opaqueFrustumNearOffset:{get:function(){return.9999}},globeHeight:{get:function(){return this._globeHeight}}}),Int.prototype.getCompressedTextureFormatSupported=function(e){const t=this.context;return("WEBGL_compressed_texture_s3tc"===e||"s3tc"===e)&&t.s3tc||("WEBGL_compressed_texture_pvrtc"===e||"pvrtc"===e)&&t.pvrtc||("WEBGL_compressed_texture_etc"===e||"etc"===e)&&t.etc||("WEBGL_compressed_texture_etc1"===e||"etc1"===e)&&t.etc1||("WEBGL_compressed_texture_astc"===e||"astc"===e)&&t.astc||("EXT_texture_compression_bptc"===e||"bc7"===e)&&t.bc7},Int.prototype.updateDerivedCommands=function(e){if(!C(e.derivedCommands))return;const t=this._frameState,n=this._context;let i=!1;const o=t.shadowState.lastDirtyTime;e.lastDirtyTime!==o&&(e.lastDirtyTime=o,e.dirty=!0,i=!0);const r=t.useLogDepth,s=this._hdr,a=e.derivedCommands,c=C(a.logDepth),l=C(a.hdr),u=C(a.originalCommand),h=r&&!c,d=s&&!l,f=(!r||!s)&&!u;if(e.dirty=e.dirty||h||d||f,e.dirty){e.dirty=!1;const o=t.shadowState.shadowMaps,r=t.shadowState.shadowsEnabled;r&&e.castShadows&&(a.shadows=X5e.createCastDerivedCommand(o,e,i,n,a.shadows)),(c||h)&&(a.logDepth=oQe.createLogDepthCommand(e,n,a.logDepth),Dnt(this,a.logDepth.command,i)),(u||f)&&Dnt(this,e,i)}};const Pnt=new FYe({pass:ige.RENDER}),Rnt=new FYe({pass:ige.PRELOAD}),Lnt=new FYe({pass:ige.PRELOAD_FLIGHT}),Mnt=new FYe({pass:ige.REQUEST_RENDER_MODE_DEFER_CHECK}),Bnt=new nn;let Nnt;function Fnt(e){const t=e.globe;if(e._mode===ij.SCENE3D&&C(t)&&t.show&&!e._cameraUnderground&&!e._globeTranslucencyState.translucent){const n=t.ellipsoid,i=e.frameState.minimumTerrainHeight;return Bnt.radius=n.minimumRadius+i,Nnt=XO.fromBoundingSphere(Bnt,e.camera.positionWC,Nnt),Nnt}}function znt(e,t,n){const i=e._frameState;i.frameNumber=t,i.time=Ea.clone(n,i.time)}Int.prototype.clearPasses=function(e){e.render=!1,e.pick=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1},Int.prototype.updateFrameState=function(){const e=this.camera,t=this._frameState;t.commandList.length=0,t.shadowMaps.length=0,t.brdfLutGenerator=this._brdfLutGenerator,t.environmentMap=this.skyBox&&this.skyBox._cubeMap,t.mode=this._mode,t.morphTime=this.morphTime,t.mapProjection=this.mapProjection,t.camera=e,t.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),t.occluder=Fnt(this),t.minimumTerrainHeight=0,t.minimumDisableDepthTestDistance=this._minimumDisableDepthTestDistance,t.invertClassification=this.invertClassification,t.useLogDepth=this._logDepthBuffer&&!(this.camera.frustum instanceof jC||this.camera.frustum instanceof GC),t.light=this.light,t.cameraUnderground=this._cameraUnderground,t.globeTranslucencyState=this._globeTranslucencyState,C(this.globe)&&(t.terrainExaggeration=this.globe.terrainExaggeration,t.terrainExaggerationRelativeHeight=this.globe.terrainExaggerationRelativeHeight),C(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready?(t.specularEnvironmentMaps=this._specularEnvironmentMapAtlas.texture,t.specularEnvironmentMapsMaximumLOD=this._specularEnvironmentMapAtlas.maximumMipmapLevel):(t.specularEnvironmentMaps=void 0,t.specularEnvironmentMapsMaximumLOD=void 0),t.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,this._actualInvertClassificationColor=xy.clone(this.invertClassificationColor,this._actualInvertClassificationColor),t2e.isTranslucencySupported(this._context)||(this._actualInvertClassificationColor.alpha=1),t.invertClassificationColor=this._actualInvertClassificationColor,C(this.globe)?t.maximumScreenSpaceError=this.globe.maximumScreenSpaceError:t.maximumScreenSpaceError=2,this.clearPasses(t.passes),t.tilesetPassState=void 0},Int.prototype.isVisible=function(e,t,n){return C(e)&&(!C(e.boundingVolume)||!e.cull||t.computeVisibility(e.boundingVolume)!==Ae.OUTSIDE&&(!C(n)||!e.occlude||!e.boundingVolume.isOccluded(n)))};let knt=new ft(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);function Unt(e,t,n,i){const o=t._frameState,r=o.context,s=e.boundingVolume;let a;C(t._debugVolume)&&t._debugVolume.destroy();let c=K.clone(s.center);if(o.mode!==ij.SCENE3D){c=ft.multiplyByPoint(knt,c,c);const e=o.mapProjection,t=e.unproject(c);c=e.ellipsoid.cartographicToCartesian(t)}if(C(s.radius)){const e=s.radius;a=fg.toWireframe(bC.createGeometry(new bC({radii:new K(e,e,e),vertexFormat:LU.FLAT_VERTEX_FORMAT}))),t._debugVolume=new tY({geometryInstances:new Sm({geometry:a,modelMatrix:ft.fromTranslation(c),attributes:{color:new Iy(1,0,0,1)}}),appearance:new LU({flat:!0,translucent:!1}),asynchronous:!1})}else{const e=s.halfAxes;a=fg.toWireframe(ep.createGeometry(ep.fromDimensions({dimensions:new K(2,2,2),vertexFormat:LU.FLAT_VERTEX_FORMAT}))),t._debugVolume=new tY({geometryInstances:new Sm({geometry:a,modelMatrix:ft.fromRotationTranslation(e,c,new ft),attributes:{color:new Iy(1,0,0,1)}}),appearance:new LU({flat:!0,translucent:!1}),asynchronous:!1})}const l=o.commandList,u=o.commandList=[];if(t._debugVolume.update(o),e=u[0],o.useLogDepth){const t=oQe.createLogDepthCommand(e,r);e=t.command}let h;C(i)&&(h=n.framebuffer,n.framebuffer=i),e.execute(r,n),C(h)&&(n.framebuffer=h),o.commandList=l}function Vnt(e,t,n,i,o){const r=t._frameState;if(C(t.debugCommandFilter)&&!t.debugCommandFilter(e))return;if(e instanceof tJ)return void e.execute(n,i);e.debugShowBoundingVolume&&C(e.boundingVolume)&&Unt(e,t,i,o),r.useLogDepth&&C(e.derivedCommands.logDepth)&&(e=e.derivedCommands.logDepth.command);const s=r.passes;if(!s.pick&&!s.depth&&t._hdr&&C(e.derivedCommands)&&C(e.derivedCommands.hdr)&&(e=e.derivedCommands.hdr.command),s.pick||s.depth){if(s.pick&&!s.depth&&C(e.derivedCommands.picking))return e=e.derivedCommands.picking.pickCommand,void e.execute(n,i);if(C(e.derivedCommands.depth))return e=e.derivedCommands.depth.depthOnlyCommand,void e.execute(n,i)}t.debugShowCommands||t.debugShowFrustums?t._debugInspector.executeDebugShowFrustumsCommand(t,e,i):r.shadowState.lightShadowsEnabled&&e.receiveShadows&&C(e.derivedCommands.shadows)?e.derivedCommands.shadows.receiveCommand.execute(n,i):e.execute(n,i)}function Hnt(e,t,n,i){const o=t._frameState;let r=e.derivedCommands;C(r)&&(o.useLogDepth&&C(r.logDepth)&&(e=r.logDepth.command),r=e.derivedCommands,C(r.picking)?(e=r.picking.pickCommand,e.execute(n,i)):C(r.depth)&&(e=r.depth.depthOnlyCommand,e.execute(n,i)))}function Gnt(e,t,n){return t.boundingVolume.distanceSquaredTo(n)-e.boundingVolume.distanceSquaredTo(n)}function Wnt(e,t,n){return e.boundingVolume.distanceSquaredTo(n)-t.boundingVolume.distanceSquaredTo(n)+z.EPSILON12}function qnt(e,t,n,i,o){const r=e.context;tz(i,Gnt,e.camera.positionWC),C(o)&&t(o.unclassifiedCommand,e,r,n);const s=i.length;for(let a=0;a<s;++a)t(i[a],e,r,n)}function jnt(e,t,n,i,o){const r=e.context;tz(i,Wnt,e.camera.positionWC),C(o)&&t(o.unclassifiedCommand,e,r,n);const s=i.length;for(let a=0;a<s;++a)t(i[a],e,r,n)}knt=ft.inverseTransformation(knt,knt);const Ynt=new nE,Knt=new $C,Xnt=new jC,Qnt=new GC;function Jnt(e,t){const n=e.camera,i=e.context,o=e.frameState,r=i.uniformState;let s;r.updateCamera(n),s=C(n.frustum.fov)?n.frustum.clone(Ynt):C(n.frustum.infiniteProjectionMatrix)?n.frustum.clone(Knt):C(n.frustum.width)?n.frustum.clone(Xnt):n.frustum.clone(Qnt),s.near=n.frustum.near,s.far=n.frustum.far,r.updateFrustum(s),r.updatePass(HU.ENVIRONMENT);const a=o.passes,c=a.pick,l=e._environmentState,u=e._view,h=l.renderTranslucentDepthForPick,d=l.useWebVR;if(!c){const n=l.skyBoxCommand;if(C(n)&&Vnt(n,e,i,t),l.isSkyAtmosphereVisible&&Vnt(l.skyAtmosphereCommand,e,i,t),l.isSunVisible&&(l.sunDrawCommand.execute(i,t),e.sunBloom&&!d)){let n;n=l.useGlobeDepthFramebuffer?u.globeDepth.framebuffer:l.usePostProcess?u.sceneFramebuffer.framebuffer:l.originalFramebuffer,e._sunPostProcess.execute(i),e._sunPostProcess.copy(i,n),t.framebuffer=n}l.isMoonVisible&&l.moonCommand.execute(i,t)}let f;l.useOIT?(C(e._executeOITFunction)||(e._executeOITFunction=function(e,t,n,o,r){u.globeDepth.prepareColorTextures(i),u.oit.executeCommands(e,t,n,o,r)}),f=e._executeOITFunction):f=a.render?qnt:jnt;const p=u.frustumCommandsList,m=p.length,_=l.clearGlobeDepth,g=l.useDepthPlane,y=e._globeTranslucencyState,v=y.translucent,b=e._view.globeTranslucencyFramebuffer,A=e._depthClearCommand,w=e._stencilClearCommand,T=e._classificationStencilClearCommand,E=e._depthPlane,x=l.usePostProcessSelected,S=n.position.z;let I;for(let O=0;O<m;++O){const a=m-O-1,d=p[a];e.mode===ij.SCENE2D?(n.position.z=S-d.near+1,s.far=Math.max(1,d.far-d.near),s.near=1,r.update(o),r.updateFrustum(s)):(s.near=0!==a?d.near*e.opaqueFrustumNearOffset:d.near,s.far=d.far,r.updateFrustum(s)),A.execute(i,t),i.stencilBuffer&&w.execute(i,t),r.updatePass(HU.GLOBE);let D=d.commands[HU.GLOBE],P=d.indices[HU.GLOBE];if(v)y.executeGlobeCommands(d,Vnt,b,e,t);else for(I=0;I<P;++I)Vnt(D[I],e,i,t);const R=u.globeDepth;if(C(R)&&l.useGlobeDepthFramebuffer&&R.executeCopyDepth(i,t),!l.renderTranslucentDepthForPick)if(r.updatePass(HU.TERRAIN_CLASSIFICATION),D=d.commands[HU.TERRAIN_CLASSIFICATION],P=d.indices[HU.TERRAIN_CLASSIFICATION],v)y.executeGlobeClassificationCommands(d,Vnt,b,e,t);else for(I=0;I<P;++I)Vnt(D[I],e,i,t);if(_&&(A.execute(i,t),g&&E.execute(i,t)),!l.useInvertClassification||c||l.renderTranslucentDepthForPick){for(r.updatePass(HU.CESIUM_3D_TILE),D=d.commands[HU.CESIUM_3D_TILE],P=d.indices[HU.CESIUM_3D_TILE],I=0;I<P;++I)Vnt(D[I],e,i,t);if(P>0&&(C(R)&&l.useGlobeDepthFramebuffer&&(R.prepareColorTextures(i,_),R.executeUpdateDepth(i,t,_,R.depthStencilTexture)),!l.renderTranslucentDepthForPick))for(r.updatePass(HU.CESIUM_3D_TILE_CLASSIFICATION),D=d.commands[HU.CESIUM_3D_TILE_CLASSIFICATION],P=d.indices[HU.CESIUM_3D_TILE_CLASSIFICATION],I=0;I<P;++I)Vnt(D[I],e,i,t)}else{e._invertClassification.clear(i,t);const n=t.framebuffer;for(t.framebuffer=e._invertClassification._fbo.framebuffer,r.updatePass(HU.CESIUM_3D_TILE),D=d.commands[HU.CESIUM_3D_TILE],P=d.indices[HU.CESIUM_3D_TILE],I=0;I<P;++I)Vnt(D[I],e,i,t);for(C(R)&&l.useGlobeDepthFramebuffer&&(e._invertClassification.prepareTextures(i),R.executeUpdateDepth(i,t,_,e._invertClassification._fbo.getDepthStencilTexture())),r.updatePass(HU.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),D=d.commands[HU.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],P=d.indices[HU.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],I=0;I<P;++I)Vnt(D[I],e,i,t);for(t.framebuffer=n,e._invertClassification.executeClassified(i,t),1===o.invertClassificationColor.alpha&&e._invertClassification.executeUnclassified(i,t),P>0&&i.stencilBuffer&&T.execute(i,t),r.updatePass(HU.CESIUM_3D_TILE_CLASSIFICATION),D=d.commands[HU.CESIUM_3D_TILE_CLASSIFICATION],P=d.indices[HU.CESIUM_3D_TILE_CLASSIFICATION],I=0;I<P;++I)Vnt(D[I],e,i,t)}for(P>0&&i.stencilBuffer&&w.execute(i,t),r.updatePass(HU.OPAQUE),D=d.commands[HU.OPAQUE],P=d.indices[HU.OPAQUE],I=0;I<P;++I)Vnt(D[I],e,i,t);let L;0!==a&&e.mode!==ij.SCENE2D&&(s.near=d.near,r.updateFrustum(s)),!c&&l.useInvertClassification&&o.invertClassificationColor.alpha<1&&(L=e._invertClassification),r.updatePass(HU.TRANSLUCENT),D=d.commands[HU.TRANSLUCENT],D.length=d.indices[HU.TRANSLUCENT],f(e,Vnt,t,D,L);const M=d.indices[HU.CESIUM_3D_TILE_CLASSIFICATION]>0;if(M&&u.translucentTileClassification.isSupported()&&(u.translucentTileClassification.executeTranslucentCommands(e,Vnt,t,D,R.depthStencilTexture),u.translucentTileClassification.executeClassificationCommands(e,Vnt,t,d)),i.depthTexture&&e.useDepthPicking&&(l.useGlobeDepthFramebuffer||h)){const n=R.depthStencilTexture,o=e._picking.getPickDepth(e,a);o.update(i,n),o.executeCopyDepth(i,t)}if(c||!x)continue;const B=t.framebuffer;if(t.framebuffer=u.sceneFramebuffer.getIdFramebuffer(),s.near=0!==a?d.near*e.opaqueFrustumNearOffset:d.near,s.far=d.far,r.updateFrustum(s),r.updatePass(HU.GLOBE),D=d.commands[HU.GLOBE],P=d.indices[HU.GLOBE],v)y.executeGlobeCommands(d,Hnt,b,e,t);else for(I=0;I<P;++I)Hnt(D[I],e,i,t);for(_&&(A.framebuffer=t.framebuffer,A.execute(i,t),A.framebuffer=void 0),_&&g&&E.execute(i,t),r.updatePass(HU.CESIUM_3D_TILE),D=d.commands[HU.CESIUM_3D_TILE],P=d.indices[HU.CESIUM_3D_TILE],I=0;I<P;++I)Hnt(D[I],e,i,t);for(r.updatePass(HU.OPAQUE),D=d.commands[HU.OPAQUE],P=d.indices[HU.OPAQUE],I=0;I<P;++I)Hnt(D[I],e,i,t);for(r.updatePass(HU.TRANSLUCENT),D=d.commands[HU.TRANSLUCENT],P=d.indices[HU.TRANSLUCENT],I=0;I<P;++I)Hnt(D[I],e,i,t);t.framebuffer=B}}function Znt(e){const t=e.context.uniformState;t.updatePass(HU.COMPUTE);const n=e._environmentState.sunComputeCommand;C(n)&&n.execute(e._computeEngine);const i=e._computeCommandList,o=i.length;for(let r=0;r<o;++r)i[r].execute(e._computeEngine)}function $nt(e,t){const n=e.context.uniformState;n.updatePass(HU.OVERLAY);const i=e.context,o=e._overlayCommandList,r=o.length;for(let s=0;s<r;++s)o[s].execute(i,t)}function eit(e,t,n){const i=n.shadowMapCullingVolume,o=n.isPointLight,r=n.passes,s=r.length,a=t.length;for(let c=0;c<a;++c){const n=t[c];if(e.updateDerivedCommands(n),n.castShadows&&(n.pass===HU.GLOBE||n.pass===HU.CESIUM_3D_TILE||n.pass===HU.OPAQUE||n.pass===HU.TRANSLUCENT)&&e.isVisible(n,i))if(o)for(let e=0;e<s;++e)r[e].commandList.push(n);else if(1===s)r[0].commandList.push(n);else{let t=!1;for(let i=s-1;i>=0;--i){const o=r[i].cullingVolume;if(e.isVisible(n,o))r[i].commandList.push(n),t=!0;else if(t)break}}}}function tit(e){const t=e.frameState,n=t.shadowState.shadowMaps,i=n.length;if(!t.shadowState.shadowsEnabled)return;const o=e.context,r=o.uniformState;for(let s=0;s<i;++s){const t=n[s];if(t.outOfView)continue;const i=t.passes,a=i.length;for(let e=0;e<a;++e)i[e].commandList.length=0;const c=e.frameState.commandList;eit(e,c,t);for(let n=0;n<a;++n){const i=t.passes[n];r.updateCamera(i.camera),t.updatePass(o,n);const a=i.commandList.length;for(let t=0;t<a;++t){const n=i.commandList[t];r.updatePass(n.pass),Vnt(n.derivedCommands.shadows.castCommands[s],e,o,i.passState)}}}}const nit=new K;function iit(e,t,n){const i=e._view,o=i.camera,r=e._environmentState,s=r.renderTranslucentDepthForPick;yit(e,t,n),git(e),i.createPotentiallyVisibleSet(e),Znt(e),s||tit(e);const a=t.viewport;a.x=0,a.y=0,a.width=.5*a.width;const c=TYe.clone(o,e._cameraVR);c.frustum=o.frustum;const l=o.frustum.near,u=l*R(e.focalLength,5),h=R(e.eyeSeparation,u/30),d=K.multiplyByScalar(c.right,.5*h,nit);o.frustum.aspectRatio=a.width/a.height;const f=.5*h*l/u;K.add(c.position,d,o.position),o.frustum.xOffset=f,Jnt(e,t),a.x=a.width,K.subtract(c.position,d,o.position),o.frustum.xOffset=-f,Jnt(e,t),TYe.clone(c,o)}Int.prototype.updateAndExecuteCommands=function(e,t){const n=this._frameState,i=n.mode,o=this._environmentState.useWebVR;o?iit(this,e,t):i!==ij.SCENE2D||this._mapMode2D===$We.ROTATE?fit(!0,this,e,t):(yit(this,e,t),dit(this,e))};const oit=new se(Math.PI,z.PI_OVER_TWO),rit=new K,sit=new K,ait=new ft,cit=new ft,lit=new K,uit=new K,hit=new bf;function dit(e,t){const n=e.context,i=e.frameState,o=e.camera,r=t.viewport,s=bf.clone(r,hit);t.viewport=s;const a=oit,c=rit,l=e.mapProjection;l.project(a,c);const u=K.clone(o.position,sit),h=ft.clone(o.transform,cit),d=o.frustum.clone();o._setTransform(ft.IDENTITY);const f=ft.computeViewportTransformation(s,0,1,ait),p=o.frustum.projectionMatrix,m=o.positionWC.y,_=K.fromElements(z.sign(m)*c.x-m,0,-o.positionWC.x,lit),g=Kl.pointToGLWindowCoordinates(p,f,_,uit);g.x=Math.floor(g.x);const y=s.x,v=s.width;if(0===m||g.x<=y||g.x>=y+v)fit(!0,e,t);else if(Math.abs(y+.5*v-g.x)<1)s.width=g.x-s.x,o.position.x*=z.sign(o.position.x),o.frustum.right=0,i.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),n.uniformState.update(i),fit(!0,e,t),s.x=g.x,o.position.x=-o.position.x,o.frustum.right=-o.frustum.left,o.frustum.left=0,i.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),n.uniformState.update(i),fit(!1,e,t);else if(g.x>y+.5*v){s.width=g.x-y;const r=o.frustum.right;o.frustum.right=c.x-m,i.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),n.uniformState.update(i),fit(!0,e,t),s.x=g.x,s.width=y+v-g.x,o.position.x=-o.position.x,o.frustum.left=-o.frustum.right,o.frustum.right=r-2*o.frustum.right,i.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),n.uniformState.update(i),fit(!1,e,t)}else{s.x=g.x,s.width=y+v-g.x;const r=o.frustum.left;o.frustum.left=-c.x-m,i.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),n.uniformState.update(i),fit(!0,e,t),s.x=y,s.width=g.x-y,o.position.x=-o.position.x,o.frustum.right=-o.frustum.left,o.frustum.left=r-2*o.frustum.left,i.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),n.uniformState.update(i),fit(!1,e,t)}o._setTransform(h),K.clone(u,o.position),o.frustum=d.clone(),t.viewport=r}function fit(e,t,n,i){const o=t._environmentState,r=t._view,s=o.renderTranslucentDepthForPick;e||(t.frameState.commandList.length=0),git(t),r.createPotentiallyVisibleSet(t),e&&(C(i)&&yit(t,n,i),Znt(t),s||tit(t)),Jnt(t,n)}const pit=new CT;function mit(e){const t=e._frameState;e.debugShowFrustumPlanes!==e._debugShowFrustumPlanes&&(e.debugShowFrustumPlanes?e._debugFrustumPlanes=new EXe({camera:e.camera,updateOnChange:!1,frustumSplits:t.frustumSplits}):e._debugFrustumPlanes=e._debugFrustumPlanes&&e._debugFrustumPlanes.destroy(),e._debugShowFrustumPlanes=e.debugShowFrustumPlanes),C(e._debugFrustumPlanes)&&e._debugFrustumPlanes.update(t)}function _it(e){const t=e._frameState,n=t.shadowMaps,i=n.length,o=i>0&&!t.passes.pick&&e.mode===ij.SCENE3D;if(o!==t.shadowState.shadowsEnabled&&(++t.shadowState.lastDirtyTime,t.shadowState.shadowsEnabled=o),t.shadowState.lightShadowsEnabled=!1,o){for(let e=0;e<i;++e)if(n[e]!==t.shadowState.shadowMaps[e]){++t.shadowState.lastDirtyTime;break}t.shadowState.shadowMaps.length=0,t.shadowState.lightShadowMaps.length=0;for(let e=0;e<i;++e){const i=n[e];i.update(t),t.shadowState.shadowMaps.push(i),i.fromLightSource&&(t.shadowState.lightShadowMaps.push(i),t.shadowState.lightShadowsEnabled=!0),i.dirty&&(++t.shadowState.lastDirtyTime,i.dirty=!1)}}}function git(e){const t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),mit(e),_it(e),e._globe&&e._globe.render(t)}function yit(e,t,n){const i=e._context,o=e._frameState,r=e._environmentState,s=e._view,a=e._frameState.passes,c=a.pick;C(s.globeDepth)&&(s.globeDepth.picking=c);const l=r.useWebVR;r.originalFramebuffer=t.framebuffer,C(e.sun)&&e.sunBloom!==e._sunBloom?(e.sunBloom&&!l?e._sunPostProcess=new xnt:C(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy()),e._sunBloom=e.sunBloom):!C(e.sun)&&C(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy(),e._sunBloom=!1);const u=e._clearColorCommand;xy.clone(n,u.color),u.execute(i,t);const h=r.useGlobeDepthFramebuffer=C(s.globeDepth);h&&(s.globeDepth.update(i,t,s.viewport,e.msaaSamples,e._hdr,r.clearGlobeDepth),s.globeDepth.clear(i,t,n));const d=s.oit,f=r.useOIT=!c&&C(d)&&d.isSupported();f&&(d.update(i,t,s.globeDepth.colorFramebufferManager,e._hdr,e.msaaSamples),d.clear(i,t,n),r.useOIT=d.isSupported());const p=e.postProcessStages;let m=r.usePostProcess=!c&&(e._hdr||p.length>0||p.ambientOcclusion.enabled||p.fxaa.enabled||p.bloom.enabled);r.usePostProcessSelected=!1,m&&(s.sceneFramebuffer.update(i,s.viewport,e._hdr,e.msaaSamples),s.sceneFramebuffer.clear(i,t,n),p.update(i,o.useLogDepth,e._hdr),p.clear(i),m=r.usePostProcess=p.ready,r.usePostProcessSelected=m&&p.hasSelected),r.isSunVisible&&e.sunBloom&&!l?(t.framebuffer=e._sunPostProcess.update(t),e._sunPostProcess.clear(i,t,n)):h?t.framebuffer=s.globeDepth.framebuffer:m&&(t.framebuffer=s.sceneFramebuffer.framebuffer),C(t.framebuffer)&&u.execute(i,t);const _=r.useInvertClassification=!c&&C(t.framebuffer)&&e.invertClassification;if(_){let n;if(1===e.frameState.invertClassificationColor.alpha&&r.useGlobeDepthFramebuffer&&(n=s.globeDepth.framebuffer),C(n)||i.depthTexture){if(e._invertClassification.previousFramebuffer=n,e._invertClassification.update(i,e.msaaSamples,s.globeDepth.colorFramebufferManager),e._invertClassification.clear(i,t),e.frameState.invertClassificationColor.alpha<1&&f){const t=e._invertClassification.unclassifiedCommand,n=t.derivedCommands;n.oit=d.createDerivedCommands(t,i,n.oit)}}else r.useInvertClassification=!1}e._globeTranslucencyState.translucent&&s.globeTranslucencyFramebuffer.updateAndClear(e._hdr,s.viewport,i,t)}function vit(e){const t=e._frameState.afterRender;for(let n=0,i=t.length;n<i;++n)t[n](),e.requestRender();t.length=0}function bit(e){const t=e._globe,n=e.camera,i=n.positionCartographic;if(C(t)&&t.show&&C(i))return t.getHeight(i)}function Ait(e){const t=e.camera,n=e._mode,i=e.globe,o=e._screenSpaceCameraController,r=t.positionCartographic;if(!C(r))return!1;if(!o.onMap()&&r.height<0)return!0;if(!C(i)||!i.show||n===ij.SCENE2D||n===ij.MORPHING)return!1;const s=e._globeHeight;return C(s)&&r.height<s}function wit(e,t){if(e.debugShowFramesPerSecond){if(!C(e._performanceDisplay)){const t=document.createElement("div");t.className="cesium-performanceDisplay-defaultContainer";const n=e._canvas.parentNode;n.appendChild(t);const i=new B4e({container:t});e._performanceDisplay=i,e._performanceContainer=t}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else C(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}function Tit(e){e._jobScheduler.resetBudgets();const t=e._frameState,n=e.primitives;n.prePassesUpdate(t),C(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function Cit(e){const t=e._frameState,n=e.primitives;n.postPassesUpdate(t),vi.update()}Int.prototype.updateEnvironment=function(){const e=this._frameState,t=this._view,n=this._environmentState,i=e.passes.render,o=e.passes.offscreen,r=this.skyAtmosphere,s=this.globe,a=this._globeTranslucencyState;if(!i||this._mode!==ij.SCENE2D&&t.camera.frustum instanceof jC||!a.environmentVisible)n.skyAtmosphereCommand=void 0,n.skyBoxCommand=void 0,n.sunDrawCommand=void 0,n.sunComputeCommand=void 0,n.moonCommand=void 0;else{C(r)?(C(s)&&(r.setDynamicAtmosphereColor(s.enableLighting&&s.dynamicAtmosphereLighting,s.dynamicAtmosphereLightingFromSun),n.isReadyForAtmosphere=n.isReadyForAtmosphere||s._surface._tilesToRender.length>0),n.skyAtmosphereCommand=r.update(e,s),C(n.skyAtmosphereCommand)&&this.updateDerivedCommands(n.skyAtmosphereCommand)):n.skyAtmosphereCommand=void 0,n.skyBoxCommand=C(this.skyBox)?this.skyBox.update(e,this._hdr):void 0;const i=C(this.sun)?this.sun.update(e,t.passState,this._hdr):void 0;n.sunDrawCommand=C(i)?i.drawCommand:void 0,n.sunComputeCommand=C(i)?i.computeCommand:void 0,n.moonCommand=C(this.moon)?this.moon.update(e):void 0}const c=n.clearGlobeDepth=C(s)&&s.show&&(!s.depthTestAgainstTerrain||this.mode===ij.SCENE2D),l=n.useDepthPlane=c&&this.mode===ij.SCENE3D&&a.useDepthPlane;l&&this._depthPlane.update(e),n.renderTranslucentDepthForPick=!1,n.useWebVR=this._useWebVR&&this.mode!==ij.SCENE2D&&!o;const u=e.mode!==ij.SCENE3D||a.sunVisibleThroughGlobe?void 0:e.occluder;let h=e.cullingVolume;const d=pit.planes;for(let m=0;m<5;++m)d[m]=h.planes[m];h=pit,n.isSkyAtmosphereVisible=C(n.skyAtmosphereCommand)&&n.isReadyForAtmosphere,n.isSunVisible=this.isVisible(n.sunDrawCommand,h,u),n.isMoonVisible=this.isVisible(n.moonCommand,h,u);const f=this.specularEnvironmentMaps;let p=this._specularEnvironmentMapAtlas;!C(f)||C(p)&&p.url===f?!C(f)&&C(p)&&(p.destroy(),this._specularEnvironmentMapAtlas=void 0):(p=p&&p.destroy(),this._specularEnvironmentMapAtlas=new JQ(f)),C(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e)},Int.prototype.resolveFramebuffers=function(e){const t=this._context,n=this._environmentState,i=this._view,o=i.globeDepth;C(o)&&o.prepareColorTextures(t);const r=n.useOIT,s=n.useGlobeDepthFramebuffer,a=n.usePostProcess,c=n.originalFramebuffer,l=s?o.colorFramebufferManager:void 0,u=i.sceneFramebuffer._colorFramebuffer,h=i.sceneFramebuffer.idFramebuffer;r&&(e.framebuffer=a?u.framebuffer:c,i.oit.execute(t,e));const d=i.translucentTileClassification;if(d.hasTranslucentDepth&&d.isSupported()&&d.execute(this,e),a){i.sceneFramebuffer.prepareColorTextures(t);let e=u;s&&!r&&(e=l);const n=this.postProcessStages,o=e.getColorTexture(0),a=h.getColorTexture(0),d=R(l,u).getDepthStencilTexture();n.execute(t,o,d,a),n.copy(t,c)}r||a||!s||(e.framebuffer=c,o.executeCopyColor(t,e))},Int.prototype.initializeFrame=function(){120===this._shaderFrameCount++&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures()),this._tweens.update(),this._globeHeight=bit(this),this._cameraUnderground=Ait(this),this._globeTranslucencyState.update(this),this._screenSpaceCameraController.update(),C(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged()};const Eit=new xy;function xit(e){const t=e._frameState,n=e.context,i=n.uniformState,o=e._defaultView;e._view=o,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=Pnt;let r=R(e.backgroundColor,xy.BLACK);e._hdr&&(r=xy.clone(r,Eit),r.red=Math.pow(r.red,e.gamma),r.green=Math.pow(r.green,e.gamma),r.blue=Math.pow(r.blue,e.gamma)),t.backgroundColor=r,e.fog.update(t),i.update(t);const s=e.shadowMap;C(s)&&s.enabled&&(!C(e.light)||e.light instanceof HHe?K.negate(i.sunDirectionWC,e._shadowMapCamera.direction):K.clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(s)),e._computeCommandList.length=0,e._overlayCommandList.length=0;const a=o.viewport;a.x=0,a.y=0,a.width=n.drawingBufferWidth,a.height=n.drawingBufferHeight;const c=o.passState;c.framebuffer=void 0,c.blendingEnabled=void 0,c.scissorTest=void 0,c.viewport=bf.clone(a,c.viewport),C(e.globe)&&e.globe.beginFrame(t),e.updateEnvironment(),e.updateAndExecuteCommands(c,r),e.resolveFramebuffers(c),c.framebuffer=void 0,$nt(e,c),C(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),n.endFrame()}function Sit(e,t){try{t(e)}catch(n){if(e._renderError.raiseEvent(e,n),e.rethrowRenderErrors)throw n}}function Iit(e){return e._picking.updateMostDetailedRayPicks(e)}function Oit(e){const t=e._frameState;Rnt.camera=t.camera,Rnt.cullingVolume=t.cullingVolume;const n=e.primitives;n.updateForPass(t,Rnt)}function Dit(e){const t=e._frameState,n=t.camera;if(!n.canPreloadFlight())return;Lnt.camera=e.preloadFlightCamera,Lnt.cullingVolume=e.preloadFlightCullingVolume;const i=e.primitives;i.updateForPass(t,Lnt)}function Pit(e){e.primitives.updateForPass(e._frameState,Mnt)}Int.prototype.render=function(e){this._preUpdate.raiseEvent(this,e);const t=this._frameState;t.newFrame=!1,C(e)||(e=Ea.now());const n=this._view.checkForCameraUpdates(this);let i=!this.requestRenderMode||this._renderRequested||n||this._logDepthBufferDirty||this._hdrDirty||this.mode===ij.MORPHING;if(!i&&C(this.maximumRenderTimeChange)&&C(this._lastRenderTime)){const t=Math.abs(Ea.secondsDifference(this._lastRenderTime,e));i=i||t>this.maximumRenderTimeChange}if(i){this._lastRenderTime=Ea.clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1;const n=z.incrementWrap(t.frameNumber,15e6,1);znt(this,n,e),t.newFrame=!0}Sit(this,Tit),this.primitives.show&&(Sit(this,Iit),Sit(this,Oit),Sit(this,Dit),i||Sit(this,Pit)),this._postUpdate.raiseEvent(this,e),i&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),Sit(this,xit)),wit(this,i),Sit(this,Cit),vit(this),i&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())},Int.prototype.forceRender=function(e){this._renderRequested=!0,this.render(e)},Int.prototype.requestRender=function(){this._renderRequested=!0},Int.prototype.clampLineWidth=function(e){return Math.max(Ck.minimumAliasedLineWidth,Math.min(e,Ck.maximumAliasedLineWidth))},Int.prototype.pick=function(e,t,n){return this._picking.pick(this,e,t,n)},Int.prototype.pickPositionWorldCoordinates=function(e,t){return this._picking.pickPositionWorldCoordinates(this,e,t)},Int.prototype.pickPosition=function(e,t){return this._picking.pickPosition(this,e,t)},Int.prototype.drillPick=function(e,t,n,i){return this._picking.drillPick(this,e,t,n,i)},Int.prototype.pickFromRay=function(e,t,n){return this._picking.pickFromRay(this,e,t,n)},Int.prototype.drillPickFromRay=function(e,t,n,i){return this._picking.drillPickFromRay(this,e,t,n,i)},Int.prototype.pickFromRayMostDetailed=function(e,t,n){return this._picking.pickFromRayMostDetailed(this,e,t,n)},Int.prototype.drillPickFromRayMostDetailed=function(e,t,n,i){return this._picking.drillPickFromRayMostDetailed(this,e,t,n,i)},Int.prototype.sampleHeight=function(e,t,n){return this._picking.sampleHeight(this,e,t,n)},Int.prototype.clampToHeight=function(e,t,n,i){return this._picking.clampToHeight(this,e,t,n,i)},Int.prototype.sampleHeightMostDetailed=function(e,t,n){return this._picking.sampleHeightMostDetailed(this,e,t,n)},Int.prototype.clampToHeightMostDetailed=function(e,t,n){return this._picking.clampToHeightMostDetailed(this,e,t,n)},Int.prototype.cartesianToCanvasCoordinates=function(e,t){return Aoe.wgs84ToWindowCoordinates(this,e,t)},Int.prototype.completeMorph=function(){this._transitioner.completeMorph()},Int.prototype.morphTo2D=function(e){let t;const n=this.globe;t=C(n)?n.ellipsoid:this.mapProjection.ellipsoid,e=R(e,2),this._transitioner.morphTo2D(e,t)},Int.prototype.morphToColumbusView=function(e){let t;const n=this.globe;t=C(n)?n.ellipsoid:this.mapProjection.ellipsoid,e=R(e,2),this._transitioner.morphToColumbusView(e,t)},Int.prototype.morphTo3D=function(e){let t;const n=this.globe;t=C(n)?n.ellipsoid:this.mapProjection.ellipsoid,e=R(e,2),this._transitioner.morphTo3D(e,t)},Int.prototype.isDestroyed=function(){return!1},Int.prototype.destroy=function(){this._tweens.removeAll(),this._computeEngine=this._computeEngine&&this._computeEngine.destroy(),this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy(),this._globe=this._globe&&this._globe.destroy(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._debugSphere=this._debugSphere&&this._debugSphere.destroy(),this.sun=this.sun&&this.sun.destroy(),this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy(),this._depthPlane=this._depthPlane&&this._depthPlane.destroy(),this._transitioner=this._transitioner&&this._transitioner.destroy(),this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy(),this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy(),this._picking=this._picking&&this._picking.destroy(),this._defaultView=this._defaultView&&this._defaultView.destroy(),this._view=void 0,this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer),this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy(),this._context=this._context&&this._context.destroy(),this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy(),C(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer)),this._removeRequestListenerCallback(),this._removeTaskProcessorListenerCallback();for(let e=0;e<this._removeGlobeCallbacks.length;++e)this._removeGlobeCallbacks[e]();return this._removeGlobeCallbacks.length=0,Qh(this)};var Rit=Int,Lit="/**\n * @license\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * * Neither the name of the project nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Modifications made by Cesium GS, Inc.\n */\n\n // Code:  http://sponeil.net/\n // GPU Gems 2 Article:  https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\n\nconst float Kr = 0.0025;\nconst float Kr4PI = Kr * 4.0 * czm_pi;\nconst float Km = 0.0015;\nconst float Km4PI = Km * 4.0 * czm_pi;\nconst float ESun = 15.0;\nconst float KmESun = Km * ESun;\nconst float KrESun = Kr * ESun;\nconst vec3 InvWavelength = vec3(\n    5.60204474633241,  // Red = 1.0 / Math.pow(0.650, 4.0)\n    9.473284437923038, // Green = 1.0 / Math.pow(0.570, 4.0)\n    19.643802610477206); // Blue = 1.0 / Math.pow(0.475, 4.0)\nconst float rayleighScaleDepth = 0.25;\n\nconst int nSamples = 2;\nconst float fSamples = 2.0;\n\nconst float g = -0.95;\nconst float g2 = g * g;\n\n#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift; // Hue, saturation, brightness\n#endif\n\nuniform vec3 u_radiiAndDynamicAtmosphereColor; // outer radius, inner radius, dynamic atmosphere color flag\n\nfloat scale(float cosAngle)\n{\n    float x = 1.0 - cosAngle;\n    return rayleighScaleDepth  * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvec3 getLightDirection(vec3 positionWC)\n{\n    float lightEnum = u_radiiAndDynamicAtmosphereColor.z;\n    vec3 lightDirection =\n        positionWC * float(lightEnum == 0.0) +\n        czm_lightDirectionWC * float(lightEnum == 1.0) +\n        czm_sunDirectionWC * float(lightEnum == 2.0);\n    return normalize(lightDirection);\n}\n\nvoid calculateRayScatteringFromSpace(in vec3 positionWC, in vec3 ray, in float innerRadius, in float outerRadius, inout float far, out vec3 start, out float startOffset)\n{\n    // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n    float cameraHeight = length(positionWC);\n    float B = 2.0 * dot(positionWC, ray);\n    float C = cameraHeight * cameraHeight - outerRadius * outerRadius;\n    float det = max(0.0, B * B - 4.0 * C);\n    float near = 0.5 * (-B - sqrt(det));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    start = positionWC + ray * near;\n    far -= near;\n    float startAngle = dot(ray, start) / outerRadius;\n    float startDepth = exp(-1.0 / rayleighScaleDepth);\n    startOffset = startDepth * scale(startAngle);\n}\n\nvoid calculateRayScatteringFromGround(in vec3 positionWC, in vec3 ray, in float atmosphereScale, in float innerRadius, out vec3 start, out float startOffset)\n{\n    // Calculate the ray's starting position, then calculate its scattering offset\n    float cameraHeight = length(positionWC);\n    start = positionWC;\n    float height = length(start);\n    float depth = exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - cameraHeight));\n    float startAngle = dot(ray, start) / height;\n    startOffset = depth*scale(startAngle);\n}\n\nczm_raySegment rayEllipsoidIntersection(czm_ray ray, vec3 inverseRadii)\n{\n    vec3 o = inverseRadii * (czm_inverseView * vec4(ray.origin, 1.0)).xyz;\n    vec3 d = inverseRadii * (czm_inverseView * vec4(ray.direction, 0.0)).xyz;\n\n    float a = dot(d, d);\n    float b = dot(d, o);\n    float c = dot(o, o) - 1.0;\n    float discriminant = b * b - a * c;\n    if (discriminant < 0.0)\n    {\n        return czm_emptyRaySegment;\n    }\n    discriminant = sqrt(discriminant);\n    float t1 = (-b - discriminant) / a;\n    float t2 = (-b + discriminant) / a;\n\n    if (t1 < 0.0 && t2 < 0.0)\n    {\n        return czm_emptyRaySegment;\n    }\n\n    if (t1 < 0.0 && t2 >= 0.0)\n    {\n        t1 = 0.0;\n    }\n\n    return czm_raySegment(t1, t2);\n}\n\nvec3 getAdjustedPosition(vec3 positionWC, float innerRadius)\n{\n  // Adjust the camera position so that atmosphere color looks the same wherever the eye height is the same\n  float cameraHeight = czm_eyeHeight + innerRadius;\n  return normalize(positionWC) * cameraHeight;\n}\n\nvec3 getTranslucentPosition(vec3 positionWC, vec3 outerPositionWC, float innerRadius, out bool intersectsEllipsoid)\n{\n    vec3 directionWC = normalize(outerPositionWC - positionWC);\n    vec3 directionEC = czm_viewRotation * directionWC;\n    czm_ray viewRay = czm_ray(vec3(0.0), directionEC);\n    czm_raySegment raySegment = rayEllipsoidIntersection(viewRay, czm_ellipsoidInverseRadii);\n    intersectsEllipsoid = raySegment.start >= 0.0;\n\n    if (intersectsEllipsoid)\n    {\n        return positionWC + raySegment.stop * directionWC;\n    }\n\n    return getAdjustedPosition(positionWC, innerRadius);\n}\n\nvoid calculateMieColorAndRayleighColor(vec3 outerPositionWC, out vec3 mieColor, out vec3 rayleighColor)\n{\n    // Unpack attributes\n    float outerRadius = u_radiiAndDynamicAtmosphereColor.x;\n    float innerRadius = u_radiiAndDynamicAtmosphereColor.y;\n\n#ifdef GLOBE_TRANSLUCENT\n    bool intersectsEllipsoid = false;\n    vec3 startPositionWC = getTranslucentPosition(czm_viewerPositionWC, outerPositionWC, innerRadius, intersectsEllipsoid);\n#else\n    vec3 startPositionWC = getAdjustedPosition(czm_viewerPositionWC, innerRadius);\n#endif\n\n    vec3 lightDirection = getLightDirection(startPositionWC);\n\n    // Get the ray from the start position to the outer position and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 ray = outerPositionWC - startPositionWC;\n    float far = length(ray);\n    ray /= far;\n\n    float atmosphereScale = 1.0 / (outerRadius - innerRadius);\n\n    vec3 start;\n    float startOffset;\n\n#ifdef SKY_FROM_SPACE\n#ifdef GLOBE_TRANSLUCENT\n    if (intersectsEllipsoid)\n    {\n        calculateRayScatteringFromGround(startPositionWC, ray, atmosphereScale, innerRadius, start, startOffset);\n    }\n    else\n    {\n        calculateRayScatteringFromSpace(startPositionWC, ray, innerRadius, outerRadius, far, start, startOffset);\n    }\n#else\n    calculateRayScatteringFromSpace(startPositionWC, ray, innerRadius, outerRadius, far, start, startOffset);\n#endif\n#else\n    calculateRayScatteringFromGround(startPositionWC, ray, atmosphereScale, innerRadius, start, startOffset);\n#endif\n\n    // Initialize the scattering loop variables\n    float sampleLength = far / fSamples;\n    float scaledLength = sampleLength * atmosphereScale;\n    vec3 sampleRay = ray * sampleLength;\n    vec3 samplePoint = start + sampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 frontColor = vec3(0.0, 0.0, 0.0);\n\n    for (int i = 0; i<nSamples; i++)\n    {\n        float height = length(samplePoint);\n        float depth = exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - height));\n        float fLightAngle = dot(lightDirection, samplePoint) / height;\n        float fCameraAngle = dot(ray, samplePoint) / height;\n        float fScatter = (startOffset + depth*(scale(fLightAngle) - scale(fCameraAngle)));\n        vec3 attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\n        frontColor += attenuate * (depth * scaledLength);\n        samplePoint += sampleRay;\n    }\n\n    // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\n    mieColor = frontColor * KmESun;\n    rayleighColor = frontColor * (InvWavelength * KrESun);\n\n    // Cap mie and rayleigh colors to prevent NaNs when vertex interpolation happens\n    mieColor = min(mieColor, vec3(10000000.0));\n    rayleighColor = min(rayleighColor, vec3(10000000.0));\n}\n\nvec4 calculateFinalColor(vec3 positionWC, vec3 toCamera, vec3 lightDirection, vec3 mieColor, vec3 rayleighColor)\n{\n    // Extra normalize added for Android\n    float cosAngle = dot(lightDirection, normalize(toCamera)) / length(toCamera);\n    float rayleighPhase = 0.75 * (1.0 + cosAngle * cosAngle);\n    float miePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + cosAngle * cosAngle) / pow(1.0 + g2 - 2.0 * g * cosAngle, 1.5);\n\n    vec3 rgb = rayleighPhase * rayleighColor + miePhase * mieColor;\n\n    const float exposure = 2.0;\n    vec3 rgbExposure = vec3(1.0) - exp(-exposure * rgb);\n\n#ifndef HDR\n    rgb = rgbExposure;\n#endif\n\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n\n    float outerRadius = u_radiiAndDynamicAtmosphereColor.x;\n    float innerRadius = u_radiiAndDynamicAtmosphereColor.y;\n    float lightEnum = u_radiiAndDynamicAtmosphereColor.z;\n\n    float cameraHeight = czm_eyeHeight + innerRadius;\n\n    // Alter alpha based on how close the viewer is to the ground (1.0 = on ground, 0.0 = at edge of atmosphere)\n    float atmosphereAlpha = clamp((outerRadius - cameraHeight) / (outerRadius - innerRadius), 0.0, 1.0);\n\n    // Alter alpha based on time of day (0.0 = night , 1.0 = day)\n    float nightAlpha = (lightEnum != 0.0) ? clamp(dot(normalize(positionWC), lightDirection), 0.0, 1.0) : 1.0;\n    atmosphereAlpha *= pow(nightAlpha, 0.5);\n\n    vec4 finalColor = vec4(rgb, mix(clamp(rgbExposure.b, 0.0, 1.0), 1.0, atmosphereAlpha) * smoothstep(0.0, 1.0, czm_morphTime));\n\n    if (mieColor.b > 1.0)\n    {\n        // Fade atmosphere below the ellipsoid. As the camera zooms further away from the ellipsoid draw\n        // a larger atmosphere ring to cover empty space of lower LOD globe tiles.\n        float strength = mieColor.b;\n        float minDistance = outerRadius;\n        float maxDistance = outerRadius * 3.0;\n        float maxStrengthLerp = 1.0 - clamp((maxDistance - cameraHeight) / (maxDistance - minDistance), 0.0, 1.0);\n        float maxStrength = mix(100.0, 10000.0, maxStrengthLerp);\n        strength = min(strength, maxStrength);\n        float alpha = 1.0 - (strength / maxStrength);\n        finalColor.a = alpha;\n    }\n\n    return finalColor;\n}\n",Mit="varying vec3 v_outerPositionWC;\n\n#ifndef PER_FRAGMENT_ATMOSPHERE\nvarying vec3 v_mieColor;\nvarying vec3 v_rayleighColor;\n#endif\n\nvoid main (void)\n{\n    vec3 toCamera = czm_viewerPositionWC - v_outerPositionWC;\n    vec3 lightDirection = getLightDirection(czm_viewerPositionWC);\n    vec3 mieColor;\n    vec3 rayleighColor;\n\n#ifdef PER_FRAGMENT_ATMOSPHERE\n    calculateMieColorAndRayleighColor(v_outerPositionWC, mieColor, rayleighColor);\n#else\n    mieColor = v_mieColor;\n    rayleighColor = v_rayleighColor;\n#endif\n\n    gl_FragColor = calculateFinalColor(czm_viewerPositionWC, toCamera, lightDirection, mieColor, rayleighColor);\n}\n",Bit="attribute vec4 position;\n\nvarying vec3 v_outerPositionWC;\n\n#ifndef PER_FRAGMENT_ATMOSPHERE\nvarying vec3 v_mieColor;\nvarying vec3 v_rayleighColor;\n#endif\n\nvoid main(void)\n{\n    vec4 positionWC = czm_model * position;\n\n#ifndef PER_FRAGMENT_ATMOSPHERE\n    calculateMieColorAndRayleighColor(positionWC.xyz, v_mieColor, v_rayleighColor);\n#endif\n    v_outerPositionWC = positionWC.xyz;\n    gl_Position = czm_modelViewProjection * position;\n}\n";function Nit(e){e=R(e,ge.WGS84),this.show=!0,this.perFragmentAtmosphere=!1,this._ellipsoid=e;const t=1.025,n=K.multiplyByScalar(e.radii,t,new K);this._scaleMatrix=ft.fromScale(n),this._modelMatrix=new ft,this._command=new UU({owner:this,modelMatrix:this._modelMatrix}),this._spSkyFromSpace=void 0,this._spSkyFromAtmosphere=void 0,this._flags=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this._hueSaturationBrightness=new K;const i=new K;i.x=e.maximumRadius*t,i.y=e.maximumRadius,i.z=0,this._radiiAndDynamicAtmosphereColor=i;const o=this;this._command.uniformMap={u_radiiAndDynamicAtmosphereColor:function(){return o._radiiAndDynamicAtmosphereColor},u_hsbShift:function(){return o._hueSaturationBrightness.x=o.hueShift,o._hueSaturationBrightness.y=o.saturationShift,o._hueSaturationBrightness.z=o.brightnessShift,o._hueSaturationBrightness}}}Object.defineProperties(Nit.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),Nit.prototype.setDynamicAtmosphereColor=function(e,t){const n=e?t?2:1:0;this._radiiAndDynamicAtmosphereColor.z=n};const Fit=new ft;function zit(e){return!(z.equalsEpsilon(e.hueShift,0,z.EPSILON7)&&z.equalsEpsilon(e.saturationShift,0,z.EPSILON7)&&z.equalsEpsilon(e.brightnessShift,0,z.EPSILON7))}Nit.prototype.update=function(e,t){if(!this.show)return;const n=e.mode;if(n!==ij.SCENE3D&&n!==ij.MORPHING)return;if(!e.passes.render)return;const i=ft.fromRotationTranslation(e.context.uniformState.inverseViewRotation,K.ZERO,Fit),o=ft.multiplyTransformation(i,iJ.Y_UP_TO_Z_UP,Fit),r=ft.multiply(this._scaleMatrix,o,Fit);ft.clone(r,this._modelMatrix);const s=e.context,a=zit(this),c=e.globeTranslucencyState.translucent,l=this.perFragmentAtmosphere||c||!C(t)||!t.show,u=this._command;if(!C(u.vertexArray)){const e=bC.createGeometry(new bC({radii:new K(1,1,1),slicePartitions:256,stackPartitions:256,vertexFormat:jf.POSITION_ONLY}));u.vertexArray=bq.fromGeometry({context:s,geometry:e,attributeLocations:fg.createAttributeLocations(e),bufferUsage:lq.STATIC_DRAW}),u.renderState=yV.fromCache({cull:{enabled:!0,face:yk.FRONT},blending:_k.ALPHA_BLEND,depthMask:!1})}const h=a|l<<2|c<<3;if(h!==this._flags){this._flags=h;const e=[];a&&e.push("COLOR_CORRECT"),l&&e.push("PER_FRAGMENT_ATMOSPHERE"),c&&e.push("GLOBE_TRANSLUCENT");let t=new tq({defines:e.concat("SKY_FROM_SPACE"),sources:[Lit,Bit]}),n=new tq({defines:e.concat("SKY_FROM_SPACE"),sources:[Lit,Mit]});this._spSkyFromSpace=fH.fromCache({context:s,vertexShaderSource:t,fragmentShaderSource:n}),t=new tq({defines:e.concat("SKY_FROM_ATMOSPHERE"),sources:[Lit,Bit]}),n=new tq({defines:e.concat("SKY_FROM_ATMOSPHERE"),sources:[Lit,Mit]}),this._spSkyFromAtmosphere=fH.fromCache({context:s,vertexShaderSource:t,fragmentShaderSource:n})}const d=e.camera.positionWC,f=K.magnitude(d);return f>this._radiiAndDynamicAtmosphereColor.x?u.shaderProgram=this._spSkyFromSpace:u.shaderProgram=this._spSkyFromAtmosphere,u},Nit.prototype.isDestroyed=function(){return!1},Nit.prototype.destroy=function(){const e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),this._spSkyFromSpace=this._spSkyFromSpace&&this._spSkyFromSpace.destroy(),this._spSkyFromAtmosphere=this._spSkyFromAtmosphere&&this._spSkyFromAtmosphere.destroy(),Qh(this)};var kit=Nit,Uit="uniform samplerCube u_cubeMap;\n\nvarying vec3 v_texCoord;\n\nvoid main()\n{\n    vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\n    gl_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n}\n",Vit="attribute vec3 position;\n\nvarying vec3 v_texCoord;\n\nvoid main()\n{\n    vec3 p = czm_viewRotation * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n    gl_Position = czm_projection * vec4(p, 1.0);\n    v_texCoord = position.xyz;\n}\n";function Hit(e){this.sources=e.sources,this._sources=void 0,this.show=R(e.show,!0),this._command=new UU({modelMatrix:ft.clone(ft.IDENTITY),owner:this}),this._cubeMap=void 0,this._attributeLocations=void 0,this._useHdr=void 0}Hit.prototype.update=function(e,t){const n=this;if(!this.show)return;if(e.mode!==ij.SCENE3D&&e.mode!==ij.MORPHING)return;if(!e.passes.render)return;const i=e.context;if(this._sources!==this.sources){this._sources=this.sources;const e=this.sources;if(!C(e.positiveX)||!C(e.negativeX)||!C(e.positiveY)||!C(e.negativeY)||!C(e.positiveZ)||!C(e.negativeZ))throw new x("this.sources is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");if(typeof e.positiveX!==typeof e.negativeX||typeof e.positiveX!==typeof e.positiveY||typeof e.positiveX!==typeof e.negativeY||typeof e.positiveX!==typeof e.positiveZ||typeof e.positiveX!==typeof e.negativeZ)throw new x("this.sources properties must all be the same type.");"string"===typeof e.positiveX?XGe(i,this._sources).then((function(e){n._cubeMap=n._cubeMap&&n._cubeMap.destroy(),n._cubeMap=e})):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new zk({context:i,source:e}))}const o=this._command;if(!C(o.vertexArray)){o.uniformMap={u_cubeMap:function(){return n._cubeMap}};const e=ep.createGeometry(ep.fromDimensions({dimensions:new K(2,2,2),vertexFormat:jf.POSITION_ONLY})),t=this._attributeLocations=fg.createAttributeLocations(e);o.vertexArray=bq.fromGeometry({context:i,geometry:e,attributeLocations:t,bufferUsage:lq.STATIC_DRAW}),o.renderState=yV.fromCache({blending:_k.ALPHA_BLEND})}if(!C(o.shaderProgram)||this._useHdr!==t){const e=new tq({defines:[t?"HDR":""],sources:[Uit]});o.shaderProgram=fH.fromCache({context:i,vertexShaderSource:Vit,fragmentShaderSource:e,attributeLocations:this._attributeLocations}),this._useHdr=t}return C(this._cubeMap)?o:void 0},Hit.prototype.isDestroyed=function(){return!1},Hit.prototype.destroy=function(){const e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),Qh(this)};var Git=Hit;function Wit(e){e=R(e,1),D.typeOf.number.greaterThan("radius",e,0),this._radius=R(e,1)}Object.defineProperties(Wit.prototype,{radius:{get:function(){return this._radius},set:function(e){D.typeOf.number.greaterThan("value",e,0),this._radius=e}}}),Wit.prototype.emit=function(e){const t=z.randomBetween(0,z.TWO_PI),n=z.randomBetween(0,z.PI),i=z.randomBetween(0,this._radius),o=i*Math.cos(t)*Math.sin(n),r=i*Math.sin(t)*Math.sin(n),s=i*Math.cos(n);e.position=K.fromElements(o,r,s,e.position),e.velocity=K.normalize(e.position,e.velocity)};function qit(){}qit.prototype.evaluate=function(e,t){x.throwInstantiationError()},qit.prototype.evaluateColor=function(e,t){x.throwInstantiationError()},qit.prototype.getShaderFunction=function(e,t,n,i){x.throwInstantiationError()},qit.prototype.getVariables=function(){x.throwInstantiationError()};var jit="uniform sampler2D u_texture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    vec4 color = texture2D(u_texture, v_textureCoordinates);\n    gl_FragColor = czm_gammaCorrect(color);\n}\n",Yit="uniform float u_radiusTS;\n\nvarying vec2 v_textureCoordinates;\n\nvec2 rotate(vec2 p, vec2 direction)\n{\n    return vec2(p.x * direction.x - p.y * direction.y, p.x * direction.y + p.y * direction.x);\n}\n\nvec4 addBurst(vec2 position, vec2 direction, float lengthScalar)\n{\n    vec2 rotatedPosition = rotate(position, direction) * vec2(25.0, 0.75);\n    float radius = length(rotatedPosition) * lengthScalar;\n    float burst = 1.0 - smoothstep(0.0, 0.55, radius);\n    return vec4(burst);\n}\n\nvoid main()\n{\n    float lengthScalar = 2.0 / sqrt(2.0);\n    vec2 position = v_textureCoordinates - vec2(0.5);\n    float radius = length(position) * lengthScalar;\n    float surface = step(radius, u_radiusTS);\n    vec4 color = vec4(vec2(1.0), surface + 0.2, surface);\n\n    float glow = 1.0 - smoothstep(0.0, 0.55, radius);\n    color.ba += mix(vec2(0.0), vec2(1.0), glow) * 0.75;\n\n    vec4 burst = vec4(0.0);\n\n    // The following loop has been manually unrolled for speed, to\n    // avoid sin() and cos().\n    //\n    //for (float i = 0.4; i < 3.2; i += 1.047) {\n    //    vec2 direction = vec2(sin(i), cos(i));\n    //    burst += 0.4 * addBurst(position, direction, lengthScalar);\n    //\n    //    direction = vec2(sin(i - 0.08), cos(i - 0.08));\n    //    burst += 0.3 * addBurst(position, direction, lengthScalar);\n    //}\n\n    burst += 0.4 * addBurst(position, vec2(0.38942,  0.92106), lengthScalar);  // angle == 0.4\n    burst += 0.4 * addBurst(position, vec2(0.99235,  0.12348), lengthScalar);  // angle == 0.4 + 1.047\n    burst += 0.4 * addBurst(position, vec2(0.60327, -0.79754), lengthScalar);  // angle == 0.4 + 1.047 * 2.0\n\n    burst += 0.3 * addBurst(position, vec2(0.31457,  0.94924), lengthScalar);  // angle == 0.4 - 0.08\n    burst += 0.3 * addBurst(position, vec2(0.97931,  0.20239), lengthScalar);  // angle == 0.4 + 1.047 - 0.08\n    burst += 0.3 * addBurst(position, vec2(0.66507, -0.74678), lengthScalar);  // angle == 0.4 + 1.047 * 2.0 - 0.08\n\n    // End of manual loop unrolling.\n\n    color += clamp(burst, vec4(0.0), vec4(1.0)) * 0.15;\n\n    gl_FragColor = clamp(color, vec4(0.0), vec4(1.0));\n}\n",Kit="attribute vec2 direction;\n\nuniform float u_size;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main() \n{\n    vec4 position;\n    if (czm_morphTime == 1.0)\n    {\n        position = vec4(czm_sunPositionWC, 1.0);\n    }\n    else\n    {\n        position = vec4(czm_sunPositionColumbusView.zxy, 1.0);\n    }\n    \n    vec4 positionEC = czm_view * position;\n    vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\n    \n    vec2 halfSize = vec2(u_size * 0.5);\n    halfSize *= ((direction * 2.0) - 1.0);\n    \n    gl_Position = czm_viewportOrthographic * vec4(positionWC.xy + halfSize, -positionWC.z, 1.0);\n    \n    v_textureCoordinates = direction;\n}\n";function Xit(){this.show=!0,this._drawCommand=new UU({primitiveType:xf.TRIANGLES,boundingVolume:new nn,owner:this}),this._commands={drawCommand:this._drawCommand,computeCommand:void 0},this._boundingVolume=new nn,this._boundingVolume2D=new nn,this._texture=void 0,this._drawingBufferWidth=void 0,this._drawingBufferHeight=void 0,this._radiusTS=void 0,this._size=void 0,this.glowFactor=1,this._glowFactorDirty=!1,this._useHdr=void 0;const e=this;this._uniformMap={u_texture:function(){return e._texture},u_size:function(){return e._size}}}Object.defineProperties(Xit.prototype,{glowFactor:{get:function(){return this._glowFactor},set:function(e){e=Math.max(e,0),this._glowFactor=e,this._glowFactorDirty=!0}}});const Qit=new ro,Jit=new ro,Zit=new Xe,$it=new Xe;Xit.prototype.update=function(e,t,n){if(!this.show)return;const i=e.mode;if(i===ij.SCENE2D||i===ij.MORPHING)return;if(!e.passes.render)return;const o=e.context,r=t.viewport.width,s=t.viewport.height;if(!C(this._texture)||r!==this._drawingBufferWidth||s!==this._drawingBufferHeight||this._glowFactorDirty||n!==this._useHdr){this._texture=this._texture&&this._texture.destroy(),this._drawingBufferWidth=r,this._drawingBufferHeight=s,this._glowFactorDirty=!1,this._useHdr=n;let e=Math.max(r,s);e=Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))-2),e=Math.max(1,e);const t=n?o.halfFloatingPointTexture?hD.HALF_FLOAT:hD.FLOAT:hD.UNSIGNED_BYTE;this._texture=new Uk({context:o,width:e,height:e,pixelFormat:fD.RGBA,pixelDatatype:t}),this._glowLengthTS=5*this._glowFactor,this._radiusTS=1/(1+2*this._glowLengthTS)*.5;const i=this,a={u_radiusTS:function(){return i._radiusTS}};this._commands.computeCommand=new PQ({fragmentShaderSource:Yit,outputTexture:this._texture,uniformMap:a,persists:!1,owner:this,postExecute:function(){i._commands.computeCommand=void 0}})}const a=this._drawCommand;if(!C(a.vertexArray)){const e={direction:0},t=new Uint8Array(8);t[0]=0,t[1]=0,t[2]=255,t[3]=0,t[4]=255,t[5]=255,t[6]=0,t[7]=255;const n=hq.createVertexBuffer({context:o,typedArray:t,usage:lq.STATIC_DRAW}),i=[{index:e.direction,vertexBuffer:n,componentsPerAttribute:2,normalize:!0,componentDatatype:ih.UNSIGNED_BYTE}],r=hq.createIndexBuffer({context:o,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:lq.STATIC_DRAW,indexDatatype:fd.UNSIGNED_SHORT});a.vertexArray=new bq({context:o,attributes:i,indexBuffer:r}),a.shaderProgram=fH.fromCache({context:o,vertexShaderSource:Kit,fragmentShaderSource:jit,attributeLocations:e}),a.renderState=yV.fromCache({blending:_k.ALPHA_BLEND}),a.uniformMap=this._uniformMap}const c=o.uniformState.sunPositionWC,l=o.uniformState.sunPositionColumbusView,u=this._boundingVolume,h=this._boundingVolume2D;K.clone(c,u.center),h.center.x=l.z,h.center.y=l.x,h.center.z=l.y,u.radius=z.SOLAR_RADIUS+z.SOLAR_RADIUS*this._glowLengthTS,h.radius=u.radius,i===ij.SCENE3D?nn.clone(u,a.boundingVolume):i===ij.COLUMBUS_VIEW&&nn.clone(h,a.boundingVolume);const d=Aoe.computeActualWgs84Position(e,c,$it),f=K.magnitude(K.subtract(d,e.camera.position,$it)),p=o.uniformState.projection,m=Zit;m.x=0,m.y=0,m.z=-f,m.w=1;const _=ft.multiplyByVector(p,m,$it),g=Aoe.clipToGLWindowCoordinates(t.viewport,_,Qit);m.x=z.SOLAR_RADIUS;const y=ft.multiplyByVector(p,m,$it),v=Aoe.clipToGLWindowCoordinates(t.viewport,y,Jit);return this._size=ro.magnitude(ro.subtract(v,g,$it)),this._size=2*this._size*(1+2*this._glowLengthTS),this._size=Math.ceil(this._size),this._commands},Xit.prototype.isDestroyed=function(){return!1},Xit.prototype.destroy=function(){const e=this._drawCommand;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._texture=this._texture&&this._texture.destroy(),Qh(this)};var eot=Xit;function tot(){}tot.prototype.boundingVolume=void 0,tot.prototype.boundingSphere=void 0,tot.prototype.distanceToCamera=function(e){x.throwInstantiationError()},tot.prototype.intersectPlane=function(e){x.throwInstantiationError()},tot.prototype.createDebugVolume=function(e){x.throwInstantiationError()};function not(e){e=R(e,R.EMPTY_OBJECT),this._tilingScheme=C(e.tilingScheme)?e.tilingScheme:new ao({ellipsoid:e.ellipsoid}),this._color=R(e.color,xy.YELLOW),this._errorEvent=new $n,this._tileWidth=R(e.tileWidth,256),this._tileHeight=R(e.tileHeight,256),this._readyPromise=Promise.resolve(!0),this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0}Object.defineProperties(not.prototype,{proxy:{get:function(){}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){}},minimumLevel:{get:function(){}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){}},hasAlphaChannel:{get:function(){return!0}}}),not.prototype.getTileCredits=function(e,t,n){},not.prototype.requestImage=function(e,t,n,i){const o=document.createElement("canvas");o.width=256,o.height=256;const r=o.getContext("2d"),s=this._color.toCssColorString();return r.strokeStyle=s,r.lineWidth=2,r.strokeRect(1,1,255,255),r.font="bold 25px Arial",r.textAlign="center",r.fillStyle=s,r.fillText(`L: ${n}`,124,86),r.fillText(`X: ${e}`,124,136),r.fillText(`Y: ${t}`,124,186),o},not.prototype.pickFeatures=function(e,t,n,i,o){};var iot=not;function oot(e){x.throwInstantiationError()}oot.prototype.isReady=x.throwInstantiationError,oot.prototype.shouldDiscardImage=x.throwInstantiationError;const rot={START:0,LOADING:1,READY:2,UPSAMPLED_ONLY:3};Object.freeze(rot);function sot(e){e=R(e,R.EMPTY_OBJECT),D.typeOf.object("options.clock",e.clock),D.typeOf.object("options.intervals",e.intervals),this.show=R(e.show,!0),this.modelMatrix=ft.clone(R(e.modelMatrix,ft.IDENTITY)),this.shadows=R(e.shadows,rj.ENABLED),this.maximumMemoryUsage=R(e.maximumMemoryUsage,256),this.shading=new Mie(e.shading),this.style=e.style,this.frameFailed=new $n,this.frameChanged=new $n,this._clock=e.clock,this._intervals=e.intervals,this._clippingPlanes=void 0,this.clippingPlanes=e.clippingPlanes,this._pointCloudEyeDomeLighting=new Rie,this._loadTimestamp=void 0,this._clippingPlanesState=0,this._styleDirty=!1,this._pickId=void 0,this._totalMemoryUsageInBytes=0,this._frames=[],this._previousInterval=void 0,this._nextInterval=void 0,this._lastRenderedFrame=void 0,this._clockMultiplier=0,this._readyPromise=yn(),this._runningSum=0,this._runningLength=0,this._runningIndex=0,this._runningSamples=wf(new Array(5),0),this._runningAverage=0}function aot(e){return`uniform vec4 czm_pickColor;\n${e}`}function cot(e){return function(t){return _n(t,{czm_pickColor:function(){return e._pickId.color}})}}function lot(){return"czm_pickColor"}Object.defineProperties(sot.prototype,{clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){_3.setOwner(e,this,"_clippingPlanes")}},totalMemoryUsageInBytes:{get:function(){return this._totalMemoryUsageInBytes}},boundingSphere:{get:function(){if(C(this._lastRenderedFrame))return this._lastRenderedFrame.pointCloud.boundingSphere}},readyPromise:{get:function(){return this._readyPromise.promise}}}),sot.prototype.makeStyleDirty=function(){this._styleDirty=!0},sot.prototype._getAverageLoadTime=function(){return 0===this._runningLength?.05:this._runningAverage};const uot=new Ea;function hot(e){const t=e._clock,n=t.canAnimate&&t.shouldAnimate,i=t.multiplier;return n?i:0}function dot(e,t){return e._intervals.indexOf(t.start)}function fot(e,t){const n=e._intervals,i=e._clock,o=hot(e);if(0===o)return;const r=e._getAverageLoadTime(),s=Ea.addSeconds(i.currentTime,r*o,uot);let a=n.indexOf(s);const c=dot(e,t);return a===c&&(o>=0?++a:--a),n.get(a)}function pot(e){const t=e._intervals,n=e._clock,i=n.currentTime,o=t.indexOf(i);return t.get(o)}function mot(e,t,n){const i=hot(e),o=dot(e,t),r=dot(e,n);return i>=0?o>=r:o<=r}function _ot(e,t){return function(n){const i=C(n.message)?n.message:n.toString();e.frameFailed.numberOfListeners>0?e.frameFailed.raiseEvent({uri:t,message:i}):(console.log(`A frame failed to load: ${t}`),console.log(`Error: ${i}`))}}function got(e,t,n){const i=dot(e,t),o=e._frames;let r=o[i];if(!C(r)){const s=t.data.transform,a=C(s)?ft.fromArray(s):void 0,c=t.data.uri;r={pointCloud:void 0,transform:a,timestamp:py(),sequential:!0,ready:!1,touchedFrameNumber:n.frameNumber},o[i]=r,Vi.fetchArrayBuffer({url:c}).then((function(t){return r.pointCloud=new hie({arrayBuffer:t,cull:!0,fragmentShaderLoaded:aot,uniformMapLoaded:cot(e),pickIdLoaded:lot}),r.pointCloud.readyPromise})).catch(_ot(e,c))}return r}function yot(e,t){e._runningSum+=t,e._runningSum-=e._runningSamples[e._runningIndex],e._runningSamples[e._runningIndex]=t,e._runningLength=Math.min(e._runningLength+1,e._runningSamples.length),e._runningIndex=(e._runningIndex+1)%e._runningSamples.length,e._runningAverage=e._runningSum/e._runningLength}function vot(e,t,n,i){t.touchedFrameNumber<i.frameNumber-1&&(t.sequential=!1);const o=t.pointCloud;if(C(o)&&!t.ready){const r=i.commandList,s=r.length;if(Cot(e,t,n,i),o.ready&&(t.ready=!0,e._totalMemoryUsageInBytes+=o.geometryByteLength,r.length=s,t.sequential)){const n=(py()-t.timestamp)/1e3;yot(e,n)}}t.touchedFrameNumber=i.frameNumber}const bot=new ft;function Aot(e,t){const n=e.shading;return C(n)&&C(n.baseResolution)?n.baseResolution:C(t.boundingSphere)?z.cbrt(t.boundingSphere.volume()/t.pointsLength):0}function wot(e){const t=e.shading;return C(t)&&C(t.maximumAttenuation)?t.maximumAttenuation:10}const Tot=new Mie;function Cot(e,t,n,i){const o=R(e.shading,Tot),r=t.pointCloud,s=R(t.transform,ft.IDENTITY);r.modelMatrix=ft.multiplyTransformation(e.modelMatrix,s,bot),r.style=e.style,r.time=n.timeSinceLoad,r.shadows=e.shadows,r.clippingPlanes=e._clippingPlanes,r.isClipped=n.isClipped,r.attenuation=o.attenuation,r.backFaceCulling=o.backFaceCulling,r.normalShading=o.normalShading,r.geometricError=Aot(e,r),r.geometricErrorScale=o.geometricErrorScale,r.maximumAttenuation=wot(e),r.update(i),t.touchedFrameNumber=i.frameNumber}function Eot(e,t,n,i){const o=got(e,t,i);vot(e,o,n,i)}function xot(e){return function(t){return t.touchedFrameNumber<e.frameNumber}}function Sot(e,t){const n=e._frames,i=n.length;for(let o=0;o<i;++o){const i=n[o];if(C(i)&&(!C(t)||t(i))){const t=i.pointCloud;i.ready&&(e._totalMemoryUsageInBytes-=t.geometryByteLength),C(t)&&t.destroy(),i===e._lastRenderedFrame&&(e._lastRenderedFrame=void 0),n[o]=void 0}}}function Iot(e,t){const n=dot(e,t),i=e._frames[n];if(C(i)&&i.ready)return i}function Oot(e,t,n,i,o){return!!C(n)&&(!!n.ready||(Eot(e,t,i,o),n.ready))}function Dot(e,t,n,i,o){let r,s,a;const c=e._intervals,l=e._frames,u=dot(e,n),h=dot(e,t);if(u>=h){for(r=u;r>=h;--r)if(s=c.get(r),a=l[r],Oot(e,s,a,i,o))return s}else for(r=u;r<=h;++r)if(s=c.get(r),a=l[r],Oot(e,s,a,i,o))return s;return t}function Pot(e,t,n){const i=e._frames,o=i.length;for(let r=0;r<o;++r){const e=i[r];C(e)&&C(e.pointCloud)&&(e.pointCloud.clippingPlanesDirty=t,e.pointCloud.styleDirty=n)}}const Rot={timeSinceLoad:0,isClipped:!1,clippingPlanesDirty:!1};sot.prototype.update=function(e){if(e.mode===ij.MORPHING)return;if(!this.show)return;C(this._pickId)||(this._pickId=e.context.createPickId({primitive:this})),C(this._loadTimestamp)||(this._loadTimestamp=Ea.clone(e.time));const t=Math.max(1e3*Ea.secondsDifference(e.time,this._loadTimestamp),0),n=this._clippingPlanes;let i=0,o=!1;const r=C(n)&&n.enabled;r&&(n.update(e),i=n.clippingPlanesState),this._clippingPlanesState!==i&&(this._clippingPlanesState=i,o=!0);const s=this._styleDirty;this._styleDirty=!1,(o||s)&&Pot(this,o,s),Rot.timeSinceLoad=t,Rot.isClipped=r;const a=this.shading,c=this._pointCloudEyeDomeLighting,l=e.commandList,u=l.length;let h=this._previousInterval,d=this._nextInterval;const f=pot(this);if(!C(f))return;let p=!1;const m=hot(this),_=0===m;m!==this._clockMultiplier&&(p=!0,this._clockMultiplier=m),C(h)&&!_||(h=f),(!C(d)||p||mot(this,f,d))&&(d=fot(this,f)),h=Dot(this,h,f,Rot,e);let g=Iot(this,h);C(g)||(Eot(this,h,Rot,e),g=this._lastRenderedFrame),C(g)&&Cot(this,g,Rot,e),C(d)&&Eot(this,d,Rot,e);const y=this;C(g)&&!C(this._lastRenderedFrame)&&e.afterRender.push((function(){y._readyPromise.resolve(y)})),C(g)&&g!==this._lastRenderedFrame&&y.frameChanged.numberOfListeners>0&&e.afterRender.push((function(){y.frameChanged.raiseEvent(y)})),this._previousInterval=h,this._nextInterval=d,this._lastRenderedFrame=g;const v=this._totalMemoryUsageInBytes,b=1024*this.maximumMemoryUsage*1024;v>b&&Sot(this,xot(e));const A=l.length,w=A-u;C(a)&&a.attenuation&&a.eyeDomeLighting&&w>0&&c.update(e,u,a,this.boundingSphere)},sot.prototype.isDestroyed=function(){return!1},sot.prototype.destroy=function(){return Sot(this),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),this._pickId=this._pickId&&this._pickId.destroy(),Qh(this)};var Lot=sot,Mot="\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    czm_materialInput materialInput;\n    \n    materialInput.s = v_textureCoordinates.s;\n    materialInput.st = v_textureCoordinates;\n    materialInput.str = vec3(v_textureCoordinates, 0.0);\n    materialInput.normalEC = vec3(0.0, 0.0, -1.0);\n    \n    czm_material material = czm_getMaterial(materialInput);\n\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n}\n";function Bot(e,t){this.show=!0,C(e)||(e=new bf),this.rectangle=bf.clone(e),C(t)||(t=EU.fromType(EU.ColorType,{color:new xy(1,1,1,1)})),this.material=t,this._material=void 0,this._overlayCommand=void 0,this._rs=void 0}Bot.prototype.update=function(e){if(!this.show)return;if(!C(this.material))throw new x("this.material must be defined.");if(!C(this.rectangle))throw new x("this.rectangle must be defined.");const t=this._rs;C(t)&&bf.equals(t.viewport,this.rectangle)||(this._rs=yV.fromCache({blending:_k.ALPHA_BLEND,viewport:this.rectangle}));const n=e.passes;if(n.render){const t=e.context;if(this._material!==this.material||!C(this._overlayCommand)){this._material=this.material,C(this._overlayCommand)&&this._overlayCommand.shaderProgram.destroy();const e=new tq({sources:[this._material.shaderSource,Mot]});this._overlayCommand=t.createViewportQuadCommand(e,{renderState:this._rs,uniformMap:this._material._uniforms,owner:this}),this._overlayCommand.pass=HU.OVERLAY}this._material.update(t),this._overlayCommand.renderState=this._rs,this._overlayCommand.uniformMap=this._material._uniforms,e.commandList.push(this._overlayCommand)}},Bot.prototype.isDestroyed=function(){return!1},Bot.prototype.destroy=function(){return C(this._overlayCommand)&&(this._overlayCommand.shaderProgram=this._overlayCommand.shaderProgram&&this._overlayCommand.shaderProgram.destroy()),Qh(this)};function Not(e,t){const n=t.terrainProvider,i=t.mapProjection,o=i.ellipsoid;let r;const s=t.camera.getRectangleCameraCoordinates(e);return r=t.mode===ij.SCENE3D?o.cartesianToCartographic(s):i.unproject(s),C(n)?n.readyPromise.then((function(){const i=n.availability;if(!C(i)||t.mode===ij.SCENE2D)return r;const o=[_t.center(e),_t.southeast(e),_t.southwest(e),_t.northeast(e),_t.northwest(e)];return Not._sampleTerrainMostDetailed(n,o).then((function(e){const t=e.reduce((function(e,t){return Math.max(t.height,e)}),-Number.MAX_VALUE),n=r;return n.height+=t,n}))})):Promise.resolve(r)}Not._sampleTerrainMostDetailed=fz;var Fot=Not;const zot=new xy,kot=new xy,Uot=new xy,Vot=new xy,Hot=new Xe,Got=new Uint8Array(4);function Wot(e,t,n,i){const o=t.height===n.height?0:(e-t.height)/(n.height-t.height);return xy.lerp(t.color,n.color,o,i)}function qot(e,t){return{height:e,color:xy.clone(t)}}function jot(e){return e=e.filter((function(e,t,n){const i=t>0,o=t<n.length-1,r=!i||e.height===n[t-1].height,s=!o||e.height===n[t+1].height,a=!r||!s;return a})),e=e.filter((function(e,t,n){const i=t>0,o=t<n.length-1,r=!!i&&xy.equals(e.color,n[t-1].color),s=!!o&&xy.equals(e.color,n[t+1].color),a=!r||!s;return a})),e=e.filter((function(e,t,n){const i=t>0,o=!!i&&xy.equals(e.color,n[t-1].color),r=!i||e.height===n[t-1].height,s=!o||!r;return s})),e}function Yot(e){let t,n;const i=[],o=e.length;for(t=0;t<o;t++){const o=e[t],r=o.entries,s=r.length;if(!Array.isArray(r)||0===s)throw new x("entries must be an array with size > 0.");let a=[];for(n=0;n<s;n++){const e=r[n];if(!C(e.height))throw new x("entry requires a height.");if(!C(e.color))throw new x("entry requires a color.");const t=z.clamp(e.height,Xot._minimumHeight,Xot._maximumHeight),i=xy.clone(e.color,zot);i.red*=i.alpha,i.green*=i.alpha,i.blue*=i.alpha,a.push(qot(t,i))}let c=!0,l=!0;for(n=0;n<s-1;n++){const e=a[n+0],t=a[n+1];c=c&&e.height<=t.height,l=l&&e.height>=t.height}l?a=a.reverse():c||tz(a,(function(e,t){return z.sign(e.height-t.height)}));let u=R(o.extendDownwards,!1),h=R(o.extendUpwards,!1);1!==a.length||u||h||(u=!0,h=!0),u&&a.splice(0,0,qot(Xot._minimumHeight,a[0].color)),h&&a.splice(a.length,0,qot(Xot._maximumHeight,a[a.length-1].color)),a=jot(a),i.push(a)}return i}function Kot(e){const t=Yot(e);let n,i=[],o=[];function r(e,t){i.push(qot(e,t))}function s(e,t,n){let i=xy.multiplyByScalar(n,1-t.alpha,Vot);i=xy.add(i,t,i),r(e,i)}const a=t.length;for(n=0;n<a;n++){const e=t[n];let a=0,c=0;o=i,i=[];const l=e.length,u=o.length;while(a<l||c<u){const t=a<l?e[a]:void 0,n=a>0?e[a-1]:void 0,i=a<l-1?e[a+1]:void 0,h=c<u?o[c]:void 0,d=c>0?o[c-1]:void 0,f=c<u-1?o[c+1]:void 0;if(C(t)&&C(h)&&t.height===h.height){const e=C(f)&&h.height===f.height,o=!C(d),l=!C(f),u=C(i)&&t.height===i.height,p=!C(n),m=!C(i);e?u?(s(t.height,t.color,h.color),s(t.height,i.color,f.color)):p?(r(t.height,h.color),s(t.height,t.color,f.color)):m?(s(t.height,t.color,h.color),r(t.height,f.color)):(s(t.height,t.color,h.color),s(t.height,t.color,f.color)):o?u?(r(t.height,t.color),s(t.height,i.color,h.color)):m?(r(t.height,t.color),r(t.height,h.color)):(p||r(t.height,t.color),s(t.height,t.color,h.color)):l?u?(s(t.height,t.color,h.color),r(t.height,i.color)):p?(r(t.height,h.color),r(t.height,t.color)):m?s(t.height,t.color,h.color):(s(t.height,t.color,h.color),r(t.height,t.color)):u?(s(t.height,t.color,h.color),s(t.height,i.color,h.color)):p?(r(t.height,h.color),s(t.height,t.color,h.color)):m?(s(t.height,t.color,h.color),r(t.height,h.color)):s(t.height,t.color,h.color),a+=u?2:1,c+=e?2:1}else if(C(t)&&C(h)&&C(d)&&t.height<h.height){const e=Wot(t.height,d,h,Uot);C(n)?C(i)?s(t.height,t.color,e):(s(t.height,t.color,e),r(t.height,e)):(r(t.height,e),s(t.height,t.color,e)),a++}else if(C(h)&&C(t)&&C(n)&&h.height<t.height){const e=Wot(h.height,n,t,kot);C(d)?C(f)?s(h.height,e,h.color):(s(h.height,e,h.color),r(h.height,e)):(r(h.height,e),s(h.height,e,h.color)),c++}else C(t)&&(!C(h)||t.height<h.height)?(!C(h)||C(d)||C(i)?(C(h)||!C(d)||C(n)||(r(d.height,Xot._emptyColor),r(t.height,Xot._emptyColor)),r(t.height,t.color)):(r(t.height,t.color),r(t.height,Xot._emptyColor),r(h.height,Xot._emptyColor)),a++):C(h)&&(!C(t)||h.height<t.height)&&(r(h.height,h.color),c++)}}const c=jot(i);return c}function Xot(e){e=R(e,R.EMPTY_OBJECT);const t=e.scene,n=e.layers;D.typeOf.object("options.scene",t),D.defined("options.layers",n),D.typeOf.number.greaterThan("options.layers.length",n.length,0);const i=Kot(n),o=i.length;let r,s,a,c;const l=!Xot._useFloatTexture(t.context);if(l)for(a=hD.UNSIGNED_BYTE,c=fD.RGBA,s=new Uint8Array(4*o),r=0;r<o;r++)Xe.packFloat(i[r].height,Hot),Xe.pack(Hot,s,4*r);else for(a=hD.FLOAT,c=fD.LUMINANCE,s=new Float32Array(o),r=0;r<o;r++)s[r]=i[r].height;const u=Uk.create({context:t.context,pixelFormat:c,pixelDatatype:a,source:{arrayBufferView:s,width:o,height:1},sampler:new Nk({wrapS:Mk.CLAMP_TO_EDGE,wrapT:Mk.CLAMP_TO_EDGE,minificationFilter:Rk.NEAREST,magnificationFilter:Dk.NEAREST})}),h=new Uint8Array(4*o);for(r=0;r<o;r++){const e=i[r].color;e.toBytes(Got),h[4*r+0]=Got[0],h[4*r+1]=Got[1],h[4*r+2]=Got[2],h[4*r+3]=Got[3]}const d=Uk.create({context:t.context,pixelFormat:fD.RGBA,pixelDatatype:hD.UNSIGNED_BYTE,source:{arrayBufferView:h,width:o,height:1},sampler:new Nk({wrapS:Mk.CLAMP_TO_EDGE,wrapT:Mk.CLAMP_TO_EDGE,minificationFilter:Rk.LINEAR,magnificationFilter:Dk.LINEAR})}),f=EU.fromType("ElevationBand",{heights:u,colors:d});return f}Xot._useFloatTexture=function(e){return e.floatingPointTexture},Xot._maximumHeight=5906376425472,Xot._minimumHeight=-5906376425472,Xot._emptyColor=new xy(0,0,0,0);function Qot(e){e=R(e,R.EMPTY_OBJECT);const t=R(e.style,I3e.AERIAL);return new x3e({assetId:t})}var Jot,Zot=Qot;"undefined"!==typeof ko&&(Jot=ko),function(){
/*!
   * Knockout JavaScript library v3.5.1
   * (c) The Knockout.js team - http://knockoutjs.com/
   * License: MIT (http://www.opensource.org/licenses/mit-license.php)
   */
(function(){(function(e){var t=this||(0,eval)("this"),n=t.document,i=t.navigator,o=t.jQuery,r=t.JSON;o||"undefined"===typeof jQuery||(o=jQuery),function(e){e(t.ko={})}((function(s,a){function c(e,t){return(null===e||typeof e in m)&&e===t}function l(t,n){var i;return function(){i||(i=p.a.setTimeout((function(){i=e,t()}),n))}}function u(e,t){var n;return function(){clearTimeout(n),n=p.a.setTimeout(e,t)}}function h(e,t){t&&"change"!==t?"beforeChange"===t?this.pc(e):this.gb(e,t):this.qc(e)}function d(e,t){null!==t&&t.s&&t.s()}function f(e,t){var n=this.qd,i=n[b];i.ra||(this.Qb&&this.mb[t]?(n.uc(t,e,this.mb[t]),this.mb[t]=null,--this.Qb):i.I[t]||n.uc(t,e,i.J?{da:e}:n.$c(e)),e.Ja&&e.gd())}var p="undefined"!==typeof s?s:{};p.b=function(e,t){for(var n=e.split("."),i=p,o=0;o<n.length-1;o++)i=i[n[o]];i[n[n.length-1]]=t},p.L=function(e,t,n){e[t]=n},p.version="3.5.1",p.b("version",p.version),p.options={deferUpdates:!1,useOnlyNativeEvents:!1,foreachHidesDestroyed:!1},p.a=function(){function s(e,t){for(var n in e)u.call(e,n)&&t(n,e[n])}function a(e,t){if(t)for(var n in t)u.call(t,n)&&(e[n]=t[n]);return e}function c(e,t){return e.__proto__=t,e}function l(e,t,n,i){var o=e[t].match(v)||[];p.a.D(n.match(v),(function(e){p.a.Na(o,e,i)})),e[t]=o.join(" ")}var u=Object.prototype.hasOwnProperty,h={__proto__:[]}instanceof Array,d="function"===typeof Symbol,f={},m={};f[i&&/Firefox\/2/i.test(i.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],f.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),s(f,(function(e,t){if(t.length)for(var n=0,i=t.length;n<i;n++)m[t[n]]=e}));var _,g={propertychange:!0},y=n&&function(){for(var t=3,i=n.createElement("div"),o=i.getElementsByTagName("i");i.innerHTML="\x3c!--[if gt IE "+ ++t+"]><i></i><![endif]--\x3e",o[0];);return 4<t?t:e}(),v=/\S+/g;return{Jc:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],D:function(e,t,n){for(var i=0,o=e.length;i<o;i++)t.call(n,e[i],i,e)},A:"function"==typeof Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t)}:function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},Lb:function(t,n,i){for(var o=0,r=t.length;o<r;o++)if(n.call(i,t[o],o,t))return t[o];return e},Pa:function(e,t){var n=p.a.A(e,t);0<n?e.splice(n,1):0===n&&e.shift()},wc:function(e){var t=[];return e&&p.a.D(e,(function(e){0>p.a.A(t,e)&&t.push(e)})),t},Mb:function(e,t,n){var i=[];if(e)for(var o=0,r=e.length;o<r;o++)i.push(t.call(n,e[o],o));return i},jb:function(e,t,n){var i=[];if(e)for(var o=0,r=e.length;o<r;o++)t.call(n,e[o],o)&&i.push(e[o]);return i},Nb:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var n=0,i=t.length;n<i;n++)e.push(t[n]);return e},Na:function(e,t,n){var i=p.a.A(p.a.bc(e),t);0>i?n&&e.push(t):n||e.splice(i,1)},Ba:h,extend:a,setPrototypeOf:c,Ab:h?c:a,P:s,Ga:function(e,t,n){if(!e)return e;var i,o={};for(i in e)u.call(e,i)&&(o[i]=t.call(n,e[i],i,e));return o},Tb:function(e){for(;e.firstChild;)p.removeNode(e.firstChild)},Yb:function(e){e=p.a.la(e);for(var t=(e[0]&&e[0].ownerDocument||n).createElement("div"),i=0,o=e.length;i<o;i++)t.appendChild(p.oa(e[i]));return t},Ca:function(e,t){for(var n=0,i=e.length,o=[];n<i;n++){var r=e[n].cloneNode(!0);o.push(t?p.oa(r):r)}return o},va:function(e,t){if(p.a.Tb(e),t)for(var n=0,i=t.length;n<i;n++)e.appendChild(t[n])},Xc:function(e,t){var n=e.nodeType?[e]:e;if(0<n.length){for(var i=n[0],o=i.parentNode,r=0,s=t.length;r<s;r++)o.insertBefore(t[r],i);for(r=0,s=n.length;r<s;r++)p.removeNode(n[r])}},Ua:function(e,t){if(e.length){for(t=8===t.nodeType&&t.parentNode||t;e.length&&e[0].parentNode!==t;)e.splice(0,1);for(;1<e.length&&e[e.length-1].parentNode!==t;)e.length--;if(1<e.length){var n=e[0],i=e[e.length-1];for(e.length=0;n!==i;)e.push(n),n=n.nextSibling;e.push(i)}}return e},Zc:function(e,t){7>y?e.setAttribute("selected",t):e.selected=t},Db:function(t){return null===t||t===e?"":t.trim?t.trim():t.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},Ud:function(e,t){return e=e||"",!(t.length>e.length)&&e.substring(0,t.length)===t},vd:function(e,t){if(e===t)return!0;if(11===e.nodeType)return!1;if(t.contains)return t.contains(1!==e.nodeType?e.parentNode:e);if(t.compareDocumentPosition)return 16==(16&t.compareDocumentPosition(e));for(;e&&e!=t;)e=e.parentNode;return!!e},Sb:function(e){return p.a.vd(e,e.ownerDocument.documentElement)},kd:function(e){return!!p.a.Lb(e,p.a.Sb)},R:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},Ac:function(e){return p.onError?function(){try{return e.apply(this,arguments)}catch(a){throw p.onError&&p.onError(a),a}}:e},setTimeout:function(e,t){return setTimeout(p.a.Ac(e),t)},Gc:function(e){setTimeout((function(){throw p.onError&&p.onError(e),e}),0)},B:function(e,t,n){var i=p.a.Ac(n);if(n=g[t],p.options.useOnlyNativeEvents||n||!o)if(n||"function"!=typeof e.addEventListener){if("undefined"==typeof e.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var r=function(t){i.call(e,t)},s="on"+t;e.attachEvent(s,r),p.a.K.za(e,(function(){e.detachEvent(s,r)}))}else e.addEventListener(t,i,!1);else _||(_="function"==typeof o(e).on?"on":"bind"),o(e)[_](t,i)},Fb:function(e,i){if(!e||!e.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var r;if("input"===p.a.R(e)&&e.type&&"click"==i.toLowerCase()?(r=e.type,r="checkbox"==r||"radio"==r):r=!1,p.options.useOnlyNativeEvents||!o||r)if("function"==typeof n.createEvent){if("function"!=typeof e.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");r=n.createEvent(m[i]||"HTMLEvents"),r.initEvent(i,!0,!0,t,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(r)}else if(r&&e.click)e.click();else{if("undefined"==typeof e.fireEvent)throw Error("Browser doesn't support triggering events");e.fireEvent("on"+i)}else o(e).trigger(i)},f:function(e){return p.O(e)?e():e},bc:function(e){return p.O(e)?e.v():e},Eb:function(e,t,n){var i;t&&("object"===typeof e.classList?(i=e.classList[n?"add":"remove"],p.a.D(t.match(v),(function(t){i.call(e.classList,t)}))):"string"===typeof e.className.baseVal?l(e.className,"baseVal",t,n):l(e,"className",t,n))},Bb:function(t,n){var i=p.a.f(n);null!==i&&i!==e||(i="");var o=p.h.firstChild(t);!o||3!=o.nodeType||p.h.nextSibling(o)?p.h.va(t,[t.ownerDocument.createTextNode(i)]):o.data=i,p.a.Ad(t)},Yc:function(e,t){if(e.name=t,7>=y)try{var i=e.name.replace(/[&<>'"]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}));e.mergeAttributes(n.createElement("<input name='"+i+"'/>"),!1)}catch(c){}},Ad:function(e){9<=y&&(e=1==e.nodeType?e:e.parentNode,e.style&&(e.style.zoom=e.style.zoom))},wd:function(e){if(y){var t=e.style.width;e.style.width=0,e.style.width=t}},Pd:function(e,t){e=p.a.f(e),t=p.a.f(t);for(var n=[],i=e;i<=t;i++)n.push(i);return n},la:function(e){for(var t=[],n=0,i=e.length;n<i;n++)t.push(e[n]);return t},Da:function(e){return d?Symbol(e):e},Zd:6===y,$d:7===y,W:y,Lc:function(e,t){for(var n=p.a.la(e.getElementsByTagName("input")).concat(p.a.la(e.getElementsByTagName("textarea"))),i="string"==typeof t?function(e){return e.name===t}:function(e){return t.test(e.name)},o=[],r=n.length-1;0<=r;r--)i(n[r])&&o.push(n[r]);return o},Nd:function(e){return"string"==typeof e&&(e=p.a.Db(e))?r&&r.parse?r.parse(e):new Function("return "+e)():null},hc:function(e,t,n){if(!r||!r.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return r.stringify(p.a.f(e),t,n)},Od:function(e,t,i){i=i||{};var o=i.params||{},r=i.includeFields||this.Jc,a=e;if("object"==typeof e&&"form"===p.a.R(e)){a=e.action;for(var c=r.length-1;0<=c;c--)for(var l=p.a.Lc(e,r[c]),u=l.length-1;0<=u;u--)o[l[u].name]=l[u].value}t=p.a.f(t);var h=n.createElement("form");for(var d in h.style.display="none",h.action=a,h.method="post",t)e=n.createElement("input"),e.type="hidden",e.name=d,e.value=p.a.hc(p.a.f(t[d])),h.appendChild(e);s(o,(function(e,t){var i=n.createElement("input");i.type="hidden",i.name=e,i.value=t,h.appendChild(i)})),n.body.appendChild(h),i.submitter?i.submitter(h):h.submit(),setTimeout((function(){h.parentNode.removeChild(h)}),0)}}}(),p.b("utils",p.a),p.b("utils.arrayForEach",p.a.D),p.b("utils.arrayFirst",p.a.Lb),p.b("utils.arrayFilter",p.a.jb),p.b("utils.arrayGetDistinctValues",p.a.wc),p.b("utils.arrayIndexOf",p.a.A),p.b("utils.arrayMap",p.a.Mb),p.b("utils.arrayPushAll",p.a.Nb),p.b("utils.arrayRemoveItem",p.a.Pa),p.b("utils.cloneNodes",p.a.Ca),p.b("utils.createSymbolOrString",p.a.Da),p.b("utils.extend",p.a.extend),p.b("utils.fieldsIncludedWithJsonPost",p.a.Jc),p.b("utils.getFormFields",p.a.Lc),p.b("utils.objectMap",p.a.Ga),p.b("utils.peekObservable",p.a.bc),p.b("utils.postJson",p.a.Od),p.b("utils.parseJson",p.a.Nd),p.b("utils.registerEventHandler",p.a.B),p.b("utils.stringifyJson",p.a.hc),p.b("utils.range",p.a.Pd),p.b("utils.toggleDomNodeCssClass",p.a.Eb),p.b("utils.triggerEvent",p.a.Fb),p.b("utils.unwrapObservable",p.a.f),p.b("utils.objectForEach",p.a.P),p.b("utils.addOrRemoveItem",p.a.Na),p.b("utils.setTextContent",p.a.Bb),p.b("unwrap",p.a.f),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if(1===arguments.length)return function(){return t.apply(e,arguments)};var n=Array.prototype.slice.call(arguments,1);return function(){var i=n.slice(0);return i.push.apply(i,arguments),t.apply(e,i)}}),p.a.g=new function(){var t,n,i=0,o="__ko__"+(new Date).getTime(),r={};return p.a.W?(t=function(t,n){var s=t[o];if(!s||"null"===s||!r[s]){if(!n)return e;s=t[o]="ko"+i++,r[s]={}}return r[s]},n=function(e){var t=e[o];return!!t&&(delete r[t],e[o]=null,!0)}):(t=function(e,t){var n=e[o];return!n&&t&&(n=e[o]={}),n},n=function(e){return!!e[o]&&(delete e[o],!0)}),{get:function(e,n){var i=t(e,!1);return i&&i[n]},set:function(n,i,o){(n=t(n,o!==e))&&(n[i]=o)},Ub:function(e,n,i){return e=t(e,!0),e[n]||(e[n]=i)},clear:n,Z:function(){return i+++o}}},p.b("utils.domData",p.a.g),p.b("utils.domData.clear",p.a.g.clear),p.a.K=new function(){function t(t,n){var i=p.a.g.get(t,r);return i===e&&n&&(i=[],p.a.g.set(t,r,i)),i}function n(e){var n=t(e,!1);if(n){n=n.slice(0);for(var o=0;o<n.length;o++)n[o](e)}p.a.g.clear(e),p.a.K.cleanExternalData(e),a[e.nodeType]&&i(e.childNodes,!0)}function i(e,t){for(var i,o=[],r=0;r<e.length;r++)if((!t||8===e[r].nodeType)&&(n(o[o.length]=i=e[r]),e[r]!==i))for(;r--&&-1==p.a.A(o,e[r]););}var r=p.a.g.Z(),s={1:!0,8:!0,9:!0},a={1:!0,9:!0};return{za:function(e,n){if("function"!=typeof n)throw Error("Callback must be a function");t(e,!0).push(n)},yb:function(n,i){var o=t(n,!1);o&&(p.a.Pa(o,i),0==o.length&&p.a.g.set(n,r,e))},oa:function(e){return p.u.G((function(){s[e.nodeType]&&(n(e),a[e.nodeType]&&i(e.getElementsByTagName("*")))})),e},removeNode:function(e){p.oa(e),e.parentNode&&e.parentNode.removeChild(e)},cleanExternalData:function(e){o&&"function"==typeof o.cleanData&&o.cleanData([e])}}},p.oa=p.a.K.oa,p.removeNode=p.a.K.removeNode,p.b("cleanNode",p.oa),p.b("removeNode",p.removeNode),p.b("utils.domNodeDisposal",p.a.K),p.b("utils.domNodeDisposal.addDisposeCallback",p.a.K.za),p.b("utils.domNodeDisposal.removeDisposeCallback",p.a.K.yb),function(){var i=[0,"",""],r=[1,"<table>","</table>"],s=[3,"<table><tbody><tr>","</tr></tbody></table>"],a=[1,"<select multiple='multiple'>","</select>"],c={thead:r,tbody:r,tfoot:r,tr:[2,"<table><tbody>","</tbody></table>"],td:s,th:s,option:a,optgroup:a},l=8>=p.a.W;p.a.ua=function(e,r){var s;if(o){if(o.parseHTML)s=o.parseHTML(e,r)||[];else if((s=o.clean([e],r))&&s[0]){for(var a=s[0];a.parentNode&&11!==a.parentNode.nodeType;)a=a.parentNode;a.parentNode&&a.parentNode.removeChild(a)}}else{(s=r)||(s=n);a=s.parentWindow||s.defaultView||t;var u,h=p.a.Db(e).toLowerCase(),d=s.createElement("div");for(u=(h=h.match(/^(?:\x3c!--.*?--\x3e\s*?)*?<([a-z]+)[\s>]/))&&c[h[1]]||i,h=u[0],u="ignored<div>"+u[1]+e+u[2]+"</div>","function"==typeof a.innerShiv?d.appendChild(a.innerShiv(u)):(l&&s.body.appendChild(d),d.innerHTML=u,l&&d.parentNode.removeChild(d));h--;)d=d.lastChild;s=p.a.la(d.lastChild.childNodes)}return s},p.a.Md=function(e,t){var n=p.a.ua(e,t);return n.length&&n[0].parentElement||p.a.Yb(n)},p.a.fc=function(t,n){if(p.a.Tb(t),n=p.a.f(n),null!==n&&n!==e)if("string"!=typeof n&&(n=n.toString()),o)o(t).html(n);else for(var i=p.a.ua(n,t.ownerDocument),r=0;r<i.length;r++)t.appendChild(i[r])}}(),p.b("utils.parseHtmlFragment",p.a.ua),p.b("utils.setHtml",p.a.fc),p.aa=function(){function t(e,n){if(e)if(8==e.nodeType){var i=p.aa.Uc(e.nodeValue);null!=i&&n.push({ud:e,Kd:i})}else if(1==e.nodeType){i=0;for(var o=e.childNodes,r=o.length;i<r;i++)t(o[i],n)}}var n={};return{Xb:function(e){if("function"!=typeof e)throw Error("You can only pass a function to ko.memoization.memoize()");var t=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return n[t]=e,"\x3c!--[ko_memo:"+t+"]--\x3e"},bd:function(t,i){var o=n[t];if(o===e)throw Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized.");try{return o.apply(null,i||[]),!0}finally{delete n[t]}},cd:function(e,n){var i=[];t(e,i);for(var o=0,r=i.length;o<r;o++){var s=i[o].ud,a=[s];n&&p.a.Nb(a,n),p.aa.bd(i[o].Kd,a),s.nodeValue="",s.parentNode&&s.parentNode.removeChild(s)}},Uc:function(e){return(e=e.match(/^\[ko_memo\:(.*?)\]$/))?e[1]:null}}}(),p.b("memoization",p.aa),p.b("memoization.memoize",p.aa.Xb),p.b("memoization.unmemoize",p.aa.bd),p.b("memoization.parseMemoText",p.aa.Uc),p.b("memoization.unmemoizeDomNodeAndDescendants",p.aa.cd),p.na=function(){function e(){if(s)for(var e,t=s,n=0;c<s;)if(e=r[c++]){if(c>t){if(5e3<=++n){c=s,p.a.Gc(Error("'Too much recursion' after processing "+n+" task groups."));break}t=s}try{e()}catch(i){p.a.Gc(i)}}}function i(){e(),c=s=r.length=0}var o,r=[],s=0,a=1,c=0;return o=t.MutationObserver?function(e){var t=n.createElement("div");return new MutationObserver(e).observe(t,{attributes:!0}),function(){t.classList.toggle("foo")}}(i):n&&"onreadystatechange"in n.createElement("script")?function(e){var t=n.createElement("script");t.onreadystatechange=function(){t.onreadystatechange=null,n.documentElement.removeChild(t),t=null,e()},n.documentElement.appendChild(t)}:function(e){setTimeout(e,0)},{scheduler:o,zb:function(e){return s||p.na.scheduler(i),r[s++]=e,a++},cancel:function(e){e-=a-s,e>=c&&e<s&&(r[e]=null)},resetForTesting:function(){var e=s-c;return c=s=r.length=0,e},Sd:e}}(),p.b("tasks",p.na),p.b("tasks.schedule",p.na.zb),p.b("tasks.runEarly",p.na.Sd),p.Ta={throttle:function(e,t){e.throttleEvaluation=t;var n=null;return p.$({read:e,write:function(i){clearTimeout(n),n=p.a.setTimeout((function(){e(i)}),t)}})},rateLimit:function(e,t){var n,i,o;"number"==typeof t?n=t:(n=t.timeout,i=t.method),e.Hb=!1,o="function"==typeof i?i:"notifyWhenChangesStop"==i?u:l,e.ub((function(e){return o(e,n,t)}))},deferred:function(t,n){if(!0!==n)throw Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");t.Hb||(t.Hb=!0,t.ub((function(n){var i,o=!1;return function(){if(!o){p.na.cancel(i),i=p.na.zb(n);try{o=!0,t.notifySubscribers(e,"dirty")}finally{o=!1}}}})))},notify:function(e,t){e.equalityComparer="always"==t?null:c}};var m={undefined:1,boolean:1,number:1,string:1};p.b("extenders",p.Ta),p.ic=function(e,t,n){this.da=e,this.lc=t,this.mc=n,this.Ib=!1,this.fb=this.Jb=null,p.L(this,"dispose",this.s),p.L(this,"disposeWhenNodeIsRemoved",this.l)},p.ic.prototype.s=function(){this.Ib||(this.fb&&p.a.K.yb(this.Jb,this.fb),this.Ib=!0,this.mc(),this.da=this.lc=this.mc=this.Jb=this.fb=null)},p.ic.prototype.l=function(e){this.Jb=e,p.a.K.za(e,this.fb=this.s.bind(this))},p.T=function(){p.a.Ab(this,_),_.qb(this)};var _={qb:function(e){e.U={change:[]},e.sc=1},subscribe:function(e,t,n){var i=this;n=n||"change";var o=new p.ic(i,t?e.bind(t):e,(function(){p.a.Pa(i.U[n],o),i.hb&&i.hb(n)}));return i.Qa&&i.Qa(n),i.U[n]||(i.U[n]=[]),i.U[n].push(o),o},notifySubscribers:function(e,t){if(t=t||"change","change"===t&&this.Gb(),this.Wa(t)){var n="change"===t&&this.ed||this.U[t].slice(0);try{p.u.xc();for(var i,o=0;i=n[o];++o)i.Ib||i.lc(e)}finally{p.u.end()}}},ob:function(){return this.sc},Dd:function(e){return this.ob()!==e},Gb:function(){++this.sc},ub:function(e){var t,n,i,o,r,s=this,a=p.O(s);s.gb||(s.gb=s.notifySubscribers,s.notifySubscribers=h);var c=e((function(){s.Ja=!1,a&&o===s&&(o=s.nc?s.nc():s());var e=n||r&&s.sb(i,o);r=n=t=!1,e&&s.gb(i=o)}));s.qc=function(e,n){n&&s.Ja||(r=!n),s.ed=s.U.change.slice(0),s.Ja=t=!0,o=e,c()},s.pc=function(e){t||(i=e,s.gb(e,"beforeChange"))},s.rc=function(){r=!0},s.gd=function(){s.sb(i,s.v(!0))&&(n=!0)}},Wa:function(e){return this.U[e]&&this.U[e].length},Bd:function(e){if(e)return this.U[e]&&this.U[e].length||0;var t=0;return p.a.P(this.U,(function(e,n){"dirty"!==e&&(t+=n.length)})),t},sb:function(e,t){return!this.equalityComparer||!this.equalityComparer(e,t)},toString:function(){return"[object Object]"},extend:function(e){var t=this;return e&&p.a.P(e,(function(e,n){var i=p.Ta[e];"function"==typeof i&&(t=i(t,n)||t)})),t}};p.L(_,"init",_.qb),p.L(_,"subscribe",_.subscribe),p.L(_,"extend",_.extend),p.L(_,"getSubscriptionsCount",_.Bd),p.a.Ba&&p.a.setPrototypeOf(_,Function.prototype),p.T.fn=_,p.Qc=function(e){return null!=e&&"function"==typeof e.subscribe&&"function"==typeof e.notifySubscribers},p.b("subscribable",p.T),p.b("isSubscribable",p.Qc),p.S=p.u=function(){function e(e){i.push(n),n=e}function t(){n=i.pop()}var n,i=[],o=0;return{xc:e,end:t,cc:function(e){if(n){if(!p.Qc(e))throw Error("Only subscribable things can act as dependencies");n.od.call(n.pd,e,e.fd||(e.fd=++o))}},G:function(n,i,o){try{return e(),n.apply(i,o||[])}finally{t()}},qa:function(){if(n)return n.o.qa()},Va:function(){if(n)return n.o.Va()},Ya:function(){if(n)return n.Ya},o:function(){if(n)return n.o}}}(),p.b("computedContext",p.S),p.b("computedContext.getDependenciesCount",p.S.qa),p.b("computedContext.getDependencies",p.S.Va),p.b("computedContext.isInitial",p.S.Ya),p.b("computedContext.registerDependency",p.S.cc),p.b("ignoreDependencies",p.Yd=p.u.G);var g=p.a.Da("_latestValue");p.ta=function(e){function t(){return 0<arguments.length?(t.sb(t[g],arguments[0])&&(t.ya(),t[g]=arguments[0],t.xa()),this):(p.u.cc(t),t[g])}return t[g]=e,p.a.Ba||p.a.extend(t,p.T.fn),p.T.fn.qb(t),p.a.Ab(t,y),p.options.deferUpdates&&p.Ta.deferred(t,!0),t};var y={equalityComparer:c,v:function(){return this[g]},xa:function(){this.notifySubscribers(this[g],"spectate"),this.notifySubscribers(this[g])},ya:function(){this.notifySubscribers(this[g],"beforeChange")}};p.a.Ba&&p.a.setPrototypeOf(y,p.T.fn);var v=p.ta.Ma="__ko_proto__";y[v]=p.ta,p.O=function(e){if((e="function"==typeof e&&e[v])&&e!==y[v]&&e!==p.o.fn[v])throw Error("Invalid object that looks like an observable; possibly from another Knockout instance");return!!e},p.Za=function(e){return"function"==typeof e&&(e[v]===y[v]||e[v]===p.o.fn[v]&&e.Nc)},p.b("observable",p.ta),p.b("isObservable",p.O),p.b("isWriteableObservable",p.Za),p.b("isWritableObservable",p.Za),p.b("observable.fn",y),p.L(y,"peek",y.v),p.L(y,"valueHasMutated",y.xa),p.L(y,"valueWillMutate",y.ya),p.Ha=function(e){if(e=e||[],"object"!=typeof e||!("length"in e))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return e=p.ta(e),p.a.Ab(e,p.Ha.fn),e.extend({trackArrayChanges:!0})},p.Ha.fn={remove:function(e){for(var t=this.v(),n=[],i="function"!=typeof e||p.O(e)?function(t){return t===e}:e,o=0;o<t.length;o++){var r=t[o];if(i(r)){if(0===n.length&&this.ya(),t[o]!==r)throw Error("Array modified during remove; cannot remove item");n.push(r),t.splice(o,1),o--}}return n.length&&this.xa(),n},removeAll:function(t){if(t===e){var n=this.v(),i=n.slice(0);return this.ya(),n.splice(0,n.length),this.xa(),i}return t?this.remove((function(e){return 0<=p.a.A(t,e)})):[]},destroy:function(e){var t=this.v(),n="function"!=typeof e||p.O(e)?function(t){return t===e}:e;this.ya();for(var i=t.length-1;0<=i;i--){var o=t[i];n(o)&&(o._destroy=!0)}this.xa()},destroyAll:function(t){return t===e?this.destroy((function(){return!0})):t?this.destroy((function(e){return 0<=p.a.A(t,e)})):[]},indexOf:function(e){var t=this();return p.a.A(t,e)},replace:function(e,t){var n=this.indexOf(e);0<=n&&(this.ya(),this.v()[n]=t,this.xa())},sorted:function(e){var t=this().slice(0);return e?t.sort(e):t.sort()},reversed:function(){return this().slice(0).reverse()}},p.a.Ba&&p.a.setPrototypeOf(p.Ha.fn,p.ta.fn),p.a.D("pop push reverse shift sort splice unshift".split(" "),(function(e){p.Ha.fn[e]=function(){var t=this.v();this.ya(),this.zc(t,e,arguments);var n=t[e].apply(t,arguments);return this.xa(),n===t?this:n}})),p.a.D(["slice"],(function(e){p.Ha.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}})),p.Pc=function(e){return p.O(e)&&"function"==typeof e.remove&&"function"==typeof e.push},p.b("observableArray",p.Ha),p.b("isObservableArray",p.Pc),p.Ta.trackArrayChanges=function(t,n){function i(){function e(){if(l){var e,n=[].concat(t.v()||[]);t.Wa("arrayChange")&&((!c||1<l)&&(c=p.a.Pb(s,n,t.Ob)),e=c),s=n,c=null,l=0,e&&e.length&&t.notifySubscribers(e,"arrayChange")}}a?e():(a=!0,r=t.subscribe((function(){++l}),null,"spectate"),s=[].concat(t.v()||[]),c=null,o=t.subscribe(e))}if(t.Ob={},n&&"object"==typeof n&&p.a.extend(t.Ob,n),t.Ob.sparse=!0,!t.zc){var o,r,s,a=!1,c=null,l=0,u=t.Qa,h=t.hb;t.Qa=function(e){u&&u.call(t,e),"arrayChange"===e&&i()},t.hb=function(n){h&&h.call(t,n),"arrayChange"!==n||t.Wa("arrayChange")||(o&&o.s(),r&&r.s(),r=o=null,a=!1,s=e)},t.zc=function(e,t,n){function i(e,t,n){return o[o.length]={status:e,value:t,index:n}}if(a&&!l){var o=[],r=e.length,s=n.length,u=0;switch(t){case"push":u=r;case"unshift":for(t=0;t<s;t++)i("added",n[t],u+t);break;case"pop":u=r-1;case"shift":r&&i("deleted",e[u],u);break;case"splice":t=Math.min(Math.max(0,0>n[0]?r+n[0]:n[0]),r);r=1===s?r:Math.min(t+(n[1]||0),r),s=t+s-2,u=Math.max(r,s);for(var h=[],d=[],f=2;t<u;++t,++f)t<r&&d.push(i("deleted",e[t],t)),t<s&&h.push(i("added",n[f],t));p.a.Kc(d,h);break;default:return}c=o}}}};var b=p.a.Da("_state");p.o=p.$=function(t,n,i){function o(){if(0<arguments.length){if("function"!==typeof r)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return r.apply(s.nb,arguments),this}return s.ra||p.u.cc(o),(s.ka||s.J&&o.Xa())&&o.ha(),s.X}if("object"===typeof t?i=t:(i=i||{},t&&(i.read=t)),"function"!=typeof i.read)throw Error("Pass a function that returns the value of the ko.computed");var r=i.write,s={X:e,sa:!0,ka:!0,rb:!1,jc:!1,ra:!1,wb:!1,J:!1,Wc:i.read,nb:n||i.owner,l:i.disposeWhenNodeIsRemoved||i.l||null,Sa:i.disposeWhen||i.Sa,Rb:null,I:{},V:0,Ic:null};return o[b]=s,o.Nc="function"===typeof r,p.a.Ba||p.a.extend(o,p.T.fn),p.T.fn.qb(o),p.a.Ab(o,A),i.pure?(s.wb=!0,s.J=!0,p.a.extend(o,w)):i.deferEvaluation&&p.a.extend(o,T),p.options.deferUpdates&&p.Ta.deferred(o,!0),s.l&&(s.jc=!0,s.l.nodeType||(s.l=null)),s.J||i.deferEvaluation||o.ha(),s.l&&o.ja()&&p.a.K.za(s.l,s.Rb=function(){o.s()}),o};var A={equalityComparer:c,qa:function(){return this[b].V},Va:function(){var e=[];return p.a.P(this[b].I,(function(t,n){e[n.Ka]=n.da})),e},Vb:function(e){if(!this[b].V)return!1;var t=this.Va();return-1!==p.a.A(t,e)||!!p.a.Lb(t,(function(t){return t.Vb&&t.Vb(e)}))},uc:function(e,t,n){if(this[b].wb&&t===this)throw Error("A 'pure' computed must not be called recursively");this[b].I[e]=n,n.Ka=this[b].V++,n.La=t.ob()},Xa:function(){var e,t,n=this[b].I;for(e in n)if(Object.prototype.hasOwnProperty.call(n,e)&&(t=n[e],this.Ia&&t.da.Ja||t.da.Dd(t.La)))return!0},Jd:function(){this.Ia&&!this[b].rb&&this.Ia(!1)},ja:function(){var e=this[b];return e.ka||0<e.V},Rd:function(){this.Ja?this[b].ka&&(this[b].sa=!0):this.Hc()},$c:function(e){if(e.Hb){var t=e.subscribe(this.Jd,this,"dirty"),n=e.subscribe(this.Rd,this);return{da:e,s:function(){t.s(),n.s()}}}return e.subscribe(this.Hc,this)},Hc:function(){var e=this,t=e.throttleEvaluation;t&&0<=t?(clearTimeout(this[b].Ic),this[b].Ic=p.a.setTimeout((function(){e.ha(!0)}),t)):e.Ia?e.Ia(!0):e.ha(!0)},ha:function(e){var t=this[b],n=t.Sa,i=!1;if(!t.rb&&!t.ra){if(t.l&&!p.a.Sb(t.l)||n&&n()){if(!t.jc)return void this.s()}else t.jc=!1;t.rb=!0;try{i=this.zd(e)}finally{t.rb=!1}return i}},zd:function(t){var n=this[b],i=!1,o=n.wb?e:!n.V;i={qd:this,mb:n.I,Qb:n.V};p.u.xc({pd:i,od:f,o:this,Ya:o}),n.I={},n.V=0;var r=this.yd(n,i);return n.V?i=this.sb(n.X,r):(this.s(),i=!0),i&&(n.J?this.Gb():this.notifySubscribers(n.X,"beforeChange"),n.X=r,this.notifySubscribers(n.X,"spectate"),!n.J&&t&&this.notifySubscribers(n.X),this.rc&&this.rc()),o&&this.notifySubscribers(n.X,"awake"),i},yd:function(e,t){try{var n=e.Wc;return e.nb?n.call(e.nb):n()}finally{p.u.end(),t.Qb&&!e.J&&p.a.P(t.mb,d),e.sa=e.ka=!1}},v:function(e){var t=this[b];return(t.ka&&(e||!t.V)||t.J&&this.Xa())&&this.ha(),t.X},ub:function(e){p.T.fn.ub.call(this,e),this.nc=function(){return this[b].J||(this[b].sa?this.ha():this[b].ka=!1),this[b].X},this.Ia=function(e){this.pc(this[b].X),this[b].ka=!0,e&&(this[b].sa=!0),this.qc(this,!e)}},s:function(){var t=this[b];!t.J&&t.I&&p.a.P(t.I,(function(e,t){t.s&&t.s()})),t.l&&t.Rb&&p.a.K.yb(t.l,t.Rb),t.I=e,t.V=0,t.ra=!0,t.sa=!1,t.ka=!1,t.J=!1,t.l=e,t.Sa=e,t.Wc=e,this.Nc||(t.nb=e)}},w={Qa:function(e){var t=this,n=t[b];if(!n.ra&&n.J&&"change"==e){if(n.J=!1,n.sa||t.Xa())n.I=null,n.V=0,t.ha()&&t.Gb();else{var i=[];p.a.P(n.I,(function(e,t){i[t.Ka]=e})),p.a.D(i,(function(e,i){var o=n.I[e],r=t.$c(o.da);r.Ka=i,r.La=o.La,n.I[e]=r})),t.Xa()&&t.ha()&&t.Gb()}n.ra||t.notifySubscribers(n.X,"awake")}},hb:function(t){var n=this[b];n.ra||"change"!=t||this.Wa("change")||(p.a.P(n.I,(function(e,t){t.s&&(n.I[e]={da:t.da,Ka:t.Ka,La:t.La},t.s())})),n.J=!0,this.notifySubscribers(e,"asleep"))},ob:function(){var e=this[b];return e.J&&(e.sa||this.Xa())&&this.ha(),p.T.fn.ob.call(this)}},T={Qa:function(e){"change"!=e&&"beforeChange"!=e||this.v()}};p.a.Ba&&p.a.setPrototypeOf(A,p.T.fn);var C=p.ta.Ma;A[C]=p.o,p.Oc=function(e){return"function"==typeof e&&e[C]===A[C]},p.Fd=function(e){return p.Oc(e)&&e[b]&&e[b].wb},p.b("computed",p.o),p.b("dependentObservable",p.o),p.b("isComputed",p.Oc),p.b("isPureComputed",p.Fd),p.b("computed.fn",A),p.L(A,"peek",A.v),p.L(A,"dispose",A.s),p.L(A,"isActive",A.ja),p.L(A,"getDependenciesCount",A.qa),p.L(A,"getDependencies",A.Va),p.xb=function(e,t){return"function"===typeof e?p.o(e,t,{pure:!0}):(e=p.a.extend({},e),e.pure=!0,p.o(e,t))},p.b("pureComputed",p.xb),function(){function t(o,r,s){if(s=s||new i,o=r(o),"object"!=typeof o||null===o||o===e||o instanceof RegExp||o instanceof Date||o instanceof String||o instanceof Number||o instanceof Boolean)return o;var a=o instanceof Array?[]:{};return s.save(o,a),n(o,(function(n){var i=r(o[n]);switch(typeof i){case"boolean":case"number":case"string":case"function":a[n]=i;break;case"object":case"undefined":var c=s.get(i);a[n]=c!==e?c:t(i,r,s)}})),a}function n(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)t(n);"function"==typeof e.toJSON&&t("toJSON")}else for(n in e)t(n)}function i(){this.keys=[],this.values=[]}p.ad=function(e){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return t(e,(function(e){for(var t=0;p.O(e)&&10>t;t++)e=e();return e}))},p.toJSON=function(e,t,n){return e=p.ad(e),p.a.hc(e,t,n)},i.prototype={constructor:i,save:function(e,t){var n=p.a.A(this.keys,e);0<=n?this.values[n]=t:(this.keys.push(e),this.values.push(t))},get:function(t){return t=p.a.A(this.keys,t),0<=t?this.values[t]:e}}}(),p.b("toJS",p.ad),p.b("toJSON",p.toJSON),p.Wd=function(e,t,n){function i(t){var i=p.xb(e,n).extend({ma:"always"}),o=i.subscribe((function(e){e&&(o.s(),t(e))}));return i.notifySubscribers(i.v()),o}return"function"!==typeof Promise||t?i(t.bind(n)):new Promise(i)},p.b("when",p.Wd),function(){p.w={M:function(t){switch(p.a.R(t)){case"option":return!0===t.__ko__hasDomDataOptionValue__?p.a.g.get(t,p.c.options.$b):7>=p.a.W?t.getAttributeNode("value")&&t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return 0<=t.selectedIndex?p.w.M(t.options[t.selectedIndex]):e;default:return t.value}},cb:function(t,n,i){switch(p.a.R(t)){case"option":"string"===typeof n?(p.a.g.set(t,p.c.options.$b,e),"__ko__hasDomDataOptionValue__"in t&&delete t.__ko__hasDomDataOptionValue__,t.value=n):(p.a.g.set(t,p.c.options.$b,n),t.__ko__hasDomDataOptionValue__=!0,t.value="number"===typeof n?n:"");break;case"select":""!==n&&null!==n||(n=e);for(var o,r=-1,s=0,a=t.options.length;s<a;++s)if(o=p.w.M(t.options[s]),o==n||""===o&&n===e){r=s;break}(i||0<=r||n===e&&1<t.size)&&(t.selectedIndex=r,6===p.a.W&&p.a.setTimeout((function(){t.selectedIndex=r}),0));break;default:null!==n&&n!==e||(n=""),t.value=n}}}}(),p.b("selectExtensions",p.w),p.b("selectExtensions.readValue",p.w.M),p.b("selectExtensions.writeValue",p.w.cb),p.m=function(){function e(e){e=p.a.Db(e),123===e.charCodeAt(0)&&(e=e.slice(1,-1)),e+="\n,";var t,n=[],s=e.match(i),a=[],c=0;if(1<s.length){for(var l,u=0;l=s[u];++u){var h=l.charCodeAt(0);if(44===h){if(0>=c){n.push(t&&a.length?{key:t,value:a.join("")}:{unknown:t||a.join("")}),t=c=0,a=[];continue}}else if(58===h){if(!c&&!t&&1===a.length){t=a.pop();continue}}else{if(47===h&&1<l.length&&(47===l.charCodeAt(1)||42===l.charCodeAt(1)))continue;47===h&&u&&1<l.length?(h=s[u-1].match(o))&&!r[h[0]]&&(e=e.substr(e.indexOf(l)+1),s=e.match(i),u=-1,l="/"):40===h||123===h||91===h?++c:41===h||125===h||93===h?--c:t||a.length||34!==h&&39!==h||(l=l.slice(1,-1))}a.push(l)}if(0<c)throw Error("Unbalanced parentheses, braces, or brackets")}return n}var t=["true","false","null","undefined"],n=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,i=RegExp("\"(?:\\\\.|[^\"])*\"|'(?:\\\\.|[^'])*'|`(?:\\\\.|[^`])*`|/\\*(?:[^*]|\\*+[^*/])*\\*+/|//.*\n|/(?:\\\\.|[^/])+/w*|[^\\s:,/][^,\"'`{}()/:[\\]]*[^\\s,\"'`{}()/:[\\]]|[^\\s]","g"),o=/[\])"'A-Za-z0-9_$]+$/,r={in:1,return:1,typeof:1},s={};return{Ra:[],wa:s,ac:e,vb:function(i,o){function r(e,i){var o;if(!u){var h=p.getBindingHandler(e);if(h&&h.preprocess&&!(i=h.preprocess(i,e,r)))return;(h=s[e])&&(o=i,0<=p.a.A(t,o)?o=!1:(h=o.match(n),o=null!==h&&(h[1]?"Object("+h[1]+")"+h[2]:o)),h=o),h&&c.push("'"+("string"==typeof s[e]?s[e]:e)+"':function(_z){"+o+"=_z}")}l&&(i="function(){return "+i+" }"),a.push("'"+e+"':"+i)}o=o||{};var a=[],c=[],l=o.valueAccessors,u=o.bindingParams,h="string"===typeof i?e(i):i;return p.a.D(h,(function(e){r(e.key||e.unknown,e.value)})),c.length&&r("_ko_property_writers","{"+c.join(",")+" }"),a.join(",")},Id:function(e,t){for(var n=0;n<e.length;n++)if(e[n].key==t)return!0;return!1},eb:function(e,t,n,i,o){e&&p.O(e)?!p.Za(e)||o&&e.v()===i||e(i):(e=t.get("_ko_property_writers"))&&e[n]&&e[n](i)}}}(),p.b("expressionRewriting",p.m),p.b("expressionRewriting.bindingRewriteValidators",p.m.Ra),p.b("expressionRewriting.parseObjectLiteral",p.m.ac),p.b("expressionRewriting.preProcessBindings",p.m.vb),p.b("expressionRewriting._twoWayBindings",p.m.wa),p.b("jsonExpressionRewriting",p.m),p.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",p.m.vb),function(){function e(e){return 8==e.nodeType&&s.test(r?e.text:e.nodeValue)}function t(e){return 8==e.nodeType&&a.test(r?e.text:e.nodeValue)}function i(n,i){for(var o=n,r=1,s=[];o=o.nextSibling;){if(t(o)&&(p.a.g.set(o,l,!0),r--,0===r))return s;s.push(o),e(o)&&r++}if(!i)throw Error("Cannot find closing comment tag to match: "+n.nodeValue);return null}function o(e,t){var n=i(e,t);return n?0<n.length?n[n.length-1].nextSibling:e.nextSibling:null}var r=n&&"\x3c!--test--\x3e"===n.createComment("test").text,s=r?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,a=r?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,c={ul:!0,ol:!0},l="__ko_matchedEndComment__";p.h={ea:{},childNodes:function(t){return e(t)?i(t):t.childNodes},Ea:function(t){if(e(t)){t=p.h.childNodes(t);for(var n=0,i=t.length;n<i;n++)p.removeNode(t[n])}else p.a.Tb(t)},va:function(t,n){if(e(t)){p.h.Ea(t);for(var i=t.nextSibling,o=0,r=n.length;o<r;o++)i.parentNode.insertBefore(n[o],i)}else p.a.va(t,n)},Vc:function(t,n){var i;e(t)?(i=t.nextSibling,t=t.parentNode):i=t.firstChild,i?n!==i&&t.insertBefore(n,i):t.appendChild(n)},Wb:function(t,n,i){i?(i=i.nextSibling,e(t)&&(t=t.parentNode),i?n!==i&&t.insertBefore(n,i):t.appendChild(n)):p.h.Vc(t,n)},firstChild:function(n){if(e(n))return!n.nextSibling||t(n.nextSibling)?null:n.nextSibling;if(n.firstChild&&t(n.firstChild))throw Error("Found invalid end comment, as the first child of "+n);return n.firstChild},nextSibling:function(n){if(e(n)&&(n=o(n)),n.nextSibling&&t(n.nextSibling)){var i=n.nextSibling;if(t(i)&&!p.a.g.get(i,l))throw Error("Found end comment without a matching opening comment, as child of "+n);return null}return n.nextSibling},Cd:e,Vd:function(e){return(e=(r?e.text:e.nodeValue).match(s))?e[1]:null},Sc:function(n){if(c[p.a.R(n)]){var i=n.firstChild;if(i)do{if(1===i.nodeType){var r;r=i.firstChild;var s=null;if(r)do{if(s)s.push(r);else if(e(r)){var a=o(r,!0);a?r=a:s=[r]}else t(r)&&(s=[r])}while(r=r.nextSibling);if(r=s)for(s=i.nextSibling,a=0;a<r.length;a++)s?n.insertBefore(r[a],s):n.appendChild(r[a])}}while(i=i.nextSibling)}}}}(),p.b("virtualElements",p.h),p.b("virtualElements.allowedBindings",p.h.ea),p.b("virtualElements.emptyNode",p.h.Ea),p.b("virtualElements.insertAfter",p.h.Wb),p.b("virtualElements.prepend",p.h.Vc),p.b("virtualElements.setDomNodeChildren",p.h.va),function(){p.ga=function(){this.nd={}},p.a.extend(p.ga.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return null!=e.getAttribute("data-bind")||p.j.getComponentNameForNode(e);case 8:return p.h.Cd(e);default:return!1}},getBindings:function(e,t){var n=this.getBindingsString(e,t);n=n?this.parseBindingsString(n,t,e):null;return p.j.tc(n,e,t,!1)},getBindingAccessors:function(e,t){var n=this.getBindingsString(e,t);n=n?this.parseBindingsString(n,t,e,{valueAccessors:!0}):null;return p.j.tc(n,e,t,!0)},getBindingsString:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return p.h.Vd(e);default:return null}},parseBindingsString:function(e,t,n,i){try{var o,r=this.nd,s=e+(i&&i.valueAccessors||"");if(!(o=r[s])){var a,c="with($context){with($data||{}){return{"+p.m.vb(e,i)+"}}}";a=new Function("$context","$element",c),o=r[s]=a}return o(t,n)}catch(xrt){throw xrt.message="Unable to parse bindings.\nBindings value: "+e+"\nMessage: "+xrt.message,xrt}}}),p.ga.instance=new p.ga}(),p.b("bindingProvider",p.ga),function(){function i(e){var t=(e=p.a.g.get(e,w))&&e.N;t&&(e.N=null,t.Tc())}function r(e,t,n){this.node=e,this.yc=t,this.kb=[],this.H=!1,t.N||p.a.K.za(e,i),n&&n.N&&(n.N.kb.push(e),this.Kb=n)}function s(e){return function(){return e}}function a(e){return e()}function c(e){return p.a.Ga(p.u.G(e),(function(t,n){return function(){return e()[n]}}))}function l(e,t,n){return"function"===typeof e?c(e.bind(null,t,n)):p.a.Ga(e,s)}function u(e,t){return c(this.getBindings.bind(this,e,t))}function h(e,t){var n=p.h.firstChild(t);if(n){var i,o=p.ga.instance,r=o.preprocessNode;if(r){for(;i=n;)n=p.h.nextSibling(i),r.call(o,i);n=p.h.firstChild(t)}for(;i=n;)n=p.h.nextSibling(i),d(e,i)}p.i.ma(t,p.i.H)}function d(e,t){var n=e,i=1===t.nodeType;i&&p.h.Sc(t),(i||p.ga.instance.nodeHasBindings(t))&&(n=m(t,null,e).bindingContextForDescendants),n&&!b[p.a.R(t)]&&h(n,t)}function f(e){var t=[],n={},i=[];return p.a.P(e,(function o(r){if(!n[r]){var s=p.getBindingHandler(r);s&&(s.after&&(i.push(r),p.a.D(s.after,(function(t){if(e[t]){if(-1!==p.a.A(i,t))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+i.join(", "));o(t)}})),i.length--),t.push({key:r,Mc:s})),n[r]=!0}})),t}function m(t,n,i){var o,r=p.a.g.Ub(t,w,{}),s=r.hd;if(!n){if(s)throw Error("You cannot apply bindings multiple times to the same element.");r.hd=!0}if(s||(r.context=i),r.Zb||(r.Zb={}),n&&"function"!==typeof n)o=n;else{var c=p.ga.instance,l=c.getBindingAccessors||u,h=p.$((function(){return(o=n?n(i,t):l.call(c,t,i))&&(i[g]&&i[g](),i[v]&&i[v]()),o}),null,{l:t});o&&h.ja()||(h=null)}var d,m=i;if(o){var _=function(){return p.a.Ga(h?h():o,a)},y=h?function(e){return function(){return a(h()[e])}}:function(e){return o[e]};_.get=function(e){return o[e]&&a(y(e))},_.has=function(e){return e in o},p.i.H in o&&p.i.subscribe(t,p.i.H,(function(){var e=(0,o[p.i.H])();if(e){var n=p.h.childNodes(t);n.length&&e(n,p.Ec(n[0]))}})),p.i.pa in o&&(m=p.i.Cb(t,i),p.i.subscribe(t,p.i.pa,(function(){var e=(0,o[p.i.pa])();e&&p.h.firstChild(t)&&e(t)}))),r=f(o),p.a.D(r,(function(n){var i=n.Mc.init,r=n.Mc.update,a=n.key;if(8===t.nodeType&&!p.h.ea[a])throw Error("The binding '"+a+"' cannot be used with virtual elements");try{"function"==typeof i&&p.u.G((function(){var n=i(t,y(a),_,m.$data,m);if(n&&n.controlsDescendantBindings){if(d!==e)throw Error("Multiple bindings ("+d+" and "+a+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");d=a}})),"function"==typeof r&&p.$((function(){r(t,y(a),_,m.$data,m)}),null,{l:t})}catch(s){throw s.message='Unable to process binding "'+a+": "+o[a]+'"\nMessage: '+s.message,s}}))}return r=d===e,{shouldBindDescendants:r,bindingContextForDescendants:r&&m}}function _(t,n){return t&&t instanceof p.fa?t:new p.fa(t,e,e,n)}var g=p.a.Da("_subscribable"),y=p.a.Da("_ancestorBindingInfo"),v=p.a.Da("_dataDependency");p.c={};var b={script:!0,textarea:!0,template:!0};p.getBindingHandler=function(e){return p.c[e]};var A={};p.fa=function(t,n,i,o,r){function s(){var e=h?u():u,t=p.a.f(e);return n?(p.a.extend(c,n),y in n&&(c[y]=n[y])):(c.$parents=[],c.$root=t,c.ko=p),c[g]=a,l?t=c.$data:(c.$rawData=e,c.$data=t),i&&(c[i]=t),o&&o(c,n,t),n&&n[g]&&!p.S.o().Vb(n[g])&&n[g](),d&&(c[v]=d),c.$data}var a,c=this,l=t===A,u=l?e:t,h="function"==typeof u&&!p.O(u),d=r&&r.dataDependency;r&&r.exportDependencies?s():(a=p.xb(s),a.v(),a.ja()?a.equalityComparer=null:c[g]=e)},p.fa.prototype.createChildContext=function(e,t,n,i){if(!i&&t&&"object"==typeof t&&(i=t,t=i.as,n=i.extend),t&&i&&i.noChildContext){var o="function"==typeof e&&!p.O(e);return new p.fa(A,this,null,(function(i){n&&n(i),i[t]=o?e():e}),i)}return new p.fa(e,this,t,(function(e,t){e.$parentContext=t,e.$parent=t.$data,e.$parents=(t.$parents||[]).slice(0),e.$parents.unshift(e.$parent),n&&n(e)}),i)},p.fa.prototype.extend=function(e,t){return new p.fa(A,this,null,(function(t){p.a.extend(t,"function"==typeof e?e(t):e)}),t)};var w=p.a.g.Z();r.prototype.Tc=function(){this.Kb&&this.Kb.N&&this.Kb.N.sd(this.node)},r.prototype.sd=function(e){p.a.Pa(this.kb,e),!this.kb.length&&this.H&&this.Cc()},r.prototype.Cc=function(){this.H=!0,this.yc.N&&!this.kb.length&&(this.yc.N=null,p.a.K.yb(this.node,i),p.i.ma(this.node,p.i.pa),this.Tc())},p.i={H:"childrenComplete",pa:"descendantsComplete",subscribe:function(e,t,n,i,o){var r=p.a.g.Ub(e,w,{});return r.Fa||(r.Fa=new p.T),o&&o.notifyImmediately&&r.Zb[t]&&p.u.G(n,i,[e]),r.Fa.subscribe(n,i,t)},ma:function(t,n){var i=p.a.g.get(t,w);if(i&&(i.Zb[n]=!0,i.Fa&&i.Fa.notifySubscribers(t,n),n==p.i.H))if(i.N)i.N.Cc();else if(i.N===e&&i.Fa&&i.Fa.Wa(p.i.pa))throw Error("descendantsComplete event not supported for bindings on this node")},Cb:function(e,t){var n=p.a.g.Ub(e,w,{});return n.N||(n.N=new r(e,n,t[y])),t[y]==n?t:t.extend((function(e){e[y]=n}))}},p.Td=function(e){return(e=p.a.g.get(e,w))&&e.context},p.ib=function(e,t,n){return 1===e.nodeType&&p.h.Sc(e),m(e,t,_(n))},p.ld=function(e,t,n){return n=_(n),p.ib(e,l(t,n,e),n)},p.Oa=function(e,t){1!==t.nodeType&&8!==t.nodeType||h(_(e),t)},p.vc=function(e,i,r){if(!o&&t.jQuery&&(o=t.jQuery),2>arguments.length){if(i=n.body,!i)throw Error("ko.applyBindings: could not find document.body; has the document been loaded?")}else if(!i||1!==i.nodeType&&8!==i.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");d(_(e,r),i)},p.Dc=function(t){return!t||1!==t.nodeType&&8!==t.nodeType?e:p.Td(t)},p.Ec=function(t){return(t=p.Dc(t))?t.$data:e},p.b("bindingHandlers",p.c),p.b("bindingEvent",p.i),p.b("bindingEvent.subscribe",p.i.subscribe),p.b("bindingEvent.startPossiblyAsyncContentBinding",p.i.Cb),p.b("applyBindings",p.vc),p.b("applyBindingsToDescendants",p.Oa),p.b("applyBindingAccessorsToNode",p.ib),p.b("applyBindingsToNode",p.ld),p.b("contextFor",p.Dc),p.b("dataFor",p.Ec)}(),function(e){function t(t,i){var s,a=Object.prototype.hasOwnProperty.call(o,t)?o[t]:e;a?a.subscribe(i):(a=o[t]=new p.T,a.subscribe(i),n(t,(function(e,n){var i=!(!n||!n.synchronous);r[t]={definition:e,Gd:i},delete o[t],s||i?a.notifySubscribers(e):p.na.zb((function(){a.notifySubscribers(e)}))})),s=!0)}function n(e,t){i("getConfig",[e],(function(n){n?i("loadComponent",[e,n],(function(e){t(e,n)})):t(null,null)}))}function i(t,n,o,r){r||(r=p.j.loaders.slice(0));var s=r.shift();if(s){var a=s[t];if(a){var c=!1;if(a.apply(s,n.concat((function(e){c?o(null):null!==e?o(e):i(t,n,o,r)})))!==e&&(c=!0,!s.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else i(t,n,o,r)}else o(null)}var o={},r={};p.j={get:function(n,i){var o=Object.prototype.hasOwnProperty.call(r,n)?r[n]:e;o?o.Gd?p.u.G((function(){i(o.definition)})):p.na.zb((function(){i(o.definition)})):t(n,i)},Bc:function(e){delete r[e]},oc:i},p.j.loaders=[],p.b("components",p.j),p.b("components.get",p.j.get),p.b("components.clearCachedDefinition",p.j.Bc)}(),function(){function e(e,t,n,i){function o(){0===--a&&i(r)}var r={},a=2,c=n.template;n=n.viewModel,c?s(t,c,(function(t){p.j.oc("loadTemplate",[e,t],(function(e){r.template=e,o()}))})):o(),n?s(t,n,(function(t){p.j.oc("loadViewModel",[e,t],(function(e){r[u]=e,o()}))})):o()}function i(e,t,n){if("function"===typeof t)n((function(e){return new t(e)}));else if("function"===typeof t[u])n(t[u]);else if("instance"in t){var o=t.instance;n((function(){return o}))}else"viewModel"in t?i(e,t.viewModel,n):e("Unknown viewModel value: "+t)}function o(e){switch(p.a.R(e)){case"script":return p.a.ua(e.text);case"textarea":return p.a.ua(e.value);case"template":if(r(e.content))return p.a.Ca(e.content.childNodes)}return p.a.Ca(e.childNodes)}function r(e){return t.DocumentFragment?e instanceof DocumentFragment:e&&11===e.nodeType}function s(e,n,i){"string"===typeof n.require?a||t.require?(a||t.require)([n.require],(function(e){e&&"object"===typeof e&&e.Xd&&e["default"]&&(e=e["default"]),i(e)})):e("Uses require, but no AMD loader is present"):i(n)}function c(e){return function(t){throw Error("Component '"+e+"': "+t)}}var l={};p.j.register=function(e,t){if(!t)throw Error("Invalid configuration for "+e);if(p.j.tb(e))throw Error("Component "+e+" is already registered");l[e]=t},p.j.tb=function(e){return Object.prototype.hasOwnProperty.call(l,e)},p.j.unregister=function(e){delete l[e],p.j.Bc(e)},p.j.Fc={getConfig:function(e,t){t(p.j.tb(e)?l[e]:null)},loadComponent:function(t,n,i){var o=c(t);s(o,n,(function(n){e(t,o,n,i)}))},loadTemplate:function(e,i,s){if(e=c(e),"string"===typeof i)s(p.a.ua(i));else if(i instanceof Array)s(i);else if(r(i))s(p.a.la(i.childNodes));else if(i.element)if(i=i.element,t.HTMLElement?i instanceof HTMLElement:i&&i.tagName&&1===i.nodeType)s(o(i));else if("string"===typeof i){var a=n.getElementById(i);a?s(o(a)):e("Cannot find element with ID "+i)}else e("Unknown element type: "+i);else e("Unknown template value: "+i)},loadViewModel:function(e,t,n){i(c(e),t,n)}};var u="createViewModel";p.b("components.register",p.j.register),p.b("components.isRegistered",p.j.tb),p.b("components.unregister",p.j.unregister),p.b("components.defaultLoader",p.j.Fc),p.j.loaders.push(p.j.Fc),p.j.dd=l}(),function(){function e(e,n){var i=e.getAttribute("params");if(i){i=t.parseBindingsString(i,n,e,{valueAccessors:!0,bindingParams:!0}),i=p.a.Ga(i,(function(t){return p.o(t,null,{l:e})}));var o=p.a.Ga(i,(function(t){var n=t.v();return t.ja()?p.o({read:function(){return p.a.f(t())},write:p.Za(n)&&function(e){t()(e)},l:e}):n}));return Object.prototype.hasOwnProperty.call(o,"$raw")||(o.$raw=i),o}return{$raw:{}}}p.j.getComponentNameForNode=function(e){var t=p.a.R(e);if(p.j.tb(t)&&(-1!=t.indexOf("-")||"[object HTMLUnknownElement]"==""+e||8>=p.a.W&&e.tagName===t))return t},p.j.tc=function(t,n,i,o){if(1===n.nodeType){var r=p.j.getComponentNameForNode(n);if(r){if(t=t||{},t.component)throw Error('Cannot use the "component" binding on a custom element matching a component');var s={name:r,params:e(n,i)};t.component=o?function(){return s}:s}}return t};var t=new p.ga;9>p.a.W&&(p.j.register=function(e){return function(t){return e.apply(this,arguments)}}(p.j.register),n.createDocumentFragment=function(e){return function(){var t,n=e(),i=p.j.dd;for(t in i);return n}}(n.createDocumentFragment))}(),function(){function e(e,t,n){if(t=t.template,!t)throw Error("Component '"+e+"' has no template");e=p.a.Ca(t),p.h.va(n,e)}function t(e,t,n){var i=e.createViewModel;return i?i.call(e,t,n):t}var n=0;p.c.component={init:function(i,o,r,s,a){function c(){var e=l&&l.dispose;"function"===typeof e&&e.call(l),h&&h.s(),u=l=h=null}var l,u,h,d=p.a.la(p.h.childNodes(i));return p.h.Ea(i),p.a.K.za(i,c),p.o((function(){var r,s,f=p.a.f(o());if("string"===typeof f?r=f:(r=p.a.f(f.name),s=p.a.f(f.params)),!r)throw Error("No component name specified");var m=p.i.Cb(i,a),_=u=++n;p.j.get(r,(function(n){if(u===_){if(c(),!n)throw Error("Unknown component '"+r+"'");e(r,n,i);var o=t(n,s,{element:i,templateNodes:d});n=m.createChildContext(o,{extend:function(e){e.$component=o,e.$componentTemplateNodes=d}}),o&&o.koDescendantsComplete&&(h=p.i.subscribe(i,p.i.pa,o.koDescendantsComplete,o)),l=o,p.Oa(n,i)}}))}),null,{l:i}),{controlsDescendantBindings:!0}}},p.h.ea.component=!0}();var E={class:"className",for:"htmlFor"};p.c.attr={update:function(t,n){var i=p.a.f(n())||{};p.a.P(i,(function(n,i){i=p.a.f(i);var o=n.indexOf(":"),r=(o="lookupNamespaceURI"in t&&0<o&&t.lookupNamespaceURI(n.substr(0,o)),!1===i||null===i||i===e);r?o?t.removeAttributeNS(o,n):t.removeAttribute(n):i=i.toString(),8>=p.a.W&&n in E?(n=E[n],r?t.removeAttribute(n):t[n]=i):r||(o?t.setAttributeNS(o,n,i):t.setAttribute(n,i)),"name"===n&&p.a.Yc(t,r?"":i)}))}},function(){p.c.checked={after:["value","attr"],init:function(t,n,i){function o(){var o=t.checked,r=s();if(!p.S.Ya()&&(o||!c&&!p.S.qa())){var l=p.u.G(n);if(u){var d=h?l.v():l,m=f;f=r,m!==r?o&&(p.a.Na(d,r,!0),p.a.Na(d,m,!1)):p.a.Na(d,r,o),h&&p.Za(l)&&l(d)}else a&&(r===e?r=o:o||(r=e)),p.m.eb(l,i,"checked",r,!0)}}function r(){var i=p.a.f(n()),o=s();u?(t.checked=0<=p.a.A(i,o),f=o):t.checked=a&&o===e?!!i:s()===i}var s=p.xb((function(){return i.has("checkedValue")?p.a.f(i.get("checkedValue")):d?i.has("value")?p.a.f(i.get("value")):t.value:void 0})),a="checkbox"==t.type,c="radio"==t.type;if(a||c){var l=n(),u=a&&p.a.f(l)instanceof Array,h=!(u&&l.push&&l.splice),d=c||u,f=u?s():e;c&&!t.name&&p.c.uniqueName.init(t,(function(){return!0})),p.o(o,null,{l:t}),p.a.B(t,"click",o),p.o(r,null,{l:t}),l=e}}},p.m.wa.checked=!0,p.c.checkedValue={update:function(e,t){e.value=p.a.f(t())}}}(),p.c["class"]={update:function(e,t){var n=p.a.Db(p.a.f(t()));p.a.Eb(e,e.__ko__cssValue,!1),e.__ko__cssValue=n,p.a.Eb(e,n,!0)}},p.c.css={update:function(e,t){var n=p.a.f(t());null!==n&&"object"==typeof n?p.a.P(n,(function(t,n){n=p.a.f(n),p.a.Eb(e,t,n)})):p.c["class"].update(e,t)}},p.c.enable={update:function(e,t){var n=p.a.f(t());n&&e.disabled?e.removeAttribute("disabled"):n||e.disabled||(e.disabled=!0)}},p.c.disable={update:function(e,t){p.c.enable.update(e,(function(){return!p.a.f(t())}))}},p.c.event={init:function(e,t,n,i,o){var r=t()||{};p.a.P(r,(function(r){"string"==typeof r&&p.a.B(e,r,(function(e){var s,a=t()[r];if(a){try{var c=p.a.la(arguments);i=o.$data,c.unshift(i),s=a.apply(i,c)}finally{!0!==s&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}!1===n.get(r+"Bubble")&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())}}))}))}},p.c.foreach={Rc:function(e){return function(){var t=e(),n=p.a.bc(t);return n&&"number"!=typeof n.length?(p.a.f(t),{foreach:n.data,as:n.as,noChildContext:n.noChildContext,includeDestroyed:n.includeDestroyed,afterAdd:n.afterAdd,beforeRemove:n.beforeRemove,afterRender:n.afterRender,beforeMove:n.beforeMove,afterMove:n.afterMove,templateEngine:p.ba.Ma}):{foreach:t,templateEngine:p.ba.Ma}}},init:function(e,t){return p.c.template.init(e,p.c.foreach.Rc(t))},update:function(e,t,n,i,o){return p.c.template.update(e,p.c.foreach.Rc(t),n,i,o)}},p.m.Ra.foreach=!1,p.h.ea.foreach=!0,p.c.hasfocus={init:function(e,t,n){function i(i){e.__ko_hasfocusUpdating=!0;var o=e.ownerDocument;if("activeElement"in o){var r;try{r=o.activeElement}catch(xrt){r=o.body}i=r===e}o=t(),p.m.eb(o,n,"hasfocus",i,!0),e.__ko_hasfocusLastValue=i,e.__ko_hasfocusUpdating=!1}var o=i.bind(null,!0),r=i.bind(null,!1);p.a.B(e,"focus",o),p.a.B(e,"focusin",o),p.a.B(e,"blur",r),p.a.B(e,"focusout",r),e.__ko_hasfocusLastValue=!1},update:function(e,t){var n=!!p.a.f(t());e.__ko_hasfocusUpdating||e.__ko_hasfocusLastValue===n||(n?e.focus():e.blur(),!n&&e.__ko_hasfocusLastValue&&e.ownerDocument.body.focus(),p.u.G(p.a.Fb,null,[e,n?"focusin":"focusout"]))}},p.m.wa.hasfocus=!0,p.c.hasFocus=p.c.hasfocus,p.m.wa.hasFocus="hasfocus",p.c.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){p.a.fc(e,t())}},function(){function e(e,t,n){p.c[e]={init:function(e,i,o,r,s){var a,c,l,u,h,d={};if(t){r=o.get("as");var f=o.get("noChildContext");h=!(r&&f),d={as:r,noChildContext:f,exportDependencies:h}}return u=(l="render"==o.get("completeOn"))||o.has(p.i.pa),p.o((function(){var o,r=p.a.f(i()),f=!n!==!r,m=!c;(h||f!==a)&&(u&&(s=p.i.Cb(e,s)),f&&(t&&!h||(d.dataDependency=p.S.o()),o=t?s.createChildContext("function"==typeof r?r:i,d):p.S.qa()?s.extend(null,d):s),m&&p.S.qa()&&(c=p.a.Ca(p.h.childNodes(e),!0)),f?(m||p.h.va(e,p.a.Ca(c)),p.Oa(o,e)):(p.h.Ea(e),l||p.i.ma(e,p.i.H)),a=f)}),null,{l:e}),{controlsDescendantBindings:!0}}},p.m.Ra[e]=!1,p.h.ea[e]=!0}e("if"),e("ifnot",!1,!0),e("with",!0)}(),p.c.let={init:function(e,t,n,i,o){return t=o.extend(t),p.Oa(t,e),{controlsDescendantBindings:!0}}},p.h.ea.let=!0;var x={};p.c.options={init:function(e){if("select"!==p.a.R(e))throw Error("options binding applies only to SELECT elements");for(;0<e.length;)e.remove(0);return{controlsDescendantBindings:!0}},update:function(t,n,i){function o(){return p.a.jb(t.options,(function(e){return e.selected}))}function r(e,t,n){var i=typeof t;return"function"==i?t(e):"string"==i?e[t]:n}function s(e,n){if(_&&u)p.i.ma(t,p.i.H);else if(f.length){var i=0<=p.a.A(f,p.w.M(n[0]));p.a.Zc(n[0],i),_&&!i&&p.u.G(p.a.Fb,null,[t,"change"])}}var a=t.multiple,c=0!=t.length&&a?t.scrollTop:null,l=p.a.f(n()),u=i.get("valueAllowUnset")&&i.has("value"),h=i.get("optionsIncludeDestroyed");n={};var d,f=[];u||(a?f=p.a.Mb(o(),p.w.M):0<=t.selectedIndex&&f.push(p.w.M(t.options[t.selectedIndex]))),l&&("undefined"==typeof l.length&&(l=[l]),d=p.a.jb(l,(function(t){return h||t===e||null===t||!p.a.f(t._destroy)})),i.has("optionsCaption")&&(l=p.a.f(i.get("optionsCaption")),null!==l&&l!==e&&d.unshift(x)));var m,_=!1;(n.beforeRemove=function(e){t.removeChild(e)},l=s,i.has("optionsAfterRender")&&"function"==typeof i.get("optionsAfterRender")&&(l=function(t,n){s(0,n),p.u.G(i.get("optionsAfterRender"),null,[n[0],t!==x?t:e])}),p.a.ec(t,d,(function(n,o,s){return s.length&&(f=!u&&s[0].selected?[p.w.M(s[0])]:[],_=!0),o=t.ownerDocument.createElement("option"),n===x?(p.a.Bb(o,i.get("optionsCaption")),p.w.cb(o,e)):(s=r(n,i.get("optionsValue"),n),p.w.cb(o,p.a.f(s)),n=r(n,i.get("optionsText"),s),p.a.Bb(o,n)),[o]}),n,l),u)||(m=a?f.length&&o().length<f.length:f.length&&0<=t.selectedIndex?p.w.M(t.options[t.selectedIndex])!==f[0]:f.length||0<=t.selectedIndex,m&&p.u.G(p.a.Fb,null,[t,"change"]));(u||p.S.Ya())&&p.i.ma(t,p.i.H),p.a.wd(t),c&&20<Math.abs(c-t.scrollTop)&&(t.scrollTop=c)}},p.c.options.$b=p.a.g.Z(),p.c.selectedOptions={init:function(e,t,n){function i(){var i=t(),o=[];p.a.D(e.getElementsByTagName("option"),(function(e){e.selected&&o.push(p.w.M(e))})),p.m.eb(i,n,"selectedOptions",o)}function o(){var n=p.a.f(t()),i=e.scrollTop;n&&"number"==typeof n.length&&p.a.D(e.getElementsByTagName("option"),(function(e){var t=0<=p.a.A(n,p.w.M(e));e.selected!=t&&p.a.Zc(e,t)})),e.scrollTop=i}if("select"!=p.a.R(e))throw Error("selectedOptions binding applies only to SELECT elements");var r;p.i.subscribe(e,p.i.H,(function(){r?i():(p.a.B(e,"change",i),r=p.o(o,null,{l:e}))}),null,{notifyImmediately:!0})},update:function(){}},p.m.wa.selectedOptions=!0,p.c.style={update:function(t,n){var i=p.a.f(n()||{});p.a.P(i,(function(n,i){if(i=p.a.f(i),null!==i&&i!==e&&!1!==i||(i=""),o)o(t).css(n,i);else if(/^--/.test(n))t.style.setProperty(n,i);else{n=n.replace(/-(\w)/g,(function(e,t){return t.toUpperCase()}));var r=t.style[n];t.style[n]=i,i===r||t.style[n]!=r||isNaN(i)||(t.style[n]=i+"px")}}))}},p.c.submit={init:function(e,t,n,i,o){if("function"!=typeof t())throw Error("The value for a submit binding must be a function");p.a.B(e,"submit",(function(n){var i,r=t();try{i=r.call(o.$data,e)}finally{!0!==i&&(n.preventDefault?n.preventDefault():n.returnValue=!1)}}))}},p.c.text={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){p.a.Bb(e,t())}},p.h.ea.text=!0,function(){if(t&&t.navigator){var n,i,o,r,s,a=function(e){if(e)return parseFloat(e[1])},c=t.navigator.userAgent;(n=t.opera&&t.opera.version&&parseInt(t.opera.version()))||(s=a(c.match(/Edge\/([^ ]+)$/)))||a(c.match(/Chrome\/([^ ]+)/))||(i=a(c.match(/Version\/([^ ]+) Safari/)))||(o=a(c.match(/Firefox\/([^ ]+)/)))||(r=p.a.W||a(c.match(/MSIE ([^ ]+)/)))||(r=a(c.match(/rv:([^ )]+)/)))}if(8<=r&&10>r)var l=p.a.g.Z(),u=p.a.g.Z(),h=function(e){var t=this.activeElement;(t=t&&p.a.g.get(t,u))&&t(e)},d=function(e,t){var n=e.ownerDocument;p.a.g.get(n,l)||(p.a.g.set(n,l,!0),p.a.B(n,"selectionchange",h)),p.a.g.set(e,u,t)};p.c.textInput={init:function(t,a,c){function l(e,n){p.a.B(t,e,n)}function u(){var n=p.a.f(a());null!==n&&n!==e||(n=""),_!==e&&n===_?p.a.setTimeout(u,4):t.value!==n&&(v=!0,t.value=n,v=!1,g=t.value)}function h(){m||(_=t.value,m=p.a.setTimeout(f,4))}function f(){clearTimeout(m),_=m=e;var n=t.value;g!==n&&(g=n,p.m.eb(a(),c,"textInput",n))}var m,_,g=t.value,y=9==p.a.W?h:f,v=!1;r&&l("keypress",f),11>r&&l("propertychange",(function(e){v||"value"!==e.propertyName||y(e)})),8==r&&(l("keyup",f),l("keydown",f)),d&&(d(t,y),l("dragend",h)),(!r||9<=r)&&l("input",y),5>i&&"textarea"===p.a.R(t)?(l("keydown",h),l("paste",h),l("cut",h)):11>n?l("keydown",h):4>o?(l("DOMAutoComplete",f),l("dragdrop",f),l("drop",f)):s&&"number"===t.type&&l("keydown",h),l("change",f),l("blur",f),p.o(u,null,{l:t})}},p.m.wa.textInput=!0,p.c.textinput={preprocess:function(e,t,n){n("textInput",e)}}}(),p.c.uniqueName={init:function(e,t){if(t()){var n="ko_unique_"+ ++p.c.uniqueName.rd;p.a.Yc(e,n)}}},p.c.uniqueName.rd=0,p.c.using={init:function(e,t,n,i,o){var r;return n.has("as")&&(r={as:n.get("as"),noChildContext:n.get("noChildContext")}),t=o.createChildContext(t,r),p.Oa(t,e),{controlsDescendantBindings:!0}}},p.h.ea.using=!0,p.c.value={init:function(t,n,i){var o=p.a.R(t),r="input"==o;if(!r||"checkbox"!=t.type&&"radio"!=t.type){var s=[],a=i.get("valueUpdate"),c=!1,l=null;a&&(s="string"==typeof a?[a]:p.a.wc(a),p.a.Pa(s,"change"));var u,h,d=function(){l=null,c=!1;var e=n(),o=p.w.M(t);p.m.eb(e,i,"value",o)};if(!p.a.W||!r||"text"!=t.type||"off"==t.autocomplete||t.form&&"off"==t.form.autocomplete||-1!=p.a.A(s,"propertychange")||(p.a.B(t,"propertychange",(function(){c=!0})),p.a.B(t,"focus",(function(){c=!1})),p.a.B(t,"blur",(function(){c&&d()}))),p.a.D(s,(function(e){var n=d;p.a.Ud(e,"after")&&(n=function(){l=p.w.M(t),p.a.setTimeout(d,0)},e=e.substring(5)),p.a.B(t,e,n)})),u=r&&"file"==t.type?function(){var i=p.a.f(n());null===i||i===e||""===i?t.value="":p.u.G(d)}:function(){var r=p.a.f(n()),s=p.w.M(t);null!==l&&r===l?p.a.setTimeout(u,0):r===s&&s!==e||("select"===o?(s=i.get("valueAllowUnset"),p.w.cb(t,r,s),s||r===p.w.M(t)||p.u.G(d)):p.w.cb(t,r))},"select"===o)p.i.subscribe(t,p.i.H,(function(){h?i.get("valueAllowUnset")?u():d():(p.a.B(t,"change",d),h=p.o(u,null,{l:t}))}),null,{notifyImmediately:!0});else p.a.B(t,"change",d),p.o(u,null,{l:t})}else p.ib(t,{checkedValue:n})},update:function(){}},p.m.wa.value=!0,p.c.visible={update:function(e,t){var n=p.a.f(t()),i="none"!=e.style.display;n&&!i?e.style.display="":!n&&i&&(e.style.display="none")}},p.c.hidden={update:function(e,t){p.c.visible.update(e,(function(){return!p.a.f(t())}))}},function(e){p.c[e]={init:function(t,n,i,o,r){return p.c.event.init.call(this,t,(function(){var t={};return t[e]=n(),t}),i,o,r)}}}("click"),p.ca=function(){},p.ca.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},p.ca.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},p.ca.prototype.makeTemplateSource=function(e,t){if("string"==typeof e){t=t||n;var i=t.getElementById(e);if(!i)throw Error("Cannot find template with ID "+e);return new p.C.F(i)}if(1==e.nodeType||8==e.nodeType)return new p.C.ia(e);throw Error("Unknown template type: "+e)},p.ca.prototype.renderTemplate=function(e,t,n,i){return e=this.makeTemplateSource(e,i),this.renderTemplateSource(e,t,n,i)},p.ca.prototype.isTemplateRewritten=function(e,t){return!1===this.allowTemplateRewriting||this.makeTemplateSource(e,t).data("isRewritten")},p.ca.prototype.rewriteTemplate=function(e,t,n){e=this.makeTemplateSource(e,n),t=t(e.text()),e.text(t),e.data("isRewritten",!0)},p.b("templateEngine",p.ca),p.kc=function(){function e(e,t,n,i){e=p.m.ac(e);for(var o=p.m.Ra,r=0;r<e.length;r++){var s=e[r].key;if(Object.prototype.hasOwnProperty.call(o,s)){var a=o[s];if("function"===typeof a){if(s=a(e[r].value))throw Error(s)}else if(!a)throw Error("This template engine does not support the '"+s+"' binding within its templates")}}return n="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+p.m.vb(e,{valueAccessors:!0})+" } })()},'"+n.toLowerCase()+"')",i.createJavaScriptEvaluatorBlock(n)+t}var t=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,n=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{xd:function(e,t,n){t.isTemplateRewritten(e,n)||t.rewriteTemplate(e,(function(e){return p.kc.Ld(e,t)}),n)},Ld:function(i,o){return i.replace(t,(function(t,n,i,r,s){return e(s,n,i,o)})).replace(n,(function(t,n){return e(n,"\x3c!-- ko --\x3e","#comment",o)}))},md:function(e,t){return p.aa.Xb((function(n,i){var o=n.nextSibling;o&&o.nodeName.toLowerCase()===t&&p.ib(o,e,i)}))}}}(),p.b("__tr_ambtns",p.kc.md),function(){p.C={},p.C.F=function(e){if(this.F=e){var t=p.a.R(e);this.ab="script"===t?1:"textarea"===t?2:"template"==t&&e.content&&11===e.content.nodeType?3:4}},p.C.F.prototype.text=function(){var e=1===this.ab?"text":2===this.ab?"value":"innerHTML";if(0==arguments.length)return this.F[e];var t=arguments[0];"innerHTML"===e?p.a.fc(this.F,t):this.F[e]=t};var t=p.a.g.Z()+"_";p.C.F.prototype.data=function(e){if(1===arguments.length)return p.a.g.get(this.F,t+e);p.a.g.set(this.F,t+e,arguments[1])};var n=p.a.g.Z();p.C.F.prototype.nodes=function(){var t=this.F;if(0==arguments.length){var i=p.a.g.get(t,n)||{},o=i.lb||(3===this.ab?t.content:4===this.ab?t:e);if(!o||i.jd){var r=this.text();r&&r!==i.bb&&(o=p.a.Md(r,t.ownerDocument),p.a.g.set(t,n,{lb:o,bb:r,jd:!0}))}return o}i=arguments[0],this.ab!==e&&this.text(""),p.a.g.set(t,n,{lb:i})},p.C.ia=function(e){this.F=e},p.C.ia.prototype=new p.C.F,p.C.ia.prototype.constructor=p.C.ia,p.C.ia.prototype.text=function(){if(0==arguments.length){var t=p.a.g.get(this.F,n)||{};return t.bb===e&&t.lb&&(t.bb=t.lb.innerHTML),t.bb}p.a.g.set(this.F,n,{bb:arguments[0]})},p.b("templateSources",p.C),p.b("templateSources.domElement",p.C.F),p.b("templateSources.anonymousTemplate",p.C.ia)}(),function(){function t(e,t,n){var i;for(t=p.h.nextSibling(t);e&&(i=e)!==t;)e=p.h.nextSibling(i),n(i,e)}function n(e,n){if(e.length){var i=e[0],o=e[e.length-1],r=i.parentNode,s=p.ga.instance,a=s.preprocessNode;if(a){if(t(i,o,(function(e,t){var n=e.previousSibling,r=a.call(s,e);r&&(e===i&&(i=r[0]||t),e===o&&(o=r[r.length-1]||n))})),e.length=0,!i)return;i===o?e.push(i):(e.push(i,o),p.a.Ua(e,r))}t(i,o,(function(e){1!==e.nodeType&&8!==e.nodeType||p.vc(n,e)})),t(i,o,(function(e){1!==e.nodeType&&8!==e.nodeType||p.aa.cd(e,[n])})),p.a.Ua(e,r)}}function i(e){return e.nodeType?e:0<e.length?e[0]:null}function o(e,t,o,r,a){a=a||{};var c=(e&&i(e)||o||{}).ownerDocument,l=a.templateEngine||s;if(p.kc.xd(o,l,c),o=l.renderTemplate(o,r,a,c),"number"!=typeof o.length||0<o.length&&"number"!=typeof o[0].nodeType)throw Error("Template engine must return an array of DOM nodes");switch(c=!1,t){case"replaceChildren":p.h.va(e,o),c=!0;break;case"replaceNode":p.a.Xc(e,o),c=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+t)}return c&&(n(o,r),a.afterRender&&p.u.G(a.afterRender,null,[o,r[a.as||"$data"]]),"replaceChildren"==t&&p.i.ma(e,p.i.H)),o}function r(e,t,n){return p.O(e)?e():"function"===typeof e?e(t,n):e}var s;p.gc=function(t){if(t!=e&&!(t instanceof p.ca))throw Error("templateEngine must inherit from ko.templateEngine");s=t},p.dc=function(t,n,a,c,l){if(a=a||{},(a.templateEngine||s)==e)throw Error("Set a template engine before calling renderTemplate");if(l=l||"replaceChildren",c){var u=i(c);return p.$((function(){var e=n&&n instanceof p.fa?n:new p.fa(n,null,null,null,{exportDependencies:!0}),s=r(t,e.$data,e);e=o(c,l,s,e,a);"replaceNode"==l&&(c=e,u=i(c))}),null,{Sa:function(){return!u||!p.a.Sb(u)},l:u&&"replaceNode"==l?u.parentNode:u})}return p.aa.Xb((function(e){p.dc(t,n,a,e,"replaceNode")}))},p.Qd=function(t,i,s,a,c){function l(e,t){p.u.G(p.a.ec,null,[a,e,h,s,u,t]),p.i.ma(a,p.i.H)}function u(e,t){n(t,d),s.afterRender&&s.afterRender(t,e),d=null}function h(e,n){d=c.createChildContext(e,{as:f,noChildContext:s.noChildContext,extend:function(e){e.$index=n,f&&(e[f+"Index"]=n)}});var i=r(t,e,d);return o(a,"ignoreTargetNode",i,d,s)}var d,f=s.as,m=!1===s.includeDestroyed||p.options.foreachHidesDestroyed&&!s.includeDestroyed;if(m||s.beforeRemove||!p.Pc(i))return p.$((function(){var t=p.a.f(i)||[];"undefined"==typeof t.length&&(t=[t]),m&&(t=p.a.jb(t,(function(t){return t===e||null===t||!p.a.f(t._destroy)}))),l(t)}),null,{l:a});l(i.v());var _=i.subscribe((function(e){l(i(),e)}),null,"arrayChange");return _.l(a),_};var a=p.a.g.Z(),c=p.a.g.Z();p.c.template={init:function(e,t){var n=p.a.f(t());if("string"==typeof n||"name"in n)p.h.Ea(e);else if("nodes"in n){if(n=n.nodes||[],p.O(n))throw Error('The "nodes" option must be a plain, non-observable array.');var i=n[0]&&n[0].parentNode;i&&p.a.g.get(i,c)||(i=p.a.Yb(n),p.a.g.set(i,c,!0)),new p.C.ia(e).nodes(i)}else{if(n=p.h.childNodes(e),!(0<n.length))throw Error("Anonymous template defined, but no template content was provided");i=p.a.Yb(n),new p.C.ia(e).nodes(i)}return{controlsDescendantBindings:!0}},update:function(t,n,i,o,r){var s=n();n=p.a.f(s),i=!0,o=null,"string"==typeof n?n={}:(s="name"in n?n.name:t,"if"in n&&(i=p.a.f(n["if"])),i&&"ifnot"in n&&(i=!p.a.f(n.ifnot)),i&&!s&&(i=!1)),"foreach"in n?o=p.Qd(s,i&&n.foreach||[],n,t,r):i?(i=r,"data"in n&&(i=r.createChildContext(n.data,{as:n.as,noChildContext:n.noChildContext,exportDependencies:!0})),o=p.dc(s,i,n,t)):p.h.Ea(t),r=o,(n=p.a.g.get(t,a))&&"function"==typeof n.s&&n.s(),p.a.g.set(t,a,!r||r.ja&&!r.ja()?e:r)}},p.m.Ra.template=function(e){return e=p.m.ac(e),1==e.length&&e[0].unknown||p.m.Id(e,"name")?null:"This template engine does not support anonymous templates nested within its templates"},p.h.ea.template=!0}(),p.b("setTemplateEngine",p.gc),p.b("renderTemplate",p.dc),p.a.Kc=function(e,t,n){var i,o,r,s,a;if(e.length&&t.length)for(i=o=0;(!n||i<n)&&(s=e[o]);++o){for(r=0;a=t[r];++r)if(s.value===a.value){s.moved=a.index,a.moved=s.index,t.splice(r,1),i=r=0;break}i+=r}},p.a.Pb=function(){function e(e,t,n,i,o){var r,s,a,c,l,u=Math.min,h=Math.max,d=[],f=e.length,m=t.length,_=m-f||1,g=f+m+1;for(r=0;r<=f;r++)for(c=a,d.push(a=[]),l=u(m,r+_),s=h(0,r-1);s<=l;s++)a[s]=s?r?e[r-1]===t[s-1]?c[s-1]:u(c[s]||g,a[s-1]||g)+1:s+1:r+1;for(u=[],h=[],_=[],r=f,s=m;r||s;)m=d[r][s]-1,s&&m===d[r][s-1]?h.push(u[u.length]={status:n,value:t[--s],index:s}):r&&m===d[r-1][s]?_.push(u[u.length]={status:i,value:e[--r],index:r}):(--s,--r,o.sparse||u.push({status:"retained",value:t[s]}));return p.a.Kc(_,h,!o.dontLimitMoves&&10*f),u.reverse()}return function(t,n,i){return i="boolean"===typeof i?{dontLimitMoves:i}:i||{},t=t||[],n=n||[],t.length<n.length?e(t,n,"added","deleted",i):e(n,t,"deleted","added",i)}}(),p.b("utils.compareArrays",p.a.Pb),function(){function t(t,n,i,o,r){var s=[],a=p.$((function(){var e=n(i,r,p.a.Ua(s,t))||[];0<s.length&&(p.a.Xc(s,e),o&&p.u.G(o,null,[i,e,r])),s.length=0,p.a.Nb(s,e)}),null,{l:t,Sa:function(){return!p.a.kd(s)}});return{Y:s,$:a.ja()?a:e}}var n=p.a.g.Z(),i=p.a.g.Z();p.a.ec=function(o,r,s,a,c,l){function u(e){f={Aa:e,pb:p.ta(w++)},b.push(f),v||I.push(f)}function h(e){f=y[e],w!==f.pb.v()&&S.push(f),f.pb(w++),p.a.Ua(f.Y,o),b.push(f)}function d(e,t){if(e)for(var n=0,i=t.length;n<i;n++)p.a.D(t[n].Y,(function(i){e(i,n,t[n].Aa)}))}r=r||[],"undefined"==typeof r.length&&(r=[r]),a=a||{};var f,m,_,g,y=p.a.g.get(o,n),v=!y,b=[],A=0,w=0,T=[],E=[],x=[],S=[],I=[],O=0;if(v)p.a.D(r,u);else{if(!l||y&&y._countWaitingForRemove){var D=p.a.Mb(y,(function(e){return e.Aa}));l=p.a.Pb(D,r,{dontLimitMoves:a.dontLimitMoves,sparse:!0})}var P,R,L;for(D=0;P=l[D];D++)switch(R=P.moved,L=P.index,P.status){case"deleted":for(;A<L;)h(A++);R===e&&(f=y[A],f.$&&(f.$.s(),f.$=e),p.a.Ua(f.Y,o).length&&(a.beforeRemove&&(b.push(f),O++,f.Aa===i?f=null:x.push(f)),f&&T.push.apply(T,f.Y))),A++;break;case"added":for(;w<L;)h(A++);R!==e?(E.push(b.length),h(R)):u(P.value)}for(;w<r.length;)h(A++);b._countWaitingForRemove=O}p.a.g.set(o,n,b),d(a.beforeMove,S),p.a.D(T,a.beforeRemove?p.oa:p.removeNode);try{g=o.ownerDocument.activeElement}catch(C){}if(E.length)for(;(D=E.shift())!=e;){for(f=b[D],m=e;D;)if((_=b[--D].Y)&&_.length){m=_[_.length-1];break}for(r=0;A=f.Y[r];m=A,r++)p.h.Wb(o,A,m)}for(D=0;f=b[D];D++){for(f.Y||p.a.extend(f,t(o,s,f.Aa,c,f.pb)),r=0;A=f.Y[r];m=A,r++)p.h.Wb(o,A,m);!f.Ed&&c&&(c(f.Aa,f.Y,f.pb),f.Ed=!0,m=f.Y[f.Y.length-1])}for(g&&o.ownerDocument.activeElement!=g&&g.focus(),d(a.beforeRemove,x),D=0;D<x.length;++D)x[D].Aa=i;d(a.afterMove,S),d(a.afterAdd,I)}}(),p.b("utils.setDomNodeChildrenFromArrayMapping",p.a.ec),p.ba=function(){this.allowTemplateRewriting=!1},p.ba.prototype=new p.ca,p.ba.prototype.constructor=p.ba,p.ba.prototype.renderTemplateSource=function(e,t,n,i){return(t=9>p.a.W||!e.nodes?null:e.nodes())?p.a.la(t.cloneNode(!0).childNodes):(e=e.text(),p.a.ua(e,i))},p.ba.Ma=new p.ba,p.gc(p.ba.Ma),p.b("nativeTemplateEngine",p.ba),function(){p.$a=function(){var e=this.Hd=function(){if(!o||!o.tmpl)return 0;try{if(0<=o.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(e){}return 1}();this.renderTemplateSource=function(t,i,r,s){if(s=s||n,r=r||{},2>e)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var a=t.data("precompiled");return a||(a=t.text()||"",a=o.template(null,"{{ko_with $item.koBindingContext}}"+a+"{{/ko_with}}"),t.data("precompiled",a)),t=[i.$data],i=o.extend({koBindingContext:i},r.templateOptions),i=o.tmpl(a,t,i),i.appendTo(s.createElement("div")),o.fragments={},i},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){n.write("<script type='text/html' id='"+e+"'>"+t+"<\/script>")},0<e&&(o.tmpl.tag.ko_code={open:"__.push($1 || '');"},o.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},p.$a.prototype=new p.ca,p.$a.prototype.constructor=p.$a;var e=new p.$a;0<e.Hd&&p.gc(e),p.b("jqueryTmplTemplateEngine",p.$a)}()}))})()})()}();var $ot=ko;"undefined"!==typeof window?(ko=window.ko,"undefined"!==typeof Jot?window.ko=Jot:delete window.ko):(ko=global.ko,"undefined"!==typeof Jot?global.ko=Jot:delete global.ko);var ert=$ot,trt="__knockoutObservables",nrt="__knockoutSubscribable";function irt(e,t){if(!e)throw new Error("When calling ko.track, you must pass an object as the first parameter.");var n=this,i=ort(e,!0);return t=t||Object.getOwnPropertyNames(e),t.forEach((function(t){if(t!==trt&&t!==nrt&&!(t in i)){var o=e[t],r=o instanceof Array,s=n.isObservable(o)?o:r?n.observableArray(o):n.observable(o);Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:s,set:n.isWriteableObservable(s)?s:void 0}),i[t]=s,r&&srt(n,s)}})),e}function ort(e,t){var n=e[trt];return!n&&t&&(n={},Object.defineProperty(e,trt,{value:n})),n}function rrt(e,t,n){var i=this,o={owner:e,deferEvaluation:!0};if("function"===typeof n)o.read=n;else{if("value"in n)throw new Error('For ko.defineProperty, you must not specify a "value" for the property. You must provide a "get" function.');if("function"!==typeof n.get)throw new Error('For ko.defineProperty, the third parameter must be either an evaluator function, or an options object containing a function called "get".');o.read=n.get,o.write=n.set}return e[t]=i.computed(o),irt.call(i,e,[t]),e}function srt(e,t){var n=null;e.computed((function(){n&&(n.dispose(),n=null);var i=t();i instanceof Array&&(n=art(e,t,i))}))}function art(e,t,n){var i=crt(e,n);return i.subscribe(t)}function crt(e,t){var n=t[nrt];if(!n){n=new e.subscribable,Object.defineProperty(t,nrt,{value:n});var i={};lrt(t,n,i),urt(e,t,n,i)}return n}function lrt(e,t,n){["pop","push","reverse","shift","sort","splice","unshift"].forEach((function(i){var o=e[i];e[i]=function(){var e=o.apply(this,arguments);return!0!==n.pause&&t.notifySubscribers(this),e}}))}function urt(e,t,n,i){["remove","removeAll","destroy","destroyAll","replace"].forEach((function(o){Object.defineProperty(t,o,{enumerable:!1,value:function(){var r;i.pause=!0;try{r=e.observableArray.fn[o].apply(e.observableArray(t),arguments)}finally{i.pause=!1}return n.notifySubscribers(t),r}})}))}function hrt(e,t){if(!e)return null;var n=ort(e,!1);return n&&n[t]||null}function drt(e,t){var n=hrt(e,t);n&&n.valueHasMutated()}function frt(e){e.track=irt,e.getObservable=hrt,e.valueHasMutated=drt,e.defineProperty=rrt}var prt={attachToKo:frt};const mrt="http://www.w3.org/2000/svg",_rt="cesium-svgPath-svg",grt={register:function(e){e.bindingHandlers.cesiumSvgPath={init:function(t,n){const i=document.createElementNS(mrt,"svg:svg");i.setAttribute("class",_rt);const o=document.createElementNS(mrt,"path");return i.appendChild(o),e.virtualElements.setDomNodeChildren(t,[i]),e.computed({read:function(){const t=e.unwrap(n());o.setAttribute("d",e.unwrap(t.path));const r=e.unwrap(t.width),s=e.unwrap(t.height);i.setAttribute("width",r),i.setAttribute("height",s),i.setAttribute("viewBox",`0 0 ${r} ${s}`),t.css&&i.setAttribute("class",`${_rt} ${e.unwrap(t.css)}`)},disposeWhenNodeIsRemoved:t}),{controlsDescendantBindings:!0}}},e.virtualElements.allowedBindings.cesiumSvgPath=!0}};var yrt=grt;prt.attachToKo(ert),yrt.register(ert);var vrt=ert;var brt,Art,wrt,Trt,Crt,Ert,xrt,Srt;!function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"}(brt||(brt={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(Art||(Art={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(wrt||(wrt={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(Trt||(Trt={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(Crt||(Crt={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(Ert||(Ert={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(xrt||(xrt={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(Srt||(Srt={}));(0,on.c)((function(e){
/* Copyright 2015-2018 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */
(function(){var t=function(){var e={defaultNoDataValue:-34027999387901484e22,decode:function(r,s){s=s||{};var a=s.encodedMaskData||null===s.encodedMaskData,c=o(r,s.inputOffset||0,a),l=null!==s.noDataValue?s.noDataValue:e.defaultNoDataValue,u=t(c,s.pixelType||Float32Array,s.encodedMaskData,l,s.returnMask),h={width:c.width,height:c.height,pixelData:u.resultPixels,minValue:u.minValue,maxValue:c.pixels.maxValue,noDataValue:l};return u.resultMask&&(h.maskData=u.resultMask),s.returnEncodedMask&&c.mask&&(h.encodedMaskData=c.mask.bitset?c.mask.bitset:null),s.returnFileInfo&&(h.fileInfo=n(c),s.computeUsedBitDepths&&(h.fileInfo.bitDepths=i(c))),h}},t=function(e,t,n,i,o){var s,a,c,l=0,u=e.pixels.numBlocksX,h=e.pixels.numBlocksY,d=Math.floor(e.width/u),f=Math.floor(e.height/h),p=2*e.maxZError,m=Number.MAX_VALUE;n=n||(e.mask?e.mask.bitset:null),a=new t(e.width*e.height),o&&n&&(c=new Uint8Array(e.width*e.height));for(var _,g,y=new Float32Array(d*f),v=0;v<=h;v++){var b=v!==h?f:e.height%h;if(0!==b)for(var A=0;A<=u;A++){var w=A!==u?d:e.width%u;if(0!==w){var T,C,E,x,S=v*e.width*f+A*d,I=e.width-w,O=e.pixels.blocks[l];if(O.encoding<2?(0===O.encoding?T=O.rawData:(r(O.stuffedData,O.bitsPerPixel,O.numValidPixels,O.offset,p,y,e.pixels.maxValue),T=y),C=0):E=2===O.encoding?0:O.offset,n)for(g=0;g<b;g++){for(7&S&&(x=n[S>>3],x<<=7&S),_=0;_<w;_++)7&S||(x=n[S>>3]),128&x?(c&&(c[S]=1),s=O.encoding<2?T[C++]:E,m=m>s?s:m,a[S++]=s):(c&&(c[S]=0),a[S++]=i),x<<=1;S+=I}else if(O.encoding<2)for(g=0;g<b;g++){for(_=0;_<w;_++)s=T[C++],m=m>s?s:m,a[S++]=s;S+=I}else for(m=m>E?E:m,g=0;g<b;g++){for(_=0;_<w;_++)a[S++]=E;S+=I}if(1===O.encoding&&C!==O.numValidPixels)throw"Block and Mask do not match";l++}}}return{resultPixels:a,resultMask:c,minValue:m}},n=function(e){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,noDataValue:e.noDataValue}}},i=function(e){for(var t=e.pixels.numBlocksX*e.pixels.numBlocksY,n={},i=0;i<t;i++){var o=e.pixels.blocks[i];0===o.encoding?n.float32=!0:1===o.encoding?n[o.bitsPerPixel]=!0:n[0]=!0}return Object.keys(n)},o=function(e,t,n){var i={},o=new Uint8Array(e,t,10);if(i.fileIdentifierString=String.fromCharCode.apply(null,o),"CntZImage"!==i.fileIdentifierString.trim())throw"Unexpected file identifier string: "+i.fileIdentifierString;t+=10;var r=new DataView(e,t,24);if(i.fileVersion=r.getInt32(0,!0),i.imageType=r.getInt32(4,!0),i.height=r.getUint32(8,!0),i.width=r.getUint32(12,!0),i.maxZError=r.getFloat64(16,!0),t+=24,!n)if(r=new DataView(e,t,16),i.mask={},i.mask.numBlocksY=r.getUint32(0,!0),i.mask.numBlocksX=r.getUint32(4,!0),i.mask.numBytes=r.getUint32(8,!0),i.mask.maxValue=r.getFloat32(12,!0),t+=16,i.mask.numBytes>0){var s=new Uint8Array(Math.ceil(i.width*i.height/8));r=new DataView(e,t,i.mask.numBytes);var a=r.getInt16(0,!0),c=2,l=0;do{if(a>0)while(a--)s[l++]=r.getUint8(c++);else{var u=r.getUint8(c++);a=-a;while(a--)s[l++]=u}a=r.getInt16(c,!0),c+=2}while(c<i.mask.numBytes);if(-32768!==a||l<s.length)throw"Unexpected end of mask RLE encoding";i.mask.bitset=s,t+=i.mask.numBytes}else 0===(i.mask.numBytes|i.mask.numBlocksY|i.mask.maxValue)&&(i.mask.bitset=new Uint8Array(Math.ceil(i.width*i.height/8)));r=new DataView(e,t,16),i.pixels={},i.pixels.numBlocksY=r.getUint32(0,!0),i.pixels.numBlocksX=r.getUint32(4,!0),i.pixels.numBytes=r.getUint32(8,!0),i.pixels.maxValue=r.getFloat32(12,!0),t+=16;var h=i.pixels.numBlocksX,d=i.pixels.numBlocksY,f=h+(i.width%h>0?1:0),p=d+(i.height%d>0?1:0);i.pixels.blocks=new Array(f*p);for(var m=0,_=0;_<p;_++)for(var g=0;g<f;g++){var y=0,v=e.byteLength-t;r=new DataView(e,t,Math.min(10,v));var b={};i.pixels.blocks[m++]=b;var A=r.getUint8(0);if(y++,b.encoding=63&A,b.encoding>3)throw"Invalid block encoding ("+b.encoding+")";if(2!==b.encoding){if(0!==A&&2!==A){if(A>>=6,b.offsetType=A,2===A)b.offset=r.getInt8(1),y++;else if(1===A)b.offset=r.getInt16(1,!0),y+=2;else{if(0!==A)throw"Invalid block offset type";b.offset=r.getFloat32(1,!0),y+=4}if(1===b.encoding)if(A=r.getUint8(y),y++,b.bitsPerPixel=63&A,A>>=6,b.numValidPixelsType=A,2===A)b.numValidPixels=r.getUint8(y),y++;else if(1===A)b.numValidPixels=r.getUint16(y,!0),y+=2;else{if(0!==A)throw"Invalid valid pixel count type";b.numValidPixels=r.getUint32(y,!0),y+=4}}var w,T;if(t+=y,3!==b.encoding)if(0===b.encoding){var C=(i.pixels.numBytes-1)/4;if(C!==Math.floor(C))throw"uncompressed block has invalid length";w=new ArrayBuffer(4*C),T=new Uint8Array(w),T.set(new Uint8Array(e,t,4*C));var E=new Float32Array(w);b.rawData=E,t+=4*C}else if(1===b.encoding){var x=Math.ceil(b.numValidPixels*b.bitsPerPixel/8),S=Math.ceil(x/4);w=new ArrayBuffer(4*S),T=new Uint8Array(w),T.set(new Uint8Array(e,t,x)),b.stuffedData=new Uint32Array(w),t+=x}}else t++}return i.eofOffset=t,i},r=function(e,t,n,i,o,r,s){var a,c,l,u=(1<<t)-1,h=0,d=0,f=Math.ceil((s-i)/o),p=4*e.length-Math.ceil(t*n/8);for(e[e.length-1]<<=8*p,a=0;a<n;a++){if(0===d&&(l=e[h++],d=32),d>=t)c=l>>>d-t&u,d-=t;else{var m=t-d;c=(l&u)<<m&u,l=e[h++],d=32-m,c+=l>>>d}r[a]=c<f?i+c*o:s}return r};return e}(),n=function(){var e={unstuff:function(e,t,n,i,o,r,s,a){var c,l,u,h,d,f=(1<<n)-1,p=0,m=0,_=4*e.length-Math.ceil(n*i/8);if(e[e.length-1]<<=8*_,o)for(c=0;c<i;c++)0===m&&(u=e[p++],m=32),m>=n?(l=u>>>m-n&f,m-=n):(h=n-m,l=(u&f)<<h&f,u=e[p++],m=32-h,l+=u>>>m),t[c]=o[l];else for(d=Math.ceil((a-r)/s),c=0;c<i;c++)0===m&&(u=e[p++],m=32),m>=n?(l=u>>>m-n&f,m-=n):(h=n-m,l=(u&f)<<h&f,u=e[p++],m=32-h,l+=u>>>m),t[c]=l<d?r+l*s:a},unstuffLUT:function(e,t,n,i,o,r){var s,a=(1<<t)-1,c=0,l=0,u=0,h=0,d=0,f=[],p=4*e.length-Math.ceil(t*n/8);e[e.length-1]<<=8*p;var m=Math.ceil((r-i)/o);for(l=0;l<n;l++)0===h&&(s=e[c++],h=32),h>=t?(d=s>>>h-t&a,h-=t):(u=t-h,d=(s&a)<<u&a,s=e[c++],h=32-u,d+=s>>>h),f[l]=d<m?i+d*o:r;return f.unshift(i),f},unstuff2:function(e,t,n,i,o,r,s,a){var c,l,u,h,d=(1<<n)-1,f=0,p=0,m=0;if(o)for(c=0;c<i;c++)0===p&&(u=e[f++],p=32,m=0),p>=n?(l=u>>>m&d,p-=n,m+=n):(h=n-p,l=u>>>m&d,u=e[f++],p=32-h,l|=(u&(1<<h)-1)<<n-h,m=h),t[c]=o[l];else{var _=Math.ceil((a-r)/s);for(c=0;c<i;c++)0===p&&(u=e[f++],p=32,m=0),p>=n?(l=u>>>m&d,p-=n,m+=n):(h=n-p,l=u>>>m&d,u=e[f++],p=32-h,l|=(u&(1<<h)-1)<<n-h,m=h),t[c]=l<_?r+l*s:a}return t},unstuffLUT2:function(e,t,n,i,o,r){var s,a=(1<<t)-1,c=0,l=0,u=0,h=0,d=0,f=0,p=[],m=Math.ceil((r-i)/o);for(l=0;l<n;l++)0===h&&(s=e[c++],h=32,f=0),h>=t?(d=s>>>f&a,h-=t,f+=t):(u=t-h,d=s>>>f&a,s=e[c++],h=32-u,d|=(s&(1<<u)-1)<<t-u,f=u),p[l]=d<m?i+d*o:r;return p.unshift(i),p},originalUnstuff:function(e,t,n,i){var o,r,s,a,c=(1<<n)-1,l=0,u=0,h=4*e.length-Math.ceil(n*i/8);for(e[e.length-1]<<=8*h,o=0;o<i;o++)0===u&&(s=e[l++],u=32),u>=n?(r=s>>>u-n&c,u-=n):(a=n-u,r=(s&c)<<a&c,s=e[l++],u=32-a,r+=s>>>u),t[o]=r;return t},originalUnstuff2:function(e,t,n,i){var o,r,s,a,c=(1<<n)-1,l=0,u=0,h=0;for(o=0;o<i;o++)0===u&&(s=e[l++],u=32,h=0),u>=n?(r=s>>>h&c,u-=n,h+=n):(a=n-u,r=s>>>h&c,s=e[l++],u=32-a,r|=(s&(1<<a)-1)<<n-a,h=a),t[o]=r;return t}},t={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(e){var t=65535,n=65535,i=e.length,o=Math.floor(i/2),r=0;while(o){var s=o>=359?359:o;o-=s;do{t+=e[r++]<<8,n+=t+=e[r++]}while(--s);t=(65535&t)+(t>>>16),n=(65535&n)+(n>>>16)}return 1&i&&(n+=t+=e[r]<<8),t=(65535&t)+(t>>>16),n=(65535&n)+(n>>>16),(n<<16|t)>>>0},readHeaderInfo:function(e,t){var n=t.ptr,i=new Uint8Array(e,n,6),o={};if(o.fileIdentifierString=String.fromCharCode.apply(null,i),0!==o.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+o.fileIdentifierString;n+=6;var r,s,a=new DataView(e,n,8),c=a.getInt32(0,!0);if(o.fileVersion=c,n+=4,c>=3&&(o.checksum=a.getUint32(4,!0),n+=4),a=new DataView(e,n,12),o.height=a.getUint32(0,!0),o.width=a.getUint32(4,!0),n+=8,c>=4?(o.numDims=a.getUint32(8,!0),n+=4):o.numDims=1,a=new DataView(e,n,40),o.numValidPixel=a.getUint32(0,!0),o.microBlockSize=a.getInt32(4,!0),o.blobSize=a.getInt32(8,!0),o.imageType=a.getInt32(12,!0),o.maxZError=a.getFloat64(16,!0),o.zMin=a.getFloat64(24,!0),o.zMax=a.getFloat64(32,!0),n+=40,t.headerInfo=o,t.ptr=n,c>=3&&(s=c>=4?52:48,r=this.computeChecksumFletcher32(new Uint8Array(e,n-s,o.blobSize-14)),r!==o.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(e,t){var n=t.headerInfo,i=this.getDataTypeArray(n.imageType),o=n.numDims*this.getDataTypeSize(n.imageType),r=this.readSubArray(e,t.ptr,i,o),s=this.readSubArray(e,t.ptr+o,i,o);t.ptr+=2*o;var a,c=!0;for(a=0;a<n.numDims;a++)if(r[a]!==s[a]){c=!1;break}return n.minValues=r,n.maxValues=s,c},readSubArray:function(e,t,n,i){var o;if(n===Uint8Array)o=new Uint8Array(e,t,i);else{var r=new ArrayBuffer(i),s=new Uint8Array(r);s.set(new Uint8Array(e,t,i)),o=new n(r)}return o},readMask:function(e,t){var n,i,o=t.ptr,r=t.headerInfo,s=r.width*r.height,a=r.numValidPixel,c=new DataView(e,o,4),l={};if(l.numBytes=c.getUint32(0,!0),o+=4,(0===a||s===a)&&0!==l.numBytes)throw"invalid mask";if(0===a)n=new Uint8Array(Math.ceil(s/8)),l.bitset=n,i=new Uint8Array(s),t.pixels.resultMask=i,o+=l.numBytes;else if(l.numBytes>0){n=new Uint8Array(Math.ceil(s/8)),c=new DataView(e,o,l.numBytes);var u=c.getInt16(0,!0),h=2,d=0,f=0;do{if(u>0)while(u--)n[d++]=c.getUint8(h++);else{f=c.getUint8(h++),u=-u;while(u--)n[d++]=f}u=c.getInt16(h,!0),h+=2}while(h<l.numBytes);if(-32768!==u||d<n.length)throw"Unexpected end of mask RLE encoding";i=new Uint8Array(s);var p=0,m=0;for(m=0;m<s;m++)7&m?(p=n[m>>3],p<<=7&m):p=n[m>>3],128&p&&(i[m]=1);t.pixels.resultMask=i,l.bitset=n,o+=l.numBytes}return t.ptr=o,t.mask=l,!0},readDataOneSweep:function(e,n,i){var o,r=n.ptr,s=n.headerInfo,a=s.numDims,c=s.width*s.height,l=s.imageType,u=s.numValidPixel*t.getDataTypeSize(l)*a,h=n.pixels.resultMask;if(i===Uint8Array)o=new Uint8Array(e,r,u);else{var d=new ArrayBuffer(u),f=new Uint8Array(d);f.set(new Uint8Array(e,r,u)),o=new i(d)}if(o.length===c*a)n.pixels.resultPixels=o;else{n.pixels.resultPixels=new i(c*a);var p=0,m=0,_=0,g=0;if(a>1)for(_=0;_<a;_++)for(g=_*c,m=0;m<c;m++)h[m]&&(n.pixels.resultPixels[g+m]=o[p++]);else for(m=0;m<c;m++)h[m]&&(n.pixels.resultPixels[m]=o[p++])}return r+=u,n.ptr=r,!0},readHuffmanTree:function(e,i){var o=this.HUFFMAN_LUT_BITS_MAX,r=new DataView(e,i.ptr,16);i.ptr+=16;var s=r.getInt32(0,!0);if(s<2)throw"unsupported Huffman version";var a=r.getInt32(4,!0),c=r.getInt32(8,!0),l=r.getInt32(12,!0);if(c>=l)return!1;var u=new Uint32Array(l-c);t.decodeBits(e,i,u);var h,d,f,p,m=[];for(h=c;h<l;h++)d=h-(h<a?0:a),m[d]={first:u[h-c],second:null};var _=e.byteLength-i.ptr,g=Math.ceil(_/4),y=new ArrayBuffer(4*g),v=new Uint8Array(y);v.set(new Uint8Array(e,i.ptr,_));var b,A=new Uint32Array(y),w=0,T=0;for(b=A[0],h=c;h<l;h++)d=h-(h<a?0:a),p=m[d].first,p>0&&(m[d].second=b<<w>>>32-p,32-w>=p?(w+=p,32===w&&(w=0,T++,b=A[T])):(w+=p-32,T++,b=A[T],m[d].second|=b>>>32-w));var C=0,E=0,x=new n;for(h=0;h<m.length;h++)void 0!==m[h]&&(C=Math.max(C,m[h].first));E=C>=o?o:C,C>=30&&console.log("WARning, large NUM LUT BITS IS "+C);var S,I,O,D,P,R,L=[];for(h=c;h<l;h++)if(d=h-(h<a?0:a),p=m[d].first,p>0)if(S=[p,d],p<=E)for(I=m[d].second<<E-p,O=1<<E-p,f=0;f<O;f++)L[I|f]=S;else for(I=m[d].second,R=x,D=p-1;D>=0;D--)P=I>>>D&1,P?(R.right||(R.right=new n),R=R.right):(R.left||(R.left=new n),R=R.left),0!==D||R.val||(R.val=S[1]);return{decodeLut:L,numBitsLUTQick:E,numBitsLUT:C,tree:x,stuffedData:A,srcPtr:T,bitPos:w}},readHuffman:function(e,t,n){var i,o,r,s,a,c,l,u,h,d,f=t.headerInfo,p=f.numDims,m=t.headerInfo.height,_=t.headerInfo.width,g=_*m,y=this.readHuffmanTree(e,t),v=y.decodeLut,b=y.tree,A=y.stuffedData,w=y.srcPtr,T=y.bitPos,C=y.numBitsLUTQick,E=y.numBitsLUT,x=0===t.headerInfo.imageType?128:0,S=t.pixels.resultMask,I=0;T>0&&(w++,T=0);var O,D=A[w],P=1===t.encodeMode,R=new n(g*p),L=R;for(O=0;O<f.numDims;O++){if(p>1&&(L=new n(R.buffer,g*O,g),I=0),t.headerInfo.numValidPixel===_*m)for(h=0,l=0;l<m;l++)for(u=0;u<_;u++,h++){if(o=0,s=D<<T>>>32-C,a=s,32-T<C&&(s|=A[w+1]>>>64-T-C,a=s),v[a])o=v[a][1],T+=v[a][0];else for(s=D<<T>>>32-E,a=s,32-T<E&&(s|=A[w+1]>>>64-T-E,a=s),i=b,d=0;d<E;d++)if(c=s>>>E-d-1&1,i=c?i.right:i.left,!i.left&&!i.right){o=i.val,T=T+d+1;break}T>=32&&(T-=32,w++,D=A[w]),r=o-x,P?(r+=u>0?I:l>0?L[h-_]:I,r&=255,L[h]=r,I=r):L[h]=r}else for(h=0,l=0;l<m;l++)for(u=0;u<_;u++,h++)if(S[h]){if(o=0,s=D<<T>>>32-C,a=s,32-T<C&&(s|=A[w+1]>>>64-T-C,a=s),v[a])o=v[a][1],T+=v[a][0];else for(s=D<<T>>>32-E,a=s,32-T<E&&(s|=A[w+1]>>>64-T-E,a=s),i=b,d=0;d<E;d++)if(c=s>>>E-d-1&1,i=c?i.right:i.left,!i.left&&!i.right){o=i.val,T=T+d+1;break}T>=32&&(T-=32,w++,D=A[w]),r=o-x,P?(u>0&&S[h-1]?r+=I:l>0&&S[h-_]?r+=L[h-_]:r+=I,r&=255,L[h]=r,I=r):L[h]=r}t.ptr=t.ptr+4*(w+1)+(T>0?4:0)}t.pixels.resultPixels=R},decodeBits:function(t,n,i,o,r){var s=n.headerInfo,a=s.fileVersion,c=0,l=new DataView(t,n.ptr,5),u=l.getUint8(0);c++;var h=u>>6,d=0===h?4:3-h,f=(32&u)>0,p=31&u,m=0;if(1===d)m=l.getUint8(c),c++;else if(2===d)m=l.getUint16(c,!0),c+=2;else{if(4!==d)throw"Invalid valid pixel count type";m=l.getUint32(c,!0),c+=4}var _,g,y,v,b,A,w,T,C,E=2*s.maxZError,x=s.numDims>1?s.maxValues[r]:s.zMax;if(f){n.counter.lut++,T=l.getUint8(c),c++,v=Math.ceil((T-1)*p/8),b=Math.ceil(v/4),g=new ArrayBuffer(4*b),y=new Uint8Array(g),n.ptr+=c,y.set(new Uint8Array(t,n.ptr,v)),w=new Uint32Array(g),n.ptr+=v,C=0;while(T-1>>>C)C++;v=Math.ceil(m*C/8),b=Math.ceil(v/4),g=new ArrayBuffer(4*b),y=new Uint8Array(g),y.set(new Uint8Array(t,n.ptr,v)),_=new Uint32Array(g),n.ptr+=v,A=a>=3?e.unstuffLUT2(w,p,T-1,o,E,x):e.unstuffLUT(w,p,T-1,o,E,x),a>=3?e.unstuff2(_,i,C,m,A):e.unstuff(_,i,C,m,A)}else n.counter.bitstuffer++,C=p,n.ptr+=c,C>0&&(v=Math.ceil(m*C/8),b=Math.ceil(v/4),g=new ArrayBuffer(4*b),y=new Uint8Array(g),y.set(new Uint8Array(t,n.ptr,v)),_=new Uint32Array(g),n.ptr+=v,a>=3?null==o?e.originalUnstuff2(_,i,C,m):e.unstuff2(_,i,C,m,!1,o,E,x):null==o?e.originalUnstuff(_,i,C,m):e.unstuff(_,i,C,m,!1,o,E,x))},readTiles:function(e,n,i){var o=n.headerInfo,r=o.width,s=o.height,a=o.microBlockSize,c=o.imageType,l=t.getDataTypeSize(c),u=Math.ceil(r/a),h=Math.ceil(s/a);n.pixels.numBlocksY=h,n.pixels.numBlocksX=u,n.pixels.ptr=0;var d,f,p,m,_,g,y,v,b,A=0,w=0,T=0,C=0,E=0,x=0,S=0,I=0,O=0,D=0,P=0,R=0,L=0,M=0,B=0,N=0,F=new i(a*a),z=s%a||a,k=r%a||a,U=o.numDims,V=n.pixels.resultMask,H=n.pixels.resultPixels;for(T=0;T<h;T++)for(E=T!==h-1?a:z,C=0;C<u;C++)for(x=C!==u-1?a:k,P=T*r*a+C*a,R=r-x,b=0;b<U;b++){if(U>1&&(H=new i(n.pixels.resultPixels.buffer,r*s*b*l,r*s)),S=e.byteLength-n.ptr,d=new DataView(e,n.ptr,Math.min(10,S)),f={},N=0,I=d.getUint8(0),N++,O=I>>6&255,D=I>>2&15,D!==(C*a>>3&15))throw"integrity issue";if(g=3&I,g>3)throw n.ptr+=N,"Invalid block encoding ("+g+")";if(2!==g)if(0===g){if(n.counter.uncompressed++,n.ptr+=N,L=E*x*l,M=e.byteLength-n.ptr,L=L<M?L:M,p=new ArrayBuffer(L%l===0?L:L+l-L%l),m=new Uint8Array(p),m.set(new Uint8Array(e,n.ptr,L)),_=new i(p),B=0,V)for(A=0;A<E;A++){for(w=0;w<x;w++)V[P]&&(H[P]=_[B++]),P++;P+=R}else for(A=0;A<E;A++){for(w=0;w<x;w++)H[P++]=_[B++];P+=R}n.ptr+=B*l}else if(y=t.getDataTypeUsed(c,O),v=t.getOnePixel(f,N,y,d),N+=t.getDataTypeSize(y),3===g)if(n.ptr+=N,n.counter.constantoffset++,V)for(A=0;A<E;A++){for(w=0;w<x;w++)V[P]&&(H[P]=v),P++;P+=R}else for(A=0;A<E;A++){for(w=0;w<x;w++)H[P++]=v;P+=R}else if(n.ptr+=N,t.decodeBits(e,n,F,v,b),N=0,V)for(A=0;A<E;A++){for(w=0;w<x;w++)V[P]&&(H[P]=F[N++]),P++;P+=R}else for(A=0;A<E;A++){for(w=0;w<x;w++)H[P++]=F[N++];P+=R}else n.counter.constant++,n.ptr+=N}},formatFileInfo:function(e){return{fileIdentifierString:e.headerInfo.fileIdentifierString,fileVersion:e.headerInfo.fileVersion,imageType:e.headerInfo.imageType,height:e.headerInfo.height,width:e.headerInfo.width,numValidPixel:e.headerInfo.numValidPixel,microBlockSize:e.headerInfo.microBlockSize,blobSize:e.headerInfo.blobSize,maxZError:e.headerInfo.maxZError,pixelType:t.getPixelType(e.headerInfo.imageType),eofOffset:e.eofOffset,mask:e.mask?{numBytes:e.mask.numBytes}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,maxValue:e.headerInfo.zMax,minValue:e.headerInfo.zMin,noDataValue:e.noDataValue}}},constructConstantSurface:function(e){var t=e.headerInfo.zMax,n=e.headerInfo.numDims,i=e.headerInfo.height*e.headerInfo.width,o=i*n,r=0,s=0,a=0,c=e.pixels.resultMask;if(c)if(n>1)for(r=0;r<n;r++)for(a=r*i,s=0;s<i;s++)c[s]&&(e.pixels.resultPixels[a+s]=t);else for(s=0;s<i;s++)c[s]&&(e.pixels.resultPixels[s]=t);else if(e.pixels.resultPixels.fill)e.pixels.resultPixels.fill(t);else for(s=0;s<o;s++)e.pixels.resultPixels[s]=t},getDataTypeArray:function(e){var t;switch(e){case 0:t=Int8Array;break;case 1:t=Uint8Array;break;case 2:t=Int16Array;break;case 3:t=Uint16Array;break;case 4:t=Int32Array;break;case 5:t=Uint32Array;break;case 6:t=Float32Array;break;case 7:t=Float64Array;break;default:t=Float32Array}return t},getPixelType:function(e){var t;switch(e){case 0:t="S8";break;case 1:t="U8";break;case 2:t="S16";break;case 3:t="U16";break;case 4:t="S32";break;case 5:t="U32";break;case 6:t="F32";break;case 7:t="F64";break;default:t="F32"}return t},isValidPixelValue:function(e,t){if(null==t)return!1;var n;switch(e){case 0:n=t>=-128&&t<=127;break;case 1:n=t>=0&&t<=255;break;case 2:n=t>=-32768&&t<=32767;break;case 3:n=t>=0&&t<=65536;break;case 4:n=t>=-2147483648&&t<=2147483647;break;case 5:n=t>=0&&t<=4294967296;break;case 6:n=t>=-34027999387901484e22&&t<=34027999387901484e22;break;case 7:n=t>=5e-324&&t<=17976931348623157e292;break;default:n=!1}return n},getDataTypeSize:function(e){var t=0;switch(e){case 0:case 1:t=1;break;case 2:case 3:t=2;break;case 4:case 5:case 6:t=4;break;case 7:t=8;break;default:t=e}return t},getDataTypeUsed:function(e,t){var n=e;switch(e){case 2:case 4:n=e-t;break;case 3:case 5:n=e-2*t;break;case 6:n=0===t?e:1===t?2:1;break;case 7:n=0===t?e:e-2*t+1;break;default:n=e;break}return n},getOnePixel:function(e,t,n,i){var o=0;switch(n){case 0:o=i.getInt8(t);break;case 1:o=i.getUint8(t);break;case 2:o=i.getInt16(t,!0);break;case 3:o=i.getUint16(t,!0);break;case 4:o=i.getInt32(t,!0);break;case 5:o=i.getUInt32(t,!0);break;case 6:o=i.getFloat32(t,!0);break;case 7:o=i.getFloat64(t,!0);break;default:throw"the decoder does not understand this pixel type"}return o}},n=function(e,t,n){this.val=e,this.left=t,this.right=n},i={decode:function(e,n){n=n||{};var i=n.noDataValue,o=0,r={};r.ptr=n.inputOffset||0,r.pixels={},t.readHeaderInfo(e,r);var s=r.headerInfo,a=s.fileVersion,c=t.getDataTypeArray(s.imageType);t.readMask(e,r),s.numValidPixel===s.width*s.height||r.pixels.resultMask||(r.pixels.resultMask=n.maskData);var l,u=s.width*s.height;if(r.pixels.resultPixels=new c(u*s.numDims),r.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},0!==s.numValidPixel)if(s.zMax===s.zMin)t.constructConstantSurface(r);else if(a>=4&&t.checkMinMaxRanges(e,r))t.constructConstantSurface(r);else{var h=new DataView(e,r.ptr,2),d=h.getUint8(0);if(r.ptr++,d)t.readDataOneSweep(e,r,c);else if(a>1&&s.imageType<=1&&Math.abs(s.maxZError-.5)<1e-5){var f=h.getUint8(1);if(r.ptr++,r.encodeMode=f,f>2||a<4&&f>1)throw"Invalid Huffman flag "+f;f?t.readHuffman(e,r,c):t.readTiles(e,r,c)}else t.readTiles(e,r,c)}r.eofOffset=r.ptr,n.inputOffset?(l=r.headerInfo.blobSize+n.inputOffset-r.ptr,Math.abs(l)>=1&&(r.eofOffset=n.inputOffset+r.headerInfo.blobSize)):(l=r.headerInfo.blobSize-r.ptr,Math.abs(l)>=1&&(r.eofOffset=r.headerInfo.blobSize));var p={width:s.width,height:s.height,pixelData:r.pixels.resultPixels,minValue:s.zMin,maxValue:s.zMax,validPixelCount:s.numValidPixel,dimCount:s.numDims,dimStats:{minValues:s.minValues,maxValues:s.maxValues},maskData:r.pixels.resultMask};if(r.pixels.resultMask&&t.isValidPixelValue(s.imageType,i)){var m=r.pixels.resultMask;for(o=0;o<u;o++)m[o]||(p.pixelData[o]=i);p.noDataValue=i}return r.noDataValue=i,n.returnFileInfo&&(p.fileInfo=t.formatFileInfo(r)),p},getBandCount:function(e){var n=0,i=0,o={ptr:0,pixels:{}};while(i<e.byteLength-58)t.readHeaderInfo(e,o),i+=o.headerInfo.blobSize,n++,o.ptr=i;return n}};return i}(),i=function(){var e=new ArrayBuffer(4),t=new Uint8Array(e),n=new Uint32Array(e);return n[0]=1,1===t[0]}(),o={decode:function(e,o){if(!i)throw"Big endian system is not supported.";o=o||{};var r,s,a=o.inputOffset||0,c=new Uint8Array(e,a,10),l=String.fromCharCode.apply(null,c);if("CntZImage"===l.trim())r=t,s=1;else{if("Lerc2"!==l.substring(0,5))throw"Unexpected file identifier string: "+l;r=n,s=2}var u,h,d,f,p,m,_=0,g=e.byteLength-10,y=[],v={width:0,height:0,pixels:[],pixelType:o.pixelType,mask:null,statistics:[]};while(a<g){var b=r.decode(e,{inputOffset:a,encodedMaskData:u,maskData:d,returnMask:0===_,returnEncodedMask:0===_,returnFileInfo:!0,pixelType:o.pixelType||null,noDataValue:o.noDataValue||null});a=b.fileInfo.eofOffset,0===_&&(u=b.encodedMaskData,d=b.maskData,v.width=b.width,v.height=b.height,v.dimCount=b.dimCount||1,v.pixelType=b.pixelType||b.fileInfo.pixelType,v.mask=b.maskData),s>1&&b.fileInfo.mask&&b.fileInfo.mask.numBytes>0&&y.push(b.maskData),_++,v.pixels.push(b.pixelData),v.statistics.push({minValue:b.minValue,maxValue:b.maxValue,noDataValue:b.noDataValue,dimStats:b.dimStats})}if(s>1&&y.length>1){for(m=v.width*v.height,v.bandMasks=y,d=new Uint8Array(m),d.set(y[0]),f=1;f<y.length;f++)for(h=y[f],p=0;p<m;p++)d[p]=d[p]&h[p];v.maskData=d}return v}};e.exports?e.exports=o:this.Lerc=o})()}));var Irt={webm:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",mp4:"data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="};const{webm:Ort,mp4:Drt}=Irt,Prt="undefined"!==typeof navigator&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream;class Rrt{constructor(){Prt?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("muted",""),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",Ort),this._addSourceToVideo(this.noSleepVideo,"mp4",Drt),this.noSleepVideo.addEventListener("loadedmetadata",(()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",(()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}))})))}_addSourceToVideo(e,t,n){var i=document.createElement("source");i.src=n,i.type=`video/${t}`,e.appendChild(i)}enable(){Prt?(this.disable(),console.warn("\n        NoSleep enabled for older iOS devices. This can interrupt\n        active or long-running network requests from completing successfully.\n        See https://github.com/richtr/NoSleep.js/issues/15 for more details.\n      "),this.noSleepTimer=window.setInterval((()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))}),15e3)):this.noSleepVideo.play()}disable(){Prt?this.noSleepTimer&&(console.warn("\n          NoSleep now disabled for older iOS devices.\n        "),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}var Lrt=Rrt,Mrt=(0,on.c)((function(e,t){var n="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){var t=Array.prototype.slice.call(arguments,1);while(t.length){var n=t.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(var o in n)i(n,o)&&(e[o]=n[o])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,n,i,o){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),o);else for(var r=0;r<i;r++)e[o+r]=t[n+r]},flattenChunks:function(e){var t,n,i,o,r,s;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(s=new Uint8Array(i),o=0,t=0,n=e.length;t<n;t++)r=e[t],s.set(r,o),o+=r.length;return s}},r={arraySet:function(e,t,n,i,o){for(var r=0;r<i;r++)e[o+r]=t[n+r]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,o)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,r))},t.setTyped(n)}));function Brt(e,t,n,i){var o=65535&e|0,r=e>>>16&65535|0,s=0;while(0!==n){s=n>2e3?2e3:n,n-=s;do{o=o+t[i++]|0,r=r+o|0}while(--s);o%=65521,r%=65521}return o|r<<16|0}var Nrt=Brt;function Frt(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}var zrt=Frt();function krt(e,t,n,i){var o=zrt,r=i+n;e^=-1;for(var s=i;s<r;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}var Urt=krt,Vrt=30,Hrt=12,Grt=function(e,t){var n,i,o,r,s,a,c,l,u,h,d,f,p,m,_,g,y,v,b,A,w,T,C,E,x;n=e.state,i=e.next_in,E=e.input,o=i+(e.avail_in-5),r=e.next_out,x=e.output,s=r-(t-e.avail_out),a=r+(e.avail_out-257),c=n.dmax,l=n.wsize,u=n.whave,h=n.wnext,d=n.window,f=n.hold,p=n.bits,m=n.lencode,_=n.distcode,g=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(f+=E[i++]<<p,p+=8,f+=E[i++]<<p,p+=8),v=m[f&g];t:for(;;){if(b=v>>>24,f>>>=b,p-=b,b=v>>>16&255,0===b)x[r++]=65535&v;else{if(!(16&b)){if(0===(64&b)){v=m[(65535&v)+(f&(1<<b)-1)];continue t}if(32&b){n.mode=Hrt;break e}e.msg="invalid literal/length code",n.mode=Vrt;break e}A=65535&v,b&=15,b&&(p<b&&(f+=E[i++]<<p,p+=8),A+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=E[i++]<<p,p+=8,f+=E[i++]<<p,p+=8),v=_[f&y];n:for(;;){if(b=v>>>24,f>>>=b,p-=b,b=v>>>16&255,!(16&b)){if(0===(64&b)){v=_[(65535&v)+(f&(1<<b)-1)];continue n}e.msg="invalid distance code",n.mode=Vrt;break e}if(w=65535&v,b&=15,p<b&&(f+=E[i++]<<p,p+=8,p<b&&(f+=E[i++]<<p,p+=8)),w+=f&(1<<b)-1,w>c){e.msg="invalid distance too far back",n.mode=Vrt;break e}if(f>>>=b,p-=b,b=r-s,w>b){if(b=w-b,b>u&&n.sane){e.msg="invalid distance too far back",n.mode=Vrt;break e}if(T=0,C=d,0===h){if(T+=l-b,b<A){A-=b;do{x[r++]=d[T++]}while(--b);T=r-w,C=x}}else if(h<b){if(T+=l+h-b,b-=h,b<A){A-=b;do{x[r++]=d[T++]}while(--b);if(T=0,h<A){b=h,A-=b;do{x[r++]=d[T++]}while(--b);T=r-w,C=x}}}else if(T+=h-b,b<A){A-=b;do{x[r++]=d[T++]}while(--b);T=r-w,C=x}while(A>2)x[r++]=C[T++],x[r++]=C[T++],x[r++]=C[T++],A-=3;A&&(x[r++]=C[T++],A>1&&(x[r++]=C[T++]))}else{T=r-w;do{x[r++]=x[T++],x[r++]=x[T++],x[r++]=x[T++],A-=3}while(A>2);A&&(x[r++]=x[T++],A>1&&(x[r++]=x[T++]))}break}}break}}while(i<o&&r<a);A=p>>3,i-=A,p-=A<<3,f&=(1<<p)-1,e.next_in=i,e.next_out=r,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=r<a?a-r+257:257-(r-a),n.hold=f,n.bits=p},Wrt=15,qrt=852,jrt=592,Yrt=0,Krt=1,Xrt=2,Qrt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Jrt=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Zrt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],$rt=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],est=function(e,t,n,i,o,r,s,a){var c,l,u,h,d,f,p,m,_,g=a.bits,y=0,v=0,b=0,A=0,w=0,T=0,C=0,E=0,x=0,S=0,I=null,O=0,D=new Mrt.Buf16(Wrt+1),P=new Mrt.Buf16(Wrt+1),R=null,L=0;for(y=0;y<=Wrt;y++)D[y]=0;for(v=0;v<i;v++)D[t[n+v]]++;for(w=g,A=Wrt;A>=1;A--)if(0!==D[A])break;if(w>A&&(w=A),0===A)return o[r++]=20971520,o[r++]=20971520,a.bits=1,0;for(b=1;b<A;b++)if(0!==D[b])break;for(w<b&&(w=b),E=1,y=1;y<=Wrt;y++)if(E<<=1,E-=D[y],E<0)return-1;if(E>0&&(e===Yrt||1!==A))return-1;for(P[1]=0,y=1;y<Wrt;y++)P[y+1]=P[y]+D[y];for(v=0;v<i;v++)0!==t[n+v]&&(s[P[t[n+v]]++]=v);if(e===Yrt?(I=R=s,f=19):e===Krt?(I=Qrt,O-=257,R=Jrt,L-=257,f=256):(I=Zrt,R=$rt,f=-1),S=0,v=0,y=b,d=r,T=w,C=0,u=-1,x=1<<w,h=x-1,e===Krt&&x>qrt||e===Xrt&&x>jrt)return 1;for(;;){p=y-C,s[v]<f?(m=0,_=s[v]):s[v]>f?(m=R[L+s[v]],_=I[O+s[v]]):(m=96,_=0),c=1<<y-C,l=1<<T,b=l;do{l-=c,o[d+(S>>C)+l]=p<<24|m<<16|_|0}while(0!==l);c=1<<y-1;while(S&c)c>>=1;if(0!==c?(S&=c-1,S+=c):S=0,v++,0===--D[y]){if(y===A)break;y=t[n+s[v]]}if(y>w&&(S&h)!==u){0===C&&(C=w),d+=b,T=y-C,E=1<<T;while(T+C<A){if(E-=D[T+C],E<=0)break;T++,E<<=1}if(x+=1<<T,e===Krt&&x>qrt||e===Xrt&&x>jrt)return 1;u=S&h,o[u]=w<<24|T<<16|d-r|0}}return 0!==S&&(o[d+S]=y-C<<24|64<<16|0),a.bits=w,0},tst=0,nst=1,ist=2,ost=4,rst=5,sst=6,ast=0,cst=1,lst=2,ust=-2,hst=-3,dst=-4,fst=-5,pst=8,mst=1,_st=2,gst=3,yst=4,vst=5,bst=6,Ast=7,wst=8,Tst=9,Cst=10,Est=11,xst=12,Sst=13,Ist=14,Ost=15,Dst=16,Pst=17,Rst=18,Lst=19,Mst=20,Bst=21,Nst=22,Fst=23,zst=24,kst=25,Ust=26,Vst=27,Hst=28,Gst=29,Wst=30,qst=31,jst=32,Yst=852,Kst=592,Xst=15,Qst=Xst;function Jst(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function Zst(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Mrt.Buf16(320),this.work=new Mrt.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function $st(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=mst,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Mrt.Buf32(Yst),t.distcode=t.distdyn=new Mrt.Buf32(Kst),t.sane=1,t.back=-1,ast):ust}function eat(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,$st(e)):ust}function tat(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ust:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,eat(e))):ust}function nat(e,t){var n,i;return e?(i=new Zst,e.state=i,i.window=null,n=tat(e,t),n!==ast&&(e.state=null),n):ust}function iat(e){return nat(e,Qst)}var oat,rat,sat=!0;function aat(e){if(sat){var t;oat=new Mrt.Buf32(512),rat=new Mrt.Buf32(32),t=0;while(t<144)e.lens[t++]=8;while(t<256)e.lens[t++]=9;while(t<280)e.lens[t++]=7;while(t<288)e.lens[t++]=8;est(nst,e.lens,0,288,oat,0,e.work,{bits:9}),t=0;while(t<32)e.lens[t++]=5;est(ist,e.lens,0,32,rat,0,e.work,{bits:5}),sat=!1}e.lencode=oat,e.lenbits=9,e.distcode=rat,e.distbits=5}function cat(e,t,n,i){var o,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Mrt.Buf8(r.wsize)),i>=r.wsize?(Mrt.arraySet(r.window,t,n-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):(o=r.wsize-r.wnext,o>i&&(o=i),Mrt.arraySet(r.window,t,n-i,o,r.wnext),i-=o,i?(Mrt.arraySet(r.window,t,n-i,i,0),r.wnext=i,r.whave=r.wsize):(r.wnext+=o,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=o))),0}function lat(e,t){var n,i,o,r,s,a,c,l,u,h,d,f,p,m,_,g,y,v,b,A,w,T,C,E,x=0,S=new Mrt.Buf8(4),I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return ust;n=e.state,n.mode===xst&&(n.mode=Sst),s=e.next_out,o=e.output,c=e.avail_out,r=e.next_in,i=e.input,a=e.avail_in,l=n.hold,u=n.bits,h=a,d=c,T=ast;e:for(;;)switch(n.mode){case mst:if(0===n.wrap){n.mode=Sst;break}while(u<16){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}if(2&n.wrap&&35615===l){n.check=0,S[0]=255&l,S[1]=l>>>8&255,n.check=Urt(n.check,S,2,0),l=0,u=0,n.mode=_st;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=Wst;break}if((15&l)!==pst){e.msg="unknown compression method",n.mode=Wst;break}if(l>>>=4,u-=4,w=8+(15&l),0===n.wbits)n.wbits=w;else if(w>n.wbits){e.msg="invalid window size",n.mode=Wst;break}n.dmax=1<<w,e.adler=n.check=1,n.mode=512&l?Cst:xst,l=0,u=0;break;case _st:while(u<16){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}if(n.flags=l,(255&n.flags)!==pst){e.msg="unknown compression method",n.mode=Wst;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Wst;break}n.head&&(n.head.text=l>>8&1),512&n.flags&&(S[0]=255&l,S[1]=l>>>8&255,n.check=Urt(n.check,S,2,0)),l=0,u=0,n.mode=gst;case gst:while(u<32){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}n.head&&(n.head.time=l),512&n.flags&&(S[0]=255&l,S[1]=l>>>8&255,S[2]=l>>>16&255,S[3]=l>>>24&255,n.check=Urt(n.check,S,4,0)),l=0,u=0,n.mode=yst;case yst:while(u<16){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&n.flags&&(S[0]=255&l,S[1]=l>>>8&255,n.check=Urt(n.check,S,2,0)),l=0,u=0,n.mode=vst;case vst:if(1024&n.flags){while(u<16){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),512&n.flags&&(S[0]=255&l,S[1]=l>>>8&255,n.check=Urt(n.check,S,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=bst;case bst:if(1024&n.flags&&(f=n.length,f>a&&(f=a),f&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Mrt.arraySet(n.head.extra,i,r,f,w)),512&n.flags&&(n.check=Urt(n.check,i,f,r)),a-=f,r+=f,n.length-=f),n.length))break e;n.length=0,n.mode=Ast;case Ast:if(2048&n.flags){if(0===a)break e;f=0;do{w=i[r+f++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&f<a);if(512&n.flags&&(n.check=Urt(n.check,i,f,r)),a-=f,r+=f,w)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=wst;case wst:if(4096&n.flags){if(0===a)break e;f=0;do{w=i[r+f++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&f<a);if(512&n.flags&&(n.check=Urt(n.check,i,f,r)),a-=f,r+=f,w)break e}else n.head&&(n.head.comment=null);n.mode=Tst;case Tst:if(512&n.flags){while(u<16){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}if(l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Wst;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=xst;break;case Cst:while(u<32){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}e.adler=n.check=Jst(l),l=0,u=0,n.mode=Est;case Est:if(0===n.havedict)return e.next_out=s,e.avail_out=c,e.next_in=r,e.avail_in=a,n.hold=l,n.bits=u,lst;e.adler=n.check=1,n.mode=xst;case xst:if(t===rst||t===sst)break e;case Sst:if(n.last){l>>>=7&u,u-=7&u,n.mode=Vst;break}while(u<3){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}switch(n.last=1&l,l>>>=1,u-=1,3&l){case 0:n.mode=Ist;break;case 1:if(aat(n),n.mode=Mst,t===sst){l>>>=2,u-=2;break e}break;case 2:n.mode=Pst;break;case 3:e.msg="invalid block type",n.mode=Wst}l>>>=2,u-=2;break;case Ist:l>>>=7&u,u-=7&u;while(u<32){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}if((65535&l)!==(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Wst;break}if(n.length=65535&l,l=0,u=0,n.mode=Ost,t===sst)break e;case Ost:n.mode=Dst;case Dst:if(f=n.length,f){if(f>a&&(f=a),f>c&&(f=c),0===f)break e;Mrt.arraySet(o,i,r,f,s),a-=f,r+=f,c-=f,s+=f,n.length-=f;break}n.mode=xst;break;case Pst:while(u<14){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}if(n.nlen=257+(31&l),l>>>=5,u-=5,n.ndist=1+(31&l),l>>>=5,u-=5,n.ncode=4+(15&l),l>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Wst;break}n.have=0,n.mode=Rst;case Rst:while(n.have<n.ncode){while(u<3){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}n.lens[I[n.have++]]=7&l,l>>>=3,u-=3}while(n.have<19)n.lens[I[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},T=est(tst,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,T){e.msg="invalid code lengths set",n.mode=Wst;break}n.have=0,n.mode=Lst;case Lst:while(n.have<n.nlen+n.ndist){for(;;){if(x=n.lencode[l&(1<<n.lenbits)-1],_=x>>>24,g=x>>>16&255,y=65535&x,_<=u)break;if(0===a)break e;a--,l+=i[r++]<<u,u+=8}if(y<16)l>>>=_,u-=_,n.lens[n.have++]=y;else{if(16===y){E=_+2;while(u<E){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}if(l>>>=_,u-=_,0===n.have){e.msg="invalid bit length repeat",n.mode=Wst;break}w=n.lens[n.have-1],f=3+(3&l),l>>>=2,u-=2}else if(17===y){E=_+3;while(u<E){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}l>>>=_,u-=_,w=0,f=3+(7&l),l>>>=3,u-=3}else{E=_+7;while(u<E){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}l>>>=_,u-=_,w=0,f=11+(127&l),l>>>=7,u-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Wst;break}while(f--)n.lens[n.have++]=w}}if(n.mode===Wst)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Wst;break}if(n.lenbits=9,C={bits:n.lenbits},T=est(nst,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,T){e.msg="invalid literal/lengths set",n.mode=Wst;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},T=est(ist,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,T){e.msg="invalid distances set",n.mode=Wst;break}if(n.mode=Mst,t===sst)break e;case Mst:n.mode=Bst;case Bst:if(a>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=r,e.avail_in=a,n.hold=l,n.bits=u,Grt(e,d),s=e.next_out,o=e.output,c=e.avail_out,r=e.next_in,i=e.input,a=e.avail_in,l=n.hold,u=n.bits,n.mode===xst&&(n.back=-1);break}for(n.back=0;;){if(x=n.lencode[l&(1<<n.lenbits)-1],_=x>>>24,g=x>>>16&255,y=65535&x,_<=u)break;if(0===a)break e;a--,l+=i[r++]<<u,u+=8}if(g&&0===(240&g)){for(v=_,b=g,A=y;;){if(x=n.lencode[A+((l&(1<<v+b)-1)>>v)],_=x>>>24,g=x>>>16&255,y=65535&x,v+_<=u)break;if(0===a)break e;a--,l+=i[r++]<<u,u+=8}l>>>=v,u-=v,n.back+=v}if(l>>>=_,u-=_,n.back+=_,n.length=y,0===g){n.mode=Ust;break}if(32&g){n.back=-1,n.mode=xst;break}if(64&g){e.msg="invalid literal/length code",n.mode=Wst;break}n.extra=15&g,n.mode=Nst;case Nst:if(n.extra){E=n.extra;while(u<E){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=Fst;case Fst:for(;;){if(x=n.distcode[l&(1<<n.distbits)-1],_=x>>>24,g=x>>>16&255,y=65535&x,_<=u)break;if(0===a)break e;a--,l+=i[r++]<<u,u+=8}if(0===(240&g)){for(v=_,b=g,A=y;;){if(x=n.distcode[A+((l&(1<<v+b)-1)>>v)],_=x>>>24,g=x>>>16&255,y=65535&x,v+_<=u)break;if(0===a)break e;a--,l+=i[r++]<<u,u+=8}l>>>=v,u-=v,n.back+=v}if(l>>>=_,u-=_,n.back+=_,64&g){e.msg="invalid distance code",n.mode=Wst;break}n.offset=y,n.extra=15&g,n.mode=zst;case zst:if(n.extra){E=n.extra;while(u<E){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Wst;break}n.mode=kst;case kst:if(0===c)break e;if(f=d-c,n.offset>f){if(f=n.offset-f,f>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Wst;break}f>n.wnext?(f-=n.wnext,p=n.wsize-f):p=n.wnext-f,f>n.length&&(f=n.length),m=n.window}else m=o,p=s-n.offset,f=n.length;f>c&&(f=c),c-=f,n.length-=f;do{o[s++]=m[p++]}while(--f);0===n.length&&(n.mode=Bst);break;case Ust:if(0===c)break e;o[s++]=n.length,c--,n.mode=Bst;break;case Vst:if(n.wrap){while(u<32){if(0===a)break e;a--,l|=i[r++]<<u,u+=8}if(d-=c,e.total_out+=d,n.total+=d,d&&(e.adler=n.check=n.flags?Urt(n.check,o,d,s-d):Nrt(n.check,o,d,s-d)),d=c,(n.flags?l:Jst(l))!==n.check){e.msg="incorrect data check",n.mode=Wst;break}l=0,u=0}n.mode=Hst;case Hst:if(n.wrap&&n.flags){while(u<32){if(0===a)break e;a--,l+=i[r++]<<u,u+=8}if(l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Wst;break}l=0,u=0}n.mode=Gst;case Gst:T=cst;break e;case Wst:T=hst;break e;case qst:return dst;case jst:default:return ust}return e.next_out=s,e.avail_out=c,e.next_in=r,e.avail_in=a,n.hold=l,n.bits=u,(n.wsize||d!==e.avail_out&&n.mode<Wst&&(n.mode<Vst||t!==ost))&&cat(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,n.total+=d,n.wrap&&d&&(e.adler=n.check=n.flags?Urt(n.check,o,d,e.next_out-d):Nrt(n.check,o,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(n.mode===xst?128:0)+(n.mode===Mst||n.mode===Ost?256:0),(0===h&&0===d||t===ost)&&T===ast&&(T=fst),T}function uat(e){if(!e||!e.state)return ust;var t=e.state;return t.window&&(t.window=null),e.state=null,ast}function hat(e,t){var n;return e&&e.state?(n=e.state,0===(2&n.wrap)?ust:(n.head=t,t.done=!1,ast)):ust}function dat(e,t){var n,i,o,r=t.length;return e&&e.state?(n=e.state,0!==n.wrap&&n.mode!==Est?ust:n.mode===Est&&(i=1,i=Nrt(i,t,r,0),i!==n.check)?hst:(o=cat(e,t,r,r),o?(n.mode=qst,dst):(n.havedict=1,ast))):ust}var fat=eat,pat=tat,mat=$st,_at=iat,gat=nat,yat=lat,vat=uat,bat=hat,Aat=dat,wat="pako inflate (from Nodeca project)",Tat={inflateReset:fat,inflateReset2:pat,inflateResetKeep:mat,inflateInit:_at,inflateInit2:gat,inflate:yat,inflateEnd:vat,inflateGetHeader:bat,inflateSetDictionary:Aat,inflateInfo:wat},Cat=!0,Eat=!0;try{String.fromCharCode.apply(null,[0])}catch(fdt){Cat=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(fdt){Eat=!1}for(var xat=new Mrt.Buf8(256),Sat=0;Sat<256;Sat++)xat[Sat]=Sat>=252?6:Sat>=248?5:Sat>=240?4:Sat>=224?3:Sat>=192?2:1;xat[254]=xat[254]=1;var Iat=function(e){var t,n,i,o,r,s=e.length,a=0;for(o=0;o<s;o++)n=e.charCodeAt(o),55296===(64512&n)&&o+1<s&&(i=e.charCodeAt(o+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Mrt.Buf8(a),r=0,o=0;r<a;o++)n=e.charCodeAt(o),55296===(64512&n)&&o+1<s&&(i=e.charCodeAt(o+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),n<128?t[r++]=n:n<2048?(t[r++]=192|n>>>6,t[r++]=128|63&n):n<65536?(t[r++]=224|n>>>12,t[r++]=128|n>>>6&63,t[r++]=128|63&n):(t[r++]=240|n>>>18,t[r++]=128|n>>>12&63,t[r++]=128|n>>>6&63,t[r++]=128|63&n);return t};function Oat(e,t){if(t<65534&&(e.subarray&&Eat||!e.subarray&&Cat))return String.fromCharCode.apply(null,Mrt.shrinkBuf(e,t));for(var n="",i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n}var Dat=function(e){return Oat(e,e.length)},Pat=function(e){for(var t=new Mrt.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},Rat=function(e,t){var n,i,o,r,s=t||e.length,a=new Array(2*s);for(i=0,n=0;n<s;)if(o=e[n++],o<128)a[i++]=o;else if(r=xat[o],r>4)a[i++]=65533,n+=r-1;else{o&=2===r?31:3===r?15:7;while(r>1&&n<s)o=o<<6|63&e[n++],r--;r>1?a[i++]=65533:o<65536?a[i++]=o:(o-=65536,a[i++]=55296|o>>10&1023,a[i++]=56320|1023&o)}return Oat(a,i)},Lat=function(e,t){var n;t=t||e.length,t>e.length&&(t=e.length),n=t-1;while(n>=0&&128===(192&e[n]))n--;return n<0||0===n?t:n+xat[e[n]]>t?n:t},Mat={string2buf:Iat,buf2binstring:Dat,binstring2buf:Pat,buf2string:Rat,utf8border:Lat},Bat={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Nat={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function Fat(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zat=Fat;function kat(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Uat=kat,Vat=Object.prototype.toString;function Hat(e){if(!(this instanceof Hat))return new Hat(e);this.options=Mrt.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zat,this.strm.avail_out=0;var n=Tat.inflateInit2(this.strm,t.windowBits);if(n!==Bat.Z_OK)throw new Error(Nat[n]);if(this.header=new Uat,Tat.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=Mat.string2buf(t.dictionary):"[object ArrayBuffer]"===Vat.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Tat.inflateSetDictionary(this.strm,t.dictionary),n!==Bat.Z_OK)))throw new Error(Nat[n])}Hat.prototype.push=function(e,t){var n,i,o,r,s,a=this.strm,c=this.options.chunkSize,l=this.options.dictionary,u=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?Bat.Z_FINISH:Bat.Z_NO_FLUSH,"string"===typeof e?a.input=Mat.binstring2buf(e):"[object ArrayBuffer]"===Vat.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new Mrt.Buf8(c),a.next_out=0,a.avail_out=c),n=Tat.inflate(a,Bat.Z_NO_FLUSH),n===Bat.Z_NEED_DICT&&l&&(n=Tat.inflateSetDictionary(this.strm,l)),n===Bat.Z_BUF_ERROR&&!0===u&&(n=Bat.Z_OK,u=!1),n!==Bat.Z_STREAM_END&&n!==Bat.Z_OK)return this.onEnd(n),this.ended=!0,!1;a.next_out&&(0!==a.avail_out&&n!==Bat.Z_STREAM_END&&(0!==a.avail_in||i!==Bat.Z_FINISH&&i!==Bat.Z_SYNC_FLUSH)||("string"===this.options.to?(o=Mat.utf8border(a.output,a.next_out),r=a.next_out-o,s=Mat.buf2string(a.output,o),a.next_out=r,a.avail_out=c-r,r&&Mrt.arraySet(a.output,a.output,o,r,0),this.onData(s)):this.onData(Mrt.shrinkBuf(a.output,a.next_out)))),0===a.avail_in&&0===a.avail_out&&(u=!0)}while((a.avail_in>0||0===a.avail_out)&&n!==Bat.Z_STREAM_END);return n===Bat.Z_STREAM_END&&(i=Bat.Z_FINISH),i===Bat.Z_FINISH?(n=Tat.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Bat.Z_OK):i!==Bat.Z_SYNC_FLUSH||(this.onEnd(Bat.Z_OK),a.avail_out=0,!0)},Hat.prototype.onData=function(e){this.chunks.push(e)},Hat.prototype.onEnd=function(e){e===Bat.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Mrt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};(0,on.c)((function(e,t){
/** @license MIT License (c) copyright B Cavalier & J Hann */
(function(e){e((function(){var e,t,n;function i(e,t,n,i){return o(e).then(t,n,i)}function o(e){var t,n;return e instanceof s?t=e:u(e)?(n=l(),e.then((function(e){n.resolve(e)}),(function(e){n.reject(e)}),(function(e){n.progress(e)})),t=n.promise):t=a(e),t}function r(e){return i(e,c)}function s(e){this.then=e}function a(e){var t=new s((function(t){try{return o(t?t(e):e)}catch(n){return c(n)}}));return t}function c(e){var t=new s((function(t,n){try{return n?o(n(e)):c(e)}catch(i){return c(i)}}));return t}function l(){var e,t,i,r,a,u,h;return t=new s(d),e={then:d,resolve:f,reject:p,progress:m,promise:t,resolver:{resolve:f,reject:p,progress:m}},i=[],r=[],a=function(e,t,n){var o,s;return o=l(),s="function"===typeof n?function(e){try{o.progress(n(e))}catch(t){o.progress(t)}}:function(e){o.progress(e)},i.push((function(n){n.then(e,t).then(o.resolve,o.reject,s)})),r.push(s),o.promise},u=function(e){return y(r,e),e},h=function(e){return e=o(e),a=e.then,h=o,u=b,y(i,e),r=i=n,e},e;function d(e,t,n){return a(e,t,n)}function f(e){return h(e)}function p(e){return h(c(e))}function m(e){return u(e)}}function u(e){return e&&"function"===typeof e.then}function h(e,t,n,o,r){return v(2,arguments),i(e,(function(e){var s,a,c,u,h,d,f,p,m,_;if(m=e.length>>>0,s=Math.max(0,Math.min(t,m)),c=[],a=m-s+1,u=[],h=l(),s)for(p=h.progress,f=function(e){u.push(e),--a||(d=f=b,h.reject(u))},d=function(e){c.push(e),--s||(d=f=b,h.resolve(c))},_=0;_<m;++_)_ in e&&i(e[_],y,g,p);else h.resolve(c);return h.then(n,o,r);function g(e){f(e)}function y(e){d(e)}}))}function d(e,t,n,i){function o(e){return t?t(e[0]):e[0]}return h(e,1,o,n,i)}function f(e,t,n,i){return v(1,arguments),m(e,A).then(t,n,i)}function p(){return m(arguments,A)}function m(e,t){return i(e,(function(e){var n,o,r,s,a,c;if(r=o=e.length>>>0,n=[],c=l(),r)for(s=function(e,o){i(e,t).then((function(e){n[o]=e,--r||c.resolve(n)}),c.reject)},a=0;a<o;a++)a in e?s(e[a],a):--r;else c.resolve(n);return c.promise}))}function _(n,o){var r=t.call(arguments,1);return i(n,(function(t){var n;return n=t.length,r[0]=function(e,t,r){return i(e,(function(e){return i(t,(function(t){return o(e,t,r,n)}))}))},e.apply(t,r)}))}function g(e,t,n){var o=arguments.length>2;return i(e,(function(e){return e=o?n:e,t.resolve(e),e}),(function(e){return t.reject(e),c(e)}),t.progress)}function y(e,t){var n,i=0;while(n=e[i++])n(t)}function v(e,t){var n,i=t.length;while(i>e)if(n=t[--i],null!=n&&"function"!=typeof n)throw new Error("arg "+i+" must be a function")}function b(){}function A(e){return e}return i.defer=l,i.resolve=o,i.reject=r,i.join=p,i.all=f,i.map=m,i.reduce=_,i.any=d,i.some=h,i.chain=g,i.isPromise=u,s.prototype={always:function(e,t){return this.then(e,e,t)},otherwise:function(e){return this.then(n,e)},yield:function(e){return this.then((function(){return e}))},spread:function(e){return this.then((function(t){return f(t,(function(t){return e.apply(n,t)}))}))}},t=[].slice,e=[].reduce||function(e){var t,n,i,o,r;if(r=0,t=Object(this),o=t.length>>>0,n=arguments,n.length<=1)for(;;){if(r in t){i=t[r++];break}if(++r>=o)throw new TypeError}else i=n[1];for(;r<o;++r)r in t&&(i=e(i,t[r],r,t));return i},i}))})((function(t){e.exports=t()}))}));function Gat(e){C(e)||(e=new _y),this._clock=e,this._eventHelper=new RC,this._eventHelper.add(e.onTick,this.synchronize,this),this.systemTime=vrt.observable(Ea.now()),this.systemTime.equalityComparer=Ea.equals,this.startTime=vrt.observable(e.startTime),this.startTime.equalityComparer=Ea.equals,this.startTime.subscribe((function(t){e.startTime=t,this.synchronize()}),this),this.stopTime=vrt.observable(e.stopTime),this.stopTime.equalityComparer=Ea.equals,this.stopTime.subscribe((function(t){e.stopTime=t,this.synchronize()}),this),this.currentTime=vrt.observable(e.currentTime),this.currentTime.equalityComparer=Ea.equals,this.currentTime.subscribe((function(t){e.currentTime=t,this.synchronize()}),this),this.multiplier=vrt.observable(e.multiplier),this.multiplier.subscribe((function(t){e.multiplier=t,this.synchronize()}),this),this.clockStep=vrt.observable(e.clockStep),this.clockStep.subscribe((function(t){e.clockStep=t,this.synchronize()}),this),this.clockRange=vrt.observable(e.clockRange),this.clockRange.subscribe((function(t){e.clockRange=t,this.synchronize()}),this),this.canAnimate=vrt.observable(e.canAnimate),this.canAnimate.subscribe((function(t){e.canAnimate=t,this.synchronize()}),this),this.shouldAnimate=vrt.observable(e.shouldAnimate),this.shouldAnimate.subscribe((function(t){e.shouldAnimate=t,this.synchronize()}),this),vrt.track(this,["systemTime","startTime","stopTime","currentTime","multiplier","clockStep","clockRange","canAnimate","shouldAnimate"])}Object.defineProperties(Gat.prototype,{clock:{get:function(){return this._clock}}}),Gat.prototype.synchronize=function(){const e=this._clock;this.systemTime=Ea.now(),this.startTime=e.startTime,this.stopTime=e.stopTime,this.currentTime=e.currentTime,this.multiplier=e.multiplier,this.clockStep=e.clockStep,this.clockRange=e.clockRange,this.canAnimate=e.canAnimate,this.shouldAnimate=e.shouldAnimate},Gat.prototype.isDestroyed=function(){return!1},Gat.prototype.destroy=function(){this._eventHelper.removeAll(),Qh(this)};var Wat=Gat;const qat={createCheckbox:function(e,t,n){D.typeOf.string("labelText",e),D.typeOf.string("checkedBinding",t);const i=document.createElement("div"),o=document.createElement("label"),r=document.createElement("input");r.type="checkbox";let s=`checked: ${t}`;return C(n)&&(s+=`, enable: ${n}`),r.setAttribute("data-bind",s),o.appendChild(r),o.appendChild(document.createTextNode(e)),i.appendChild(o),i},createSection:function(e,t,n,i){D.defined("panel",e),D.typeOf.string("headerText",t),D.typeOf.string("sectionVisibleBinding",n),D.typeOf.string("toggleSectionVisibilityBinding",i);const o=document.createElement("div");o.className="cesium-cesiumInspector-section",o.setAttribute("data-bind",`css: { "cesium-cesiumInspector-section-collapsed": !${n} }`),e.appendChild(o);const r=document.createElement("h3");r.className="cesium-cesiumInspector-sectionHeader",r.appendChild(document.createTextNode(t)),r.setAttribute("data-bind",`click: ${i}`),o.appendChild(r);const s=document.createElement("div");return s.className="cesium-cesiumInspector-sectionContent",o.appendChild(s),s}};var jat=qat;function Yat(e,t){if(!C(e))throw new x("command is required.");this._command=e,t=R(t,R.EMPTY_OBJECT),this.toggled=R(t.toggled,!1),this.tooltip=R(t.tooltip,""),vrt.track(this,["toggled","tooltip"])}Object.defineProperties(Yat.prototype,{command:{get:function(){return this._command}}});var Kat=Yat;function Xat(e,t){if(!C(e))throw new x("func is required.");t=R(t,!0);const n=new $n,i=new $n;function o(){if(!o.canExecute)throw new x("Cannot execute command, canExecute is false.");const t={args:arguments,cancel:!1};let r;return n.raiseEvent(t),t.cancel||(r=e.apply(null,arguments),i.raiseEvent(r)),r}return o.canExecute=t,vrt.track(o,["canExecute"]),Object.defineProperties(o,{beforeExecute:{value:n},afterExecute:{value:i}}),o}var Qat=Xat;function Jat(e,t,n,i,o){return n.call(i,e[t]),vrt.getObservable(e,t).subscribe(n,i,o)}var Zat=Jat;const $at={FLOAT:"float",VEC2:"vec2",VEC3:"vec3",VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",MAT2:"mat2",MAT3:"mat2",MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube"};var ect=Object.freeze($at);function tct(){this._defaultTexture=void 0,this._textures={},this._loadedImages=[],this._lastUpdatedFrame=-1}function nct(e,t,n){n.resource.fetchImage().then((function(i){e._loadedImages.push({id:t,image:i,textureUniform:n})})).catch((function(){const n=e._textures[t];C(n)&&n!==e._defaultTexture&&n.destroy(),e._textures[t]=e._defaultTexture}))}function ict(e,t,n){const i=t.id,o=t.textureUniform,r=o.typedArray,s=o.sampler;let a;a=C(r)?new Uk({context:n,pixelFormat:o.pixelFormat,pixelDatatype:o.pixelDatatype,source:{arrayBufferView:r,width:o.width,height:o.height},sampler:s,flipY:!1}):new Uk({context:n,source:t.image,sampler:s});const c=e._textures[i];C(c)&&c!==n.defaultTexture&&c.destroy(),e._textures[i]=a}function oct(e){e=R(e,R.EMPTY_OBJECT),this.mode=R(e.mode,qhe.MODIFY_MATERIAL),this.lightingModel=e.lightingModel,this.uniforms=R(e.uniforms,R.EMPTY_OBJECT),this.varyings=R(e.varyings,R.EMPTY_OBJECT),this.vertexShaderText=e.vertexShaderText,this.fragmentShaderText=e.fragmentShaderText,this.isTranslucent=R(e.isTranslucent,!1),this._textureManager=new tct,this._defaultTexture=void 0,this.uniformMap=rct(this),this.usedVariablesVertex={attributeSet:{},featureIdSet:{},metadataSet:{}},this.usedVariablesFragment={attributeSet:{},featureIdSet:{},metadataSet:{},materialSet:{}},lct(this),dct(this)}function rct(e){const t=e.uniforms,n={};for(const i in t)if(t.hasOwnProperty(i)){const o=t[i],r=o.type;if(r===ect.SAMPLER_CUBE)throw new x("CustomShader does not support samplerCube uniforms");r===ect.SAMPLER_2D?(e._textureManager.loadTexture2D(i,o.value),n[i]=sct(e,i)):n[i]=act(e,i)}return n}function sct(e,t){return function(){return R(e._textureManager.getTexture(t),e._defaultTexture)}}function act(e,t){return function(){return e.uniforms[t].value}}function cct(e,t,n){let i;while(null!==(i=t.exec(e))){const e=i[1];n[e]=!0}}function lct(e){const t=/[vf]sInput\.attributes\.(\w+)/g,n=/[vf]sInput\.featureIds\.(\w+)/g,i=/[vf]sInput\.metadata.(\w+)/g;let o;const r=e.vertexShaderText;C(r)&&(o=e.usedVariablesVertex.attributeSet,cct(r,t,o),o=e.usedVariablesVertex.featureIdSet,cct(r,n,o),o=e.usedVariablesVertex.metadataSet,cct(r,i,o));const s=e.fragmentShaderText;if(C(s)){o=e.usedVariablesFragment.attributeSet,cct(s,t,o),o=e.usedVariablesFragment.featureIdSet,cct(s,n,o),o=e.usedVariablesFragment.metadataSet,cct(s,i,o);const r=/material\.(\w+)/g,a=e.usedVariablesFragment.materialSet;cct(s,r,a)}}function uct(e){const t=/^.*MC$/,n=/^.*WC$/,i=/^.*EC$/;return t.test(e)?`${e} (model coordinates)`:n.test(e)?`${e} (Cartesian world coordinates)`:i.test(e)?`${e} (eye coordinates)`:e}function hct(e,t,n,i){if(e.hasOwnProperty(t)){const e=`${uct(t)} is not available in the ${i} shader. Did you mean ${uct(n)} instead?`;throw new x(e)}}function dct(e){const t=e.usedVariablesVertex.attributeSet;hct(t,"position","positionMC","vertex"),hct(t,"normal","normalMC","vertex"),hct(t,"tangent","tangentMC","vertex"),hct(t,"bitangent","bitangentMC","vertex"),hct(t,"positionWC","positionMC","vertex"),hct(t,"positionEC","positionMC","vertex"),hct(t,"normalEC","normalMC","vertex"),hct(t,"tangentEC","tangentMC","vertex"),hct(t,"bitangentEC","bitangentMC","vertex");const n=e.usedVariablesFragment.attributeSet;hct(n,"position","positionEC","fragment"),hct(n,"normal","normalEC","fragment"),hct(n,"tangent","tangentEC","fragment"),hct(n,"bitangent","bitangentEC","fragment"),hct(n,"normalMC","normalEC","fragment"),hct(n,"tangentMC","tangentEC","fragment"),hct(n,"bitangentMC","bitangentEC","fragment")}tct.prototype.getTexture=function(e){return this._textures[e]},tct.prototype.loadTexture2D=function(e,t){C(t.typedArray)?this._loadedImages.push({id:e,textureUniform:t}):nct(this,e,t)},tct.prototype.update=function(e){if(e.frameNumber===this._lastUpdatedFrame)return;this._lastUpdatedFrame=e.frameNumber;const t=e.context;this._defaultTexture=t.defaultTexture;const n=this._loadedImages;for(let i=0;i<n.length;i++){const e=n[i];ict(this,e,t)}n.length=0},tct.prototype.isDestroyed=function(){return!1},tct.prototype.destroy=function(){const e=this._textures;for(const t in e)if(e.hasOwnProperty(t)){const n=e[t];n!==this._defaultTexture&&n.destroy()}return Qh(this)},oct.prototype.setUniform=function(e,t){if(D.typeOf.string("uniformName",e),D.defined("value",t),!C(this.uniforms[e]))throw new x(`Uniform ${e} must be declared in the CustomShader constructor.`);const n=this.uniforms[e];n.type===ect.SAMPLER_2D?this._textureManager.loadTexture2D(e,t):C(t.clone)?n.value=t.clone(n.value):n.value=t},oct.prototype.update=function(e){this._defaultTexture=e.context.defaultTexture,this._textureManager.update(e)},oct.prototype.isDestroyed=function(){return!1},oct.prototype.destroy=function(){this._textureManager=this._textureManager&&this._textureManager.destroy(),Qh(this)};const fct={FLOAT:"float",VEC2:"vec2",VEC3:"vec3",VEC4:"vec4",MAT2:"mat2",MAT3:"mat2",MAT4:"mat4"};Object.freeze(fct);const pct="http://www.w3.org/2000/svg",mct="http://www.w3.org/1999/xlink";let _ct;const gct=xy.fromCssColorString("rgba(247,250,255,0.384)"),yct=xy.fromCssColorString("rgba(143,191,255,0.216)"),vct=xy.fromCssColorString("rgba(153,197,255,0.098)"),bct=xy.fromCssColorString("rgba(255,255,255,0.086)"),Act=xy.fromCssColorString("rgba(255,255,255,0.267)"),wct=xy.fromCssColorString("rgba(255,255,255,0)"),Tct=xy.fromCssColorString("rgba(66,67,68,0.3)"),Cct=xy.fromCssColorString("rgba(0,0,0,0.5)");function Ect(e){return xy.fromCssColorString(window.getComputedStyle(e).getPropertyValue("color"))}const xct={animation_pathReset:{tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M24.316,5.318,9.833,13.682,9.833,5.5,5.5,5.5,5.5,25.5,9.833,25.5,9.833,17.318,24.316,25.682z"},animation_pathPause:{tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M13,5.5,7.5,5.5,7.5,25.5,13,25.5zM24.5,5.5,19,5.5,19,25.5,24.5,25.5z"},animation_pathPlay:{tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M6.684,25.682L24.316,15.5L6.684,5.318V25.682z"},animation_pathPlayReverse:{tagName:"path",transform:"translate(16,16) scale(-0.85,0.85) translate(-16,-16)",d:"M6.684,25.682L24.316,15.5L6.684,5.318V25.682z"},animation_pathLoop:{tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M24.249,15.499c-0.009,4.832-3.918,8.741-8.75,8.75c-2.515,0-4.768-1.064-6.365-2.763l2.068-1.442l-7.901-3.703l0.744,8.694l2.193-1.529c2.244,2.594,5.562,4.242,9.26,4.242c6.767,0,12.249-5.482,12.249-12.249H24.249zM15.499,6.75c2.516,0,4.769,1.065,6.367,2.764l-2.068,1.443l7.901,3.701l-0.746-8.693l-2.192,1.529c-2.245-2.594-5.562-4.245-9.262-4.245C8.734,3.25,3.25,8.734,3.249,15.499H6.75C6.758,10.668,10.668,6.758,15.499,6.75z"},animation_pathClock:{tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-15.5)",d:"M15.5,2.374C8.251,2.375,2.376,8.251,2.374,15.5C2.376,22.748,8.251,28.623,15.5,28.627c7.249-0.004,13.124-5.879,13.125-13.127C28.624,8.251,22.749,2.375,15.5,2.374zM15.5,25.623C9.909,25.615,5.385,21.09,5.375,15.5C5.385,9.909,9.909,5.384,15.5,5.374c5.59,0.01,10.115,4.535,10.124,10.125C25.615,21.09,21.091,25.615,15.5,25.623zM8.625,15.5c-0.001-0.552-0.448-0.999-1.001-1c-0.553,0-1,0.448-1,1c0,0.553,0.449,1,1,1C8.176,16.5,8.624,16.053,8.625,15.5zM8.179,18.572c-0.478,0.277-0.642,0.889-0.365,1.367c0.275,0.479,0.889,0.641,1.365,0.365c0.479-0.275,0.643-0.887,0.367-1.367C9.27,18.461,8.658,18.297,8.179,18.572zM9.18,10.696c-0.479-0.276-1.09-0.112-1.366,0.366s-0.111,1.09,0.365,1.366c0.479,0.276,1.09,0.113,1.367-0.366C9.821,11.584,9.657,10.973,9.18,10.696zM22.822,12.428c0.478-0.275,0.643-0.888,0.366-1.366c-0.275-0.478-0.89-0.642-1.366-0.366c-0.479,0.278-0.642,0.89-0.366,1.367C21.732,12.54,22.344,12.705,22.822,12.428zM12.062,21.455c-0.478-0.275-1.089-0.111-1.366,0.367c-0.275,0.479-0.111,1.09,0.366,1.365c0.478,0.277,1.091,0.111,1.365-0.365C12.704,22.344,12.54,21.732,12.062,21.455zM12.062,9.545c0.479-0.276,0.642-0.888,0.366-1.366c-0.276-0.478-0.888-0.642-1.366-0.366s-0.642,0.888-0.366,1.366C10.973,9.658,11.584,9.822,12.062,9.545zM22.823,18.572c-0.48-0.275-1.092-0.111-1.367,0.365c-0.275,0.479-0.112,1.092,0.367,1.367c0.477,0.275,1.089,0.113,1.365-0.365C23.464,19.461,23.3,18.848,22.823,18.572zM19.938,7.813c-0.477-0.276-1.091-0.111-1.365,0.366c-0.275,0.48-0.111,1.091,0.366,1.367s1.089,0.112,1.366-0.366C20.581,8.702,20.418,8.089,19.938,7.813zM23.378,14.5c-0.554,0.002-1.001,0.45-1.001,1c0.001,0.552,0.448,1,1.001,1c0.551,0,1-0.447,1-1C24.378,14.949,23.929,14.5,23.378,14.5zM15.501,6.624c-0.552,0-1,0.448-1,1l-0.466,7.343l-3.004,1.96c-0.478,0.277-0.642,0.889-0.365,1.365c0.275,0.479,0.889,0.643,1.365,0.367l3.305-1.676C15.39,16.99,15.444,17,15.501,17c0.828,0,1.5-0.671,1.5-1.5l-0.5-7.876C16.501,7.072,16.053,6.624,15.501,6.624zM15.501,22.377c-0.552,0-1,0.447-1,1s0.448,1,1,1s1-0.447,1-1S16.053,22.377,15.501,22.377zM18.939,21.455c-0.479,0.277-0.643,0.889-0.366,1.367c0.275,0.477,0.888,0.643,1.366,0.365c0.478-0.275,0.642-0.889,0.366-1.365C20.028,21.344,19.417,21.18,18.939,21.455z"},animation_pathWingButton:{tagName:"path",d:"m 4.5,0.5 c -2.216,0 -4,1.784 -4,4 l 0,24 c 0,2.216 1.784,4 4,4 l 13.71875,0 C 22.478584,27.272785 27.273681,22.511272 32.5,18.25 l 0,-13.75 c 0,-2.216 -1.784,-4 -4,-4 l -24,0 z"},animation_pathPointer:{tagName:"path",d:"M-15,-65,-15,-55,15,-55,15,-65,0,-95z"},animation_pathSwooshFX:{tagName:"path",d:"m 85,0 c 0,16.617 -4.813944,35.356 -13.131081,48.4508 h 6.099803 c 8.317138,-13.0948 13.13322,-28.5955 13.13322,-45.2124 0,-46.94483 -38.402714,-85.00262 -85.7743869,-85.00262 -1.0218522,0 -2.0373001,0.0241 -3.0506131,0.0589 45.958443,1.59437 82.723058,35.77285 82.723058,81.70532 z"}};function Sct(e){const t=document.createElementNS(pct,e.tagName);for(const n in e)if(e.hasOwnProperty(n)&&"tagName"!==n)if("children"===n){const n=e.children.length;for(let i=0;i<n;++i)t.appendChild(Sct(e.children[i]))}else 0===n.indexOf("xlink:")?t.setAttributeNS(mct,n.substring(6),e[n]):"textContent"===n?t.textContent=e[n]:t.setAttribute(n,e[n]);return t}function Ict(e,t,n){const i=document.createElementNS(pct,"text");i.setAttribute("x",e),i.setAttribute("y",t),i.setAttribute("class","cesium-animation-svgText");const o=document.createElementNS(pct,"tspan");return o.textContent=n,i.appendChild(o),i}function Oct(e,t,n){e.setAttribute("transform",`translate(100,100) rotate(${n})`),t.setAttribute("transform",`rotate(${n})`)}const Dct=new xy;function Pct(e,t){const n=t.alpha,i=1-n;return Dct.red=e.red*i+t.red*n,Dct.green=e.green*i+t.green*n,Dct.blue=e.blue*i+t.blue*n,Dct.toCssColorString()}function Rct(e,t,n){const i=xct[n],o={tagName:"g",class:"cesium-animation-rectButton",transform:`translate(${e},${t})`,children:[{tagName:"rect",class:"cesium-animation-buttonGlow",width:32,height:32,rx:2,ry:2},{tagName:"rect",class:"cesium-animation-buttonMain",width:32,height:32,rx:4,ry:4},{class:"cesium-animation-buttonPath",id:n,tagName:i.tagName,transform:i.transform,d:i.d},{tagName:"title",textContent:""}]};return Sct(o)}function Lct(e,t,n){const i=xct[n],o=xct["animation_pathWingButton"],r={tagName:"g",class:"cesium-animation-rectButton",transform:`translate(${e},${t})`,children:[{class:"cesium-animation-buttonGlow",id:"animation_pathWingButton",tagName:o.tagName,d:o.d},{class:"cesium-animation-buttonMain",id:"animation_pathWingButton",tagName:o.tagName,d:o.d},{class:"cesium-animation-buttonPath",id:n,tagName:i.tagName,transform:i.transform,d:i.d},{tagName:"title",textContent:""}]};return Sct(r)}function Mct(e,t){const n=e._viewModel,i=n.shuttleRingDragging;if(!i||_ct===e)if("mousedown"===t.type||i&&"mousemove"===t.type||"touchstart"===t.type&&1===t.touches.length||i&&"touchmove"===t.type&&1===t.touches.length){const o=e._centerX,r=e._centerY,s=e._svgNode,a=s.getBoundingClientRect();let c,l;if("touchstart"===t.type||"touchmove"===t.type?(c=t.touches[0].clientX,l=t.touches[0].clientY):(c=t.clientX,l=t.clientY),!i&&(c>a.right||c<a.left||l<a.top||l>a.bottom))return;const u=e._shuttleRingPointer.getBoundingClientRect(),h=c-o-a.left,d=l-r-a.top;let f=180*Math.atan2(d,h)/Math.PI+90;f>180&&(f-=360);const p=n.shuttleRingAngle;i||c<u.right&&c>u.left&&l>u.top&&l<u.bottom?(_ct=e,n.shuttleRingDragging=!0,n.shuttleRingAngle=f):f<p?n.slower():f>p&&n.faster(),t.preventDefault()}else e===_ct&&(_ct=void 0),n.shuttleRingDragging=!1}function Bct(e,t){this._viewModel=t,this.svgElement=e,this._enabled=void 0,this._toggled=void 0;const n=this;this._clickFunction=function(){const e=n._viewModel.command;e.canExecute&&e()},e.addEventListener("click",this._clickFunction,!0),this._subscriptions=[Zat(t,"toggled",this.setToggled,this),Zat(t,"tooltip",this.setTooltip,this),Zat(t.command,"canExecute",this.setEnabled,this)]}function Nct(e,t){if(!C(e))throw new x("container is required.");if(!C(t))throw new x("viewModel is required.");e=Uke(e),this._viewModel=t,this._container=e,this._centerX=0,this._centerY=0,this._defsElement=void 0,this._svgNode=void 0,this._topG=void 0,this._lastHeight=void 0,this._lastWidth=void 0;const n=e.ownerDocument,i=document.createElement("style");i.textContent=".cesium-animation-rectButton .cesium-animation-buttonGlow { filter: url(#animation_blurred); }.cesium-animation-rectButton .cesium-animation-buttonMain { fill: url(#animation_buttonNormal); }.cesium-animation-buttonToggled .cesium-animation-buttonMain { fill: url(#animation_buttonToggled); }.cesium-animation-rectButton:hover .cesium-animation-buttonMain { fill: url(#animation_buttonHovered); }.cesium-animation-buttonDisabled .cesium-animation-buttonMain { fill: url(#animation_buttonDisabled); }.cesium-animation-shuttleRingG .cesium-animation-shuttleRingSwoosh { fill: url(#animation_shuttleRingSwooshGradient); }.cesium-animation-shuttleRingG:hover .cesium-animation-shuttleRingSwoosh { fill: url(#animation_shuttleRingSwooshHovered); }.cesium-animation-shuttleRingPointer { fill: url(#animation_shuttleRingPointerGradient); }.cesium-animation-shuttleRingPausePointer { fill: url(#animation_shuttleRingPointerPaused); }.cesium-animation-knobOuter { fill: url(#animation_knobOuter); }.cesium-animation-knobInner { fill: url(#animation_knobInner); }",n.head.insertBefore(i,n.head.childNodes[0]);const o=document.createElement("div");o.className="cesium-animation-theme",o.innerHTML='<div class="cesium-animation-themeNormal"></div><div class="cesium-animation-themeHover"></div><div class="cesium-animation-themeSelect"></div><div class="cesium-animation-themeDisabled"></div><div class="cesium-animation-themeKnob"></div><div class="cesium-animation-themePointer"></div><div class="cesium-animation-themeSwoosh"></div><div class="cesium-animation-themeSwooshHover"></div>',this._theme=o,this._themeNormal=o.childNodes[0],this._themeHover=o.childNodes[1],this._themeSelect=o.childNodes[2],this._themeDisabled=o.childNodes[3],this._themeKnob=o.childNodes[4],this._themePointer=o.childNodes[5],this._themeSwoosh=o.childNodes[6],this._themeSwooshHover=o.childNodes[7];const r=document.createElementNS(pct,"svg:svg");this._svgNode=r,r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink",mct);const s=document.createElementNS(pct,"g");this._topG=s,this._realtimeSVG=new Bct(Lct(3,4,"animation_pathClock"),t.playRealtimeViewModel),this._playReverseSVG=new Bct(Rct(44,99,"animation_pathPlayReverse"),t.playReverseViewModel),this._playForwardSVG=new Bct(Rct(124,99,"animation_pathPlay"),t.playForwardViewModel),this._pauseSVG=new Bct(Rct(84,99,"animation_pathPause"),t.pauseViewModel);const a=document.createElementNS(pct,"g");a.appendChild(this._realtimeSVG.svgElement),a.appendChild(this._playReverseSVG.svgElement),a.appendChild(this._playForwardSVG.svgElement),a.appendChild(this._pauseSVG.svgElement);const c=Sct({tagName:"circle",class:"cesium-animation-shuttleRingBack",cx:100,cy:100,r:99});this._shuttleRingBackPanel=c;const l=xct["animation_pathSwooshFX"],u=xct["animation_pathPointer"],h=Sct({tagName:"g",class:"cesium-animation-shuttleRingSwoosh",children:[{tagName:l.tagName,transform:"translate(100,97) scale(-1,1)",id:"animation_pathSwooshFX",d:l.d},{tagName:l.tagName,transform:"translate(100,97)",id:"animation_pathSwooshFX",d:l.d},{tagName:"line",x1:100,y1:8,x2:100,y2:22}]});this._shuttleRingSwooshG=h,this._shuttleRingPointer=Sct({class:"cesium-animation-shuttleRingPointer",id:"animation_pathPointer",tagName:u.tagName,d:u.d});const d=Sct({tagName:"g",transform:"translate(100,100)"});this._knobOuter=Sct({tagName:"circle",class:"cesium-animation-knobOuter",cx:0,cy:0,r:71});const f=61,p=Sct({tagName:"circle",class:"cesium-animation-knobInner",cx:0,cy:0,r:f});this._knobDate=Ict(0,-24,""),this._knobTime=Ict(0,-7,""),this._knobStatus=Ict(0,-41,"");const m=Sct({tagName:"circle",class:"cesium-animation-blank",cx:0,cy:0,r:f}),_=document.createElementNS(pct,"g");_.setAttribute("class","cesium-animation-shuttleRingG"),e.appendChild(o),s.appendChild(_),s.appendChild(d),s.appendChild(a),_.appendChild(c),_.appendChild(h),_.appendChild(this._shuttleRingPointer),d.appendChild(this._knobOuter),d.appendChild(p),d.appendChild(this._knobDate),d.appendChild(this._knobTime),d.appendChild(this._knobStatus),d.appendChild(m),r.appendChild(s),e.appendChild(r);const g=this;function y(e){Mct(g,e)}this._mouseCallback=y,c.addEventListener("mousedown",y,!0),c.addEventListener("touchstart",y,!0),h.addEventListener("mousedown",y,!0),h.addEventListener("touchstart",y,!0),n.addEventListener("mousemove",y,!0),n.addEventListener("touchmove",y,!0),n.addEventListener("mouseup",y,!0),n.addEventListener("touchend",y,!0),n.addEventListener("touchcancel",y,!0),this._shuttleRingPointer.addEventListener("mousedown",y,!0),this._shuttleRingPointer.addEventListener("touchstart",y,!0),this._knobOuter.addEventListener("mousedown",y,!0),this._knobOuter.addEventListener("touchstart",y,!0);const v=this._knobTime.childNodes[0],b=this._knobDate.childNodes[0],A=this._knobStatus.childNodes[0];let w;this._subscriptions=[Zat(t.pauseViewModel,"toggled",(function(e){w!==e&&(w=e,w?g._shuttleRingPointer.setAttribute("class","cesium-animation-shuttleRingPausePointer"):g._shuttleRingPointer.setAttribute("class","cesium-animation-shuttleRingPointer"))})),Zat(t,"shuttleRingAngle",(function(e){Oct(g._shuttleRingPointer,g._knobOuter,e)})),Zat(t,"dateLabel",(function(e){b.textContent!==e&&(b.textContent=e)})),Zat(t,"timeLabel",(function(e){v.textContent!==e&&(v.textContent=e)})),Zat(t,"multiplierLabel",(function(e){A.textContent!==e&&(A.textContent=e)}))],this.applyThemeChanges(),this.resize()}Bct.prototype.destroy=function(){this.svgElement.removeEventListener("click",this._clickFunction,!0);const e=this._subscriptions;for(let t=0,n=e.length;t<n;t++)e[t].dispose();Qh(this)},Bct.prototype.isDestroyed=function(){return!1},Bct.prototype.setEnabled=function(e){if(this._enabled!==e){if(this._enabled=e,!e)return void this.svgElement.setAttribute("class","cesium-animation-buttonDisabled");if(this._toggled)return void this.svgElement.setAttribute("class","cesium-animation-rectButton cesium-animation-buttonToggled");this.svgElement.setAttribute("class","cesium-animation-rectButton")}},Bct.prototype.setToggled=function(e){this._toggled!==e&&(this._toggled=e,this._enabled&&(e?this.svgElement.setAttribute("class","cesium-animation-rectButton cesium-animation-buttonToggled"):this.svgElement.setAttribute("class","cesium-animation-rectButton")))},Bct.prototype.setTooltip=function(e){this.svgElement.getElementsByTagName("title")[0].textContent=e},Object.defineProperties(Nct.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),Nct.prototype.isDestroyed=function(){return!1},Nct.prototype.destroy=function(){C(this._observer)&&(this._observer.disconnect(),this._observer=void 0);const e=this._container.ownerDocument,t=this._mouseCallback;this._shuttleRingBackPanel.removeEventListener("mousedown",t,!0),this._shuttleRingBackPanel.removeEventListener("touchstart",t,!0),this._shuttleRingSwooshG.removeEventListener("mousedown",t,!0),this._shuttleRingSwooshG.removeEventListener("touchstart",t,!0),e.removeEventListener("mousemove",t,!0),e.removeEventListener("touchmove",t,!0),e.removeEventListener("mouseup",t,!0),e.removeEventListener("touchend",t,!0),e.removeEventListener("touchcancel",t,!0),this._shuttleRingPointer.removeEventListener("mousedown",t,!0),this._shuttleRingPointer.removeEventListener("touchstart",t,!0),this._knobOuter.removeEventListener("mousedown",t,!0),this._knobOuter.removeEventListener("touchstart",t,!0),this._container.removeChild(this._svgNode),this._container.removeChild(this._theme),this._realtimeSVG.destroy(),this._playReverseSVG.destroy(),this._playForwardSVG.destroy(),this._pauseSVG.destroy();const n=this._subscriptions;for(let i=0,o=n.length;i<o;i++)n[i].dispose();return Qh(this)},Nct.prototype.resize=function(){const e=this._container.clientWidth,t=this._container.clientHeight;if(e===this._lastWidth&&t===this._lastHeight)return;const n=this._svgNode,i=200,o=132;let r=e,s=t;0===e&&0===t?(r=i,s=o):0===e?(s=t,r=i*(t/o)):0===t&&(r=e,s=o*(e/i));const a=r/i,c=s/o;n.style.cssText=`width: ${r}px; height: ${s}px; position: absolute; bottom: 0; left: 0; overflow: hidden;`,n.setAttribute("width",r),n.setAttribute("height",s),n.setAttribute("viewBox",`0 0 ${r} ${s}`),this._topG.setAttribute("transform",`scale(${a},${c})`),this._centerX=Math.max(1,100*a),this._centerY=Math.max(1,100*c),this._lastHeight=e,this._lastWidth=t},Nct.prototype.applyThemeChanges=function(){const e=this._container.ownerDocument;if(!e.body.contains(this._container)){if(C(this._observer))return;const t=this;return t._observer=new MutationObserver((function(){e.body.contains(t._container)&&(t._observer.disconnect(),t._observer=void 0,t.applyThemeChanges())})),void t._observer.observe(e,{childList:!0,subtree:!0})}const t=Ect(this._themeNormal),n=Ect(this._themeHover),i=Ect(this._themeSelect),o=Ect(this._themeDisabled),r=Ect(this._themeKnob),s=Ect(this._themePointer),a=Ect(this._themeSwoosh),c=Ect(this._themeSwooshHover),l=Sct({tagName:"defs",children:[{id:"animation_buttonNormal",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":Pct(t,gct)},{tagName:"stop",offset:"12%","stop-color":Pct(t,yct)},{tagName:"stop",offset:"46%","stop-color":Pct(t,vct)},{tagName:"stop",offset:"81%","stop-color":Pct(t,bct)}]},{id:"animation_buttonHovered",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":Pct(n,gct)},{tagName:"stop",offset:"12%","stop-color":Pct(n,yct)},{tagName:"stop",offset:"46%","stop-color":Pct(n,vct)},{tagName:"stop",offset:"81%","stop-color":Pct(n,bct)}]},{id:"animation_buttonToggled",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":Pct(i,gct)},{tagName:"stop",offset:"12%","stop-color":Pct(i,yct)},{tagName:"stop",offset:"46%","stop-color":Pct(i,vct)},{tagName:"stop",offset:"81%","stop-color":Pct(i,bct)}]},{id:"animation_buttonDisabled",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":Pct(o,Act)},{tagName:"stop",offset:"75%","stop-color":Pct(o,wct)}]},{id:"animation_blurred",tagName:"filter",width:"200%",height:"200%",x:"-50%",y:"-50%",children:[{tagName:"feGaussianBlur",stdDeviation:4,in:"SourceGraphic"}]},{id:"animation_shuttleRingSwooshGradient",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-opacity":.2,"stop-color":a.toCssColorString()},{tagName:"stop",offset:"85%","stop-opacity":.85,"stop-color":a.toCssColorString()},{tagName:"stop",offset:"95%","stop-opacity":.05,"stop-color":a.toCssColorString()}]},{id:"animation_shuttleRingSwooshHovered",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-opacity":.2,"stop-color":c.toCssColorString()},{tagName:"stop",offset:"85%","stop-opacity":.85,"stop-color":c.toCssColorString()},{tagName:"stop",offset:"95%","stop-opacity":.05,"stop-color":c.toCssColorString()}]},{id:"animation_shuttleRingPointerGradient",tagName:"linearGradient",x1:"0%",y1:"50%",x2:"100%",y2:"50%",children:[{tagName:"stop",offset:"0%","stop-color":s.toCssColorString()},{tagName:"stop",offset:"40%","stop-color":s.toCssColorString()},{tagName:"stop",offset:"60%","stop-color":Pct(s,Cct)},{tagName:"stop",offset:"100%","stop-color":Pct(s,Cct)}]},{id:"animation_shuttleRingPointerPaused",tagName:"linearGradient",x1:"0%",y1:"50%",x2:"100%",y2:"50%",children:[{tagName:"stop",offset:"0%","stop-color":"#CCC"},{tagName:"stop",offset:"40%","stop-color":"#CCC"},{tagName:"stop",offset:"60%","stop-color":"#555"},{tagName:"stop",offset:"100%","stop-color":"#555"}]},{id:"animation_knobOuter",tagName:"linearGradient",x1:"20%",y1:"0%",x2:"90%",y2:"100%",children:[{tagName:"stop",offset:"5%","stop-color":Pct(r,gct)},{tagName:"stop",offset:"60%","stop-color":Pct(r,Tct)},{tagName:"stop",offset:"85%","stop-color":Pct(r,yct)}]},{id:"animation_knobInner",tagName:"linearGradient",x1:"20%",y1:"0%",x2:"90%",y2:"100%",children:[{tagName:"stop",offset:"5%","stop-color":Pct(r,Tct)},{tagName:"stop",offset:"60%","stop-color":Pct(r,gct)},{tagName:"stop",offset:"85%","stop-color":Pct(r,bct)}]}]});C(this._defsElement)?this._svgNode.replaceChild(l,this._defsElement):this._svgNode.appendChild(l),this._defsElement=l};var Fct=Nct;const zct=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],kct=15,Uct=105;function Vct(e,t){return e-t}function Hct(e,t){const n=qs(t,e,Vct);return n<0?~n:n}function Gct(e,t){if(Math.abs(e)<=kct)return e/kct;const n=kct,i=Uct;let o;const r=0;let s;return e>0?(o=Math.log(t[t.length-1]),s=(o-r)/(i-n),Math.exp(r+s*(e-n))):(o=Math.log(-t[0]),s=(o-r)/(i-n),-Math.exp(r+s*(Math.abs(e)-n)))}function Wct(e,t,n){if(n.clockStep===dy.SYSTEM_CLOCK)return kct;if(Math.abs(e)<=1)return e*kct;const i=t[t.length-1];e>i?e=i:e<-i&&(e=-i);const o=kct,r=Uct;let s;const a=0;let c;return e>0?(s=Math.log(i),c=(s-a)/(r-o),(Math.log(e)-a)/c+o):(s=Math.log(-t[0]),c=(s-a)/(r-o),-((Math.log(Math.abs(e))-a)/c+o))}function qct(e){if(!C(e))throw new x("clockViewModel is required.");const t=this;this._clockViewModel=e,this._allShuttleRingTicks=[],this._dateFormatter=qct.defaultDateFormatter,this._timeFormatter=qct.defaultTimeFormatter,this.shuttleRingDragging=!1,this.snapToTicks=!1,vrt.track(this,["_allShuttleRingTicks","_dateFormatter","_timeFormatter","shuttleRingDragging","snapToTicks"]),this._sortedFilteredPositiveTicks=[],this.setShuttleRingTicks(qct.defaultTicks),this.timeLabel=void 0,vrt.defineProperty(this,"timeLabel",(function(){return t._timeFormatter(t._clockViewModel.currentTime,t)})),this.dateLabel=void 0,vrt.defineProperty(this,"dateLabel",(function(){return t._dateFormatter(t._clockViewModel.currentTime,t)})),this.multiplierLabel=void 0,vrt.defineProperty(this,"multiplierLabel",(function(){const e=t._clockViewModel;if(e.clockStep===dy.SYSTEM_CLOCK)return"Today";const n=e.multiplier;return n%1===0?`${n.toFixed(0)}x`:`${n.toFixed(3).replace(/0{0,3}$/,"")}x`})),this.shuttleRingAngle=void 0,vrt.defineProperty(this,"shuttleRingAngle",{get:function(){return Wct(e.multiplier,t._allShuttleRingTicks,e)},set:function(e){e=Math.max(Math.min(e,Uct),-Uct);const n=t._allShuttleRingTicks,i=t._clockViewModel;if(i.clockStep=dy.SYSTEM_CLOCK_MULTIPLIER,Math.abs(e)===Uct)return void(i.multiplier=e>0?n[n.length-1]:n[0]);let o=Gct(e,n);if(t.snapToTicks)o=n[Hct(o,n)];else if(0!==o){const e=Math.abs(o);if(e>100){const t=e.toFixed(0).length-2,n=Math.pow(10,t);o=Math.round(o/n)*n|0}else e>kct?o=Math.round(o):e>1?o=+o.toFixed(1):e>0&&(o=+o.toFixed(2))}i.multiplier=o}}),this._canAnimate=void 0,vrt.defineProperty(this,"_canAnimate",(function(){const e=t._clockViewModel,n=e.clockRange;if(t.shuttleRingDragging||n===uy.UNBOUNDED)return!0;const i=e.multiplier,o=e.currentTime,r=e.startTime;let s=!1;if(n===uy.LOOP_STOP)s=Ea.greaterThan(o,r)||o.equals(r)&&i>0;else{const t=e.stopTime;s=Ea.greaterThan(o,r)&&Ea.lessThan(o,t)||o.equals(r)&&i>0||o.equals(t)&&i<0}return s||(e.shouldAnimate=!1),s})),this._isSystemTimeAvailable=void 0,vrt.defineProperty(this,"_isSystemTimeAvailable",(function(){const e=t._clockViewModel,n=e.clockRange;if(n===uy.UNBOUNDED)return!0;const i=e.systemTime;return Ea.greaterThanOrEquals(i,e.startTime)&&Ea.lessThanOrEquals(i,e.stopTime)})),this._isAnimating=void 0,vrt.defineProperty(this,"_isAnimating",(function(){return t._clockViewModel.shouldAnimate&&(t._canAnimate||t.shuttleRingDragging)}));const n=Qat((function(){const e=t._clockViewModel;e.shouldAnimate?e.shouldAnimate=!1:t._canAnimate&&(e.shouldAnimate=!0)}));this._pauseViewModel=new Kat(n,{toggled:vrt.computed((function(){return!t._isAnimating})),tooltip:"Pause"});const i=Qat((function(){const e=t._clockViewModel,n=e.multiplier;n>0&&(e.multiplier=-n),e.shouldAnimate=!0}));this._playReverseViewModel=new Kat(i,{toggled:vrt.computed((function(){return t._isAnimating&&e.multiplier<0})),tooltip:"Play Reverse"});const o=Qat((function(){const e=t._clockViewModel,n=e.multiplier;n<0&&(e.multiplier=-n),e.shouldAnimate=!0}));this._playForwardViewModel=new Kat(o,{toggled:vrt.computed((function(){return t._isAnimating&&e.multiplier>0&&e.clockStep!==dy.SYSTEM_CLOCK})),tooltip:"Play Forward"});const r=Qat((function(){t._clockViewModel.clockStep=dy.SYSTEM_CLOCK}),vrt.getObservable(this,"_isSystemTimeAvailable"));this._playRealtimeViewModel=new Kat(r,{toggled:vrt.computed((function(){return e.clockStep===dy.SYSTEM_CLOCK})),tooltip:vrt.computed((function(){return t._isSystemTimeAvailable?"Today (real-time)":"Current time not in range"}))}),this._slower=Qat((function(){const e=t._clockViewModel,n=t._allShuttleRingTicks,i=e.multiplier,o=Hct(i,n)-1;o>=0&&(e.multiplier=n[o])})),this._faster=Qat((function(){const e=t._clockViewModel,n=t._allShuttleRingTicks,i=e.multiplier,o=Hct(i,n)+1;o<n.length&&(e.multiplier=n[o])}))}qct.defaultDateFormatter=function(e,t){const n=Ea.toGregorianDate(e);return`${zct[n.month-1]} ${n.day} ${n.year}`},qct.defaultTicks=[.001,.002,.005,.01,.02,.05,.1,.25,.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600,7200,14400,21600,43200,86400,172800,345600,604800],qct.defaultTimeFormatter=function(e,t){const n=Ea.toGregorianDate(e),i=Math.round(n.millisecond);return Math.abs(t._clockViewModel.multiplier)<1?`${n.hour.toString().padStart(2,"0")}:${n.minute.toString().padStart(2,"0")}:${n.second.toString().padStart(2,"0")}.${i.toString().padStart(3,"0")}`:`${n.hour.toString().padStart(2,"0")}:${n.minute.toString().padStart(2,"0")}:${n.second.toString().padStart(2,"0")} UTC`},qct.prototype.getShuttleRingTicks=function(){return this._sortedFilteredPositiveTicks.slice(0)},qct.prototype.setShuttleRingTicks=function(e){if(!C(e))throw new x("positiveTicks is required.");let t,n,i;const o={},r=this._sortedFilteredPositiveTicks;for(r.length=0,t=0,n=e.length;t<n;++t)i=e[t],o.hasOwnProperty(i)||(o[i]=!0,r.push(i));r.sort(Vct);const s=[];for(n=r.length,t=n-1;t>=0;--t)i=r[t],0!==i&&s.push(-i);Array.prototype.push.apply(s,r),this._allShuttleRingTicks=s},Object.defineProperties(qct.prototype,{slower:{get:function(){return this._slower}},faster:{get:function(){return this._faster}},clockViewModel:{get:function(){return this._clockViewModel}},pauseViewModel:{get:function(){return this._pauseViewModel}},playReverseViewModel:{get:function(){return this._playReverseViewModel}},playForwardViewModel:{get:function(){return this._playForwardViewModel}},playRealtimeViewModel:{get:function(){return this._playRealtimeViewModel}},dateFormatter:{get:function(){return this._dateFormatter},set:function(e){if("function"!==typeof e)throw new x("dateFormatter must be a function");this._dateFormatter=e}},timeFormatter:{get:function(){return this._timeFormatter},set:function(e){if("function"!==typeof e)throw new x("timeFormatter must be a function");this._timeFormatter=e}}}),qct._maxShuttleRingAngle=Uct,qct._realtimeShuttleRingAngle=kct;var jct=qct;function Yct(e){e=R(e,R.EMPTY_OBJECT);const t=e.globe,n=R(e.imageryProviderViewModels,[]),i=R(e.terrainProviderViewModels,[]);if(!C(t))throw new x("globe is required");this._globe=t,this.imageryProviderViewModels=n.slice(0),this.terrainProviderViewModels=i.slice(0),this.dropDownVisible=!1,vrt.track(this,["imageryProviderViewModels","terrainProviderViewModels","dropDownVisible"]);const o=vrt.getObservable(this,"imageryProviderViewModels"),r=vrt.pureComputed((function(){const e=o(),t={};let n;for(n=0;n<e.length;n++){const i=e[n],o=i.category;C(t[o])?t[o].push(i):t[o]=[i]}const i=Object.keys(t),r=[];for(n=0;n<i.length;n++){const e=i[n];r.push({name:e,providers:t[e]})}return r}));this._imageryProviders=r;const s=vrt.getObservable(this,"terrainProviderViewModels"),a=vrt.pureComputed((function(){const e=s(),t={};let n;for(n=0;n<e.length;n++){const i=e[n],o=i.category;C(t[o])?t[o].push(i):t[o]=[i]}const i=Object.keys(t),o=[];for(n=0;n<i.length;n++){const e=i[n];o.push({name:e,providers:t[e]})}return o}));this._terrainProviders=a,this.buttonTooltip=void 0,vrt.defineProperty(this,"buttonTooltip",(function(){const e=this.selectedImagery,t=this.selectedTerrain,n=C(e)?e.name:void 0,i=C(t)?t.name:void 0;return C(n)&&C(i)?`${n}\n${i}`:C(n)?n:i})),this.buttonImageUrl=void 0,vrt.defineProperty(this,"buttonImageUrl",(function(){const e=this.selectedImagery;if(C(e))return e.iconUrl})),this.selectedImagery=void 0;const c=vrt.observable();this._currentImageryProviders=[],vrt.defineProperty(this,"selectedImagery",{get:function(){return c()},set:function(e){if(c()===e)return void(this.dropDownVisible=!1);let t;const n=this._currentImageryProviders,i=n.length,o=this._globe.imageryLayers;let r=!1;for(t=0;t<i;t++){const e=o.length;for(let i=0;i<e;i++){const e=o.get(i);if(e.imageryProvider===n[t]){o.remove(e),r=!0;break}}}if(C(e)){const n=e.creationCommand();if(Array.isArray(n)){const e=n.length;for(t=e-1;t>=0;t--)o.addImageryProvider(n[t],0);this._currentImageryProviders=n.slice(0)}else if(this._currentImageryProviders=[n],r)o.addImageryProvider(n,0);else{const e=o.get(0);C(e)&&o.remove(e),o.addImageryProvider(n,0)}}c(e),this.dropDownVisible=!1}}),this.selectedTerrain=void 0;const l=vrt.observable();vrt.defineProperty(this,"selectedTerrain",{get:function(){return l()},set:function(e){if(l()===e)return void(this.dropDownVisible=!1);let t;C(e)&&(t=e.creationCommand()),this._globe.depthTestAgainstTerrain=!(t instanceof DC),this._globe.terrainProvider=t,l(e),this.dropDownVisible=!1}});const u=this;this._toggleDropDown=Qat((function(){u.dropDownVisible=!u.dropDownVisible})),this.selectedImagery=R(e.selectedImageryProviderViewModel,n[0]),this.selectedTerrain=R(e.selectedTerrainProviderViewModel,i[0])}Object.defineProperties(Yct.prototype,{toggleDropDown:{get:function(){return this._toggleDropDown}},globe:{get:function(){return this._globe}}});var Kct=Yct;function Xct(e,t){if(!C(e))throw new x("container is required.");e=Uke(e);const n=new Kct(t),i=document.createElement("button");i.type="button",i.className="cesium-button cesium-toolbar-button",i.setAttribute("data-bind","attr: { title: buttonTooltip },click: toggleDropDown"),e.appendChild(i);const o=document.createElement("img");o.setAttribute("draggable","false"),o.className="cesium-baseLayerPicker-selected",o.setAttribute("data-bind","attr: { src: buttonImageUrl }, visible: !!buttonImageUrl"),i.appendChild(o);const r=document.createElement("div");r.className="cesium-baseLayerPicker-dropDown",r.setAttribute("data-bind",'css: { "cesium-baseLayerPicker-dropDown-visible" : dropDownVisible }'),e.appendChild(r);const s=document.createElement("div");s.className="cesium-baseLayerPicker-sectionTitle",s.setAttribute("data-bind","visible: imageryProviderViewModels.length > 0"),s.innerHTML="Imagery",r.appendChild(s);const a=document.createElement("div");a.className="cesium-baseLayerPicker-section",a.setAttribute("data-bind","foreach: _imageryProviders"),r.appendChild(a);const c=document.createElement("div");c.className="cesium-baseLayerPicker-category",a.appendChild(c);const l=document.createElement("div");l.className="cesium-baseLayerPicker-categoryTitle",l.setAttribute("data-bind","text: name"),c.appendChild(l);const u=document.createElement("div");u.className="cesium-baseLayerPicker-choices",u.setAttribute("data-bind","foreach: providers"),c.appendChild(u);const h=document.createElement("div");h.className="cesium-baseLayerPicker-item",h.setAttribute("data-bind",'css: { "cesium-baseLayerPicker-selectedItem" : $data === $parents[1].selectedImagery },attr: { title: tooltip },visible: creationCommand.canExecute,click: function($data) { $parents[1].selectedImagery = $data; }'),u.appendChild(h);const d=document.createElement("img");d.className="cesium-baseLayerPicker-itemIcon",d.setAttribute("data-bind","attr: { src: iconUrl }"),d.setAttribute("draggable","false"),h.appendChild(d);const f=document.createElement("div");f.className="cesium-baseLayerPicker-itemLabel",f.setAttribute("data-bind","text: name"),h.appendChild(f);const p=document.createElement("div");p.className="cesium-baseLayerPicker-sectionTitle",p.setAttribute("data-bind","visible: terrainProviderViewModels.length > 0"),p.innerHTML="Terrain",r.appendChild(p);const m=document.createElement("div");m.className="cesium-baseLayerPicker-section",m.setAttribute("data-bind","foreach: _terrainProviders"),r.appendChild(m);const _=document.createElement("div");_.className="cesium-baseLayerPicker-category",m.appendChild(_);const g=document.createElement("div");g.className="cesium-baseLayerPicker-categoryTitle",g.setAttribute("data-bind","text: name"),_.appendChild(g);const y=document.createElement("div");y.className="cesium-baseLayerPicker-choices",y.setAttribute("data-bind","foreach: providers"),_.appendChild(y);const v=document.createElement("div");v.className="cesium-baseLayerPicker-item",v.setAttribute("data-bind",'css: { "cesium-baseLayerPicker-selectedItem" : $data === $parents[1].selectedTerrain },attr: { title: tooltip },visible: creationCommand.canExecute,click: function($data) { $parents[1].selectedTerrain = $data; }'),y.appendChild(v);const b=document.createElement("img");b.className="cesium-baseLayerPicker-itemIcon",b.setAttribute("data-bind","attr: { src: iconUrl }"),b.setAttribute("draggable","false"),v.appendChild(b);const A=document.createElement("div");A.className="cesium-baseLayerPicker-itemLabel",A.setAttribute("data-bind","text: name"),v.appendChild(A),vrt.applyBindings(n,i),vrt.applyBindings(n,r),this._viewModel=n,this._container=e,this._element=i,this._dropPanel=r,this._closeDropDown=function(e){i.contains(e.target)||r.contains(e.target)||(n.dropDownVisible=!1)},Oc.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeDropDown,!0):(document.addEventListener("mousedown",this._closeDropDown,!0),document.addEventListener("touchstart",this._closeDropDown,!0))}Object.defineProperties(Xct.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),Xct.prototype.isDestroyed=function(){return!1},Xct.prototype.destroy=function(){return Oc.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeDropDown,!0):(document.removeEventListener("mousedown",this._closeDropDown,!0),document.removeEventListener("touchstart",this._closeDropDown,!0)),vrt.cleanNode(this._element),vrt.cleanNode(this._dropPanel),this._container.removeChild(this._element),this._container.removeChild(this._dropPanel),Qh(this)};var Qct=Xct;function Jct(e){if(!C(e.name))throw new x("options.name is required.");if(!C(e.tooltip))throw new x("options.tooltip is required.");if(!C(e.iconUrl))throw new x("options.iconUrl is required.");if("function"!==typeof e.creationFunction)throw new x("options.creationFunction is required.");let t=e.creationFunction;C(t.canExecute)||(t=Qat(t)),this._creationCommand=t,this.name=e.name,this.tooltip=e.tooltip,this.iconUrl=e.iconUrl,this._category=R(e.category,""),vrt.track(this,["name","tooltip","iconUrl"])}Object.defineProperties(Jct.prototype,{creationCommand:{get:function(){return this._creationCommand}},category:{get:function(){return this._category}}});var Zct=Jct;function $ct(){const e=[];return e.push(new Zct({name:"Bing Maps Aerial",iconUrl:Zi("Widgets/Images/ImageryProviders/bingAerial.png"),tooltip:"Bing Maps aerial imagery, provided by Cesium ion",category:"Cesium ion",creationFunction:function(){return Zot({style:I3e.AERIAL})}})),e.push(new Zct({name:"Bing Maps Aerial with Labels",iconUrl:Zi("Widgets/Images/ImageryProviders/bingAerialLabels.png"),tooltip:"Bing Maps aerial imagery with labels, provided by Cesium ion",category:"Cesium ion",creationFunction:function(){return Zot({style:I3e.AERIAL_WITH_LABELS})}})),e.push(new Zct({name:"Bing Maps Roads",iconUrl:Zi("Widgets/Images/ImageryProviders/bingRoads.png"),tooltip:"Bing Maps standard road maps, provided by Cesium ion",category:"Cesium ion",creationFunction:function(){return Zot({style:I3e.ROAD})}})),e.push(new Zct({name:"ESRI World Imagery",iconUrl:Zi("Widgets/Images/ImageryProviders/esriWorldImagery.png"),tooltip:"World Imagery provides one meter or better satellite and aerial imagery in many parts of the world and lower resolution satellite imagery worldwide.  The map includes NASA Blue Marble: Next Generation 500m resolution imagery at small scales (above 1:1,000,000), i-cubed 15m eSAT imagery at medium-to-large scales (down to 1:70,000) for the world, and USGS 15m Landsat imagery for Antarctica. The map features 0.3m resolution imagery in the continental United States and 0.6m resolution imagery in parts of Western Europe from DigitalGlobe. In other parts of the world, 1 meter resolution imagery is available from GeoEye IKONOS, i-cubed Nationwide Prime, Getmapping, AeroGRID, IGN Spain, and IGP Portugal.  Additionally, imagery at different resolutions has been contributed by the GIS User Community.\nhttp://www.esri.com",category:"Other",creationFunction:function(){return new rWe({url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",enablePickFeatures:!1})}})),e.push(new Zct({name:"ESRI World Street Map",iconUrl:Zi("Widgets/Images/ImageryProviders/esriWorldStreetMap.png"),tooltip:"This worldwide street map presents highway-level data for the world. Street-level data includes the United States; much of Canada; Japan; most countries in Europe; Australia and New Zealand; India; parts of South America including Argentina, Brazil, Chile, Colombia, and Venezuela; Ghana; and parts of southern Africa including Botswana, Lesotho, Namibia, South Africa, and Swaziland.\nhttp://www.esri.com",category:"Other",creationFunction:function(){return new rWe({url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",enablePickFeatures:!1})}})),e.push(new Zct({name:"ESRI National Geographic",iconUrl:Zi("Widgets/Images/ImageryProviders/esriNationalGeographic.png"),tooltip:"This web map contains the National Geographic World Map service. This map service is designed to be used as a general reference map for informational and educational purposes as well as a basemap by GIS professionals and other users for creating web maps and web mapping applications.\nhttp://www.esri.com",category:"Other",creationFunction:function(){return new rWe({url:"https://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/",enablePickFeatures:!1})}})),e.push(new Zct({name:"Open­Street­Map",iconUrl:Zi("Widgets/Images/ImageryProviders/openStreetMap.png"),tooltip:"OpenStreetMap (OSM) is a collaborative project to create a free editable map of the world.\nhttp://www.openstreetmap.org",category:"Other",creationFunction:function(){return new _4e({url:"https://a.tile.openstreetmap.org/"})}})),e.push(new Zct({name:"Stamen Watercolor",iconUrl:Zi("Widgets/Images/ImageryProviders/stamenWatercolor.png"),tooltip:"Reminiscent of hand drawn maps, Stamen watercolor maps apply raster effect area washes and organic edges over a paper texture to add warm pop to any map.\nhttp://maps.stamen.com",category:"Other",creationFunction:function(){return new _4e({url:"https://stamen-tiles.a.ssl.fastly.net/watercolor/",credit:"Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under CC BY SA."})}})),e.push(new Zct({name:"Stamen Toner",iconUrl:Zi("Widgets/Images/ImageryProviders/stamenToner.png"),tooltip:"A high contrast black and white map.\nhttp://maps.stamen.com",category:"Other",creationFunction:function(){return new _4e({url:"https://stamen-tiles.a.ssl.fastly.net/toner/",credit:"Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under CC BY SA."})}})),e.push(new Zct({name:"Sentinel-2",iconUrl:Zi("Widgets/Images/ImageryProviders/sentinel-2.png"),tooltip:"Sentinel-2 cloudless by EOX IT Services GmbH (Contains modified Copernicus Sentinel data 2016 and 2017).",category:"Cesium ion",creationFunction:function(){return new x3e({assetId:3954})}})),e.push(new Zct({name:"Blue Marble",iconUrl:Zi("Widgets/Images/ImageryProviders/blueMarble.png"),tooltip:"Blue Marble Next Generation July, 2004 imagery from NASA.",category:"Cesium ion",creationFunction:function(){return new x3e({assetId:3845})}})),e.push(new Zct({name:"Earth at night",iconUrl:Zi("Widgets/Images/ImageryProviders/earthAtNight.png"),tooltip:"The Earth at night, also known as The Black Marble, is a 500 meter resolution global composite imagery layer released by NASA.",category:"Cesium ion",creationFunction:function(){return new x3e({assetId:3812})}})),e.push(new Zct({name:"Natural Earth II",iconUrl:Zi("Widgets/Images/ImageryProviders/naturalEarthII.png"),tooltip:"Natural Earth II, darkened for contrast.\nhttp://www.naturalearthdata.com/",category:"Cesium ion",creationFunction:function(){return new $2e({url:Zi("Assets/Textures/NaturalEarthII")})}})),e}var elt=$ct;function tlt(){const e=[];return e.push(new Zct({name:"WGS84 Ellipsoid",iconUrl:Zi("Widgets/Images/TerrainProviders/Ellipsoid.png"),tooltip:"WGS84 standard ellipsoid, also known as EPSG:4326",category:"Cesium ion",creationFunction:function(){return new DC}})),e.push(new Zct({name:"Cesium World Terrain",iconUrl:Zi("Widgets/Images/TerrainProviders/CesiumWorldTerrain.png"),tooltip:"High-resolution global terrain tileset curated from several datasources and hosted by Cesium ion",category:"Cesium ion",creationFunction:function(){return OF({requestWaterMask:!0,requestVertexNormals:!0})}})),e}var nlt=tlt;function ilt(e){return function(t){const n=e._scene.pick(t.position);C(n)&&n.primitive instanceof wbe&&(e.tileset=n.primitive),e.pickActive=!1}}function olt(e,t){t?e._eventHandler.setInputAction((function(t){const n=e._scene.pick(t.endPosition);C(n)&&n.primitive instanceof wbe&&(e.tileset=n.primitive)}),JL.MOUSE_MOVE):(e._eventHandler.removeInputAction(JL.MOUSE_MOVE),e.picking=e.picking)}const rlt={maximumFractionDigits:3};function slt(e){const t=e/1048576;return t<1?t.toLocaleString(void 0,rlt):Math.round(t).toLocaleString()}function alt(e,t){if(!C(e))return"";const n=t?e._statisticsPerPass[ige.PICK]:e._statisticsPerPass[ige.RENDER];let i='<ul class="cesium-cesiumInspector-statistics">';return i+=`<li><strong>Visited: </strong>${n.visited.toLocaleString()}</li><li><strong>Selected: </strong>${n.selected.toLocaleString()}</li><li><strong>Commands: </strong>${n.numberOfCommands.toLocaleString()}</li>`,i+="</ul>",t||(i+='<ul class="cesium-cesiumInspector-statistics">',i+=`<li><strong>Requests: </strong>${n.numberOfPendingRequests.toLocaleString()}</li><li><strong>Attempted: </strong>${n.numberOfAttemptedRequests.toLocaleString()}</li><li><strong>Processing: </strong>${n.numberOfTilesProcessing.toLocaleString()}</li><li><strong>Content Ready: </strong>${n.numberOfTilesWithContentReady.toLocaleString()}</li><li><strong>Total: </strong>${n.numberOfTilesTotal.toLocaleString()}</li>`,i+="</ul>",i+='<ul class="cesium-cesiumInspector-statistics">',i+=`<li><strong>Features Selected: </strong>${n.numberOfFeaturesSelected.toLocaleString()}</li><li><strong>Features Loaded: </strong>${n.numberOfFeaturesLoaded.toLocaleString()}</li><li><strong>Points Selected: </strong>${n.numberOfPointsSelected.toLocaleString()}</li><li><strong>Points Loaded: </strong>${n.numberOfPointsLoaded.toLocaleString()}</li><li><strong>Triangles Selected: </strong>${n.numberOfTrianglesSelected.toLocaleString()}</li>`,i+="</ul>",i+='<ul class="cesium-cesiumInspector-statistics">',i+=`<li><strong>Tiles styled: </strong>${n.numberOfTilesStyled.toLocaleString()}</li><li><strong>Features styled: </strong>${n.numberOfFeaturesStyled.toLocaleString()}</li>`,i+="</ul>",i+='<ul class="cesium-cesiumInspector-statistics">',i+=`<li><strong>Children Union Culled: </strong>${n.numberOfTilesCulledWithChildrenUnion.toLocaleString()}</li>`,i+="</ul>",i+='<ul class="cesium-cesiumInspector-statistics">',i+=`<li><strong>Geometry Memory (MB): </strong>${slt(n.geometryByteLength)}</li><li><strong>Texture Memory (MB): </strong>${slt(n.texturesByteLength)}</li><li><strong>Batch Table Memory (MB): </strong>${slt(n.batchTableByteLength)}</li>`,i+="</ul>"),i}const clt=[{text:"Highlight",value:NJ.HIGHLIGHT},{text:"Replace",value:NJ.REPLACE},{text:"Mix",value:NJ.MIX}],llt=new xy(1,1,0,.4),ult=new xy,hlt=new xy;function dlt(e,t){D.typeOf.object("scene",e),D.typeOf.object("performanceContainer",t);const n=this,i=e.canvas;this._eventHandler=new BM(i),this._scene=e,this._performanceContainer=t,this._canvas=i,this._performanceDisplay=new B4e({container:t}),this._statisticsText="",this._pickStatisticsText="",this._editorError="",this.performance=!1,this.showStatistics=!0,this.showPickStatistics=!0,this.inspectorVisible=!0,this.tilesetVisible=!1,this.displayVisible=!1,this.updateVisible=!1,this.loggingVisible=!1,this.styleVisible=!1,this.tileDebugLabelsVisible=!1,this.optimizationVisible=!1,this.styleString="{}",this._tileset=void 0,this._feature=void 0,this._tile=void 0,vrt.track(this,["performance","inspectorVisible","_statisticsText","_pickStatisticsText","_editorError","showPickStatistics","showStatistics","tilesetVisible","displayVisible","updateVisible","loggingVisible","styleVisible","optimizationVisible","tileDebugLabelsVisible","styleString","_feature","_tile"]),this._properties=vrt.observable({}),this.properties=[],vrt.defineProperty(this,"properties",(function(){const e=[],t=n._properties();for(const n in t)t.hasOwnProperty(n)&&e.push(n);return e}));const o=vrt.observable();vrt.defineProperty(this,"dynamicScreenSpaceError",{get:function(){return o()},set:function(e){o(e),C(n._tileset)&&(n._tileset.dynamicScreenSpaceError=e)}}),this.dynamicScreenSpaceError=!1;const r=vrt.observable();vrt.defineProperty(this,"colorBlendMode",{get:function(){return r()},set:function(e){r(e),C(n._tileset)&&(n._tileset.colorBlendMode=e,n._scene.requestRender())}}),this.colorBlendMode=NJ.HIGHLIGHT;const s=vrt.observable(),a=vrt.observable();vrt.defineProperty(this,"picking",{get:function(){return a()},set:function(t){a(t),t?n._eventHandler.setInputAction((function(t){const i=e.pick(t.endPosition);if(i instanceof hZ?(n.feature=i,n.tile=i.content.tile):C(i)&&C(i.content)?(n.feature=void 0,n.tile=i.content.tile):(n.feature=void 0,n.tile=void 0),C(n._tileset)){if(s&&C(i)&&C(i.content)){let o;e.pickPositionSupported&&(o=e.pickPosition(t.endPosition),C(o)&&(n._tileset.debugPickPosition=o)),n._tileset.debugPickedTile=i.content.tile}else n._tileset.debugPickedTile=void 0;n._scene.requestRender()}}),JL.MOUSE_MOVE):(n.feature=void 0,n.tile=void 0,n._eventHandler.removeInputAction(JL.MOUSE_MOVE))}}),this.picking=!0;const c=vrt.observable();vrt.defineProperty(this,"colorize",{get:function(){return c()},set:function(e){c(e),C(n._tileset)&&(n._tileset.debugColorizeTiles=e,n._scene.requestRender())}}),this.colorize=!1;const l=vrt.observable();vrt.defineProperty(this,"wireframe",{get:function(){return l()},set:function(e){l(e),C(n._tileset)&&(n._tileset.debugWireframe=e,n._scene.requestRender())}}),this.wireframe=!1;const u=vrt.observable();vrt.defineProperty(this,"showBoundingVolumes",{get:function(){return u()},set:function(e){u(e),C(n._tileset)&&(n._tileset.debugShowBoundingVolume=e,n._scene.requestRender())}}),this.showBoundingVolumes=!1;const h=vrt.observable();vrt.defineProperty(this,"showContentBoundingVolumes",{get:function(){return h()},set:function(e){h(e),C(n._tileset)&&(n._tileset.debugShowContentBoundingVolume=e,n._scene.requestRender())}}),this.showContentBoundingVolumes=!1;const d=vrt.observable();vrt.defineProperty(this,"showRequestVolumes",{get:function(){return d()},set:function(e){d(e),C(n._tileset)&&(n._tileset.debugShowViewerRequestVolume=e,n._scene.requestRender())}}),this.showRequestVolumes=!1;const f=vrt.observable();vrt.defineProperty(this,"freezeFrame",{get:function(){return f()},set:function(e){f(e),C(n._tileset)&&(n._tileset.debugFreezeFrame=e,n._scene.debugShowFrustumPlanes=e,n._scene.requestRender())}}),this.freezeFrame=!1,vrt.defineProperty(this,"showOnlyPickedTileDebugLabel",{get:function(){return s()},set:function(e){s(e),C(n._tileset)&&(n._tileset.debugPickedTileLabelOnly=e,n._scene.requestRender())}}),this.showOnlyPickedTileDebugLabel=!1;const p=vrt.observable();vrt.defineProperty(this,"showGeometricError",{get:function(){return p()},set:function(e){p(e),C(n._tileset)&&(n._tileset.debugShowGeometricError=e,n._scene.requestRender())}}),this.showGeometricError=!1;const m=vrt.observable();vrt.defineProperty(this,"showRenderingStatistics",{get:function(){return m()},set:function(e){m(e),C(n._tileset)&&(n._tileset.debugShowRenderingStatistics=e,n._scene.requestRender())}}),this.showRenderingStatistics=!1;const _=vrt.observable();vrt.defineProperty(this,"showMemoryUsage",{get:function(){return _()},set:function(e){_(e),C(n._tileset)&&(n._tileset.debugShowMemoryUsage=e,n._scene.requestRender())}}),this.showMemoryUsage=!1;const g=vrt.observable();vrt.defineProperty(this,"showUrl",{get:function(){return g()},set:function(e){g(e),C(n._tileset)&&(n._tileset.debugShowUrl=e,n._scene.requestRender())}}),this.showUrl=!1;const y=vrt.observable();vrt.defineProperty(this,"maximumScreenSpaceError",{get:function(){return y()},set:function(e){e=Number(e),isNaN(e)||(y(e),C(n._tileset)&&(n._tileset.maximumScreenSpaceError=e))}}),this.maximumScreenSpaceError=16;const v=vrt.observable();vrt.defineProperty(this,"dynamicScreenSpaceErrorDensity",{get:function(){return v()},set:function(e){e=Number(e),isNaN(e)||(v(e),C(n._tileset)&&(n._tileset.dynamicScreenSpaceErrorDensity=e))}}),this.dynamicScreenSpaceErrorDensity=.00278,this.dynamicScreenSpaceErrorDensitySliderValue=void 0,vrt.defineProperty(this,"dynamicScreenSpaceErrorDensitySliderValue",{get:function(){return Math.pow(v(),1/6)},set:function(e){v(Math.pow(e,6))}});const b=vrt.observable();vrt.defineProperty(this,"dynamicScreenSpaceErrorFactor",{get:function(){return b()},set:function(e){e=Number(e),isNaN(e)||(b(e),C(n._tileset)&&(n._tileset.dynamicScreenSpaceErrorFactor=e))}}),this.dynamicScreenSpaceErrorFactor=4;const A=ilt(this),w=vrt.observable();vrt.defineProperty(this,"pickActive",{get:function(){return w()},set:function(e){w(e),e?n._eventHandler.setInputAction(A,JL.LEFT_CLICK):n._eventHandler.removeInputAction(JL.LEFT_CLICK)}});const T=vrt.observable();vrt.defineProperty(this,"pointCloudShading",{get:function(){return T()},set:function(e){T(e),C(n._tileset)&&(n._tileset.pointCloudShading.attenuation=e)}}),this.pointCloudShading=!1;const E=vrt.observable();vrt.defineProperty(this,"geometricErrorScale",{get:function(){return E()},set:function(e){e=Number(e),isNaN(e)||(E(e),C(n._tileset)&&(n._tileset.pointCloudShading.geometricErrorScale=e))}}),this.geometricErrorScale=1;const x=vrt.observable();vrt.defineProperty(this,"maximumAttenuation",{get:function(){return x()},set:function(e){e=Number(e),isNaN(e)||(x(e),C(n._tileset)&&(n._tileset.pointCloudShading.maximumAttenuation=0===e?void 0:e))}}),this.maximumAttenuation=0;const S=vrt.observable();vrt.defineProperty(this,"baseResolution",{get:function(){return S()},set:function(e){e=Number(e),isNaN(e)||(S(e),C(n._tileset)&&(n._tileset.pointCloudShading.baseResolution=0===e?void 0:e))}}),this.baseResolution=0;const I=vrt.observable();vrt.defineProperty(this,"eyeDomeLighting",{get:function(){return I()},set:function(e){I(e),C(n._tileset)&&(n._tileset.pointCloudShading.eyeDomeLighting=e)}}),this.eyeDomeLighting=!1;const O=vrt.observable();vrt.defineProperty(this,"eyeDomeLightingStrength",{get:function(){return O()},set:function(e){e=Number(e),isNaN(e)||(O(e),C(n._tileset)&&(n._tileset.pointCloudShading.eyeDomeLightingStrength=e))}}),this.eyeDomeLightingStrength=1;const P=vrt.observable();vrt.defineProperty(this,"eyeDomeLightingRadius",{get:function(){return P()},set:function(e){e=Number(e),isNaN(e)||(P(e),C(n._tileset)&&(n._tileset.pointCloudShading.eyeDomeLightingRadius=e))}}),this.eyeDomeLightingRadius=1,this.pickActive=!1;const R=vrt.observable();vrt.defineProperty(this,"skipLevelOfDetail",{get:function(){return R()},set:function(e){R(e),C(n._tileset)&&(n._tileset.skipLevelOfDetail=e)}}),this.skipLevelOfDetail=!0;const L=vrt.observable();vrt.defineProperty(this,"skipScreenSpaceErrorFactor",{get:function(){return L()},set:function(e){e=Number(e),isNaN(e)||(L(e),C(n._tileset)&&(n._tileset.skipScreenSpaceErrorFactor=e))}}),this.skipScreenSpaceErrorFactor=16;const M=vrt.observable();vrt.defineProperty(this,"baseScreenSpaceError",{get:function(){return M()},set:function(e){e=Number(e),isNaN(e)||(M(e),C(n._tileset)&&(n._tileset.baseScreenSpaceError=e))}}),this.baseScreenSpaceError=1024;const B=vrt.observable();vrt.defineProperty(this,"skipLevels",{get:function(){return B()},set:function(e){e=Number(e),isNaN(e)||(B(e),C(n._tileset)&&(n._tileset.skipLevels=e))}}),this.skipLevels=1;const N=vrt.observable();vrt.defineProperty(this,"immediatelyLoadDesiredLevelOfDetail",{get:function(){return N()},set:function(e){N(e),C(n._tileset)&&(n._tileset.immediatelyLoadDesiredLevelOfDetail=e)}}),this.immediatelyLoadDesiredLevelOfDetail=!1;const F=vrt.observable();vrt.defineProperty(this,"loadSiblings",{get:function(){return F()},set:function(e){F(e),C(n._tileset)&&(n._tileset.loadSiblings=e)}}),this.loadSiblings=!1,this._style=void 0,this._shouldStyle=!1,this._definedProperties=["properties","dynamicScreenSpaceError","colorBlendMode","picking","colorize","wireframe","showBoundingVolumes","showContentBoundingVolumes","showRequestVolumes","freezeFrame","maximumScreenSpaceError","dynamicScreenSpaceErrorDensity","baseScreenSpaceError","skipScreenSpaceErrorFactor","skipLevelOfDetail","skipLevels","immediatelyLoadDesiredLevelOfDetail","loadSiblings","dynamicScreenSpaceErrorDensitySliderValue","dynamicScreenSpaceErrorFactor","pickActive","showOnlyPickedTileDebugLabel","showGeometricError","showRenderingStatistics","showMemoryUsage","showUrl","pointCloudShading","geometricErrorScale","maximumAttenuation","baseResolution","eyeDomeLighting","eyeDomeLightingStrength","eyeDomeLightingRadius"],this._removePostRenderEvent=e.postRender.addEventListener((function(){n._update()})),C(this._tileset)||olt(this,!0)}function flt(e){if(e.featuresLength>0)return!0;const t=e.innerContents;if(C(t)){const e=t.length;for(let n=0;n<e;++n)if(!flt(t[n]))return!1;return!0}return!1}Object.defineProperties(dlt.prototype,{scene:{get:function(){return this._scene}},performanceContainer:{get:function(){return this._performanceContainer}},statisticsText:{get:function(){return this._statisticsText}},pickStatisticsText:{get:function(){return this._pickStatisticsText}},colorBlendModes:{get:function(){return clt}},editorError:{get:function(){return this._editorError}},tileset:{get:function(){return this._tileset},set:function(e){if(this._tileset=e,this._style=void 0,this.styleString="{}",this.feature=void 0,this.tile=void 0,C(e)){const t=this;e.readyPromise.then((function(e){t.isDestroyed()||t._properties(e.properties)}));const n=["colorize","wireframe","showBoundingVolumes","showContentBoundingVolumes","showRequestVolumes","freezeFrame","showOnlyPickedTileDebugLabel","showGeometricError","showRenderingStatistics","showMemoryUsage","showUrl"],i=n.length;for(let e=0;e<i;++e){const t=n[e];this[t]=this[t]}this.maximumScreenSpaceError=e.maximumScreenSpaceError,this.dynamicScreenSpaceError=e.dynamicScreenSpaceError,this.dynamicScreenSpaceErrorDensity=e.dynamicScreenSpaceErrorDensity,this.dynamicScreenSpaceErrorFactor=e.dynamicScreenSpaceErrorFactor,this.colorBlendMode=e.colorBlendMode,this.skipLevelOfDetail=e.skipLevelOfDetail,this.skipScreenSpaceErrorFactor=e.skipScreenSpaceErrorFactor,this.baseScreenSpaceError=e.baseScreenSpaceError,this.skipLevels=e.skipLevels,this.immediatelyLoadDesiredLevelOfDetail=e.immediatelyLoadDesiredLevelOfDetail,this.loadSiblings=e.loadSiblings;const o=e.pointCloudShading;this.pointCloudShading=o.attenuation,this.geometricErrorScale=o.geometricErrorScale,this.maximumAttenuation=o.maximumAttenuation?o.maximumAttenuation:0,this.baseResolution=o.baseResolution?o.baseResolution:0,this.eyeDomeLighting=o.eyeDomeLighting,this.eyeDomeLightingStrength=o.eyeDomeLightingStrength,this.eyeDomeLightingRadius=o.eyeDomeLightingRadius,this._scene.requestRender()}else this._properties({});this._statisticsText=alt(e,!1),this._pickStatisticsText=alt(e,!0),olt(this,!1)}},feature:{get:function(){return this._feature},set:function(e){if(this._feature===e)return;const t=this._feature;C(t)&&!t.content.isDestroyed()&&(!this.colorize&&C(this._style)?t.color=C(this._style.color)?this._style.color.evaluateColor(t,ult):xy.WHITE:t.color=hlt,this._scene.requestRender()),C(e)&&(xy.clone(e.color,hlt),e.color=llt,this._scene.requestRender()),this._feature=e}},tile:{get:function(){return this._tile},set:function(e){if(this._tile===e)return;const t=this._tile;!C(t)||t.isDestroyed()||flt(t.content)||(t.color=hlt,this._scene.requestRender()),C(e)&&!flt(e.content)&&(xy.clone(e.color,hlt),e.color=llt,this._scene.requestRender()),this._tile=e}}}),dlt.prototype.togglePickTileset=function(){this.pickActive=!this.pickActive},dlt.prototype.toggleInspector=function(){this.inspectorVisible=!this.inspectorVisible},dlt.prototype.toggleTileset=function(){this.tilesetVisible=!this.tilesetVisible},dlt.prototype.toggleDisplay=function(){this.displayVisible=!this.displayVisible},dlt.prototype.toggleUpdate=function(){this.updateVisible=!this.updateVisible},dlt.prototype.toggleLogging=function(){this.loggingVisible=!this.loggingVisible},dlt.prototype.toggleStyle=function(){this.styleVisible=!this.styleVisible},dlt.prototype.toggleTileDebugLabels=function(){this.tileDebugLabelsVisible=!this.tileDebugLabelsVisible},dlt.prototype.toggleOptimization=function(){this.optimizationVisible=!this.optimizationVisible},dlt.prototype.trimTilesCache=function(){C(this._tileset)&&this._tileset.trimLoadedTiles()},dlt.prototype.compileStyle=function(){const e=this._tileset;if(C(e)&&this.styleString!==JSON.stringify(e.style)){this._editorError="";try{0===this.styleString.length&&(this.styleString="{}"),this._style=new jYe(JSON.parse(this.styleString)),this._shouldStyle=!0,this._scene.requestRender()}catch(t){this._editorError=t.toString()}this.feature=this._feature,this.tile=this._tile}},dlt.prototype.styleEditorKeyPress=function(e,t){if(9===t.keyCode){t.preventDefault();const e=t.target,n=e.selectionStart,i=e.selectionEnd;let o=i;const r=e.value.slice(n,i),s=r.split("\n"),a=s.length;let c;if(t.shiftKey)for(c=0;c<a;++c)" "===s[c][0]&&(" "===s[c][1]?(s[c]=s[c].substr(2),o-=2):(s[c]=s[c].substr(1),o-=1));else for(c=0;c<a;++c)s[c]=`  ${s[c]}`,o+=2;const l=s.join("\n");e.value=e.value.slice(0,n)+l+e.value.slice(i),e.selectionStart=n!==i?n:o,e.selectionEnd=o}else!t.ctrlKey||10!==t.keyCode&&13!==t.keyCode||this.compileStyle();return!0},dlt.prototype._update=function(){const e=this._tileset;if(this.performance&&this._performanceDisplay.update(),C(e)){if(e.isDestroyed())return this.tile=void 0,this.feature=void 0,void(this.tileset=void 0);const t=e.style;this._style!==e.style&&(this._shouldStyle?(e.style=this._style,this._shouldStyle=!1):(this._style=t,this.styleString=JSON.stringify(t.style,null,"  ")))}this.showStatistics&&(this._statisticsText=alt(e,!1),this._pickStatisticsText=alt(e,!0))},dlt.prototype.isDestroyed=function(){return!1},dlt.prototype.destroy=function(){this._eventHandler.destroy(),this._removePostRenderEvent();const e=this;return this._definedProperties.forEach((function(t){vrt.getObservable(e,t).dispose()})),Qh(this)},dlt.getStatistics=alt;var plt=dlt;function mlt(e,t){D.defined("container",e),D.typeOf.object("scene",t),e=Uke(e);const n=document.createElement("div"),i=document.createElement("div");i.setAttribute("data-bind","visible: performance");const o=new plt(t,i);this._viewModel=o,this._container=e,this._element=n;const r=document.createElement("div");r.textContent="3D Tiles Inspector",r.className="cesium-cesiumInspector-button",r.setAttribute("data-bind","click: toggleInspector"),n.appendChild(r),n.className="cesium-cesiumInspector cesium-3DTilesInspector",n.setAttribute("data-bind",'css: { "cesium-cesiumInspector-visible" : inspectorVisible, "cesium-cesiumInspector-hidden" : !inspectorVisible}'),e.appendChild(n);const s=document.createElement("div");this._panel=s,s.className="cesium-cesiumInspector-dropDown",n.appendChild(s);const a=jat.createSection,c=jat.createCheckbox,l=a(s,"Tileset","tilesetVisible","toggleTileset"),u=a(s,"Display","displayVisible","toggleDisplay"),h=a(s,"Update","updateVisible","toggleUpdate"),d=a(s,"Logging","loggingVisible","toggleLogging"),f=a(s,"Tile Debug Labels","tileDebugLabelsVisible","toggleTileDebugLabels"),p=a(s,"Style","styleVisible","toggleStyle"),m=a(s,"Optimization","optimizationVisible","toggleOptimization"),_=document.createElement("div");_.className="field-group";const g=document.createElement("label");g.className="field-label",g.appendChild(document.createTextNode("Properties: "));const y=document.createElement("div");y.setAttribute("data-bind","text: properties"),_.appendChild(g),_.appendChild(y),l.appendChild(_),l.appendChild(glt("togglePickTileset","Pick Tileset","pickActive")),l.appendChild(glt("trimTilesCache","Trim Tiles Cache")),l.appendChild(c("Enable Picking","picking")),u.appendChild(c("Colorize","colorize")),u.appendChild(c("Wireframe","wireframe")),u.appendChild(c("Bounding Volumes","showBoundingVolumes")),u.appendChild(c("Content Volumes","showContentBoundingVolumes")),u.appendChild(c("Request Volumes","showRequestVolumes")),u.appendChild(c("Point Cloud Shading","pointCloudShading"));const v=document.createElement("div");v.setAttribute("data-bind","visible: pointCloudShading"),v.appendChild(_lt("geometricErrorScale",0,2,.01,"Geometric Error Scale")),v.appendChild(_lt("maximumAttenuation",0,32,1,"Maximum Attenuation")),v.appendChild(_lt("baseResolution",0,1,.01,"Base Resolution")),v.appendChild(c("Eye Dome Lighting (EDL)","eyeDomeLighting")),u.appendChild(v);const b=document.createElement("div");b.setAttribute("data-bind","visible: eyeDomeLighting"),b.appendChild(_lt("eyeDomeLightingStrength",0,2,.1,"EDL Strength")),b.appendChild(_lt("eyeDomeLightingRadius",0,4,.1,"EDL Radius")),v.appendChild(b),h.appendChild(c("Freeze Frame","freezeFrame")),h.appendChild(c("Dynamic Screen Space Error","dynamicScreenSpaceError"));const A=document.createElement("div");A.appendChild(_lt("maximumScreenSpaceError",0,128,1,"Maximum Screen Space Error")),h.appendChild(A);const w=document.createElement("div");w.setAttribute("data-bind","visible: dynamicScreenSpaceError"),w.appendChild(_lt("dynamicScreenSpaceErrorDensitySliderValue",0,1,.005,"Screen Space Error Density","dynamicScreenSpaceErrorDensity")),w.appendChild(_lt("dynamicScreenSpaceErrorFactor",1,10,.1,"Screen Space Error Factor")),h.appendChild(w),d.appendChild(c("Performance","performance")),d.appendChild(i),d.appendChild(c("Statistics","showStatistics"));const T=document.createElement("div");T.className="cesium-3dTilesInspector-statistics",T.setAttribute("data-bind","html: statisticsText, visible: showStatistics"),d.appendChild(T),d.appendChild(c("Pick Statistics","showPickStatistics"));const C=document.createElement("div");C.className="cesium-3dTilesInspector-statistics",C.setAttribute("data-bind","html: pickStatisticsText, visible: showPickStatistics"),d.appendChild(C);const E=document.createElement("div");p.appendChild(E),E.appendChild(document.createTextNode("Color Blend Mode: "));const x=document.createElement("select");x.setAttribute("data-bind",'options: colorBlendModes, optionsText: "text", optionsValue: "value", value: colorBlendMode'),E.appendChild(x);const S=document.createElement("textarea");S.setAttribute("data-bind","textInput: styleString, event: { keydown: styleEditorKeyPress }"),E.className="cesium-cesiumInspector-styleEditor",E.appendChild(S);const I=glt("compileStyle","Compile (Ctrl+Enter)");E.appendChild(I);const O=document.createElement("div");O.className="cesium-cesiumInspector-error",O.setAttribute("data-bind","text: editorError"),E.appendChild(O),f.appendChild(c("Show Picked Only","showOnlyPickedTileDebugLabel")),f.appendChild(c("Geometric Error","showGeometricError")),f.appendChild(c("Rendering Statistics","showRenderingStatistics")),f.appendChild(c("Memory Usage (MB)","showMemoryUsage")),f.appendChild(c("Url","showUrl")),m.appendChild(c("Skip Tile LODs","skipLevelOfDetail"));const P=document.createElement("div");P.appendChild(_lt("skipScreenSpaceErrorFactor",1,50,1,"Skip SSE Factor")),m.appendChild(P);const R=document.createElement("div");R.appendChild(_lt("baseScreenSpaceError",0,4096,1,"SSE before skipping LOD")),m.appendChild(R);const L=document.createElement("div");L.appendChild(_lt("skipLevels",0,10,1,"Min. levels to skip")),m.appendChild(L),m.appendChild(c("Load only tiles that meet the max SSE.","immediatelyLoadDesiredLevelOfDetail")),m.appendChild(c("Load siblings of visible tiles","loadSiblings")),vrt.applyBindings(o,n)}function _lt(e,t,n,i,o,r){r=R(r,e);const s=document.createElement("input");s.setAttribute("data-bind",`value: ${r}`),s.type="number";const a=document.createElement("input");a.type="range",a.min=t,a.max=n,a.step=i,a.setAttribute("data-bind",`valueUpdate: "input", value: ${e}`);const c=document.createElement("div");c.appendChild(a);const l=document.createElement("div");return l.className="cesium-cesiumInspector-slider",l.appendChild(document.createTextNode(o)),l.appendChild(s),l.appendChild(c),l}function glt(e,t,n){const i=document.createElement("button");i.type="button",i.textContent=t,i.className="cesium-cesiumInspector-pickButton";let o=`click: ${e}`;return C(n)&&(o+=`, css: {"cesium-cesiumInspector-pickButtonHighlight" : ${n}}`),i.setAttribute("data-bind",o),i}Object.defineProperties(mlt.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),mlt.prototype.isDestroyed=function(){return!1},mlt.prototype.destroy=function(){return vrt.cleanNode(this._element),this._container.removeChild(this._element),this.viewModel.destroy(),Qh(this)};function ylt(e){let t;if(C(e)){t="Command Statistics";const n=e.commandsInFrustums;for(const e in n)if(n.hasOwnProperty(e)){let i,o=parseInt(e,10);if(7===o)i="1, 2 and 3";else{const e=[];for(let t=2;t>=0;t--){const n=Math.pow(2,t);o>=n&&(e.push(t+1),o-=n)}i=e.reverse().join(" and ")}t+=`<br>&nbsp;&nbsp;&nbsp;&nbsp;${n[e]} in frustum ${i}`}t+=`<br>Total: ${e.totalCommands}`}return t}function vlt(e,t,n){let i=Math.min(n,t);return i=Math.max(i,e),i}const blt=new os,Alt=new K;function wlt(e,t){if(!C(e))throw new x("scene is required");if(!C(t))throw new x("performanceContainer is required");const n=this,i=e.canvas,o=new BM(i);this._eventHandler=o,this._scene=e,this._canvas=i,this._primitive=void 0,this._tile=void 0,this._modelMatrixPrimitive=void 0,this._performanceDisplay=void 0,this._performanceContainer=t;const r=this._scene.globe;let s;function a(e){const t=n._scene.pick({x:e.position.x,y:e.position.y});C(t)&&(n.primitive=C(t.collection)?t.collection:t.primitive),n._scene.requestRender(),n.pickPrimitiveActive=!1}function c(e){let t;const i=r.ellipsoid,o=n._scene.camera.getPickRay(e.position,blt),s=r.pick(o,n._scene,Alt);if(C(s)){const e=i.cartesianToCartographic(s),n=r._surface.tileProvider._tilesToRenderByTextureCount;for(let i=0;!t&&i<n.length;++i){const o=n[i];if(C(o))for(let n=0;!t&&n<o.length;++n){const i=o[n];_t.contains(i.rectangle,e)&&(t=i)}}}n.tile=t,n.pickTileActive=!1}r.depthTestAgainstTerrain=!0,this.frustums=!1,this.frustumPlanes=!1,this.performance=!1,this.shaderCacheText="",this.primitiveBoundingSphere=!1,this.primitiveReferenceFrame=!1,this.filterPrimitive=!1,this.tileBoundingSphere=!1,this.filterTile=!1,this.wireframe=!1,this.depthFrustum=1,this._numberOfFrustums=1,this.suspendUpdates=!1,this.tileCoordinates=!1,this.frustumStatisticText=!1,this.tileText="",this.hasPickedPrimitive=!1,this.hasPickedTile=!1,this.pickPrimitiveActive=!1,this.pickTileActive=!1,this.dropDownVisible=!0,this.generalVisible=!0,this.primitivesVisible=!1,this.terrainVisible=!1,this.depthFrustumText="",vrt.track(this,["frustums","frustumPlanes","performance","shaderCacheText","primitiveBoundingSphere","primitiveReferenceFrame","filterPrimitive","tileBoundingSphere","filterTile","wireframe","depthFrustum","suspendUpdates","tileCoordinates","frustumStatisticText","tileText","hasPickedPrimitive","hasPickedTile","pickPrimitiveActive","pickTileActive","dropDownVisible","generalVisible","primitivesVisible","terrainVisible","depthFrustumText"]),this._toggleDropDown=Qat((function(){n.dropDownVisible=!n.dropDownVisible})),this._toggleGeneral=Qat((function(){n.generalVisible=!n.generalVisible})),this._togglePrimitives=Qat((function(){n.primitivesVisible=!n.primitivesVisible})),this._toggleTerrain=Qat((function(){n.terrainVisible=!n.terrainVisible})),this._frustumsSubscription=vrt.getObservable(this,"frustums").subscribe((function(e){n._scene.debugShowFrustums=e,n._scene.requestRender()})),this._frustumPlanesSubscription=vrt.getObservable(this,"frustumPlanes").subscribe((function(e){n._scene.debugShowFrustumPlanes=e,n._scene.requestRender()})),this._performanceSubscription=vrt.getObservable(this,"performance").subscribe((function(e){e?n._performanceDisplay=new B4e({container:n._performanceContainer}):n._performanceContainer.innerHTML=""})),this._showPrimitiveBoundingSphere=Qat((function(){return n._primitive.debugShowBoundingVolume=n.primitiveBoundingSphere,n._scene.requestRender(),!0})),this._primitiveBoundingSphereSubscription=vrt.getObservable(this,"primitiveBoundingSphere").subscribe((function(){n._showPrimitiveBoundingSphere()})),this._showPrimitiveReferenceFrame=Qat((function(){if(n.primitiveReferenceFrame){const e=n._primitive.modelMatrix;n._modelMatrixPrimitive=new MXe({modelMatrix:e}),n._scene.primitives.add(n._modelMatrixPrimitive)}else C(n._modelMatrixPrimitive)&&(n._scene.primitives.remove(n._modelMatrixPrimitive),n._modelMatrixPrimitive=void 0);return n._scene.requestRender(),!0})),this._primitiveReferenceFrameSubscription=vrt.getObservable(this,"primitiveReferenceFrame").subscribe((function(){n._showPrimitiveReferenceFrame()})),this._doFilterPrimitive=Qat((function(){return n.filterPrimitive?n._scene.debugCommandFilter=function(e){return!(!C(n._modelMatrixPrimitive)||e.owner!==n._modelMatrixPrimitive._primitive)||!!C(n._primitive)&&(e.owner===n._primitive||e.owner===n._primitive._billboardCollection||e.owner.primitive===n._primitive)}:n._scene.debugCommandFilter=void 0,!0})),this._filterPrimitiveSubscription=vrt.getObservable(this,"filterPrimitive").subscribe((function(){n._doFilterPrimitive(),n._scene.requestRender()})),this._wireframeSubscription=vrt.getObservable(this,"wireframe").subscribe((function(e){r._surface.tileProvider._debug.wireframe=e,n._scene.requestRender()})),this._depthFrustumSubscription=vrt.getObservable(this,"depthFrustum").subscribe((function(e){n._scene.debugShowDepthFrustum=e,n._scene.requestRender()})),this._incrementDepthFrustum=Qat((function(){const e=n.depthFrustum+1;return n.depthFrustum=vlt(1,n._numberOfFrustums,e),n._scene.requestRender(),!0})),this._decrementDepthFrustum=Qat((function(){const e=n.depthFrustum-1;return n.depthFrustum=vlt(1,n._numberOfFrustums,e),n._scene.requestRender(),!0})),this._suspendUpdatesSubscription=vrt.getObservable(this,"suspendUpdates").subscribe((function(e){r._surface._debug.suspendLodUpdate=e,e||(n.filterTile=!1)})),this._showTileCoordinates=Qat((function(){return n.tileCoordinates&&!C(s)?s=e.imageryLayers.addImageryProvider(new iot({tilingScheme:e.terrainProvider.tilingScheme})):!n.tileCoordinates&&C(s)&&(e.imageryLayers.remove(s),s=void 0),!0})),this._tileCoordinatesSubscription=vrt.getObservable(this,"tileCoordinates").subscribe((function(){n._showTileCoordinates(),n._scene.requestRender()})),this._tileBoundingSphereSubscription=vrt.getObservable(this,"tileBoundingSphere").subscribe((function(){n._showTileBoundingSphere(),n._scene.requestRender()})),this._showTileBoundingSphere=Qat((function(){return n.tileBoundingSphere?r._surface.tileProvider._debug.boundingSphereTile=n._tile:r._surface.tileProvider._debug.boundingSphereTile=void 0,n._scene.requestRender(),!0})),this._doFilterTile=Qat((function(){return n.filterTile?(n.suspendUpdates=!0,r._surface._tilesToRender=[],C(n._tile)&&n._tile.renderable&&r._surface._tilesToRender.push(n._tile)):n.suspendUpdates=!1,!0})),this._filterTileSubscription=vrt.getObservable(this,"filterTile").subscribe((function(){n.doFilterTile(),n._scene.requestRender()})),this._pickPrimitive=Qat((function(){n.pickPrimitiveActive=!n.pickPrimitiveActive})),this._pickPrimitiveActiveSubscription=vrt.getObservable(this,"pickPrimitiveActive").subscribe((function(e){e?o.setInputAction(a,JL.LEFT_CLICK):o.removeInputAction(JL.LEFT_CLICK)})),this._pickTile=Qat((function(){n.pickTileActive=!n.pickTileActive})),this._pickTileActiveSubscription=vrt.getObservable(this,"pickTileActive").subscribe((function(e){e?o.setInputAction(c,JL.LEFT_CLICK):o.removeInputAction(JL.LEFT_CLICK)})),this._removePostRenderEvent=e.postRender.addEventListener((function(){n._update()}))}Object.defineProperties(wlt.prototype,{scene:{get:function(){return this._scene}},performanceContainer:{get:function(){return this._performanceContainer}},toggleDropDown:{get:function(){return this._toggleDropDown}},showPrimitiveBoundingSphere:{get:function(){return this._showPrimitiveBoundingSphere}},showPrimitiveReferenceFrame:{get:function(){return this._showPrimitiveReferenceFrame}},doFilterPrimitive:{get:function(){return this._doFilterPrimitive}},incrementDepthFrustum:{get:function(){return this._incrementDepthFrustum}},decrementDepthFrustum:{get:function(){return this._decrementDepthFrustum}},showTileCoordinates:{get:function(){return this._showTileCoordinates}},showTileBoundingSphere:{get:function(){return this._showTileBoundingSphere}},doFilterTile:{get:function(){return this._doFilterTile}},toggleGeneral:{get:function(){return this._toggleGeneral}},togglePrimitives:{get:function(){return this._togglePrimitives}},toggleTerrain:{get:function(){return this._toggleTerrain}},pickPrimitive:{get:function(){return this._pickPrimitive}},pickTile:{get:function(){return this._pickTile}},selectParent:{get:function(){const e=this;return Qat((function(){e.tile=e.tile.parent}))}},selectNW:{get:function(){const e=this;return Qat((function(){e.tile=e.tile.northwestChild}))}},selectNE:{get:function(){const e=this;return Qat((function(){e.tile=e.tile.northeastChild}))}},selectSW:{get:function(){const e=this;return Qat((function(){e.tile=e.tile.southwestChild}))}},selectSE:{get:function(){const e=this;return Qat((function(){e.tile=e.tile.southeastChild}))}},primitive:{get:function(){return this._primitive},set:function(e){const t=this._primitive;e!==t&&(this.hasPickedPrimitive=!0,C(t)&&(t.debugShowBoundingVolume=!1),this._scene.debugCommandFilter=void 0,C(this._modelMatrixPrimitive)&&(this._scene.primitives.remove(this._modelMatrixPrimitive),this._modelMatrixPrimitive=void 0),this._primitive=e,e.show=!1,setTimeout((function(){e.show=!0}),50),this.showPrimitiveBoundingSphere(),this.showPrimitiveReferenceFrame(),this.doFilterPrimitive())}},tile:{get:function(){return this._tile},set:function(e){if(C(e)){this.hasPickedTile=!0;const t=this._tile;if(e!==t){this.tileText=`L: ${e.level} X: ${e.x} Y: ${e.y}`,this.tileText+=`<br>SW corner: ${e.rectangle.west}, ${e.rectangle.south}`,this.tileText+=`<br>NE corner: ${e.rectangle.east}, ${e.rectangle.north}`;const t=e.data;C(t)&&C(t.tileBoundingRegion)?this.tileText+=`<br>Min: ${t.tileBoundingRegion.minimumHeight} Max: ${t.tileBoundingRegion.maximumHeight}`:this.tileText+="<br>(Tile is not loaded)"}this._tile=e,this.showTileBoundingSphere(),this.doFilterTile()}else this.hasPickedTile=!1,this._tile=void 0}}}),wlt.prototype._update=function(){this.frustums&&(this.frustumStatisticText=ylt(this._scene.debugFrustumStatistics));const e=this._scene.numberOfFrustums;this._numberOfFrustums=e,this.depthFrustum=vlt(1,e,this.depthFrustum),this.depthFrustumText=`${this.depthFrustum} of ${e}`,this.performance&&this._performanceDisplay.update(),this.primitiveReferenceFrame&&(this._modelMatrixPrimitive.modelMatrix=this._primitive.modelMatrix),this.shaderCacheText=`Cached shaders: ${this._scene.context.shaderCache.numberOfShaders}`},wlt.prototype.isDestroyed=function(){return!1},wlt.prototype.destroy=function(){return this._eventHandler.destroy(),this._removePostRenderEvent(),this._frustumsSubscription.dispose(),this._frustumPlanesSubscription.dispose(),this._performanceSubscription.dispose(),this._primitiveBoundingSphereSubscription.dispose(),this._primitiveReferenceFrameSubscription.dispose(),this._filterPrimitiveSubscription.dispose(),this._wireframeSubscription.dispose(),this._depthFrustumSubscription.dispose(),this._suspendUpdatesSubscription.dispose(),this._tileCoordinatesSubscription.dispose(),this._tileBoundingSphereSubscription.dispose(),this._filterTileSubscription.dispose(),this._pickPrimitiveActiveSubscription.dispose(),this._pickTileActiveSubscription.dispose(),Qh(this)};var Tlt=wlt;function Clt(e,t){if(!C(e))throw new x("container is required.");if(!C(t))throw new x("scene is required.");e=Uke(e);const n=document.createElement("div"),i=new Tlt(t,n);this._viewModel=i,this._container=e;const o=document.createElement("div");this._element=o;const r=document.createElement("div");r.textContent="Cesium Inspector",r.className="cesium-cesiumInspector-button",r.setAttribute("data-bind","click: toggleDropDown"),o.appendChild(r),o.className="cesium-cesiumInspector",o.setAttribute("data-bind",'css: { "cesium-cesiumInspector-visible" : dropDownVisible, "cesium-cesiumInspector-hidden" : !dropDownVisible }'),e.appendChild(this._element);const s=document.createElement("div");this._panel=s,s.className="cesium-cesiumInspector-dropDown",o.appendChild(s);const a=jat.createSection,c=jat.createCheckbox,l=a(s,"General","generalVisible","toggleGeneral"),u=c("Show Frustums","frustums"),h=document.createElement("div");h.className="cesium-cesiumInspector-frustumStatistics",h.setAttribute("data-bind","visible: frustums, html: frustumStatisticText"),u.appendChild(h),l.appendChild(u),l.appendChild(c("Show Frustum Planes","frustumPlanes")),l.appendChild(c("Performance Display","performance")),n.className="cesium-cesiumInspector-performanceDisplay",l.appendChild(n);const d=document.createElement("div");d.className="cesium-cesiumInspector-shaderCache",d.setAttribute("data-bind","html: shaderCacheText"),l.appendChild(d);const f=document.createElement("div");l.appendChild(f);const p=document.createElement("span");p.setAttribute("data-bind",'html: "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Frustum:"'),f.appendChild(p);const m=document.createElement("span");m.setAttribute("data-bind","text: depthFrustumText"),f.appendChild(m);const _=document.createElement("input");_.type="button",_.value="-",_.className="cesium-cesiumInspector-pickButton",_.setAttribute("data-bind","click: decrementDepthFrustum"),f.appendChild(_);const g=document.createElement("input");g.type="button",g.value="+",g.className="cesium-cesiumInspector-pickButton",g.setAttribute("data-bind","click: incrementDepthFrustum"),f.appendChild(g);const y=a(s,"Primitives","primitivesVisible","togglePrimitives"),v=document.createElement("div");v.className="cesium-cesiumInspector-pickSection",y.appendChild(v);const b=document.createElement("input");b.type="button",b.value="Pick a primitive",b.className="cesium-cesiumInspector-pickButton",b.setAttribute("data-bind",'css: {"cesium-cesiumInspector-pickButtonHighlight" : pickPrimitiveActive}, click: pickPrimitive');let A=document.createElement("div");A.className="cesium-cesiumInspector-center",A.appendChild(b),v.appendChild(A),v.appendChild(c("Show bounding sphere","primitiveBoundingSphere","hasPickedPrimitive")),v.appendChild(c("Show reference frame","primitiveReferenceFrame","hasPickedPrimitive")),this._primitiveOnly=c("Show only selected","filterPrimitive","hasPickedPrimitive"),v.appendChild(this._primitiveOnly);const w=a(s,"Terrain","terrainVisible","toggleTerrain"),T=document.createElement("div");T.className="cesium-cesiumInspector-pickSection",w.appendChild(T);const E=document.createElement("input");E.type="button",E.value="Pick a tile",E.className="cesium-cesiumInspector-pickButton",E.setAttribute("data-bind",'css: {"cesium-cesiumInspector-pickButtonHighlight" : pickTileActive}, click: pickTile'),A=document.createElement("div"),A.appendChild(E),A.className="cesium-cesiumInspector-center",T.appendChild(A);const S=document.createElement("div");T.appendChild(S);const I=document.createElement("input");I.type="button",I.value="Parent",I.className="cesium-cesiumInspector-pickButton",I.setAttribute("data-bind","click: selectParent");const O=document.createElement("input");O.type="button",O.value="NW",O.className="cesium-cesiumInspector-pickButton",O.setAttribute("data-bind","click: selectNW");const D=document.createElement("input");D.type="button",D.value="NE",D.className="cesium-cesiumInspector-pickButton",D.setAttribute("data-bind","click: selectNE");const P=document.createElement("input");P.type="button",P.value="SW",P.className="cesium-cesiumInspector-pickButton",P.setAttribute("data-bind","click: selectSW");const R=document.createElement("input");R.type="button",R.value="SE",R.className="cesium-cesiumInspector-pickButton",R.setAttribute("data-bind","click: selectSE");const L=document.createElement("div");L.className="cesium-cesiumInspector-tileText",S.className="cesium-cesiumInspector-frustumStatistics",S.appendChild(L),S.setAttribute("data-bind","visible: hasPickedTile"),L.setAttribute("data-bind","html: tileText");const M=document.createElement("div");M.className="cesium-cesiumInspector-relativeText",M.textContent="Select relative:",S.appendChild(M);const B=document.createElement("table"),N=document.createElement("tr"),F=document.createElement("tr"),z=document.createElement("td");z.appendChild(I);const k=document.createElement("td");k.appendChild(O);const U=document.createElement("td");U.appendChild(D),N.appendChild(z),N.appendChild(k),N.appendChild(U);const V=document.createElement("td"),H=document.createElement("td");H.appendChild(P);const G=document.createElement("td");G.appendChild(R),F.appendChild(V),F.appendChild(H),F.appendChild(G),B.appendChild(N),B.appendChild(F),S.appendChild(B),T.appendChild(c("Show bounding volume","tileBoundingSphere","hasPickedTile")),T.appendChild(c("Show only selected","filterTile","hasPickedTile")),w.appendChild(c("Wireframe","wireframe")),w.appendChild(c("Suspend LOD update","suspendUpdates")),w.appendChild(c("Show tile coordinates","tileCoordinates")),vrt.applyBindings(i,this._element)}Object.defineProperties(Clt.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),Clt.prototype.isDestroyed=function(){return!1},Clt.prototype.destroy=function(){return vrt.cleanNode(this._element),this._container.removeChild(this._element),this.viewModel.destroy(),Qh(this)};function Elt(e){return Zi(`Assets/Textures/SkyBox/tycho2t3_80_${e}.jpg`)}function xlt(e){e._renderLoopRunning=!0;let t=0;function n(i){if(!e.isDestroyed())if(e._useDefaultRenderLoop)try{const o=e._targetFrameRate;if(C(o)){const r=1e3/o,s=i-t;s>r&&(e.resize(),e.render(),t=i-s%r),oz(n)}else e.resize(),e.render(),oz(n)}catch(o){if(e._useDefaultRenderLoop=!1,e._renderLoopRunning=!1,e._showRenderLoopErrors){const t="An error occurred while rendering.  Rendering has stopped.";e.showErrorPanel(t,void 0,o)}}else e._renderLoopRunning=!1}oz(n)}function Slt(e){let t=e._useBrowserRecommendedResolution?1:window.devicePixelRatio;return t*=e._resolutionScale,C(e._scene)&&(e._scene.pixelRatio=t),t}function Ilt(e){const t=e._canvas;let n=t.clientWidth,i=t.clientHeight;const o=Slt(e);e._canvasClientWidth=n,e._canvasClientHeight=i,n*=o,i*=o,t.width=n,t.height=i,e._canRender=0!==n&&0!==i,e._lastDevicePixelRatio=window.devicePixelRatio}function Olt(e){const t=e._canvas,n=t.width,i=t.height;if(0!==n&&0!==i){const t=e._scene.camera.frustum;C(t.aspectRatio)?t.aspectRatio=n/i:(t.top=t.right*(i/n),t.bottom=-t.top)}}function Dlt(e,t){if(!C(e))throw new x("container is required.");e=Uke(e),t=R(t,R.EMPTY_OBJECT);const n=document.createElement("div");n.className="cesium-widget",e.appendChild(n);const i=document.createElement("canvas"),o=Oc.supportsImageRenderingPixelated();function r(){i!==i.ownerDocument.activeElement&&i.ownerDocument.activeElement.blur()}this._supportsImageRenderingPixelated=o,o&&(i.style.imageRendering=Oc.imageRenderingValue()),i.oncontextmenu=function(){return!1},i.onselectstart=function(){return!1},i.addEventListener("mousedown",r),i.addEventListener("pointerdown",r),n.appendChild(i);const s=document.createElement("div");s.className="cesium-widget-credits";const a=C(t.creditContainer)?Uke(t.creditContainer):n;a.appendChild(s);const c=C(t.creditViewport)?Uke(t.creditViewport):n,l=R(t.showRenderLoopErrors,!0),u=R(t.useBrowserRecommendedResolution,!0);this._element=n,this._container=e,this._canvas=i,this._canvasClientWidth=0,this._canvasClientHeight=0,this._lastDevicePixelRatio=0,this._creditViewport=c,this._creditContainer=a,this._innerCreditContainer=s,this._canRender=!1,this._renderLoopRunning=!1,this._showRenderLoopErrors=l,this._resolutionScale=1,this._useBrowserRecommendedResolution=u,this._forceResize=!1,this._clock=C(t.clock)?t.clock:new _y,Ilt(this);try{const e=new Rit({canvas:i,contextOptions:t.contextOptions,creditContainer:s,creditViewport:c,mapProjection:t.mapProjection,orderIndependentTranslucency:t.orderIndependentTranslucency,scene3DOnly:R(t.scene3DOnly,!1),shadows:t.shadows,mapMode2D:t.mapMode2D,requestRenderMode:t.requestRenderMode,maximumRenderTimeChange:t.maximumRenderTimeChange,depthPlaneEllipsoidOffset:t.depthPlaneEllipsoidOffset,msaaSamples:t.msaaSamples});this._scene=e,e.camera.constrainedAxis=K.UNIT_Z,Slt(this),Olt(this);const n=R(e.mapProjection.ellipsoid,ge.WGS84);let o=t.globe;C(o)||(o=new R0e(n)),!1!==o&&(e.globe=o,e.globe.shadows=R(t.terrainShadows,rj.RECEIVE_ONLY));let r=t.skyBox;C(r)||(r=new Git({sources:{positiveX:Elt("px"),negativeX:Elt("mx"),positiveY:Elt("py"),negativeY:Elt("my"),positiveZ:Elt("pz"),negativeZ:Elt("mz")}})),!1!==r&&(e.skyBox=r,e.sun=new eot,e.moon=new V3e);let a=t.skyAtmosphere;C(a)||(a=new kit(n)),!1!==a&&(e.skyAtmosphere=a);let l=!1!==t.globe&&t.imageryProvider;C(l)||(l=Zot()),!1!==l&&e.imageryLayers.addImageryProvider(l),C(t.terrainProvider)&&!1!==t.globe&&(e.terrainProvider=t.terrainProvider),this._screenSpaceEventHandler=new BM(i),C(t.sceneMode)&&(t.sceneMode===ij.SCENE2D&&this._scene.morphTo2D(0),t.sceneMode===ij.COLUMBUS_VIEW&&this._scene.morphToColumbusView(0)),this._useDefaultRenderLoop=void 0,this.useDefaultRenderLoop=R(t.useDefaultRenderLoop,!0),this._targetFrameRate=void 0,this.targetFrameRate=t.targetFrameRate;const u=this;this._onRenderError=function(e,t){if(u._useDefaultRenderLoop=!1,u._renderLoopRunning=!1,u._showRenderLoopErrors){const e="An error occurred while rendering.  Rendering has stopped.";u.showErrorPanel(e,void 0,t)}},e.renderError.addEventListener(this._onRenderError)}catch(h){if(l){const e="Error constructing CesiumWidget.",t='Visit <a href="http://get.webgl.org">http://get.webgl.org</a> to verify that your web browser and hardware support WebGL.  Consider trying a different web browser or updating your video drivers.  Detailed error information is below:';this.showErrorPanel(e,t,h)}throw h}}Object.defineProperties(Dlt.prototype,{container:{get:function(){return this._container}},canvas:{get:function(){return this._canvas}},creditContainer:{get:function(){return this._creditContainer}},creditViewport:{get:function(){return this._creditViewport}},scene:{get:function(){return this._scene}},imageryLayers:{get:function(){return this._scene.imageryLayers}},terrainProvider:{get:function(){return this._scene.terrainProvider},set:function(e){this._scene.terrainProvider=e}},camera:{get:function(){return this._scene.camera}},clock:{get:function(){return this._clock}},screenSpaceEventHandler:{get:function(){return this._screenSpaceEventHandler}},targetFrameRate:{get:function(){return this._targetFrameRate},set:function(e){if(e<=0)throw new x("targetFrameRate must be greater than 0, or undefined.");this._targetFrameRate=e}},useDefaultRenderLoop:{get:function(){return this._useDefaultRenderLoop},set:function(e){this._useDefaultRenderLoop!==e&&(this._useDefaultRenderLoop=e,e&&!this._renderLoopRunning&&xlt(this))}},resolutionScale:{get:function(){return this._resolutionScale},set:function(e){if(e<=0)throw new x("resolutionScale must be greater than 0.");this._resolutionScale!==e&&(this._resolutionScale=e,this._forceResize=!0)}},useBrowserRecommendedResolution:{get:function(){return this._useBrowserRecommendedResolution},set:function(e){this._useBrowserRecommendedResolution!==e&&(this._useBrowserRecommendedResolution=e,this._forceResize=!0)}}}),Dlt.prototype.showErrorPanel=function(e,t,n){const i=this._element,o=document.createElement("div");o.className="cesium-widget-errorPanel";const r=document.createElement("div");r.className="cesium-widget-errorPanel-content",o.appendChild(r);const s=document.createElement("div");s.className="cesium-widget-errorPanel-header",s.appendChild(document.createTextNode(e)),r.appendChild(s);const a=document.createElement("div");function c(){a.style.maxHeight=`${Math.max(Math.round(.9*i.clientHeight-100),30)}px`}a.className="cesium-widget-errorPanel-scroll",r.appendChild(a),c(),C(window.addEventListener)&&window.addEventListener("resize",c,!1);const l=C(t),u=C(n);if(l||u){const i=document.createElement("div");if(i.className="cesium-widget-errorPanel-message",a.appendChild(i),u){let i=Zd(n);l||("string"===typeof n&&(n=new Error(n)),t=Zd({name:n.name,message:n.message}),i=n.stack),"undefined"!==typeof console&&console.error(`${e}\n${t}\n${i}`);const o=document.createElement("div");o.className="cesium-widget-errorPanel-message-details collapsed";const s=document.createElement("span");s.className="cesium-widget-errorPanel-more-details",s.appendChild(document.createTextNode("See more...")),o.appendChild(s),o.onclick=function(e){o.removeChild(s),o.appendChild(document.createTextNode(i)),o.className="cesium-widget-errorPanel-message-details",r.className="cesium-widget-errorPanel-content expanded",o.onclick=void 0},a.appendChild(o)}i.innerHTML=`<p>${t}</p>`}const h=document.createElement("div");h.className="cesium-widget-errorPanel-buttonPanel",r.appendChild(h);const d=document.createElement("button");d.setAttribute("type","button"),d.className="cesium-button",d.appendChild(document.createTextNode("OK")),d.onclick=function(){C(c)&&C(window.removeEventListener)&&window.removeEventListener("resize",c,!1),i.removeChild(o)},h.appendChild(d),i.appendChild(o)},Dlt.prototype.isDestroyed=function(){return!1},Dlt.prototype.destroy=function(){C(this._scene)&&(this._scene.renderError.removeEventListener(this._onRenderError),this._scene=this._scene.destroy()),this._container.removeChild(this._element),this._creditContainer.removeChild(this._innerCreditContainer),Qh(this)},Dlt.prototype.resize=function(){const e=this._canvas;(this._forceResize||this._canvasClientWidth!==e.clientWidth||this._canvasClientHeight!==e.clientHeight||this._lastDevicePixelRatio!==window.devicePixelRatio)&&(this._forceResize=!1,Ilt(this),Olt(this),this._scene.requestRender())},Dlt.prototype.render=function(){if(this._canRender){this._scene.initializeFrame();const e=this._clock.tick();this._scene.render(e)}else this._clock.tick()};var Plt=Dlt;function Rlt(e,t){C(t)||(t=document.body),t=Uke(t);const n=this,i=vrt.observable(qa.fullscreen),o=vrt.observable(qa.enabled),r=t.ownerDocument;this.isFullscreen=void 0,vrt.defineProperty(this,"isFullscreen",{get:function(){return i()}}),this.isFullscreenEnabled=void 0,vrt.defineProperty(this,"isFullscreenEnabled",{get:function(){return o()},set:function(e){o(e&&qa.enabled)}}),this.tooltip=void 0,vrt.defineProperty(this,"tooltip",(function(){return this.isFullscreenEnabled?i()?"Exit full screen":"Full screen":"Full screen unavailable"})),this._command=Qat((function(){qa.fullscreen?qa.exitFullscreen():qa.requestFullscreen(n._fullscreenElement)}),vrt.getObservable(this,"isFullscreenEnabled")),this._fullscreenElement=R(Uke(e),r.body),this._callback=function(){i(qa.fullscreen)},r.addEventListener(qa.changeEventName,this._callback)}Object.defineProperties(Rlt.prototype,{fullscreenElement:{get:function(){return this._fullscreenElement},set:function(e){if(!(e instanceof Element))throw new x("value must be a valid Element.");this._fullscreenElement=e}},command:{get:function(){return this._command}}}),Rlt.prototype.isDestroyed=function(){return!1},Rlt.prototype.destroy=function(){document.removeEventListener(qa.changeEventName,this._callback),Qh(this)};var Llt=Rlt;const Mlt="M 83.96875 17.5625 L 83.96875 17.59375 L 76.65625 24.875 L 97.09375 24.96875 L 76.09375 45.96875 L 81.9375 51.8125 L 102.78125 30.9375 L 102.875 51.15625 L 110.15625 43.875 L 110.1875 17.59375 L 83.96875 17.5625 z M 44.125 17.59375 L 17.90625 17.625 L 17.9375 43.90625 L 25.21875 51.1875 L 25.3125 30.96875 L 46.15625 51.8125 L 52 45.96875 L 31 25 L 51.4375 24.90625 L 44.125 17.59375 z M 46.0625 76.03125 L 25.1875 96.875 L 25.09375 76.65625 L 17.8125 83.9375 L 17.8125 110.21875 L 44 110.25 L 51.3125 102.9375 L 30.90625 102.84375 L 51.875 81.875 L 46.0625 76.03125 z M 82 76.15625 L 76.15625 82 L 97.15625 103 L 76.71875 103.0625 L 84.03125 110.375 L 110.25 110.34375 L 110.21875 84.0625 L 102.9375 76.8125 L 102.84375 97 L 82 76.15625 z",Blt="M 104.34375 17.5625 L 83.5 38.4375 L 83.40625 18.21875 L 76.125 25.5 L 76.09375 51.78125 L 102.3125 51.8125 L 102.3125 51.78125 L 109.625 44.5 L 89.1875 44.40625 L 110.1875 23.40625 L 104.34375 17.5625 z M 23.75 17.59375 L 17.90625 23.4375 L 38.90625 44.4375 L 18.5 44.53125 L 25.78125 51.8125 L 52 51.78125 L 51.96875 25.53125 L 44.6875 18.25 L 44.625 38.46875 L 23.75 17.59375 z M 25.6875 76.03125 L 18.375 83.3125 L 38.78125 83.40625 L 17.8125 104.40625 L 23.625 110.25 L 44.5 89.375 L 44.59375 109.59375 L 51.875 102.3125 L 51.875 76.0625 L 25.6875 76.03125 z M 102.375 76.15625 L 76.15625 76.1875 L 76.1875 102.4375 L 83.46875 109.71875 L 83.5625 89.53125 L 104.40625 110.375 L 110.25 104.53125 L 89.25 83.53125 L 109.6875 83.46875 L 102.375 76.15625 z";function Nlt(e,t){if(!C(e))throw new x("container is required.");e=Uke(e);const n=new Llt(t,e);n._exitFullScreenPath=Blt,n._enterFullScreenPath=Mlt;const i=document.createElement("button");i.type="button",i.className="cesium-button cesium-fullscreenButton",i.setAttribute("data-bind","attr: { title: tooltip },click: command,enable: isFullscreenEnabled,cesiumSvgPath: { path: isFullscreen ? _exitFullScreenPath : _enterFullScreenPath, width: 128, height: 128 }"),e.appendChild(i),vrt.applyBindings(n,i),this._container=e,this._viewModel=n,this._element=i}Object.defineProperties(Nlt.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),Nlt.prototype.isDestroyed=function(){return!1},Nlt.prototype.destroy=function(){return this._viewModel.destroy(),vrt.cleanNode(this._element),this._container.removeChild(this._element),Qh(this)};var Flt=Nlt;const zlt=1e3;function klt(e){if(!C(e)||!C(e.scene))throw new x("options.scene is required.");C(e.geocoderServices)?this._geocoderServices=e.geocoderServices:this._geocoderServices=[new cp,new nO({scene:e.scene})],this._viewContainer=e.container,this._scene=e.scene,this._flightDuration=e.flightDuration,this._searchText="",this._isSearchInProgress=!1,this._geocodePromise=void 0,this._complete=new $n,this._suggestions=[],this._selectedSuggestion=void 0,this._showSuggestions=!0,this._handleArrowDown=Vlt,this._handleArrowUp=Ult;const t=this;this._suggestionsVisible=vrt.pureComputed((function(){const e=vrt.getObservable(t,"_suggestions"),n=e().length>0,i=vrt.getObservable(t,"_showSuggestions")();return n&&i})),this._searchCommand=Qat((function(e){if(e=R(e,ME.SEARCH),t._focusTextbox=!1,C(t._selectedSuggestion))return t.activateSuggestion(t._selectedSuggestion),!1;t.hideSuggestions(),t.isSearchInProgress?Ylt(t):qlt(t,t._geocoderServices,e)})),this.deselectSuggestion=function(){t._selectedSuggestion=void 0},this.handleKeyDown=function(e,t){const n="ArrowDown"===t.key||"Down"===t.key||40===t.keyCode,i="ArrowUp"===t.key||"Up"===t.key||38===t.keyCode;return(n||i)&&t.preventDefault(),!0},this.handleKeyUp=function(e,n){const i="ArrowDown"===n.key||"Down"===n.key||40===n.keyCode,o="ArrowUp"===n.key||"Up"===n.key||38===n.keyCode,r="Enter"===n.key||13===n.keyCode;return o?Ult(t):i?Vlt(t):r&&t._searchCommand(),!0},this.activateSuggestion=function(e){t.hideSuggestions(),t._searchText=e.displayName;const n=e.destination;Xlt(t),t.destinationFound(t,n)},this.hideSuggestions=function(){t._showSuggestions=!1,t._selectedSuggestion=void 0},this.showSuggestions=function(){t._showSuggestions=!0},this.handleMouseover=function(e,n){e!==t._selectedSuggestion&&(t._selectedSuggestion=e)},this.keepExpanded=!1,this.autoComplete=R(e.autocomplete,!0),this.destinationFound=R(e.destinationFound,klt.flyToDestination),this._focusTextbox=!1,vrt.track(this,["_searchText","_isSearchInProgress","keepExpanded","_suggestions","_selectedSuggestion","_showSuggestions","_focusTextbox"]);const n=vrt.getObservable(this,"_searchText");n.extend({rateLimit:{timeout:500}}),this._suggestionSubscription=n.subscribe((function(){klt._updateSearchSuggestions(t)})),this.isSearchInProgress=void 0,vrt.defineProperty(this,"isSearchInProgress",{get:function(){return this._isSearchInProgress}}),this.searchText=void 0,vrt.defineProperty(this,"searchText",{get:function(){return this.isSearchInProgress?"Searching...":this._searchText},set:function(e){if("string"!==typeof e)throw new x("value must be a valid string.");this._searchText=e}}),this.flightDuration=void 0,vrt.defineProperty(this,"flightDuration",{get:function(){return this._flightDuration},set:function(e){if(C(e)&&e<0)throw new x("value must be positive.");this._flightDuration=e}})}function Ult(e){if(0===e._suggestions.length)return;const t=e._suggestions.indexOf(e._selectedSuggestion);if(-1===t||0===t)return void(e._selectedSuggestion=void 0);const n=t-1;e._selectedSuggestion=e._suggestions[n],klt._adjustSuggestionsScroll(e,n)}function Vlt(e){if(0===e._suggestions.length)return;const t=e._suggestions.length,n=e._suggestions.indexOf(e._selectedSuggestion),i=(n+1)%t;e._selectedSuggestion=e._suggestions[i],klt._adjustSuggestionsScroll(e,i)}function Hlt(e,t){const n=C(t)?t.availability:void 0;return C(n)?fz(t,[e]).then((function(t){return e=t[0],e.height+=zlt,e})):(e.height+=zlt,Promise.resolve(e))}function Glt(e,t){const n=e._scene,i=n.mapProjection,o=i.ellipsoid,r=n.camera,s=n.terrainProvider;let a,c=t;return t instanceof _t?z.equalsEpsilon(t.south,t.north,z.EPSILON7)&&z.equalsEpsilon(t.east,t.west,z.EPSILON7)?t=_t.center(t):a=Fot(t,n):t=o.cartesianToCartographic(t),C(a)||(a=Hlt(t,s)),a.then((function(e){c=o.cartographicToCartesian(e)})).finally((function(){r.flyTo({destination:c,complete:function(){e._complete.raiseEvent()},duration:e._flightDuration,endTransform:ft.IDENTITY})}))}function Wlt(e,t,n,i){return e.then((function(e){if(C(e)&&"fulfilled"===e.state&&e.value.length>0)return e;const o=t.geocode(n,i).then((function(e){return{state:"fulfilled",value:e}})).catch((function(e){return{state:"rejected",reason:e}}));return o}))}function qlt(e,t,n){const i=e._searchText;if(Klt(i))return void e.showSuggestions();e._isSearchInProgress=!0;let o=Promise.resolve();for(let r=0;r<t.length;r++)o=Wlt(o,t[r],i,n);e._geocodePromise=o,o.then((function(t){if(o.cancel)return;e._isSearchInProgress=!1;const n=t.value;if("fulfilled"===t.state&&C(n)&&n.length>0)return e._searchText=n[0].displayName,void e.destinationFound(e,n[0].destination);e._searchText=`${i} (not found)`}))}function jlt(e,t){const n=Uke(e._viewContainer),i=n.getElementsByClassName("search-results")[0],o=n.getElementsByTagName("li"),r=o[t];if(0===t)return void(i.scrollTop=0);const s=r.offsetTop;s+r.clientHeight>i.clientHeight?i.scrollTop=s+r.clientHeight:s<i.scrollTop&&(i.scrollTop=s)}function Ylt(e){e._isSearchInProgress=!1,C(e._geocodePromise)&&(e._geocodePromise.cancel=!0,e._geocodePromise=void 0)}function Klt(e){return/^\s*$/.test(e)}function Xlt(e){vrt.getObservable(e,"_suggestions").removeAll()}function Qlt(e){if(!e.autoComplete)return;const t=e._searchText;if(Xlt(e),Klt(t))return;let n=Promise.resolve([]);return e._geocoderServices.forEach((function(e){n=n.then((function(n){return n.length>=5?n:e.geocode(t,ME.AUTOCOMPLETE).then((function(e){return n=n.concat(e),n}))}))})),n.then((function(t){const n=e._suggestions;for(let e=0;e<t.length;e++)n.push(t[e])}))}Object.defineProperties(klt.prototype,{complete:{get:function(){return this._complete}},scene:{get:function(){return this._scene}},search:{get:function(){return this._searchCommand}},selectedSuggestion:{get:function(){return this._selectedSuggestion}},suggestions:{get:function(){return this._suggestions}}}),klt.prototype.destroy=function(){this._suggestionSubscription.dispose()},klt.flyToDestination=Glt,klt._updateSearchSuggestions=Qlt,klt._adjustSuggestionsScroll=jlt;var Jlt=klt;const Zlt="M29.772,26.433l-7.126-7.126c0.96-1.583,1.523-3.435,1.524-5.421C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885c0,5.789,4.693,10.481,10.484,10.481c1.987,0,3.839-0.563,5.422-1.523l7.128,7.127L29.772,26.433zM7.203,13.885c0.006-3.582,2.903-6.478,6.484-6.486c3.579,0.008,6.478,2.904,6.484,6.486c-0.007,3.58-2.905,6.476-6.484,6.484C10.106,20.361,7.209,17.465,7.203,13.885z",$lt="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z";function eut(e){if(!C(e)||!C(e.container))throw new x("options.container is required.");if(!C(e.scene))throw new x("options.scene is required.");const t=Uke(e.container),n=new Jlt(e);n._startSearchPath=Zlt,n._stopSearchPath=$lt;const i=document.createElement("form");i.setAttribute("data-bind","submit: search");const o=document.createElement("input");o.type="search",o.className="cesium-geocoder-input",o.setAttribute("placeholder","Enter an address or landmark..."),o.setAttribute("data-bind",'textInput: searchText,disable: isSearchInProgress,event: { keyup: handleKeyUp, keydown: handleKeyDown, mouseover: deselectSuggestion },css: { "cesium-geocoder-input-wide" : keepExpanded || searchText.length > 0 },hasFocus: _focusTextbox'),this._onTextBoxFocus=function(){setTimeout((function(){o.select()}),0)},o.addEventListener("focus",this._onTextBoxFocus,!1),i.appendChild(o),this._textBox=o;const r=document.createElement("span");r.className="cesium-geocoder-searchButton",r.setAttribute("data-bind","click: search,cesiumSvgPath: { path: isSearchInProgress ? _stopSearchPath : _startSearchPath, width: 32, height: 32 }"),i.appendChild(r),t.appendChild(i);const s=document.createElement("div");s.className="search-results",s.setAttribute("data-bind","visible: _suggestionsVisible");const a=document.createElement("ul");a.setAttribute("data-bind","foreach: _suggestions");const c=document.createElement("li");a.appendChild(c),c.setAttribute("data-bind","text: $data.displayName, click: $parent.activateSuggestion, event: { mouseover: $parent.handleMouseover}, css: { active: $data === $parent._selectedSuggestion }"),s.appendChild(a),t.appendChild(s),vrt.applyBindings(n,i),vrt.applyBindings(n,s),this._container=t,this._searchSuggestionsContainer=s,this._viewModel=n,this._form=i,this._onInputBegin=function(e){let i=e.target;"function"===typeof e.composedPath&&(i=e.composedPath()[0]),t.contains(i)||(n._focusTextbox=!1,n.hideSuggestions())},this._onInputEnd=function(e){n._focusTextbox=!0,n.showSuggestions()},Oc.supportsPointerEvents()?(document.addEventListener("pointerdown",this._onInputBegin,!0),t.addEventListener("pointerup",this._onInputEnd,!0),t.addEventListener("pointercancel",this._onInputEnd,!0)):(document.addEventListener("mousedown",this._onInputBegin,!0),t.addEventListener("mouseup",this._onInputEnd,!0),document.addEventListener("touchstart",this._onInputBegin,!0),t.addEventListener("touchend",this._onInputEnd,!0),t.addEventListener("touchcancel",this._onInputEnd,!0))}Object.defineProperties(eut.prototype,{container:{get:function(){return this._container}},searchSuggestionsContainer:{get:function(){return this._searchSuggestionsContainer}},viewModel:{get:function(){return this._viewModel}}}),eut.prototype.isDestroyed=function(){return!1},eut.prototype.destroy=function(){const e=this._container;return Oc.supportsPointerEvents()?(document.removeEventListener("pointerdown",this._onInputBegin,!0),e.removeEventListener("pointerup",this._onInputEnd,!0)):(document.removeEventListener("mousedown",this._onInputBegin,!0),e.removeEventListener("mouseup",this._onInputEnd,!0),document.removeEventListener("touchstart",this._onInputBegin,!0),e.removeEventListener("touchend",this._onInputEnd,!0)),this._viewModel.destroy(),vrt.cleanNode(this._form),vrt.cleanNode(this._searchSuggestionsContainer),e.removeChild(this._form),e.removeChild(this._searchSuggestionsContainer),this._textBox.removeEventListener("focus",this._onTextBoxFocus,!1),Qh(this)};var tut=eut;function nut(e,t){if(!C(e))throw new x("scene is required.");this._scene=e,this._duration=t;const n=this;this._command=Qat((function(){n._scene.camera.flyHome(n._duration)})),this.tooltip="View Home",vrt.track(this,["tooltip"])}Object.defineProperties(nut.prototype,{scene:{get:function(){return this._scene}},command:{get:function(){return this._command}},duration:{get:function(){return this._duration},set:function(e){if(C(e)&&e<0)throw new x("value must be positive.");this._duration=e}}});var iut=nut;function out(e,t,n){if(!C(e))throw new x("container is required.");e=Uke(e);const i=new iut(t,n);i._svgPath="M14,4l-10,8.75h20l-4.25-3.7188v-4.6562h-2.812v2.1875l-2.938-2.5625zm-7.0938,9.906v10.094h14.094v-10.094h-14.094zm2.1876,2.313h3.3122v4.25h-3.3122v-4.25zm5.8442,1.281h3.406v6.438h-3.406v-6.438z";const o=document.createElement("button");o.type="button",o.className="cesium-button cesium-toolbar-button cesium-home-button",o.setAttribute("data-bind","attr: { title: tooltip },click: command,cesiumSvgPath: { path: _svgPath, width: 28, height: 28 }"),e.appendChild(o),vrt.applyBindings(i,o),this._container=e,this._viewModel=i,this._element=o}Object.defineProperties(out.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),out.prototype.isDestroyed=function(){return!1},out.prototype.destroy=function(){return vrt.cleanNode(this._element),this._container.removeChild(this._element),Qh(this)};var rut=out;const sut="M 13.84375 7.03125 C 11.412798 7.03125 9.46875 8.975298 9.46875 11.40625 L 9.46875 11.59375 L 2.53125 7.21875 L 2.53125 24.0625 L 9.46875 19.6875 C 9.4853444 22.104033 11.423165 24.0625 13.84375 24.0625 L 25.875 24.0625 C 28.305952 24.0625 30.28125 22.087202 30.28125 19.65625 L 30.28125 11.40625 C 30.28125 8.975298 28.305952 7.03125 25.875 7.03125 L 13.84375 7.03125 z",aut="M 27.34375 1.65625 L 5.28125 27.9375 L 8.09375 30.3125 L 30.15625 4.03125 L 27.34375 1.65625 z M 13.84375 7.03125 C 11.412798 7.03125 9.46875 8.975298 9.46875 11.40625 L 9.46875 11.59375 L 2.53125 7.21875 L 2.53125 24.0625 L 9.46875 19.6875 C 9.4724893 20.232036 9.5676108 20.7379 9.75 21.21875 L 21.65625 7.03125 L 13.84375 7.03125 z M 28.21875 7.71875 L 14.53125 24.0625 L 25.875 24.0625 C 28.305952 24.0625 30.28125 22.087202 30.28125 19.65625 L 30.28125 11.40625 C 30.28125 9.8371439 29.456025 8.4902779 28.21875 7.71875 z";function cut(){this._cameraClicked=new $n,this._closeClicked=new $n,this.maxHeight=500,this.enableCamera=!1,this.isCameraTracking=!1,this.showInfo=!1,this.titleText="",this.description="",vrt.track(this,["showInfo","titleText","description","maxHeight","enableCamera","isCameraTracking"]),this._loadingIndicatorHtml='<div class="cesium-infoBox-loadingContainer"><span class="cesium-infoBox-loading"></span></div>',this.cameraIconPath=void 0,vrt.defineProperty(this,"cameraIconPath",{get:function(){return!this.enableCamera||this.isCameraTracking?aut:sut}}),vrt.defineProperty(this,"_bodyless",{get:function(){return!C(this.description)||0===this.description.length}})}cut.prototype.maxHeightOffset=function(e){return this.maxHeight-e+"px"},Object.defineProperties(cut.prototype,{cameraClicked:{get:function(){return this._cameraClicked}},closeClicked:{get:function(){return this._closeClicked}}});var lut=cut;function uut(e){D.defined("container",e),e=Uke(e);const t=document.createElement("div");t.className="cesium-infoBox",t.setAttribute("data-bind",'css: { "cesium-infoBox-visible" : showInfo, "cesium-infoBox-bodyless" : _bodyless }'),e.appendChild(t);const n=document.createElement("div");n.className="cesium-infoBox-title",n.setAttribute("data-bind","text: titleText"),t.appendChild(n);const i=document.createElement("button");i.type="button",i.className="cesium-button cesium-infoBox-camera",i.setAttribute("data-bind",'attr: { title: "Focus camera on object" },click: function () { cameraClicked.raiseEvent(this); },enable: enableCamera,cesiumSvgPath: { path: cameraIconPath, width: 32, height: 32 }'),t.appendChild(i);const o=document.createElement("button");o.type="button",o.className="cesium-infoBox-close",o.setAttribute("data-bind","click: function () { closeClicked.raiseEvent(this); }"),o.innerHTML="&times;",t.appendChild(o);const r=document.createElement("iframe");r.className="cesium-infoBox-iframe",r.setAttribute("sandbox","allow-same-origin allow-popups allow-forms"),r.setAttribute("data-bind","style : { maxHeight : maxHeightOffset(40) }"),r.setAttribute("allowfullscreen",!0),t.appendChild(r);const s=new lut;vrt.applyBindings(s,t),this._container=e,this._element=t,this._frame=r,this._viewModel=s,this._descriptionSubscription=void 0;const a=this;r.addEventListener("load",(function(){const e=r.contentDocument,n=e.createElement("link");n.href=Zi("Widgets/InfoBox/InfoBoxDescription.css"),n.rel="stylesheet",n.type="text/css";const i=e.createElement("div");i.className="cesium-infoBox-description",e.head.appendChild(n),e.body.appendChild(i),a._descriptionSubscription=Zat(s,"description",(function(e){r.style.height="5px",i.innerHTML=e;let n=null;const o=i.firstElementChild;if(null!==o&&1===i.childNodes.length){const e=window.getComputedStyle(o);if(null!==e){const t=e["background-color"],i=xy.fromCssColorString(t);C(i)&&0!==i.alpha&&(n=e["background-color"])}}t.style["background-color"]=n;const s=i.getBoundingClientRect().height;r.style.height=`${s}px`}))})),r.setAttribute("src","about:blank")}Object.defineProperties(uut.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}},frame:{get:function(){return this._frame}}}),uut.prototype.isDestroyed=function(){return!1},uut.prototype.destroy=function(){const e=this._container;return vrt.cleanNode(this._element),e.removeChild(this._element),C(this._descriptionSubscription)&&this._descriptionSubscription.dispose(),Qh(this)};var hut=uut;function dut(){this.showInstructions=!1;const e=this;this._command=Qat((function(){e.showInstructions=!e.showInstructions})),this._showClick=Qat((function(){e._touch=!1})),this._showTouch=Qat((function(){e._touch=!0})),this._touch=!1,this.tooltip="Navigation Instructions",vrt.track(this,["tooltip","showInstructions","_touch"])}Object.defineProperties(dut.prototype,{command:{get:function(){return this._command}},showClick:{get:function(){return this._showClick}},showTouch:{get:function(){return this._showTouch}}});var fut=dut;function put(e){if(!C(e)||!C(e.container))throw new x("options.container is required.");const t=Uke(e.container),n=new fut,i=R(e.instructionsInitiallyVisible,!1);n.showInstructions=i,n._svgPath="M16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466z M17.328,24.371h-2.707v-2.596h2.707V24.371zM17.328,19.003v0.858h-2.707v-1.057c0-3.19,3.63-3.696,3.63-5.963c0-1.034-0.924-1.826-2.134-1.826c-1.254,0-2.354,0.924-2.354,0.924l-1.541-1.915c0,0,1.519-1.584,4.137-1.584c2.487,0,4.796,1.54,4.796,4.136C21.156,16.208,17.328,16.627,17.328,19.003z";const o=document.createElement("span");o.className="cesium-navigationHelpButton-wrapper",t.appendChild(o);const r=document.createElement("button");r.type="button",r.className="cesium-button cesium-toolbar-button cesium-navigation-help-button",r.setAttribute("data-bind","attr: { title: tooltip },click: command,cesiumSvgPath: { path: _svgPath, width: 32, height: 32 }"),o.appendChild(r);const s=document.createElement("div");s.className="cesium-navigation-help",s.setAttribute("data-bind",'css: { "cesium-navigation-help-visible" : showInstructions}'),o.appendChild(s);const a=document.createElement("button");a.type="button",a.className="cesium-navigation-button cesium-navigation-button-left",a.setAttribute("data-bind",'click: showClick, css: {"cesium-navigation-button-selected": !_touch, "cesium-navigation-button-unselected": _touch}');const c=document.createElement("img");c.src=Zi("Widgets/Images/NavigationHelp/Mouse.svg"),c.className="cesium-navigation-button-icon",c.style.width="25px",c.style.height="25px",a.appendChild(c),a.appendChild(document.createTextNode("Mouse"));const l=document.createElement("button");l.type="button",l.className="cesium-navigation-button cesium-navigation-button-right",l.setAttribute("data-bind",'click: showTouch, css: {"cesium-navigation-button-selected": _touch, "cesium-navigation-button-unselected": !_touch}');const u=document.createElement("img");u.src=Zi("Widgets/Images/NavigationHelp/Touch.svg"),u.className="cesium-navigation-button-icon",u.style.width="25px",u.style.height="25px",l.appendChild(u),l.appendChild(document.createTextNode("Touch")),s.appendChild(a),s.appendChild(l);const h=document.createElement("div");h.className="cesium-click-navigation-help cesium-navigation-help-instructions",h.setAttribute("data-bind",'css: { "cesium-click-navigation-help-visible" : !_touch}'),h.innerHTML=`            <table>                <tr>                    <td><img src="${Zi("Widgets/Images/NavigationHelp/MouseLeft.svg")}" width="48" height="48" /></td>                    <td>                        <div class="cesium-navigation-help-pan">Pan view</div>                        <div class="cesium-navigation-help-details">Left click + drag</div>                    </td>                </tr>                <tr>                    <td><img src="${Zi("Widgets/Images/NavigationHelp/MouseRight.svg")}" width="48" height="48" /></td>                    <td>                        <div class="cesium-navigation-help-zoom">Zoom view</div>                        <div class="cesium-navigation-help-details">Right click + drag, or</div>                        <div class="cesium-navigation-help-details">Mouse wheel scroll</div>                    </td>                </tr>                <tr>                    <td><img src="${Zi("Widgets/Images/NavigationHelp/MouseMiddle.svg")}" width="48" height="48" /></td>                    <td>                        <div class="cesium-navigation-help-rotate">Rotate view</div>                        <div class="cesium-navigation-help-details">Middle click + drag, or</div>                        <div class="cesium-navigation-help-details">CTRL + Left/Right click + drag</div>                    </td>                </tr>            </table>`,s.appendChild(h);const d=document.createElement("div");d.className="cesium-touch-navigation-help cesium-navigation-help-instructions",d.setAttribute("data-bind",'css: { "cesium-touch-navigation-help-visible" : _touch}'),d.innerHTML=`            <table>                <tr>                    <td><img src="${Zi("Widgets/Images/NavigationHelp/TouchDrag.svg")}" width="70" height="48" /></td>                    <td>                        <div class="cesium-navigation-help-pan">Pan view</div>                        <div class="cesium-navigation-help-details">One finger drag</div>                    </td>                </tr>                <tr>                    <td><img src="${Zi("Widgets/Images/NavigationHelp/TouchZoom.svg")}" width="70" height="48" /></td>                    <td>                        <div class="cesium-navigation-help-zoom">Zoom view</div>                        <div class="cesium-navigation-help-details">Two finger pinch</div>                    </td>                </tr>                <tr>                    <td><img src="${Zi("Widgets/Images/NavigationHelp/TouchTilt.svg")}" width="70" height="48" /></td>                    <td>                        <div class="cesium-navigation-help-rotate">Tilt view</div>                        <div class="cesium-navigation-help-details">Two finger drag, same direction</div>                    </td>                </tr>                <tr>                    <td><img src="${Zi("Widgets/Images/NavigationHelp/TouchRotate.svg")}" width="70" height="48" /></td>                    <td>                        <div class="cesium-navigation-help-tilt">Rotate view</div>                        <div class="cesium-navigation-help-details">Two finger drag, opposite direction</div>                    </td>                </tr>            </table>`,s.appendChild(d),vrt.applyBindings(n,o),this._container=t,this._viewModel=n,this._wrapper=o,this._closeInstructions=function(e){o.contains(e.target)||(n.showInstructions=!1)},Oc.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeInstructions,!0):(document.addEventListener("mousedown",this._closeInstructions,!0),document.addEventListener("touchstart",this._closeInstructions,!0))}Object.defineProperties(put.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),put.prototype.isDestroyed=function(){return!1},put.prototype.destroy=function(){return Oc.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeInstructions,!0):(document.removeEventListener("mousedown",this._closeInstructions,!0),document.removeEventListener("touchstart",this._closeInstructions,!0)),vrt.cleanNode(this._wrapper),this._container.removeChild(this._wrapper),Qh(this)};var mut=put;function _ut(e){if(!C(e)||!C(e.scene))throw new x("options.scene is required.");this._scene=e.scene,this.lowFrameRateMessage=R(e.lowFrameRateMessage,"This application appears to be performing poorly on your system.  Please try using a different web browser or updating your video drivers."),this.lowFrameRateMessageDismissed=!1,this.showingLowFrameRateMessage=!1,vrt.track(this,["lowFrameRateMessage","lowFrameRateMessageDismissed","showingLowFrameRateMessage"]);const t=this;this._dismissMessage=Qat((function(){t.showingLowFrameRateMessage=!1,t.lowFrameRateMessageDismissed=!0}));const n=LQe.fromScene(e.scene);this._unsubscribeLowFrameRate=n.lowFrameRate.addEventListener((function(){t.lowFrameRateMessageDismissed||(t.showingLowFrameRateMessage=!0)})),this._unsubscribeNominalFrameRate=n.nominalFrameRate.addEventListener((function(){t.showingLowFrameRateMessage=!1}))}Object.defineProperties(_ut.prototype,{scene:{get:function(){return this._scene}},dismissMessage:{get:function(){return this._dismissMessage}}}),_ut.prototype.destroy=function(){return this._unsubscribeLowFrameRate(),this._unsubscribeNominalFrameRate(),Qh(this)};var gut=_ut;function yut(e){if(!C(e)||!C(e.container))throw new x("options.container is required.");if(!C(e.scene))throw new x("options.scene is required.");const t=Uke(e.container),n=new gut(e),i=document.createElement("div");i.className="cesium-performance-watchdog-message-area",i.setAttribute("data-bind","visible: showingLowFrameRateMessage");const o=document.createElement("button");o.setAttribute("type","button"),o.className="cesium-performance-watchdog-message-dismiss",o.innerHTML="&times;",o.setAttribute("data-bind","click: dismissMessage"),i.appendChild(o);const r=document.createElement("div");r.className="cesium-performance-watchdog-message",r.setAttribute("data-bind","html: lowFrameRateMessage"),i.appendChild(r),t.appendChild(i),vrt.applyBindings(n,i),this._container=t,this._viewModel=n,this._element=i}Object.defineProperties(yut.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),yut.prototype.isDestroyed=function(){return!1},yut.prototype.destroy=function(){return this._viewModel.destroy(),vrt.cleanNode(this._element),this._container.removeChild(this._element),Qh(this)};function vut(e){if(!C(e))throw new x("scene is required.");this._scene=e,this._orthographic=e.camera.frustum instanceof jC,this._flightInProgress=!1,this.dropDownVisible=!1,this.tooltipPerspective="Perspective Projection",this.tooltipOrthographic="Orthographic Projection",this.selectedTooltip=void 0,this.sceneMode=e.mode,vrt.track(this,["_orthographic","_flightInProgress","sceneMode","dropDownVisible","tooltipPerspective","tooltipOrthographic"]);const t=this;vrt.defineProperty(this,"selectedTooltip",(function(){return t._orthographic?t.tooltipOrthographic:t.tooltipPerspective})),this._toggleDropDown=Qat((function(){t.sceneMode===ij.SCENE2D||t._flightInProgress||(t.dropDownVisible=!t.dropDownVisible)})),this._eventHelper=new RC,this._eventHelper.add(e.morphComplete,(function(e,n,i,o){t.sceneMode=i,t._orthographic=i===ij.SCENE2D||t._scene.camera.frustum instanceof jC})),this._eventHelper.add(e.preRender,(function(){t._flightInProgress=C(e.camera._currentFlight)})),this._switchToPerspective=Qat((function(){t.sceneMode!==ij.SCENE2D&&(t._scene.camera.switchToPerspectiveFrustum(),t._orthographic=!1,t.dropDownVisible=!1)})),this._switchToOrthographic=Qat((function(){t.sceneMode!==ij.SCENE2D&&(t._scene.camera.switchToOrthographicFrustum(),t._orthographic=!0,t.dropDownVisible=!1)})),this._sceneMode=ij}Object.defineProperties(vut.prototype,{scene:{get:function(){return this._scene}},toggleDropDown:{get:function(){return this._toggleDropDown}},switchToPerspective:{get:function(){return this._switchToPerspective}},switchToOrthographic:{get:function(){return this._switchToOrthographic}},isOrthographicProjection:{get:function(){return this._orthographic}}}),vut.prototype.isDestroyed=function(){return!1},vut.prototype.destroy=function(){this._eventHelper.removeAll(),Qh(this)};var but=vut;const Aut="M 28.15625,10.4375 9.125,13.21875 13.75,43.25 41.75,55.09375 50.8125,37 54.5,11.9375 z m 0.125,3 19.976451,0.394265 L 43.03125,16.875 22.6875,14.28125 z M 50.971746,15.705477 47.90625,36.03125 42.53125,46 44.84375,19.3125 z M 12.625,16.03125 l 29.15625,3.6875 -2.65625,31 L 16.4375,41.125 z",wut="m 31.560594,6.5254438 -20.75,12.4687502 0.1875,24.5625 22.28125,11.8125 19.5,-12 0.65625,-0.375 0,-0.75 0.0312,-23.21875 z m 0.0625,3.125 16.65625,9.5000002 -16.125,10.28125 -17.34375,-9.71875 z m 18.96875,11.1875002 0.15625,20.65625 -17.46875,10.59375 0.15625,-20.28125 z m -37.0625,1.25 17.21875,9.625 -0.15625,19.21875 -16.9375,-9 z";function Tut(e,t){if(!C(e))throw new x("container is required.");if(!C(t))throw new x("scene is required.");e=Uke(e);const n=new but(t);n._perspectivePath=Aut,n._orthographicPath=wut;const i=document.createElement("span");i.className="cesium-projectionPicker-wrapper cesium-toolbar-button",e.appendChild(i);const o=document.createElement("button");o.type="button",o.className="cesium-button cesium-toolbar-button",o.setAttribute("data-bind",'css: { "cesium-projectionPicker-buttonPerspective": !_orthographic,       "cesium-projectionPicker-buttonOrthographic": _orthographic,       "cesium-button-disabled" : sceneMode === _sceneMode.SCENE2D || _flightInProgress,        "cesium-projectionPicker-selected": dropDownVisible },attr: { title: selectedTooltip },click: toggleDropDown'),o.innerHTML='\x3c!-- ko cesiumSvgPath: { path: _perspectivePath, width: 64, height: 64, css: "cesium-projectionPicker-iconPerspective" } --\x3e\x3c!-- /ko --\x3e\x3c!-- ko cesiumSvgPath: { path: _orthographicPath, width: 64, height: 64, css: "cesium-projectionPicker-iconOrthographic" } --\x3e\x3c!-- /ko --\x3e',i.appendChild(o);const r=document.createElement("button");r.type="button",r.className="cesium-button cesium-toolbar-button cesium-projectionPicker-dropDown-icon",r.setAttribute("data-bind",'css: { "cesium-projectionPicker-visible" : (dropDownVisible && _orthographic),       "cesium-projectionPicker-none" : !_orthographic,       "cesium-projectionPicker-hidden" : !dropDownVisible },attr: { title: tooltipPerspective },click: switchToPerspective,cesiumSvgPath: { path: _perspectivePath, width: 64, height: 64 }'),i.appendChild(r);const s=document.createElement("button");s.type="button",s.className="cesium-button cesium-toolbar-button cesium-projectionPicker-dropDown-icon",s.setAttribute("data-bind",'css: { "cesium-projectionPicker-visible" : (dropDownVisible && !_orthographic),       "cesium-projectionPicker-none" : _orthographic,       "cesium-projectionPicker-hidden" : !dropDownVisible},attr: { title: tooltipOrthographic },click: switchToOrthographic,cesiumSvgPath: { path: _orthographicPath, width: 64, height: 64 }'),i.appendChild(s),vrt.applyBindings(n,i),this._viewModel=n,this._container=e,this._wrapper=i,this._closeDropDown=function(e){i.contains(e.target)||(n.dropDownVisible=!1)},Oc.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeDropDown,!0):(document.addEventListener("mousedown",this._closeDropDown,!0),document.addEventListener("touchstart",this._closeDropDown,!0))}Object.defineProperties(Tut.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),Tut.prototype.isDestroyed=function(){return!1},Tut.prototype.destroy=function(){return this._viewModel.destroy(),Oc.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeDropDown,!0):(document.removeEventListener("mousedown",this._closeDropDown,!0),document.removeEventListener("touchstart",this._closeDropDown,!0)),vrt.cleanNode(this._wrapper),this._container.removeChild(this._wrapper),Qh(this)};var Cut=Tut;function Eut(e,t){if(!C(e))throw new x("scene is required.");this._scene=e;const n=this,i=function(e,t,i,o){n.sceneMode=i,n.dropDownVisible=!1};this._eventHelper=new RC,this._eventHelper.add(e.morphStart,i),this._duration=R(t,2),this.sceneMode=e.mode,this.dropDownVisible=!1,this.tooltip2D="2D",this.tooltip3D="3D",this.tooltipColumbusView="Columbus View",vrt.track(this,["sceneMode","dropDownVisible","tooltip2D","tooltip3D","tooltipColumbusView"]),this.selectedTooltip=void 0,vrt.defineProperty(this,"selectedTooltip",(function(){const e=n.sceneMode;return e===ij.SCENE2D?n.tooltip2D:e===ij.SCENE3D?n.tooltip3D:n.tooltipColumbusView})),this._toggleDropDown=Qat((function(){n.dropDownVisible=!n.dropDownVisible})),this._morphTo2D=Qat((function(){e.morphTo2D(n._duration)})),this._morphTo3D=Qat((function(){e.morphTo3D(n._duration)})),this._morphToColumbusView=Qat((function(){e.morphToColumbusView(n._duration)})),this._sceneMode=ij}Object.defineProperties(Eut.prototype,{scene:{get:function(){return this._scene}},duration:{get:function(){return this._duration},set:function(e){if(e<0)throw new x("duration value must be positive.");this._duration=e}},toggleDropDown:{get:function(){return this._toggleDropDown}},morphTo2D:{get:function(){return this._morphTo2D}},morphTo3D:{get:function(){return this._morphTo3D}},morphToColumbusView:{get:function(){return this._morphToColumbusView}}}),Eut.prototype.isDestroyed=function(){return!1},Eut.prototype.destroy=function(){this._eventHelper.removeAll(),Qh(this)};var xut=Eut;const Sut="m 32.401392,4.9330437 c -7.087603,0 -14.096095,2.884602 -19.10793,7.8946843 -5.0118352,5.010083 -7.9296167,11.987468 -7.9296167,19.072999 0,7.085531 2.9177815,14.097848 7.9296167,19.107931 4.837653,4.835961 11.541408,7.631372 18.374354,7.82482 0.05712,0.01231 0.454119,0.139729 0.454119,0.139729 l 0.03493,-0.104797 c 0.08246,7.84e-4 0.162033,0.03493 0.244525,0.03493 0.08304,0 0.161515,-0.03414 0.244526,-0.03493 l 0.03493,0.104797 c 0,0 0.309474,-0.129487 0.349323,-0.139729 6.867765,-0.168094 13.582903,-2.965206 18.444218,-7.82482 2.558195,-2.5573 4.551081,-5.638134 5.903547,-8.977584 1.297191,-3.202966 2.02607,-6.661489 2.02607,-10.130347 0,-6.237309 -2.366261,-12.31219 -6.322734,-17.116794 -0.0034,-0.02316 0.0049,-0.04488 0,-0.06986 -0.01733,-0.08745 -0.104529,-0.278855 -0.104797,-0.279458 -5.31e-4,-0.0012 -0.522988,-0.628147 -0.523984,-0.62878         -3.47e-4,-2.2e-4 -0.133444,-0.03532 -0.244525,-0.06987 C 51.944299,13.447603 51.751076,13.104317 51.474391,12.827728 46.462556,7.8176457 39.488996,4.9330437 32.401392,4.9330437 z m -2.130866,3.5281554 0.104797,9.6762289 c -4.111695,-0.08361 -7.109829,-0.423664 -9.257041,-0.943171 1.198093,-2.269271 2.524531,-4.124404 3.91241,-5.414496 2.167498,-2.0147811 3.950145,-2.8540169 5.239834,-3.3185619 z m 2.794579,0 c 1.280302,0.4754953 3.022186,1.3285948 5.065173,3.2486979 1.424667,1.338973 2.788862,3.303645 3.982275,5.728886 -2.29082,0.403367 -5.381258,0.621049 -8.942651,0.698645 L 33.065105,8.4611991 z m 5.728886,0.2445256 c 4.004072,1.1230822 7.793098,3.1481363 10.724195,6.0782083 0.03468,0.03466 0.07033,0.06991 0.104797,0.104797 -0.45375,0.313891 -0.923054,0.663002 -1.956205,1.082899 -0.647388,0.263114 -1.906242,0.477396 -2.829511,0.733577 -1.382296,-2.988132         -3.027146,-5.368585 -4.785716,-7.0213781 -0.422866,-0.397432 -0.835818,-0.6453247 -1.25756,-0.9781032 z m -15.33525,0.7685092 c -0.106753,0.09503 -0.207753,0.145402 -0.31439,0.244526 -1.684973,1.5662541 -3.298068,3.8232211 -4.680919,6.5672591 -0.343797,-0.14942 -1.035052,-0.273198 -1.292493,-0.419186 -0.956528,-0.542427 -1.362964,-1.022024 -1.537018,-1.292493 -0.0241,-0.03745 -0.01868,-0.0401 -0.03493,-0.06986 2.250095,-2.163342 4.948824,-3.869984 7.859752,-5.0302421 z m -9.641296,7.0912431 c 0.464973,0.571618 0.937729,1.169056 1.956205,1.746612 0.349907,0.198425 1.107143,0.335404 1.537018,0.523983 -1.20166,3.172984 -1.998037,7.051901 -2.165798,11.772162 C 14.256557,30.361384 12.934823,30.161483 12.280427,29.90959 10.644437,29.279855 9.6888882,28.674891 9.1714586,28.267775 8.6540289,27.860658 8.6474751,27.778724 8.6474751,27.778724 l -0.069864,0.03493 C 9.3100294,23.691285         11.163248,19.798527 13.817445,16.565477 z m 37.552149,0.523984 c 2.548924,3.289983 4.265057,7.202594 4.890513,11.318043 -0.650428,0.410896 -1.756876,1.001936 -3.563088,1.606882 -1.171552,0.392383 -3.163859,0.759153 -4.960377,1.117832 -0.04367,-4.752703 -0.784809,-8.591423 -1.88634,-11.807094 0.917574,-0.263678 2.170552,-0.486495 2.864443,-0.76851 1.274693,-0.518066 2.003942,-1.001558 2.654849,-1.467153 z m -31.439008,2.619917 c 2.487341,0.672766 5.775813,1.137775 10.479669,1.222628 l 0.104797,10.689263 0,0.03493 0,0.733577 c -5.435005,-0.09059 -9.512219,-0.519044 -12.610536,-1.117831 0.106127,-4.776683 0.879334,-8.55791 2.02607,-11.562569 z m 23.264866,0.31439 c 1.073459,3.067541 1.833795,6.821314 1.816476,11.702298 -3.054474,0.423245 -7.062018,0.648559 -11.702298,0.698644 l 0,-0.838373 -0.104796,-10.654331 c 4.082416,-0.0864 7.404468,-0.403886 9.990618,-0.908238 z         M 8.2632205,30.922625 c 0.7558676,0.510548 1.5529563,1.013339 3.0041715,1.57195 0.937518,0.360875 2.612202,0.647642 3.91241,0.978102 0.112814,3.85566 0.703989,7.107756 1.606883,9.920754 -1.147172,-0.324262 -2.644553,-0.640648 -3.423359,-0.978102 -1.516688,-0.657177 -2.386627,-1.287332 -2.864443,-1.71168 -0.477816,-0.424347 -0.489051,-0.489051 -0.489051,-0.489051 L 9.8002387,40.319395 C 8.791691,37.621767 8.1584238,34.769583 8.1584238,31.900727 c 0,-0.330153 0.090589,-0.648169 0.1047967,-0.978102 z m 48.2763445,0.419186 c 0.0047,0.188973 0.06986,0.36991 0.06986,0.558916 0,2.938869 -0.620228,5.873558 -1.676747,8.628261 -0.07435,0.07583 -0.06552,0.07411 -0.454119,0.349323 -0.606965,0.429857 -1.631665,1.042044 -3.318562,1.676747 -1.208528,0.454713 -3.204964,0.850894 -5.135038,1.25756 0.84593,-2.765726 1.41808,-6.005357 1.606883,-9.815957 2.232369,-0.413371 4.483758,-0.840201         5.938479,-1.327425 1.410632,-0.472457 2.153108,-0.89469 2.96924,-1.327425 z m -38.530252,2.864443 c 3.208141,0.56697 7.372279,0.898588 12.575603,0.978103 l 0.174662,9.885821 c -4.392517,-0.06139 -8.106722,-0.320566 -10.863925,-0.803441 -1.051954,-2.664695 -1.692909,-6.043794 -1.88634,-10.060483 z m 26.793022,0.31439 c -0.246298,3.923551 -0.877762,7.263679 -1.816476,9.885822 -2.561957,0.361954 -5.766249,0.560708 -9.431703,0.62878 l -0.174661,-9.815957 c 4.491734,-0.04969 8.334769,-0.293032 11.42284,-0.698645 z M 12.035901,44.860585 c 0.09977,0.04523 0.105535,0.09465 0.209594,0.139729 1.337656,0.579602 3.441099,1.058072 5.589157,1.537018 1.545042,3.399208 3.548524,5.969402 5.589157,7.789888 -3.034411,-1.215537 -5.871615,-3.007978 -8.174142,-5.309699 -1.245911,-1.245475 -2.271794,-2.662961 -3.213766,-4.156936 z m 40.69605,0 c -0.941972,1.493975 -1.967855,2.911461         -3.213765,4.156936 -2.74253,2.741571 -6.244106,4.696717 -9.955686,5.868615 0.261347,-0.241079 0.507495,-0.394491 0.768509,-0.663713 1.674841,-1.727516 3.320792,-4.181056 4.645987,-7.265904 2.962447,-0.503021 5.408965,-1.122293 7.161107,-1.781544 0.284034,-0.106865 0.337297,-0.207323 0.593848,-0.31439 z m -31.404076,2.305527 c 2.645807,0.376448 5.701178,0.649995 9.466635,0.698645 l 0.139729,7.789888 c -1.38739,-0.480844 -3.316218,-1.29837 -5.659022,-3.388427 -1.388822,-1.238993 -2.743668,-3.0113 -3.947342,-5.100106 z m 20.365491,0.104797 c -1.04872,2.041937 -2.174337,3.779068 -3.353494,4.995309 -1.853177,1.911459 -3.425515,2.82679 -4.611055,3.353494 l -0.139729,-7.789887 c 3.13091,-0.05714 5.728238,-0.278725 8.104278,-0.558916 z",Iut="m 2.9825053,17.550598 0,1.368113 0,26.267766 0,1.368113 1.36811,0 54.9981397,0 1.36811,0 0,-1.368113 0,-26.267766 0,-1.368113 -1.36811,0 -54.9981397,0 -1.36811,0 z m 2.73623,2.736226 10.3292497,0 0,10.466063 -10.3292497,0 0,-10.466063 z m 13.0654697,0 11.69737,0 0,10.466063 -11.69737,0 0,-10.466063 z m 14.43359,0 11.69737,0 0,10.466063 -11.69737,0 0,-10.466063 z m 14.43359,0 10.32926,0 0,10.466063 -10.32926,0 0,-10.466063 z m -41.9326497,13.202288 10.3292497,0 0,10.329252 -10.3292497,0 0,-10.329252 z m 13.0654697,0 11.69737,0 0,10.329252 -11.69737,0 0,-10.329252 z m 14.43359,0 11.69737,0 0,10.329252 -11.69737,0 0,-10.329252 z m 14.43359,0 10.32926,0 0,10.329252 -10.32926,0 0,-10.329252 z",Out="m 14.723969,17.675598 -0.340489,0.817175 -11.1680536,26.183638 -0.817175,1.872692 2.076986,0 54.7506996,0 2.07698,0 -0.81717,-1.872692 -11.16805,-26.183638 -0.34049,-0.817175 -0.91933,0 -32.414586,0 -0.919322,0 z m 1.838643,2.723916 6.196908,0 -2.928209,10.418977 -7.729111,0 4.460412,-10.418977 z m 9.02297,0 4.903049,0 0,10.418977 -7.831258,0 2.928209,-10.418977 z m 7.626964,0 5.584031,0 2.62176,10.418977 -8.205791,0 0,-10.418977 z m 8.410081,0 5.51593,0 4.46042,10.418977 -7.38863,0 -2.58772,-10.418977 z m -30.678091,13.142892 8.103649,0 -2.89416,10.282782 -9.6018026,0 4.3923136,-10.282782 z m 10.929711,0 8.614384,0 0,10.282782 -11.508544,0 2.89416,-10.282782 z m 11.338299,0 8.852721,0 2.58772,10.282782 -11.440441,0 0,-10.282782 z m 11.678781,0 7.86531,0 4.39231,10.282782 -9.6699,0 -2.58772,-10.282782 z";function Dut(e,t,n){if(!C(e))throw new x("container is required.");if(!C(t))throw new x("scene is required.");e=Uke(e);const i=new xut(t,n);i._globePath=Sut,i._flatMapPath=Iut,i._columbusViewPath=Out;const o=document.createElement("span");o.className="cesium-sceneModePicker-wrapper cesium-toolbar-button",e.appendChild(o);const r=document.createElement("button");r.type="button",r.className="cesium-button cesium-toolbar-button",r.setAttribute("data-bind",'css: { "cesium-sceneModePicker-button2D": sceneMode === _sceneMode.SCENE2D,       "cesium-sceneModePicker-button3D": sceneMode === _sceneMode.SCENE3D,       "cesium-sceneModePicker-buttonColumbusView": sceneMode === _sceneMode.COLUMBUS_VIEW,       "cesium-sceneModePicker-selected": dropDownVisible },attr: { title: selectedTooltip },click: toggleDropDown'),r.innerHTML='\x3c!-- ko cesiumSvgPath: { path: _globePath, width: 64, height: 64, css: "cesium-sceneModePicker-slide-svg cesium-sceneModePicker-icon3D" } --\x3e\x3c!-- /ko --\x3e\x3c!-- ko cesiumSvgPath: { path: _flatMapPath, width: 64, height: 64, css: "cesium-sceneModePicker-slide-svg cesium-sceneModePicker-icon2D" } --\x3e\x3c!-- /ko --\x3e\x3c!-- ko cesiumSvgPath: { path: _columbusViewPath, width: 64, height: 64, css: "cesium-sceneModePicker-slide-svg cesium-sceneModePicker-iconColumbusView" } --\x3e\x3c!-- /ko --\x3e',o.appendChild(r);const s=document.createElement("button");s.type="button",s.className="cesium-button cesium-toolbar-button cesium-sceneModePicker-dropDown-icon",s.setAttribute("data-bind",'css: { "cesium-sceneModePicker-visible" : (dropDownVisible && (sceneMode !== _sceneMode.SCENE3D)) || (!dropDownVisible && (sceneMode === _sceneMode.SCENE3D)),       "cesium-sceneModePicker-none" : sceneMode === _sceneMode.SCENE3D,       "cesium-sceneModePicker-hidden" : !dropDownVisible },attr: { title: tooltip3D },click: morphTo3D,cesiumSvgPath: { path: _globePath, width: 64, height: 64 }'),o.appendChild(s);const a=document.createElement("button");a.type="button",a.className="cesium-button cesium-toolbar-button cesium-sceneModePicker-dropDown-icon",a.setAttribute("data-bind",'css: { "cesium-sceneModePicker-visible" : (dropDownVisible && (sceneMode !== _sceneMode.SCENE2D)),       "cesium-sceneModePicker-none" : sceneMode === _sceneMode.SCENE2D,       "cesium-sceneModePicker-hidden" : !dropDownVisible },attr: { title: tooltip2D },click: morphTo2D,cesiumSvgPath: { path: _flatMapPath, width: 64, height: 64 }'),o.appendChild(a);const c=document.createElement("button");c.type="button",c.className="cesium-button cesium-toolbar-button cesium-sceneModePicker-dropDown-icon",c.setAttribute("data-bind",'css: { "cesium-sceneModePicker-visible" : (dropDownVisible && (sceneMode !== _sceneMode.COLUMBUS_VIEW)) || (!dropDownVisible && (sceneMode === _sceneMode.COLUMBUS_VIEW)),       "cesium-sceneModePicker-none" : sceneMode === _sceneMode.COLUMBUS_VIEW,       "cesium-sceneModePicker-hidden" : !dropDownVisible},attr: { title: tooltipColumbusView },click: morphToColumbusView,cesiumSvgPath: { path: _columbusViewPath, width: 64, height: 64 }'),o.appendChild(c),vrt.applyBindings(i,o),this._viewModel=i,this._container=e,this._wrapper=o,this._closeDropDown=function(e){o.contains(e.target)||(i.dropDownVisible=!1)},Oc.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeDropDown,!0):(document.addEventListener("mousedown",this._closeDropDown,!0),document.addEventListener("touchstart",this._closeDropDown,!0))}Object.defineProperties(Dut.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),Dut.prototype.isDestroyed=function(){return!1},Dut.prototype.destroy=function(){return this._viewModel.destroy(),Oc.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeDropDown,!0):(document.removeEventListener("mousedown",this._closeDropDown,!0),document.removeEventListener("touchstart",this._closeDropDown,!0)),vrt.cleanNode(this._wrapper),this._container.removeChild(this._wrapper),Qh(this)};var Put=Dut;const Rut=new ro,Lut="-1000px";function Mut(e,t,n){if(!C(e))throw new x("scene is required.");if(!C(t))throw new x("selectionIndicatorElement is required.");if(!C(n))throw new x("container is required.");this._scene=e,this._screenPositionX=Lut,this._screenPositionY=Lut,this._tweens=e.tweens,this._container=R(n,document.body),this._selectionIndicatorElement=t,this._scale=1,this.position=void 0,this.showSelection=!1,vrt.track(this,["position","_screenPositionX","_screenPositionY","_scale","showSelection"]),this.isVisible=void 0,vrt.defineProperty(this,"isVisible",{get:function(){return this.showSelection&&C(this.position)}}),vrt.defineProperty(this,"_transform",{get:function(){return`scale(${this._scale})`}}),this.computeScreenSpacePosition=function(t,n){return Aoe.wgs84ToWindowCoordinates(e,t,n)}}Mut.prototype.update=function(){if(this.showSelection&&C(this.position)){const e=this.computeScreenSpacePosition(this.position,Rut);if(C(e)){const t=this._container,n=t.parentNode.clientWidth,i=t.parentNode.clientHeight,o=this._selectionIndicatorElement.clientWidth,r=.5*o;e.x=Math.min(Math.max(e.x,-o),n+o)-r,e.y=Math.min(Math.max(e.y,-o),i+o)-r,this._screenPositionX=`${Math.floor(e.x+.25)}px`,this._screenPositionY=`${Math.floor(e.y+.25)}px`}else this._screenPositionX=Lut,this._screenPositionY=Lut}},Mut.prototype.animateAppear=function(){this._tweens.addProperty({object:this,property:"_scale",startValue:2,stopValue:1,duration:.8,easingFunction:rC.EXPONENTIAL_OUT})},Mut.prototype.animateDepart=function(){this._tweens.addProperty({object:this,property:"_scale",startValue:this._scale,stopValue:1.5,duration:.8,easingFunction:rC.EXPONENTIAL_OUT})},Object.defineProperties(Mut.prototype,{container:{get:function(){return this._container}},selectionIndicatorElement:{get:function(){return this._selectionIndicatorElement}},scene:{get:function(){return this._scene}}});var But=Mut;function Nut(e,t){if(!C(e))throw new x("container is required.");e=Uke(e),this._container=e;const n=document.createElement("div");n.className="cesium-selection-wrapper",n.setAttribute("data-bind",'style: { "top" : _screenPositionY, "left" : _screenPositionX },css: { "cesium-selection-wrapper-visible" : isVisible }'),e.appendChild(n),this._element=n;const i="http://www.w3.org/2000/svg",o="M -34 -34 L -34 -11.25 L -30 -15.25 L -30 -30 L -15.25 -30 L -11.25 -34 L -34 -34 z M 11.25 -34 L 15.25 -30 L 30 -30 L 30 -15.25 L 34 -11.25 L 34 -34 L 11.25 -34 z M -34 11.25 L -34 34 L -11.25 34 L -15.25 30 L -30 30 L -30 15.25 L -34 11.25 z M 34 11.25 L 30 15.25 L 30 30 L 15.25 30 L 11.25 34 L 34 34 L 34 11.25 z",r=document.createElementNS(i,"svg:svg");r.setAttribute("width",160),r.setAttribute("height",160),r.setAttribute("viewBox","0 0 160 160");const s=document.createElementNS(i,"g");s.setAttribute("transform","translate(80,80)"),r.appendChild(s);const a=document.createElementNS(i,"path");a.setAttribute("data-bind","attr: { transform: _transform }"),a.setAttribute("d",o),s.appendChild(a),n.appendChild(r);const c=new But(t,this._element,this._container);this._viewModel=c,vrt.applyBindings(this._viewModel,this._element)}Object.defineProperties(Nut.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),Nut.prototype.isDestroyed=function(){return!1},Nut.prototype.destroy=function(){const e=this._container;return vrt.cleanNode(this._element),e.removeChild(this._element),Qh(this)};var Fut=Nut;function zut(e,t,n){this._color=e,this._height=t,this._base=R(n,0)}zut.prototype.getHeight=function(){return this._height},zut.prototype.getBase=function(){return this._base},zut.prototype.getStartTime=function(){return this._start},zut.prototype.getStopTime=function(){return this._stop},zut.prototype.setRange=function(e,t){this._start=e,this._stop=t},zut.prototype.render=function(e){let t="";if(this._start&&this._stop&&this._color){const n=Ea.secondsDifference(this._start,e.epochJulian);let i=Math.round(e.timeBarWidth*e.getAlpha(n));const o=Ea.secondsDifference(this._stop,e.epochJulian);let r=Math.round(e.timeBarWidth*e.getAlpha(o))-i;i<0&&(r+=i,i=0),i+r>e.timeBarWidth&&(r=e.timeBarWidth-i),r>0&&(t=`<span class="cesium-timeline-highlight" style="left: ${i.toString()}px; width: ${r.toString()}px; bottom: ${this._base.toString()}px; height: ${this._height}px; background-color: ${this._color};"></span>`)}return t};var kut=zut;function Uut(e,t,n,i){this.interval=e,this.height=t,this.color=n||new xy(.5,.5,.5,1),this.backgroundColor=i||new xy(0,0,0,0)}Uut.prototype.render=function(e,t){const n=this.interval.start,i=this.interval.stop,o=t.startJulian,r=Ea.addSeconds(t.startJulian,t.duration,new Ea);if(Ea.lessThan(n,o)&&Ea.greaterThan(i,r))e.fillStyle=this.color.toCssColorString(),e.fillRect(0,t.y,t.timeBarWidth,this.height);else if(Ea.lessThanOrEquals(n,r)&&Ea.greaterThanOrEquals(i,o)){let o,r,s;for(o=0;o<t.timeBarWidth;++o){const e=Ea.addSeconds(t.startJulian,o/t.timeBarWidth*t.duration,new Ea);!C(r)&&Ea.greaterThanOrEquals(e,n)?r=o:!C(s)&&Ea.greaterThanOrEquals(e,i)&&(s=o)}e.fillStyle=this.backgroundColor.toCssColorString(),e.fillRect(0,t.y,t.timeBarWidth,this.height),C(r)&&(C(s)||(s=t.timeBarWidth),e.fillStyle=this.color.toCssColorString(),e.fillRect(r,t.y,Math.max(s-r,1),this.height))}};var Vut=Uut;let Hut=1e12;const Gut={none:0,scrub:1,slide:2,zoom:3,touchOnly:4},Wut={none:0,scrub:1,slideZoom:2,singleTap:3,ignore:4},qut=[.001,.002,.005,.01,.02,.05,.1,.25,.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600,7200,14400,21600,43200,86400,172800,345600,604800,1296e3,2592e3,5184e3,7776e3,15552e3,31536e3,63072e3,126144e3,15768e4,31536e4,63072e4,126144e4,15768e5,31536e5,63072e5,126144e5,15768e6,31536e6],jut=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Yut(e,t){if(!C(e))throw new x("container is required.");if(!C(t))throw new x("clock is required.");e=Uke(e);const n=e.ownerDocument;this.container=e;const i=n.createElement("div");i.className="cesium-timeline-main",e.appendChild(i),this._topDiv=i,this._endJulian=void 0,this._epochJulian=void 0,this._lastXPos=void 0,this._scrubElement=void 0,this._startJulian=void 0,this._timeBarSecondsSpan=void 0,this._clock=t,this._scrubJulian=t.currentTime,this._mainTicSpan=-1,this._mouseMode=Gut.none,this._touchMode=Wut.none,this._touchState={centerX:0,spanX:0},this._mouseX=0,this._timelineDrag=0,this._timelineDragLocation=void 0,this._lastHeight=void 0,this._lastWidth=void 0,this._topDiv.innerHTML='<div class="cesium-timeline-bar"></div><div class="cesium-timeline-trackContainer"><canvas class="cesium-timeline-tracks" width="10" height="1"></canvas></div><div class="cesium-timeline-needle"></div><span class="cesium-timeline-ruler"></span>',this._timeBarEle=this._topDiv.childNodes[0],this._trackContainer=this._topDiv.childNodes[1],this._trackListEle=this._topDiv.childNodes[1].childNodes[0],this._needleEle=this._topDiv.childNodes[2],this._rulerEle=this._topDiv.childNodes[3],this._context=this._trackListEle.getContext("2d"),this._trackList=[],this._highlightRanges=[],this.zoomTo(t.startTime,t.stopTime),this._onMouseDown=Xut(this),this._onMouseUp=Qut(this),this._onMouseMove=Jut(this),this._onMouseWheel=Zut(this),this._onTouchStart=$ut(this),this._onTouchMove=tht(this),this._onTouchEnd=eht(this);const o=this._timeBarEle;n.addEventListener("mouseup",this._onMouseUp,!1),n.addEventListener("mousemove",this._onMouseMove,!1),o.addEventListener("mousedown",this._onMouseDown,!1),o.addEventListener("DOMMouseScroll",this._onMouseWheel,!1),o.addEventListener("mousewheel",this._onMouseWheel,!1),o.addEventListener("touchstart",this._onTouchStart,!1),o.addEventListener("touchmove",this._onTouchMove,!1),o.addEventListener("touchend",this._onTouchEnd,!1),o.addEventListener("touchcancel",this._onTouchEnd,!1),this._topDiv.oncontextmenu=function(){return!1},t.onTick.addEventListener(this.updateFromClock,this),this.updateFromClock()}function Kut(e){return e<10?`0${e.toString()}`:e.toString()}function Xut(e){return function(t){e._mouseMode!==Gut.touchOnly&&(0===t.button?(e._mouseMode=Gut.scrub,e._scrubElement&&(e._scrubElement.style.backgroundPosition="-16px 0"),e._onMouseMove(t)):(e._mouseX=t.clientX,2===t.button?e._mouseMode=Gut.zoom:e._mouseMode=Gut.slide)),t.preventDefault()}}function Qut(e){return function(t){e._mouseMode=Gut.none,e._scrubElement&&(e._scrubElement.style.backgroundPosition="0 0"),e._timelineDrag=0,e._timelineDragLocation=void 0}}function Jut(e){return function(t){let n;if(e._mouseMode===Gut.scrub){t.preventDefault();const n=t.clientX-e._topDiv.getBoundingClientRect().left;n<0?(e._timelineDragLocation=0,e._timelineDrag=-.01*e._timeBarSecondsSpan):n>e._topDiv.clientWidth?(e._timelineDragLocation=e._topDiv.clientWidth,e._timelineDrag=.01*e._timeBarSecondsSpan):(e._timelineDragLocation=void 0,e._setTimeBarTime(n,n*e._timeBarSecondsSpan/e._topDiv.clientWidth))}else if(e._mouseMode===Gut.slide){if(n=e._mouseX-t.clientX,e._mouseX=t.clientX,0!==n){const t=n*e._timeBarSecondsSpan/e._topDiv.clientWidth;e.zoomTo(Ea.addSeconds(e._startJulian,t,new Ea),Ea.addSeconds(e._endJulian,t,new Ea))}}else e._mouseMode===Gut.zoom&&(n=e._mouseX-t.clientX,e._mouseX=t.clientX,0!==n&&e.zoomFrom(Math.pow(1.01,n)))}}function Zut(e){return function(t){let n=t.wheelDeltaY||t.wheelDelta||-t.detail;Hut=Math.max(Math.min(Math.abs(n),Hut),1),n/=Hut,e.zoomFrom(Math.pow(1.05,-n))}}function $ut(e){return function(t){const n=t.touches.length;let i,o;const r=e._topDiv.getBoundingClientRect().left;t.preventDefault(),e._mouseMode=Gut.touchOnly,1===n?(i=Ea.secondsDifference(e._scrubJulian,e._startJulian),o=Math.round(i*e._topDiv.clientWidth/e._timeBarSecondsSpan+r),Math.abs(t.touches[0].clientX-o)<50?(e._touchMode=Wut.scrub,e._scrubElement&&(e._scrubElement.style.backgroundPosition=1===n?"-16px 0":"0 0")):(e._touchMode=Wut.singleTap,e._touchState.centerX=t.touches[0].clientX-r)):2===n?(e._touchMode=Wut.slideZoom,e._touchState.centerX=.5*(t.touches[0].clientX+t.touches[1].clientX)-r,e._touchState.spanX=Math.abs(t.touches[0].clientX-t.touches[1].clientX)):e._touchMode=Wut.ignore}}function eht(e){return function(t){const n=t.touches.length,i=e._topDiv.getBoundingClientRect().left;e._touchMode===Wut.singleTap?(e._touchMode=Wut.scrub,e._onTouchMove(t)):e._touchMode===Wut.scrub&&e._onTouchMove(t),e._mouseMode=Gut.touchOnly,1!==n?e._touchMode=n>0?Wut.ignore:Wut.none:e._touchMode===Wut.slideZoom&&(e._touchState.centerX=t.touches[0].clientX-i),e._scrubElement&&(e._scrubElement.style.backgroundPosition="0 0")}}function tht(e){return function(t){let n,i,o,r,s,a,c=1;const l=e._topDiv.getBoundingClientRect().left;e._touchMode===Wut.singleTap&&(e._touchMode=Wut.slideZoom),e._mouseMode=Gut.touchOnly,e._touchMode===Wut.scrub?(t.preventDefault(),1===t.changedTouches.length&&(i=t.changedTouches[0].clientX-l,i>=0&&i<=e._topDiv.clientWidth&&e._setTimeBarTime(i,i*e._timeBarSecondsSpan/e._topDiv.clientWidth))):e._touchMode===Wut.slideZoom&&(o=t.touches.length,2===o?(r=.5*(t.touches[0].clientX+t.touches[1].clientX)-l,s=Math.abs(t.touches[0].clientX-t.touches[1].clientX)):1===o&&(r=t.touches[0].clientX-l,s=0),C(r)&&(s>0&&e._touchState.spanX>0?(c=e._touchState.spanX/s,a=Ea.addSeconds(e._startJulian,(e._touchState.centerX*e._timeBarSecondsSpan-r*e._timeBarSecondsSpan*c)/e._topDiv.clientWidth,new Ea)):(n=e._touchState.centerX-r,a=Ea.addSeconds(e._startJulian,n*e._timeBarSecondsSpan/e._topDiv.clientWidth,new Ea)),e.zoomTo(a,Ea.addSeconds(a,e._timeBarSecondsSpan*c,new Ea)),e._touchState.centerX=r,e._touchState.spanX=s))}}Yut.prototype.addEventListener=function(e,t,n){this._topDiv.addEventListener(e,t,n)},Yut.prototype.removeEventListener=function(e,t,n){this._topDiv.removeEventListener(e,t,n)},Yut.prototype.isDestroyed=function(){return!1},Yut.prototype.destroy=function(){this._clock.onTick.removeEventListener(this.updateFromClock,this);const e=this.container.ownerDocument;e.removeEventListener("mouseup",this._onMouseUp,!1),e.removeEventListener("mousemove",this._onMouseMove,!1);const t=this._timeBarEle;t.removeEventListener("mousedown",this._onMouseDown,!1),t.removeEventListener("DOMMouseScroll",this._onMouseWheel,!1),t.removeEventListener("mousewheel",this._onMouseWheel,!1),t.removeEventListener("touchstart",this._onTouchStart,!1),t.removeEventListener("touchmove",this._onTouchMove,!1),t.removeEventListener("touchend",this._onTouchEnd,!1),t.removeEventListener("touchcancel",this._onTouchEnd,!1),this.container.removeChild(this._topDiv),Qh(this)},Yut.prototype.addHighlightRange=function(e,t,n){const i=new kut(e,t,n);return this._highlightRanges.push(i),this.resize(),i},Yut.prototype.addTrack=function(e,t,n,i){const o=new Vut(e,t,n,i);return this._trackList.push(o),this._lastHeight=void 0,this.resize(),o},Yut.prototype.zoomTo=function(e,t){if(!C(e))throw new x("startTime is required.");if(!C(t))throw new x("stopTime is required");if(Ea.lessThanOrEquals(t,e))throw new x("Start time must come before end time.");if(this._startJulian=e,this._endJulian=t,this._timeBarSecondsSpan=Ea.secondsDifference(t,e),this._clock&&this._clock.clockRange!==uy.UNBOUNDED){const e=this._clock.startTime,t=this._clock.stopTime,n=Ea.secondsDifference(t,e),i=Ea.secondsDifference(e,this._startJulian),o=Ea.secondsDifference(t,this._endJulian);this._timeBarSecondsSpan>=n?(this._timeBarSecondsSpan=n,this._startJulian=this._clock.startTime,this._endJulian=this._clock.stopTime):i>0?(this._endJulian=Ea.addSeconds(this._endJulian,i,new Ea),this._startJulian=e,this._timeBarSecondsSpan=Ea.secondsDifference(this._endJulian,this._startJulian)):o<0&&(this._startJulian=Ea.addSeconds(this._startJulian,o,new Ea),this._endJulian=t,this._timeBarSecondsSpan=Ea.secondsDifference(this._endJulian,this._startJulian))}this._makeTics();const n=document.createEvent("Event");n.initEvent("setzoom",!0,!0),n.startJulian=this._startJulian,n.endJulian=this._endJulian,n.epochJulian=this._epochJulian,n.totalSpan=this._timeBarSecondsSpan,n.mainTicSpan=this._mainTicSpan,this._topDiv.dispatchEvent(n)},Yut.prototype.zoomFrom=function(e){let t=Ea.secondsDifference(this._scrubJulian,this._startJulian);e>1||t<0||t>this._timeBarSecondsSpan?t=.5*this._timeBarSecondsSpan:t+=t-.5*this._timeBarSecondsSpan;const n=this._timeBarSecondsSpan-t;this.zoomTo(Ea.addSeconds(this._startJulian,t-t*e,new Ea),Ea.addSeconds(this._endJulian,n*e-n,new Ea))},Yut.prototype.makeLabel=function(e){const t=Ea.toGregorianDate(e),n=t.millisecond;let i=" UTC";if(n>0&&this._timeBarSecondsSpan<3600){i=Math.floor(n).toString();while(i.length<3)i=`0${i}`;i=`.${i}`}return`${jut[t.month-1]} ${t.day} ${t.year} ${Kut(t.hour)}:${Kut(t.minute)}:${Kut(t.second)}${i}`},Yut.prototype.smallestTicInPixels=7,Yut.prototype._makeTics=function(){const e=this._timeBarEle,t=Ea.secondsDifference(this._scrubJulian,this._startJulian),n=Math.round(t*this._topDiv.clientWidth/this._timeBarSecondsSpan),i=n-8;let o;const r=this;this._needleEle.style.left=`${n.toString()}px`;let s="";const a=.01,c=31536e6,l=1e-10;let u=0,h=this._timeBarSecondsSpan;h<a?(h=a,this._timeBarSecondsSpan=a,this._endJulian=Ea.addSeconds(this._startJulian,a,new Ea)):h>c&&(h=c,this._timeBarSecondsSpan=c,this._endJulian=Ea.addSeconds(this._startJulian,c,new Ea));let d=this._timeBarEle.clientWidth;d<10&&(d=10);const f=this._startJulian,p=Math.min(h/d*1e-5,.4);let m;const _=Ea.toGregorianDate(f);m=h>31536e4?Ea.fromDate(new Date(Date.UTC(100*Math.floor(_.year/100),0))):h>31536e3?Ea.fromDate(new Date(Date.UTC(10*Math.floor(_.year/10),0))):h>86400?Ea.fromDate(new Date(Date.UTC(_.year,0))):Ea.fromDate(new Date(Date.UTC(_.year,_.month,_.day)));const g=Ea.secondsDifference(this._startJulian,Ea.addSeconds(m,p,new Ea));let y=g+h;function v(e){return Math.floor(g/e)*e}function b(e,t){return Math.ceil(e/t+.5)*t}function A(e){return(e-g)/h}function w(e,t){return e-t*Math.round(e/t)}this._epochJulian=m,this._rulerEle.innerHTML=this.makeLabel(Ea.addSeconds(this._endJulian,-a,new Ea));let T=this._rulerEle.offsetWidth+20;T<30&&(T=180);const C=u;u-=l;const E={startTime:g,startJulian:f,epochJulian:m,duration:h,timeBarWidth:d,getAlpha:A};this._highlightRanges.forEach((function(e){s+=e.render(E)}));let x=0,S=0,I=0,O=T/d;O>1&&(O=1),O*=this._timeBarSecondsSpan;let D=-1,P=-1;const R=qut.length;let L;for(L=0;L<R;++L){const e=qut[L];if(++D,x=e,e>O&&e>u)break;P<0&&d*(e/this._timeBarSecondsSpan)>=this.smallestTicInPixels&&(P=D)}if(D>0){while(D>0)if(--D,Math.abs(w(x,qut[D]))<1e-5){qut[D]>=u&&(S=qut[D]);break}if(P>=0)while(P<D){if(Math.abs(w(S,qut[P]))<1e-5&&qut[P]>=u){I=qut[P];break}++P}}u=C,u>l&&I<1e-5&&Math.abs(u-x)>l&&(I=u,u<=x+l&&(S=0));let M,B=-999999;if(d*(I/this._timeBarSecondsSpan)>=3)for(o=v(I);o<=y;o=b(o,I))s+=`<span class="cesium-timeline-ticTiny" style="left: ${Math.round(d*A(o)).toString()}px;"></span>`;if(d*(S/this._timeBarSecondsSpan)>=3)for(o=v(S);o<=y;o=b(o,S))s+=`<span class="cesium-timeline-ticSub" style="left: ${Math.round(d*A(o)).toString()}px;"></span>`;if(d*(x/this._timeBarSecondsSpan)>=2){this._mainTicSpan=x,y+=x,o=v(x);const e=Ea.computeTaiMinusUtc(m);while(o<=y){let t=Ea.addSeconds(f,o-g,new Ea);if(x>2.1){const n=Ea.computeTaiMinusUtc(t);Math.abs(n-e)>.1&&(o+=n-e,t=Ea.addSeconds(f,o-g,new Ea))}const n=Math.round(d*A(o)),i=this.makeLabel(t);this._rulerEle.innerHTML=i,M=this._rulerEle.offsetWidth,M<10&&(M=T);const r=n-(M/2-1);r>B?(B=r+M+5,s+=`<span class="cesium-timeline-ticMain" style="left: ${n.toString()}px;"></span><span class="cesium-timeline-ticLabel" style="left: ${r.toString()}px;">${i}</span>`):s+=`<span class="cesium-timeline-ticSub" style="left: ${n.toString()}px;"></span>`,o=b(o,x)}}else this._mainTicSpan=-1;s+=`<span class="cesium-timeline-icon16" style="left:${i}px;bottom:0;background-position: 0 0;"></span>`,e.innerHTML=s,this._scrubElement=e.lastChild,this._context.clearRect(0,0,this._trackListEle.width,this._trackListEle.height),E.y=0,this._trackList.forEach((function(e){e.render(r._context,E),E.y+=e.height}))},Yut.prototype.updateFromClock=function(){this._scrubJulian=this._clock.currentTime;const e=this._scrubElement;if(C(this._scrubElement)){const t=Ea.secondsDifference(this._scrubJulian,this._startJulian),n=Math.round(t*this._topDiv.clientWidth/this._timeBarSecondsSpan);this._lastXPos!==n&&(this._lastXPos=n,e.style.left=n-8+"px",this._needleEle.style.left=`${n}px`)}C(this._timelineDragLocation)&&(this._setTimeBarTime(this._timelineDragLocation,this._timelineDragLocation*this._timeBarSecondsSpan/this._topDiv.clientWidth),this.zoomTo(Ea.addSeconds(this._startJulian,this._timelineDrag,new Ea),Ea.addSeconds(this._endJulian,this._timelineDrag,new Ea)))},Yut.prototype._setTimeBarTime=function(e,t){if(e=Math.round(e),this._scrubJulian=Ea.addSeconds(this._startJulian,t,new Ea),this._scrubElement){const t=e-8;this._scrubElement.style.left=`${t.toString()}px`,this._needleEle.style.left=`${e.toString()}px`}const n=document.createEvent("Event");n.initEvent("settime",!0,!0),n.clientX=e,n.timeSeconds=t,n.timeJulian=this._scrubJulian,n.clock=this._clock,this._topDiv.dispatchEvent(n)},Yut.prototype.resize=function(){const e=this.container.clientWidth,t=this.container.clientHeight;if(e===this._lastWidth&&t===this._lastHeight)return;this._trackContainer.style.height=`${t}px`;let n=1;this._trackList.forEach((function(e){n+=e.height})),this._trackListEle.style.height=`${n.toString()}px`,this._trackListEle.width=this._trackListEle.clientWidth,this._trackListEle.height=n,this._makeTics(),this._lastXPos=void 0,this._lastWidth=e,this._lastHeight=t};var nht=Yut;function iht(e){let t=!1;const n=window.screen;return C(n)&&(C(n.lockOrientation)?t=n.lockOrientation(e):C(n.mozLockOrientation)?t=n.mozLockOrientation(e):C(n.msLockOrientation)?t=n.msLockOrientation(e):C(n.orientation&&n.orientation.lock)&&(t=n.orientation.lock(e))),t}function oht(){const e=window.screen;C(e)&&(C(e.unlockOrientation)?e.unlockOrientation():C(e.mozUnlockOrientation)?e.mozUnlockOrientation():C(e.msUnlockOrientation)?e.msUnlockOrientation():C(e.orientation&&e.orientation.unlock)&&e.orientation.unlock())}function rht(e,t,n,i){i()||(n()?(t.useWebVR=!1,e._locked&&(oht(),e._locked=!1),e._noSleep.disable(),qa.exitFullscreen(),n(!1)):(qa.fullscreen||qa.requestFullscreen(e._vrElement),e._noSleep.enable(),e._locked||(e._locked=iht("landscape")),t.useWebVR=!0,n(!0)))}function sht(e,t){if(!C(e))throw new x("scene is required.");const n=this,i=vrt.observable(qa.enabled),o=vrt.observable(!1);this.isVRMode=void 0,vrt.defineProperty(this,"isVRMode",{get:function(){return o()}}),this.isVREnabled=void 0,vrt.defineProperty(this,"isVREnabled",{get:function(){return i()},set:function(e){i(e&&qa.enabled)}}),this.tooltip=void 0,vrt.defineProperty(this,"tooltip",(function(){return i()?o()?"Exit VR mode":"Enter VR mode":"VR mode is unavailable"}));const r=vrt.observable(!1);this._isOrthographic=void 0,vrt.defineProperty(this,"_isOrthographic",{get:function(){return r()}}),this._eventHelper=new RC,this._eventHelper.add(e.preRender,(function(){r(e.camera.frustum instanceof jC)})),this._locked=!1,this._noSleep=new Lrt,this._command=Qat((function(){rht(n,e,o,r)}),vrt.getObservable(this,"isVREnabled")),this._vrElement=R(Uke(t),document.body),this._callback=function(){!qa.fullscreen&&o()&&(e.useWebVR=!1,n._locked&&(oht(),n._locked=!1),n._noSleep.disable(),o(!1))},document.addEventListener(qa.changeEventName,this._callback)}Object.defineProperties(sht.prototype,{vrElement:{get:function(){return this._vrElement},set:function(e){if(!(e instanceof Element))throw new x("value must be a valid Element.");this._vrElement=e}},command:{get:function(){return this._command}}}),sht.prototype.isDestroyed=function(){return!1},sht.prototype.destroy=function(){this._eventHelper.removeAll(),document.removeEventListener(qa.changeEventName,this._callback),Qh(this)};var aht=sht;const cht="M 5.3125 6.375 C 4.008126 6.375 2.96875 7.4141499 2.96875 8.71875 L 2.96875 19.5 C 2.96875 20.8043 4.008126 21.875 5.3125 21.875 L 13.65625 21.875 C 13.71832 20.0547 14.845166 18.59375 16.21875 18.59375 C 17.592088 18.59375 18.71881 20.0552 18.78125 21.875 L 27.09375 21.875 C 28.398125 21.875 29.4375 20.8043 29.4375 19.5 L 29.4375 8.71875 C 29.4375 7.4141499 28.398125 6.375 27.09375 6.375 L 5.3125 6.375 z M 9.625 10.4375 C 11.55989 10.4375 13.125 12.03385 13.125 13.96875 C 13.125 15.90365 11.55989 17.46875 9.625 17.46875 C 7.69011 17.46875 6.125 15.90365 6.125 13.96875 C 6.125 12.03385 7.69011 10.4375 9.625 10.4375 z M 22.46875 10.4375 C 24.40364 10.4375 25.96875 12.03385 25.96875 13.96875 C 25.96875 15.90365 24.40364 17.46875 22.46875 17.46875 C 20.53386 17.46875 18.96875 15.90365 18.96875 13.96875 C 18.96875 12.03385 20.53386 10.4375 22.46875 10.4375 z",lht="M 25.770585,2.4552065 C 15.72282,13.962707 10.699956,19.704407 8.1768352,22.580207 c -1.261561,1.4379 -1.902282,2.1427 -2.21875,2.5 -0.141624,0.1599 -0.208984,0.2355 -0.25,0.2813 l 0.6875,0.75 c 10e-5,-10e-5 0.679191,0.727 0.6875,0.7187 0.01662,-0.016 0.02451,-0.024 0.03125,-0.031 0.01348,-0.014 0.04013,-0.038 0.0625,-0.062 0.04474,-0.05 0.120921,-0.1315 0.28125,-0.3126 0.320657,-0.3619 0.956139,-1.0921 2.2187499,-2.5312 2.5252219,-2.8781 7.5454589,-8.6169 17.5937499,-20.1250005 l -1.5,-1.3125 z m -20.5624998,3.9063 c -1.304375,0 -2.34375,1.0391 -2.34375,2.3437 l 0,10.8125005 c 0,1.3043 1.039375,2.375 2.34375,2.375 l 2.25,0 c 1.9518039,-2.2246 7.4710958,-8.5584 13.5624998,-15.5312005 l -15.8124998,0 z m 21.1249998,0 c -1.855467,2.1245 -2.114296,2.4005 -3.59375,4.0936995 1.767282,0.1815 3.15625,1.685301 3.15625,3.500001 0,1.9349 -1.56511,3.5 -3.5,3.5 -1.658043,0 -3.043426,-1.1411 -3.40625,-2.6875 -1.089617,1.2461 -2.647139,2.9988 -3.46875,3.9375 0.191501,-0.062 0.388502,-0.094 0.59375,-0.094 1.373338,0 2.50006,1.4614 2.5625,3.2812 l 8.3125,0 c 1.304375,0 2.34375,-1.0707 2.34375,-2.375 l 0,-10.8125005 c 0,-1.3046 -1.039375,-2.3437 -2.34375,-2.3437 l -0.65625,0 z M 9.5518351,10.423906 c 1.9348899,0 3.4999999,1.596401 3.4999999,3.531301 0,1.9349 -1.56511,3.5 -3.4999999,3.5 -1.9348899,0 -3.4999999,-1.5651 -3.4999999,-3.5 0,-1.9349 1.56511,-3.531301 3.4999999,-3.531301 z m 4.2187499,10.312601 c -0.206517,0.2356 -0.844218,0.9428 -1.03125,1.1562 l 0.8125,0 c 0.01392,-0.4081 0.107026,-0.7968 0.21875,-1.1562 z";function uht(e,t,n){if(!C(e))throw new x("container is required.");if(!C(t))throw new x("scene is required.");e=Uke(e);const i=new aht(t,n);i._exitVRPath=lht,i._enterVRPath=cht;const o=document.createElement("button");o.type="button",o.className="cesium-button cesium-vrButton",o.setAttribute("data-bind",'css: { "cesium-button-disabled" : _isOrthographic }, attr: { title: tooltip },click: command,enable: isVREnabled,cesiumSvgPath: { path: isVRMode ? _exitVRPath : _enterVRPath, width: 32, height: 32 }'),e.appendChild(o),vrt.applyBindings(i,o),this._container=e,this._viewModel=i,this._element=o}Object.defineProperties(uht.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),uht.prototype.isDestroyed=function(){return!1},uht.prototype.destroy=function(){return this._viewModel.destroy(),vrt.cleanNode(this._element),this._container.removeChild(this._element),Qh(this)};var hht=uht;const dht=new nn;function fht(e){const t=e.clock;t.currentTime=e.timeJulian,t.shouldAnimate=!1}function pht(e){const t=e.getPropertyNames();let n="";return t.forEach((function(t){const i=e.getProperty(t);C(i)&&(n+=`<tr><th>${t}</th><td>${i}</td></tr>`)})),n.length>0&&(n=`<table class="cesium-infoBox-defaultTable"><tbody>${n}</tbody></table>`),n}function mht(e){let t;const n=[],i=e.getPropertyNames();for(t=0;t<i.length;t++){const o=i[t];/^name$/i.test(o)?n[0]=e.getProperty(o):/name/i.test(o)?n[1]=e.getProperty(o):/^title$/i.test(o)?n[2]=e.getProperty(o):/^(id|identifier)$/i.test(o)?n[3]=e.getProperty(o):/element/i.test(o)?n[4]=e.getProperty(o):/(id|identifier)$/i.test(o)&&(n[5]=e.getProperty(o))}const o=n.length;for(t=0;t<o;t++){const e=n[t];if(C(e)&&""!==e)return e}return"Unnamed Feature"}function _ht(e,t){const n=e.scene.pick(t.position);if(C(n)){const e=R(n.id,n.primitive.id);if(e instanceof iQ)return e;if(n instanceof hZ)return new iQ({name:mht(n),description:pht(n),feature:n})}if(C(e.scene.globe))return bht(e,t.position)}const ght=new Ea;function yht(e,t,n){if(C(n)){const i=n.clock;if(C(i)&&(i.getValue(t),C(e))){const t=i.startTime;let n=i.stopTime;Ea.equals(t,n)&&(n=Ea.addSeconds(t,z.EPSILON2,ght)),e.updateFromClock(),e.zoomTo(t,n)}}}const vht=new K;function bht(e,t){const n=e.scene,i=n.camera.getPickRay(t),o=n.imageryLayers.pickImageryLayerFeatures(i,n);if(!C(o))return;const r=new iQ({id:"Loading...",description:"Loading feature information..."});return o.then((function(t){if(e.selectedEntity!==r)return;if(!C(t)||0===t.length)return void(e.selectedEntity=Aht());const n=t[0],i=new iQ({id:n.name,description:n.description});if(C(n.position)){const t=e.scene.globe.ellipsoid.cartographicToCartesian(n.position,vht);i.position=new iX(t)}e.selectedEntity=i}),(function(){e.selectedEntity===r&&(e.selectedEntity=Aht())})),r}function Aht(){return new iQ({id:"None",description:"No features found."})}function wht(e,t){const n=e._geocoder,i=e._homeButton,o=e._sceneModePicker,r=e._projectionPicker,s=e._baseLayerPicker,a=e._animation,c=e._timeline,l=e._fullscreenButton,u=e._infoBox,h=e._selectionIndicator,d=t?"hidden":"visible";if(C(n)&&(n.container.style.visibility=d),C(i)&&(i.container.style.visibility=d),C(o)&&(o.container.style.visibility=d),C(r)&&(r.container.style.visibility=d),C(s)&&(s.container.style.visibility=d),C(a)&&(a.container.style.visibility=d),C(c)&&(c.container.style.visibility=d),C(l)&&l.viewModel.isFullscreenEnabled&&(l.container.style.visibility=d),C(u)&&(u.container.style.visibility=d),C(h)&&(h.container.style.visibility=d),e._container){const n=t||!C(l)?0:l.container.clientWidth;e._vrButton.container.style.right=`${n}px`,e.forceResize()}}function Tht(e,t){if(!C(e))throw new x("container is required.");e=Uke(e),t=R(t,R.EMPTY_OBJECT);const n=(!C(t.globe)||!1!==t.globe)&&(!C(t.baseLayerPicker)||!1!==t.baseLayerPicker);if(!n&&C(t.selectedImageryProviderViewModel))throw new x("options.selectedImageryProviderViewModel is not available when not using the BaseLayerPicker widget. Either specify options.imageryProvider instead or set options.baseLayerPicker to true.");if(!n&&C(t.selectedTerrainProviderViewModel))throw new x("options.selectedTerrainProviderViewModel is not available when not using the BaseLayerPicker widget. Either specify options.terrainProvider instead or set options.baseLayerPicker to true.");const i=this,o=document.createElement("div");o.className="cesium-viewer",e.appendChild(o);const r=document.createElement("div");r.className="cesium-viewer-cesiumWidgetContainer",o.appendChild(r);const s=document.createElement("div");s.className="cesium-viewer-bottom",o.appendChild(s);const a=R(t.scene3DOnly,!1);let c,l,u=!1;C(t.clockViewModel)?(l=t.clockViewModel,c=l.clock):(c=new _y,l=new Wat(c),u=!0),C(t.shouldAnimate)&&(c.shouldAnimate=t.shouldAnimate);const h=new Plt(r,{imageryProvider:!n&&!C(t.imageryProvider)&&void 0,clock:c,skyBox:t.skyBox,skyAtmosphere:t.skyAtmosphere,sceneMode:t.sceneMode,mapProjection:t.mapProjection,globe:t.globe,orderIndependentTranslucency:t.orderIndependentTranslucency,contextOptions:t.contextOptions,useDefaultRenderLoop:t.useDefaultRenderLoop,targetFrameRate:t.targetFrameRate,showRenderLoopErrors:t.showRenderLoopErrors,useBrowserRecommendedResolution:t.useBrowserRecommendedResolution,creditContainer:C(t.creditContainer)?t.creditContainer:s,creditViewport:t.creditViewport,scene3DOnly:a,shadows:t.shadows,terrainShadows:t.terrainShadows,mapMode2D:t.mapMode2D,requestRenderMode:t.requestRenderMode,maximumRenderTimeChange:t.maximumRenderTimeChange,depthPlaneEllipsoidOffset:t.depthPlaneEllipsoidOffset,msaaSamples:t.msaaSamples});let d=t.dataSources,f=!1;C(d)||(d=new HEe,f=!0);const p=h.scene,m=new rDe({scene:p,dataSourceCollection:d}),_=new RC;let g,y;if(_.add(c.onTick,Tht.prototype._onTick,this),_.add(p.morphStart,Tht.prototype._clearTrackedObject,this),!C(t.selectionIndicator)||!1!==t.selectionIndicator){const e=document.createElement("div");e.className="cesium-viewer-selectionIndicatorContainer",o.appendChild(e),g=new Fut(e,p)}if(!C(t.infoBox)||!1!==t.infoBox){const e=document.createElement("div");e.className="cesium-viewer-infoBoxContainer",o.appendChild(e),y=new hut(e);const t=y.viewModel;_.add(t.cameraClicked,Tht.prototype._onInfoBoxCameraClicked,this),_.add(t.closeClicked,Tht.prototype._onInfoBoxClockClicked,this)}const v=document.createElement("div");let b,A,w,T,E,S,I,O,D,P,L,M,B,N,F;if(v.className="cesium-viewer-toolbar",o.appendChild(v),!C(t.geocoder)||!1!==t.geocoder){const e=document.createElement("div");let n;e.className="cesium-viewer-geocoderContainer",v.appendChild(e),C(t.geocoder)&&"boolean"!==typeof t.geocoder&&(n=Array.isArray(t.geocoder)?t.geocoder:[t.geocoder]),b=new tut({container:e,geocoderServices:n,scene:p}),_.add(b.viewModel.search.beforeExecute,Tht.prototype._clearObjects,this)}if(C(t.homeButton)&&!1===t.homeButton||(A=new rut(v,p),C(b)&&_.add(A.viewModel.command.afterExecute,(function(){const e=b.viewModel;e.searchText="",e.isSearchInProgress&&e.search()})),_.add(A.viewModel.command.beforeExecute,Tht.prototype._clearTrackedObject,this)),!0===t.sceneModePicker&&a)throw new x("options.sceneModePicker is not available when options.scene3DOnly is set to true.");if(a||C(t.sceneModePicker)&&!1===t.sceneModePicker||(w=new Put(v,p)),t.projectionPicker&&(T=new Cut(v,p)),n){const e=R(t.imageryProviderViewModels,elt()),n=R(t.terrainProviderViewModels,nlt());E=new Qct(v,{globe:p.globe,imageryProviderViewModels:e,selectedImageryProviderViewModel:t.selectedImageryProviderViewModel,terrainProviderViewModels:n,selectedTerrainProviderViewModel:t.selectedTerrainProviderViewModel});const i=v.getElementsByClassName("cesium-baseLayerPicker-dropDown");S=i[0]}if(C(t.imageryProvider)&&!1!==t.imageryProvider&&(n&&(E.viewModel.selectedImagery=void 0),p.imageryLayers.removeAll(),p.imageryLayers.addImageryProvider(t.imageryProvider)),C(t.terrainProvider)&&(n&&(E.viewModel.selectedTerrain=void 0),p.terrainProvider=t.terrainProvider),!C(t.navigationHelpButton)||!1!==t.navigationHelpButton){let e=!0;try{if(C(window.localStorage)){const t=window.localStorage.getItem("cesium-hasSeenNavHelp");C(t)&&Boolean(t)?e=!1:window.localStorage.setItem("cesium-hasSeenNavHelp","true")}}catch(V){}I=new mut({container:v,instructionsInitiallyVisible:R(t.navigationInstructionsInitiallyVisible,e)})}if(!C(t.animation)||!1!==t.animation){const e=document.createElement("div");e.className="cesium-viewer-animationContainer",o.appendChild(e),O=new Fct(e,new jct(l))}if(!C(t.timeline)||!1!==t.timeline){const e=document.createElement("div");e.className="cesium-viewer-timelineContainer",o.appendChild(e),D=new nht(e,c),D.addEventListener("settime",fht,!1),D.zoomTo(c.startTime,c.stopTime)}if(C(t.fullscreenButton)&&!1===t.fullscreenButton||(M=document.createElement("div"),M.className="cesium-viewer-fullscreenContainer",o.appendChild(M),P=new Flt(M,t.fullscreenElement),L=Zat(P.viewModel,"isFullscreenEnabled",(function(e){M.style.display=e?"block":"none",C(D)&&(D.container.style.right=`${M.clientWidth}px`,D.resize())}))),t.vrButton){const e=document.createElement("div");e.className="cesium-viewer-vrContainer",o.appendChild(e),B=new hht(e,p,t.fullScreenElement),N=Zat(B.viewModel,"isVREnabled",(function(t){e.style.display=t?"block":"none",C(P)&&(e.style.right=`${M.clientWidth}px`),C(D)&&(D.container.style.right=`${e.clientWidth}px`,D.resize())})),F=Zat(B.viewModel,"isVRMode",(function(e){wht(i,e)}))}this._baseLayerPickerDropDown=S,this._fullscreenSubscription=L,this._vrSubscription=N,this._vrModeSubscription=F,this._dataSourceChangedListeners={},this._automaticallyTrackDataSourceClocks=R(t.automaticallyTrackDataSourceClocks,!0),this._container=e,this._bottomContainer=s,this._element=o,this._cesiumWidget=h,this._selectionIndicator=g,this._infoBox=y,this._dataSourceCollection=d,this._destroyDataSourceCollection=f,this._dataSourceDisplay=m,this._clockViewModel=l,this._destroyClockViewModel=u,this._toolbar=v,this._homeButton=A,this._sceneModePicker=w,this._projectionPicker=T,this._baseLayerPicker=E,this._navigationHelpButton=I,this._animation=O,this._timeline=D,this._fullscreenButton=P,this._vrButton=B,this._geocoder=b,this._eventHelper=_,this._lastWidth=0,this._lastHeight=0,this._allowDataSourcesToSuspendAnimation=!0,this._entityView=void 0,this._enableInfoOrSelection=C(y)||C(g),this._clockTrackedDataSource=void 0,this._trackedEntity=void 0,this._needTrackedEntityUpdate=!1,this._selectedEntity=void 0,this._clockTrackedDataSource=void 0,this._zoomIsFlight=!1,this._zoomTarget=void 0,this._zoomPromise=void 0,this._zoomOptions=void 0,this._selectedEntityChanged=new $n,this._trackedEntityChanged=new $n,vrt.track(this,["_trackedEntity","_selectedEntity","_clockTrackedDataSource"]),_.add(d.dataSourceAdded,Tht.prototype._onDataSourceAdded,this),_.add(d.dataSourceRemoved,Tht.prototype._onDataSourceRemoved,this),_.add(p.postUpdate,Tht.prototype.resize,this),_.add(p.postRender,Tht.prototype._postRender,this);const z=d.length;for(let C=0;C<z;C++)this._dataSourceAdded(d,d.get(C));function k(e){const t=_ht(i,e);C(t)?Bz.getValueOrUndefined(t.position,i.clock.currentTime)?i.trackedEntity=t:i.zoomTo(t):C(i.trackedEntity)&&(i.trackedEntity=void 0)}function U(e){i.selectedEntity=_ht(i,e)}this._dataSourceAdded(void 0,m.defaultDataSource),_.add(d.dataSourceAdded,Tht.prototype._dataSourceAdded,this),_.add(d.dataSourceRemoved,Tht.prototype._dataSourceRemoved,this),h.screenSpaceEventHandler.setInputAction(U,JL.LEFT_CLICK),h.screenSpaceEventHandler.setInputAction(k,JL.LEFT_DOUBLE_CLICK)}function Cht(e,t,n,i){if(!C(t))throw new x("zoomTarget is required.");xht(e);const o=yn();return e._zoomPromise=o,e._zoomIsFlight=i,e._zoomOptions=n,Promise.resolve(t).then((function(t){if(e._zoomPromise===o)if(t instanceof JJe)t.getViewableRectangle().then((function(t){return Fot(t,e.scene)})).then((function(t){e._zoomPromise===o&&(e._zoomTarget=t)}));else if(t instanceof wbe)e._zoomTarget=t;else if(t instanceof Lot)e._zoomTarget=t;else if(t.isLoading&&C(t.loadingEvent)){const n=t.loadingEvent.addEventListener((function(){n(),e._zoomPromise===o&&(e._zoomTarget=t.entities.values.slice(0))}))}else Array.isArray(t)?e._zoomTarget=t.slice(0):(t=R(t.values,t),C(t.entities)&&(t=t.entities.values),Array.isArray(t)?e._zoomTarget=t.slice(0):e._zoomTarget=[t])})),e.scene.requestRender(),o.promise}function Eht(e){e._zoomPromise=void 0,e._zoomTarget=void 0,e._zoomOptions=void 0}function xht(e){const t=e._zoomPromise;C(t)&&(Eht(e),t.resolve(!1))}function Sht(e){const t=e._zoomTarget;if(!C(t)||e.scene.mode===ij.MORPHING)return;const n=e.scene,i=n.camera,o=e._zoomPromise,r=R(e._zoomOptions,{});let s;if(t instanceof wbe)return t.readyPromise.then((function(){const n=t.boundingSphere;C(r.offset)||(r.offset=new uI(0,-.5,n.radius)),s={offset:r.offset,duration:r.duration,maximumHeight:r.maximumHeight,complete:function(){o.resolve(!0)},cancel:function(){o.resolve(!1)}},e._zoomIsFlight?i.flyToBoundingSphere(t.boundingSphere,s):(i.viewBoundingSphere(n,r.offset),i.lookAtTransform(ft.IDENTITY),o.resolve(!0)),Eht(e)}));if(t instanceof Lot)return t.readyPromise.then((function(){const n=t.boundingSphere;C(r.offset)||(r.offset=new uI(0,-.5,n.radius)),s={offset:r.offset,duration:r.duration,maximumHeight:r.maximumHeight,complete:function(){o.resolve(!0)},cancel:function(){o.resolve(!1)}},e._zoomIsFlight?i.flyToBoundingSphere(n,s):(i.viewBoundingSphere(n,r.offset),i.lookAtTransform(ft.IDENTITY),o.resolve(!0)),Eht(e)}));if(t instanceof se)return s={destination:n.mapProjection.ellipsoid.cartographicToCartesian(t),duration:r.duration,maximumHeight:r.maximumHeight,complete:function(){o.resolve(!0)},cancel:function(){o.resolve(!1)}},e._zoomIsFlight?i.flyTo(s):(i.setView(s),o.resolve(!0)),void Eht(e);const a=t,c=[];for(let u=0,h=a.length;u<h;u++){const t=e._dataSourceDisplay.getBoundingSphere(a[u],!1,dht);if(t===Lz.PENDING)return;t!==Lz.FAILED&&c.push(nn.clone(dht))}if(0===c.length)return void xht(e);e.trackedEntity=void 0;const l=nn.fromBoundingSpheres(c);e._zoomIsFlight?(Eht(e),i.flyToBoundingSphere(l,{duration:r.duration,maximumHeight:r.maximumHeight,complete:function(){o.resolve(!0)},cancel:function(){o.resolve(!1)},offset:r.offset})):(i.viewBoundingSphere(l,r.offset),i.lookAtTransform(ft.IDENTITY),Eht(e),o.resolve(!0))}function Iht(e){if(!e._needTrackedEntityUpdate)return;const t=e._trackedEntity,n=e.clock.currentTime,i=Bz.getValueOrUndefined(t.position,n);if(!C(i))return;const o=e.scene,r=e._dataSourceDisplay.getBoundingSphere(t,!1,dht);if(r===Lz.PENDING)return;const s=o.mode;s!==ij.COLUMBUS_VIEW&&s!==ij.SCENE2D||(o.screenSpaceCameraController.enableTranslate=!1),s!==ij.COLUMBUS_VIEW&&s!==ij.SCENE3D||(o.screenSpaceCameraController.enableTilt=!1);const a=r!==Lz.FAILED?dht:void 0;e._entityView=new wDe(t,o,o.mapProjection.ellipsoid),e._entityView.update(n,a),e._needTrackedEntityUpdate=!1}Object.defineProperties(Tht.prototype,{container:{get:function(){return this._container}},bottomContainer:{get:function(){return this._bottomContainer}},cesiumWidget:{get:function(){return this._cesiumWidget}},selectionIndicator:{get:function(){return this._selectionIndicator}},infoBox:{get:function(){return this._infoBox}},geocoder:{get:function(){return this._geocoder}},homeButton:{get:function(){return this._homeButton}},sceneModePicker:{get:function(){return this._sceneModePicker}},projectionPicker:{get:function(){return this._projectionPicker}},baseLayerPicker:{get:function(){return this._baseLayerPicker}},navigationHelpButton:{get:function(){return this._navigationHelpButton}},animation:{get:function(){return this._animation}},timeline:{get:function(){return this._timeline}},fullscreenButton:{get:function(){return this._fullscreenButton}},vrButton:{get:function(){return this._vrButton}},dataSourceDisplay:{get:function(){return this._dataSourceDisplay}},entities:{get:function(){return this._dataSourceDisplay.defaultDataSource.entities}},dataSources:{get:function(){return this._dataSourceCollection}},canvas:{get:function(){return this._cesiumWidget.canvas}},scene:{get:function(){return this._cesiumWidget.scene}},shadows:{get:function(){return this.scene.shadowMap.enabled},set:function(e){this.scene.shadowMap.enabled=e}},terrainShadows:{get:function(){return this.scene.globe.shadows},set:function(e){this.scene.globe.shadows=e}},shadowMap:{get:function(){return this.scene.shadowMap}},imageryLayers:{get:function(){return this.scene.imageryLayers}},terrainProvider:{get:function(){return this.scene.terrainProvider},set:function(e){this.scene.terrainProvider=e}},camera:{get:function(){return this.scene.camera}},postProcessStages:{get:function(){return this.scene.postProcessStages}},clock:{get:function(){return this._clockViewModel.clock}},clockViewModel:{get:function(){return this._clockViewModel}},screenSpaceEventHandler:{get:function(){return this._cesiumWidget.screenSpaceEventHandler}},targetFrameRate:{get:function(){return this._cesiumWidget.targetFrameRate},set:function(e){this._cesiumWidget.targetFrameRate=e}},useDefaultRenderLoop:{get:function(){return this._cesiumWidget.useDefaultRenderLoop},set:function(e){this._cesiumWidget.useDefaultRenderLoop=e}},resolutionScale:{get:function(){return this._cesiumWidget.resolutionScale},set:function(e){this._cesiumWidget.resolutionScale=e}},useBrowserRecommendedResolution:{get:function(){return this._cesiumWidget.useBrowserRecommendedResolution},set:function(e){this._cesiumWidget.useBrowserRecommendedResolution=e}},allowDataSourcesToSuspendAnimation:{get:function(){return this._allowDataSourcesToSuspendAnimation},set:function(e){this._allowDataSourcesToSuspendAnimation=e}},trackedEntity:{get:function(){return this._trackedEntity},set:function(e){if(this._trackedEntity!==e){this._trackedEntity=e,xht(this);const t=this.scene,n=t.mode;C(e)&&C(e.position)?this._needTrackedEntityUpdate=!0:(this._needTrackedEntityUpdate=!1,n!==ij.COLUMBUS_VIEW&&n!==ij.SCENE2D||(t.screenSpaceCameraController.enableTranslate=!0),n!==ij.COLUMBUS_VIEW&&n!==ij.SCENE3D||(t.screenSpaceCameraController.enableTilt=!0),this._entityView=void 0,this.camera.lookAtTransform(ft.IDENTITY)),this._trackedEntityChanged.raiseEvent(e),this.scene.requestRender()}}},selectedEntity:{get:function(){return this._selectedEntity},set:function(e){if(this._selectedEntity!==e){this._selectedEntity=e;const t=C(this._selectionIndicator)?this._selectionIndicator.viewModel:void 0;C(e)?C(t)&&t.animateAppear():C(t)&&t.animateDepart(),this._selectedEntityChanged.raiseEvent(e)}}},selectedEntityChanged:{get:function(){return this._selectedEntityChanged}},trackedEntityChanged:{get:function(){return this._trackedEntityChanged}},clockTrackedDataSource:{get:function(){return this._clockTrackedDataSource},set:function(e){this._clockTrackedDataSource!==e&&(this._clockTrackedDataSource=e,yht(this._timeline,this.clock,e))}}}),Tht.prototype.extend=function(e,t){if(!C(e))throw new x("mixin is required.");e(this,t)},Tht.prototype.resize=function(){const e=this._cesiumWidget,t=this._container,n=t.clientWidth,i=t.clientHeight,o=C(this._animation),r=C(this._timeline);if(e.resize(),n===this._lastWidth&&i===this._lastHeight)return;const s=i-125,a=this._baseLayerPickerDropDown;if(C(a)&&(a.style.maxHeight=`${s}px`),C(this._geocoder)){const e=this._geocoder.searchSuggestionsContainer;e.style.maxHeight=`${s}px`}C(this._infoBox)&&(this._infoBox.viewModel.maxHeight=s);const c=this._timeline;let l,u=0,h=0,d=0;if(o&&"hidden"!==window.getComputedStyle(this._animation.container).visibility){const e=this._lastWidth;l=this._animation.container,n>900?(u=169,e<=900&&(l.style.width="169px",l.style.height="112px",this._animation.resize())):n>=600?(u=136,(e<600||e>900)&&(l.style.width="136px",l.style.height="90px",this._animation.resize())):(u=106,(e>600||0===e)&&(l.style.width="106px",l.style.height="70px",this._animation.resize())),h=u+5}if(r&&"hidden"!==window.getComputedStyle(this._timeline.container).visibility){const e=this._fullscreenButton,t=this._vrButton,n=c.container,i=n.style;d=n.clientHeight+3,i.left=`${u}px`;let o=0;C(e)&&(o+=e.container.clientWidth),C(t)&&(o+=t.container.clientWidth),i.right=`${o}px`,c.resize()}this._bottomContainer.style.left=`${h}px`,this._bottomContainer.style.bottom=`${d}px`,this._lastWidth=n,this._lastHeight=i},Tht.prototype.forceResize=function(){this._lastWidth=0,this.resize()},Tht.prototype.render=function(){this._cesiumWidget.render()},Tht.prototype.isDestroyed=function(){return!1},Tht.prototype.destroy=function(){let e;this.screenSpaceEventHandler.removeInputAction(JL.LEFT_CLICK),this.screenSpaceEventHandler.removeInputAction(JL.LEFT_DOUBLE_CLICK);const t=this.dataSources,n=t.length;for(e=0;e<n;e++)this._dataSourceRemoved(t,t.get(e));return this._dataSourceRemoved(void 0,this._dataSourceDisplay.defaultDataSource),this._container.removeChild(this._element),this._element.removeChild(this._toolbar),this._eventHelper.removeAll(),C(this._geocoder)&&(this._geocoder=this._geocoder.destroy()),C(this._homeButton)&&(this._homeButton=this._homeButton.destroy()),C(this._sceneModePicker)&&(this._sceneModePicker=this._sceneModePicker.destroy()),C(this._projectionPicker)&&(this._projectionPicker=this._projectionPicker.destroy()),C(this._baseLayerPicker)&&(this._baseLayerPicker=this._baseLayerPicker.destroy()),C(this._animation)&&(this._element.removeChild(this._animation.container),this._animation=this._animation.destroy()),C(this._timeline)&&(this._timeline.removeEventListener("settime",fht,!1),this._element.removeChild(this._timeline.container),this._timeline=this._timeline.destroy()),C(this._fullscreenButton)&&(this._fullscreenSubscription.dispose(),this._element.removeChild(this._fullscreenButton.container),this._fullscreenButton=this._fullscreenButton.destroy()),C(this._vrButton)&&(this._vrSubscription.dispose(),this._vrModeSubscription.dispose(),this._element.removeChild(this._vrButton.container),this._vrButton=this._vrButton.destroy()),C(this._infoBox)&&(this._element.removeChild(this._infoBox.container),this._infoBox=this._infoBox.destroy()),C(this._selectionIndicator)&&(this._element.removeChild(this._selectionIndicator.container),this._selectionIndicator=this._selectionIndicator.destroy()),this._destroyClockViewModel&&(this._clockViewModel=this._clockViewModel.destroy()),this._dataSourceDisplay=this._dataSourceDisplay.destroy(),this._cesiumWidget=this._cesiumWidget.destroy(),this._destroyDataSourceCollection&&(this._dataSourceCollection=this._dataSourceCollection.destroy()),Qh(this)},Tht.prototype._dataSourceAdded=function(e,t){const n=t.entities;n.collectionChanged.addEventListener(Tht.prototype._onEntityCollectionChanged,this)},Tht.prototype._dataSourceRemoved=function(e,t){const n=t.entities;n.collectionChanged.removeEventListener(Tht.prototype._onEntityCollectionChanged,this),C(this.trackedEntity)&&n.getById(this.trackedEntity.id)===this.trackedEntity&&(this.trackedEntity=void 0),C(this.selectedEntity)&&n.getById(this.selectedEntity.id)===this.selectedEntity&&(this.selectedEntity=void 0)},Tht.prototype._onTick=function(e){const t=e.currentTime,n=this._dataSourceDisplay.update(t);this._allowDataSourcesToSuspendAnimation&&(this._clockViewModel.canAnimate=n);const i=this._entityView;if(C(i)){const e=this._trackedEntity,n=this._dataSourceDisplay.getBoundingSphere(e,!1,dht);n===Lz.DONE&&i.update(t,dht)}let o,r=!1;const s=this.selectedEntity,a=C(s)&&this._enableInfoOrSelection;if(a&&s.isShowing&&s.isAvailable(t)){const e=this._dataSourceDisplay.getBoundingSphere(s,!0,dht);e!==Lz.FAILED?o=dht.center:C(s.position)&&(o=s.position.getValue(t,o)),r=C(o)}const c=C(this._selectionIndicator)?this._selectionIndicator.viewModel:void 0;C(c)&&(c.position=K.clone(o,c.position),c.showSelection=a&&r,c.update());const l=C(this._infoBox)?this._infoBox.viewModel:void 0;C(l)&&(l.showInfo=a,l.enableCamera=r,l.isCameraTracking=this.trackedEntity===this.selectedEntity,a?(l.titleText=R(s.name,s.id),l.description=Bz.getValueOrDefault(s.description,t,"")):(l.titleText="",l.description=""))},Tht.prototype._onEntityCollectionChanged=function(e,t,n){const i=n.length;for(let o=0;o<i;o++){const e=n[o];this.trackedEntity===e&&(this.trackedEntity=void 0),this.selectedEntity===e&&(this.selectedEntity=void 0)}},Tht.prototype._onInfoBoxCameraClicked=function(e){if(e.isCameraTracking&&this.trackedEntity===this.selectedEntity)this.trackedEntity=void 0;else{const e=this.selectedEntity,t=e.position;C(t)?this.trackedEntity=this.selectedEntity:this.zoomTo(this.selectedEntity)}},Tht.prototype._clearTrackedObject=function(){this.trackedEntity=void 0},Tht.prototype._onInfoBoxClockClicked=function(e){this.selectedEntity=void 0},Tht.prototype._clearObjects=function(){this.trackedEntity=void 0,this.selectedEntity=void 0},Tht.prototype._onDataSourceChanged=function(e){this.clockTrackedDataSource===e&&yht(this.timeline,this.clock,e)},Tht.prototype._onDataSourceAdded=function(e,t){this._automaticallyTrackDataSourceClocks&&(this.clockTrackedDataSource=t);const n=t.entities.id,i=this._eventHelper.add(t.changedEvent,Tht.prototype._onDataSourceChanged,this);this._dataSourceChangedListeners[n]=i},Tht.prototype._onDataSourceRemoved=function(e,t){const n=this.clockTrackedDataSource===t,i=t.entities.id;if(this._dataSourceChangedListeners[i](),this._dataSourceChangedListeners[i]=void 0,n){const t=e.length;this._automaticallyTrackDataSourceClocks&&t>0?this.clockTrackedDataSource=e.get(t-1):this.clockTrackedDataSource=void 0}},Tht.prototype.zoomTo=function(e,t){const n={offset:t};return Cht(this,e,n,!1)},Tht.prototype.flyTo=function(e,t){return Cht(this,e,t,!0)},Tht.prototype._postRender=function(){Sht(this),Iht(this)};var Oht=Tht;function Dht(e,t,n){void 0===n&&(n={});var i={type:"Feature"};return(0===n.id||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=e,i}function Pht(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Bht(e[0])||!Bht(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return Dht(i,t,n)}function Rht(e,t,n){void 0===n&&(n={});for(var i=0,o=e;i<o.length;i++){var r=o[i];if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<r[r.length-1].length;s++)if(r[r.length-1][s]!==r[0][s])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:e};return Dht(a,t,n)}function Lht(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function Mht(e,t,n){void 0===n&&(n={});var i={type:"MultiPoint",coordinates:e};return Dht(i,t,n)}function Bht(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function Nht(e){return Array.isArray(e)?Vht(e):e&&e.bbox?Vht(e.bbox):[kht(),Uht()]}function Fht(e,t){void 0===t&&(t={}),void 0!==e&&null!==e||(e=1);for(var n=[],i=0;i<e;i++)n.push(Pht(Nht(t.bbox)));return Lht(n)}function zht(){return Math.random()-.5}function kht(){return 360*zht()}function Uht(){return 180*zht()}function Vht(e){return[Math.random()*(e[2]-e[0])+e[0],Math.random()*(e[3]-e[1])+e[1]]}function Hht(e,t){var n=!1;return Lht(jht(e.features.map((function(e){var i={x:e.geometry.coordinates[0],y:e.geometry.coordinates[1]};return t?i.z=e.properties[t]:3===e.geometry.coordinates.length&&(n=!0,i.z=e.geometry.coordinates[2]),i}))).map((function(e){var t=[e.a.x,e.a.y],i=[e.b.x,e.b.y],o=[e.c.x,e.c.y],r={};return n?(t.push(e.a.z),i.push(e.b.z),o.push(e.c.z)):r={a:e.a.z,b:e.b.z,c:e.c.z},Rht([[t,i,o,t]],r)})))}var Ght=function(){function e(e,t,n){this.a=e,this.b=t,this.c=n;var i,o,r=t.x-e.x,s=t.y-e.y,a=n.x-e.x,c=n.y-e.y,l=r*(e.x+t.x)+s*(e.y+t.y),u=a*(e.x+n.x)+c*(e.y+n.y),h=2*(r*(n.y-t.y)-s*(n.x-t.x));this.x=(c*l-s*u)/h,this.y=(r*u-a*l)/h,i=this.x-e.x,o=this.y-e.y,this.r=i*i+o*o}return e}();function Wht(e,t){return t.x-e.x}function qht(e){var t,n,i,o,r,s=e.length;e:while(s){n=e[--s],t=e[--s],i=s;while(i)if(r=e[--i],o=e[--i],t===o&&n===r||t===r&&n===o){e.splice(s,2),e.splice(i,2),s-=2;continue e}}}function jht(e){if(e.length<3)return[];e.sort(Wht);var t,n,i,o,r,s,a=e.length-1,c=e[a].x,l=e[0].x,u=e[a].y,h=u,d=1e-12;while(a--)e[a].y<u&&(u=e[a].y),e[a].y>h&&(h=e[a].y);var f,p=l-c,m=h-u,_=p>m?p:m,g=.5*(l+c),y=.5*(h+u),v=[new Ght({__sentinel:!0,x:g-20*_,y:y-_},{__sentinel:!0,x:g,y:y+20*_},{__sentinel:!0,x:g+20*_,y:y-_})],b=[],A=[];a=e.length;while(a--){A.length=0,f=v.length;while(f--)p=e[a].x-v[f].x,p>0&&p*p>v[f].r?(b.push(v[f]),v.splice(f,1)):(m=e[a].y-v[f].y,p*p+m*m>v[f].r||(A.push(v[f].a,v[f].b,v[f].b,v[f].c,v[f].c,v[f].a),v.splice(f,1)));qht(A),f=A.length;while(f)n=A[--f],t=A[--f],i=e[a],o=n.x-t.x,r=n.y-t.y,s=2*(o*(i.y-n.y)-r*(i.x-n.x)),Math.abs(s)>d&&v.push(new Ght(t,n,i))}Array.prototype.push.apply(b,v),a=b.length;while(a--)(b[a].a.__sentinel||b[a].b.__sentinel||b[a].c.__sentinel)&&b.splice(a,1);return b}function Yht(e,t,n){if(null!==e)for(var i,o,r,s,a,c,l,u,h=0,d=0,f=e.type,p="FeatureCollection"===f,m="Feature"===f,_=p?e.features.length:1,g=0;g<_;g++){l=p?e.features[g].geometry:m?e.geometry:e,u=!!l&&"GeometryCollection"===l.type,a=u?l.geometries.length:1;for(var y=0;y<a;y++){var v=0,b=0;if(s=u?l.geometries[y]:l,null!==s){c=s.coordinates;var A=s.type;switch(h=!n||"Polygon"!==A&&"MultiPolygon"!==A?0:1,A){case null:break;case"Point":if(!1===t(c,d,g,v,b))return!1;d++,v++;break;case"LineString":case"MultiPoint":for(i=0;i<c.length;i++){if(!1===t(c[i],d,g,v,b))return!1;d++,"MultiPoint"===A&&v++}"LineString"===A&&v++;break;case"Polygon":case"MultiLineString":for(i=0;i<c.length;i++){for(o=0;o<c[i].length-h;o++){if(!1===t(c[i][o],d,g,v,b))return!1;d++}"MultiLineString"===A&&v++,"Polygon"===A&&b++}"Polygon"===A&&v++;break;case"MultiPolygon":for(i=0;i<c.length;i++){for(b=0,o=0;o<c[i].length;o++){for(r=0;r<c[i][o].length-h;r++){if(!1===t(c[i][o][r],d,g,v,b))return!1;d++}b++}v++}break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===Yht(s.geometries[i],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Kht(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)if(!1===t(e.features[n],n))break}function Xht(e,t){var n,i,o,r,s,a,c,l,u,h,d=0,f="FeatureCollection"===e.type,p="Feature"===e.type,m=f?e.features.length:1;for(n=0;n<m;n++){for(a=f?e.features[n].geometry:p?e.geometry:e,l=f?e.features[n].properties:p?e.properties:{},u=f?e.features[n].bbox:p?e.bbox:void 0,h=f?e.features[n].id:p?e.id:void 0,c=!!a&&"GeometryCollection"===a.type,s=c?a.geometries.length:1,o=0;o<s;o++)if(r=c?a.geometries[o]:a,null!==r)switch(r.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(r,d,l,u,h))return!1;break;case"GeometryCollection":for(i=0;i<r.geometries.length;i++)if(!1===t(r.geometries[i],d,l,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,l,u,h))return!1;d++}}function Qht(e){var t=[1/0,1/0,-1/0,-1/0];return Yht(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}Qht["default"]=Qht;var Jht=Qht;function Zht(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function $ht(e){return"Feature"===e.type?e.geometry:e}function edt(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var i=Zht(e),o=$ht(t),r=o.type,s=t.bbox,a=o.coordinates;if(s&&!1===ndt(i,s))return!1;"Polygon"===r&&(a=[a]);for(var c=!1,l=0;l<a.length&&!c;l++)if(tdt(i,a[l][0],n.ignoreBoundary)){var u=!1,h=1;while(h<a[l].length&&!u)tdt(i,a[l][h],!n.ignoreBoundary)&&(u=!0),h++;u||(c=!0)}return c}function tdt(e,t,n){var i=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var o=0,r=t.length-1;o<t.length;r=o++){var s=t[o][0],a=t[o][1],c=t[r][0],l=t[r][1],u=e[1]*(s-c)+a*(c-e[0])+l*(e[0]-s)===0&&(s-e[0])*(c-e[0])<=0&&(a-e[1])*(l-e[1])<=0;if(u)return!n;var h=a>e[1]!==l>e[1]&&e[0]<(c-s)*(e[1]-a)/(l-a)+s;h&&(i=!i)}return i}function ndt(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}function idt(e,t){var n=[];return Kht(e,(function(e){var i=!1;if("Point"===e.geometry.type)Xht(t,(function(t){edt(e,t)&&(i=!0)})),i&&n.push(e);else{if("MultiPoint"!==e.geometry.type)throw new Error("Input geometry must be a Point or MultiPoint");var o=[];Xht(t,(function(t){Yht(e,(function(e){edt(e,t)&&(i=!0,o.push(e))}))})),i&&n.push(Mht(o))}})),Lht(n)}var odt=idt,rdt=n(6666);class sdt{constructor(e){this.viewer=e,this.entityCollection=[],this.measureDataSource=new Bwe("measureData"),this.measureCollection=this.measureDataSource.entities,e.dataSources.add(this.measureDataSource)}clear(e){const t=document.querySelector("body");t.style.cursor="default",this.measureCollection.removeAll(),this.entityCollection=[],this.viewer.screenSpaceEventHandler.removeInputAction(JL.LEFT_CLICK),this.viewer.screenSpaceEventHandler.removeInputAction(JL.MOUSE_MOVE),this.viewer.screenSpaceEventHandler.removeInputAction(JL.RIGHT_CLICK),e&&e()}measurePolyLine(e){const t=document.querySelector("body");t.style.cursor="crosshair";let n=[],i=null,o=null,r=new BM(this.viewer.canvas);r.setInputAction((t=>{let o=this.viewer.scene.globe.pick(this.viewer.camera.getPickRay(t.position),this.viewer.scene);if(!o)return!1;0===n.length&&(n.push(o),this.drawPoint(o)),2===n.length&&(this.drawPoint(o),this.addLine([n[0],n[1]]),i=null,n.shift(),n.push(o),e&&e())}),JL.LEFT_CLICK),r.setInputAction((e=>{let t=this.viewer.scene.globe.pick(this.viewer.camera.getPickRay(e.endPosition),this.viewer.scene);if(!t)return!1;if(1===n.length&&(n.push(t),o=this.addLine(n)),2===n.length){n.pop(),n.push(t),i&&(this.measureCollection.remove(i),this.entityCollection.splice(this.entityCollection.indexOf(i),1));let e=K.midpoint(n[0],n[1],new K),o="距离："+this.getLengthText(n[0],n[1]);i=this.addLabel(e,o)}}),JL.MOUSE_MOVE),r.setInputAction((()=>{t.style.cursor="default",this.measureCollection.remove(o),this.entityCollection.splice(this.entityCollection.indexOf(o),1),this.measureCollection.remove(i),this.entityCollection.splice(this.entityCollection.indexOf(i),1),r.destroy()}),JL.RIGHT_CLICK)}measurePolyLineToGround(e){const t=document.querySelector("body");t.style.cursor="crosshair";let n=[],i=null,o=null,r=new BM(this.viewer.canvas);r.setInputAction((t=>{let o=this.viewer.scene.globe.pick(this.viewer.camera.getPickRay(t.position),this.viewer.scene);if(!o)return!1;0===n.length&&(n.push(o),this.drawPoint(o)),2===n.length&&(this.drawPoint(o),this.addLineToGround([n[0],n[1]]),Promise.resolve(this.distanceToGround(n[0],n[1])).then((e=>{(0,rdt.bM)({title:"贴地距离",message:"计算完成",type:"success",position:"top-left"});let t=e[3],n=e[0];n=n>1e3?(n/1e3).toFixed(2)+" 公里":n.toFixed(2)+" 米";let o="距离："+n;i=this.addLabel(t,o),this.entityCollection.push(i),i=null})),n.shift(),n.push(o),e&&e())}),JL.LEFT_CLICK),r.setInputAction((e=>{let t=this.viewer.scene.globe.pick(this.viewer.camera.getPickRay(e.endPosition),this.viewer.scene);if(!t)return!1;1===n.length&&(n.push(t),o=this.addLineToGround(n)),2===n.length&&(n.pop(),n.push(t))}),JL.MOUSE_MOVE),r.setInputAction((()=>{t.style.cursor="default",this.measureCollection.remove(o),this.entityCollection.splice(this.entityCollection.indexOf(o),1),r.destroy()}),JL.RIGHT_CLICK)}measurePolygonToGround(){let e=[],t=new BM(this.viewer.canvas),n=[],i=this.addLineToGround(n);t.setInputAction((t=>{let n=this.viewer.scene.globe.pick(this.viewer.camera.getPickRay(t.position),this.viewer.scene);if(!n)return!1;e.push(n),this.drawPoint(n),e.length>1&&this.addLineToGround(e.slice(e.length-2,e.length))}),JL.LEFT_CLICK),t.setInputAction((t=>{if(e.length>0){let i=this.viewer.scene.globe.pick(this.viewer.camera.getPickRay(t.endPosition),this.viewer.scene);if(!i)return!1;n[0]=e[e.length-1],n[1]=i}}),JL.MOUSE_MOVE),t.setInputAction((()=>{(0,rdt.bM)({title:"贴地面积",message:"开始计算",type:"info",position:"top-left"}),this.measureCollection.remove(i);const n=e=>{let t=this.areaPolygonToGround(e);Promise.resolve(t).then((t=>{(0,rdt.bM)({title:"贴地面积",message:"计算完成",type:"success",position:"top-left"}),this.drawPolygon(e),t=t>1e6?(t/1e6).toFixed(2)+"平方公里":t.toFixed(2)+"平方米";let n="面积："+t;this.addLabel(e[0],n)}))};n(e),this.addLineToGround([e[e.length-1],e[0]]),t.destroy()}),JL.RIGHT_CLICK)}drawPoint(e){this.entityCollection.push(this.measureCollection.add(new iQ({position:e,point:{color:xy.fromCssColorString("#D75624"),pixelSize:8,heightReference:Sz.CLAMP_TO_GROUND}})))}addLine(e){let t=new mQ((()=>e),!1),n=this.measureCollection.add(new iQ({name:"线",polyline:{positions:t,width:2,arcType:hf.NONE,material:xy.fromCssColorString("#85AB77")}}));return this.entityCollection.push(n),n}addLineToGround(e){let t=new mQ((()=>e),!1),n=this.measureCollection.add(new iQ({name:"线",polyline:{positions:t,width:2,arcType:hf.RHUMB,material:xy.fromCssColorString("#85AB77"),clampToGround:!0}}));return this.entityCollection.push(n),n}drawPolygon(e){let t=new mQ((()=>new sP(e)),!1);this.entityCollection.push(this.measureCollection.add(new iQ({polygon:{hierarchy:t,heightReference:Sz.CLAMP_TO_GROUND,material:xy.fromCssColorString("#66DA9A").withAlpha(.5)}})))}addLabel(e,t){return this.measureCollection.add(new iQ({position:e,label:{text:t,font:"14px sans-serif",style:Ise.FILL_AND_OUTLINE,fillColor:xy.YELLOW,showBackground:!0,backgroundColor:new xy(.165,.165,.165,.8),backgroundPadding:new ro(6,6),pixelOffset:new ro(0,-25),disableDepthTestDistance:Number.POSITIVE_INFINITY}}))}getLengthText(e,t){let n=K.distance(e,t);return n=n>1e3?(n/1e3).toFixed(2)+" 公里":n.toFixed(2)+" 米",n}async distanceToGround(e,t){let n=K.distance(e,t),i=Math.floor(n),o=[],r=se.fromCartesian(e),s=se.fromCartesian(t);o.push(r);for(let l=1;l<i;l++){let n=K.lerp(e,t,l/i,new K);o.push(se.fromCartesian(n))}o.push(s);const a=OF();let c=uz(a,12,o);return Promise.resolve(c).then((function(n){let i=0;for(let e=0;e<n.length;e++)e!==n.length-1&&(i+=K.distance(K.fromRadians(n[e].longitude,n[e].latitude,n[e].height),K.fromRadians(n[e+1].longitude,n[e+1].latitude,n[e+1].height)));return[i,e,t,K.fromRadians(n[Math.floor(n.length/2)].longitude,n[Math.floor(n.length/2)].latitude,n[Math.floor(n.length/2)].height)]}))}async areaPolygonToGround(e){let t=this.cartesian3ArrToCartographicArr(e),n=this.CartographicToTurfPolygon(t),i=Jht(n),o=Math.ceil((i[2]-i[0])/Math.PI*180*11e4/50),r=Fht(o,{bbox:i}),s=odt(r,n);for(let h=0;h<n.geometry.coordinates[0].length-1;h++)s.features.push(Pht(n.geometry.coordinates[0][h]));let a=Hht(s),c=[];for(let h=0;h<a.features.length;h++){let e=this.turfPolygonToCartographicArr(a.features[h]);await Promise.resolve(e).then((e=>{c.push(e)}))}let l=[];c.forEach((e=>{let t=[];e.forEach((e=>{let n=K.fromRadians(e.longitude,e.latitude,e.height);t.push(n)})),l.push(t)}));let u=0;return l.forEach((e=>{u+=this.areaSpaceTriangle([e[0].x,e[0].y,e[0].z],[e[1].x,e[1].y,e[1].z],[e[2].x,e[2].y,e[2].z])})),u}cartesian3ArrToCartographicArr(e){let t=[];return e.forEach((e=>{t.push(se.fromCartesian(e))})),t}CartographicToTurfPolygon(e){let t=[[]];return e.forEach((e=>{t[0].push([e.longitude,e.latitude])})),t[0].push([e[0].longitude,e[0].latitude]),Rht(t)}turfPolygonToCartographicArr(e){let t=[];e.geometry.coordinates[0].forEach((e=>{t.push(new se(e[0],e[1]))})),t.pop();const n=OF();return uz(n,12,t)}areaSpaceTriangle(e,t,n){let i=t[0]-e[0],o=t[1]-e[1],r=t[2]-e[2],s=n[0]-e[0],a=n[1]-e[1],c=n[2]-e[2],l=[o*c-a*r,-i*c+s*r,i*a-s*o];return.5*Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])}}class adt{constructor(e){this.viewer=e}flyTo(e){this.viewer.camera.flyTo(e)}}var cdt=n(4870),ldt={name:"Cesium",setup(){let e,t,o;const r=(0,cdt.iH)(!1);(0,i.bv)((()=>{ZI.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIyNDg2NzE0Yy1jNTQzLTQ4NWMtODI0My03OTg5NWZiYWY2YjUiLCJpZCI6NzU0MjYsImlhdCI6MTYzODU5NzkyOH0.nMc5nLbF-KZFbOCPyZeiDSHiX5tCDv8brYBZIElPfKs",e=new Oht("cesiumContainer",{vrButton:!0,projectionPicker:!0});const i=new Zct({name:"天地图影像",tooltip:"天地图影像地图源",iconUrl:n(2798),category:"国内地图",creationFunction:function(){const e=new w3e({url:"http://t0.tianditu.gov.cn/img_w/wmts?tk=057532f01c1b949cb43202d3aa352993",layer:"img",style:"default",tileMatrixSetID:"w",format:"tiles",maximumLevel:18}),t=new w3e({url:"http://t0.tianditu.gov.cn/cia_w/wmts?tk=057532f01c1b949cb43202d3aa352993",layer:"cia",style:"default",tileMatrixSetID:"w",format:"tiles",maximumLevel:18});return[e,t]}}),r=new Zct({name:"天地图矢量",tooltip:"天地图矢量地图源",iconUrl:n(5353),category:"国内地图",creationFunction:function(){const e=new w3e({url:"http://t0.tianditu.gov.cn/vec_w/wmts?tk=057532f01c1b949cb43202d3aa352993",layer:"vec",style:"default",tileMatrixSetID:"w",format:"tiles",maximumLevel:18}),t=new w3e({url:"http://t0.tianditu.gov.cn/cva_w/wmts?tk=057532f01c1b949cb43202d3aa352993",layer:"cva",style:"default",tileMatrixSetID:"w",format:"tiles",maximumLevel:18});return[e,t]}}),s=new Zct({name:"天地图地形",tooltip:"天地图影像地图源",iconUrl:n(6353),category:"国内地图",creationFunction:function(){const e=new w3e({url:"http://t0.tianditu.gov.cn/ter_w/wmts?tk=057532f01c1b949cb43202d3aa352993",layer:"ter",style:"default",tileMatrixSetID:"w",format:"tiles",maximumLevel:18}),t=new w3e({url:"http://t0.tianditu.gov.cn/cta_w/wmts?tk=057532f01c1b949cb43202d3aa352993",layer:"cta",style:"default",tileMatrixSetID:"w",format:"tiles",maximumLevel:18});return[e,t]}});e.baseLayerPicker.viewModel.imageryProviderViewModels.unshift(i,r,s),e.baseLayerPicker.viewModel.selectedTerrain=e.baseLayerPicker.viewModel.terrainProviderViewModels[1],t=new sdt(e),o=new adt(e)}));const s=[{label:"北川",children:[{label:"地下水源",category:"water",name:"underground",icon:n(8932),show:!1},{label:"地表水源",category:"water",name:"surface",icon:n(3189),show:!1}]}],a=(t,n,i)=>{TPe.load("/geoserver/water/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+t+"%3A"+n+"&outputFormat=application%2Fjson").then((function(t){t.name=n,e.dataSources.add(t);const o=t.entities.values;for(let e=0;e<o.length;e++){const t=o[e];t.billboard=new Ez({image:i,width:30,height:30,heightReference:Sz.CLAMP_TO_GROUND,verticalOrigin:Pz.BOTTOM})}})).catch((function(e){window.alert(e)}))},c=t=>{!0===t.show?(e.dataSources.remove(e.dataSources.getByName(t.name)[0],!0),t.show=!1):!1===t.show&&(a(t.category,t.name,t.icon),t.show=!0)},l=()=>{t.measurePolyLine()},u=()=>{t.measurePolyLineToGround()},h=()=>{t.clear()},d=()=>{o.flyTo({destination:new K(-1359527.881887964,5251080.84182769,3347486.3154035173),orientation:{heading:.6321958327174828,pitch:-.29359391259896683}})},f=()=>{t.measurePolygonToGround()};return{tree:s,handleCheckChange:c,measureDistance:l,measurePolyLineToGround:u,clearDistance:h,flyTo:d,measurePolygonToGround:f,drawer:r}}},udt=n(89);const hdt=(0,udt.Z)(ldt,[["render",w],["__scopeId","data-v-024a05c2"]]);var ddt=hdt},2798:function(e,t,n){e.exports=n.p+"img/tianimg.16ebceda.png"},6353:function(e,t,n){e.exports=n.p+"img/tianter.88a55a56.png"},5353:function(e,t,n){e.exports=n.p+"img/tianvec.78ca8ea5.png"},8932:function(e,t,n){e.exports=n.p+"img/地下水滴.b5b440db.png"},3189:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAFEVJREFUeF7tXXuUFNWZ/309Q1eDYNT4XI7BSIyrgm/Dia4Kyy5GJccHgrquxIgvunrwddyjGw0YUU/cPWQzdDUSIFHXuIIa38RHVORIlIgJMZpEjUZMXFFXo84Runpm+ttTM6OMODN169Vdde93z5nDH/U9f9/3o/pW3bqXIEMQEAQGRYAEG0FAEBgcASGIdIcgMAQCQhBpD0FACCI9IAiEQ0DuIOFwEy1DEBCCGFJoSTMcAkKQcLiJliEICEEMKbSkGQ4BIUg43ETLEASEIIYUWtIMh4AQJBxuomUIAkIQQwotaYZDQAgSDjfRMgQBIYghhZY0wyEgBAmHm2gZgoAQxJBCS5rhEBCChMNNtAxBQAhiSKElzXAICEHC4SZahiAgBDGk0JJmOASEIOFwEy1DEBCCGFJoSTMcAkKQcLiJliEICEFSUuiCw2cx4wgvHCKsqdp0U0pCMzoMIUgKyp93eC4B87YK5UbXptkpCM/oEIQgTS6/VeHjwXhgoDAYmFez6eomh2i0eyFIk8ufd/hmAmYOEsaLrk3jmhyi0e6FIE0sv/VD3gut+B0Aa7AwmDCjVqQ7mhim0a6FIE0sf97h7xAwf6gQCLijatOMJoZptGshSBPLbzn8PIDxfiFwC/arXUC/95OT6/EjIASJH1Mli/kKTyfGChVhmayroJSMjBAkGVx9rVoVvhOMab6CvQIyWVcEKm4xIUjciCrYG3YjH5DrxnoF0U9FZLIeBK34ZIUg8WGpbKlQ5uuYcIWygvd2XSbrQeCKTVYIEhuUioZW8HDrXbwAYE9FjS13EZmsB4UssrwQJDKEwQwUynw2E5YF0+qVlsl6GNSi6QhBouEXWNty+HEAkwIr9ipscAkHoUh/C6kvagEREIIEBCyKuOXwNwD8PIoNAJe4Nv0gog1RV0RACKIIVBxieYdvJeCMiLaed3fCwZhB3RHtiLoCAkIQBZDiEBnWzgfkWoI92h3MLwHnVG0KNY+JIxeTbAhBGlRtq8I3gHFZTO6ecm06MiZbYmYIBIQgDWiPke28U2cLfgtgt7jccR0zam2yyjcuPIe4WyftQuxbDl8MYEHMSKx0bTo+ZptibisE5A7SgJawyvwcCAcn4OoY16ZHErArJvsQEIIk3Ap5h08l4PYk3BDj9mqJTk/CttjsRUAIknAnWGW+H4SpSbmpE77eWaRnkrJvul0hSIIdUKjwkcxYnaALz/Ri16YLEvZhrHkhSIKlt8q8GITzEnThLdCqcR0H1ebIF4dJ4CwESQJVbxcGh78C9DzaHZGQiy1mCf/hFunfEvdjoAMhSEJFH2QzuIS84d1cNw7ePIf+mpQDU+0KQRKofKHCezKwFowdEzA/oEkizK8W6apG+TPFjxAkgUpbDnsvBb2Xg40cH4AxwS3Ry410qrsvIUjMFR62iA/K1bEWwLCYTauYa3dtulBFUGTUEBCCqOGkLJV3eBkBZysrxCtYr9cxobON1sVr1lxrQpAYa19YyBM5hydiNBnYFDNurpXorMCKojDw3E5wiQ+BgHtdxed4K0uUw+TqbPI+7ZUREQG5g0QE8BP1fJlPIMI9Qc2NGQWMygN/6QA+rAXVHlT+btemk2OzZrAhIUhMxbccfhTAP6mau/Qg4PSvAuO+uEVj/rOA9xfHYMbJtRLdHYctk20IQWKofsHhmQzcrGqq/SjgvEFO/bBXAcvi2Kaa8bhbosmqMYncwAgIQSJ3BlPBwVoGDlMxtftIYN1pwBfyg0uf8TBw16sq1oaWIcJZ1SIpEze6R/0sCEEi1tSqcBsY7apmLj8EmDdhaOmb/wCcH8OzMALWVd/FBMyjump8IvdZBIQgUTriB7ydle95KfhVFTPDW4FfzQD22m5o6dVvAlPuVbGoIMO40C2RMoEVLBolIgSJUO58ma8kwjWqJs7dD1h4tL/0d58Bbvi1v5yixMtuDRNwMX2gKC9i/RAQgoRsh3yF988xVjGwvaqJJ08GJuzqLz31fuAXf/GXU5VgxlW1Eg151JuqLdPkhCAhK26V+U6Q8gE4mDYW+Okx/s7WvAVMjvvhLOODeh0TO+eQ932KjAAICEECgPWJqLWIZ6OOShDVnx0HHLeHv0bbk8CSF/3lAksw7nZL8vIwKG5CkICIWRXeG4xVABR+LPUanzgaeOgEf0cbOoDDlgMfxfdGfWunba5NZf9IROITBIQgAXshzAbUSycD/7q3v6PvPwfM9Z6JJTf+jxkTayVK4h6VXNRNtCwECQB+mMNv9t+x99Gu3+hm4NDbgT8kfPKHHOXmV4nPXheCKOJVKPMYJjwJYIyiSo/YDUcAcw7w17jtJeDsx/zlYpFgFN0SLYrFluZGhCCKBQ7zIdTokcCzM4AdCv5OvvkA8Ogb/nIxSWzkOibV2uiPMdnT1owQRKG0eYfPIOBWBdHPiKgsK/EUYn1zrhgkAf9TtelfFMWNFROC+JR+G4d37ULPUyuFafYWY6rLSjyN2auAn8SxgjdgGxNwXtWmJQHVjBIXgviU2ypzBYTZQbtCdVnJax8Chy4HNnUF9RCL/JveU2jXpj/FYk1DI0KQIYqaX8TTqI47g9a9NQc8dQpwoMKuWNeuA675VVAP8ckzcGvNpjPjs6iXJSHIYPWs8PZW7wvB/YOWvDgeWKBwQFqt3vto9+UmLyMkxqxqiX4cNE8T5IUgg1Q57MbT2wwD1pwC/L3CEsZb/gicl46tFTZQDhOrs+l1E5o+SI5CkAHQssp8EQihziK/+EDg+sPVSnDcfcDjKdlNlwn/XSvSTLXIzZESgmxVa8vhKQAeCnO4kPe+w7t7fHlb/wa69zXgVM9LusZlrk3/ma6QmhuNEKQf/sMd3r3OeAiEfcOU5YpDgblfU9P8xr3AKu8ZUvqGnHvYryZCkH5gBP3Go39v77YN8MtTAO9fv3HrS8A5jVpW4hfM568/35rHlI/PpbeDq+qnIQTpq2nB4e8xEPr4AO/O4d1B/EadgSPvAp57x0+yeddlPrIFeyEIgLzDpxNwW9iW9OYc3txDZc2V8zxw6VNhPTVUT+YjYSaiDS1RA5wNc/jAXO+8Y5ew7rynVt7TK7/xgdt793ilye89/OLsd934+YjZd5B2tqwW/BzApABN8xlR732Hd/fw3n/4jevXAVc38a25X3wDXDd+PmI0QSyHHQDFEI3zqYr3xtx7c+433ugA/uEu4J1NfpLpum76fMRYglgOlwAsjNKO3lorb82Vt/bKb/z708CC3/hJpfa6sfMRIwlSKPNkpp6fVgo/jAZvWmciMEvhjckL7/XOPTY3Z8VuXKwzcj5iHEFGLuKdOxmPgKHwIezgvbWdBWycpdZ7se3YruYuKSkj5yPGESRf4ZuI8a2oXeSd67HuVH8rT78FTIp7Izh/t4lImDgfMYogVoUvAodbhLh1x3nHF7x9jn8fznwUWPGKv1yGJC5ybfphhuKNFKoxBCks4olcxyNR5x390b7pn4HT9hoc/4c2ACc+GKk+qVNmxvvw9tZqo9+lLrgEAjKDID/h7Qqb8IjqITeqOB87BrhlCjBqgKn+798HvINwkt7nSjXWmOXudG2aHrPNVJozgiCWwz8CcG4SFThkZ6C0P3DMGGAHq9fD2o3ABU9oS47eJA3ZW0t7glgOey8CvReCiY+jRgO/eQfo6EzcVRocbARholukl9IQTFIxaE2Q4Q4fXkfPvENhEXpSEOtrlxm31Up0hr4ZAloTxHL4ZwBO0rmAzc6NgHOqNi1rdhxJ+deWIH13jzVJASd2+xBgvEGMidU2+rOOmGhLEMthb3PmC3QsWgpzqrg22SmMK3JIWhLEauexaMF6ACOjILRtvvdMwQl9X4p4x6M9kZJdSKLkFbcuE95v7cb4TW30v3HbbrY9LQmSd3guAfOigLvzCOCJk4CxX/islWffAaavBDZmbNl6FCyUdAmXukVaoCSbISH9COLwSIuwHoyxUepQHeIrkQdfB6atjGJdP10Cnq3apLinS3by144gVoUvACPS4TDeabTeqbRDjRMeAB5u3HkemegoZpxYK9G9mQhWMUjtCJJ3eA0Binsbfh6lr+0CrJ7mj978ZwHvT8YWBIhwe7VIp+uEiVYEyZf5JCJ47z5CjysPA7w/vyEEGRghzmF8bTa94IdfVq5rRRDL4aUAFD9jGrhEqgQ59j55ojUQggRcW7XpyqwQwC9O3Qji/c+1n1/SQ1335h7eHGSo4T3JOjLwqSFRosqQLuNVt4bxuIQ2ZyjqQUPVhiBWhfcGI/KhlN7Bm6/67HE+5d7ecwVlDPIzi3BSrUj36ICPNgQpODyLAe8nVuQx1F3Eu3N4dxAZgyPAhKtqRZqvA0baECSO+Uf/gu6zPTDtK8DJYwHv89pn3gaWvwzcp+WKo3hbmYDlVZtOi9dqc6zpRJDI84/mlEBLry+6No3TITMtCDJiMe/W3QXt1gFlucHcVmyH8+nDLOfgxa4FQfJlnkGE5Vkvhk7xE3Bk1aZs7GM/BPBaEMQqczsIbTo1mAa52K5NlaznoQdBKrwaDIWDl7NerkzFv9i1KfPf4+hBkDKvB0XbSjRTrZeBYBl4umZT6DVxaUlRD4I4/CqAPdMCqsTRsy3Qx26JIn2wlgYcdSGI9+pupzQAKjFsQcBtRR7nU6Y3QdKFIN66n4I0Z7oQcEdhJGbSx+mKKlg02SfIYh5mdaEWLG2RbgQCrosv4hJ6vxG+kvKRfYIs4B0sC+8lBZDYDY9AK7DbxzZtDG+h+ZqZJ0ihzGOY8HrzoZQItkaAGHtUS7Qhy8hkniD5RTyO6jBiK/7MNRpjb7dEL2cu7n4BZ54gw8v89Trhl1kugq6x6/D5beYJMqydD8j1bhInI2UI1AmHdhbpuZSFFSiczBMEy3iUVcVHgbIW4YYgkGMcvrlETzfEWUJOsk8QAJbD7wLYMSGMxGxIBKiOSdU2WhVSPRVqWhAkX+G1xNBuV79UdEiEINwR2B7fpg8imGi6qhYEKTh8OwMKhzI3HW+TAviza1Pm18fpQZAyX8eEK0zqvgzkerdr08kZiHPIEPUgiMPnMuAd1CkjJQgwY26tRN9LSTihw9CDIGWezIRfhEZBFGNHgIFpNZsibQMbe1AhDOpBkCX8Za7htRD5i0pCCHAr9qmdT5E38ksoPGWzWhDEy9ZymJWzFsFEEWDgvZpNWjx214YgBYdXMDA90cqLcVUEnnBt+kdV4TTLaUOQfIWnE2NFmsE2JjaC4xappEO+2hAE3tFrQIcORcl6Dsw4tVYiLf6z0ocg3je38jMrDdx6yd0J+2EGdachmKgxaEWQYWU+M0e4JSoooh8eASJcVy3Sd8JbSJemVgTZZgnv0lVDpj/xTFd7BI+mzjiks0S/Dq6ZTg2tCNL3uNd7OXVSOuHWPqqVrk3H65SlfgSJ4RhonQrcyFyIMataoh830mfSvvQjSDuPRQv+lDRwYv9zCLzptmI/HY486J+ZdgTp+5n1XwAulCZuKALtrk3aYa4lQQqLeA/uxjMg7NLQFjHYGTGOrpZotW4QaEkQr0h5hy8n4HrdCpbGfBi4tWbTmWmMLWpM2hIEC3i4VcDTYDkWIWqT+Oi/w3UcXWvL/srdgfLUlyDem/WF/G3OQaunKgk3e3DzjAvdErUHV8yGhtYE6ZuwPwxgSjbKkbkoH3Rtmpq5qAMErD9BKnwsGCsDYCKiKggwunLAUVnf98ovVe0J0jdhv5mAmX5gyHV1BBiYV7PpanWNbEqaQZCFPJ5a8AAYX8pmmdIVdc/5g/viKEyirnRFFn80RhCkZy6yiKeijvvjh9BAi4SpbpEeNCFzYwjSQ5IK22CUTShsUjkScG3VpiuTsp82u0YRpI8kN4BxWdoKkZF4bnRtmp2RWGMJ0ziCeKgVHF7OwIxYEDTECAF3VG0yDjMjCdLzZKvMa4lkw2slfjMed0s0WUlWMyFjCdLzc6vMG2VBo09HM37rluhAzfpeOR2jCdJDEoc/BLCtMmImCTL+6pZod5NS3jpX4wnSN3F/CIxjTG6Ez+XO2OyWaITpmAhB+jog7/BcAuaZ3hB9+b/o2jROsACEIP26IO/w6QTcZnJjMPDdmk3XmIxB/9yFIFt1QsHhSQzcY+C8pDOXw6TNs2mNkGMLAkKQAboh7/A+xFgCwhEmNAsDP625mINL6H0T8g2SoxBkMLQW8A5WHj8CYVoQQLMmy4zLayX6ftbiblS8QhAfpPMLeRrlYAOY1KiiNMiPtzXSJa5NsoBzCMCFIIrdWCjzt+oEm4DDFFXSKraBgWWtrVi66Xx6K61BpiUuIUjASlhltpFDEYx9A6o2V5zwCtexrAYsRYnea24w2fEuBAlTK4dH5hk29RIl7R9hvQhgmVvAUswiOT8lYL2FIAEB6y++jcO7dhGmg3Es0POXprEehKVuF5ZiDrlpCixLsQhBYqpWYTF/ibtxQlPJQngBjNUMrK4VsQJEcrBpxPoKQSICOKB6hbcvACcy9xzD8M0kXHg2vdNkCfC2+3ySu/BY7UJ6ISlfptoVgiRd+RXcYr2LyUQYXQdGE2M08Onf3wHYdcgQGB8jh4/A6CCggwkdDDzWUsdjum+5k3RpVOwLQVRQSlJmBbcU/obR1InRXS3opjo6WrrRsdlCB95CB+ZRPUn3YntoBIQg0iGCwBAICEGkPQQBIYj0gCAQDgG5g4TDTbQMQUAIYkihJc1wCAhBwuEmWoYgIAQxpNCSZjgEhCDhcBMtQxAQghhSaEkzHAJCkHC4iZYhCAhBDCm0pBkOASFIONxEyxAEhCCGFFrSDIeAECQcbqJlCAJCEEMKLWmGQ0AIEg430TIEASGIIYWWNMMhIAQJh5toGYKAEMSQQkua4RAQgoTDTbQMQUAIYkihJc1wCAhBwuEmWoYgIAQxpNCSZjgEhCDhcBMtQxAQghhSaEkzHAL/D1t/3wW+pklYAAAAAElFTkSuQmCC"},4378:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAFMhJREFUeF7tnQvQdlVVx39WKhYZVqagFupIiQWYGoqZKV4TSCq7QJqMWCBd0KjUILxrSqKmQklBGnSx0gCzi5cUQS0YgRILprRC0aw0o7xVNn98pE/93vf811nnnP3s511r5pv5Zp511tr7v/f/PWfvvfZaN6GkFQK3B+4P3BPYd5d/as/7dvl3KfAW4NpWDd3Jfm+ykzvfoO/7A8cChwAHB/2/E7gEOAu4KvhsqY9EoAgyErjgY7cEngQ8EdD/M/Ix4IXA6YD+XzIjAkWQGcFdmX4scBJwt4ldvRs4DThnYrtlbhcEiiDzToezARFkThFBjpnTwU62XQSZb/Tfu1p4z+fh/y1rUX/HJRztNB9FkHlGXDtP95jH9JZWL1vtiC3sdrPdFUGmH98nA8+d3qxl8SnA8yzNUrIQKIJYMNlKRwHn2trzKB4NnDeP6Z1ntQgy3Zhr+1bnFFPvVkVbqN0tnbPUFnAUud3oF0EmAHFl4mnAqUFznwBeDVy5+nfF6vkDgQNW/x4F7BG0+3RA7SlJIlAESQK4elwn5G8PHgJeDTwBeONAEw4FXg7sF2iq3h73qRP3AGJbqBZB8hjKgk61TwyYugA4IqAv1fOBwwPPvGh1ch94pFS/EIEiyDRz4l3AQaapM4HjTd0vVDsDOM589nLg7qZuqdUbZLY5oEhcHQo6okX8fR3FbXQuXi3CHTM6PNQhYslIBOoNMhK4XR5TKIlCSobkeuB+gP6yZ0RvqouAPQ0jCkGpWC0DqK1UiiAJ8FaPuusPnU3ojGIK0VmLzlyGpNYhQwgN/F4ESQIIvAZ4pGHmFOBZhp6jcjLwTEPxtcCRhl6pbIFAESQ/NdwFunagLsy7u8HCYYB2woakFupDCNUbJInQ8OMfAfYaVmMf4DpDz1HZG/iAofhR4FaGXqnUG2S2OfAZ0/LUb+tWfs3uboba1IO2GajEetFqorbyG0Onc+0iSH4AW03UVn7ziHVkoQiSH6xWE7WV3zxiHVkoguQHq9VEbeU3j1hHFoog+cFqNVFb+c0j1pGFIkh+sFpN1FZ+84h1ZKEIkh+sVhO1ld88Yh1ZKILkB6vVRG3lN49YRxaKIPnBajVRW/nNI9aRhSJIfrBaTdRWfvOIdWShCJIfrFYTtZXfPGIdWSiC5Aer1URt5TePWEcWiiD5wWo1UVv5zSPWkYUiSH6wWk3UVn7ziHVkoQiSH6xWE7WV3zxiHVkoguQHq9VEbeU3j1hHFoog+cFqNVFb+c0j1pGFIkh+sFpN1FZ+84h1ZKEIkh+sVhO1ld88Yh1ZKILkB6vVRG3lN49YRxaKIPnBajVRW/nNI9aRhSJIfrBaTdRWfvOIdWShCJIfrFYTtZXfPGIdWSiC5Aer1URt5TePWEcWiiD5wWo1UVv5zSPWkYUiSH6wWk3UVn7ziHVkoQiSH6xWE7WV3zxiHVkoguQHq9VEbeU3j1hHFoog+cFqNVFb+c0j1pGFIkh+sFpN1FZ+84h1ZKEIkh+sVhO1ld88Yh1ZKILkB6vVRG3lN49YRxaKIPnBajVRW/nNI9aRhSJIfrBaTdRWfvOIdWShCJIfrFYTtZXfPGIdWSiC5Aer1URt5TePWEcWiiD5wWo1UVv5zSPWkYUiSH6wWk3UVn7ziHVkoQiSH6xWE7WV3zxiHVkoguQHq9VEbeU3j1hHFoog+cFqNVFb+c0j1pGFIkh+sFpN1FZ+84h1ZKEIkh+sVhO1ld88Yh1ZKILkB6vVRG3lN49YRxaKIPnBajVRW/nNI9aRhSJIfrBaTdRWfvOIdWShCJIfrFYTtZXfPGIdWSiC5Aer1URt5TePWEcWiiD5wWo1UVv5zSPWkYUsQfYEjgDuChwI3APYp6P+V1M3D4EPAJcBVwDvAc4Hrh/bzQxBDgFeBhw01nk9VwgsgMDlwAnAJWN8jSXIccAZYxzWM4VAIwSOB86M+h5DkMOAC6KOSr8QWAMEDgcujLQjSpC7AFdHHJRuIbBmCOwHXOO2KUKQm6/Y9yDXeOkVAmuIwBsAfQV90mlbhCCPBl7pGC2dQmDNEXgM8CqnjRGCvAA4yTFaOoXAmiNwGvAzThsjBPkT4CGO0dIpBNYcgT8FHuq0MUKQDwK3cYyWTiGw5gh8CLit08YIQSq0wUG0dFojMOk8LYK0Hs7yPzUCRZCpES17G4VAEWSjhrM6MzUCRZCpES17G4VAEWSjhrM6MzUCRZCpES17G4VAEWSjhrM6MzUCRZCpES17G4VAEWSjhrM6MzUCzQjy/rpvPvVYlr1GCOje+u0c35GTdF1+142skkKgdwR0I1bJRgYlQpBnAicPWiyFQmD9EXgWcIrTzAhBjgLOdYyWTiGw5ggcDZzntDFCEOXAuqjS/Diwls4aI6A0QPdzc2VFCKI+KxfWxWvc+WpaITCEwH0jObKiBJHzyok1NAT1+7oiEM6NNYYg6nzlxlrXKVDt2gqBcE4sGRpLED2rHFkvByoNUE3KdUZAaX6eEMmFtWtnMgSRHeXK+n7ggNU/JbCue+vrPF02v226b67E1Veu/v2umwNrd9BkCTIGbjcUQLbVSZGuZHMR0GTWH1hXFp2zizoD7g/8uYsE8JuAEtaVbC4CSuD2w4HufSfwloB+SnVpgpwKPC3Q4p8FlLCuZHMRUAK35we6p/nz9IB+SnVpgrwJeECgxQ8DlLCuZHMRUAK3Pw50783AAwP6KdWlCfI/wJeYLf7wav1xnalfan0isPdqUX1rs/n/C3ypqZtWW5Ig8qXOufLG2kJ2oepeT1uxhwZ6oT+ykc2egOnPV12SIN8RXFydDjxpdM/qwZ4QeCHwxECDtdnz1oD+aNUlCaLw4mcEWnoMcE5Av1T7ReCxwNmB5v8CoOsXs8uSBIm+Ru+5qlY6OwjloDkCqo58aaAVi31+L0mQTwNfZoKg8r37m7qlthkIXLUqJ+705r+BmzqKWZ2lCKJdB3XKld8BftBVLr2NQOC3gR8I9ER/bLUrOqssRZBvX122cjvz88BzXOXS2wgEngo8O9ATXXp6W0B/lOpSBNGE1z1gV0aFJrvGS28tEYheoVB+hAihRnV6KYKo5NWDzRZ+FLgboNQsJTsHgX2AdwN7mV3+syVKAi5FkE8FFlXa39Y+d8nOQ0BBiDovc0SbPjdzFDM6SxBEiyl1xpWXAj/hKpfeRiHwy8CPB3qknazI5k/A9GdVlyBINNHDjwKvCPekHtgEBB4P/GqgI6EEDAG7N6ouQZCnBHek7g28c0xn6pnuETgYeEegF9r5em5AP6y6BEEi9dWvAfYL96Ie2CQErl7lO3D6ZNc7d4ztTmcJgnxidXfdaePvA9/nKJbOxiLwe8D3mr37JLCHqTtKbW6CaJdBnXBFNw4jAY2u3dLrBwEFIkZuDCpxiHZJZ5G5CXKfSBY74EjgtbP0tIz2gsAjgdcEGqtNoLcH9EOqcxPkyYFF1PXANwD/FupBKW8aAl8N/AOgXNCOaBPoeY7iGJ25CfJ6QPfKHbkE0LZdSSGg/M96Mzii++wPdxTH6MxNkP8CbmE27FdWeX9N9VLbYATOBH7M7N/HgS83dcNqcxJEiyftYLlywiqVqatfepuLgFKFvizQPe1kRTaDbNNzEiR6gn6v4K0yu5Ol2B0Cuk36l4FWz3aiPidBlPTtF81Ovg+4o6lbajsDgfcC+5pd/blg8jnT7LyxWK8DvstsiQqEfrepW2o7A4E/dAttAn8EPGIOWOZ8g2jb9ivMRttFFU17pdY/ApGisf8Z2BYOITMXQbRzpR0sV1RC4dWucuntCAQeBah0gSvaydKO1qQyF0Eid9C1+/A1gP4KlBQCn0NAXx//Gojjm+WO+lwEOSmQlV27Fd9W86IQ2A0CfwFod9MRZYk/zVGM6MxFkAtWdQydtvwacKyjWDo7DoGzgMeZvb4QULKPSWUugvxHYNH0U8BLJu1VGdsUBH4SeLHZGW0KfaWpa6vNQRAtliLriW8B/tpucSnuJAS+GfirQIe1bolsDg2anoMgWiy5mbevBe4w2MpS2MkI/BNwexMAZUS5yNS11OYgiEoW/JLlfcYDni38Kz7sdsDXB2slmt0ptRkQiBw4/zSgUgqTyRwE0am4u1hSHL/i+ecWVVFViv2jdilTrWKiqvNe5y9zo5+zr6QMulfkiDaHjnAUXZ05CPLvwC3NBii8RISaUxTuolQyenPsTuqQck7087Y14RV24sjHgK9yFF2dqQmiRZJ2ExxROTZ98sya+Gt1O02fVFuJUpzeORia7/SvdKZBQIkHdZjs1rbUTcTIJtG2rZyaIJE66JcDd58Gwy2tuOEKxwO6pFOyngi8CzjIbNqkddSnJkhkgf5K4EfMTo9V0x669tKHRFk0IvXbh+zV79Mi8BvAY0yTky7UpyaIMpK4YesnBg6BTGy+SM090S+CjEV4med0mPwi05XWK8qMMolMTZCPBNLXK4OiMinOKW5Zr8oHPOco5G3fBVDGRUdUPuNWjqKjMyVBdMyvXQRHPgTc1lFM6rhZHR8EqDBkyfoi8MFdtuiHWqldVIU7pWVKgmhx9GazRUsUP9Hpq05hHdF1X137LVlfBCJFmB4w1UHwlATR4sgNN9ZJu0Li5xR3R02FIN3qu3O2t2xvj4DmluaYI5pbbjTHtvamJMgfrFKHOh14KKC/CHPKMcCvGw70bfuNhl6ptEXgIYAqBTii1KXf4ygO6UxJEN3+UtpIR6b0u5U/3XNX8dAhmTUz35Dz+j2EwGdMbaWv1S3VtEw1UbUoUoiJIwptV4j73HIe8EOGEyUoi5T9MkyWykwIKPRdIfCOKOTE3TTa0t5UBNGi6E1OqwFN3KNN3YyaqlQ5V3l1uHl6xlE9uxgC564CTh2HDwxsGs1OEN0Hfr7T6lX+XeXhnVs+DHyt4WSJgEmjGaViIKB8vW5IkBIXvsCwua3KVG+QSFUglTj4x2zDB57X61UHRo7UjUYHpfXQUdCpSiM4Mkm1sqkI8i/momiyxdMAQt8KXOaguLrH7EYgmyZLbUYE3M0g6TlfELO/QfYCFGLiiC4pab0yt6jOoXMRSqHuW90TmbuNZX8cAjqM1qG0Iwo5cb8kdmtvijfIocAbnNau1ilKNDy3yIdTdUj3l3WPuaQfBJQQXesLR9IhRFMQJJLFfdJY/W0Q0iaAAhCH5BxAB4ol/SDgRkioR+ms71MQRJ8ybunmKfw5Q6k3mt5sQ6KKqkqSXNIXAu6BoTaPdGlutEwxYf8ZuLXRgr8FvsnQm0LFrS2h8xidy5T0hcDfmOFB2ur/ukzXsgTRIsitSqs3jRIkzC26u6wAREdmq0zkOC+d0Qgo67v7ZlD4k7uJ9EUNyhJEiyCFrjuib319888tkcs1+wDXzd2gsj85AkrhdLZp9cGBTaTJCRKpg34bQJ9jc4sihRWAOCSKHdMWdUl/COizSZfuHEnVUc++QdwF+uT5irZBxq2QqkwZOlAs6RMBN/9aaqGeJYh7DfJtgHL2LiHuxZoUcEt0pHxsi4DOsFSoaUhS17szBFG8vUJMHHkGcKqjOIGOLss4WS104OSmtJygWWViYgSUiUbb9I4o5EShJ2HJECRyw+vegMLPl5ArzfsmxwFLRBUv0eed6ONg4B1mx0ffYM0QRIuf55gNzPgxXdyo5lbXfVjgCme0DaW/DALugeFTASXBDktm4roh7n+/yn0bbtyIB5RKyN221aGlDi9L+kXg74A7Gc0fHfqeIYgiYfc2GveqQNpIw9y2KocAFxtGdJCoRNtKilzSLwJKX/too/n6o6kzr7CMJYgWPTrGd0Q1OX7LUZxAR2AJtCGpTCZDCPXxu3IOuKFCCodyN5Vu7P1YgriHcXKkwzg3oUN2WLRT5iShrkwmWaTX4/nIzdFRa86xBNGi59kGRh8HVNRzKXFfuaosdcJSjSo/syKgop23MDwoBZS7qZR+g7hJ4rQecA5zjP5ZKvKndciQTHKhf8hJ/b4IAjqEVtDpkIxKJjf2DfJ+c9EzirVDPd3mdy3GnKTYVXYtAfKaPep+zYy6Xj2GIFrsuEGHqiClSlJLSKT8272AS5doVPmYHQFVnlJcnSMKcnQ3l26wN4YgD+ez5ZsdGWPfsbs7HaXv0Sm6I6N2NBzDpdMEAffAUAVdXx9p4ZgJfLJ5TVW5r5QDaylR/JW+M4dk1Kt2yGj93hQB5crarlDr5xp3CqCczbaMIYgbDHgW8Hi7JXlFtz5iZTLJY71uFl4BHGs0SiUCjzT0blQZQxAVpVFxmiFR+nnnL/qQHfd3JaHWXZAhWfJkf6gt9fs0CGjSa2d1SK4F7jCktOvvUYLoVqDugDiyx8KhHDr80wHmkCiLiRsmPWSrfl8PBG4eqHOvXU73NmJ4ka5FzusMTD4N3MzQm1JF4SO6jz4kjzML6wzZqd/XC4FPATc1mvSIwCZTmCBa5Ojy05CoIKYSOiwpCkBURpMhUb4st1TDkK36fX0QmCUXWvQTSzWojzAwmaxGnOFLKvsCyoXlyJ0BheCXbBYCbo3M8wGVvLAkShAtcpxkz/sD77FaMI2Smx9YQZPK5eXum0/TurKyBAJ3Ba4yHCkKxNlkusFUhCCRy0gRu0afBlWUh9e5PnsFoJPXks1EwP3Dp3tM1mZTZCJrcXOhgas+dZxbXoYpW0Uh7k5SCH0iOgkdbMeluFYI6NNZNe+H5DBzsyn0BnHvWrQoiukS5MXAiUPo1e/dIvBS8xqD5ouyogxK5A2ixc3hgxYhtI1m2HNUtHWrk/sh0YGSTlNLNhMB9xjiAnOzKfQGcUPcI6SbcpiGMu29FVBtiZLNRsBZh9jxeJHJ7BJks+Gv3m0CArMQxP3E2gQAqw+bjcAsn1iKYVKoe0kh0DsCCnlXVMigRD6xlL7n3EGLpVAIrD8CdmWxCEH2BHSXog7a1n8CVAu3RkBXwFVpQClqByVCEBlzMxcOOi6FQqARAqGye1GCqE/Kin5Go86V20Igg8DxwJkRA2MIIvs6qtdOQEkh0AsCOuR2QqU+rz9jCSIjupykDIVL3/voZUCqneuBgO6J6Cr2NWOakyGI/Omqo5KwHbD6dyCga7klhUArBHSdVlHbSgGlfyoZPTqL//8BKKXl59VUV38AAAAASUVORK5CYII="},4966:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAEb5JREFUeF7tnQtwFdUZx797834RknADISQEiCBPhaKAVECtggP4oHaEEVTstFoFOtbWRw3vKFXraCG+xtYiwUdrKxVR8YUIgzyrUoXwCkJCCHm/yDv33s6mZJrknr33nN1zyN17/zvDjON+59uzv7P//Pc7Z/eujbCBAAjoErCBDQiAgD4BCARXBwh4IQCB4PIAAQgE1wAIGCMABzHGDa2ChAAEEiQDjdM0RgACMcYNrYKEAAQSJAON0zRGAAIxxg2tgoQABBIkA43TNEYAAjHGDa2ChAAEEiQDjdM0RgACMcYNrYKEAAQSJAON0zRGAAIxxg2tgoQABBIkA43TNEYAAjHGDa2ChIBygdy9JOuSNhelBglPnOZFJBBqp6L1a7OPqzykEoEseGDpBLLbHidyTySyOVSeAHIHOwF3GZFtD7ncT+S+sHqvbBrSBTJ/0bIVNhstl91R5AMBXwTcblqxMWfVSl9xIvulCuSuxVlDXGQ/IdIBxIKATAJ2cmW+vi47X1ZOqQKZv2jZuzYb3Sqrc8gDAqIE3G7atDFn1RzRdnrxUgWyYPGyciJKktU55AEBAwQqctet6mOgHbOJNIEsuD9rOIXYD8vqGPKAgGECTteI3Bez8wy379RQmkDmL8qaZrPZv2B1asNaqXUT87wPHzvF/P8Zaf0oOipSBitpORoam+hU4TlmvhFDM6QdR1aisopq0v5132KiI2nggH6yDiOc584l7Lkgt9t1zcac7O3CCRkNIBAZFAVzQCCCwHTCIRABjnAQAViCoXAQQWCscNxi8UOEg/Cz8hYJBxHgCAcRgCUYCgcRBAYHMQcMDmKOX0drOIgARziIACzBUDiIIDA4iDlgcBBz/OAgBvjBQQxA42wCB+EE5S0Ms1j8EOEg/KwwiyWHFcFBJIFkpIGDSGALB+GHCAfhZwUHkcMKDiKJIysNHEQCXDgIP0Q4CD8rOIgcVnAQSRzhIF0J4GlehReWXmo4iBzoWEkX4IhZLAFYgqGoQQSBscJRg/BDhIPws0INIocVahBJHFGDoAZReCnxpYaD8HHyFYUaxBehTvtRgwjAEgxFDSIIDDWIOWBwEHP8OlrDQQQ4wkEEYAmGwkEEgcFBzAGDg5jjBwcxwA8OYgAaZxM4CCcob2He1kEeXbRQwhGQAgS6EvhDzl+ZSCz3w3EQCC5tFQQgEBVUkTNgCEAgATOUOBEVBCAQFVSRM2AIQCABM5Q4ERUEAkYgLz/1mAo+XXLqfU5A+/yBP25W6m99Q5Pu5w8cSb17DO99j6wJjFksfB+k6zhioVCOpvCoiQBHLBQKwBIMxUKhIDBWOF6Y4ocIB+Fn5S0SDiLAEQ4iAEswFA4iCAwOYg4YHMQcv47WcBABjnAQAViCoXAQQWBwEHPA4CDm+MFBDPCDgxiAxtkEDsIJylsYZrH4IcJB+FlhFksOK/zsjySOrDRwEAlw4SD8EOEg/KzgIHJYwUEkcYSDdCWAH69WeGHppYaDyIGOdRABjpjFEoAlGIoaRBAY1kHMAYODmOOHdRAD/OAgBqBxNoGDcILCOogEUEQEB5HDETWIAEc4iAAswVA4iCAw1CDmgMFBzPFDDWKAHxzEADTOJnAQTlCoQSSAQg0iByIRoQYRQFlZXUcR4aEUHh5GIfYQam5poeaWVgoPC6XoqEiBTOpDrXiLFREe1s5W++dsc7az1f4lJfRSD0znCBBIj6FXe2CrCUQtDePZIRDj7Py6JQQiZ3ggEDkc/S4LBCJnSCAQORz9LgsEImdIIBA5HP0uCwQiZ0ggEAGOpY1OOlPXRqfqWqmqyUmZvcMpPS6UBsaFkV3aQ/0CHfISajWBNDudVFRfS4X1tXSqrpoSIiIpI643pcXEt/93T20QiA/yW0/X04YjtVRQ10bljU5mdFSojQb3CqOZg2LpnhE9NyXZuXNWEcjTB3fRvrKidlE43W4m3/7RcTQ0Pol+PmwsjUpMvqhagUC84P79V+X0bv55oQGZ1C+Snp+STPERdqF2soP9XSC7SgpJE0fB+RruUw+z29tFcu/w8dxtzAZCIAyCp+vaaP7HxVSm4xg80J/5sYNmD4rhCVUSowlE+6QAa+vJzwlo/dGE8Vb+94bPW3OR3Gm3Gm4v0hAC6Uaroc1N4946LcJQN/a1n/Slq1KipOQKlCRPHdxFb5sQRweHftGx9NGMO5RjgUC6Ib7nsxL6qrhRGviv5w2k6FA/q+ClnZ1YooMVJXT3l/8Sa+Ql+pHLJtPcIaOk5WMlgkA6UXn7WB2t2FvhFXifyBBKigppv+i1Wa3SBie1utjFpZZo7tA4WjEhSekgWiF5Y1srzfns73SuQb+miwoNo6SIKEqKjKL61lYqb2qg6hb2bWLHOa+fegtdltRXGQII5ALab8qaad7WYl3QSZEhtHpSEl07ILpLzA+1rbR0dwUdKNUfSE0gmlCCeXvy2530zsnDughuzbiUlo2b6rF/w/GD9Nx3e3TbaeJ4afJM0sSlYoNALlDN3l9JG4/UMhmPS46gN6eneOWfc7Cacv5TzYwZlhBO783qr2L8LJGztLGepn+0Ubevz02aTtNSMnT3n2s8Tzd+9Ibu/tXjr6FZ6UOVsAgYgfB+xFPvsfRffF5CO8961h7JUSH0+ZwBFMaxEvjIrnJ67yT7FuL18UTxav7IKbkwZCY9fL6SVp/cz0z5+Nir6bZBI3we7vvKUlqwfRMz7o7M0fTbMVcx92mzeWa2gPmI56OLFvrkEN8rllL79WHGXb/pDBWeb/PY98K0ZLourettld6Bzta30czNRdTY5lmTDDv2CcXXFPnsYyAGVKZEU9Ewzy/VXulIpVeunsV9yq/kHaCX8/7tET/e0Z9evXo2M8/R/AJyOl3cx+geGDCfgeYRSF9HIvPlmyanmy5/kz21u+WmVMoU+NP/sw+L6buKZo8BSTtzgFKKvzM8UFZueG5wLypLj/U4hRlpmbTmiuu4T+3TopP08N5PPeJjw8Jp52z2H8iCohI6X298VjKoBJLWP5niYj3d4GhVC9285SxzoA7MTafYMP5V8azd5fSPE563WUmVP9CQ/O3cF0MgBZ4emUi1Ds/nqeZnjqGHxkziPtWSxnqaoVPLbLr+9vZnt7pv58oqqbKKXVvyHDioBJKa4qD4OM/V7RM1rTRrM/v2Z//cdIoTEMjyPRX0t+N1Huz7VOTT4JM7eMYk4GIKRiZQjcNzwXTBJWPoN6PlCGTz9HmUFuP5HFxxSQVV1XiOBy/koBJIn8R4Su6T4MFGW8cY/Qb7Fmvz7P40tHc4L0/66Ydn6VBFi0d8xundlFx6hDtPIAWWZMRRaYbnNLesW6yEiCjaNvNOJrIfCoqpscnzlpeXb1AJJDYmmtJT2U+Dznq/iE5Ut3pwe3BsAt07Kp6L57YzDXT/F6XM2BF5H1DsefY+ruQWDqpOjqLCEZ5/mDJ7JdKrU2ZT73C+x9kf2/85bS084UFiakoGPT9pOpOQ3k818eIMGIFsWLuS95yZcUu+LKVPChqY+96ckULjHBE+809+p5AqmjwfiQ+322jP7elB+8jJoaoymv/Fu0x+vDNZf/p+L60/9i0zx33Df6TsCd+AWQcxK5A/fl1Ffz6k/+j1x7cMoIFxocwB0m7R7vr0HH1dyrbysY4IemuG94VGn+qzcEBtSzNN3bJe9wwWDr2cloyaoLt/R/Fp+vXurbr7n514A13bf5ASQhDIBaw8j7g/fkUiTU2Nbn+LUNvqWly0r6SJVu6taH8uS297foqDZgzsuUfflVw5gklzDu2jvxz9RrfV9amDSVvwG57goHB7SHvcsZoK+qDgOGmPm+htk/umU87kGwV7wx8OgXRilXuklp7YX+mTXt/oEEqMCKG8Ks9ivHvjOUNi6cmr2IuTPg8UYAHztv2TjlSXez2rULudtNqkrKmeKpp8r1+8d8NcSo/lqxGN4IRAulH75bYS2lHke2B4YDuiQmjnbWk8oUERo709ePMnb0s714cvm0zz8Lj7/3lerK/cXpp7SsogeqtbpBzAgkm0Nwm1NwrNbqpvrTr6BwfRGSlfRbu3AdbeIsyZltyjs1baQ3raL6aztoED+pm9Pk2112qLe3du8fmuh95B1lx5Hc0YkGmqD7yNIRAvpHYVN1L2vkrS3vng3fzl3Q9//9EGjaf2noe3Arw7c22m6sHRE2kAY8Wcd3xE4yAQH8TKm5z02qFayqtsbi/Kq5s9nwwdmRROoxIj6JYhsaRN6frDZgWBaJy0WaqvSgrpaE055ddWeaBzREa3z2yN6N1H2VqHt/GCQASvZu25rbzKlvbfyNKEMTIxgmLC/O+dc6sIpDP+mpbmdqFoM13JkTHtwhiocIaKZ+ghEB5KFoyxokD8ETME4o+jIqFPEIgEiPjClByI/pgFApEzKnAQORz9LgsEImdIIBA5HP0uCwQiZ0ggEAGOhWdLKSoygsLCQinEbqeW1jZqam6m3r1i8RFPAY6sUG1RU/txBe1Dnhpfp8tFLS2tpAm9Jxc2IRCBgcV30gVgCYbiO+mCwFjhF+tZLL2uQiASBlEnBQQigS0Ewg/RajUIBMI/trqREAg/RAiEn5W3SNQgAhxxiyUASzAUDiIIDDWIOWBwEHP8OlrDQQQ4wkEEYAmGwkEEgcFBzAGDg5jjBwcxwA8OYgAaZxM4CCcob2GYxeKHCAfhZ4VZLDmsCA4iCSQjDRxEAls4CD9EOAg/KziIHFZwEEkcWWngIBLgwkH4IcJB+FnBQeSwgoNI4ggH6UpA2k9+wEH4r1A4CD8rOIgcVnAQSRzhIHAQhZcSX2o4CB8nX1F4FssXoU77sQ4iAEswFLNYgsBY4ahB+CHCQfhZoQaRwwo1iCSOqEF6oAZ5dvmDCofvf6n1PifgSPL8gL3yznAcIBD6GxMd2aO/GPPQyueYpN1u1zUbc7K3cwyDz5CLMs376KKFPjuCABAQJRAwn4GGQESHHvE8BCAQHkqICVoCEEjQDj1OnIcABMJDCTFBSyBgBLL64V8pH8T6hibmMbSZFn/cAqG/Pc126dMvBcYs1oa1K5Vfo1hJV4cYK+kS2GIlnR8iVtL5WXmLxLNYAhzhIAKwBEPhIILAWOFwEH6IcBB+VnAQOazwLJYkjqw0cBAJcOEg/BDhIPys4CByWMFBJHGEg3QlcFEeVsQ0b1focBA5asYslgBHzGIJwBIMRQ0iCAyzWOaAwUHM8etoDQcR4AgHEYAlGAoHEQQGBzEHDA5ijh8cxAA/OIgBaJxN4CCcoLyFYR2EHyIchJ8V1kHksMI6iCSOWAfBOojCS4kvNRyEj5OvKMxi+SLUaT9qEAFYgqGoQQSBYRbLHDA4iDl+mMUywA8OYgAaZxM4CCcozGJJAEVEcBA5HFGDCHCEgwjAEgyFgwgCQw1iDhgcxBw/1CAG+MFBDEDjbAIH4QSFGkQCKNQgciASEWoQAZRwEAFYgqFwEEFgqEHMAUMNYo4fahAD/OAgBqBxNoGDcIJCDSIBFGoQORBRg4hxhIOI8RKJhoOI0NKJxfsg/BBRg/Cz8haJWSwBjnAQAViCoXAQQWCs8LuXZF3idNuPSUiFFCBgikCIzTV0/drs46aSXGgs7YfjtHwLFi8tJbI5ZHQMOUDAGAF3We661cnG2nq2kiyQZZuJaLasziEPCBgg8H7uulU3GWjHbCJXIA8snUB22x5ZnUMeEBAm4HJPzH1h9V7hdjoNpApEO8b8RctW2Gy0XFYHkQcEeAm43bRyY86qFbzxPHHSBaId9K7FWUOcbvszNhtNIaIkno4gBgQMEqhwu2lHiM31u9fXZecbzKHbTIlAOh9twf1Zw9126iu748gHAjYXleS+mJ2nkoRygajsPHKDgGoCEIhqwshvaQIQiKWHD51XTQACUU0Y+S1NAAKx9PCh86oJQCCqCSO/pQlAIJYePnReNQEIRDVh5Lc0AQjE0sOHzqsmAIGoJoz8liYAgVh6+NB51QQgENWEkd/SBCAQSw8fOq+aAASimjDyW5oABGLp4UPnVROAQFQTRn5LE4BALD186LxqAhCIasLIb2kC/wWtwLCqUnGJVgAAAABJRU5ErkJggg=="},8647:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAGTlJREFUeF7tnQl0FMXaht/JBgGyh0AgC/sqO8gqsqiAoCDcH0VBPYqiSBQuIJdr2KNcuSIKuP0qqKC4/FcUVOSigiiLYBAQQZaEJQTIvq+TZP5Tg4GQ7p6u6qmZZDJfnZMTZd76uvqpefN1d1VXmUCFCBABTQImYkMEiIA2ATIIfTuIgA0CZBD6ehABMgh9B4iAMQKUQYxxo1puQoAM4iYdTadpjAAZxBg3quUmBMggbtLRdJrGCJBBjHGjWm5CgAziJh1Np2mMABnEGDeq5SYEyCBu0tF0msYIkEGMcaNabkKADOImHU2naYwAGcQYN6rlJgTIIG7S0XSaxgiQQYxxo1puQsDhBnn46di2ZRVo7iY86TSdSMDLA8nvrY477chDOsQgU55a0BcepucASz/A1NiRJ0Cx3Z2AJQ0w7UeF5fkNry37RTYN6QaZPGPhYpMJi2Q3lOIRAT0CFgsWb1y7dImeTuRzqQZ5KCa2dQU8zog0gLREQCYBD1S0eX9NXIKsmFINMnnGws9NJtwjq3EUhwiIErBYsHnj2qXjRetp6aUaZErMwnQAIbIaR3GIgAECGRvWLA01UE+1ijSDTJke2xGeHsdlNYziEAHDBMorOm14Pe6E4fpVKkozyOQZsUNMJo+dao36YLXU+ybV8z5x+rzqv0dHNEED3/oyWEmLUVhUjPMXU1TjdWwbLe04sgKlZWQjPTNHEY5xZXxrqjz4tPqzIIulYujGtXG7ZLSLDCKDomAMMoggMA05GUSAI2UQAViCUsoggsDU5HSJxQ+RMgg/K1tKyiACHCmDCMASlFIGEQRGGcQ+YJRB7ONXWZsyiABHyiACsASllEEEgVEGsQ8YZRD7+FEGMcCPMogBaJxVKINwgrIlo6dY/BBdMYOYzWXw8fFG/Xo+MJeVoaTEjJJSMw0U8nY7GYSXFOBqBuE/M+cq6SZdgDddYgnAqiNSMohAR5JBBGDVESkZRKAjySACsOqIlAwi0JFkEAFYdURKBhHoSDKIACyD0lxzCS7k5yConi+aN/AzGEVeNTKIAEsyiAAsTumX50/i98wUJOXn4lx+NlKLCq7V9PX0Qiv/ILTwC0RkQ39M69ibM6o8GRlEgCUZRAAWh/TZX3ZgR3Iih/Kq5KbgMMzrOtD621mFDCJAmgwiAMuGdE9KEpg5CsvMhgI+0bGX07IJGUSgi8ggArA0pF+c+xNLDv1od6Ah4S2wqv8Iu+PoBSCD6BGq8jkZRACWijSjpAi3ff2BfUGq1H5j0Gj0C4uQFk8tEBlEAC8ZRACWinTWvu3YdfmcfUGq1f5u9IMIqecrNWbVYGQQAbRkEAFY1aQfnD6CVb/v1wzQJTgMs7r0R1j9hgjzbYA8cykuF+bjk4Rj2HrhlGa90VHtENd7qPGG6dQkgwigJYMIwKoizSktwZCv3tOsPK5FByzqeavm5x8nHMOLR/Zofr6y3x0Y1qylscaRQeRxI4MYY3ksMxVTdm1WrTyhZUfE9hisG5g9DmZPvtTKYx16YnqnProxjAjqTAaZH/OIkfOnOhIJtGnZHN5eXoqI3ySdxnMHf1D8e4fAULw7+G408PLmasXi+F1gA4vVy+Cm0Xh1wEjVGFp/1LgOCGD5mnWqUpdbOI4MwtvljtNprdj41olf8eaJeMWBb2veCv/uezt3g7acP4lF8crFDMN8G2L7qMmqcc4lXUFRcQn3MaoLySCG0VHFqgS8vb3QpoX6Jl8se7AsUr1MbNUZ87sP4gaZmJuFCd99qqpnBmFGqV4up2YgOyef+xhkEMOoqKItAuw12ZZR4aqSmL3b8POVC4rPHmnfAzGdb+YGm28uxS1b16vqNw2bAHbJVr2kpGchMyuX+xhkEMOoqKIeAa1LrFeO7cf7p44oqt8d3R5Leg3RC3vt830pSZi+5xuF3sfDE7+Mm6oahy3gzV4/NlroEssoOaqnINCuVQQ8PT0V//7luT+xWGV6Sd+w5nhz0Bhuklr3Mr1Dm+HtwXepxjmZcAEVFRbuY9TZDPLmi/MNQ+CtqLWdQE0uz2+r7TXRXrVtIOLTL2Pq7i2qTf2fVp3wz+636HbBtxfPYP6B71V1D7bthlld+ql+Zk/2YAGfmLdcNa7LPcWi/UFu7MfatKoJe8djxLaNmiZgWYRlE62iN9AY13sYRke11TWZEUGdGQchg9Reg7CWaT3Jqmz1jM4349H2PRTfYa0xlEpha/8gvDt4LAJ86hn5/uvWIYPoIrouoJF0AVjVpCwLjP3vJrDfWoW9Zsu+8B0CQnGpMA+ncjJwscD2E6jn+wzDnZGOyR6snWQQgT4ngwjAUpHqZQPR6MwYzCCOLGQQAbpkEAFYGlK9Sy3eI7BLql1jHuaVG9aRQQTQkUEEYNmQvnfqMF499ovhYCMj2mD5zcMN1xepSAYRoEUGEYClI2X3F8sP/4zDGVe4g9b39LJeUjlqartaQ8gg3N0DkEEEYHFK2UtU319KRHJBnmaNQJ/66Bkabh3riGjozxlZjowMIsCRDCIAS1DKDPL+zl1IqSjBFUsJGpm8EFQClKfkwq+oHItnT4OHh7QdxblbRwbhRkUZRACVIemr73yM+KMnFHUH3dwdj0++x1BMeyuRQQQIUgYRgCUoLSsrx7zn1yAtI0tR875xd+DOYQMFI8qRk0EEOJJBBGAJShPOXcSSl99WrTXvqYfQuX0rwYhy5GQQAY5kEAFYgtLvfz6I9z/9SlErONAfy/85A771HTOVRK+ZZBA9QlU+J4MIwBKUrvt4C3btVb6W27VjG8x5copgNHlyMogASzKIACxB6eKV/4vE88mKWnffMRh/G+OcQUG1JpNBBDqSDCIAS0Cal1+AZxauBLtRr15mPjYJPbt0EIgmV0oGEeBJBhGAJSA9euI0XnpD+b6Il6cnVi35OwL8GwlEkyslgwjwJIMIwBKQbvpiO7b9sFdRo03LSCycpf6uuUB4u6RkEAF8ZBABWALS2BffwIVk5Zys8XcOxbiR/Is6CBySW0oG4UZFI+kCqLiltsY/ls6dhhaRzbhjOUJIBhGgShlEABandMv23fi/r5WLMbRvHY3nnqn55WTJIJwdyWRkEAFYnNIXVq/Hn2eUe4ZMvPt2jLmNf9VFzsMJy8ggAsjIIAKwOKRXUjPwbNxqVeUL859CRLjzNuvUai4ZhKMjKyVkEAFYHNIvt/+I/3ytXPWdzbti869qQyGDCPQCGUQAlo6Urdu1YMUbSMvIVigfGD8SI4b0l3cwOyKRQQTgkUEEYOlIv925Fx9t3q6qWrHgaTRtHCLvYHZEIoMIwHNlg7BRaR8fb9Tz8UbTsGCBs5YvLS8vx4IVb+Li5VRF8Jp8OUrtTMkgAv3vagYpNZdZDcF+PDw8BM7UsdKde37F+k+2qh5kfszD6NjWMfsNGjkrMogANVcyiMBpOVV65PhpvPrOJtWJiT26tMesx+53anv0DkYG0SNU5XMyiAAsFWlJaSn+vngV8vILVQM9/ei96N2tk30HkVybDCIAlAwiAEtFOnvJK6rvnDNpu9bRiFUZOc/JzafZvLzYJ8+IHWIyeexU09Pq7rwUna9jj3RfWL0OF5JTNA/+6KSxuLV/T8XnbI+Tmtx/hTKIwPelrmSQUrMZ7AbeXHr199X/N8NsLkNggB+CAvytN/YySvzRP633HLaK1pOrzOxc5OUXkUF4O4IyCC+p67qCwiIkXriEM2eTcOL0WdV5T2pR2U5RQQF+CAzwt/5mP2GhwQgPC0HTsFD4+yl3lK2Mk3QpBX+cTMSZc0k48NsfNhvdMrIZlsydptCUl1fg7IXLYLvnUgbh7HcyCB8o9sU8ePi49R3vkwnn+SoJqpiBmFm8vW/MNKnpmWB/+XkK+/K/9sI8sB1yqxc2wp6emQN2HDIID00AZBDboA7/cQo/Hzis+1ebE7fDZVoTEouKSnDu4tUXqMggAt1gyyB1bRNPtc0wtVAxU7Cf46fOCtCsOWl4WCjmPDkZjUOCVBtxITkV7NKw0iCNQwJqrLF1ZhPP+TE1/3KNjF708fZGy6imXCPfpxIvWGfDsnsLVym39u+FyRNGop6P8rKKnUNmVi5S0pXLj9bU+dE+6TVFXuO4Uc2boGGD+rqt+mrHT/jPNzvB5jW5QulxU3uMGNIPndppLyHKxjwupWTUqtMhg9Si7ggLDUJIkP7+Fy+/9SHY/YZI8W/UEFERTREdEY7oiKYICQr8a56WD+rVY/O12G8f5OUVID0zG2mZ7CY5C+kZV/87IysHmVk5KC4p5T5s105t0a1TWzBzhAYH2qyXk1eAS1fSuWM7S0gGcRZpneOwJzkto8J1W8OuidnAG09p0yISfbp3wk0dWiOyWROeKroadm9gNUt2rvV3fkGh1Vys/cxgbPyE/Xe7VtHw8vLUjccEBYXFNgcRuYI4SEQGcRBY0bDNmoQiwF97bIHFW7LybSScv2gztF+jBujTrTP6dO+Izu1bizbD6frcvAIk18LMUQmCDOL0r4TygGzl8haRTW22ZO36T3Uf33bv3A4PjB+FJo1r9n0PXqTsZpzdlNfmUmcMUpfnYu3efwjvfPSlze/RncMH4r6xd9Tm75rNtlUODFYX0TiIQJe640BhXkEh4la9i8up2jewryydDbaPhisXMoiE3nNHg2zetgubt6lOYLYSfXnxLN0nRExXVFwCNkJdXGpGsya1433vql8JMggZRJhAdk4eFr70FthvtTJ72gPo1rmdZlw2RpKRxWbEFlpn7VaWjm2jhdvi6ApkEAmE3S2D2Moe7H6D3XdoFfYomL1LoVbIIPxfRnofhJ+V05ceZSt/nL94WdHCRg188dKimdaJfGQQgQ40ICWDCEBz5gtTzBjMIGplQO+ueOLBCTZbThlEoGNtSMkgAhydaRBbl1fPTJ2EXl1tb0tGBhHoWDKIHFjONMgHn32N7346oHp59fq//qF7QmQQXURcAsogXJiuipxpEK2Rczbxb9bj+mtHkUEEOpYyiBxYzjTI8jXrceK0ct+MYYP64OGJY3RPiAyii4hLQBmEC5PzM8hz/3odbPGD6mXC6GEYO+JW3VaTQXQRcQnIIFyYnG8Qtm94lsriB1PvH4fB/XrotpoMoouIS0AG4cLkfINMnR1nXauqepk7fQq6dGij22oyiC4iLgEZhAuTcw1SWmrG1Dlxqi1bPOdxtIpqrttqMoguIi4BGYQLk3MNwt7Um7XoZdWWvRgbA7YqiF4hg+gR4vucDMLHyapy1lMsW6Poq+PmINDfT7fVZBBdRFwCMggXJudmELYq4pp1n6i27O2XYrnWzSWDCHSsDSkZRICjszLIWxs+x56DRxQt82vYAK8tn8fVYjIIFyZdERlEF9F1gTMMwl5smrlwpfUFp+qFbQ/AtgngKWQQHkr6GjKIPqNrCmcYhM2/YvOw1ErMI/dal/HhKWQQHkr6GjKIPiOnGSQ7Nx/LVr2juguTp4cHXo2bA7YAHE8hg/BQ0teQQfQZXVNk5eRZVxYsLi69YYVBtjy/yGLTWofc9MV2bPthr+rHPbt0wMzHJnG3lgzCjcqmkAxikCO7R8jMzgNb+EyGQdhGM2wGr1ZZMPNRtG0Vxd1aMgg3KjKIHFTqUUpKzdYFpO3JIHrmGD18EO4de7vQaZBBhHBpiimDyOFoOIqeOdioeeysR8Ee8YoUMogILW0tGUQOR0NRtu74CZ9t/c5m3Scf+hv69+oiHJ8MIoxMtQIZRA5HoSiXUtKtxog/esJmvQfGj8SIIf2FYleKySCGsCkqkUGqIEktKsfFvDIk5ZtxLrcMibmlMMGENgHeaBngjSg/L0T5eSPAx8Mw/R/3HcLn3+xEVo7tRZvvGTUU94waYvg4ZBDD6G6oSAYBkFNSgbiDGdh6toCL6rSbAjCrh/r+eloBfjt2Ett37cfxU4m6x7DXHOwAZBBdzFwCtzcIM8XzBzOQXVLBBaxS1DHYB68MDkO0n5fNegnnLmL7j/uxP/53rvgio+W2ApJBuHDritzaIHN/TuPOGlokn+sTjCkdlCursy3S9v36O/bFH9XtBCZgW6Mxc7Bt2GQUMogMioDbGuSdP3Lw0iE5u6l+OaYZ2gf5WFdP3xt/FPt+PQq2Ay1vGTawDx6cOBoeJhNvFV0dGUQXEZfALQ1yMqsUY7+6xAWIR+TnacEM7+M4fOykdd8+3tIkNBgjh/bH8Ftu5q3CrSODcKOyKXRLg9y//TIOpSqnk1eS6h9eH2G+Xgip7wkLLEgrLMepbDNOZWvv8Bp+5Rgikw5y9Qrb3HLU0AEYMbQ/9+RDrsBVRGQQUWLqerczyIr4LKw7rv1XflI7Pyzqq9xgJqukArN2p2L/Fe0dZlsl7kZoRoLNnhnYp5vVGC0i9He0taeLySD20Lte1+0McueWZCTmKJfTYUjW3dYUA8K1txRgmpWHsvD2H+oGC8lIQOvE3ao9069nFwzo0xVso01nFDKIHMp1xiArF826gUjjEOXG9cXlFvTadB7lFiU8Nq7Bxjd4yuQvTuHXPB+F1LcoG12Obb72736NGmJgn64Y0LsbWkTqZwyLxYL0TP57GL22asUKDeY7T734sj9Xay+bBNrAt57sQ3HHm71klarWYqkYunFt3C7uQDaE0h7N2Nphan7MI9eaENksDI0a+iqapHVz7utlwm+T+Lcl23HyCmIOqF9q9fztI7QMCwS7lGIZg2cFEtbQ/IIipGdmo6hY+z5HRmdQDDECdWYb6KoGaRXdTHXljx0XChHzY6qCUEQjL3x3TwQ3udJyC7p9eBYWk3LKycJ2Zbi/r/7Kh5UHKysrt2YN9jIWldpHoE4apEObKJhUxhS0xj66N66Hj0fqXwJV7b7+648iy0s5QPhsr2A80olvS2ZmCrbJprnKBpu17yvi3i2qkwZp06I5vL2VU0A2J+Rj/l7lfuPtAn2w5a5m3N+EpOQU3L+3BGnFyukprwxujJHRtt8bZxkjJzf/hp1nuQ9OQqcSqJMG0boHOZxWgvu+VW6KGVjPA/sn8r/OeibHjDFbklU7ase4CERqzM9iWx1nZueiokLlKYFTu50Oxkugzhhk2bPTr50zu0EPCVJe5mQWl2PAZ0mqbEQujf6xJx1fJOYr4jRt4IldEyJV4ydfSQe733BmYY961Yo9rwc7sv1q7a3pti5Y8brqKbvcU6wPVi/h6rvhmy8iOb9MVbtzfATCG9qenfvhyTwsO5ChWv/2qAZYc2sYVzscLaJxEDmE68w4CK9BntqViu+TCjXpfToqHF1D1Z+7f3u+ADN3p2nWndE1EDO6Kcdf5HSVWBQyiBgvLbXbGeRoegke2H4FZhv3AeyL3ibQG+zpVnkFEJ9abJ1i8nmC8rKqEiwzFTNXbSlkEDk94XYGYdjWHsnG2qPZcgj+FcVW5pF6IM5gZBBOUDoytzQIYzJx22WwbCKj1KZLq8rzIYPI6Fk3fmGK4Rv6+UVcLlC/YefFOzyyAV4bUjtuzKu2mQzC24O2dW6bQSqx2HoqpYf43duaYGC4cs6XXj1nfE4GkUPZ7Q3CMP6WVoIV8ZnW3zxlbKtGmNsrCKH1PXnkNaIhg8jBTgb5i2NhmQX/vVCAE5ml137yzFenkrCR9s4h9XBTsI/19x1RYsuAyukqsShkEDFeWmoyiA2OZ3PNYHP1W/h7y6HtxChkEDmwySByONa6KGQQOV1CBpHDsdZFIYPI6RIyiASO7MtY05Pqqp8GGURCx8LNx0HsRZiTW2B9TTa8SQgZxE6Y7FUArXfS2Q5eNVUogwiQLykxo7j06h6F7C8026+QFRlbsAk0g0tKGYQLk66IDKKL6LrAGdtACzTHppQMIockGUSAIxlEAJaglC6xBIGpyW0t+8P7Pog9zSCD2EPPdl0yiAS2ZBB+iHSJxc/KlpIusQQ4UgYRgCUopQwiCIwusewDRhnEPn6VtSmDCHCkDCIAS1BKGUQQGGUQ+4BRBrGPH2UQA/wogxiAxlmFMggnKFsyeorFD5EyCD8reoolhxUog0gCqRKGMogEtpRB+CFSBuFnRRlEDivKIJI4qoWhDCIBLmUQfoiUQfhZUQaRw4oyiCSOlEFuJOCUPQppsuKN0CmDyHGzS42kP/x0bNtyi8cpOadOUYiAcQKepop2762OO208wvWa0jIICzklZkEqYGoso2EUgwgYI2BJ27BmmbT1ZiUbZOEWAHcZOzGqRQSkENi6Yc3Su6VEAqxrr0krU55a0Bcepv3SAlIgIiBKoMLSb8Nry34Rraall2oQdpDJMxYuNpmwSFYDKQ4R4CVgsWDJxrVLF/PqeXTSDcIO+lBMbOtyi8e/TSYMBhDC0xDSEAGDBDIsFuz2NFXMfX9NXILBGJrVHGKQqkebMj22o8UDNbd4kmxiFK/WEDBVIGXD63EnHNkghxvEkY2n2ETA0QTIII4mTPFdmgAZxKW7jxrvaAJkEEcTpvguTYAM4tLdR413NAEyiKMJU3yXJkAGcenuo8Y7mgAZxNGEKb5LEyCDuHT3UeMdTYAM4mjCFN+lCZBBXLr7qPGOJkAGcTRhiu/SBMggLt191HhHEyCDOJowxXdpAmQQl+4+aryjCZBBHE2Y4rs0ATKIS3cfNd7RBMggjiZM8V2awP8DTbwb16I3aHoAAAAASUVORK5CYII="},4908:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAF7xJREFUeF7tnQn0fkVZx79uKJmKWmKKmYZm5gKaphaKa7kimrukkCjikru4awUuhEJulbhBGJp7omRuqLihR5KC1AgyDXPLrSRM7XzqvvnzMnPvnfvOM3OX5znnPb//Of+5M8/znfu9d+7Ms1xELo6AIxBF4CKOjSPgCMQRcIL43eEIdCDgBPHbwxFwgvg94AiMQ8DfIONw86tWgoATZCUT7WaOQ8AJMg43v2olCDhBVjLRbuY4BJwg43Dzq1aCgBNkJRPtZo5DwAkyDje/aiUIrIEgz844lzn7yqiWd2WFwBoI8n5J+2YCcA14ZYJqGd2sYcKdIMu4V6tY4QRJg30NeKUhsvDWa5hwf4Ms/Ca2NM8JkobuGvBKQ2Thrdcw4bE3yAc65jb2Ub8GvBZ+y6eZt4YJjxHkOZJC27aQg2tCsga80u6ghbde6oTvKukOkn5P0q0jcziGIFzzx5K+sfD7ws1rEFgaQe4v6faSHjxghscQZNPtCyUdL+n0AeN4kxkjsBSCHCDpUEk3S5iLbQjCMN+URB9HJ4zpTWeGwNwJcg9Jj5B0mxG4b0uQzZBvlfRMSWeM0MEvmTgCcyXIXpKeJenuW+CbiyCo8IWGqO/YQh+/dIIIzJEgj2nIsdsE8XyUpJdMUC9XaSQCcyLImLfGZ5odp1zOikNgfr6kw4Y09DbTR2AuBLmfpJdJGvrW+GtJL5Z0UnOmkYsgB0l6rqTde6b2NZIOnP70u4Z9CMyBIL8r6dg+Q5r/P07SqySdsqN9bl+s60g6QtL+PTqdLOmOA/X2ZhNFYOoEebSkYwZgd0JzgPeJQNvcBNkM8QpJD+nR7W1bbiQMMN2bWCIwZYKwjmc50ye4i7AjFRMrgjDe4yQd1aPgn0o6pM8I//9pIlCKIDHfpi5U+r4bcPfgDcPbY5t+UmYm5ODY5bu16buPxCk6TLXtjSVdZodybMPnkpi7UK7+o/2UIsiPMlvy8eapPBVXjyEk4S3C22QJsoekW0m6pSSIwc9KeCg5QRLQfW2z9v/vhGtKNB1CEg42+S6Zo/yapPtIuoUk/l1KnCAJSFcFa4CeQ0iCvxhvwLnIxvkTR9AaUnXO57bEqgrWwLtjCEmu3rinDOyySrM7NcvYu1YZ/ceDVp1zJ4jN7A8hySUlXWAz/Fa93q4hxj236iXfxasmSNf2bGgXpCpYiXPeRxLIAUmmIvtIergkvBYsZVZzXvsNwu5EaOuUbdG5E4SbDNeUV3bcbXgBs9yqKXxwQ4wHjVDic5I+teP3FUlfbX6xnctZzbkTZMRdkXgJzotP6riGD/aUQK/E4aPNr9k4VR6c2OEHJeHS815J53Zc6wRJAHYRYCXY225KUNV+Hdd/TNLNt+g/9dKHSnqGJM4zhgo2sMXO3yGyiDn3N8iQqc7T5jRJv9rR1d9L+o0mlDfPiBfu5foNMe6VMABLRIjxoYRraOoESQBsEWAl2Btr+k+SrtHRD98keACfmWGsdhePbchx+YF9/0UT/PWRge3bzRYx51N4g4TwZwdoCR/pIdu+JemyHTcdySDuLelvRt6Y7ctYuj1dEucaQ+RdTSwNf7eRLoLMZs5rEyR1Aua0zdtl239KIndXTH4giSc+QV/bCN8ZkGOXAZ3wpiBcmDdHDsnlf1d1zp0gOW6FcX38raQb9Fz6uuYGPydxCNIgPVLSTQdcZ5W+yAkyAPxNk0WAlWDv0KZvkkTqoi75V0kEZ+EJfF5PW9xCIAZZJYcIO1Ic3Fl4RS9izv0NMuQ2sm3zBklDdpUgCmcQ/9AczH13h1oPbDJK/vxAVa3eGjuHd4IMnAyaLQKsBHtTm5KdkTzCJcTyreEEGTmDTpB+4HD3eJGhf1aJt4YTpH+eB7dgv/+dgdZflHS1wb0sqyF+Sn8k6UaZzTpREi4vFt8aY1XFXYXNhLaQlYZMNpOQUt8gIWPJQkgpgbaUdruYxETsUAIPX7Z4SQjxs1sq92lJL5AEQaYmT5V0eEApHCB/aSrK1iQI6XxIutCWNw78aJ0KhlZ6/GJDEj7gU4mCAyR5uSAHZy5TFOJNmOuQ1Lwvf0KfmoqQ9TB0ussHK09Ql/9D4OKSCGLih68WXrhtwnxJ0uebTJLgetYMwPvlDpcaltgstatLTYJ8VtK1Awg8YUCuqerAVVaA9DoQhc0PiPG9yvqMHR7d9wxczNvlzWM7zXldTYLgTnHRgDH3lfT6nEZ6X5NFgHIRdw5ox24e32DVpRZBGPeHEetZRpxaHRlXoAQC7Ng9PjAQoQFD3GTMdaxFEFy+cf0OyS9I+mdzy32AKSBALclXRxSpdW/+hDq1lCDX0rsDwOBOcdUpzJzrUAQBnDVx2gwJD9GukN4iCtYiCKfG1PtoC9nZS2btKwKyD9KJwNclXSHQgu3t2DZwMUhrEYSM6KGPMHYuppKPqdgkrHwgvjdJZ9qWSVTqqkUQ8tPeLQAKJ+ulnPZWfl9OxnxWEqwo2kLWFM5+qkotgpCg4LoBy0mPc2RVRHzw0ghQhIh4l7ac3xN1WUTPWgT5r0gYKAmSc4V8FgHQB9kaARwzST4XEg6SOUysJjUIwuEgh4Qhod5EanqZauD5wNkQiIVDVH9g1iAILhJnR6CdQ9bzbHeFd/T/CPyjJJwz21L9Q70GQW7TpK1sg/Fvkq7sN80qEaBsdyiOvrpndw2CkPYyVIqMdWhX5sFV3jkrMfqlkg4N2EqA1941MahBEGIUnhgw2ksm17wT6o4dqxb8nZ4ke+Za1yAIh4H7ByzjKULKGpf1IUBi71hS7N0lUVahitQgyGckkUS5LU+R9LwqKPigtRG4nqQzIkpwyv7RWgrWIEgs7SYB/H9eCwgftyoCpGGNhQZXvS9KE+RikmLlm/0MpOo9Wn1wwoavEtCCzI9UHKsipQnCXjd73iEhK+C/VEHBB50CAqdI4iHZFlYVofRARXQuTZDbSnpPwLKvjcjcUQQgH6QYAuTDOjAwGt8fIW/fIoqVJggJwY4NWEb+ptzJ0ooA6INkQ+Bpkv4w0Bs7WOxkVZHSBHluUziybexfRdzfq4Dig1ZBgGQdMUdVCg5xJlJcShPkLyX9dsDKl0dOUosD4gNWQ+AmkogoDQmn6VXSppYmCEupvQII8Ho9otrU+MBTQICwW8JvQ8JDlVoqxaU0QXhN/nTAyqp73cVR9wFjCMTi0w9rkm8XR64kQUih+f2IhftI+nBx633AqSHAEoulVluIOMTJtbiUJAgpJmPRYZPJxVp8BnzAnQjwkc7HelveJ4kjguJSkiAE4IdKG39D0hWLW+4DThEBtnn5Hm0LiQRJKFhcShIkFpyP8+INi1vuA04RAQ4KOTAMySU63JTMbClJkNjTgSpToQTGZkZ7x5NFAFcTXE5CQrkECpgWlZIEia0v/0zSw4pa7YNNFQGcFXFaDMldmvonRXUvSRAydodCap8eKcVVFAgfbDIIUOvkUgFtSCgYKtlnqnhJgvy7pN0C1lDj+wRTK73zOSHAMipUo7BKzZBSBOED64LILHk9kDndvva6TirDSSmCXEsS1UtDskfHutN+OnyEqSFAxpvQoWCVzP+lCBKrB/KtyLJrapPm+pRDIFYe+rxIxKGpZqUIcrAkdqvaQhJrAvZdHIENAg/oyE2wS4e7kgmCpQgSOwNhvflbJpZ5p3NF4Nc7/PII2Y6V7jOxtxRBiCvmydCWak5oJmh6pzkQ4Js0lptg346DxBxjX6iPUgT5WKS0mseBmEzr7Dsl8w0ZcNryO5KOL2ldKYKQlCHkkMhb5XUlDfaxZoFALNt78QdqCYLwYUXBnJCw3vzILKbMlSyJAOXXqALQlj+JlGsz060EQagS9NmIBZR8pvSziyOwE4FYCqCTJOGTVUxKEIS6D+xWtaV65u5iKPtAqQg8UxIZFdtC/l5qqxeTEgSJ1QM5K1LIs5jxPtBkEXiQpNcEtPumpMuX1LoEQQ6XxOloW94t6TdLGutjzQYBtnPfH9H2cpK+XcqSEgTBU5dijG3xOJBSszy/cQivPSeiNp4XeGAUkRIEOTWSW5W3CpkWXRyBNgLclz+MwHJHSSeXgqwEQSjOeaWAQdVL/JYC2ccZhQCJGsj43xaiT0N+faMG6bvImiCXlHR+RImqlYP6gPH/r45ArBwCfn3PKKWdNUGIDIsF2hN/jAuziyMQQuC4SF2Q10p6cCnIrAnCLlVovUi5rUuXMtLHmSUCfyCJfAVtYXcrdMpuYqQ1QWJnIJysX8fEIu90KQjEasngp0WEahGxJggZ26le2xaPAykyvbMeJJaJE7++UNYTE2OtCYKn7v0CmhN3fIiJRd7pUhDoymNwZUnsjpqLNUHw1L15wAqviW4+tbMfoMsLnAzwnyxhoTVB8NT9uYAhvFVOLGGgjzFrBGKloe8h6S0lLLMkCOtEsuSFhLcKUYYujkAXArEVyGMkHVMCOkuCsEuFx25IeKt8uYSBPsasEYjlcz5K0hNKWGZJkNgZCCfru5YwzseYPQKxqshvkHSfEtZZEgSfGUIk28LJOqnsXRyBPgQeFUlYzdKLcG1zsSRI7AzE40DMp3UxA1DdltLhbTlX0jVKWGlJEHxmSNPSlldLOqiEcT7G7BGIJZErdlhoSZD3RAovFvXGnP0tsm4Drinp7AgEP9NRVz0bapYEOTPyrfHwyLdJNqO8o8Ug0HVYeH1Jf2dtqSVByNx+2YAB+0l6u7Vh3v9iEIgVXiJbTqhqclbDrQhCYD0ZKEJCGbZPZbXCO1syArGVCJlPiBkxFSuCdB0S7i7pK6ZWeedLQiCWZbGIP58VQQhowbC2/EDSxZc0e26LOQKxygAU9KSwp6lYEeSAyOvvC5KubmqRd740BI6MuJVwPnJva2OtCHJYJKUPDooh93drO73/+SLwOEn4XrWFdFIUgDUVK4K8WNIjA5q/SRKnoy6OwFAECI0Ilcig0hQVp0zFiiAQAZ/9thRZN5oi5p2XRmAfSR8MDEooxU9ZK2NFkFhFqSdLeoG1Ud7/ohDA5ypWl9A8bMKKINSYo9ZcW/h4Z1fCxREYigC7nt+PNN5b0ulDOxrTzoIgRBKS9yrU960ir8sxuvs160Hgu5E8alRIDtWeyYaMBUG6MnPzf+RcdXEEUhD4vKQ9AxeQYRGvcTOxIAjbuLG6gxbjmYHjHU8GAT7S+VhvC8cJz7fU0uKGZfeKXay24Ly4m6Ux3vdiEXh95FDwaEmPtbTagiCPkPSSgNI4nf2KpTHe92IRgAghtxLz2HQLgsRKruGajIuyiyOQigAZTHA5acuHJN0ytbOU9hYEIaQ2lJ6eoowHpijnbR2BBoH7SiIFUFvME1lbEISkDLcPGMObJZTO3u8CR6APgVhsOscJfNfGzkn6+u39fwuCUGDxuoGRi5bO6rXcG8wJATzAyWQSEsq0cTBtIhYEIZKQiMK2mB/qmCDknU4BgYtKIpYoJDeVdJqVkrkJgm8MCatDQrK4WDk2K/u83+UgcIGkSwTMuaukd1iZmZsgN+qIN8fzMpbM2so+73c5CMSq3h4s6VgrM3MT5M4RNv9IEq9JF0dgLAIxD3Eq3pJrzURyEyRWV+6Lkq5mYsE0Ot03oxofyNjXkroixDYUbMehNDl8TSQ3QdjGpTppWz4u6WYmFkyjUyqv5iJJ7jmZBkLba/EiSdQFacsbJd1r++7DPeSejJdKOjQw1NJDbZ0gVnfoj/uNxaZ/OOLImEWj3AR5s6T9A5q9UNLjs2g8zU6cIPbzQgYTnBbbgiv8ta2Gz02Qj0aWUsVKZlkB1dOvE8Qe+FgYBcFUVL39DwsVchMkthXHW+WtFgZMpE8niP1EsMlDXrWQkN0kFre+lWY5CXKFJqXoxQIacT7y6a00nfbFTpAy88NxQUjw1YoF6W2lWU6CEOsRS0dfpJbDVkhsd3GMIM+R9OxA1+x4cU1Ics7JdlZN4+ourFI1jM1HtJ+ck3FbSRTNWeOkO0FSb9Xh7RdDkAdKOj5g97cjzovDIZp+SyeI3RwthiBPjCSFw/39enb4VeuZDC2UeeAvJYlDB4W+xNp+ehZDEM46QgH075SEj9acBS9lduJusoMUbC32iROkD6H+/18MQUgwTKLhtlArnbqEcxOCvm7XEGOsG8kYguCZ+gpJn5gbYEb6zo4g7MqQITEkoRupy/mOG2hKznlXasgMMXKk1u+ybQjp+KYjcwf9cCC2RukiyK0jgDwrcckbxXXMLhYEQYEcgoFTIMhlGh8y3nRTLfCDNyubAeB1Vg7wZ9LHmC3x1E0TJ0gEARIj41wJMfjgnosQG8Hb5VWSzp+L0iP1dIKMBG7byx7QlPbaa8uOCDH+XEZ39xR1eJOQZgmifD3lwhm1dYJUmCyi0H5/xLgsc05pYuuJr/9S00dOV5MRav2vjxIkgSwxf6Ux/U7hGidIwVngW4PycNTYHiqQ4m2Ns2XMYzQnQc6RRNGYMcJbZEOUpXynLIYgfDzydA1J7KO+5Ec6SylKwIWyhLd15kZ7mSSyQQ7xEg35W425wbmGvu4miWwd/GVnLVX4LoEobBnP3Um0iyDsgoaEXdaUg9sovjl3sSBIbNst5oVZiiBknOfNcZWeO40bC2LwOzv1rjRozxvvLjvIcunEMcg8SHkAyt7N9WN+lucgoTfCVAkSC9Vs32scaEKMMxJvwlLNOc3nrbIhTMq4n2xIwnJxbuIEMZyxYyQ9uqd/MvZRshqCzEVuLOmhzS9FZ7aGeZvEwhJS+irV1gligPRVJZFAYr+evllGQY6TDXQo0eUYopAaFpLwi6XzLKH70DHwJMiVtaRIPEjsJH0qSyyiyyDHDXtm4H2SKPazhHSoY4hC/gBIMuVQ6Jzk4HaoTpDYrkIsei73R/pDmkIrfaXe2OGBHHP9cI1xfwxRwIJ8ZucNfaQXatdHjjEuSuyyJu045tzFGoNbLoKQcY+lUsyJcqdubDCMOSQcY1+tayAKLjQHDVSAmB0KYpolgR6ox6YZ30oE4MWEBy41aMyXiHMnCGG+pJ3s+9YAaLxheWsclzhZc25+d0lPTshqOYWHxxGSntIBOmS+hSQiVc1ljgQhawo1IdjFCZV6C4EGqJAjdpBpDnTFAcALkjxpYOjz25v2Nb7NXi7pkA6svibpBiWXg3MgCIdlnH4Tn8HSgd8VE264kxpykLNrzULYM0TpWrps8CHZOEuuEwoBxjcjNQgpstQlZFAkk2IxqU0Qbt4vN0V3OCWmhgh/N//eXdLeI9Hgo/Oo5jeyi0VeRgpPiEKusj4hjBqimNUAbB58RFD2hRtwH5zep3Du/69NkNz2bPpjmxdy4PjncmEEdm1IMiTwjWUpJCEGJbeQw4Bvjkv1dMzq4dTcgw/pbwxB+vrFE5USCMRblBYSREAMzjhc+hHAGRJfrb6n93ckPa3xZ+vvtb8FeXbZWr5TT1N8ya7VUdavf6QtW1gQZKMS24wQhZSk1vLeZg37SuuBFtj/Hg1J7j/AthMlEUtDffKxwvWQY5eeDlh+Q+Afjh0ox3WWBEE/TrMPaPJGMRE5hV2WtzQnwZ4BZHtkKU/B2ySUW3ln75RcPrLBfWj5ZTLE8O3DeRUpavuEkmoQqbpYE2RjILsUJFfjF3OJHwIGOxi4SGyIMeQabzMcAeYGkpD/a4i8qzlXwlt451uFarRsxfOAxNkwxZeKA1++ISchpQiy01gcCVlX7rnjb2wZdqYkzjA2f786CdSWrQQPs+dJetgIMyEJB3icVZAQI0XYocJVaVK+YTUIkgKat62HAOWVIUqJb8ijG3LgaTwpcYJMajompwxnD5DkDkaaTfKtsdNWJ4jRzC+s28MlPTWjTSS/4HCQJdXk3hpOkIwzvaKuOLO4Z/O73Ei7T5NE2C+/c0f2UfQyf4MUhXsRg+EORJJyfnhTdwnu6Ow8cgoPKTjInZU4QWY1XZNTlsM+MsWQUGLzFwKxm8UPcnxvclonKOQESQDLm64PASfI+ubcLU5AwAmSAJY3XR8CTpD1zblbnICAEyQBLG+6PgScIOubc7c4AQEnSAJY3nR9CDhB1jfnbnECAk6QBLC86foQcIKsb87d4gQEnCAJYHnT9SHgBFnfnLvFCQg4QRLA8qbrQ8AJsr45d4sTEPgffE/z9kS6oSYAAAAASUVORK5CYII="},7885:function(e,t,n){n.d(t,{a:function(){return i},c:function(){return o}});n(1703);var i="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};function o(e,t,n){return n={path:t,exports:{},require:function(e,t){return r(e,void 0===t||null===t?n.path:t)}},e(n,n.exports),n.exports}function r(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}},8424:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Z:function(){return protobuf$1}});var core_js_modules_es_error_cause_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1703),core_js_modules_es_typed_array_at_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(8675),core_js_modules_es_typed_array_set_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3462),_commonjsHelpers_3aae1032_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(7885);function _mergeNamespaces(e,t){return t.forEach((function(t){t&&"string"!==typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var protobuf=(0,_commonjsHelpers_3aae1032_js__WEBPACK_IMPORTED_MODULE_3__.c)((function(module){
/*!
   * protobuf.js v6.7.0 (c) 2016, Daniel Wirtz
   * Compiled Sun, 02 Apr 2017 11:28:29 UTC
   * Licensed under the BSD-3-Clause License
   * see: https://github.com/dcodeIO/protobuf.js for details
   */
(function(global,undefined$1){(function(e,t,n){function i(n){var o=t[n];return o||e[n][0].call(o=t[n]={exports:{}},i,o,o.exports),o.exports}var o=global.protobuf=i(n[0]);"function"===typeof undefined$1&&undefined$1.amd&&undefined$1(["long"],(function(e){return e&&e.isLong&&(o.util.Long=e,o.configure()),o})),module&&module.exports&&(module.exports=o)})({1:[function(e,t,n){function i(e,t){for(var n=[],i=2;i<arguments.length;)n.push(arguments[i++]);var o=!0;return new Promise((function(i,r){n.push((function(e){if(o)if(o=!1,e)r(e);else{for(var t=[],n=1;n<arguments.length;)t.push(arguments[n++]);i.apply(null,t)}}));try{e.apply(t||this,n)}catch(s){o&&(o=!1,r(s))}}))}t.exports=i},{}],2:[function(e,t,n){var i=n;i.length=function(e){var t=e.length;if(!t)return 0;var n=0;while(--t%4>1&&"="===e.charAt(t))++n;return Math.ceil(3*e.length)/4-n};for(var o=new Array(64),r=new Array(123),s=0;s<64;)r[o[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;i.encode=function(e,t,n){var i,r=[],s=0,a=0;while(t<n){var c=e[t++];switch(a){case 0:r[s++]=o[c>>2],i=(3&c)<<4,a=1;break;case 1:r[s++]=o[i|c>>4],i=(15&c)<<2,a=2;break;case 2:r[s++]=o[i|c>>6],r[s++]=o[63&c],a=0;break}}return a&&(r[s++]=o[i],r[s]=61,1===a&&(r[s+1]=61)),String.fromCharCode.apply(String,r)};var a="invalid encoding";i.decode=function(e,t,n){for(var i,o=n,s=0,c=0;c<e.length;){var l=e.charCodeAt(c++);if(61===l&&s>1)break;if((l=r[l])===undefined$1)throw Error(a);switch(s){case 0:i=l,s=1;break;case 1:t[n++]=i<<2|(48&l)>>4,i=l,s=2;break;case 2:t[n++]=(15&i)<<4|(60&l)>>2,i=l,s=3;break;case 3:t[n++]=(3&i)<<6|l,s=0;break}}if(1===s)throw Error(a);return n-o},i.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},{}],3:[function(e,t,n){function i(){this._listeners={}}t.exports=i,i.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},i.prototype.off=function(e,t){if(e===undefined$1)this._listeners={};else if(t===undefined$1)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===t?n.splice(i,1):++i;return this},i.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,n)}return this}},{}],4:[function(e,t,n){function i(e){return"undefined"!==typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),i=128===n[3];function o(e,i,o){t[0]=e,i[o]=n[0],i[o+1]=n[1],i[o+2]=n[2],i[o+3]=n[3]}function r(e,i,o){t[0]=e,i[o]=n[3],i[o+1]=n[2],i[o+2]=n[1],i[o+3]=n[0]}function s(e,i){return n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=e[i+3],t[0]}function a(e,i){return n[3]=e[i],n[2]=e[i+1],n[1]=e[i+2],n[0]=e[i+3],t[0]}e.writeFloatLE=i?o:r,e.writeFloatBE=i?r:o,e.readFloatLE=i?s:a,e.readFloatBE=i?a:s}():function(){function t(e,t,n,i){var o=t<0?1:0;if(o&&(t=-t),0===t)e(1/t>0?0:2147483648,n,i);else if(isNaN(t))e(2143289344,n,i);else if(t>34028234663852886e22)e((o<<31|2139095040)>>>0,n,i);else if(t<11754943508222875e-54)e((o<<31|Math.round(t/1401298464324817e-60))>>>0,n,i);else{var r=Math.floor(Math.log(t)/Math.LN2),s=8388607&Math.round(t*Math.pow(2,-r)*8388608);e((o<<31|r+127<<23|s)>>>0,n,i)}}function n(e,t,n){var i=e(t,n),o=2*(i>>31)+1,r=i>>>23&255,s=8388607&i;return 255===r?s?NaN:o*(1/0):0===r?1401298464324817e-60*o*s:o*Math.pow(2,r-150)*(s+8388608)}e.writeFloatLE=t.bind(null,o),e.writeFloatBE=t.bind(null,r),e.readFloatLE=n.bind(null,s),e.readFloatBE=n.bind(null,a)}(),"undefined"!==typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),i=128===n[7];function o(e,i,o){t[0]=e,i[o]=n[0],i[o+1]=n[1],i[o+2]=n[2],i[o+3]=n[3],i[o+4]=n[4],i[o+5]=n[5],i[o+6]=n[6],i[o+7]=n[7]}function r(e,i,o){t[0]=e,i[o]=n[7],i[o+1]=n[6],i[o+2]=n[5],i[o+3]=n[4],i[o+4]=n[3],i[o+5]=n[2],i[o+6]=n[1],i[o+7]=n[0]}function s(e,i){return n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=e[i+3],n[4]=e[i+4],n[5]=e[i+5],n[6]=e[i+6],n[7]=e[i+7],t[0]}function a(e,i){return n[7]=e[i],n[6]=e[i+1],n[5]=e[i+2],n[4]=e[i+3],n[3]=e[i+4],n[2]=e[i+5],n[1]=e[i+6],n[0]=e[i+7],t[0]}e.writeDoubleLE=i?o:r,e.writeDoubleBE=i?r:o,e.readDoubleLE=i?s:a,e.readDoubleBE=i?a:s}():function(){function t(e,t,n,i,o,r){var s=i<0?1:0;if(s&&(i=-i),0===i)e(0,o,r+t),e(1/i>0?0:2147483648,o,r+n);else if(isNaN(i))e(0,o,r+t),e(2146959360,o,r+n);else if(i>17976931348623157e292)e(0,o,r+t),e((s<<31|2146435072)>>>0,o,r+n);else{var a;if(i<22250738585072014e-324)a=i/5e-324,e(a>>>0,o,r+t),e((s<<31|a/4294967296)>>>0,o,r+n);else{var c=Math.floor(Math.log(i)/Math.LN2);1024===c&&(c=1023),a=i*Math.pow(2,-c),e(4503599627370496*a>>>0,o,r+t),e((s<<31|c+1023<<20|1048576*a&1048575)>>>0,o,r+n)}}}function n(e,t,n,i,o){var r=e(i,o+t),s=e(i,o+n),a=2*(s>>31)+1,c=s>>>20&2047,l=4294967296*(1048575&s)+r;return 2047===c?l?NaN:a*(1/0):0===c?5e-324*a*l:a*Math.pow(2,c-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,o,0,4),e.writeDoubleBE=t.bind(null,r,4,0),e.readDoubleLE=n.bind(null,s,0,4),e.readDoubleBE=n.bind(null,a,4,0)}(),e}function o(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function r(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function s(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function a(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}t.exports=i(i)},{}],5:[function(require,module,exports){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},{}],6:[function(e,t,n){function i(e,t,n){var i=n||8192,o=i>>>1,r=null,s=i;return function(n){if(n<1||n>o)return e(n);s+n>i&&(r=e(i),s=0);var a=t.call(r,s,s+=n);return 7&s&&(s=1+(7|s)),a}}t.exports=i},{}],7:[function(e,t,n){var i=n;i.length=function(e){for(var t=0,n=0,i=0;i<e.length;++i)n=e.charCodeAt(i),n<128?t+=1:n<2048?t+=2:55296===(64512&n)&&56320===(64512&e.charCodeAt(i+1))?(++i,t+=4):t+=3;return t},i.read=function(e,t,n){var i=n-t;if(i<1)return"";var o,r=null,s=[],a=0;while(t<n)o=e[t++],o<128?s[a++]=o:o>191&&o<224?s[a++]=(31&o)<<6|63&e[t++]:o>239&&o<365?(o=((7&o)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[a++]=55296+(o>>10),s[a++]=56320+(1023&o)):s[a++]=(15&o)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,s)),a=0);return r?(a&&r.push(String.fromCharCode.apply(String,s.slice(0,a))),r.join("")):String.fromCharCode.apply(String,s.slice(0,a))},i.write=function(e,t,n){for(var i,o,r=n,s=0;s<e.length;++s)i=e.charCodeAt(s),i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&56320===(64512&(o=e.charCodeAt(s+1)))?(i=65536+((1023&i)<<10)+(1023&o),++s,t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128);return n-r}},{}],8:[function(e,t,n){var i=n;function o(){i.Reader._configure(i.BufferReader),i.util._configure()}i.build="minimal",i.roots={},i.Writer=e(15),i.BufferWriter=e(16),i.Reader=e(9),i.BufferReader=e(10),i.util=e(14),i.rpc=e(11),i.configure=o,i.Writer._configure(i.BufferWriter),o()},{10:10,11:11,14:14,15:15,16:16,9:9}],9:[function(e,t,n){t.exports=c;var i,o=e(14),r=o.LongBits,s=o.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var l="undefined"!==typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")};function u(){var e=new r(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function h(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw a(this,8);return new r(h(this.buf,this.pos+=4),h(this.buf,this.pos+=4))}c.create=o.Buffer?function(e){return(c.create=function(e){return o.Buffer.isBuffer(e)?new i(e):l(e)})(e)}:l,c.prototype._slice=o.Array.prototype.subarray||o.Array.prototype.slice,c.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return e}}(),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return h(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|h(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=o.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=o.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return this.pos+=e,t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},c.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},c.prototype.skip=function(e){if("number"===typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:do{if(4===(e=7&this.uint32()))break;this.skipType(e)}while(1);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){i=e;var t=o.Long?"toLong":"toNumber";o.merge(c.prototype,{int64:function(){return u.call(this)[t](!1)},uint64:function(){return u.call(this)[t](!0)},sint64:function(){return u.call(this).zzDecode()[t](!1)},fixed64:function(){return d.call(this)[t](!0)},sfixed64:function(){return d.call(this)[t](!1)}})}},{14:14}],10:[function(e,t,n){t.exports=r;var i=e(9);(r.prototype=Object.create(i.prototype)).constructor=r;var o=e(14);function r(e){i.call(this,e)}o.Buffer&&(r.prototype._slice=o.Buffer.prototype.slice),r.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))}},{14:14,9:9}],11:[function(e,t,n){var i=n;i.Service=e(12)},{12:12}],12:[function(e,t,n){t.exports=o;var i=e(14);function o(e,t,n){if("function"!==typeof e)throw TypeError("rpcImpl must be a function");i.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(o.prototype=Object.create(i.EventEmitter.prototype)).constructor=o,o.prototype.rpcCall=function e(t,n,o,r,s){if(!r)throw TypeError("request must be specified");var a=this;if(!s)return i.asPromise(e,a,t,n,o,r);if(!a.rpcImpl)return setTimeout((function(){s(Error("already ended"))}),0),undefined$1;try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](r).finish(),(function(e,n){if(e)return a.emit("error",e,t),s(e);if(null===n)return a.end(!0),undefined$1;if(!(n instanceof o))try{n=o[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),s(e)}return a.emit("data",n,t),s(null,n)}))}catch(c){return a.emit("error",c,t),setTimeout((function(){s(c)}),0),undefined$1}},o.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{14:14}],13:[function(e,t,n){t.exports=o;var i=e(14);function o(e,t){this.lo=e>>>0,this.hi=t>>>0}var r=o.zero=new o(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var s=o.zeroHash="\0\0\0\0\0\0\0\0";o.fromNumber=function(e){if(0===e)return r;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new o(n,i)},o.from=function(e){if("number"===typeof e)return o.fromNumber(e);if(i.isString(e)){if(!i.Long)return o.fromNumber(parseInt(e,10));e=i.Long.fromString(e)}return e.low||e.high?new o(e.low>>>0,e.high>>>0):r},o.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},o.prototype.toLong=function(e){return i.Long?new i.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;o.fromHash=function(e){return e===s?r:new o((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},o.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},o.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},o.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},o.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},{14:14}],14:[function(e,t,n){var i=n;function o(e,t,n){for(var i=Object.keys(t),o=0;o<i.length;++o)e[i[o]]!==undefined$1&&n||(e[i[o]]=t[i[o]]);return e}function r(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&o(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}i.asPromise=e(1),i.base64=e(2),i.EventEmitter=e(3),i.float=e(4),i.inquire=e(5),i.utf8=e(7),i.pool=e(6),i.LongBits=e(13),i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isNode=Boolean(global.process&&global.process.versions&&global.process.versions.node),i.isInteger=Number.isInteger||function(e){return"number"===typeof e&&isFinite(e)&&Math.floor(e)===e},i.isString=function(e){return"string"===typeof e||e instanceof String},i.isObject=function(e){return e&&"object"===typeof e},i.isset=i.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!==typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},i.Buffer=function(){try{var e=i.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(t){return null}}(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(e){return"number"===typeof e?i.Buffer?i._Buffer_allocUnsafe(e):new i.Array(e):i.Buffer?i._Buffer_from(e):"undefined"===typeof Uint8Array?e:new Uint8Array(e)},i.Array="undefined"!==typeof Uint8Array?Uint8Array:Array,i.Long=global.dcodeIO&&global.dcodeIO.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(e){return e?i.LongBits.from(e).toHash():i.LongBits.zeroHash},i.longFromHash=function(e,t){var n=i.LongBits.fromHash(e);return i.Long?i.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},i.merge=o,i.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},i.newError=r,i.ProtocolError=r("ProtocolError"),i.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&this[e[n]]!==undefined$1&&null!==this[e[n]])return e[n]}},i.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},i.lazyResolve=function(e,t){for(var n=0;n<t.length;++n)for(var i=Object.keys(t[n]),o=0;o<i.length;++o){var r=t[n][i[o]].split("."),s=e;while(r.length)s=s[r.shift()];t[n][i[o]]=s}},i.toJSONOptions={longs:String,enums:String,bytes:String},i._configure=function(){var e=i.Buffer;e?(i._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},i._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):i._Buffer_from=i._Buffer_allocUnsafe=null}},{1:1,13:13,2:2,3:3,4:4,5:5,6:6,7:7}],15:[function(e,t,n){t.exports=h;var i,o=e(14),r=o.LongBits,s=o.base64,a=o.utf8;function c(e,t,n){this.fn=e,this.len=t,this.next=undefined$1,this.val=n}function l(){}function u(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new c(l,0,0),this.tail=this.head,this.states=null}function d(e,t,n){t[n]=255&e}function f(e,t,n){while(e>127)t[n++]=127&e|128,e>>>=7;t[n]=e}function p(e,t){this.len=e,this.next=undefined$1,this.val=t}function m(e,t,n){while(e.hi)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;while(e.lo>127)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function _(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=o.Buffer?function(){return(h.create=function(){return new i})()}:function(){return new h},h.alloc=function(e){return new o.Array(e)},o.Array!==Array&&(h.alloc=o.pool(h.alloc,o.Array.prototype.subarray)),h.prototype.push=function(e,t,n){return this.tail=this.tail.next=new c(e,t,n),this.len+=t,this},p.prototype=Object.create(c.prototype),p.prototype.fn=f,h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this.push(m,10,r.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=r.from(e);return this.push(m,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=r.from(e).zzEncode();return this.push(m,t.length(),t)},h.prototype.bool=function(e){return this.push(d,1,e?1:0)},h.prototype.fixed32=function(e){return this.push(_,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=r.from(e);return this.push(_,4,t.lo).push(_,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this.push(o.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this.push(o.float.writeDoubleLE,8,e)};var g=o.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this.push(d,1,0);if(o.isString(e)){var n=h.alloc(t=s.length(e));s.decode(e,n,0),e=n}return this.uint32(t).push(g,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t).push(a.write,t,e):this.push(d,1,0)},h.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new c(l,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(l,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){var e=this.head.next,t=this.constructor.alloc(this.len),n=0;while(e)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){i=e}},{14:14}],16:[function(e,t,n){t.exports=s;var i=e(15);(s.prototype=Object.create(i.prototype)).constructor=s;var o=e(14),r=o.Buffer;function s(){i.call(this)}s.alloc=function(e){return(s.alloc=o._Buffer_allocUnsafe)(e)};var a=r&&r.prototype instanceof Uint8Array&&"set"===r.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]};function c(e,t,n){e.length<40?o.utf8.write(e,t,n):t.utf8Write(e,n)}s.prototype.bytes=function(e){o.isString(e)&&(e=o._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this.push(a,t,e),this},s.prototype.string=function(e){var t=r.byteLength(e);return this.uint32(t),t&&this.push(c,t,e),this}},{14:14,15:15}]},{},[8])})("object"===typeof window&&window||"object"===typeof self&&self||_commonjsHelpers_3aae1032_js__WEBPACK_IMPORTED_MODULE_3__.a)})),protobuf$1=_mergeNamespaces({__proto__:null,default:protobuf},[protobuf])}}]);
//# sourceMappingURL=240.d3de6881.js.map